<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>一款开源的代码部署工具syncd | 极客快訊</title><meta property="og:title" content="一款开源的代码部署工具syncd - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/912bd2aacb3248e6ae345571d791df29"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/68511dda.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/68511dda.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e6%b8%b8%e6%88%8f/68511dda.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/68511dda.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/68511dda.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e6%b8%b8%e6%88%8f/68511dda.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e6%b8%b8%e6%88%8f/68511dda.html><link rel=canonical href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/68511dda.html><meta property="article:published_time" content="2020-11-14T20:54:26+08:00"><meta property="article:modified_time" content="2020-11-14T20:54:26+08:00"><meta name=Keywords content><meta name=description content="一款开源的代码部署工具syncd"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E6%B8%B8%E6%88%8F/68511dda.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一款开源的代码部署工具syncd</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E6%B8%B8%E6%88%8F.html>游戏</a></span></div><div class=post-content><div><h1>特性</h1><ul><li>Go语言开发，编译简单、运行高效</li><li>Web界面访问，交互友好</li><li>灵活的角色权限配置</li><li>支持Git仓库</li><li>分支、tag上线</li><li>部署hook支持</li><li>完善的上线工作流</li><li>邮件通知机制</li></ul><h1>原理</h1><div class=pgc-img><img alt=一款开源的代码部署工具syncd onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/912bd2aacb3248e6ae345571d791df29><p class=pgc-img-caption></p></div><p>Git</p><p>Syncd服务通过git-ssh(或password)方式从仓库中拉取指定tag(分支)代码</p><p>构建</p><p>运行配置好的构建脚本, 编译成可上线的软件包</p><p>在这一环节中，可运行单元测试 (例如 go test php phpunit, 下载依赖 (如 go: glide install php: composer install), 编译软件包 (如 js: npm build go: go build xx.go java: javac xx.java c: cc xx.c) 等.</p><p>分发</p><p>通过 scp 命令分发软件包到各机房生产服务器的临时目录, 远程执行 pre-deploy 配置的命令, 执行完毕后解压缩软件包到目标目录，然后执行 post-deploy 命令</p><p>分发上线过程是串行执行，并且任意步骤执行失败整个上线单会终止上线并将状态置为上线失败，需要点击 <strong>再次上线</strong> 重试.</p><blockquote><p>将来会支持同一集群服务器并行执行, 集群之间串行发布的特性</p></blockquote><p>SSH信任</p><p>生产服务器与部署服务器之间通过ssh-key建立信任</p><p>配置方法请参考 秘钥配置 章节</p><h1>安装</h1><p>准备工作</p><ul><li>Go</li></ul><p>推荐Go1.10以上版本, 用来编译源代码</p><ul><li>Nginx</li></ul><p>Web服务依赖Nginx</p><ul><li>MySQL</li></ul><p>系统依赖Mysql存储持久化数据, 推荐版本 Mysql 5.7</p><ul><li>Linux + Bash</li></ul><p>系统会使用到 git, ssh, scp 等命令，所以目前只推荐在Linux上使用, 并且需要提前安装或更新这些命令道最新版本</p><ul><li>秘钥配置</li></ul><p>由于部署服务器(Syncd服务所在的服务器)与生产服务器(代码部署目标机)之间通过ssh协议通信，所以需要将部署机的公钥 (一般在这里: ~/.ssh/id_rsa.pub)加入到生产机的信任列表中(一般在这里 ~/.ssh/authorized_keys)</p><p>可使用 ssh-copy-id 命令添加，或手动拷贝. 拷贝后不要忘记进行测试连通性 ssh {生产机用户名}@{生产机地址}</p><p>最后建议将以下配置加入到部署服务器ssh配置/etc/ssh/ssh_config中，关闭公钥摘要的显示提示，防止后台脚本运行失败</p><pre>Host * StrictHostKeyChecking no</pre><p>请注意: ssh目录权限需按此设置，否则会出现无法免密登录的情况</p><pre>~/.ssh 0700~/.ssh/authorized_keys 0600</pre><h1>安装</h1><ul><li>运行以下命令</li></ul><pre>curl https://raw.githubusercontent.com/dreamans/syncd/master/install.sh |bash</pre><p>当前路径中若生成 syncd-deploy 或者 syncd-deploy-xxx 目录则表明安装成功</p><blockquote><p>生成的 syncd-deploy 目录可拷贝或移动到你想要的地方，但不要试图将此目录拷贝到其他服务器上运行，会造成不可预料的结果.</p></blockquote><ul><li>数据库依赖</li></ul><p>你需要将 github.com/dreamans/syncd/syncd.sql 数据表结构和数据导入到MySQL数据库中</p><ul><li>修改配置文件</li></ul><p>修改 syncd-deploy/etc/syncd.ini 中相关配置信息, 具体配置描述可参考注释</p><ul><li>启动服务</li></ul><pre>cd syncd-deploy➜ syncd-deploy ./bin/syncd -c ./etc/syncd.ini __ _____ __ __ ____ _____ ____/ / / ___/ / / / / / __ \ / ___/ / __ / (__ ) / /_/ / / / / / / /__ / /_/ //____/ \__, / /_/ /_/ \___/ \__,_/ /____/Service: syncdVersion: 1.0.0Config Loaded: ./etc/syncd.iniLog: stdoutDatabase: 127.0.0.1Mail Enable: 0HTTP Service: :8868Start Running...</pre><ul><li>添加Nginx配置</li></ul><pre>upstream syncdServer { server 127.0.0.1:8868 weight=1;}server { listen 80; server_name deploy.syncd.cc; # 此处替换成你的真实域名 access_log logs/deploy.syncd.cc.log; location / { try_files $uri $uri/ /index.html; root /path/syncd-deploy/public; # 此处/path请替换成真实路径 index index.html index.htm; } location ^~ /api/ { proxy_pass http://syncdServer; proxy_set_header X-Forwarded-Host $host:$server_port; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Origin $host:$server_port; proxy_set_header Referer $host:$server_port; }}</pre><p>重启nginx服务</p><p>修改hosts</p><p>若域名未解析，可修改hosts进行临时解析</p><pre>sudo vim /etc/hosts127.0.0.1 deploy.syncd.cc;</pre><p>安装完成</p><p>打开浏览器，访问 http://deploy.syncd.cc</p><p>初始账号:</p><pre>用户名: syncd邮箱: syncd@syncd.cc密码: syncd.cc</pre><p><strong>!!!登录后请尽快修改密码</strong></p><h1>使用</h1><p>系统使用流程图</p><div class=pgc-img><img alt=一款开源的代码部署工具syncd onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6e0433f774354bb0a0f57988659b6a04><p class=pgc-img-caption></p></div><h1>使用截图</h1><div class=pgc-img><img alt=一款开源的代码部署工具syncd onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1a37eae8962a4b3189123c5a66c58157><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=一款开源的代码部署工具syncd onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f519466330304d7688d467f32545aa72><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=一款开源的代码部署工具syncd onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2d42587c474e45f38b847a7f4e348704><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=一款开源的代码部署工具syncd onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fe2e57977a4f4be4b8eda8d061cb7d04><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=一款开源的代码部署工具syncd onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c871d116f93f4e969832dc2ea9eb05fe><p class=pgc-img-caption></p></div><h1>项目地址</h1><p>https://gitee.com/dreamans/syncd</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'开源','代码','syncd'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>