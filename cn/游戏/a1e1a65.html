<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Python数据清洗(三)：异常值识别与处理 | 极客快訊</title><meta property="og:title" content="Python数据清洗(三)：异常值识别与处理 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="http://p1.pstatp.com/large/pgc-image/0101706610e44949a0268661007777d6"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/a1e1a65.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/a1e1a65.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e6%b8%b8%e6%88%8f/a1e1a65.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/a1e1a65.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/a1e1a65.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e6%b8%b8%e6%88%8f/a1e1a65.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e6%b8%b8%e6%88%8f/a1e1a65.html><link rel=canonical href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/a1e1a65.html><meta property="article:published_time" content="2020-10-29T20:48:05+08:00"><meta property="article:modified_time" content="2020-10-29T20:48:05+08:00"><meta name=Keywords content><meta name=description content="Python数据清洗(三)：异常值识别与处理"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E6%B8%B8%E6%88%8F/a1e1a65.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Python数据清洗(三)：异常值识别与处理</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E6%B8%B8%E6%88%8F.html>游戏</a></span></div><div class=post-content><div class=pgc-img><img alt=Python数据清洗(三)：异常值识别与处理 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/0101706610e44949a0268661007777d6><p class=pgc-img-caption></p></div><blockquote><p>作者 | 刘顺祥</p></blockquote><blockquote><p>来源 | 数据分析1480</p></blockquote><p>在《Python数据清洗(一)：类型转换和冗余数据删除》和《Python数据清洗(二)：缺失值识别与处理》文中已经讲解了有关数据中重复观测和缺失值的识别与处理，在本节中将分享异常值的判断和处理方法。</p><p>异常值也称为离群点，就是那些远离绝大多数样本点的特殊群体，通常这样的数据点在数据集中都表现出不合理的特性。如果忽视这些异常值，在某些建模场景下就会导致结论的错误（如线性回归模型、K均值聚类等），所以在数据的探索过程中，有必要识别出这些异常值并处理好它们。</p><p><strong>异常值的识别</strong></p><p>通常，异常值的识别可以借助于图形法（如箱线图、正态分布图）和建模法（如线性回归、聚类算法、K近邻算法），在本期内容中，将分享两种图形法，在下一期将分享基于模型识别异常值的方法。</p><p><strong>箱线图法</strong></p><p>箱线图技术实际上就是利用数据的分位数识别其中的异常点，该图形属于典型的统计图形，在学术界和工业界都得到广泛的应用。箱线图的形状特征如下图所示：</p><div class=pgc-img><img alt=Python数据清洗(三)：异常值识别与处理 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/08be6d2a7db3417fabd888976514d1ad><p class=pgc-img-caption></p></div><p>图中的下四分位数指的是数据的25%分位点所对应的值（Q1）；中位数即为数据的50%分位点所对应的值（Q2）；上四分位数则为数据的75%分位点所对应的值（Q3）；上须的计算公式为Q3+1.5(Q3-Q1)；下须的计算公式为Q1-1.5(Q3-Q1)。其中，Q3-Q1表示四分位差。如果采用箱线图识别异常值，其判断标准是，当变量的数据值大于箱线图的上须或者小于箱线图的下须时，就可以认为这样的数据点为异常点。</p><p>所以，基于上方的箱线图，可以定义某个数值型变量中的异常点和极端异常点，它们的判断表达式如下表所示：</p><div class=pgc-img><img alt=Python数据清洗(三)：异常值识别与处理 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/c3ccfe2d252847ca9def3666fe377c07><p class=pgc-img-caption></p></div><p>在Python中可以使用matplotlib模块实现数据的可视化，其中boxplot函数就是用于绘制箱线图的。下面以1700年至1988年太阳黑子数量的数据为例，利用箱线图法识别数据中的异常点和极端异常点。具体的代码如下：</p><pre># 导入第三方模块import pandas as pdimport matplotlib.pyplot as plt# 导入数据sunspots = pd.read_csv(r'C:\Users\Administrator\Desktop\sunspots.csv')# 绘制箱线图（1.5倍的四分位差，如需绘制3倍的四分位差，只需调整whis参数）plt.boxplot(x = sunspots.counts, # 指定绘制箱线图的数据 whis = 1.5, # 指定1.5倍的四分位差 widths = 0.7, # 指定箱线图的宽度为0.8 patch_artist = True, # 指定需要填充箱体颜色 showmeans = True, # 指定需要显示均值 boxprops = {'facecolor':'steelblue'}, # 指定箱体的填充色为铁蓝色 # 指定异常点的填充色、边框色和大小 flierprops = {'markerfacecolor':'red', 'markeredgecolor':'red', 'markersize':4},  # 指定均值点的标记符号（菱形）、填充色和大小 meanprops = {'marker':'D','markerfacecolor':'black', 'markersize':4},  medianprops = {'linestyle':'--','color':'orange'}, # 指定中位数的标记符号（虚线）和颜色 labels = [''] # 去除箱线图的x轴刻度值 )# 显示图形plt.show()</pre><div class=pgc-img><img alt=Python数据清洗(三)：异常值识别与处理 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/18f136c4dcd74a27902bdb4a8ee0206e><p class=pgc-img-caption></p></div><p>如上图所示，利用matplotlib子模块pyplot中的boxplot函数可以非常方便地绘制箱线图，其中左图的上下须设定为1.5倍的四分位差，右图的上下须设定为3倍的四分位差。从左图可知，发现数据集中至少存在5个异常点，它们均在上须之上；而在右图中并没有显示极端异常点。</p><p>通过上图可以直观地发现数据中是否存在异常点或极端异常点，但无法得知哪些观测为异常点，以及这些异常点的具体数值。为解决该问题，读者可以通过下方的代码实现查询：</p><pre># 计算下四分位数和上四分位Q1 = sunspots.counts.quantile(q = 0.25)Q3 = sunspots.counts.quantile(q = 0.75)# 基于1.5倍的四分位差计算上下须对应的值low_whisker = Q1 - 1.5*(Q3 - Q1)up_whisker = Q3 + 1.5*(Q3 - Q1)# 寻找异常点sunspots.counts[(sunspots.counts &gt; up_whisker) | (sunspots.counts &lt; low_whisker)]</pre><div class=pgc-img><img alt=Python数据清洗(三)：异常值识别与处理 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/1d75bf779d7e4c31b6f5a2c8c0a72a60><p class=pgc-img-caption></p></div><p><strong>正态分布图法</strong></p><p>根据正态分布的定义可知，数据点落在偏离均值正负1倍标准差（即sigma值）内的概率为68.2%；数据点落在偏离均值正负2倍标准差内的概率为95.4%；数据点落在偏离均值正负3倍标准差内的概率为99.6%。</p><p>所以，换个角度思考上文提到的概率值，如果数据点落在偏离均值正负2倍标准差之外的概率就不足5%，它属于小概率事件，即认为这样的数据点为异常点。同理，如果数据点落在偏离均值正负3倍标准差之外的概率将会更小，可以认为这些数据点为极端异常点。为使读者直观地理解文中提到的概率值，可以查看标准正态分布的概率密度图，如下图所示：</p><div class=pgc-img><img alt=Python数据清洗(三)：异常值识别与处理 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/c152166fa63147b6848717cf1f9f4015><p class=pgc-img-caption></p></div><p>进一步，基于上图的结论，可以按照下表中的判断条件，识别出数值型变量的异常点和极端异常点，如下表所示：</p><div class=pgc-img><img alt=Python数据清洗(三)：异常值识别与处理 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/9e2e2944890c4ac4ae6028cc4e2a48d8><p class=pgc-img-caption></p></div><p>利用正态分布的知识点，结合pyplot子模块中的plot函数绘制折线图和散点图，并借助于两条水平参考线识别异常值或极端异常值。</p><p>接下来以某公司的支付转化率数据为例，使用正态分布的特性识别数据集中的异常点和极端异常点，该数据呈现的是2017年第三季度每天的支付转化率。我们利用如上介绍的plot函数，识别数据中可能存在的异常点或极端异常点。具体代码如下：</p><pre># 读入外部数据pay_ratio = pd.read_excel(r'C:\Users\Administrator\Desktop\pay_ratio.xlsx')# 绘制单条折线图，并在折线图的基础上添加点图plt.plot(pay_ratio.date, # x轴数据 pay_ratio.ratio, # y轴数据 linestyle = '-', # 设置折线类型 linewidth = 2, # 设置线条宽度 color = 'steelblue', # 设置折线颜色 marker = 'o', # 往折线图中添加圆点 markersize = 4, # 设置点的大小 markeredgecolor='black', # 设置点的边框色 markerfacecolor='black') # 设置点的填充色# 显示图形plt.show()# 添加上下界的水平参考线（便于判断异常点，如下判断极端异常点，只需将2改为3）plt.axhline(y = pay_ratio.ratio.mean() - 2* pay_ratio.ratio.std(), linestyle = '--', color = 'gray')plt.axhline(y = pay_ratio.ratio.mean() + 2* pay_ratio.ratio.std(), linestyle = '--', color = 'gray')# 导入模块，用于日期刻度的修改（因为默认格式下的日期刻度标签并不是很友好）import matplotlib as mpl# 获取图的座标信息ax = plt.gca()# 设置日期的显示格式 date_format = mpl.dates.DateFormatter("%m-%d") ax.xaxis.set_major_formatter(date_format) # 设置x轴每个刻度的间隔天数xlocator = mpl.ticker.MultipleLocator(7)ax.xaxis.set_major_locator(xlocator)# 为了避免x轴刻度标签的紧凑，将刻度标签旋转45度plt.xticks(rotation=45)</pre><div class=pgc-img><img alt=Python数据清洗(三)：异常值识别与处理 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/e485520b0fbd459e852686688148a137><p class=pgc-img-caption></p></div><p>如上图所示，左图中的两条水平线是偏离均值正负2倍标准差的参考线，目测有6个样本点落在参考线之外，可以判定它们属于异常点；而对于右图中偏离均值正负3倍标准差的参考线来说，仅有1个样本点落在参考线之外，即说明该样本点就是2017年第三季度的唯一极端异常点。</p><p>同理，也可以借助于下面的代码，查询出异常点所对应的水流量：</p><pre># 计算判断异常点和极端异常点的临界值outlier_ll = pay_ratio.ratio.mean() - 2* pay_ratio.ratio.std()outlier_ul = pay_ratio.ratio.mean() + 2* pay_ratio.ratio.std()extreme_outlier_ll = pay_ratio.ratio.mean() - 3* pay_ratio.ratio.std()extreme_outlier_ul = pay_ratio.ratio.mean() + 3* pay_ratio.ratio.std()# 寻找异常点pay_ratio.loc[(pay_ratio.ratio &gt; outlier_ul) | (pay_ratio.ratio &lt; outlier_ll), ['date','ratio']]# 寻找极端异常点pay_ratio.loc[(pay_ratio.ratio &gt; extreme_outlier_ul) | (pay_ratio.ratio &lt; extreme_outlier_ll), ['date','ratio']]</pre><p><strong>异常点</strong></p><div class=pgc-img><img alt=Python数据清洗(三)：异常值识别与处理 onerror=errorimg.call(this); src=http://p9.pstatp.com/large/pgc-image/08a32ef9b255427c9009841d275f98ae><p class=pgc-img-caption></p></div><p><strong>极端异常点</strong></p><div class=pgc-img><img alt=Python数据清洗(三)：异常值识别与处理 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/4af2ae93c7574f2a87c37519f59431f2><p class=pgc-img-caption></p></div><p>尽管基于箱线图的分位数法和基于正态分布的参考线法都可以实现异常值和极端异常值的识别，但是在实际应用中，需要有针对性的选择。如果待判断的变量近似服从正态分布，建议选择正态分布的参考线法识别异常点，否则使用分位数法识别异常点。</p><div class=pgc-img><img alt=Python数据清洗(三)：异常值识别与处理 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/2ef5bd8d869741a18530f2523fbddfae><p class=pgc-img-caption></p></div><p><strong>扫码进入CDA官方小程序，解锁更多新鲜资讯和优质内容，还有免费试听课程，不要错过哟！</strong></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Python','数据','常值'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>