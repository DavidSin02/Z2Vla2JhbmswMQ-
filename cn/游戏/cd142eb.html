<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Spring Boot入门系列（十三）如何实现事务，极简版！ | 极客快訊</title><meta property="og:title" content="Spring Boot入门系列（十三）如何实现事务，极简版！ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="http://p3.pstatp.com/large/pgc-image/15d70cf19e1c4967afc5d49a10def1ce"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/cd142eb.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/cd142eb.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e6%b8%b8%e6%88%8f/cd142eb.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/cd142eb.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/cd142eb.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e6%b8%b8%e6%88%8f/cd142eb.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e6%b8%b8%e6%88%8f/cd142eb.html><link rel=canonical href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/cd142eb.html><meta property="article:published_time" content="2020-10-29T20:46:29+08:00"><meta property="article:modified_time" content="2020-10-29T20:46:29+08:00"><meta name=Keywords content><meta name=description content="Spring Boot入门系列（十三）如何实现事务，极简版！"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E6%B8%B8%E6%88%8F/cd142eb.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Spring Boot入门系列（十三）如何实现事务，极简版！</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E6%B8%B8%E6%88%8F.html>游戏</a></span></div><div class=post-content><p>前面介绍了Spring Boot 中的整合Mybatis并实现增删改查。不清楚的朋友可以看看之前的文章。</p><p>Spring Boot 整合完Mybatis后，有个特别重要的功能之前忘记讲了：那就是Spring Boot如何实现事物控制。在我们的实际系统中，事务会被经常用到。特别是数据库操作或者是复杂的业务操作时，必须事物执行。必须保证本次业务的处理结果更改要么都成功，要么都失败。那么这种场景下，我们改如何实现呢？</p><p><br></p><h2 class=pgc-h-arrow-right>为什么要事务</h2><p>以转账业务为例：一次转载业务涉及数据库表的两次更改。为确保业务完整性，需保证这两次更改要么都成功，要么都失败。否则账户金额就做了，后果非常严重。</p><div class=pgc-img><img alt="Spring Boot入门系列（十三）如何实现事务，极简版！" onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/15d70cf19e1c4967afc5d49a10def1ce><p class=pgc-img-caption></p></div><p><br></p><h2 class=pgc-h-arrow-right>事务播行为</h2><p>Propagation.REQUIRED -- 支持当前事务，如果当前没有事务，就新建一个事务,最常见的选择。</p><p>Propagation.SUPPORTS -- 支持当前事务，如果当前没有事务，就以非事务方式执行。</p><p>Propagation.MANDATORY -- 支持当前事务，如果当前没有事务，就抛出异常。</p><p>Propagation.REQUIRES_NEW -- 新建事务，如果当前存在事务，把当前事务挂起, 两个事务之间没有关系，一个异常，一个提交，不会同时回滚。</p><p>Propagation.NOT_SUPPORTED -- 以非事务方式执行操作，如果当前存在事务，就把当前事务挂起。</p><p>Propagation.NEVER -- 以非事务方式执行，如果当前存在事务，则抛出异常。</p><p><br></p><h2 class=pgc-h-arrow-right>如何实现事务</h2><p>1、首先创建Spring Boot项目，并整合Mybatis相关的依赖。这个之前的文章讲过，大家可以看我这篇文章：《<a class=pgc-link data-content=mp href="https://www.toutiao.com/i6803276779000693255/?group_id=6803276779000693255" rel="noopener noreferrer" target=_blank>Spring Boot入门系列（六）Spring Boot如何整合Mybatis【附详细步骤】</a>》</p><p>2、在需要事务的方法上添加 @Transactional注解，并通过propagation指定事务机制。</p><p>修改UserServiceImpl 类和UserService类，增加 saveUserTransactional 方法。</p><pre><code>    @Override    @Transactional(propagation = Propagation.REQUIRED)    public void saveUserTransactional(SysUser user) {        userMapper.insert(user);        int a = 1 / 0;        user.setIsDelete(1);        userMapper.updateByPrimaryKeySelective(user);    }</code></pre><p>说明：</p><ul><li>propagation = Propagation.REQUIRED是默认的事务机制，若当前有事务则支持当前事务，否则新建事务。</li><li>springboot 开启事物很简单，只需要加注解@Transactional即可。</li><li>@Transactional也可以加在类上，则该类所有方法都遵循该注解配置。</li></ul><p>3、测试调用</p><p>在之前的MyBatisCRUDController增加测试方法：saveUserTransactional。</p><pre><code>    @RequestMapping("/saveUserTransactional")    public JSONResult saveUserTransactional() {        String userId = sid.nextShort();        SysUser user = new SysUser();        user.setId(userId);        user.setUsername("weiz" + new Date());        user.setNickname("weiz" + new Date());        user.setPassword("abc123");        user.setIsDelete(0);        user.setRegistTime(new Date());        userService.saveUserTransactional(user);        return JSONResult.ok("保存成功");    }</code></pre><p><br></p><h2 class=pgc-h-arrow-right>测试</h2><p>首先我们看目前的sql数据中的数据，user表中数据如下：</p><div class=pgc-img><img alt="Spring Boot入门系列（十三）如何实现事务，极简版！" onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/9dc0daa196d747fc8ce863d597bcbc41><p class=pgc-img-caption></p></div><p><br></p><p>在浏览器中数据：http://localhost:8080/mybatis/saveUserTransactional，也没返回执行异常，数据库中的数据也没有变化，说明数据已经回滚了：</p><div class=pgc-img><img alt="Spring Boot入门系列（十三）如何实现事务，极简版！" onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/627d38170f18419e8dfdec89e0355e54><p class=pgc-img-caption></p></div><p><br></p><h2 class=pgc-h-arrow-right>最后</h2><p>以上，就把Spring Boot中事物控制讲完了，是不是特别简单。</p><p>这个系列课程的完整源码，也会提供给大家。大家关注我的头条号（<strong class=highlight-text>架构师精进</strong>），回复：springboot源码。获取这个系列课程的完整源码。</p><p><br></p><h2 class=pgc-h-arrow-right>推荐阅读：</h2><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6816262771894649355/?group_id=6816262771894649355" rel="noopener noreferrer" target=_blank>SpringBoot入门系列（十一）实现统一异常处理，就这么简单！</a></p><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6806605754238239239/?group_id=6806605754238239239" rel="noopener noreferrer" target=_blank>Spring Boot整合定时任务Task，一秒搞定定时任务</a></p><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6815895102011998728/?group_id=6815895102011998728" rel="noopener noreferrer" target=_blank>Spring Boot入门系列（十）如何使用拦截器，一学就会！</a></p><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6801686903612506635/?group_id=6801686903612506635" rel="noopener noreferrer" target=_blank>SpringBoot入门系列（四）如何整合Thymeleaf模板引擎</a></p><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6805502194662507011/?group_id=6805502194662507011" rel="noopener noreferrer" target=_blank>Spring Boot集成Redis代码详解，三步搞定！</a></p><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6800690860901007884/?group_id=6800690860901007884" rel="noopener noreferrer" target=_blank>SpringBoot入门系列（三）资源文件属性配置</a></p><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6800690860901007884/?group_id=6800690860901007884" rel="noopener noreferrer" target=_blank>Spring Boot入门系列（六）Spring整合Mybatis详解「附详细步骤」</a></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Spring','Boot','入门'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>