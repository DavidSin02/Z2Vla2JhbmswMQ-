<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署 | 极客快訊</title><meta property="og:title" content="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/3132252589134132810d13c0590f8774"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/cdecfde8.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/cdecfde8.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e6%b8%b8%e6%88%8f/cdecfde8.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/cdecfde8.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/cdecfde8.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e6%b8%b8%e6%88%8f/cdecfde8.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e6%b8%b8%e6%88%8f/cdecfde8.html><link rel=canonical href=https://geekbank.cf/tw/%e6%b8%b8%e6%88%8f/cdecfde8.html><meta property="article:published_time" content="2020-11-14T20:54:26+08:00"><meta property="article:modified_time" content="2020-11-14T20:54:26+08:00"><meta name=Keywords content><meta name=description content="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E6%B8%B8%E6%88%8F/cdecfde8.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E6%B8%B8%E6%88%8F.html>游戏</a></span></div><div class=post-content><div><h1><strong>继<a class=pgc-link data-content=mp href="https://www.toutiao.com/i6685589275297186318/?group_id=6685589275297186318" target=_blank>使用Docker搭建Gitlab</a>、<a class=pgc-link data-content=mp href="https://www.toutiao.com/i6687456305533157902/?group_id=6687456305533157902" target=_blank>使用Jenkins+Docker+Gitlab+Maven搭建持续集成环境</a>后</strong></h1><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3132252589134132810d13c0590f8774><p class=pgc-img-caption></p></div><p><strong>CI\CD整个流程：</strong></p><ol><li>idea修改工程后push到gitlab >> gitlab通过webhook通知jenkins工程有改变 >>jenkins到gitlab取最新工程 。</li><li>jenkins 自动 maven （构建、单元测试）工程。</li><li>jenkins完成容器构建 docker images >> push到docker hub私有镜像仓库并自动化运行容器应用。</li><li>通过Kubernetes到Harbor私有镜像仓库拉取镜像，自动化编排服务，运行微服务容器应用。<strong>（下一章节）</strong>。</li></ol><p><strong>一、通过GitLab的webhook与Jenkins 连通。</strong></p><p>一个比较典型的微服务应用 这里只强调应用中的两个比较重要的文件 一个是Dockerfile 另外一个是build.sh。</p><p>接下来是idea 修改工程 功能后push到gitlab之后。</p><p><strong>1、jenkins 创建一个新任务</strong></p><p><strong></strong>任务名称跟Gitlab 工程目录下的其中一个微服务模块名称对应，选择流水线 ，点确定。</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ae6ba8180d834ad09ed5cfcbb82acd15><p class=pgc-img-caption></p></div><p><strong>2、在任务详情的 “构建触发器” ，勾选 “触发远程构建” ，输入身份验证令牌（自定义）</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/bea45406f5a64d669138319707d88947><p class=pgc-img-caption></p></div><p>复制/job/register-center/build?token=123456 到Gitlab 工程下的Integrations 右边 URL中，</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fd8656950da5444abdbb6fe3450f1b2f><p class=pgc-img-caption></p></div><p>点击 Add webhook 生成一条 webhook 记录 。</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d2871b2549ca43f18ba972df7ee9dbd0><p class=pgc-img-caption></p></div><p><strong>3、jenkins进入系统设置>全局安全配置 不选择 跨站请求伪造保护下的“防止跨站点请求伪造”，勾选 授权策略下的 “匿名用户具有可读权限” 点保存。</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/77918c1859624c00994a08ba9853af3e><p class=pgc-img-caption></p></div><p><strong>4、在Gitlab的webhook 点击 test >push events 测试是否与jenkins连通。</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bc51ac2a1bda4eadaf78245183015d90><p class=pgc-img-caption></p></div><p>如果页面上方出现 Hook executed successfully: HTTP 201 提示，表示已连通。</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/22b799159bca42f4be31553d1b795d2c><p class=pgc-img-caption></p></div><p>在jenkins 查看对应的 控制台输出 Finished: SUCCESS 。</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/45068eee876c4ba99d1bfda62c140246><p class=pgc-img-caption></p></div><p><strong>二、jenkins maven 自动（构建、单元测试）</strong></p><p><strong>1、jenkins进入任务详情的 “流水线”Pipeline 脚本编写，点击 “流水线语法”进入，查看语法。</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/aecdd2e1473847a1a484ebb807363878><p class=pgc-img-caption></p></div><p>步骤>示例步骤 选择 Git</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e54587595a6f44ae9c5e70c1833c2ba0><p class=pgc-img-caption></p></div><p>从GitLab 获取工程的git 地址到 复制到 Repository URL 然后点击 “生成流水线脚本”，复制到流水线的脚本中</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c7ffb684f52f4dc6a0b4c254d6c1e12a><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7d7199fefcf5485ab63f07bce332c247><p class=pgc-img-caption></p></div><p>编写自动获取代码、自动编译、单元测试 脚本 ，保存返回，点立即构建 ，进入自动构建。</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/33b75f5f72af44b2b70da74f065856a9><p class=pgc-img-caption></p></div><p>查看jenkins首页 可以看到工程状态信息，进入控制台查看日志，如出现 BUILD SUCCESS 表示 自动获取代码、自动编译成功。</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/796682cb859e4d919a16ada1b0c11986><p class=pgc-img-caption></p></div><p><strong>三、jenkins构建镜像 （docker images）push到docker 私有镜像仓库并自动化运行容器应用。</strong></p><p><strong>1、新建脚本路径与构建镜像脚本文件，编写脚本</strong></p><p>cd /usr/local</p><p>mkdir build_script</p><p>cd build_script</p><p>vi build-images.sh</p><p>chmod 775 build-images.sh</p><p><strong>编写脚本</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/b542eee3eaac4447816865b3274f6e9b><p class=pgc-img-caption>应用docker镜像构建、推送私有镜像仓库、运行镜像生成容器</p></div><p><strong>2、在jenkins流水线的脚本中添加build-images.sh执行步骤</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b08ec38d0e384f4596aca582e25b4bcc><p class=pgc-img-caption></p></div><p><strong>3、在idea修改微服务工程代码后push到gitlab，查看jenkins控制台输出及返回项目主页，如出现下图表示整理流程没问题了。</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d7083858c4f0442fa9ef7e3779b720bd><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3530f18d265f45788987207954e95381><p class=pgc-img-caption></p></div><p><strong>4、在服务器上通过docker命令查看镜像 可以发现已经构建成镜像了</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cf9d90d6c8ef449a8fa76f314af7e05e><p class=pgc-img-caption>docker images</p></div><p>查看是否在运行：</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服务自动化部署" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5ac5f7ae0a3744789a5770e6082fd1e8><p class=pgc-img-caption>docker ps -a</p></div><p><strong>已实现自动化构建容器应用，通过Kubernetes到Harbor私有镜像仓库拉取镜像，自动化编排服务，运行微服务容器应用。（下一计划）</strong></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Jenkins','Docker','Gitlab'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>