<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>TCP与IP的对比，TCP的报文头介绍，TCP的三次握手和TCP的安全机制 | 极客快訊</title><meta property="og:title" content="TCP与IP的对比，TCP的报文头介绍，TCP的三次握手和TCP的安全机制 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/f1fd0df30c1c4366be12eef1be8b593b"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/0365df13.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/0365df13.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/0365df13.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/0365df13.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/0365df13.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/0365df13.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/0365df13.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/0365df13.html><meta property="article:published_time" content="2020-11-14T20:50:52+08:00"><meta property="article:modified_time" content="2020-11-14T20:50:52+08:00"><meta name=Keywords content><meta name=description content="TCP与IP的对比，TCP的报文头介绍，TCP的三次握手和TCP的安全机制"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E5%AD%A6/0365df13.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>TCP与IP的对比，TCP的报文头介绍，TCP的三次握手和TCP的安全机制</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E5%AD%A6.html>科学</a></span></div><div class=post-content><p>IP协议是无连接的通讯协议不会占用两个正在通讯的计算机之间的通讯线路,这样IP就降低了对网络线路的需求,每条线可以同时满足许多不同计算机之间的通讯需要.</p><p>通过IP,消息或者其他数据会被分割为较小的独立的包并通过因特网在计算机之间传送<br>IP负责将每个包路由到目的地,但是<strong>IP协议没用做任何工作去确认数据是否按顺序发送或者包是否被破坏,所以IP数据包是不可靠的</strong>,因此需要它的上层传输层TCP协议来做控制!</p><h6 class=pgc-h-arrow-right>TCP（Transmission Control Protocol 传输控制协议）</h6><ul><li>面向连接的、可靠的、基于字节流的传输层通信协议</li><li>将应用层的数据流分割成报文段(报文段长度受MTU影响)并发送给目标节点的TCP层</li><li>数据包<strong>都有</strong>序号，对方收到则发送ACK(确认字符)确认，未收到则重传</li><li>使用校验和来检验数据在传输过程中是否有误</li></ul><p><strong>报文头介绍</strong></p><div class=pgc-img><img alt=TCP与IP的对比，TCP的报文头介绍，TCP的三次握手和TCP的安全机制 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f1fd0df30c1c4366be12eef1be8b593b><p class=pgc-img-caption></p></div><blockquote><p>源端口标识发起通信的那个进程，目的端口标识接受通信的那个进程。<br>有了端口号，接受到报文后才能够知道将报文发送到哪个进程。</p></blockquote><blockquote><p>在TCP传输中，每一个字节都是有序号的，从0开始。<strong>通过序号的方式保存数据的顺序</strong>,接收端接受到之后进行重新排列成为需要的数据。<br>因此，我对于SEQ和ACK的了解就是：<br><strong>seq(Sequence Nubmer) 代表：发送的这个包中第一个字节（如果有payload的话）的序号<br>ack(Acknowledgement) 代表：已成功接受序列号到 ack-1 的数据，期望接收的下一个字节的序号为 ack</strong></p></blockquote><blockquote><p>首部长度（Data Offset）：表示TCP报文首部信息的长度。由于首部可能含有选项内容，因为TCP首部的长度是不确定的。首部长度指示了数据区在报文段中的起始偏移值。没有任何选项字段的TCP头部长度为20字节，做多可以有60字节的TCP头部。</p></blockquote><blockquote><p>保留(Reserved)：6位保留字段，值通常为0；</p></blockquote><h6 class=pgc-h-arrow-right>TCP Flags标志位(每个标志位表示一个控制功能)</h6><p>◆URG：紧急指针(为0无效忽略,为1有效)<br>◆<strong>ACK：确认序号(为0表示报文中不含确认信息忽略确认号字段,为1表示确认号有效)</strong><br>◆PSH：(为1表示带有PAH数据让接收方应该尽快将这个报文段交给应用层,不在缓冲区排队)<br>◆RST：重建连接。(用于重置由于主机崩溃或其他原因出现错误的链接或用于拒绝非法报文段和非法请求)<br>◆<strong>SYN：同步序列号,用于建立连接过程</strong><br>◆<strong>FIN：finsh标志,用于释放连接。为1时表示发送方已经没有数据发送了</strong></p><ul><li>window指滑动窗口大小,用来告知发送端目的接收端的缓存大小以此来控制发送端发送数据的速率以此达到流量控制的效果</li><li>CheckSum 校验和：奇偶校验。对整个TCP报文段，即TCP头部和TCP数据进行校验和计算以16位进行计算所得,由发送端计算和存储，并由接收端进行验证</li><li>紧急指针（Urgent Pointer）：只有TCPFlags中URG=1时有效,如果TCP通信中，一方有紧急的数据需要尽快发送给接收方，并且让接收方的TCP协议尽快通知相应的应用程序，可以将URG置位，并通过紧急指针指示紧急数据在报文段中的结束位置。占16比特。它是一个偏移量，和序号字段中的值相加表示紧急数据最后一个字节的序号。</li><li>Options可定义一些其他参数</li></ul><h1 class=pgc-h-arrow-right>TCP的三次握手流程</h1><div class=pgc-img><img alt=TCP与IP的对比，TCP的报文头介绍，TCP的三次握手和TCP的安全机制 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4580d68c41d642d785e2869ce7b7db89><p class=pgc-img-caption></p></div><p>这里每次传递seq ack+1的原因是每次一个报文传送告知,都要消耗一个序号</p><pre><code>书面解释,专业回答```在TCP/IP协议中，TCP协议提供可靠的连接服务，采用三次握手建立一个连接。第一次握手：建立连接时，客户端发送SYN包（syn=j）到服务器，并进入SYN_SEND状态，等待服务器确认；第二次握手：服务器收到SYN包，必须确认客户的SYN(ack=j+1),同时自己也发送一个SYN包（syn=k）            即SYN+ACK包，此时服务器进入SYN_RECV状态；第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK（ack=k+1]，此包发送完毕           客户端和服务器进入ESTABLISHED状态，完成三次握手。</code></pre><p>三次握手模拟,只限理解,专业回答看上面</p><pre><code>两者建立链接的过程类似于彼此确认彼此能否正确的收到信息(类似于相互在进行一次小型的通讯)```AB在一个很高的楼层想尝试带彼此东西上楼,于是要尝试能不能收到彼此的东西,:第一次握手,SYN=1,A告诉B,老子要给你送东西了,seq=X,你在x楼等包裹:第二次握手,ACK=1,老子听到了你说啥了,SYN=1,B告诉A,老子愿意收,我这就去x楼等你,ack=x+1,我在在x楼了,下一次x+1楼,seq=y,我把你的重新给你我再给你我自己的东西你试试能不能收到,你到y楼等我):第三次握手,ACK=1,我收到我发的包和你发的包了,没问题,seq=x+1,你下次去的楼是x+1楼,sck=y+1,老子到y楼了,下一层y+1楼;```哈哈哈除了我大概别人也难看懂</code></pre><p><strong>为什么需要三次握手才能建立链接???</strong></p><p><strong>为了初始化Sequence Number的初始值,其实就是上面的x和y,通讯双方要告诉彼此自己的Sequence Number这个号要作为以后数据通讯的序号,以保证应用层接收到的数据接收到的数据不会因为网络上的问题而产生问题,即TCP会用这个序号来拼接数据,因此服务器端收到客户端的Sequence Number要发送一个确认报文,告诉客户端,我已收到你的Sequence Number;</strong></p><h5 class=pgc-h-arrow-right>首次握手的隐患-SYN超时</h5><p><strong>问题原因:</strong></p><ul><li>Server收到Client的SYN，回复SYN-ACK的时候未收到ACK确认(比如IP地址是伪造的,服务器找不到)</li><li>Server不断重试直至超时，Linux默认等待63秒才断开连接(重试5次,间隔时间翻倍1,2,4,8,16,32)</li></ul><p><strong>后果</strong><br>可能服务器收到SYN Flood的风险,每一次这样的链接会让服务器等待63秒,如果有很多这样的请求，导致服务器打开了大量的SYNC_RECV半连接,就会把TCP的连接队列耗尽，最后导致TCP无法对其他TCP连接进行响应。</p><p><strong>针对SYN Flood的预防措施</strong></p><ul><li>SYN队列满后，TCP通过源地址端口目标地址端口和时间戳打造出一个tcp_syncookies(可看作Sequence Numbe)参数回发SYN Cookie</li><li>若为正常连接则Client会回发SYN Cookie，直接建立连接(即使服务器队列满了也可以)</li></ul><h5 class=pgc-h-arrow-right>若建立连接后Client出现故障怎么办?</h5><p><strong>TCP设有保活机制</strong></p><ul><li>若一段时间内(保活时间)若连接处于非活动状态,开启保活功能的一段向对方发送保活探测报文，如果未收到响应则继续发送</li><li>尝试次数达到保活探测数仍未收到响应(这时可以确认对方主机为不可达)则中断连接</li></ul><h1 class=pgc-h-arrow-right>需要以下视频资料可后台回复【架构】获取</h1><p>nginx源码—线程池的实现</p><p>高性能服务器为什么需要内存池</p><p>去中心化，p2p，网络穿透一起搞定</p><p>如何快速掌握WebRTC音视频通话技术</p><p>Nginx模块开发</p><p>进程与CPU之间的故事</p><p>tcp/ip协议栈不为人知的秘密</p><p>如何掌握MySQL</p><div class=pgc-img><img alt=TCP与IP的对比，TCP的报文头介绍，TCP的三次握手和TCP的安全机制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/85c99b85ad7a46cc9e326531d21b6ed0><p class=pgc-img-caption></p></div><p><br></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'TCP','IP','报文头'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>