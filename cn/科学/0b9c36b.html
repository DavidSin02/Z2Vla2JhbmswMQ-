<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>从Wasserstein距离、对偶理论到WGAN | 极客快訊</title><meta property="og:title" content="从Wasserstein距离、对偶理论到WGAN - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/4aaad61b907e419389a261dae187c2e1"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/0b9c36b.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/0b9c36b.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/0b9c36b.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/0b9c36b.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/0b9c36b.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/0b9c36b.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/0b9c36b.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/0b9c36b.html><meta property="article:published_time" content="2020-10-29T20:56:37+08:00"><meta property="article:modified_time" content="2020-10-29T20:56:37+08:00"><meta name=Keywords content><meta name=description content="从Wasserstein距离、对偶理论到WGAN"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E5%AD%A6/0b9c36b.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>从Wasserstein距离、对偶理论到WGAN</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E5%AD%A6.html>科学</a></span></div><div class=post-content><div><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4aaad61b907e419389a261dae187c2e1><p class=pgc-img-caption></p></div><p class=ql-align-justify>在本篇文章中，我们从数学化的视角来讨论一下 WGAN。当然，本文并不是纯粹地讨论 GAN，而主要侧重于 Wasserstein 距离及其对偶理论的理解。</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7db8bc082f7c40e2a5e1620e74dc04b7><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>▲ </strong>推土机哪家强？成本最低找Wasserstein</p><p class=ql-align-justify>本文受启发于著名的国外博文 <em>Wasserstein GAN and the Kantorovich-Rubinstein Duality</em> [1]，内容跟它大体上相同，但是删除了一些冗余的部分，对不够充分或者含糊不清的地方作了补充。不管怎样，在此先对前辈及前辈的文章表示致敬。</p><p class=ql-align-justify>注：完整理解本文，应该需要多元微积分、概率论以及线性代数等基础知识。还有，本文确实长，数学公式确实多，但是，真的不复杂、不难懂，大家不要看到公式就吓怕了。</p><p class=ql-align-justify>Wasserstein距离</p><p class=ql-align-justify>显然，整篇文章必然围绕着 Wasserstein 距离（W 距离）来展开。假设我们有了两个概率分布 p(x),q(x)，那么 Wasserstein 距离的定义为：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/49c4d20f24c64a07b0b643e612996152><p class=pgc-img-caption></p></div><p class=ql-align-justify>事实上，这也算是最优传输理论中最核心的定义了。</p><p class=ql-align-justify>相信我，式 (1) 没有想象中那么难理解。我们来逐项看看。</p><p class=ql-align-justify>成本函数</p><p class=ql-align-justify>首先 d(x,y) ，它不一定是距离，其准确含义应该是一个成本函数，代表着从 x 运输到 y 的成本。常用的 d 是基于 l 范数衍生出来的，比如：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/380c00032394499f92ce15eec19afff9><p class=pgc-img-caption></p></div><p class=ql-align-justify>都是常见的选择，其中：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0d6ab2a30ef54d11a770d1c1eecf4cf3><p class=pgc-img-caption></p></div><p class=ql-align-justify>特别指出，其实哪种距离并不是特别重要，因为很多范数都是相互等价的，范数的等价性表明其实最终定义出来的 W 距离都差不多。</p><p class=ql-align-justify>成本最小化</p><p class=ql-align-justify>然后来看 γ ，条件 γ∈Π[p,q] 意味着：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b6583377d2e049f69aed3b097dd87f70><p class=pgc-img-caption></p></div><p class=ql-align-justify>这也就是说， γ 是一个联合分布，它的边缘分布就是原来的 p 和 q。</p><p class=ql-align-justify>事实上 γ 就描述了一种运输方案。不失一般性，设 p 是原始分布，设 q 是目标分布， p(x) 的意思是原来在位置 x 处有 p(x) 量的货物， q(x) 是指最终 x 处要存放的货物量，如果 p(x)>q(x) ，那么就要把 x 处的一部分货物运到别处，反之，如果 p(x)&lt;q(x) ，那么就要从别的地方运一些货物到 x 处。而 γ(x,y) 的意思是指，要从 x 处搬 γ(x,y)dx 那么多的东西到 y 处。</p><p class=ql-align-justify>最后是 inf ，这表示下确界，简单来说就是取最小，也就是说，要从所有的运输方案中，找出总运输成本 ∬γ(x,y)d(x,y)dxdy 最小的方案，这个方案的成本，就是我们要算的 W[p,q] 。</p><p class=ql-align-justify>如果将上述比喻中的“货物”换成“沙土”，那么 Wasserstein 距离就是在求最省力的“搬土”方案了，所以 Wasserstein 距离也被称为“推土机距离”（Earth Mover's Distance）。</p><p class=ql-align-justify>最后改编一张开头提到的国外博文的图片，来展示这个“推土”过程：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fb300e783ab54be0996fab94c6fb5b2f><p class=pgc-img-caption></p></div><p><strong>▲ </strong>推土机距离图示。左边p(x)每处的沙土被分为若干部分，然后运输到右端q(x)的同色的位置（或者不动）</p><p class=ql-align-justify>矩阵形式</p><p class=ql-align-justify>逐项分析完含义之后，现在我们再来完成地重述一下问题，我们实际上在求下式的最小值：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/679c6b528d514323a54c8202c748f1ce><p class=pgc-img-caption></p></div><p class=ql-align-justify>其中 d(x,y) 是事先给定的，而这个最小值要满足如下约束：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b076a605e08649cf8d3371bdb81822c4><p class=pgc-img-caption></p></div><p class=ql-align-justify>认真盯著式 (5)，考虑到积分只是求和的极限形式，所以我们可以把 γ(x,y) 和 d(x,y) 离散化，然后看成很长很长的（列）向量 Γ 和 D：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/2db668a4832f4b77a6ca554cc28628fc><p class=pgc-img-caption></p></div><p class=ql-align-justify>所以式 (5) 相当于就是将 Γ 和 D 对应位置相乘，然后求和，这不就是内积<strong> </strong>⟨Γ,D⟩ 了吗？</p><p class=ql-align-justify>如果还没理解这一点，那么请再好好地盯一会式 (5)，头脑中想象着将 x,y 分区间离散化的过程，再想想积分的定义，相信这并不难理解。</p><p class=ql-align-justify>如果已经理解了这一点，那就好办了，我们可以把约束条件 (6) 也这样看：把 p(x),q(x) 分别看成一个长向量，然后还可以拼起来，把积分也看成求和，这时候约束条件 (6) 也可以写成矩阵形式 AΓ=b：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e1dd1eec176b4191baefeaf5ecd9e191><p class=pgc-img-caption></p></div><p class=ql-align-justify>最后不能忘记的是 Γ ≥ 0 ，它表示 Γ 的每个分量都大于等于 0。</p><p class=ql-align-justify>线性规划问题</p><p class=ql-align-justify>现在问题可以用一行字来描述：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/06c83bda96d94076b0decacbca9d47ef><p class=pgc-img-caption></p></div><p class=ql-align-justify>这就是“线性约束下的线性函数最小值”的问题，它就是我们在高中时就已经接触过的线性规划问题了。可见，虽然原始问题足够复杂，又有积分又有下确界的，但经过转写，它本质上就是一个并不难理解的线性规划问题（当然，“不难理解”并不意味着“容易求解”）。</p><p class=ql-align-justify>线性规划与对偶</p><p class=ql-align-justify>让我们用更一般的记号，把线性规划问题重写一遍，常见的形式有两种：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/f4988dcb9b1f4fb8a7f07ad0bcd33831><p class=pgc-img-caption></p></div><p class=ql-align-justify>这两种形式本质上是等价的，只不过在讨论第一种的时候相对简单一点（真的只是简单一点点，并没有本质差别），而从 (9) 式可以知道，我们目前只关心第一种情况。</p><p class=ql-align-justify>注意，为了避免混乱，我们必须声明一下各个向量的大小。我们假设每个向量都是列向量，经过转置 ⊤ 之后就代表一个行向量，</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d1652d0bc7974d518d5ece7de10b92c3><p class=pgc-img-caption></p></div><p class=ql-align-justify>都是 n 维向量，其中 c 也就是权重，</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/05871e3c7d9a4770a3e9b585fe61197e><p class=pgc-img-caption></p></div><p class=ql-align-justify>就是对 x 的各个分量加权求和；</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f323981dbf1948f6abd6364300c0f2c3><p class=pgc-img-caption></p></div><p class=ql-align-justify>是 m 维向量，自然</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b7294103c9464b8d9f4bc8fe812f908e><p class=pgc-img-caption></p></div><p class=ql-align-justify>是一个 m×n 的矩阵了， Ax=b 实际上就是描述了 m 个等式约束。</p><p class=ql-align-justify>弱对偶形式</p><p class=ql-align-justify>在规划和优化问题中，“对偶形式”是一个非常重要的概念。一般情况下，“对偶”是指某种变换，能将原问题转化为一个等价的、但是看起来几乎不一样的新问题，即：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/19a58b5f088e4802ac5cbdfeed29d4a4><p class=pgc-img-caption></p></div><p class=ql-align-justify>“对偶”之所以称为“对偶”，是因为将新问题进行同样形式的变换后，通常来说能还原为原问题，即：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/29cb0028fbde47f6bab20c72559bf0a8><p class=pgc-img-caption></p></div><p class=ql-align-justify>即“对偶”像是一面镜子，原问题和新问题相当于“原像”和“镜像”，解决了一个问题，就等价于解决了另一个问题。所以就看哪个问题更简单了。</p><p class=ql-align-justify>读者可能还有疑问：“对偶”跟数学中诸如“逆否命题”之类的等价描述有什么区别？其实也没有本质区别，简单来说“对偶”和“逆否命题”都是跟原来的命题完全等价的，但是“对偶”看起来跟原命题很不一样，而“逆否命题”仅仅是原命题的一个逻辑变换。从线性代数的角度来看，“对偶”相当于向量空间中的“原空间”和“补空间”之间的关系。</p><p class=ql-align-justify>最大 vs 最小</p><p class=ql-align-justify>这里我们先介绍“弱对偶形式”，其实它推导起来还是挺简单的。</p><p class=ql-align-justify>我们的目标是</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/62fc5ac6d9c146fd87f09a26e87ef6d6><p class=pgc-img-caption></p></div><p class=ql-align-justify>，设置最小值在</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d7ab1e4cbd6543568395bbee82f0393c><p class=pgc-img-caption></p></div><p class=ql-align-justify>处取到，那么我们有</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/20189b33967742da95e256db42924eca><p class=pgc-img-caption></p></div><p class=ql-align-justify>，我们可以在两边乘以一个</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/fb496ac60e8d4d62838050f4b2a1b9c6><p class=pgc-img-caption></p></div><p class=ql-align-justify>，使得等式变成一个标量：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d81b4e8567114d23bcd93daf30ce811c><p class=pgc-img-caption></p></div><p class=ql-align-justify>。如果此时假设</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/dde77d8a19044d2c9b1b2a1a2ab219fa><p class=pgc-img-caption></p></div><p class=ql-align-justify>，那么</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b9587436238840b9aef39ab4ff561806><p class=pgc-img-caption></p></div><p class=ql-align-justify>（因为</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e3e365f251d24b67b65ccf2d3090b296><p class=pgc-img-caption></p></div><p class=ql-align-justify>），则</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1cf66786648a4e94a494829fc79653aa><p class=pgc-img-caption></p></div><p class=ql-align-justify>。也就是说，在条件</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/eeea0f950eb2445caa1ebfb40b0e89bb><p class=pgc-img-caption></p></div><p class=ql-align-justify>下的任意</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/93abc38c3b4341d1b630e6f594deee0f><p class=pgc-img-caption></p></div><p class=ql-align-justify>总是不大于</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/62fc5ac6d9c146fd87f09a26e87ef6d6><p class=pgc-img-caption></p></div><p class=ql-align-justify>，“总是”意味着即使对于最大那个也一样，所以我们就有：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d92dd0dbc5ba4455b41eb4cd5f26f50f><p class=pgc-img-caption></p></div><p class=ql-align-justify>这便称为“弱对偶形式”，它的形式就是：“左边的最大”还大不过“右端的最小”。</p><p class=ql-align-justify>几点评注</p><p class=ql-align-justify>对于弱对偶形式，也许下面几点值得进一步说明一下：</p><p class=ql-align-justify>1. 现在我们将原来的最小值问题变成了一个最大值问题</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f7889d3f027849f8a363c723df730ba8><p class=pgc-img-caption></p></div><p class=ql-align-justify>，这便有了对偶的味道。当然，弱对偶形式之所以“弱”，是因为我们目前找到的对偶形式只是原来问题的一个下界，还没有证明它们二者相等。</p><p class=ql-align-justify>2. 弱对偶形式在很多优化问题中（包括非线性优化）都成立。如果二者真的相等，那么就是真正意义上的对偶了，称为强对偶形式。</p><p class=ql-align-justify>3. 理论上，我们确实需要证明式 (13) 左右两端相等才能进一步应用它。但从应用角度，其实弱对偶形式给出的下界都已经够用了，因为深度学习中的问题都很复杂，能有一个近似的目标去优化都已经很不错了。</p><p class=ql-align-justify>4. 读者可能会想问：前面我们为什么要假设</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/dde77d8a19044d2c9b1b2a1a2ab219fa><p class=pgc-img-caption></p></div><p class=ql-align-justify>而不干脆假设</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/098875f4a4af4344889576f48ee612e6><p class=pgc-img-caption></p></div><p class=ql-align-justify>？假设后者当然简单很多，但问题是后者在实践中很难实现，所以只能假设前者。</p><p class=ql-align-justify>强对偶形式</p><p class=ql-align-justify>上面已经说了，从实践角度其实弱对偶形式已经够用了。但是为了让对完整理论的读者也有更多收获，这里继续把“强对偶形式”也论证一番。对于只关心 WGAN 本身的读者来说，可以考虑跳过这部分。</p><p class=ql-align-justify>所谓强对偶形式，也就是：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6fb14b2ab3444b6082f037bae3dc07c4><p class=pgc-img-caption></p></div><p class=ql-align-justify>注意前面已经说了，弱对偶形式对于很多优化问题都成立，但强对偶形式不一定成立。而对于线性规划来说，强对偶形式是成立的。</p><p class=ql-align-justify>Farkas引理</p><p class=ql-align-justify>强对偶形式的证明，主要用到称之为“Farkas 引理”的结论：</p><p class=ql-align-justify>对于固定的矩阵</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/722dfbf2feaf4e21a5dba1db8917020b><p class=pgc-img-caption></p></div><p class=ql-align-justify>和向量</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9357d2522eeb48c793e43367f84c5721><p class=pgc-img-caption></p></div><p class=ql-align-justify>，下面两个选项有且只有一个成立：</p><p class=ql-align-justify>1. 存在</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/40aebdeda8444a5ca4068a820370d1b8><p class=pgc-img-caption></p></div><p class=ql-align-justify>且 x≥0，使得Ax=b；</p><p class=ql-align-justify>2. 存在</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7cec2fe6da894b74bd4cbb5708ceae6f><p class=pgc-img-caption></p></div><p class=ql-align-justify>使得</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/692c93ccfb4d4b49997db6e70ad758ce><p class=pgc-img-caption></p></div><p class=ql-align-justify>且</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5ebd04ea849b4423bfbdb6c1c856f044><p class=pgc-img-caption></p></div><p class=ql-align-justify>。</p><p class=ql-align-justify>什么鬼？又大又小又转置的？能不能说人话？</p><p class=ql-align-justify>其实这个引理还真有一个很直观的几何解释，只不过几何解释翻译成代数语言就不简单了。几何解释的出发点是我们去考虑如下的向量集合：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b6f6bb024e0640269e957f15bf13aa6c><p class=pgc-img-caption></p></div><p class=ql-align-justify>这个集合的含义是：我们将 A 看成是 n 个 m 维列向量的组合。</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/19ce3aaefc2948579e48439070590fc0><p class=pgc-img-caption></p></div><p class=ql-align-justify>那么上述集合实际上就是所有 a1,a2,…,an 的非负线性组合。那这个集合是个啥呢？答案是：一个锥，如图所示。</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/19a871ab3ee44d4fb18a3750d6a7fc4c><p class=pgc-img-caption></p></div><p><strong>▲ </strong>给定向量的非负线性组合构成这些向量围成的一个锥</p><p class=ql-align-justify>现在我们随便给定一个向量 b，那么显然它只有两种可能性，而且必有一种成立：1. 在锥内（包括边界）；2. 在锥外<strong>。</strong>这当然是废话，但是将它翻译成代数语言，那就不是废话了。</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3b4af5aca3724593a459c07492c20b35><p class=pgc-img-caption></p></div><p><strong>▲ </strong>给定的向量在锥内，意味着可以表示为非负线性组合</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a4641b294fe8495da8ba90dcc1d2de20><p class=pgc-img-caption></p></div><p><strong>▲ </strong>给定的向量在锥外，我们可以找到一个“标杆”向量与之对比</p><p class=ql-align-justify>如果它在锥内，那么根据锥本身的定义，它就可以表示为 a1,a2,…,an 的非负线性组合（表示方式可能不唯一），也就是存在 x≥0，使得 Ax=b，这就是第一种情况。</p><p class=ql-align-justify>如果在锥外呢？怎么表示在锥外？当然我们可以直接写出锥内的否命题，但是那实用价值不大。如果向量 b 在锥外，那么我们总是可以找到一个“标杆”向量 y，它与 a1,a2,…,an 的夹角都大于等于 90 度，向量表示法就是内积都小于等于零，即</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/cf2e77f4bdd647afa2563b03bbd9815c><p class=pgc-img-caption></p></div><p class=ql-align-justify>，或者写成一个整体</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/bfb762177dde4c08a8b22b3f5d5da83d><p class=pgc-img-caption></p></div><p class=ql-align-justify>。找到这个“标杆”后，向量 b 与“标杆”的夹角必然是要小于 90 度的，即</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9541bd72b5d741ec8238b4f0fdd8df2a><p class=pgc-img-caption></p></div><p class=ql-align-justify>。这样一个大于等于 90 度，一个小于 90 度，保证了向量 b 在全体向量构成的锥外。这就是第二种情况。</p><p class=ql-align-justify>当然，这不能算是完备的证明，只能算是一个启发式引导，完备的证明还要仔细论证为什么这些向量的非负线性组合构成了一个锥。这些就不在本文的范畴了。Farkas 引理的特点是二选一，比如我要证明满足第二点，只需要证明它不满足第一点，反之亦然。这是对问题的一个转化。</p><p class=ql-align-justify>从引理到强对偶</p><p class=ql-align-justify>有了 Farkas 引理，我们就可以证明强对偶形式了。证明的思路是：证明 max 可以任意程度地接近 min 。</p><p class=ql-align-justify>证明还是先假设 min 的最小值在</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/28e7ce0dfd214546bd27b9b90d8f88e3><p class=pgc-img-caption></p></div><p class=ql-align-justify>处取到，即最小值为</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9ae43de7ce59450690d6e7f8e9ec91d6><p class=pgc-img-caption></p></div><p class=ql-align-justify>，那么我们考虑：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1465d9f9f4cd42d4b3da910d48bef650><p class=pgc-img-caption></p></div><p class=ql-align-justify>当 ϵ>0 时，那么对于任意 x≥0，</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/845bc25b8a72421cb8d1cb71890a9754><p class=pgc-img-caption></p></div><p class=ql-align-justify>都不可能等于</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d7561acb3e644f5b9d19fee4336e3e41><p class=pgc-img-caption></p></div><p class=ql-align-justify>，这是因为</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3fd295e86a454bc0bf1fcb53bb5d76b8><p class=pgc-img-caption></p></div><p class=ql-align-justify>已经是最小值，所以</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/237989c348f146ff9c2071f5354208f8><p class=pgc-img-caption></p></div><p class=ql-align-justify>是</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6c0515057d624907bda7cc7497d93d46><p class=pgc-img-caption></p></div><p class=ql-align-justify>能达到的最大值，它不可能等于更大的</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5c4befbe767e438a8e135450dd2b5da9><p class=pgc-img-caption></p></div><p class=ql-align-justify>。前面已经说了，不满足第一种情况，那就只能满足第二种情况了，即存在</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e7460e89120c4946849f0eb00db20238><p class=pgc-img-caption></p></div><p class=ql-align-justify>使得</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d6f96900fa374b799b082dc07e2f2304><p class=pgc-img-caption></p></div><p class=ql-align-justify>且</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/bd2b9f5293b7422fb890e02e14e9a813><p class=pgc-img-caption></p></div><p class=ql-align-justify>，这等价于：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ee4a95663d7b49429dcafed14318410a><p class=pgc-img-caption></p></div><p class=ql-align-justify>下面我们表明 α 必须大于 0，这是因为</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15c285d8c70c4ce4be96e8cc5f924f33><p class=pgc-img-caption></p></div><p class=ql-align-justify>，所以我们再去考虑 ϵ=0。而当 ϵ=0 时有</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cb423df9a03a4e15a169c95807c67e1e><p class=pgc-img-caption></p></div><p class=ql-align-justify>，即满足 Farkas 引理的第一种情况，那就不满足第二种情况，而不满足第二种情况，意味着</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/31342a32732d4f7bac8a6a2d011b7a14><p class=pgc-img-caption></p></div><p class=ql-align-justify>，都有</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c308e8d64be14725aeb5b9ec37fa3f93><p class=pgc-img-caption></p></div><p class=ql-align-justify>，刚刚我们已经证明了</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3fcc942b8f5b45e79d3090411f529791><p class=pgc-img-caption></p></div><p class=ql-align-justify>，所以必须有 α>0。</p><p class=ql-align-justify>现在确定 α>0 了，我们就可以从式 (18) 得到：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d0eaa271195f4237a3b06f8ce06ff7ba><p class=pgc-img-caption></p></div><p class=ql-align-justify>这意味着：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15f453ff2234440392398e11bd192144><p class=pgc-img-caption></p></div><p class=ql-align-justify>而弱对偶形式已经告诉我们：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c8acd4aa469d4372958a7f7fc8646765><p class=pgc-img-caption></p></div><p class=ql-align-justify>也就是</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fba32030e46e4c0caff6d25f2ef7cc4f><p class=pgc-img-caption></p></div><p class=ql-align-justify>被夹在</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/441fc3114aa848aaa7ad6ab9065dbad2><p class=pgc-img-caption></p></div><p class=ql-align-justify>和</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/29916ba2fade4c39be9f51322d1051c7><p class=pgc-img-caption></p></div><p class=ql-align-justify>之间，而因为 ϵ > 0 是任意的，所以两者可以无限接近，从而：</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7122d6818c294082ad694616102d51a8><p class=pgc-img-caption></p></div><p class=ql-align-justify>这便是要证的强对偶形式。</p><p class=ql-align-justify>简单说明</p><p class=ql-align-justify>Farkas 引理和强对偶形式的证明，看上去比较迂回，但实际上是优化理论中非常经典和重要的证明案例，对于初学者来说，它应该是一次非常强烈的思维冲击。因为我们以往的认识中，我们对原命题做变换，仅仅是局限于“逻辑变换”，如否命题、逆否命题等。而对偶形式和 Farkas 引理却出现了一些“看起来很不一样，却又偏偏等价”的结论。</p><p class=ql-align-justify>Farkas 引理和强对偶形式也可以进一步推广到一般的凸集优化问题，证明手段相似，只不过在对区域和不等关系的讨论上，比上面的线性规划的过程更为细致和复杂。不过我也不是专门搞这些优化问题的，所以只有一个模糊的认识，就不再继续班门弄斧了。</p><p class=ql-align-justify>Wasserstein GAN</p><p class=ql-align-justify>好了，进行了一大通的准备工作后，我们终于可以导出 Wasserstein GAN 了，就本文来看，它只不过是线性规划的对偶形式的一个副产品罢了。</p><p class=ql-align-justify>W距离的对偶</p><p class=ql-align-justify>在推导之前，我们还是再来捋一捋本文的思路：本文先给出了 W 距离的定义 (1) ，然后经过分析，发现它其实就是普通线性规划问题的一个连续版本，转化过程为 (7) , (8) 和 (9) ；因此中间我们花了相当一部分篇幅去学习线性规划及其对偶形式，最终得到了结论 (14) 。</p><p class=ql-align-justify>现在我们要做的事情，就是把整个过程“逆”过来，也就是将找出 (14) 对应的连续版本，为 W 距离找一个对偶表达式。 其实这个过程也不复杂，由结论 (14) 和式 (9) ，我们得到：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/41d29f050e8b484e9609e3ed4ef246e4><p class=pgc-img-caption></p></div><p class=ql-align-justify>注意式 (8) 中 b 是由两部分拼起来的，所以我们也可以把 F 类似地写成：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/002eb3a38f5f498188c7be1402fbfd83><p class=pgc-img-caption></p></div><p class=ql-align-justify>现在 ⟨b,F⟩ 可以写成：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/90fffb09403b47cd95747ea3a5b3c409><p class=pgc-img-caption></p></div><p class=ql-align-justify>或者对应的积分形式是：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/55355539f1ac4864bb414d9b30b24699><p class=pgc-img-caption></p></div><p class=ql-align-justify>别忘了约束条件</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/42d097062896499ea3d8902975ab1661><p class=pgc-img-caption></p></div><p class=ql-align-justify>：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d9323ddfaa604ba6a274dd8922d41794><p class=pgc-img-caption></p></div><p class=ql-align-justify>代入计算后，可以发现这个诺大的矩阵运算实际上就说了这样的一件事情：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f19501f4febc446c94ac98186086da4e><p class=pgc-img-caption></p></div><p class=ql-align-justify>或者直接写成：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c923715a14204866af2bc640c36a351e><p class=pgc-img-caption></p></div><p class=ql-align-justify>从对偶到WGAN</p><p class=ql-align-justify>终于，我们就要接近尾声了，现在我们得到了 W 距离 (1) 的一个对偶形式了：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/17c7cf6c193c42d1b9eaeb4bd31208a5><p class=pgc-img-caption></p></div><p class=ql-align-justify>注意到由 f(x)+g(y)≤d(x,y) 我们得到：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/df27ed6ac61540119bb7e8f3fa5e56bd><p class=pgc-img-caption></p></div><p class=ql-align-justify>即 g(x)≤−f(x)，所以我们有：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/eada04592ed54fcd95e0521453a3830b><p class=pgc-img-caption></p></div><p class=ql-align-justify>即如果 g=−f，它的最大值不会小于原来的最大值，所以我们可以放心地让 g=−f，从而：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0fac893c668e4d488cfae0cb6c73fbc9><p class=pgc-img-caption></p></div><p class=ql-align-justify>这便是我们最终要寻找的 W 距离 (1) 的对偶形式了，其中约束条件我们可以写为 ||f||L≤1，称为 Lipschitz 约束。</p><p class=ql-align-justify>由于 p,q 都是概率分布，因此我们可以写成采样形式：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/673d8d7e644047b884d72434ed2d4845><p class=pgc-img-caption></p></div><p class=ql-align-justify>这就是 WGAN 的判别器所采用的 loss 了，自然地，整个 WGAN 的训练过程就是：</p><div class=pgc-img><img alt=从Wasserstein距离、对偶理论到WGAN onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/cc9fcfd3150a4eb089e451d7479bbf16><p class=pgc-img-caption></p></div><p class=ql-align-justify>千呼万唤的 WGAN 终于现身，剩下的就是怎么加 Lipschitz 约束的问题了，可以参考：深度学习中的Lipschitz约束：泛化与生成模型。</p><p class=ql-align-justify>文章小结</p><p class=ql-align-justify>本文主要介绍了 Wasserstein 距离，然后转化为一个线性规划问题，继而介绍了线性规划的对偶理论，最终导出了 Wasserstein 距离的对偶形式，它可以用作训练生成模型，即 WGAN 及后面一系列推广。</p><p>本文是笔者对线性规划及其对偶理论的一次简单学习总结，对熟悉线性代数后希望从理论上了解 WGAN 的读者应该会有一定的参考价值。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Wasserstein','距离','偶理论'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>