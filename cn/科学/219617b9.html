<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>为什么要进行因子正交化处理？ | 极客快訊</title><meta property="og:title" content="为什么要进行因子正交化处理？ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/ca2925bb8f364c5294c8bfd17a2d5067"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/219617b9.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/219617b9.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/219617b9.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/219617b9.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/219617b9.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/219617b9.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/219617b9.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/219617b9.html><meta property="article:published_time" content="2020-11-14T20:52:23+08:00"><meta property="article:modified_time" content="2020-11-14T20:52:23+08:00"><meta name=Keywords content><meta name=description content="为什么要进行因子正交化处理？"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E5%AD%A6/219617b9.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>为什么要进行因子正交化处理？</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E5%AD%A6.html>科学</a></span></div><div class=post-content><div><p><strong>摘要</strong></p><p>选股多因子模型中常进行因子正交化处理。如果因子之间不满足正交性，则它们会相互影响各自的回归系数，这可能造成回归系数过大的估计误差，对因子的评价产生负面影响。</p><p class=ql-align-center><strong>1 多因子模型求解</strong></p><p>在选股多因子模型中，人们常提到的一个概念是<strong>因子正交化处理</strong>。本文就从多因子截面回归求解的角度来简单说说为什么我们喜欢相互正交的因子，以及如果因子之间不正交对回归系数会有什么影响。</p><p class=ql-align-center>一个多因子模型可以写成如下的形式：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ca2925bb8f364c5294c8bfd17a2d5067><p class=pgc-img-caption></p></div><p class=ql-align-center>其中 <strong>y</strong> 是 N × 1 阶股票下一期的收益率向量，<strong>X</strong> 为 N × K 阶当期的因子暴露矩阵，<strong>b</strong> 为 K × 1 阶待通过回归求解得到的因子收益率向量，<strong>ε</strong> 为 N × 1 阶残差向量。假设 <strong>X </strong>满足列满秩，则上述模型的 OLS（ordinary least squares）回归求解为：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/112967f9b82b445ba797d93a1b0ea287><p class=pgc-img-caption></p></div><p>需要注意的是，在上面这个模型以及 <strong>b</strong> 的表达式中，因子向量 X 已经包括了所有的 regressors，因此回归模型右侧没有额外的截距项。这意味着，如果我们假设截距项也是一个因子，则它对应的 N × 1 阶向量 [1,1,…,1]^T 已经作为 <strong>X</strong> 的某一列（通常是第一列）存在于 <strong>X</strong> 之中了；如果我们假设截距项不是一个因子，则 <strong>X</strong> 中没有 [1,1,…,1]^T 这一列。</p><p>在 Barra 的多因子模型 CNE5 中考虑了国家因子，所有个股在该因子上的暴露都是 1，因此它的作用就相当于一个截距因子；[1,1,…,1]^T 这个向量在 Barra 模型中正是 <strong>X</strong> 的第一列。另外，对于我们最熟悉的 simple regression model，它的右侧只有一个截距和一个解释变量：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2382faff418d41a4aea861f5be401a5b><p class=pgc-img-caption></p></div><p class=ql-align-center>按照上述说明，该模型对应的矩阵 <strong>X</strong> 包括两列：一列对应截距，一列对应真正的解释变量 <strong>x</strong>：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/cf9b9202c1a74a318fd9a0ae49521453><p class=pgc-img-caption></p></div><p>从 <strong>b</strong> 的表达式来看，它和 (<strong>X</strong>^T)<strong>X</strong> 有关。<strong>当 X 的各列（即回归模型中的不同解释变量，或我们研究问题中的不同因子暴露向量）之间不正交时，则在计算 </strong>(<strong>X</strong>^T)<strong>X 乃至最终的 b 时，X 不同列之间是相互影响的，而这种影响不是什么好事儿。</strong></p><h1 class=ql-align-center><strong>2 简单一元回归</strong></h1><p>让我们从最简单的一元回归（simple univariate regression）说起。</p><p class=ql-align-center>假设有一元回归模型 <strong>y</strong> = b<strong>x</strong> + <strong>ε</strong>（模型右侧只有一个解释变量，<strong>没有截距项</strong>）。对于两个同阶向量 <strong>m</strong> 和 <strong>n</strong>，令 &lt;<strong>m</strong>, <strong>n</strong>> 表示它们的内积，即 &lt;<strong>m</strong>, <strong>n</strong>> = Σ(m_i)(n_i)，则该一元回归模型的 OLS 解为（求解对象就是标量 b）：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/2ed08abf442d4954871a611154974194><p class=pgc-img-caption></p></div><p class=ql-align-center>这个结论非常简单，但是它十分重要。在上一节中，我们给出了多元回归 OLS 求解的表达式：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cf4d266e5405499abea7c7f15fe48a55><p class=pgc-img-caption></p></div><p class=ql-align-center>比较一元回归模型的标量 b 和多元回归模型的向量 <strong>b</strong> 不难发现如下现象：在多元回归模型中，如果所有的解释变量两两正交，即 &lt;<strong>x</strong>_i, <strong>x</strong>_j> = 0, i ≠ j，则向量 <strong>b</strong> 中的每一个系数 b_i 恰恰等于：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a2376107090a4dbc99bb6ca5e55b0199><p class=pgc-img-caption></p></div><p>这是因为 &lt;<strong>x</strong>_i, <strong>x</strong>_j> = 0 保证了 (<strong>X</strong>^T)<strong>X</strong> 的所有非对角元素都是 0，因此它是一个对角阵。对角阵的逆矩阵就是把该对角阵对角线上的元素都取倒数，所以逆矩阵仍然是对角阵。因此，(<strong>X</strong>^T)<strong>X</strong> 的第 i 个对角元素为 1/&lt;<strong>x</strong>_i, <strong>x</strong>_i>。另一方面，(<strong>X</strong>^T)<strong>y</strong> 是一个 K × 1 向量，它的第 i 个元素是 <strong>x</strong>_i 和 <strong>y</strong> 的内积，即 &lt;<strong>x</strong>_i, <strong>y</strong>>。最终，多元回归的 b_i 正是 &lt;<strong>x</strong>_i, <strong>y</strong>>/&lt;<strong>x</strong>_i, <strong>x</strong>_i>。</p><p>怎么样？b_i 和一元回归中的 b 的表达式一模一样，说明<strong>当所有解释变量相互正交时，不同的因子（即 x</strong>_i<strong>）对彼此的参数估计（即 </strong>b_i<strong>，因子收益率）没有任何影响。</strong>这便是正交的好处。</p><p>那么，当因子（解释变量）之间不正交时又会怎样呢？为了回答这个问题，我们首先来看看回归的几何意义。</p><h1 class=ql-align-center><strong>3 回归的几何意义</strong></h1><p class=ql-align-center>将 <strong>b</strong> 的表达式代入回归模型得到 <strong>ε</strong> 的表达式，并计算 <strong>X</strong> 和 <strong>ε</strong> 的内积有；</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/abe476b960dd4424b401d1f8186abe9d><p class=pgc-img-caption></p></div><p>上式说明，OLS 的残差 <strong>ε</strong> 和解释变量 <strong>X</strong> 正交。来看看这在几何上意味着什么。</p><p class=ql-align-center>首先考虑最简单的情况，即一元回归 <strong>y</strong> = b<strong>x</strong> + <strong>ε</strong>（再次提醒，没有截距项）。它的几何意义如下图所示：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/e2c90251b66c4e1ebe7a4cc186644fd1><p class=pgc-img-caption></p></div><p>这个图说明，OLS 回归实际上将 <strong>y</strong> <strong>垂直投影到（orthogonally projected onto）x 之上</strong>，使得 <strong>y</strong> 和其在 <strong>x</strong> 上的投影之间的距离（<strong>ε</strong> 的长度）最短（残差平方和最小）。这就是 OLS 的几何意义。</p><p class=ql-align-center>再来看看二元回归 <strong>y</strong> = b_1<strong>x</strong>_1 + b_2<strong>x</strong>_2 + <strong>ε</strong>，并首先<strong>假设 x</strong>_1<strong> 和 x</strong>_2<strong> 之间是正交的</strong>。该回归的几何意义如下：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d8f2a64bd5994bf18936b014d6218f0f><p class=pgc-img-caption></p></div><p>对于二元回归，它的几何意义是将 <strong>y</strong> 垂直投影到由 <strong>x</strong>_1 和 <strong>x</strong>_2 生成的超平面内，其投影正如上图中绿色向量所示。此外，我们可以分别、独立的将 <strong>y</strong> 投影到 <strong>x</strong>_1 和 <strong>x</strong>_2 上（图中两个橘黄色向量）。在本例中，<strong>由于 x</strong>_1<strong> 和 x</strong>_2<strong> 相互正交（垂直），因此绿色向量恰好等于两个橘黄色向量之和。</strong>这说明当 <strong>x</strong>_1 和 <strong>x</strong>_2 正交时，回归系数 b_i 仅由 <strong>x</strong>_i 和 <strong>y</strong> 决定、其他任何解释变量 <strong>x</strong>_j (j ≠ i) 对 b_i 均没有影响。</p><p class=ql-align-center>下面来看看 <strong>x</strong>_1 和 <strong>x</strong>_2 非<strong>正交</strong>的情况。该二元回归的几何意义如下：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/5749d0dd258b4a43a2d8148acf0b8201><p class=pgc-img-caption></p></div><p>它和前一种情况最大的区别是，<strong>当 x</strong>_1<strong> 和 x</strong>_2<strong> 非正交时，y 在由 x</strong>_1<strong> 和 x</strong>_2<strong> 生成的超平面内的投影不等于 y 分别在 x</strong>_1<strong> 和 x</strong>_2<strong> 上的投影之和。</strong>在这种情况下，解释变量之间对各自的回归系数有不同的作用，因此 OLS 的回归系数 b_i <strong>不再等于</strong> &lt;<strong>x</strong>_i, <strong>y</strong>>/&lt;<strong>x</strong>_i, <strong>x</strong>_i>。</p><p>非正交 <strong>x</strong>_i 之间的相互作用如何影响回归系数 b_i 呢？通过连续正交化来求解多元线性回归可以回答这个问题。</p><h1 class=ql-align-center><strong>4 用正交化过程求解多元回归</strong></h1><p class=ql-align-center>还是拿我们最熟悉的 simple regression model 为例；该模型有两个解释变量 —— 截距项和 <strong>x</strong>。</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/982968f883614773ad708ca0ae9171d1><p class=pgc-img-caption></p></div><p class=ql-align-center>令 <strong>x</strong>_0 表示截距项对应的解释变量，即 <strong>x</strong>_0 = [1,1,…,1]^T；<strong>x</strong>_1 表示上式中的解释变量 <strong>x</strong>。假设 <strong>x</strong>_0 和 <strong>x</strong>_1 非正交（正交的话我们就不用费劲了）。对于简单回归模型，回归系数 a（对应 <strong>x</strong>_0）和 b（对应 <strong>x</strong>_1）的解为：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5e8f424845d1478a8c9294d587552d45><p class=pgc-img-caption></p></div><p class=ql-align-center>下面就来看看如何通过正交化求解 a 和 b。由于 <strong>x</strong>_0 和 <strong>x</strong>_1 非正交，首先需要构造出一组正交向量。令 <strong>z</strong>_0 = <strong>x</strong>_0 为其中的一个向量，将 <strong>x</strong>_1 用 <strong>z</strong>_0 进行一元回归（不带截距）得到的残差就是和 <strong>z</strong>_0 互相垂直（正交）的向量，记为 <strong>z</strong>_1。由一元回归的性质可知：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4db2714299e0418a979ccbd81e9bc2cd><p class=pgc-img-caption></p></div><p>其中 \bar x 表示 <strong>x</strong> 的均值，<strong>1</strong> 表示列向量 [1,1,…,1]^T，即 <strong>z</strong>_0。</p><p>So far so good？接下来，注意了：</p><p class=ql-align-center><strong>将 y 用上面得到的 z</strong>_1<strong> 进行一元回归（不带截距），得到的回归系数就是上述 simple regression model 中解释变量 x 的回归系数 </strong>b<strong>！</strong></p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/058f606b06dc4ad0a2469f5a3e25f85b><p class=pgc-img-caption></p></div><p class=ql-align-center>怎么样？我们并没有直接对该模型求解，而是通过正交化的方式就求出了解释变量 <strong>x</strong>_1 的回归系数 b。反应快的小伙伴也许马上会问 a 呢？a 是否等于 &lt;<strong>z</strong>_0, <strong>y</strong>>/&lt;<strong>z</strong>_0, <strong>z</strong>_0> 呢？别急，我们一会儿就聊 a，但是在那之前先来看一个<strong>通过连续正交化求解多元回归的算法</strong>（Hastie et al. 2016）：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d796938df6ae47a0bc735048e3803ce6><p class=pgc-img-caption></p></div><p><strong>该算法的核心是通过连续的正交化计算把一组非两两正交的向量 x</strong>_i<strong> 转换成一组两两正交的向量 z</strong>_i<strong>，并以此方便的求出最后一个被正交化的解释变量的多元回归系数。</strong>虽然它只有三步，但是每一步都值得解读一下：</p><ol><li>第一步是初始化，在所有解释变量中（如果回归中有截距项，就把 [1,1,…,1]^T 看做一个解释变量）任意挑选一个当作 <strong>x</strong>_0 进行初始化 <strong>z</strong>_0 = <strong>x</strong>_0。</li><li>第二步是<strong>根据我们自己选定的递归顺序（任意顺序都可以）</strong>，对 <strong>x</strong>_1, <strong>x</strong>_2, …, <strong>x</strong>_p 依次进行正交化。例如，对 <strong>x</strong>_j 的正交化处理就是用它和之前已经被处理过后的正交向量 <strong>z</strong>_0, <strong>z</strong>_1, …, <strong>z</strong>_{j-1} <strong>逐一独立</strong>一元回归得到系数 &lt;<strong>z</strong>_k, <strong>x</strong>_j>/&lt;<strong>z</strong>_k, <strong>z</strong>_k>, k = 0, 1, ..., j - 1，进而用 <strong>x</strong>_j 减去 (&lt;<strong>z</strong>_k, <strong>x</strong>_j>/&lt;<strong>z</strong>_k, <strong>z</strong>_k>)<strong>z</strong>_k, k = 0, 1, ..., j - 1 之和，得到的残差就是最新的正交化向量 <strong>z</strong>_j。</li><li>使用 <strong>y</strong> 和 <strong>z</strong>_p 进行一元回归，得到的系数 &lt;<strong>z</strong>_p, <strong>y</strong>>/&lt;<strong>z</strong>_p, <strong>z</strong>_p> 正是这个多元回归 OLS 求解中原始解释变量 <strong>x</strong>_p 的回归系数 b_p。注意，这一结论仅对<strong>最后一个</strong>（第 p 个）被正交化后的解释变量成立。换句话说，对于别的解释变量 j &lt; p，&lt;<strong>z</strong>_j, <strong>y</strong>>/&lt;<strong>z</strong>_j, <strong>z</strong>_j> 并不是多元回归中原解释变量 <strong>x</strong>_j 的回归系数。</li></ol><p>看到这里，有的小伙伴可能会问，这个算法确实不错，但是费了半天劲算出了一大堆相互正交的向量 <strong>z</strong>_j，但是求解回归系数的结论仅对最后一个被正交化的解释变量成立，这不是坑爹吗？</p><p>答案是并不坑爹！这是因为上述算法中的关键一点是，<strong>正交化这些解释变量的顺序是任意的</strong>。我们可以选任何一个来初始化，也可以选任何一个作为最后一个被正交化的解释变量。无论我们怎么选，上述过程都保证了最后一个被正交化的解释变量的回归系数满足 b_p = &lt;<strong>z</strong>_p, <strong>y</strong>>/&lt;<strong>z</strong>_p, <strong>z</strong>_p>。因此，<strong>我们只需要依次挑选这些解释变量作为最后一个被正交化的，就可以通过上述步骤方便的求出它们的回归系数。</strong>而它所反映出来的本质是：</p><blockquote><p><strong>在多元线性回归中，解释变量 x</strong>_j<strong> 的回归系数 </strong>b_j<strong> 等于 x</strong>_j<strong> 在被其他 x</strong>_0<strong>, x</strong>_1<strong>, …, x</strong>_{j-1}<strong>, x</strong>_{j+1}<strong>, …, x</strong>_p <strong>调整之后（即正交化，从而排除其他 x</strong>_i<strong> 对 x</strong>_j<strong> 的影响）仍能够对 y 产生的增量贡献。</strong></p></blockquote><p><strong>这个算法叫作多元回归的 Gram-Schmidt（格拉姆-施密特）正交化过程。</strong></p><p>本小节开始的 simple regression model 已经验证了上述结论。我们使用 <strong>x</strong>_0 将 <strong>x</strong>_1 正交化处理得到 <strong>z</strong>_1，然后用 <strong>y</strong> 和 <strong>z</strong>_1 回归得到的正是 <strong>x</strong>_1 的回归系数 b；如果将 <strong>x</strong>_1 选为 <strong>z</strong>_0，然后用它正交化 <strong>x</strong>_0 = [1,1,…,1]^T，就可以方便的求出回归系数 a。</p><p class=ql-align-center>让我们来好好审视一下这个结论，即：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/affa1718799541b9a7ae9b2458c4adff><p class=pgc-img-caption></p></div><p class=ql-align-center>上式说明，解释变量 <strong>x</strong>_p 的回归系数 b_p 和正交化后的 <strong>z</strong>_p 的大小（<strong>z</strong>_p 自己的内积为分母）有关。<strong>如果 x</strong>_p<strong> 和其他解释变量高度相关（即非常不正交），那么 z</strong>_p<strong> 就会很小，则会导致 </strong>b_p<strong> 非常不稳定（一点点样本数据的变化都会导致 </strong>b_p<strong> 的大幅变化）。</strong>当 y_i 满足独立同分布时，假设它的方差为 σ^2，可以证明回归系数 b_p 的方差和 <strong>z</strong>_p 的大小成反比，即 <strong>z</strong>_p 越小，b_p 的误差越大：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a8d4ec53cda2413492c78854c4732ec4><p class=pgc-img-caption></p></div><p>在多因子模型中，b_p 代表的是因子 p 的收益率。<strong>为避免因子收益率的估计非常不稳定，要求不同的因子之间尽量满足正交化。</strong>举例来说，在 Barra 的 CNE5 模型中，非线性规模因子和规模因子之间进行了正交化处理；残差波动率因子和规模以及 BETA 因子也进行了正交化处理。</p><p>在结束本小节的讨论之前，我还想介绍一个有意思也有用的特性。本节的论述说明我们可以任选一个解释变量作为最后一个，然后根据连续正交化方便的求出它的回归系数。这意味着如果我们有 20 个解释变量，需要进行 20 次上述操作。那么，<strong>是否存在什么办法仅通过进行一次连续正交化就求出所有的回归系数 </strong>b_j, j = 0, 1, …, p<strong> 呢？答案是肯定的。</strong></p><p class=ql-align-center>假设我们按照某给定顺序 <strong>x</strong>_0, <strong>x</strong>_1, …, <strong>x</strong>_p 进行了连续正交化过程，得到了 <strong>z</strong>_0, <strong>z</strong>_1, …, <strong>z</strong>_p，且我们现在知道 b_p = &lt;<strong>z</strong>_p, <strong>y</strong>>/&lt;<strong>z</strong>_p, <strong>z</strong>_p>。由于 b_p 是解释变量 <strong>x</strong>_p 的回归系数，因此 b_p(<strong>x</strong>_p) 正是 <strong>x</strong>_p 所解释的 <strong>y</strong> 的部分。如果从 <strong>y</strong> 中剔除 b_p(<strong>x</strong>_p)，并把得到的 <strong>y</strong> - b_p(<strong>x</strong>_p) 用 <strong>x</strong>_0, <strong>x</strong>_1, …, <strong>x</strong>_{p-1} 回归，则结果就和 <strong>x</strong>_p 无关了。在这个新的回归中，<strong>x</strong>_{p-1} 就变成了最后一个被正交化的解释变量，其对应的正交向量为 <strong>z</strong>_{p-1}。因此，<strong>x</strong>_{p-1} 的回归系数就是用新的 <strong>y</strong> - b_p(<strong>x</strong>_p) 和 <strong>z</strong>_{p-1} 回归的结果：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/47d56dbf1be44f89a83ae1deb3217d84><p class=pgc-img-caption></p></div><p class=ql-align-center>以此类推，我们可以按照 b_p, b_{p-1}, …, b_0 的<strong>倒序</strong>求解出多元回归中所有解释变量的回归系数 b_j（Drygas 2011）：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/31bb8ea22f104ddfb7919e31198d0e21><p class=pgc-img-caption></p></div><p class=ql-align-center>最后用本小节开始的 simple regression model 检验一下。我们用上述方法求解截距项的回归系数 a 看看。根据定义有 <strong>z</strong>_0 = <strong>1</strong> 并假设已知 b。则根据上面的表达式可得：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3b36a9180fbd4d6db0d991c9cb8c82eb><p class=pgc-img-caption></p></div><p>这正是直接求解 simple regression model 得到的回归系数 a（请往前滚屏比较看看）。</p><h1 class=ql-align-center><strong>5 一个例子</strong></h1><p class=ql-align-center>本节用一个例子来验证一下上一节的各种公式。假设有四个解释变量 <strong>x</strong>_0 到 <strong>x</strong>_3，以及 <strong>y</strong>：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f5e9ccf126b2452cb72c3ca54175743d><p class=pgc-img-caption></p></div><p class=ql-align-center>直接使用回归系数 <strong>b</strong> 的表达式求解，则它们的回归系数分别为：b_0 = 0.38548073, b_1 = 0.96332683, b_2 = -0.36300685, b_3 = 0.37189391。按照 <strong>x</strong>_0, <strong>x</strong>_1, <strong>x</strong>_2, <strong>x</strong>_3 的顺序进行连续正交化，得到的正交向量为：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/4ed02972fc9d40a291f3b1a2f683cf6e><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fa145604e50340dc8347d1c559524c6c><p class=pgc-img-caption></p></div><p class=ql-align-center>使用 Drygas (2011) 提出的解法按照 b_3, b_2, b_1, b_0 的顺序求解各个回归系数 b_j：</p><div class=pgc-img><img alt=为什么要进行因子正交化处理？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fd08d069506146ae83ae82722fcdfbe4><p class=pgc-img-caption></p></div><p>上述公式求出 b_0 = 0.38548073, b_1 = 0.96332683, b_2 = -0.36300685, b_3 = 0.37189391，和使用回归系数 <strong>b</strong> 的表达式求解的结果完全一致。另外，我们也可以分别选择 <strong>x</strong>_0, <strong>x</strong>_1, <strong>x</strong>_2 替换 <strong>x</strong>_3 作为最后一个被正交化的解释变量（前三个变量的顺序也不重要），并利用 b_p = &lt;<strong>z</strong>_p, <strong>y</strong>>/&lt;<strong>z</strong>_p, <strong>z</strong>_p> 求解，得出的 b_j 也和上面的完全相同。</p><h1 class=ql-align-center><strong>6 正交等于不相关？</strong></h1><p>在我们平常说因子之间正交的时候，另一个常用的词汇是因子之间“不相关”（这里不相关指的是不同因子的 Pearson 相关系数为零）。那么“正交”和“不相关”是否等价呢？</p><p>从定义出发，两个因子向量 <strong>x</strong>_1 和 <strong>x</strong>_2 正交意味着它们的内积，即 &lt;<strong>x</strong>_1, <strong>x</strong>_2> 为零。而 <strong>x</strong>_1 和 <strong>x</strong>_2 的相关系数为零则意味着 &lt;<strong>x</strong>_1 – E[x_1]·<strong>1</strong>, <strong>x</strong>_2 - E[x_2]·<strong>1</strong>> 为零，因为在计算相关系数时，必须先分别减去其均值，这就是个 centering 的过程。由于 &lt;<strong>x</strong>_1, <strong>x</strong>_2> 为零不一定意味着 &lt;<strong>x</strong>_1 – E[x_1]·<strong>1</strong>, <strong>x</strong>_2 - E[x_2]·<strong>1</strong>> 也为零，因此正交不一定等于不相关。</p><p>举个例子，[4, 2]^T 和 [3, -6]^T 的内积为零，这两个向量正交。而各自减去均值后，[4, 2]^T和 [3, -6]^T 分别变为 [1, -1]^T 和 [4.5, -4.5]^T。这两个新向量在一条直线上、内积不为零，因此 [4, 2]^T 和 [3, -6]^T 的相关系数不为零（事实上，它们的相关系数等于 1）。从多元回归求解的角度来说，我们在乎的是他们是否正交，而非 centering 之后的内积是否为零（即是否不相关）。</p><p>不过对于因子暴露向量来说，因为个股在每个因子上的暴露都经过 demean 处理了，所以每个因子向量的均值已经是零了（这里考虑的就是简单等权均值的情况，而不是像 Barra 那种用市值作为权重进行去均值的情况）。从这个意义上说，因子向量之间正交和它们之间不相关等价。</p><h1 class=ql-align-center><strong>7 结语</strong></h1><p>本文掰扯了一大堆公式其实就是想说明下面这句话：<strong>在多元线性回归中，解释变量 x</strong>_j<strong> 的回归系数 </strong>b_j<strong> 等于 x</strong>_j<strong> 在被其他 x</strong>_0<strong>, x</strong>_1<strong>, …, x</strong>_{j-1}<strong>, x</strong>_{j+1}<strong>, …, x</strong>_p<strong> 调整之后仍能够对 y 产生的增量贡献。如果 x</strong>_j<strong> 和其他解释变量高度相关，则它的回归系数 </strong>b_j<strong> 会有很大的估计误差。这对于多因子模型中评价因子收益非常不利。</strong></p><p>如果看完之后你对这句话有一定的体会，那我的功夫就没白花。</p><p>在计算机算法进行多元回归求解的时候，并不是试图按照 <strong>b</strong> 的公式计算 (<strong>X</strong>^T)<strong>X</strong> 的逆矩阵，而采用的正是正交化的思路。在正交化的过程中可以非常容易的得到 <strong>X</strong> 的 QR 分解，其中 <strong>Q</strong> 是正交阵、<strong>R</strong> 是上三角阵。这也极大的化简了回归系数 <strong>b</strong> 以及 <strong>y</strong> 预测值的求解。由于篇幅原因（我也好意思说篇幅……），本文就不给出 QR 分解的具体表达式了，感兴趣的读者请参考 Hastie et al. (2016)。</p><p><strong>参考文献</strong></p><ul><li>Drygas, H. (2011). On the Relationship between the Method of Least Squares and Gram-Schmidt Orthogonalization. <em>Acta et Commentationes Universitatis Tartuensis de Mathematica</em>, Vol. 15(1), 3 – 13.</li><li>Hastie, T., R. Tibshirani, and J. Friedman (2016). <em>The Elements of Statistical Learning: Data Mining, Inference, and Prediction</em>, 2nd Ed. Springer.</li></ul><p><strong>免责声明：</strong>文章内容不可视为投资意见。市场有风险，入市需谨慎。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'什么','进行','化处理'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>