<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>CAN协议学习要点总结 | 极客快訊</title><meta property="og:title" content="CAN协议学习要点总结 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/d9d10c0637314484936b2a1c6c13e576"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/22664e7.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/22664e7.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/22664e7.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/22664e7.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/22664e7.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/22664e7.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/22664e7.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/22664e7.html><meta property="article:published_time" content="2020-10-29T21:03:56+08:00"><meta property="article:modified_time" content="2020-10-29T21:03:56+08:00"><meta name=Keywords content><meta name=description content="CAN协议学习要点总结"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E5%AD%A6/22664e7.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>CAN协议学习要点总结</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E5%AD%A6.html>科学</a></span></div><div class=post-content><div><div class=pgc-img><img alt=CAN协议学习要点总结 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d9d10c0637314484936b2a1c6c13e576><p class=pgc-img-caption></p></div><p class=ql-align-justify>CAN协议，即controllerarea network协议，是一种串行数据通信协议，对应的是ISO中物理层与数据链路层的功能（另，CAN总线需要接的线少，通信可靠、抗干扰，故在汽车总线等方面得到了大量的应用）。</p><p class=ql-align-justify>对CAN有：</p><p class=ql-align-justify>A.工作：对通信数据的成帧处理（位填充、数据块编码、循环冗余检验、优先级判断等）；</p><p class=ql-align-justify>B.规定了：检验错误-出错标定-故障界定、何时收发报文、仲裁、控制帧；</p><p class=ql-align-justify>C.目的：为了任意两个CAN设备之间的兼容通信。</p><p class=ql-align-justify>D.CAN协议能分为两层（3小层），其中：</p><p class=ql-align-justify>数据链路层（又可以分成逻辑链路子层LLC和介质访问控制子层MAC）：LLC实现了远程帧请求、数据传输、确定收发哪一个报文、报文滤波、恢复管理、过载通知等；MAC（CAN协议的核心）现实了规则的传输：控制帧结构、执行仲裁、错误检测、出错标定、故障界定等；</p><p class=ql-align-justify>物理层：实现了不同节点间的电气属性的比特流传输、位时间、位编码；</p><p class=ql-align-justify>至于在应用层，则由另外的协议实现（如：DeviceNet、CANopen）。</p><p class=ql-align-justify><strong>一、特点</strong></p><p class=ql-align-justify>A.多主机、灵活：任一节点在任一时刻都能主动发送信息，不分主从；</p><p class=ql-align-justify>B.不同节点具有不同的优先级；</p><p class=ql-align-justify>C.仲裁：1、两个节点相对发送信息时，低优先级的主动停止，高优先级的不受影响；</p><p class=ql-align-justify>2、利用标识符实现位仲裁；</p><p class=ql-align-justify>3、数据帧的优先级大于远程帧的优先级；</p><p class=ql-align-justify>D. 多种发送接收方式：点对点、一对多、全局广播；</p><p class=ql-align-justify>E.最大传输速率为1Mbps（此时最远传输距离为40m），最远传输距离为10km（此时最大传播速率为5kbps），传输速率与相应的最大传输距离成反比；</p><p class=ql-align-justify>F.节点数最多可达110个（取决于最少节点的的CAN总线）；</p><p class=ql-align-justify>G. 短帧结构（数据最多是8字节，64位，16个16进制数）；</p><p class=ql-align-justify>H. 具有CRC错误检测与标定功能，因此出错率极低（总线空闲时，将自动破坏掉的报文重新传输）；</p><p class=ql-align-justify>I.对每一个节点具有主动错误、被动错误、总线关闭三种状态，记录的错误达到一定数量后节点会自动关闭，总线上其他操作不会受到影响；</p><p class=ql-align-justify>J.通信介质：双绞线、同轴电缆、光导纤维等，主要是双绞线（双绞线中CANL一般是棕色，而CANH则有黑、绿、紫色；而在简化图中，CANL为绿色而CANH为黄色）；</p><p class=ql-align-justify>K.报文过滤：利用过滤组、通过寄存器、有一个过滤码；</p><p class=ql-align-justify>L. 应答机制；</p><p class=ql-align-justify>M.保证延迟时间；</p><p class=ql-align-justify>N.系统宽数据的连通性。</p><p class=ql-align-justify><strong>二、CAN总线系统</strong></p><p class=ql-align-justify>A. CAN总线系统中有设备CPU、CAN控制器、CAN收发器、120Ω终端电阻和CAN总线等；</p><p class=ql-align-justify>B. 电平与逻辑的关系：</p><p class=ql-align-justify>总线上是“与”的逻辑关系，“0”是具有决定作用的；有一个“0”，与的结果就是“0”，显性；全部为“1”，与的结果才是“1”，隐形；</p><p class=ql-align-justify>定义显性电平为逻辑“0”，此时CANH为3.5V，CANL为1.5V，差分为2V，表闭合；</p><p class=ql-align-justify>定义隐形电平为逻辑“1”，此时CANH为2.5V，CANL为2.5V，差分为0V，表断开；</p><p class=ql-align-justify>C. 规范：CAN2.0A/2.0B</p><p class=ql-align-justify>帧：数据帧、远程帧（请求返回带有同样ID的帧）；</p><p class=ql-align-justify>网关：将不同波特率的CAN网络（如：CAN高速驱动、CAN低速舒适、CAN娱乐）连成一个整体网络。</p><p class=ql-align-justify><strong>三、术语</strong></p><p class=ql-align-justify>A.报文：固定格式发送、长度受限；</p><p class=ql-align-justify>B.信息路由：（1）不要求节点改变软硬件就可以接入CAN总线；（2）所有节点均可以接收报文、被同一份报文激活；（3）数据相容性：同一报文可以被所有节点接收、又可以没有被任何节点接收；</p><p class=ql-align-justify>C.Bps：同一个系统内固定；</p><p class=ql-align-justify>D.优先权：由ID定义；</p><p class=ql-align-justify>E.仲裁：当2个或2个以上的节点同时传送报文时，就会出现冲突，此时优先度高的节点就有总线访问权，它发送报文，另外优先度低的节点将会推出发送，在总线空闲的时候再次尝试发送，这就确保了报文和时间都不会损失；在仲裁过程中，发送器对发送位的电平和被监控的总线的电平比较，如果相同，则继续发送，如果发送端“1”，被监控端“0”，发送端失去仲裁，退出发送；</p><p class=ql-align-justify>F.错误检测（为了确保无错）：监视、循环冗余检查、位填充、报文格式检查；</p><p class=ql-align-justify>G.故障界定：累计错误0~127为主动错误状态，累计错误127~255为被动错误状态，；诶及错误超过255时，进入总线关闭状态；</p><p class=ql-align-justify>H.显性电平为逻辑“0”，隐形电平为逻辑“1”；</p><p class=ql-align-justify>I.应答：报文连贯的话，接收器应答；否则，接收器做出标志。</p><p class=ql-align-justify><strong>四、CAN报文及其结构</strong></p><p class=ql-align-justify>A.结构：帧起始（1位“0”）、仲裁场（11位ID+1位RTR，数据帧为“0”，远程帧为“1”）、控制场（2位保留位+4位DLC表示数据字节数）、数据场（0~8个字节，0~64位）、CRC、应答、结尾帧（7个“1”）；</p><p class=ql-align-justify>B.发送报文的节点在总线空闲或失去仲裁前恒为发送器、不是发送器的节点在总线不空闲的时候为接收器；</p><p class=ql-align-justify>C.数据场：从0~7依次8个字节，如：某个解析文件用到2、3字节时，3字节为高位字节，2字节为低位字节。</p><p class=ql-align-justify><strong>五、同步机制</strong></p><p class=ql-align-justify>A.节点检测到：“隐/1”→“显/0”条边沿，会产生总线位同步；</p><p class=ql-align-justify>B.当跳变沿不在位周期的同步段内的话，会产生相对误差：发生在采样点之前、同步段和传播时间段（补偿时延）之后的相位缓冲段1的，是正误差；发生在采样点之后，同步段之前的相对缓冲段2的，是负误差；</p><p class=ql-align-justify>C.硬同步：总线空闲时，下降沿（帧起始“1”→“0”）触发，所有节点位时间重新开始；</p><p class=ql-align-justify>重同步：在随后位中出现跳边沿，并在同步段之外，就会引起重同步（正误差时增长相对缓冲段1位时间、负误差时缩短相对缓冲段2位时间，借此来调整采样点，确保正确采样）；</p><p class=ql-align-justify>另，位填充既使数据透明化，又增加同步机会。</p><p class=ql-align-justify><strong>六、故障处理</strong></p><p class=ql-align-justify>用示波器测试CANL与CANH引脚的电压，可以分析出一些接线错误：CANL断路、CANH断路、CANL与电瓶短接、CANL与地短接、HL短接、HL交叉错接等。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'协议','学习','要点'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>