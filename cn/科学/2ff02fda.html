<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Rust标准输入和输出 | 极客快訊</title><meta property="og:title" content="Rust标准输入和输出 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/eb1d879738cd46c4a0cb134ac8604886"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/2ff02fda.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/2ff02fda.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/2ff02fda.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/2ff02fda.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/2ff02fda.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/2ff02fda.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/2ff02fda.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/2ff02fda.html><meta property="article:published_time" content="2020-10-29T21:13:10+08:00"><meta property="article:modified_time" content="2020-10-29T21:13:10+08:00"><meta name=Keywords content><meta name=description content="Rust标准输入和输出"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E5%AD%A6/2ff02fda.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Rust标准输入和输出</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E5%AD%A6.html>科学</a></span></div><div class=post-content><p>回顾一下我们写的第一个 Rust 程序就是带副作用的，其副作用就是向标准输出(stdout)，通常是终端或屏幕，输出了 Hello, World! 让屏幕上这几个字符的地方点亮起来。println! 宏是最常见的输出，用宏来做输出的还有 print!，两者都是向标准输出(stdout)输出，两者的区别也一眼就能看出。至于格式化输出，基础运算符和字符串格式化小节有详细说明，这里就不再啰嗦了。</p><p>更通用的标准输入与输出定义在 std::io 模块里，调用 std::io::stdin() 和 std::io::stdout() 两个函数分别会得到输入句柄和输出句柄(哎，句柄这个词是计算机史上最莫名其妙的翻译了)，这两个句柄默认会通过互斥锁同步，也就是说不让多个进程同时读或写标准输入输出，不然的话如果一个进程要往标准输出画马，一个进程要画驴，两个进程同时写标准输出的话，最后可能就给画出一头骡子了，如果更多进程画不同的动物最后可能就成四不像了。除了隐式地用互斥锁，我们还可以显式地在句柄上调用 .lock()。输入输出句柄实现了前面讲的读写 Trait，所以是 reader/writer，就可以调接口来读写标准输入与输出了。举几个</p><h1 class=pgc-h-arrow-right><br></h1><div class=pgc-img><img alt=Rust标准输入和输出 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/eb1d879738cd46c4a0cb134ac8604886><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>栗子：</h1><pre><code>use std::io;fn read_from_stdin(buf: &amp;mut String) -&gt; io::Result&lt;()&gt; {    try!(io::stdin().read_line(buf));    Ok(())}</code></pre><pre><code>use std::io;fn write_to_stdout(buf: &amp;[u8]) -&gt; io::Result&lt;()&gt; {    try!(io::stdout().write(&amp;buf));    Ok(())}</code></pre><p>可以看到上面的例子都是返回了 io::Result&lt;()> 类型，这不是偶然，而是 IO 操作通用的写法，因为 IO 操作是程序与外界打交道，所以都是有可能失败的，用 io::Result&lt;T> 把结果包起来，io::Result&lt;T> 只是标准 Result&lt;T,E> 中 E 固定为 io::Error 后类型的别名，而作为有副作用的操作我们一般是不用关心其返回值的，因为执行这类函数其真正的意义都体现在副作用上面了，所以返回值只是用来表示是否成功执行，而本身 Result 类型本身已经可以表示执行状态了，里面的 T 是什么则无关紧要，既然 T 没什么意义，那我们就选没什么意义的 unit 类型好了，所以 IO 操作基本上都是使用 io::Result&lt;()>。</p><p>另外有一个地方需要注意的是由于 IO 操作可能会失败所以一般都是和 try! 宏一起使用的，但是 try! 在遇到错误时会把错误 return 出去的，所以需要保证包含 try! 语句的函数其返回类型是 io::Result&lt;T>，很多新手文档没仔细看就直接查 std api 文档，然后照着 api 文档里面的例子把带 IO 操作的 try! 宏写到了 main 函数里。结果一编译，擦，照着文档写都编译不过，什么烂文档。其实点一下 api 文档上面的运行按钮就会发现文档里面的例子都是把 try! 放在另一个函数里面的，因为 main 函数是没有返回值的，而 try! 会返回 io::Result&lt;T>，所以直接把 try! 放 main 函数里面肯定要跪。比如下面的从标准输入读取一行输入，由于把 try! 放在了 main 函数里，所以是编译不过的。</p><pre><code>use std::io;fn main() {    let mut input = String::new();    try!(io::stdin().read_line(&amp;mut input));    println!("You typed: {}", input.trim());}</code></pre><p>这里有一件事需要主要的是 Rust 里面没有办法从键盘获取一个数字类型的值。实际上像 C 这样的语言也不是直接获取了数字类型，它只不过是做了一种转换。那么我们如果想要从键盘获取一个数字类型应该怎么做呢？</p><pre><code>fn main() {    let mut input = String::new();        std::io::stdin()            .read_line(&amp;mut input)            .expect("Failed to read line");    // 这里等效的写法是：    // let num: i32 = input.trim().parse().unwrap();     let num = input.trim().parse::&lt;i32&gt;().unwrap();    println!("您输入的数字是：{}", num);}</code></pre><p>如果有很多地方都需要输入数字可以自行编写一个 numin 宏:</p><pre><code>macro_rules! numin {      () =&gt;{          {            let mut input = String::new();              std::io::stdin()                  .read_line(&amp;mut input)                .expect("Failed to read line");              input.trim().parse().unwrap()        }    };}</code></pre><p>于是上面的程序可以被改写成：</p><pre><code>fn main() {    let num: i32 = numin!();    println!("您输入的数字是：{}", num);}</code></pre><p>不过如果用户输入的不是数字，那么就会导致错误。这一点和 C 里面是非常相似的。当然您可以把程序写得再复杂一点儿来保证用户输入的一定是数字。不过这些就不是我们这一节要讨论的内容了。</p><p>还有一点一些从其它语言转过来的程序员可能会疑惑的是，如何从命令行接受输入参数，因为 C 里面的 main 函数可以带参数所以可以直接从 main 函数的参数里获取输入参数。但其实这类输入与我们这里讲的有很大的差别的，它在 Rust 里面被归为环境变量，可以通过 std::env::args() 获取，这个函数返回一个 Args 迭代器，其中第一个就是程序名，后面的都是输入给程序的命令行参数。</p><pre><code>use std::env;fn main() {    let args = env::args();    for arg in args {        println!("{}", arg);    }}</code></pre><p>将上面的程序存为 <em>args.rs</em> 然后编译执行，结果如下</p><pre><code>$ rustc args.rs$ ./args a b c./argsabc</code></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Rust','标准','输入'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>