<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>智能运维 | 你的机房不通或者内网异常，用这个连通性矩阵图试试 | 极客快訊</title><meta property="og:title" content="智能运维 | 你的机房不通或者内网异常，用这个连通性矩阵图试试 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/dfic-imagehandler/762657a5-93a3-4744-afae-0b2af6d4cf8f"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/4c240fab.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/4c240fab.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/4c240fab.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/4c240fab.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/4c240fab.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/4c240fab.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/4c240fab.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/4c240fab.html><meta property="article:published_time" content="2020-11-14T20:53:56+08:00"><meta property="article:modified_time" content="2020-11-14T20:53:56+08:00"><meta name=Keywords content><meta name=description content="智能运维 | 你的机房不通或者内网异常，用这个连通性矩阵图试试"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E5%AD%A6/4c240fab.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>智能运维 | 你的机房不通或者内网异常，用这个连通性矩阵图试试</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E5%AD%A6.html>科学</a></span></div><div class=post-content><div><p class=ql-align-justify>在云环境下，云平台的运维更离不开运维可视化。在上次文章《智能运维 | 可视化让你一眼看出内网故障》中，我们详细介绍了内网可视化的事件流图。本文继续从可视化角度分析，百度内网监测系统（NetRadar）如何展示在某个时刻的内网异常，从而让运维工程师直观地了解情况。</p><p class=ql-align-center><br></p><h1 class=ql-align-center><strong>什么是机房连通性可视化</strong></h1><p class=ql-align-justify><br></p><p class=ql-align-justify>当运维工程师发现自己的系统出现异常，并通过事件流图得知内网存在异常后，他需要进一步得知这些异常影响了内网的哪些部分，从而判断内网的异常是否造成了自己系统的故障。在这种情况下，运维工程师希望能够有一个视图直观地展示异常的影响范围。具体来说影响范围包括：</p><ul><li>哪些机房之间的连通性有异常</li><li>哪些机房的内部网络存在异常</li><li>连通性异常是否是地域性的</li></ul><p class=ql-align-justify><br></p><p>备注：一个区域包含多个机房，比如华北区域包括4个机房，华东区域包括4个机房，华南区域包括3个机房。区域之间通常用跨区域的链路连接。跨区域链路出现故障时，会导致两个区域中的机房互相不能连通。</p><div class=pgc-img><img alt="智能运维 | 你的机房不通或者内网异常，用这个连通性矩阵图试试" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/762657a5-93a3-4744-afae-0b2af6d4cf8f><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>检测可视化网络状态的方法包括两种：图（graph）和连通性矩阵。</p><ul><li>在图中，每个节点代表一个网络实体，比如交换机、路由器、主机等，每条边代表网络实体之间的链路。</li><li>在连通性矩阵中，网络实体对应矩阵的行和列，矩阵中的元素表示所在行和列对应的网络实体之间的链路。</li></ul><p class=ql-align-justify>根据上述的需求，我们可以看出工程师们主要关注机房之间的连通性情况。如果用图的方式表达，就会形成一个全连通图，图中大量的边不利于工程师掌握网络总体状态。因此，我们决定使用连通性矩阵的可视化方法。</p><p class=ql-align-justify><br></p><h1><strong>1连通性矩阵</strong></h1><p class=ql-align-justify><br></p><p class=ql-align-justify>假设有a1、a2、a3、a4四个机房，可以用一个4行4列连通性矩阵来表示，其中机房ai对应矩阵中的第i行和第i列。矩阵中第i行第j列的元素描述的就是机房ai到机房aj的连通性状态，如下图：</p><p class=ql-align-justify></p><p class=ql-align-center><br></p><div class=pgc-img><img alt="智能运维 | 你的机房不通或者内网异常，用这个连通性矩阵图试试" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0605b100f5b5439a8f54d7180f1c4174><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>图1 连通性矩阵</p><p class=ql-align-justify><br></p><p class=ql-align-justify>我们不妨用bij来表示矩阵中位于第i行第j列的元素。图中存在一个红色的圆点，位于b32，以及一个灰色的三角形，位于b44。</p><p class=ql-align-justify>b32的红色的圆点代表机房a3到机房a2的链路出现了异常。在矩阵中，与b32对称的元素b23代表的是机房a2到机房a3的链路状态。b23和b32说的都是机房a2和机房a3之间的链路，只是方向不同，这正好可以表达内网监控系统的探测方向。</p><p class=ql-align-justify>为了探测网络连通性，监控系统在服务器之间发送探测包。比如，服务器x给服务器y发送了一个探测包，y收到探测包后给x发送一个响应包。如果x收到了响应包，就认为x到y的链路没有问题。反过来，y也可以给x发送探测包，x发送响应包。这说明内网监控系统的探测是存在方向性的。</p><p class=ql-align-justify>所以图中b32有红点，b23没有点的意思就是：机房a3的服务器主动发送探测包探测机房a2中的服务器，存在大量丢失响应包或者延迟显著增大的情况，连通性有异常；而机房a2的服务器主动发送探测包探测机房a3中的服务器，响应包基本都能正常到达。两个探测方向结论不一致主要是由机房的网络出口和入口设备不同，并且单一设备出故障导致。</p><p class=ql-align-justify>b44的灰色三角形代表的是机房a4的机房内网络存在异常。连通性矩阵的主对角线元素bii都代表机房内网络的状态。为了能够与机房间网络有更直观的区分，我们选择了三角形来表示。</p><p class=ql-align-justify>最后，颜色代表了异常的程度，红色代表异常程度比较严重，灰色代表异常程度比较轻微。所以图1中a3到a2的机房间网络存在比较严重的连通性异常，而a4的机房内网络则存在比较轻微的连通性异常。</p><p class=ql-align-justify>当连通性矩阵中存在多个异常点时，这些点可以形成特定的模式，分别代表不同的网络问题。</p><p class=ql-align-justify>下面，我们就来分析几种常见的模式。</p><div class=pgc-img><img alt="智能运维 | 你的机房不通或者内网异常，用这个连通性矩阵图试试" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/9e17ee48-ccf1-4cf8-a4a3-aece1e7dc9a4><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify><br></p><h1><strong>2单机房出/入口链路问题</strong></h1><p class=ql-align-justify><br></p><p class=ql-align-justify>在连通性矩阵图中，可能会出现整行红色圆点。</p><p class=ql-align-justify></p><p class=ql-align-center><br></p><div class=pgc-img><img alt="智能运维 | 你的机房不通或者内网异常，用这个连通性矩阵图试试" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/77e3e2ad6a2e4816880e89a773f8753e><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>图2.1 单机房出口链路问题</p><p class=ql-align-justify><br></p><p class=ql-align-justify>图2.1存在三个红色的圆点，分别位于b31、b32、b34位置。这就是整行红色圆点的情况。 每个点的含义如下：b31代表的是a3到a1的链路有异常，b32是a3到a2的链路有异常, b34 表示a3到a4链路有问题, 从这几个链路问题来看，链路都是从a3出来的，所以a3的出口链路出现了故障。</p><p class=ql-align-justify>当然有可能出现整列红色圆点的情况，如下图所示：</p><p class=ql-align-justify></p><p class=ql-align-center><br></p><div class=pgc-img><img alt="智能运维 | 你的机房不通或者内网异常，用这个连通性矩阵图试试" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/14b8e10022374031849d6b45ec0ae58c><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>图2.2 单机房入口链路问题</p><p class=ql-align-justify><br></p><p class=ql-align-justify>图2.2的三个红色圆点，分别在b13、b23、b43位置。同理：b13表示a1到a3的链路有问题, b23说明a2到a3链路有故障, b43呈现a4到a3的链路问题，这一列的链路问题，说明a3的入口链路出现的异常。</p><p class=ql-align-justify>是不是有整行、整列的红点情况呢？</p><p class=ql-align-justify></p><p class=ql-align-center><br></p><div class=pgc-img><img alt="智能运维 | 你的机房不通或者内网异常，用这个连通性矩阵图试试" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b45d754511a448d88fcc9a4b25ea3fc3><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>图2.3 单机房出入口链路问题</p><p class=ql-align-justify>图2.3包含了6个红色圆点，是图2.1与图2.2的集合， 整行与整列的异常代表a3的出/入链路都出现异常。</p><h1><strong>3单机房核心设备问题</strong></h1><p class=ql-align-justify><br></p><p class=ql-align-justify>图2.1、图2.2、图2.3都看到b33这个点是没有状态的，那如果在b33的点的异常情况也加上有表示什么呢？看如下可视化方式：</p><p class=ql-align-justify></p><p class=ql-align-center><br></p><div class=pgc-img><img alt="智能运维 | 你的机房不通或者内网异常，用这个连通性矩阵图试试" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/80ba1cf72f9349ba8089cbc3ac4fd178><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>图3 单机房核心设备问题</p><p class=ql-align-justify><br></p><p class=ql-align-justify>图3所示，除了图2.2中的6个红色圆点，还在b33中有个红色的三角，b33位置的三角刚好在矩阵图的主对角线上，代表a3机房内网络出现故障。图3的6个红色圆点说明a3的出/入链路出现网络异常，红色三角说明a3单机房核心设备也出现故障。</p><div class=pgc-img><img alt="智能运维 | 你的机房不通或者内网异常，用这个连通性矩阵图试试" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/0b79dce5-d546-4619-9f1a-a240b0696489><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><h1><strong>4区域链路问题</strong></h1><p class=ql-align-justify><br></p><p class=ql-align-justify>通常，网络不是只在某一个区域，有可能同时有华北区域a1、a2、a3、a4四个机房，华东区域b1、b2、b3、b4四个机房，华南区域c1、c2、c3、c4四个机房，如下图所示。</p><p class=ql-align-justify></p><p class=ql-align-center><br></p><div class=pgc-img><img alt="智能运维 | 你的机房不通或者内网异常，用这个连通性矩阵图试试" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bb6a64e202c94cd588259611e28cf593><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>图4.1 区域链路问题</p><p class=ql-align-justify><br></p><p class=ql-align-justify>图4.1，我们可以看出机房分别用三个颜色来标识：紫色、蓝色、绿色。这几个颜色在右上角有说明分别代表华北区域、华东区域与华南区域。同时，图中在蓝色区块的华东区域（b1、b2、b3、b4机房）两个区块有大批红点出现，呈现两个矩阵形状的圆点，这说明华东区域的链路问题导致机房互相不能连通。那如果，我们想对区域进行筛选，只查看华北、华南的区域之间的情况呢？如下图所示：</p><p class=ql-align-justify></p><p class=ql-align-center><br></p><div class=pgc-img><img alt="智能运维 | 你的机房不通或者内网异常，用这个连通性矩阵图试试" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/beb9aaed89a24047b8041f5f406730f2><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>图4.2 区域筛选链路问题</p><p class=ql-align-justify><br></p><p class=ql-align-justify>如图4.2中只有一个红色三角与红色圆点，与图4.1相比，这里筛选掉了图4.1华东区域的所有异常。 我们从图4.2中，能看到一个细节问题，鼠标移动到异常点的时候，出现“进入c3-a4机房详情页 ”tooltip信息，点击这个异常点，可以进一步查看这俩机房间的异常事件与相关的指标趋势。如果想要知道a4机房内的详情，可以点击这个异常点查看详情，然后我们可以进一步观察a4内部集群之间的网络连通性， 集群的网络连通性跟机房连通性矩阵的方式是一样的，就不详细展开了。</p><h1 class=ql-align-center><strong>总 结</strong></h1><p class=ql-align-justify>矩阵图的最大优点在于，寻找对应元素的交点很方便，而且不会遗漏，显示对应元素的关系也很清楚。所以是一种很好的方式来可视化机房连通性的异常状况。从内网连通性矩阵图来看，可视化能让运维由繁化简，关键是我们如何从业务角度出发，用可视化手段来表达运维数据。在智能运维场景中，我们结合业务，抽象出这些可视化组件，单独看这些可视化组件没那么神奇，但是如果我们把它们放在一起，就得到了运维通用的解决方案。</p><p class=ql-align-justify>后面我们还会持续发布可视化相关的文章，请关注百度云微信公众号。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'通性','运维','机房'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>