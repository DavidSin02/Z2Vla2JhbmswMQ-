<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>「精品干货」CANopen实时总线的基本概念与知识讲解 | 极客快訊</title><meta property="og:title" content="「精品干货」CANopen实时总线的基本概念与知识讲解 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/483b71e53c0243fd8d35fd9a0ef1d924"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/506dfac.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/506dfac.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/506dfac.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/506dfac.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/506dfac.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/506dfac.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/506dfac.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/506dfac.html><meta property="article:published_time" content="2020-10-29T21:03:57+08:00"><meta property="article:modified_time" content="2020-10-29T21:03:57+08:00"><meta name=Keywords content><meta name=description content="「精品干货」CANopen实时总线的基本概念与知识讲解"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E5%AD%A6/506dfac.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>「精品干货」CANopen实时总线的基本概念与知识讲解</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E5%AD%A6.html>科学</a></span></div><div class=post-content><div><p>一、 CAN和CANopen简介</p><p><strong>CAN</strong>总线全称为 Controller AreaNetwork 即控制器局域网是国际上应用最广泛的现场总线之一，已经在汽车制造、机械制造、包装机械、烟草等行业得到了广泛的应 用 。</p><p>CAN 总线是德国 BOSCH 公司从 80 年代初为解决现代汽车中众多的控制与测试仪器之间的数据交换而开发的一种串行数据通信协议，它是一种多主总线，通信介质可以是双绞线、同轴电缆或光导纤维。通信速率可达 1MBPS 。CAN 总线通信接口中集成了 CAN协议的物理层和数据链路层功能，可完成对通信数据的成帧处理，包括位填充、数据块编码、循环冗余检验、优先级判别等项工作。</p><p>CAN 协议的一个最大特点是废除了传统的站地址编码，而代之以对通信数据块进行编码。采用这种方法的优点可使网络内的节点个数在理论上不受限制，数据块的标识码可由 11 位或 29 位二进制数组成，因此可以定义 211 或 229 个不同的数据块，这种按数据块编码的方式，还可使不同的节点同时接收到相同的数据，这一点在分布式控制系统中非常有用。数据段长度最多为 8 个字节，可满足通常工业领域中控制命令、工作状态及测试数据的一般要求。同时，8 个字节不会占用总线时间过长，从而保证了通信的实时性。CAN 协议采用 CRC 检验并可提供相应的错误处理功能，保证了数据通信的可靠性。CAN 卓越的特性、极高的可靠性和独特的设计，特别适合工业过程监控设备的互连，因此，越来越受到工业界的重视，并已公认为最有前途的现场总线之一。</p><p>另外，CAN 总线采用了多主竞争式总线结构，具有多主站运行和分散仲裁的串行总线以及广播通信的特点。CAN 总线上任意节点可在任意时刻主动地向网络上其它节点发送信息而不分主次，因此可在各节点之间实现自由通信。CAN 总线协议已被国际标准化组织认证，技术比较成熟，控制的芯片已经商品化，性价比高，特别适用于分布式测控系统之间的数通讯。CAN 总线插卡可以任意插在 PC、 AT 、XT 兼容机上，方便地构成分布式监控系统。</p><p>而 CANopen 是基于 CAN 总线的应用层协议，在开放的现场总线标准中CANopen是最著名和成功的一种,已经在欧洲和美国获得广泛的认可和大量应用。1992 年在德国成立了“自动化 CAN 用户和制造商协会”(CiA,CANinAutomation)，开始着手制定自动化CAN 的应用层协议CANopen。此后，协会成员开发出一系列 CANopen 产品，在机械制造、铁路、车辆、船舶、制药、食品加工等领域获得大量应用。目前 CANopen 协议已经成为了一种新的工业现场总线标准 EN-50325-4。CANopen 协议是 CAN-in-Automation(CiA)定义的标准之一，在欧洲，CANopen 协议被认为是在基于 CAN 的工业系统中占领导地位的标准。大多数重要的设备类型，例如数字和模拟的输入输出模块、驱动设备、操作设备、控制器、可编程控制器或编码器，都在称为“设备描述”的协议中进行描述；“设备描述”定义了不同类型的标准设备及其相应的功能。依靠 CANopen 协议的支持，可以对不同厂商的设备通过总线进行配置。</p><div class=pgc-img><img alt=「精品干货」CANopen实时总线的基本概念与知识讲解 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/483b71e53c0243fd8d35fd9a0ef1d924><p class=pgc-img-caption></p></div><p>二、CANopen的基本知识</p><p><strong>EDS文件</strong></p><p>EDS （Electronic Data Sheet）</p><p>EDS 文件描述了 CAN 网络上设备通信属性（波特率、输出类型、I/O 提供…）。它由设备制造商提供，用于在配置工具中配置节点（就像 Windows 里的设备驱动程序）。</p><p>PDO</p><p>PDO （过程数据对象）</p><p>CANopen 帧包含 I/O 数据</p><p>区分在：</p><p>1、 传送 PDO：TXPDO 带有节点提供给其他节点的数据</p><p>2、 接收 PDO：RXPDO 节点消耗的数据</p><p>传送的方向从节点的观点看总是可见的。PDO 没有必要包含所有节点映象。通常模拟量和数字量被分成不同的 PDO 进行传送。对输出也是同样如此！</p><p>SDO</p><p>SDO （服务数据对象）</p><p>CANopen 帧包含参数</p><p>SDO 主要用于在程序运行时，从设备读参数或者向设备写参数</p><p><strong>COB-ID</strong></p><p>COB-ID（通讯对象标识符）</p><p>每个 CAN 帧以一个 COB-ID 开头，COB-ID 作为 CAN 帧的标识符。</p><p>在配置阶段，每个节点在接收 COB-ID 时，对帧来说，他是提供者或者消费者。</p><div class=pgc-img><img alt=「精品干货」CANopen实时总线的基本概念与知识讲解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4905d5745b9f49a1abaad997ac406780><p class=pgc-img-caption></p></div><p>三、关于CANopen</p><p>介绍</p><p>CANopen 是一个标准的工业控制系统现场总线协议。它特别适合实时控制的 PLC ，因为它为集成的和可传输的工业应用提供了一个高效、低成本的解决方案。</p><p><strong>CANopen协议</strong></p><p>CANopen 协议是建立在 CAL 协议基础上的一个子协议。通过定义设备规范，它甚至更加适合于标准工业组件。CANopen 是一个 CIA （CAN inAutomation）标准，投入市场之初，它就迅速被推广。在欧洲，CANopen现在已经被公认为基于 CAN 设计的工业系统的工业标准。</p><p>物理层</p><p>CAN 使用差分驱动两总线（公共回路）。CAN 信号是 CAN-high 和CAN-low 线之间的电压差值。</p><div class=pgc-img><img alt=「精品干货」CANopen实时总线的基本概念与知识讲解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c2e77c110e16482a86d867ab70e94381><p class=pgc-img-caption></p></div><p>1:CAN-high 线</p><p>2:CAN-low 线</p><p>3:终端电阻：120Ω</p><p>4:节点</p><p>根据电磁兼容要求，总线可以使用平行、双绞或者屏蔽走线方式。单线结构使反射最小化。</p><p><strong>CANopen规范文件</strong></p><p>通讯规范文件</p><p>CANopen 规范文件时基于“通信规范文件”的，用来规定主要通讯机制和它们的描述（DS301 ）。</p><p>设备规范文件</p><p>在设备规范文件中描述了工业自动化领域最重要的设备类型，同时也定义了设备功能类型。</p><p>标准设备描述例子为：</p><p>◆ 数字量和模拟量输入/输出模块（DS401）</p><p>◆ 电机（DS402）</p><p>◆ 控制设备（DS4P403）</p><p>◆ 闭环控制器（DSP404）</p><p>◆ PLC （DS405）</p><p>◆ 编码器（DS406）</p><p><strong>通过CAN总线配置设备</strong></p><p>通过 CAN 总线配置设备的可能性是制造商要求自治的基本原则之一。</p><p><strong>CANopen规范文件的通用规格</strong></p><p>CANopen 是符合以下规定文件的，用于 CAN 系统的一套规范：</p><p>◆ 开发的总线系统</p><p>◆ 无协议超负荷的实时数据交换</p><p>◆ 可重新定义尺寸的模块化设计</p><p>◆ 设备互用性和交换性</p><p>◆ 被大量国际制造商支持</p><p>◆ 标准的网络配置</p><p>◆ 访问所有的参数设备</p><p>◆ 同步和循环过程数据/事件驱动数据</p><p><strong>CANopen产品认证</strong></p><p>在市场上提供CANopen 认证产品的制造商都是 CiA 组织成员。</p><p><strong>CAN标准</strong></p><p>CANopen 协议被 CIA 组织定义并且可访问该组织（须遵守某些限制 ）站点：http://www.can-cia.com.对主从设备的源代码可以从不同的供应商得</p><p>到。</p><p><strong>与CANopen网络通讯</strong></p><p>通讯协议文件基于 CAL 服务和协议。</p><p>它提供用户对两种交换类型的访问：SDO、PDO。</p><p>在上电时，设备进入一个初始化阶段，接着进入预处理阶段。在这个阶段，只有SDO 可以通讯。在接到一个启动命令后，设备进入工作状态 ，在这个阶段 PDO 可以进行通讯，SDO 通讯仍然有效。</p><p><strong>CANopen启动Boot-up</strong></p><p>启动过程 最小设备配置指定了简化的启动程序。这个过程描述如下：</p><div class=pgc-img><img alt=「精品干货」CANopen实时总线的基本概念与知识讲解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5715bfbcd21447a9a9d99d9d960a9436><p class=pgc-img-caption></p></div><p>详细步骤介绍：</p><p>１、模块上电</p><p>２、模块初始化，进入预处理状态</p><p>３、NMT 服务：启动远程节点</p><p>４、NMT 服务：预处理</p><p>５、NMT 服务：停止远程节点</p><p>６、NMT 服务：重启节点</p><p>７、NMT 服务：重启节点通讯</p><p>初始</p><p>进入“重新启动通讯”后，设备进入初始模式。</p><p>该状态允许的操作有：</p><p>◆ 定义要求的通讯对象（SDO、PDO、紧急事件处理）</p><p>◆ 安装相关的 CAL 服务</p><p>◆ 配置 CAN 控制器</p><p>初始化完成后设备自动进入预处理模式。</p><p>预处理</p><p>进入预处理的条件:</p><p>◆ 在初始化完成后</p><p>◆ 在正常工作模式下，接收到“进入预处理”NMT 命令</p><p>在这种情况下，设备的配置可以被修改。然而只有 SDO 可以用来读或写设备的参数。</p><p>当配置完成后，通过接收相关的命令，设备进入以下的工作状态：</p><p>◆ 停止 ，当接收到“停止远程节点”NMT 命令</p><p>◆ 运行 ，当接收到“启动远程节点”NMT 命令</p><p>停止</p><p>如果设备处于“预处理 ” 或者“正常工作 ” 状态，接收到“节点停止 ” 命令（NMT 服务），设备进入 “停止状态 ” 。</p><p>在这种情况下，设备不能被配置。不能读写设备相关参数（SDO ），只有从设备的监视功能（即节点保护）有效。</p><p>操作</p><p>当设备处于“预处理”状态，接收到“启动远程节点 ” ，设备进入操作状态。在“运行 ” 状态，当使用“节点启动 ” NMT 服务启动 CANopen 网络，所有的设备功能性被使用，PDO、SDO 均可进行通讯。</p><p><strong>过程数据对象（PDO）</strong></p><p><strong>PDO定义</strong></p><p>PDO 是过程数据通信相关的通信对象，它能保证过程数据的实时交换。</p><p>一个 CANopen 设备的 PDO 对象定义了它与网络上其他 CANopen 设备之间的</p><p>隐式数据交换。</p><p>当设备运行时，PDO 交换被激活。</p><p><strong>PDO类型</strong></p><p>有两种 PDO 类型：</p><p>◆ TXPDO/TPDO：PDO 被设备传送</p><p>◆ RXPDO/RPDO：PDO 被设备接收</p><p><strong>PDO的供给者与消费者</strong></p><p>PDO 基于“供给者/消费者 ” 模型。传送的叫“供给者 ” ，接收的叫“消费者 ” 。</p><p><strong>PDO的传送模式</strong></p><p>◆ 同步（通过接收SYNC对象实现同步）</p><p>非周期：由远程帧预触发传送，或者由设备子协议中规定的对象特定事件预触发传送。</p><p>周期：传送在每1到240个SYNC消息后触发。</p><p>◆ 异步</p><p>由远程帧触发传送。</p><p>由设备子协议中规定的对象特定事件触发传送。</p><p><strong>服务数据对象（SDO）</strong></p><p><strong>SDO定义</strong></p><p>服务数据对象 SDO 允许使用显示请求交换数据。</p><p>当设备处于预处理、工作状态，SDO 服务是有效的 。</p><p><strong>SDO的类型</strong></p><p>有两种 SDO 类型：</p><p>◆ 读 SDO（上传）</p><p>◆写 SDO（下载）</p><p><strong>客户端/ 服务器模型</strong></p><p>SDO 协议是基于“客户端/服务器”模型。</p><p>对于下载 SDO</p><p>客户端发送一个标示被写对象的请求，服务器返回一个确认信息。</p><p>对于上传 SDO</p><p>客户端发送一个标示被读对象的请求，服务器返回被读对象的数据。</p><p>对于一个未处理的 SDO</p><p>对于以上的两种情况，如果一个 SDO 不能被处理，服务器返回一个错误</p><p>代码。</p><p><strong>“节点保护”和“寿命保护”</strong></p><p>使用期限的定义</p><p>“使用期限”参数是按以下来计算的：</p><p>使用期限=保护时间（看门狗时间）*使用期限系数；</p><p>保护时间的典型值在 250ms 到 2S 之间。对象 0X100CH 含有以毫秒时间定义的保护时间，对象 0X100DH 含有“使用期限系数 ” 。</p><p>监控机制：</p><p>1、节点保护</p><p>2、心跳报文</p><p>监控激活</p><p>如果两个参数中有一个为零，那么模块不执行监控，即无寿命保护。为了激活监控，必须在两个对象中输入非零的数值。</p><p>保证可靠工作</p><p>为了保证可靠工作，建议设置“使用期限系数 ” 为 2。如果不是只样，主模块会产生延时（例如，在“节点保护 ” 时高优先级信息的处理或者内部处理时），模块会转入预处理模式而不产生错误。</p><p>监控的重要性</p><p>这两种保护机制对 CANopen 系统的安全运行特别重要，特别是对不工作于事件-被控模式的设备。</p><p>从设备的监控</p><p>监控按以下的方法执行：</p><p>◆ 主设备发送远程帧，来读取从设备的状态;</p><div class=pgc-img><img alt=「精品干货」CANopen实时总线的基本概念与知识讲解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2c3dca724ad04f41ba5265f492b803cb><p class=pgc-img-caption></p></div><p>从设备答复：</p><div class=pgc-img><img alt=「精品干货」CANopen实时总线的基本概念与知识讲解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8cc4004bf4c74b2c8ce19fd0e2323fdd><p class=pgc-img-caption></p></div><p>◆ 从设备可以被配置为产生周期性的被称着 “心跳报文” 的报文，周期性的发送从设备的状态。</p><div class=pgc-img><img alt=「精品干货」CANopen实时总线的基本概念与知识讲解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/33d1f50ba6474a008b179179628f3e4c><p class=pgc-img-caption></p></div><p>主设备的监控</p><p>如果主设备基于严格循环请求“保护 ” 信息，从设备可以检测主设备的状态。如果从设备在也定义的使用期限内没有收到主设备的请求（保护错误），它会认为主设备故障。这种情况下相应输出进入出错状态并且从设备进入预处理状态。</p><p>“保护”协议</p><p>在第一个“保护”信息里，“锁住位”（t）的值是0，然后在每个后来的保护信息里，该位都会改变，只有可以显示信息是否丢失。总线头部用7个剩余的位来指示网络状态:</p><div class=pgc-img><img alt=「精品干货」CANopen实时总线的基本概念与知识讲解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/46f0e55566c44ceda081b4a257917c1d><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=「精品干货」CANopen实时总线的基本概念与知识讲解 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/483b71e53c0243fd8d35fd9a0ef1d924><p class=pgc-img-caption></p></div><p>四、CANopen设备</p><p><strong>CAN 总线网络中有如下几类设备：</strong></p><p><strong>(1)PLC：</strong>PLC 做 CAN 上的一个主站，起到中央控制器的作用，对整个系统的工作起安排、调度、执行各个操作等作用。作为 CAN 网络中的主站，PLC 可以访问网络中任何节点的任何可以访问的数据，并起总线监控作用，实时监控总线上各个节点的工作状态，如果出现错误并执行相应的处理程序；</p><p><strong>(2)分散式I/O：</strong>通常由电源部分、通信适配器部分、接线端子部分组成。分散式I/O 不具有程序存储和程序执行，通信适配器部分接收主站指令，按主站指令驱动 I/O ，并将 I/O 输入及故障诊断等信息返回给主站。</p><p><strong>(3)驱动器、传感器、执行机构等现场设备：</strong>即带 CAN 接口的现场设备，可由主站在线完成系统配置、参数修改、数据交换等功能。至于哪些参数可进行通信及参数格式由 CANopen 行规决定。</p><p>以下资料免费领取，请主页赶快私信小编哦！</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「精品干货」CANopen实时总线的基本概念与知识讲解 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/a81c9cac4abc475d9a174c07ae3e604b><p class=pgc-img-caption></p></div><p class=ql-align-center>想学习PLC编程了解更多自动化专业资料和下载工控软件的小伙伴可以加我微信：18603068534</p><div class=pgc-img><img alt=「精品干货」CANopen实时总线的基本概念与知识讲解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b387d31b50594443858ddfdb81efc8a8><p class=pgc-img-caption></p></div><p class=ql-align-center>可以顺便关注一下抖音哦~</p><div class=pgc-img><img alt=「精品干货」CANopen实时总线的基本概念与知识讲解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f9d8e406886e4448861b932a4579aa2c><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-justify><br></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'干货','CANopen','实时'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>