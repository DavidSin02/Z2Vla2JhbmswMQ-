<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>嵌入式C语言编程——5年程序员给你讲文件操作fopen fputs fwrite | 极客快訊</title><meta property="og:title" content="嵌入式C语言编程——5年程序员给你讲文件操作fopen fputs fwrite - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/502ca92374204ac896961ef228e42b1e"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/56c42178.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/56c42178.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/56c42178.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/56c42178.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/56c42178.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/56c42178.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/56c42178.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/56c42178.html><meta property="article:published_time" content="2020-10-29T21:13:10+08:00"><meta property="article:modified_time" content="2020-10-29T21:13:10+08:00"><meta name=Keywords content><meta name=description content="嵌入式C语言编程——5年程序员给你讲文件操作fopen fputs fwrite"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E5%AD%A6/56c42178.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>嵌入式C语言编程——5年程序员给你讲文件操作fopen fputs fwrite</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E5%AD%A6.html>科学</a></span></div><div class=post-content><p>本文主要是对C基础编程关于文件的初步讲解，后续会深入讲解C高级相关的概念（C大神可先略过）。 本人近期会陆续上传IT编程相关的资料和视频教程，可以关注一下互相交流：C C++ Java python linux ARM 嵌入式 物联网等。想学编程的朋友进入主页即可看到相关教程和资料。</p><p><strong>本文的主要内容：</strong></p><p><strong>1文件概述</strong></p><p><strong>2文件指针</strong></p><p><strong>3文件的打开与关闭</strong></p><p><strong>3.1文件的打开(fopen 函数)</strong></p><p><strong>3.2文件关闭函数（fclose 函数）</strong></p><p><strong>4文件的读写</strong></p><p><strong>4.1字符读写函数 fgetc 和 fputc</strong></p><p><strong>4.2字符串读写函数 fgets 和 fputs</strong></p><p><strong>4.3数据块读写函数 fread 和 fwtrite</strong></p><p><strong>4.4格式化读写函数 fscanf 和 fprintf</strong></p><p><strong>5文件的随机读写</strong></p><p><strong>5.1文件定位</strong></p><p><strong>5.2文件的随机读写</strong></p><p><strong>6本章小结</strong></p><h1 class=pgc-h-arrow-right>12.1 C 文件概述</h1><p><br></p><p>所谓"文件"是指一组相关数据的有序集合。这个数据集有一个名称，叫做文件名。实 际上在前面的各章中我们已经多次使用了文件，例如源程序文件、目标文件、可执行文件、 库文件 (头文件)等。</p><p>文件通常是驻留在外部介质(如磁盘等)上的，在使用时才调入内存中来。从不同的角度 可对文件作不同的分类。从用户的角度看，文件可分为普通文件和设备文件两种。</p><p>普通文件是指驻留在磁盘或其它外部介质上的一个有序数据集，可以是源文件、目标文 件、可执行程序；也可以是一组待输入处理的原始数据，或者是一组输出的结果。对于原文 件、目标文件、可执行程序可以称作程序文件，对输入输出数据可称作数据文件。</p><p>设备文件是指与主机相联的各种外部设备，如显示器、打印机、键盘等。在操作系统中，把 外部设备也看作是一个文件来进行管理，把它们的输入、输出等同于对磁盘文件的读和写。 通常把显示器定义为标准输出文件，一般情况下在屏幕上显示有关信息就是向标准输出文件输出。如前面经常使用的 printf,putchar 函数就是这类输出。</p><p>键盘通常被指定标准的输入文件，从键盘上输入就意味着从标准输入文件上输入数据。</p><p>scanf,getchar 函数就属于这类输入。</p><p>从文件编码的方式来看，文件可分为 ASCII 码文件和二进制码文件两种。ASCII 文件也称为文本文件，这种文件在磁盘中存放时每个字符对应一个字节，用于存放对应的 ASCII 码。例如，数 5678 的存储形式为：</p><div class=pgc-img><img alt="嵌入式C语言编程——5年程序员给你讲文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/502ca92374204ac896961ef228e42b1e><p class=pgc-img-caption></p></div><p>ASCII 码文件可在屏幕上按字符显示，例如源程序文件就是 ASCII 文件，用 DOS 命令 TYPE 可显示文件的内容。由于是按字符显示，因此能读懂文件内容。</p><p>二进制文件是按二进制的编码方式来存放文件的。 例如， 数 5678 的存储形式为：</p><p>00010110 00101110</p><p>只占二个字节。二进制文件虽然也可在屏幕上显示，但其内容无法读懂。C 系统在处理这些文件时，并不区分类型，都看成是字符流，按字节进行处理。</p><p>输入输出字符流的开始和结束只由程序控制而不受物理符号(如回车符)的控制。因此也把这 种文件称作"流式文件"。</p><p>本章讨论流式文件的打开、关闭、读、写、 定位等各种操作。</p><h1 class=pgc-h-arrow-right>12.2 文件指针</h1><p><br></p><p>在Ｃ语言中用一个指针变量指向一个文件，这个指针称为文件指针。通过文件指针就可对它 所指的文件进行各种操作。</p><p>定义说明文件指针的一般形式为：</p><p>FILE* 指针变量标识符；</p><p>其中 FILE 应为大写，它实际上是由系统定义的一个结构，该结构中含有文件名、文件状态和文件当前位置等信息。在编写源程序时不必关心 FILE 结构的细节。</p><p>例如：</p><p>FILE* fp；</p><p>表示 fp 是指向 FILE 结构的指针变量，通过 fp 即可找存放某个文件信息的结构变量，然后按结构变量提供的信息找到该文件，实施对文件的操作。习惯上也笼统地把 fp 称为指向一个文件的指针。</p><h1 class=pgc-h-arrow-right>12.3 文件的打开与关闭</h1><p><br></p><p>文件在进行读写操作之前要先打开，使用完毕要关闭。所谓打开文件，实际上是建立文 件的各种有关信息，并使文件指针指向该文件，以便进行其它操作。关闭文件则断开指针与 文件之间的联系，也就禁止再对该文件进行操作。</p><p>在Ｃ语言中，文件操作都是由库函数来完成的。在本章内将介绍主要的文件操作函数。</p><h1 class=pgc-h-arrow-right>12.3.1 文件的打开(fopen 函数)</h1><p><br></p><p>fopen 函数用来打开一个文件，其调用的一般形式为： 文件指针名 = fopen(文件名,使用文件方式);</p><p>其中，</p><p>"文件指针名"必须是被说明为 FILE 类型的指针变量；</p><p>"文件名"是被打开文件的文件名；</p><p>"使用文件方式"是指文件的类型和操作要求。</p><p>"文件名"是字符串常量或字符串数组。例如：</p><p>FILE *fp；</p><p>fp = ( "filename", "r" );</p><p>其意义是在当前目录下打开文件 file a，只允许进行"读"操作，并使 fp 指向该文件。又如：</p><p>FILE* fphzk</p><p>Fphzk = ( "./hzk16", "rb" )</p><p>其意义是打开当前目录下的文件 hzk16，这是一个二进制文件，只允许按二进制方式进行读操作。</p><p>使用文件的方式共有 12 种，下面给出了它们的符号和意义。</p><div class=pgc-img><img alt="嵌入式C语言编程——5年程序员给你讲文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/291e2356309642a589c5474cf8b293a0><p class=pgc-img-caption></p></div><p>对于文件使用方式有以下几点说明：</p><p>文件使用方式由 r,w,a,t,b，+六个字符拼成，各字符的含义是：</p><p>r(read): 读</p><p>w(write): 写</p><p>a(append): 追加</p><p>t(text): 文本文件，可省略不写</p><p>b(banary): 二进制文件</p><p>+: 读和写</p><p>凡用"r"打开一个文件时，该文件必须已经存在，且只能从该文件读出。</p><p>用"w"打开的文件只能向该文件写入。若打开的文件不存在，则以指定的文件名建立该文件， 若打开的文件已经存在，则将该文件删去，重建一个新文件。</p><p>若要向一个已存在的文件追加新的信息，只能用"a"方式打开文件。但此时该文件必须是存 在的，否则将会出错。</p><p>在打开一个文件时，如果出错，fopen 将返回一个空指针值 NULL。在程序中可以用这一信息来判别是否完成打开文件的工作，并作相应的处理。因此常用以下程序段打开文件：</p><p>if (( fp = fopen("./hzk16", "rb") == NULL)</p><p>{</p><p>printf("\nerror on open ./hzk16 file!"); getchar();</p><p>exit(1);</p><p>}</p><p>这段程序的意义是，如果返回的指针为空，表示不能打开 C 盘根目录下的 hzk16 文件，则给出提示信息"error on open ./hzk16 file!"，下一行的作用是等待，只有当用户从键盘敲任一键时，程序才继续执行，因此用户可利用这个等待时间阅读出错提示。敲键后执行 exit(1) 退出程序。</p><p>把一个文本文件读入内存时，要将 ASCII 码转换成二进制码，而把文件以文本方式写入磁盘时，也要把二进制码转换成 ASCII 码，因此文本文件的读写要花费较多的转换时间。对二进制文件的读写不存在这种转换。</p><p>标准输入文件(键盘)，标准输出文件(显示器)，标准出错输出(出错信息)是由系统打开的， 可直接使用。</p><h1 class=pgc-h-arrow-right>12.3.2 文件关闭函数（fclose 函数）</h1><p><br></p><p>文件一旦使用完毕，应用关闭文件函数把文件关闭，以避免文件的数据丢失等错误。</p><p>fclose 函数调用的一般形式是：</p><p>fclose(文件指针)；</p><p>例如：</p><p>fclose(fp);</p><p>正常完成关闭文件操作时，fclose 函数返回值为 0。如返回非零值则表示有错误发生。</p><h1 class=pgc-h-arrow-right>12.4 文件的读写</h1><p><br></p><p>对文件的读和写是最常用的文件操作。在Ｃ语言中提供了多种文件读写的函数： 字符读写函数 ：fgetc 和 fputc</p><p>格式化读写函数：fscanf 和 fprinf 字符串读写函数：fgets 和 fputs 数据块读写函数：freed 和 fwrite</p><p>·下面分别予以介绍。使用以上函数都要求包含头文件 stdio.h。</p><h1 class=pgc-h-arrow-right>12.4.1 字符读写函数 fgetc 和 fputc</h1><p><br></p><p>字符读写函数是以字符(字节)为单位的读写函数。 每次可从文件读出或向文件写入一个字符。</p><p>读字符函数 fgetc</p><p>fgetc 函数的功能是从指定的文件中读一个字符，函数调用的形式为： 字符变量 = fgetc(文件指针)；</p><p>例如：</p><p>char ch;</p><p>ch = fgetc(fp);</p><p>其意义是从打开的文件 fp 中读取一个字符并送入 ch 中。对于 fgetc 函数的使用有以下几点说明：</p><p>在 fgetc 函数调用中，读取的文件必须是以读或读写方式打开的。读取字符的结果也可以不向字符变量赋值，</p><p>例 如 ： fgetc(fp);</p><p>但是读出的字符不能保存。</p><p>在文件内部有一个位置指针。用来指向文件的当前读写字节。在文件打开时，该指针总是指 向文件的第一个字节。使用 fgetc 函数后，该位置指针将向后移动一个字节。 因此可连续多次使用 fgetc 函数，读取多个字符。应注意文件指针和文件内部的位置指针不是一回事。文件指针是指向整个文件的，须在程序中定义说明，只要不重新赋值，文件指针的值是不变 的。文件内部的位置指针用以指示文件内部的当前读写位置，每读写一次，该指针均向后移 动，它不需在程序中定义说明，而是由系统自动设置的。</p><p>【例 12.1】读入文件 c1.txt，在屏幕上输出。</p><div class=pgc-img><img alt="嵌入式C语言编程——5年程序员给你讲文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/404be6bcdea046cb9009446dc6affc90><p class=pgc-img-caption></p></div><p>本例程序的功能是从文件中逐个读取字符，在屏幕上显示。程序定义了文件指针 fp,以读文本文件方式打开文件"cl.txt"，并使 fp 指向该文件。如打开文件出错，给出提示并退出程序。程序第 14 行先读出一个字符，然后进入循环，只要读出的字符不是文件结束标志(每个文件末有一结束标志 EOF)就把该字符显示在屏幕上，再读入下一字符。每读一次，文件内部的位置指针向后移动一个字符，文件结束时，该指针指向 EOF。执行本程序将显示整个文件。</p><p>写字符函数 fputc</p><p>fputc 函数的功能是把一个字符写入指定的文件中，函数调用的形式为：</p><p>fputc(字符量，文件指针)；</p><p>其中，待写入的字符量可以是字符常量或变量，例如： fputc('a', fp);</p><p>其意义是把字符 a 写入 fp 所指向的文件中。对于 fputc 函数的使用也要说明几点：</p><p>被写入的文件可以用写、读写、追加方式打开，用写或读写方式打开一个已存在的文件时将 清除原有的文件内容，写入字符从文件首开始。如需保留原有文件内容，希望写入的字符以 文件末开始存放，必须以追加方式打开文件。被写入的文件若不存在，则创建该文件。</p><p>每写入一个字符，文件内部位置指针向后移动一个字节。</p><p>fputc 函数有一个返回值，如写入成功则返回写入的字符，否则返回一个 EOF。可用此来判断写入是否成功。</p><p>【例 12.2】从键盘输入一行字符，写入一个文件，再把该文件内容读出显示在屏幕上。</p><div class=pgc-img><img alt="嵌入式C语言编程——5年程序员给你讲文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/783364881d3340c78a93476599e6b0f4><p class=pgc-img-caption></p></div><p>程序中以读写文本文件方式打开文件 string。从键盘读入一个字符后进入循环，当读入字符不为回车符时，则把该字符写入文件之中，然后继续从键盘读入下一字符。每输入一个字符， 文件内部位置指针向后移动一个字节。写入完毕，该指针已指向文件末。如要把文件从头读出，须把指针移向文件头，rewind 函数用于把 fp 所指文件的内部位置指针移到文件头。</p><p>【例 12.3】把命令行参数中的前一个文件名标识的文件，复制到后一个文件名标识的文件中， 如命令行中只有一个文件名则把该文件写到标准输出文件(显示器)中。</p><div class=pgc-img><img alt="嵌入式C语言编程——5年程序员给你讲文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/702f8214c4c248e597d86361b1e278ba><p class=pgc-img-caption></p></div><p>本程序为带参的 main 函数。程序中定义了两个文件指针 fp1 和 fp2，分别指向命令行参数中给出的文件。如命令行参数中没有给出文件名，则给出提示信息。程序第 18 行表示如果只给出一个文件名，则使 fp2 指向标准输出文件(即显示器)。程序第 25 行至 28 行用循环语句逐个读出文件 1 中的字符再送到文件 2 中。再次运行时，给出了一个文件名，故输出给标准输出文件 stdout，即在显示器上显示文件内容。第三次运行，给出了二个文件名，因此把 string 中的内容读出，写入到 OK 之中。可用 DOS 命令 type 显示 OK 的内容。</p><h1 class=pgc-h-arrow-right>12.4.2 字符串读写函数 fgets 和 fputs</h1><p><br></p><p>读字符串函数 fgets</p><p>函数的功能是从指定的文件中读一个字符串到字符数组中，函数调用的形式为：</p><p>fgets(字符数组名, n, 文件指针);</p><p>其中的 n 是一个正整数。表示从文件中读出的字符串不超过 n-1 个字符。在读入的最后一个字符后加上串结束标志'\0'。</p><p>例如：</p><p>fgets(str, n, fp);</p><p>的意义是从 fp 所指的文件中读出 n-1 个字符送入字符数组 str 中。</p><p>【例 12.4】从 string 文件中读入一个含 10 个字符的字符串。</p><div class=pgc-img><img alt="嵌入式C语言编程——5年程序员给你讲文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2aac3908f8bf43d497f8280ab56aa82d><p class=pgc-img-caption></p></div><p>本例定义了一个字符数组 str 共 11 个字节，在以读文本文件方式打开文件 string 后，从中读出 10 个字符送入 str 数组，在数组最后一个单元内将加上'\0'，然后在屏幕上显示输出</p><p>str 数组。输出的十个字符正是例 13.1 程序的前十个字符。对 fgets 函数有两点说明：</p><p>在读出 n-1 个字符之前，如遇到了换行符或 EOF，则读出结束。</p><p>fgets 函数也有返回值，其返回值是字符数组的首地址。写字符串函数 fputs</p><p>fputs 函数的功能是向指定的文件写入一个字符串，其调用形式为：</p><p>fputs( 字符串, 文件指针 );</p><p>其中字符串可以是字符串常量，也可以是字符数组名，或指针变量，例如： fputs("abcd", fp);</p><p>其意义是把字符串"abcd"写入 fp 所指的文件之中。</p><p>【例 12.5】在例 13.2 中建立的文件 string 中追加一个字符串。</p><div class=pgc-img><img alt="嵌入式C语言编程——5年程序员给你讲文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/8e84582fb7ce432c91bdf79211f1f80b><p class=pgc-img-caption></p></div><p>本例要求在 string 文件末加写字符串，因此，在程序第 6 行以追加读写文本文件的方式打开文件 string。然后输入字符串，并用 fputs 函数把该串写入文件 string。在程序 15 行用 rewind 函数把文件内部位置指针移到文件首。再进入循环逐个显示当前文件中的全部内容。</p><h1 class=pgc-h-arrow-right>12.4.3 数据块读写函数 fread 和 fwtrite</h1><p><br></p><p>Ｃ语言还提供了用于整块数据的读写函数。可用来读写一组数据，如一个数组元素，一 个结构变量的值等。</p><p>读数据块函数调用的一般形式为： fread( buffer, size, count, fp ); 写数据块函数调用的一般形式为： fwrite( buffer, size, count, fp ); 其中:</p><p>buffer 是一个指针，在 fread 函数中，它表示存放输入数据的首地址。在 fwrite 函数中，它表示存放输出数据的首地址。</p><p>size 表示数据块的字节数。</p><p>count 表示要读写的数据块块数。</p><p>fp 表示文件指针。</p><p>例如：</p><p>fread( fa, 4, 5, fp );</p><p>其意义是从 fp 所指的文件中，每次读 4 个字节(一个实数)送入实数组 fa 中，连续读 5 次， 即读 5 个实数到 fa 中。</p><p>【例 12.6】从键盘输入两个学生数据，写入一个文件中，再读出这两个学生的数据显示在屏幕上。</p><div class=pgc-img><img alt="嵌入式C语言编程——5年程序员给你讲文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/b08aa1a7e6f74439900edfa33b0fabe8><p class=pgc-img-caption></p></div><p>本例程序定义了一个结构 stu,说明了两个结构数组 boya 和 boyb 以及两个结构指针变量 pp 和 qq。pp 指向 boya,qq 指向 boyb。程序第 16 行以读写方式打开二进制文件"stu_list"， 输入二个学生数据之后，写入该文件中，然后把文件内部位置指针移到文件首，读出两块学生数据后，在屏幕上显示。</p><h1 class=pgc-h-arrow-right>12.4.4 格式化读写函数 fscanf 和 fprintf</h1><p><br></p><p>fscanf 函数，fprintf 函数与前面使用的 scanf 和 printf 函数的功能相似，都是格式化读写函数。两者的区别在于 fscanf 函数和 fprintf 函数的读写对象不是键盘和显示器，而是磁盘文件。</p><p>这两个函数的调用格式为：</p><p>fscanf(文件指针, 格式字符串, 输入表列);</p><p>fprintf(文件指针, 格式字符串, 输出表列);</p><p>例如：</p><p>fscanf( fp, "%d%s", &i, s );</p><p>fprintf( fp, "%d%c", j, ch );</p><p>用 fscanf 和 fprintf 函数也可以完成例 11.6 的问题。修改后的程序如例 11.7 所示。</p><p>【例 12.7】用 fscanf 和 fprintf 函数成例 11.6 的问题。</p><div class=pgc-img><img alt="嵌入式C语言编程——5年程序员给你讲文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7969c7a3a3464386b1cff440a2b8793c><p class=pgc-img-caption></p></div><p>与例 11.6 相比，本程序中 fscanf 和 fprintf 函数每次只能读写一个结构数组元素，因此采</p><p>用了循环语句来读写全部数组元素。还要注意指针变量 pp,qq 由于循环改变了它们的值，因此在程序的 25 和 32 行分别对它们重新赋予了数组的首地址。</p><h1 class=pgc-h-arrow-right>12.5 文件的随机读写</h1><p><br></p><p>前面介绍的对文件的读写方式都是顺序读写，即读写文件只能从头开始，顺序读写各个数据。 但在实际问题中常要求只读写文件中某一指定的部分。为了解决这个问题可移动文件内部的位置指针到需要读写的位置，再进行读写，这种读写称为随机读写。</p><p>实现随机读写的关键是要按要求移动位置指针，这称为文件的定位。</p><h1 class=pgc-h-arrow-right>12.5.1 文件定位</h1><p><br></p><p>移动文件内部位置指针的函数主要有两个，即 rewind 函数和 fseek 函数。</p><p>rewind 函数前面已多次使用过，其调用形式为：</p><p>rewind(文件指针);</p><p>它的功能是把文件内部的位置指针移到文件首。 下面主要介绍 fseek 函数。</p><p>fseek 函数用来移动文件内部位置指针，其调用形式为：</p><p>fseek(文件指针, 位移量, 起始点); 其中：</p><p>"文件指针"指向被移动的文件。</p><p>"位移量"表示移动的字节数，要求位移量是 long 型数据，以便在文件长度大于 64KB 时不会出错。当用常量表示位移量时，要求加后缀"L"。</p><p>"起始点"表示从何处开始计算位移量，规定的起始点有三种：文件首，当前位置和文件尾。 其表示方法如下表。</p><div class=pgc-img><img alt="嵌入式C语言编程——5年程序员给你讲文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fe07839cc1624e6cacee3cd212bb1842><p class=pgc-img-caption></p></div><p>例如：</p><p>fseek( fp, 100L, 0 );</p><p>其意义是把位置指针移到离文件首 100 个字节处。</p><p>还要说明的是 fseek 函数一般用于二进制文件。在文本文件中由于要进行转换，故往往计算的位置会出现错误。</p><h1 class=pgc-h-arrow-right>12.5.2 文件的随机读写</h1><p><br></p><p>在移动位置指针之后，即可用前面介绍的任一种读写函数进行读写。由于一般是读写一个数 据据块，因此常用 fread 和 fwrite 函数。</p><p>下面用例题来说明文件的随机读写。</p><p>【例 12.8】在学生文件 stu_list 中读出第二个学生的数据。</p><div class=pgc-img><img alt="嵌入式C语言编程——5年程序员给你讲文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/693288afc4ce4fe29fed106740ca842f><p class=pgc-img-caption></p></div><p>本程序用随机读出的方法读出第二个学生的数据。程序中定义 boy 为 stu 类型变量，qq 为指向 boy 的指针。以读二进制文件方式打开文件，程序第 22 行移动文件位置指针。其中的</p><p>i 值为 1，表示从文件头开始，移动一个 stu 类型的长度，然后再读出的数据即为第二个学生的数据。</p><h1 class=pgc-h-arrow-right>12.6 本章小结</h1><p>1."文件"是指一组相关数据的有序集合。</p><p>2. Ｃ语言中用一个指针变量指向一个文件，称为文件指针。通过文件指针就可对它所指 的文件进行各种操作。</p><p>3. 文件在进行读写操作之前要先打开，使用完毕要关闭。</p><p>4. Ｃ语言中提供了多种文件读写的函数，参考 10.4 节。</p><p>5. 移动文件内部的位置指针到需要读写的位置，再进行读写，这种读写称为随机读写。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'语言','编程','员给'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>