<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>JTAG接口学习笔记 | 极客快訊</title><meta property="og:title" content="JTAG接口学习笔记 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/34cffc1aa8e14d70a89a6f3cb1b677cd"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/5b1b0dee.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/5b1b0dee.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/5b1b0dee.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/5b1b0dee.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/5b1b0dee.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/5b1b0dee.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/5b1b0dee.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/5b1b0dee.html><meta property="article:published_time" content="2020-11-14T20:57:22+08:00"><meta property="article:modified_time" content="2020-11-14T20:57:22+08:00"><meta name=Keywords content><meta name=description content="JTAG接口学习笔记"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E5%AD%A6/5b1b0dee.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>JTAG接口学习笔记</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E5%AD%A6.html>科学</a></span></div><div class=post-content><p></p><div class=pgc-img><img alt=JTAG接口学习笔记 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/34cffc1aa8e14d70a89a6f3cb1b677cd><p class=pgc-img-caption></p></div><p>接口名称：JTAG</p><p>英文全称：Joint Test Action Group</p><p>中文：联合测试工作组</p><p>标准号： IEEE1149.1-1990/IEEE1149.1a-1993</p><p>标准维护：IEEE</p><p>当前规范：www.IEEE.org</p><p>最新版本：IEEE1149.1-2011</p><p>生效时间：</p><p>下一版本：</p><p>说明：是一种国际标准测试协议（IEEE 1149.1兼容），主要用于芯片内部测试。标准的JTAG接口是4线：TMS、TCK、TDI、TDO，分别为模式选择、时钟、数据输入和数据输出线。是一种芯片测试技术接口。</p><p>JTAG是IEEE下属的一个工作组，该组织研究标准测试访问接口和边界扫描结构Test Access Port and Boundary-Scan Architecture。JTAG的前身是JETAG(Joint European Test Action Group欧洲联合测试行动小组) 。</p><p><strong>一、接口结构</strong></p><p><strong></strong>支持JTAG接口的芯片，其内部结构如下图所示。TAP（Test Access Port)TAP是一个通用的端口，通过TAP可以访问芯片提供的所有数据寄存器（DR）和指令寄存器（IR）。当芯片内部存在多条BSC时，需要有相应的机制来控制访问。对整个TAP的控制是通过TAP Controller来完成的。</p><p>TMS测试模式选择（Test Mode Select），通过TMS信号控制JTAG状态机的状态；</p><p>TCK为JTAG的时钟信号，TDI为数据输入信号，TDO为数据输出信号，nTRST为JTAG复位信号，复位JTAG的状态机和内部的宏单元（Macro cell）。</p><p><br></p><div class=pgc-img><img alt=JTAG接口学习笔记 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/55f5f2bb981448e783865c13876c23cf><p class=pgc-img-caption></p></div><p><br></p><div class=pgc-img><img alt=JTAG接口学习笔记 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/75fc8b3fece245d098ab8bf8acaf48f4><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>JTAG引脚定义</h3><p>TCK——测试时钟输入；</p><p>TDI——测试数据输入，数据通过TDI输入JTAG口；</p><p>TDO——测试数据输出，数据通过TDO从JTAG口输出；</p><p>TMS——测试模式选择，TMS用来设置JTAG口处于某种特定的测试模式。</p><p>可选引脚TRST——测试复位，输入引脚，低电平有效。</p><p><strong>二、工作原理</strong></p><p>JTAG的基本原理是在器件内部定义一个TAP（Test Access Port测试访问口），通</p><p>过专用的JTAG测试工具对内部节点进行测试。</p><p>² 方便芯片的故障定位,迅速准确地测试两个芯片管脚的连接是否可靠,提高测试检验效率。</p><p>² 具有J TAG接口的芯片,内置一些预先定义好的功能模式,通过边界扫描通道来使芯片处于某个特定的功能模式,以提高系统控制的灵活性和方便系统设计。</p><p>JTAG测试允许多个器件通过JTAG接口串联在一起，形成一个JTAG链，能实现对各个器件分别测试。如今，JTAG接口还常用于实现ISP（In-System Programmer，在系统编程），对FLASH等器件进行编程。</p><p>JTAG编程方式是在线编程，传统生产流程中先对芯片进行预编程然后再装到板上，简化的流程为先固定器件到电路板上，再用JTAG编程，从而大大加快工程进度。JTAG接口可对DSP芯片内部的所有部件进行编程。</p><p>JTAG内部有一个状态机，称为TAP控制器。TAP控制器的状态机通过TCK和TMS进行状态的改变，实现数据和指令的输入。</p><p><strong>边界扫描</strong></p><p>边界扫描技术的基本思想是在靠近芯片的输入输出管脚上增加一个移位寄存器单元。因为这些移位寄存器单元都分布在芯片的边界上（周围），所以被称为边界扫描寄存器（Boundary-Scan Register Cell）.边界扫描测试是通过边界扫描单元以及一些附加的测试控制逻辑实现的。 当芯片处于调试状态的时候，这些边界扫描寄存器可以将芯片和外围的输入输出隔离开来。通过这些边界扫描寄存器单元，可以实现对芯片输入输出信号的观察和控制。</p><p>在正常的运行状态下，这些边界扫描寄存器对芯片来说是透明的，所以正常的运行不会受到任何影响。</p><p>JTAG标准定义了一个串行的移位寄存器。寄存器的每一个单元分配给IC芯片的相应引脚，每一个独立的单元称为BSC（Boundary-Scan Cell）边界扫描单元。这个串联的BSC在IC内部构成JTAG回路，所有的BSR（Boundary-Scan Register）边界扫描寄存器通过JTAG测试激活，平时这些引脚保持正常的IC功能。</p><p>每个I/ O 管脚都有一个BSC ,每个BSC 有两个数据通道:一个是测试数据通道,测试数据输入TDI ( test data input ) 、测试数据输出TDO (test data output) ;另一个是正常数据通道,正常数据输入NDI ( normal data input ) 、正常数据出NDO　(normal data output) 。如图1 所示。</p><p></p><div class=pgc-img><img alt=JTAG接口学习笔记 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/21235547bf134155acd501b54da60bd5><p class=pgc-img-caption></p></div><p>在正常工作状态,输入和输出数据可以自由通过每个BSC ,正常工作数据从NDI 进,从NDO 出。在测试状态,可以选择数据流动的通道:对于输入的IC管脚,可以选择从NDI 或从TDI 输入数据;对于输出的IC 管脚,可以选择从BSC 输出数据至NDO ,也可以选择从BSC输出数据至TDO。</p><p>另外，芯片输入输出管脚上的边界扫描寄存器单元可以相互连接起来，在芯片的周围形成一个边界扫描链（Boundary-Scan Chain）。一般的芯片都会提供几条独立的边界扫描链，用来实现完整的测试功能。边界扫描链可以串行的输入和输出，通过相应的时钟信号和控制信号，就可以方便的观察和控制处在调试状态下的芯片。</p><p>图2 所示是边界扫描测试应用的示意图。为了测试两个JTAG 设备的连接,首先将JTAG 设备1某个输出测试脚的BSC 置为高或低电平,输出至NDO ,然后,让JTAG设备2 的输入测试脚来捕获（capture)从管脚输入的NDI 值,再通过测试数据通道将捕获到的数据输出至TDO ,对比测试结果,即可快速准确的判断这两脚是否连接可靠。</p><p></p><div class=pgc-img><img alt=JTAG接口学习笔记 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/fe8ff9e032694cf885ef24d8e5095a7f><p class=pgc-img-caption></p></div><p>JTAG控制器</p><p>JTAG控制器主要由三个部分组成:</p><p>l 测试端口( TAP ,test access port) 控制器</p><p>l 指令寄存器(包括指令译码器)</p><p>l 数据寄存器</p><p>TAP 控制器是边界扫描测试核心控制器。TAP 有以下5个控制信号:</p><p>n TCK: TCK 为TAP 的操作提供了一个独立的、基本的时钟信号，TAP 的所有操作都是通过这个时钟信号来驱动的。TCK 在IEEE 1149.1 标准里是强制要求的。</p><p>n TMS : TMS 信号用来控制TAP 状态机的转换。通过TMS 信号，可以控制TAP 在不同的状态间相互转换。TMS 信号在TCK 的上升沿有效。TMS 在IEEE 1149.1 标准里是强制要求的 。</p><p>n TDI : TDI 是数据输入的接口。所有要输入到特定寄存器的数据都是通过TDI 接口一位一位串行输入的（由TCK 驱动）。TDI 在IEEE 1149.1 标准里是强制要求的。</p><p>n TDO 是数据输出的接口。所有要从特定的寄存器中输出的数据都是通过TDO 接口一位一位串行输出的（由TCK 驱动）。TDO 在IEEE 1149.1 标准里是强制要求的。</p><p>n TRST: TRST可以用来对TAP Controller 进行复位（初始化）。不过这个信号接口在IEEE 1149.1标准里是可选的，并不是强制要求的。因为通过TMS 也可以对TAP 进行复位（初始化）。</p><p>TAP控制器内部有多个寄存器：JTAG控制指令寄存器、测试数据寄存器、旁路寄存器(BYPASS)、器件识别码(IDCODE)寄存器和扫描路径选择寄存器等。</p><p>指令寄存器：若执行数据寄存器边界扫描测试,则指令寄存器负责提供地址和控制信号去选择某个特定的数据寄存器;也可以通过指令寄存器执行边界扫描测试,这时,TAP 输出的SEL ECT 信号选择指令寄存器的输出去驱动TDO。</p><p>数据寄存器：边界扫描链属于数据寄存器中很重要一种。IEEE1149.1规定必须具有的两个数据寄存器是<strong>边界扫描寄存器</strong>(boundary scan register) 和<strong>旁通(bypass) 寄存器</strong>。其它的寄存器是任选的。由指令寄存器选择某个特定的数据寄存器作为边界扫描测试寄存器,当一个扫描路径选定后,其它的路径处于高阻态。<strong>边界扫描寄存器</strong>是由围绕IC 管脚的一系列的BSC 组成的,正是由它来实现测试管脚信号的输入、输出;<strong>旁通寄存器</strong>只由一个扫描寄存器位组成,当选择了旁通寄存器, TDI 和TDO 之间只有一位寄存器,实际上没有执行边界扫描测试。旁通寄存器的作用是为了缩短扫描路径而对不需要进行测试的IC 进行旁通。</p><p></p><div class=pgc-img><img alt=JTAG接口学习笔记 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c8e08d9bcf8b436ba71389421ad5c5ae><p class=pgc-img-caption></p></div><p>如上所述,TAP 控制器是边界扫描测试在TCK和TMS 的控制下,可以选择使用指令寄存器扫描或数据寄存器扫描,以及控制边界扫描测试的各个状态。TMS 和TDI在TCK 上升沿被采样, TDO 在TCK 下降沿变化。</p><p>TAP控制状态机</p><p>TAP 控制器的状态机共有16种状态，但只有6 个稳定状态:<strong>测试逻辑复位( test-logic-reset ) 、测试/ 等待(run-test/idle) 、数据寄存器移位( shift-DR) 、数据寄存器移位暂停(pause-DR) 、指令寄存器移位( shift-IR) 、指令寄存器移位暂停(pause-IR) </strong>。其它状态都不是稳态,而只是暂态.</p><p>在上电或IC 的正常运行时,必须使TMS 在最少持续5个TCK 保持为高电平,则TAP 进入测试逻辑复位态。这时,TAP 发出复位信号使所有的测试逻辑不影响元件的正常运行。若需要进行边界扫描测试,可以在TMS 与TCK 的配合控制下,退出复位,进入边界扫描测试需要的各个状态。</p><p></p><div class=pgc-img><img alt=JTAG接口学习笔记 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/53135e965d4e4b5da6f554451816c17c><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=JTAG接口学习笔记 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7e4e5eaa9abc4ef0a3cd3f8acc3b8f20><p class=pgc-img-caption></p></div><p>指令寄存器访问流程：</p><p>u 系统上电，TAP Controller进入Test-Logic Reset状态。</p><p>u Run-Test/Idle->Select-DR-Scan->Select-IR-Scan->Capture-IR->Shift-IR->Exit1-IR ->Update-IR，最后回到Run-Test/Idle状态。</p><p>u 在Capture-IR状态，特定的逻辑序列被加载到指令寄存器中；然后进入到Shift-IR状态。</p><p>数据寄存器访问流程：</p><p>u 当前可以访问的数据寄存器由指令寄存器中的当前指令决定。</p><p>u 以Run-Test/Idle为起点，依次进入Select-DR-Scan->Capture-DR->Shift-DR->Exit1-DR->Update-DR，最后回到Run-Test/Idle状态。</p><p>n JTAG扫描链工作原理：</p><p><strong>每一个扫描单元的内部由两个D触发器和两个多路选择器组成。</strong></p><p><br></p><div class=pgc-img><img alt=JTAG接口学习笔记 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f291d1f6272447b9a970b99779e56b4e><p class=pgc-img-caption></p></div><p><strong>在正常状态下即挂起，BSR对芯片是透明的，不影响芯片的正常运行。</strong></p><p></p><div class=pgc-img><img alt=JTAG接口学习笔记 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1af73b20e4e2499dbaaa507c6961bf5e><p class=pgc-img-caption></p></div><p>当芯片处于调试状态时，BSR将芯片与外围隔离。通过BSR可实现对芯片管脚的观察与控制。</p><p>对于输入管脚，可通过对BSR的操作，将信号（数据）加载至管脚。</p><p>对于输出管脚，可通过BSR将管脚上的输出信号“捕获”（Capture)。</p><p></p><div class=pgc-img><img alt=JTAG接口学习笔记 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d8c1b419bc4048a58cfc40aef526b8d1><p class=pgc-img-caption></p></div><p>BSR可以相互连接起来，在芯片周围形成一个边界扫描链。（Boundary-Scan Chain）</p><p>一般芯片会提供多条独立的BSC，用于实现完整的测试功能。BSC可以串行的输入输出，再配合时钟及控制信号，可观察与控制调试状态下的芯片。JTAG扫描链一共有四种操作：挂起、捕获、移位和更新。</p><p>BSDL：Boundary Scan Description Language边界扫描描述语言</p><p></p><p><strong>三、应用设计</strong></p><p>JTAG 接口的连接有三种标准，即10针、 14 针接口和 20 针接口，其定义分别如下所示。</p><p><br></p><div class=pgc-img><img alt=JTAG接口学习笔记 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c71ab290c1c3459893c15246bf425a21><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>14针JTAG接口</h3><p>1 、 13 　 VCC 接电源</p><p>2 、 4 、 6 、 8 、 10 、 14 　 GND 接地</p><p>3 　nTRST 　测试系统复位信号</p><p>5 　TDI 　 测试数据串行输入</p><p>7 　TMS 　测试模式选择</p><p>9 　TCK 　测试时钟</p><p>11　TDO 　 测试数据串行输出</p><p>12　NC 　 未连接</p><h3 class=pgc-h-arrow-right>20针JTAG接口</h3><p>1 VTref 　 目标板参考电压，接电源</p><p>2 VCC 　 接电源</p><p>3 nTRST 　 测试系统复位信号</p><p>4、6、8、10、12、14、16、18、20 　GND 接地</p><p>5 TDI 　 测试数据串行输入</p><p>7 TMS 　 测试模式选择</p><p>9 TCK 　 测试时钟</p><p>11 RTCK 　测试时钟返回信号</p><p>13 TDO 　 测试数据串行输出</p><p>15 nRESET 　 目标系统复位信号</p><p>17 、 19 NC 　未连接</p><h3 class=pgc-h-arrow-right>10针JTAG接口</h3><p>1. TCK</p><p>2. NC</p><p>3. TDO</p><p>4. Vtref</p><p>5. TMS</p><p>6. nSRST</p><p>7. NC</p><p>8. nTRST</p><p>9. TDI</p><p>10.GND</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'JTAG','学习','笔记'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>