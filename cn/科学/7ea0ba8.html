<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>另辟捷径，解决变态看门狗需求 | 极客快訊</title><meta property="og:title" content="另辟捷径，解决变态看门狗需求 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="http://p1.pstatp.com/large/pgc-image/f3730045780142c59a0ebaed1ec765e8"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/7ea0ba8.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/7ea0ba8.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/7ea0ba8.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/7ea0ba8.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/7ea0ba8.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/7ea0ba8.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/7ea0ba8.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/7ea0ba8.html><meta property="article:published_time" content="2020-10-29T20:48:46+08:00"><meta property="article:modified_time" content="2020-10-29T20:48:46+08:00"><meta name=Keywords content><meta name=description content="另辟捷径，解决变态看门狗需求"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E5%AD%A6/7ea0ba8.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>另辟捷径，解决变态看门狗需求</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E5%AD%A6.html>科学</a></span></div><div class=post-content><p><strong>导语：</strong></p><p>作为一个电子行业的从业人员，相信各位对看门狗的重要性已经非常清楚了，看门狗主要用于监控系统的可靠性，一旦发现系统的严重故障，设计者可以根据严重等级，轻则可以复位系统，重则可以重新断电重启。看门狗又分为硬件看门狗和软件看门狗，两者最主要的区别就是硬件看门狗一上电就运行，只要运行起来就停不下来；软件看门狗可以很容易通过寄存器配置启动和停止。无论是硬件还是软件看门狗，都需要软件在定时器结束前进行喂狗，否则看门狗就会复位输出。就是因为这个特性，大家都相信硬件的比软件的可靠，可靠性要求高的都会增加硬件的看门狗。</p><h1 class=pgc-h-arrow-right>长时看门狗应用场合</h1><p>硬件看门狗在大部分的系统应用，都不会有问题，但是以下的两种情况，相信很多设计者都遇到并且崩溃过：</p><p>1；设备使用了较复杂的系统，如Linux、安卓，启动时间较长，或者遇到烧录升级，此时所需时间较长，但这不是异常情况，但是硬件看门狗上电时候已经启动了，并且停不下来，启动升级烧录化几分钟时间太正常了，几分钟内软件都无法喂狗，一般的硬件看门狗（一般Timeout时间都是20S以内）早就喂狗超时 了，设备被复位或者断电，进入死循环。</p><p>2；在功耗要求非常低的场合，并且又需要可靠性非常高的场合，例如农业环境温度检测，只需要2小时检测一次就足够了，其他时间都需要待机，2小时到了才能唤醒工作。为了低功耗，此时就要求看门狗2小时喂狗一次。目前大部分的看门狗的喂狗时间都是20s以内，普通看门狗根本无法满足需求。</p><p><br></p><p>上述的特殊需求，都是要求看门狗的喂狗时间Timeout较长，最好是能够灵活配置。</p><p><br></p><h1 class=pgc-h-arrow-right>为何长时看门狗难实现</h1><p>相信很多工程师都有这样的疑惑，较长时间的看门狗特别难选，厂家和型号特别少，并且超过20S的看门狗特别贵，例如下图ADI 公司的超长喂狗时间的看门狗价格大约3美元，将近21元人民币，和CPU一样的价格了，这个是如何也接受不了的。</p><div class=pgc-img><img alt=另辟捷径，解决变态看门狗需求 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/f3730045780142c59a0ebaed1ec765e8><p class=pgc-img-caption>图1.ADI公司的超长喂狗时间看门狗</p></div><p>看门狗喂狗时间很难做长，是由于内部的机理决定的，如下图是Max630X 系列的看门狗芯片，内部主要依赖RC充放电和比较器进行喂狗，RC充电达到比较器的阈值后，定时器就会溢出，芯片复位信号就会翻转。所以，喂狗时间才长短主要是由外部的电容C1决定的。芯片内部的电阻R1是确定的，C1越大，喂狗时间就越长，有些小伙伴就懂歪脑筋了，需要更长的时间，把C1无限做大就可以了。但是还有另一个问题：漏电流。所以，Max603x 芯片的规格书中规定，配置电容必须是低漏电流的陶瓷电容（＜10nA）。并且随着电容的容量越来越大，漏电流越来越大，所以max603x规格书中规定，最大电容只能到1uF，最长的Timeout时间是500x Tw，再长的时间，就无法设置了。</p><div class=pgc-img><img alt=另辟捷径，解决变态看门狗需求 onerror=errorimg.call(this); src=http://p9.pstatp.com/large/pgc-image/12b10cd1212b4312b4849cb03350b7b4><p class=pgc-img-caption>图2.常规看门狗喂狗时间配置示意图</p></div><div class=pgc-img><img alt=另辟捷径，解决变态看门狗需求 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/7a8e824c9a6541a98afeaae68f450480><p class=pgc-img-caption>图3 .各种介质陶瓷电容的温度／漏电流特性对比</p></div><p><br></p><h1 class=pgc-h-arrow-right>如何另辟捷径</h1><p>由于上述的看门狗的可调节的缺陷机理，TI公司另辟捷径，用另一种办法实现看门狗的可调节喂狗时间。我们看其实现的原理，TI公司的TPL5010定位是一个低功耗唤醒定时器，工作电流低至35nA，基本是和很多的电容的漏电流差不多，他的看门狗功能其实是附加的功能，所以甚至在TI的看门狗选型系列里面都找不到他，但是把他当成可配置喂狗时间的看门狗来用。</p><p><br></p><p>设备上电时，TPL5010的Delay引脚会一次性读取外置的电阻Rext的阻值，然后根据阻值配置唤醒时间的周期Tip，该唤醒时间Tip也就是喂狗时间Timeout的周期，TPL5010以Tip的周期向cpu发送周期方波信号wake，CPU必须在小于Tip 时间内回复Dnoe信号，如果没有在小于Tip周期内回复Done信号，则TPL5010就会对外输出复位信号，复位整个系统，同时实现看门狗和低功耗定时唤醒功能。如果用户只需要看门狗的功能，则Wake信号不连接也可以，只需要cpu定期输出Dnoe信号，定时清零看门狗定时器即可。TPL5010的喂狗时间可以从0.1s到7200S 之间可配置，基本可以满足所有的应用场合。</p><div class=pgc-img><img alt=另辟捷径，解决变态看门狗需求 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/2c0602040a2741fcb52fcfadeef1b623><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=另辟捷径，解决变态看门狗需求 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/131b7de5bb7b4081af732d2c0b6e2c07><p class=pgc-img-caption>图4 .TPL同时具备定时唤醒和喂狗时间可配置功能</p></div><div class=pgc-img><img alt=另辟捷径，解决变态看门狗需求 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/12bf21c059f54a49bcf9a3709b1de4cd><p class=pgc-img-caption>图5 .TPL使用电阻配置喂狗时间，可避免电容的漏电流问题</p></div><div class=pgc-img><img alt=另辟捷径，解决变态看门狗需求 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/43214400ab184ad4a600d6c7241e022e><p class=pgc-img-caption>图6.TPL 看门狗功能时序图</p></div><p>不过TI的芯片功能也是很有限的，那么是否有更加强大的看门狗芯片方案吗?</p><p>前方高能，请避让</p><p><br></p><h1 class=pgc-h-arrow-right>使用Dialog Greenpak的芯片实现喂狗时间可编程的看门狗方案</h1><p><strong>最近创易栈正在推出的Greenpak芯片做看门狗也有意想不到的强大功能。</strong><br></p><p>喂狗时间通过IIC编程到GreenPak芯片里面，按照编程时间来，使用外部中断先唤醒深度睡眠的MCU，在规定时间（可以设置）内如果MCU没有喂狗，那么GreenPak芯片将对MCU做复位操作。</p><p>GreenPak芯片带IIC的芯片有：</p><div class=pgc-img><img alt=另辟捷径，解决变态看门狗需求 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/008490bfd08a4a99a62ee0a83fd7aaba><p class=pgc-img-caption></p></div><p>Greenpak设计基本电路设计包括具有可编程睡眠持续时间的唤醒计时器和手动唤醒按钮。内部Greenpak设计示意图如图所示。</p><div class=pgc-img><img alt=另辟捷径，解决变态看门狗需求 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/528edcb7a94946d4beb54cdb430423db><p class=pgc-img-caption></p></div><p>唤醒/休眠状态存储在一个可重置的dff块中，因此睡眠周期可以被中断。通过外部信号（按钮）。dff状态等于npoff（关机）信号：1=唤醒/打开电源，0=休眠/关闭电源。唤醒计时器本身由一个边缘触发延迟模式下的CNT/DLY阻塞。npoff信号的下降沿延迟了一段睡眠时间，因此计时器在设备进入睡眠状态时启动。当计时器过期时，它将设置dff/npoff并唤醒设备的dff低输入。清醒期不是定时的，所以睡眠期可以从睡眠的下降沿开始输入。下降沿反转以重置DFF并切换到休眠状态。极性信号可根据MCU进行调整。两个额外的逻辑门启用备用睡眠触发器（GPIO引脚或I2C消息）和唤醒触发器（外部或计时器）。一个额外的DFF捕获唤醒原因：0=外部唤醒，1=计时器唤醒。</p><p><br></p><p><strong>主要特点：</strong></p><p>该设计允许使用睡眠pin或i2c消息启动睡眠周期</p><p>睡眠时间可通过I2C消息编程</p><p>按下按钮可启用手动唤醒</p><p>按钮输入被取消</p><p>去噪时间常数也可通过I2C编程</p><p>单片机可通过I2C读取当前睡眠周期值</p><p>内部振荡器只在睡眠期间运行，因此在清醒期间不产生电流</p><p>存储上次唤醒事件的原因并在pin上发出信号</p><p>MCU可以读取GPIO引脚或I2C以上的上一次唤醒原因</p><p><br></p><p>基本的设计是用SLG46537V设计的，虽然设计非常简单，但是很适合任何启用I2C的Greenpak。如果我们去掉I2C的特性，这个设计可以适用于任何非i2cGreenpak仍然提供唤醒计时器和强制唤醒功能。<br></p><p><strong>注意</strong>，在所提出的设计中，当外部唤醒时，电路将忽略休眠命令处于活动状态，因此按住按钮将阻止MCU进入睡眠状态。然而，这不会阻止它进入其他睡眠模式，如深度睡眠或浅睡眠。一旦松开按钮，再次启用睡眠模式。</p><p><br></p><p>可选的设计修改和优化对于固定的睡眠时间和没有人工强制唤醒的情况，电路设计可以简化。下图显示了封装在微型SLG46108V中的简单唤醒计时器。注意，即使尽管SLG46108V是最小的Greenpak，但仍然有足够的空闲块可以实现带去噪滤波器的外部唤醒。</p><div class=pgc-img><img alt=另辟捷径，解决变态看门狗需求 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/a1d84a173c88432e8629ec8b7beb4ff8><p class=pgc-img-caption></p></div><p>如果GPIO管脚是高级的，并且您的电路设计已经使用I2C与其他外围设备，可以避免睡眠引脚使用I2C启动睡眠周期。只是移除休眠输入并将定时器输入连接到I2C块。注意I2C已启用greenpaks对于cnt/dly块有一个“一次性”选项，因此不需要dff，并且整个唤醒定时器可以在两个模块中实现，包括I2C可编程睡眠持续时间。演示电路在接收到睡眠输入后立即切断单片机的电源。如果应用程序需要引入一些延迟（例如，让调试消息通过通过串行调试通道），可以通过对睡眠输入应用延迟块轻松完成。所提出的唤醒电路可应用于除esp8266外的其它无线模块/mcu。例如粒子光子或覆盆子π，很少或没有修改。用于MCU或模块在没有断电输入选项的情况下，可以使用集成了PFET开关可用于SLG46116V/117V或SLG46125V。</p><p><br></p><p><strong>该电路软件性能：</strong></p><p>主要的性能问题与睡眠时间和功耗有关，</p><p>不同Greenpak零件如表2所示。</p><p>没有说明最小睡眠时间，因为它在所有Greenpak的微秒范围内在实际应用中，这种短暂的睡眠时间是不可能的。如果需要的话，使用2MHz赫振荡器（而不是25KHz或RC低频振荡器）可以使睡眠时间更短。</p><p><br></p><p>对于任何一个被选中的Greenpak。只有表2中的第一行给出了这个应用注中演示电路的性能，基于SLG46537V。其他行显示基于其他行的类似电路的估计性能。表中的数据适用于类似于本应用程序中演示电路的唤醒电路设计注意，只包含唤醒计时器和几个逻辑门。如果剩余的块被用来增加其他功能，电流消耗可能会增加，这取决于设计。绿色领域强调的是性能标志，在这个特定领域超过了其他部分。</p><div class=pgc-img><img alt=另辟捷径，解决变态看门狗需求 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/b07b8f1dc7ec48ceb2c1a681e1e8ecdf><p class=pgc-img-caption></p></div><p>从上表可以清楚地看出，最大睡眠时间可以被认为是无限的。因此，只有在应用程序使用时，才应考虑最大睡眠时间。多个CNT/DLY块用于其他用途。注意，在演示电路中，只有一个cnt/dly块是用于计时器，在这种情况下的最大睡眠时间约为二十分钟。到增加最大睡眠持续时间，级联另一个CNT/DY块并更新超深度睡眠（睡眠时间）；相应的功能。性能权衡是可能的。例如，SLG46140V的公差、差±20%使用低频振荡器时，电流消耗非常低，为0.7μA。切换到25khz振荡器将提高公差，但电流消耗将上升至~5μa。</p><h1 class=pgc-h-arrow-right>总结</h1><p>作为系统可靠性的关键器件，看门狗是必备的器件之一，DIALOG GREENPAK的出现弥补了传统硬件看门狗的以下几个缺点：</p><p>1) 喂狗时间固定：绝大部分的2元以内的看门狗，喂狗时间都是固定的，使用起来非常不方便，一旦遇到标题一的情形就无能无力了。<br></p><p>2) 可配置时间看门狗价格贵：传统的看门狗通过电容RC充电延迟了配置喂狗时间，电容漏电流大，喂狗时间无法做到很长，并且长时间（100S以上）喂狗时间的看门狗价格都在4元以上。<br></p><p>3) 没有定时唤醒功能：大部分的看门狗芯片都只干看门狗的活，部分会自带电压检测功能，而GREENPAK芯片或者本文的TPL5010的强大可编程性能，更适合低功耗待机的场合。<br></p><p><strong>本文提供的两种看门狗的捷径方案 你更喜欢哪种呢？</strong></p><p><br></p><div class=pgc-img><img alt=另辟捷径，解决变态看门狗需求 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/34aec1f27d9c4471a25c8395722ba917><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=另辟捷径，解决变态看门狗需求 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/e766b4f815cf4c8381708c74943f7a6f><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'另辟','捷径','解决'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>