<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>一文搞懂仿射变换的原理和应用 | 极客快訊</title><meta property="og:title" content="一文搞懂仿射变换的原理和应用 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/4e40309d90da4b1b98e16e52e7bbcd6a"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/b0e59288.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/b0e59288.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/b0e59288.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/b0e59288.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/b0e59288.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/b0e59288.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/b0e59288.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/b0e59288.html><meta property="article:published_time" content="2020-11-14T20:52:19+08:00"><meta property="article:modified_time" content="2020-11-14T20:52:19+08:00"><meta name=Keywords content><meta name=description content="一文搞懂仿射变换的原理和应用"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E5%AD%A6/b0e59288.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一文搞懂仿射变换的原理和应用</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E5%AD%A6.html>科学</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>导读</h1><p>在图像处理中，我们经常需要对图像进行各种操作如<strong>平移</strong>、<strong>缩放</strong>、<strong>旋转</strong>、<strong>翻转</strong>等，这些操作都属于图像的<strong>仿射变换</strong>，我们通过一个<strong>变换矩阵</strong>就能很容易的实现。本篇文章详细的介绍了各种操作的实现原理，以及代码的实现和使用</p><h1 class=pgc-h-arrow-right>仿射变换</h1><p><strong>仿射变换</strong>也称<strong>仿射投影</strong>，是指几何中，<strong>对一个向量空间进行线性变换并接上一个平移，变换为另一个向量空间</strong>。所以，仿射变换其实也就是在讲如何来进行<strong>两个向量空间的变换</strong></p><p>假设有一个向量空间k：</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/4e40309d90da4b1b98e16e52e7bbcd6a><p class=pgc-img-caption>向量空间k</p></div><p>和另一个向量空间j：</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/18cdd69eaf6245c59969296afaec097c><p class=pgc-img-caption>向量空间j</p></div><p>如果我们想要将向量空间由k变为j，可以通过下面的公式来实现：</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/88e7da8685f7479f845c8ecd11587c73><p class=pgc-img-caption>向量空间变换</p></div><p>将上式进行拆分可得</p><p><br></p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1ed83a6a6e5d41939665bcfee720c746><p class=pgc-img-caption>向量空间座标变换</p></div><p>我们再将上式转换为矩阵的乘法</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d5412b6ef7d040d698af06cfa3f323ef><p class=pgc-img-caption>向量空间变换的矩阵表示</p></div><p>上式表明通过一个<strong>两行三列的矩阵M</strong>就可以<strong>实现两个向量空间之间的转换</strong>，在进行仿射变换的时候我们也只需要一个矩阵M就可以实现图像的<strong>平移</strong>、<strong>缩放</strong>、<strong>旋转</strong>和<strong>翻转</strong>变换。</p><p>接下来，会先介绍原理然后利用OpenCV来实现相应的例子，这里主要利用OpenCV的<strong>warpAffine</strong>函数来实现仿射变换</p><p><strong>warpAffine</strong>函数参数：</p><ul><li>src：输入的图像数组</li><li>M：仿射变换矩阵</li><li>dsize：变换后图像的大小</li><li>flags：使用的插值算法</li><li>borderValue：边界的填充值</li></ul><h1 class=pgc-h-arrow-right>图像平移</h1><p>在平面座标系有点P(x,y)和点P′(x′,y′)，如果我们想要将P点移动到P′通过下面的变换就可以实现</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7f628aeafb2f4d9ba65410c002d05b9f><p class=pgc-img-caption>座标平移</p></div><p>其中<strong>Δx</strong>和<strong>Δy</strong>就是<strong>x方向上和y方向上的偏移量</strong>，我们将其转换为矩阵的形式上面的矩阵MM就是仿射变换的平移参数，接下来我们利用OpenCV中的warpAffine函数来实现</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/be5b3cf6cbbb4715a74536f0a769508e><p class=pgc-img-caption>座标平移的矩阵形式</p></div><p>上面的<strong>矩阵M</strong>就是<strong>仿射变换的平移参数</strong>，接下来我们利用OpenCV中的<strong>warpAffine</strong>函数来实现图像的平移</p><p><br></p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f22b80d425434a638eb513ca3edcdf90><p class=pgc-img-caption>仿射变换实现图像平移</p></div><p><br></p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/29ae80b8741847f1bc772d881fbedae1><p class=pgc-img-caption>图像平移</p></div><h1 class=pgc-h-arrow-right>图像翻转</h1><p>有时候我们我们需要对图像进行<strong>水平翻转</strong>、<strong>垂直翻转</strong>、<strong>镜像翻转</strong>(同时进行水平和垂直翻转)，想要实现这个功能并不难，我们可以通过<strong>opencv内置的flip</strong>方法很容易实现，还可以通过<strong>numpy的索引</strong>来实现，当然也可以通过<strong>仿射变换矩阵</strong>来实现这个功能</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6c30efe1fba145eb9bf14e2e9c893a93><p class=pgc-img-caption></p></div><p>上图中的<strong>A</strong>、<strong>B</strong>、<strong>C</strong>、<strong>D</strong>表示图像的四个顶点，如果我们需要对图像进行水平翻转，那么我们就需要将A点和B点进行交换，C点和D点进行交换，<strong>沿着x轴的中线进行对称交换位置</strong>，通过下面的式子可以实现水平翻转</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7f2b34a42f37492ca9a70d390f4e1613><p class=pgc-img-caption>水平翻转</p></div><p>上式中的<strong>w</strong>表示<strong>图像的宽</strong>，同理可得<strong>垂直翻转</strong>的实现公式</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7a4938c8f3574f5d846663b105b2737c><p class=pgc-img-caption>垂直翻转</p></div><p>上式中的<strong>h</strong>表示的是<strong>图像的高</strong></p><ul><li>利用变换矩阵翻转图像</li></ul><p>水平翻转的变换矩阵M：</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6693645b2e744148aa9d2c3ef4506757><p class=pgc-img-caption>仿射变换水平翻转矩阵</p></div><p>垂直翻转的变换矩阵M：</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f5dc6314c7cf47e78c253e86d657a107><p class=pgc-img-caption>仿射变换垂直翻转矩阵</p></div><p>镜像翻转的变换矩阵M：</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/436207ec3c024f6a8a8584681e899c95><p class=pgc-img-caption>仿射变换镜像翻转矩阵</p></div><p><br></p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f1585de79fdf427fa77a1817d38053d6><p class=pgc-img-caption>仿射变换实现图像的镜像翻转</p></div><p><br></p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e8eecba1e9e844219a4dbe01912365ec><p class=pgc-img-caption>镜像翻转</p></div><ul><li>OpenCV的flip函数翻转图像</li></ul><p>flip函数参数：</p><ul><li>src：输入的图像数组</li><li>flipCode：图像翻转参数，1表示水平翻转，0表示垂直翻转，-1表示镜像翻转</li></ul><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/32e60d3b91f142df999db1a677ec7d41><p class=pgc-img-caption>flip函数实现图像翻转</p></div><ul><li>numpy的索引翻转图像</li></ul><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cd0b5a9733834106a16d4fe465debd48><p class=pgc-img-caption>numpy通过索引数组实现图像翻转</p></div><h1 class=pgc-h-arrow-right>图像缩放</h1><p>如果我们想要对座标系的<strong>P</strong>点进行缩放操作，通过下面的公式就可以实现</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1ae8b7a635fc49598e68ee33df412d66><p class=pgc-img-caption>图像缩放</p></div><p>通过在x和y前面添加一个<strong>缩放系数</strong>即可，同样我们将其转换为矩阵形式</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/eb92cda0cb754173973fee53cae01fdb><p class=pgc-img-caption>图像缩放的矩阵形式</p></div><p>通过上面的<strong>矩阵M</strong>我们就可以实现对图片的缩放</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e88809c61d58452ebc069c8b2714a508><p class=pgc-img-caption>仿射变换实现图像缩放</p></div><p><br></p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a8c575cbd8874b60a1e1d496556b9cea><p class=pgc-img-caption>仿射变换实现图像缩放</p></div><p>这里使用<strong>仿射变换实现的图片缩放</strong>其实和<strong>resize函数</strong>的效果是一样的，缩放时选择的<strong>插值函数</strong>不同最终效果会有所偏差</p><h1 class=pgc-h-arrow-right>图像旋转</h1><ul><li>围绕原点旋转</li></ul><p>我们先来看看一个二维平面上的点在围绕原点是如何旋转的</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2469c3ec0913460893abc6e2e96d05aa><p class=pgc-img-caption>任意一点围绕原点旋转</p></div><p>上图中<strong>点v</strong>在<strong>围绕原点旋转θ度</strong>之后得到了<strong>点v′</strong>，我们将座标点用极座标的形式来表示可以得到<strong>v(rcosϕ,rsinϕ)</strong>，所以<strong>v′(rcos(θ+ϕ),rsin(θ+ϕ))</strong>利用<strong>正弦和余弦展开式</strong>将其展开可得，对于v点来说：</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7b49187f711f4408acfd7e81f726606a><p class=pgc-img-caption>v点座标展开式</p></div><p>对于v′来说：</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7bfa34ccdebc4ac0a516146a152b1f57><p class=pgc-img-caption>v'点座标展开式</p></div><p>然后我们再将x和y代入上式可得</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/cb51ceb5efd54c4d92314d8c8bd607c5><p class=pgc-img-caption>变换后的x和y的座标</p></div><p>然后再<strong>将上式用矩阵M表示</strong>，可得</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7126920277f44e29a509f687c22594c9><p class=pgc-img-caption>旋转后坐标的矩阵表示形式</p></div><p><strong class=highlight-text>特别注意</strong>：我们在建立直角座标系的时候是以<strong>左下角为原点</strong>建立的，然而对于图像而言是以<strong>左上角为原点</strong>建立的，所以我们需要对角度θ进行取反，结合三角函数的特性，M矩阵的表达式如下</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6e203b1517944a2db99083f4b8129b48><p class=pgc-img-caption>围绕原点旋转的仿射变换矩阵</p></div><p>还需要注意的是这里的角度都是<strong>弧度制</strong>，所以我们在使用的时候还需要对其进行转换，转换代码如下</p><pre><code>#将角度转换为弧度制radian_theta = theta/180 * np.pi#np.pi指的是π</code></pre><p>将图片围绕原点进行逆时针旋转θ度的代码如下</p><p><br></p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/64a4fc50072d4a7fb071ffeb6bc2099a><p class=pgc-img-caption>将图像围绕原点旋转</p></div><ul><li>围绕任意点旋转</li></ul><p>如果我们想<strong>围绕任意座标点旋转</strong>呢？其实也并不难，下图的<strong>v点在围绕c点(a,b)旋转90度得到v′</strong>。其实我们可以将其等价于，<strong>先将V点平移到V1点，然后再将V1点围绕原点旋转90度得到V2点，最后再将V2点沿着V点平移的反方向平移相同长度，最终得到V'</strong>。这样我们就<strong>将围绕任意座标点旋转的问题转换成了围绕原点旋转的问题</strong></p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a74026b076dd44b7aa16a21b000cd563><p class=pgc-img-caption></p></div><p>我们来回顾一下，围绕原点旋转座标的变换公式</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/416e319932a744538ee743965f56e18f><p class=pgc-img-caption>围绕原点旋转</p></div><p>在围绕原点旋转变换公式的基础上，我们将其改进为围绕<strong>任意点c(a,b)</strong>旋转，我们现在原来的座标进行平移，得到变换后的座标，最后再沿着之前平移的反方向进行平移，就得到围绕任意点旋转的变换公式</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/25f89a7cdea841f3a051fc35aea5c660><p class=pgc-img-caption>围绕任意点旋转</p></div><p>将其展开可得</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/726b8a5a4985449690669426ad29e10a><p class=pgc-img-caption>围绕任意点旋转的展开式</p></div><p>将上式用矩阵M表示：</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/9e713e45fe0b49c299fe448e5d66f00c><p class=pgc-img-caption>矩阵形式表示围绕点c进行旋转</p></div><p>上式中的<strong>c(a,b)</strong>表示<strong>旋转中心</strong>，因为<strong>座标系问题</strong>需要对θ进行取反，最终M矩阵的表达式如下</p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/34c2ac6131ac43859e61b0efe4ec74ef><p class=pgc-img-caption>旋转矩阵</p></div><p><br></p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/49ad25f8d69d4f8e9010394d67b90fbd><p class=pgc-img-caption>围绕图像中心旋转图像</p></div><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8f500a51dbda4f95a35955959df10564><p class=pgc-img-caption>围绕图像中心旋转图像</p></div><p>细心的同学也许已经发现了，上图中<strong>围绕图像中心旋转后的图片部分被裁剪掉了</strong>，如果我们想让旋转之后的图片仍然是完整，应该如何修改呢？</p><p><br></p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4fb0ed975b00491b8587260b0cc46ef8><p class=pgc-img-caption>围绕图像中心旋转后仍保持完整</p></div><p><br></p><div class=pgc-img><img alt=一文搞懂仿射变换的原理和应用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c876d5ad7d6f43c2b1a42924365334b2><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'搞懂','变换','应用'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>