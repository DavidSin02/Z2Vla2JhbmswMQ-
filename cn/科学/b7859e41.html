<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>CCNA最实用的复习知识点（6） | 极客快訊</title><meta property="og:title" content="CCNA最实用的复习知识点（6） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/4aedcb4ad4a94fed844d5601aace1e74"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/b7859e41.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/b7859e41.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/b7859e41.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/b7859e41.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/b7859e41.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/b7859e41.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/b7859e41.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/b7859e41.html><meta property="article:published_time" content="2020-11-14T20:50:25+08:00"><meta property="article:modified_time" content="2020-11-14T20:50:25+08:00"><meta name=Keywords content><meta name=description content="CCNA最实用的复习知识点（6）"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E5%AD%A6/b7859e41.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>CCNA最实用的复习知识点（6）</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E5%AD%A6.html>科学</a></span></div><div class=post-content><p><strong>第2层交换和生成树协议（STP）</strong></p><p>路由协议可以防止在网络层发生网络环路。然而，如果在交换机间有冗余的物理链路，路由协议将不能防止在数据链路层发生的环路。正是由于这个原因，才开发了生成树协议STP（Spanning Tree Protocol），它可以防止在第2层交换式的互联网络中发生环路。</p><p><br></p><p>1、交换式服务</p><p>跟网桥使用软件来创建和管理过滤表不一样，交换机使用专用集成电路（ASIC：专用集成电路Application Specific Integrated Circuit）来创建并维护其过滤表。但把第2层交换机视为多端口网桥仍然是可以的，因为它们的用途是一样的，用来分隔冲突域。交换机和网桥转发数据的速度比路由器快一些，因为它们不花时间查看网络层报头信息。相反，在决定是转发帧或是丢弃它之前，它们查看帧的硬件地址，它们没有对数据包做任何修改，只读取封装了数据包的帧，与路由相比，这就使得交换过程非常快，而且不容易出错。</p><p><br></p><p>第2层交换提供的性能如下：</p><p>基于硬件的桥接（ASIC）；</p><p>线速（Wire speed）；</p><p>低延迟；</p><p>低成本。</p><p><br></p><p>2、第2层交换的局限性</p><p>交换机和网桥分隔冲突域，但网络仍然是一个大的广播域。要用网桥设计出一个好的网络，就必须考虑到下面两个最重要的方面：</p><p>必须绝对正确地分隔出冲突域；</p><p>创建一个功能强大的桥接网络的正确方法是，确信其用户在本地网段上花费了80%的时间。</p><p><br></p><p>随着网络的增长，广播、组播及生成树的慢收敛会让你觉得恼火。这就是为什么第2层交换机和网桥在互联网络中不能完全取代路由器的重要原因。</p><p><br></p><p>3、桥接与LAN交换的比较</p><p>网桥是基于软件的，而交换机是基于硬件的；</p><p>交换机可以看成是多端口的网桥；</p><p>每个网桥只有一个生成树实例，而交换机可以有许多生成树实例；</p><p>交换机的端口数量比大多数网桥都多；</p><p>网桥和交换机都转发第2层广播；</p><p>通过检查所接收的每个数据帧的源地址，网桥和交换机就学到了MAC地址；</p><p>网桥和交换机都是基于第2层地址做出转发的决定。<br></p><p>4、第2层的3种交换功能</p><p>地址学习（Address Learning）：</p><p>转发/过滤决定（Forward/filter decisions）：</p><p>避免环路（Loop avoidance）：<br></p><p>5、端口安全</p><p>怎样才能阻止非授权用户的主机接入到交换机的端口上呢？</p><p>Switch#config terminal</p><p>Switch(config)#interface fastethernet0/1</p><p>Switch(config-if)#switchport port-security mac-address sticky //开启端口MAC地址自动粘连</p><p>Switch(config-if)#switchport port-security maximum 2 //端口允许的最大MAC地址数为2</p><p>Switch(config-if)#switchport port-security violation shutdown //违规则关闭端口<br></p><p>6、避免环路</p><p>交换机间存在冗余链路是一件好事，因为如某一条链路出了故障的话，它们就可以用来防止整个网络失效。但它处理不当会带来一些严重的问题：</p><p>广播风暴：</p><p>同一帧的多个复制品：</p><p>MAC地址表不稳定：<br></p><p>7、生成树协议（STP）</p><p>STP（Spanning Tree Protocol）最早是由数字设备公司DEC（Digital Equipment Corporation）开发的，这个公司后来被收购并改名Compaq公司。IEEE后来开发了它自己的STP版本，称为802.1D。坏消息是，默认时，Cisco交换机运行STP的IEEE802.1D版本，它与DEC版本不兼容。好消息是，Cisco在其新出品的交换机上使用了另一个工业标准，称为802.1W。</p><p><br></p><p>生成树术语</p><p>根桥（Root bridge）<strong>：</strong>是桥ID最低的网桥。它将成为网络中的焦点，所有其它的决定都是根据根桥的判断来做出选择的。</p><p>桥协议数据单元（BPDU/Bridge Protocol Data Unit）：所有的交换机相互之间都交换信息，并利用这些信息来选出根交换机，也根据这些信息来进行网络的后续配置。默认时，每2秒发送一次BPDU。</p><p>桥ID（Bridge ID）：STP利用桥ID来跟踪网络中的所有交换机。桥ID是由桥优先级（在所有的Cisco交换机上，默认的优先级为32768）和MAC地址的组合来决定的。在网络中，桥ID最小的网桥就成为根桥。</p><p>非根桥（Nonroot bridge）：除了根桥外，其他所有的网桥都是非根桥。它们相互之间都交换BPDU，并在所有交换机上更新STP拓朴数据库，以防止环路并对链路失效采取补救措施。</p><p>端口开销（Port cost）：当两台交换机之间有多条链路且都不是根端口时，就根据端口开销来决定最佳路径，链路的开销取决于链路带宽。</p><p>根端口（Root port）：根端口是指直接连到根桥的链路所在的端口，或者到根桥的路径最短的端口。选择依次比较：开销最低的端口，如开销相同，就使用桥ID小一些的那个，如多条链路来自同一台设备，就使用端口号最低的那条链路。</p><p>指定端口（Designated port）：有最低开销的端口就是指定端口，指定端口被标记为转发端口。</p><p>非指定端口（Nondesignated port）：非指定端口是指开销比指定端口高的端口，非指定端口将被置为阻塞状态，它不是转发端口。</p><p>转发端口（Forwarding port）：指能够转发帧的端口。</p><p>阻塞端口（Blocked port）：阻塞端口是指不能转发帧的端口，这样做是为了防止产生环路。然而，被阻塞的端口将始终监听帧。</p><p><br></p><p>生成树的操作</p><p>STP的任务是找到网络中的所有链路，并关闭任何冗余的链路，这样就可以防止网络环路的产生。STP首先选举一个根桥，由根桥来负责决定网络拓朴。一旦根桥选定，其它的每台交换机就必须找到其唯一的根端口。在两台交换机之间的每一条链路必须有唯一的指定端口，在那条链路上的端口提供到根桥最大的带宽（并不是路短路径）。显然，根交换机上的每个端口都是指定端口，因为根桥离自己总是最近的。在执行STP算法之后，任何既不是端口也不是指定端口的端口，这意味着它们是非根端口、非指定端口，它们将会被置为阻塞状态，从而打破交换环路。</p><p><br></p><p>选举根桥</p><p>桥ID用来选举根桥，并决定根端口。桥ID为8个字节长，其中包括了设备的优先级和MAC地址。</p><p>a、首先看优先级，优先级小的胜出；</p><p>b、看MAC地址，MAC地址最小的设备胜出。</p><p>改变默认优先级是选举根桥的最佳方式。这一点很重要，因为我们希望网络中的核心交换机成为根桥，这样STP就会快速收敛：</p><p>Switch B(config)#do show spanning-tree</p><p>VLAN0001</p><p>Spanning tree enabled protocol ieee</p><p>Root ID Priority 32769</p><p>Address 0005.74ae.aa40</p><p>Cost 19</p><p>Port 1(FastEthernet0/1)</p><p>Hello Time 2 sec Max Age 20 sec Forward Delay 15 sec</p><p>Bridge ID Priority 32769 (priority 32768 sys-id-ext 1)</p><p>Address 0012.7f52.0280</p><p>Hello Time 2 sce Max Age 20 sec Forward Delay 15 sec</p><p>Aging Time 300</p><p>[output cut]</p><p>从以上显示得出，交换机B运行的是IEEE802.1d协议，第一项输出（RootID）是交换式网络中根桥的信息，但这不是交换机B的信息。交换机B到根桥的端口（根端口）是端口1。桥ID实际上是有关交换机B和VLAN1的生成树信息。交换机B的默认优先级是32768，这是每台交换机的默认优先级。它被列为32769，由于VLAN ID实际被加进来了，因此在这种情况下，对于VLAN 1，它显示32769，对于VLAN 2显示32770，以此类推。</p><p>在Catalyst交换机上改动桥的优先级的方法：</p><p>Switch B(config)#spanning-tree vlan 1 priority 4096 //改变桥优先级为4096；范围&lt;0~61440></p><p><br></p><p>生成树端口状态</p><p>阻塞（Blocking）：端口将不能转发帧，它只监听BPDU。当交换机加电时，默认情况下所有的端口都处于阻塞状态。</p><p>侦听（Listining）：端口都侦听BPDU，以确信在传送数据帧之前，在网络上没有环路产生。处在侦听状态的端口，在没有形成MAC地址表时，就准备转发数据帧。</p><p>学习（Learning）：交换机端口侦听BPDU，并学习交换式网络中的所有路径。处在学习状态的端口形成了MAC地址表，但不能转发数据帧。转发延迟意味着将端口从侦听状态转换到学习状态所花费的时间，默认时设置为15秒，可以用命令show spanning-tree显示出来。</p><p>转发（Forwarding）：在桥接的端口上，处在转发状态的端口发送并接收所有的数据帧。如果在学习状态结束时，端口仍然是指定端口或根端口，它就进入转发状态。</p><p>禁用（Disabled）：从管理上讲，处于禁用状态的端口不能参与帧的转发或形成STP。处于禁用状态下的端口实质上是不工作的。</p><p>说明：只有在学习状态或转发状态下，交换机才能填写MAC地址表。大多数情况下，交换机端口都处在阻塞或转发状态。但如果网络的拓朴改变了（如：链路失效或添加了一台新的交换机），交换机端口就会处于侦听或学习状态。</p><p><br></p><p>收敛</p><p>当网桥或交换机上的所有端口都转变到转发或阻塞状态时，就产生了收敛。在收敛完成之前，交换机不能转发任何数据。收敛是重要的，它用来确保所有的设备都有同样的数据库，但它确实会花一些时间。从阻塞状态转变到转发状态通常要花50秒。</p><p><br></p><p>生成树快速端口（PortFast）</p><p>如果你有一台服务器或其它设备连接到交换机上，而且可以保证在禁用STP时不会产生交换环路，那么就可以在这些端口上使用快速端口。使用快速端口意味着，当STP正在收敛时，端口不会花费通常的50秒才进入转发状态。在端口配置模式下：</p><p>Switch(config-if)#spanning-tree portfast</p><p><br></p><p>生成树上行链路快速（UplinkFast）</p><p>上行链路快速是Cisco产品特有的特性，当链路失效时，它可用来改进STP收敛时间，Cisco推荐仅当交换机典型地在接入层有被阻塞的端口时，才启用UplinkFast。允许交换机在primary link失效前，找出到根桥的可选路径。这意味着如果主链路失效，备份链路（secondary link）将更快地启用，端口将不会等待通常的50秒STP收敛时间。</p><p><br></p><p>生成树主干快速（Backbone Fast）</p><p>在本地交换机上，UplinkFast用来确定并快速修复链路失效。与UplinkFast不一样的是，Cisco有另外一个专用的STP扩展特性，称为主干快速，当某条链路并没有直连到失效的交换机时，就可以使用BackboneFast加速收敛。</p><p>特别重申：UplinkFast只能配置在接入层交换机上或带冗余链路的交换机上，而且至少有一条链路处于阻塞状态，而BackboneFast可以在所有的Catalyst交换机上启用，以便能够检测到非直连的链路失效。启用BackboneFast可在50秒的默认STP收敛时间中，它能节省20秒时间。</p><p><br></p><p>快速生成树协议（RSTP）802.1W</p><p>Cisco创建PortFast、UplinkFast、BackboneFast来“修补”IEEE802.1d标准中的漏洞和缺陷。这些特性的不足之处仅在于，它们是Cisoc专用的且需要进行额外的配置。但新的802.1w标准（RSTP）将所有这些“问题”都放在一个封包中解决了。重要的是，必须确信网络中所有的交换机都在正确地运行802.1w。当它与老的网桥交互作用时，802.1w内在的快速收敛能力将失效。</p><p><br></p><p>EtherChannel</p><p>将多条冗余链路捆在一起创建出逻辑聚合，这样，多条链路就可以像一条链路那样起作用。Cisco版本称为端口聚合协议（Port Aggregation Protocol ，PagP）；IEEE的802.3ad标准则称为链路聚合控制协议（Link Aggregation Control Protocol ，LACP）。</p><p><br></p><p>8、配置Catalyst交换机</p><p>交换机的配置与路由器的配置大同小异，值得注意的几个方面是：</p><p>我们为交换机分配IP地址，对于网络功能来说，这并不是必需的。为交换机设置IP地址的唯一原因是，我们能够对它进行管理。IP地址是在逻辑接口下配置的，称为管理域或VLAN。</p><p>Switch>enable</p><p>Switch#config terminal</p><p>Switch(config)#hostname S1</p><p>S1(config)#enable secret todd</p><p>S1(config)#line console 0</p><p>S1(config-line)#password console</p><p>S1(config-line)#login</p><p>S1(config-line)#exit</p><p>S1(config)#line vty 0 15</p><p>S1(config-line)#password telnet</p><p>S1(config-line)#login</p><p>S1(config-line)#exit</p><p>S1(config)#interface vlan 1 //进入逻辑接口Vlan1</p><p>S1(config-if)#ip address 192.168.10.17 255.255.255.240 //为逻辑接口设置IP便于管理</p><p>S1(config-if)#no shutdown</p><p><br></p><p>端口安全</p><p>S1(config)#interface range fastethernet0/3-4 //进入端口F0/3和F0/4</p><p>S1(config-if-range)#switchport port-security maximum 1 //充许端口最大接入数为1</p><p>S1(config-if-range)#switchport port-security mac-address sticky</p><p>//接入设备的MAC地址自动关联，这样就不必手工输入每台设备的所有MAC地址了。</p><p>S1(config-if-range)#switchport port-security violation shutdown //违规则关闭端口<br></p><p>S1(config-if-range)#spanning-tree portfast</p><p>//启用生成树快速端口</p><p>S1(config-if-range)#spanning-tree bpduguard enable</p><p>//为配置了portfast的端口开启BPDU护卫，可防止错误地在出现环路的端口上使用portfast。它会将该端口自动置为错误的禁用状态。该命令只在接入层交换机上使用。</p><p>S1(config-if-range)#spanning-tree bpdufilter enable</p><p>//为配置了portfast的端口开启BPDU过滤，与bpduguard不同的是，它将使端口保持打开，但不运行Portfast。</p><p>S1(config-if-range)#exit</p><p>S1(config)#spanning-tree uplinkfast</p><p>//启用生成树上行链路快速，它是一个全局命令，在每个端口上都可以启用。用于接入层交换机。用来在本地交换机上检测链路失效并修复。</p><p>S1(config)#spanning-tree backbonefast</p><p>//启用生成树主干快速，与uplinkfast不一样的是，它可在网络中所有交换机上配置，用来在远端交换机上检测链路失效并且修复。</p><p><br></p><p>9、配置EtherChannel</p><p>如：S1的F0/1、F0/2分别与Core交换机的F0/7、F0/8相连</p><p><br></p><div class=pgc-img><img alt=CCNA最实用的复习知识点（6） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4aedcb4ad4a94fed844d5601aace1e74><p class=pgc-img-caption></p></div><p><br></p><p>对于S1：</p><p>S1(config)#interface port-channel 1 //创建逻辑聚合端口通道1</p><p>S1(config-if)#interface range f0/1-2 //捆绑接口F0/1、F0/2</p><p>S1(config-if-range)#switchport mode trunk //定义为trunk（干线/中继）端口</p><p>S1(config-if-range)#switchport nonegotiate //关闭端口自动协商，以阻止交换机试图自动检测链路类型，以及自动设置中继。</p><p>S1(config-if-range)#channel-group 1 mode desirable //desirable选项：交换机主动要求形成一个EthernetChannel 并发送pagp分组。</p><p>对于Core：</p><p>Core(config)#interface port-channel 1</p><p>Core(config-if)#interface range f0/7-8</p><p>Core(config-if-range)#switchport trunk encapsulation dot1q //中继线路封装802.1q协议</p><p>Core(config-if-range)#switchport mode trunk</p><p>Core(config-if-range)#switchport nonegotiate</p><p>Core(config-if-range)#channel-group 1 mode desirable<br></p><p>10、验证Cisco Catalyst交换机的配置</p><p>交换机上并不需要IP地址，在交换机上设置IP地址、掩码、和默认网关的唯一理由是出于管理的需要，它们都配置在vlan下：</p><p>S1#show running-config //显示配置文件了解设备的大致情况</p><p>S1#show interface vlan 1 //显示vlan1下的IP地址、掩码等</p><p>S1#show mac address-table //显示转发过滤表，也称内容可寻址内存（content addressable memory，CAM）表。</p><p><br></p><p>11、分配静态MAC地址</p><p>S1#config t</p><p>S1(config)#mac-address-table static aaaa.bbbb.cccc vlan 1 int fa0/5</p><p>//将MAC地址aaaa.bbbb.cccc静态地分配给vlan 1中的快速以太网端口fa0/5</p><p><br></p><p>12、生成树相关信息</p><p>S1#show spanning-tree //显示生成树协议运行情况</p><p>S1#show spanning-tree vlan 2 //显示vlan 2的STP运行情况。每个vlan都运行它自己的STP。</p><p><br></p><p>13、确定根桥</p><p>a、首先看优先级，优先级小的胜出；</p><p>b、看MAC地址，MAC地址最小的设备胜出。</p><p><br></p><p>14、设置根桥</p><p>方法1：改变优先级</p><p>S1#config t</p><p>S1(config)#spanning-tree vlan 1 priority 16384</p><p>//优先级取值范围是0~61440，如果为0，表示那台交换机始终是根桥，如果为61440，就表示那台交换机永远不会成为根桥。</p><p>方法2：直接设置为根桥</p><p>S1(config)#spanning-tree vlan 1 root primary</p><p>//这个命令并不会覆盖低优先级的交换机，仅当所有的交换机都设置了相同或更高的优先级时，这个命令才起作用。</p><p><br></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'CCNA','最实用','习知识点'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>