<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>互联网大厂老司机带你深入了解 Java 调试 | 极客快訊</title><meta property="og:title" content="互联网大厂老司机带你深入了解 Java 调试 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/dfic-imagehandler/cd4f472c-89fb-4392-aa72-05e40b8039b1"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/c60b6bc.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/c60b6bc.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/c60b6bc.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/c60b6bc.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/c60b6bc.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/c60b6bc.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/c60b6bc.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/c60b6bc.html><meta property="article:published_time" content="2020-10-29T21:02:12+08:00"><meta property="article:modified_time" content="2020-10-29T21:02:12+08:00"><meta name=Keywords content><meta name=description content="互联网大厂老司机带你深入了解 Java 调试"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E5%AD%A6/c60b6bc.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>互联网大厂老司机带你深入了解 Java 调试</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E5%AD%A6.html>科学</a></span></div><div class=post-content><blockquote><p>点击上方☝，轻松关注！及时获取有趣有料的技术文章</p></blockquote><p><br></p><div class=pgc-img><img alt="互联网大厂老司机带你深入了解 Java 调试" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/cd4f472c-89fb-4392-aa72-05e40b8039b1><p class=pgc-img-caption></p></div><p><br></p><p>Bug(俗称"八阿哥") 是软件开发绕不过的一道坎，因此调试便成了每位程序员一项必备的核心技能。调试不仅有助于理解程序的运行流程，还能改进代码质量，最终提高开发者解决问题的能力以及交付软件的品质。<br>本文旨在讨论 Java 调试关键技巧，同时也会介绍生产环境中调试 Java 的最佳实践。</p><h1 class=pgc-h-arrow-right><strong>0 调试 Java 项目</strong></h1><p><br></p><p>本节讨论 Java 项目调试中的常见概念与技巧，包括Breakpoint (断点)、Step filter (单步过滤器)、Drop to Frame (跳出函数到选定层)等。这些技术同样可以在复杂场景下使用。</p><p><br></p><h1 class=pgc-h-arrow-right><strong>条件断点</strong></h1><p><br></p><h1 class=pgc-h-arrow-right>断点用来指定在调试过程中程序停止执行的位置。通过临时挂起执行过程，可以观察或修改字段与变量值。下面的内容虽然使用了 Eclipse进行演示，但是相关概念同样适用于其他 Java IDE。条件断点即设置成在满足特定条件时触发的断点，用来检查条件发生时程序的状态、调用堆栈及重要的变量值。</h1><p><br></p><h1 class=pgc-h-arrow-right>下面的示例对音乐专辑得分计算算术平均值：</h1><div class=pgc-img><img alt="互联网大厂老司机带你深入了解 Java 调试" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0723fc8a71ec441f93019582396328e9><p class=pgc-img-caption></p></div><p><br></p><p>假设有数百张专辑，可以在循环中设置条件断点 album.getRating().score == 0。当出现专辑得分为0时，程序就会停止执行。</p><p><br></p><p><strong>其他断点类型</strong></p><p>除了上面介绍的断点类型，不同的 Java IDE 还提供了其他类型的断点：</p><p><br></p><ul><li>事件断点：与事件绑定，在遇到调试器能够识别的事件时触发；</li></ul><p><br></p><ul><li>字段断点：给定字段或表达式的值发生变化时，字段断点将停止正在执行的程序。调试时可以指定一个字段作为观察点，表达式读取、修改时停止执行；</li></ul><p><br></p><ul><li>方法断点 ：进入或退出指定方法时挂起程序，用来检查特定方法的进入或退出事件；</li></ul><p><br></p><ul><li>行断点：程序到达断点中设置的特定代码行时停止程序执行。</li></ul><h1 class=pgc-h-arrow-right><br></h1><h1 class=pgc-h-arrow-right><strong>使用 Rookout 设置断点</strong></h1><p><br></p><p>Rookout 是一个创新的调试平台，在不停止或中断程序的情况下搜集调试数据。支持自定义断点触发条件。Rookout 提供的"断点状态"功能非常强大：在断点附近通过警告标志或展示断点状态。</p><p><br></p><p>Rookout 有5种断点状态：</p><p><br></p><ul><li>Active (紫色, 实心)</li></ul><p><br></p><ul><li>Pending (紫色, 空心)</li></ul><p><br></p><ul><li>Warning (紫色, 实心, 带三角形)</li></ul><p><br></p><ul><li>Error (紫色, 空心, 带三角形)</li></ul><p><br></p><ul><li>Disabled (灰色, 空心)</li></ul><p><br></p><div class=pgc-img><img alt="互联网大厂老司机带你深入了解 Java 调试" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/63ed0785f39443eba50004ffbb369e85><p class=pgc-img-caption></p></div><p><br></p><p>"断点状态" 可以在查看日志或调试信息前就能对程序运行状况有所了解。</p><p><br></p><h1 class=pgc-h-arrow-right><strong>Step Filter (单步过滤器)</strong></h1><p><br></p><p>Step Filter 可以在调试中指定需要跳过的 package。在调试多个 class、第三方库或框架时非常好用。在 Eclipse 中可以通过 Window Preferences >>Java Debug >>Step Filtering 配置。</p><p><br></p><h1 class=pgc-h-arrow-right><strong>Drop to frame (跳出函数到选定层)</strong></h1><p><br></p><p>这种技术可以在调试期间选择并重新执行程序的一部分：指定程序调用堆栈中任意帧(frame)，在 Debug View 中点击 Drop-to-frame 按钮，调试器会从这里重新启动。Drop to frame 不会影响字段或现有数据，例如已写入数据库的记录。</p><p><br></p><p><strong>1 远程调试</strong></p><p>大多数 Java IDE 都支持 JVM 远程调试。设置调试参数如下：</p><div class=pgc-img><img alt="互联网大厂老司机带你深入了解 Java 调试" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/b26ddf18da654847a41cda1727c45889><p class=pgc-img-caption></p></div><p><br></p><p>Eclipse 用户需输入主机名 (hostname) 和端口号，如下图所示：</p><div class=pgc-img><img alt="互联网大厂老司机带你深入了解 Java 调试" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/39e711e53a9f46ccbf7cd2b565921d10><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>2 在生产环境调试 Java</strong></h1><p><br></p><p>现如今开发节奏越来越快，代码发布也是如此。无论测试流程如何严格，总会有漏网之鱼。当这些漏洞遇到生产中的实际数据，产生的压力随之飙升。因此，进行系统扩展的同时解决潜在的漏洞非常关键。</p><p><br></p><p>下面的策略可供每个 Java 开发者参考：</p><p><br></p><ul><li>确定错误发生的时间；</li><li>评估错误的严重程度(优先级)；</li><li>筛选定位导致程序出错的状态；</li><li>接下来，跟踪并解决根本原因(root cause)；</li><li>最后，打补丁。</li></ul><p><br></p><p>除了上面的五个步骤，还应当遵守下面这些生产环境最佳实践：</p><p><br></p><h1 class=pgc-h-arrow-right><strong>提高日志等级</strong></h1><p><br></p><p>大多数情况下，错误信息没有包含足够的上下文内容，因此调试时需要提升日志等级。完整的上下文内容可以有效地理解、定位和确定错误的根本原因。一种常见的方法，在每个线程的入口点生成 UUID。</p><p><br></p><p>理想情况下，可以按照以下格式设置线程名称：</p><div class=pgc-img><img alt="互联网大厂老司机带你深入了解 Java 调试" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3cc7431502fc4f59a52985fd7e5886cc><p class=pgc-img-caption></p></div><p><br></p><p>这样，堆栈跟踪信息会以 “threadName: pool-7-thread-22, UUID: EB85GTA, MsgType: AnalyzeGraph, MsgID: 415669, 29/03/2020 04:44” 开头，比起 “pool-7-thread-22” 这样的名字更有意义。</p><p><br></p><p><strong>集中日志</strong></p><p><br></p><p>在应用程序生命周期各阶段尤其是生产阶段处理错误时，应优先考虑高效的日志记录机制。把会话中所有重要事件汇集到统一的日志服务器，不但能够降低调试的难度，而且在跟踪关键产品指标时，还可以帮助监视应用程序中发生错误的情况。</p><p><br></p><h1 class=pgc-h-arrow-right><strong>检查堆栈跟踪和其他日志</strong></h1><p>调试异常时，堆栈跟踪非常有用：它能帮助确定在程序崩溃时调用了哪些函数以及调用顺序。下面的代码使用 printStack() 方法打印异常堆栈：</p><p><br></p><div class=pgc-img><img alt="互联网大厂老司机带你深入了解 Java 调试" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fda11869a4344dab94261ae6492ab961><p class=pgc-img-caption></p></div><p><br></p><p>输出结果：</p><div class=pgc-img><img alt="互联网大厂老司机带你深入了解 Java 调试" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d7033ed9c4d24238a627fede9cdfbfa0><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><br></h1><h1 class=pgc-h-arrow-right><strong>复制实例</strong></h1><p><br></p><p>获取日志后，接下来最重要的是在复制场景(实例)。通常会创建一个与 IDE 调试类似的环境，便于分析与解决错误。</p><p><br></p><h1 class=pgc-h-arrow-right><strong>3 总结</strong></h1><p><br></p><p>Java 调试并不是开发者的噩梦。一点创造性思维加上合适的工具，开发者会更有信心、更加快速准确地识别、诊断和解决代码中的错误。</p><blockquote><p>来源：覃佑桦</p><p>medium.com/@AriNoman/java-debugging-731c21d278be</p></blockquote><p><br></p><p>上面就是本次文章的全部内容，感谢你的阅读，希望对你有帮助，也欢迎你点赞留言和转发~</p><blockquote><p>关注我，不迷路，及时获取有趣有料内容，See you next good day~</p></blockquote></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'互联','网大厂','老司'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>