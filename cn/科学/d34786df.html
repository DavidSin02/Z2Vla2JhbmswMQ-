<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>10、OpenCV中图像和Mat类型（一） | 极客快訊</title><meta property="og:title" content="10、OpenCV中图像和Mat类型（一） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/24b0ab17ca4f4fc38e616aecfbe79161"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/d34786df.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/d34786df.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/d34786df.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/d34786df.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/d34786df.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/d34786df.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%a6/d34786df.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%a6/d34786df.html><meta property="article:published_time" content="2020-11-14T20:56:35+08:00"><meta property="article:modified_time" content="2020-11-14T20:56:35+08:00"><meta name=Keywords content><meta name=description content="10、OpenCV中图像和Mat类型（一）"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E5%AD%A6/d34786df.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>10、OpenCV中图像和Mat类型（一）</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E5%AD%A6.html>科学</a></span></div><div class=post-content><p>Mat类型可以被认为是OpenCV库的核心。 OpenCV库中绝大多数的函数都是Mat类的成员，以Mat作为参数，或者Mat作为返回值。</p><div class=pgc-img><img alt=10、OpenCV中图像和Mat类型（一） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/24b0ab17ca4f4fc38e616aecfbe79161><p class=pgc-img-caption></p></div><p>Mat类用于表示任意维数的密集数组。即使对于数组中的该条目为零，也存在与该条目相对应的数据值。大多数图像都以密集阵列的形式存储。在稀疏数组的情况下，通常只存储非零条目。如果许多条目都是零，那么可以节省大量的存储空间。使用稀疏数组而不是密集数组的常见情况是直方图。对于许多直方图，大多数条目都是零，并且存储所有这些零不是必需的。对于稀疏数组的情况，OpenCV有另一种数据结构，SparseMat。</p><p>如果你熟悉OpenCV库的C接口（2.1之前的版本），您将会记住IplImage和CvMat的数据类型。 你也可能记得CvArr。 在C ++实现中，所有这些都消失了，用Mat代替。Mat类可以用于任何维数的数组。数据被存储在阵列中，被认为是"光栅扫描顺序"的n维数字。这意味着在一维数组中，元素是顺序的。在二维数组中，数据按行组织，每行依次出现。对于三维阵列，每个平面都是逐行填充的。</p><p>每个Mat都包含一个标志元素，指示数组内容，一个dims元素指示维数，rows和cols元素指示行数和列数，指向数据指针的位置数组数据被存储，一个类似于Ptr &lt;>的的引用计数器。数据数组被布置成使得其索引由（i0，ii，...，iNd-1）给出的元素的地址是：</p><p>在二维数组的简单情况下，这可以简化为：</p><p>&(mtxi, j)= mtx.data +mtx.step 0 *i +mtx.step 1 *j</p><p>Mat中每个数据元素本身可以是单个数字，也可以是多个数字。在多个数字的情况下，这就是多通道数组。一个数组可能被认为是一个32位浮点数的二维三通道数组;在这种情况下，数组的元素是三个32位浮点数，大小为12个字节。在内存中布局时，数组的行可能不是绝对顺序的;在下一个之前可能会有小的间隙缓冲每一行。一个n维单通道阵列和一个（n-1）维多通道阵列之间的区别在于，这个填充将始终发生在整行的末尾,即元素中的通道将始终是连续的）。</p><p>可以简单地通过实例化一个类型为Mat的变量来创建一个数组。以这种方式创建的数组没有大小和数据类型。但是，可以使用create（）等成员函数分配数据。 create（）的一个变体将多个行，多个列和一个类型作为参数，并将该数组表示为一个二维对象。数组的类型决定了它具有哪种元素以及通道的数量。所有这些类型都在库中定义，并具有CV_ {8U，16S，16U，32S，32F，64F} C {1,2,3}的格式。例如，CV_32FC3意味着一个32位浮点三通道阵列。</p><p>也可以在首次分配矩阵时指定这些内容。Mat有许多构造函数，其中一个与create（）具有相同的参数。例如：</p><p>cv::Mat m;</p><p>// 创建3行10列3通道32位浮点型数据</p><p>m.create( 3, 10, CV_32FC3 );</p><p>//设置第一个通道为1.0，第二个通道为0.0，第三个通道为1.0</p><p>m.setTo( cv::Scalar( 1.0f, 0.0f, 1.0f ) );</p><p>//上面的定义与下面的语句等价</p><p>Mat m( 3, 10, CV_32FC3, cv::Scalar( 1.0f, 0.0f, 1.0f ) );</p><p>Mat对象实际上是数据区域的头，原则上它是一个完全独立的东西。 例如，可以将一个矩阵n分配给另一个矩阵m（即，m = n）。 在这种情况下，m中的数据指针将被改变为指向与n相同的数据。 先前由m的数据元素指向的数据将被释放。同时，它们现在共享的数据区域的引用计数器将递增。同时将更新m成员的数据（如行，列和标志），以准确描述m中数据指向的数据。</p><p>表1是Mat的构造函数的完整列表。但事实上，大多数时候可能使用其中的一小部分。</p><div class=pgc-img><img alt=10、OpenCV中图像和Mat类型（一） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5870d38ea65540b5abb1902e0559fb18><p class=pgc-img-caption></p></div><p>表1列出了Mat对象的构造函数。除了默认的构造函数之外，它们分为三个基本类别：有些需要多行和多列来创建二维数组的类，有些使用Size对象创建，有些构造n维数组并要求指定维数并传入指定每个维的大小的整数数组的指针。此外，其中一些允许初始化数据，或者通过Scalar提供初始化值（这时整个数组将被初始化为该值），或者通过提供指向数据块的指针来指定。在后一种情况下，只是为现有数据创建一个数据头，不复制数据;将数据成员设置为指向由数据参数指示的数据）。</p><p>表2的复制构造函数显示了如何从另一个数组创建一个数组。除了基本的复制构造函数外，还有三种方法用于从现有数组的子区域构建数组，以及使用某个矩阵表达式的结果初始化新矩阵的构造函数。</p><div class=pgc-img><img alt=10、OpenCV中图像和Mat类型（一） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/64d28b6f21924874aaedc4689a7fb6fb><p class=pgc-img-caption></p></div><p>也可以从OpenCV2.1版之前的CvMat或IplImage结构创建新的C ++风格的Mat结构。在这种情况下，可以采用下面表3这种方式转换。</p><div class=pgc-img><img alt=10、OpenCV中图像和Mat类型（一） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/dce22c82038743fbbb49e656627451bf><p class=pgc-img-caption></p></div><p>这些构造函数可能比你刚开始认识OpenCV的时候要多得多。还有一种构造函数是模板构造函数。 这些被称为模板构造函数是因为它们从本身就是模板的东西构建了Mat的实例。 这些构造函数允许使用任意Vec &lt;>或Matx &lt;>来创建具有相应维数和类型的Mat数组，或者使用任意类型的STL向量&lt;>对象来构造一个相同类型的数组。表4是这种构造方式。</p><div class=pgc-img><img alt=10、OpenCV中图像和Mat类型（一） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ba35391c146f41089f3bb817fd6b6ea5><p class=pgc-img-caption></p></div><p>Mat类还提供了许多静态成员函数来创建特定类型的常用数组（表4-5）。 这些函数包括zero（），ones（）和eye（）等函数，它们分别构造一个全是零的矩阵，一个全是1矩阵的矩阵和一个单位矩阵。表5是这种构造方式</p><div class=pgc-img><img alt=10、OpenCV中图像和Mat类型（一） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/88126d698815404c8add90ea49d42f91><p class=pgc-img-caption></p></div><p>对于Mat中的数据访问方式可以参考第6部分的说明。</p><p>有时候我们需要访问数组中的某一块元素，可能是选择一行或一列，或原始数组的任何子区域。有很多方法可以做到这一点，表6是Mat类的成员函数，并返回调用它们的数组的子部分。</p><div class=pgc-img><img alt=10、OpenCV中图像和Mat类型（一） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/96ad411846d14a1eaaf2b19b5f0dd44c><p class=pgc-img-caption></p></div><p>这些方法中最简单的方法是row（）和col（）。与row（）和col（）紧密相关的是rowRange（）和colRange（）。这些函数基本上是一样的，只不过他们会提取一个具有多个连续行（或列）的数组。可以通过以下两种方式之一调用这两个函数：指定一个整数开始和结束行（或列），或者通过传递一个行（或列）的Range对象。范围包括开始索引但不包括结束索引。</p><p>除了从m.diag（）返回的数组引用矩阵的对角线元素之外，成员函数diag（）与row（）或col（）的作用相同。 m.diag（）需要一个整数参数，用于指示要提取哪个对角线。如果该参数为零，那么它将是主对角线。如果是正数，则它将从阵列上半部分的主对角线偏移该距离。如果它是负数，那么它将来自阵列的下半部分。</p><p>提取子矩阵的最后一种方法是使用operator（）。使用这个运算符，你可以传递一对范围（行的Range和列的Range）或者从Rect指定你想要的区域。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'10','OpenCV','中图'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>