<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>sync-player使用websocket实现异地同步播放 | 极客快訊</title><meta property="og:title" content="sync-player使用websocket实现异地同步播放 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/ffc06a527dc54617a72f41f5c181c7f0"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/00f168a.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/00f168a.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/00f168a.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/00f168a.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/00f168a.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/00f168a.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/00f168a.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/00f168a.html><meta property="article:published_time" content="2020-10-29T20:58:12+08:00"><meta property="article:modified_time" content="2020-10-29T20:58:12+08:00"><meta name=Keywords content><meta name=description content="sync-player使用websocket实现异地同步播放"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/00f168a.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>sync-player使用websocket实现异地同步播放</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><blockquote><p><span style="color:#6a737d;--tt-darkmode-color: #6A737D">本文作者：星空无限</span></p><p><span style="color:#6a737d;--tt-darkmode-color: #6A737D">原文链接：https://liyangzone.com/2020/09/20/前端/sync-player/</span></p><p><span style="color:#6a737d;--tt-darkmode-color: #6A737D">GoEasy已获作者授权转载，GoEasy转载时有改动，感谢作者的分享。</span></p></blockquote><p style=text-align:start>前段时间我有这样一个需求，想和一个异地的人一起看电影，先后在网上找了一些方案，不过那几个案都有一些缺点</p><ul><li><strong>coplay:</strong> 一个浏览器插件，只能播放各大视频网站的视频，视频资源有限，我想要看的视频没有，比如一些经典电影和美剧之类</li><li><strong>微光APP:</strong> 还是上面的问题，而且只有手机端</li><li><strong>向日葵等远程桌面:</strong> 受限于网络问题，卡顿很严重，体验不好</li></ul><p style=text-align:start>作为一个对用户体验有追求的切图仔，我是一个下载党，看电影必须下载到本地看，基本不看视频网站上的玩意</p><p style=text-align:start>那么有没有能实现同步播放本地文件的方案呢，答案是肯定的，经过我的一些摸索和研究，我实现了本地文件的同步播放，同时支持PC和手机端，而且还支持外挂字幕等高级功能，如何实现请往下看。</p><h1 class=pgc-h-arrow-right>功能介绍&特性：</h1><p style=text-align:start>一个可以同步看视频的播放器，可用于异地同步观影、观剧，支持多人同时观看。 本项目有两个版本，web版运行在浏览器上，可跨平台，不限操作系统、设备，功能简单适用于要求不高的用户。还有基于SPlayer(射手影音)DIY的客户端版本(windows、MAC)，播放4K高清文件、外挂字幕，统统没问题。</p><h1 class=pgc-h-arrow-right>演示demo:</h1><p><strong>web版同步效果</strong></p><div class=pgc-img><img alt=sync-player使用websocket实现异地同步播放 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ffc06a527dc54617a72f41f5c181c7f0><p class=pgc-img-caption></p></div><p><strong>客户端与web版同步效果</strong></p><div class=pgc-img><img alt=sync-player使用websocket实现异地同步播放 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2a8a10f4214e48ffa3ed710fcddcb0ad><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>原理：</h1><p style=text-align:start>基于websocket实现，与一些用websocket实现的聊天室类似，只不过这个聊天室里的消息换成了播放暂停的动作和时间信息，客户端收到消息后执行相应的动作:播放、暂停、快进，以达到同时播放的效果。</p><h1 class=pgc-h-arrow-right>项目所用到的</h1><ul><li>node.js</li><li>socketio</li><li>HTML5 video API</li><li>vue.js</li></ul><h1 class=pgc-h-arrow-right>如何使用：</h1><p style=text-align:start>本项目的核心是websocket，所以至少需要一台服务器提供websocket服务，websocket服务可以自己部署，可以使用第三方平台GoEasy提供的websocket服务。</p><h1 class=pgc-h-arrow-right>1、自己部署：</h1><p style=text-align:start>websocket服务器可以是一台具有公网IP的云服务器，也可以是一台具有公网IP的普通PC，没有公网IP也可以。你也可以使用zerotier或其他VPN工具将两台设备组成一个大局域网，让它们能互相通信。websocket服务器操作系统不限，只要有node.js环境。</p><p style=text-align:start>websocket服务端部署方法：安装node.js环境，将server目录移动到服务器上，进入server目录，执行以下命令：</p><p style=text-align:start><strong>安装项目依赖包</strong></p><pre><code># 安装项目依赖包npm install # 启动websocket服务node index.js</code></pre><h1 class=pgc-h-arrow-right>2、使用GoEasy的websocket服务</h1><p style=text-align:start>注册GoEasy开发者账号并创建一个应用，获得appkey，复制到本项目相应位置即可。</p><p style=text-align:start>GoEasy官网：https://www.goeasy.io</p><p style=text-align:start>无论是使用哪种websocket服务都可以，本项目写了两套代码，只需将不用的那套注释掉即可(默认GoEasy)。</p><p style=text-align:start>除了websocket服务器之外，还需要两个http服务端，一个是web服务端(提供html、css、js等文件的访问)，一个是视频服务端(提供视频文件访问)。</p><p style=text-align:start><strong>你可以将web服务部端署到以下位置：</strong></p><ul><li>具有公网IP的服务器</li><li>github-pages或国内的码云提供的静态web服务</li><li>localhost(本地服务器)，同一个局域网内的设备访问该服务器内网IP</li></ul><p style=text-align:start><strong>视频文件只需一个视频地址就行，也有以下几种选择：</strong></p><ul><li>具有公网IP的服务器</li><li>localhost(本地服务器)，同一个局域网内的设备访问该服务器内网IP</li><li>第三方视频地址</li></ul><div class=pgc-img><img alt=sync-player使用websocket实现异地同步播放 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e61002dcacec44c7b7339d0c55fd6121><p class=pgc-img-caption></p></div><p style=text-align:start><strong>使用场景1：</strong></p><p style=text-align:start>云服务器带宽足够大(至少要大于播放视频的码率)，云服务器既可以作为websocket服务端，也可以作为http服务端。上图中所有设备都访问云服务器的ip或域名。</p><p style=text-align:start><strong>使用场景2：</strong></p><p>云服务器的带宽很小，这时候它只能作为websocket服务端，这时可以用上图中的PC1和PC2作为http服务端，PC1和PHONE1在一个内网访问PC1的内网IP，PC2和PHONE2在一个内网访问PC2的内网IP，PC3可作为自己的http服务端，PHONE3若是有提供视频文件的服务端，也可以使用。</p><div class=pgc-img><img alt=sync-player使用websocket实现异地同步播放 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/171cd55b82ed4b1e85d0acc9e24180ae><p class=pgc-img-caption></p></div><p><strong>使用场景3：</strong></p><p style=text-align:start>需要使用zerotier或其他VPN工具将异地设备组成一个大局域网，其中任意一台PC均可作为websocket服务端和http服务端(需要上传带宽足够大)。上图中各设备都访问那台PC的内网ip即可。</p><p style=text-align:start>最简单的使用方法，下载nginx开启一个本地服务器，下载本项目client文件夹放到到nginx根目录里，视频文件也放到里面。注册goeasy开发者账号并创建一个应用，获得appkey，并填入到appkey到代码(script/main.js)相应位置。然后浏览器打开 192.168.3.58/client/，填入你的视频地址192.168.3.58/movie/xxx.mp4或网络视频地址，对方也这样操作一番，即可实现同步播放视频。</p><p style=text-align:start>web版本的功能比较简单，而且受限于网络问题，快进之类的操作需要缓冲一段时间。如果你不满足web版功能，对用户体验有更高的要求，如支持更多文件格式、播放高清本地视频文件、外挂字幕等，我也找到了另一种方式来满足你的需求。</p><p style=text-align:start>那就是DIY一个开源的播放器的源码：SPlayer(射手影音)。</p><p style=text-align:start>射手影音官网：https://splayer.org</p><p style=text-align:start>源码地址：https://github.com/chiflix/splayerx</p><p style=text-align:start>在以electron + 播放器为关键字一番搜索之后，我找到了这个基于electron实现的开源播放器，并下载了源码来研究。</p><p style=text-align:start>经过一番研究之后，我找到了控制视频播放、暂停、快进的代码位置，并将控制同步的代码移植了进去，从而也实现了同步功能，并且与web版兼容。</p><p style=text-align:start>具体方法请看：修改教程</p><p style=text-align:start>本项目部分图标样式来源于此项目: coplay</p><p style=text-align:start>本项目github地址：点击前往 ，欢迎⭐⭐⭐STAR⭐⭐⭐</p><h1 class=pgc-h-arrow-right>关于GoEasy：</h1><p style=text-align:start>GoEasy是一个成熟稳定的企业级websocket PAAS服务平台，开发人员不需要考虑websocket服务端的搭建，只需要几行代码，就可以轻松实现客户端与客户端之间，服务器与客户端之间的的websocket通信。</p><p style=text-align:start>GoEasy作为国内领先的第三方websocket消息推送平台，具备极佳的兼容性。除了兼容所有常见的浏览器以外，同时也兼容uni-app，各种小程序，以及vue、react-native、cocos、laya、egret等常见的前端框架。</p><p style=text-align:start>同时GoEasy已经内置websocket中必备的心跳，断网重连，消息补发，历史消息和客户端上下线提醒等特性，开发人员也不需要自己搭建websocket服务处理集群高可用，安全和性能问题。GoEasy已经稳定运行了5年，支持千万级并发，成功支撑过很多知名企业的重要活动，安全性和可靠性都是久经考验。</p><p style=text-align:start>有兴趣自己搭建websocket的话，可以参考这篇技术分享《<a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6800945330385846788/?group_id=6800945330385846788" rel="noopener noreferrer" target=_blank>搭建websocket消息推送服务，必须要考虑的几个问题</a>》</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'sync','player','websocket'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>