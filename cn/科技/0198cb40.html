<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>'佩奇'，网络协议报文格式大集合 | 极客快訊</title><meta property="og:title" content="'佩奇'，网络协议报文格式大集合 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/8b5811fbc54e405d89ff0096fb740b52"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0198cb40.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0198cb40.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0198cb40.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0198cb40.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0198cb40.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0198cb40.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0198cb40.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0198cb40.html><meta property="article:published_time" content="2020-11-14T21:03:08+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:08+08:00"><meta name=Keywords content><meta name=description content="'佩奇'，网络协议报文格式大集合"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/0198cb40.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>'佩奇'，网络协议报文格式大集合</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>1、TCP/IP体系结构</h1><p>TCP/IP协议分为四层结构，每一层完成特定的功能，包括多个协议。本课程实验中相关协议的层次分布，如下图所示。</p><div class=pgc-img><img alt='"佩奇"，网络协议报文格式大集合' onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8b5811fbc54e405d89ff0096fb740b52><p class=pgc-img-caption></p></div><p>这些协议之间的PDU封装并不是严格按照低层PDU封装高层PDU的方式进行的，上图显示了Ethernet帧、ARP分组、IP分组、ICMP报文、TCP报文段、UDP数据报、RIP报文、OSPF报文和FTP报文之间的封装关系。</p><p>各协议PDU间的封装关系</p><div class=pgc-img><img alt='"佩奇"，网络协议报文格式大集合' onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/585d3e7952d9456882ed4e585bc6fb0d><p class=pgc-img-caption></p></div><h1>2、链路层协议报文格式</h1><p>2.1、 Ethernet报文格式</p><p>最新的IEEE 802.3标准（2002年）中定义Ethernet帧格式如下：</p><div class=pgc-img><img alt='"佩奇"，网络协议报文格式大集合' onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e59b5a3850c64311b854191ea3bfb34a><p class=pgc-img-caption></p></div><ul><li>l其中，类型/长度值小于1536（0x0600）时表示数据字段的长度，大于等于1536（0x0600）时表示数据字段的协议类型。类型/长度值0x0800表示帧中封装的数据为IP分组，类型值0x0806表示帧中封装的数据为ARP分组。</li><li>Ethernet II类型以太网帧的最小长度为64字节（6＋6＋2＋46＋4）最大长度为1518字节（6＋6＋2＋1500＋4）。其中前12字节分别标识出发送数据帧的源节点MAC地址和接收数据帧的目标节点MAC地址。（注：ISL封装后可达1548字节，802.1Q封装后可达1522字节）</li><li>接下来的2个字节标识出以太网帧所携带的上层数据类型，如下</li></ul><pre>IPv4: 0x0800ARP:0x0806PPPoE:0x8864802.1Q tag: 0x8100 IPV6: 0x86DDMPLS Label:0x8847</pre><ul><li>在不定长的数据字段后是4个字节的帧校验序列（Frame. Check Sequence，FCS）</li></ul><p>2.2、802.1q VLAN数据帧(4字节）</p><div class=pgc-img><img alt='"佩奇"，网络协议报文格式大集合' onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f09906f8fa024f2b8eb98d49ce824f6b><p class=pgc-img-caption></p></div><ul><li>Type：长度为2字节，取值为0x8100，表示此帧的类型为802.1Q Tag帧。</li><li>PRI：长度为3比特，可取0～7之间的值，表示帧的优先级，值越大优先级越高。该优先级主要为QoS差分服务提供参考依据（COS）。</li><li>CFI 字段标识MAC 地址在不同的传输介质中是否以标准格式进行封装，长度为1bit，取值为0 表示MAC 地址以标准格式进行封装，为1 表示以非标准格式封装，缺省取值为0</li><li>VLAN Identifier (VID) : 长度12bits，可配置的VLAN ID取值范围为1～4094。通常vlan 0和vlan 4095预留，vlan1为缺省vlan，一般用于网管</li></ul><p>3.3、PPP帧格式</p><div class=pgc-img><img alt='"佩奇"，网络协议报文格式大集合' onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e483918336084ce3abccfc7ca73c54f3><p class=pgc-img-caption></p></div><p>PPP报文的内容是指Address、Control、Protocol和Information四个域的内容。各字段的含义如下。</p><ul><li>lFlag域Flag域标识了一个物理帧的起始和结束，该字节为0x7E。</li><li>Address域PPP协议是被运用在点对点的链路上，它可以唯一标识对方。因此使用PPP协议互连的两个通信设备无须知道对方的数据链路层地址。所以该字节已无任何意义，按照协议的规定将该字节填充为全1的广播地址。</li><li>Control域同Address域一样，PPP数据帧的Control域也没有实际意义，按照协议的规定通信双方将该字节的内容填充为0x03。Address和Control域一起表示了此报文为PPP报文，即PPP报文头为FF03。</li><li>Protocol域协议域可用来区分PPP数据帧中信息域所承载的数据报文的内容。</li></ul><p>Protocol协议域</p><div class=pgc-img><img alt='"佩奇"，网络协议报文格式大集合' onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/3d54120c54f4448d97173b0880e0698f><p class=pgc-img-caption></p></div><ul><li>Information域信息域最大长度是1500字节，其中包括填充域的内容。信息域的最大长度等于PPP协议中MRU（Maximum Receive Unit）的缺省值。</li></ul><p>2.4、 STP协议格式</p><div class=pgc-img><img alt='"佩奇"，网络协议报文格式大集合' onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7cb022c1d34b4810af6eeb77a7e7997c><p class=pgc-img-caption></p></div><ul><li>目的mac地址 ― 目的地址是一个固定的桥的组播地址（0x0180c2000000）</li><li>源MAC地址 ― 即发送该配置消息的桥MAC地址</li><li>长度/类型 ― 这里表示帧长</li><li>LLC Header ― 固定的链路头-0x424203</li><li>Payload ― BPDU数据</li></ul><h1>3 网络层协议报文</h1><p>3.1 IP报文头</p><div class=pgc-img><img alt='"佩奇"，网络协议报文格式大集合' onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d5acd80426134291ac2f68ea50b7f88d><p class=pgc-img-caption></p></div><ul><li>类型：IP报文的类型为0x0800；</li><li>Version：4比特；表示版本；目前为4；即0100</li><li>IHL：Internet Header Length 首部长度；占4比特。是头部占32比特的数字，包括可选项。普通IP数据报（没有任何选项），该字段的值是5，即160比特=20字节。此字段最大值为60字节；</li><li>服务类型（Type of Service ，TOS）字段：占8比特。其中前3比特为优先权子字段（Precedence，现已被忽略）。第8比特保留未用。第4至第7比特分别代表延迟、吞吐量、可靠性和花费。当它们取值为1时分别代表要求最小时延、最大吞吐量、最高可靠性和最小费用。这4比特的服务类型中只能置其中1比特为1。可以全为0，若全为0则表示一般服务。服务类型字段声明了数据报被网络系统传输时可以被怎样处理。例如：TELNET协议可能要求有最小的延迟，FTP协议（数据）可能要求有最大吞吐量，SNMP协议可能要求有最高可靠性，NNTP（Network News Transfer Protocol，网络新闻传输协议）可能要求最小费用，而ICMP协议可能无特殊要求（4比特全为0）。实际上，大部分主机会忽略这个字段，但一些动态路由协议如OSPF（Open Shortest Path First Protocol）、IS-IS（Intermediate System to Intermediate System Protocol）可以根据这些字段的值进行路由决策。</li><li>总长度字段：占16比特。指明整个数据报的长度（以字节为单位）。最大长度为65535字节。</li><li>标志字段：占16比特。用来唯一地标识主机发送的每一份数据报。通常每发一份报文，它的值会加1。</li><li>标志位字段：占3比特。标志一份数据报是否要求分段。</li><li>段偏移字段：占13比特。如果一份数据报要求分段的话，此字段指明该段偏移距原始数据报开始的位置</li><li>生存期（TTL：Time to Live）字段：占8比特。用来设置数据报最多可以经过的路由器数。由发送数据的源主机设置，通常为32、64、128等。每经过一个路由器，其值减1，直到0时该数据报被丢弃</li><li>协议字段：占8比特。指明IP层所封装的上层协议类型，如ICMP（1）、IGMP（2） 、TCP（6）、UDP（17）等</li><li>头部校验和字段：占16比特。内容是根据IP头部计算得到的校验和码。计算方法是：对头部中每个16比特进行二进制反码求和。（和ICMP、IGMP、TCP、UDP不同，IP不对头部后的数据进行校验）</li><li>源IP地址、目标IP地址字段：各占32比特。用来标明发送IP数据报文的源主机地址和接收IP报文的目标主机地址</li><li>可选项字段：占32比特。用来定义一些任选项：如记录路径、时间戳等。这些选项很少被使用，同时并不是所有主机和路由器都支持这些选项。可选项字段的长度必须是32比特的整数倍，如果不足，必须填充0以达到此长度要求</li></ul><p>3.2、ARP协议报文</p><div class=pgc-img><img alt='"佩奇"，网络协议报文格式大集合' onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d300d2e8d72b4b808c86296150efd4e2><p class=pgc-img-caption></p></div><p>以太网类型为0x0806代表ARP协议</p><p>ARP报文格式：</p><p>前四个字段用来指定后四个字段的类型和长度</p><ul><li>硬件地址类型：本地网络的硬件类型，例如10 Mb 的Ethernet，是以0001 为代码。</li><li>协议类型：表示ARP 提供解析的协议类型，常为IP 协议， IP 是以0080 为代码。</li><li>硬件地址长度：表示该类型的硬件地址长度，例如Ethernet 和 Token Ring 为06，而Frame Relay 为02。</li><li>协议地址长度：通常表示IP 位址的长度，IPv4 为04</li><li>OP:操作资源，ARP可以用于其他类型的网络，可以解析IP地址以外的地址</li></ul></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'网络','协议','报文'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>