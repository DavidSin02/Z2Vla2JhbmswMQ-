<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>详解中断程序的编写方法 | 极客快訊</title><meta property="og:title" content="详解中断程序的编写方法 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/15411285021465001798b3c"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/029d832.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/029d832.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/029d832.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/029d832.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/029d832.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/029d832.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/029d832.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/029d832.html><meta property="article:published_time" content="2020-10-29T20:50:02+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:02+08:00"><meta name=Keywords content><meta name=description content="详解中断程序的编写方法"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/029d832.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>详解中断程序的编写方法</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>在应用中断技术时，先要根据中断需实现的功能设计好电路，然后编写中断程序。下面首先分析一个中断程序，再总结出编写中断程序的一般规律。</p><h1>从实例了解中断程序的编写</h1><p>图5-2所示是一个已设计好的单片机电路，在这个电路中需要实现这样的中断控制：当按下按键S1时，单片机的外部中断INT0端(与P3.2引脚共用)输入中断请求信号，该信号进入内部中断系统，让CPU产生中断来执行中断子程序，程序运行的结果是让单片机的P1.2引脚输出低电平，发光二极管VD1发光。</p><div class=pgc-img><img alt=详解中断程序的编写方法 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15411285021465001798b3c><p class=pgc-img-caption>图5-2 一个单片机应用电路</p></div><p>实现上述控制功能的程序如下：</p><div class=pgc-img><img alt=详解中断程序的编写方法 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/15411285191330d7c9a6f26><p class=pgc-img-caption></p></div><p><strong>程序执行过程说明如下。</strong></p><p>① 程序从第2行指令开始执行(因为第1行是伪指令，不执行)，执行第2行指令的结果是跳到第6行。</p><p>② 第6行～第11行指令用于进行中断前的设置。具体包括：在单片机内部存储器中设置一个区域当作堆栈(堆栈的栈底地址设为5FH);将I/O接口设置到初始状态;设置中断输入有效方式(下降沿有效)，并开启总中断和外部中断0。</p><p>③ 第12行指令“LJMP $”是一条死循环指令。这条指令执行的结果就是再执行它，程序一直执行这条指令，无法执行下一条指令，就像是原地踏步。</p><p>④ 一旦按下按键S1，单片机的INT0端(P3.2)马上由高电平变为低电平，相当于该端输入一个下降沿信号，该信号使单片机内部的中断系统发生中断，由于外部中断0的中断入口地址为0003H，程序马上由“LJMP $”指令处跳到第4行指令“LJMP INT_0”处，第4行指令执行的结果是跳到标号“INT_0”处。</p><p>⑤ 从标号“INT_0”到指令“RETI”的这一段程序为中断子程序。为了避免执行中断子程序时破坏累加器ACC和寄存器PSW中的数据，先用“PUSH”指令将ACC、PSW中的数据送到先前设置好的堆栈中保存下来(保护现场)，然后执行子程序中的关键部分“CPL P1.2”，执行完后，再用“POP”指令依次将堆栈中的数据送回到PSW、ACC中(恢复现场)。要注意的是，先保存到堆栈中的数据要后取出(先存后取)，由于ACC中的数据先存入堆栈，所以要后取出，如果不按“先存后取”的顺序，就会造成数据恢复错误(如会将堆栈中ACC的数据送到PSW中)。</p><p>⑥ “ RETI”指令是一条中断子程序返回指令，该条指令执行的结果是返回到中断前的指令，这里是返回到指令“LJMP $”处，让程序又“原地踏步”，直到INT0端再输入中断请求信号。</p><h1>中断程序的编写方法</h1><p>中断程序的编写包括主程序的编写和中断子程序的编写。</p><p><strong>1.编写主程序</strong></p><p>主程序的一般编写过程如下。</p><p>① 设置中断源和中断触发方式。根据需要确定中断的性质，通过设置定时器/计数器控制寄存器TCON或串行通信口控制寄存器SCON相应位的值来选择是外部中断，还是定时器/计数器中断等;设置中断触发方式是低电平触发，还是下降沿触发。</p><p>② 设置中断优先顺序。根据中断紧急程度(当有多个中断源时)确定中断源的优先顺序，以此来设置中断优先级控制寄存器IP中相应位的值。</p><p>③ 打开中断。通过在中断允许寄存器IE中设置相应的值，打开各个中断。</p><p><strong>2.编写中断子程序</strong></p><p>中断子程序的编写过程如下。</p><p>① 关中断。进入中断后，一般先要将中断关闭，再进行现场保护，如在前面的实例中，可在“PUSH ACC”指令前加一条“CLR EA”指令，就能将总中断关闭。</p><p>② 保护现场。为了防止执行中断子程序的过程中改变ACC和PSW中的数据，要用“PUSH ”指令将ACC和PSW中的数据送入堆栈中保护起来。</p><p>③ 开启中断。现场保护好后，再开启中断，如在前面实例的“PUSH PSW”指令后加一条“SETB EA”指令，就能将总中断打开。</p><p>④ 执行中断服务。中断服务程序是中断子程序中的核心，前面实例中的“CPL P1.2”指令就是中断服务程序。</p><p>⑤ 关闭中断。中断服务程序执行后又要关闭中断，以恢复现场，如在前面的实例中，可在“CPL P1.2”指令后加一条“CLR EA”指令，就能将总中断关闭。</p><p>⑥ 恢复现场。恢复现场的方法是用“POP”指令将堆栈中的数据送还给ACC和PSW。</p><p>⑦ 退出中断子程序，返回主程序。在中断子程序的最后用“RETI”指令可以退出中断子程序，返回主程序。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'详解','中断','编写'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>