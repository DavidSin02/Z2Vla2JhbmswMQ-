<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>NLP任务中的文本预处理步骤、工具和示例 | 极客快訊</title><meta property="og:title" content="NLP任务中的文本预处理步骤、工具和示例 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/RqSgmP9HojtMNK"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/02a71e69.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/02a71e69.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/02a71e69.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/02a71e69.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/02a71e69.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/02a71e69.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/02a71e69.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/02a71e69.html><meta property="article:published_time" content="2020-11-14T21:00:59+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:59+08:00"><meta name=Keywords content><meta name=description content="NLP任务中的文本预处理步骤、工具和示例"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/02a71e69.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>NLP任务中的文本预处理步骤、工具和示例</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><img alt=NLP任务中的文本预处理步骤、工具和示例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RqSgmP9HojtMNK><img alt=NLP任务中的文本预处理步骤、工具和示例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/SEcNnQO5cGc6EE><p>作者 | Viet Hoang Tran Duong</p><p>来源 | DeepHub IMBA</p><p>头图 | CSDN付费下载于视觉中国</p><p>数据是新的石油，文本是我们需要更深入钻探的油井。文本数据无处不在，在实际使用之前，我们必须对其进行预处理，以使其适合我们的需求。对于数据也是如此，我们必须清理和预处理数据以符合我们的目的。这篇文章将包括一些简单的方法来清洗和预处理文本数据以进行文本分析任务。</p><p>我们将在Covid-19 Twitter数据集上对该方法进行建模。这种方法有3个主要组成部分：</p><p>首先，我们要清理和过滤所有非英语的推文/文本，因为我们希望数据保持一致。</p><p>其次，我们为复杂的文本数据创建一个简化的版本。</p><p>最后，我们将文本向量化并保存其嵌入以供将来分析。</p><img alt=NLP任务中的文本预处理步骤、工具和示例 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/SEcNnS282M9iw3><img alt=NLP任务中的文本预处理步骤、工具和示例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RqMqLxPCXik3SR><p></p><h1 toutiao-origin=h2>清理和过滤文本</h1><p>首先，为了简化文本，我们要将文本标准化为仅为英文字符。此函数将删除所有非英语字符。</p><pre><div><pre><div><pre><code>def clean_non_english(txt):<br>txt = re.sub(r'\W+', ' ', txt)<br>txt = txt.lower<br>txt = txt.replace("[^a-zA-Z]", " ")<br>word_tokens = word_tokenize(txt)<br>filtered_word = [w for w in word_tokens if all(ord(c) &lt; 128 for c in w)]<br>filtered_word = [w + " " for w in filtered_word]<br>return "".join(filtered_word)</code></pre></div></pre></div></pre><p>我们甚至可以通过删除停止词来做得更好。停词是出现在英语句子中对意思没有多大帮助的常见词。我们将使用nltk包来过滤stopwords。由于我们的主要任务是使用word cloud将tweet的主题可视化，所以这一步需要避免使用“the，”“a，”等常见单词。但是，如果你的任务需要完整的句子结构，比如下一个单词预测或语法检查，你可以跳过这一步。</p><pre><div><pre><div><pre><code>import nltk<br>nltk.download('punkt') # one time execution<br>nltk.download('stopwords')<br>from nltk.corpus import stopwords<br>stop_words = set(stopwords.words('english'))def clean_text(english_txt):<br>try:<br>word_tokens = word_tokenize(english_txt)<br>filtered_word = [w for w in word_tokens if not w in stop_words]<br>filtered_word = [w + " " for w in filtered_word]<br>return "".join(filtered_word)<br>except:<br>return np.nan</code></pre></div></pre></div></pre><p>对于tweets，在清理之前我们需要考虑一个特殊的特性:提及@。您的数据可能具有这样的特殊特性(也可能没有)，这是具体情况，而不是普遍要求。因此，在盲目地清理和预处理数据之前，要充分了解您的数据!</p><pre><code>def get_mention(txt):<br>mention = <br>for i in txt.split(" "):<br>if len(i) &gt; 0 and i[0] == "@":<br>mention.append(i)<br>return "".join([mention[i] + ", " if i != len(mention) - 1 else mention[i] for i in range(len(mention))]<br></code></pre><p>以前，我们清理非英文字符。现在，我们删除非英语文本(语义上)。Langdetect是一个python包，它允许检查文本的语言。它是谷歌的语言检测库从Java到Python的直接端移植。</p><pre><div><pre><code>from langdetect import detect<br>def detect_lang(txt):<br>try:<br>return detect(txt)<br>except:<br>return np.nan</code></pre></div></pre><p>然后我们过滤掉所有不是“en”语言的列。</p><img alt=NLP任务中的文本预处理步骤、工具和示例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RqMqLy93x95UEx><p><strong class=highlight-text toutiao-origin=span>简化复杂的数据</strong></p><p>对于数值数据，良好的处理方法是缩放，标准化和规范化。此资源有助于理解并将这些方法应用于您的数据。在本文的讨论范围内，由于其他资源在此方面做得很好，因此我将不做进一步讨论。</p><p>对于分类数据，有许多方法。两种名义上的方法是标签编码器（为每个标签分配一个不同的编号）和一种热编码（以0和1的向量表示）。有关这些分类值的方法的更多详细信息，请参见此处。与我提到的这两种资源相比，此资源非常丰富，具有更多类型的编码。</p><p>这篇文章将介绍一些减少数据特别是位置数据复杂性的方法。在我的数据集中，有一列位置，带有作者的地址。但是，由于这些原始数据过于混乱和复杂（具有城市，县，州，国家/地区），因此我无法对其进行太多分析。因此，我们可以将文本标准化，并将其缩小到“国家”级别。处理位置数据的程序包是geopy。它可以识别正确的地址并将这些位置重新格式化为标准格式。然后，您可以选择保留所需的任何信息。对我来说，国家，国家足够体面。</p><pre><div><pre><code>from geopy.geocoders import Nominatim<br>geolocator = Nominatim(user_agent="twitter")def get_nation(txt):<br>try:<br>location = geolocator.geocode(txt)<br>x = location.address.split(",")[-1]<br>return x<br>except:<br>return np.nan<br></code></pre></div><br></pre><img alt=NLP任务中的文本预处理步骤、工具和示例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RqMqMYY7LcGio6><p></p><h1 toutiao-origin=h2>向量化和嵌入</h1><p>文本向量化将文本转换为值的向量以表示其含义。早些时候，我们有一种热编码方法，其向量的大小与我们的词汇量相同，在出现文本的任何地方都为1，在其他地方为0。如今，我们拥有更高级的方法，例如spacy，GloVe甚至bert嵌入。对于本项目的范围，我将向您介绍python和Jupiter笔记本中的GloVe。</p><p>首先，我们下载嵌入向量。您可以在此处手动下载或直接在笔记本中进行下载。</p><pre><div><pre><code>!wget http://nlp.stanford.edu/data/glove.6B.zip<br>!unzip glove*.zip</code></pre></div></pre><p>然后，我们创建一个向量矢量化每个数据点的函数。句子是每个单词的平均表示。对于空句子，我们将其默认为零向量。</p><pre><div><pre><code>def vectorize(value, word_embeddings, dim = 100):<br>sentences = value.to_list<br>sentence_vectors = <br>for i in sentences:<br>if len(i) != 0:<br>v = sum([word_embeddings.get(w, np.zeros((dim,))) for w in i.split()])/(len(i.split)+0.001)<br>else:<br>v = np.zeros((dim,))<br>sentence_vectors.append(v)<br>sentence_vectors = np.array(sentence_vectors)<br>return sentence_vectors</code></pre></div></pre><p>最后，我们对整个数据集进行矢量化处理，并将矢量化的numpy数组另存为文件，因此我们不必在每次运行代码时都再次进行此过程。矢量化版本将以.npy文件的形式保存为numpy数组。Numpy包方便存储和处理海量数组数据。</p><p>作为我的个人标准做法，我尝试将每个部分之后的所有数据保存为单独的文件，以评估数据并更灵活地更改代码。</p><pre><div><pre><code>def vectorize_data(data = data, value = 'english_text', dim = 100):<br># Extract word vectors<br>word_embeddings = {}<br>f = open('glove.6B.{}d.txt'.format(str(dim)), encoding='utf-8')<br>for line in f:<br>values = line.split<br>word = values[0]<br>coefs = np.asarray(values[1:], dtype='float32')<br>word_embeddings[word] = coefs<br>f.close text_vec = vectorize(data[value], word_embeddings, dim)<br>np.save("vectorized_{}.npy".format(str(dim)), text_vec)<br>print("Done. Data:", text_vec.shape)<br>return True<br></code></pre></div><br></pre><img alt=NLP任务中的文本预处理步骤、工具和示例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RqMqMZM85xvsbJ><p></p><h1 toutiao-origin=h2>总结</h1><p>数据预处理，特别是文本预处理，可能是一个非常麻烦的过程。机器学习工程师工作流程的很大一部分将用于这些清理和格式化数据（如果您的数据已经完全清理好了，那么，幸运的是，对于所有实现这一目标的工程师来说，他们都感到很荣幸）。</p><p>这篇文章中的所有代码都是非常抽象的，可以应用于许多数据项目（您只需更改列名，所有代码都可以正常工作）。在笔记本中，我还添加了异常功能来处理故障情况，以确保您的代码不会在中途崩溃。我希望它对您的项目有帮助，就像对我的帮助一样。</p><p>最后，所有的代码可以在这里找到：</p><p><strong toutiao-origin=em>https://github.com/viethoangtranduong/covid19-tweets</strong></p><img alt=NLP任务中的文本预处理步骤、工具和示例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/R69FpRH4d90a7d><img alt=NLP任务中的文本预处理步骤、工具和示例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/SEcNnBuCwlcZyE></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'示例','NLP','任务中'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>