<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Android气泡对话框-HappyBubble（根据被点击View位置显示定制） | 极客快訊</title><meta property="og:title" content="Android气泡对话框-HappyBubble（根据被点击View位置显示定制） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/d694982a8bb34d7eb5cc5b3320970e35"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/03808b57.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/03808b57.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/03808b57.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/03808b57.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/03808b57.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/03808b57.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/03808b57.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/03808b57.html><meta property="article:published_time" content="2020-11-14T21:01:56+08:00"><meta property="article:modified_time" content="2020-11-14T21:01:56+08:00"><meta name=Keywords content><meta name=description content="Android气泡对话框-HappyBubble（根据被点击View位置显示定制）"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/03808b57.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Android气泡对话框-HappyBubble（根据被点击View位置显示定制）</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>HappyBubble</h1><p><br></p><div class=pgc-img><img alt=Android气泡对话框-HappyBubble（根据被点击View位置显示定制） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d694982a8bb34d7eb5cc5b3320970e35><p class=pgc-img-caption>HappyBubble</p></div><p><br></p><p>Github: https://github.com/xujiaji/HappyBubble</p><p>气泡布局的形状可以改变，如四角弧度、气泡颜色、箭头大小和阴影。</p><p>气泡Dialog可以根据被点击的view的位置来确定自己展示的位置。</p><h2 class=pgc-h-arrow-right>更新</h2><ul><li>1.1.9: 修复初始位置偏移；新增通过x，y座标显示HappyDialog</li><li>1.1.8: 修复当设置透明背景时，状态栏文字颜色可能变白色问题</li><li>1.1.7: 修复位置问题，修复autoPosition无效问题，修复横屏模式问题。#13#11#10</li><li>1.1.6:<br>新增方向优先级:issues/9</li><li>1.1.5:<br>修复:issues/8</li><li>1.1.4：<br>①新增方法setLayout(int width, int height, int margin)，width（设置气泡的宽）、height（设置气泡的高）、margin（设置距离屏幕边缘的间距,只有当设置width或height为MATCH_PARENT才有效）。<br>②autoPosition(true)方法准备弃用（现在还可以用），使用新方法autoPosition(Auto),如果两个都使用了会直接用autoPosition(Auto)。请参考下方“方法参考表”。<br>③感谢@wolf8088521提供建议#4</li><li>1.1.3：<br>①通过重新调用setClickedView可以直接更新当前dialog的所在位置。<br>②新添加setRelativeOffset(int)方法，设置dialog相对于被点击View的偏移（负值：向被点击view的中心偏移；正值：向被点击view的外侧偏移）<br>③测试页面SetClickedViewTestActivity.java</li></ul><div class=pgc-img><img alt=Android气泡对话框-HappyBubble（根据被点击View位置显示定制） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/67171d44e379403c93ab545cfc1177f8><p class=pgc-img-caption>列表测试</p></div><ul><li>1.1.2：修复默认值没有适配屏幕</li><li>1.1.1：修复大小变化后，没有对应变化位置的问题；修复接触顶部偏位问题；</li><li>1.1.0：①Dialog交互事件传递到Activity达到不在不关闭Dialog的情况下做其他Activity的操作。②添加自动根据被点击View距离屏幕边缘的距离确定Dialog的位置。③新增“autoPosition”和“setThroughEvent”方法，请参考“BubbleDialog方法参考表”</li><li>1.0.3:继续优化了点击在气泡之外才会被dismiss；修复了Dialog周围会有部分点击无法dismiss；</li><li>1.0.2:修复点击dialog边缘无法取消</li></ul><h2 class=pgc-h-arrow-right>哪些app使用了它？</h2><p>玩清单</p><p><br></p><div class=pgc-img><img alt=Android气泡对话框-HappyBubble（根据被点击View位置显示定制） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6f72013f58e647b0b06205a6229b5753><p class=pgc-img-caption>玩清单</p></div><p><br></p><h2 class=pgc-h-arrow-right>如何开始？</h2><p>在你模块中的build.gradle添加上HappyBubble依赖</p><pre><code>implementation 'com.github.xujiaji:happy-bubble:1.1.9'</code></pre><h2 class=pgc-h-arrow-right>如何使用 HappyBubble-BubbleDialog？</h2><blockquote><p>方法参考表</p></blockquote><p><br></p><div class=pgc-img><img alt=Android气泡对话框-HappyBubble（根据被点击View位置显示定制） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b46b31c0bb4641daa43a126c59d31dcc><p class=pgc-img-caption>方法参考表</p></div><h3 class=pgc-h-arrow-right>最简单的实现</h3><div class=pgc-img><img alt=Android气泡对话框-HappyBubble（根据被点击View位置显示定制） onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/6a6c7c0e01db42ce87d0d935a72dc642><p class=pgc-img-caption>简单实现</p></div><div class=pgc-img><img alt=Android气泡对话框-HappyBubble（根据被点击View位置显示定制） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/533f2a073f764dda91f60c96e34d0874><p class=pgc-img-caption>多文字</p></div><pre><code>new BubbleDialog(this)        .addContentView(LayoutInflater.from(this).inflate(R.layout.dialog_view3, null))        .setClickedView(mButton)        .show();</code></pre><h3 class=pgc-h-arrow-right>向下偏移8dp</h3><div class=pgc-img><img alt=Android气泡对话框-HappyBubble（根据被点击View位置显示定制） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6f5792b194a64875bedd2fb6f0d27458><p class=pgc-img-caption>向下偏移的</p></div><pre><code>new BubbleDialog(this)        .addContentView(LayoutInflater.from(this).inflate(R.layout.dialog_view3, null))        .setClickedView(mButton4)        .setPosition(mPosition)        .setOffsetY(8)        .show();</code></pre><h3 class=pgc-h-arrow-right>当想要输入框随软键盘上移时</h3><div class=pgc-img><img alt=Android气泡对话框-HappyBubble（根据被点击View位置显示定制） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/414a099c0a6a49a2888bf7b11d6dee00><p class=pgc-img-caption>键盘出来的</p></div><pre><code>new BubbleDialog(this)        .addContentView(LayoutInflater.from(this).inflate(R.layout.dialog_view, null))        .setClickedView(mButton12)        .setPosition(mPosition)        .softShowUp()        .show();</code></pre><h3 class=pgc-h-arrow-right>自定义 BubbleLayout</h3><div class=pgc-img><img alt=Android气泡对话框-HappyBubble（根据被点击View位置显示定制） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/395cd45a22ac437294d02e9fc96e2164><p class=pgc-img-caption>自定义气泡样式</p></div><p><br></p><pre><code>BubbleLayout bl = new BubbleLayout(this);bl.setBubbleColor(Color.YELLOW);bl.setShadowColor(Color.RED);bl.setLookLength(Util.dpToPx(this, 18));bl.setLookWidth(Util.dpToPx(this, 24));bl.setBubbleRadius(Util.dpToPx(this, 3));new BubbleDialog(this)        .addContentView(LayoutInflater.from(this).inflate(R.layout.dialog_view5, null))        .setClickedView(mButton8)        .setPosition(mPosition)        .setBubbleLayout(bl)        .show();</code></pre><h3 class=pgc-h-arrow-right>自定义 BubbleDialog，可交互的 BubbleDialog</h3><div class=pgc-img><img alt=Android气泡对话框-HappyBubble（根据被点击View位置显示定制） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8730a192ad32417c9e0b4084095ae6ce><p class=pgc-img-caption>交互后变化了</p></div><blockquote><p>1、布局</p><p><br></p></blockquote><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"    android:layout_width="160dp"    android:layout_height="match_parent"    android:orientation="vertical"&gt;    &lt;Button        android:id="@+id/button13"        android:layout_width="match_parent"        android:layout_height="wrap_content"        android:text="Button1" /&gt;    &lt;Button        android:id="@+id/button14"        android:layout_width="match_parent"        android:layout_height="wrap_content"        android:text="Button2" /&gt;    &lt;Button        android:id="@+id/button15"        android:layout_width="match_parent"        android:layout_height="wrap_content"        android:text="Button3" /&gt;&lt;/LinearLayout&gt;</code></pre><blockquote><p>2、自定义 BubbleDialog</p></blockquote><pre><code>/** * 自定义可操作性dialog * Created by JiajiXu on 17-12-11. */public class CustomOperateDialog extends BubbleDialog implements View.OnClickListener{    private ViewHolder mViewHolder;    private OnClickCustomButtonListener mListener;    public CustomOperateDialog(Context context)    {        super(context);        setTransParentBackground();        setPosition(Position.TOP);        View rootView = LayoutInflater.from(context).inflate(R.layout.dialog_view4, null);        mViewHolder = new ViewHolder(rootView);        addContentView(rootView);        mViewHolder.btn13.setOnClickListener(this);        mViewHolder.btn14.setOnClickListener(this);        mViewHolder.btn15.setOnClickListener(this);    }    @Override    public void onClick(View v)    {        if (mListener != null)        {            mListener.onClick(((Button)v).getText().toString());        }    }    private static class ViewHolder    {        Button btn13, btn14, btn15;        public ViewHolder(View rootView)        {            btn13 = rootView.findViewById(R.id.button13);            btn14 = rootView.findViewById(R.id.button14);            btn15 = rootView.findViewById(R.id.button15);        }    }    public void setClickListener(OnClickCustomButtonListener l)    {        this.mListener = l;    }    public interface OnClickCustomButtonListener    {        void onClick(String str);    }}</code></pre><blockquote><p>3、显示</p></blockquote><pre><code>CustomOperateDialog codDialog = new CustomOperateDialog(this)        .setPosition(mPosition)        .setClickedView(mButton10);codDialog.setClickListener(new CustomOperateDialog.OnClickCustomButtonListener(){    @Override    public void onClick(String str)    {        mButton10.setText("点击了：" + str);    }});codDialog.show();</code></pre><h3 class=pgc-h-arrow-right>查看关于BappyDialog的使用代码</h3><p>TestDialogActivity 代码</p><h3 class=pgc-h-arrow-right>写法建议</h3><p>根据@hm该朋友在文章中反馈的多次点击后位置不对的问题，是由于多次对BappyDialog进行了设置导致，所以建议下方写法。(当然如果对重复调用setClickedView()方法设置不同的被点击的控件来更新位置有需要，是需要写在外面的。)</p><pre><code>if(mBubbleDialog == null){    mBubbleDialog = new BubbleDialog(this)        .addContentView(LayoutInflater.from(this).inflate(R.layout.dialog_view3, null))        .setClickedView(mButton4)        .setPosition(mPosition)        .setOffsetY(8);}mBubbleDialog.show();</code></pre><hr><h2 class=pgc-h-arrow-right>如何使用 HappyBubble-BubbleLayout？</h2><h3 class=pgc-h-arrow-right>在XML代码中设置属性值</h3><blockquote><p>属性参照表</p></blockquote><p>属性值描述lookAtleft, top, right, bottom箭头指向lookLengthdimension箭头的长度lookPositiondimension箭头相对于x或y轴的位置lookWidthdimension箭头的宽度bubbleColorcolor气泡的颜色bubbleRadiusdimension气泡四角的圆弧bubblePaddingdimension气泡边缘到BubbleLayout边缘的距离shadowRadiusdimension阴影的扩散大小shadowXdimension阴影在x轴方向的偏移shadowYdimension阴影在y轴方向的偏移shadowColorcolor阴影的颜色</p><blockquote><p>xml 例子</p></blockquote><pre><code>&lt;com.xujiaji.happybubble.BubbleLayout    xmlns:app="http://schemas.android.com/apk/res-auto"    android:id="@+id/bubbleLayout"    android:layout_width="match_parent"    android:layout_height="200dp"    android:layout_margin="16dp"    app:lookAt="left"    app:lookLength="16dp"    app:lookPosition="20dp"    app:lookWidth="16dp" /&gt;</code></pre><h3 class=pgc-h-arrow-right>在java代码中定义属性值</h3><blockquote><p>BubbleLayout 通过“set属性名”方法和invalidate方法来更新BubbleLayout。</p></blockquote><pre><code>mBubbleLayout.setLook(BubbleLayout.Look.LEFT);</code></pre><blockquote><p>查看更多</p></blockquote><p>MainActivity 代码</p><div class=pgc-img><img alt=Android气泡对话框-HappyBubble（根据被点击View位置显示定制） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5537d48b61854ef7ab104b5011edad6b><p class=pgc-img-caption>气泡布局详情</p></div><h3 class=pgc-h-arrow-right>demo 下载</h3><p><br></p><p>https://github.com/xujiaji/HappyBubble/releases/tag/demoApk</p><hr><h1 class=pgc-h-arrow-right>License</h1><pre><code>Copyright 2016 XuJiajiLicensed under the Apache License, Version 2.0 (the "License");you may not use this file except in compliance with the License.You may obtain a copy of the License at    http://www.apache.org/licenses/LICENSE-2.0Unless required by applicable law or agreed to in writing, softwaredistributed under the License is distributed on an "AS IS" BASIS,WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.See the License for the specific language governing permissions andlimitations under the License.</code></pre><ul><li><strong>本文作者:</strong>xujiaji</li><li><strong>版权声明:</strong>Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)</li><li><strong>本文链接:</strong>https://blog.xujiaji.com/post/happy-bubble/</li></ul></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Android','气泡','HappyBubble'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>