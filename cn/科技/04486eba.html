<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Pythonçˆ¬è™«ä½¿ç”¨seleniumçˆ¬å–ç¾¤æˆå‘˜ä¿¡æ¯ï¼ˆå…¨è‡ªåŠ¨å®ç°è‡ªåŠ¨ç™»é™†ï¼‰ | æå®¢å¿«è¨Š</title><meta property="og:title" content="Pythonçˆ¬è™«ä½¿ç”¨seleniumçˆ¬å–ç¾¤æˆå‘˜ä¿¡æ¯ï¼ˆå…¨è‡ªåŠ¨å®ç°è‡ªåŠ¨ç™»é™†ï¼‰ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/e11e69f643584941aaa2b71ee6ed3d7f"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/04486eba.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/04486eba.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/04486eba.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/04486eba.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/04486eba.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/04486eba.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/04486eba.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/04486eba.html><meta property="article:published_time" content="2020-11-14T21:07:40+08:00"><meta property="article:modified_time" content="2020-11-14T21:07:40+08:00"><meta name=Keywords content><meta name=description content="Pythonçˆ¬è™«ä½¿ç”¨seleniumçˆ¬å–ç¾¤æˆå‘˜ä¿¡æ¯ï¼ˆå…¨è‡ªåŠ¨å®ç°è‡ªåŠ¨ç™»é™†ï¼‰"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/04486eba.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Pythonçˆ¬è™«ä½¿ç”¨seleniumçˆ¬å–ç¾¤æˆå‘˜ä¿¡æ¯ï¼ˆå…¨è‡ªåŠ¨å®ç°è‡ªåŠ¨ç™»é™†ï¼‰</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p><strong>å‰è¨€</strong></p><p>æœ¬æ–‡çš„æ–‡å­—åŠå›¾ç‰‡æ¥æºäºç½‘ç»œ,ä»…ä¾›å­¦ä¹ ã€äº¤æµä½¿ç”¨,ä¸å…·æœ‰ä»»ä½•å•†ä¸šç”¨é€”,ç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰,å¦‚æœ‰é—®é¢˜è¯·åŠæ—¶è”ç³»æˆ‘ä»¬ä»¥ä½œå¤„ç†ã€‚</p><p>ä½œè€…ï¼š pythonå°çˆ¬è™«</p><p>PSï¼šå¦‚æœ‰éœ€è¦Pythonå­¦ä¹ èµ„æ–™çš„å°ä¼™ä¼´å¯ä»¥åŠ ç‚¹å‡»ä¸‹æ–¹é“¾æ¥è‡ªè¡Œè·å–</p><p>http://note.youdao.com/noteshare?id=3054cce4add8a909e784ad934f956cef</p><ol start=0><li>æ•ˆæœå›¾ï¼Œå…¶ä¸­æ¶‰åŠä¸€äº›çœŸåæˆ‘å°±æ‰“ç äº†ï¼Œè¿˜æœ‰qqå·æˆ‘ä¹Ÿæ‰“ç äº†ï¼Œè§è°…</li><li>åˆ†æç™»é™†çš„å…ƒç´ ï¼Œä¸‹å›¾ä¸€ç›®äº†ç„¶ï¼Œæ€ä¹ˆè·å–è¿™ä¸ªç™»é™†å…ƒç´ åº”è¯¥éƒ½çŸ¥é“äº†</li><li>ä»£ç å¥‰ä¸Š</li></ol><pre>url = 'https://qun.qq.com/'# æ„å»ºè°·æ­Œé©±åŠ¨å™¨browser = webdriver.Chrome()# è¯·æ±‚urlbrowser.get(url)# æ¨¡æ‹Ÿç™»é™†ï¼Œé¦–å…ˆæ‰¾åˆ°ç™»é™†çš„idï¼Œå¹¶ç‚¹å‡»browser.find_element_by_css_selector('#headerInfo p a').click()</pre><ol start=4><li>ç‚¹å‡»ä¹‹åå‡ºç°è¿™ä¹ˆä¸€ä¸ªæ¡†æ¡†ï¼ˆè¿™ä¸ªæ¡†æ¡†å¯æŠŠæˆ‘æŠ˜ç£¨çš„é˜¿ï¼‰åŸå› æ˜¯è¿™æ ·çš„ï¼Œå¯»å¸¸çš„è·å–è¿™ä¸ªæ¡†æ¡†æ˜¯ä¸èƒ½è·å–åˆ°çš„</li></ol><p>5.å…ˆçœ‹çœ‹è¿™ä¸ªæ¡†æ‰€åœ¨çš„ä½ç½®ï¼Œè¿™ä¸ªæ¡†æ¡†ç«Ÿç„¶åœ¨å¦ä¸€ä¸ªhtmlä»£ç é‡Œé¢ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æµè§ˆå™¨çœ‹çš„æ—¶å€™ï¼Œå‡ºç°äº†ä¸¤ä¸ªhtmlæ ‡ç­¾ï¼Œè€å®è¯´ï¼Œæˆ‘æ˜¯ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ç§æƒ…å†µçš„ï¼Œå¥ˆä½•æˆ‘çš„htmlä¹Ÿä¸å¥½ï¼Œè¿å…¥é—¨éƒ½ç®—ä¸ä¸Šï¼Œæ²¡åŠæ³•ï¼Œæˆ‘å°±å»ç™¾åº¦äº†ï¼Œæœç„¶é»„å¤©ä¸è´Ÿæœ‰å¿ƒäººï¼Œè¯´æ˜¯å› ä¸ºiframeè¿™ä¸ªæ ‡ç­¾å¯ä»¥å†æ”¾htmlä»£ç ï¼Œæ‰€ä»¥å°±æ˜¯è¿™ç§æƒ…å†µäº†</p><div class=pgc-img><img alt=Pythonçˆ¬è™«ä½¿ç”¨seleniumçˆ¬å–ç¾¤æˆå‘˜ä¿¡æ¯ï¼ˆå…¨è‡ªåŠ¨å®ç°è‡ªåŠ¨ç™»é™†ï¼‰ onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/e11e69f643584941aaa2b71ee6ed3d7f><p class=pgc-img-caption></p></div><ol start=5><li>æ—¢ç„¶çŸ¥é“äº†æ˜¯æ€ä¹ˆä¸€å›äº‹ä¹‹åï¼Œé‚£å°±å¯ä»¥ç»§ç»­æ“ä½œäº†ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆæ‰¾åˆ°iframeè¿™ä¸ªæ ‡ç­¾ï¼Œç„¶åè·å–å®ƒçš„srcå±æ€§ï¼Œè¿™ä¸ªé“¾æ¥å°±æ˜¯è¿™ä¸ªæ¡†æ¡†ç™»é™†çš„é“¾æ¥äº†ï¼Œå¦‚æœä¸è·å–è¿™ä¸ªiframeæ ‡ç­¾çš„srcå±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨seleniumæ˜¯è·å–ä¸åˆ°è¿™ä¸ªæ¡†æ¡†çš„å…ƒç´ çš„ã€‚</li></ol><pre># ç‚¹å‡»ä¹‹åä¼šå¼¹å‡ºä¸€ä¸ªç™»é™†æ¡†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ç”¨æ˜¾ç¤ºç­‰å¾…æ¥ç­‰å¾…è¿™ä¸ªç™»é™†æ¡†åŠ è½½å‡ºæ¥WebDriverWait(browser, 1000).until( EC.presence_of_all_elements_located( (By.CSS_SELECTOR, '#loginWin iframe') ))print('ç™»é™†æ¡†å·²åŠ è½½')# ç™»é™†æ¡†åŠ è½½ä¹‹åï¼Œæˆ‘ä»¬å‘ç°æ•´ä¸ªç™»é™†æ¡†å…¶å®å°±æ˜¯å¦ä¸€ä¸ªç½‘ç½‘é¡µ# å¦‚æœåœ¨åŸç½‘é¡µæ“ä½œè¿™ä¸ªç™»é™†æ¡†çš„è¯ï¼Œæ˜¯ä¸èƒ½æ“ä½œçš„# æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æå–iframeæ ‡ç­¾çš„srcå±æ€§ï¼Œç„¶åå†å»è®¿é—®è¿™ä¸ªurlå³å¯å®ç°# è‡ªåŠ¨ç™»é™†# æ‰¾åˆ°iframeæ ‡ç­¾å¹¶è·å–srciframe_url = browser.find_element_by_css_selector('#loginWin iframe').get_attribute('src')# å†è®¿é—®è¿™ä¸ªurlbrowser.get(iframe_url)# æ‰¾åˆ°å¿«æ·ç™»é™†çš„å¤´åƒå¹¶ç‚¹å‡»# é¦–å…ˆç”¨æ˜¾ç¤ºç­‰å¾…è¿™ä¸ªå¤´åƒå·²ç»åŠ è½½å®ŒæˆWebDriverWait(browser, 1000).until( EC.presence_of_all_elements_located( (By.ID, 'qlogin_list') ))browser.find_element_by_css_selector('#qlogin_list a').click()print('ç™»é™†æˆåŠŸ')</pre><ol start=7><li>ç™»é™†æˆåŠŸä¹‹åæˆ‘ä»¬éœ€è¦çš„æ˜¯ç¾¤ç®¡ç†ï¼Œæ˜¯ulæ ‡ç­¾çš„ç¬¬å››ä¸ªliæ ‡ç­¾ï¼Œé€šè¿‡xpathè·å–</li></ol><pre># ç™»é™†æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬å°±æ‰¾åˆ°ç¾¤ç®¡ç†çš„æ ‡ç­¾å¹¶ç‚¹å‡»,é¦–å…ˆç­‰å¾…è¿™ä¸ªå…ƒç´ åŠ è½½å®ŒæˆWebDriverWait(browser, 1000).until( EC.presence_of_all_elements_located( (By.XPATH, './/ul[@id="headerNav"]/li[4]') ))browser.find_element_by_xpath('.//ul[@id="headerNav"]/li[4]').click()</pre><p>8.ç‚¹å‡»ç¾¤ç®¡ç†ä¹‹åï¼Œè¿›å…¥ç¾¤ç®¡ç†ç•Œé¢ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯æˆå‘˜ç®¡ç†</p><div class=pgc-img><img alt=Pythonçˆ¬è™«ä½¿ç”¨seleniumçˆ¬å–ç¾¤æˆå‘˜ä¿¡æ¯ï¼ˆå…¨è‡ªåŠ¨å®ç°è‡ªåŠ¨ç™»é™†ï¼‰ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b688405faac9489497041e3306a49af4><p class=pgc-img-caption></p></div><pre># ç‚¹å‡»ä¹‹åï¼Œæˆ‘ä»¬æ‰¾åˆ°æˆå‘˜ç®¡ç†æ ‡ç­¾å¹¶ç‚¹å‡»WebDriverWait(browser, 1000).until( EC.presence_of_all_elements_located( (By.CLASS_NAME, 'color-tit') ))browser.find_element_by_class_name('color-tit').click()</pre><p>9.ç‚¹å‡»æˆå‘˜ç®¡ç†ä¹‹åä¼šé‡æ–°æ–°å»ºä¸€ä¸ªçª—å£ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå‡ºç°å¥æŸ„ï¼Œæˆ‘ä»¬éœ€è¦å°†å½“ç„¶çª—å£çš„å¥æŸ„åˆ‡æ¢åˆ°æ–°æ‰“å¼€çš„è¿™ä¸ªç•Œé¢ï¼Œä¸ç„¶çš„è¯ï¼Œæ˜¯è·å–ä¸åˆ°æ–°æ‰“å¼€ç•Œé¢çš„ä¿¡æ¯çš„ï¼Œæ³¨é‡Šå·²ç»å†™äº†</p><div class=pgc-img><img alt=Pythonçˆ¬è™«ä½¿ç”¨seleniumçˆ¬å–ç¾¤æˆå‘˜ä¿¡æ¯ï¼ˆå…¨è‡ªåŠ¨å®ç°è‡ªåŠ¨ç™»é™†ï¼‰ onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/20c6aa3808de4890b2a16d4c9f0b6c51><p class=pgc-img-caption></p></div><pre># æ‰“å°å…¨éƒ¨çª—å£å¥æŸ„# print(browser.window_handles)# æ‰“å°å½“å‰çª—å£å¥æŸ„# print(browser.current_window_handle)# æ³¨æ„è¿™é‡Œç‚¹å‡»æˆå‘˜ç®¡ç†ä¹‹åä¼šè‡ªåŠ¨è·³è½¬åˆ°ä¸€ä¸ªæ–°çª—å£æ‰“å¼€è¿™ä¸ªé¡µé¢# æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†çª—å£å¥æŸ„åˆ‡æ¢åˆ°è¿™ä¸ªæ–°çª—å£browser.switch_to.window(browser.window_handles[1])# è§£é‡Šä¸€ä¸‹browser.switch_to.windowæ˜¯è·å–å½“å‰ä¸€å…±æœ‰å‡ ä¸ªçª—å£# è¿™é‡Œæ˜¯2ä¸ª# browser.switch_to.windowè¿™ä¸ªæ˜¯æŒ‡å®šå½“å‰æ¸¸æ ‡åˆ‡æ¢åˆ°å“ªä¸ªçª—å£# å…¶å®ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™# all_window = browser.switch_to.windowè¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨# browser.switch_to.window(all_window[1])# æ•ˆæœæ˜¯ä¸€æ ·çš„</pre><p>10.æˆ‘ä»¬éœ€è¦çš„æ˜¯æˆ‘åŠ å…¥çš„ç¾¤ä¿¡æ¯</p><div class=pgc-img><img alt=Pythonçˆ¬è™«ä½¿ç”¨seleniumçˆ¬å–ç¾¤æˆå‘˜ä¿¡æ¯ï¼ˆå…¨è‡ªåŠ¨å®ç°è‡ªåŠ¨ç™»é™†ï¼‰ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/12409e6a5bb442b485e7bfe9e67b6f83><p class=pgc-img-caption></p></div><pre># åˆ‡æ¢å¥æŸ„ä¹‹åï¼Œæˆ‘ä»¬æ˜¾ç¤ºç­‰å¾…çª—å£å‡ºæ¥ WebDriverWait(browser, 1000).until( EC.presence_of_all_elements_located( (By.CLASS_NAME, 'my-all-group') ) ) # ç­›é€‰å‡ºæˆ‘åŠ å…¥çš„ç¾¤æ ‡ç­¾ lis = browser.find_elements_by_xpath('.//div[@class="my-all-group"]/ul[2]/li')</pre><p>11.éå†åˆ—è¡¨ï¼Œå–å‡ºä¿¡æ¯</p><pre># éå†num= 0while True: if num == len(lis): break try: # æŒ‰é¡ºåºé€‰æ‹©ç¾¤å¹¶è·å–ä¿¡æ¯ # å…ˆç‚¹å‡»è¯¥ç¾¤è·å–æˆå‘˜ä¿¡æ¯ lis[num].click() # æ˜¾ç¤ºç­‰å¾…ä¿¡æ¯åŠ è½½å®Œæˆ WebDriverWait(browser, 1000).until( EC.presence_of_all_elements_located( (By.CLASS_NAME, 'list') ) ) # è·å–è¯¥ç¾¤å½“å‰æœ‰å¤šå°‘äººï¼Œåé¢ç¿»é¡µéœ€è¦ groupMemberNum = eval(browser.find_element_by_id('groupMemberNum').text) # æ¯ä¸€æ¬¡ç¿»é¡µéƒ½ä¼šåˆ·æ–°21æ¡ä¿¡æ¯ï¼Œæ‰€ä»¥å†™ä¸ªå¾ªç¯ # è¿™é‡ŒåŠ 1æ˜¯å› ä¸ºå‡å¦‚ä¸€ä¸ªç¾¤æœ‰36äººï¼Œé‚£ä¹ˆcount=1ï¼Œå¦‚æœå¾ªç¯çš„è¯å°±ä¸ä¼šç¿»é¡µäº† # ä¹Ÿå°±æ˜¯åªèƒ½æŠ“åˆ°ä¸€é¡µçš„æ•°æ®ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±æƒ³æƒ³å…¶ä¸­çš„æµç¨‹å°±çŸ¥é“äº† count = groupMemberNum // 21 + 1 # è¿™é‡Œæˆ‘åªçˆ¬å–æ¯ä¸ªç¾¤çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœæƒ³çˆ¬å–å…¨éƒ¨æˆå‘˜ä¿¡æ¯ # è¯·æ³¨é‡Šä¸‹é¢çš„ifè¯­å¥ if count &gt; 2: count = 1 # æ¯æ¬¡å¾ªç¯éƒ½è¿›è¡Œç¿»é¡µ # while count: # count -= 1 # # browser.execute_script('document.documentElement.scrollTop=100000') # time.sleep(2) time.sleep(2) # å¼€å§‹è·å–æˆå‘˜ä¿¡æ¯ trs = browser.find_elements_by_class_name('mb') if trs: # éå† for tr in trs: tds = tr.find_elements_by_tag_name('td')[2:] if len(tds) == 8: # qqç½‘å qq_name = tds[0].text # ç¾¤åç§° group_name = tds[1].text # qqå· qq_number = tds[2].text # æ€§åˆ« gender = tds[3].text # qqå¹´é¾„ qq_year = tds[4].text # å…¥ç¾¤æ—¶é—´ join_time = tds[5].text # ç­‰çº§ï¼ˆç§¯åˆ†ï¼‰ level = None # æœ€åå‘è¨€æ—¶é—´ end_time = tds[6].text # å£°æ˜ä¸€ä¸ªå­—å…¸å­˜å‚¨æ•°æ® data_dict = {} data_dict['qq_name'] = qq_name data_dict['group_name'] = group_name data_dict['qq_number'] = qq_number data_dict['gender'] = gender data_dict['qq_year'] = qq_year data_dict['join_time'] = join_time data_dict['level'] = level data_dict['end_time'] = end_time print(data_dict) elif len(tds) == 9: # qqç½‘å qq_name = tds[0].text # ç¾¤åç§° group_name = tds[1].text # qqå· qq_number = tds[2].text # æ€§åˆ« gender = tds[3].text # qqå¹´é¾„ qq_year = tds[4].text # å…¥ç¾¤æ—¶é—´ join_time = tds[5].text # ç­‰çº§ï¼ˆç§¯åˆ†ï¼‰ level = tds[6].text # æœ€åå‘è¨€æ—¶é—´ end_time = tds[7].text # å£°æ˜ä¸€ä¸ªå­—å…¸å­˜å‚¨æ•°æ® data_dict = {} data_dict['qq_name'] = qq_name data_dict['group_name'] = group_name data_dict['qq_number'] = qq_number data_dict['gender'] = gender data_dict['qq_year'] = qq_year data_dict['join_time'] = join_time data_dict['level'] = level data_dict['end_time'] = end_time data_list.append(data_dict) print(data_dict) browser.find_element_by_id('changeGroup').click() time.sleep(3) WebDriverWait(browser, 1000).until( EC.presence_of_all_elements_located( (By.CLASS_NAME, 'ui-dialog') ) ) lis = browser.find_elements_by_xpath('.//div[@class="my-all-group"]/ul[2]/li') num += 1 except Exception as e: lis = browser.find_elements_by_xpath('.//div[@class="my-all-group"]/ul[2]/li') num += 1 continue</pre><p><strong>å®Œæ•´ä»£ç é™„ä¸Š</strong></p><pre># å¯¼å…¥éœ€è¦çš„åŒ…# çˆ¬å–qqç¾¤çš„æˆå‘˜ä¿¡æ¯from selenium import webdriverfrom selenium.webdriver.support.ui import WebDriverWaitfrom selenium.webdriver.support import expected_conditions as ECfrom selenium.webdriver.common.by import Byimport timeimport jsonimport csv# å¼€å§‹ç™»é™†def login_spider(): url = 'https://qun.qq.com/' # æ„å»ºè°·æ­Œé©±åŠ¨å™¨ browser = webdriver.Chrome() # è¯·æ±‚url browser.get(url) # æ¨¡æ‹Ÿç™»é™†ï¼Œé¦–å…ˆæ‰¾åˆ°ç™»é™†çš„idï¼Œå¹¶ç‚¹å‡» browser.find_element_by_css_selector('#headerInfo p a').click() # ç‚¹å‡»ä¹‹åä¼šå¼¹å‡ºä¸€ä¸ªç™»é™†æ¡†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ç”¨æ˜¾ç¤ºç­‰å¾…æ¥ç­‰å¾…è¿™ä¸ªç™»é™†æ¡†åŠ è½½å‡ºæ¥ WebDriverWait(browser, 1000).until( EC.presence_of_all_elements_located( (By.CSS_SELECTOR, '#loginWin iframe') ) ) print('ç™»é™†æ¡†å·²åŠ è½½') # ç™»é™†æ¡†åŠ è½½ä¹‹åï¼Œæˆ‘ä»¬å‘ç°æ•´ä¸ªç™»é™†æ¡†å…¶å®å°±æ˜¯å¦ä¸€ä¸ªç½‘ç½‘é¡µ # å¦‚æœåœ¨åŸç½‘é¡µæ“ä½œè¿™ä¸ªç™»é™†æ¡†çš„è¯ï¼Œæ˜¯ä¸èƒ½æ“ä½œçš„ # æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æå–iframeæ ‡ç­¾çš„srcå±æ€§ï¼Œç„¶åå†å»è®¿é—®è¿™ä¸ªurlå³å¯å®ç° # è‡ªåŠ¨ç™»é™† # æ‰¾åˆ°iframeæ ‡ç­¾å¹¶è·å–æ˜¯å¦‚æ­¤ç†Ÿæ‚‰ iframe_url = browser.find_element_by_css_selector('#loginWin iframe').get_attribute('src') # å†è®¿é—®è¿™ä¸ªurl browser.get(iframe_url) # æ‰¾åˆ°å¿«æ·ç™»é™†çš„å¤´åƒå¹¶ç‚¹å‡» # é¦–å…ˆç”¨æ˜¾ç¤ºç­‰å¾…è¿™ä¸ªå¤´åƒå·²ç»åŠ è½½å®Œæˆ WebDriverWait(browser, 1000).until( EC.presence_of_all_elements_located( (By.ID, 'qlogin_list') ) ) browser.find_element_by_css_selector('#qlogin_list a').click() print('ç™»é™†æˆåŠŸ') return browser# åˆ‡æ¢å¥æŸ„æ“ä½œdef switch_spider(browser): # ç™»é™†æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬å°±æ‰¾åˆ°ç¾¤ç®¡ç†çš„æ ‡ç­¾å¹¶ç‚¹å‡»,é¦–å…ˆç­‰å¾…è¿™ä¸ªå…ƒç´ åŠ è½½å®Œæˆ WebDriverWait(browser, 1000).until( EC.presence_of_all_elements_located( (By.XPATH, './/ul[@id="headerNav"]/li[4]') ) ) browser.find_element_by_xpath('.//ul[@id="headerNav"]/li[4]').click() # ç‚¹å‡»ä¹‹åï¼Œæˆ‘ä»¬æ‰¾åˆ°æˆå‘˜ç®¡ç†æ ‡ç­¾å¹¶ç‚¹å‡» WebDriverWait(browser, 1000).until( EC.presence_of_all_elements_located( (By.CLASS_NAME, 'color-tit') ) ) browser.find_element_by_class_name('color-tit').click() # æ‰“å°å…¨éƒ¨çª—å£å¥æŸ„ # print(browser.window_handles) # æ‰“å°å½“å‰çª—å£å¥æŸ„ # print(browser.current_window_handle) # æ³¨æ„è¿™é‡Œç‚¹å‡»æˆå‘˜ç®¡ç†ä¹‹åä¼šè‡ªåŠ¨è·³è½¬åˆ°ä¸€ä¸ªæ–°çª—å£æ‰“å¼€è¿™ä¸ªé¡µé¢ # æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†çª—å£å¥æŸ„åˆ‡æ¢åˆ°è¿™ä¸ªæ–°çª—å£ browser.switch_to.window(browser.window_handles[1]) # è§£é‡Šä¸€ä¸‹browser.switch_to.windowæ˜¯è·å–å½“å‰ä¸€å…±æœ‰å‡ ä¸ªçª—å£ # è¿™é‡Œæ˜¯2ä¸ª # browser.switch_to.windowè¿™ä¸ªæ˜¯æŒ‡å®šå½“å‰æ¸¸æ ‡åˆ‡æ¢åˆ°å“ªä¸ªçª—å£ # å…¶å®ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ # all_window = browser.switch_to.windowè¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨ # browser.switch_to.window(all_window[1]) # æ•ˆæœæ˜¯ä¸€æ ·çš„ return browser# å¼€å§‹é‡‡é›†æ•°æ®def start_spider(browser): # å£°æ˜ä¸€ä¸ªåˆ—è¡¨å­˜å‚¨å­—å…¸ data_list = [] # åˆ‡æ¢å¥æŸ„ä¹‹åï¼Œæˆ‘ä»¬æ˜¾ç¤ºç­‰å¾…çª—å£å‡ºæ¥ WebDriverWait(browser, 1000).until( EC.presence_of_all_elements_located( (By.CLASS_NAME, 'my-all-group') ) ) # ç­›é€‰å‡ºæˆ‘åŠ å…¥çš„ç¾¤æ ‡ç­¾ lis = browser.find_elements_by_xpath('.//div[@class="my-all-group"]/ul[2]/li') # éå† num = 0 while True: try: # æŒ‰é¡ºåºé€‰æ‹©ç¾¤å¹¶è·å–ä¿¡æ¯ # å…ˆç‚¹å‡»è¯¥ç¾¤è·å–æˆå‘˜ä¿¡æ¯ lis[num].click() # æ˜¾ç¤ºç­‰å¾…ä¿¡æ¯åŠ è½½å®Œæˆ WebDriverWait(browser, 1000).until( EC.presence_of_all_elements_located( (By.CLASS_NAME, 'list') ) ) # è·å–è¯¥ç¾¤å½“å‰æœ‰å¤šå°‘äººï¼Œåé¢ç¿»é¡µéœ€è¦ groupMemberNum = eval(browser.find_element_by_id('groupMemberNum').text) # æ¯ä¸€æ¬¡ç¿»é¡µéƒ½ä¼šåˆ·æ–°21æ¡ä¿¡æ¯ï¼Œæ‰€ä»¥å†™ä¸ªå¾ªç¯ # è¿™é‡ŒåŠ 1æ˜¯å› ä¸ºå‡å¦‚ä¸€ä¸ªç¾¤æœ‰36äººï¼Œé‚£ä¹ˆcount=1ï¼Œå¦‚æœå¾ªç¯çš„è¯å°±ä¸ä¼šç¿»é¡µäº† # ä¹Ÿå°±æ˜¯åªèƒ½æŠ“åˆ°ä¸€é¡µçš„æ•°æ®ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±æƒ³æƒ³å…¶ä¸­çš„æµç¨‹å°±çŸ¥é“äº† count = groupMemberNum // 21 + 1 # è¿™é‡Œæˆ‘åªçˆ¬å–æ¯ä¸ªç¾¤çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœæƒ³çˆ¬å–å…¨éƒ¨æˆå‘˜ä¿¡æ¯ # è¯·æ³¨é‡Šä¸‹é¢çš„ifè¯­å¥ if count &gt; 5: count = 5 # æ¯æ¬¡å¾ªç¯éƒ½è¿›è¡Œç¿»é¡µ while count: count -= 1 browser.execute_script('document.documentElement.scrollTop=100000') time.sleep(2) time.sleep(3) # å¼€å§‹è·å–æˆå‘˜ä¿¡æ¯ trs = browser.find_elements_by_class_name('mb') if trs: # éå† for tr in trs: tds = tr.find_elements_by_tag_name('td')[2:] if len(tds) == 8: # qqç½‘å qq_name = tds[0].text # ç¾¤åç§° group_name = tds[1].text # qqå· qq_number = tds[2].text # æ€§åˆ« gender = tds[3].text # qqå¹´é¾„ qq_year = tds[4].text # å…¥ç¾¤æ—¶é—´ join_time = tds[5].text # ç­‰çº§ï¼ˆç§¯åˆ†ï¼‰ level = None # æœ€åå‘è¨€æ—¶é—´ end_time = tds[6].text # å£°æ˜ä¸€ä¸ªå­—å…¸å­˜å‚¨æ•°æ® data_dict = {} data_dict['qq_name'] = qq_name data_dict['group_name'] = group_name data_dict['qq_number'] = qq_number data_dict['gender'] = gender data_dict['qq_year'] = qq_year data_dict['join_time'] = join_time data_dict['level'] = level data_dict['end_time'] = end_time print(data_dict) elif len(tds) == 9: # qqç½‘å qq_name = tds[0].text # ç¾¤åç§° group_name = tds[1].text # qqå· qq_number = tds[2].text # æ€§åˆ« gender = tds[3].text # qqå¹´é¾„ qq_year = tds[4].text # å…¥ç¾¤æ—¶é—´ join_time = tds[5].text # ç­‰çº§ï¼ˆç§¯åˆ†ï¼‰ level = tds[6].text # æœ€åå‘è¨€æ—¶é—´ end_time = tds[7].text # å£°æ˜ä¸€ä¸ªå­—å…¸å­˜å‚¨æ•°æ® data_dict = {} data_dict['qq_name'] = qq_name data_dict['group_name'] = group_name data_dict['qq_number'] = qq_number data_dict['gender'] = gender data_dict['qq_year'] = qq_year data_dict['join_time'] = join_time data_dict['level'] = level data_dict['end_time'] = end_time data_list.append(data_dict) print(data_dict) browser.find_element_by_id('changeGroup').click() time.sleep(3) WebDriverWait(browser, 1000).until( EC.presence_of_all_elements_located( (By.CLASS_NAME, 'ui-dialog') ) ) lis = browser.find_elements_by_xpath('.//div[@class="my-all-group"]/ul[2]/li') num += 1 except Exception as e: continue return data_listdef main(): browser = login_spider() browser = switch_spider(browser) data_list = start_spider(browser) # å°†æ•°æ®å†™å…¥jsonæ–‡ä»¶ with open('data_json.json', 'a+', encoding='utf-8') as f: json.dump(data_list, f) print('jsonæ–‡ä»¶å†™å…¥å®Œæˆ') # è¿™é‡Œçš„ç¼–ç æ ¼å¼ä¸è¦å†™é”™äº†ï¼Œä¸ç„¶ä¼šå‡ºç°ä¹±ç ï¼Œå› ä¸ºç¾¤é‡Œé¢çš„å¤§ç¥åå­—è´¼éªš with open('data_csv.csv', 'w', encoding='utf-8-sig', newline='') as f: # è¡¨å¤´ title = data_list[0].keys() # å£°æ˜writer writer = csv.DictWriter(f, title) # å†™å…¥è¡¨å¤´ writer.writeheader() # æ‰¹é‡å†™å…¥æ•°æ® writer.writerows(data_list) print('csvæ–‡ä»¶å†™å…¥å®Œæˆ')if __name__ == '__main__': main()</pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Python','çˆ¬è™«','selenium'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>