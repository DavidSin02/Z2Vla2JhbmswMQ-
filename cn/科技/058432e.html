<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Milvus 实战 | Milvus 与 BERT 搭建文本搜索 | 极客快訊</title><meta property="og:title" content="Milvus 实战 | Milvus 与 BERT 搭建文本搜索 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/a8eec11fa7fa434bb456702338ad52a0"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/058432e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/058432e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/058432e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/058432e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/058432e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/058432e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/058432e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/058432e.html><meta property="article:published_time" content="2020-10-29T20:50:15+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:15+08:00"><meta name=Keywords content><meta name=description content="Milvus 实战 | Milvus 与 BERT 搭建文本搜索"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/058432e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Milvus 实战 | Milvus 与 BERT 搭建文本搜索</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>Google 的 BERT 模型在 NLP 领域中具有巨大的影响力。它是一个通用的语言表示模型，可以应用于诸多领域。本文的项目是将 Milvus 与 BERT 模型结合搭建文本搜索引擎，使用 BERT 模型将文本数据转成向量，结合 Milvus 特征向量相似度搜索引擎可以快速搜索相似文本。</p><p><br></p><h1 class=pgc-h-arrow-right>| 关键技术</h1><ol start=1><li><strong></strong>Milvus</li></ol><p>Milvus 是一款开源向量相似度搜索引擎，建立在 Faiss、NMSLIB、Annoy 等向量索引库基础之上，具有功能强大、稳定可靠以及易于使用等特点。Milvus 集成了这些向量索引库，对外提供了一套简单而一致的 API 。除了提供针对向量的近实时搜索能力外，Milvus 可以对标量数据进行过滤。随着数据和查询规模的增加，Milvus 还提供了集群分片的解决方案，支持读写分离、水平扩展、动态扩容等功能，实现了对于超大数据规模的支持。</p><p><br></p><div class=pgc-img><img alt="Milvus 实战 | Milvus 与 BERT 搭建文本搜索" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a8eec11fa7fa434bb456702338ad52a0><p class=pgc-img-caption></p></div><ol start=2><li>BERT</li></ol><p>BERT 模型是 Google 发布的一个新的语言表达模型（Language Representation Model），全称是 Bidirectional Encoder Representations from Transformers，即双向编码表征模型。BERT 模型的优势体现在两方面。</p><ul><li>一方面，它使用基于特别设计的注意力机制（Attention Mechanism）的简单全连接网络取代了复杂的 CNN 和 RNN 网络。不但大大减少了训练时间，同时有效地提升了网络性能。</li><li>另一方面，BERT 模型是第一个真正捕获上下文语义信息的预训练语言表示模型。这是因为 BERT 模型使用了 Transformer 作为算法的主要框架，而 Transformer 框架能更彻底地捕捉语句中的双向关系。</li></ul><div class=pgc-img><img alt="Milvus 实战 | Milvus 与 BERT 搭建文本搜索" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ed2c33785d8c487dbf068e588428bfcc><p class=pgc-img-caption></p></div><p>Google 提供了一些预先训练的模型，其中最基本的两个模型是BERT-base 模型和 BERT-large 模型。具体参数如下表所示：</p><div class=pgc-img><img alt="Milvus 实战 | Milvus 与 BERT 搭建文本搜索" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/af8e8d4d86be4b8d8d889ef1ef92b26c><p class=pgc-img-caption></p></div><p>BERT-base 模型和 BERT-large 模型的参数总量大小和网络层数不同，BERT-large 模型所占计算机内存较多，所以本文项目选用 BERT-base 模型对文本数据进行向量转化。（注：其中，层数（即 Transformer 块个数）表示为 L，隐藏尺寸表示为 H ，自注意力头数表示为 A 。）</p><p><br></p><h1 class=pgc-h-arrow-right>数据来源</h1><p>本项目所需的新闻数据集包含两个部分：一个标题集，一个文本集。文本集与标题集是一一对应的，存在 data 目录下（data 目录下面的数据是经过预处理的）。数据集来源于和鲸社区的中文新闻数据集 （注1），有将近 14w 条数据。</p><p><br></p><h1 class=pgc-h-arrow-right>整体架构</h1><p>本文的文本搜索引擎项目使用的 Milvus 整体架构如图所示：</p><div class=pgc-img><img alt="Milvus 实战 | Milvus 与 BERT 搭建文本搜索" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/753303063c7a470fab690cd7852e12bb><p class=pgc-img-caption>深蓝色线为数据导入过程，橘黄色线为用户查询过程</p></div><ol start=1><li>首先，本文项目使用开源的 bert-as-service ，使用 BERT 做为句子编码器，将新闻标题数据转化为固定长度为 728 维的特征向量，并导入 Milvus 库。</li><li>然后，对存入 Milvus 库中的特征向量进行存储并建立索引，同时 Milvus 会给这些特征向量分配一个 ID，将 ID 和对应的新闻标题和文本存储在 PostgreSQL 中。</li><li>最后，用户输入一个新闻标题，BERT 将其转成特征向量。Milvus 对特征向量进行相似度检索，得到相似的新闻标题的 ID ，在 PostgreSQL 中找出 ID 对应的新闻标题和文本返回。在后续界面展示中可以看到新闻文本搜索的一个例子。</li></ol><p><br></p><h1 class=pgc-h-arrow-right>实现步骤</h1><p>下面我们来看一下 BERT 模型与 Milvus 搭建的文本搜索引擎实现的关键步骤。详细步骤可参考 GitHub 项目（注2）。</p><p><br></p><p><strong>1. 安装 Milvus</strong></p><p>Milvus 提供两个发行版本：CPU 版本和 GPU 版本。为了得到更优的查询性能，项目中使用的是 GPU 版本。具体安装方法参考 <u>Milvus 文档</u>。</p><p><br></p><p><strong>2. 安装 PostgreSQL</strong></p><p>PostgreSQL 是一个强大的、开源的对象关系数据库系统。PostgreSQL 在可靠性、稳定性、数据一致性等性能方面表现不错。具体安装方法参考<u>PostgreSQL 官网</u>。</p><p><br></p><p><strong>3. 安装 bert-as-service</strong></p><p>使用 bert-as-service 将标题集转化为特征向量，以便 Milvus 后续进行相似度检索。更多安装细节可参考 bert-as-service 的 Github 存储库（注3）。</p><pre><code>#下载模型$ wget https://storage.googleapis.com/BERT_models/2018_11_03/chinese_L-12_H-768_A-12.zip#启动服务$ BERT-serving-start -model_dir chinese_L-12_H-768_A-12/ -num_worker=12 -max_seq_len=40</code></pre><p><br></p><p><strong>4. 数据导入</strong></p><p>在项目中的 Milvus-bert-server 文件的 main.py 文本数据导入脚本。用户只需要修改脚本中的标题集路径和文本集路径，即可运行脚本进行文本数据导入。</p><pre><code>python main.py --collection test11 --title data/title.txt --version data/version.txt --load</code></pre><p><br></p><p><strong>5. 启动查询服务</strong></p><p>在项目中启动查询服务，然后在浏览器中进行文本搜索，得到最终的文本搜索结果。</p><pre><code>python app.py</code></pre><p><br></p><h1 class=pgc-h-arrow-right>| 界面展示</h1><p>打开 <em>http://127.0.0.1:3001/search</em>，下面是一个文本搜索的例子。首先进入搜索页面，输入“中国股市”，点击 Search 进行搜索。</p><div class=pgc-img><img alt="Milvus 实战 | Milvus 与 BERT 搭建文本搜索" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9da69123041e47ddb7b2ebc17d8bb28a><p class=pgc-img-caption></p></div><p>可以得到与“中国股市”相关的新闻文本。比如图中所示的文本“中国股市吸引外资......”等。</p><div class=pgc-img><img alt="Milvus 实战 | Milvus 与 BERT 搭建文本搜索" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/332392a592aa4e72b2cead02c4054b4d><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>| 总结展望</strong></h1><p>在 AI 高速发展的时代，我们可以使用深度学习模型去处理各种类型的非结构化数据，例如图片、文本、视频和语音等。本文项目通过 BERT 模型可以将这些非结构化数据提取为特征向量，然后通过 Milvus 对这些特征向量进行计算，实现对非结构化数据的分析与检索。</p><p>本文利用 Milvus 搭建的文本搜索引擎也只是其中一个场景，展示了 Milvus 在非结构化数据处理中的应用。欢迎大家导入自己的数据建立自己的文本搜索引擎。Milvus 向量相似度检索引擎可以兼容各种深度学习平台，搜索十亿向量仅需毫秒响应时间。你可以使用 Milvus 探索更多 AI 用法！我们还提供了其他应用场景以供参考，详见 Milvus 应用场景（注4）。</p><p><br></p><h1 class=pgc-h-arrow-right>参考资料：</h1><ul><li>和鲸社区的中文新闻数据集：https://www.kesci.com/home/dataset/5d8878638499bc002c1148f7/files</li></ul><ul><li>GitHub 项目：https://github.com/milvus-io/bootcamp/blob/0.10.0/solutions/Textsys/README.md</li></ul><ul><li>bert-as-service：https://github.com/hanxiao/BERT-as-service</li></ul><ul><li>Milvus 应用场景：https://milvus.io/cn/scenarios/</li></ul></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Milvus','实战','BERT'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>