<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>【至简设计案例系列】波形相位频率可调DDS信号发生器 | 极客快訊</title><meta property="og:title" content="【至简设计案例系列】波形相位频率可调DDS信号发生器 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/d4a6d5c20d86476dbdac92a0ebe4cc5d"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05976fda.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05976fda.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/05976fda.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05976fda.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05976fda.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/05976fda.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/05976fda.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05976fda.html><meta property="article:published_time" content="2020-10-29T21:11:00+08:00"><meta property="article:modified_time" content="2020-10-29T21:11:00+08:00"><meta name=Keywords content><meta name=description content="【至简设计案例系列】波形相位频率可调DDS信号发生器"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/05976fda.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>【至简设计案例系列】波形相位频率可调DDS信号发生器</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>本文为明德扬原创及录用文章，转载请注明出处！</p><p><br></p><p><strong>1.1 总体设计</strong></p><p><br></p><p><strong>1.1.1 概述</strong></p><p><br></p><p>学习了明德扬至简设计法和明德扬设计规范，本人设计了一个基于FPGA的可调频调相而且可以输出不同波形的DDS信号发生器。该信号发生器实现了通过按键控制输出不同类型的波形，并可以通过按键改变波形频率和初始相位。将此设计与明德扬的波形采集设计相结合，可以实现示波器功能，并且还可拓展实现波形频率计算、峰峰值计算、频谱分析等功能，有很大的设计空间。同时本设计以及其扩展功能在现实生活中也具有比较广泛的应用。在本案例的设计过程中，包含了按键定义和消抖、计数器、ROMIP的应用等技术。经过逐步改进、调试等一系列操作之后，完成了此设计，下面将完整的设计记录与大家分享。</p><p><br></p><p><strong>1.1.2 设计目标</strong></p><p><br></p><p>此设计可以通过按键进行波形类型的切换，并且波形的频率还可以进行改变，具体需求如下：</p><p>1）按键1按下时可以改变波形的类型，实现波形的切换，顺序为正弦波、锯齿波、三角波；</p><p>2）按键2按下时可以改变波形的频率，每按下一次，频率增大2倍，达到一定值后跳回初始频率值，以此循环；</p><p>3）按键3按下时可以改变波形的初始相位，每按下一次，初始相位加30，达到一定值后跳回初始相位值，以此循环。</p><p><br></p><p><strong>1.1.3 系统结构框图</strong></p><p><br></p><p>系统结构框图如下所示：</p><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d4a6d5c20d86476dbdac92a0ebe4cc5d><p class=pgc-img-caption></p></div><p><br></p><p><strong>1.1.4 模块功能</strong></p><ul class=list-paddingleft-2><li><strong>按键模块实现功能</strong></li></ul><p>将外来异步信号打两拍处理，将异步信号同步化；</p><p>实现20ms按键消抖功能，并输出有效按键信号。</p><ul class=list-paddingleft-2><li><strong>DDS模块实现功能</strong></li></ul><p>通过有效按键信号实现切换波形类型、改变波形频率、调整波形初始相位；</p><p>从ROM中读取波形数据并输出按键控制下的波形数据。</p><p><br></p><p><strong>1.1.5 信号定义</strong></p><ul class=list-paddingleft-2><li><strong>顶层模块mdy_DDS.v</strong></li></ul><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/619a91178fe644859bd39de5636e39b8><p class=pgc-img-caption></p></div><p><br></p><li><strong>按键模块key_delay.v</strong></li><p><br></p><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/04d51f5419d942d9b3481e8a2b58071e><p class=pgc-img-caption></p></div><p><br></p><ul class=list-paddingleft-2><li><strong>DDS模块DDS.v</strong></li></ul><p><br></p><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6d3d5af2fd4d416fab862c8aacc5be11><p class=pgc-img-caption></p></div><p><br></p><p><strong>1.1.6 工作原理</strong></p><p><br></p><p>在系统整体结构中，通过按键控制输出波形类型，并通过按键改变波形频率控制字和初始相位控制字，得到ROM的读地址。ROM为只读存储器，只要给它一个地址，就能读出该地址中相应的数据，从已经初始化好的ROM读取相应的波形数据。</p><p><br></p><p>DDS的原理如下图，累加器每次累加一个频率控制字，调节频率控制字的数值，可以改变累加器的累加速度，进而可以调节从ROM查找表中读取波形数据的速度。即频率控制字越大，频率越高。相位控制字可以用来调节初始相位，即ROM地址自加的初始值。</p><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0f93507de88f4ca7a5af55db03bc7235><p class=pgc-img-caption></p></div><p><br></p><p><strong>1.2 按键电路</strong></p><p><br></p><p><strong>1.2.1 按键电路</strong></p><p>独立式按键工作原理如上图所示，4条输入线接到FPGA的IO口上，当按键K1按下时，VCC通过电阻R1再通过按键K1最终进入GND形成一条通路，这条线路的全部电压都加在R1上，则引脚P14是低电平。当松开按键后，线路断开，就不会有电流通过，P14和VCC就应该是等电位，为高电平。我们可以通过P14这个IO口的高低电平状态来判断是否有按键按下。其它按键原理与K1一致。</p><p>从图中可以看出，如果我们按下按键，那么按键就会接通并连接到低电平GND，如果我们没有按下，那么按键就会断开并接到VCC，因此按键为低电平有效。通常的按键所用开关为机械弹性开关，当机械触点断开或者闭合时，由于机械触点的弹性作用，一个按键开关在闭合时不会马上稳定地接通，在断开时也不会一下子断开。因而机械式按键在闭合及断开的瞬间均伴随有一连串的抖动，如果不进行处理，会使系统识别到抖动信号而进行不必要的反应，导致模块功能不正常，为了避免这种现象的产生，需要进行按键消抖的操作。</p><p><br></p><p><strong>1.2.2 按键消抖</strong></p><p><br></p><p>按键消抖主要分为硬件消抖和软件消抖。两个“与非”门构成一个RS触发器为常用的硬件消抖。软件方法消抖，即检测出键闭合后执行一个延时程序，抖动时间的长短由按键的机械特性决定，一般为5ms～20ms，让前沿抖动消失后再一次检测键的状态，如果仍保持闭合状态电平，则确认按下按键操作有效。当检测到按键释放后，也要给5ms～20ms的延时，待后沿抖动消失后才能转入该键的处理程序。经过按键消抖的行人优先按键，判断按键有效后，按键信号传递给控制系统，控制系统再进入相应的处理程序。如还不明白之处，见实验的PDF。</p><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b96ba02013544a9f92f34c0795c277ff><p class=pgc-img-caption>图5.1.2按键消抖示意图</p></div><p><br></p><p><strong>1.2.3 按键消抖代码实现</strong></p><p><br></p><p>使用明德扬的计数器模板，可以很快速很熟练地写出按键消抖模块。</p><p>每20ms扫描一次按键输入key_in，可以达到消抖的目的，再用寄存器缓存一下，按键为低电平有效；所以检测当检测到按键有下降沿变化时，代表该按键被按下，按键有效，输出1。</p><p><br></p><p>代码如下：</p><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7dc5627b36a847ecbdb5b2ff6b78a10f><p class=pgc-img-caption></p></div><p><strong>1.3 DDS模块设计</strong></p><p><strong>1.3.1 控制波形类型</strong></p><p>消抖过后的按键输入到本模块，同样使用明德扬至简设计法和计数器模板，可以秒速写出控制波形类型的代码。按键1每按下一次，即key_done[0]有效时，wave_cnt加1，加到3时归0，否则保持不变。wave_cnt为0时输出正弦波，1时输出三角波，2时输出锯齿波，默认时输出正弦波；至简设计法和计数器模板有多好用，越用越绝精妙。</p><p>完整代码如下：</p><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ce0956f7b9e849a19a44caf8bdc98ed2><p class=pgc-img-caption></p></div><p></p><p><strong>1.3.2 改变波形频率</strong></p><p>话不多说，反手又是一个明德扬计数模板。按键2每按下一次，即key_done[1]有效时，i乘以2，加到64时归0，否则保持不变。这里通过i可以改变频率的原理是ROM中512个数据为一个周期，i等于1的话，采集一个周期需要512次，clk/512即为频率，i为2时，只需要采集256次即完成一个周期，频率为clk/256。</p><p>当然也可以直接通过分频改变clk，从而达到改变频率的效果。</p><p>完整代码如下：</p><p><br></p><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/9a188db5c7f74a568663540807846079><p class=pgc-img-caption></p></div><p><strong>1.3.3 改变波形相位</strong></p><p>依旧是百用不厌的计数器模板，按键3每按下一次，即key_done[2]有效时，初始相位加30，加到360时归0，否则保持不变。达到改变相位的目的。</p><p>因此，通过至简设计法、计数器模板，可以轻松达到设计目标。</p><p>完整代码如下：</p><p><br></p><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e6813ed9ba874991a79948cbbd416b14><p class=pgc-img-caption></p></div><p><strong>1.3.4 mif文件的生成</strong></p><p>程序中我们会用到一个ROM用于存储512个8位的波形数据，首先我们需要准备ROM的初始化文件(mif文件)。以下为生成正弦波数据mif文件的方法：首先打开Guagle_wave工具，选择菜单＂查看＂->”全局参数设置”，设置参数如下：</p><p><br></p><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ad0309ff8fc44613984cd1da094eb5ae><p class=pgc-img-caption></p></div><p></p><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/050369f0b83c4b7c8596b3e078a8b5e4><p class=pgc-img-caption></p></div><p><br></p><p>调用ROMIP核，并将mif导入ROM，其他波形同理。</p><p><br></p><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/13c27a9ebe414845be2e5a6249acc870><p class=pgc-img-caption></p></div><p></p><p><strong>1.4 在线逻辑分析仪查看波形数据</strong></p><ul class=list-paddingleft-2><li><strong>不同频率正弦波：</strong></li></ul><p><br></p><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d1cd03b9200643cd8682bc8a1f2a9dd0><p class=pgc-img-caption></p></div><p><br></p><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5da10f21c1b04065850d06443c956b4e><p class=pgc-img-caption></p></div><p><br></p><ul class=list-paddingleft-2><li><strong>三角波</strong></li></ul><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a5b95f009dd54edcb0ded24f1ddc5fbd><p class=pgc-img-caption></p></div><p><br></p><ul class=list-paddingleft-2><li><strong>锯齿波</strong></li></ul><div class=pgc-img><img alt=【至简设计案例系列】波形相位频率可调DDS信号发生器 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/933d20c97c414cf6b66ea98bdbd48f4c><p class=pgc-img-caption></p></div><p><br></p><p>观看上面的现象，可以发现，各项功能正常，可以通过按键改变波形类型、频率、相位，成功完成设计目标。</p><p><br></p><p>在这个设计案例中，至简设计法和明德扬计数器模板发挥了至关重要的作用，使我能够快速准确完成设计。本设计拓展加上ADDA采集和VGA显示，可以实现基于FPGA的示波器设计，之前明德扬论坛已经发布了波形采集并VGA显示的案例，希望有兴趣的同学可以运用至简设计法和明德扬模板尝试一下拓展设计哦。</p><p><br></p><p>感兴趣的朋友也可以访问明德扬论坛（http://www.fpgabbs.cn/）进行FPGA相关工程设计学习，也欢迎大家在评论与我进行讨论！</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'简设计','频率','可调'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>