<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Python中的多进程 | 极客快訊</title><meta property="og:title" content="Python中的多进程 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/49dd44b999924b69bd3396709ecacaf4"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05b8f164.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05b8f164.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/05b8f164.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05b8f164.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05b8f164.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/05b8f164.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/05b8f164.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05b8f164.html><meta property="article:published_time" content="2020-11-14T21:06:37+08:00"><meta property="article:modified_time" content="2020-11-14T21:06:37+08:00"><meta name=Keywords content><meta name=description content="Python中的多进程"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/05b8f164.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Python中的多进程</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>回顾</h1><p>在Python进阶记录之基础篇（二十二）中，我们介绍了Python中对文本文件和二进制文件的简单操作，需要重点掌握文件的各种打开方式，以及简单的读写操作。今天我们讲一下Python中的多进程。</p><h1>进程的基本概念</h1><p>进程就是操作系统中执行的一个程序，操作系统以进程为单位分配存储空间，每个进程都有自己的地址空间、数据栈以及其他用于跟踪进程执行的辅助数据，操作系统管理所有进程的执行，为它们合理的分配资源。</p><p>进程可以通过fork或spawn的方式来创建新的进程来执行其他的任务，不过新的进程也有自己独立的内存空间，因此必须通过进程间通信机制来实现数据共享，具体的方式包括管道、信号、套接字、共享内存区等。</p><p>我们先来看这样一个例子：假设现在我们需要下载两个文件（具体怎么下载暂时先忽略）。按照我们之前掌握的知识点，就是一个一个地逐一下载。</p><div class=pgc-img><img alt=Python中的多进程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/49dd44b999924b69bd3396709ecacaf4><p class=pgc-img-caption>逐一下载</p></div><p>上述代码中，我们将两个文件按顺序进行下载，为了模拟真实下载场景，我们设置相应的下载时间。可以看到，如果按顺序逐一下载，需要先等待一个文件下载完成后才能开始下一个文件的下载，整个过程下来需要耗费两个下载任务时间的总和，即9秒左右。</p><p>但是我们知道，这是两个毫不相关的下载任务，像这样逐一下载显然效率太低了。因此，就出现了并发编程的概念，而多进程就是Python实现并发编程的三种方式之一。</p><h1>Python中多进程的创建方式</h1><p>Python为我们提供了两种方式来实现多进程：系统的fork( )函数和multiprocessing</p><p>模块。其中multiprocessing模块是我们使用多进程的主要方式。</p><ul><li>系统的fork( )函数</li></ul><p>Unix和Linux操作系统提供了fork( )系统调用来创建进程，调用fork( )函数的是父进程，创建出的是子进程，子进程就是父进程的一个拷贝，但是子进程拥有自己的PID（进程标识）。</p><p>fork( )函数非常特殊，它会返回两次，父进程中可以通过fork( )函数的返回值得到子进程的PID，而子进程中的返回值永远都是0。</p><p>因此，在Unix和Linux操作系统中，Python的os模块也拥有fork( )函数。</p><div class=pgc-img><img alt=Python中的多进程 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a7a5b5f0b116442bbdffadce98955cb5><p class=pgc-img-caption>fork( )创建子进程</p></div><p>fork( )函数可以创建子进程，通过子进程实现多进程。可以看到，通过创建子进程，耗时从原来的9秒左右缩短到5秒左右。</p><ul><li>multiprocessing模块</li></ul><p>由于Windows系统中没有fork调用，因此我们在Windows系统中使用os.fork( )是无法运行的。</p><p>为了实现跨平台的多进程编程，Python为我们提供了multiprocessing模块。该模块中的Process类可以创建子进程，而且该模块还提供了更高级的封装，例如批量启动进程的进程池、用于进程间通信的队列和管道等。</p><p>因此，在Python的实际开发过程中，我们更多地是使用multiprocessing模块来实现多进程。</p><div class=pgc-img><img alt=Python中的多进程 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e80670e248384885afb4cc7b84e701e1><p class=pgc-img-caption>Process类创建进程</p></div><p>上述代码中，我们通过multiprocessing模块的Process类创建了进程对象，target参数表示目标函数，即进程启动后要执行的代码，args参数是目标函数所需要的参数，用一个元组接收。Process的start( )方法用于启动进程，而join( )方法表示等待进程执行结束再继续往下运行。</p><p>我们运行上述代码，可以发现两个下载任务一起执行，从而大大缩短了程序的执行时间。并且与fork( )函数相比，这种方式更加清晰。</p><h1>进程池Pool</h1><p>当下载文件增多，需要大量子进程时，我们也可以使用multiprocessing模块中的进程池Pool。假设现在有5个文件待下载，我们通过进程池Pool来实现并发下载。</p><div class=pgc-img><img alt=Python中的多进程 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ed43dd7784dd439eb184fa264f0f7719><p class=pgc-img-caption>进程池Pool</p></div><p>上述代码中，我们创建了一个Pool对象，然后通过循环调用apply_async( )方法来创建进程。创建结束调用close( )方法，调用此方法后进程池就不能继续添加新的进程了。最后调用join( )方法等待所有子进程执行完毕。</p><p>从运行结果我们看到，程序并没有像我们预计地5个文件一起下载，而是先下载其中四个，直到四个中有一个下载完成才开始第5个。这是因为Pool线程池是有默认大小的，在我电脑上默认就是4，因此，最多同时执行4个进程。</p><p>如果你想同时执行5个，需要在创建Pool对象时传入一个5即可，p = Pool(5)。</p><h1>进程间的通信</h1><p>进程与进程之间有时也需要通信，在介绍进程的基本概念中我们提到，操作系统提供了很多机制来实现进程间的通信。Python的multiprocessing模块也包装了操作系统底层的机制，提供了对列（Queue）、管道（Pipes）等多种方式来实现数据共享。</p><p>下面我们以对列Queue为例，首先创建两个子进程，其中，一个往对列中写数据，一个从对列中读数据。</p><div class=pgc-img><img alt=Python中的多进程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/85087df80efb443f991a5cb31e8b4fe1><p class=pgc-img-caption>进程间的通信</p></div><p>上述代码中，我们首先创建对列对象，然后创建两个进程分别用于数据的读和写。通过对列的put/get方法实现了两个进程之间的数据共享。</p><h1>总结</h1><p>以上内容介绍了进程的基本概念以及Python中多进程的使用方法，需要重点理解进程的概念。熟练掌握多进程的创建方法和各种基本操作。感谢大家的支持与关注，欢迎一起学习交流~</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Python','进程'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>