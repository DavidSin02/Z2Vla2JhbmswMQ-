<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云 | 极客快訊</title><meta property="og:title" content="爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/520d8b0a27d1467bbc5e5996810945f1"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0637cd6b.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0637cd6b.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0637cd6b.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0637cd6b.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0637cd6b.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0637cd6b.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0637cd6b.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0637cd6b.html><meta property="article:published_time" content="2020-10-29T21:09:49+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:49+08:00"><meta name=Keywords content><meta name=description content="爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/0637cd6b.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>前言</h1><p>2019 年 10 月 1 日，是一个值得被纪念的日子。转眼间，10年已经过去了。上一次国庆历历在目，当年的我还参加了国庆 60 周年的翻花表演。</p><p>平时热衷于 B 站的我，扫到了排行榜排名第一的视频，数百位摄影师联合制作，《10分钟带你看绝美祖国大好河山！》</p><p><br></p><div class=pgc-img><img alt=爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/520d8b0a27d1467bbc5e5996810945f1><p class=pgc-img-caption></p></div><p><br></p><blockquote><p>感兴趣的，可以复制下面地址看下：</p></blockquote><p>https://www.bilibili.com/video/av69241910/​www.bilibili.com</p><p>可以看到上图右侧，有数千条弹幕。通过查看历史记录，发现是 9.28 才有的第一条弹幕，目测应该是 9.28 上传的视频。出于感兴趣，于是打算来个词频统计。</p><p>文章写到这里，笔者并没有开始代码的编写，也不知道弹幕哪个词出现的频率最高。（平时写文章有个习惯，都是先写前言，搭好文章架子再开始写具体的代码实现。）</p><p>在结果出现之前，来个盲猜吧！<strong>祖国，快乐</strong>。这两个没猜错，应该是最高的频率词！</p><h1 class=pgc-h-arrow-right>框架性思维</h1><p>不知道大家还记不记得爬虫的框架步骤。</p><p>首先，熟悉网站结构，找出我们想要的数据接口。</p><p>其次，分析提取数据。</p><p>最后，完成本次的词频统计。</p><p>所以，让我们先来找接口吧！B 站的接口很好找哟！</p><h1 class=pgc-h-arrow-right>B站弹幕接口</h1><p>打开上述提到的视频链接。</p><p>提供一个思路，打开 F12 后，一般默认先去找 XHR 里是否有相似数据。因为 XHR 这栏，是异步请求。意味着，即使不刷新页面，也可以像服务器异步发送请求，不会影响用户操作。</p><p><br></p><div class=pgc-img><img alt=爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/a3029b8439494c3c8ae9e023e8ca7ac5><p class=pgc-img-caption></p></div><p><br></p><p>总的来说，下面的异步请求并不多，一个个去看，也能全部浏览完。不过有个小技巧，就是根据名字挑着看，比如那些常见的单词，list。</p><p><br></p><div class=pgc-img><img alt=爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/891965c32619485c80f4a3a0e9bfcac7><p class=pgc-img-caption></p></div><p><br></p><p>F12看数据，可以看到不是 json 的形式返回的，用浏览器访问下试试。</p><p><br></p><div class=pgc-img><img alt=爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/10b5f6857d4344a390ac7e01d8f3e63d><p class=pgc-img-caption></p></div><p><br></p><div class=pgc-img><img alt=爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/f39b850a0d214e418191c0b4d514b07f><p class=pgc-img-caption></p></div><p><br></p><p>它是以标签的形式，将数据展示的。而这种形式，恰是之前在小课堂中介绍到的 XML 格式。</p><p>其中有个 maxlimit 的标签，数字显示 1500 。猜测应该是此页数据最大 1500 条数据。复制到文本工具里，删除非数据以外的头尾，验证下，一共 1502 行。</p><p><br></p><div class=pgc-img><img alt=爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/52e358ef73724eb1b748dc1189c9fbca><p class=pgc-img-caption></p></div><p><br></p><p>由此得知，这并不是历史数据。继续来挖，点击查看历史，选择9.28日，F12再次看请求。</p><p>当然，你可以先清除下之前的F12记录，以免太乱，点击F12的小垃圾桶即可。我这里用的是 Safari 浏览器，谷歌浏览器类似操作。</p><p><br></p><div class=pgc-img><img alt=爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/4fad2cad9dab4342a61f5b6907ffdc6c><p class=pgc-img-caption></p></div><p><br></p><p>选择日期：</p><p><br></p><div class=pgc-img><img alt=爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/891b7409bf42412c9e2f5ea9006ed9ee><p class=pgc-img-caption></p></div><p><br></p><p>再次查看：</p><p><br></p><div class=pgc-img><img alt=爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/cb9b884979584770aa3ff7dac12ca8e0><p class=pgc-img-caption></p></div><p><br></p><p>出现了 history 的名字，无疑就是它了！明显，请求地址发生了改变。</p><p>https://api.bilibili.com/x/v2/dm/history?type=1&oid=120004475&date=2019-09-28</p><p>这样一来，就有了这几天的历史数据。模拟请求，修改下 url 中 date 字段的日期。接下来只需要将返回的 XML 进行数据提取就好啦！</p><h1 class=pgc-h-arrow-right>代码简说及成果展示</h1><p>需要的第三方库：</p><ul><li>requests</li><li>jieba</li><li>wordcloud</li><li>numpy</li><li>PIL</li><li>matplotlib</li></ul><pre><code>pip install jiebapip install requestpip install wordcloudpip install numpypip install Pillowpip install matplotlib</code></pre><p>简单的说下代码思路。</p><p>用 requests 库发起模拟请求，请求头需要携带自己的 cookie ，否则会提示请登录的字眼。</p><p>爬取弹幕后，存储到一个公有 list 中，通过 jieba 分词的第三方库，对其进行词频统计分析。</p><p>其中 jieba 使用的核心代码是这段：</p><p>https://github.com/fxsjy/jieba​github.com</p><div class=pgc-img><img alt=爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6cead71999034863855f10de09f8e142><p class=pgc-img-caption></p></div><p><br></p><div class=pgc-img><img alt=爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/19001001b80a467ab41d72e427bce78a><p class=pgc-img-caption></p></div><p><br></p><p>最后，使用 wordcloud 生成词云图核心代码：</p><pre><code>def __draw_word(self):    """ 词云生成 """    d = os.path.dirname(__file__)    alice_mask = np.array(Image.open(os.path.join(d, "gq.jpg")))    windows_font_path = 'C:/Windows/Fonts/simsun.ttc'  # winodws字体    mac_font_path = '/System/Library/Fonts/PingFang.ttc'  # mac字体    wc = WordCloud(font_path=mac_font_path,  # 设置字体格式,系统自带的中文字体                   mask=alice_mask,  # 设置背景图                   background_color='white',                   max_words=400,  # 最多显示词数                   max_font_size=150  # 字体最大值)                   )    wc.generate_from_frequencies(self.word_dict)  # 从字典生成词云    image_colors = wordcloud.ImageColorGenerator(alice_mask)  # 从背景图建立颜色方案    wc.recolor(color_func=image_colors)  # 将词云颜色设置为背景图方案    plt.imshow(wc, interpolation='bilinear')  # 显示词云    plt.axis('off')  # 关闭座标轴    plt.show()  # 显示图像</code></pre><p>生成词云图时，需要一张原图做"铺垫"。</p><p>原图：</p><div class=pgc-img><img alt=爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/75d9e347aca74270b139f24e8f243fa7><p class=pgc-img-caption></p></div><p><br></p><p>渲染：</p><div class=pgc-img><img alt=爬取B站视频排名第一《祖国大好河山》1W+弹幕，得出一份词频词云 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/841e0f18598549f8a6258380d0ffeac5><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right>总结</h1><p>总的来说，盲猜与结果相似度还可以！。。</p><p>图片的清晰度有些模糊，可以看到 生日快乐、祖国、我爱你、盛世 字眼相对较大，当然也可以看到中国许多的地名，山东、四川、苏州、山西等等。。。</p><p>相信每个看视频的小伙伴，看到自己家乡美景的时候，都会很自豪吧！</p><p>本篇文章可以当做一个熟悉词云的练手小项目。从数据角度来看，实用的意义并不是很大！</p><p>想看全部源码的同学，公众号后台回复 <strong>70</strong> ，即可获得源码地址。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'爬取','站视频','祖国'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>