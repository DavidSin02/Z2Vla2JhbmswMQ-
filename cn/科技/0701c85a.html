<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>JavaScript的宏任务和微任务 | 极客快訊</title><meta property="og:title" content="JavaScript的宏任务和微任务 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/73a5badff31b42da8f8c62a9761be636"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0701c85a.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0701c85a.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0701c85a.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0701c85a.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0701c85a.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0701c85a.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0701c85a.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0701c85a.html><meta property="article:published_time" content="2020-11-14T21:05:38+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:38+08:00"><meta name=Keywords content><meta name=description content="JavaScript的宏任务和微任务"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/0701c85a.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>JavaScript的宏任务和微任务</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>JavaScript是单线程的语言，也就是说同一时间只能进行一个任务，毕竟JavaScript可以操作dom,进行ui交互，删除dom和修改dom同时进行，那么应该听哪一个？。</p><p>正是因为这样，决定了它是单线程的，但是又说单线程只能在同一个时间内执行一个任务，这样岂不是会造成阻塞？前一个任务执行很久，后面都卡死了，所以就需要JavaScript的事件循环机制来进行分配，这样就会被分为</p><h1 class=pgc-h-arrow-right>宏任务：当前调用栈执行的代码称为宏任务</h1><p>宏任务有哪些？</p><ul><li>主代码块</li><li>定时器 setTimeout、setInterval、setImmediate</li><li>同步代码</li><li>I/O</li></ul><h1 class=pgc-h-arrow-right>微任务：当前宏任务执行完，在下一个宏任务开始之前需要执行的在队列（先进先出）里的任务，可理解为回调事件</h1><p>微任务有哪些？</p><ul><li>promise.then</li><li>nextTick</li><li>process</li><li>Object.observe、MutationObserve</li><li>catch finally</li></ul><h1 class=pgc-h-arrow-right>运行机制，面试中经常会遇到这样的题目（让说出它的执行顺序）：</h1><pre><code>console.log('1');setTimeout(function() {    console.log('2');}, 0);Promise.resolve().then(function() {    console.log('3');}).then(function() {    console.log('4');});console.log('5');</code></pre><p>执行结果：1 5 3 4 2</p><p>先了解一下运行机制：</p><p>1. 在执行栈中执行一个宏任务（程序刚开始执行时，会把整个代码当成第一个宏任务）。</p><p>2. 执行的过程中遇到微任务，先将微任务添加到微任务队列中（它是属于本次执行的宏任务中分出来微任务），遇到宏任务，放到下一个执行栈中。</p><p>3. 当前宏任务执行完毕，立即执行任务队列（先进先出的原则）中的微任务</p><p>4. 当前微任务队列中的任务执行完毕</p><p>5. 接着开始执行执行栈中的下一个宏任务，</p><p>6. 依次循环这个规律</p><p>解析上面的代码：</p><p>1. 整体代码被当成第一个宏任务，代码从上到下执行</p><p>2. 遇到console.log('1');是同步任务，直接执行，输出<strong>1</strong></p><p>3. 遇到setTimeout，是宏任务，放到执行栈中</p><p>4. 再往下执行，遇到promise，promise的执行器里是立即执行的，这里没有执行器，而是有then，then是微任务，先放到本次宏任务的微任务队列中，then后面返回的也是一个promise，第二个then也是一个微任务，放到微任务队列中。</p><p>5.接着遇到同步代码console.log('5');直接输出<strong>5</strong>，这时候，第一轮宏任务执行完毕</p><p>6.需要去执行本轮它产生的微任务，先进先出的原则，输出<strong>3 4</strong></p><p>7.这时候循环的第一周期就结束了</p><p>8.再去执行栈中的第二个宏任务，输出 <strong>2</strong></p><hr><p><strong>来个难的练习一下：</strong></p><pre><code>console.log('1');setTimeout(function() {    console.log('2');    process.nextTick(function() {        console.log('3');    })    new Promise(function(resolve) {        console.log('4');        resolve();    }).then(function() {        console.log('5')    })})process.nextTick(function() {    console.log('6');})new Promise(function(resolve) {    console.log('7');    resolve();}).then(function() {    console.log('8')})setTimeout(function() {    console.log('9');    process.nextTick(function() {        console.log('10');    })    new Promise(function(resolve) {        console.log('11');        resolve();    }).then(function() {        console.log('12')    })})</code></pre><p>结果：1 7 6 8 2 4 3 5 9 11 10 12</p><p>process.nextTick 需要放在node环境下才能执行：</p><div class=pgc-img><img alt=JavaScript的宏任务和微任务 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/73a5badff31b42da8f8c62a9761be636><p class=pgc-img-caption></p></div><hr><p>加上async和await</p><pre><code>async function async1() {    console.log('1');    let a = await async2();    console.log(a);    console.log('2');}async function async2() {    return new Promise((resolve) =&gt; {        setTimeout(() =&gt; {            resolve('data');        }, 0);    });}console.log('3');setTimeout(function () {    console.log('4');}, 0);async1();new Promise(function (resolve) {    console.log('5');    resolve();}).then(function () {    console.log('6');});console.log('7');// 3 1 5 7 6 4 data 2</code></pre><p>提示：</p><ol start=1><li><strong>await是一个让出线程的标志</strong>。</li><li>正常情况下， await 命令后面是一个 Promise 对象。如果不是，会被转成一个立即 resolve 的 Promise 对象</li><li>当函数执行的时候， 一旦遇到 await 就会先返回，跳出函数体执行外部的代码，等到异步操作完成，再接着执行函数体内后面的代码。</li></ol></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'JavaScript','宏任务','任务'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>