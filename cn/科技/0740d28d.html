<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>åŒ…æ•™åŒ…ä¼šï¼çœ‹äº†è¿™ç¯‡ä½ å°±ä¼šæ‰‹å†™RPCæ¡†æ¶äº† | æå®¢å¿«è¨Š</title><meta property="og:title" content="åŒ…æ•™åŒ…ä¼šï¼çœ‹äº†è¿™ç¯‡ä½ å°±ä¼šæ‰‹å†™RPCæ¡†æ¶äº† - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/55d9c37ea69242bb9e645344cd879609"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0740d28d.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0740d28d.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0740d28d.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0740d28d.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0740d28d.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0740d28d.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0740d28d.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0740d28d.html><meta property="article:published_time" content="2020-11-14T20:59:17+08:00"><meta property="article:modified_time" content="2020-11-14T20:59:17+08:00"><meta name=Keywords content><meta name=description content="åŒ…æ•™åŒ…ä¼šï¼çœ‹äº†è¿™ç¯‡ä½ å°±ä¼šæ‰‹å†™RPCæ¡†æ¶äº†"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/0740d28d.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>åŒ…æ•™åŒ…ä¼šï¼çœ‹äº†è¿™ç¯‡ä½ å°±ä¼šæ‰‹å†™RPCæ¡†æ¶äº†</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><blockquote><p>æœ¬æ–‡ä½œè€…ï¼šä¸œæ–¹é›¨å€¾<br>æœ¬æ–‡é“¾æ¥ï¼šhttps://www.cnblogs.com/itoak/p/13370031.html</p></blockquote><h1 class=pgc-h-arrow-right><strong>ä¸€ã€å­¦ä¹ æœ¬æ–‡ä½ èƒ½å­¦åˆ°ä»€ä¹ˆï¼Ÿ</strong></h1><ul><li>RPCçš„æ¦‚å¿µåŠè¿ä½œæµç¨‹</li><li>RPCåè®®åŠRPCæ¡†æ¶çš„æ¦‚å¿µ</li><li>Nettyçš„åŸºæœ¬ä½¿ç”¨</li><li>Javaåºåˆ—åŒ–åŠååºåˆ—åŒ–æŠ€æœ¯</li><li>Zookeeperçš„åŸºæœ¬ä½¿ç”¨ï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰</li><li>è‡ªå®šä¹‰æ³¨è§£å®ç°ç‰¹æ®Šä¸šåŠ¡é€»è¾‘</li><li>Javaçš„åŠ¨æ€ä»£ç†</li><li>è‡ªå®šä¹‰Spring Boot Starter</li></ul><p style=text-align:start>è¿™é‡Œåªæ˜¯åˆ—å‡ºäº†ä½ èƒ½ä»RPCæ¡†æ¶æºç ä¸­èƒ½å­¦åˆ°çš„ä¸œè¥¿ï¼Œæœ¬æ–‡å¹¶ä¸ä¼šæ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½ç‚¹åˆ°ï¼Œä¸»è¦è®²è¿°å¦‚ä½•æ‰‹å†™ä¸€ä¸ªRPCæ¡†æ¶ï¼Œæ›´å¤šç»†èŠ‚éœ€è¦è¯»è€…é˜…è¯»æºç ï¼Œæ–‡ç« çš„ä¸‹æ–¹ä¼šæä¾›æºç é“¾æ¥å“¦ã€‚</p><h1 class=pgc-h-arrow-right><strong>äºŒã€RPCåŸºç¡€çŸ¥è¯†</strong></h1><h1 class=pgc-h-arrow-right><strong>2.1 RPCæ˜¯ä»€ä¹ˆï¼Ÿ</strong></h1><p style=text-align:start>Remote Procedure Callï¼ˆRPCï¼‰ï¼šè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚</p><blockquote><p>è¿‡ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿè¿‡ç¨‹å°±æ˜¯ä¸šåŠ¡å¤„ç†ã€è®¡ç®—ä»»åŠ¡ï¼Œæ›´ç›´ç™½ç†è§£ï¼Œå°±æ˜¯ç¨‹åºã€‚ï¼ˆåƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹çš„è¿‡ç¨‹ã€‚ï¼‰</p></blockquote><p style=text-align:start>RPCé‡‡ç”¨Client-Serverç»“æ„ï¼Œé€šè¿‡Request-Responseæ¶ˆæ¯æ¨¡å¼å®ç°ã€‚</p><h1 class=pgc-h-arrow-right><strong>2.2 RPCçš„æµç¨‹</strong></h1><div class=pgc-img><img alt=åŒ…æ•™åŒ…ä¼šï¼çœ‹äº†è¿™ç¯‡ä½ å°±ä¼šæ‰‹å†™RPCæ¡†æ¶äº† onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/55d9c37ea69242bb9e645344cd879609><p class=pgc-img-caption></p></div><ul><li>å®¢æˆ·ç«¯å¤„ç†è¿‡ç¨‹ä¸­è°ƒç”¨Client stubï¼ˆå°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ï¼‰ï¼Œä¼ é€’å‚æ•°ï¼›</li><li>Client stubå°†å‚æ•°ç¼–ç»„ä¸ºæ¶ˆæ¯ï¼Œç„¶åé€šè¿‡ç³»ç»Ÿè°ƒç”¨å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼›</li><li>å®¢æˆ·ç«¯æœ¬åœ°æ“ä½œç³»ç»Ÿå°†æ¶ˆæ¯ä»å®¢æˆ·ç«¯æœºå™¨å‘é€åˆ°æœåŠ¡ç«¯æœºå™¨ï¼›</li><li>æœåŠ¡ç«¯æ“ä½œç³»ç»Ÿå°†æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ä¼ é€’ç»™Server stub;</li><li>Server stubè§£ç»„æ¶ˆæ¯ä¸ºå‚æ•°ï¼›</li><li>Server stubå†è°ƒç”¨æœåŠ¡ç«¯çš„è¿‡ç¨‹ï¼Œè¿‡ç¨‹æ‰§è¡Œç»“æœä»¥åæ–¹å‘çš„ç›¸åŒæ­¥éª¤å“åº”ç»™å®¢æˆ·ç«¯ã€‚</li></ul><h1 class=pgc-h-arrow-right><strong>2.3 RPCæµç¨‹ä¸­éœ€è¦å¤„ç†çš„é—®é¢˜</strong></h1><ul><li>Client stubã€Server stubçš„å¼€å‘ï¼›</li><li>å‚æ•°å¦‚ä½•ç¼–ç»„ä¸ºæ¶ˆæ¯ï¼Œä»¥åŠè§£ç»„æ¶ˆæ¯ï¼›</li><li>æ¶ˆæ¯å¦‚ä½•å‘é€ï¼›</li><li>è¿‡ç¨‹ç»“æœå¦‚ä½•è¡¨ç¤ºã€å¼‚å¸¸æƒ…å†µå¦‚ä½•å¤„ç†ï¼›</li><li>å¦‚ä½•å®ç°å®‰å…¨çš„è®¿é—®æ§åˆ¶ã€‚</li></ul><h1 class=pgc-h-arrow-right><strong>2.4 RPCåè®®æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h1><p style=text-align:start>RPCè°ƒç”¨è¿‡ç¨‹ä¸­éœ€è¦å°†å‚æ•°ç¼–ç»„ä¸ºæ¶ˆæ¯è¿›è¡Œå‘é€ï¼Œæ¥æ”¶æ–¹éœ€è¦è§£ç»„æ¶ˆæ¯ä¸ºå‚æ•°ï¼Œè¿‡ç¨‹å¤„ç†ç»“æœåŒæ ·éœ€è¦ç»ç¼–ç»„ã€è§£ç»„ã€‚æ¶ˆæ¯ç”±å“ªäº›éƒ¨åˆ†æ„æˆåŠæ¶ˆæ¯çš„è¡¨ç¤ºå½¢å¼å°±æ„æˆäº†æ¶ˆæ¯åè®®ã€‚</p><p style=text-align:start><strong>RPCè°ƒç”¨è¿‡ç¨‹ä¸­é‡‡ç”¨çš„æ¶ˆæ¯åè®®ç§°ä¸ºRPCåè®®</strong></p><blockquote><p>RPCåè®®è§„å®šè¯·æ±‚ã€å“åº”æ¶ˆæ¯çš„æ ¼å¼</p><p>åœ¨TCPï¼ˆç½‘ç»œä¼ è¾“æ§åˆ¶åè®®ï¼‰ä¸Šå¯é€‰ç”¨æˆ–è‡ªå®šä¹‰æ¶ˆæ¯åè®®æ¥å®ŒæˆRPCæ¶ˆæ¯äº¤äº’</p><p>æˆ‘ä»¬å¯ä»¥é€‰ç”¨é€šç”¨çš„æ ‡å‡†åè®®ï¼ˆå¦‚ï¼šhttpã€httpsï¼‰ï¼Œä¹Ÿä¹Ÿå¯æ ¹æ®è‡ªèº«çš„éœ€è¦å®šä¹‰è‡ªå·±çš„æ¶ˆæ¯åè®®ã€‚</p></blockquote><p style=text-align:start><br></p><h1 class=pgc-h-arrow-right><strong>2.5 RPCæ¡†æ¶æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h1><p style=text-align:start>å°è£…å¥½å‚æ•°ç¼–ç»„ã€æ¶ˆæ¯è§£ç»„ã€åº•å±‚ç½‘ç»œé€šä¿¡çš„RPCç¨‹åºå¼€å‘æ¡†æ¶ï¼Œå¸¦æ¥çš„ä¾¿æ·æ˜¯å¯ä»¥ç›´æ¥åœ¨å…¶åŸºç¡€ä¸Šåªéœ€è¦ä¸“æ³¨äºè¿‡ç¨‹ä»£ç ç¼–å†™ã€‚</p><p style=text-align:start>Javaé¢†åŸŸï¼š</p><ul><li>ä¼ ç»Ÿçš„webserviceæ¡†æ¶ï¼šApache CXFã€Apache Axis2ã€Javaè‡ªå¸¦çš„JAX-WSç­‰ã€‚webserviceæ¡†æ¶å¤§å¤šåŸºäºæ ‡å‡†çš„SOAPåè®®ã€‚</li><li>æ–°å…´çš„å¾®æœåŠ¡æ¡†æ¶ï¼šDubboã€spring cloudã€Apache Thriftç­‰ã€‚</li></ul><h1 class=pgc-h-arrow-right><strong>ä¸‰ã€æ‰‹å†™RPC</strong></h1><h1 class=pgc-h-arrow-right><strong>3.1 ç›®æ ‡</strong></h1><p style=text-align:start>æˆ‘ä»¬å°†ä¼šå†™ä¸€ä¸ªç®€æ˜“çš„RPCæ¡†æ¶ï¼Œæš‚ä¸”å«å®ƒleisure-rpc-spring-boot-starterï¼Œé€šè¿‡åœ¨é¡¹ç›®ä¸­å¼•å…¥è¯¥starterï¼Œå¹¶ç®€å•çš„é…ç½®ä¸€ä¸‹ï¼Œé¡¹ç›®å³æ‹¥æœ‰æä¾›è¿œç¨‹æœåŠ¡çš„èƒ½åŠ›ã€‚</p><p style=text-align:start>ç¼–å†™è‡ªå®šä¹‰æ³¨è§£@Serviceï¼Œè¢«å®ƒæ³¨è§£çš„ç±»å°†ä¼šæä¾›è¿œç¨‹æœåŠ¡ã€‚</p><p style=text-align:start>ç¼–å†™è‡ªå®šä¹‰æ³¨è§£@InjectServiceï¼Œä½¿ç”¨å®ƒå¯æ³¨å…¥è¿œç¨‹æœåŠ¡ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.2 é¡¹ç›®æ•´ä½“ç»“æ„</strong></h1><div class=pgc-img><img alt=åŒ…æ•™åŒ…ä¼šï¼çœ‹äº†è¿™ç¯‡ä½ å°±ä¼šæ‰‹å†™RPCæ¡†æ¶äº† onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/747182abb8da4394b1b197c9d7b7d3e2><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>3.3 å®¢æˆ·ç«¯ç¼–å†™</strong></h1><h1 class=pgc-h-arrow-right><strong>3.3.1 å®¢æˆ·ç«¯éœ€è¦åšä»€ä¹ˆï¼Ÿ</strong></h1><p style=text-align:start>å®¢æˆ·ç«¯æƒ³è¦è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œå¿…é¡»å…·å¤‡<strong>æœåŠ¡å‘ç°</strong>çš„èƒ½åŠ›ï¼›åœ¨çŸ¥é“æœ‰å“ªäº›æœåŠ¡è¿‡åï¼Œè¿˜å¿…é¡»æœ‰<strong>æœåŠ¡ä»£ç†</strong>æ¥æ‰§è¡ŒæœåŠ¡è°ƒç”¨ï¼›å®¢æˆ·ç«¯æƒ³è¦ä¸æœåŠ¡ç«¯é€šä¿¡ï¼Œå¿…é¡»è¦æœ‰ç›¸åŒçš„<strong>æ¶ˆæ¯åè®®</strong>ï¼›å®¢æˆ·ç«¯æƒ³è¦è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œé‚£ä¹ˆå¿…é¡»å…·å¤‡ç½‘ç»œè¯·æ±‚çš„èƒ½åŠ›ï¼Œå³<strong>ç½‘ç»œå±‚</strong>åŠŸèƒ½ã€‚</p><p style=text-align:start>å½“ç„¶ï¼Œè¿™æ˜¯å®¢æˆ·ç«¯æ‰€éœ€çš„æœ€åŸºæœ¬çš„èƒ½åŠ›ï¼Œå…¶å®è¿˜å¯ä»¥æ‰©å±•çš„èƒ½åŠ›ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.3.2 å…·ä½“å®ç°</strong></h1><p style=text-align:start>æˆ‘ä»¬å…ˆçœ‹çœ‹å®¢æˆ·ç«¯çš„ä»£ç ç»“æ„ï¼š</p><div class=pgc-img><img alt=åŒ…æ•™åŒ…ä¼šï¼çœ‹äº†è¿™ç¯‡ä½ å°±ä¼šæ‰‹å†™RPCæ¡†æ¶äº† onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7a4fa227f9f5460aa20360b0aab5b3f0><p class=pgc-img-caption></p></div><p style=text-align:start>åŸºäºé¢å‘æ¥å£ç¼–ç¨‹çš„ç†å¿µï¼Œä¸åŒè§’è‰²éƒ½å®ç°äº†å®šä¹‰äº†ç›¸åº”è§„èŒƒçš„æ¥å£ã€‚è¿™é‡Œé¢æˆ‘ä»¬æ²¡æœ‰å‘ç°æ¶ˆæ¯åè®®ç›¸å…³å†…å®¹ï¼Œé‚£æ˜¯å› ä¸ºæœåŠ¡ç«¯ä¹Ÿéœ€è¦æ¶ˆæ¯åè®®ï¼Œå› æ­¤æŠ½ç¦»äº†å‡ºæ¥ï¼Œæ”¾åœ¨å…¬å…±å±‚ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.3.2.1 æœåŠ¡å‘ç°è€…</strong></h1><pre><code>/*** æœåŠ¡å‘ç°æŠ½è±¡ç±»ï¼Œå®šä¹‰æœåŠ¡å‘ç°è§„èŒƒ** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/publicÂ interfaceÂ ServiceDiscovererÂ {Â  Â List&lt;Service&gt;Â getServices(StringÂ name);}/*** ZookeeperæœåŠ¡å‘ç°è€…ï¼Œå®šä¹‰ä»¥Zookeeperä¸ºæ³¨å†Œä¸­å¿ƒçš„æœåŠ¡å‘ç°ç»†åˆ™** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/publicÂ classÂ ZookeeperServiceDiscovererÂ implementsÂ ServiceDiscovererÂ {Â  Â privateÂ ZkClientÂ zkClient;Â  Â publicÂ ZookeeperServiceDiscoverer(StringÂ zkAddress) {Â  Â  Â  Â zkClientÂ =Â newÂ ZkClient(zkAddress);Â  Â  Â  Â zkClient.setZkSerializer(newÂ ZookeeperSerializer());Â  }Â  Â /**Â  Â Â * ä½¿ç”¨Zookeeperå®¢æˆ·ç«¯ï¼Œé€šè¿‡æœåŠ¡åè·å–æœåŠ¡åˆ—è¡¨Â  Â Â * æœåŠ¡åæ ¼å¼ï¼šæ¥å£å…¨è·¯å¾„Â  Â Â *Â  Â Â * @param name æœåŠ¡åÂ  Â Â * @return æœåŠ¡åˆ—è¡¨Â  Â Â */Â  Â @OverrideÂ  Â publicÂ List&lt;Service&gt;Â getServices(StringÂ name) {Â  Â  Â  Â StringÂ servicePathÂ =Â LeisureConstant.ZK_SERVICE_PATHÂ +LeisureConstant.PATH_DELIMITERÂ +Â nameÂ +Â "/service";Â  Â  Â  Â List&lt;String&gt;Â childrenÂ =Â zkClient.getChildren(servicePath);Â  Â  Â  Â returnÂ Optional.ofNullable(children).orElse(newÂ ArrayList&lt;&gt;()).stream().map(strÂ -&gt;Â {Â  Â  Â  Â  Â  Â StringÂ deChÂ =Â null;Â  Â  Â  Â  Â  Â tryÂ {Â  Â  Â  Â  Â  Â  Â  Â deChÂ =Â URLDecoder.decode(str,Â LeisureConstant.UTF_8);Â  Â  Â  Â  Â  }Â catchÂ (UnsupportedEncodingExceptionÂ e) {Â  Â  Â  Â  Â  Â  Â  Â e.printStackTrace();Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â returnÂ JSON.parseObject(deCh,Â Service.class);Â  Â  Â  }).collect(Collectors.toList());Â  }}</code></pre><p style=text-align:start>æœåŠ¡å‘ç°è€…ä½¿ç”¨Zookeeperæ¥å®ç°ï¼Œé€šè¿‡ZkClientæˆ‘ä»¬å¾ˆå®¹æ˜“å‘ç°å·²ç»æ³¨å†Œåœ¨ZKä¸Šçš„æœåŠ¡ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ç»„ä»¶ä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œä¾‹å¦‚Redisã€‚</p><h1 class=pgc-h-arrow-right><strong>3.3.2.2 ç½‘ç»œå®¢æˆ·ç«¯</strong></h1><pre><code>/*** ç½‘ç»œè¯·æ±‚å®¢æˆ·ç«¯ï¼Œå®šä¹‰ç½‘ç»œè¯·æ±‚è§„èŒƒ** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/publicÂ interfaceÂ NetClientÂ {Â  Â byte[]Â sendRequest(byte[]Â data,Â ServiceÂ service)Â throwsÂ InterruptedException;}/*** Nettyç½‘ç»œè¯·æ±‚å®¢æˆ·ç«¯ï¼Œå®šä¹‰é€šè¿‡Nettyå®ç°ç½‘ç»œè¯·æ±‚çš„ç»†åˆ™ã€‚** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/publicÂ classÂ NettyNetClientÂ implementsÂ NetClientÂ {Â  Â privateÂ staticÂ LoggerÂ loggerÂ =Â LoggerFactory.getLogger(NettyNetClient.class);Â  Â /**Â  Â Â * å‘é€è¯·æ±‚Â  Â Â *Â  Â Â * @param data Â  è¯·æ±‚æ•°æ®Â  Â Â * @param service æœåŠ¡ä¿¡æ¯Â  Â Â * @return å“åº”æ•°æ®Â  Â Â * @throws InterruptedException å¼‚å¸¸Â  Â Â */Â  Â @OverrideÂ  Â publicÂ byte[]Â sendRequest(byte[]Â data,Â ServiceÂ service)Â throwsInterruptedExceptionÂ {Â  Â  Â  Â String[]Â addInfoArrayÂ =Â service.getAddress().split(":");Â  Â  Â  Â StringÂ serverAddressÂ =Â addInfoArray[0];Â  Â  Â  Â StringÂ serverPortÂ =Â addInfoArray[1];Â  Â  Â  Â SendHandlerÂ sendHandlerÂ =Â newÂ SendHandler(data);Â  Â  Â  Â byte[]Â respData;Â  Â  Â  Â // é…ç½®å®¢æˆ·ç«¯Â  Â  Â  Â EventLoopGroupÂ groupÂ =Â newÂ NioEventLoopGroup();Â  Â  Â  Â tryÂ {Â  Â  Â  Â  Â  Â BootstrapÂ bÂ =Â newÂ Bootstrap();Â  Â  Â  Â  Â  Â b.group(group).channel(NioSocketChannel.class).option(ChannelOption.TCP_NODELAY,Â true)Â  Â  Â  Â  Â  Â  Â  Â  Â  .handler(newÂ ChannelInitializer&lt;SocketChannel&gt;() {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â @OverrideÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â publicÂ voidÂ initChannel(SocketChannelÂ ch) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ChannelPipelineÂ pÂ =Â ch.pipeline();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â p.addLast(sendHandler);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â // å¯åŠ¨å®¢æˆ·ç«¯è¿æ¥Â  Â  Â  Â  Â  Â b.connect(serverAddress,Â Integer.parseInt(serverPort)).sync();Â  Â  Â  Â  Â  Â respDataÂ =Â (byte[])Â sendHandler.rspData();Â  Â  Â  Â  Â  Â logger.info("SendRequest get reply: {}",Â respData);Â  Â  Â  }Â finallyÂ {Â  Â  Â  Â  Â  Â // é‡Šæ”¾çº¿ç¨‹ç»„èµ„æºÂ  Â  Â  Â  Â  Â group.shutdownGracefully();Â  Â  Â  }Â  Â  Â  Â returnÂ respData;Â  }}/*** å‘é€å¤„ç†ç±»ï¼Œå®šä¹‰Nettyå…¥ç«™å¤„ç†ç»†åˆ™** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/publicÂ classÂ SendHandlerÂ extendsÂ ChannelInboundHandlerAdapterÂ {Â  Â privateÂ staticÂ LoggerÂ loggerÂ =Â LoggerFactory.getLogger(SendHandler.class);Â  Â privateÂ CountDownLatchÂ cdl;Â  Â privateÂ ObjectÂ readMsgÂ =Â null;Â  Â privateÂ byte[]Â data;Â  Â publicÂ SendHandler(byte[]Â data) {Â  Â  Â  Â cdlÂ =Â newÂ CountDownLatch(1);Â  Â  Â  Â this.dataÂ =Â data;Â  }Â  Â /**Â  Â Â * å½“è¿æ¥æœåŠ¡ç«¯æˆåŠŸåï¼Œå‘é€è¯·æ±‚æ•°æ®Â  Â Â *Â  Â Â * @param ctx é€šé“ä¸Šä¸‹æ–‡Â  Â Â */Â  Â @OverrideÂ  Â publicÂ voidÂ channelActive(ChannelHandlerContextÂ ctx) {Â  Â  Â  Â logger.info("Successful connection to serverï¼š{}",Â ctx);Â  Â  Â  Â ByteBufÂ reqBufÂ =Â Unpooled.buffer(data.length);Â  Â  Â  Â reqBuf.writeBytes(data);Â  Â  Â  Â logger.info("Client sends messageï¼š{}",Â reqBuf);Â  Â  Â  Â ctx.writeAndFlush(reqBuf);Â  }Â  Â /**Â  Â Â * è¯»å–æ•°æ®ï¼Œæ•°æ®è¯»å–å®Œæ¯•é‡Šæ”¾CDé”Â  Â Â *Â  Â Â * @param ctx ä¸Šä¸‹æ–‡Â  Â Â * @param msg ByteBufÂ  Â Â */Â  Â @OverrideÂ  Â publicÂ voidÂ channelRead(ChannelHandlerContextÂ ctx,Â ObjectÂ msg) {Â  Â  Â  Â logger.info("Client reads message: {}",Â msg);Â  Â  Â  Â ByteBufÂ msgBufÂ =Â (ByteBuf)Â msg;Â  Â  Â  Â byte[]Â respÂ =Â newÂ byte[msgBuf.readableBytes()];Â  Â  Â  Â msgBuf.readBytes(resp);Â  Â  Â  Â readMsgÂ =Â resp;Â  Â  Â  Â cdl.countDown();Â  }Â  Â /**Â  Â Â * ç­‰å¾…è¯»å–æ•°æ®å®ŒæˆÂ  Â Â *Â  Â Â * @return å“åº”æ•°æ®Â  Â Â * @throws InterruptedException å¼‚å¸¸Â  Â Â */Â  Â publicÂ ObjectÂ rspData()Â throwsÂ InterruptedExceptionÂ {Â  Â  Â  Â cdl.await();Â  Â  Â  Â returnÂ readMsg;Â  }Â  Â @OverrideÂ  Â publicÂ voidÂ channelReadComplete(ChannelHandlerContextÂ ctx) {Â  Â  Â  Â ctx.flush();Â  }Â  Â @OverrideÂ  Â publicÂ voidÂ exceptionCaught(ChannelHandlerContextÂ ctx,Â ThrowableÂ cause) {Â  Â  Â  Â // Close the connection when an exception is raised.Â  Â  Â  Â cause.printStackTrace();Â  Â  Â  Â logger.error("Exception occurredï¼š{}",Â cause.getMessage());Â  Â  Â  Â ctx.close();Â  }}</code></pre><p style=text-align:start>åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Nettyæ¥å®ç°ç½‘ç»œè¯·æ±‚å®¢æˆ·ç«¯ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨Minaã€‚ç½‘ç»œè¯·æ±‚å®¢æˆ·ç«¯èƒ½è¿æ¥è¿œç¨‹æœåŠ¡ç«¯ï¼Œå¹¶å°†ç¼–ç»„å¥½çš„è¯·æ±‚æ•°æ®å‘é€ç»™æœåŠ¡ç«¯ï¼Œå¾…æœåŠ¡ç«¯å¤„ç†å¥½åï¼Œåˆå°†æœåŠ¡ç«¯çš„å“åº”æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.3.2.3 æœåŠ¡ä»£ç†</strong></h1><pre><code>/*** å®¢æˆ·ç«¯ä»£ç†å·¥å‚ï¼šç”¨äºåˆ›å»ºè¿œç¨‹æœåŠ¡ä»£ç†ç±»* å°è£…ç¼–ç»„è¯·æ±‚ã€è¯·æ±‚å‘é€ã€ç¼–ç»„å“åº”ç­‰æ“ä½œã€‚** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/publicÂ classÂ ClientProxyFactoryÂ {Â  Â privateÂ ServiceDiscovererÂ serviceDiscoverer;Â  Â privateÂ Map&lt;String,Â MessageProtocol&gt;Â supportMessageProtocols;Â  Â privateÂ NetClientÂ netClient;Â  Â privateÂ Map&lt;Class&lt;?&gt;,Â Object&gt;Â objectCacheÂ =Â newÂ HashMap&lt;&gt;();Â  Â /**Â  Â Â * é€šè¿‡JavaåŠ¨æ€ä»£ç†è·å–æœåŠ¡ä»£ç†ç±»Â  Â Â *Â  Â Â * @param clazz è¢«ä»£ç†ç±»ClassÂ  Â Â * @param &lt;T&gt; Â  æ³›å‹Â  Â Â * @return æœåŠ¡ä»£ç†ç±»Â  Â Â */Â  Â @SuppressWarnings("unchecked")Â  Â publicÂ &lt;T&gt;Â TÂ getProxy(Class&lt;T&gt;Â clazz) {Â  Â  Â  Â returnÂ (T)Â this.objectCache.computeIfAbsent(clazz,Â  Â  Â  Â  Â  Â  Â  Â clsÂ -&gt;Â newProxyInstance(cls.getClassLoader(),Â newÂ Class&lt;?&gt;[]{cls},Â newClientInvocationHandler(cls)));Â  }Â  Â // getter setter ...Â  Â /**Â  Â Â * å®¢æˆ·ç«¯æœåŠ¡ä»£ç†ç±»invokeå‡½æ•°ç»†èŠ‚å®ç°Â  Â Â */Â  Â privateÂ classÂ ClientInvocationHandlerÂ implementsÂ InvocationHandlerÂ {Â  Â  Â  Â privateÂ Class&lt;?&gt;Â clazz;Â  Â  Â  Â privateÂ RandomÂ randomÂ =Â newÂ Random();Â  Â  Â  Â publicÂ ClientInvocationHandler(Class&lt;?&gt;Â clazz) {Â  Â  Â  Â  Â  Â super();Â  Â  Â  Â  Â  Â this.clazzÂ =Â clazz;Â  Â  Â  }Â  Â  Â  Â @OverrideÂ  Â  Â  Â publicÂ ObjectÂ invoke(ObjectÂ proxy,Â MethodÂ method,Â Object[]Â args)Â throwsExceptionÂ {Â  Â  Â  Â  Â  Â ifÂ (method.getName().equals("toString")) {Â  Â  Â  Â  Â  Â  Â  Â returnÂ proxy.getClass().toString();Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â ifÂ (method.getName().equals("hashCode")) {Â  Â  Â  Â  Â  Â  Â  Â returnÂ 0;Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â // 1ã€è·å¾—æœåŠ¡ä¿¡æ¯Â  Â  Â  Â  Â  Â StringÂ serviceNameÂ =Â this.clazz.getName();Â  Â  Â  Â  Â  Â List&lt;Service&gt;Â servicesÂ =Â serviceDiscoverer.getServices(serviceName);Â  Â  Â  Â  Â  Â ifÂ (servicesÂ ==Â nullÂ ||Â services.isEmpty()) {Â  Â  Â  Â  Â  Â  Â  Â throwÂ newÂ LeisureException("No provider available!");Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â // éšæœºé€‰æ‹©ä¸€ä¸ªæœåŠ¡æä¾›è€…ï¼ˆè½¯è´Ÿè½½å‡è¡¡ï¼‰Â  Â  Â  Â  Â  Â ServiceÂ serviceÂ =Â services.get(random.nextInt(services.size()));Â  Â  Â  Â  Â  Â // 2ã€æ„é€ requestå¯¹è±¡Â  Â  Â  Â  Â  Â LeisureRequestÂ reqÂ =Â newÂ LeisureRequest();Â  Â  Â  Â  Â  Â req.setServiceName(service.getName());Â  Â  Â  Â  Â  Â req.setMethod(method.getName());Â  Â  Â  Â  Â  Â req.setParameterTypes(method.getParameterTypes());Â  Â  Â  Â  Â  Â req.setParameters(args);Â  Â  Â  Â  Â  Â // 3ã€åè®®å±‚ç¼–ç»„Â  Â  Â  Â  Â  Â // è·å¾—è¯¥æ–¹æ³•å¯¹åº”çš„åè®®Â  Â  Â  Â  Â  Â MessageProtocolÂ protocolÂ =supportMessageProtocols.get(service.getProtocol());Â  Â  Â  Â  Â  Â // ç¼–ç»„è¯·æ±‚Â  Â  Â  Â  Â  Â byte[]Â dataÂ =Â protocol.marshallingRequest(req);Â  Â  Â  Â  Â  Â // 4ã€è°ƒç”¨ç½‘ç»œå±‚å‘é€è¯·æ±‚Â  Â  Â  Â  Â  Â byte[]Â repDataÂ =Â netClient.sendRequest(data,Â service);Â  Â  Â  Â  Â  Â // 5è§£ç»„å“åº”æ¶ˆæ¯Â  Â  Â  Â  Â  Â LeisureResponseÂ rspÂ =Â protocol.unmarshallingResponse(repData);Â  Â  Â  Â  Â  Â // 6ã€ç»“æœå¤„ç†Â  Â  Â  Â  Â  Â ifÂ (rsp.getException()Â !=Â null) {Â  Â  Â  Â  Â  Â  Â  Â throwÂ rsp.getException();Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â returnÂ rsp.getReturnValue();Â  Â  Â  }Â  }}</code></pre><p style=text-align:start>æœåŠ¡ä»£ç†ç±»ç”±å®¢æˆ·ç«¯ä»£ç†å·¥å‚ç±»äº§ç”Ÿï¼Œä»£ç†æ–¹å¼æ˜¯åŸºäºJavaçš„åŠ¨æ€ä»£ç†ã€‚åœ¨å¤„ç†ç±»ClientInvocationHandlerçš„invokeå‡½æ•°ä¸­ï¼Œå®šä¹‰äº†ä¸€ç³»åˆ—çš„æ“ä½œï¼ŒåŒ…æ‹¬è·å–æœåŠ¡ã€é€‰æ‹©æœåŠ¡æä¾›è€…ã€æ„é€ è¯·æ±‚å¯¹è±¡ã€ç¼–ç»„è¯·æ±‚å¯¹è±¡ã€ç½‘ç»œè¯·æ±‚å®¢æˆ·ç«¯å‘é€è¯·æ±‚ã€è§£ç»„å“åº”æ¶ˆæ¯ã€å¼‚å¸¸å¤„ç†ç­‰ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.3.2.4 æ¶ˆæ¯åè®®</strong></h1><pre><code>/*** æ¶ˆæ¯åè®®ï¼Œå®šä¹‰ç¼–ç»„è¯·æ±‚ã€è§£ç»„è¯·æ±‚ã€ç¼–ç»„å“åº”ã€è§£ç»„å“åº”è§„èŒƒ** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/publicÂ interfaceÂ MessageProtocolÂ {Â  Â /**Â  Â Â * ç¼–ç»„è¯·æ±‚Â  Â Â *Â  Â Â * @param req è¯·æ±‚ä¿¡æ¯Â  Â Â * @return è¯·æ±‚å­—èŠ‚æ•°ç»„Â  Â Â * @throws Exception ç¼–ç»„è¯·æ±‚å¼‚å¸¸Â  Â Â */Â  Â byte[]Â marshallingRequest(LeisureRequestÂ req)Â throwsÂ Exception;Â  Â /**Â  Â Â * è§£ç»„è¯·æ±‚Â  Â Â *Â  Â Â * @param data è¯·æ±‚å­—èŠ‚æ•°ç»„Â  Â Â * @return è¯·æ±‚ä¿¡æ¯Â  Â Â * @throws Exception è§£ç»„è¯·æ±‚å¼‚å¸¸Â  Â Â */Â  Â LeisureRequestÂ unmarshallingRequest(byte[]Â data)Â throwsÂ Exception;Â  Â /**Â  Â Â * ç¼–ç»„å“åº”Â  Â Â *Â  Â Â * @param rsp å“åº”ä¿¡æ¯Â  Â Â * @return å“åº”å­—èŠ‚æ•°ç»„Â  Â Â * @throws Exception ç¼–ç»„å“åº”å¼‚å¸¸Â  Â Â */Â  Â byte[]Â marshallingResponse(LeisureResponseÂ rsp)Â throwsÂ Exception;Â  Â /**Â  Â Â * è§£ç»„å“åº”Â  Â Â *Â  Â Â * @param data å“åº”å­—èŠ‚æ•°ç»„Â  Â Â * @return å“åº”ä¿¡æ¯Â  Â Â * @throws Exception è§£ç»„å“åº”å¼‚å¸¸Â  Â Â */Â  Â LeisureResponseÂ unmarshallingResponse(byte[]Â data)Â throwsÂ Exception;}/*** Javaåºåˆ—åŒ–æ¶ˆæ¯åè®®** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/publicÂ classÂ JavaSerializeMessageProtocolÂ implementsÂ MessageProtocolÂ {Â  Â privateÂ byte[]Â serialize(ObjectÂ obj)Â throwsÂ ExceptionÂ {Â  Â  Â  Â ByteArrayOutputStreamÂ boutÂ =Â newÂ ByteArrayOutputStream();Â  Â  Â  Â ObjectOutputStreamÂ outÂ =Â newÂ ObjectOutputStream(bout);Â  Â  Â  Â out.writeObject(obj);Â  Â  Â  Â returnÂ bout.toByteArray();Â  }Â  Â @OverrideÂ  Â publicÂ byte[]Â marshallingRequest(LeisureRequestÂ req)Â throwsÂ ExceptionÂ {Â  Â  Â  Â returnÂ this.serialize(req);Â  }Â  Â @OverrideÂ  Â publicÂ LeisureRequestÂ unmarshallingRequest(byte[]Â data)Â throwsÂ ExceptionÂ {Â  Â  Â  Â ObjectInputStreamÂ inÂ =Â newÂ ObjectInputStream(newByteArrayInputStream(data));Â  Â  Â  Â returnÂ (LeisureRequest)Â in.readObject();Â  }Â  Â @OverrideÂ  Â publicÂ byte[]Â marshallingResponse(LeisureResponseÂ rsp)Â throwsÂ ExceptionÂ {Â  Â  Â  Â returnÂ this.serialize(rsp);Â  }Â  Â @OverrideÂ  Â publicÂ LeisureResponseÂ unmarshallingResponse(byte[]Â data)Â throwsÂ ExceptionÂ {Â  Â  Â  Â ObjectInputStreamÂ inÂ =Â newÂ ObjectInputStream(newByteArrayInputStream(data));Â  Â  Â  Â returnÂ (LeisureResponse)Â in.readObject();Â  }}</code></pre><p style=text-align:start>æ¶ˆæ¯åè®®ä¸»è¦æ˜¯å®šä¹‰äº†å®¢æˆ·ç«¯å¦‚ä½•<strong>ç¼–ç»„è¯·æ±‚</strong>ã€<strong>è§£ç»„å“åº”</strong>ï¼ŒæœåŠ¡ç«¯å¦‚ä½•<strong>è§£ç»„è¯·æ±‚</strong>ã€<strong>ç¼–ç»„å“åº”</strong>è¿™å››ä¸ªæ“ä½œè§„èŒƒã€‚æœ¬æ–‡æä¾›äº†Javaåºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„å®ç°ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥åŸºäºå…¶ä»–åºåˆ—åŒ–æŠ€æœ¯å®ç°å…¶ä»–æ¶ˆæ¯åè®®ï¼ˆå·å·è¯´ä¸€å¥ï¼šJavaçš„åºåˆ—åŒ–æ€§èƒ½å¾ˆä¸ç†æƒ³ï¼‰ã€‚</p><p style=text-align:start><br></p><h1 class=pgc-h-arrow-right><strong>3.4 æœåŠ¡ç«¯ç¼–å†™</strong></h1><h1 class=pgc-h-arrow-right><strong>3.4.1 æœåŠ¡ç«¯éœ€è¦åšä»€ä¹ˆï¼Ÿ</strong></h1><p style=text-align:start>é¦–å…ˆï¼ŒæœåŠ¡ç«¯è¦æä¾›è¿œç¨‹æœåŠ¡ï¼Œå¿…é¡»å…·å¤‡<strong>æœåŠ¡æ³¨å†ŒåŠæš´éœ²</strong>çš„èƒ½åŠ›ï¼›åœ¨è¿™ä¹‹åï¼Œè¿˜éœ€è¦å¼€å¯<strong>ç½‘ç»œæœåŠ¡</strong>ï¼Œä¾›å®¢æˆ·ç«¯è¿æ¥ã€‚æœ‰äº›é¡¹ç›®å¯èƒ½æ—¢æ˜¯æœåŠ¡æä¾›è€…ï¼Œåˆæ˜¯æœåŠ¡æ¶ˆè´¹è€…ï¼Œé‚£ä»€ä¹ˆæ—¶å€™å¼€å¯æœåŠ¡ï¼Œä»€ä¹ˆæ—¶å€™æ³¨å…¥æœåŠ¡å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ª<strong>RPCå¤„ç†è€…</strong>çš„æ¦‚å¿µï¼Œç”±å®ƒæ¥å¸®æˆ‘ä»¬å¼€å¯æœåŠ¡ï¼Œä»¥åŠæ³¨å…¥æœåŠ¡ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.4.3 å…·ä½“å®ç°</strong></h1><p style=text-align:start>å…ˆçœ‹çœ‹æœåŠ¡ç«¯çš„ä»£ç ç»“æ„ï¼š</p><div class=pgc-img><img alt=åŒ…æ•™åŒ…ä¼šï¼çœ‹äº†è¿™ç¯‡ä½ å°±ä¼šæ‰‹å†™RPCæ¡†æ¶äº† onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6df64a1fc70b447da611d69af84df99c><p class=pgc-img-caption></p></div><p style=text-align:start>æœåŠ¡ç«¯åšçš„äº‹æƒ…ä¹Ÿå¾ˆç®€å•ï¼Œæ³¨å†ŒæœåŠ¡å¹¶æš´éœ²æœåŠ¡ï¼Œç„¶åå¼€å¯ç½‘ç»œæœåŠ¡ï¼›å¦‚æœæœåŠ¡ç«¯ä¹Ÿæ˜¯æ¶ˆè´¹è€…ï¼Œåˆ™æ³¨å…¥è¿œç¨‹æœåŠ¡ã€‚</p><p style=text-align:start>æœåŠ¡æ³¨å†Œå’ŒæœåŠ¡æ³¨å…¥ä¾èµ–ä¸¤ä¸ªè‡ªå®šä¹‰æ³¨è§£æ¥å®ç°ï¼š</p><ul><li>@Serviceï¼šæ³¨å†ŒæœåŠ¡</li><li>@InjectServiceï¼šæ³¨å…¥æœåŠ¡</li></ul><p style=text-align:start>ä¸‹é¢æ˜¯ä»–ä»¬çš„å®ç°ä»£ç ï¼š</p><pre><code>/*** è¢«è¯¥æ³¨è§£æ ‡è®°çš„æœåŠ¡å¯æä¾›è¿œç¨‹RPCè®¿é—®çš„èƒ½åŠ›** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/@Target({ElementType.TYPE})@Retention(RetentionPolicy.RUNTIME)@Documented@ComponentpublicÂ @interfaceÂ ServiceÂ {Â  Â StringÂ value()Â defaultÂ "";}/*** è¯¥æ³¨è§£ç”¨äºæ³¨å…¥è¿œç¨‹æœåŠ¡** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/@Target({ElementType.FIELD})@Retention(RetentionPolicy.RUNTIME)@DocumentedpublicÂ @interfaceÂ InjectServiceÂ {}</code></pre><h1 class=pgc-h-arrow-right><strong>3.4.3.1 æœåŠ¡æ³¨å†Œ(æš´éœ²)</strong></h1><pre><code>/*** æœåŠ¡æ³¨å†Œå™¨ï¼Œå®šä¹‰æœåŠ¡æ³¨å†Œè§„èŒƒ** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/publicÂ interfaceÂ ServiceRegisterÂ {Â  Â voidÂ register(ServiceObjectÂ so)Â throwsÂ Exception;Â  Â ServiceObjectÂ getServiceObject(StringÂ name)Â throwsÂ Exception;}/*** é»˜è®¤æœåŠ¡æ³¨å†Œå™¨** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/publicÂ classÂ DefaultServiceRegisterÂ implementsÂ ServiceRegisterÂ {Â  Â privateÂ Map&lt;String,Â ServiceObject&gt;Â serviceMapÂ =Â newÂ HashMap&lt;&gt;();Â  Â protectedÂ StringÂ protocol;Â  Â protectedÂ IntegerÂ port;Â  Â @OverrideÂ  Â publicÂ voidÂ register(ServiceObjectÂ so)Â throwsÂ ExceptionÂ {Â  Â  Â  Â ifÂ (soÂ ==Â null) {Â  Â  Â  Â  Â  Â throwÂ newÂ IllegalArgumentException("Parameter cannot be empty.");Â  Â  Â  }Â  Â  Â  Â this.serviceMap.put(so.getName(),Â so);Â  }Â  Â @OverrideÂ  Â publicÂ ServiceObjectÂ getServiceObject(StringÂ name) {Â  Â  Â  Â returnÂ this.serviceMap.get(name);Â  }}/*** ZookeeperæœåŠ¡æ³¨å†Œå™¨ï¼Œæä¾›æœåŠ¡æ³¨å†Œã€æœåŠ¡æš´éœ²çš„èƒ½åŠ›** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/publicÂ classÂ ZookeeperExportServiceRegisterÂ extendsÂ DefaultServiceRegisterimplementsÂ ServiceRegisterÂ {Â  Â /**Â  Â Â * Zkå®¢æˆ·ç«¯Â  Â Â */Â  Â privateÂ ZkClientÂ client;Â  Â publicÂ ZookeeperExportServiceRegister(StringÂ zkAddress,Â IntegerÂ port,Â Stringprotocol) {Â  Â  Â  Â clientÂ =Â newÂ ZkClient(zkAddress);Â  Â  Â  Â client.setZkSerializer(newÂ ZookeeperSerializer());Â  Â  Â  Â this.portÂ =Â port;Â  Â  Â  Â this.protocolÂ =Â protocol;Â  }Â  Â /**Â  Â Â * æœåŠ¡æ³¨å†ŒÂ  Â Â *Â  Â Â * @param so æœåŠ¡æŒæœ‰è€…Â  Â Â * @throws Exception æ³¨å†Œå¼‚å¸¸Â  Â Â */Â  Â @OverrideÂ  Â publicÂ voidÂ register(ServiceObjectÂ so)Â throwsÂ ExceptionÂ {Â  Â  Â  Â super.register(so);Â  Â  Â  Â ServiceÂ serviceÂ =Â newÂ Service();Â  Â  Â  Â StringÂ hostÂ =Â InetAddress.getLocalHost().getHostAddress();Â  Â  Â  Â StringÂ addressÂ =Â hostÂ +Â ":"Â +Â port;Â  Â  Â  Â service.setAddress(address);Â  Â  Â  Â service.setName(so.getClazz().getName());Â  Â  Â  Â service.setProtocol(protocol);Â  Â  Â  Â this.exportService(service);Â  }Â  Â /**Â  Â Â * æœåŠ¡æš´éœ²Â  Â Â *Â  Â Â * @param serviceResource éœ€è¦æš´éœ²çš„æœåŠ¡ä¿¡æ¯Â  Â Â */Â  Â privateÂ voidÂ exportService(ServiceÂ serviceResource) {Â  Â  Â  Â StringÂ serviceNameÂ =Â serviceResource.getName();Â  Â  Â  Â StringÂ uriÂ =Â JSON.toJSONString(serviceResource);Â  Â  Â  Â tryÂ {Â  Â  Â  Â  Â  Â uriÂ =Â URLEncoder.encode(uri,Â UTF_8);Â  Â  Â  }Â catchÂ (UnsupportedEncodingExceptionÂ e) {Â  Â  Â  Â  Â  Â e.printStackTrace();Â  Â  Â  }Â  Â  Â  Â StringÂ servicePathÂ =Â ZK_SERVICE_PATHÂ +Â PATH_DELIMITERÂ +Â serviceNameÂ +"/service";Â  Â  Â  Â ifÂ (!client.exists(servicePath)) {Â  Â  Â  Â  Â  Â client.createPersistent(servicePath,Â true);Â  Â  Â  }Â  Â  Â  Â StringÂ uriPathÂ =Â servicePathÂ +Â PATH_DELIMITERÂ +Â uri;Â  Â  Â  Â ifÂ (client.exists(uriPath)) {Â  Â  Â  Â  Â  Â client.delete(uriPath);Â  Â  Â  }Â  Â  Â  Â client.createEphemeral(uriPath);Â  }}</code></pre><p style=text-align:start>è¿™ä¸ªè¿‡ç¨‹å…¶å®æ²¡å•¥å¥½è¯´çš„ï¼Œå°±æ˜¯å°†æŒ‡å®šServiceObjectå¯¹è±¡åºåˆ—åŒ–åä¿å­˜åˆ°ZKä¸Šï¼Œä¾›å®¢æˆ·ç«¯å‘ç°ã€‚åŒæ—¶ä¼šå°†æœåŠ¡å¯¹è±¡ç¼“å­˜èµ·æ¥ï¼Œåœ¨å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡æ—¶ï¼Œé€šè¿‡ç¼“å­˜çš„ServiceObjectå¯¹è±¡åå°„æŒ‡å®šæœåŠ¡ï¼Œè°ƒç”¨æ–¹æ³•ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.4.3.2 ç½‘ç»œæœåŠ¡</strong></h1><pre><code>/*** RPCæœåŠ¡ç«¯æŠ½è±¡ç±»** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/publicÂ abstractÂ classÂ RpcServerÂ {Â  Â /**Â  Â Â * æœåŠ¡ç«¯å£Â  Â Â */Â  Â protectedÂ intÂ port;Â  Â /**Â  Â Â * æœåŠ¡åè®®Â  Â Â */Â  Â protectedÂ StringÂ protocol;Â  Â /**Â  Â Â * è¯·æ±‚å¤„ç†è€…Â  Â Â */Â  Â protectedÂ RequestHandlerÂ handler;Â  Â publicÂ RpcServer(intÂ port,Â StringÂ protocol,Â RequestHandlerÂ handler) {Â  Â  Â  Â super();Â  Â  Â  Â this.portÂ =Â port;Â  Â  Â  Â this.protocolÂ =Â protocol;Â  Â  Â  Â this.handlerÂ =Â handler;Â  }Â  Â /**Â  Â Â * å¼€å¯æœåŠ¡Â  Â Â */Â  Â publicÂ abstractÂ voidÂ start();Â  Â /**Â  Â Â * åœæ­¢æœåŠ¡Â  Â Â */Â  Â publicÂ abstractÂ voidÂ stop();// getter setter ...}/*** Netty RPCæœåŠ¡ç«¯ï¼Œæä¾›Nettyç½‘ç»œæœåŠ¡å¼€å¯ã€å…³é—­çš„èƒ½åŠ›** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/publicÂ classÂ NettyRpcServerÂ extendsÂ RpcServerÂ {Â  Â privateÂ staticÂ LoggerÂ loggerÂ =Â LoggerFactory.getLogger(NettyRpcServer.class);Â  Â privateÂ ChannelÂ channel;Â  Â publicÂ NettyRpcServer(intÂ port,Â StringÂ protocol,Â RequestHandlerÂ handler) {Â  Â  Â  Â super(port,Â protocol,Â handler);Â  }Â  Â @OverrideÂ  Â publicÂ voidÂ start() {Â  Â  Â  Â // é…ç½®æœåŠ¡å™¨Â  Â  Â  Â EventLoopGroupÂ bossGroupÂ =Â newÂ NioEventLoopGroup(1);Â  Â  Â  Â EventLoopGroupÂ workerGroupÂ =Â newÂ NioEventLoopGroup();Â  Â  Â  Â tryÂ {Â  Â  Â  Â  Â  Â ServerBootstrapÂ bÂ =Â newÂ ServerBootstrap();Â  Â  Â  Â  Â  Â b.group(bossGroup,workerGroup).channel(NioServerSocketChannel.class).option(ChannelOption.SO_BACKLOG,Â 100)Â  Â  Â  Â  Â  Â  Â  Â  Â  .handler(newÂ LoggingHandler(LogLevel.INFO)).childHandler(newChannelInitializer&lt;SocketChannel&gt;() {Â  Â  Â  Â  Â  Â  Â  Â @OverrideÂ  Â  Â  Â  Â  Â  Â  Â publicÂ voidÂ initChannel(SocketChannelÂ ch) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ChannelPipelineÂ pÂ =Â ch.pipeline();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â p.addLast(newÂ ChannelRequestHandler());Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â // å¯åŠ¨æœåŠ¡Â  Â  Â  Â  Â  Â ChannelFutureÂ fÂ =Â b.bind(port).sync();Â  Â  Â  Â  Â  Â logger.info("Server started successfully.");Â  Â  Â  Â  Â  Â channelÂ =Â f.channel();Â  Â  Â  Â  Â  Â // ç­‰å¾…æœåŠ¡é€šé“å…³é—­Â  Â  Â  Â  Â  Â f.channel().closeFuture().sync();Â  Â  Â  }Â catchÂ (ExceptionÂ e) {Â  Â  Â  Â  Â  Â e.printStackTrace();Â  Â  Â  }Â finallyÂ {Â  Â  Â  Â  Â  Â // é‡Šæ”¾çº¿ç¨‹ç»„èµ„æºÂ  Â  Â  Â  Â  Â bossGroup.shutdownGracefully();Â  Â  Â  Â  Â  Â workerGroup.shutdownGracefully();Â  Â  Â  }Â  }Â  Â @OverrideÂ  Â publicÂ voidÂ stop() {Â  Â  Â  Â this.channel.close();Â  }Â  Â privateÂ classÂ ChannelRequestHandlerÂ extendsÂ ChannelInboundHandlerAdapterÂ {Â  Â  Â  Â @OverrideÂ  Â  Â  Â publicÂ voidÂ channelActive(ChannelHandlerContextÂ ctx) {Â  Â  Â  Â  Â  Â logger.info("Channel activeï¼š{}",Â ctx);Â  Â  Â  }Â  Â  Â  Â @OverrideÂ  Â  Â  Â publicÂ voidÂ channelRead(ChannelHandlerContextÂ ctx,Â ObjectÂ msg)Â throwsExceptionÂ {Â  Â  Â  Â  Â  Â logger.info("The server receives a message: {}",Â msg);Â  Â  Â  Â  Â  Â ByteBufÂ msgBufÂ =Â (ByteBuf)Â msg;Â  Â  Â  Â  Â  Â byte[]Â reqÂ =Â newÂ byte[msgBuf.readableBytes()];Â  Â  Â  Â  Â  Â msgBuf.readBytes(req);Â  Â  Â  Â  Â  Â byte[]Â resÂ =Â handler.handleRequest(req);Â  Â  Â  Â  Â  Â logger.info("Send responseï¼š{}",Â msg);Â  Â  Â  Â  Â  Â ByteBufÂ respBufÂ =Â Unpooled.buffer(res.length);Â  Â  Â  Â  Â  Â respBuf.writeBytes(res);Â  Â  Â  Â  Â  Â ctx.write(respBuf);Â  Â  Â  }Â  Â  Â  Â @OverrideÂ  Â  Â  Â publicÂ voidÂ channelReadComplete(ChannelHandlerContextÂ ctx) {Â  Â  Â  Â  Â  Â ctx.flush();Â  Â  Â  }Â  Â  Â  Â @OverrideÂ  Â  Â  Â publicÂ voidÂ exceptionCaught(ChannelHandlerContextÂ ctx,Â ThrowableÂ cause) {Â  Â  Â  Â  Â  Â // Close the connection when an exception is raised.Â  Â  Â  Â  Â  Â cause.printStackTrace();Â  Â  Â  Â  Â  Â logger.error("Exception occurredï¼š{}",Â cause.getMessage());Â  Â  Â  Â  Â  Â ctx.close();Â  Â  Â  }Â  }}/*** è¯·æ±‚å¤„ç†è€…ï¼Œæä¾›è§£ç»„è¯·æ±‚ã€ç¼–ç»„å“åº”ç­‰æ“ä½œ** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/publicÂ classÂ RequestHandlerÂ {Â  Â privateÂ MessageProtocolÂ protocol;Â  Â privateÂ ServiceRegisterÂ serviceRegister;Â  Â publicÂ RequestHandler(MessageProtocolÂ protocol,Â ServiceRegisterÂ serviceRegister) {Â  Â  Â  Â super();Â  Â  Â  Â this.protocolÂ =Â protocol;Â  Â  Â  Â this.serviceRegisterÂ =Â serviceRegister;Â  }Â  Â publicÂ byte[]Â handleRequest(byte[]Â data)Â throwsÂ ExceptionÂ {Â  Â  Â  Â // 1ã€è§£ç»„æ¶ˆæ¯Â  Â  Â  Â LeisureRequestÂ reqÂ =Â this.protocol.unmarshallingRequest(data);Â  Â  Â  Â // 2ã€æŸ¥æ‰¾æœåŠ¡å¯¹è±¡Â  Â  Â  Â ServiceObjectÂ soÂ =Â this.serviceRegister.getServiceObject(req.getServiceName());Â  Â  Â  Â LeisureResponseÂ rspÂ =Â null;Â  Â  Â  Â ifÂ (soÂ ==Â null) {Â  Â  Â  Â  Â  Â rspÂ =Â newÂ LeisureResponse(LeisureStatus.NOT_FOUND);Â  Â  Â  }Â elseÂ {Â  Â  Â  Â  Â  Â // 3ã€åå°„è°ƒç”¨å¯¹åº”çš„è¿‡ç¨‹æ–¹æ³•Â  Â  Â  Â  Â  Â tryÂ {Â  Â  Â  Â  Â  Â  Â  Â MethodÂ mÂ =Â so.getClazz().getMethod(req.getMethod(),req.getParameterTypes());Â  Â  Â  Â  Â  Â  Â  Â ObjectÂ returnValueÂ =Â m.invoke(so.getObj(),Â req.getParameters());Â  Â  Â  Â  Â  Â  Â  Â rspÂ =Â newÂ LeisureResponse(LeisureStatus.SUCCESS);Â  Â  Â  Â  Â  Â  Â  Â rsp.setReturnValue(returnValue);Â  Â  Â  Â  Â  }Â catchÂ (NoSuchMethodExceptionÂ |Â SecurityExceptionÂ |Â IllegalAccessExceptionÂ |IllegalArgumentExceptionÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â |Â InvocationTargetExceptionÂ e) {Â  Â  Â  Â  Â  Â  Â  Â rspÂ =Â newÂ LeisureResponse(LeisureStatus.ERROR);Â  Â  Â  Â  Â  Â  Â  Â rsp.setException(e);Â  Â  Â  Â  Â  }Â  Â  Â  }Â  Â  Â  Â // 4ã€ç¼–ç»„å“åº”æ¶ˆæ¯Â  Â  Â  Â returnÂ this.protocol.marshallingResponse(rsp);Â  }// getter setter ...}</code></pre><p style=text-align:start>ç½‘ç»œæœåŠ¡å®šä¹‰äº†å¯åŠ¨æœåŠ¡çš„ç»†åˆ™ï¼Œä»¥åŠå¦‚ä½•å¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.4.3.3 RPCå¤„ç†è€…</strong></h1><pre><code>/*** RPCå¤„ç†è€…ï¼Œæ”¯æŒæœåŠ¡å¯åŠ¨æš´éœ²ã€è‡ªåŠ¨æ³¨å…¥Service** @author ä¸œæ–¹é›¨å€¾* @since 1.0.0*/publicÂ classÂ DefaultRpcProcessorÂ implementsApplicationListener&lt;ContextRefreshedEvent&gt;Â {Â  Â @ResourceÂ  Â privateÂ ClientProxyFactoryÂ clientProxyFactory;Â  Â @ResourceÂ  Â privateÂ ServiceRegisterÂ serviceRegister;Â  Â @ResourceÂ  Â privateÂ RpcServerÂ rpcServer;Â  Â @OverrideÂ  Â publicÂ voidÂ onApplicationEvent(ContextRefreshedEventÂ event) {Â  Â  Â  Â ifÂ (Objects.isNull(event.getApplicationContext().getParent())) {Â  Â  Â  Â  Â  Â ApplicationContextÂ contextÂ =Â event.getApplicationContext();Â  Â  Â  Â  Â  Â // å¼€å¯æœåŠ¡Â  Â  Â  Â  Â  Â startServer(context);Â  Â  Â  Â  Â  Â // æ³¨å…¥ServiceÂ  Â  Â  Â  Â  Â injectService(context);Â  Â  Â  }Â  }Â  Â privateÂ voidÂ startServer(ApplicationContextÂ context) {Â  Â  Â  Â Map&lt;String,Â Object&gt;Â beansÂ =Â context.getBeansWithAnnotation(Service.class);Â  Â  Â  Â ifÂ (beans.size()Â !=Â 0) {Â  Â  Â  Â  Â  Â booleanÂ startServerFlagÂ =Â true;Â  Â  Â  Â  Â  Â forÂ (ObjectÂ objÂ :Â beans.values()) {Â  Â  Â  Â  Â  Â  Â  Â tryÂ {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Class&lt;?&gt;Â clazzÂ =Â obj.getClass();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Class&lt;?&gt;[]Â interfacesÂ =Â clazz.getInterfaces();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ServiceObjectÂ so;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ifÂ (interfaces.lengthÂ !=Â 1) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ServiceÂ serviceÂ =Â clazz.getAnnotation(Service.class);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â StringÂ valueÂ =Â service.value();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ifÂ (value.equals("")) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â startServerFlagÂ =Â false;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â throwÂ newÂ UnsupportedOperationException("The exposed interface is not specific with '"Â +Â obj.getClass().getName()Â +Â "'");Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â soÂ =Â newÂ ServiceObject(value,Â Class.forName(value),Â obj);Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â elseÂ {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Class&lt;?&gt;Â superClassÂ =Â interfaces[0];Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â soÂ =Â newÂ ServiceObject(superClass.getName(),Â superClass,Â obj);Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â serviceRegister.register(so);Â  Â  Â  Â  Â  Â  Â  }Â catchÂ (ExceptionÂ e) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â e.printStackTrace();Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â ifÂ (startServerFlag) {Â  Â  Â  Â  Â  Â  Â  Â rpcServer.start();Â  Â  Â  Â  Â  }Â  Â  Â  }Â  }Â  Â privateÂ voidÂ injectService(ApplicationContextÂ context) {Â  Â  Â  Â String[]Â namesÂ =Â context.getBeanDefinitionNames();Â  Â  Â  Â forÂ (StringÂ nameÂ :Â names) {Â  Â  Â  Â  Â  Â Class&lt;?&gt;Â clazzÂ =Â context.getType(name);Â  Â  Â  Â  Â  Â ifÂ (Objects.isNull(clazz))Â continue;Â  Â  Â  Â  Â  Â Field[]Â fieldsÂ =Â clazz.getDeclaredFields();Â  Â  Â  Â  Â  Â forÂ (FieldÂ fieldÂ :Â fields) {Â  Â  Â  Â  Â  Â  Â  Â InjectServiceÂ injectLeisureÂ =Â field.getAnnotation(InjectService.class);Â  Â  Â  Â  Â  Â  Â  Â ifÂ (Objects.isNull(injectLeisure))Â continue;Â  Â  Â  Â  Â  Â  Â  Â Class&lt;?&gt;Â fieldClassÂ =Â field.getType();Â  Â  Â  Â  Â  Â  Â  Â ObjectÂ objectÂ =Â context.getBean(name);Â  Â  Â  Â  Â  Â  Â  Â field.setAccessible(true);Â  Â  Â  Â  Â  Â  Â  Â tryÂ {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â field.set(object,Â clientProxyFactory.getProxy(fieldClass));Â  Â  Â  Â  Â  Â  Â  }Â catchÂ (IllegalAccessExceptionÂ e) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â e.printStackTrace();Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  }Â  Â  Â  }Â  }}</code></pre><p style=text-align:start>DefaultRpcProcessorå®ç°äº†ApplicationListenerï¼Œå¹¶ç›‘å¬äº†ContextRefreshedEventäº‹ä»¶ï¼Œå…¶æ•ˆæœå°±æ˜¯åœ¨Springå¯åŠ¨å®Œæ¯•è¿‡åä¼šæ”¶åˆ°ä¸€ä¸ªäº‹ä»¶é€šçŸ¥ï¼ŒåŸºäºè¿™ä¸ªæœºåˆ¶ï¼Œå°±å¯ä»¥åœ¨è¿™é‡Œå¼€å¯æœåŠ¡ï¼Œä»¥åŠæ³¨å…¥æœåŠ¡ã€‚å› ä¸ºä¸€åˆ‡å·²ç»å‡†å¤‡å°±ç»ªäº†ï¼Œæ‰€éœ€è¦çš„èµ„æºéƒ½æ˜¯OKçš„ã€‚</p><p style=text-align:start><br></p><h1 class=pgc-h-arrow-right><strong>å››ã€ä½¿ç”¨RPCæ¡†æ¶</strong></h1><p style=text-align:start>æ¡†æ¶ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§å°±æ˜¯è¦ä½¿ç”¨ç®€å•ï¼Œä½¿ç”¨è¯¥æ¡†æ¶åªéœ€è¦ä¸€ä¸ªæ¡ä»¶å’Œå››ä¸ªæ­¥éª¤å³å¯ã€‚</p><h1 class=pgc-h-arrow-right><strong>4.1 ä¸€ä¸ªæ¡ä»¶</strong></h1><p style=text-align:start>éœ€è¦å‡†å¤‡ä¸€ä¸ªZookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œå•èŠ‚ç‚¹å³å¯ã€‚</p><h1 class=pgc-h-arrow-right><strong>4.2 æ­¥éª¤ä¸€</strong></h1><p style=text-align:start>å¼•å…¥Mavenä¾èµ–ï¼š</p><pre><code>&lt;dependency&gt;Â  Â &lt;groupId&gt;wang.leisure&lt;/groupId&gt;Â  Â &lt;artifactId&gt;leisure-rpc-spring-boot-starter&lt;/artifactId&gt;Â  Â &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt;</code></pre><blockquote><p>ä¸çŸ¥é“å¦‚ä½•è·å¾—ä¾èµ–çš„è¯»è€…ï¼Œè¯·åœ¨æºç ä¸‹è½½åï¼Œè¿›å…¥é¡¹ç›®ç›®å½•ä¸‹ï¼ˆpom.xmlæ–‡ä»¶æ‰€åœ¨ä½ç½®ï¼‰ï¼Œæ‰§è¡Œ mvn installå‘½ä»¤ï¼Œå³å¯åœ¨æœ¬åœ°ä»“åº“ç”Ÿæˆmavenä¾èµ–ã€‚</p></blockquote><h1 class=pgc-h-arrow-right><strong>4.3 æ­¥éª¤äºŒ</strong></h1><p style=text-align:start>åœ¨ä½ çš„é¡¹ç›®é…ç½®æ–‡ä»¶ï¼ˆapplication.propertiesï¼‰ä¸­é…ç½®æ³¨å†Œä¸­å¿ƒåœ°å€ï¼Œä¾‹å¦‚ï¼š</p><pre><code>leisure.rpc.register-address=192.168.199.241:2181</code></pre><h1 class=pgc-h-arrow-right><strong>4.4 æ­¥éª¤ä¸‰</strong></h1><p style=text-align:start>å°†ä½ çš„è¿œç¨‹æœåŠ¡ä½¿ç”¨@Serviceæ³¨è§£ï¼Œä¾‹å¦‚ï¼š</p><pre><code>importÂ wang.leisure.rpc.annotation.Service;@ServicepublicÂ classÂ UserServiceImplÂ implementsÂ UserServiceÂ {Â  Â @OverrideÂ  Â publicÂ ApiResult&lt;User&gt;Â getUser(LongÂ id) {Â  Â  Â  Â UserÂ userÂ =Â getFromDbOrCache(id);Â  Â  Â  Â returnÂ ApiResult.success(user);Â  }Â  Â privateÂ UserÂ getFromDbOrCache(LongÂ id) {Â  Â  Â  Â returnÂ newÂ User(id,Â "ä¸œæ–¹é›¨å€¾",Â 1,Â "https://leisure.wang");Â  }}</code></pre><h1 class=pgc-h-arrow-right><strong>4.5 æ­¥éª¤å››</strong></h1><p style=text-align:start>ä½¿ç”¨æ³¨è§£@InjectServiceæ³¨å…¥è¿œç¨‹æœåŠ¡ï¼Œä¾‹å¦‚ï¼š</p><pre><code>@RestController@RequestMapping("/index/")publicÂ classÂ IndexControllerÂ {Â  Â @InjectServiceÂ  Â privateÂ UserServiceÂ userService;Â  Â /**Â  Â Â * è·å–ç”¨æˆ·ä¿¡æ¯Â  Â Â * http://localhost:8080/index/getUser?id=1Â  Â Â *Â  Â Â * @param id ç”¨æˆ·idÂ  Â Â * @return ç”¨æˆ·ä¿¡æ¯Â  Â Â */Â  Â @GetMapping("getUser")Â  Â publicÂ ApiResult&lt;User&gt;Â getUser(LongÂ id) {Â  Â  Â  Â returnÂ userService.getUser(id);Â  }}</code></pre><h1 class=pgc-h-arrow-right><strong>äº”ã€æºç ä¸‹è½½</strong></h1><p style=text-align:start>æ¡†æ¶æºç ï¼š<u>https://github.com/OakWang/leisure-rpc-spring-boot-starter.git</u></p><p style=text-align:start>ç¤ºä¾‹æºç ï¼š<u>https://github.com/OakWang/leisure-rpc-example.git</u></p><h1 class=pgc-h-arrow-right><strong>å…­ã€æ€»ç»“</strong></h1><p>å¸Œæœ›è¯»è€…èƒ½å¤ŸçœŸæ­£åŠ¨æ‰‹å»è¯•ä¸€è¯•ï¼Œåªæœ‰å®è·µäº†æ‰èƒ½çŸ¥é“é‡Œé¢çš„è¿ä½œé€»è¾‘ã€‚ç¬”è€…ä¹Ÿæ˜¯èŠ±äº†ä¸¤ä¸ªæ˜ŸæœŸæ‰æŠŠä»£ç è·Ÿæ–‡ç« æ•´ç†å¥½ï¼Œå¹¶ä¸æ˜¯å› ä¸ºè¿™ä¸ªä¸œè¥¿éš¾ï¼Œè€Œæ˜¯å› ä¸ºæ²¡æ—¶é—´ï¼Œè‹¦é€¼çš„ç¨‹åºçŒ¿</p><p>å¦‚æœæ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå¸Œæœ›å¤šå¤šæ”¯æŒã€‚</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'åŒ…æ•™','åŒ…ä¼š','è¿™ç¯‡'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>