<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>工作表数据与UserForm窗口交互工程的设计总结 | 极客快訊</title><meta property="og:title" content="工作表数据与UserForm窗口交互工程的设计总结 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/0fe3120aa6e94a9fb70b622a895877c2"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0ec56d7.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0ec56d7.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0ec56d7.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0ec56d7.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0ec56d7.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0ec56d7.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0ec56d7.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0ec56d7.html><meta property="article:published_time" content="2020-10-29T20:59:21+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:21+08:00"><meta name=Keywords content><meta name=description content="工作表数据与UserForm窗口交互工程的设计总结"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/0ec56d7.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>工作表数据与UserForm窗口交互工程的设计总结</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>大家好，我们今天继续讲解VBA数据库解决方案，今日讲解的是第84讲:工作表数据与UserForm窗口的交互工程设计总结。这一讲是讲解的窗体设计的最后一讲，做个总结，把需要注意的问题和大家再讲一下，同时这讲内容也是VBA数据库解决方案的最后一讲内容。</p><p>一 在实现窗口的交互工程的设计的时候要考虑到具体应用。</p><p>我在第77讲到83讲的讲解中，利用了Application.Caller 来传递我的需求，如下截图</p><div class=pgc-img><img alt=工作表数据与UserForm窗口交互工程的设计总结 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0fe3120aa6e94a9fb70b622a895877c2><p class=pgc-img-caption></p></div><p>在我的窗体中共用7大需求，分别对应着不同的Application.Caller值，这样我可以在加载UserForm窗口时可以精准实现我的控制。如下面的删除代码传递的Application.Caller是8</p><p>If Right(Application.Caller, 1) = 8 Then '删除</p><p>' UserForm1.CommandButton3.Enabled = False '开始</p><p>UserForm1.CommandButton1.Enabled = False '下一条记录</p><p>UserForm1.CommandButton4.Enabled = False '最后一条记录</p><p>UserForm1.CommandButton5.Enabled = False '编辑记录</p><p>UserForm1.CommandButton7.Enabled = False '查找记录</p><p>UserForm1.CommandButton8.Enabled = False '删除记录</p><p>UserForm1.CommandButton6.Enabled = False '保存记录</p><p>UserForm1.CommandButton9.Enabled = False '录入记录</p><p>UserForm1.TextBox1.Enabled = False</p><p>UserForm1.TextBox2.Enabled = False</p><p>UserForm1.TextBox3.Enabled = False</p><p>End If</p><p>上述代码就是实现了在加载窗体时，只有"开始"按钮可以响应代码，耳其他的十项内容是不可以响应代码的。</p><p>二 在实现窗口的交互工程的设计的时候窗体的设计和代码的设计要同时进行</p><p>为了能让代码控制窗体时达到最友好的界面，让用户有友好的体验，我们要对代码和窗体同步的设计，不要先涉及完窗体，再写代码，这样往往会造成在写代码时发现窗体设计的不合理后修改麻烦。更不能在写完代码后再布局窗体。而是应该按照一步一个脚印的办法同步完成窗体的布局和代码的书写。</p><p>1.写一段代码时，可能用到多个控件，那么我就先把这些控件先布置好；</p><p>2.在布置一个控件时往往会用到其他的控件，那么我们就一并布置好。</p><p>3.布置控件和写代码可以同步进行，边写代码边布置控件</p><p>如我在写上述工程的保存按钮代码时会遇到录入保存和修改保存两种情况，那么我要合并来考虑，不要分开写；</p><p>Private Sub CommandButton6_Click() '保存</p><p>If UserForm1.TextBox1.Value = "" Or UserForm1.TextBox2.Value = "" Or UserForm1.TextBox3.Value = "" Then MsgBox "信息有空值，请确认！": Exit Sub</p><p>If MsgBox("是否要保存记录？", vbOKCancel, "提示") = vbCancel Then Exit Sub</p><p>Dim cnADO, rsADO As Object</p><p>Dim strPath, strSQL As String</p><p>Dim myData() As Variant</p><p>Set cnADO = CreateObject("ADODB.Connection")</p><p>Set rsADO = CreateObject("ADODB.Recordset")</p><p>strPath = ThisWorkbook.FullName</p><p>cnADO.Open "provider=Microsoft.ACE.OLEDB.12.0;extended properties='excel 12.0;hdr=yes;imex=0';" _</p><p>& "data source=" & strPath</p><p>strSQL = "SELECT * FROM [数据7$]"</p><p>rsADO.Open strSQL, cnADO, 1, 3</p><p>If UserForm1.TextBox1.Enabled = False Then '编辑的保存</p><p>If rsADO.RecordCount > 0 Then rsADO.MoveFirst</p><p>Do While Not rsADO.EOF</p><p>If Trim(rsADO.Fields(0)) = UserForm1.TextBox1.Value Then</p><p>rsADO.Fields(1) = UserForm1.TextBox2.Value</p><p>rsADO.Fields(2) = UserForm1.TextBox3.Value</p><p>rsADO.Update</p><p>GoTo 100</p><p>End If</p><p>rsADO.MoveNext</p><p>Loop</p><p>100:</p><p>UserForm1.TextBox1.Enabled = False</p><p>UserForm1.TextBox2.Enabled = False</p><p>UserForm1.TextBox3.Enabled = False</p><p>UserForm1.CommandButton6.Enabled = False</p><p>MsgBox ("保存OK！")</p><p>Else '录入的保存</p><p>If rsADO.RecordCount > 0 Then</p><p>Do While Not rsADO.EOF</p><p>If Trim(rsADO.Fields(0)) = UserForm1.TextBox1.Value Then MsgBox "员工编号重复，请确认！": GoTo 110</p><p>rsADO.MoveNext</p><p>Loop</p><p>End If</p><p>rsADO.AddNew</p><p>rsADO.Fields(0) = UserForm1.TextBox1.Value</p><p>rsADO.Fields(1) = UserForm1.TextBox2.Value</p><p>rsADO.Fields(2) = UserForm1.TextBox3.Value</p><p>rsADO.Update</p><p>110:</p><p>UserForm1.TextBox1.Value = ""</p><p>UserForm1.TextBox2.Value = ""</p><p>UserForm1.TextBox3.Value = ""</p><p>UserForm1.TextBox1.SetFocus</p><p>MsgBox ("保存OK！")</p><p>End If</p><p>rsADO.Close</p><p>cnADO.Close</p><p>Set rsADO = Nothing</p><p>Set cnADO = Nothing</p><p>End Sub</p><p>上述代码中在打开数据库的连接设置时是一样的，我就用同样的连接来进行。</p><div class=pgc-img><img alt=工作表数据与UserForm窗口交互工程的设计总结 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/85c871e9d6a44f81a7772407ab7a50fb><p class=pgc-img-caption></p></div><p>三 代码要采用自己熟悉的方式写法进行。</p><p>实现一个目的有很多方法，写代码也是一样，实现一个功能，有很多代码的写法，有的人喜欢用这种，有的人喜欢有那种，无可厚非。大家要注意VBA的定位，我也多次讲过，对于我们日常工作的OFICE内容，运行时间是可以不用作为第一要素来考虑的。往往，我们更注重的是和手工操作的比较。</p><p>所谓采用自己熟悉的方式，就是在我的书籍中经常提到的搭积木的方法，罗列你的代码到合适的位置，然后再修正它。</p><p>四 完成自己的工程后要做细致的调试。这种调试包括：</p><p>1 通用数据的测试。</p><p>2 首尾数据的测试。</p><p>3 异常数据的测试。</p><p>所谓通用数据就是一般正常的数据实现，首尾数据的测试为了避免由于变量设置失误而造成数据的丢失。异常数据是指通常的"坑"，自己给自己挖个坑，然后自己跳下去，也未尝不可，这样可以更能检测自己的程序运行情况。</p><p>好了，再看看我们最后的窗体运行：</p><div class=pgc-img><img alt=工作表数据与UserForm窗口交互工程的设计总结 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8df454a18af746728dd8386b82170220><p class=pgc-img-caption></p></div><p>最后祝大家在VBA的道路上稳步的前进。</p><p>（本书完）</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'表数','UserForm','设计'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>