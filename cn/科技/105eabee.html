<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>「技术」App可靠性设计 | 极客快訊</title><meta property="og:title" content="「技术」App可靠性设计 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/152475476360184f2ae84e9"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/105eabee.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/105eabee.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/105eabee.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/105eabee.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/105eabee.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/105eabee.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/105eabee.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/105eabee.html><meta property="article:published_time" content="2020-11-14T21:07:11+08:00"><meta property="article:modified_time" content="2020-11-14T21:07:11+08:00"><meta name=Keywords content><meta name=description content="「技术」App可靠性设计"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/105eabee.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>「技术」App可靠性设计</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p><img alt=「技术」App可靠性设计 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/152475476360184f2ae84e9></p><p>可靠性是软件一个重要的质量属性，它关注的是软件功能持续的可用性，以及出现故障之后是否能够容错，是否能快速的恢复使用。</p><p><strong>可靠性六条基本准则</strong></p><p>1、故障应在第一时间被检测和感知；</p><p>2、能避免的故障都不应该发生；</p><p>3、不可避免或无法预测的故障，需进行容错；</p><p>4、已发生故障，需在最短时间内得到恢复；</p><p>5、对象状态和生命期都应该是完备的，闭合的；</p><p>6、资源必须合理和均衡地使用；</p><p>应用作为直接提供用户服务，与用户交互最多的环节，其可靠性对用户体验的影响巨大，甚至会高于系统对用户造成的影响。</p><p><strong>可靠性故障的现象及根因</strong></p><p><strong>应用不响应（ANR）</strong></p><p>(1)应用将耗时操作或者同步调用放在UI线程，广播接收器里处理；</p><p>(2)应用资源异常，如内存，文件，线程等的滥用、泄露；</p><p>(3)消息、通知过载，忙不过来；</p><p>(4)获取系统资源阻塞，比如访问文件系统，数据库，网络，CPU等；</p><p><strong>应用启动不起来，界面卡住冻屏，黑屏，白屏</strong></p><p>(1)应用启动阶段必现闪退；</p><p>(2)应用在启动阶段做了特殊的耗时、阻塞动作；</p><p>(3)应用事件处理bug，例如：应用接收事件但不做任何响应；</p><p>(4)应用资源异常，获取系统资源阻塞；</p><p>(5)应用窗口状态异常，或者使用定制的显示绘制接口导致；</p><p><strong>应用闪退或者频繁闪退</strong></p><p>(1)低级编码错误，多线程并发错误，app质量不合格；</p><p>(2)异常处理不闭合，不完备；</p><p>(3)版本兼容性问题，硬件兼容性问题；</p><p><strong>Android应用故障案例分享</strong></p><p><strong>一、应用资源异常</strong></p><p>1、某输入法软件为了保证应用能常驻内存不被系统清理，在应用进程退出时，高频率注册1秒的定时器，定时器到时候，立即拉起该应用及关联应用。如果系统反复清理该应用，该应用会反复自启动，导致系统卡顿很严重。</p><p>2、某应用反复注册了800+个应用权限管理的AppOps Listener，在执行callback的时候直接导致system_server进程的global reference table overflow，系统重启。</p><p>3、某著名社交软件收到消息通知之前，需要获取通话状态。如果该应用短时间内收到通知消息特别多，直接会将system_server的binder线程全部占满，导致其他应用和服务无法与system_server通信，直接导致系统重启。</p><p><strong>二、应用的特殊行为</strong></p><p>1、某社交软件在自身升级后的首次启动过程中，长时间进入dex2oat优化过程，应用界面显示黑屏。按back键无效，只能手杀，大量用户反馈手机黑屏死机。</p><p>2、某著名社交软件收到消息通知之前，需要获取通话状态。如果该应用短时间内收到通知消息特别多，直接会将system_server的binder线程全部占满，导致其他应用和服务无法与system_server通信，直接导致系统重启。</p><p>3、某应用注册加速度传感器以及近距离传感器监听的逻辑：若两个传感器的注册有任何一个失败或者被拒，则会进行无限重试，直到两者全成功，该逻辑会导致距离传感器被反复执行注册，致使system_server的fd数量急速增加，超过1024，导致system_server进程崩溃，系统重启。</p><p><strong>三、兼容性问题</strong></p><p>1、Google 版本升级导致。应用升级N版本之后，应用频繁闪退，功能缺失，应用无法使用，清除数据和缓存也无效，系统负载高，用户退机。</p><p>2、某应用推送最新版本异常。应用升级之后，用户无法使用。</p><p>3、ROM升级之后，导致应用无法使用。ROM升级之后，该应用读取电话薄失败，应用频繁Crash，导致手机电话过程中无法挂断。</p><p><strong>可靠性设计的一般准则</strong></p><p><strong>一、业务功能的可靠性设计</strong></p><p>1、合理分配执行任务：哪些放在前台？哪些放在后台？</p><p>2、仔细设计任务同步&并发：采用同步还是异步？多任务并发？</p><p>3、任务负载的均衡：多个业务执行流有序执行；</p><p>4、对象生命周期的闭合；</p><p>5、良好的用户交互和提示：别让用户以为应用crash</p><p><strong>二、应用数据源可靠性设计</strong></p><p>1、应用核心的数据/文件应有备份和容错设计</p><p>2、来自外部输入设备的数据，应用应能判别数据的合法性，例如被破坏的数据源，非法的外部数据/命令</p><p>3、向外发起的服务请求，要有超时和有限重试设计，外部扰动不导致应用卡死</p><p>4、外部发起的攻击性请求，例如通知，广播，要有防护设计</p><p><strong>三、应用的资源可靠性设计</strong></p><p>1、分配的资源必须在确定的地方释放；</p><p>2、使用资源必须有明确的上界，如内存，磁盘，文件，线程。</p><p><strong>四、优秀的编码能力</strong></p><p>优秀的编码能力是应用可靠性设计的基础；</p><p><strong>五、完备的测试故障用例</strong></p><p>事先考虑到应用内部、外部可能发生的故障，将故障的集合定义出来，针对性的设计故障用例。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'技术','App','设计'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>