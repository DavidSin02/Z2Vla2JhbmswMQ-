<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>单片机小制作，LED小灯瓶 | 极客快訊</title><meta property="og:title" content="单片机小制作，LED小灯瓶 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/0c04d96da3564fee8b1025a7d933e2ac"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/11338e8.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/11338e8.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/11338e8.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/11338e8.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/11338e8.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/11338e8.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/11338e8.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/11338e8.html><meta property="article:published_time" content="2020-10-29T21:07:11+08:00"><meta property="article:modified_time" content="2020-10-29T21:07:11+08:00"><meta name=Keywords content><meta name=description content="单片机小制作，LED小灯瓶"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/11338e8.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>单片机小制作，LED小灯瓶</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>有一天在网上看到一个制作——LED电子萤火虫，我感觉电路很有特点，于是就想仿制一个。那个LED电子萤火虫用的是ATtiny13单片机来控制，我也正好有。而且硬件制作比较简单，成本也不高，10元钱都不到，就能DIY一个。虽然简单，但是制作却需要耐心和细心，毕竟需要连接12个LED，焊接的工作量不少，我自己用了一个下午才完成，而程序更是陆陆续续地写了几个小时。</p><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0c04d96da3564fee8b1025a7d933e2ac><p class=pgc-img-caption></p></div><p>估计你会很好奇地问，一共才6个可用I/O引脚的 ATtiny13，怎么能驱动12个LED呢?其实，我要告诉你，它不仅可以点亮每个LED，而且还能控制每个LED的亮度呢!这才是本次制作的精华。在制作的过程中，发生了一点小小的意外。由于我购买的JST充电线和原来的充电器引脚相反，致使我原本打算使用的小型锂电池损坏，不能充电。在万般无奈的情况下，我只好更换体积更大的锂电池了。</p><h1>主要材料</h1><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9a86167ddf1e471f8e3f0adcf17ee86c><p class=pgc-img-caption>图6.1 制作所需的主要材料</p></div><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/533bc106bfdb442b8e931978abb11ae5><p class=pgc-img-caption></p></div><p>这次的主要元器件就是ATtiny13单片机和12个LED。当然还有双绞线、洞洞板、电池、空瓶子、电阻等其他辅助材料，如图6.1所示。</p><p>本制作使用的是8个引脚的ATtiny13单片机，这款单片机现在的价格很便宜，4元左右就能买到。ATtiny13 是AVR 单片机，它有1KB 的 Flash、64B 的EEPROM、64B 的SRAM、6 个通用I/O口线、32个通用工作寄存器、1个具有比较模式的8位定时器/计数器、片内/外中断、4路10位ADC、具有片内振荡器的可编程看门狗定时器，以及3种可以通过软件进行选择的省电模式。12个LED为普通的3mm发黄色光的LED。</p><h1>制作过程</h1><p>1 焊接单片机插座。</p><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3df3ea1c008546af9185c1c745f89fa2><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6dccaced815e4dd1888d1812b1382108><p class=pgc-img-caption></p></div><p>2 焊接两个电阻。</p><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6f95ae2a91c94624adb5c1429c8ec233><p class=pgc-img-caption></p></div><p>3 双绞线套入热缩管后，焊接LED。焊接好后，用打火机加热热缩管，使其收缩固定。最后，别忘了再扭下热缩管。</p><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/be98e71060744425980f540d74d50db0><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1bab9f563d4d439c8db1b63e15f5216d><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/34b213b29b0b4d6b837e4b8aa853e303><p class=pgc-img-caption></p></div><p>4 焊接好的12个LED。</p><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/162c7a24a78a4505b7430a2bc995e943><p class=pgc-img-caption></p></div><p>5 双绞线焊接到洞洞板上。</p><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b86da3e98e10470fad4f2fc9e1c539ea><p class=pgc-img-caption></p></div><p>6 洞洞板和双绞线焊接好的效果。</p><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b251d2ffd2c14f19985c3c560094e0e7><p class=pgc-img-caption></p></div><p>7 焊接JST插头、锂电池和开关。</p><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/af8df90a8377413096a850745cabb0e4><p class=pgc-img-caption></p></div><p>8 在瓶子上开口。</p><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d80a3af4270c454e9eaebb227f129ee0><p class=pgc-img-caption></p></div><p>9 用热熔胶固定。</p><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8d914d9948004449986ac3039776bc4c><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/89f8252005814355826fa3a56c9659e1><p class=pgc-img-caption></p></div><p>10 装入瓶子中。</p><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/09f0ac40f5044b29863742a70b6df062><p class=pgc-img-caption></p></div><h1>控制原理</h1><p>为什么6个I/O能控制12个LED呢?它们之间会不会相互影响呢?其实，这样的连接方式不仅能控制每个LED，还能控制其亮度呢!之所以能这样连接，是因为AVR单片机的每个I/O都是3态输出。如果用普通51单片机，这样连接是不行的。</p><p>那么又是如何控制LED的亮度呢?控制亮度的关键是ATtiny13的两路PWM，它们可以分别设置连接到PB0和PB1引脚上。在ATtiny13使用内部振荡器的情况下，PWM的最高频率可设置为47.5kHz。而且PWM的极性可以通过设置寄存器而改变，这使得12个LED亮度的控制更加简单了。</p><p>先谈谈如何控制每个LED单独的亮和灭。ATtiny13的每个I/O都有4种状态，即输出0状态、输出1状态、高阻态(悬空态)、带上拉电阻的高阻态。要使LED亮，必须要让LED中流过正向的电流，如果要让最左边的LED亮，PB1输出1、PB2输出0即可。但是，其他不相关的引脚需要设置成高阻态。否则，如果PB0此时也为1的话，第2个LED也会亮。总之，为了保证其他LED不受到影响，在设置某个灯亮时，必须先把所有I/O设置成不带上拉的高阻态。</p><p>能控制亮和灭有什么了不起?呵呵，其实还能控制每个LED单独的渐变，就是渐渐变亮，渐渐变暗。我举个例子吧，如果要最左边的LED渐渐变亮，就先设置PB2引脚为0电平，PB1引脚设置为高电平驱动的PWM波。然后，程序逐渐控制PB1的PWM状态，通过调整PWM高电平的脉宽长度来实现亮度控制。当PWM高电平的时间长时，LED就变亮了。反之，LED就变暗了。</p><p>那么电路原理图(见图6.2)中第7个反过来接的LED怎么实现亮度控制呢?原理还是一样，只是PB2将刚才的0电平设置成1电平，原来PB1为高电平脉冲驱动的PWM波设置成低电平脉冲驱动的PWM波即可。同样，要控制第7个LED的亮度，就控制PWM低电平的脉宽长度，当低电平的脉宽长度长时，LED就变亮了。反之，LED就变暗了。</p><div class=pgc-img><img alt=单片机小制作，LED小灯瓶 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c0b945810f9a42febe52bc88f9dbd944><p class=pgc-img-caption>图6.2 控制电路原理图</p></div><p>那么能实现所有的LED同时发光吗?制作过程中，这个功能的实现倒是困扰了我一会儿。后来，我想到了动态扫描。什么是动态扫描?老式电视机不就是这个原理吗?电视机通过磁场让射线高速地扫描屏幕，从而产生一幅画面。那么，让每个灯分别亮1ms左右，然后像电视机一样不断地扫描，看上去就都亮了。在此基础上，再控制每个灯的亮度数值，就能实现整体亮度控制了。如果LED足够多，单片机引脚也足够多，还可能显示一副灰度画面呢!</p><h1>3种效果的程序编写</h1><p>程序的PWM频率设置为最高的37.5kHz。之所以选择这么高的频率是为了不影响动态扫描。试想，如果PWM频率为100Hz，那么还怎么动态扫描呢?在程序中，动态扫描实际的频率为62Hz。这已经足够骗过人的眼睛，让我们看不到灯的闪烁。</p><p>在单片机的中断代码中，程序每过26µs就会产生溢出中断一次，通过变量count计数中断次数。当中断的次数达到50次时，就更换下一个LED，显示它对应的亮度。LED的亮度存储到led[ ]这个数组中，每个LED通过载入对应的亮度值，即通过改变PWM产生寄存器的OCR0A与OCR0B，来实际控制高低电平脉宽长度，最终实现亮度的控制。当然，每次通过PWM控制亮度，都要先根据LED的驱动电平方式，重新设置PWM的控制模式。在此之前，还要记得设置不相关的引脚为高阻态。</p><p>LED的3种效果控制程序能够实现LED不断地变换，只要调用就能分别实现如下功能：所有LED的呼吸效果、逐个点亮和熄灭LED、LED流水显示的效果。从编程的思路上讲，led[ ]数组存放了12个元素，每个元素所存内容，即对应每个LED灯亮度值。要改变某个LED灯亮度，都是通过设置led[ ]数组中对应元素的 PWM 缓冲数值来实现自动变换。要让所有的灯全亮只需设置数组中的每个元素的数值都为255即可。如果要一半的亮度就设置为128。要让某个灯单独最亮，只要设置这个LED元素数值为255，其他的元素为0。如果任意LED要产生渐渐变亮的效果，那么只要对应数组元素中的数值从0逐渐变为255即可。同理，渐渐变暗，数值就从255变成0。要实现什么样的效果，大家可以通过改变led[ ]数组来实现。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'单片机','LED','小灯'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>