<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>50个ggplot2可视化案例 | 极客快訊</title><meta property="og:title" content="50个ggplot2可视化案例 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/RTBO8cK9mJlDy3"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/131bb7f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/131bb7f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/131bb7f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/131bb7f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/131bb7f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/131bb7f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/131bb7f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/131bb7f.html><meta property="article:published_time" content="2020-10-29T20:59:29+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:29+08:00"><meta name=Keywords content><meta name=description content="50个ggplot2可视化案例"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/131bb7f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>50个ggplot2可视化案例</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><blockquote><p>什么类型的可视化用于什么类型的问题？本文可帮助您为特定分析目标选择正确的图表类型，以及如何使用ggplot2在R中实现它。</p></blockquote><p>本文转载自“R友舍”，已获授权，点我跳转原文链接</p><p>本文翻译自：http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html</p><p><strong>一个有效的图标:</strong></p><ul><li><p>在不歪曲事实的情况下传达正确的信息</p></li><li><p>简单而优雅的表达信息内容</p></li><li><p>通过美学表达信息，而不是掩盖信息</p></li><li><p>没有信息负载</p></li></ul><p>下面介绍了八类常见的图表可视化情景。在绘图之前，请仔细考虑你准备如何通过可视化的方式表达统计事实或事件关系。也许就是这八类情景中的一个。</p><p></p><h2>类型一：相关性 Correlation</h2><p>以及几个图用于检查两个变量见的相关性</p><p></p><h3>散点图 Scatterplot</h3><p>散点图是数据分析过程中使用最多的图标之一。当你想了解两个变量间的相关性时，首先想到的就是散点图。我们可以用ggplot2里的geom_point绘制散点图。另外，还可以用geom_smooth来绘制平滑曲线，通过设置methon='lm'来绘制最佳拟合曲线。</p><pre><code>options(scipen=999) <br>library(ggplot2)<br>theme_set(theme_bw)<br>data("midwest", package = "ggplot2")<br># midwest &lt;- read.csv("http://goo.gl/G1K41K")<br><br># Scatterplot<br>gg &lt;- ggplot(midwest, aes(x=area, y=poptotal)) +<br>geom_point(aes(col=state, size=popdensity)) +<br>geom_smooth(method="loess", se=F) +<br>xlim(c(0, 0.1)) +<br>ylim(c(0, 500000)) +<br>labs(subtitle="Area Vs Population",<br>y="Population",<br>x="Area",<br>title="Scatterplot",<br>caption = "Source: midwest")<br><br>plot(gg)</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/RTBO8cK9mJlDy3><p></p><h3>带有环绕的散点图 Scatterplot With Encircling</h3><p>在展示结果时，有时可以将某个特殊的区域包围起来，从而达到突出展示的效果。</p><p>我们可以通过ggalt包里的geom_encircle实现。</p><p>在geom_encircle中，我们可以指定需要突出的数据集，此外还可以扩展曲线，以便在点之外传递；以及修改曲线的颜色及大小。</p><pre><code># install 'ggalt' pkg<br># devtools::install_github("hrbrmstr/ggalt")<br>options(scipen = 999)<br>library(ggplot2)<br>library(ggalt)<br>midwest_select &lt;- midwest[midwest$poptotal &gt; 350000 &amp;<br>midwest$poptotal &lt;= 500000 &amp;<br>midwest$area &gt; 0.01 &amp;<br>midwest$area &lt; 0.1, ]<br><br># Plot<br>ggplot(midwest, aes(x=area, y=poptotal)) +<br>geom_point(aes(col=state, size=popdensity)) + # draw points<br>geom_smooth(method="loess", se=F) +<br>xlim(c(0, 0.1)) +<br>ylim(c(0, 500000)) + # draw smoothing line<br>geom_encircle(aes(x=area, y=poptotal),<br>data=midwest_select,<br>color="red",<br>size=2,<br>expand=0.08) + # encircle<br>labs(subtitle="Area Vs Population",<br>y="Population",<br>x="Area",<br>title="Scatterplot + Encircle",<br>caption="Source: midwest")<br></code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO8cV3reNN4t><p></p><h3>抖动图 Jitter Plot</h3><p>我们看看先用一组新的数据绘制散点图。这次，我将使用mpg数据集来绘制城市里程（cty）与公路里程。</p><pre><code># load package and data<br>library(ggplot2)<br></code><p><code>data(mpg, package="ggplot2") </code></p><p><code># alternate source: "http://goo.gl/uEeRGu")</code></p><code>theme_set(theme_bw) # pre-set the bw theme.<br><br>g &lt;- ggplot(mpg, aes(cty, hwy))<br><br># Scatterplot<br>g + geom_point +<br>geom_smooth(method="lm", se=F) +<br>labs(subtitle="mpg: city vs highway mileage",<br>y="hwy",<br>x="cty",<br>title="Scatterplot with overlapping points",<br>caption="Source: midwest")<br></code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO8cf97vTMGQ><p>虽然我们能够从图中看出，两个变量存在相关性。但是不难发现，很多散点被隐藏了，因为数据存在重叠的问题。由于cty和hvy两个变量都是整数，所以数据重叠的现象更加严重。对于这类数据集的散点图，展示过程中应该格外小心。那么应该如何解决一个问题呢？我们可以使用jitter_geom对数据增加抖动，通过设置width，使得重叠的点在原始位置随机抖动。</p><pre><code> # load package and data<br>library(ggplot2)<br>data(mpg, package="ggplot2")<br># mpg &lt;- read.csv("http://goo.gl/uEeRGu")<br><br># Scatterplot<br>theme_set(theme_bw) # pre-set the bw theme.<br>g &lt;- ggplot(mpg, aes(cty, hwy))<br>g + geom_jitter(width = .5, size=1) +<br>labs(subtitle="mpg: city vs highway mileage",<br>y="hwy",<br>x="cty",<br>title="Jittered Points")<br></code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/RTBO8cp87yIJOE><p></p><h3>计数图 Counts Chart</h3><p>第二种解决散点重叠的方法是使用计数图。当数据存在散点重叠时，我们可以用散点大小来表达数据重叠的程度。</p><pre><code># load package and data<br>library(ggplot2)<br>data(mpg, package="ggplot2")<br># mpg &lt;- read.csv("http://goo.gl/uEeRGu")<br><br># Scatterplot<br>theme_set(theme_bw) # pre-set the bw theme.<br>g &lt;- ggplot(mpg, aes(cty, hwy))<br>g + geom_count(col="tomato3", show.legend=F) +<br>labs(subtitle="mpg: city vs highway mileage",<br>y="hwy",<br>x="cty",<br>title="Counts Plot")</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO8cy7ETcBuA><p></p><h3>气泡图 Bubble plot</h3><p>虽然散点图能够表示两个连续变量间的相关关系。但如果想在以下两个方面了解数据间的潜在关系时，气泡图会更有用：</p><p>1.基于分类变量，修改散点颜色2.基于另一个连续变量，表示散点的大小</p><p>简单来说，如果你有一个四维变量的数据，两个连续变量，一个分类变量用以表示颜色，一个连续变量表示点的大小，那么气泡图就非常适合了。</p><p>比如下面这个例子，气泡图清楚地区分了制造商之间的差异以及最佳拟合曲线的斜率变化，从而能够更好的比较不同组群间的差异。</p><pre><code># load package and data<br>library(ggplot2)<br>data(mpg, package="ggplot2")<br># mpg &lt;- read.csv("http://goo.gl/uEeRGu")<br><br>mpg_select &lt;- mpg[mpg$manufacturer %in% c("audi", "ford", "honda", "hyundai"), ]<br><br># Scatterplot<br>theme_set(theme_bw) # pre-set the bw theme.<br>g &lt;- ggplot(mpg_select, aes(displ, cty)) +<br>labs(subtitle="mpg: Displacement vs City Mileage",<br>title="Bubble chart")<br><br>g + geom_jitter(aes(col=manufacturer, size=hwy)) +<br>geom_smooth(aes(col=manufacturer), method="lm", se=F)</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO8kG9KXx6of><p></p><h3>动态气泡图 Animated Bubble chart</h3><p>对于动态气泡图的实现，可以使用gganimate包。动态气泡图和普通气泡图的区别就在于使用第五维数据(一般是时间)来展示数据间的变化。动态气泡图的处理方法和其它图形基本一致，不同的是需要在aes层指定动画展示的变量。构建绘图后，可以使用gganimate通过设置动画的时间间隔。</p><pre><code># Source: https://github.com/dgrtwo/gganimate<br># install.packages("cowplot") # a gganimate dependency<br># devtools::install_github("dgrtwo/gganimate")<br>library(ggplot2)<br>library(gganimate)<br>library(gapminder)<br>theme_set(theme_bw) # pre-set the bw theme.<br><br></code><p><code>g &lt;- ggplot(gapminder, aes(gdpPercap, lifeExp, size = pop, </code></p><p><code>frame = year)) +</code></p><code> geom_point +<br>geom_smooth(aes(group = year),<br>method = "lm",<br>show.legend = FALSE) +<br>facet_wrap(~continent, scales = "free") +<br>scale_x_log10 # convert to log scale<br><br>gganimate(g, interval=0.2)</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO8l0A6CyS74><p></p><h3>边缘分布的直方图／箱型图 Marginal Histogram / Boxplot</h3><p>如果你想在用一张图表中显示两个变量的关系以及分布，那么可以使用边缘分布直方图。它可以在散点图的X、Y周，显示变量的直方图。边缘分布直方图可以通过ggExtra包的ggMarginal函数实现。除了绘制直方图外，还支持绘制边缘分布的箱型图和密度函数。</p><pre><code># load package and data<br>library(ggplot2)<br>library(ggExtra)<br>data(mpg, package="ggplot2")<br># mpg &lt;- read.csv("http://goo.gl/uEeRGu")<br><br># Scatterplot<br>theme_set(theme_bw) # pre-set the bw theme.<br>mpg_select &lt;- mpg[mpg$hwy &gt;= 35 &amp; mpg$cty &gt; 27, ]<br>g &lt;- ggplot(mpg, aes(cty, hwy)) +<br>geom_count +<br>geom_smooth(method="lm", se=F)<br><br>ggMarginal(g, type = "histogram", fill="transparent")<br>ggMarginal(g, type = "boxplot", fill="transparent")<br># ggMarginal(g, type = "density", fill="transparent")</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO8lC1XdPjgL><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/RTBO8lKQaQ20W><p></p><h3>相关关系图 Correlogram</h3><p>相关关系图可以同时显示统一组数据中多个变量间的相关性。通过ggcorrplot包可以很方便的实现它。</p><pre><code># devtools::install_github("kassambara/ggcorrplot")<br>library(ggplot2)<br>library(ggcorrplot)<br><br># Correlation matrix<br>data(mtcars)<br>corr &lt;- round(cor(mtcars), 1)<br><br># Plot<br>ggcorrplot(corr, hc.order = TRUE,<br>type = "lower",<br>lab = TRUE,<br>lab_size = 3,<br>method="circle",<br>colors = c("tomato2", "white", "springgreen3"),<br>title="Correlogram of mtcars",<br>ggtheme=theme_bw)</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO8lTHI0ZwZX><p></p><h2>类型二: 偏差 Deviation</h2><h3>发散型条形图 Diverging bars</h3><p>发散型条形图，是一种可以同时处理正负值的条形图表。一般通过geom<em>bar函数就能实现，但是使用geom</em>bar函数时，往往会出现概念上的混淆。因为该函数既可以画直方图也可以画条形图。</p><p>比如，geom_bar函数的stat参数默认值是count，这也意味着，当指定的数据是连续变量时，系统会生成直方图。为了创建条形图而不是直方图，需要作如下修改：</p><ul><li><p>设置参数stat=identity</p></li><li><p>在aes中提供x和y两维变量，其中x是字符或因子型变量，y是数值型变量</p></li></ul><p>在下面的示例中，首先对mtcars数据集的mpg进行标准化。将那些mpg大于零的车辆标记为绿色，小于零的车辆标记为红色。</p><pre><code>library(ggplot2)<br>theme_set(theme_bw)<br><br># Data Prep<br>data("mtcars") # load data<br>mtcars$`car name` &lt;- rownames(mtcars)<br>mtcars$mpg_z &lt;- round((mtcars$mpg - mean(mtcars$mpg))/sd(mtcars$mpg), 2)<br>mtcars$mpg_type &lt;- ifelse(mtcars$mpg_z &lt; 0, "below", "above")<br>mtcars &lt;- mtcars[order(mtcars$mpg_z), ] # sort<br></code><p><code>mtcars$`car name` &lt;- factor(mtcars$`car name`, </code></p><p><code>levels = mtcars$`car name`) </code></p><code>#Diverging Barcharts<br>ggplot(mtcars, aes(x=`car name`, y=mpg_z, label=mpg_z)) +<br>geom_bar(stat='identity', aes(fill=mpg_type), width=.5) +<br>scale_fill_manual(name="Mileage",<br>labels = c("Above Average", "Below Average"),<br>values = c("above"="#00ba38", "below"="#f8766d")) +<br>labs(subtitle="Normalised mileage from 'mtcars'",<br>title= "Diverging Bars") +<br>coord_flip</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO8oJHpbPnnb><p></p><h3>发散型棒棒糖图 Diverging Lollipop Chart</h3><p>棒棒糖图与条形图类似。一般可以使用geom_<em>point和geom_</em>segment来画棒棒糖图。借用条形图的数据，我们这里用棒棒糖图来实现它。</p><pre><code>library(ggplot2)<br>theme_set(theme_bw)<br><br>ggplot(mtcars, aes(x=`car name`, y=mpg_z, label=mpg_z)) +<br>geom_point(stat='identity', fill="black", size=6) +<br>geom_segment(aes(y = 0,<br>x = `car name`,<br>yend = mpg_z,<br>xend = `car name`),<br>color = "black") +<br>geom_text(color="white", size=2) +<br>labs(title="Diverging Lollipop Chart",<br>subtitle="Normalized mileage from 'mtcars': Lollipop") +<br>ylim(-2.5, 2.5) +<br>coord_flip</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/RTBO8oV86TBa7d><p></p><h3>发散型点图 Diverging Dot Plot</h3><p>点图与条形图原理一致，只是表达形式不同。</p><pre><code>library(ggplot2)<br>theme_set(theme_bw)<br><br># Plot<br>ggplot(mtcars, aes(x=`car name`, y=mpg_z, label=mpg_z)) +<br>geom_point(stat='identity', aes(col=mpg_type), size=6) +<br>scale_color_manual(name="Mileage",<br>labels = c("Above Average", "Below Average"),<br>values = c("above"="#00ba38", "below"="#f8766d")) +<br>geom_text(color="white", size=2) +<br>labs(title="Diverging Dot Plot",<br>subtitle="Normalized mileage from 'mtcars': Dotplot") +<br>ylim(-2.5, 2.5) +<br>coord_flip</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO8pSBKru5pz><p></p><h3>面积图 Area Chart</h3><p>面积图一般用来表示某指标与基准指标相比的变化情况。通常可以用geom_area函数实现它。</p><pre><code>library(ggplot2)<br>library(quantmod)<br>data("economics", package = "ggplot2")<br><br># Compute % Returns<br></code><p><code>economics$returns_perc &lt;- c(0, diff(economics$psavert)/</code></p><p><code>economics$psavert[-length(economics$psavert)])</code></p><code><br># Create break points and labels for axis ticks<br>brks &lt;- economics$date[seq(1, length(economics$date), 12)]<br></code><p><code>lbls &lt;- lubridate::year(economics$date[seq(1, </code></p><p><code>length(economics$date), 12)])</code></p><code><br># Plot<br>ggplot(economics[1:100, ], aes(date, returns_perc)) +<br>geom_area +<br>scale_x_date(breaks=brks, labels=lbls) +<br>theme(axis.text.x = element_text(angle=90)) +<br>labs(title="Area Chart",<br>subtitle = "Perc Returns for Personal Savings",<br>y="% Returns for Personal savings",<br>caption="Source: economics")</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/RTBO8paG6i0J4g><p></p><h2>三: 排序 Ranking</h2><p>排序图一般用于比较多个项目之间的指标大小。</p><p></p><h3>有序条形图 Ordered Bar Chart</h3><p>有序条形图是按照Y轴变量大小进行排序的条形图。让我们用mpg数据集绘制每个制造商的平均城市里程数的有序条形图。</p><pre><code>cty_mpg &lt;- aggregate(mpg$cty, by=list(mpg$manufacturer), FUN=mean) <br>colnames(cty_mpg) &lt;- c("make", "mileage")<br>cty_mpg &lt;- cty_mpg[order(cty_mpg$mileage), ]<br>cty_mpg$make &lt;- factor(cty_mpg$make, levels = cty_mpg$make)<br>library(ggplot2)<br>theme_set(theme_bw)<br><br># Draw plot<br>ggplot(cty_mpg, aes(x=make, y=mileage)) +<br>geom_bar(stat="identity", width=.5, fill="tomato3") +<br>labs(title="Ordered Bar Chart",<br>subtitle="Make Vs Avg. Mileage",<br>caption="source: mpg") +<br>theme(axis.text.x = element_text(angle=65, vjust=0.6))</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO8r25UnCr1P><p></p><h3>棒棒糖图 Lollipop Chart</h3><p>与条形图类似，棒棒糖图也具备类似的图形展示效果。通过将条形改为细线，可以让图形显得更简洁，更美观。</p><pre><code>library(ggplot2)<br>theme_set(theme_bw)<br><br># Plot<br>ggplot(cty_mpg, aes(x=make, y=mileage)) +<br>geom_point(size=3) +<br>geom_segment(aes(x=make,<br>xend=make,<br>y=0,<br>yend=mileage)) +<br>labs(title="Lollipop Chart",<br>subtitle="Make Vs Avg. Mileage",<br>caption="source: mpg") +<br>theme(axis.text.x = element_text(angle=65, vjust=0.6))</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO8v14dkoVDh><p></p><h3>点图 Dot Plot</h3><p>点图其实和棒棒糖图类似，但是没有线条，并且指标被反转到了X轴。</p><pre><code>library(ggplot2)<br>library(scales)<br>theme_set(theme_classic)<br><br># Plot<br>ggplot(cty_mpg, aes(x=make, y=mileage)) +<br>geom_point(col="tomato2", size=3) + # Draw points<br>geom_segment(aes(x=make,<br>xend=make,<br>y=min(mileage),<br>yend=max(mileage)),<br>linetype="dashed",<br>size=0.1) + # Draw dashed lines<br>labs(title="Dot Plot",<br>subtitle="Make Vs Avg. Mileage",<br>caption="source: mpg") +<br>coord_flip</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO8vAHYzgptK><p></p><h3>倾斜图 Slope Chart</h3><p>斜率图是比较2个时间点之间位置的绝佳方法，既能展示值的大小变化，也能同时展示排名的变化。下图可以作为倾斜图的一个展示。</p><pre><code>library(ggplot2)<br>library(scales)<br>theme_set(theme_classic)<br><br># prep data<br>df &lt;- read.csv("https://raw.githubusercontent.com/<br>selva86/datasets/master/gdppercap.csv")<br>colnames(df) &lt;- c("continent", "1952", "1957")<br>left_label &lt;- paste(df$continent, round(df$`1952`),sep=", ")<br>right_label &lt;- paste(df$continent, round(df$`1957`),sep=", ")<br>df$class &lt;- ifelse((df$`1957` - df$`1952`) &lt; 0, "red", "green")<br><br># Plot<br>p &lt;- ggplot(df) +<br>geom_segment(aes(x=1, xend=2,<br>y=`1952`, yend=`1957`,<br>col=class), size=.75,<br>show.legend=F) +<br>geom_vline(xintercept=1, linetype="dashed", size=.1) +<br>geom_vline(xintercept=2, linetype="dashed", size=.1) +<br>scale_color_manual(labels = c("Up", "Down"),<br>values = c("green"="#00ba38",<br>"red"="#f8766d")) +<br>labs(x="", y="Mean GdpPerCap") +<br>xlim(.5, 2.5) + ylim(0,(1.1*(max(df$`1952`, df$`1957`))))<br><br># Add texts<br>p &lt;- p + geom_text(label=left_label, y=df$`1952`,<br>x=rep(1, NROW(df)), hjust=1.1, size=3.5)<br>p &lt;- p + geom_text(label=right_label, y=df$`1957`,<br>x=rep(2, NROW(df)), hjust=-0.1, size=3.5)<br>p &lt;- p + geom_text(label="Time 1", x=1, y=1.1*(max(df$`1952`,<br>df$`1957`)), hjust=1.2, size=5)<br>p &lt;- p + geom_text(label="Time 2", x=2, y=1.1*(max(df$`1952`,<br>df$`1957`)), hjust=-0.1, size=5)<br><br># Minify theme<br>p + theme(panel.background = element_blank,<br>panel.grid = element_blank,<br>axis.ticks = element_blank,<br>axis.text.x = element_blank,<br>panel.border = element_blank,<br>plot.margin = unit(c(1,2,1,2), "cm"))</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO8vJ958MHlv><p></p><h3>哑铃图 Dumbbell Plot</h3><p>哑铃图适合展示两个时间点之间的相对位置，比较两个类别之间的距离。正确的哑铃图要求Y轴变量是一个因子，并且因子水平与指标顺序相同。</p><pre><code># devtools::install_github("hrbrmstr/ggalt")<br>library(ggplot2)<br>library(ggalt)<br>theme_set(theme_classic)<br><br>health &lt;- read.csv("https://raw.githubusercontent.com/<br>selva86/datasets/master/health.csv")<br>health$Area &lt;- factor(health$Area, levels=as.character(health$Area))<br><br># health$Area &lt;- factor(health$Area)<br>gg &lt;- ggplot(health, aes(x=pct_2013, xend=pct_2014,<br>y=Area, group=Area)) +<br>geom_dumbbell(color="#a3c4dc",<br>size=0.75,<br>point.colour.l="#0e668b") +<br>scale_x_continuous(label=percent) +<br>labs(x=,<br>y=,<br>title="Dumbbell Chart",<br>subtitle="Pct Change: 2013 vs 2014",<br>caption="Source: https://github.com/hrbrmstr/ggalt") +<br>theme(plot.title = element_text(hjust=0.5, face="bold"),<br>plot.background=element_rect(fill="#f7f7f7"),<br>panel.background=element_rect(fill="#f7f7f7"),<br>panel.grid.minor=element_blank,<br>panel.grid.major.y=element_blank,<br>panel.grid.major.x=element_line,<br>axis.ticks=element_blank,<br>legend.position="top",<br>panel.border=element_blank)<br>plot(gg)</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO8vS9jPQkX2><p></p><h2>四: 分布 Distribution</h2><p>当拥有大量数据点并想要研究数据点的分布特点时，则可以画分布图。</p><p></p><h3>直方图 Histogram</h3><p>连续变量直方图一般可以通过geom_bar或者geom_histogram来实现。当使用geom_histogram时，可以选择使用bin参数来控制柱子的数量。或者也可以通过设置binwidth来设置bin的范围。因为geom_<em>histogram提供了控制箱数和binwidth的功能，因此一般可以选择geom_</em>histogram来绘制直方图。</p><pre><code>library(ggplot2)<br>theme_set(theme_classic)<br><br># Histogram on a Continuous (Numeric) Variable<br></code><p><code>g &lt;- ggplot(mpg, aes(displ)) + </code></p><p><code>scale_fill_brewer(palette = "Spectral")</code></p><code><br>g + geom_histogram(aes(fill=class),<br>binwidth = .1,<br>col="black",<br>size=.1) + # change binwidth<br>labs(title="Histogram with Auto Binning",<br>subtitle="Engine Displacement across Vehicle Classes")<br><br>g + geom_histogram(aes(fill=class),<br>bins=5,<br>col="black",<br>size=.1) + # change number of bins<br>labs(title="Histogram with Fixed Bins",<br>subtitle="Engine Displacement across Vehicle Classes")</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO8vb58w9Iof><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO8zbAQE2HZ3><p></p><h3>分类变量直方图 Histogram on a categorical variable</h3><p>分类变量上的直方图将生成显示每个类别的条形图的频率图表。通过调整宽度，可以调整条形的厚度。</p><pre><code>library(ggplot2)<br>theme_set(theme_classic)<br><br># Histogram on a Categorical variable<br>g &lt;- ggplot(mpg, aes(manufacturer))<br>g + geom_bar(aes(fill=class), width = 0.5) +<br>theme(axis.text.x = element_text(angle=65, vjust=0.6)) +<br>labs(title="Histogram on Categorical Variable",<br>subtitle="Manufacturer across Vehicle Classes")</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO8zpAKn93tK><p></p><h3>密度函数图 Density plot</h3><pre><code>library(ggplot2)<br>theme_set(theme_classic)<br><br># Plot<br>g &lt;- ggplot(mpg, aes(cty))<br>g + geom_density(aes(fill=factor(cyl)), alpha=0.8) +<br>labs(title="Density plot",<br>subtitle="City Mileage Grouped by Number of cylinders",<br>caption="Source: mpg",<br>x="City Mileage",<br>fill="# Cylinders")</code><br></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO9047kFKUgM><p></p><h3>箱型图 Box Plot</h3><p>箱形图是研究数据分布的一个好工具。它还可以显示多个组内的分布，以及中位数，范围和异常值。</p><p>箱型图框内的黑线代表数据的中位数，箱子的顶部和底部分布时数据的75%和25%的分位数。线条的终点距离为1.5*IQR，IQR为第25和第75百分位数之间的距离。线条以外的点衬之为异常点。</p><pre><code>library(ggplot2)<br>theme_set(theme_classic)<br><br># Plot<br>g &lt;- ggplot(mpg, aes(class, cty))<br>g + geom_boxplot(varwidth=T, fill="plum") +<br>labs(title="Box plot",<br>subtitle="City Mileage grouped by Class of vehicle",<br>caption="Source: mpg",<br>x="Class of Vehicle",<br>y="City Mileage")</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO90GGCyIOXJ><pre><code>library(ggthemes)<br>g &lt;- ggplot(mpg, aes(class, cty))<br>g + geom_boxplot(aes(fill=factor(cyl))) +<br>theme(axis.text.x = element_text(angle=65, vjust=0.6)) +<br>labs(title="Box plot",<br>subtitle="City Mileage grouped by Class of vehicle",<br>caption="Source: mpg",<br>x="Class of Vehicle",<br>y="City Mileage")</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO90j7xd68pa><p></p><h3>带点的箱型图 Dot + Box Plot</h3><p>除了箱型图的基本信息外，点图可以为箱型图提供更多的信息，在图中每个点代表一个观察点。</p><pre><code>library(ggplot2)<br>theme_set(theme_bw)<br><br># plot<br>g &lt;- ggplot(mpg, aes(manufacturer, cty))<br>g + geom_boxplot +<br>geom_dotplot(binaxis='y',<br>stackdir='center',<br>dotsize = .5,<br>fill="red") +<br>theme(axis.text.x = element_text(angle=65, vjust=0.6)) +<br>labs(title="Box plot + Dot plot",<br></code><p><code>subtitle="City Mileage vs Class: Each dot represents 1 row</code></p><p><code>in source data",</code></p><code> caption="Source: mpg",<br>x="Class of Vehicle",<br>y="City Mileage")</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO94p8Zme5Mw><p></p><h3>塔夫特箱型图 Tufte Boxplot</h3><pre><code>library(ggthemes)<br>library(ggplot2)<br>theme_set(theme_tufte) # from ggthemes<br><br># plot<br>g &lt;- ggplot(mpg, aes(manufacturer, cty))<br>g + geom_tufteboxplot +<br>theme(axis.text.x = element_text(angle=65, vjust=0.6)) +<br>labs(title="Tufte Styled Boxplot",<br>subtitle="City Mileage grouped by Class of vehicle",<br>caption="Source: mpg",<br>x="Class of Vehicle",<br>y="City Mileage")</code><br></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO9506i94JbW><p></p><h3>小提琴图 Violin Plot</h3><p>小提琴图与箱型图类似，但是小提琴图还包含了数据的密度函数图。</p><pre><code>library(ggplot2)<br>theme_set(theme_bw)<br><br># plot<br>g &lt;- ggplot(mpg, aes(class, cty))<br>g + geom_violin +<br>labs(title="Violin plot",<br>subtitle="City Mileage vs Class of vehicle",<br>caption="Source: mpg",<br>x="Class of Vehicle",<br>y="City Mileage")</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO958HTIDN9I><p></p><h3>人口金字塔图 Population Pyramid</h3><p>人口金字塔提供了一种独特的方式来可视化人口数量或人口百分比。下面的金字塔图，反映了在电子邮件营销活动渠道的每个阶段用户数。</p><pre><code>library(ggplot2)<br>library(ggthemes)<br>options(scipen = 999) # turns of scientific notations like 1e+40<br><br># Read data<br></code><p><code>email_campaign_funnel &lt;- read.csv("https://raw.githubusercontent.com</code></p><p><code>/selva86/datasets/master/email_campaign_funnel.csv")</code></p><code><br># X Axis Breaks and Labels<br>brks &lt;- seq(-15000000, 15000000, 5000000)<br>lbls = paste0(as.character(c(seq(15, 0, -5),<br>seq(5, 15, 5))), "m")<br><br># Plot<br>ggplot(email_campaign_funnel, aes(x = Stage,<br>y = Users, fill = Gender)) + # Fill column<br>geom_bar(stat = "identity", width = .6) + # draw the bars<br>scale_y_continuous(breaks = brks, # Breaks<br>labels = lbls) + # Labels<br>coord_flip + # Flip axes<br>labs(title="Email Campaign Funnel") +<br>theme_tufte + # Tufte theme from ggfortify<br>theme(plot.title = element_text(hjust = .5),<br>axis.ticks = element_blank) + # Centre plot title<br>scale_fill_brewer(palette = "Dark2") # Color palette</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO95HCix9x0t><p></p><h2>五: 组成 Composition</h2><h3>华夫饼图 Waffle Chart</h3><p>华夫饼图通常可以用来显示总人口分类。我们可以通过ggplot2的geom_tile函数实现华夫饼图。</p><pre><code>var &lt;- mpg$class # the categorical data <br><br>nrows &lt;- 10<br>df &lt;- expand.grid(y = 1:nrows, x = 1:nrows)<br>categ_table &lt;- round(table(var) * ((nrows*nrows)/(length(var))))<br>categ_table<br><br>df$category &lt;- factor(rep(names(categ_table), categ_table))<br><br>## Plot<br>ggplot(df, aes(x = x, y = y, fill = category)) +<br>geom_tile(color = "black", size = 0.5) +<br>scale_x_continuous(expand = c(0, 0)) +<br>scale_y_continuous(expand = c(0, 0), trans = 'reverse') +<br>scale_fill_brewer(palette = "Set3") +<br>labs(title="Waffle Chart", subtitle="'Class' of vehicles",<br>caption="Source: mpg")</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO95PFHagvoO><p></p><h3>饼图 Pie Chart</h3><p>饼图是显示数据组成的一种重要方式，在ggplot中，需要通过coord_polar函数来实现。</p><pre><code>library(ggplot2)<br>theme_set(theme_classic)<br><br># Source: Frequency table<br>df &lt;- as.data.frame(table(mpg$class))<br>colnames(df) &lt;- c("class", "freq")<br>pie &lt;- ggplot(df, aes(x = "", y=freq, fill = factor(class))) +<br>geom_bar(width = 1, stat = "identity") +<br>theme(axis.line = element_blank,<br>plot.title = element_text(hjust=0.5)) +<br>labs(fill="class",<br>x=,<br>y=,<br>title="Pie Chart of class",<br>caption="Source: mpg")<br><br>pie + coord_polar(theta = "y", start=0)<br><br># Source: Categorical variable.<br># mpg$class<br>pie &lt;- ggplot(mpg, aes(x = "", fill = factor(class))) +<br>geom_bar(width = 1) +<br>theme(axis.line = element_blank,<br>plot.title = element_text(hjust=0.5)) +<br>labs(fill="class",<br>x=,<br>y=,<br>title="Pie Chart of class",<br>caption="Source: mpg")<br><br>pie + coord_polar(theta = "y", start=0)</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/RTBO99W8OzuXKu><p></p><h3>树形图 Treemap</h3><p>树形图是现实分层数据的好方法。在ggplot中，treemapify包含有树形图所需要的数据处理及绘图方法。</p><p>为了创建树形图，需要先将数据转换成treemapify需要的数据格式。</p><p>此图测试没通过！！！</p><pre><code> library(ggplot2) <br>library(treemapify)<br></code><p><code>proglangs &lt;- read.csv("https://raw.githubusercontent.com/</code></p><p><code>selva86/datasets/master/proglanguages.csv")</code></p><code><br># plot<br>treeMapCoordinates &lt;- treemapify(proglangs,<br>area = "value",<br>fill = "parent",<br>label = "id",<br>group = "parent")<br><br>treeMapPlot &lt;- ggplotify(treeMapCoordinates) +<br>scale_x_continuous(expand = c(0, 0)) +<br>scale_y_continuous(expand = c(0, 0)) +<br>scale_fill_brewer(palette = "Dark2")<br><br>print(treeMapPlot)</code></pre><p></p><h3>条形图 Bar Chart</h3><pre><code>freqtable &lt;- table(mpg$manufacturer)<br>df &lt;- as.data.frame.table(freqtable)<br>library(ggplot2)<br>theme_set(theme_classic)<br><br># Plot<br>g &lt;- ggplot(df, aes(Var1, Freq))<br>g + geom_bar(stat="identity", width = 0.5, fill="tomato2") +<br>labs(title="Bar Chart",<br>subtitle="Manufacturer of vehicles",<br></code><p><code>caption="Source: Frequency of Manufacturers from </code></p><p><code>'mpg' dataset") +</code></p><code> theme(axis.text.x = element_text(angle=65, vjust=0.6)) <br></code><br></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO9A21CPeCR1><pre><code># From on a categorical column variable<br>g &lt;- ggplot(mpg, aes(manufacturer))<br>g + geom_bar(aes(fill=class), width = 0.5) +<br>theme(axis.text.x = element_text(angle=65, vjust=0.6)) +<br>labs(title="Categorywise Bar Chart",<br>subtitle="Manufacturer of vehicles",<br>caption="Source: Manufacturers from 'mpg' dataset")</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO9AB6MuxMn3><p></p><h2>六:时序变化 Change</h2><h3>时间序列图 Time Series</h3><p>ggfortify包支持autoplot函数直接从时间序列对象中自动绘制时间序列图。</p><pre><code>## From Timeseries object (ts)<br>library(ggplot2)<br>library(ggfortify)<br>theme_set(theme_classic)<br><br># Plot<br>autoplot(AirPassengers) +<br>labs(title="AirPassengers")</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO9AKBP2djux><p></p><h3>数据框格式的时间序列图 Time Series Plot From a Data Frame</h3><pre><code>library(ggplot2)<br>theme_set(theme_classic)<br><br># Allow Default X Axis Labels<br>ggplot(economics, aes(x=date)) +<br>geom_line(aes(y=returns_perc)) +<br>labs(title="Time Series Chart",<br>subtitle="Returns Percentage from 'Economics' Dataset",<br>caption="Source: Economics",<br>y="Returns %")</code><br></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO9Gh1u3wLnt><p></p><h3>关于月度数据的时间序列图 <em>Monthly</em>Time</h3><pre><code>library(ggplot2)<br>library(lubridate)<br>theme_set(theme_bw)<br><br>economics_m &lt;- economics[1:24, ]<br><br># labels and breaks for X axis text<br>lbls &lt;- paste0(month.abb[month(economics_m$date)], " ",<br>lubridate::year(economics_m$date))<br>brks &lt;- economics_m$date<br><br># plot<br>ggplot(economics_m, aes(x=date)) +<br>geom_line(aes(y=uempmed)) +<br>labs(title="Monthly Time Series",<br>subtitle="Returns Percentage from Economics Dataset",<br>caption="Source: Economics",<br>y="Returns %") + # title and caption<br>scale_x_date(labels = lbls,<br>breaks = brks) +<br>theme(axis.text.x = element_text(angle = 90, vjust=0.5),<br>panel.grid.minor = element_blank)</code><br></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO9Gt5P68Dza><p></p><h3>关于年度数据的时间序列图 <em>Yearly</em>Time</h3><pre><code>library(ggplot2)<br>library(lubridate)<br>theme_set(theme_bw)<br><br>economics_y &lt;- economics[1:90, ]<br><br># labels and breaks for X axis text<br>brks &lt;- economics_y$date[seq(1, length(economics_y$date), 12)]<br>lbls &lt;- lubridate::year(brks)<br><br># plot<br>ggplot(economics_y, aes(x=date)) +<br>geom_line(aes(y=uempmed)) +<br>labs(title="Yearly Time Series",<br>subtitle="uempmed Percentage from Economics Dataset",<br>caption="Source: Economics",<br>y="uempmed %") + # title and caption<br>scale_x_date(labels = lbls,<br>breaks = brks) +<br></code><p><code>theme(axis.text.x = element_text(angle = 90, vjust=0.5), </code></p><p><code>panel.grid.minor = element_blank) </code></p><br></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO9HxFtguo1c><p></p><h3>同时展示多个时间序列 Long Data Format: Multiple Time Series</h3><pre><code>data(economics_long, package = "ggplot2")<br>head(economics_long)<br>library(ggplot2)<br>library(lubridate)<br>theme_set(theme_bw)<br><br>df &lt;- economics_long[economics_long$variable %in%<br>c("psavert", "uempmed"), ]<br>df &lt;- df[lubridate::year(df$date) %in% c(1967:1981), ]<br><br># labels and breaks for X axis text<br>brks &lt;- df$date[seq(1, length(df$date), 12)]<br>lbls &lt;- lubridate::year(brks)<br><br># plot<br>ggplot(df, aes(x=date)) +<br>geom_line(aes(y=value, col=variable)) +<br>labs(title="Time Series of Returns Percentage",<br>subtitle="Drawn from Long Data format",<br>caption="Source: Economics",<br>y="Returns %",<br>color=) + # title and caption<br>scale_x_date(labels = lbls, breaks = brks) +<br>scale_color_manual(labels = c("psavert", "uempmed"),<br>values = c("psavert"="#00ba38",<br>"uempmed"="#f8766d")) +<br>theme(axis.text.x = element_text(angle = 90, vjust=0.5, size = 8),<br>panel.grid.minor = element_blank)</code><br></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO9I7H6exAUQ><p></p><h3>堆积图 Stacked Area Chart</h3><pre><code>library(ggplot2)<br>library(lubridate)<br>theme_set(theme_bw)<br><br>df &lt;- economics[, c("date", "psavert", "uempmed")]<br>df &lt;- df[lubridate::year(df$date) %in% c(1967:1981), ]<br><br># labels and breaks for X axis text<br>brks &lt;- df$date[seq(1, length(df$date), 12)]<br>lbls &lt;- lubridate::year(brks)<br><br># plot<br>ggplot(df, aes(x=date)) +<br>geom_area(aes(y=psavert+uempmed, fill="psavert")) +<br>geom_area(aes(y=uempmed, fill="uempmed")) +<br>labs(title="Area Chart of Returns Percentage",<br>subtitle="From Wide Data format",<br>caption="Source: Economics",<br>y="Returns %") +<br>scale_x_date(labels = lbls, breaks = brks) +<br>scale_fill_manual(name="",<br>values = c("psavert"="#00ba38", "uempmed"="#f8766d")) +<br>theme(panel.grid.minor = element_blank)</code><br></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/RTBO9IH2Vao5YX><p></p><h3>日历热图 Calendar Heatmap</h3><p>当你想强调在日历格式中，数据变化情况(如股票数据)，那么就可以使用日历热图。通过数据准备，我们可以用geom_tile函数来实现日历热图。</p><pre><code>library(ggplot2)<br>library(plyr)<br>library(scales)<br>library(zoo)<br><br></code><p><code>df &lt;- read.csv("https://raw.githubusercontent.com/selva86/datasets</code></p><p><code>/master/yahoo.csv")</code></p><code>df$date &lt;- as.Date(df$date) # format date<br>df &lt;- df[df$year &gt;= 2012, ] # filter reqd years<br><br># Create Month Week<br>df$yearmonth &lt;- as.yearmon(df$date)<br>df$yearmonthf &lt;- factor(df$yearmonth)<br>df &lt;- ddply(df,.(yearmonthf), transform, monthweek=1+week-min(week))<br>df &lt;- df[, c("year", "yearmonthf", "monthf",<br>"week", "monthweek", "weekdayf", "VIX.Close")]<br><br><br># Plot<br>ggplot(df, aes(monthweek, weekdayf, fill = VIX.Close)) +<br>geom_tile(colour = "white") +<br>facet_grid(year~monthf) +<br>scale_fill_gradient(low="red", high="green") +<br>labs(x="Week of Month",<br>y="",<br>title = "Time-Series Calendar Heatmap",<br>subtitle="Yahoo Closing Price",<br>fill="Close")</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO9Ok9IyCWaD><p></p><h3>季节性时间序列 Seasonal Plot</h3><pre><code>library(ggplot2)<br>library(forecast)<br>theme_set(theme_classic)<br><br># Subset data<br></code><p><code>nottem_small &lt;- window(nottem, start=c(1920, 1), end=c(1925, 12)) </code></p><p><code># subset a smaller timewindow</code></p><code><br># Plot<br></code><p><code>ggseasonplot(AirPassengers) + </code></p><p><code>labs(title="Seasonal plot: International Airline Passengers")</code></p><p><code>ggseasonplot(nottem_small) + </code></p><p><code>labs(title="Seasonal plot: Air temperatures at Nottingham Castle") </code></p><br><br></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO9OvGn99Im3><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO9P42zLyB8y><p></p><h2>七: 分组 Groups</h2><h3>分层树形图 Hierarchical Dendrogram</h3><pre><code># install.packages("ggdendro")<br>library(ggplot2)<br>library(ggdendro)<br>theme_set(theme_bw)<br><br>hc &lt;- hclust(dist(USArrests), "ave") # hierarchical clustering<br><br># plot<br>ggdendrogram(hc, rotate = TRUE, size = 2)</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO9PE7ASIt8m><p></p><h3>聚类 Clusters</h3><p>对于不同的数据簇，我们可以用geom_<em>encircle来显示。如果数据存在多维特征，可以考虑采用PCA降维，并将第一主成分与第二主成分作为图形的X、Y轴。geom</em>encircle将需要突出的数据簇包围起来，从而达到突出数据的作用。</p><pre><code># devtools::install_github("hrbrmstr/ggalt")<br>library(ggplot2)<br>library(ggalt)<br>library(ggfortify)<br>theme_set(theme_classic)<br><br>df &lt;- iris[c(1, 2, 3, 4)]<br>pca_mod &lt;- prcomp(df)<br><br>df_pc &lt;- data.frame(pca_mod$x, Species=iris$Species)<br>df_pc_vir &lt;- df_pc[df_pc$Species == "virginica", ]<br>df_pc_set &lt;- df_pc[df_pc$Species == "setosa", ]<br>df_pc_ver &lt;- df_pc[df_pc$Species == "versicolor", ]<br><br># Plot ----------------------------------------------------<br>ggplot(df_pc, aes(PC1, PC2, col=Species)) +<br>geom_point(aes(shape=Species), size=2) +<br>labs(title="Iris Clustering",<br>subtitle="With principal components PC1 and<br>PC2 as X and Y axis",<br>caption="Source: Iris") +<br>coord_cartesian(xlim = 1.2 * c(min(df_pc$PC1), max(df_pc$PC1)),<br>ylim = 1.2 * c(min(df_pc$PC2), max(df_pc$PC2))) +<br>geom_encircle(data = df_pc_vir, aes(x=PC1, y=PC2)) +<br>geom_encircle(data = df_pc_set, aes(x=PC1, y=PC2)) +<br>geom_encircle(data = df_pc_ver, aes(x=PC1, y=PC2))</code></pre><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTBO9Q2AfwRL5m><p></p><h2>八: 空间可视化Spatial</h2><p>ggmap包提供了与google maps api交互的工具，并获取要绘制的地点的座标 。</p><p>Error: Google now requires an API key. See ?register_google for details.</p><p>目前使用需要注册API key，而且国内也无法直连，以下没有测试。</p><pre><code># Better install the dev versions ----------<br># devtools::install_github("dkahle/ggmap")<br># devtools::install_github("hrbrmstr/ggalt")<br><br># load packages<br>library(ggplot2)<br>library(ggmap)<br>library(ggalt)<br><br># Get Chennai's Coordinates --------------------------------<br>chennai &lt;- geocode("Chennai")<br><br># Get the Map ----------------------------------------------<br># Google Satellite Map<br>chennai_ggl_sat_map &lt;- qmap("chennai", zoom=12,<br>source = "google", maptype="satellite")<br><br># Google Road Map<br>chennai_ggl_road_map &lt;- qmap("chennai", zoom=12,<br>source = "google", maptype="roadmap")<br><br># Google Hybrid Map<br>chennai_ggl_hybrid_map &lt;- qmap("chennai", zoom=12,<br>source = "google", maptype="hybrid")<br><br># Open Street Map<br>chennai_osm_map &lt;- qmap("chennai", zoom=12, source = "osm")<br><br># Get Coordinates for Chennai's Places ---------------------<br>chennai_places &lt;- c("Kolathur",<br>"Washermanpet",<br>"Royapettah",<br>"Adyar",<br>"Guindy")<br><br>places_loc &lt;- geocode(chennai_places)<br><br><br># Plot Open Street Map -------------------------------------<br>chennai_osm_map + geom_point(aes(x=lon, y=lat),<br>data = places_loc,<br>alpha = 0.7,<br>size = 7,<br>color = "tomato") +<br>geom_encircle(aes(x=lon, y=lat),<br>data = places_loc, size = 2, color = "blue")<br><br># Plot Google Road Map -------------------------------------<br>chennai_ggl_road_map + geom_point(aes(x=lon, y=lat),<br>data = places_loc,<br>alpha = 0.7,<br>size = 7,<br>color = "tomato") +<br>geom_encircle(aes(x=lon, y=lat),<br>data = places_loc, size = 2, color = "blue")<br><br># Google Hybrid Map ----------------------------------------<br>chennai_ggl_hybrid_map + geom_point(aes(x=lon, y=lat),<br>data = places_loc,<br>alpha = 0.7,<br>size = 7,<br>color = "tomato") +<br>geom_encircle(aes(x=lon, y=lat),<br>data = places_loc, size = 2, color = "blue")</code></pre><p></p><h3>街道地图</h3><img alt=50个ggplot2可视化案例 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTBO9VP1Gc2QMh><p><strong>测试环境</strong></p><p>sessionInfo</p><p>## R version 3.6.0 (2019-04-26)</p><p>## Platform: x86_64-w64-mingw32/x64 (64-bit)</p><p>## Running under: Windows 10 x64 (build 17134)</p><p>##</p><p>## Matrix products: default</p><p>##</p><p>## locale:</p><p>## [1] LC_COLLATE=Chinese (Simplified)_China.936</p><p>## [2] LC_CTYPE=Chinese (Simplified)_China.936</p><p>## [3] LC_MONETARY=Chinese (Simplified)_China.936</p><p>## [4] LC_NUMERIC=C</p><p>## [5] LC_TIME=Chinese (Simplified)_China.936</p><p>##</p><p>## attached base packages:</p><p>## [1] stats graphics grDevices utils datasets methods base</p><p>##</p><p>## other attached packages:</p><p>## [1] ggdendro_0.1-20 forecast_8.7 reshape2_1.4.3 dplyr_0.8.1</p><p>## [5] plyr_1.8.4 lubridate_1.7.4 ggfortify_0.4.7 ggthemes_4.2.0</p><p>## [9] scales_1.0.0 quantmod_0.4-14 TTR_0.23-4 xts_0.11-2</p><p>## [13] zoo_1.8-6 ggcorrplot_0.1.3 ggExtra_0.8 gifski_0.8.6</p><p>## [17] gganimate_1.0.3 ggalt_0.4.0 ggplot2_3.1.1</p><p>##</p><p>## loaded via a namespace (and not attached):</p><p>## [1] tseries_0.10-47 maps_3.3.0 tidyr_0.8.3</p><p>## [4] shiny_1.3.2 assertthat_0.2.1 yaml_2.2.0</p><p>## [7] progress_1.2.2 backports_1.1.4 Rttf2pt1_1.3.7</p><p>## [10] pillar_1.4.0 lattice_0.20-38 quadprog_1.5-7</p><p>## [13] glue_1.3.1 extrafontdb_1.0 digest_0.6.19</p><p>## [16] RColorBrewer_1.1-2 promises_1.0.1 colorspace_1.4-1</p><p>## [19] htmltools_0.3.6 httpuv_1.5.1 timeDate_3043.102</p><p>## [22] pkgconfig_2.0.2 purrr_0.3.2 xtable_1.8-4</p><p>## [25] tweenr_1.0.1 later_0.8.0 tibble_2.1.1</p><p>## [28] farver_1.1.0 withr_2.1.2 urca_1.3-0</p><p>## [31] nnet_7.3-12 lazyeval_0.2.2 cli_1.1.0</p><p>## [34] magrittr_1.5 crayon_1.3.4 mime_0.6</p><p>## [37] evaluate_0.13 ash_1.0-15 fansi_0.4.0</p><p>## [40] nlme_3.1-139 MASS_7.3-51.4 tools_3.6.0</p><p>## [43] prettyunits_1.0.2 hms_0.4.2 stringr_1.4.0</p><p>## [46] munsell_0.5.0 compiler_3.6.0 rlang_0.3.4</p><p>## [49] grid_3.6.0 miniUI_0.1.1.1 labeling_0.3</p><p>## [52] rmarkdown_1.13 proj4_1.0-8 fracdiff_1.4-2</p><p>## [55] gtable_0.3.0 curl_3.3 R6_2.4.0</p><p>## [58] gridExtra_2.3 knitr_1.23 zeallot_0.1.0</p><p>## [61] extrafont_0.17 utf8_1.1.4 KernSmooth_2.23-15</p><p>## [64] stringi_1.4.3 parallel_3.6.0 Rcpp_1.0.1</p><p>## [67] vctrs_0.1.0 png_0.1-7 lmtest_0.9-37</p><p>## [70] tidyselect_0.2.5 xfun_0.7</p><p><strong>后台回复“ggplot2”获得本文原代码。</strong></p><p></p><h2>猜你喜欢</h2><p>10000+：菌群分析宝宝与猫狗 梅毒狂想曲 提DNA发Nature Cell专刊 肠道指挥大脑</p><p>系列教程：微生物组入门 Biostar 微生物组 宏基因组</p><p>专业技能：学术图表高分文章生信宝典 不可或缺的人</p><p>一文读懂：宏基因组 寄生虫益处 进化树</p><p>必备技能：提问 搜索 Endnote</p><p>文献阅读 热心肠 SemanticScholar Geenmedical</p><p>扩增子分析：图表解读 分析流程 统计绘图</p><p>16S功能预测 PICRUSt FAPROTAX Bugbase Tax4Fun</p><p>在线工具：16S预测培养基 生信绘图</p><p>科研经验：云笔记 云协作 公众号</p><p>编程模板: Shell R Perl</p><p>生物科普: 肠道细菌人体上的生命生命大跃进 细胞暗战 人体奥秘</p><p></p><h2>写在后面</h2><p>为鼓励读者交流、快速解决科研困难，我们建立了“宏基因组”专业讨论群，目前己有国内外5000+ 一线科研人员加入。参与讨论，获得专业解答，欢迎分享此文至朋友圈，并扫码加主编好友带你入群，务必备注“姓名-单位-研究方向-职称/年级”。PI请明示身份，另有海内外微生物相关PI群供大佬合作交流。技术问题寻求帮助，首先阅读《如何优雅的提问》学习解决问题思路，仍未解决群内讨论，问题不私聊，帮助同行。</p><p>学习16S扩增子、宏基因组科研思路和分析实战，关注“宏基因组”</p><p>点击阅读原文，跳转最新文章目录阅读</p><p>https://mp.weixin.qq.com/s/5jQspEvH5_4Xmart22gjMA</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'50','ggplot2','可视化'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>