<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>使用公钥/私钥对设定免密的 Linux 登录方式 | 极客快訊</title><meta property="og:title" content="使用公钥/私钥对设定免密的 Linux 登录方式 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/2276426814ab465eb251dd31343c9824"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/13331db.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/13331db.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/13331db.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/13331db.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/13331db.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/13331db.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/13331db.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/13331db.html><meta property="article:published_time" content="2020-10-29T20:51:34+08:00"><meta property="article:modified_time" content="2020-10-29T20:51:34+08:00"><meta name=Keywords content><meta name=description content="使用公钥/私钥对设定免密的 Linux 登录方式"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/13331db.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>使用公钥/私钥对设定免密的 Linux 登录方式</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div class=pgc-img><img alt="使用公钥/私钥对设定免密的 Linux 登录方式" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2276426814ab465eb251dd31343c9824><p class=pgc-img-caption></p></div><blockquote><p>使用一组公钥/私钥对让你不需要密码登录到远程 Linux 系统或使用 ssh 运行命令，这会非常方便，但是设置过程有点复杂。下面是帮助你的方法和脚本。-- Sandra Henry-stocker（作者）</p></blockquote><p><br></p><p>在 Linux 系统上设置一个允许你无需密码即可远程登录或运行命令的帐户并不难，但是要使它正常工作，你还需要掌握一些繁琐的细节。在本文，我们将完成整个过程，然后给出一个可以帮助处理琐碎细节的脚本。</p><p>设置好之后，如果希望在脚本中运行 ssh 命令，尤其是希望配置自动运行的命令，那么免密访问特别有用。</p><p>需要注意的是，你不需要在两个系统上使用相同的用户帐户。实际上，你可以把公用密钥用于系统上的多个帐户或多个系统上的不同帐户。</p><p>设置方法如下。</p><h1 class=pgc-h-arrow-right>在哪个系统上启动？</h1><p>首先，你需要从要发出命令的系统上着手。那就是你用来创建 ssh 密钥的系统。你还需要可以访问远程系统上的帐户并在其上运行这些命令。</p><p>为了使角色清晰明了，我们将场景中的第一个系统称为 “boss”，因为它将发出要在另一个系统上运行的命令。</p><p>因此，命令提示符如下：</p><pre><code>boss$</code></pre><p>如果你还没有在 boss 系统上为你的帐户设置公钥/私钥对，请使用如下所示的命令创建一个密钥对。注意，你可以在各种加密算法之间进行选择。（一般使用 RSA 或 DSA。）注意，要在不输入密码的情况下访问系统，你需要在下面的对话框中的两个提示符出不输入密码。</p><p>如果你已经有一个与此帐户关联的公钥/私钥对，请跳过此步骤。</p><pre><code>boss$ ssh-keygen -t rsaGenerating public/private rsa key pair.Enter file in which to save the key (/home/myself/.ssh/id_rsa):Enter passphrase (empty for no passphrase):            &lt;== 按下回车键即可Enter same passphrase again:                           &lt;== 按下回车键即可Your identification has been saved in /home/myself/.ssh/id_rsa.Your public key has been saved in /home/myself/.ssh/id_rsa.pub.The key fingerprint is:SHA256:1zz6pZcMjA1av8iyojqo6NVYgTl1+cc+N43kIwGKOUI myself@bossThe key's randomart image is:+---[RSA 3072]----+|     . ..        ||   E+ .. .       ||  .+ .o + o      ||   ..+.. .o* .   ||    ... So+*B o  ||    +   ...==B . || . o .   ....++. ||o o   . . o..o+  ||=..o.. ..o  o.   |+----[SHA256]-----+</code></pre><p>上面显示的命令将创建公钥和私钥。其中公钥用于加密，私钥用于解密。因此，这些密钥之间的关系是关键的，私有密钥<strong>绝不</strong>应该被共享。相反，它应该保存在 boss 系统的 .ssh 文件夹中。</p><p>注意，在创建时，你的公钥和私钥将会保存在 .ssh 文件夹中。</p><p>下一步是将<strong>公钥</strong>复制到你希望从 boss 系统免密访问的系统。你可以使用 scp 命令来完成此操作，但此时你仍然需要输入密码。在本例中，该系统称为 “target”。</p><pre><code>boss$ scp .ssh/id_rsa.pub myacct@target:/home/myaccountmyacct@target's password:</code></pre><p>你需要安装公钥在 target 系统（将运行命令的系统）上。如果你没有 .ssh 目录（例如，你从未在该系统上使用过 ssh），运行这样的命令将为你设置一个目录：</p><pre><code>target$ ssh localhost datetarget$ ls -la .sshtotal 12drwx------ 2 myacct myacct 4096 Jan 19 11:48 .drwxr-xr-x 6 myacct myacct 4096 Jan 19 11:49 ..-rw-r--r-- 1 myacct myacct  222 Jan 19 11:48 known_hosts</code></pre><p>仍然在目标系统上，你需要将从“boss”系统传输的公钥添加到 .ssh/authorized_keys 文件中。如果该文件已经存在，使用下面的命令将把它添加到文件的末尾；如果文件不存在，则创建该文件并添加密钥。</p><pre><code>target$ cat id_rsa.pub &gt;&gt; .ssh/authorized_keys</code></pre><p>下一步，你需要确保你的 authorized_keys 文件权限为 600。如果还不是，执行命令 chmod 600 .ssh/authorized_keys。</p><pre><code>target$ ls -l authorized_keys-rw------- 1 myself myself 569 Jan 19 12:10 authorized_keys</code></pre><p>还要检查目标系统上 .ssh 目录的权限是否设置为 700。如果需要，执行 chmod 700 .ssh 命令修改权限。</p><pre><code>target$ ls -ld .sshdrwx------ 2 myacct myacct 4096 Jan 14 15:54 .ssh</code></pre><p>此时，你应该能够从 boss 系统远程免密运行命令到目标系统。除非目标系统上的目标用户帐户拥有与你试图连接的用户和主机相同的旧公钥，否则这应该可以工作。如果是这样，你应该删除早期的（并冲突的）条目。</p><h1 class=pgc-h-arrow-right>使用脚本</h1><p>使用脚本可以使某些工作变得更加容易。但是，在下面的示例脚本中，你会遇到的一个烦人的问题是，在配置免密访问权限之前，你必须多次输入目标用户的密码。一种选择是将脚本分为两部分——需要在 boss 系统上运行的命令和需要在 target 系统上运行的命令。</p><p>这是“一步到位”版本的脚本：</p><pre><code>#!/bin/bash# NOTE: This script requires that you have the password for the remote acct#       in order to set up password-free access using your public keyLOC=`hostname`  # the local system from which you want to run commands from                # wo a password# get target system and accountecho -n "target system&gt; "read REMecho -n "target user&gt; "read user# create a key pair if no public key existsif [ ! -f ~/.ssh/id_rsa.pub ]; then  ssh-keygen -t rsafi# ensure a .ssh directory exists in the remote accountecho checking for .ssh directory on remote systemssh $user@$REM "if [ ! -d /home/$user/.ssh ]; then mkdir /home/$user/.ssh; fi"# share the public key (using local hostname)echo copying the public keyscp ~/.ssh/id_rsa.pub $user@$REM:/home/$user/$user-$LOC.pub# put the public key into the proper locationecho adding key to authorized_keysssh $user@$REM "cat /home/$user/$user-$LOC.pub &gt;&gt; /home/$user/.ssh/authorized_keys"# set permissions on authorized_keys and .ssh (might be OK already)echo setting permissionsssh $user@$REM "chmod 600 ~/.ssh/authorized_keys"ssh $user@$REM "chmod 700 ~/.ssh"# try it out -- should NOT ask for a passwordecho testing -- if no password is requested, you are all setssh $user@$REM /bin/hostname</code></pre><p>脚本已经配置为在你每次必须输入密码时告诉你它正在做什么。交互看起来是这样的:</p><pre><code>$ ./rem_login_setuptarget system&gt; fruitflytarget user&gt; lolachecking for .ssh directory on remote systemlola@fruitfly's password:copying the public keylola@fruitfly's password:id_rsa.pub                                    100%  567   219.1KB/s   00:00adding key to authorized_keyslola@fruitfly's password:setting permissionslola@fruitfly's password:testing -- if no password is requested, you are all setfruitfly</code></pre><p>在上面的场景之后，你就可以像这样登录到 lola 的帐户：</p><pre><code>$ ssh lola@fruitfly[lola@fruitfly ~]$</code></pre><p>一旦设置了免密登录，你就可以不需要键入密码从 boss 系统登录到 target 系统，并且运行任意的 ssh 命令。以这种免密的方式运行并不意味着你的帐户不安全。然而，根据 target 系统的性质，保护你在 boss 系统上的密码可能变得更加重要。</p><hr><p>via: https://www.networkworld.com/article/3514607/setting-up-passwordless-linux-logins-using-publicprivate-keys.html</p><p>作者： Sandra Henry-Stocker 选题： lujun9972 译者： laingke 校对： wxy</p><p>本文由 LCTT 原创编译， Linux中国 荣誉推出</p><h1 class=pgc-h-arrow-right>点击“了解更多”可访问文内链接</h1></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'公钥','私钥','设定'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>