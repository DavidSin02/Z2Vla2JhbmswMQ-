<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>MySQL基础之分组查询 | 极客快訊</title><meta property="og:title" content="MySQL基础之分组查询 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/a6b08f84f10947fd8d7e507dfcef6b3b"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/13dbccdd.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/13dbccdd.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/13dbccdd.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/13dbccdd.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/13dbccdd.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/13dbccdd.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/13dbccdd.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/13dbccdd.html><meta property="article:published_time" content="2020-10-29T21:12:22+08:00"><meta property="article:modified_time" content="2020-10-29T21:12:22+08:00"><meta name=Keywords content><meta name=description content="MySQL基础之分组查询"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/13dbccdd.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>MySQL基础之分组查询</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p class=ql-align-justify>在MySQL 查询 语句中，允许使用 GROUP BY 子句对结果分组。</p><p class=ql-align-justify>GROUP BY语法：</p><pre>select 分组函数, 列（要求在group by 子句后面）from 表名【where 条件】group by 分组的列【order by 子句】</pre><p class=ql-align-justify>准备一个表，和一些数据。员工表，表名emp，包含姓名（ename）、工作（job）、工资（sal）、 部门编号（deptNo）等字段。</p><pre> CREATE TABLE `emp` ( `id` int(255) NOT NULL AUTO_INCREMENT, `ename` varchar(255) DEFAULT NULL, `job` varchar(255) DEFAULT NULL, `sal` int(11) DEFAULT NULL, `deptNo` int(11) DEFAULT NULL, `hiredate` datetime NOT NULL, `bonus` int(11) DEFAULT NULL, `orderNo` varchar(255) DEFAULT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8</pre><p>准备好的一些测试数据</p><div class=pgc-img><img alt=MySQL基础之分组查询 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a6b08f84f10947fd8d7e507dfcef6b3b><p class=pgc-img-caption></p></div><p class=ql-align-justify><strong>简单分组</strong></p><p class=ql-align-justify>假设有一个需求：查询每个部门的员工人数。</p><p class=ql-align-justify>使用count函数可以查询个数，select count(*) from emp 将整个表看作一组，返回整个表的行数。此时要求查询每个部门的员工人数，意味着要在整个emp表再按部门分组，有几个部门就分几个小组，然后再统计部门的人数。</p><p class=ql-align-justify>可以这样写：</p><pre>mysql&gt; select count(*),deptNo  from emp group by deptNo;+----------+--------+| count(*) | deptNo |+----------+--------+| 2 | 1 || 2 | 2 | | 2 | 3 | | 2 | 4 | | 2 | 5 | +----------+--------+</pre><p class=ql-align-justify>deptNo是部门编号，所以以此列作为分组的列。前面是员工数量，后面是部门编号。</p><p class=ql-align-justify>再如，查询每个部门的平均工资</p><pre>mysql&gt; select avg(sal),deptNo from emp group by deptNo;+-----------+--------+| avg(sal) | deptNo |+-----------+--------+| 4000.0000 | 1 || 4100.0000 | 2 || 3250.0000 | 3 || 4000.0000 | 4 || 3500.0000 | 5 |+-----------+--------+</pre><p class=ql-align-justify><strong>有条件的分组查询</strong></p><p class=ql-align-justify>1、比如第一个问题改一下，查询每个部门有奖金的员工人数（即bonus这列，其有两个值，null和非null）</p><p class=ql-align-justify>此时可以这样查</p><pre>mysql&gt; select count(*),deptNo  from emp  where bonus is not null  group by deptNo;+----------+--------+| count(*) | deptNo |+----------+--------+| 1 | 1 || 1 | 2 || 1 | 3 || 1 | 4 || 1 | 5 |+----------+--------+</pre><p class=ql-align-justify>奖金是筛选条件，条件涉及的字段bonus是在emp表中，也就是原始表中，此时就可以在where中使用，并且在group by 之前。</p><p class=ql-align-justify><br></p><p class=ql-align-justify>2、再有一个问题，要求查询员工人数大于1的部门。</p><p class=ql-align-justify>第一步，我们可以先查出每个部门的人数</p><p class=ql-align-justify>第二步，根据第一步的结果上进行筛选哪个部门员工人数大于1</p><pre>查询部门员工人数select count(*),deptNo from emp group by deptNo;</pre><p class=ql-align-justify>此时我们发现，根据原始表的字段，我们无法找出哪个部门的员工人数大于1，只能是根据分组之后的结果集进行筛选，此时添加条件不能在group by之前，否则会报错。</p><pre>mysql&gt; select count(*),deptNo  from emp  where count(*) &gt; 1  group by deptNo;ERROR 1111 (HY000): Invalid use of group function</pre><p class=ql-align-justify>是group by分组之后再筛选，所以条件也在group by 子句后面，也不能再用where，而是用关键词having</p><pre>mysql&gt; select count(*),deptNo  from emp  group by deptNo  having count(*) &gt; 1;+----------+--------+| count(*) | deptNo |+----------+--------+| 2 | 1 || 2 | 2 || 2 | 3 || 2 | 4 || 2 | 5 |+----------+--------+</pre><p class=ql-align-justify><strong>筛选条件在分组前添加还是在分组后添加，可以看它能不能使用原始表中的列来确定。</strong></p><pre>分组前 原始表字段，在group by前面，用where关键词，分组后 分组的结果集，在group by后面，用having关键词。</pre><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>如果用分组函数作条件，肯定是在group by后面。</strong></p><p class=ql-align-justify><strong>优先使用分组前筛选。</strong></p><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>按函数分组或者表达式分组</strong></p><p class=ql-align-justify>如按员工姓名的长度进行分组，查询每个长度的员工人数。</p><pre>mysql&gt; select count(*),length(ename)  from emp group by length(ename);+----------+---------------+| count(*) | length(ename) |+----------+---------------+| 4 | 4 || 1 | 5 || 3 | 6 || 1 | 7 || 1 | 8 |+----------+---------------+</pre><p class=ql-align-justify></p><p class=ql-align-justify><strong>按多个字段分组</strong></p><p class=ql-align-justify>如按部门、工作分组，查询员工数量</p><pre>mysql&gt; select count(*),deptNo,job  from emp  group by deptNo,job;+----------+--------+-------------+| count(*) | deptNo | job |+----------+--------+-------------+| 1 | 1 | accountant || 1 | 1 | auditor || 1 | 2 | cashier || 1 | 2 | operator || 1 | 3 | engineer || 1 | 3 | secretary || 1 | 4 | buyer || 1 | 4 | electrician || 1 | 5 | interpreter || 1 | 5 | janitor |+----------+--------+-------------+</pre><p class=ql-align-justify>有多个字段，加在group by后面用逗号分隔即可，两者值相同的字段才会分到一组中。字段在分组的顺序随意，没有要求。</p><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>添加排序</strong></p><p class=ql-align-justify>如查询每个部门的平均工资，按照降序排序</p><pre>mysql&gt; select avg(sal),deptNo  from emp  group by deptNo  order by avg(sal) desc;+-----------+--------+| avg(sal) | deptNo |+-----------+--------+| 4100.0000 | 2 || 4000.0000 | 4 || 4000.0000 | 1 || 3500.0000 | 5 || 3250.0000 | 3 |+-----------+--------+</pre><p class=ql-align-justify><strong>如果没有limit，order by 子句一定在查询语句的最后。</strong></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'MySQL','基础','组查询'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>