<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>美食图谱复现指南之依存句法分析 | 极客快訊</title><meta property="og:title" content="美食图谱复现指南之依存句法分析 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/d5962d33a0f546488eaca3acf9447c87"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/15e6d5d.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/15e6d5d.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/15e6d5d.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/15e6d5d.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/15e6d5d.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/15e6d5d.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/15e6d5d.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/15e6d5d.html><meta property="article:published_time" content="2020-10-29T21:05:58+08:00"><meta property="article:modified_time" content="2020-10-29T21:05:58+08:00"><meta name=Keywords content><meta name=description content="美食图谱复现指南之依存句法分析"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/15e6d5d.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>美食图谱复现指南之依存句法分析</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>文章转载自公众号</p><div class=pgc-img><img alt=美食图谱复现指南之依存句法分析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d5962d33a0f546488eaca3acf9447c87><p class=pgc-img-caption></p></div><p>牛衣古柳 ， 作者 古柳DesertsX</p><p class=ql-align-justify>本文代码开源在：DesertsX/gulius-projects</p><p class=ql-align-justify>哈工大语言云的官网有一篇名为《使用语言云分析微博用户饮食习惯》的文章，里面讲到了借助分词、词性标注和依存句法分析等NLP技术，可以从微博文本内容中提取出用户饮食习惯等数据。</p><p class=ql-align-justify>进而可以结合用户性别、地区、发微博时间等不同维度信息，展现出许多有趣的结果，比如下图分别是上海、重庆、以及广东（男性）的特色饮食习惯：</p><div class=pgc-img><img alt=美食图谱复现指南之依存句法分析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ef40561721f24f7fb1448c5ee33074a7><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>那么如何抽取出上述食物呢？原文给出了由三个条件组成的规则：<strong>一条微博里含有词语“吃”+与“吃”相关的句法关系为VOB（动宾关系）+“吃”的宾语为名词</strong>，就可以判断发生饮食行为，进而提取出“吃”的宾语就是相关的食物。</p><p class=ql-align-justify>作为解释，给出了三个例句：“我刚吃了一块巧克力”、“今天我去电影院看了浓情巧克力”、“我吃了个巧克力味冰淇淋”。</p><div class=pgc-img><img alt=美食图谱复现指南之依存句法分析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7d331fdda55c41df97d8d0757e45706e><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>句子经过分词，并在下方标注了词性，依存弧表明每个词语之间的关系，比如主谓关系（SBV）、动宾关系（VOB）等等。</p><p class=ql-align-justify>由上述规则可以判断出第二句没有饮食行为，于是进行过滤；而从另外两句中可以分别抽取出“巧克力”和“冰淇淋”（当然第三句更细粒度、更准确地应该是“巧克力味冰淇淋”，如何改进上面的规则，后面再提）。</p><p class=ql-align-justify>经过上面的介绍，看起来这条规则还蛮符合逻辑，应该能行的吧？但不知怎的脑海中突然浮现出张学友这张表情包，呼之欲出就是这句……</p><div class=pgc-img><img alt=美食图谱复现指南之依存句法分析 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/20e2ce9bf51d4f45b6f6c718cb3895ac><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>于是用语言云官方的在线演示试了下：出现“吃”这个字+与“吃”相关的有VOB动宾关系+宾语是名词“n”……过于完美地符合所有条件。</p><div class=pgc-img><img alt=美食图谱复现指南之依存句法分析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/adb6fb5e4807412b9f7a20f600d5c732><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>扯回来，总得来看，给出的判断逻辑还是靠谱的，那么该如何实现呢？“章口就莱”甩下一句：Talk is cheap. Show me the code. 然而翻遍原文也没找到实现代码。</p><div class=pgc-img><img alt=美食图谱复现指南之依存句法分析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/60a4c1f91148455491f9d5b26c8569a1><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>很早以前就看过这篇文章，一直不会，重新试了下，发现非常简单，果然是“难者不会，会者不难”，核心代码也就两行。</p><div class=pgc-img><img alt=美食图谱复现指南之依存句法分析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4e0f76e5331e47a09ab163a59dcb3c8c><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>以下是代码部分（本文代码开源在：DesertsX/gulius-projects），原本不必讲pip install pyltp这种基础安装第三方库的事，但因为windows下可能会出现Microsoft Visual C++等相关错误，所以建议参考：《哈工大自然语言处理ltp在windows10下的安装使用》一文的方案二，亲测可行。</p><div class=pgc-img><img alt=美食图谱复现指南之依存句法分析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4c4fe80692064872a59d3b5eb3930433><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>再是pyltp的入门介绍此处略过，看官方文档使用 pyltp一文就够了。</p><blockquote>pyltp 是 LTP 的 Python 封装，提供了分词，词性标注，命名实体识别，依存句法分析，语义角色标注的功能。</blockquote><p class=ql-align-justify>pyltp 安装成功，并下载好相应的 LTP 模型文件后，分别加载分词、词性标注和依存句法分析的模型。</p><pre class=ql-align-justify>import osfrom pyltp import SegmentorLTP_DATA_DIR = '/path/to/your/ltp_data' # ltp模型目录的路径# 加载分词模型cws_model_path = os.path.join(LTP_DATA_DIR, 'cws.model')segmentor = Segmentor()segmentor.load(cws_model_path)# 加载词性标注模型from pyltp import Postaggerpos_model_path = os.path.join(LTP_DATA_DIR, 'pos.model')postagger = Postagger()postagger.load(pos_model_path)# 加载依存句法分析模型from pyltp import Parserpar_model_path = os.path.join(LTP_DATA_DIR, 'parser.model')parser = Parser()parser.load(par_model_path)</pre><p class=ql-align-justify>对每个句子分别进行分词、词性标注和依存句法分析，并对分词后的每个词语依次提取依存弧的父节点id（Root 的 id 为0，其他按分词结果依次递增）、依存关系以及依存父节点对应的词语。最后写出进行饮食行为判断的核心代码即可。</p><pre class=ql-align-justify>def extract_food(sentence): words = segmentor.segment(sentence) print(" ".join(words)) postags = postagger.postag(words) for word, postag in zip(words, postags): print(word + '/'+ postag, end=' ') netags = recognizer.recognize(words, postags) arcs = parser.parse(words, postags) # 例句：我 刚 吃 了 一 块 巧克力 。 # 提取依存父节点id # 3, 3, 0, 3, 6, 7, 3, 3 rely_id = [arc.head for arc in arcs] # 提取依存关系 # ['SBV', 'ADV', 'HED', 'RAD', 'ATT', 'ATT', 'VOB', 'WP'] relation = [arc.relation for arc in arcs] # 匹配依存父节点词语 # ['吃', '吃', 'Root', '吃', '块', '巧克力', '吃', '吃'] heads = ['Root' if id==0 else words[id-1] for id in rely_id] print("\n") for i in range(len(words)): if postags[i] == 'n' and heads[i] == '吃' and relation[i] == 'VOB': print("找到了一种食物：" + words[i]) print("=" * 30) </pre><p class=ql-align-justify>对依存关系这部分还不太理解的可以看下此文：依存句法分析结果的输出怎么看</p><div class=pgc-img><img alt=美食图谱复现指南之依存句法分析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/adb6fb5e4807412b9f7a20f600d5c732><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>接着三个例句进行测试，结果和原文相符。</p><pre class=ql-align-justify>sentences = ['我刚吃了一块巧克力。', '今天我去电影院看了浓情巧克力。', '我吃了个巧克力味冰淇淋。']for sent in sentences: extract_food(sent)</pre><p class=ql-align-justify><br></p><div class=pgc-img><img alt=美食图谱复现指南之依存句法分析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/adb6fb5e4807412b9f7a20f600d5c732><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>以上算是简单复现了下这篇博客的思路。还有个问题就是，现实中大家讨论饮食的方式可能并不像例句中那么规整简单。</p><p class=ql-align-justify>以以前爬取的知乎想法里与“#好吃的杭州#”相关的言论为例（该话题知乎想法API），各种表述方式应有尽有，理想与现实的差距可见一斑。</p><div class=pgc-img><img alt=美食图谱复现指南之依存句法分析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b4c857beb11542b193e758d6eb561f0b><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>再者是复现的代码，对于食物宾语的提取逻辑过于简单，以致诸如“巧克力味冰淇淋”、“西湖醋鱼”等带有前缀修饰的词语都无法提取。当然宾语补全也能实现，此处暂且不表。</p><div class=pgc-img><img alt=美食图谱复现指南之依存句法分析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/90292b6fe4de40cd94598e983d0379bc><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>本文代码开源在：DesertsX/gulius-projects</p><p class=ql-align-justify>https://github.com/DesertsX/gulius-projects</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'图谱','句法分析','依存'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>