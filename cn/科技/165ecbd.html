<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>VBK系列——Excel中某个单元格的物理座标 | 极客快訊</title><meta property="og:title" content="VBK系列——Excel中某个单元格的物理座标 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/2a48edb10ed845d6b7f83b47b8284212"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/165ecbd.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/165ecbd.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/165ecbd.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/165ecbd.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/165ecbd.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/165ecbd.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/165ecbd.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/165ecbd.html><meta property="article:published_time" content="2020-10-29T20:58:37+08:00"><meta property="article:modified_time" content="2020-10-29T20:58:37+08:00"><meta name=Keywords content><meta name=description content="VBK系列——Excel中某个单元格的物理座标"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/165ecbd.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>VBK系列——Excel中某个单元格的物理座标</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>先舔一下Excel，当你想要某个特性，正在犹豫Excel会不会有呢，Excel已经迫不及待的点头：Yes。即使大部分人用一辈子电子表格都不会提及。</p><p>昨天想给Excel添加一个“额外的”聚光灯效果（这个真没有，Wps都有了，高版本未知），想要获取某个单元格的物理座标。，，，</p><p>==============正题============</p><h1 class=pgc-h-arrow-right>1、Excel 里面单元格的物理座标，是以表格里面 “A1” 单元格为原点的。（准确的是A1左上角那个点）<br>比如下图中E5的座标，需要参照A1获取，这样的好处是微软只需要测量到A1的座标，其他都是基于A1偏移的，可以通过计算可得。</h1><div class=pgc-img><img alt=VBK系列——Excel中某个单元格的物理座标 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2a48edb10ed845d6b7f83b47b8284212><p class=pgc-img-caption>图1</p></div><p><br></p><h1 class=pgc-h-arrow-right>2、注意是A1的左上角点，这个参照点是跟随“A1”跑的，即使A1被滚动到不见的位置。<br>不是你屏幕中看到的标题的交叉点。<br>即使A1被滚动顶到了屏幕之外，Excel仍然测量的是A1的座标，如图2中，A1座标为-1086 -228。<br>Excel中获取A1座标的方法：</h1><pre><code>Application.ActiveWindow.PointsToScreenPixelsX(0)   Application.ActiveWindow.PointsToScreenPixelsY(0)</code></pre><div class=pgc-img><img alt=VBK系列——Excel中某个单元格的物理座标 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4d0a92c07c224f34b25deda7de4b727b><p class=pgc-img-caption>图2</p></div><h1 class=pgc-h-arrow-right>3、如何获取“指定单元格”的偏移值呢<br>既然老妖前面提到了所得数据是“基于A1的偏移值”，怎么获取呢？以图3为例，我要获取E5的偏移值。<br>获取E5偏移值的方法：</h1><pre><code>Range("E5").left Range("E5").top</code></pre><div class=pgc-img><img alt=VBK系列——Excel中某个单元格的物理座标 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/645a32495e184ddfadffadb05d470c06><p class=pgc-img-caption>图3</p></div><h1 class=pgc-h-arrow-right>4、座标原点有了，偏移值有了，是不是直接加一下就可以了呢？<br>还不行，微软在记录这个偏移值的时候不是用的像素，用的是磅，很奇怪吧。所以需要换算。<br>第一步、磅转成英寸，好在excel本身提供这个转换，函数是英寸转磅，所以取个倒数即可。</h1><pre><code>磅转英寸=1/Application.InchesToPoints(1)</code></pre><p>第二步、英寸转像素点，这个涉及到屏幕大小、分辨率等等，好在windows有API可以取得</p><pre><code>hDC := DllCall("GetDC", Ptr, 0, Ptr)LPX := DllCall("GetDeviceCaps", Ptr, hDC, UInt,  0x58)  ;LOGPIXELSX   横向每英寸逻辑像素数量LPY := DllCall("GetDeviceCaps", Ptr, hDC, UInt,  0x5A)  ;LOGPIXELSY   纵向每英寸逻辑像素数量这是ahk的代码写法。</code></pre><p>第三步、excel的表格可能实施了缩放，比如75%、300%等等，这个缩放系数倒是简单</p><pre><code>applicaiton.ActiveWindow.Zoom</code></pre><p>第四步、综合计算一下看看</p><p>以X座标为例：</p><pre><code>A1的x座标+E5横向偏移值*zoom/100  * 磅转英寸 * 英寸转像素点</code></pre><p><br></p><div class=pgc-img><img alt=VBK系列——Excel中某个单元格的物理座标 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1a396b29b79d405ab8360e2f3c88f50c><p class=pgc-img-caption></p></div><p><br></p><p>附上完整代码，第一次对此挖掘，有错漏的欢迎交流指正</p><pre><code>F9::hDC1 := DllCall("GetDC", Ptr, 0, Ptr)logpixelsx := DllCall("GetDeviceCaps", Ptr, hDC1, UInt,  0x58)  ;LOGPIXELSXlogpixelsy := DllCall("GetDeviceCaps", Ptr, hDC1, UInt,  0x5A)  ;LOGPIXELSYDllCall("ReleaseDC", Ptr, 0, Ptr, hDC1)ox:=ox()         ;实际上就是官网Excel_Get函数，没有的请自行找一下，或者去群里问一下pointsPerInch    := ox.InchesToPoints(1)缩放及转换系数X  := (ox.ActiveWindow.Zoom/100)*logpixelsx/pointsPerInch          ; 缩放因子，zoom、ppi、逻辑缩放及转换系数Y  := (ox.ActiveWindow.Zoom/100)*logpixelsy/pointsPerInch;A1 座标  当前sheet的“A1”的座标，此为其他单元格的参照点，滚动上去不可见时，为负数、A1物理座标X  := ox.ActiveWindow.PointsToScreenPixelsX(0)   ; PointsToScreenPixelsX/Y(0)是工作表上单元格A1左上端座标系原点，以此为参照A1物理座标Y  := ox.ActiveWindow.PointsToScreenPixelsY(0)   ; 所以冻结情况下，显然会出问题，Excel的逻辑需要进一步了解;A1 座标  当前sheet的“A1”的座标，此为其他单元格的参照点，滚动上去不可见时，为负数、E5偏移值x := ox.Range("E5").left   ; PointsToScreenPixelsX/Y(0)是工作表上单元格A1左上端座标系原点，以此为参照E5偏移值y := ox.Range("E5").top   ; 所以冻结情况下，显然会出问题，Excel的逻辑需要进一步了解E5座标x:=A1物理座标X+E5偏移值x*缩放及转换系数XE5座标y:=A1物理座标y+E5偏移值y*缩放及转换系数ymsg:= "单元格A1的座标：`n==========A1`nX=" A1物理座标X "`tY=" A1物理座标Ymsg.= "`n单元格E5的座标：`n==========A1`nX=" E5座标x "`tY=" E5座标ymsg.= "`n单元格E5的座标偏移值：`n==========A1`nX=" E5偏移值x "`tY=" E5偏移值yToolTip %msg%</code></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'VBK','Excel','某个'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>