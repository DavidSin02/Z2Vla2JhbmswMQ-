<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>HashMapæ•°æ®ç»“æ„ä¸å·¥ä½œåŸç†æºç åˆ†æ | æå®¢å¿«è¨Š</title><meta property="og:title" content="HashMapæ•°æ®ç»“æ„ä¸å·¥ä½œåŸç†æºç åˆ†æ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/8ea640e8042c44c48174b9797067ede3"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/17b4d8df.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/17b4d8df.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/17b4d8df.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/17b4d8df.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/17b4d8df.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/17b4d8df.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/17b4d8df.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/17b4d8df.html><meta property="article:published_time" content="2020-10-29T21:09:20+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:20+08:00"><meta name=Keywords content><meta name=description content="HashMapæ•°æ®ç»“æ„ä¸å·¥ä½œåŸç†æºç åˆ†æ"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/17b4d8df.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>HashMapæ•°æ®ç»“æ„ä¸å·¥ä½œåŸç†æºç åˆ†æ</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><ul><li>HashMapçš„æ•°æ®ç»“æ„</li><li>HashMapçš„put å’Œget æ–¹æ³•æºç åˆ†æ</li><li>HashMapçš„é‡æ–°å“ˆå¸Œçš„æœºåˆ¶</li><li>JDK1.8 ä¹‹åä¸ºä»€ä¹ˆè¦è°ƒæ•´HashMapçš„æ•°æ®ç»“æ„</li></ul><h2 class=pgc-h-arrow-right>HashMapçš„æ•°æ®ç»“æ„</h2><p>åœ¨ç¼–ç¨‹é¢†åŸŸï¼Œå½“æ¶‰åŠåˆ°æ•°æ®å­˜å‚¨ï¼Œéƒ½ç¦»ä¸å¼€æ•°æ®ç»“æ„ï¼ŒHashMap ä½œä¸ºK,Vå½¢å¼å­˜å‚¨çš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡çœ‹å®ƒçš„æºç ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œå®ƒæ˜¯é€šè¿‡æ•°ç»„å’Œé“¾è¡¨æ¥å®ç°ï¼Œåœ¨JDK1.8 ä¹‹åå‡å¦‚åŠ å…¥çº¢é»‘æ ‘ç»„åˆï¼Œæ‰€ä»¥ç°åœ¨HashMap çš„æ•°æ®ç»“æ„æ˜¯æ•°æ®+é“¾è¡¨+çº¢é»‘æ ‘</p><p>HashMapå®é™…æ˜¯ä¸€ç§â€œæ•°ç»„+é“¾è¡¨â€æ•°æ®ç»“æ„ã€‚åœ¨putæ“ä½œä¸­ï¼Œé€šè¿‡å†…éƒ¨å®šä¹‰ç®—æ³•å¯»æ­¢æ‰¾åˆ°æ•°ç»„ä¸‹æ ‡ï¼Œå°†æ•°æ®ç›´æ¥æ”¾å…¥æ­¤æ•°ç»„å…ƒç´ ä¸­ï¼Œè‹¥é€šè¿‡ç®—æ³•å¾—åˆ°çš„è¯¥æ•°ç»„å…ƒç´ å·²ç»æœ‰äº†å…ƒç´ ï¼ˆä¿—ç§°hashå†²çªï¼Œé“¾è¡¨ç»“æ„å‡ºç°çš„å®é™…æ„ä¹‰ä¹Ÿå°±æ˜¯ä¸ºäº†è§£å†³hashå†²çªçš„é—®é¢˜ï¼‰ã€‚å°†ä¼šæŠŠè¿™ä¸ªæ•°ç»„å…ƒç´ ä¸Šçš„é“¾è¡¨è¿›è¡Œéå†ï¼Œå°†æ–°çš„æ•°æ®æ”¾åˆ°é“¾è¡¨æœ«å°¾</p><p>ä¸ºäº†éªŒè¯æ•°æ®ç»“æ„çš„æ­£ç¡®æ€§ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†é€šè¿‡æºç åˆ†ææ¥éªŒè¯</p><p></p><div class=pgc-img><img alt=HashMapæ•°æ®ç»“æ„ä¸å·¥ä½œåŸç†æºç åˆ†æ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8ea640e8042c44c48174b9797067ede3><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=HashMapæ•°æ®ç»“æ„ä¸å·¥ä½œåŸç†æºç åˆ†æ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c24e9453c2474bf8afd3cca886a20708><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=HashMapæ•°æ®ç»“æ„ä¸å·¥ä½œåŸç†æºç åˆ†æ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/522cc0efd1634b918a6ae0110311b8eb><p class=pgc-img-caption></p></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰Nodeå…ƒç´ çš„æ•°æ®ï¼ŒåŒæ—¶nodeæ˜¯ä¸€ä¸ªé“¾å¼ç»“æ„</p><p><strong>HashMap çš„åˆå§‹åŒ–æ–¹å¼æœ‰ä¸‰ç§</strong></p><pre><code>HashMap();//æ„é€ ä¸€ä¸ªå…·æœ‰é»˜è®¤åˆå§‹å®¹é‡ (16) å’Œé»˜è®¤åŠ è½½å› å­ (0.75) çš„ç©º HashMapã€‚HashMap(int initialCapacity);//æ„é€ ä¸€ä¸ªå¸¦æŒ‡å®šåˆå§‹å®¹é‡å’Œé»˜è®¤åŠ è½½å› å­ (0.75) çš„ç©º HashMapHashMap(int initialCapacity, float loadFactor);//æ„é€ ä¸€ä¸ªå¸¦æŒ‡å®šåˆå§‹å®¹é‡å’ŒåŠ è½½å› å­çš„ç©º HashMapHashMap(Map&lt;? extendsK,? extendsV&gt; m); //æ„é€ ä¸€ä¸ªæ˜ å°„å…³ç³»ä¸æŒ‡å®š Map ç›¸åŒçš„ HashMap</code></pre><h2 class=pgc-h-arrow-right>HashMap çš„put å’Œget æ–¹æ³•æºç åˆ†æ</h2><p><br></p><p><strong>put æ–¹æ³•</strong></p><pre><code>public V put(K key, V value) {    return putVal(hash(key), key, value, false, true);}/** * Implements Map.put and related methods * * @param hash hash for key * @param key the key * @param value the value to put * @param onlyIfAbsent  è¯¥å‚æ•°è¡¨ç¤ºæ˜¯å¦è¦†ç›–åŸæ¥çš„å€¼  * @param evict  è¿™é‡Œæ²¡æœ‰å®é™…æ„ä¹‰,LinkHashMapå°¾éƒ¨æ’å…¥æ‰æœ‰æ„ä¹‰ . * @return previous value, or null if none */final V putVal(int hash, K key, V value, boolean onlyIfAbsent,               boolean evict) {    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; // //å®šä¹‰å˜é‡tabæ˜¯å°†è¦æ“ä½œçš„Nodeæ•°ç»„å¼•ç”¨ï¼Œpè¡¨ç¤ºtabä¸Šçš„æŸNodeèŠ‚ç‚¹ï¼Œnä¸ºtabçš„é•¿åº¦ï¼Œiä¸ºtabçš„ä¸‹æ ‡    if ((tab = table) == null || (n = tab.length) == 0)  //åˆ¤æ–­å½“tableä¸ºnullæˆ–è€…tabçš„é•¿åº¦ä¸º0æ—¶ï¼Œå³tableå°šæœªåˆå§‹åŒ–ï¼Œæ­¤æ—¶é€šè¿‡resize()æ–¹æ³•å¾—åˆ°åˆå§‹åŒ–çš„table        n = (tab = resize()).length;     if ((p = tab[i = (n - 1) &amp; hash]) == null)    //æ­¤å¤„é€šè¿‡ï¼ˆn - 1ï¼‰ &amp; hash è®¡ç®—å‡ºçš„å€¼ä½œä¸ºtabçš„ä¸‹æ ‡iï¼Œå¹¶å¦pè¡¨ç¤ºtab[i]ï¼Œä¹Ÿå°±æ˜¯è¯¥é“¾è¡¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ä½ç½®ã€‚å¹¶åˆ¤æ–­pæ˜¯å¦ä¸ºnullã€‚        tab[i] = newNode(hash, key, value, null); //å½“pä¸ºnullæ—¶ï¼Œè¡¨æ˜tab[i]ä¸Šæ²¡æœ‰ä»»ä½•å…ƒç´ ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±newç¬¬ä¸€ä¸ªNodeèŠ‚ç‚¹ï¼Œè°ƒç”¨newNodeæ–¹æ³•è¿”å›æ–°èŠ‚ç‚¹èµ‹å€¼ç»™tab[i]ã€‚    else {//pä¸ä¸ºnullçš„æƒ…å†µï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼špä¸ºé“¾è¡¨èŠ‚ç‚¹ï¼›pä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹ï¼›pæ˜¯é“¾è¡¨èŠ‚ç‚¹ä½†é•¿åº¦ä¸ºä¸´ç•Œé•¿åº¦TREEIFY_THRESHOLDï¼Œå†æ’å…¥ä»»ä½•å…ƒç´ å°±è¦å˜æˆçº¢é»‘æ ‘äº†        Node&lt;K,V&gt; e; K k;        if (p.hash == hash &amp;&amp;            ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))//HashMapä¸­åˆ¤æ–­keyç›¸åŒçš„æ¡ä»¶æ˜¯keyçš„hashç›¸åŒï¼Œå¹¶ä¸”ç¬¦åˆequalsæ–¹æ³•ã€‚è¿™é‡Œåˆ¤æ–­äº†p.keyæ˜¯å¦å’Œæ’å…¥çš„keyç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™å°†pçš„å¼•ç”¨èµ‹ç»™e, HashMapä¸­å·²ç»å­˜åœ¨äº†keyï¼Œäºæ˜¯æ’å…¥æ“ä½œå°±ä¸éœ€è¦äº†ï¼Œåªè¦æŠŠåŸæ¥çš„valueè¦†ç›–å°±å¯ä»¥äº†            e = p;//è¿™é‡Œä¸ºä»€ä¹ˆè¦æŠŠpèµ‹å€¼ç»™eï¼Œè€Œä¸æ˜¯ç›´æ¥è¦†ç›–åŸå€¼å‘¢ï¼Ÿç­”æ¡ˆå¾ˆç®€å•ï¼Œç°åœ¨æˆ‘ä»¬åªåˆ¤æ–­äº†ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåé¢è¿˜å¯èƒ½å‡ºç°keyç›¸åŒï¼Œæ‰€ä»¥éœ€è¦åœ¨æœ€åä¸€å¹¶å¤„ç†ã€‚        else if (p instanceof TreeNode)            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value);       //ç°åœ¨å¼€å§‹äº†ç¬¬ä¸€ç§æƒ…å†µï¼Œpæ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè‚¯å®šæ’å…¥åä»ç„¶æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å¼ºåˆ¶è½¬å‹påè°ƒç”¨TreeNode.putTreeValæ–¹æ³•ï¼Œè¿”å›çš„å¼•ç”¨èµ‹ç»™e, è¿™é‡Œæ€ä¹ˆä¸éå†treeçœ‹çœ‹æœ‰æ²¡æœ‰keyç›¸åŒçš„èŠ‚ç‚¹å‘¢ï¼Ÿå…¶å®ï¼ŒputTreeValå†…éƒ¨è¿›è¡Œäº†éå†ï¼Œå­˜åœ¨ç›¸åŒhashæ—¶è¿”å›è¢«è¦†ç›–çš„TreeNodeï¼Œå¦åˆ™è¿”å›nullã€‚ else { //æ¥ä¸‹é‡Œå°±æ˜¯pä¸ºé“¾è¡¨èŠ‚ç‚¹çš„æƒ…å½¢ï¼Œä¹Ÿå°±æ˜¯ä¸Šè¿°è¯´çš„å¦å¤–ä¸¤ç±»æƒ…å†µï¼šæ’å…¥åè¿˜æ˜¯é“¾è¡¨/æ’å…¥åè½¬çº¢é»‘æ ‘ã€‚å¦å¤–ï¼Œä¸Šè¡Œè½¬å‹ä»£ç ä¹Ÿè¯´æ˜äº†TreeNodeæ˜¯Nodeçš„ä¸€ä¸ªå­ç±»ã€‚            for (int binCount = 0; ; ++binCount) {//æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè®¡æ•°å™¨æ¥è®¡ç®—å½“å‰é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°ï¼Œå¹¶éå†é“¾è¡¨ï¼ŒbinCountå°±æ˜¯è¿™ä¸ªè®¡æ•°å™¨                if ((e = p.next) == null) {                    p.next = newNode(hash, key, value, null);//éå†è¿‡ç¨‹ä¸­å½“å‘ç°p.nextä¸ºnullæ—¶ï¼Œè¯´æ˜é“¾è¡¨åˆ°å¤´äº†ï¼Œç›´æ¥åœ¨pçš„åé¢æ’å…¥æ–°çš„é“¾è¡¨èŠ‚ç‚¹ï¼Œå³æŠŠæ–°èŠ‚ç‚¹çš„å¼•ç”¨èµ‹ç»™p.nextï¼Œæ’å…¥æ“ä½œå°±å®Œæˆäº†ã€‚æ³¨æ„æ­¤æ—¶eèµ‹ç»™pã€‚æœ€åä¸€ä¸ªå‚æ•°ä¸ºæ–°èŠ‚ç‚¹çš„nextï¼Œè¿™é‡Œä¼ å…¥nullï¼Œä¿è¯äº†æ–°èŠ‚ç‚¹ç»§ç»­ä¸ºè¯¥é“¾è¡¨çš„æœ«ç«¯                    if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st                        treeifyBin(tab, hash);  //æ’å…¥æˆåŠŸåï¼Œè¦åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œå› ä¸ºæ’å…¥åé“¾è¡¨é•¿åº¦åŠ 1ï¼Œè€ŒbinCountå¹¶ä¸åŒ…å«æ–°èŠ‚ç‚¹ï¼Œæ‰€ä»¥åˆ¤æ–­æ—¶è¦å°†ä¸´ç•Œé˜ˆå€¼å‡1ã€‚å½“æ–°é•¿åº¦æ»¡è¶³è½¬æ¢æ¡ä»¶æ—¶ï¼Œè°ƒç”¨treeifyBinæ–¹æ³•ï¼Œå°†è¯¥é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚                    break;                }                if (e.hash == hash &amp;&amp;                    ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))                    break;//åœ¨éå†é“¾è¡¨çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¹‹å‰æåˆ°äº†ï¼Œæœ‰å¯èƒ½éå†åˆ°ä¸æ’å…¥çš„keyç›¸åŒçš„èŠ‚ç‚¹ï¼Œæ­¤æ—¶åªè¦å°†è¿™ä¸ªèŠ‚ç‚¹å¼•ç”¨èµ‹å€¼ç»™eï¼Œæœ€åé€šè¿‡eå»æŠŠæ–°çš„valueè¦†ç›–æ‰å°±å¯ä»¥äº†ã€‚è€æ ·å­åˆ¤æ–­å½“å‰éå†çš„èŠ‚ç‚¹çš„keyæ˜¯å¦ç›¸åŒã€‚                p = e;            }        }        if (e != null) { // existing mapping for key// é’ˆå¯¹å·²ç»å­˜åœ¨keyçš„æƒ…å†µåšå¤„ç†            V oldValue = e.value;            if (!onlyIfAbsent || oldValue == null)                e.value = value;//å‰é¢æåˆ°ï¼ŒonlyIfAbsentè¡¨ç¤ºå­˜åœ¨keyç›¸åŒæ—¶ä¸åšè¦†ç›–å¤„ç†ï¼Œè¿™é‡Œä½œä¸ºåˆ¤æ–­æ¡ä»¶ï¼Œå¯ä»¥çœ‹å‡ºå½“onlyIfAbsentä¸ºfalseæˆ–è€…oldValueä¸ºnullæ—¶ï¼Œè¿›è¡Œè¦†ç›–æ“ä½œã€‚ //è¦†ç›–æ“ä½œï¼Œå°†åŸèŠ‚ç‚¹eä¸Šçš„valueè®¾ç½®ä¸ºæ’å…¥çš„æ–°valueã€‚            afterNodeAccess(e); ã€€//è¿™ä¸ªå‡½æ•°åœ¨hashmapä¸­æ²¡æœ‰ä»»ä½•æ“ä½œï¼Œæ˜¯ä¸ªç©ºå‡½æ•°ï¼Œä»–å­˜åœ¨ä¸»è¦æ˜¯ä¸ºäº†linkedHashMapçš„ä¸€äº›åç»­å¤„ç†å·¥ä½œã€‚            return oldValue;        }    }    ++modCount; ã€€ //æ”¶å°¾å·¥ä½œï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¯¹keyç›¸åŒè€Œè¦†ç›–oldValueçš„æƒ…å†µï¼Œåœ¨å‰é¢å·²ç»returnï¼Œä¸ä¼šæ‰§è¡Œè¿™é‡Œï¼Œæ‰€ä»¥é‚£ä¸€ç±»æƒ…å†µä¸ç®—æ•°æ®ç»“æ„å˜åŒ–ï¼Œå¹¶ä¸æ”¹å˜modCountå€¼ã€‚    if (++size &gt; threshold)// åŒç†ï¼Œè¦†ç›–oldValueæ—¶æ˜¾ç„¶æ²¡æœ‰æ–°å…ƒç´ æ·»åŠ ï¼Œé™¤æ­¤ä¹‹å¤–éƒ½æ–°å¢äº†ä¸€ä¸ªå…ƒç´ ï¼Œè¿™é‡Œ++sizeå¹¶ä¸thresholdåˆ¤æ–­æ˜¯å¦è¾¾åˆ°äº†æ‰©å®¹æ ‡å‡†        resize();//å½“HashMapä¸­å­˜åœ¨çš„nodeèŠ‚ç‚¹å¤§äºthresholdæ—¶ï¼Œhashmapè¿›è¡Œæ‰©å®¹ã€‚    afterNodeInsertion(evict); ã€€//è¿™é‡Œä¸å‰é¢çš„afterNodeAccessåŒç†ï¼Œæ˜¯ç”¨äºlinkedHashMapçš„å°¾éƒ¨æ“ä½œï¼ŒHashMapä¸­å¹¶æ— å®é™…æ„ä¹‰ã€‚    return null;}</code></pre><p></p><p class=pgc-end-literature>HashMapæ ¹æ® (n - 1) & hash æ±‚å‡ºäº†å…ƒç´ åœ¨nodeæ•°ç»„çš„ä¸‹æ ‡ï¼Œä¸»è¦åˆ†ä¸‰ä¸ªé˜¶æ®µï¼šè®¡ç®—hashcodeã€é«˜ä½è¿ç®—å’Œå–æ¨¡è¿ç®—ã€‚</p><p class=pgc-end-literature>key.hashCode()è®¡ç®—å‡ºkeyçš„å“ˆå¸Œå€¼ï¼Œç„¶åå°†å“ˆå¸Œå€¼hå³ç§»16ä½ï¼Œå†ä¸åŸæ¥çš„håšå¼‚æˆ–^è¿ç®—ã€‚æ­£å¥½æ˜¯intç±»å‹32ä½å¯¹åŠã€‚å°†é«˜16ä½å’Œä½16ä½çš„ä¿¡æ¯"èåˆ"åˆ°ä¸€èµ·ï¼Œä¹Ÿç§°ä¸º"æ‰°åŠ¨å‡½æ•°"ã€‚è¿™æ ·æ‰èƒ½ä¿è¯hashå€¼æ‰€æœ‰ä½çš„æ•°å€¼ç‰¹å¾éƒ½ä¿å­˜ä¸‹æ¥è€Œæ²¡æœ‰é—æ¼ï¼Œä»è€Œä½¿æ˜ å°„ç»“æœå°½å¯èƒ½çš„æ¾æ•£ã€‚</p><p class=pgc-end-literature>å–æ¨¡è¿ç®—ï¼ŒHashMapæ•°ç»„ä¸‹æ ‡çš„è®¡ç®—æ–¹å¼ tab[(n - 1) & hash]ï¼Œn æ˜¯æ•°ç»„çš„é•¿åº¦ã€‚å…¶å®è¯¥ç®—æ³•çš„ç»“æœå’Œæ¨¡è¿ç®—çš„ç»“æœæ˜¯ç›¸åŒçš„ã€‚å¯¹CPUæ¥è¯´ï¼Œä½è¿ç®—æ˜¯æœ€å¿«çš„åŠ¨ä½œï¼Œé™¤æ³•å’Œæ±‚ä½™æ•°ï¼ˆæ¨¡è¿ç®—ï¼‰æ˜¯æœ€æ…¢çš„åŠ¨ä½œã€‚å½“næ˜¯2çš„Næ¬¡å¹‚çš„æ—¶å€™ã€‚Hash%n == ï¼ˆn-1ï¼‰& hashã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆHashMap çš„å®¹é‡å»ºè®®æ˜¯ 2çš„å¹‚æ¬¡æ–¹ã€‚hash ç®—æ³•çš„ç›®çš„æ˜¯ä¸ºäº†è®©hashå€¼å‡åŒ€çš„åˆ†å¸ƒåœ¨æ•°ç»„ä¸­ï¼Œå½“å®¹é‡åªä¸æ˜¯2çš„å¹‚æ¬¡æ–¹æ—¶ï¼Œä¼šå‘ç°ï¼Œæœ‰æ—¶å€™ä¼šå½¢æˆé•¿é“¾ï¼Œå½±å“è¯»å†™çš„æ€§èƒ½</p><p class=pgc-end-literature>å¦‚æœMapä¸­å·²æœ‰æ•°æ®çš„å®¹é‡è¾¾åˆ°äº†åˆå§‹å®¹é‡çš„ 75%ï¼Œé‚£ä¹ˆæ•£åˆ—è¡¨å°±ä¼šæ‰©å®¹ï¼Œè€Œæ‰©å®¹å°†ä¼šé‡æ–°å°†æ‰€æœ‰çš„æ•°æ®é‡æ–°æ•£åˆ—ï¼Œæ€§èƒ½æŸå¤±ä¸¥é‡ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å¿…é¡»è¦å¤§äºæˆ‘ä»¬é¢„è®¡æ•°æ®é‡çš„ 1.34 å€ã€‚</p><p><strong>get æ–¹æ³•åˆ†æ</strong></p><p>è®²å®Œputæ–¹æ³•ï¼Œgetæ–¹æ³•å…¶å®å¾ˆå®¹æ˜“ç†è§£</p><pre><code>public V get(Object key) {    Node&lt;K,V&gt; e;    return (e = getNode(hash(key), key)) == null ? null : e.value;}/** * Implements Map.get and related methods * * @param hash hash for key * @param key the key * @return the node, or null if none */final Node&lt;K,V&gt; getNode(int hash, Object key) {    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k;    if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;        (first = tab[(n - 1) &amp; hash]) != null) {	//æ ¹æ®è¾“å…¥çš„hashå€¼ï¼Œå¯ä»¥ç›´æ¥è®¡ç®—å‡ºå¯¹åº”çš„ä¸‹æ ‡ï¼ˆn - 1ï¼‰&amp; hash        if (first.hash == hash &amp;&amp; // always check first node            ((k = first.key) == key || (key != null &amp;&amp; key.equals(k))))//åˆ¤æ–­ç¬¬ä¸€ä¸ªå­˜åœ¨çš„èŠ‚ç‚¹çš„keyæ˜¯å¦å’ŒæŸ¥è¯¢çš„keyç›¸ç­‰ã€‚å¦‚æœç›¸ç­‰ï¼Œç›´æ¥è¿”å›è¯¥èŠ‚ç‚¹ã€‚            return first;        if ((e = first.next) != null) {            if (first instanceof TreeNode)//å½“è¿™ä¸ªtableèŠ‚ç‚¹ä¸Šå­˜å‚¨çš„æ˜¯çº¢é»‘æ ‘ç»“æ„æ—¶ï¼Œåœ¨æ ¹èŠ‚ç‚¹firstä¸Šè°ƒç”¨getTreeNodeæ–¹æ³•ï¼Œåœ¨å†…éƒ¨éå†çº¢é»‘æ ‘èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰åŒ¹é…çš„TreeNode                return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);            do {                if (e.hash == hash &amp;&amp;                    ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))    //å½“è¿™ä¸ªtableèŠ‚ç‚¹ä¸Šå­˜å‚¨çš„æ˜¯é“¾è¡¨ç»“æ„æ—¶ï¼ŒåŒæ ·çš„æ–¹å¼å»åˆ¤æ–­keyæ˜¯å¦ç›¸åŒã€‚  		return e;            } while ((e = e.next) != null);        }    }    return null;}</code></pre><p><br></p><h2 class=pgc-h-arrow-right>HashedMapçš„é‡æ–°æ‰©å®¹æœºåˆ¶</h2><p>é¦–å…ˆæˆ‘ä»¬æ˜ç™½ï¼Œresizeé‡æ–°æ‰©å®¹å°±æ˜¯å»ºç«‹ä¸€ä¸ªæ¯”åŸæ¥æ›´å¤§çš„æ•°ç»„æ¥å­˜å‚¨ã€‚</p><p>ç›´æ¥ä¸Šä»£ç </p><pre><code>final Node&lt;K,V&gt;[] resize() {    Node&lt;K,V&gt;[] oldTab = table;    int oldCap = (oldTab == null) ? 0 : oldTab.length;    int oldThr = threshold;    int newCap, newThr = 0;    if (oldCap &gt; 0) {        if (oldCap &gt;= MAXIMUM_CAPACITY) {            threshold = Integer.MAX_VALUE;            return oldTab;        }        else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp;                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)            newThr = oldThr &lt;&lt; 1; // double threshold    }    else if (oldThr &gt; 0) // initial capacity was placed in threshold        newCap = oldThr;    else {               // zero initial threshold signifies using defaults        newCap = DEFAULT_INITIAL_CAPACITY;        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);    }    if (newThr == 0) {        float ft = (float)newCap * loadFactor;        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ?                  (int)ft : Integer.MAX_VALUE);    }    threshold = newThr;// ä¸Šé¢çš„ä»£ç å¾ˆç®€å•ï¼Œæ€»ç»“æ¥è¯´ï¼Œ1ã€å½“HashMapåˆå§‹åŒ–æ—¶æŒ‡å®šæ•°æ®å¤§å°ä¸º16ï¼Œé˜ˆå€¼ä¸º16 * loadFactorï¼ˆè´Ÿè½½å› å­ï¼‰   2ã€å°†æ•°ç»„çš„å¤§å°æ‰©å¤§ä¸ºåŸæ¥2å€ï¼Œé˜ˆå€¼è®¾ç½®ä¸ºæ•°ç»„å¤§å°ä¹˜ä»¥ è´Ÿè½½å› å­ã€‚    @SuppressWarnings({"rawtypes","unchecked"})     Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap];    table = newTab;    if (oldTab != null) {        for (int j = 0; j &lt; oldCap; ++j) {// éå†åŸæ¥çš„æ•°ç»„            Node&lt;K,V&gt; e;            if ((e = oldTab[j]) != null) {                oldTab[j] = null; // å°†oldTab[j]=nullåªæ˜¯æ¸…é™¤æ—§è¡¨çš„å¼•ç”¨                if (e.next == null)		// å½“å‰å­˜å‚¨æ¡¶åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œç›´æ¥hashèµ‹å€¼åˆ°æ–°çš„æ•°ç»„ä¸Šå³å¯                    newTab[e.hash &amp; (newCap - 1)] = e;                else if (e instanceof TreeNode)		// å¦‚æœè¯¥å­˜å‚¨æ¡¶é‡Œé¢å­˜çš„æ˜¯çº¢é»‘æ ‘, åˆ™æ‹†åˆ†æ ‘                    ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap);                else { // preserve order		// ä»¥ä¸‹ä»£ç ä¸»è¦å°†ä¸€ä¸ªé“¾è¡¨æ‹†ä¸ºä¸¤ä¸ªé“¾è¡¨lo,hi                    Node&lt;K,V&gt; loHead = null, loTail = null;	// loé“¾è¡¨çš„å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹                    Node&lt;K,V&gt; hiHead = null, hiTail = null;	//  hié“¾è¡¨çš„å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹                    Node&lt;K,V&gt; next;                    do {// éå†å½“å‰å½“å‰å­˜å‚¨æ¡¶çš„é“¾è¡¨                        next = e.next;                        if ((e.hash &amp; oldCap) == 0) {	// (e.hash &amp; oldCap) == 0 ä½œä¸ºé“¾è¡¨æ‹†ä¸ºçš„æ¡ä»¶ï¼Œä¸ºä»€ä¹ˆä»¥è¯¥æ¡ä»¶ä½œä¸ºé“¾è¡¨æ‹†åˆ†æ¡ä»¶ï¼Œä¸‹æ–‡å†è¯¦è§£                            if (loTail == null)                                loHead = e;                            else                                loTail.next = e;                            loTail = e;                        }                        else {                            if (hiTail == null)                                hiHead = e;                            else                                hiTail.next = e;                            hiTail = e;                        }                    } while ((e = next) != null);	// é“¾è¡¨æ‹†åˆ†ä¹‹åï¼Œå°†loé“¾è¡¨èµ‹ç»™ newTab[j],å°†hié“¾è¡¨èµ‹ç»™newTab[j+oldCap], åˆ°è¿™é‡Œä½ åº”è¯¥ä¼šæœ‰ä¸‰ä¸ªç–‘æƒ‘ï¼Œ1ã€(e.hash &amp; oldCap) == 0ä¸ºä»€ä¹ˆä»¥è¿™ä¸ªæ¡ä»¶ä½œä¸ºé“¾è¡¨æ‹†åˆ†æ¡ä»¶ï¼Œ2ã€loï¼Œhié“¾è¡¨ä¸ºä»€ä¹ˆåˆ†åˆ«ä»¥j å’Œ j+oldCapä½œä¸ºä¸‹æ ‡               if (loTail != null) {                        loTail.next = null;                        newTab[j] = loHead;                    }                    if (hiTail != null) {                        hiTail.next = null;                        newTab[j + oldCap] = hiHead;                    }                }            }        }    }    return newTab;}</code></pre><p>å¯¹äºé“¾è¡¨æ‹†åˆ†ï¼Œæˆ‘ä»¬ä»¥ä¸‹é¢è¿™ä¸ªå›¾å¯èƒ½æ›´å¥½ç†è§£ç‚¹</p><p><strong></strong></p><div class=pgc-img><img alt=HashMapæ•°æ®ç»“æ„ä¸å·¥ä½œåŸç†æºç åˆ†æ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1923b2bcb56c4da6b80bd83068e46424><p class=pgc-img-caption></p></div><p><strong>(e.hash & oldCap) == 0 j ä»¥åŠ j+oldCap</strong></p><ol start=1><li>oldCapä¸€å®šæ˜¯2çš„æ•´æ•°æ¬¡å¹‚, è¿™é‡Œå‡è®¾æ˜¯2^m</li><li>newCapæ˜¯oldCapçš„ä¸¤å€, åˆ™ä¼šæ˜¯2^(m+1)</li><li>hashå¯¹æ•°ç»„å¤§å°å–æ¨¡(n - 1) & hash å…¶å®å°±æ˜¯å–hashçš„ä½mä½</li></ol><p>(16-1) & hash è‡ªç„¶å°±æ˜¯å–hashå€¼çš„ä½4ä½,æˆ‘ä»¬å‡è®¾å®ƒä¸º abcd.ä»¥æ­¤ç±»æ¨, å½“æˆ‘ä»¬å°†oldCapæ‰©å¤§ä¸¤å€å, æ–°çš„indexçš„ä½ç½®å°±å˜æˆäº† (32-1) & hash, å…¶å®å°±æ˜¯å– hashå€¼çš„ä½5ä½. é‚£ä¹ˆå¯¹äºåŒä¸€ä¸ªNode, ä½5ä½çš„å€¼æ— å¤–ä¹ä¸‹é¢ä¸¤ç§æƒ…å†µã€‚</p><pre><code>0abcd1abcd</code></pre><p>å…¶ä¸­, 0abcdä¸åŸæ¥çš„indexå€¼ä¸€è‡´, è€Œ1abcd = 0abcd + 10000 = 0abcd + oldCapæ•…è™½ç„¶æ•°ç»„å¤§å°æ‰©å¤§äº†ä¸€å€ï¼Œä½†æ˜¯åŒä¸€ä¸ªkeyåœ¨æ–°æ—§tableä¸­å¯¹åº”çš„indexå´å­˜åœ¨ä¸€å®šè”ç³»ï¼š è¦ä¹ˆä¸€è‡´ï¼Œè¦ä¹ˆç›¸å·®ä¸€ä¸ª oldCapã€‚</p><p>è€Œæ–°æ—§indexæ˜¯å¦ä¸€è‡´å°±ä½“ç°åœ¨hashå€¼çš„ç¬¬4ä½(æˆ‘ä»¬æŠŠæœ€ä½ä¸ºç§°ä½œç¬¬0ä½), æ€ä¹ˆæ‹¿åˆ°è¿™ä¸€ä½çš„å€¼å‘¢, åªè¦:</p><pre><code>hash &amp;Â 0000Â 0000Â 0000Â 0000Â 0000Â 0000Â 0001Â 0000</code></pre><p>ä¸Šå¼å°±ç­‰æ•ˆäº</p><pre><code>hashÂ &amp; oldCap</code></pre><p><strong>æ•…å¾—å‡ºç»“è®º:</strong></p><p>å¦‚æœ (e.hash & oldCap) == 0 åˆ™è¯¥èŠ‚ç‚¹åœ¨æ–°è¡¨çš„ä¸‹æ ‡ä½ç½®ä¸æ—§è¡¨ä¸€è‡´éƒ½ä¸º j<br>å¦‚æœ (e.hash & oldCap) == 1 åˆ™è¯¥èŠ‚ç‚¹åœ¨æ–°è¡¨çš„ä¸‹æ ‡ä½ç½® j + oldCap</p><ol start=1><li>resizeå‘ç”Ÿåœ¨tableåˆå§‹åŒ–, æˆ–è€…tableä¸­çš„èŠ‚ç‚¹æ•°è¶…è¿‡thresholdå€¼çš„æ—¶å€™, thresholdçš„å€¼ä¸€èˆ¬ä¸ºè´Ÿè½½å› å­ä¹˜ä»¥å®¹é‡å¤§å°.</li><li>æ¯æ¬¡æ‰©å®¹éƒ½ä¼šæ–°å»ºä¸€ä¸ªtable, æ–°å»ºçš„tableçš„å¤§å°ä¸ºåŸå¤§å°çš„2å€.</li><li>æ‰©å®¹æ—¶,ä¼šå°†åŸtableä¸­çš„èŠ‚ç‚¹re-hashåˆ°æ–°çš„tableä¸­, ä½†èŠ‚ç‚¹åœ¨æ–°æ—§tableä¸­çš„ä½ç½®å­˜åœ¨ä¸€å®šè”ç³»: è¦ä¹ˆä¸‹æ ‡ç›¸åŒ, è¦ä¹ˆç›¸å·®ä¸€ä¸ªoldCap(åŸtableçš„å¤§å°).</li></ol><h2 class=pgc-h-arrow-right>JDK1.8 ä¹‹åä¸ºä»€ä¹ˆè¦è°ƒæ•´HashMapçš„æ•°æ®ç»“æ„</h2><p>çº¢é»‘æ ‘è°ƒæ•´Hashapçš„ä¼˜ç‚¹</p><ol start=1><li>Â· æ·»åŠ æ—¶ï¼Œå½“æ¡¶ä¸­é“¾è¡¨ä¸ªæ•°è¶…è¿‡ 8 æ—¶ä¼šè½¬æ¢æˆçº¢é»‘æ ‘ï¼›</li><li>åˆ é™¤ã€æ‰©å®¹æ—¶ï¼Œå¦‚æœæ¡¶ä¸­ç»“æ„ä¸ºçº¢é»‘æ ‘ï¼Œå¹¶ä¸”æ ‘ä¸­å…ƒç´ ä¸ªæ•°å¤ªå°‘çš„è¯ï¼Œä¼šè¿›è¡Œä¿®å‰ªæˆ–è€…ç›´æ¥è¿˜åŸæˆé“¾è¡¨ç»“æ„ï¼›</li><li>æŸ¥æ‰¾æ—¶å³ä½¿å“ˆå¸Œå‡½æ•°ä¸ä¼˜ï¼Œå¤§é‡å…ƒç´ é›†ä¸­åœ¨ä¸€ä¸ªæ¡¶ä¸­ï¼Œç”±äºæœ‰çº¢é»‘æ ‘ç»“æ„ï¼Œæ€§èƒ½ä¹Ÿä¸ä¼šå·®</li></ol><p>å‚è€ƒ</p><p>https://segmentfault.com/a/1190000015812438</p><p>https://blog.csdn.net/hao134838/article/details/77653679</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'HashMap','æ•°æ®','ç»“æ„'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>