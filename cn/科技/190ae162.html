<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>å¦‚ä½•åœ¨ Go ä¸­å†™å‡ºé«˜æ•ˆçš„å•å…ƒæµ‹è¯• | æå®¢å¿«è¨Š</title><meta property="og:title" content="å¦‚ä½•åœ¨ Go ä¸­å†™å‡ºé«˜æ•ˆçš„å•å…ƒæµ‹è¯• - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/ed1aef2573fe45c582af69ef44638521"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/190ae162.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/190ae162.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/190ae162.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/190ae162.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/190ae162.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/190ae162.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/190ae162.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/190ae162.html><meta property="article:published_time" content="2020-11-14T20:59:18+08:00"><meta property="article:modified_time" content="2020-11-14T20:59:18+08:00"><meta name=Keywords content><meta name=description content="å¦‚ä½•åœ¨ Go ä¸­å†™å‡ºé«˜æ•ˆçš„å•å…ƒæµ‹è¯•"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/190ae162.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>å¦‚ä½•åœ¨ Go ä¸­å†™å‡ºé«˜æ•ˆçš„å•å…ƒæµ‹è¯•</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div class=pgc-img><img alt="å¦‚ä½•åœ¨ Go ä¸­å†™å‡ºé«˜æ•ˆçš„å•å…ƒæµ‹è¯•" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ed1aef2573fe45c582af69ef44638521><p class=pgc-img-caption></p></div><p>æœ¬å‘¨åœ¨å›¢é˜Ÿåšäº†ä¸€æ¬¡å…³äº Go å•å…ƒæµ‹è¯•çš„åˆ†äº«ï¼Œåˆ†äº«é¢˜ç›®ä¸ºã€ŠTesting in Go-how to write efficient unit testã€‹ã€‚</p><h2 class=pgc-h-arrow-right>å†…å®¹å¤§çº²</h2><ul><li>å•å…ƒæµ‹è¯•çš„é‡è¦æ€§</li><li>Go å•å…ƒæµ‹è¯•åŸºç¡€çŸ¥è¯†</li><li>è¡¨æ ¼æµ‹è¯•å’Œ HTTP æµ‹è¯•</li><li>å…¶å®ƒæµ‹è¯•æ¡†æ¶</li><li>å…¶å®ƒ Mock åº“</li><li>ä¸ Docker é›†æˆ</li></ul><h2 class=pgc-h-arrow-right>å•æµ‹çš„é‡è¦æ€§</h2><ul><li>èƒ½å¤Ÿå°½æ—©çš„å‘ç° bug</li><li>æ–¹ä¾¿ debugging</li><li>æ–¹ä¾¿ä»£ç é‡æ„</li><li>æå‡ä»£ç è´¨é‡</li><li>ä½¿æ•´ä¸ªè¿‡ç¨‹æ•æ·</li></ul><p>è®²è¿™éƒ¨åˆ†çš„ç›®çš„æ˜¯ä¸ºäº†è®©å›¢é˜Ÿè¾¾æˆå…±è¯†---<strong>å•æµ‹å¾ˆé‡è¦ï¼Œæˆ‘ä»¬å¿…é¡»è¦åšå¥½å•å…ƒæµ‹è¯•</strong>ã€‚</p><p><br></p><h2 class=pgc-h-arrow-right>Go å•æµ‹åŸºç¡€çŸ¥è¯†</h2><h3 class=pgc-h-arrow-right>åŸºæœ¬è§„åˆ™</h3><ul><li>é€šå¸¸æˆ‘ä»¬çš„å•å…ƒæµ‹è¯•ä»£ç éƒ½æ”¾åœ¨ä»¥ <strong>_test.go</strong> ç»“å°¾çš„æ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶ä¸€èˆ¬å’Œç›®æ ‡ä»£ç æ”¾åœ¨åŒä¸€ä¸ª package ä¸­ã€‚</li><li>æµ‹è¯•çš„æ–¹æ³•ä»¥ä¸º <strong>Test</strong> å¼€å¤´ï¼Œå¹¶ä¸”æ‹¥æœ‰å”¯ä¸€ä¸€ä¸ª <strong>*Testing.T </strong>çš„å‚æ•°<strong>ã€‚</strong></li></ul><h3 class=pgc-h-arrow-right>go test ä½¿ç”¨</h3><ul><li>go test æµ‹è¯•å½“å‰åŒ…</li><li>go test some/pkg æµ‹è¯•ä¸€ä¸ªç‰¹å®šçš„åŒ…</li><li>go test some/pkg/... é€’å½’æµ‹è¯•ä¸€ä¸ªç‰¹å®šåŒ…ä¸‹é¢çš„æ‰€æœ‰åŒ…</li><li>go test -v some/pkg -run ^TestSum$ æµ‹è¯•ç‰¹å®šåŒ…ä¸‹é¢çš„ç‰¹å®šæ–¹æ³•</li><li>go test -cover æŸ¥çœ‹å•æµ‹è¦†ç›–ç‡</li><li>go test -count=1 å¿½ç•¥ç¼“å­˜è¿è¡Œå•æµ‹ï¼Œæ³¨æ„å¦‚æœä»¥é€’å½’æ–¹å¼ï¼ˆ./...ï¼‰æµ‹è¯•çš„æ—¶å€™ï¼Œé»˜è®¤ä¼šä½¿ç”¨ cache</li></ul><h3 class=pgc-h-arrow-right>è¡¨æ ¼æµ‹è¯•</h3><ul><li>ä½¿ç”¨åŒ¿åç»“æ„ä½“æ‰¹é‡æ„å»ºè‡ªå·±çš„æµ‹è¯• case</li><li>é‡‡ç”¨å­æµ‹è¯•çš„æ–¹å¼è®©æµ‹è¯•è¾“å‡ºæ›´å‹å¥½</li></ul><pre><code>func TestIsIPV4WithTable(t *testing.T) {	testCases := []struct {		IP    string		valid bool	}{		{"", false},		{"192.168.0", false},		{"192.168.x.1", false},		{"192.168.0.1.1", false},		{"127.0.0.1", true},		{"192.168.0.1", true},		{"255.255.255.255", true},		{"120.52.148.118", true},	}	for _, tc := range testCases {		t.Run(tc.IP, func(t *testing.T) {			if IsIPV4(tc.IP) != tc.valid {				t.Errorf("IsIPV4(%s) should be %v", tc.IP, tc.valid)			}		})	}}</code></pre><h3 class=pgc-h-arrow-right>HTTP æµ‹è¯•</h3><ul><li>ä½¿ç”¨ httptest.NewRecorder æ¥æµ‹è¯• HTTP Handler è€Œä¸éœ€è¦çœŸæ­£è¿›è¡Œ HTTP ç›‘å¬</li><li>å¯ä»¥ä½¿ç”¨ errorReader æ¥æé«˜æµ‹è¯•è¦†ç›–ç‡</li></ul><pre><code>type errorReader struct{}func (errorReader) Read(p []byte) (n int, err error) {	return 0, errors.New("mock body error")}func TestLoginHandler(t *testing.T) {	testCases := []struct {		Name string		Code int		Body interface{}	}{		{"ok", 200, `{"code":"a@example.com", "password":"password"}`},		{"read body error", 500, new(errorReader)},		{"invalid format", 400, `{"code":1, "password":"password"}`},		{"invalid code", 400, `{"code":"a@example.com1", "password":"password"}`},		{"invalid password", 400, `{"code":"a@example.com", "password":"password1"}`},	}	for _, tc := range testCases {		t.Run(tc.Name, func(t *testing.T) {			var body io.Reader			if stringBody, ok := tc.Body.(string); ok {				body = strings.NewReader(stringBody)			} else {				body = tc.Body.(io.Reader)			}			req := httptest.NewRequest("POST", "http://example.com/foo", body)			w := httptest.NewRecorder()			LoginHandler(w, req)			resp := w.Result()			if resp.StatusCode != tc.Code {				t.Errorf("response code is invalid, expect=%d but got=%d",					tc.Code, resp.StatusCode)			}		})	}}</code></pre><p><br></p><p><strong>Go å•æµ‹åŸºç¡€çŸ¥è¯†</strong>è¿™éƒ¨åˆ†çš„å†…å®¹ä¸»è¦æ˜¯å‘å¤§å®¶è®²è§£ Go å®˜æ–¹å•æµ‹åº“ testing ä»¥åŠå‘½ä»¤è¡Œ go test çš„ä½¿ç”¨ã€‚</p><p><br></p><p>å¯ä»¥çœ‹åˆ°å®˜æ–¹è‡ªå¸¦çš„åº“å·²ç»è¶³å¤Ÿå¥½ç”¨ï¼Œ ä¸ä»…å¸¦æœ‰ subtest è¿˜æœ‰ httptest çš„ç›¸å…³å†…å®¹ï¼Œå¯¹äºä¸­å°å‹çš„é¡¹ç›®è€Œè¨€ä½¿ç”¨å®˜æ–¹çš„ testing åº“è¶³å¤Ÿã€‚</p><p><br></p><h2 class=pgc-h-arrow-right>å…¶å®ƒæµ‹è¯•æ¡†æ¶</h2><p><br></p><p>è™½ç„¶å®˜æ–¹ testing åº“è¶³å¤Ÿä¼˜ç§€ï¼Œä½†åœ¨ä¸€äº›è¾ƒå¤§é¡¹ç›®ä¸Šï¼Œå®ƒè¿˜æ˜¯æœ‰å¾ˆå¤šéœ€è¦å®Œå–„çš„åœ°æ–¹ï¼Œå¦‚ï¼š</p><ul><li>æ–­è¨€ä¸å¤Ÿå‹å¥½ï¼Œéœ€è¦é€šè¿‡å¤§é‡ if</li><li>æŒç»­é›†æˆä¸å¤Ÿï¼Œæ¯æ¬¡éƒ½è¦æ‰‹åŠ¨è·‘æµ‹è¯•</li><li>BDD æ— æ”¯æŒ</li><li>æµ‹è¯• case çš„æ–‡æ¡£è‡ªåŠ¨åŒ–ä¸å¤Ÿ</li></ul><p>æ‰€ä»¥æˆ‘è¿™é‡Œä»‹ç»äº†ä¸‰ç§æµ‹è¯•æ¡†æ¶ï¼Œé’ˆå¯¹ä»¥ä¸Šå‡ ç‚¹éƒ½æœ‰ä¸€å®šçš„æ”¹è¿›ã€‚</p><p><br></p><h3 class=pgc-h-arrow-right>Testify</h3><ul><li>å’Œ go test æ— ç¼é›†æˆï¼Œç›´æ¥ä½¿ç”¨è¯¥å‘½ä»¤è¿è¡Œ</li><li>æ”¯æŒæ–­è¨€ï¼Œå†™æ³•æ›´ç®€ä¾¿</li><li>æ”¯æŒ mocking</li><li>https://github.com/stretchr/testify ï¼ˆ10k+ å…³æ³¨ï¼‰</li></ul><pre><code>func TestIsIPV4WithTestify(t *testing.T) {	assertion := assert.New(t)	assertion.False(IsIPV4(""))	assertion.False(IsIPV4("192.168.0"))	assertion.False(IsIPV4("192.168.x.1"))	assertion.False(IsIPV4("192.168.0.1.1"))	assertion.True(IsIPV4("127.0.0.1"))	assertion.True(IsIPV4("192.168.0.1"))	assertion.True(IsIPV4("255.255.255.255"))	assertion.True(IsIPV4("120.52.148.118"))}</code></pre><p><br></p><h3 class=pgc-h-arrow-right>GoConvey</h3><ul><li>https://github.com/smartystreets/goconvey ï¼ˆ5k+ å…³æ³¨ï¼‰</li><li>æ”¯æŒ BDD</li><li>èƒ½å¤Ÿä½¿ç”¨ go test æ¥è¿è¡Œæµ‹è¯•</li><li>èƒ½å¤Ÿé€šè¿‡æµè§ˆå™¨æŸ¥çœ‹æµ‹è¯•ç»“æœ</li><li>è‡ªåŠ¨åŠ è½½æ›´æ–°</li></ul><pre><code>func TestIsIPV4WithGoconvey(t *testing.T) {	Convey("ip.IsIPV4()", t, func() {		Convey("should be invalid", func() {			Convey("empty string", func() {				So(IsIPV4(""), ShouldEqual, false)			})			Convey("with less length", func() {				So(IsIPV4("192.0.1"), ShouldEqual, false)			})			Convey("with more length", func() {				So(IsIPV4("192.168.1.0.1"), ShouldEqual, false)			})			Convey("with invalid character", func() {				So(IsIPV4("192.168.x.1"), ShouldEqual, false)			})		})		Convey("should be valid", func() {			Convey("loopback address", func() {				So(IsIPV4("127.0.0.1"), ShouldEqual, true)			})			Convey("extranet address", func() {				So(IsIPV4("120.52.148.118"), ShouldEqual, true)			})		})	})}</code></pre><p><br></p><h3 class=pgc-h-arrow-right>GinkGo</h3><ul><li>https://github.com/onsi/ginkgo ï¼ˆ4K+ å…³æ³¨ï¼‰</li><li>ä¹Ÿæ˜¯ä¸€ä¸ª BDD æµ‹è¯•æ¡†æ¶</li><li>èƒ½å¤Ÿä½¿ç”¨ go test</li><li>æœ‰è‡ªå·±çš„æ–­è¨€åº“ Gomega</li><li>ä¹Ÿæ”¯æŒè‡ªåŠ¨åŠ è½½æ›´æ–°</li></ul><pre><code>var _ = Describe("Ip", func() {	Describe("IsIPV4()", func() {		// fore content level prepare		BeforeEach(func() {			// prepare data before every case		})		AfterEach(func() {			// clear data after every case		})		Context("should be invalid", func() {			It("empty string", func() {				Expect(IsIPV4("")).To(Equal(false))			})			It("with less length", func() {				Expect(IsIPV4("192.0.1")).To(Equal(false))			})			It("with more length", func() {				Expect(IsIPV4("192.168.1.0.1")).To(Equal(false))			})			It("with invalid character", func() {				Expect(IsIPV4("192.168.x.1")).To(Equal(false))			})		})		Context("should be valid", func() {			It("loopback address", func() {				Expect(IsIPV4("127.0.0.1")).To(Equal(true))			})			It("extranet address", func() {				Expect(IsIPV4("120.52.148.118")).To(Equal(true))			})		})	})})func TestGinkgotesting(t *testing.T) {	RegisterFailHandler(Fail)	RunSpecs(t, "Ginkgotesting Suite")}</code></pre><h2 class=pgc-h-arrow-right>å…¶å®ƒ Mock åº“</h2><p><br></p><p>åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»æŒæ¡äº† Go å®˜æ–¹åº“ testing å’Œå…¶å®ƒå¸¸è§çš„æµ‹è¯•æ¡†æ¶çš„ç”¨æ³•ï¼Œèƒ½å¤Ÿæ–¹ä¾¿æˆ‘ä»¬ç¼–å†™å’Œè¿è¡Œå¸¸è§„çš„å•å…ƒæµ‹è¯•ã€‚</p><p><br></p><p>ä½†æˆ‘ä»¬çš„ç³»ç»Ÿå¾€å¾€æ¯”è¾ƒå¤æ‚ï¼Œä¾èµ–å¾ˆå¤šæœåŠ¡å’ŒåŸºç¡€ç»„å»ºï¼Œæ¯”å¦‚ä¸€ä¸ª Web æœåŠ¡å¾€å¾€ä¾èµ– MySQLã€Redis ç­‰ï¼Œè¿™é‡Œä¸»è¦è®²è§£é‡‡ç”¨æ¨¡æ‹Ÿï¼ˆmock-å±è”½æ‰è¿™äº›æœåŠ¡çš„å®é™…è°ƒç”¨ï¼‰çš„æ–¹å¼æ¥æµ‹è¯•æˆ‘ä»¬çš„ä»£ç é€»è¾‘ã€‚</p><p><br></p><h3 class=pgc-h-arrow-right>GoMock</h3><ul><li>https://github.com/golang/mock ï¼ˆ4k+ å…³æ³¨ï¼‰</li><li>golang å®˜æ–¹æ¨å‡ºçš„ mock åº“</li><li>é’ˆå¯¹æ¥å£è¿›è¡Œ mock</li><li>æ”¯æŒ mock å’Œ stub</li><li>é‡‡ç”¨ mockgen ç”Ÿæˆä»£ç </li></ul><pre><code>func TestPostIndexWithGoMock(t *testing.T) {	ctrl := gomock.NewController(t)	defer ctrl.Finish()	Convey("PostController.Index", t, func() {		Convey("should be 200", func() {			posts := []*post.PostModel{				{1, "title", "body"},				{2, "title2", "body2"},			}			m := NewMockPostService(ctrl)			m.				EXPECT().				List().				Return(posts, nil)			handler := post.PostController{				PostService: m,			}			req := httptest.NewRequest("GET", "http://example.com/foo", nil)			w := httptest.NewRecorder()			handler.Index(w, req)			So(w.Result().StatusCode, ShouldEqual, 200)		})		Convey("should be 500", func() {			m := NewMockPostService(ctrl)			m.				EXPECT().				List().				Return(nil, errors.New("list post with error"))			handler := post.PostController{				PostService: m,			}			req := httptest.NewRequest("GET", "http://example.com/foo", nil)			w := httptest.NewRecorder()			handler.Index(w, req)			So(w.Result().StatusCode, ShouldEqual, 500)		})	})}</code></pre><p><br></p><h3 class=pgc-h-arrow-right>HTTPMock</h3><ul><li>https://github.com/jarcoal/httpmock ï¼ˆ1K å…³æ³¨ï¼‰</li><li>é’ˆå¯¹ HTTP Request æ¥è¿›è¡Œ mocking</li><li>èƒ½å¤Ÿè‡ªå®šä¹‰ä»»æ„çš„ HTTP Response</li><li>æˆªæ­¢ HTTP Request ç›´æ¥è¿”å›è‡ªå®šä¹‰çš„ Response</li><li>ç»™äºˆæ­£åˆ™åŒ¹é…</li></ul><pre><code>func TestPostClientFetch(t *testing.T) {	httpmock.Activate()	defer httpmock.DeactivateAndReset()	postFetchURL := "https://api.mybiz.com/posts"	client := &amp;PostClient{		Client: &amp;http.Client{			Transport: httpmock.DefaultTransport,		},	}	Convey("PostClient.Fetch", t, func() {		Convey("without error", func() {			httpmock.RegisterResponder("GET", postFetchURL,				httpmock.NewStringResponder(200, `[{"id": 1, "title": "title", "body": "body"}]`))			items, err := client.Fetch(postFetchURL, 1)			So(len(items), ShouldEqual, 1)			So(err, ShouldEqual, nil)		})		Convey("with error", func() {			Convey("response data invalid", func() {				httpmock.RegisterResponder("GET", postFetchURL,					httpmock.NewStringResponder(200, `[{"id": "213"}]`))				items, err := client.Fetch(postFetchURL, 1)				So(items, ShouldBeEmpty)				So(err, ShouldNotBeNil)			})			Convey("without error", func() {				httpmock.RegisterResponder("GET", postFetchURL,					httpmock.NewStringResponder(500, `some error`))				items, err := client.Fetch(postFetchURL, 1)				So(items, ShouldBeEmpty)				So(err.Error(), ShouldContainSubstring, "some error")			})		})	})}</code></pre><p><br></p><h3 class=pgc-h-arrow-right>SQLMock</h3><ul><li>https://github.com/DATA-DOG/go-sqlmock ï¼ˆ2k+ å…³æ³¨ï¼‰</li><li>é’ˆå¯¹ database/sql çš„æ‰€æœ‰æ¥å£è¿›è¡Œ mock</li><li>åŸºäºæ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…</li><li>æ”¯æŒ æŸ¥è¯¢ã€æ›´æ–°ã€äº‹åŠ¡ç­‰mock</li></ul><pre><code>func TestPostDaoList(t *testing.T) {	db, mock, err := sqlmock.New()	if err != nil {		t.Fatalf("an error '%s' was not expected when opening a stub database connection", err)	}	defer db.Close()	Convey("PostDao.Fetch", t, func() {		dao := post.NewPostDao(db)		Convey("should be successful", func() {			rows := sqlmock.NewRows([]string{"id", "title", "body"}).				AddRow(1, "post 1", "hello").				AddRow(2, "post 2", "world")			mock.ExpectQuery("^SELECT (.+) FROM posts$").				WithArgs().WillReturnRows(rows)			items, err := dao.List()			So(items, ShouldHaveLength, 2)			So(err, ShouldBeNil)		})		Convey("should be failed", func() {			mock.ExpectQuery("^SELECT (.+) FROM posts$").				WillReturnError(fmt.Errorf("list post error"))			items, err := dao.List()			So(items, ShouldBeNil)			So(err.Error(), ShouldContainSubstring, "list post error")		})	})}</code></pre><h2 class=pgc-h-arrow-right>ä¸ Docker é›†æˆ</h2><p>è™½ç„¶æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ Mock çš„æ–¹å¼å±è”½æ‰æŸäº›æœåŠ¡ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨æŸäº›æœåŠ¡æ¯”è¾ƒå¤æ‚ï¼Œå¾ˆéš¾ mockï¼ˆå¦‚ MongoDBï¼‰ ï¼Œè€Œä¸”æœ‰æ—¶æˆ‘ä»¬ç¡®å®æƒ³å’Œä¾èµ–çš„æœåŠ¡åšæŸäº›é›†æˆæµ‹è¯•ã€‚</p><p><br></p><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç”¨ Docker æ¥å¿«é€Ÿæ„å»ºæˆ‘ä»¬çš„æµ‹è¯•ä¾èµ–ç¯å¢ƒï¼Œå¹¶ä¸”ç”¨å®Œå³é‡Šæ”¾ã€éå¸¸é«˜æ•ˆï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ªåŒ…å« MongoDB çš„ Dockerfileï¼š</p><pre><code>FROM ubuntu:16.04RUN apt-get update &amp;&amp; apt-get install -y libssl1.0.0 libssl-dev gccRUN mkdir -p /data/db /opt/go/ /opt/gopathCOPY mongodb/bin/* /usr/local/bin/ADD go /opt/goRUN cp /opt/go/bin/* /usr/local/bin/ENV GOROOT=/opt/go GOPATH=/opt/gopathWORKDIR /wsCMD mongod --fork --logpath /var/log/mongodb.log &amp;&amp; GOPROXY=off go test -mod=vendor ./...</code></pre><h2 class=pgc-h-arrow-right>æ€»ç»“</h2><p>æœ¬æ¬¡åˆ†äº«ä¸»è¦ä»å•å…ƒæµ‹è¯•çš„é‡è¦æ€§å…¥æ‰‹ï¼Œä¾æ¬¡è®²è§£äº†å®˜æ–¹åº“ testingã€ç¤¾åŒºæµ‹è¯•æ¡†æ¶ï¼ˆTestifyã€GoConveyã€GinkGoï¼‰ã€Mock ç›¸å…³æŠ€æœ¯ã€Docker é›†æˆçš„å†…å®¹ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š</p><ul><li>å•å…ƒæµ‹è¯•åº”è¯¥æ˜¯ä¸€ä¸ªå›¢é˜Ÿå…±è¯†</li><li>å•å…ƒæµ‹è¯•å¹¶ä¸éš¾</li><li>ä½¿ç”¨ Mock èƒ½å¤Ÿä½¿æˆ‘ä»¬å•å…ƒæµ‹è¯•é«˜æ•ˆ</li><li>åº”è¯¥é¢å‘æ¥å£ç¼–ç¨‹ï¼Œæ–¹ä¾¿åš mock ï¼ˆgomockï¼‰</li><li>å®˜æ–¹åº“è¶³å¤Ÿä¼˜ç§€ï¼ŒåŒ…å«è¡¨æ ¼æµ‹è¯•ã€http æµ‹è¯•ç›¸å…³å†…å®¹</li><li>ç¤¾åŒºæœ‰å¾ˆå¤šä¼˜ç§€æµ‹è¯•æ¡†æ¶ï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬æ›´å¥½çš„å®è·µ BDDæˆ–è€…TDD</li><li>Docker èƒ½å¤Ÿé€‚ç”¨äºæ›´å¤æ‚çš„æµ‹è¯•åœºæ™¯</li></ul><h2 class=pgc-h-arrow-right>å‚è€ƒ</h2><ul><li>https://github.com/songjiayang/gotesting</li><li>https://golang.org/pkg/testing</li><li>https://golang.org/pkg/cmd/go/internal/test</li><li>https://golang.org/pkg/testing/#hdr-Subtests_and_Sub_benchmarks</li><li>https://golang.org/pkg/net/http/httptest</li><li>https://github.com/stretchr/testify</li><li>https://github.com/onsi/ginkgo</li><li>https://en.wikipedia.org/wiki/Behavior-driven_development</li><li>https://github.com/onsi/gomega</li><li>https://github.com/smartystreets/goconvey</li><li>https://github.com/golang/mock</li><li>https://github.com/jarcoal/httpmock</li><li>https://github.com/DATA-DOG/go-sqlmock</li></ul><p>ä½œè€…ï¼š_whyå…ˆç”Ÿ</p><p>åŸæ–‡é“¾æ¥:ã€<strong>http://dwz.date/b2v3</strong>ã€‘ã€‚æ–‡ç« è½¬è½½è¯·è”ç³»ä½œè€…</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Go','ä¸­å†™','å•å…ƒ'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>