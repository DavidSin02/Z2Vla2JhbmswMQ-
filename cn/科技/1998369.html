<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Redis之虚拟内存 | 极客快訊</title><meta property="og:title" content="Redis之虚拟内存 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1998369.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1998369.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/1998369.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1998369.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1998369.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/1998369.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/1998369.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1998369.html><meta property="article:published_time" content="2020-10-29T20:59:04+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:04+08:00"><meta name=Keywords content><meta name=description content="Redis之虚拟内存"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/1998369.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Redis之虚拟内存</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><strong>【本文详细介绍了非关系型数据库Redis中虚拟内存的基本概念和配置方法，欢迎读者朋友们阅读、转发和收藏！】</strong></p><h1 class=pgc-h-arrow-right>1 基本概念</h1><h1 class=pgc-h-arrow-right>1.1 简介</h1><p>和大多 NoSQL 数据库一样， Redis 同样遵循了 Key/Value 数据存储模型。在有些情况下， Redis 会将 Keys/Values 保存在内存中以提高数据查询和数据修改的效率，然而这样的做法并非总是很好的选择。鉴于此，我们可以将之进一步优化，即尽量在内存中只保留 Keys 的数据，这样可以保证数据检索的效率，而 Values 数据在很少使用的时候则可以被换出到磁盘。</p><p>在实际的应用中，大约只有 10% 的 Keys 属于相对比较常用的键，这样 Redis 就可以通过虚存将其余不常用的 Keys 和 Values 换出到磁盘上，而一旦这些被换出的 Keys 或 Values 需要被读取时， Redis 则将其再次读回到主内存中。</p><h1 class=pgc-h-arrow-right>1.2 应用场景</h1><p>对于大多数数据库而言，最为理想的运行方式就是将所有的数据都加载到内存中，而之后的查询操作则可以完全基于内存数据完成。然而在现实中这样的场景却并不普遍，更多的情况则是只有部分数据可以被加载到内存中。</p><p>在 Redis 中，有一个非常重要的概念，即 keys 一般不会被交换，所以如果你的数据库中有大量的 keys ，其中每个 key 仅仅关联很小的 value ，那么这种场景就不是非常适合使用虚拟内存。如果恰恰相反，数据库中只是包含少量的 keys ，而每一个 key 所关联的 value 却非常大，那么这种场景对于使用虚存就再合适不过了。</p><p>在实际的应用中，为了能让虚存更为充分的发挥作用以帮助我们提高系统的运行效率，我们可以将带有很多较小值的 Keys 合并为带有少量较大值的 Keys 。其中最主要的方法就是将原有的 Key/Value 模式改为基于 Hash 的模式，这样可以让很多原来的 Keys 成为 Hash 中的属性。</p><h1 class=pgc-h-arrow-right>1.3 配置</h1><p>1). 在配置文件中添加以下配置项，以使当前 Redis 服务器在启动时打开虚存功能。</p><pre><code>vm-enabled yes</code></pre><p>2). 在配置文件中设定 Redis 最大可用的虚存字节数。如果内存中的数据大于该值，则有部分对象被换出到磁盘中，其中被换出对象所占用内存将被释放，直到已用内存小于该值时才停止换出。</p><pre><code>vm-max-memory (bytes)</code></pre><p>Redis 的交换规则是尽量考虑 " 最老 " 的数据，即最长时间没有使用的数据将被换出。如果两个对象的 age 相同，那么 Value 较大的数据将先被换出。需要注意的是， Redis 不会将 Keys 交换到磁盘，因此如果仅仅 keys 的数据就已经填满了整个虚存，那么这种数据模型将不适合使用虚存机制，或者是将该值设置的更大，以容纳整个 Keys 的数据。在实际的应用，如果考虑使用 Redis 虚拟内存，我们应尽可能的分配更多的内存交给 Redis 使用，以避免频繁的换入换出。</p><p>3). 在配置文件中设定页的数量及每一页所占用的字节数。为了将内存中的数据传送到磁盘上，我们需要使用交换文件。这些文件与数据持久性无关， Redis 会在退出前会将它们全部删除。由于对交换文件的访问方式大多为随机访问，因此建议将交换文件存储在固态磁盘上，这样可以大大提高系统的运行效率。</p><pre><code>vm-pages 134217728vm-page-size 32</code></pre><p>在上面的配置中， Redis 将交换文件划分为 vm-pages 个页，其中每个页所占用的字节为 vm-page-size ，那么 Redis 最终可用的交换文件大小为： vm-pages * vm-page-size 。由于一个 value 可以存放在一个或多个页上，但是一个页不能持有多个 value ，鉴于此，我们在设置 vm-page-size 时需要充分考虑 Redis 的该特征。</p><p>4). 在 Redis 的配置文件中有一个非常重要的配置参数，即：</p><pre><code>vm-max-threads 4</code></pre><p>该参数表示 Redis 在对交换文件执行 IO 操作时所应用的最大线程数量。通常而言，我们推荐该值等于主机的 CPU cores 。如果将该值设置为 0 ，那么 Redis 在与交换文件进行 IO 交互时，将以同步的方式执行此操作。</p><p>对于 Redis 而言，如果操作交换文件是以同步的方式进行，那么当某一客户端正在访问交换文件中的数据时，其它客户端如果再试图访问交换文件中的数据，该客户端的请求就将被挂起，直到之前的操作结束为止。特别是在相对较慢或较忙的磁盘上读取较大的数据值时，这种阻塞所带来的影响就更为突兀了。然而同步操作也并非一无是处，事实上，从全局执行效率视角来看，同步方式要好于异步方式，毕竟同步方式节省了线程切换、线程间同步，以及线程拉起等操作产生的额外开销。特别是当大部分频繁使用的数据都可以直接从主内存中读取时，同步方式的表现将更为优异。</p><p>如果你的现实应用恰恰相反，即有大量的换入换出操作，同时你的系统又有很多的 cores ，同时又不希望客户端在访问交换文件之前不得不阻塞一小段时间，那异步方式可能更适合于你的系统。至于最终选用哪种配置方式，最好的答案将来自于不断的实验和调优。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Redis','之虚拟','内存'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>