<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>SpringBoot应用多个子项目配置文件规划、多环境支持（一） | 极客快訊</title><meta property="og:title" content="SpringBoot应用多个子项目配置文件规划、多环境支持（一） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/d5249d1faf2741c8a538e35f13e04666"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/201295f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/201295f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/201295f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/201295f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/201295f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/201295f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/201295f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/201295f.html><meta property="article:published_time" content="2020-10-29T20:59:54+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:54+08:00"><meta name=Keywords content><meta name=description content="SpringBoot应用多个子项目配置文件规划、多环境支持（一）"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/201295f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>SpringBoot应用多个子项目配置文件规划、多环境支持（一）</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><strong>欢迎关注头条号：老顾聊技术</strong></p><p><strong>精品原创技术分享，知识的组装工</strong></p><h1 class=pgc-h-arrow-right>目录</h1><ol start=1><li>前言</li><li>项目规划</li><li>问题</li><li>配置子项目</li><li>spring.profiles.include</li><li>配置文件目录</li><li>多环境目录</li><li>多环境配置问题总结</li></ol><h1 class=pgc-h-arrow-right>前言</h1><p>我们在日常开发过程中，在新建一个项目中，我们经常会<strong>将一个项目按照功能性、模块等将一个项目分成多个子项目</strong>，这些<strong>子项目都包含在主项目</strong>中。</p><p>今天老顾就介绍<strong>企业应用</strong>中，<strong>分布式项目如何将配置分为开发环境、测试环境、预演环境、生产环境，对于不同的环境参数配置，如何处理？以及如何规划配置文件？</strong></p><h1 class=pgc-h-arrow-right>项目规划</h1><p>如一个电商系统，内部的核心系统架构，如下图</p><div class=pgc-img><img alt=SpringBoot应用多个子项目配置文件规划、多环境支持（一） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d5249d1faf2741c8a538e35f13e04666><p class=pgc-img-caption></p></div><p><strong>项目架构如下图</strong></p><p></p><div class=pgc-img><img alt=SpringBoot应用多个子项目配置文件规划、多环境支持（一） onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/dc68d411834544309fcc4c924d832c9c><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>问题</h1><p>在整个系统中，我们会<strong>配置数据库源的相关配置</strong>，如：</p><pre><code>#============数据源配置================spring:  datasource:    url: jdbc:mysql://127.0.0.1:3306/shop    username: root    password: 123456    driver-class-name: com.mysql.cj.jdbc.Driver</code></pre><p>还有<strong>dubbo微服务注册中心</strong>地址</p><pre><code>dubbo:  registry:     address: spring-cloud://127.0.0.1</code></pre><blockquote class=ql-long-13868411><p>上面的注册中心采用的是springcloud alibaba的nacos注册中心，这个不是重点</p></blockquote><p>因为整个系统中有<strong>很多微服务，都要用到数据源和注册中心地址</strong>；那通常做法就是把各个服务application.yml中进行配置，如：</p><div class=pgc-img><img alt=SpringBoot应用多个子项目配置文件规划、多环境支持（一） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/84cd4a98c66e42d3a4274bba5cd3cd8c><p class=pgc-img-caption></p></div><p>业务逻辑项目rb-business也会在它的application.yml中也会用到注册中心地址。</p><p><strong>那问题来了：</strong></p><blockquote class=ql-long-13868411><p>这么多子项目中各自都配置了数据源以及注册中心，显然不合理；万一地址变了，那所有的子项目都要进行更改</p></blockquote><p>那这么进行修改呢？</p><h1 class=pgc-h-arrow-right>配置子项目</h1><p>怎么解决上面的问题？就是再<strong>新建一个公共配置的子项目</strong>，把公共的配置放在配置子项目中，然后<strong>其他子项目引用这个公共配置子项目</strong></p><div class=pgc-img><img alt=SpringBoot应用多个子项目配置文件规划、多环境支持（一） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e59ae92fac45453faa5c438778ea7f7c><p class=pgc-img-caption></p></div><p>我们可以把<strong>数据库配置，redis配置参数、oss、sms等共同需要的配置写在里面</strong>，我们观察一些配置文件的名字的<strong>命名方式application-xxx.properties(也可以yml格式)</strong>；这个必须要准守，因为我们要利用一下springboot的机制。继续往下看。</p><h1 class=pgc-h-arrow-right>spring.profiles.include</h1><p>小伙伴有没有见过profiles.include呢？好像一直在用profiles.active。</p><p>SpringBoot能<strong>使用application- {你的自定义profile名称myProfileName} .properties模式添加任何你指定配置文件到其属性文件</strong>。</p><p>要加载特定的配置文件属性文件，我们可以使用<strong>命令行选项-Dspring.profiles.active = myProfileName。</strong></p><p>缺省<strong>默认SpringBoot是加载application.properties</strong>，无需任何-Dspring.profile.active选项。</p><blockquote class=ql-long-13868411><p>或使用-Dspring.profiles.active = default来加载。默认属性文件也可以命名为application-default.properties。</p></blockquote><p>默认配置文件application.properties中<strong>指定的任何属性将被你指定加载的配置文件中的的属性覆盖。</strong></p><p>也可以在application.properties中指定激活配置文件。</p><blockquote class=ql-long-13868411><p>spring.profiles.active=prod</p></blockquote><p>比如你有<strong>三个配置文件</strong>：</p><pre><code>src/main/resources/application.properties（默认的）src/main/resources/application-dev.properties（你指定的dev）src/main/resources/application-prod.properties（你指定的prod）</code></pre><p>如果在application.properties中有：</p><pre><code>spring.profiles.active=prod</code></pre><p>那么SpringBoot将加载application-prod.properties内容。</p><p>如果你在代码中使用配置文件中的变量：</p><pre><code>@Configurationpublic class UserBean {  @Value("${app.name}")  private String name;  @Value("${app.age}")  private int age;</code></pre><p>如果application-prod.properties和application.properties都有app.name和app.age，那么以prod中配置的值为主。</p><p><strong>spring.profile.include属性</strong></p><p>在application-prod.properties还可以加入</p><p><strong>spring.profiles.include=redis,db</strong></p><p>这是<strong>无条件地添加活动配置文件（以逗号分隔）</strong>。此属性添加的配置文件<strong>不会根据某些条件或命令行开关决定是否添加，而是始终无条件添加它们</strong>。</p><p>上述配置是就加载了：</p><pre><code>src/main/resources/application-redis.propertiessrc/main/resources/application-db.properties</code></pre><p>这两个配置文件中的内容。<strong>即使这些文件在其他子项目resources中，也可以被加载</strong></p><p>我们只需要<strong>在rb-user-server、rb-goods-server等引用项目中引用rb-common-config</strong>这个子项目。并且<strong>在项目中的application.yml配置文件中</strong>，加入</p><pre><code>spring:     profiles:    include:    - redis    - db    - nacos </code></pre><p>就可以引用rb-common-config中的配置文件了。</p><p>有些细心的小朋友会问，那个rb-common-config项目的配置文件是在resources目录下的config文件夹下的哦，<strong>怎么也会加载呢？</strong></p><h1 class=pgc-h-arrow-right>配置文件目录</h1><p>SpringBoot配置文件可以<strong>放置在多种路径下，不同路径下的配置优先级有所不同</strong>。</p><p><strong>可放置目录(优先级从高到低)</strong></p><blockquote class=ql-long-13868411><p>file:./config/ (当前项目路径config目录下);</p></blockquote><blockquote class=ql-long-13868411><p>file:./ (当前项目路径下);</p></blockquote><blockquote class=ql-long-13868411><p>classpath:/config/ (类路径config目录下);</p></blockquote><blockquote class=ql-long-13868411><p>classpath:/ (类路径config下).</p></blockquote><p><strong>优先级由高到底，高优先级的配置会覆盖低优先级的配置</strong>；</p><p><strong>SpringBoot会从这四个位置全部加载配置文件并互补配置；</strong></p><p>我们可以从ConfigFileApplicationListener这类便可看出，其中DEFAULT_SEARCH_LOCATIONS属性设置了加载的目录：</p><div class=pgc-img><img alt=SpringBoot应用多个子项目配置文件规划、多环境支持（一） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d073d4a1b5654e0ebb2ace58c8f8a0e2><p class=pgc-img-caption></p></div><p>所以之前的配置文件在config目录中也照样有效，而且优先级高一级哦。</p><p></p><p>到这里为止，我们很好的把公共的配置项，转移到子项目rb-common-config文件下了，其中的关键点就是，<strong>在引用项目加入spring.profiles.include配置</strong></p><h1 class=pgc-h-arrow-right>多环境配置</h1><p>在开发过程中，我们都会区分开发环境，测试环境，预演环境，生产环境等；不同环境的配置参数是不一样的。分布式项目中如何应用呢？</p><p>网上大多数介绍是针对单个项目工程的，<strong>利用上面介绍的spring.profiles.active配置来进行区分不同的环境</strong></p><pre><code>src/main/resources/application.properties（默认的）src/main/resources/application-dev.properties（开发环境）src/main/resources/application-prod.properties（生产环境）</code></pre><p>想要什么环境，在启动的时候</p><pre><code>java -jar xxx.jar --spring.profiles.active=prod</code></pre><p>上面就是应用了生产环境了。</p><p><strong>这种方式是否可以应用到分布式多项目中</strong>，也是可以的，我们可以把rb-common-config中也配置多个配置文件，如：</p><pre><code>src/main/resources/config/application-devDB.properties（开发环境）src/main/resources/config/application-devRedis.properties（开发环境）src/main/resources/config/application-prodDB.properties（生产环境）src/main/resources/config/application-prodRedis.properties（生产环境）</code></pre><p>然后在引用项目中如rb-user-server中</p><p><strong>application-dev.properties加入</strong></p><pre><code>spring.profiles.include=devDB,devRedis</code></pre><p><strong>application-prod.properties加入</strong></p><pre><code>spring.profiles.include=prodDB,prodRedis</code></pre><p><strong>启动rb-user-server.jar</strong></p><pre><code>java -jar rb-user-server.jar --spring.profiles.active=prod</code></pre><p>这样就做到了区分多环境的目的。</p><h1 class=pgc-h-arrow-right>多环境配置问题总结</h1><p>在上面的多环境配置中，我们需要在各个项目中，新建多个<strong>properties文件，</strong>区分不同的环境，这个是比较麻烦的事情，而且不够优雅。</p><p><strong>遗留问题一：</strong></p><p>那有没有一种方案，不需要建那么多的配置文件，每个项目只需要必须的配置文件就行了呢？</p><p><strong>遗留问题二：</strong></p><p>上面的方案中，涉及到了开发环境，测试环境，预演环境，生产环境，我们把各自环境的参数配置到各自的配置文件中。</p><p><strong>这里就出现了安全问题</strong>，<strong>数据库的连接地址，用户名与密码等直接暴露在开发人员面前</strong>；开发与测试环境安全要求低，还能接受；但是生产环境的相关服务器参数直接暴露在开发人员面前，那是很不安全的。那怎么处理呢？</p><p>上面遗留的问题，老顾在下一篇文章中，进行分享介绍，谢谢！！！</p><p><strong>---End---</strong></p><hr><div class=tt-column-card data-content='{"new_thumb_url": "http://sf3-ttcdn-tos.pstatp.com/img/pgc-image/9c2850b413da478abd6187d7705d657d", "title": "\u5fae\u670d\u52a1API\u7f51\u5173\u6846\u67b6", "url": "", "price": 199, "column_id": "6724549139599720712", "content": "", "author_description": "\u8001\u987e\u804a\u6280\u672f", "share_price": 47.76, "thumb_url": "http://p2.pstatp.com/large/pgc-image/9c2850b413da478abd6187d7705d657d", "sold": 10}'><p class=column-placeholder></p></div><blockquote class=ql-long-13868411><p>最近老顾上传了微服务网关的分享课程，请大家多多支持</p></blockquote><p><strong>推荐阅读</strong></p><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6809075773232644612/?group_id=6809075773232644612" rel="noopener noreferrer" target=_blank>dubbo如何处理业务异常，这个一定要知道哦！</a></p><p>1<strong>、</strong>基于RocketMq的SpringCloud Stream框架实战入门</p><p>2、如何搭建消息中间件应用框架之SpringCloud Stream</p><p>3<strong>、</strong>面试必备：网关异常了怎么办？如何做全局异常处理？</p><p>4<strong>、</strong>Gateway网关系列(二)：SpringCloud Gateway入门实战，路由规则</p><p>5<strong>、</strong>Gateway网关系列开篇：SpringCloud的官方网关Gateway介绍</p><p>6<strong>、</strong>API网关在微服务架构中的应用，这一篇就够了</p><p>7<strong>、</strong>学习Lambda表达式看这篇就够了，不会让你失望的哦（续篇）</p><p>8<strong>、</strong>Lambda用在哪里？几种场景？</p><p>9、为什么会出现Lambda表达式，你知道吗？</p><p>10、不说“分布式事务”理论，直接上大厂阿里的解决方案，绝对实用</p><p>11、女程序员问到这个问题，让我思考了半天，Mysql的“三高”架构</p><p>12、大厂二面：CAP原则为什么只能满足其中两项？而不能同时满足</p><p>13、阿里P7二面：聊聊零拷贝的原理</p><p>14、秒杀系统的核心点都在这里，快来取</p><p>15、你了解如何利用token方式实现分布式Session吗？</p><p>16、Mysql索引结构演变，为什么最终会是那个结构呢？让你一看就懂</p><p>17、一场比赛涉及到的知识，用通俗易通的方式介绍并发协调</p><p>18、企业实战Redis全方面思考，你思考了吗？</p><p>19、面试题：Thread的start和run的区别</p><p>20、面试题：什么是CAS？CAS的作用以及缺点</p><p>21、如何访问redis中的海量数据？避免事故产生</p><p>22、如何解决Redis热点问题？以及如何发现热点？</p><p>23、如何设计API接口，实现统一格式返回？</p><p>24、你真的知道在生产环境下如何部署tomcat吗？</p><p>25、分享一线互联网大厂分布式唯一ID设计 之 snowflake方案</p><p>26、分享大厂分布式唯一ID设计方案，快来围观</p><p>27、你想了解一线大厂的分布式唯一ID生成方案吗？</p><p>28、你知道如何处理大数据量吗？(数据拆分篇)</p><p>29、如何永不迁移数据和避免热点? 根据服务器指标分配数据量(揭秘篇)</p><p>30、你知道怎么分库分表吗？如何做到永不迁移数据和避免热点吗？</p><p>31、你了解大型网站的页面静态化吗？</p><p>32、你知道如何更新缓存吗？如何保证缓存和数据库双写一致性？</p><p>33、你知道怎么解决DB读写分离，导致数据不一致问题吗？</p><p>34、DB读写分离情况下，如何解决缓存和数据库不一致性问题？</p><p>35、你真的知道怎么使用缓存吗？</p><p>36、如何利用锁，防止缓存击穿？重构思想的重要性</p><p>37、海量订单产生的业务高峰期，如何避免消息的重复消费？</p><p>38、你知道如何保障生产端100%消息投递成功吗？</p><p>39、微服务下的分布式session该如何管理？</p><p>40、阿里二面：filter、interceptor、aspect应如何选择？很多人中招</p><p>41、互联网架构重要组员CDN，很多高级开发都没有实操过，来看这里</p><p>42、阿里二面：CDN缓存控制原理，看看能不能难住你</p><p>43、SpringCloud Alibaba之Nacos多环境多项目管理</p><p>44、SpringCloud Alibaba系列之Nacos配置中心玩法</p><p>45、SpringCloud Alibaba之Nacos注册中心</p><p>46、SpringCloud Plus版本之SpringCloud Alibaba</p><p>47、SpringCloud Alibaba之Nacos集群、持久化</p><p>48、SpringCloud Alibaba之Nacos共享配置、灰度配置</p><p>49、SpringCloud Alibaba之Sentinel工作原理</p><p>50、SpringCloud Alibaba之Sentinel流控管理</p><p>51、SpringCloud Alibaba之Sentinel降级管理</p><p>52、SpringCloud Alibaba之Sentinel热点参数限流</p><p>53、SpringCloud Alibaba之Sentinel的API实战</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'配置文件','SpringBoot','应用'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>