<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>MongoDB的学习，配置文件详解 | 极客快訊</title><meta property="og:title" content="MongoDB的学习，配置文件详解 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/ed9147df6e6d4da59bc0ae7bedb89737"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/20b9be5.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/20b9be5.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/20b9be5.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/20b9be5.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/20b9be5.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/20b9be5.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/20b9be5.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/20b9be5.html><meta property="article:published_time" content="2020-10-29T20:59:53+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:53+08:00"><meta name=Keywords content><meta name=description content="MongoDB的学习，配置文件详解"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/20b9be5.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>MongoDB的学习，配置文件详解</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>上一个篇幅介绍了mongodb的介绍和安装，接下来介绍mongodb的配置文件。</p><div class=pgc-img><img alt=MongoDB的学习，配置文件详解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ed9147df6e6d4da59bc0ae7bedb89737><p class=pgc-img-caption></p></div><p>bsondump:将bjson文档转化为json文档</p><p>mongo:客户端程序，连接MongoDB</p><p>mongod:服务端程序，启动MongoDB</p><p>mongodump:备份程序</p><p>mongoexport:数据导出程序</p><p>mongofiles:GridFS工具，内建的分布式文件系统</p><p>mongoimport:数据导入程序</p><p>mongooplog:mongodb的oplog</p><p>mongoperf:mongoperf是mongoDB自带工具，用于评估磁盘随机IO性能。</p><p>mongoreplay:一种工具能够把程序在现网上接收的所有网络包存储下来，然后在测试环境上将这个些存储的网络包进行重放，进行测试</p><p>mongorestore:数据恢复程序</p><p>mongos:数据分片程序，支持数据的横向扩展</p><p>mongostat:监视程序</p><p>mongotop:跟踪一个MongoDB的实例，查看哪些大量的时间花费在读取和写入数据</p><p>mongodb.conf：新建的mongodb的配置文件</p><p><br></p><p>mongodb.conf配置文件</p><pre><code>storage:    dbPath: "/usr/local/mongodb/mongodb-linux-x86_64-rhel70-3.4.10/data"systemLog:    destination: file    path: "/usr/local/mongodb/mongodb-linux-x86_64-rhel70-3.4.10/logs/mongodb.log"net:    port: 27022    http:        RESTInterfaceEnabled: trueprocessManagement:    fork: false</code></pre><p class=pgc-end-literature>官方配置文件文档：</p><p class=pgc-end-literature>https://docs.mongodb.com/manual/reference/configuration-options/</p><p><br></p><h1 class=pgc-h-arrow-right>storage配置项：</h1><pre><code>systemLog:   verbosity: &lt;int&gt;   quiet: &lt;boolean&gt;   traceAllExceptions: &lt;boolean&gt;   syslogFacility: &lt;string&gt;   path: &lt;string&gt;   logAppend: &lt;boolean&gt;   logRotate: &lt;string&gt;   destination: &lt;string&gt;   timeStampFormat: &lt;string&gt;   component:      accessControl:         verbosity: &lt;int&gt;      command:         verbosity: &lt;int&gt;</code></pre><p><strong>systemLog.verbosity：</strong>Type: integer，Default: 0</p><p>日志消息详细级别，范围是0到5，0是MongoDB的默认日志详细级别，其中包含参考消息。<br>1到5增加了详细程度，包含Debug消息。从版本4.2开始，MongoDB在日志消息中包括调试详细级别（1-5）。 例如，如果详细级别为2，则MongoDB记录D2。 在以前的版本中，MongoDB日志消息仅将Debug级别指定为D。</p><p><strong>systemLog.quiet：</strong>Type: boolean</p><p>以<strong>quiet</strong>模式运行mongos或mongod，以尝试限制输出量。不建议在生产系统中使用systemLog.quiet，因为它可能会使在特定连接期间的跟踪问题更加困难。</p><p><strong>systemLog.traceAllExceptions：</strong>Type: boolean</p><p>打印详细信息以进行调试， 用于支持排除相关故障的其他日志记录。</p><p><strong>systemLog.syslogFacility：</strong>Type: string，Default: user</p><p>将消息记录到syslog时使用的工具。 操作系统的syslog实现必须支持您指定的值。 要使用此选项，必须将systemLog.destination设置为syslog。</p><p><strong>systemLog.path：</strong>Type: string</p><p>mongod或mongos应该将所有诊断日志记录信息发送到的日志文件的路径，而不是标准输出或主机的syslog。 MongoDB在指定路径创建日志文件。</p><p><strong>systemLog.logAppend：</strong>Type: boolean，Default: false</p><p>如果为true，则mongos或mongod实例重新启动时，mongos或mongod会将新条目追加到现有日志文件的末尾。 如果没有此选项，mongod将备份现有日志并创建一个新文件。</p><p><strong>systemLog.logRotate：</strong>Type: string，Default: rename</p><p>日志 “回转”，防止一个日志文件特别大，则使用 logRotate 指令将文件 “回转”，可选值：</p><p>1.rename：重命名日志文件，默认值。</p><p>2.reopen：使用 linux 日志 rotate 特性，关闭并重新打开此日志文件，可以避免日志丢失，但是 logAppend 必须为 true。</p><p><strong>systemLog.destination：</strong>Type: string</p><p>日志输出目的地，可以指定为 “file” 或者“syslog”，表述输出到日志文件，如果不指定，则会输出到标准输出中（standard output）</p><p class=pgc-end-literature>注意：syslog守护程序在记录消息时（而不是在MongoDB发出消息时）生成时间戳。 这会导致误导日志条目的时间戳，尤其是在系统负载沉重的情况下。 我们建议对生产系统使用file选项，以确保准确的时间戳。</p><p><strong>systemLog.timeStampFormat：</strong>Type: string,Default: iso8601-local</p><p>日志消息中时间戳的时间格式。可选值：</p><p>ctime:显示时间格式为Wed Dec 31 18:17:54.811</p><p>iso8601-utc：以国际标准时间（UTC）以ISO-8601格式显示时间戳，1970-01-01T00:00:00.000Z</p><p>iso8601-local：以ISO-8601格式显示本地时间的时间戳，1969-12-31T19:00:00.000-0500</p><p><strong>systemLog.component配置选项</strong></p><pre><code>systemLog:   component:      accessControl:         verbosity: &lt;int&gt;      command:         verbosity: &lt;int&gt;      # COMMENT some component verbosity settings omitted for brevity      replication:         verbosity: &lt;int&gt;         election:            verbosity: &lt;int&gt;         heartbeats:            verbosity: &lt;int&gt;         initialSync:            verbosity: &lt;int&gt;         rollback:            verbosity: &lt;int&gt;      storage:         verbosity: &lt;int&gt;         journal:            verbosity: &lt;int&gt;         recovery:            verbosity: &lt;int&gt;      write:         verbosity: &lt;int&gt;</code></pre><p><strong>systemLog.component.accessControl.verbosity：</strong>Type: integer,Default: 0</p><p>与访问控制有关的组件的日志消息详细级别</p><p>详细级别的范围是0到5：<br>0是MongoDB的默认日志详细级别，其中包含参考消息。<br>1到5增加了详细程度，以包含Debug消息。</p><p><strong>除了accessControl，还有很多的组件都可以配置日志级别。在这里列出如下。</strong></p><p>command，control，ftdc(3.2版中的新功能)，geo，index，network，query，replication，</p><p>replication.election(4.2版中的新功能),replication.heartbeats(3.6版中的新功能),replication.initialSync</p><p>(4.2版中的新功能),replication.rollback(3.6版中的新功能)，storage，storage.journal，</p><p>storage.recovery(4.0版中的新功能)，transaction(4.0.2版中的新功能),write。</p><h1 class=pgc-h-arrow-right>processManagement配置块</h1><pre><code>processManagement:   fork: &lt;boolean&gt;   pidFilePath: &lt;string&gt;   timeZoneInfo: &lt;string&gt;</code></pre><p><strong>processManagement.fork：</strong>Type: boolean,Default: false</p><p>启用后台运行mongos或mongod进程的守护程序模式。 默认情况下，mongos或mongod不会作为守护程序运行：通常，您将通过使用processManagement.fork或使用处理守护进程的控制进程（例如，与upstart和systemd一起）将mongos或mongod作为守护程序运行。<br>Windows不支持processManagement.fork选项。<br>Linux程序包的初始化脚本不希望processManagement.fork更改为默认值。 如果使用Linux软件包并更改processManagement.fork，则必须使用自己的初始化脚本并禁用内置脚本。</p><p><strong>processManagement.pidFilePath：</strong>Type: string</p><p>指定文件位置来存储mongos或mongod进程的进程ID（PID）。 运行mongod或mongos进程的用户必须能够写入此路径。 如果未指定processManagement.pidFilePath选项，则该过程不会创建PID文件。 此选项通常仅与processManagement.fork设置结合使用才有用。</p><p><strong>processManagement.timeZoneInfo：</strong>Type: string</p><p>加载时区数据库的完整路径。 如果未提供此选项，则MongoDB将使用其内置时区数据库。<br>Linux和macOS软件包随附的配置文件默认将时区数据库路径设置为/usr/share/zoneinfo。<br>内置时区数据库是Olson/IANA时区数据库的副本。 它随MongoDB版本一起更新，但时区数据库的发布周期与MongoDB的发布周期不同。 可以从https://downloads.mongodb.org/olson_tz_db/timezonedb-latest.zip下载最新版本的时区数据库。</p><h1 class=pgc-h-arrow-right>cloud配置选项</h1><p>4.0版本的新功能</p><pre><code>cloud:   monitoring:      free:         state: &lt;string&gt;         tags: &lt;string&gt;</code></pre><p><strong>cloud.monitoring.free.state：</strong>Type: string</p><p>版本4.0中的新功能：适用于MongoDB社区版。<br>启用或禁用免费的MongoDB Cloud监视。 cloud.monitoring.free.state接受以下值：</p><ul><li>runtime：默认。 您可以在运行时启用或禁用免费监视。</li></ul><p class=pgc-end-literature>要在运行时启用或禁用免费监视，请参见db.enableFreeMonitoring()和db.disableFreeMonitoring()。<br>要在使用访问控制运行时在运行时启用或禁用免费监视，用户必须具有必需的特权。 有关详细信息，请参见</p><p class=pgc-end-literature>db.enableFreeMonitoring()和db.disableFreeMonitoring()。</p><ul><li>on：在启动时启用免费监视； 即注册免费监控。 在启动时启用后，您将无法在运行时禁用免费监视。</li><li>off：不管您先前是否注册了免费监视，都在启动时禁用免费监视。 如果在启动时禁用它，则无法在运行时启用免费监视。</li></ul><p>启用后，自由监视状态将保持启用状态，直到明确禁用为止。 也就是说，您不必在每次启动服务器时都重新启用。<br>有关相应的命令行选项，请参见--enableFreeMonitoring。</p><p><strong>cloud.monitoring.free.tags:</strong>Type: string</p><p>版本4.0中的新功能：适用于MongoDB社区版。<br>描述环境上下文的可选标签。 该标签可以在启动时作为免费的MongoDB Cloud监视注册的一部分发送。<br>有关相应的命令行选项，请参见--freeMonitoringTag。</p><h1 class=pgc-h-arrow-right>net配置选项</h1><pre><code>net:   port: &lt;int&gt;   bindIp: &lt;string&gt;   bindIpAll: &lt;boolean&gt;   maxIncomingConnections: &lt;int&gt;   wireObjectCheck: &lt;boolean&gt;   ipv6: &lt;boolean&gt;   unixDomainSocket:      enabled: &lt;boolean&gt;      pathPrefix: &lt;string&gt;      filePermissions: &lt;int&gt;   tls:      certificateSelector: &lt;string&gt;      clusterCertificateSelector: &lt;string&gt;      mode: &lt;string&gt;      certificateKeyFile: &lt;string&gt;      certificateKeyFilePassword: &lt;string&gt;      clusterFile: &lt;string&gt;      clusterPassword: &lt;string&gt;      CAFile: &lt;string&gt;      clusterCAFile: &lt;string&gt;      CRLFile: &lt;string&gt;      allowConnectionsWithoutCertificates: &lt;boolean&gt;      allowInvalidCertificates: &lt;boolean&gt;      allowInvalidHostnames: &lt;boolean&gt;      disabledProtocols: &lt;string&gt;      FIPSMode: &lt;boolean&gt;   compression:      compressors: &lt;string&gt;   serviceExecutor: &lt;string&gt;</code></pre><p><strong>在版本4.2中进行了更改：MongoDB 4.2弃用ssl选项，转而使用具有相同功能的tls选项。</strong></p><p><strong>net.port：</strong>Type: integer</p><p>Default:</p><p>27017：如果不是分片或者config服务成员，或者是mongos实例<br>27018：如果mongod是分片成员<br>27019： 如果mongod是config 服务器成员</p><p>MongoDB实例在其上侦听客户端连接的TCP端口。</p><p><strong>net.bindIp：</strong>Type: string,Default: localhost</p><p>从MongoDB 3.6开始，默认情况下mongos或mongod绑定到localhost。</p><p>mongos或mongod应该在其上侦听客户端连接的主机名,IP地址,完整的Unix域套接字路径。 您可以将mongos或mongod附加到任何接口。 要绑定到多个地址，请输入一个用逗号分隔的值的列表。</p><pre><code>localhost,/tmp/mongod.sock</code></pre><p>您可以指定IPv4和IPv6地址，也可以指定解析为IPv4或IPv6地址的主机名。</p><pre><code>localhost, 2001:0DB8:e132:ba26:0d5c:2774:e7f9:d513</code></pre><p>如果为net.bindIp指定IPv6地址或解析为IPv6地址的主机名，则必须以net.ipv6：true开头。</p><p><strong>net.bindIpAll：</strong>Type: boolean，Default: false</p><p>如果为true，则mongos或mongod实例绑定到所有IPv4地址（即0.0.0.0）。 如果mongos或mongod以net.ipv6:true开头，则net.bindIpAll也将绑定到所有IPv6地址（即::）。<br>net.bindIp和net.bindIpAll是互斥的。 同时指定两个选项会导致mongos或mongod抛出错误并终止。</p><p><strong>net.maxIncomingConnections：</strong>Type: integer,Default: 65536</p><p>mongos或mongod将接受的最大同时连接数。 如果此设置高于操作系统配置的最大连接跟踪阈值，则该设置无效。<br>请勿为此选项分配太低的值，否则在正常的应用程序操作过程中会遇到错误。<br>如果您的客户端创建多个连接并允许它们超时而不是关闭它们，则这对于mongos尤其有用。<br>在这种情况下，请将maxIncomingConnections设置为略高于客户端创建的最大连接数或连接池的最大的值。<br>此设置可防止mongos引起各个分片上的连接尖峰。 此类尖峰可能会破坏分片群集的操作和内存分配。</p><p><strong>net.wireObjectCheck：</strong>Type: boolean,Default: true</p><p>设置为true时，mongod或mongos实例会验证来自客户端的所有请求，以防止客户端将格式错误或无效的BSON插入MongoDB数据库。<br><strong>net.ipv6：</strong>Type: boolean,Default: false</p><p>将net.ipv6设置为true以启用IPv6支持。 mongos/mongod默认禁用IPv6支持。</p><p><br><strong>net.unixDomainSocke配置</strong></p><pre><code>net:   unixDomainSocket:      enabled: &lt;boolean&gt;      pathPrefix: &lt;string&gt;      filePermissions: &lt;int&gt;</code></pre><p><strong>net.unixDomainSocket.enabled：</strong>Type: boolean，Default: true</p><p>在UNIX域套接字上启用或禁用侦听。 net.unixDomainSocket.enabled仅适用于基于Unix的系统。<br>当net.unixDomainSocket.enabled为true时，mongos或mongod在UNIX套接字上侦听。<br>除非满足以下条件之一，否则mongos或mongod进程始终在UNIX套接字上侦听：</p><ul><li>net.unixDomainSocket.enabled为false</li><li>--nounixsocket已设置。 命令行选项优先于配置文件设置。</li><li>未设置net.bindIp</li><li>net.bindIp未指定localhost或其关联的IP地址</li></ul><p><strong>net.unixDomainSocket.pathPrefix：</strong>Type: string，Default: /tmp</p><p>UNIX套接字的路径。 net.unixDomainSocket.pathPrefix仅适用于基于Unix的系统。<br>如果此选项没有值，则mongos或mongod进程将创建一个以/ tmp为前缀的套接字。 除非满足以下条件之一，否则MongoDB会在UNIX套接字上创建并侦听：(同上)</p><p><strong>net.unixDomainSocket.filePermissions：</strong>Type: int,Default: 0700</p><p>设置UNIX域套接字文件的权限。net.unixDomainSocket.filePermissions仅适用于基于Unix的系统。<br><strong>net.http配置</strong></p><p>在3.6版中进行了更改：MongoDB 3.6删除了不推荐使用的net.http选项。 自3.2版以来，该选项已被弃用。</p><p>4.2版中的新增功能：tls选项提供的功能与以前的ssl选项相同。</p><pre><code>net:   tls:      mode: &lt;string&gt;      certificateKeyFile: &lt;string&gt;      certificateKeyFilePassword: &lt;string&gt;      certificateSelector: &lt;string&gt;      clusterCertificateSelector: &lt;string&gt;      clusterFile: &lt;string&gt;      clusterPassword: &lt;string&gt;      CAFile: &lt;string&gt;      clusterCAFile: &lt;string&gt;      CRLFile: &lt;string&gt;      allowConnectionsWithoutCertificates: &lt;boolean&gt;      allowInvalidCertificates: &lt;boolean&gt;      allowInvalidHostnames: &lt;boolean&gt;      disabledProtocols: &lt;string&gt;      FIPSMode: &lt;boolean&gt;</code></pre><p><strong>net.tls.mode</strong>：Type: string，</p><p>4.2版中的新功能。<br>启用用于所有网络连接的TLS。 net.tls.mode设置的参数可以是以下之一：</p><p>disabled：服务器不使用TLS</p><p>allowTLS：服务器之间的连接不使用TLS。 对于传入连接，服务器同时接受TLS和非TLS。</p><p>preferTLS：服务器之间的连接使用TLS。 对于传入连接，服务器同时接受TLS和非TLS。</p><p>requireTLS：服务器仅使用并接受TLS加密连接。</p><p>如果未指定--tlsCAFile或tls.CAFile并且未使用x.509身份验证，则在连接到启用TLS的服务器时将使用系统范围的CA证书存储。<br>如果使用x.509身份验证，则必须指定--tlsCAFile或tls.CAFile，除非使用--tlsCertificateSelector。<br>有关TLS和MongoDB的更多信息，请参阅为TLS/SSL和客户端的TLS/SSL配置配置mongod和mongos。</p><p><strong>net.tls.certificateKeyFile：</strong>Type: string</p><p>4.2版中的新增功能。.pem文件同时包含TLS证书和密钥。</p><p>从macOS或Windows上的MongoDB 4.0开始，您可以使用net.tls.certificateSelector设置从操作系统的安全证书存储而不是PEM密钥文件中指定证书。 certificateKeyFile和net.tls.certificateSelector是互斥的。 您只能指定一个。</p><ul><li>在Linux/BSD上，启用TLS时必须指定net.tls.certificateKeyFile。</li><li>在Windows或macOS上，启用TLS时，您必须指定net.tls.certificateKeyFile或net.tls.certificateSelector。</li></ul><p><strong>仅对于Windows，MongoDB 4.0和更高版本不支持加密的PEM文件。 如果mongod遇到加密的PEM文件，它将无法启动。 要在Windows上安全地存储和访问用于TLS的证书，请使用net.tls.certificateSelector。</strong></p><p><strong>net.tls.certificateKeyFilePassword：</strong>Type: string</p><p>版本4.2中的新功能：用于解密证书密钥文件（即certificateKeyFile）的密码。 仅当证书密钥文件已加密时，才使用net.tls.certificateKeyPassword选项。 在所有情况下，mongos或mongod都会从所有日志记录和报告输出中删除密码。</p><p><strong>net.tls.certificateSelector：</strong>Type: string</p><p>4.2版中的新增功能。Windows和macOS上可用，可以替代net.tls.certificateKeyFile。</p><p>指定证书属性，以便从操作系统的证书存储中选择匹配的证书以用于TLS/SSL。</p><p><strong>net.tls.clusterCertificateSelector：</strong>Type: string</p><p>4.2版中的新增功能：.pem文件包含用于群集或副本集成员身份验证的x.509证书密钥文件。</p><p><strong>net.tls.clusterPassword：</strong>Type: string</p><p>4.2版中的新增功能：用于解密使用--sslClusterFile指定的x.509证书密钥文件的密码。 仅当证书密钥文件已加密时，才使用net.tls.clusterPassword选项。 在所有情况下，mongos或mongod都会从所有日志记录和报告输出中删除密码。</p><p><strong>net.tls.CAFile:</strong>Type: string</p><p>4.2版中的新增功能：.pem文件包含来自证书颁发机构的根证书链。 使用相对或绝对路径指定.pem文件的文件名。</p><p><strong>net.tls.clusterCAFile:</strong>Type: string</p><p>版本4.2中的新增功能：.pem文件包含来自证书颁发机构的根证书链，该证书颁发机构用于验证建立连接的客户端提供的证书。 使用相对或绝对路径指定.pem文件的文件名。 net.tls.clusterCAFile要求设置net.tls.CAFile。</p><p><strong>net.tls.CRLFile：</strong>Type: string</p><p>4.2版中的新功能。<br>包含证书吊销列表的.pem文件。 使用相对或绝对路径指定.pem文件的文件名。</p><p>从MongoDB 4.0开始，您不能在macOS上指定net.tls.CRLFile。 请改用net.tls.certificateSelector。</p><p><strong>net.tls.allowConnectionsWithoutCertificates：</strong>Type: boolean</p><p>4.2版中的新功能。<br>对于不提供证书的客户端，mongos或mongod在建立连接时会绕过TLS/SSL证书验证。</p><p><strong>net.tls.allowInvalidCertificates:</strong>Type: string</p><p>4.2版中的新功能。<br>对群集中其他服务器上的TLS证书启用或禁用验证检查，并允许使用无效证书进行连接。</p><p><strong>net.tls.allowInvalidHostnames：</strong>Type: boolean,Default: false</p><p>当net.tls.allowInvalidHostnames为true时，MongoDB禁用TLS证书中主机名的验证，如果其证书的主机名与指定的主机名不匹配，则允许mongod连接到MongoDB实例。</p><p><strong>net.tls.disabledProtocols：</strong>Type: string</p><p>4.2版中的新功能。<br>防止运行TLS的MongoDB服务器接受使用一个或多个特定协议的传入连接。 要指定多个协议，请使用逗号分隔的协议列表。<br>net.tls.disabledProtocols可以识别以下协议：TLS1_0，TLS1_1，TLS1_2，以及版本4.0.4（和3.6.9）以及TLS1_3。</p><p><strong>net.tls.FIPSMode：</strong>Type: boolean</p><p>4.2版中的新功能。<br>为mongos或mongod启用或禁用TLS库的FIPS模式。 您的系统必须具有FIPS兼容库才能使用net.tls.FIPSMode选项。</p><p><strong>兼容FIPS的TLS/SSL仅在MongoDB Enterprise中可用。 有关更多信息，请参阅为FIPS配置MongoDB。</strong></p><p><strong>net.ssl配置</strong></p><p><strong class=highlight-text>从4.2开始不推荐使用所有SSL选项。 请使用TLS对应项，因为它们具有与SSL选项相同的功能。 不建议使用SSL协议，MongoDB支持TLS 1.0和更高版本。</strong></p><h1 class=pgc-h-arrow-right>security配置</h1><pre><code>security:   keyFile: &lt;string&gt;   clusterAuthMode: &lt;string&gt;   authorization: &lt;string&gt;   transitionToAuth: &lt;boolean&gt;   javascriptEnabled:  &lt;boolean&gt;   redactClientLogData: &lt;boolean&gt;   clusterIpSourceWhitelist:     - &lt;string&gt;   sasl:      hostName: &lt;string&gt;      serviceName: &lt;string&gt;      saslauthdSocketPath: &lt;string&gt;   enableEncryption: &lt;boolean&gt;   encryptionCipherMode: &lt;string&gt;   encryptionKeyFile: &lt;string&gt;   kmip:      keyIdentifier: &lt;string&gt;      rotateMasterKey: &lt;boolean&gt;      serverName: &lt;string&gt;      port: &lt;string&gt;      clientCertificateFile: &lt;string&gt;      clientCertificatePassword: &lt;string&gt;      clientCertificateSelector: &lt;string&gt;      serverCAFile: &lt;string&gt;   ldap:      servers: &lt;string&gt;      bind:         method: &lt;string&gt;         saslMechanisms: &lt;string&gt;         queryUser: &lt;string&gt;         queryPassword: &lt;string&gt;         useOSDefaults: &lt;boolean&gt;      transportSecurity: &lt;string&gt;      timeoutMS: &lt;int&gt;      userToDNMapping: &lt;string&gt;      authz:         queryTemplate: &lt;string&gt;      validateLDAPServerConfig: &lt;boolean&gt;</code></pre><p><strong>security.keyFile：</strong>Type: string</p><p>密钥文件的路径，该密钥文件用于存储MongoDB实例用于在分片群集或副本集中相互进行身份验证的共享密钥。 keyFile表示security.authorization。</p><p><strong>security.clusterAuthMode：</strong>Type: string,Default: keyFile</p><p>用于集群认证的认证方式。 如果您使用内部x.509身份验证，请在此处指定。</p><p><strong>security.authorization：</strong>Type: string，Default: disabled</p><p>启用或禁用基于角色的访问控制（RBAC），以控制每个用户对数据库资源和操作的访问。</p><p><strong>security.transitionToAuth：</strong>Type: boolean，Default: false</p><p>3.4版中的新增功能：允许mongod或mongos接受并创建与部署中其他mongod和mongos实例之间的经过身份验证和未经身份验证的连接。 用于执行副本集或分片群集从无身份验证配置到内部身份验证的滚动过渡。 需要指定内部身份验证机制，例如security.keyFile。</p><p><strong>security.javascriptEnabled：</strong>Type: boolean，Default: true</p><p>启用或禁用服务器端JavaScript执行。 禁用后，您将无法使用执行JavaScript代码在服务器端执行的操作，例如$where查询运算符，mapReduce命令和db.collection.mapReduce()方法。</p><p><strong>security.redactClientLogData:</strong>Type: boolean</p><p>3.4版的新功能：仅在MongoDB Enterprise中可用。<br>运行了security.redactClientLogData的mongod会在记录之前编辑伴随给定日志事件的任何消息。 这样可以防止mongod或mongos将存储在数据库中的潜在敏感数据写入诊断日志。 错误或操作代码，行号和源文件名等元数据仍在日志中可见。</p><p><strong>security.clusterIpSourceWhitelist</strong>Type: list</p><p>mongod验证IP地址/CIDR（无类域间路由）范围的列表，mongod以此范围验证来自副本集其他成员（如果是分片群集的一部分）的mongos实例的身份验证请求。 mongod验证原始IP是否在列表中显示或属于列表中的CIDR范围。 如果IP地址不存在，则服务器不会对mongod或mongos进行身份验证。</p><p><strong>Key Management Configuration</strong></p><pre><code>security:   enableEncryption: &lt;boolean&gt;   encryptionCipherMode: &lt;string&gt;   encryptionKeyFile: &lt;string&gt;   kmip:      keyIdentifier: &lt;string&gt;      rotateMasterKey: &lt;boolean&gt;      serverName: &lt;string&gt;      port: &lt;string&gt;      clientCertificateFile: &lt;string&gt;      clientCertificatePassword: &lt;string&gt;      clientCertificateSelector: &lt;string&gt;      serverCAFile: &lt;string&gt;</code></pre><p><strong>security.enableEncryption：</strong>Type: boolean，Default: false</p><p>3.2版中的新增功能：为WiredTiger存储引擎启用加密。 您必须设置为true才能传递加密密钥和配置。</p><p><strong>security.encryptionCipherMode: </strong>Type: string,Default: AES256-CBC</p><p>3.2版中的新功能。<br>用于静态加密的密码模式</p><p><strong>security.encryptionKeyFile：</strong>Type: string</p><p>3.2版中的新功能。<br>通过除KMIP之外的其他进程管理密钥时，本地密钥文件的路径。 仅在通过KMIP以外的进程管理密钥时设置。 如果数据已使用KMIP加密，则MongoDB将引发错误。</p><p><strong>security.kmip.keyIdentifier：</strong>Type: string</p><p>KMIP服务器中现有密钥的唯一KMIP标识符。 包括将与标识符关联的密钥用作系统密钥。 您只能在首次为mongod实例启用加密时使用该设置。 要求security.enableEncryption为true。</p><p><strong>security.kmip.rotateMasterKey：</strong>Type: boolean，Default: false</p><p>3.2版中的新功能。<br>如果为true，请旋转主密钥并重新加密内部密钥库。</p><p><strong>security.kmip.serverName：</strong>Type: string</p><p>3.2版中的新功能。<br>运行KMIP服务器的密钥管理解决方案的主机名或IP地址。 要求security.enableEncryption为true。</p><p><strong>security.kmip.port：</strong>Type: string，Default: 5696</p><p>3.2版中的新功能。<br>KMIP服务器正在侦听的端口号。 要求提供security.kmip.serverName。 要求security.enableEncryption为true。</p><p><strong>security.kmip.clientCertificateFile：</strong>Type: string</p><p>3.2版中的新功能。<br>字符串，包含用于向MongoDB验证KMIP服务器的客户端证书的路径。 要求提供security.kmip.serverName。</p><p><strong>security.kmip.clientCertificatePassword：</strong>Type: string</p><p>3.2版中的新功能。<br>用来解密客户端证书的密码（即security.kmip.clientCertificateFile），用于向KMIP服务器认证MongoDB。 仅当证书已加密时才使用该选项。</p><p><strong>security.kmip.clientCertificateSelector：</strong>Type: string</p><p>4.0版中的新增功能：Windows和macOS上可用，可替代security.kmip.clientCertificateFile。<br>security.kmip.clientCertificateFile和security.kmip.clientCertificateSelector选项是互斥的。 您只能指定一个。</p><p><strong>security.kmip.serverCAFile：</strong>Type: string</p><p>3.2版中的新功能。<br>CA文件的路径。 用于验证与KMIP服务器的安全客户端连接。</p><h1 class=pgc-h-arrow-right>setParameter配置</h1><p>setParameter<br>设置一个或多个MongoDB服务器参数中描述的参数<br>要在YAML配置文件中设置参数，请使用以下格式：</p><pre><code>setParameter:   &lt;parameter1&gt;: &lt;value1&gt;   &lt;parameter2&gt;: &lt;value2&gt;</code></pre><pre><code>#在配置文件中指定enableLocalhostAuthBypass：setParameter:   enableLocalhostAuthBypass: false</code></pre><h1 class=pgc-h-arrow-right>storage配置项</h1><pre><code>storage:   dbPath: &lt;string&gt;   indexBuildRetry: &lt;boolean&gt;   journal:      enabled: &lt;boolean&gt;      commitIntervalMs: &lt;num&gt;   directoryPerDB: &lt;boolean&gt;   syncPeriodSecs: &lt;int&gt;   engine: &lt;string&gt;   wiredTiger:      engineConfig:         cacheSizeGB: &lt;number&gt;         journalCompressor: &lt;string&gt;         directoryForIndexes: &lt;boolean&gt;         maxCacheOverflowFileSizeGB: &lt;number&gt;      collectionConfig:         blockCompressor: &lt;string&gt;      indexConfig:         prefixCompression: &lt;boolean&gt;   inMemory:      engineConfig:         inMemorySizeGB: &lt;number&gt;</code></pre><p><strong>storage.dbPat：</strong>Type: string<strong></strong></p><p>Default:</p><ul><li>/data/db on Linux and macOS</li><li>\data\db on Windows</li></ul><p><strong>storage.indexBuildRetry：</strong>Type: boolean，Default: true</p><p>指定mongod在下次启动时是否重建不完整的索引。 这适用于mongod在关闭或在索引构建过程中停止后重新启动的情况。 在这种情况下，mongod总是删除所有不完整的索引，然后默认情况下尝试重建它们。 要阻止mongod重建索引，请将此选项设置为false。</p><p><strong>storage.journal.enabled：</strong>Type: boolean</p><p>默认值：在64位系统上为true，在32位系统上为false<br>启用或禁用耐久性日志，以确保数据文件保持有效和可恢复。 仅当您指定storage.dbPath设置时，此选项才适用。 mongod默认情况下启用日记功能。</p><p><strong>storage.journal.commitIntervalMs：</strong>Type: number，Default: 100</p><p>mongod进程在两次日记操作之间允许的最长时间（以毫秒为单位）。 取值范围是1到500毫秒。 较低的值会增加日志的持久性，但会降低磁盘性能。</p><p><strong>storage.directoryPerDB：</strong>Type: boolean,Default: false</p><p>如果为true，则MongoDB使用单独的目录存储每个数据库的数据。 这些目录位于storage.dbPath目录下，每个子目录名称都与数据库名称相对应。</p><p><strong>storage.syncPeriodSecs：</strong>Type: number，Default: 60</p><p>MongoDB通过fsync操作将数据刷新到数据文件之前可以经过的时间。</p><p><strong>storage.engine：</strong>Default: wiredTiger</p><p>从4.2版开始，MongoDB删除不推荐使用的MMAPv1存储引擎。</p><p>mongod数据库的存储引擎。 可用值包括：inMemory/wiredTiger</p><p>如果您尝试使用storage.dbPath启动一个mongod，该path包含由storage.engine指定的存储引擎以外的其他存储引擎生成的数据文件，mongod将拒绝启动。</p><h1 class=pgc-h-arrow-right>operationProfiling配置项</h1><pre><code>operationProfiling:   mode: &lt;string&gt;   slowOpThresholdMs: &lt;int&gt;   slowOpSampleRate: &lt;double&gt;</code></pre><p><strong>operationProfiling.mode：</strong>Type: string，Default: off</p><p>指定应分析哪些操作。 提供以下探查器级别：</p><p>off：探查器已关闭，并且不收集任何数据。 这是默认的探查器级别。</p><p>slowOp：探查器收集的数据花费的时间长于慢速值。</p><p>all：探查器收集所有操作的数据。</p><p><strong>operationProfiling.slowOpThresholdMs：</strong>Type: integer，Default: 100</p><p>慢速操作时间阈值（以毫秒为单位）。 运行时间超过此阈值的操作被认为是缓慢的。</p><p><strong>operationProfiling.slowOpSampleRate：</strong>Type: double,Default: 1.0</p><h3 class=pgc-h-arrow-right>应当分析或记录的慢速操作的一部分。 operationProfiling.slowOpSampleRate接受0到1之间的值（包括0和1）。</h3><h1 class=pgc-h-arrow-right>replication配置项</h1><pre><code>replication:   oplogSizeMB: &lt;int&gt;   replSetName: &lt;string&gt;   enableMajorityReadConcern: &lt;boolean&gt;</code></pre><p><strong>replication.oplogSizeMB</strong></p><p>复制操作日志（即oplog）的最大大小（以兆字节为单位）。</p><p>从MongoDB 4.0开始，操作日志可以超过其配置的大小限制，以避免删除多数提交点。</p><p>默认情况下，mongod进程基于最大可用空间量创建操作日志。 对于64位系统，操作日志通常是可用磁盘空间的5％。<br>mongod首次创建oplog后，更改Replication.oplogSizeMB选项将不会影响oplog的大小。<br>要更改正在运行的副本集成员的操作日志大小，请使用replSetResizeOplog管理命令。 replSetResizeOplog使您能够动态调整操作日志的大小，而无需重新启动mongod进程。<br></p><p><strong>replication.replSetName：</strong>Type: string</p><p>mongod所属的副本集的名称。 副本集中的所有主机必须具有相同的集名称。<br>如果您的应用程序连接到多个副本集，则每个副本集应具有不同的名称。 某些驱动程序通过副本集名称对副本集连接进行分组。<br>Replication.replSetName设置仅适用于mongod。</p><p>从MongoDB 4.0开始：<br>1.设置Replication.replSetName不能与storage.indexBuildRetry一起使用。<br>replication.enableMajorityReadConcern对于WiredTiger存储引擎，storage.journal.enabled:false不能与Replication.replSetName一起使用。</p><p><strong>replication.enableMajorityReadConcern:</strong>Default: true</p><p>从MongoDB 3.6开始，默认情况下，MongoDB启用“majority”的read concern的支持。<br></p><h1 class=pgc-h-arrow-right>sharding配置项</h1><pre><code>sharding:   clusterRole: &lt;string&gt;   archiveMovedChunks: &lt;boolean&gt;</code></pre><p><strong>sharding.clusterRole：</strong>Type: string</p><p>mongod实例在分片群集中的角色。 将此设置设置为以下之一：</p><ul><li>configsvr：启动此实例作为配置服务器。 默认情况下，该实例从端口27019开始。</li><li>shardsvr：启动此实例作为分片。 默认情况下，该实例从端口27018开始。</li></ul><p><strong>设置sharding.clusterRole要求mongod实例与复制一起运行。 要将实例部署为副本集成员，请使用replSetName设置并指定副本集的名称。</strong></p><p><strong>sharding.archiveMovedChunks：</strong>Type: boolean</p><p>在3.2版中进行了更改：从3.2版开始，MongoDB使用false作为默认值。<br>在块迁移期间，分片不会保存从该分片迁移的文档。</p><p>具体可以查看官方文档：https://docs.mongodb.com/manual/reference/configuration-options/</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'配置文件','MongoDB','学习'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>