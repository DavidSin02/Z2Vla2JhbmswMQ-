<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>80%的人都不知道伺服电机远程控制如何实现的 | 极客快訊</title><meta property="og:title" content="80%的人都不知道伺服电机远程控制如何实现的 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/f1bda1d478b140da81754007e1433147"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/21d0f607.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/21d0f607.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/21d0f607.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/21d0f607.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/21d0f607.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/21d0f607.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/21d0f607.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/21d0f607.html><meta property="article:published_time" content="2020-11-14T20:59:29+08:00"><meta property="article:modified_time" content="2020-11-14T20:59:29+08:00"><meta name=Keywords content><meta name=description content="80%的人都不知道伺服电机远程控制如何实现的"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/21d0f607.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>80%的人都不知道伺服电机远程控制如何实现的</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>私信“干货”二字，即可领取138G伺服与机器人专属及电控资料！</h1><p class=ql-align-justify>本文针对伺服电机远程控制接线复杂性、单一性、不稳定性等问题，提出采用开放式通信协议DS301、驱动子协议DSP402实现伺服电机控制的新方法。</p><div class=pgc-img><img alt=80%的人都不知道伺服电机远程控制如何实现的 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f1bda1d478b140da81754007e1433147><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center><strong>前 言</strong></p><p>CANopen是一种架构在控制局域网路(CAN)上的高层通讯协定，包括通讯子协定及设备子协定常在嵌入式系统中使用，也是工业控制常用到的一种现场总线。CANopen实现了OSI模型中的网络层以上(包括网络层)的协定。CANopen标准包括寻址方案、数个小的通讯子协定及由设备子协定所定义的应用层。CANopen支援网络管理、设备监控及节点间的通讯，其中包括一个简易的传输层，可处理资料的分段传送及其组合。一般而言数据链结层及物理层会用CAN来实作。除了CANopen外，也有其他的通讯协定(如EtherCAT)实作CANopen的设备子协定。</p><p>CANopen由非营利组织CiA进行标准的起草及审核工作，基本的CANopen设备及通讯子协定定义在CiA301中。针对个别设备的子协定以CiA301为基础再进行扩充。如针对I/O模组的CiA401及针对运动控制的CiA402。</p><p>针对伺服电机远程控制接线复杂、控制单一、可靠性不高等问题，提出利用CANopen通信协议、驱动子协议实现伺服电机控制的新方法。分析CANopen协议的对象字典和报文格式，详细介绍了CANopen伺服控制状态机各步骤的转换以及实现CANopen协议下PP、PV、HM3钟伺服控制模式的报文设置。利用CAN卡和伺服驱动设备以及伺服驱动设备以及PC机构建了实验平台，在上位机界面通过报文设置成功实现了基于CANopen协议的伺服电机的PP、PV、HM的三种模式的控制。实脸结果表明利用协议的报文设置控制电机简单易操作，通讯数据快速、可靠，用户通过上位机可以很好的实现对伺服电机的监控。</p><p><strong>►系统架构搭建</strong></p><p>整个控制系统由PC机、CANopen上位机、USBCAN适配器、伺服驱动设备构成。CANopen通讯部分由DS301协议实现，伺服控制部分由DSP402协议实现伺服驱动设备作为的从节点，具有CANopen通讯功能，负责电机的电流、转速、位置等控制对象，它通过通信接口与总线相连，将信息传送给计算机的上位机界面;上位机界面则根据从站的反馈信息通过USBCAN适配器对伺服驱动设备实现控制。如图1所示为开放式通讯协议的伺服控制系统总体架构图。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=80%的人都不知道伺服电机远程控制如何实现的 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f1e6fc18daac45c2bc4f08506ae602d5><p class=pgc-img-caption></p></div><p>图1 开放式通讯协议伺服控制系统总体架构图</p><p class=ql-align-center><br></p><p><strong>1 CANopen通讯设备模型</strong></p><p>CANopen的设备模型分为以下3个部分:通信单元、对象字典、应用过程。用户可以通过该模型对功能完全不同的设备进行描述。</p><p>CANopen的核心概念是对象字典，对象字典包含描述这个设备和它的网络行为的所有参数，应用单元和通信单元都可以问这个参数列表。对象字典中的参数通过一个16位索引和位子索引进行识别和定位。</p><p>通信部分由CAN收发器、CAN控制器和CANopen协议栈组成协议栈中定义了实现通讯的通讯对象:NMT(网络管理报文)、PDO(过程数据)SDO(服务数据对象)预定义报文或者特殊能对象(含同步报文、紧急报文、时间标记对象等)通信的所有内容和功能由这些通信对象描述，所有设备之间通信也通过这些通信对象完成。其中NMT用于主站对从站进行状态管理以及从站应答自身所处的通信状态，SDO用于主站对从站的对象字典进行配置和监控。PDO用来传输高速、小型数据。而特殊功能对象则用于同步网络中的通信对象(通常为PDO)的方法。应用部分是对设备的基本功能的定义和描述，它是连接设备与主站上位机的纽带，其核心功能是通过访问设备的对象字典对设备进行参数配置、状态控制和监控，并高速传输设备的过程数据信息。</p><p class=ql-align-center><br></p><p><strong>2 伺服控制模式</strong></p><p>CANopen驱动及运动控制设备子协议DSP402对特性的描述要求非常准确，它不仅定义了驱动器的运行模式，还定义了用于控制驱动器的状态机。驱动器状态机通过对象字典中的控制字6040来控制，并通过状态字6041来读取驱动器的状态。控制状态机如图2所示。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=80%的人都不知道伺服电机远程控制如何实现的 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ca5924c0aabd4de6b2c76a947a3bd22e><p class=pgc-img-caption></p></div><p class=ql-align-center>图2 控制状态机图</p><p>状态机可以分成以下3个部分:PowerDisabled(主电关闭)、PowerEbabled(主电打开)和Fault。所有状态在发生报警后均进入"Fault"在上电后，驱动器完成初始化，然后再进入SWUTCH_ON_DISABLED状态，在该状态，可以进行CAN通讯，可以对驱动器进行配置。此主电仍然关闭，电机没有被励磁。经过StateTransition(状态传输)2,3,4后，进入OPERATIONENABle此时，主电已开启，驱动器根据配置的工作模式控制电机。StateTransition(状态传输)9完成关闭电路主电。一旦驱动器发生报警，驱动器的状态都进入FAULT。</p><p>PP模式(简表位置模式)是典型的定位模式，可通过单步设定与连续设定两种方式控制电机运行到目标位置。PV模式(简表速度模式)是速度控制模式，HM(回零模式)提供多种达到起始位置的方法。</p><p><strong>►系统软硬件设计</strong></p><p class=ql-align-center><strong>1 系统硬件设计</strong></p><p>本文设计采用USBCAN和伺服驱动设备和PC机来搭建硬件平台。伺服驱动控制芯片采用的是DSP的芯片。</p><p>系统硬件搭建按以下步骤进行。首先在TI的开发环境中配置好的相关参数，并建立DS301工程项目，完成CANopen协议通信程序的调试运行。项目调试成功之后下载到驱动器中，在上位机界面中设置报文，测试SDO、PDO、NMT等通讯对象。测试结果正确则系统硬件搭建完成。</p><p class=ql-align-center><br></p><p><strong>2 系统软件设计</strong></p><p>整个伺服控制的软件设计在CCS中建立，主要包括永磁同步电机的闭环控制程序和CANopen协议找的实现两大部分。如图3所示为软件设计流程图。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=80%的人都不知道伺服电机远程控制如何实现的 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/eaeb6621ae7d491f86927d00a356b721><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>图3 软件设计流程图</p><p>初始化部分程序主要完成DSP系统的初始化以及CANopen通讯的初始化。</p><p>初始化主要完成的工作如下:</p><p>初始化相关变量，使能全局中断，进人伺服电机编码器霍尔传感器反馈UVW三路信号来判断电机初始电角度位置。</p><p>初始化通讯的主要完成的工作如下:</p><p>设置从站节点地址和CAN通信波特率，初始化各通对象，完成各路的预定义映射，最后进入通信处理程序。</p><p class=ql-align-center><br></p><p><strong>3 伺服控制报文设置</strong></p><p>CANopen报文结构由11位的COB-ID以及最多8字节的数据域构成。在上位机界面中通过NMT报文设置控制从站进入预作状态或者运行状态，再通过SDO报文设置伺服控制的各个参数(速度、位置等)以及状态机的各个状态可以使电机按照不同控制模式运转起来，最后通过将电机的当前参数映射到PDO中，读取PDO报文的值得到电机当前值，将其与设置值对比得到控制结果的正确性。控制报文全部由SDO实现。</p><p>以下为PP模式控制、PV模式控制和HM模式控制报文列表:</p><p><strong>1.PP模式控制报文列表</strong></p><p class=ql-align-center><br></p><div class=pgc-img><img alt=80%的人都不知道伺服电机远程控制如何实现的 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9b089cb6d1b64b3884b4b2bd0e6dd0d7><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p><strong>2.PV模式控制报文列表</strong></p><div class=pgc-img><img alt=80%的人都不知道伺服电机远程控制如何实现的 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/aecda51256af47f486387dac532d26a2><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p><strong>3.HM模式报文列表</strong></p><p class=ql-align-center><br></p><div class=pgc-img><img alt=80%的人都不知道伺服电机远程控制如何实现的 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/57a16163b9874e70b716285c3ee7653c><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>以上三种控制模式报文操作都是首先设置伺服控制模式，然后根据当前模式依次输入相关的目标控制值(如位置、速度、回零方式等)，最后按照状态机步骤使用6040h控制电机启动与停止。</p><p><strong>►仿真实验</strong></p><p>本系统的上位机界面由USBCAN的上位机界面及电机的监控界面两部分构成，其中USBCAN的上位机界面作为CANopen报文数据监控界面，电机的监控界面用VB2008开发。在上位机界面中通信波特率选用1Mbps伺服电机Node-ID设置为1，心跳周期为1s，TPDO发送周期为100ms，同时设置好电机电流环、位置环、速度环的参数，将设置的报文依次输入上位机界面的SDO控制，电机启动并运行到报文中的设定值，电机手动遥控器显示值与设定值一致，同时上位机界面中报文显示值也与设定值一致，成功实现了伺服控制的控制。</p><p class=ql-align-center><br></p><p><strong>1 PP模式</strong></p><p>电机监控界面中位置控制曲线如下图4所示:</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=80%的人都不知道伺服电机远程控制如何实现的 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3010ca8c90464123be997fa253786b57><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>图4 电机位置控制曲线</p><p>在上位机界面中设置好报文值，电机启动。电机先加速运行，达到设定的目标速度值后开始匀速运行，直至达到设定的目标位置值就不再变化。上位机过程数据与电机监控曲线变化一致。如果需要改变电机的位置值，在上位机界面中依次输人新的控制报文，电机会根据设定值正转或者反转，继续运行到新的位置。</p><p class=ql-align-center><strong>2 PV模式</strong></p><p>电机首先加速到设定的目标速度值，然后按照设疋值勾速运打。如果需要改变运行的速度，同样可在上位机界面中输人新的速度值，加速时的变化如上所述。减速控制时，电机减速直至速度为则停止。如图5所示为上位机数据变化与电机监控曲线变化一致速度控制曲线。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=80%的人都不知道伺服电机远程控制如何实现的 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/795c4663c0d2425b9a6c73fe2075417a><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>图5 电机速度控制曲线图</p><p><strong>3 HM模式</strong></p><p>电机先加速到设定速度，然后寻找原点位置，找到原点后，电机回零，减速直至这时分别在上位机界面以及电机的手动遥控器伺服电机中查看电机的当前位置值，都可以看到电机的当前设为说明电机回零操作完成。如图6所示为位置控制曲线图。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=80%的人都不知道伺服电机远程控制如何实现的 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c8bc1eee179f49059dd108825d262182><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>图6 位置控制曲线图</p><p class=ql-align-center><strong>结 论</strong></p><p>在实际应用应用过程中，本文所设计的系统运行可靠，数据准确易分析，机先加速运行，达到设定的目标速度值后开始匀速实时性好，协议栈程序易植入。该方法可以扩展适用于多电机控制系统，而且的CANopen通信协议栈适用于所有设备，在工程应用应用领域非常广泛。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'80%','电机','远程'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>