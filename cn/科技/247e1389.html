<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ä½¿ç”¨ Node.js å†™ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨ | æå®¢å¿«è¨Š</title><meta property="og:title" content="ä½¿ç”¨ Node.js å†™ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/2cba7942e6784844bac56d6b44752c5c"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/247e1389.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/247e1389.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/247e1389.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/247e1389.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/247e1389.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/247e1389.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/247e1389.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/247e1389.html><meta property="article:published_time" content="2020-11-14T20:55:22+08:00"><meta property="article:modified_time" content="2020-11-14T20:55:22+08:00"><meta name=Keywords content><meta name=description content="ä½¿ç”¨ Node.js å†™ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/247e1389.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ä½¿ç”¨ Node.js å†™ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><p>ä½¿ç”¨ Node.js å†™ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨</p><p>èƒŒæ™¯</p><p>ç¬¬ä¸€æ¬¡æ¥è§¦ä»£ç ç”Ÿæˆå™¨ç”¨çš„æ˜¯åŠ¨è½¯ä»£ç ç”Ÿæˆå™¨ï¼Œæ•°æ®åº“è®¾è®¡å¥½ä¹‹åï¼Œä¸€é”®ç”Ÿæˆåç«¯ curdä»£ç ã€‚ä¹‹åä¹Ÿç”¨è¿‡ CodeSmith , T4ã€‚ç›®å‰å¸‚é¢ä¸Šä¹Ÿæœ‰å¾ˆå¤šä¼˜ç§€çš„ä»£ç ç”Ÿæˆå™¨ï¼Œè€Œä¸”å¤§éƒ¨åˆ†éƒ½æä¾›å¯è§†åŒ–ç•Œé¢æ“ä½œã€‚</p><p>è‡ªå·±å†™ä¸€ä¸ªçš„åŸå› æ˜¯å› ä¸ºè¦é›†æˆåˆ°è‡ªå·±å†™çš„ä¸€ä¸ªå°å·¥å…·ä¸­ï¼Œè€Œä¸”ä½¿ç”¨ Node.js è¿™ç§åŠ¨æ€è„šæœ¬è¯­è¨€è¿›è¡Œç¼–å†™æ›´åŠ çµæ´»ã€‚</p><p>åŸç†</p><p>ä»£ç ç”Ÿæˆå™¨çš„åŸç†å°±æ˜¯ï¼šæ•°æ® + æ¨¡æ¿ => æ–‡ä»¶ã€‚</p><p>æ•°æ®ä¸€èˆ¬ä¸ºæ•°æ®åº“çš„è¡¨å­—æ®µç»“æ„ã€‚</p><p>æ¨¡æ¿çš„è¯­æ³•ä¸ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“æœ‰å…³ã€‚</p><p>ä½¿ç”¨æ¨¡æ¿å¼•æ“å°†æ•°æ®å’Œæ¨¡æ¿è¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘åçš„å†…å®¹è¾“å‡ºåˆ°æ–‡ä»¶ä¸­å°±å¾—åˆ°äº†ä¸€ä»½ä»£ç æ–‡ä»¶ã€‚</p><p>åŠŸèƒ½</p><p>å› ä¸ºè¿™ä¸ªä»£ç ç”Ÿæˆå™¨æ˜¯è¦é›†æˆåˆ°ä¸€ä¸ªå°å·¥å…· lazy-mock å†…ï¼Œè¿™ä¸ªå·¥å…·çš„ä¸»è¦åŠŸèƒ½æ˜¯å¯åŠ¨ä¸€ä¸ª mock server æœåŠ¡ï¼ŒåŒ…å«curdåŠŸèƒ½ï¼Œå¹¶ä¸”æ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œæ–‡ä»¶å˜åŒ–çš„æ—¶å€™è‡ªåŠ¨é‡å¯æœåŠ¡ä»¥æœ€æ–°çš„ä»£ç æä¾› api mock æœåŠ¡ã€‚</p><p>ä»£ç ç”Ÿæˆå™¨çš„åŠŸèƒ½å°±æ˜¯æ ¹æ®é…ç½®çš„æ•°æ®å’Œæ¨¡æ¿ï¼Œç¼–è¯‘åå°†å†…å®¹è¾“å‡ºåˆ°æŒ‡å®šçš„ç›®å½•æ–‡ä»¶ä¸­ã€‚å› ä¸ºæ·»åŠ äº†æ–°çš„æ–‡ä»¶ï¼Œmock server æœåŠ¡ä¼šè‡ªåŠ¨é‡å¯ã€‚</p><p>è¿˜è¦æ”¯æŒæ¨¡æ¿çš„å®šåˆ¶ä¸å¼€å‘ï¼Œä»¥åŠä½¿ç”¨ CLI å®‰è£…æ¨¡æ¿ã€‚</p><p>å¯ä»¥å¼€å‘å‰ç«¯é¡¹ç›®çš„æ¨¡æ¿ï¼Œç›´æ¥å°†ç¼–è¯‘åçš„å†…å®¹è¾“å‡ºåˆ°å‰ç«¯é¡¹ç›®çš„ç›¸å…³ç›®å½•ä¸‹ï¼Œwebpack çš„çƒ­æ›´æ–°åŠŸèƒ½ä¹Ÿä¼šèµ·ä½œç”¨ã€‚</p><p>æ¨¡æ¿å¼•æ“</p><p>æ¨¡æ¿å¼•æ“ä½¿ç”¨çš„æ˜¯ nunjucksã€‚</p><p>lazy-mock ä½¿ç”¨çš„æ„å»ºå·¥å…·æ˜¯ gulpï¼Œä½¿ç”¨ gulp-nodemon å®ç° mock-server æœåŠ¡çš„è‡ªåŠ¨é‡å¯ã€‚æ‰€ä»¥è¿™é‡Œä½¿ç”¨ gulp-nunjucks-render é…åˆ gulp çš„æ„å»ºæµç¨‹ã€‚</p><p>ä»£ç ç”Ÿæˆ</p><p>ç¼–å†™ä¸€ä¸ª gulp task ï¼š</p><p><strong>const</strong> rename = require('gulp-rename') <strong>const</strong> nunjucksRender = require('gulp-nunjucks-render') <strong>const</strong> codeGenerate = require('./templates/generate') <strong>const</strong> ServerFullPath = require('./package.json').ServerFullPath; //mock -serveré¡¹ç›®çš„ç»å¯¹è·¯å¾„ <strong>const</strong> FrontendFullPath = require('./package.json').FrontendFullPath; //å‰ç«¯é¡¹ç›®çš„ç»å¯¹è·¯å¾„ <strong>const</strong> nunjucksRenderConfig = { path: 'templates/server', envOptions: { tags: { blockStart: '&lt;%', blockEnd: '%>', variableStart: '&lt;$', variableEnd: '$>', commentStart: '&lt;#', commentEnd: '#>' }, }, ext: '.js', //ä»¥ä¸Šæ˜¯ nunjucks çš„é…ç½® ServerFullPath, FrontendFullPath } gulp.task('code', <strong>function</strong> () { require('events').EventEmitter.defaultMaxListeners = 0 <strong>return</strong> codeGenerate(gulp, nunjucksRender, rename, nunjucksRenderConfig) });</p><blockquote>ä»£ç å…·ä½“ç»“æ„ç»†èŠ‚å¯ä»¥æ‰“å¼€ lazy-mock è¿›è¡Œå‚ç…§</blockquote><p>ä¸ºäº†æ”¯æŒæ¨¡æ¿çš„å¼€å‘ï¼Œä»¥åŠæ›´çµæ´»çš„é…ç½®ï¼Œæˆ‘å°†ä»£ç ç”Ÿæˆçš„é€»è¾‘å…¨éƒ½æ”¾åœ¨æ¨¡æ¿ç›®å½•ä¸­ã€‚</p><p>templates æ˜¯å­˜æ”¾æ¨¡æ¿ä»¥åŠæ•°æ®é…ç½®çš„ç›®å½•ã€‚ç»“æ„å¦‚ä¸‹ï¼š</p><div class=pgc-img><img alt="ä½¿ç”¨ Node.js å†™ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2cba7942e6784844bac56d6b44752c5c></div><p>åªç”Ÿæˆ lazy-mock ä»£ç çš„æ¨¡æ¿ä¸­ ï¼š</p><p>generate.jsçš„å†…å®¹å¦‚ä¸‹ï¼š</p><p><strong>const</strong> path = require('path') <strong>const</strong> CodeGenerateConfig = require('./config').default; <strong>const</strong> Model = CodeGenerateConfig.model; module.exports = <strong>function</strong> <strong>generate</strong>(gulp, nunjucksRender, rename, nunjucksRenderConfig) { nunjucksRenderConfig.data = { model: CodeGenerateConfig.model, config: CodeGenerateConfig.config } <strong>const</strong> ServerProjectRootPath = nunjucksRenderConfig.ServerFullPath; //server <strong>const</strong> serverTemplatePath = 'templates/server/' gulp.src(`${serverTemplatePath}controller.njk`) .pipe(nunjucksRender(nunjucksRenderConfig)) .pipe(rename(Model.name + '.js')) .pipe(gulp.dest(ServerProjectRootPath + CodeGenerateConfig.config.ControllerRelativePath)); gulp.src(`${serverTemplatePath}service.njk`) .pipe(nunjucksRender(nunjucksRenderConfig)) .pipe(rename(Model.name + 'Service.js')) .pipe(gulp.dest(ServerProjectRootPath + CodeGenerateConfig.config.ServiceRelativePath)); gulp.src(`${serverTemplatePath}model.njk`) .pipe(nunjucksRender(nunjucksRenderConfig)) .pipe(rename(Model.name + 'Model.js')) .pipe(gulp.dest(ServerProjectRootPath + CodeGenerateConfig.config.ModelRelativePath)); gulp.src(`${serverTemplatePath}db.njk`) .pipe(nunjucksRender(nunjucksRenderConfig)) .pipe(rename(Model.name + '_db.json')) .pipe(gulp.dest(ServerProjectRootPath + CodeGenerateConfig.config.DBRelativePath)); <strong>return</strong> gulp.src(`${serverTemplatePath}route.njk`) .pipe(nunjucksRender(nunjucksRenderConfig)) .pipe(rename(Model.name + 'Route.js')) .pipe(gulp.dest(ServerProjectRootPath + CodeGenerateConfig.config.RouteRelativePath)); }</p><p>ç±»ä¼¼ï¼š</p><p>gulp.src(`${serverTemplatePath}controller.njk`) .pipe(nunjucksRender(nunjucksRenderConfig)) .pipe(rename(Model.name + '.js')) .pipe(gulp.dest(ServerProjectRootPath + CodeGenerateConfig.config.ControllerRelativePath));</p><p>è¡¨ç¤ºä½¿ç”¨ controller.njk ä½œä¸ºæ¨¡æ¿ï¼ŒnunjucksRenderConfigä½œä¸ºæ•°æ®ï¼ˆæ¨¡æ¿å†…å¯ä»¥è·å–åˆ° nunjucksRenderConfig å±æ€§ data ä¸Šçš„æ•°æ®ï¼‰ã€‚ç¼–è¯‘åè¿›è¡Œæ–‡ä»¶é‡å‘½åï¼Œå¹¶ä¿å­˜åˆ°æŒ‡å®šç›®å½•ä¸‹ã€‚</p><p>model.js çš„å†…å®¹å¦‚ä¸‹ï¼š</p><p><strong>var</strong> shortid = require('shortid') <strong>var</strong> Mock = require('mockjs') <strong>var</strong> Random = Mock.Random //å¿…é¡»åŒ…å«å­—æ®µid <strong>export</strong> <strong>default</strong> { name: "book", Name: "Book", properties: [ { key: "id", title: "id" }, { key: "name", title: "ä¹¦å" }, { key: "author", title: "ä½œè€…" }, { key: "press", title: "å‡ºç‰ˆç¤¾" } ], buildMockData: <strong>function</strong> () {//ä¸éœ€è¦ç”Ÿæˆè®¾ä¸ºfalse <strong>let</strong> data = [] <strong>for</strong> (<strong>let</strong> i = 0; i &lt; 100; i++) { data.push({ id: shortid.generate(), name: Random.cword(5, 7), author: Random.cname(), press: Random.cword(5, 7) }) } <strong>return</strong> data } }</p><p>æ¨¡æ¿ä¸­ä½¿ç”¨æœ€å¤šçš„å°±æ˜¯è¿™ä¸ªæ•°æ®ï¼Œä¹Ÿæ˜¯ç”Ÿæˆæ–°ä»£ç éœ€è¦é…ç½®çš„åœ°æ–¹ï¼Œæ¯”å¦‚è¿™é‡Œé…ç½®çš„æ˜¯ book ï¼Œç”Ÿæˆçš„å°±æ˜¯å…³äº book çš„curd çš„ mock æœåŠ¡ã€‚è¦ç”Ÿæˆåˆ«çš„ï¼Œä¿®æ”¹åæ‰§è¡Œç”Ÿæˆå‘½ä»¤å³å¯ã€‚</p><p>buildMockData å‡½æ•°çš„ä½œç”¨æ˜¯ç”Ÿæˆ mock æœåŠ¡éœ€è¦çš„éšæœºæ•°æ®ï¼Œåœ¨ db.njk æ¨¡æ¿ä¸­ä¼šä½¿ç”¨ï¼š</p><p>{ "&lt;$ model.name $>":&lt;% <strong>if</strong> model.buildMockData %>&lt;$ model.buildMockData()|dump|safe $>&lt;% <strong>else</strong> %>[]&lt;% endif %> }</p><blockquote>è¿™ä¹Ÿæ˜¯ nunjucks å¦‚ä½•åœ¨æ¨¡æ¿ä¸­æ‰§è¡Œå‡½æ•°</blockquote><p>config.js çš„å†…å®¹å¦‚ä¸‹ï¼š</p><p><strong>export</strong> <strong>default</strong> { //server RouteRelativePath: '/src/routes/', ControllerRelativePath: '/src/controllers/', ServiceRelativePath: '/src/services/', ModelRelativePath: '/src/models/', DBRelativePath: '/src/db/' }</p><p>é…ç½®ç›¸åº”çš„æ¨¡æ¿ç¼–è¯‘åä¿å­˜çš„ä½ç½®ã€‚</p><p>config/index.js çš„å†…å®¹å¦‚ä¸‹ï¼š</p><p><strong>import</strong> model <strong>from</strong> './model'; <strong>import</strong> config <strong>from</strong> './config'; <strong>export</strong> <strong>default</strong> { model, config }</p><p>é’ˆå¯¹ lazy-mock çš„ä»£ç ç”Ÿæˆçš„åŠŸèƒ½å°±å·²ç»å®Œæˆäº†ï¼Œè¦å®ç°æ¨¡æ¿çš„å®šåˆ¶ç›´æ¥ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶å³å¯ï¼Œæ¯”å¦‚è¦ä¿®æ”¹ mock server æœåŠ¡ api çš„æ¥å£å®šä¹‰ï¼Œç›´æ¥ä¿®æ”¹ route.njk æ–‡ä»¶ï¼š</p><p><strong>import</strong> KoaRouter <strong>from</strong> 'koa-router' <strong>import</strong> controllers <strong>from</strong> '../controllers/index.js' <strong>import</strong> PermissionCheck <strong>from</strong> '../middleware/PermissionCheck' <strong>const</strong> router = <strong>new</strong> KoaRouter() router .get('/&lt;$ model.name $>/paged', controllers.&lt;$model.name $>.get&lt;$ model.Name $>PagedList) .get('/&lt;$ model.name $>/:id', controllers.&lt;$ model.name $>.get&lt;$ model.Name $>) .del('/&lt;$ model.name $>/del', controllers.&lt;$ model.name $>.del&lt;$ model.Name $>) .del('/&lt;$ model.name $>/batchdel', controllers.&lt;$ model.name $>.del&lt;$ model.Name $>s) .post('/&lt;$ model.name $>/save', controllers.&lt;$ model.name $>.save&lt;$ model.Name $>) module.exports = router</p><p>æ¨¡æ¿å¼€å‘ä¸å®‰è£…</p><p>ä¸åŒçš„é¡¹ç›®ï¼Œä»£ç ç»“æ„æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯æ¬¡ç›´æ¥ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶ä¼šå¾ˆéº»çƒ¦ã€‚</p><p>éœ€è¦æä¾›è¿™æ ·çš„åŠŸèƒ½ï¼šé’ˆå¯¹ä¸åŒçš„é¡¹ç›®å¼€å‘ä¸€å¥—ç‹¬ç«‹çš„æ¨¡æ¿ï¼Œæ”¯æŒæ¨¡æ¿çš„å®‰è£…ã€‚</p><p>ä»£ç ç”Ÿæˆçš„ç›¸å…³é€»è¾‘éƒ½åœ¨æ¨¡æ¿ç›®å½•çš„æ–‡ä»¶ä¸­ï¼Œæ¨¡æ¿å¼€å‘æ²¡æœ‰ä»€ä¹ˆè§„åˆ™é™åˆ¶ï¼Œåªè¦ä¿è¯ç›®å½•åä¸º templatesï¼Œgenerate.jsä¸­å¯¼å‡ºgenerateå‡½æ•°å³å¯ã€‚</p><p>æ¨¡æ¿çš„å®‰è£…åŸç†å°±æ˜¯å°†æ¨¡æ¿ç›®å½•ä¸­çš„æ–‡ä»¶å…¨éƒ¨è¦†ç›–æ‰å³å¯ã€‚ä¸è¿‡å…·ä½“çš„å®‰è£…åˆ†ä¸ºæœ¬åœ°å®‰è£…ä¸åœ¨çº¿å®‰è£…ã€‚</p><p>ä¹‹å‰å·²ç»è¯´äº†ï¼Œè¿™ä¸ªä»£ç ç”Ÿæˆå™¨æ˜¯é›†æˆåœ¨ lazy-mock ä¸­çš„ï¼Œæˆ‘çš„åšæ³•æ˜¯åœ¨åˆå§‹åŒ–ä¸€ä¸ªæ–° lazy-mock é¡¹ç›®çš„æ—¶å€™ï¼ŒæŒ‡å®šä½¿ç”¨ç›¸åº”çš„æ¨¡æ¿è¿›è¡Œåˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯å®‰è£…ç›¸åº”çš„æ¨¡æ¿ã€‚</p><p>ä½¿ç”¨ Node.js å†™äº†ä¸€ä¸ª CLI å·¥å…· lazy-mock-cliï¼Œå·²å‘åˆ° npm ï¼Œå…¶åŠŸèƒ½åŒ…å«ä¸‹è½½æŒ‡å®šçš„è¿œç¨‹æ¨¡æ¿æ¥åˆå§‹åŒ–æ–°çš„ lazy-mock é¡¹ç›®ã€‚ä»£ç å‚è€ƒï¼ˆ copy ï¼‰äº† vue-cli2ã€‚ä»£ç ä¸éš¾ï¼Œè¯´ä¸‹æŸäº›å…³é”®ç‚¹ã€‚</p><p>å®‰è£… CLI å·¥å…·ï¼š</p><p>npm install lazy-mock -g</p><p>ä½¿ç”¨æ¨¡æ¿åˆå§‹åŒ–é¡¹ç›®ï¼š</p><p>lazy-mock init d2-admin-pm my-project</p><blockquote>d2-admin-pm æ˜¯æˆ‘ä¸ºä¸€ä¸ªå‰ç«¯é¡¹ç›®å·²ç»å†™å¥½çš„ä¸€ä¸ªæ¨¡æ¿ã€‚</blockquote><p>init å‘½ä»¤è°ƒç”¨çš„æ˜¯ lazy-mock-init.js ä¸­çš„é€»è¾‘ï¼š</p><p><strong>#!/usr/bin/env node</strong> <strong>const</strong> download = require('download-git-repo') <strong>const</strong> program = require('commander') <strong>const</strong> ora = require('ora') <strong>const</strong> exists = require('fs').existsSync <strong>const</strong> rm = require('rimraf').sync <strong>const</strong> path = require('path') <strong>const</strong> chalk = require('chalk') <strong>const</strong> inquirer = require('inquirer') <strong>const</strong> home = require('user-home') <strong>const</strong> fse = require('fs-extra') <strong>const</strong> tildify = require('tildify') <strong>const</strong> cliSpinners = require('cli-spinners'); <strong>const</strong> logger = require('../lib/logger') <strong>const</strong> localPath = require('../lib/local-path') <strong>const</strong> isLocalPath = localPath.isLocalPath <strong>const</strong> getTemplatePath = localPath.getTemplatePath program.usage('&lt;template-name> [project-name]') .option('-c, --clone', 'use git clone') .option('--offline', 'use cached template') program.on('--help', () => { console.log(' Examples:') console.log() console.log(chalk.gray(' # create a new project with an official template')) console.log(' $ lazy-mock init d2-admin-pm my-project') console.log() console.log(chalk.gray(' # create a new project straight from a github template')) console.log(' $ vue init username/repo my-project') console.log() }) <strong>function</strong> <strong>help</strong>() { program.parse(process.argv) <strong>if</strong> (program.args.length &lt; 1) <strong>return</strong> program.help() } help() //æ¨¡æ¿ <strong>let</strong> template = program.args[0] //åˆ¤æ–­æ˜¯å¦ä½¿ç”¨å®˜æ–¹æ¨¡æ¿ <strong>const</strong> hasSlash = template.indexOf('/') > -1 //é¡¹ç›®åç§° <strong>const</strong> rawName = program.args[1] //åœ¨å½“å‰æ–‡ä»¶ä¸‹åˆ›å»º <strong>const</strong> inPlace = !rawName || rawName === '.' //é¡¹ç›®åç§° <strong>const</strong> name = inPlace ? path.relative('../', process.cwd()) : rawName //åˆ›å»ºé¡¹ç›®å®Œæ•´ç›®æ ‡ä½ç½® <strong>const</strong> to = path.resolve(rawName || '.') <strong>const</strong> clone = program.clone || false //ç¼“å­˜ä½ç½® <strong>const</strong> serverTmp = path.join(home, '.lazy-mock', 'sever') <strong>const</strong> tmp = path.join(home, '.lazy-mock', 'templates', template.replace(/[\/:]/g, '-')) <strong>if</strong> (program.offline) { console.log(`> Use cached template at ${chalk.yellow(tildify(tmp))}`) template = tmp } //åˆ¤æ–­æ˜¯å¦å½“å‰ç›®å½•ä¸‹åˆå§‹åŒ–æˆ–è€…è¦†ç›–å·²æœ‰ç›®å½• <strong>if</strong> (inPlace || exists(to)) { inquirer.prompt([{ type: 'confirm', message: inPlace ? 'Generate project in current directory?' : 'Target directory exists. Continue?', name: 'ok' }]).then(answers => { <strong>if</strong> (answers.ok) { run() } }).catch(logger.fatal) } <strong>else</strong> { run() } <strong>function</strong> <strong>run</strong>() { //ä½¿ç”¨æœ¬åœ°ç¼“å­˜ <strong>if</strong> (isLocalPath(template)) { <strong>const</strong> templatePath = getTemplatePath(template) <strong>if</strong> (exists(templatePath)) { generate(name, templatePath, to, err => { <strong>if</strong> (err) logger.fatal(err) console.log() logger.success('Generated "%s"', name) }) } <strong>else</strong> { logger.fatal('Local template "%s" not found.', template) } } <strong>else</strong> { <strong>if</strong> (!hasSlash) { //ä½¿ç”¨å®˜æ–¹æ¨¡æ¿ <strong>const</strong> officialTemplate = 'lazy-mock-templates/' + template downloadAndGenerate(officialTemplate) } <strong>else</strong> { downloadAndGenerate(template) } } } <strong>function</strong> <strong>downloadAndGenerate</strong>(template) { downloadServer(() => { downloadTemplate(template) }) } <strong>function</strong> <strong>downloadServer</strong>(done) { <strong>const</strong> spinner = ora('downloading server') spinner.spinner = cliSpinners.bouncingBall spinner.start() <strong>if</strong> (exists(serverTmp)) rm(serverTmp) download('wjkang/lazy-mock', serverTmp, { clone }, err => { spinner.stop() <strong>if</strong> (err) logger.fatal('Failed to download server ' + template + ': ' + err.message.trim()) done() }) } <strong>function</strong> <strong>downloadTemplate</strong>(template) { <strong>const</strong> spinner = ora('downloading template') spinner.spinner = cliSpinners.bouncingBall spinner.start() <strong>if</strong> (exists(tmp)) rm(tmp) download(template, tmp, { clone }, err => { spinner.stop() <strong>if</strong> (err) logger.fatal('Failed to download template ' + template + ': ' + err.message.trim()) generate(name, tmp, to, err => { <strong>if</strong> (err) logger.fatal(err) console.log() logger.success('Generated "%s"', name) }) }) } <strong>function</strong> <strong>generate</strong>(name, src, dest, done) { <strong>try</strong> { fse.removeSync(path.join(serverTmp, 'templates')) <strong>const</strong> packageObj = fse.readJsonSync(path.join(serverTmp, 'package.json')) packageObj.name = name packageObj.author = "" packageObj.description = "" packageObj.ServerFullPath = path.join(dest) packageObj.FrontendFullPath = path.join(dest, "front-page") fse.writeJsonSync(path.join(serverTmp, 'package.json'), packageObj, { spaces: 2 }) fse.copySync(serverTmp, dest) fse.copySync(path.join(src, 'templates'), path.join(dest, 'templates')) } <strong>catch</strong> (err) { done(err) <strong>return</strong> } done() }</p><p>åˆ¤æ–­äº†æ˜¯ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„æ¨¡æ¿è¿˜æ˜¯æ‹‰å–æœ€æ–°çš„æ¨¡æ¿ï¼Œæ‹‰å–çº¿ä¸Šæ¨¡æ¿æ—¶æ˜¯ä»å®˜æ–¹ä»“åº“æ‹‰å–è¿˜æ˜¯ä»åˆ«çš„ä»“åº“æ‹‰å–ã€‚</p><p>ä¸€äº›å°é—®é¢˜</p><p>ç›®å‰ä»£ç ç”Ÿæˆçš„ç›¸å…³æ•°æ®å¹¶ä¸æ˜¯æ¥æºäºæ•°æ®åº“ï¼Œè€Œæ˜¯åœ¨ model.js ä¸­ç®€å•é…ç½®çš„ï¼ŒåŸå› æ˜¯æˆ‘è®¤ä¸ºä¸€ä¸ª mock server ä¸éœ€è¦æ•°æ®åº“ï¼Œlazy-mock ç¡®å®å¦‚æ­¤ã€‚</p><p>ä½†æ˜¯å¦‚æœå†™ä¸€ä¸ªæ­£å„¿å…«ç»çš„ä»£ç ç”Ÿæˆå™¨ï¼Œé‚£è‚¯å®šæ˜¯éœ€è¦æ ¹æ®å·²ç»è®¾è®¡å¥½çš„æ•°æ®åº“è¡¨æ¥ç”Ÿæˆä»£ç çš„ã€‚é‚£ä¹ˆå°±éœ€è¦è¿æ¥æ•°æ®åº“ï¼Œè¯»å–æ•°æ®è¡¨çš„å­—æ®µä¿¡æ¯ï¼Œæ¯”å¦‚å­—æ®µåç§°ï¼Œå­—æ®µç±»å‹ï¼Œå­—æ®µæè¿°ç­‰ã€‚è€Œä¸åŒå…³ç³»å‹æ•°æ®åº“ï¼Œè¯»å–è¡¨å­—æ®µä¿¡æ¯çš„ sql æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥è¿˜è¦å†™ä¸€å †balabalaçš„åˆ¤æ–­ã€‚å¯ä»¥ä½¿ç”¨ç°æˆçš„å·¥å…· sequelize-auto , æŠŠå®ƒè¯»å–çš„ model æ•°æ®è½¬æˆæˆ‘ä»¬éœ€è¦çš„æ ¼å¼å³å¯ã€‚</p><p>ç”Ÿæˆå‰ç«¯é¡¹ç›®ä»£ç çš„æ—¶å€™ï¼Œä¼šé‡åˆ°è¿™ç§æƒ…å†µï¼š</p><p>æŸä¸ªç›®å½•ç»“æ„æ˜¯è¿™æ ·çš„ï¼š</p><div class=pgc-img><img alt="ä½¿ç”¨ Node.js å†™ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/27eb06ca18b24f87af5366de534841de></div><p>index.js çš„å†…å®¹ï¼š</p><p><strong>import</strong> layoutHeaderAside <strong>from</strong> '@/layout/header-aside' <strong>export</strong> <strong>default</strong> { "layoutHeaderAside": layoutHeaderAside, "menu": () => <strong>import</strong>(/* webpackChunkName: "menu" */'@/pages/sys/menu'), "route": () => <strong>import</strong>(/* webpackChunkName: "route" */'@/pages/sys/route'), "role": () => <strong>import</strong>(/* webpackChunkName: "role" */'@/pages/sys/role'), "user": () => <strong>import</strong>(/* webpackChunkName: "user" */'@/pages/sys/user'), "interface": () => <strong>import</strong>(/* webpackChunkName: "interface" */'@/pages/sys/interface') }</p><p>å¦‚æœæ·»åŠ ä¸€ä¸ª book å°±éœ€è¦åœ¨è¿™é‡ŒåŠ ä¸Š"book": () => import(/* webpackChunkName: "book" */'@/pages/sys/book')</p><p>è¿™ä¸€è¡Œå†…å®¹ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡é…ç½®æ¨¡æ¿æ¥ç”Ÿæˆçš„ï¼Œæ¯”å¦‚æ¨¡æ¿å†…å®¹ä¸ºï¼š</p><p>"&lt;$ model.name $>": () => import(/* webpackChunkName: "&lt;$ model.name $>" */'@/pages&lt;$ model.module $>&lt;$ model.name $>')</p><p>ä½†æ˜¯ç”Ÿæˆçš„å†…å®¹æ€ä¹ˆåŠ åˆ°index.jsä¸­å‘¢ï¼Ÿ</p><p>ç¬¬ä¸€ç§æ–¹æ³•ï¼šå¤åˆ¶ç²˜è´´</p><p>ç¬¬äºŒç§æ–¹æ³•ï¼š</p><p>è¿™éƒ¨åˆ†çš„æ¨¡æ¿ä¸º routerMapComponent.njk ï¼š</p><p>export default { "&lt;$ model.name $>": () => import(/* webpackChunkName: "&lt;$ model.name $>" */'@/pages&lt;$ model.module $>&lt;$ model.name $>') }</p><p>ç¼–è¯‘åæ–‡ä»¶ä¿å­˜åˆ° routerMapComponents ç›®å½•ä¸‹ï¼Œæ¯”å¦‚ book.js</p><p>ä¿®æ”¹ index.js :</p><p><strong>const</strong> files = require.context('./', true, /\.js$/); <strong>import</strong> layoutHeaderAside <strong>from</strong> '@/layout/header-aside' <strong>let</strong> componentMaps = { "layoutHeaderAside": layoutHeaderAside, "menu": () => <strong>import</strong>(/* webpackChunkName: "menu" */'@/pages/sys/menu'), "route": () => <strong>import</strong>(/* webpackChunkName: "route" */'@/pages/sys/route'), "role": () => <strong>import</strong>(/* webpackChunkName: "role" */'@/pages/sys/role'), "user": () => <strong>import</strong>(/* webpackChunkName: "user" */'@/pages/sys/user'), "interface": () => <strong>import</strong>(/* webpackChunkName: "interface" */'@/pages/sys/interface'), } files.keys().forEach((key) => { <strong>if</strong> (key === './index.js') <strong>return</strong> Object.assign(componentMaps, files(key).default) }) <strong>export</strong> <strong>default</strong> componentMaps</p><blockquote>ä½¿ç”¨äº† require.context</blockquote><p>æˆ‘ç›®å‰ä¹Ÿæ˜¯ä½¿ç”¨äº†è¿™ç§æ–¹æ³•</p><p>ç¬¬ä¸‰ç§æ–¹æ³•ï¼š</p><p>å¼€å‘æ¨¡æ¿çš„æ—¶å€™ï¼Œåšç‰¹æ®Šå¤„ç†ï¼Œè¯»å–åŸæœ‰ index.js çš„å†…å®¹ï¼ŒæŒ‰è¡Œè¿›è¡Œåˆ†å‰²ï¼Œåœ¨æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ä¹‹å‰æ’å…¥æ–°ç”Ÿæˆçš„å†…å®¹ï¼Œæ³¨æ„é€—å·çš„å¤„ç†ï¼Œå°†æ–°æ•°ç»„å†…å®¹é‡æ–°å†™å…¥ index.js ä¸­ï¼Œæ³¨æ„æ¢è¡Œã€‚</p><p>æ‰“ä¸ªå¹¿å‘Š</p><p>å¦‚æœä½ æƒ³è¦å¿«é€Ÿçš„åˆ›å»ºä¸€ä¸ª mock-serverï¼ŒåŒæ—¶è¿˜æ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œåˆä¸éœ€è¦å®‰è£…æ•°æ®åº“ï¼Œè¿˜æ”¯æŒä»£ç ç”Ÿæˆå™¨çš„æ¨¡æ¿å¼€å‘ï¼Œæ¬¢è¿è¯•è¯• lazy-mock ã€‚</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'ç”Ÿæˆå™¨','Node','js'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>