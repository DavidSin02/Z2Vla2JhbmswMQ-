<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>震惊！滑动验证码竟然能这样破解 | 极客快訊</title><meta property="og:title" content="震惊！滑动验证码竟然能这样破解 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/15312208083725bfb06e346"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/24c88bed.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/24c88bed.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/24c88bed.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/24c88bed.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/24c88bed.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/24c88bed.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/24c88bed.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/24c88bed.html><meta property="article:published_time" content="2020-11-14T21:04:55+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:55+08:00"><meta name=Keywords content><meta name=description content="震惊！滑动验证码竟然能这样破解"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/24c88bed.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>震惊！滑动验证码竟然能这样破解</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><blockquote><p><strong>奇技指南</strong></p><p>现在的人工智能过于强大, 大部分扭曲的图形验证码都可以被机器破解, 而且图形验证码体验很差, 输入困难。而滑动验证码操作简便, 破解难度大, 很快就流行起来了。今天来讲讲滑动验证码的破解办法。</p><p>本文由 chunpu 在奇舞周刊投稿，转载请注明出处。</p></blockquote><div class=pgc-img><img alt=震惊！滑动验证码竟然能这样破解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15312208083725bfb06e346><p class=pgc-img-caption></p></div><p>最近西部世界第二季很火, 小编经常分不清谁是机器人谁是真人</p><p>为了区分人类和机器, 有个人发明了一种测试, 他叫图灵~</p><p>验证码就是一个典型的图灵测试, 英文名 captcha, 全称如下</p><blockquote><p>Completely Automated Public Turing test to tell Computers and Humans Apart</p><p>全自动区分计算机和人类的图灵测试</p></blockquote><p>目前主流的验证码有</p><ul><li>图形验证码</li><li>短信验证码</li><li>滑块验证码</li><li>图中点选验证码</li></ul><p>但现在的人工智能过于强大, 大部分扭曲的图形验证码都可以被机器破解, 已经不再是一个可靠的图灵测试</p><p>而且图形验证码体验很差, 输入困难</p><p>这时候, <strong>滑动验证码</strong>出现了, 最具代表性的就是 <strong>Geetest</strong>(极验)</p><div class=pgc-img><img alt=震惊！滑动验证码竟然能这样破解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15312208082922dbb4b9cca><p class=pgc-img-caption></p></div><p>滑动验证码对机器破解有两大难点, 第一个是需要通过图像识别知道滑到哪里, 第二个是需要模仿人类做出滑动的手势</p><p>滑动验证码 <strong>操作简便</strong>, <strong>破解难度大</strong>, 很快就流行起来了</p><h1><strong>WebDriver 标准</strong></h1><p>正好 <strong>W3C</strong> 近日发布了一个浏览器自动化操作的标准, 名叫 <strong>WebDriver</strong></p><blockquote><p>https://www.w3.org/TR/webdriver1/</p></blockquote><p>小编就拿极验滑动验证码开刀, 和大家一起感受 WebDriver 的强大功能</p><p>先附上小编成果(本视频20秒, 没有声音)：https://v.qq.com/x/page/y0715zqcz7f.html</p><h1>安装 WebDriver</h1><p>WebDriver 已经是既定标准, 各大浏览器最新版都天然支持 WebDriver 协议, 使用门槛大大降低</p><p>小编本次使用的是支持度较好的浏览器 <strong>firefox</strong></p><p>从 https://github.com/mozilla/geckodriver 官方仓库中即可下载 firefox 的 diver</p><p>使用 selenium-webdriver</p><p>WebDriver 标准本身只是定义了一系列操作浏览器的 <strong>HTTP 协议</strong>, 但 <strong>selenium</strong> 已经为我们封装成了 sdk, 直接调用函数即可</p><blockquote><p>const webdriver = require('selenium-webdriver')</p></blockquote><h1><strong>打开极验demo页面</strong></h1><p>我们先用 WebDriver 实现一个最简单的例子: <strong>打开一个网页</strong></p><blockquote><p>const webdriver = require('selenium-webdriver')</p><p>!async function() {</p><p>// 新建一个 firefox 的 driver 实例</p><p>let driver = await new webdriver.Builder().forBrowser('firefox').build()</p><p>// 访问极验demo页</p><p>await driver.get('http://www.geetest.com/type/')</p><p>console.log('success')</p><p>}()</p></blockquote><p>运行这段代码, 我们能看到浏览器打开了极验的 demo 页</p><p>此时浏览器的地址栏是<strong>黄色</strong>的, 表示该浏览器被控制了, 就好像电视剧里面被心灵控制的人眼睛是红色的</p><div class=pgc-img><img alt=震惊！滑动验证码竟然能这样破解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15312208082727ae02fe262><p class=pgc-img-caption></p></div><h1><strong>选择滑动行为验证</strong></h1><p>极验第一个标签是智能组合验证, 第二个标签才是我们要破解的滑动验证, 因此需要先切换至滑动验证</p><p>我们通过 CSS 选择器选出要点击的标签, 然后使用 WebDriver 点击这个元素</p><blockquote><p>await driver.findElement(webdriver.By.css('.products-content li:nth-child(2)')).click()</p></blockquote><h1><strong>点击验证按钮</strong></h1><p>来到了滑动行为验证区域, 接下来就要点击验证按钮, 同样也是先用 CSS 选择器选出按钮, 然后再点击</p><blockquote><p>await driver.findElement(webdriver.By.css('.geetest_radar_tip')).click()</p></blockquote><h1><strong>区域截图</strong></h1><div class=pgc-img><img alt=震惊！滑动验证码竟然能这样破解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1531220887679bddf42960f><p class=pgc-img-caption></p></div><p>到这一步, 滑动验证码已经弹出</p><p>我们碰到了破解过程中的第一个难点, <strong>图像识别</strong></p><p>要知道拼图需要滑动到哪里, 先要知道完整图片以及缺一块的图片, 放一起对比, 才能知道滑块需要滑动到哪里</p><p>WebDriver 提供了两种截图方式, 一种是全屏截图, 一种是元素截图</p><p>这里我们仅需要获取拼图缺失的背景图, 因此使用元素截图</p><blockquote><p>// 隐藏原图再截图</p><p>await driver.executeScript(`document.querySelector('.geetest_canvas_fullbg').style.display = 'none'`)</p><p>// 找到验证码背景图元素, 是一个 canvas</p><p>const bgCanvas = await driver.findElement(webdriver.By.css('.geetest_canvas_bg'))</p><p>// 获得一个 base64 格式的 png 截图</p><p>const bgPng = await bgCanvas.takeScreenshot()</p></blockquote><h1><strong>找到滑动点</strong></h1><p>小编并不懂图像识别, 为了降低实现难度, 用了一个简单取巧的方法</p><p>因为拼图缺失的区域会有 <strong>阴影</strong>, 而阴影一般比较黑</p><div class=pgc-img><img alt=震惊！滑动验证码竟然能这样破解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15312208876790fcbb74cfc><p class=pgc-img-caption></p></div><p>因此我们把题目从 <strong>寻找拼图丢失区</strong> 改成了 <strong>寻找比较黑的点</strong></p><p>当然这个草率的规则正确率并不高, 但为了demo演示已经足够了</p><p>那怎么定义 <strong>比较黑</strong> 呢? 最简单的方法就是挨个读取图像中的像素</p><p>我们把 R, G, B 三值相加, 数字越小就认为越黑, 最黑的 rgb(0, 0, 0) 就是0</p><p>附上小编用的读取像素库 get-pixels</p><h1><strong>开始滑动</strong></h1><p>滑动操作使用了 WebDriver 中的 actions api, 可以完成一系列操作, 比如键盘输入, 鼠标移动, 点击等</p><blockquote><p>// 获取拼图滑块按钮</p><p>const button = await driver.findElement(webdriver.By.css('.geetest_slider_button'))</p><p>// 获取按钮位置等信息</p><p>const buttonRect = await button.getRect()</p><p>// 初始化 action</p><p>let actions = driver.actions({async: true})</p><p>// 把鼠标移动到滑块上, 然后点击</p><p>actions = actions.move({</p><p>x: x + 10,</p><p>y: y + 10,</p><p>duration: 100</p><p>}).press()</p><p>// 花一秒钟把滑块拖动至拼图缺失区, 松开鼠标</p><p>await actions.move({</p><p>x: x + 10 + point.x - 5,</p><p>y: y + 10,</p><p>duration: 1000</p><p>}).release().perform()</p></blockquote><p>写完代码, 执行, 看着拼图顺畅的向前滑动, 等待着奇迹的发生</p><p>然而奇迹并没有发生, 只有一行黄字映入眼帘</p><blockquote><p>怪物吃了拼图, 请3秒后重试</p></blockquote><div class=pgc-img><img alt=震惊！滑动验证码竟然能这样破解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15312209260718bf29eaa58><p class=pgc-img-caption></p></div><p>重复好多次, 我们发现</p><p><strong>即便完全吻合, 也无法绕过极验的认证!</strong></p><p>低估, 完全的低估!</p><p>拼图吻合只是必要条件, 破解的基础门槛</p><p>真正的难点是拖动过程中的 <strong>滑动轨迹</strong>!</p><h1><strong>模仿人类滑动</strong></h1><p>我们再次想到了西部世界二, 最后的彩蛋威廉在世外山谷绝望的问艾米莉</p><blockquote><p>威廉: Verify what?</p><p>艾米莉: Fidelity</p></blockquote><div class=pgc-img><img alt=震惊！滑动验证码竟然能这样破解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/153122092610303b1d7dd63><p class=pgc-img-caption></p></div><p>Fidelity, 真实度</p><p>破解到了这一步, 能否模仿人类的滑动轨迹成了关键</p><p>我们反复不断的调教滑动代码, again and again</p><p>小编进行了多次尝试, 比如把 move action 分成多段, 按照不同的速度进行拖动, 甚至加入各种随机数, 但始终无法通过极验的轨迹检查</p><p>最后小编仿照微信随机红包的方式, 先把要滑动的距离切成几十份, 并且允许有负数</p><blockquote><p>人在滑动拼图的时候很容易出现, 滑过了再滑动回去的场景, 因此负数可以增加 Fidelity</p><p>const count = 30 // 小编分成30步进行滑动</p><p>const steps = getSteps(distance, count)</p><p>const totalDuration = 8000 // 一共耗时8秒, 慢才能充实轨迹~</p><p>_.reduce(steps, (actions, step) => {</p><p>return actions.move({</p><p>x: x + 10 + step,</p><p>y: y + 10 + _.random(-5, 40), // 加上y轴随机数</p><p>duration: parseInt(_.random(totalDuration / count / 2, totalDuration / count * 2)) // 加上时长随机数</p><p>})</p><p>}, actions)</p><p>// 随机拆成n份</p><p>function getRandomDistribution(total, count) {</p><p>let item = total / count</p><p>item = item + _.random(-item * 2, item * 3)</p><p>item = parseInt(item)</p><p>if (count === 1) {</p><p>return [total]</p><p>} else {</p><p>return [item].concat(getRandomDistribution(total - item, count - 1))</p><p>}</p><p>}</p><p>// 获取每次滑动的X座标</p><p>function getSteps(total, count) {</p><p>let distribution = getRandomDistribution(total, count)</p><p>return _.map(distribution, (item, i) => {</p><p>return _.sum(distribution.slice(0, i + 1))</p><p>})</p><p>}</p></blockquote><p>保存, 执行</p><p>小编放下鼠标, 端起桌上的马克杯, 看着 WebDriver 再次控制浏览器</p><p>打开网页, 点击按钮, 拖动滑块, 滑块曲折前行...</p><p>摩擦摩擦, 似魔鬼的步伐, 似老奶奶颤巍巍的手</p><p>终于, 极验显示出一个清爽绿色的横幅, 仿佛在向我们招手: 欢迎你, 人类</p><div class=pgc-img><img alt=震惊！滑动验证码竟然能这样破解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15312209261028a41c384ad><p class=pgc-img-caption></p></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'震惊','滑动验','证码'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>