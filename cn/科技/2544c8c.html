<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>详解PG三大配置文件-postgresql.conf,pg_hba.conf,pg_ident.conf | 极客快訊</title><meta property="og:title" content="详解PG三大配置文件-postgresql.conf,pg_hba.conf,pg_ident.conf - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/59a9cd8cdac34a30a6fde42ac24222d0"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2544c8c.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2544c8c.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2544c8c.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2544c8c.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2544c8c.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2544c8c.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2544c8c.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2544c8c.html><meta property="article:published_time" content="2020-10-29T20:59:53+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:53+08:00"><meta name=Keywords content><meta name=description content="详解PG三大配置文件-postgresql.conf,pg_hba.conf,pg_ident.conf"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/2544c8c.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>详解PG三大配置文件-postgresql.conf,pg_hba.conf,pg_ident.conf</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1><strong>概述</strong></h1><p>今天主要介绍PG的三大配置文件，下面一起来看看吧！</p><hr><h1><strong>一、pg_settings</strong></h1><blockquote><p>The view pg_settings provides access to run-time parameters of the server. It is essentially an alternative interface to the SHOW and SET commands. It also provides access to some facts about each parameter that are not directly available from SHOW, such as minimum and maximum values.</p></blockquote><div class=pgc-img><img alt=详解PG三大配置文件-postgresql.conf,pg_hba.conf,pg_ident.conf onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/59a9cd8cdac34a30a6fde42ac24222d0><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=详解PG三大配置文件-postgresql.conf,pg_hba.conf,pg_ident.conf onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/443734cec65d4872852c1fe5c29926fc><p class=pgc-img-caption></p></div><p>PostgreSQL的配置文件主要有如下3个(postgresql.conf,pg_hba.conf,pg_ident.conf)</p><pre> select name, setting,source from pg_settings where category='File Locations' ;</pre><div class=pgc-img><img alt=详解PG三大配置文件-postgresql.conf,pg_hba.conf,pg_ident.conf onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0c1e6806c743494cb81c802167587087><p class=pgc-img-caption></p></div><hr><h1><strong>二、postgresql.conf（数据库相关配置）</strong></h1><p><strong><br></strong>该文件包含一些通用设置，比如内存分配，新建database的默认存储位置，PostgreSQL服务器的IP地址，日志的位置以及许多其他设置。</p><pre> select name, context, unit, setting, boot_val, reset_val from pg_settings where name in ('listen_address','max_connetctons','shared_buffers','effective_cache_size','work_mem','maintenance_work_mem') order by context, name;​</pre><div class=pgc-img><img alt=详解PG三大配置文件-postgresql.conf,pg_hba.conf,pg_ident.conf onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b9cba8ce0472478e8c62f850e2e50c07><p class=pgc-img-caption></p></div><p>说明：context 设置为postmaster，更改此形参后需要重启PostgreSQL服务才能生效；设置为user，那么只需要执行一次重新加载即可全局生效。重启数据库服务会终止活动连接，但重新加载不会。</p><p>unit 字段表示这些设置的单位;<br>setting是指当前设置；</p><p>boot_val是指默认设置；</p><p>reset_val是指重新启动服务器或重新加载设置之后的新设置;<br>在postgresql.conf中修改了设置后，一定记得查看一下setting和reset_val并确保二者是一致，否则说明设置并未生效，需要重新启动服务器或者重新加载设置</p><hr><h1><strong>三、pg_hba.conf（客户端认证配置文件）</strong></h1><p>pg_hba.conf为PostgreSQL的访问策略配置文件，默认位于/var/lib/pgsql/10/data/目录（PostgreSQL10）。</p><p>该配置文件有5个参数，分别为：TYPE（主机类型）、DATABASE（数据库名）、USER（用户名）、ADDRESS（IP地址和掩码）、METHOD（加密方法）</p><p><strong>1、TYPE，有4个值</strong></p><pre>local：使用Unix-domainsockethost：使用TCP/IP连接，可以是SSL的，也可以不是hostssl：必须是SSL的hostnossl：必须是非SSL的</pre><div class=pgc-img><img alt=详解PG三大配置文件-postgresql.conf,pg_hba.conf,pg_ident.conf onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ef4ef44e4c5448818e19a7ded99bde82><p class=pgc-img-caption></p></div><p><strong>2、DATABASE：</strong></p><p>数据库名，可以是"all", "sameuser", "samerole", "replication"。all表示所有，但不包括replication。多个数据库用“,”隔开。</p><div class=pgc-img><img alt=详解PG三大配置文件-postgresql.conf,pg_hba.conf,pg_ident.conf onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1aef388e67274aa39e085486833afc41><p class=pgc-img-caption></p></div><p><strong>3、USER：</strong></p><p>用户名，可以为"all"，表示所有，也可以具体指定一个用户。多个用户用“,”隔开。和DATABASE一样，也可以将配置放到文件中，文件名加上前缀@</p><div class=pgc-img><img alt=详解PG三大配置文件-postgresql.conf,pg_hba.conf,pg_ident.conf onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/140af137eaf749a7bfb0bed4c6e59480><p class=pgc-img-caption></p></div><p><strong>4、ADDRESS：</strong></p><p>可以是为一个主机名，或者由IP地址和CIDR掩码组成。掩码可以为0-32（IPv4）或者0-128（IPv6）间的一个整数，32表示子网掩码为255.255.255.255，24表示子网掩码为255.255.255.0。主机名以“.”开头。samehost可以匹配所有主机、samenet可以匹配同一个掩码内的所有主机。</p><p>例：192.168.10.122/32表示单一主机，192.168.10.0/24表示192.168.0.1~192.168.0.255网段内所有主机，0.0.0.0/0表示所有主机。</p><div class=pgc-img><img alt=详解PG三大配置文件-postgresql.conf,pg_hba.conf,pg_ident.conf onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2ad34296a754439ca47e5c6b43978261><p class=pgc-img-caption></p></div><p>5、METHOD：</p><p>密码加密策略，password表示以明文方式发送密码，md5和scram-sha-256会以对应的方式加密再发送密码。</p><div class=pgc-img><img alt=详解PG三大配置文件-postgresql.conf,pg_hba.conf,pg_ident.conf onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/71e79e0afe894dbcbbd92a79bbe6fa98><p class=pgc-img-caption></p></div><hr><h1><strong>四、pg_ident.conf（用户映射文件）</strong></h1><p>前面pg_hba.conf讲到ident认证方式，需要建立映射用户或具备同名用户。</p><p>同名用户好办，各新建一个同名的操作系统用户和数据库用户，两个用户密码不必相同，但名字必须相同。用该用户登录到操作系统或su到该用户后，即可$ psql dbname。</p><p>如果不想新建同名用户，也可以配置pg_ident.conf文件。pg_ident.conf用来配置哪些操作系统用户可以映射为数据库用户。</p><p>pg_ident.conf的格式如下：</p><pre># MAPNAME SYSTEM-USERNAME PG-USERNAMEusermap username dbuser</pre><p>usermap为映射名，要在pg_hba.conf中用到，多个映射可以共用同一个映射名，username为操作系统用户名，dbuser为映射到的数据库用户。<br>比如，服务器上有名为user1的操作系统用户，同时数据库上也有同名的数据库用户，user1登录操作系统后可以直接输入psql，以user1数据库用户身份登录数据库且不需密码。<br>很多初学者都会遇到psql -U username登录数据库却出现“username ident 认证失败”的错误，明明数据库用户已经createuser。<br>原因就在于此，使用了ident认证方式，却没有同名的操作系统用户或没有相应的映射用户。<br>解决方案：</p><pre>1)、在pg_ident.conf中添加映射用户；</pre><pre>2)、改变认证方式。</pre><p>CentOS7安装了PostgreSQL10和pgadmin4后,pgadmin4始终登陆数据库提示用户认证失败,<br>就是因为Linux下PostgreSQL默认的local认证方式是ident,而pg_ident.conf用户映射文件里并没有任何映射用户,所以可以修改认证方式为md5,即可使用密码成功登陆了.</p><hr><p>觉得有用的朋友多帮忙转发哦！后面会分享更多devops和DBA方面的内容，感兴趣的朋友可以关注下~</p><div class=pgc-img><img alt=详解PG三大配置文件-postgresql.conf,pg_hba.conf,pg_ident.conf onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/48d332a03a0d4647bb171eadd37a5848><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'conf','pg','配置文件'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>