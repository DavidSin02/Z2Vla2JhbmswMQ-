<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>KNX-EIB通信协议的基本原理 | 极客快訊</title><meta property="og:title" content="KNX-EIB通信协议的基本原理 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/0eb231dd55b34ebcbbd7ac0328fd48a9"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2a286add.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2a286add.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2a286add.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2a286add.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2a286add.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2a286add.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2a286add.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2a286add.html><meta property="article:published_time" content="2020-11-14T21:08:02+08:00"><meta property="article:modified_time" content="2020-11-14T21:08:02+08:00"><meta name=Keywords content><meta name=description content="KNX-EIB通信协议的基本原理"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/2a286add.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>KNX-EIB通信协议的基本原理</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>2.1 物理层</p><p style=text-align:justify>要想了解KNX标准的物理层，总线信号是必须要弄清楚。物理层负责产生和产生和监控帧格式所对应的比特流，如表2-1，KNX标准支持四种传输媒介。支持双绞线、电力线、Wi-Fi、Ethernet、RF（射频）等通信介质[8]，其中双绞线最为广泛，每个物理段可达1000m,支持优先级冲突检测与退避，传输速率为9.6Kbps；使用电力线时，最大传输距离为600m。</p><p>双绞线介质是由从20V到30V操作调节一个24V额定的电压差组成，在总线上的KNX信号可以采取两种状态之一：逻辑0和逻辑1。逻辑1是直流水平总线电压，类似于一个逻辑一个总线中（信号线的空闲状态和逻辑1是一样的）。逻辑0是在KNX总线有动作的时候发生。逻辑0的编码在2个阶段发生。第一阶段被称为有源脉冲。有源脉冲是电压降约6至9伏在总线电压。这个电压跌落持续35µ和由发送端下降电流从差分线产生[9]。</p><p style=text-align:justify></p><p style=text-align:center>表2-1 KNX标准的传输媒介</p><p style=text-align:center>类型</p><p style=text-align:center>信息</p><p style=text-align:center>双绞线</p><p>UART波特率9600</p><p>90%的市场</p><p>最大传输距离可达1公里</p><p>优先级冲突检测与退避</p><p style=text-align:center>电力线</p><p>1200bits/s</p><p>碰撞控制：随机优先级</p><p>230／400V供电系统的背景噪声高电压，总线接入不能与电压等级有联系</p><p>利用特殊时隙的冲突问题得到了解决即每一个电源耦合器只能在指定的时间内传输</p><p style=text-align:center>Wi-Fi</p><p>封装IP报文</p><p style=text-align:center>Ethernet</p><p>封装IP报文</p><p style=text-align:center>RF（射频）</p><p>868MHz</p><p>最大功率为5MW</p><p>16.384kbit/sec的比特率</p><p>支持单通道和多通道</p><p style=text-align:justify>每个有源脉冲被随着总线上的电压突然跳跃大于直流电压产生的。这信号电压的突然跳变由指数衰减到直流电平持续了69µ。这个脉冲是一个均衡脉冲，扼流圈的指示器通常是内置到KNX电源。这个阻流电感器产生正均衡脉冲。发射器必须确保正确的电压水平和消息成功传递的时间。图2-1显示了在KNX双绞线线的编码信号。</p><p></p><p style=text-align:center>图2-1 KNX双绞线的信号编码</p><p style=text-align:justify>接收器端需要一个带有滞后的差分比较器。接收器检测到活动脉冲的开始和结束。有源脉冲启动检测阈值是−0.45 V（典型），要比平均总线电压值小。有源脉冲结束的检测阈值是−0.2 V（典型）[10]。内部能带隙来排除从总线到输入比较器的干扰也是很有必要的。</p><p style=text-align:justify>KNX总线对电压值是有要求的，对单片机的外部模拟组件也是有要求的。物理层部分是由能实时通信的模拟电路组成，KNX设备是总线给予供电的。物理层提供的电压调节器使输出稳定的3.3V直流电应用到单片机中。</p><p style=text-align:justify>KNX系统有使能信号电平的通信的模拟物理层，一些物理层的设置集成了数字逻辑组成的部分，从而使单片机的应用中把自身的数字逻辑功能弃置不用，包括碰撞控制、重复、确认、奇偶校验、和校验和等[11]。如果物理不包括这些逻辑数字功能，应用单片机必须实现这些功能。</p><p style=text-align:justify>了解物理层的数字功能的重要性，认为碰撞处理的操作。传输设备必须在传输过程中不断地监控总线。因为一个逻辑1等于该线上的空闲状态，只能检测到另一个设备发出的逻辑0。如果有2个或更多设备尝试在同一时间发送，于是发生碰撞了。设备发送0可以继续，而设备发送1必须等待。这个机制和严格的时间要求确保碰撞检测和处理[12]。</p><p style=text-align:justify>几个物理层关于模拟和模拟-数字接口的选择可用在市场上得到的。这些接口之间的主要权衡是复杂性和成本。模拟-数字PHY提供最简单的解决方案就应用单片机，但成本超过模拟接口的解决方案。MSP系列单片机支持认证的供应商的物理类型。模拟硬件接口是基于位的界面，和模拟-数字硬件接口是一个TP-UART接口。</p><p>2.2 通信协议栈</p><p style=text-align:justify>在KNX总线发送的消息在数据包中称为电报。如图2-2所示，严格的时序要求必须考虑在内。考虑是由按钮触发事件的情况。一个传输过程开始后总线了能在一段时间后t1 = 5.2ms后一直保持闲置状态[13]。如果这个时间开始启动的要求完成，然后电报才会被发送。当传输完成时，接收设备必须在t2 = 1.56ms的时间内确认收到这段电报。报如果发送端没有收到从接收端发回的确认信息，发送端会重新发送这个电报。</p><p style=text-align:center>图2-2 电报传输和应答之间的时间要求</p><p style=text-align:justify>信息传输是由带有8位用于同步和错误控制的一些系统开销的字符组成[14]，如图2-3。开始时表示数据字节的开始。8位的数据，奇偶校验位，一个停止位和一个2位的暂停位。13位中每一位的数据都是要求被发送的。</p><p style=text-align:center>图2-3 TP KNX总线数据格式</p><p style=text-align:justify>图2-4所示，TP KNX总线上传输电报是由七个部分组成的。（1）小节到 （8）小节描述了电报的组成及其具体信息的编码。</p><p style=text-align:center>图2-4 电报的组成</p><p style=text-align:center></p><p>（1） The ACK字段</p><p style=text-align:justify>表2-2所示的是一个数据的字节，可以表示三个不同的确认情况：</p><p style=text-align:justify>a. BUSY</p><p style=text-align:justify>b. NACK</p><p style=text-align:justify>c. ACK</p><p style=text-align:justify></p><p style=text-align:center>表2-2 KNX ACK字节描述</p><p style=text-align:center>D7</p><p style=text-align:center>D6</p><p style=text-align:center>D5</p><p style=text-align:center>D4</p><p style=text-align:center>D3</p><p style=text-align:center>D2</p><p style=text-align:center>D1</p><p style=text-align:center>D0</p><p style=text-align:center>描述</p><p style=text-align:center>1</p><p style=text-align:center>1</p><p style=text-align:center>0</p><p style=text-align:center>0</p><p style=text-align:center>0</p><p style=text-align:center>0</p><p style=text-align:center>0</p><p style=text-align:center>0</p><p style=text-align:center>BUSY为不能立即处理新信息</p><p style=text-align:center>0</p><p style=text-align:center>0</p><p style=text-align:center>0</p><p style=text-align:center>0</p><p style=text-align:center>1</p><p style=text-align:center>1</p><p style=text-align:center>0</p><p style=text-align:center>0</p><p style=text-align:center>NACK为消息接收不正确</p><p style=text-align:center>1</p><p style=text-align:center>1</p><p style=text-align:center>0</p><p style=text-align:center>0</p><p style=text-align:center>1</p><p style=text-align:center>1</p><p style=text-align:center>0</p><p style=text-align:center>0</p><p style=text-align:center>ACK为消息接收正确</p><p>（2） The Control Field字段</p><p style=text-align:justify>控制域是一个字节，用于不同的目的。如果总线设备返回NACK信号，那么电报会被重传，在重复控制字节的位设置为0，表示这是一个重传[15]。重复位确保接收设备只执行一次命令。这个控制字节还设置消息的优先级。表2-3显示了控件的功能描述领域。</p><p style=text-align:justify></p><p style=text-align:center>表2-3 用于控制字节的位编码</p><p style=text-align:center>D7</p><p style=text-align:center>D6</p><p style=text-align:center>D5</p><p style=text-align:center>D4</p><p style=text-align:center>D3</p><p style=text-align:center>D2</p><p style=text-align:center>D1</p><p style=text-align:center>D0</p><p style=text-align:center>描述</p><p style=text-align:center>1</p><p style=text-align:center>0</p><p style=text-align:center>R</p><p style=text-align:center>1</p><p style=text-align:center>P</p><p style=text-align:center>P</p><p style=text-align:center>0</p><p style=text-align:center>0</p><p style=text-align:center>PP为发送优先，R为重复，其他为混合</p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center>0</p><p style=text-align:center>0</p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center>系统功能（最高级）</p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center>1</p><p style=text-align:center>0</p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center>时钟功能</p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center>0</p><p style=text-align:center>1</p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center>一般模式（次高级）</p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center>1</p><p style=text-align:center>1</p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center>自动模式</p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center>0</p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center></p><p style=text-align:center>重复</p><p>（3） The Source Address字段</p><p style=text-align:justify>在KNX网络中的每个设备都有一个2字节的地址。</p><p style=text-align:justify>要在网络上识别特定的设备，必须将该区域、线路和设备号码放在源地址字段。图2-7显示了如果D1的设备地址，发送端可以D1在1线也可以在15线[16]。类似地，该区域编号必须指定。源地址包含发送端的完整信息。如图2-5所示，低8位是独立总线设备地址。</p><p style=text-align:center>图2-5 KNX源地址包含的区域，线，和总线设备数量</p><p>考虑一个KNX设备的独立地址在线并且在区域3，则给出源地址由3/10/20的形式如图2-6所示。</p><p style=text-align:center>图2-6 源地址示例</p><p>（4） The Target Address字段</p><p style=text-align:justify>目标地址包含要处理发送消息的设备的地址[17]。图2-7显示该地址还包含设备的区域、线路和独立地址KNX网络但有一点点额外的指定地址是否为单个节点或多设备。额外的位是KNX系统的一个有用的功能。考虑一个系统，其中1个开关是用来控制房间里的20个灯泡。每个灯泡都有一个独立的地址，要求开关发送相同的消息20次寻址每个目标设备[18]。通过设置该组位为1，在指定区域内指定的线上处理该消息时，独立的地址被忽略的。二十个灯泡可以由一个单一的信息控制。</p><p style=text-align:center>图2-7 KNX目标地址</p><p style=text-align:justify>目标地址是点对点连接时为独立地址（面向连接的通信）。对于多播或广播寻址（无连接通信）时[19]，组地址被称为地址被用作目标（接收器）地址。</p><p>（5） The Routing Bits字段</p><p style=text-align:justify>路由位形成一个3位计数器限制一个消息可以在KNX网络传输多远。路由值由发发送端进行初始化，并通过在系统的耦合器中进行修改。每一个耦合器都会使路由计数器的值减小，只要这个值大于零，电报就被传递；如果计数器等于零，该消息不能被耦合器发送。此功能阻止不同线路之间的短路，防止消息永远在总线上循环。路由器（线路耦合器）中的筛选器表格的参数来管理是否做滤波。要禁用过滤的功能，使路由计数器的值等于7。如果路由号码是7，耦合器继续传输消息[19]，而且路由位并不会递减。</p><p>（6） The Length 字段</p><p style=text-align:justify>长度字段在数据字段中有有用的数据的数量。数据的长度取决于传送的数据的大小，并且可以在1位和16字节之间变化。接收器使用长度字段检查正确的数据接收。只有数据位和不是数据流或者是控制位（如奇偶校验，开始和停止，等等）计算长度字段时都被认为包括在内。</p><p>（7） The Data字段</p><p style=text-align:justify>KNX-EIB网络是通过Datapo int接口进行互通的。每个Datapo int被分配了一个解释的名字，以及类型(Datapoint Type)。Datapoint Type用于格式化总线上发送和接收的数据[20]，Datapoint Type定义了数据类型及取值范围，如图2-8所示，每一个Datapoint Type标准化一个组合的结构，编码，范围，单位。</p><p style=text-align:center>图2-8 Datapoint Type的结构</p><p style=text-align:justify>数据场包含电报的实际数据，如打开灯。消息被编码为标准化的数据点类型以确保设备的互操作性。Data point类型确保所有设备在同一种编程语言中进行通信。要用开关控制一组灯。灯泡有只有两种状态：打开和关闭。</p><p style=text-align:justify>在KNX数据类型列表中，有一种称为DPT_Switch的类型。图2-9显示dpt_switch描述以及其他位数据类型。DPT_Switch是一位消息表示灯光关或是闭的状态。该类型可用于灯光的开关[20]。</p><p></p><p style=text-align:center>图2-9 KNX数据点类型的例子</p><p style=text-align:justify>应用程序需要不同的Data point类型。</p><p>（8） The Check报文段</p><p style=text-align:justify>KNX通讯协议提供了两级错误检查。第一个是字节级。如图在图2-10中，电报中的每个字节都有它自己的奇偶校验位。也就是说，奇偶校验位得到了值0或1使所有位的二进制和（D0：D7和P）等于0。</p><p style=text-align:center>图2-10 奇偶校验对KNX电报每个字节</p><p style=text-align:justify>电报的最后一个字节（称为检查字段）进行二次检查[21]。这个字段是由检查每个位位的奇偶校验位的所有字符。考虑一个有3个字节的数据如图2-11所示。</p><p style=text-align:justify>每个字节都有它自己的数据字段内的奇偶校验位。每一个检查字节计算的基础上的每个位的总和，该位的位置，以便二进制位的总和等于1。</p><p>2.3 拓扑结构</p><p style=text-align:justify>HBES的网络类型是完全对等的分布式总线模型[22]。了解KNX寻址，考虑到KNX的拓扑结构。图2-12显示了KNX网络概述。从设备级开始，多达256 KNX设备（Dn）可以连接每条总线。添加线路中继器（LRn）每行扩展电缆长度。如果在该系统中使用了更多的设备，可以用线耦合器连接到15条线链接主线，最大能扩展3840个设备，也就是15线形成区域。</p><p style=text-align:justify><br></p><div class=pgc-img><img alt=KNX-EIB通信协议的基本原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0eb231dd55b34ebcbbd7ac0328fd48a9><p class=pgc-img-caption>德龙科技</p></div><p style=text-align:justify><br></p><p style=text-align:center>图2-11 字节和电报级错误检查</p><p style=text-align:justify>主干线可扩展KNX双绞线总线。最大的15线区域也可以使用骨干网互连耦合器（BCn）对每个KNX网络共扩展57600个设备[23]。每条主干线和线必须有自己的电源供应。电源规格上限制实际最高系统中的设备数。</p><p></p><p style=text-align:center>图2-12 KNX拓扑：BCn =骨干耦合器，LCn =线耦合器，LRn=线路中继器，PS =电源，Dn= KNX设备或节点</p><p style=text-align:justify>EIB总线的设备也是就是总线连接单元（BCU）,它们的物理地址是唯一的，在双绞线的KNX总线数据格式中源地址来表示设备的物理地址[24]。由2个字节组成，在源地址字段包括该区域、线路和设备的号码。用来总线连接单元的程序下载和系统监控等功能。</p><p>2.4 组地址</p><p style=text-align:justify>KNX-EIB网络通过组寻址的通信方式来有效进行，则组地址承担了非常重要的角色在这种通信的模式中来实现一个传感器设备控制多个执行器设备，或者多个传感器控制一个执行器模块。在双绞线的KNX总线数据格式中目标地址用来组成组地址的形式，用来实现其功能。</p><p style=text-align:justify>目标地址是点对点连接时为独立地址（面向连接的通信）。对于多播或广播寻址（无连接通信）时，组地址被称为地址被用作目标（接收器）地址，并在图2-13中显示的结构。组地址也是占用2个字节，但是有效的组地址是15位，因为其首位永远为0，用来备用。</p><p style=text-align:justify>第一行表明了组地址是如何表示成一个主/次的两级层次结构，而第二行显示了一个主/中/分的三级层次结构。两级层次和三级层次的组地址在物理层上是没有区别的，只在三段式的表达形式中能够用子组来区分不同功能的各组设备。</p><p></p><p style=text-align:center>图2-13 组地址编码15比特（位D15是保留位）</p><p>2.5 BCU的识别</p><p style=text-align:justify>KNX-EIB系统提供了完整的传感器、执行器等模块的网络设备的识别机制。传感器、执行器等模块在网络总线上可以通过其独立地址被识别，也可以通过其MAC地址进行识别，甚至其所处的配置模式。设备可以通过MAC地址得到其独立地址，也可以通过独立地址设置其MAC地址。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'KNX','EIB','协议'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>