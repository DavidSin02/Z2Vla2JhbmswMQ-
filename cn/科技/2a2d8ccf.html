<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Python 初学者常犯的5个错误，布尔型竟是整型的子类 | 极客快訊</title><meta property="og:title" content="Python 初学者常犯的5个错误，布尔型竟是整型的子类 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2a2d8ccf.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2a2d8ccf.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2a2d8ccf.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2a2d8ccf.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2a2d8ccf.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2a2d8ccf.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2a2d8ccf.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2a2d8ccf.html><meta property="article:published_time" content="2020-10-29T21:09:15+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:15+08:00"><meta name=Keywords content><meta name=description content="Python 初学者常犯的5个错误，布尔型竟是整型的子类"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/2a2d8ccf.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Python 初学者常犯的5个错误，布尔型竟是整型的子类</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>选自deepsource</p><p><strong>作者：Mohit</strong></p><p><strong>机器之心编译参与：思</strong></p><blockquote><p>Python 是一种神奇的语言，看似简单便捷，但总会有一些意想不到的惊喜在等着我们。比如说，assert 在正式环境下根本不会运行，isinstance(False, int) 竟然输出 True。</p></blockquote><p>Python 是一种高级的动态编程语言，它以易于使用著名。目前 Python 社区已经非常完善了，近几年它的发展尤为迅猛。但是易于使用同样能带来一些坏处，即易于误用。在本文中，作者列举了 5 个初学者常犯的错误，希望它们能帮助初学者写更加正确与优美的代码。</p><p><strong>1. 可变的缺省参数</strong></p><p>Python 中的缺省参数会在执行函数定义时计算一次，这表示在函数完成定义后该表达式只执行一次，因此缺省值可以用于后续的每一次调用。如果我们令缺省参数为可变的，例如列表或字典等，那么对于将来所有的调用，该参数都是一直保留且可变的。</p><p>如下为不正确的表达方式，如果我们第一次调用 add_item 增加「a」时，items=[『a』]。当我们第二次调用 add_item 增加「b」时，由于定义中的 items=[] 只在初始化的时候运行一次，因此这时的 items=[『a』, 『b』]。</p><p>尤其是当我们在调用 add_item 函数时没传入任何参数，那么 items 还是能保留以前记住的内容，相当于将以前的内容泄漏给了后续的调用。</p><pre>def add_item(new_item, items=[]): items.append(new_item)</pre><p>正确的表达方式应该是如下，在我们没传入 items 时应该要将它初始化为空白列表：</p><pre>def add_item(new_item, items=None): if items is None: items = [] items.append(new_item)</pre><p><strong>2. 将 assert 声明语句作为保证条件</strong></p><p>因为 assert 语句很容易检查一些条件是否满足或执行是否正确，开发者经常用它来检查某部分代码的有效性。但是当 Python 解释器调用时带了-O (optimize) flag，那么 assert 语句会从字节码中移除。所以，如果 assert 语句在面向用户验证的产品代码中，根本就不会执行，因为它可能会造成一些安全漏洞。</p><p>因此开发者应该只在测试中使用 assert 语句，不正确的示例如下：</p><pre>assert re.match(VALID_ADDRESS_REGEXP, email) is not None</pre><p>正确的代码要改成：</p><pre>if not re.match(VALID_ADDRESS_REGEXP, email): raise AssertionError</pre><p><strong>3. 使用 isinstance 代替 type</strong></p><p>type 和 isinstance 都能检查某个对象的类别是什么。但是它们间有非常重要的区别，isinstance 在解析目标类型时，它会关注继承关系，而 type 并不会。正因为这个区别，isinstance 在某些时候并不是我们所想的那样。例如以下案例：</p><pre>def which_number_type(num): if isinstance(num, int): print('Integer') else: raise TypeError('Not an integer')which_number(False) # prints 'Integer', which is incorrect</pre><p>因为布尔类型的变量在 Python 中是 int 的子类，isinstance(num, int) 同样会得出 True，这并不是我们想要的。在特定的类别中，使用 type 可能更加正确。</p><p><strong>4. 不必要的 lambda 表达式</strong></p><p>函数在 Python 中是最常用的结构，我们能将函数赋值给某个变量，并将该变量作为参数传递给另外一个函数，这也是函数常见的用法。但这对于初学者或了解其它编程语言的开发者而言，这种传递方式是非常反直觉的。</p><p>一个比较常见的模式可以表示为：</p><pre>def request(self, method, **kwargs): # ... if method not in ("get", "post"): req.get_method = lambda: method.upper() # ...</pre><p>上面采用匿名函数 lambda 的方式，最好可以改成以下：</p><pre>def request(self, method, **kwargs): # ... if method not in ("get", "post"): req.get_method = method.upper # ...</pre><p>这种命名可能会使开发者感到困惑，NotImplementedError 是一种 exception 类，当派生类需要重写某个方法时，Python 应该触发这类错误。而 NotImplemented 是一个常量，它用于实现二进制操作。当我们触发 NotImplemented 时，Python 会给出「TypeError」的报错。</p><p>错误的例子：</p><pre>class SitesManager(object): def get_image_tracking_code(self): raise NotImplemented</pre><p>正确表达方法应该是：</p><pre>class SitesManager(object): def get_image_tracking_code(self): raise NotImplementedError</pre></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'常犯','Python','初学者'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>