<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Javaç¼–ç¨‹æŠ€å·§ï¼šå¦‚ä½•å®ç°å‚æ•°çš„è¾“å…¥è¾“å‡ºï¼Ÿ | æå®¢å¿«è¨Š</title><meta property="og:title" content="Javaç¼–ç¨‹æŠ€å·§ï¼šå¦‚ä½•å®ç°å‚æ•°çš„è¾“å…¥è¾“å‡ºï¼Ÿ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/b36247aabf154a46aca31b642fc3cd0c"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2a836fe1.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2a836fe1.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2a836fe1.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2a836fe1.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2a836fe1.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2a836fe1.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2a836fe1.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2a836fe1.html><meta property="article:published_time" content="2020-10-29T21:09:46+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:46+08:00"><meta name=Keywords content><meta name=description content="Javaç¼–ç¨‹æŠ€å·§ï¼šå¦‚ä½•å®ç°å‚æ•°çš„è¾“å…¥è¾“å‡ºï¼Ÿ"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/2a836fe1.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Javaç¼–ç¨‹æŠ€å·§ï¼šå¦‚ä½•å®ç°å‚æ•°çš„è¾“å…¥è¾“å‡ºï¼Ÿ</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p><strong>å‰è¨€</strong></p><p><br></p><p>è½¯ä»¶å¼€å‘æ–¹æ³•å­¦çš„æ³°æ–—è‚¯ç‰¹Â·è´å…‹ï¼ˆKent Beckï¼‰æ›¾è¯´è¿‡ï¼š</p><p><br></p><blockquote><p>æˆ‘ä¸æ˜¯ä¸€ä¸ªä¼Ÿå¤§çš„ç¨‹åºå‘˜ï¼Œæˆ‘åªæ˜¯ä¸€ä¸ªå…·æœ‰è‰¯å¥½ä¹ æƒ¯çš„ä¼˜ç§€ç¨‹åºå‘˜ã€‚</p></blockquote><p><br></p><p>å…»æˆè‰¯å¥½çš„ä¹ æƒ¯ï¼Œå°¤å…¶æ˜¯ä¸æ–­é‡æ„çš„ä¹ æƒ¯ï¼Œæ˜¯æ¯ä¸€ä¸ªä¼˜ç§€ç¨‹åºå‘˜éƒ½åº”è¯¥å…·å¤‡çš„ç´ è´¨ã€‚é‡æ„ï¼ˆRefactoringï¼‰å°±æ˜¯åœ¨ä¸æ”¹å˜è½¯ä»¶ç°æœ‰åŠŸèƒ½çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡è°ƒæ•´ç¨‹åºçš„ç»“æ„ã€æé«˜ç¨‹åºçš„è´¨é‡ã€ä¼˜åŒ–ç¨‹åºçš„æ€§èƒ½â€¦â€¦ä½¿å…¶ç¨‹åºçš„è®¾è®¡æ¨¡å¼å’Œæ¶æ„æ›´è¶‹åˆç†ï¼Œä»è€Œæé«˜è½¯ä»¶çš„ç¨³å®šæ€§ã€æ‰©å±•æ€§å’Œç»´æŠ¤æ€§ã€‚</p><p><br></p><p><strong>ä¸€ ä¸€ä¸ªéœ€è¦é‡æ„çš„æ–¹æ³•</strong></p><p><br></p><p><strong>éœ€æ±‚æè¿°ï¼š</strong></p><p><br></p><p>éœ€è¦æŠŠä¸€ä¸ªçº¿ä¸²ï¼ˆä¸€ç»„ç»çº¬åº¦åº§æ ‡ä¸²ï¼‰ï¼ŒæŒ‰ç…§æŒ‡å®šåˆ†æ®µé•¿åº¦æ•°ç»„è¿›è¡ŒæŒ‰æ¯”ä¾‹åˆ’åˆ†ï¼ˆç”±äºæŒ‡å®šçº¿ä¸²çš„é•¿åº¦è¾ƒå°ï¼Œå¯ä»¥è¿‘ä¼¼åœ°è®¤ä¸ºåœ¨å‡ ä½•å¹³é¢ä¸Šï¼Œæ— éœ€è¿›è¡Œçƒé¢è·ç¦»æ¢ç®—ï¼‰ã€‚</p><p><br></p><p><strong>ä»£ç å®ç°ï¼š</strong></p><p><br></p><pre><code>/** * å‡ ä½•è¾…åŠ©ç±» */publicÂ finalÂ classÂ GeometryHelperÂ {    /** å¸¸é‡ç›¸å…³ */    /** å°æ•°ä½æ•° */    private static final int DIGIT_SCALE = 8;    /** æ”¾å¤§æ¯”ä¾‹ */    private static final double ZOOM_SCALE = 10000000000L;    /** å‡ ä½•å·¥å‚ */Â Â Â Â privateÂ staticÂ finalÂ GeometryFactoryÂ GEOMETRY_FACTORYÂ =Â newÂ GeometryFactory(newÂ PrecisionModel(PrecisionModel.FLOATING));    /**     * æ„é€ æ–¹æ³•     */    private GeometryHelper() {        throw new UnsupportedOperationException();Â Â Â Â }    /**     * åˆ’åˆ†çº¿ä¸²     *      * @param lineString åŸå§‹çº¿ä¸²     * @param segmentLengthes åˆ†æ®µé•¿åº¦æ•°ç»„     * @return çº¿ä¸²æ•°ç»„     */    public static LineString[] splitLineString(LineString lineString, double[] segmentLengthes) {        // æ£€æŸ¥åˆ†æ®µæ•°é‡        if (Objects.isNull(segmentLengthes) || segmentLengthes.length &lt; 1) {            return new LineString[] {lineString};Â Â Â Â Â Â Â Â }        // è®¡ç®—æ€»å…±é•¿åº¦        double totalLength = Arrays.stream(segmentLengthes)            .map(segmentLength -&gt; Math.max(segmentLength, 0.0D))Â Â Â Â Â Â Â Â Â Â Â Â .sum();        // è®¡ç®—ç›®æ ‡é•¿åº¦        double lineLength = lineString.getLength();        long[] targetLengthes = Arrays.stream(segmentLengthes)            .mapToLong(segmentLength -&gt; getTargetLength(lineLength, totalLength, segmentLength))Â Â Â Â Â Â Â Â Â Â Â Â .toArray();        // åˆå§‹åŒ–å‚æ•°å€¼        int index = 1;        Coordinate[] coordinates = lineString.getCoordinates();        Coordinate coordinate = coordinates[0];        int length = targetLengthes.length;Â Â Â Â Â Â Â Â LineString[]Â lineStringsÂ =Â newÂ LineString[length];        // æ·»åŠ å‰é¢Næ®µ        for (int i = 0; i &lt; length - 1; i++) {            // æ·»åŠ çº¿ä¸²åº§æ ‡            long addupLength = 0L;            List&lt;Coordinate&gt; coordinateList = new ArrayList&lt;&gt;();            coordinateList.add(coordinate);            for (; index &lt; coordinates.length; index++) {                // è®¡ç®—åˆ†æ®µé•¿åº¦Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â longÂ segmentLengthÂ =Â Math.round(coordinate.distance(coordinates[index])Â *Â ZOOM_SCALE);                // æ ¹æ®é•¿åº¦å¤„ç†                boolean isBreak = true;                int compareResult = Long.compare(addupLength + segmentLength, targetLengthes[i]);                // æ ¹æ®é•¿åº¦å¤„ç†: æœªè¾¾ç›®æ ‡é•¿åº¦                if (compareResult &lt; 0) {                    addupLength += segmentLength;                    coordinate = coordinates[index];                    coordinateList.add(coordinate);                    isBreak = false;                }                // æ ¹æ®é•¿åº¦å¤„ç†: è¶…è¿‡ç›®æ ‡é•¿åº¦                else if (compareResult &gt; 0) {                    long deltaLength = targetLengthes[i] - addupLength;                    coordinate = buildMiddleCoordinate(coordinate, coordinates[index], segmentLength, deltaLength);                }                // æ ¹æ®é•¿åº¦å¤„ç†: ç­‰äºç›®æ ‡é•¿åº¦                else {                    index++;                    coordinate = coordinates[index];Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }                // æ˜¯å¦è·³å‡ºå¾ªç¯                if (isBreak) {                    break;                }            }Â Â Â Â Â Â Â Â Â Â Â Â coordinateList.add(coordinate);            // è®¾ç½®çº¿ä¸²å¯¹è±¡            lineStrings[i] = buildLineString(coordinateList);Â Â Â Â Â Â Â Â }        // æ·»åŠ æœ€åä¸€æ®µÂ Â Â Â Â Â Â Â lineStrings[lengthÂ -Â 1]Â =Â buildLineString(coordinates,Â index,Â coordinate);        // è¿”å›çº¿ä¸²æ•°ç»„        return lineStrings;Â Â Â Â }    /**     * æ„å»ºçº¿ä¸²     *      * @param coordinates åº§æ ‡æ•°ç»„     * @param index å½“å‰åºå·     * @param coordinate å½“å‰åº§æ ‡     * @return çº¿ä¸²     */    private static LineString buildLineString(Coordinate[] coordinates, int index, Coordinate coordinate) {        List&lt;Coordinate&gt; coordinateList = new ArrayList&lt;&gt;();        coordinateList.add(coordinate);        coordinateList.addAll(Arrays.asList(ArrayUtils.subarray(coordinates, index, coordinates.length)));        return buildLineString(coordinateList);Â Â Â Â }    /**     * æ„å»ºçº¿ä¸²     *      * @param coordinateList åº§æ ‡åˆ—è¡¨     * @return çº¿ä¸²     */    private static LineString buildLineString(List&lt;Coordinate&gt; coordinateList) {        return GEOMETRY_FACTORY.createLineString(coordinateList.toArray(new Coordinate[0]));Â Â Â Â }    /**     * æ„å»ºä¸­é—´åº§æ ‡     *      * @param coordinate1 åº§æ ‡1     * @param coordinate2 åº§æ ‡2     * @param segmentLength åˆ†æ®µé•¿åº¦     * @param deltaLength å¢é‡é•¿åº¦     * @return ä¸­é—´åº§æ ‡     */    private static Coordinate buildMiddleCoordinate(Coordinate coordinate1, Coordinate coordinate2,        long segmentLength, long deltaLength) {        double deltaScale = deltaLength * 1.0D / segmentLength;        double middleX = round(coordinate1.x + (coordinate2.x - coordinate1.x) * deltaScale, DIGIT_SCALE);        double middleY = round(coordinate1.y + (coordinate2.y - coordinate1.y) * deltaScale, DIGIT_SCALE);        return new Coordinate(middleX, middleY);Â Â Â Â }    /**     * è·å–ç›®æ ‡é•¿åº¦     *      * @param lineLength çº¿è·¯é•¿åº¦     * @param totalLength æ€»å…±é•¿åº¦     * @param segmentLength æ®µé•¿åº¦     * @return ç›®æ ‡é•¿åº¦     */    private static long getTargetLength(double lineLength, double totalLength, double segmentLength) {        return Math.round(Math.max(segmentLength, 0.0D) * ZOOM_SCALE * lineLength / totalLength);Â Â Â Â }    /**     * å››èˆäº”å…¥     *      * @param value åŒç²¾åº¦æµ®ç‚¹å€¼     * @param scale ä¿ç•™å°æ•°ä½æ•°     * @return å››èˆäº”å…¥å€¼     */    private static double round(double value, int scale) {        return BigDecimal.valueOf(value).setScale(scale, BigDecimal.ROUND_HALF_UP).doubleValue();Â Â Â Â }Â Â Â Â Â Â }</code></pre><p><br></p><p><strong>å¤‡æ³¨è¯´æ˜ï¼š</strong></p><p><br></p><p>åœ¨è¶…è¿‡ç›®æ ‡é•¿åº¦æ—¶ï¼Œè·å–äº†ä¸€ä¸ªä¸­é—´åº§æ ‡ï¼Œç”±äºæ•°æ®ç²¾åº¦çš„å…³ç³»ï¼Œè¿™ä¸ªåº§æ ‡å¯èƒ½è·Ÿä¸Šä¸€åº§æ ‡æˆ–ä¸‹ä¸€åº§æ ‡é‡åˆã€‚è¿™é‡Œä¸ºäº†é™ä½è¿™å—é€»è¾‘çš„å¤æ‚åº¦ï¼Œæ²¡æœ‰è¿›è¡Œå‰ååº§æ ‡çš„å»é‡å¤„ç†ã€‚</p><p><br></p><p><strong>å­˜åœ¨é—®é¢˜ï¼š</strong></p><p><br></p><p>åœ¨æ–¹æ³•splitLineStringï¼ˆåˆ’åˆ†çº¿ä¸²ï¼‰ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªä¸¤å±‚å¾ªç¯ï¼Œå¯¼è‡´äº†æ–¹æ³•é€»è¾‘å¤æ‚ã€å±‚çº§è¾ƒæ·±ã€ä»£ç é‡å¤§ã€‚å¦‚æœæŠŠå¤–å±‚å¾ªç¯ä½“æç‚¼ä¸ºä¸€ä¸ªæ–¹æ³•ï¼Œå°±èƒ½å¤Ÿä½¿ä»£ç æ›´ç®€æ´ã€æ›´æ¸…æ™°ã€æ›´å®¹æ˜“ç»´æŠ¤ã€‚</p><p><br></p><p><strong>äºŒ ä¸€æ¬¡å¤±è´¥çš„é‡æ„ç»å†</strong></p><p><br></p><p><strong>ç†è®ºä¾æ®ï¼š</strong></p><p><br></p><p>å½“çœ‹åˆ°ä¸€ä¸ªæ–¹æ³•å®šä¹‰è¿‡é•¿æˆ–è€…è¿™æ®µæ–¹æ³•éœ€è¦å¾ˆå¤šæ³¨é‡Šæ‰èƒ½è®©äººç†è§£çš„æ—¶å€™ï¼Œè¿™æ—¶å€™å°±è¦è€ƒè™‘æ˜¯ä¸æ˜¯æŠŠè¿™ä¸ªæ–¹æ³•çš„éƒ¨åˆ†ä»£ç æå–å‡ºæ¥ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼Œæ–¹ä¾¿è°ƒç”¨å’Œç†è§£ï¼ŒåŒæ—¶ä¹Ÿå‡å°æ–¹æ³•çš„ç²’åº¦ã€‚æˆ‘ä»¬æŠŠè¿™ç§æ–¹æ³•å«åšæç‚¼å‡½æ•°ï¼ˆExtract Functionï¼‰ï¼Œåœ¨Javaè¯­è¨€ä¸­å¯å«åšæç‚¼æ–¹æ³•ï¼ˆExtract Methodï¼‰ã€‚</p><p><br></p><p><strong>é‡æ„æ­¥éª¤ï¼š</strong></p><p><br></p><ul><li>åˆ›å»ºä¸€ä¸ªæ–°æ–¹æ³•ï¼Œå¹¶æ ¹æ®è¿™ä¸ªæ–¹æ³•çš„æ„å›¾æ¥å‘½åï¼›</li></ul><p><br></p><ul><li>å°†å¾…æç‚¼çš„ä»£ç æ®µä»åŸæ–¹æ³•ä¸­æ‹·è´åˆ°æ–°æ–¹æ³•ä¸­ï¼›</li></ul><p><br></p><ul><li>æ£€æŸ¥æç‚¼çš„ä»£ç æ®µï¼ŒæŠŠç¼ºå°‘çš„å˜é‡æ·»åŠ åˆ°æ–¹æ³•çš„å‚æ•°ä¸­ï¼›</li></ul><p><br></p><ul><li>å¦‚æœéƒ¨åˆ†å‚æ•°æˆå¯¹å‡ºç°ï¼Œå¯ä»¥æŠŠè¿™äº›å‚æ•°åˆå¹¶ä¸ºä¸€ä¸ªå‚æ•°ï¼›</li></ul><p><br></p><ul><li>å¦‚æœæ–¹æ³•éœ€è¦æœ‰è¿”å›å€¼ï¼Œç¡®å®šè¿”å›å€¼çš„ç±»å‹ï¼Œå¹¶åœ¨åˆé€‚çš„ä½ç½®è¿”å›ï¼›</li></ul><p><br></p><ul><li>åœ¨åŸæ–¹æ³•ä¸­ï¼Œåˆ é™¤è¢«æç‚¼çš„ä»£ç æ®µï¼Œæ›¿æ¢ä¸ºæ–°æ–¹æ³•çš„è°ƒç”¨ã€‚</li></ul><p><br></p><p><strong>ä»£ç å®ç°ï¼š</strong></p><p style=text-align:justify><br></p><pre><code>/** * å‡ ä½•è¾…åŠ©ç±» */publicÂ finalÂ classÂ GeometryHelperÂ {    /** åŸæœ‰é™æ€å¸¸é‡ */Â Â Â Â ......    /**     * åˆ’åˆ†çº¿ä¸²     *      * @param lineString åŸå§‹çº¿ä¸²     * @param segmentLengthes åˆ†æ®µé•¿åº¦æ•°ç»„     * @return çº¿ä¸²æ•°ç»„     */    public static LineString[] splitLineString(LineString lineString, double[] segmentLengthes) {        // åŸæœ‰è®¡ç®—é€»è¾‘Â Â Â Â Â Â Â Â ......        // åˆå§‹åŒ–å‚æ•°å€¼        int index = 1;        Coordinate[] coordinates = lineString.getCoordinates();        Coordinate coordinate = coordinates[0];        int length = targetLengthes.length;Â Â Â Â Â Â Â Â LineString[]Â lineStringsÂ =Â newÂ LineString[length];        // æ·»åŠ å‰é¢Næ®µ        for (int i = 0; i &lt; length - 1; i++) {            lineStrings[i] = combineLineString(coordinates, index, coordinate, targetLengthes[i]);Â Â Â Â Â Â Â Â }        // æ·»åŠ æœ€åä¸€æ®µÂ Â Â Â Â Â Â Â lineStrings[lengthÂ -Â 1]Â =Â buildLineString(coordinates,Â index,Â coordinate);        // è¿”å›çº¿ä¸²æ•°ç»„        return lineStrings;Â Â Â Â }    /**     * ç»„è£…çº¿ä¸²     *      * @param coordinates åº§æ ‡æ•°ç»„     * @param index å½“å‰åºå·     * @param coordinate å½“å‰åº§æ ‡     * @param targetLength ç›®æ ‡é•¿åº¦     * @return çº¿ä¸²     */    private static LineString combineLineString(Coordinate[] coordinates, int index, Coordinate coordinate, long targetLength) {        // æ·»åŠ çº¿ä¸²åº§æ ‡        long addupLength = 0L;        List&lt;Coordinate&gt; coordinateList = new ArrayList&lt;&gt;();        coordinateList.add(coordinate);        for (; index &lt; coordinates.length; index++) {            // è®¡ç®—åˆ†æ®µé•¿åº¦Â Â Â Â Â Â Â Â Â Â Â Â longÂ segmentLengthÂ =Â Math.round(coordinate.distance(coordinates[index])Â *Â ZOOM_SCALE);            // æ ¹æ®é•¿åº¦å¤„ç†            boolean isBreak = true;            int compareResult = Long.compare(addupLength + segmentLength, targetLength);            // æ ¹æ®é•¿åº¦å¤„ç†: æœªè¾¾ç›®æ ‡é•¿åº¦            if (compareResult &lt; 0) {                addupLength += segmentLength;                coordinate = coordinates[index];                coordinateList.add(coordinate);                isBreak = false;            }            // æ ¹æ®é•¿åº¦å¤„ç†: è¶…è¿‡ç›®æ ‡é•¿åº¦            else if (compareResult &gt; 0) {                long deltaLength = targetLength - addupLength;                coordinate = buildMiddleCoordinate(coordinate, coordinates[index], segmentLength, deltaLength);            }            // æ ¹æ®é•¿åº¦å¤„ç†: ç­‰äºç›®æ ‡é•¿åº¦            else {                index++;                coordinate = coordinates[index];Â Â Â Â Â Â Â Â Â Â Â Â }            // æ˜¯å¦è·³å‡ºå¾ªç¯            if (isBreak) {                break;            }        }Â Â Â Â Â Â Â Â coordinateList.add(coordinate);        // è¿”å›çº¿ä¸²å¯¹è±¡        return buildLineString(coordinateList);Â Â Â Â }    /** åŸæœ‰é™æ€æ–¹æ³• */Â Â Â Â ......}</code></pre><p><br></p><p><strong>å­˜åœ¨é—®é¢˜ï¼š</strong></p><p><br></p><p>ç²—çœ‹è¿™æ®µä»£ç ï¼Œä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ä½†æ˜¯ï¼Œé€šè¿‡æµ‹è¯•å‘ç°ï¼Œå¹¶æ²¡æœ‰å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚</p><p><br></p><p><strong>åˆ†æåŸå› ï¼š</strong></p><p><br></p><p>åœ¨ã€ŠThinking in Javaã€‹ä¸­æœ‰è¿™æ ·ä¸€æ®µè¯ï¼š</p><p><br></p><blockquote><p>When youâ€™re passing primitives into a methodï¼Œyou get a distinct copy of the primitive. When youâ€™re passing a reference into a method, you get a copy of the reference.</p><p><br></p><p>å½“æ‚¨å°†åŸºæœ¬ç±»å‹ä¼ é€’åˆ°æ–¹æ³•ä¸­æ—¶ï¼Œæ‚¨å°†å¾—åˆ°è¯¥åŸºæœ¬ç±»å‹çš„å‰¯æœ¬ã€‚å½“æ‚¨å°†å¯¹è±¡å¼•ç”¨ä¼ é€’åˆ°æ–¹æ³•ä¸­æ—¶ï¼Œæ‚¨å°†å¾—åˆ°è¯¥å¯¹è±¡å¼•ç”¨çš„å‰¯æœ¬ã€‚</p></blockquote><p style=text-align:justify><br></p><p>åŸæ¥å‚æ•°indexï¼ˆå½“å‰åºå·ï¼‰å’Œcoordinateï¼ˆå½“å‰åº§æ ‡ï¼‰åœ¨æ–¹æ³•combineLineStringï¼ˆç»„è£…çº¿ä¸²ï¼‰ä¸­çš„ä¿®æ”¹ï¼Œåªæ˜¯å¯¹è¯¥æ–¹æ³•ä¸­çš„å‚æ•°å‰¯æœ¬è¿›è¡Œä¿®æ”¹ï¼Œå¹¶æ²¡æœ‰ä½“ç°åˆ°è°ƒç”¨æ–¹æ³•splitLineStringï¼ˆåˆ’åˆ†çº¿ä¸²ï¼‰ä¸­ï¼Œä»è€Œå¯¼è‡´æ¯æ¬¡è°ƒç”¨éƒ½åœ¨ä½¿ç”¨å‚æ•°çš„åˆå§‹åŒ–å€¼ã€‚å…¶å®ï¼Œè¿™æ˜¯åœ¨æå–æ–¹æ³•çš„è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰è€ƒè™‘åˆ°å‚æ•°çš„ä½œç”¨åŸŸã€‚</p><p><br></p><p><strong>æ£€æŸ¥æŠ€å·§ï¼š</strong></p><p><br></p><p>è¿™é‡Œç»™å‡ºä¸€ä¸ªä½œè€…å±¡è¯•ä¸çˆ½çš„æ£€æŸ¥æŠ€å·§â€”â€”æŠŠæå–æ–¹æ³•çš„æ‰€æœ‰å‚æ•°æ·»åŠ ä¸Šfinalå…³é”®å­—ï¼Œç¼–è¯‘åè§‚å¯Ÿåˆ°å“ªä¸ªå‚æ•°å‡ºç°ç¼–è¯‘é”™è¯¯ï¼Œå°±è¯´æ˜è¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªè¾“å…¥è¾“å‡ºå‚æ•°ï¼ˆInout Parameterï¼‰ã€‚</p><p><br></p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><p><br></p><p>åœ¨Javaè¯­è¨€ä¸­ï¼Œæ²¡æœ‰ç›´æ¥çš„è¾“å…¥è¾“å‡ºå‚æ•°æœºåˆ¶ï¼Œæ— æ³•ç®€å•åœ°å®ç°å‚æ•°çš„è¾“å…¥è¾“å‡ºåŠŸèƒ½ã€‚æ‰€ä»¥ï¼Œéœ€è¦å€ŸåŠ©å…¶å®ƒè§£å†³æ–¹æ¡ˆï¼Œæ¥å®ç°å‚æ•°çš„è¾“å…¥è¾“å‡ºåŠŸèƒ½ã€‚åœ¨è¿™é‡Œï¼Œä½œè€…é€šè¿‡å®è·µæ€»ç»“ï¼Œç»™å‡ºäº†ä»¥ä¸‹å‡ ç§è§£å†³æ–¹æ¡ˆã€‚</p><p><br></p><p><strong>ä¸‰ åˆ©ç”¨æ–¹æ³•å‚æ•°å®ç°</strong></p><p><br></p><p>æœ¬ç« å°†ä»æ–¹æ³•å‚æ•°å…¥æ‰‹ï¼Œå®ç°å‚æ•°çš„è¾“å…¥è¾“å‡ºåŠŸèƒ½ã€‚</p><p><br></p><p>3.1 åˆ©ç”¨å‚æ•°ç±»å®ç°</p><p><br></p><p><strong>ç†è®ºä¾æ®ï¼š</strong></p><p><br></p><p>å¼•å…¥å‚æ•°å¯¹è±¡ï¼ˆIntroduce Parameter Objectï¼‰ï¼šå½“ä¸€ä¸ªæ–¹æ³•çš„å‚æ•°è¶…è¿‡3ä¸ªæ—¶ï¼Œå°±å¯ä»¥è€ƒè™‘å°†å‚æ•°å°è£…æˆä¸€ä¸ªå¯¹è±¡ç±»ã€‚å°†å‚æ•°å°è£…æˆå¯¹è±¡ç±»åï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§ï¼Œå¹¶ä¸”è¯¥å‚æ•°å¯¹è±¡ç±»ä¹Ÿå¯ä»¥é‡ç”¨ã€‚ä»¥åï¼Œå¦‚æœå¢åŠ æˆ–åˆ é™¤å‚æ•°ï¼Œæ–¹æ³•æœ¬èº«ä¸éœ€è¦ä¿®æ”¹ï¼Œåªéœ€è¦ä¿®æ”¹å‚æ•°å¯¹è±¡ç±»å°±å¯ä»¥äº†ã€‚</p><p><br></p><p>è¿™é‡Œï¼Œå¯ä»¥åˆ©ç”¨å¼•å…¥å‚æ•°å¯¹è±¡é‡æ„æ–¹æ³•ï¼Œå®šä¹‰ä¸€ä¸ªè¾“å…¥è¾“å‡ºå‚æ•°ç±»ï¼Œæ¥å®ç°å‚æ•°çš„è¾“å…¥è¾“å‡ºåŠŸèƒ½ã€‚</p><p><br></p><p><strong>ä»£ç å®ç°ï¼š</strong></p><p><br></p><pre><code>/** * å‡ ä½•è¾…åŠ©ç±» */publicÂ finalÂ classÂ GeometryHelperÂ {    /** åŸæœ‰é™æ€å¸¸é‡ */Â Â Â Â ......    /**     * åˆ’åˆ†çº¿ä¸²     *      * @param lineString åŸå§‹çº¿ä¸²     * @param segmentLengthes åˆ†æ®µé•¿åº¦æ•°ç»„     * @return çº¿ä¸²æ•°ç»„     */    public static LineString[] splitLineString(LineString lineString, double[] segmentLengthes) {        // åŸæœ‰è®¡ç®—é€»è¾‘Â Â Â Â Â Â Â Â ......        // åˆå§‹åŒ–å‚æ•°å€¼        Coordinate[] coordinates = lineString.getCoordinates();        InoutParameter inoutParameter = new InoutParameter(1, coordinates[0]);        int length = targetLengthes.length;Â Â Â Â Â Â Â Â LineString[]Â lineStringsÂ =Â newÂ LineString[length];        // æ·»åŠ å‰é¢Næ®µ        for (int i = 0; i &lt; length - 1; i++) {            lineStrings[i] = combineLineString(coordinates, inoutParameter, targetLengthes[i]);Â Â Â Â Â Â Â Â }        // æ·»åŠ æœ€åä¸€æ®µÂ Â Â Â Â Â Â Â lineStrings[lengthÂ -Â 1]Â =Â buildLineString(coordinates,Â inoutParameter.getIndex(),Â inoutParameter.getCoordinate());        // è¿”å›çº¿ä¸²æ•°ç»„        return lineStrings;Â Â Â Â }    /**     * ç»„è£…çº¿ä¸²     *      * @param coordinates åº§æ ‡æ•°ç»„     * @param inoutParameter è¾“å…¥è¾“å‡ºå‚æ•°     * @param targetLength ç›®æ ‡é•¿åº¦     * @return çº¿ä¸²     */    private static LineString combineLineString(Coordinate[] coordinates, InoutParameter inoutParameter, long targetLength) {        // è·å–è¾“å…¥å‚æ•°        int index = inoutParameter.getIndex();Â Â Â Â Â Â Â Â CoordinateÂ coordinateÂ =Â inoutParameter.getCoordinate();        // æ·»åŠ çº¿ä¸²åº§æ ‡Â Â Â Â Â Â Â Â ......        // è®¾ç½®è¾“å‡ºå‚æ•°        inoutParameter.setIndex(index);Â Â Â Â Â Â Â Â inoutParameter.setCoordinate(coordinate);        // è¿”å›çº¿ä¸²å¯¹è±¡        return buildLineString(coordinateList);Â Â Â Â }    /** åŸæœ‰é™æ€æ–¹æ³• */Â Â Â Â ......    /**     * è¾“å…¥è¾“å‡ºå‚æ•°ç±»     */    @Getter    @Setter    @ToString    @NoArgsConstructor    @AllArgsConstructor    private static class InoutParameter {        /** å½“å‰åºå· */        private int index;        /** å½“å‰åº§æ ‡ */        private Coordinate coordinate;Â Â Â Â }}</code></pre><p><br></p><p>3.2 åˆ©ç”¨å•å€¼æ•°ç»„å®ç°</p><p><br></p><p><strong>ç†è®ºä¾æ®ï¼š</strong></p><p><br></p><p>å½“æ‚¨å°†å¯¹è±¡å¼•ç”¨ä¼ é€’åˆ°æ–¹æ³•ä¸­æ—¶ï¼Œæ‚¨å°†å¾—åˆ°è¯¥å¯¹è±¡å¼•ç”¨çš„å‰¯æœ¬ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ‚¨å°†æ•°ç»„å¼•ç”¨ä¼ é€’åˆ°æ–¹æ³•ä¸­æ—¶ï¼Œæ‚¨å°†å¾—åˆ°è¯¥æ•°ç»„å¼•ç”¨çš„å‰¯æœ¬ã€‚ä½†æ˜¯ï¼Œè¿™ä¸¤ä¸ªæ•°ç»„å¼•ç”¨éƒ½æŒ‡å‘åŒä¸€ä¸ªæ•°ç»„ï¼Œå½“ä¿®æ”¹å‰¯æœ¬æ•°ç»„å¼•ç”¨ä¸­çš„å€¼æ—¶ï¼Œä¹Ÿèƒ½ä½“ç°åˆ°åŸæœ‰æ•°ç»„å¼•ç”¨ä¸­ã€‚</p><p><br></p><p>åˆ©ç”¨æ•°ç»„å¼•ç”¨çš„è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥å®ç°å‚æ•°çš„è¾“å…¥è¾“å‡ºåŠŸèƒ½ã€‚è¿™é‡Œï¼Œå¼•å…¥äº†å•å€¼æ•°ç»„çš„æ¦‚å¿µï¼Œå³ä¸€ä¸ªæ•°ç»„åªæœ‰ä¸€ä¸ªå€¼ï¼Œç”¨äºä¼ é€’è¾“å…¥è¾“å‡ºå‚æ•°å€¼ã€‚</p><p><br></p><p><strong>ä»£ç å®ç°ï¼š</strong></p><p><br></p><pre><code>/** * å‡ ä½•è¾…åŠ©ç±» */publicÂ finalÂ classÂ GeometryHelperÂ {    /** åŸæœ‰é™æ€å¸¸é‡ */Â Â Â Â ......    /**     * åˆ’åˆ†çº¿ä¸²     *      * @param lineString åŸå§‹çº¿ä¸²     * @param segmentLengthes åˆ†æ®µé•¿åº¦æ•°ç»„     * @return çº¿ä¸²æ•°ç»„     */    public static LineString[] splitLineString(LineString lineString, double[] segmentLengthes) {        // åŸæœ‰è®¡ç®—é€»è¾‘Â Â Â Â Â Â Â Â ......        // åˆå§‹åŒ–å‚æ•°å€¼        int[] indexHolder = new int[] {1};        Coordinate[] coordinates = lineString.getCoordinates();        Coordinate[] coordinateHolder = new Coordinate[] {coordinates[0]};        int length = targetLengthes.length;Â Â Â Â Â Â Â Â LineString[]Â lineStringsÂ =Â newÂ LineString[length];        // æ·»åŠ å‰é¢Næ®µ        for (int i = 0; i &lt; length - 1; i++) {            lineStrings[i] = combineLineString(coordinates, indexHolder, coordinateHolder, targetLengthes[i]);Â Â Â Â Â Â Â Â }        // æ·»åŠ æœ€åä¸€æ®µÂ Â Â Â Â Â Â Â lineStrings[lengthÂ -Â 1]Â =Â buildLineString(coordinates,Â indexHolder[0],Â coordinateHolder[0]);        // è¿”å›çº¿ä¸²æ•°ç»„        return lineStrings;Â Â Â Â }    /**     * ç»„è£…çº¿ä¸²     *      * @param coordinates åº§æ ‡æ•°ç»„     * @param indexHolder åºå·æ”¯æ’‘     * @param coordinateHolder åº§æ ‡æ”¯æ’‘     * @param targetLength ç›®æ ‡é•¿åº¦     * @return çº¿ä¸²     */    private static LineString combineLineString(Coordinate[] coordinates, int[] indexHolder, Coordinate[] coordinateHolder, long targetLength) {        // è·å–æ”¯æ’‘å–å€¼        int index = indexHolder[0];Â Â Â Â Â Â Â Â CoordinateÂ coordinateÂ =Â coordinateHolder[0];        // æ·»åŠ çº¿ä¸²åº§æ ‡Â Â Â Â Â Â Â Â ......        // è®¾ç½®æ”¯æ’‘å–å€¼        indexHolder[0] = index;Â Â Â Â Â Â Â Â coordinateHolder[0]Â =Â coordinate;        // è¿”å›çº¿ä¸²å¯¹è±¡        return buildLineString(coordinateList);Â Â Â Â }    /** åŸæœ‰é™æ€æ–¹æ³• */Â Â Â Â ......}</code></pre><p><br></p><p>3.3 åˆ©ç”¨å…ƒç»„ç±»å®ç°</p><p><br></p><p><strong>ç†è®ºä¾æ®ï¼š</strong></p><p><br></p><p>å…ƒç»„ï¼ˆTupleï¼‰ï¼šJavaä¸­çš„å…ƒç»„ï¼ˆTupleï¼‰æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯ä»¥å­˜æ”¾å¤šä¸ªå…ƒç´ ï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ çš„æ•°æ®ç±»å‹å¯ä»¥ä¸åŒã€‚Tupleä¸Listç±»ä¼¼ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ï¼ŒListåªèƒ½å­˜å‚¨ä¸€ç§æ•°æ®ç±»å‹ï¼Œè€ŒTupleå¯å­˜å‚¨å¤šç§æ•°æ®ç±»å‹ã€‚</p><p><br></p><p>å¯èƒ½ä½ ä¼šè´¨ç–‘ï¼ŒObjectç±»å‹çš„Listå®é™…ä¹Ÿæ˜¯å¯ä»¥å­˜å‚¨å¤šç§ç±»å‹çš„å•Šï¼Ÿä½†æ˜¯ï¼Œåœ¨åˆ›å»ºListæ—¶ï¼Œéœ€è¦æŒ‡å®šå…ƒç´ æ•°æ®ç±»å‹ï¼Œåªèƒ½æŒ‡å®šä¸ºObjectç±»å‹ï¼›åœ¨è·å–çš„å…ƒç´ æ—¶ï¼Œåªèƒ½è·å–åˆ°Objectç±»å‹çš„å€¼ï¼Œéœ€è¦å¼ºåˆ¶è½¬åŒ–ä¸ºå¯¹åº”çš„æ•°æ®ç±»å‹ã€‚è€ŒTupleåœ¨åˆ›å»ºæ—¶ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šå¤šä¸ªå…ƒç´ æ•°æ®ç±»å‹ï¼›åœ¨è·å–å…ƒç´ æ—¶ï¼Œæ— éœ€è¿›è¡Œæ•°æ®ç±»å‹çš„å¼ºåˆ¶è½¬åŒ–ã€‚</p><p><br></p><p>å¸¸ç”¨çš„å…ƒç»„å·¥å…·åŒ…æœ‰ï¼š</p><p><br></p><ul><li>Apacheçš„commons-lang3æä¾›çš„å…ƒç»„ç±»ï¼š</li></ul><p><br></p><ul><li>Pair&lt;L, R>ï¼šMutablePair&lt;L, R>ï¼ŒImmutablePair&lt;L, R></li><li>Triple&lt;L, M, R>ï¼šMutableTriple&lt;L, M, R>ã€ImmutableTriple&lt;L, M, R></li></ul><p><br></p><ul><li>JavaTuplesæä¾›çš„å…ƒç»„ç±»ï¼š</li></ul><p><br></p><ul><li>Unit&lt;A></li><li>Pair&lt;A,B>ï¼ŒKeyValue&lt;A,B></li><li>Triplet&lt;A,B,C></li><li>Quartet&lt;A,B,C,D></li><li>Quintet&lt;A,B,C,D,E></li><li>Sextet&lt;A,B,C,D,E,F></li><li>Septet&lt;A,B,C,D,E,F,G></li><li>Octet&lt;A,B,C,D,E,F,G,H></li><li>Ennead&lt;A,B,C,D,E,F,G,H,I></li><li>Decade&lt;A,B,C,D,E,F,G,H,I,J></li></ul><p><br></p><p>éšç€å…ƒç»„çš„å…ƒæ•°ä¸æ–­åœ°å¢åŠ ï¼Œä»£ç çš„é˜…è¯»æ€§ä¹Ÿé€æ¸åœ°ä¸‹é™ã€‚å½“å…ƒç»„çš„å…ƒæ•°è¶…è¿‡3ä¸ªæ—¶ï¼Œä¸å¦‚ç›´æ¥åˆ›å»ºå¯¹è±¡ç±»ï¼Œå¹¶ç»™äºˆåˆé€‚ç±»åå’Œå­—æ®µåï¼Œä¾¿äºä»£ç çš„ç†è§£å’Œç»´æŠ¤ã€‚æ‰€ä»¥ï¼Œä¸å»ºè®®ä½¿ç”¨JavaTuplesä¸­çš„å…ƒç»„ç±»ï¼Œè€Œæ¨èä½¿ç”¨Apacheçš„commons-lang3æä¾›çš„å…ƒç»„ç±»ã€‚</p><p><br></p><p><strong>ä»£ç å®ç°ï¼š</strong></p><p><br></p><pre><code>/** * å‡ ä½•è¾…åŠ©ç±» */publicÂ finalÂ classÂ GeometryHelperÂ {    /** åŸæœ‰é™æ€å¸¸é‡ */Â Â Â Â ......    /**     * åˆ’åˆ†çº¿ä¸²     *      * @param lineString åŸå§‹çº¿ä¸²     * @param segmentLengthes åˆ†æ®µé•¿åº¦æ•°ç»„     * @return çº¿ä¸²æ•°ç»„     */    public static LineString[] splitLineString(LineString lineString, double[] segmentLengthes) {        // åŸæœ‰è®¡ç®—é€»è¾‘Â Â Â Â Â Â Â Â ......        // åˆå§‹åŒ–å‚æ•°å€¼        Coordinate[] coordinates = lineString.getCoordinates();        MutablePair&lt;Integer, Coordinate&gt; mutablePair = MutablePair.of(1, coordinates[0]);        int length = targetLengthes.length;Â Â Â Â Â Â Â Â LineString[]Â lineStringsÂ =Â newÂ LineString[length];        // æ·»åŠ å‰é¢Næ®µ        for (int i = 0; i &lt; length - 1; i++) {            lineStrings[i] = combineLineString(coordinates, mutablePair, targetLengthes[i]);Â Â Â Â Â Â Â Â }        // æ·»åŠ æœ€åä¸€æ®µÂ Â Â Â Â Â Â Â lineStrings[lengthÂ -Â 1]Â =Â buildLineString(coordinates,Â mutablePair.getLeft(),Â mutablePair.getRight());        // è¿”å›çº¿ä¸²æ•°ç»„        return lineStrings;Â Â Â Â }    /**     * ç»„è£…çº¿ä¸²     *      * @param coordinates åº§æ ‡æ•°ç»„     * @param mutablePair å½“å‰é…å¯¹     * @param targetLength ç›®æ ‡é•¿åº¦     * @return çº¿ä¸²     */    private static LineString combineLineString(Coordinate[] coordinates, MutablePair&lt;Integer, Coordinate&gt; mutablePair,        long targetLength) {        // è·å–é…å¯¹å–å€¼        int index = mutablePair.getLeft();Â Â Â Â Â Â Â Â CoordinateÂ coordinateÂ =Â mutablePair.getRight();        // æ·»åŠ çº¿ä¸²åº§æ ‡Â Â Â Â Â Â Â Â ......        // è®¾ç½®é…å¯¹å–å€¼        mutablePair.setLeft(index);Â Â Â Â Â Â Â Â mutablePair.setRight(coordinate);        // è¿”å›çº¿ä¸²å¯¹è±¡        return buildLineString(coordinateList);Â Â Â Â }    /** åŸæœ‰é™æ€æ–¹æ³• */Â Â Â Â ......}</code></pre><p><br></p><p>3.4 åˆ©ç”¨æ”¯æ’‘ç±»å®ç°</p><p><br></p><p><strong>ç†è®ºä¾æ®ï¼š</strong></p><p><br></p><p>åœ¨ä¸Šä¸€èŠ‚é‡Œï¼ŒæŠŠæ‰€æœ‰è¾“å…¥è¾“å‡ºå‚æ•°æ”¾å…¥åˆ°ä¸€ä¸ªå…ƒç»„é‡Œï¼Œæ¯ä¸€ä¸ªè¾“å…¥è¾“å‡ºå‚æ•°æ²¡æœ‰ä¸€ä¸ªå…·ä½“çš„å‘½åï¼Œé€ æˆäº†ä»£ç çš„ç†è§£å’Œç»´æŠ¤å›°éš¾ã€‚å¦‚æœæ¯ä¸€ä¸ªè¾“å…¥è¾“å‡ºå‚æ•°éƒ½å®šä¹‰ä¸€ä¸ªå…ƒç»„ï¼Œå¯ä»¥è®©ä»£ç ç»´æŠ¤è€…è½»æ¾åœ°çŸ¥é“æ¯ä¸€ä¸ªå‚æ•°çš„å…·ä½“å«ä¹‰ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œå®šä¹‰äº†è‡ªå·±çš„ä¸€å…ƒå…ƒç»„ç±»â€”â€”ObjectHolderï¼ˆå¯¹è±¡æ”¯æ’‘ç±»ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨javatuplesçš„Unitç±»ï¼‰ï¼Œç”¨äºä¼ é€’è¾“å…¥è¾“å‡ºå‚æ•°å€¼ã€‚</p><p><br></p><p><strong>ä»£ç å®ç°ï¼š</strong></p><p><br></p><pre><code>/** * å‡ ä½•è¾…åŠ©ç±» */publicÂ finalÂ classÂ GeometryHelperÂ {    /** åŸæœ‰é™æ€å¸¸é‡ */Â Â Â Â ......    /**     * åˆ’åˆ†çº¿ä¸²     *      * @param lineString åŸå§‹çº¿ä¸²     * @param segmentLengthes åˆ†æ®µé•¿åº¦æ•°ç»„     * @return çº¿ä¸²æ•°ç»„     */    public static LineString[] splitLineString(LineString lineString, double[] segmentLengthes) {        // åŸæœ‰è®¡ç®—é€»è¾‘Â Â Â Â Â Â Â Â ......        // åˆå§‹åŒ–å‚æ•°å€¼        Coordinate[] coordinates = lineString.getCoordinates();        ObjectHolder&lt;Integer&gt; indexHolder = new ObjectHolder&lt;&gt;(1);        ObjectHolder&lt;Coordinate&gt; coordinateHolder = new ObjectHolder&lt;&gt;(coordinates[0]);        int length = targetLengthes.length;Â Â Â Â Â Â Â Â LineString[]Â lineStringsÂ =Â newÂ LineString[length];        // æ·»åŠ å‰é¢Næ®µ        for (int i = 0; i &lt; length - 1; i++) {            lineStrings[i] = combineLineString(coordinates, indexHolder, coordinateHolder, targetLengthes[i]);Â Â Â Â Â Â Â Â }        // æ·»åŠ æœ€åä¸€æ®µÂ Â Â Â Â Â Â Â lineStrings[lengthÂ -Â 1]Â =Â buildLineString(coordinates,Â indexHolder.getValue(),Â coordinateHolder.getValue());        // è¿”å›çº¿ä¸²æ•°ç»„        return lineStrings;Â Â Â Â }    /**     * ç»„è£…çº¿ä¸²     *      * @param coordinates åº§æ ‡æ•°ç»„     * @param indexHolder åºå·æ”¯æ’‘     * @param coordinateHolder åº§æ ‡æ”¯æ’‘     * @param targetLength ç›®æ ‡é•¿åº¦     * @return çº¿ä¸²     */    private static LineString combineLineString(Coordinate[] coordinates, ObjectHolder&lt;Integer&gt; indexHolder, ObjectHolder&lt;Coordinate&gt; coordinateHolder, long targetLength) {        // è·å–æ”¯æ’‘å–å€¼        int index = indexHolder.getValue();Â Â Â Â Â Â Â Â CoordinateÂ coordinateÂ =Â coordinateHolder.getValue();        // æ·»åŠ çº¿ä¸²åº§æ ‡Â Â Â Â Â Â Â Â ......        // è®¾ç½®æ”¯æ’‘å–å€¼        indexHolder.setValue(index);Â Â Â Â Â Â Â Â coordinateHolder.setValue(coordinate);        // è¿”å›çº¿ä¸²å¯¹è±¡        return buildLineString(coordinateList);Â Â Â Â }    /** åŸæœ‰é™æ€æ–¹æ³• */Â Â Â Â ......}/** * å¯¹è±¡æ”¯æ’‘ç±» */@Getter@Setter@ToString@NoArgsConstructor@AllArgsConstructorpublicÂ classÂ ObjectHolder&lt;T&gt;Â {    /** å¯¹è±¡å–å€¼ */Â Â Â Â privateÂ TÂ value;}</code></pre><p><br></p><p>3.5 åˆ©ç”¨å…¶å®ƒæ–¹æ³•å®ç°</p><p><br></p><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åˆ©ç”¨å…¶å®ƒå‚æ•°æ–¹æ³•å®ç°å‚æ•°çš„è¾“å…¥è¾“å‡ºåŠŸèƒ½ï¼š</p><p><br></p><p><strong>åˆ©ç”¨æ•°ç»„å®ç°</strong></p><p><br></p><p>é¦–å…ˆï¼Œåœ¨è°ƒç”¨å‡½æ•°ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼ŒæŠŠæ‰€æœ‰è¾“å…¥è¾“å‡ºå‚æ•°å­˜å…¥å¯¹è±¡æ•°ç»„ä¸­ï¼›å…¶æ¬¡ï¼Œåœ¨è¢«è°ƒç”¨å‡½æ•°ä¸­ï¼ŒæŠŠè¿™äº›å‚æ•°ä»å¯¹è±¡æ•°ç»„ä¸­å–å‡ºæ¥ä½¿ç”¨ï¼›å†æ¬¡ï¼Œåœ¨è¢«è°ƒç”¨å‡½æ•°ä¸­ï¼Œå†æŠŠè¿™äº›å‚æ•°å€¼å­˜å…¥å¯¹è±¡æ•°ç»„ä¸­ï¼›æœ€åï¼Œåœ¨è°ƒç”¨å‡½æ•°ä¸­ï¼ŒæŠŠè¿™äº›å‚æ•°å€¼ä»å¯¹è±¡æ•°ç»„ä¸­å–å‡ºæ¥ä½¿ç”¨ã€‚</p><p><br></p><p>åˆ©ç”¨å¯¹è±¡æ•°ç»„çš„é—®é¢˜æ˜¯â€”â€”ä»£ç å¯è¯»æ€§å¤ªå·®ï¼Œè€Œä¸”åœ¨å‚æ•°çš„å­˜å…¥å’Œå–å‡ºè¿‡ç¨‹ä¸­ï¼Œéœ€è¦è¿›è¡Œæ•°æ®ç±»å‹çš„å¼ºåˆ¶è½¬åŒ–ã€‚å¦‚æœæ‰€æœ‰è¾“å…¥è¾“å‡ºå‚æ•°çš„ç±»å‹ä¸€è‡´ï¼Œå¯ä»¥ç›´æ¥å®šä¹‰è¯¥ç±»å‹çš„æ•°ç»„ï¼Œä»è€Œé¿å…äº†æ•°æ®ç±»å‹çš„å¼ºåˆ¶è½¬åŒ–ã€‚</p><p><br></p><p><strong>åˆ©ç”¨Mapå®ç°</strong></p><p><br></p><p>é¦–å…ˆï¼Œåœ¨è°ƒç”¨å‡½æ•°ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªå¯¹è±¡Mapï¼ŒæŠŠæ‰€æœ‰è¾“å…¥è¾“å‡ºå‚æ•°å­˜å…¥å¯¹è±¡Mapä¸­ï¼›å…¶æ¬¡ï¼Œåœ¨è¢«è°ƒç”¨å‡½æ•°ä¸­ï¼ŒæŠŠè¿™äº›å‚æ•°ä»å¯¹è±¡Mapä¸­å–å‡ºæ¥ä½¿ç”¨ï¼›å†æ¬¡ï¼Œåœ¨è¢«è°ƒç”¨å‡½æ•°ä¸­ï¼Œå†æŠŠè¿™äº›å‚æ•°å€¼å­˜å…¥å¯¹è±¡Mapä¸­ï¼›æœ€åï¼Œåœ¨è°ƒç”¨å‡½æ•°ä¸­ï¼ŒæŠŠè¿™äº›å‚æ•°å€¼ä»å¯¹è±¡Mapä¸­å–å‡ºæ¥ä½¿ç”¨ã€‚</p><p><br></p><p>åˆ©ç”¨å¯¹è±¡Mapå®ç°ï¼Œä»£ç çš„å¯è¯»æ€§æ¯”åˆ©ç”¨å¯¹è±¡æ•°ç»„å®ç°æ›´å¼ºï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨åŒæ ·çš„é—®é¢˜â€”â€”åœ¨å‚æ•°çš„å­˜å…¥å’Œå–å‡ºè¿‡ç¨‹ä¸­ï¼Œéœ€è¦è¿›è¡Œæ•°æ®ç±»å‹çš„å¼ºåˆ¶è½¬åŒ–ã€‚å¦‚æœæ‰€æœ‰è¾“å…¥è¾“å‡ºå‚æ•°çš„ç±»å‹ä¸€è‡´ï¼Œå¯ä»¥ç›´æ¥å®šä¹‰è¯¥ç±»å‹çš„Mapï¼Œä»è€Œé¿å…äº†æ•°æ®ç±»å‹çš„å¼ºåˆ¶è½¬åŒ–ã€‚ä½†æ˜¯ï¼Œåˆ©ç”¨å¯¹è±¡Mapå®ç°ï¼Œè¿˜ä¸å¦‚å®šä¹‰ä¸€ä¸ªå‚æ•°ç±»æ›´å®ç”¨ã€‚</p><p><br></p><p><strong>åˆ©ç”¨åŸå­ç±»å®ç°</strong></p><p><br></p><p>JDKä¸­ï¼Œæä¾›äº†ä¸€å¥—åŸå­ç±»â€”â€”AtomicIntegerã€AtomicLongã€AtomicDoubleç­‰ï¼Œå¯ç”¨äºå¯¹åº”çš„åŸºç¡€ç±»å‹å’ŒåŒ…è£…ç±»å‹ï¼Œå®ç°å¯¹åº”å‚æ•°çš„è¾“å…¥è¾“å‡ºåŠŸèƒ½ã€‚å®ç°æ–¹æ³•è·ŸObjectHolderä¸€æ ·ï¼Œè¿™é‡Œä¸å†ç´¯è¿°ã€‚</p><p><br></p><p><strong>å›› åˆ©ç”¨æ–¹æ³•è¿”å›å€¼å®ç°</strong></p><p><br></p><p>æœ¬ç« å°†ä»æ–¹æ³•è¿”å›å€¼å…¥æ‰‹ï¼Œå®ç°å‚æ•°çš„è¾“å…¥è¾“å‡ºåŠŸèƒ½ã€‚</p><p><br></p><p>4.1 åˆ©ç”¨ç»“æœç±»å®ç°</p><p><br></p><p><strong>ç†è®ºä¾æ®ï¼š</strong></p><p><br></p><p>å¼•å…¥è¿”å›å€¼å¯¹è±¡ï¼ˆIntroduce Return Objectï¼‰ï¼šå½“ä¸€ä¸ªæ–¹æ³•çš„éœ€è¦è¿”å›å¤šä¸ªå€¼æ—¶ï¼Œå°±å¯ä»¥è€ƒè™‘å°†è¿”å›å€¼å°è£…æˆä¸€ä¸ªå¯¹è±¡ç±»ã€‚å°†è¿”å›å€¼å°è£…æˆå¯¹è±¡ç±»åï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§ï¼Œå¹¶ä¸”è¯¥è¿”å›å€¼å¯¹è±¡ç±»ä¹Ÿå¯ä»¥é‡ç”¨ã€‚ä»¥åï¼Œå¦‚æœå¢åŠ æˆ–åˆ é™¤è¿”å›å€¼ï¼Œæ–¹æ³•æœ¬èº«ä¸éœ€è¦ä¿®æ”¹ï¼Œåªéœ€è¦ä¿®æ”¹è¿”å›å€¼å¯¹è±¡ç±»å°±å¯ä»¥äº†ã€‚</p><p><br></p><p>è¿™é‡Œï¼Œå¯ä»¥åˆ©ç”¨å¼•å…¥è¿”å›å€¼å¯¹è±¡é‡æ„æ–¹æ³•ï¼Œå®šä¹‰ä¸€ä¸ªè¿”å›å€¼å¯¹è±¡ç±»ï¼Œæ¥å®ç°å‚æ•°çš„è¾“å…¥è¾“å‡ºåŠŸèƒ½ã€‚</p><p><br></p><p><strong>ä»£ç å®ç°ï¼š</strong></p><pre><code>/** * å‡ ä½•è¾…åŠ©ç±» */publicÂ finalÂ classÂ GeometryHelperÂ {    /** åŸæœ‰é™æ€å¸¸é‡ */Â Â Â Â ......    /**     * åˆ’åˆ†çº¿ä¸²     *      * @param lineString åŸå§‹çº¿ä¸²     * @param segmentLengthes åˆ†æ®µé•¿åº¦æ•°ç»„     * @return çº¿ä¸²æ•°ç»„     */    public static LineString[] splitLineString(LineString lineString, double[] segmentLengthes) {        // åŸæœ‰è®¡ç®—é€»è¾‘Â Â Â Â Â Â Â Â ......        // åˆå§‹åŒ–å‚æ•°å€¼        int index = 1;        Coordinate[] coordinates = lineString.getCoordinates();        Coordinate coordinate = coordinates[0];        int length = targetLengthes.length;Â Â Â Â Â Â Â Â LineString[]Â lineStringsÂ =Â newÂ LineString[length];        // æ·»åŠ å‰é¢Næ®µ        for (int i = 0; i &lt; length - 1; i++) {            ReturnResult result = combineLineString(coordinates, index, coordinate, targetLengthes[i]);            index = result.getIndex();            coordinate = result.getCoordinate();            lineStrings[i] = result.getLineString();Â Â Â Â Â Â Â Â }        // æ·»åŠ æœ€åä¸€æ®µÂ Â Â Â Â Â Â Â lineStrings[lengthÂ -Â 1]Â =Â buildLineString(coordinates,Â index,Â coordinate);        // è¿”å›çº¿ä¸²æ•°ç»„        return lineStrings;Â Â Â Â }    /**     * ç»„è£…çº¿ä¸²     *      * @param coordinates åº§æ ‡æ•°ç»„     * @param index å½“å‰åºå·     * @param coordinate å½“å‰åº§æ ‡     * @param targetLength ç›®æ ‡é•¿åº¦     * @return è¿”å›å€¼     */    private static ReturnResult combineLineString(Coordinate[] coordinates, int index, Coordinate coordinate, long targetLength) {        // æ·»åŠ çº¿ä¸²åº§æ ‡Â Â Â Â Â Â Â Â ......        // è¿”å›è¾“å‡ºç»“æœ        return new ReturnResult(index, coordinate, buildLineString(coordinateList));Â Â Â Â }    /** åŸæœ‰é™æ€æ–¹æ³• */Â Â Â Â ......    /**     * è¿”å›å€¼ç±»     */    @Getter    @Setter    @ToString    @NoArgsConstructor    @AllArgsConstructor    private static class ReturnResult {        /** å½“å‰åºå· */        private int index;        /** å½“å‰åº§æ ‡ */        private Coordinate coordinate;        /** çº¿ä¸²å¯¹è±¡ */        private LineString lineString;Â Â Â Â }}</code></pre><p><br></p><p>4.2 åˆ©ç”¨å…ƒç»„ç±»å®ç°</p><p><br></p><p><strong>ç†è®ºä¾æ®ï¼š</strong></p><p><br></p><p>å‚è€ƒ3.3ç« èŠ‚çš„å…ƒç»„ï¼ˆTupleï¼‰çš„å®šä¹‰å’Œç‰¹æ€§ã€‚å…ƒç»„ï¼ˆTupleï¼‰å¯ä»¥ç”¨äºæ–¹æ³•çš„å‚æ•°å€¼ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ–¹æ³•çš„è¿”å›å€¼ã€‚å½“ä¸€ä¸ªæ–¹æ³•éœ€è¦è¿”å›å¤šä¸ªå€¼æ—¶ï¼Œåˆä¸æ„¿æ„å®šä¹‰è‡ªå·±çš„ç»“æœç±»æ—¶ï¼Œå¯ä»¥é‡‡ç”¨å…ƒç»„ï¼ˆTupleï¼‰å®ç°å¤šä¸ªå€¼çš„è¿”å›ã€‚</p><p><br></p><p><strong>ä»£ç å®ç°ï¼š</strong></p><p><br></p><pre><code>/** * å‡ ä½•è¾…åŠ©ç±» */publicÂ finalÂ classÂ GeometryHelperÂ {    /** åŸæœ‰é™æ€å¸¸é‡ */Â Â Â Â ......    /**     * åˆ’åˆ†çº¿ä¸²     *      * @param lineString åŸå§‹çº¿ä¸²     * @param segmentLengthes åˆ†æ®µé•¿åº¦æ•°ç»„     * @return çº¿ä¸²æ•°ç»„     */    public static LineString[] splitLineString(LineString lineString, double[] segmentLengthes) {        // åŸæœ‰è®¡ç®—é€»è¾‘Â Â Â Â Â Â Â Â ......        // åˆå§‹åŒ–å‚æ•°å€¼        int index = 1;        Coordinate[] coordinates = lineString.getCoordinates();        Coordinate coordinate = coordinates[0];        int length = targetLengthes.length;Â Â Â Â Â Â Â Â LineString[]Â lineStringsÂ =Â newÂ LineString[length];        // æ·»åŠ å‰é¢Næ®µ        for (int i = 0; i &lt; length - 1; i++) {            Triple&lt;Integer, Coordinate, LineString&gt; triple = combineLineString(coordinates, index, coordinate, targetLengthes[i]);            index = triple.getLeft();            coordinate = triple.getMiddle();            lineStrings[i] = triple.getRight();Â Â Â Â Â Â Â Â }        // æ·»åŠ æœ€åä¸€æ®µÂ Â Â Â Â Â Â Â lineStrings[lengthÂ -Â 1]Â =Â buildLineString(coordinates,Â index,Â coordinate);        // è¿”å›çº¿ä¸²æ•°ç»„        return lineStrings;Â Â Â Â }    /**     * ç»„è£…çº¿ä¸²     *      * @param coordinates åº§æ ‡æ•°ç»„     * @param index å½“å‰åºå·     * @param coordinate å½“å‰åº§æ ‡     * @param targetLength ç›®æ ‡é•¿åº¦     * @return è¿”å›å€¼     */    private static Triple&lt;Integer, Coordinate, LineString&gt; combineLineString(Coordinate[] coordinates, int index, Coordinate coordinate, long targetLength) {        // æ·»åŠ çº¿ä¸²åº§æ ‡Â Â Â Â Â Â Â Â ......        // è¿”å›è¾“å‡ºç»“æœ        return ImmutableTriple.of(index, coordinate, buildLineString(coordinateList));Â Â Â Â }    /** åŸæœ‰é™æ€æ–¹æ³• */Â Â Â Â ......}</code></pre><p><br></p><p>4.3 åˆ©ç”¨å…¶å®ƒæ–¹æ³•å®ç°</p><p><br></p><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åˆ©ç”¨å…¶å®ƒè¿”å›å€¼æ–¹æ³•å®ç°å‚æ•°çš„è¾“å…¥è¾“å‡ºåŠŸèƒ½ï¼š</p><p><br></p><p><strong>åˆ©ç”¨æ•°ç»„å®ç°</strong></p><p><br></p><p>é¦–å…ˆï¼Œåœ¨è¢«è°ƒç”¨æ–¹æ³•ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼ŒæŠŠå¤šä¸ªè¿”å›å€¼æ”¾å…¥åˆ°å¯¹è±¡æ•°ç»„ä¸­ï¼›æœ€åï¼Œåœ¨è°ƒç”¨å‡½æ•°ä¸­ï¼ŒæŠŠè¿™äº›å‚æ•°å€¼ä»å¯¹è±¡æ•°ç»„ä¸­å–å‡ºæ¥ï¼Œå¹¶å¼ºåˆ¶è½¬åŒ–ä¸ºå¯¹åº”çš„æ•°æ®ç±»å‹ã€‚</p><p><br></p><p>åˆ©ç”¨å¯¹è±¡æ•°ç»„çš„é—®é¢˜æ˜¯â€”â€”ä»£ç å¯è¯»æ€§å¤ªå·®ï¼Œè€Œä¸”åœ¨è¿”å›å€¼çš„å­˜å…¥å’Œå–å‡ºè¿‡ç¨‹ä¸­ï¼Œéœ€è¦è¿›è¡Œæ•°æ®ç±»å‹çš„å¼ºåˆ¶è½¬åŒ–ã€‚å¦‚æœæ‰€æœ‰è¿”å›å€¼çš„æ•°æ®ç±»å‹ä¸€è‡´ï¼Œå¯ä»¥ç›´æ¥å®šä¹‰è¯¥ç±»å‹çš„æ•°ç»„ï¼Œä»è€Œé¿å…äº†æ•°æ®ç±»å‹çš„å¼ºåˆ¶è½¬åŒ–ã€‚</p><p><br></p><p><strong>åˆ©ç”¨Mapå®ç°</strong></p><p><br></p><p>é¦–å…ˆï¼Œåœ¨è¢«è°ƒç”¨æ–¹æ³•ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªå¯¹è±¡Mapï¼ŒæŠŠå¤šä¸ªè¿”å›å€¼æ”¾å…¥åˆ°å¯¹è±¡Mapä¸­ï¼›æœ€åï¼Œåœ¨è°ƒç”¨å‡½æ•°ä¸­ï¼ŒæŠŠè¿™äº›å‚æ•°å€¼ä»å¯¹è±¡Mapä¸­å–å‡ºæ¥ï¼Œå¹¶å¼ºåˆ¶è½¬åŒ–ä¸ºå¯¹åº”çš„æ•°æ®ç±»å‹ã€‚</p><p><br></p><p>åˆ©ç”¨å¯¹è±¡Mapå®ç°ï¼Œä»£ç çš„å¯è¯»æ€§æ¯”åˆ©ç”¨å¯¹è±¡æ•°ç»„å®ç°æ›´å¼ºï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨åŒæ ·çš„é—®é¢˜â€”â€”åœ¨è¿”å›å€¼çš„å­˜å…¥å’Œå–å‡ºè¿‡ç¨‹ä¸­ï¼Œéœ€è¦è¿›è¡Œæ•°æ®ç±»å‹çš„å¼ºåˆ¶è½¬åŒ–ã€‚å¦‚æœæ‰€æœ‰è¿”å›å€¼çš„ç±»å‹ä¸€è‡´ï¼Œå¯ä»¥ç›´æ¥å®šä¹‰è¯¥ç±»å‹çš„Mapï¼Œä»è€Œé¿å…äº†æ•°æ®ç±»å‹çš„å¼ºåˆ¶è½¬åŒ–ã€‚ä½†æ˜¯ï¼Œåˆ©ç”¨å¯¹è±¡Mapå®ç°ï¼Œè¿˜ä¸å¦‚å®šä¹‰ä¸€ä¸ªè¿”å›å€¼ç±»æ›´å®ç”¨ã€‚</p><p><br></p><p><strong>äº” åˆ©ç”¨ç±»å­—æ®µå®ç°</strong></p><p><br></p><p>æœ¬ç« å°†ä»ç±»å­—æ®µå…¥æ‰‹ï¼Œå®ç°å‚æ•°çš„è¾“å…¥è¾“å‡ºåŠŸèƒ½ã€‚</p><p><br></p><p>5.1 åˆ©ç”¨çº¿ç¨‹æœ¬åœ°å˜é‡å®ç°</p><p><br></p><p><strong>ç†è®ºä¾æ®ï¼š</strong></p><p><br></p><p>çº¿ç¨‹æœ¬åœ°å˜é‡ï¼ˆThreadLocalï¼‰ï¼šçº¿ç¨‹æœ¬åœ°å˜é‡ä¸åŒäºå®ƒä»¬çš„æ™®é€šå˜é‡ï¼Œå› ä¸ºè®¿é—®æŸä¸ªå˜é‡çš„æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å±€éƒ¨å˜é‡ï¼Œä¸”ç‹¬ç«‹äºå˜é‡çš„åˆå§‹åŒ–å‰¯æœ¬ã€‚çº¿ç¨‹æœ¬åœ°å˜é‡å®ä¾‹é€šå¸¸æ˜¯ç±»ä¸­çš„ç§æœ‰é™æ€å­—æ®µï¼Œå®ƒå¸Œæœ›å°†å˜é‡çŠ¶æ€ä¸æŸä¸€ä¸ªçº¿ç¨‹å…³è”èµ·æ¥ã€‚</p><p><br></p><p>è¦ç”¨ç±»å­—æ®µè§£å†³å‚æ•°çš„è¾“å…¥è¾“å‡ºé—®é¢˜ï¼Œå°±å¿…é¡»è€ƒè™‘æ–¹æ³•çš„çº¿ç¨‹å®‰å…¨æ€§ã€‚è¿™é‡Œï¼Œåˆ©ç”¨çº¿ç¨‹æœ¬åœ°å˜é‡ï¼ˆThreadLocalï¼‰æ¥å®ç°çº¿ç¨‹ä¸­è¾“å…¥è¾“å‡ºå‚æ•°å€¼å…±äº«ã€‚</p><p><br></p><p><strong>ä»£ç å®ç°ï¼š</strong></p><p><strong><br></strong></p><pre><code>/** * å‡ ä½•è¾…åŠ©ç±» */publicÂ finalÂ classÂ GeometryHelperÂ {    /** å±æ€§ç›¸å…³ */    /** å½“å‰åºå·æ”¯æ’‘ */    private static final ThreadLocal&lt;Integer&gt; INDEX_HOLDER = new ThreadLocal&lt;&gt;();    /** å½“å‰åº§æ ‡æ”¯æ’‘ */Â Â Â Â privateÂ staticÂ finalÂ ThreadLocal&lt;Coordinate&gt;Â COORDINATE_HOLDERÂ =Â newÂ ThreadLocal&lt;&gt;();    /** åŸæœ‰é™æ€å¸¸é‡ */Â Â Â Â ......    /**     * åˆ’åˆ†çº¿ä¸²     *      * @param lineString åŸå§‹çº¿ä¸²     * @param segmentLengthes åˆ†æ®µé•¿åº¦æ•°ç»„     * @return çº¿ä¸²æ•°ç»„     */    public static LineString[] splitLineString(LineString lineString, double[] segmentLengthes) {        // åŸæœ‰è®¡ç®—é€»è¾‘Â Â Â Â Â Â Â Â ......        // åˆå§‹åŒ–å‚æ•°å€¼        INDEX_HOLDER.set(1);        Coordinate[] coordinates = lineString.getCoordinates();        COORDINATE_HOLDER.set(coordinates[0]);        int length = targetLengthes.length;Â Â Â Â Â Â Â Â LineString[]Â lineStringsÂ =Â newÂ LineString[length];        // æ·»åŠ å‰é¢Næ®µ        for (int i = 0; i &lt; length - 1; i++) {            lineStrings[i] = combineLineString(coordinates, targetLengthes[i]);Â Â Â Â Â Â Â Â }        // æ·»åŠ æœ€åä¸€æ®µÂ Â Â Â Â Â Â Â lineStrings[lengthÂ -Â 1]Â =Â buildLineString(coordinates,Â INDEX_HOLDER.get(),Â COORDINATE_HOLDER.get());        // æ¸…é™¤æ”¯æ’‘ç±»        INDEX_HOLDER.remove();Â Â Â Â Â Â Â Â COORDINATE_HOLDER.remove();        // è¿”å›çº¿ä¸²æ•°ç»„        return lineStrings;Â Â Â Â }    /**     * ç»„è£…çº¿ä¸²     *      * @param coordinates åº§æ ‡æ•°ç»„     * @param targetLength ç›®æ ‡é•¿åº¦     * @return çº¿ä¸²     */    private static LineString combineLineString(Coordinate[] coordinates, long targetLength) {        // è·å–æ”¯æ’‘å–å€¼        int index = INDEX_HOLDER.get();Â Â Â Â Â Â Â Â CoordinateÂ coordinateÂ =Â COORDINATE_HOLDER.get();        // æ·»åŠ çº¿ä¸²åº§æ ‡Â Â Â Â Â Â Â Â ......        // è®¾ç½®æ”¯æŒå–å€¼        INDEX_HOLDER.set(index);Â Â Â Â Â Â Â Â COORDINATE_HOLDER.set(coordinate);        // è¿”å›çº¿ä¸²å¯¹è±¡        return buildLineString(coordinateList);Â Â Â Â }    /** åŸæœ‰é™æ€æ–¹æ³• */Â Â Â Â ......}</code></pre><p><br></p><p>5.2 åˆ©ç”¨ç±»æˆå‘˜å˜é‡å®ç°</p><p><br></p><p><strong>ç†è®ºä¾æ®ï¼š</strong></p><p><br></p><p>åœ¨ä¸Šä¸€ç« èŠ‚ä¸­ï¼Œåˆ©ç”¨çº¿ç¨‹æœ¬åœ°å˜é‡ï¼ˆThreadLocalï¼‰æ¥å®ç°çº¿ç¨‹ä¸­è¾“å…¥è¾“å‡ºå‚æ•°å€¼å…±äº«ï¼Œè®©æ–¹æ³•çš„å°è£…æ›´å¤æ‚â€”â€”éœ€è¦ä»çº¿ç¨‹æœ¬åœ°å˜é‡ï¼ˆThreadLocalï¼‰è¯»å–å’Œå­˜å‚¨è¾“å…¥è¾“å‡ºå‚æ•°å€¼ã€‚æœ‰æ²¡æœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•ï¼Œç›´æ¥åˆ©ç”¨ç±»æˆå‘˜å˜é‡å®ç°è¾“å…¥è¾“å‡ºå‚æ•°å€¼çš„å…±äº«å‘¢ï¼Ÿ</p><p><br></p><p>ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå¯ä»¥æŠŠæ–¹æ³•çš„å°è£…å’Œå˜é‡çš„å®šä¹‰å°è£…åˆ°ä¸€ä¸ªç±»ä¸­ã€‚è¿™æ ·ï¼Œåœ¨æ¯ä¸€ä¸ªç±»å®ä¾‹ä¸­ï¼Œéƒ½å¯ä»¥åˆ©ç”¨ç±»æˆå‘˜å˜é‡æ¥å®ç°è¾“å…¥è¾“å‡ºå‚æ•°å€¼çš„å…±äº«ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªç±»æ˜¯çº¿ç¨‹éå®‰å…¨çš„ï¼Œå¿…é¡»åœ¨å•çº¿ç¨‹ä¸­ä½¿ç”¨ã€‚</p><p><br></p><p><strong>ä»£ç å®ç°ï¼š</strong></p><p><br></p><pre><code>/** * å‡ ä½•è¾…åŠ©ç±» */publicÂ finalÂ classÂ GeometryHelperÂ {    // åŸæœ‰æ„é€ æ–¹æ³•Â Â Â Â ......    /**     * åˆ’åˆ†çº¿ä¸²     *      * @param lineString åŸå§‹çº¿ä¸²     * @param segmentLengthes åˆ†æ®µé•¿åº¦æ•°ç»„     * @return çº¿ä¸²æ•°ç»„     */    public static LineString[] splitLineString(LineString lineString, double[] segmentLengthes) {        SplitLineStringAlgorithm algorithm = new SplitLineStringAlgorithm();        return algorithm.splitLineString(lineString, segmentLengthes);Â Â Â Â }}/** * åˆ’åˆ†çº¿ä¸²ç®—æ³•ç±» */publicÂ classÂ SplitLineStringAlgorithmÂ {    /** å±æ€§ç›¸å…³ */    /** å½“å‰åºå· */    private int index;    /** å½“å‰åº§æ ‡ */Â Â Â Â privateÂ CoordinateÂ coordinate;    /** åŸæœ‰é™æ€å¸¸é‡ */Â Â Â Â ......    /**     * åˆ’åˆ†çº¿ä¸²     *      * @param lineString åŸå§‹çº¿ä¸²     * @param segmentLengthes åˆ†æ®µé•¿åº¦æ•°ç»„     * @return çº¿ä¸²æ•°ç»„     */    public LineString[] splitLineString(LineString lineString, double[] segmentLengthes) {        // åŸæœ‰è®¡ç®—é€»è¾‘Â Â Â Â Â Â Â Â ......        // åˆå§‹åŒ–å‚æ•°å€¼        index = 1;        Coordinate[] coordinates = lineString.getCoordinates();        coordinate = coordinates[0];        int length = targetLengthes.length;Â Â Â Â Â Â Â Â LineString[]Â lineStringsÂ =Â newÂ LineString[length];        // æ·»åŠ å‰é¢Næ®µ        for (int i = 0; i &lt; length - 1; i++) {            lineStrings[i] = combineLineString(coordinates, targetLengthes[i]);Â Â Â Â Â Â Â Â }        // æ·»åŠ æœ€åä¸€æ®µÂ Â Â Â Â Â Â Â lineStrings[lengthÂ -Â 1]Â =Â buildLineString(coordinates,Â index,Â coordinate);        // è¿”å›çº¿ä¸²æ•°ç»„        return lineStrings;Â Â Â Â }    /**     * ç»„è£…çº¿ä¸²     *      * @param coordinates åº§æ ‡æ•°ç»„     * @param targetLength ç›®æ ‡é•¿åº¦     * @return çº¿ä¸²     */    private LineString combineLineString(Coordinate[] coordinates, long targetLength) {        // æ·»åŠ çº¿ä¸²åº§æ ‡Â Â Â Â Â Â Â Â ......        // è¿”å›çº¿ä¸²å¯¹è±¡        return buildLineString(coordinateList);Â Â Â Â }    /** åŸæœ‰é™æ€æ–¹æ³• */Â Â Â Â ......}</code></pre><p><br></p><p>å…­ å„ç§æ–¹æ³•ç»¼åˆç‚¹è¯„</p><p><br></p><p>ä¸‹é¢ï¼Œé’ˆå¯¹ä»¥ä¸Šå„ç§å®ç°æ–¹æ³•è¿›è¡Œä¸€ä¸ªç»¼åˆç‚¹è¯„ï¼š</p><p style=text-align:center><br></p><div class=pgc-img><img alt=Javaç¼–ç¨‹æŠ€å·§ï¼šå¦‚ä½•å®ç°å‚æ•°çš„è¾“å…¥è¾“å‡ºï¼Ÿ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b36247aabf154a46aca31b642fc3cd0c><p class=pgc-img-caption></p></div><p><br></p><p>æ€»ç»“å¦‚ä¸‹ï¼š</p><p><br></p><ul><li>å„ç§å®ç°æ–¹æ³•æœ‰åˆ©æœ‰å¼Šï¼Œåº”å½“æ ¹æ®å…·ä½“çš„ä½¿ç”¨åœºæ™¯ï¼Œæ¥é€‰æ‹©æœ€é€‚åˆçš„å®ç°æ–¹æ³•ã€‚</li></ul><p><br></p><ul><li>æ ¹æ®å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹é€‰æ‹©å®ç°æ–¹æ³•ï¼šè¾“å…¥è¾“å‡ºå‚æ•°å°½é‡ä½¿ç”¨æ–¹æ³•å‚æ•°å®ç°ï¼Œè¿”å›å€¼å°½é‡ä½¿ç”¨è¿”å›å€¼å®ç°ã€‚</li></ul><p><br></p><ul><li>æ ¹æ®å‚æ•°å’Œè¿”å›å€¼çš„æ•°é‡é€‰æ‹©å®ç°æ–¹æ³•ï¼šæ•°é‡å°‘çš„å°½é‡ä½¿ç”¨æ”¯æ’‘ç±»å’Œå…ƒç»„ç±»ï¼Œæ•°é‡å¤šçš„å°½é‡ä½¿ç”¨è‡ªå®šä¹‰ç±»ã€‚</li></ul><p><br></p><ul><li>ä¸å»ºè®®ä½¿ç”¨ä¸€äº›å–å·§çš„å®ç°æ–¹æ³•ï¼Œæ¯”å¦‚ï¼š3.2.åˆ©ç”¨å•å€¼æ•°ç»„å®ç°ã€5.1.åˆ©ç”¨çº¿ç¨‹æœ¬åœ°å˜é‡å®ç°ã€‚</li></ul><p><br></p><ul><li>ä¸æ¨èä½¿ç”¨å¯¹è±¡æ•°ç»„å’Œå¯¹è±¡Mapï¼ŒJavaæ˜¯å¼ºç±»å‹å®šä¹‰è¯­è¨€ï¼Œä¸å»ºè®®ä½¿ç”¨å¼ºåˆ¶æ•°æ®ç±»å‹è½¬åŒ–ã€‚</li></ul><p><br></p><ul><li>æœ€é€‚åˆæœ¬æ–‡ä¸­æ¡ˆä¾‹çš„å®ç°æ–¹æ³•æ˜¯â€”â€”3.4.åˆ©ç”¨æ”¯æ’‘ç±»å®ç°ã€‚</li></ul><p><br></p><p><strong>åè®°</strong></p><p><br></p><p>ã€Šåº„å­Â·å…»ç”Ÿä¸»ã€‹æœ‰è¨€ï¼š</p><p><br></p><blockquote><p>å¾ç”Ÿä¹Ÿæœ‰æ¶¯ï¼Œè€ŒçŸ¥ä¹Ÿæ— æ¶¯ã€‚ä»¥æœ‰æ¶¯éšæ— æ¶¯ï¼Œæ®†å·²ï¼</p></blockquote><p><br></p><p>æ„æ€æ˜¯ï¼šæˆ‘çš„ç”Ÿå‘½æ˜¯æœ‰é™çš„ï¼Œä½†çŸ¥è¯†å´æ˜¯æ— é™çš„ã€‚ç”¨æœ‰é™çš„ç”Ÿå‘½å»è¿½æ±‚æ— é™çš„çŸ¥è¯†ï¼Œå¿…ç„¶ä¼šå¤±è´¥çš„ã€‚</p><p><br></p><p>æ‰€ä»¥ï¼ŒçŸ¥è¯†å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œè€Œæ˜¯â€œå­¦è€Œç²¾ä¹‹ï¼Œç²¾è€Œæ·±ä¹‹ï¼Œæ·±è€Œæ–°ä¹‹ â€ã€‚</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Java','ç¼–ç¨‹','å®ç°'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>