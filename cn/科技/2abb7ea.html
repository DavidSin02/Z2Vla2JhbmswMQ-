<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>「系统设计」如何设计一个“稳、准、快”的秒杀系统 | 极客快訊</title><meta property="og:title" content="「系统设计」如何设计一个“稳、准、快”的秒杀系统 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/5f1b283fc044438c93611d0f29613b9a"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2abb7ea.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2abb7ea.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2abb7ea.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2abb7ea.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2abb7ea.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2abb7ea.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2abb7ea.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2abb7ea.html><meta property="article:published_time" content="2020-10-29T20:59:28+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:28+08:00"><meta name=Keywords content><meta name=description content="「系统设计」如何设计一个“稳、准、快”的秒杀系统"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/2abb7ea.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>「系统设计」如何设计一个“稳、准、快”的秒杀系统</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>秒杀在互联网电商中很常见。比如，淘宝“双十一”，你在和上万人一起抢购一件性价比超高的衣服？春运时我们都会去 12306 订购火车票。在这些高并发场景下都需要保证高性能和高可用。</p><p>先思考一下，如果由你来设计高并发秒杀，怎么保证衣服不会超卖？以前在抢票时经常遇到页面打不开的情况，让你来设计 12306 系统，如何保证在千万人访问的同时也能支持正常抢票呢？</p><div class=pgc-img><img alt=「系统设计」如何设计一个“稳、准、快”的秒杀系统 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5f1b283fc044438c93611d0f29613b9a><p class=pgc-img-caption></p></div><p>其实，<strong>秒杀本质上是要解决两个问题 </strong>：<strong>并发读</strong>（减少直接读库），<strong>并发写</strong>（层层设卡- 保db）。前辈大牛们总结出了“三五”原则（观点参考自许令波《如何设计一个秒杀系统》）。</p><h1 class=pgc-h-arrow-right>一、宏观架构上要遵循“稳、准、快” 3大原则</h1><p><strong>1.稳：指高可用</strong></p><p>做好降级限流措施，防止最坏情况发生。要设计好<strong class=highlight-text>兜底方案</strong>，保证不掉链子，秒杀活动顺利完成。</p><p><strong>2.准：指一致性</strong></p><p>商品、订单要最终一致性。成交多一台少一台都不行。</p><p><strong>3.快：指高性能</strong></p><p>整个请求链路上都要做协同的优化，包括：</p><p>a. 浏览器优化技术：合理布局，<strong class=highlight-text>页面缓存，减少http请求数</strong>，页面压缩，减少 cookie 传输</p><p>b. 设计数据的动静分离方案（秒杀时<strong class=highlight-text>不需要刷新整个页面</strong>，而只需要点击抢购按钮）</p><p>c. 热点的发现与隔离（最关键的详情和交易系统<strong class=highlight-text>增加本地缓存</strong>，提前缓存秒杀商品的信息）</p><p>d. <strong class=highlight-text>请求的削峰与分层过滤</strong>（比如秒杀答题提交，消息队列缓冲瞬时流量或线程池加锁等待）</p><p>e. 服务端的极致优化（比如部分缓存前置在nginx层，业务代码优化，可能需要牺牲通用性）</p><h1 class=pgc-h-arrow-right>二、微观架构上要遵循“4 要 1 不要” 5个原则</h1><p><strong>1. 数据要尽量少</strong></p><p>数据在网络上传输需要时间，服务器在<strong class=highlight-text>写网络时通常都要做压缩和字符编码，这些都非常消耗CPU</strong>。</p><p>系统依赖的数据能少就少。因为这些数据一般是和后台服务（涉及<strong class=highlight-text>数据的序列化和反序列化，增加延时</strong>）以及数据库（容易成为一个瓶颈）打交道的。</p><p><strong>2. 请求数要尽量少</strong></p><p>秒杀页面做好缓存（CSS/JavaScript、图片），减少http请求数，<strong class=highlight-text>尽量减少“额外请求”</strong>。</p><p>建立连接要做三次握手，一些请求（例如 JavaScript）还需要串行加载等。另外，如果不同请求的域名不一样的话，还涉及这些域名的 DNS 解析，可能会耗时更久。</p><p><strong>3. 路径要尽量短</strong></p><p><strong class=highlight-text>缩短请求路径</strong>不仅可以增加可用性，同样可以<strong class=highlight-text>有效提升性能（减少中间节点可以减少数据的序列化与反序列化），并减少延时（可以减少网络传输耗时）</strong>。</p><p>要缩短访问路径有一种办法，就是多个相互强依赖的应用合并部署在一起，把远程过程调用（RPC）变成 JVM 内部之间的方法调用。</p><p><strong>4. 依赖要尽量少</strong></p><p>依赖一般分为“强”依赖（比如秒杀页面必须强依赖商品信息、用户信息）和“弱”依赖（优惠券、成交列表）。“弱”依赖属于可有可无的信息，在紧急情况下就可以抛弃掉。</p><p>要减少依赖，我们可以给系统进行分级，<strong class=highlight-text>防止重要的系统被不重要的系统拖垮</strong>。避免最重要的系统强依赖不那么重要的系统。</p><p>例如支付系统不应该强依赖优惠券，在极端情况下可以把优惠券给降级，防止支付系统被优惠券系统给拖垮。</p><p><strong>5. 不要有单点</strong></p><p><strong class=highlight-text>架构上单点是大忌</strong>（单点意味着没有备份，风险不可控），设计分布式系统最重要的原则就是“消除单点”。</p><p>应用无状态化是有效避免单点的一种方式。但有例外，存储服务本身很难无状态化，因为数据要存储在磁盘上，本身就要和机器绑定，这种场景要冗余多个备份来解决单点问题。</p><p><br></p><hr><p>架构是一门平衡的艺术，最好的架构离不开特定的业务场景，<strong>抛开业务谈架构一切都将是空谈。如何优化，优化到什么程度需要依量（流量、体量）而行。</strong></p><p>秒杀系统演进也是一个渐进的过程，并非一蹴而就，你在工作中积累了哪些经验又踩到了哪些坑呢？欢迎留言讨论。</p><p>最后，感谢你的阅读，如果这篇文章让你有所收获，<strong>欢迎点赞和转发</strong>。</p><p>本头条号专注于互联网领域的技术交流与经验分享，诚挚<strong>欢迎关注我</strong>哦 ~</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'系统','设计','一个'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>