<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>吴恩达深度学习笔记(132) | 序列模型 | 改进集束搜索 | 极客快訊</title><meta property="og:title" content="吴恩达深度学习笔记(132) | 序列模型 | 改进集束搜索 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/62cda93c07d14841930e00586835064e"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2b4ff01.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2b4ff01.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2b4ff01.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2b4ff01.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2b4ff01.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2b4ff01.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2b4ff01.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2b4ff01.html><meta property="article:published_time" content="2020-10-29T20:50:45+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:45+08:00"><meta name=Keywords content><meta name=description content="吴恩达深度学习笔记(132) | 序列模型 | 改进集束搜索"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/2b4ff01.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>吴恩达深度学习笔记(132) | 序列模型 | 改进集束搜索</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>上个笔记中, 你已经学到了基本的<strong>束搜索算法(the basic beam search algorithm)</strong>，这个笔记里,我们会学到一些技巧, 能够使算法运行的更好。<strong>长度归一化（Length normalization）</strong>就是对束搜索算法稍作调整的一种方式，帮助你得到更好的结果，下面介绍一下它。</p><div class=pgc-img><img alt="吴恩达深度学习笔记(132) | 序列模型 | 改进集束搜索" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/62cda93c07d14841930e00586835064e><p class=pgc-img-caption></p></div><p>前面讲到束搜索就是最大化这个概率，这个乘积就是P(y^(&lt;1>)…y^(&lt;T_y ) |X)，可以表示成:P(y^(&lt;1>) |X) P(y^(&lt;2>) |X,y^(&lt;1>)) P(y^(&lt;3>) |X,y^(&lt;1>),y^(&lt;2>))…P(y^(&lt;T_y>) |X,y^(&lt;1>),y^(&lt;2>)…y^(&lt;T_y-1>))</p><div class=pgc-img><img alt="吴恩达深度学习笔记(132) | 序列模型 | 改进集束搜索" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a56dfa767dc7468ba81e8fa3418eacfb><p class=pgc-img-caption></p></div><p>这些符号看起来可能比实际上吓人，但这就是我们之前见到的<strong>乘积概率（the product probabilities）</strong>。</p><p>如果计算这些，其实这些概率值都是小于1的，通常远小于1。很多小于1的数乘起来，会得到很小很小的数字，会造成<strong>数值下溢（numerical underflow）</strong>。数值下溢就是数值太小了，导致电脑的浮点表示不能精确地储存，因此在实践中,我们不会最大化这个乘积，而是<strong>取log</strong>值。如果在这加上一个log，最大化这个log求和的概率值，在选择最可能的句子y时，你会得到同样的结果。</p><p>所以通过取log，我们会得到一个<strong>数值上更稳定的算法</strong>，不容易出现四舍五入的误差，数值的舍入误差（rounding errors）或者说数值下溢（numerical underflow）。因<strong>为log函数它是严格单调递增的函数，最大化P(y)，因为对数函数，这就是log函数，是严格单调递增的函数，所以最大化logP(y|x)和最大化P(y|x)结果一样</strong>。</p><p>如果一个y值能够使前者最大，就肯定能使后者也取最大。所以实际工作中，我们总是记录概率的<strong>对数和（the sum of logs of the probabilities），而不是概率的乘积（the production of probabilities）。</strong></p><p>对于目标函数（this objective function），还可以做一些改变，可以使得机器翻译表现的更好。如果参照原来的目标函数（this original objective），如果有一个很长的句子，那么这个句子的概率会很低，<strong>因为乘了很多项小于1的数字来估计句子的概率</strong>。所以如果乘起来很多小于1的数字，那么就会得到一个更小的概率值，所以这个目标函数有一个缺点，它可能不自然地倾向于简短的翻译结果，它更偏向短的输出，因为短句子的概率是由更少数量的小于1的数字乘积得到的，所以这个乘积不会那么小。</p><p>顺便说一下，这里也有同样的问题，概率的log值通常小于等于1，实际上在log的这个范围内，所以加起来的项越多，得到的结果越负，所以对这个算法另一个改变也可以使它表现的更好，也就是我们不再最大化这个目标函数了，我们可以把它<strong>归一化，通过除以翻译结果的单词数量（normalize this by the number of words in your translation）</strong>。这样就是取每个单词的概率对数值的平均了，这样很明显地<strong>减少了对输出长的结果的惩罚（this significantly reduces the penalty for outputting longer translations.）。</strong></p><p>在实践中，有个探索性的方法，相比于直接除T_y，也就是输出句子的单词总数，我们有时会用一个更柔和的方法（a softer approach），在T_y上加上指数a，a可以等于0.7。如果a等于1，就相当于完全用长度来归一化，如果a等于0，T_y的0次幂就是1，就相当于完全没有归一化，这就是在完全归一化和没有归一化之间。a就是算法另一个超参数（hyper parameter），需要调整大小来得到最好的结果。不得不承认，这样用a实际上是试探性的，它并没有理论验证。但是大家都发现效果很好，大家都发现实践中效果不错，所以很多人都会这么做。你可以尝试不同的a值，看看哪一个能够得到最好的结果。</p><p>总结一下如何运行束搜索算法。当你运行束搜索时，你会看到很多长度等于1的句子，很多长度等于2的句子，很多长度等于3的句子，等等。可能运行束搜索30步，考虑输出的句子可能达到，比如长度30。因为束宽为3，你会记录所有这些可能的句子长度，长度为1、2、3、4 等等一直到30的三个最可能的选择。然后针对这些所有的可能的输出句子，用这个式子（上图编号1所示）给它们打分，取概率最大的几个句子，然后对这些束搜索得到的句子，计算这个目标函数。最后从经过评估的这些句子中，挑选出在归一化的log 概率目标函数上得分最高的一个（you pick the one that achieves the highest value on this normalized log probability objective.），有时这个也叫作归一化的对数似然目标函数（a normalized log likelihood objective）。这就是最终输出的翻译结果，这就是如何实现束搜索。这周的练习中你会自己实现这个算法。</p><div class=pgc-img><img alt="吴恩达深度学习笔记(132) | 序列模型 | 改进集束搜索" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/12db4cd4eeea4230a8c2a7304ea28eba><p class=pgc-img-caption></p></div><p>最后还有一些实现的细节，如何选择束宽B。</p><p><strong>B越大，你考虑的选择越多，你找到的句子可能越好，但是B越大，你的算法的计算代价越大，因为你要把很多的可能选择保存起来</strong>。</p><p>最后我们总结一下关于如何选择束宽B的一些想法。接下来是针对或大或小的B各自的优缺点。</p><p>如果束宽很大，你会考虑很多的可能，你会得到一个更好的结果，因为你要考虑很多的选择，但是算法会运行的慢一些，内存占用也会增大，计算起来会慢一点。</p><p>而如果你用小的束宽，结果会没那么好，因为你在算法运行中，保存的选择更少，但是你的算法运行的更快，内存占用也小。</p><p>在前面笔记里，我们例子中用了束宽为3，所以会保存3个可能选择，在实践中这个值有点偏小。在产品中，经常可以看到把束宽设到10，我认为束宽为100对于产品系统来说有点大了，这也取决于不同应用。</p><p>但是对科研而言，人们想压榨出全部性能，这样有个最好的结果用来发论文，也经常看到大家用束宽为1000或者3000，这也是取决于特定的应用和特定的领域。</p><p>在你实现你的应用时，尝试不同的束宽的值，<strong>当B很大的时候，性能提高会越来越少</strong>。对于很多应用来说，<strong>从束宽1，也就是贪心算法，到束宽为3、到10，你会看到一个很大的改善</strong>。但是当束宽从1000增加到3000时，效果就没那么明显了。</p><p>对于之前上过计算机科学课程的同学来说，如果你熟悉计算机科学里的<strong>搜索算法（computer science search algorithms）, 比如广度优先搜索（BFS, Breadth First Search algorithms），或者深度优先搜索（DFS, Depth First Search）</strong>，你可以这样想束搜索，不像其他你在计算机科学算法课程中学到的算法一样。如果你没听说过这些算法也不要紧，但是如果你听说过广度优先搜索和深度优先搜索，不同于这些算法，这些都是精确的搜索算法（exact search algorithms），束搜索运行的更快，但是不能保证一定能找到argmax的准确的最大值。如果你没听说过广度优先搜索和深度优先搜索，也不用担心，这些对于我们的目标也不重要，如果你听说过，这就是束搜索和其他算法的关系。</p><p>好，这就是束搜索。这个算法广泛应用在多产品系统或者许多商业系统上，在深度学习系列课程中的第三门课中，我们讨论了很多关于误差分析（error analysis）的问题。事实上在束搜索上做误差分析是我发现的最有用的工具之一。</p><p>有时你想知道是否应该增大束宽，我的束宽是否足够好，你可以计算一些简单的东西来指导你需要做什么，来改进你的搜索算法。我们在下个笔记里进一步讨论。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'吴恩达','学习','笔记'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../cn/%E7%A7%91%E6%8A%80/f564827a.html alt="吴恩达深度学习笔记(108)-序列模型介绍(Sequence Models)" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/dfa0587764f14afb8ccfd7a33796cd74 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/f564827a.html title="吴恩达深度学习笔记(108)-序列模型介绍(Sequence Models)">吴恩达深度学习笔记(108)-序列模型介绍(Sequence Models)</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/efabb5bb.html alt=吴恩达深度学习笔记(106)-风格迁移网络讲解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/01def15aa8654252990f709965d5b769 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/efabb5bb.html title=吴恩达深度学习笔记(106)-风格迁移网络讲解>吴恩达深度学习笔记(106)-风格迁移网络讲解</a></li><hr><li><a href=../../cn/%E7%A7%91%E5%AD%A6/31a4d4f2.html alt="吴恩达深度学习笔记(38)-优化算法(Optimization algorithms)" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/c34f86938ddb484298ca8e0a20494ff2 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E5%AD%A6/31a4d4f2.html title="吴恩达深度学习笔记(38)-优化算法(Optimization algorithms)">吴恩达深度学习笔记(38)-优化算法(Optimization algorithms)</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/72a9b3c.html alt=吴恩达深度学习笔记(28)-网络训练验证测试数据集的组成介绍 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b64cd54d8477428589d89e078a3e37b4 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/72a9b3c.html title=吴恩达深度学习笔记(28)-网络训练验证测试数据集的组成介绍>吴恩达深度学习笔记(28)-网络训练验证测试数据集的组成介绍</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>