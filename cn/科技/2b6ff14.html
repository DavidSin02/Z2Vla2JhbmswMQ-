<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Android 11 中的存储机制更新 | 极客快訊</title><meta property="og:title" content="Android 11 中的存储机制更新 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/9158d57566f742409893eb5de136edbc"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2b6ff14.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2b6ff14.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2b6ff14.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2b6ff14.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2b6ff14.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2b6ff14.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2b6ff14.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2b6ff14.html><meta property="article:published_time" content="2020-10-29T20:53:03+08:00"><meta property="article:modified_time" content="2020-10-29T20:53:03+08:00"><meta name=Keywords content><meta name=description content="Android 11 中的存储机制更新"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/2b6ff14.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Android 11 中的存储机制更新</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div class=pgc-img><img alt="Android 11 中的存储机制更新" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9158d57566f742409893eb5de136edbc><p class=pgc-img-caption></p></div><p>Android 10 引入了对外部存储权限的更改，旨在更好地保护用户数据以及降低应用的存储空间。Android 11 开发者预览版里加入了更多改进，以帮助开发者更好地适应这些权限修改。</p><p>在 Google Play 上发布的大部分应用都会请求 (READ_EXTERNAL_STORAGE) 存储权限，来做一些诸如在 SD 卡中存储文件或者读取多媒体文件等常规操作。这些应用可能会在磁盘中存储大量文件，即使应用被卸载了还会依然存在。另外，这些应用还可能会读取其他应用的一些敏感文件数据。在 Android 10 中，我们调整了存储权限的工作方式，仅为应用提供其所需的访问权限。这也是在鼓励应用在指定目录下进行文件存储以限制文件混乱。当应用被卸载后，这些相关的目录也会被删除。</p><p>Android 10 所带来的关于存储上的变更遵循了以下三个基本原则</p><ul><li><strong>更好的从属性:</strong> 系统知道哪些文件属于哪些应用，这可以让用户更方便地管理他们的文件。当应用被卸载后，除非用户需要，否则应用之前所创建的文件也不应该保留在设备上；</li><li><strong>保护应用数据: </strong>当一个应用将它所属的文件写入外部存储时，这些文件是不应该被其他应用所访问的；</li><li><strong>保护用户数据: </strong>当用户下载了一些文件，比如带有敏感信息的邮件附件，这些文件应该对其他应用不可见。</li></ul><p>目标 API 级别 (Target SDK Level) 设定为 Android 10 的应用无需请求 Storage 权限，就可以使用自己的外部存储目录并管理媒体集合 (音频、视频、图片和下载数据)。Storage 权限仅允许读取其他应用<strong>共享</strong>的音频、视频和图片集合，但并不允许访问非本应用创建的下载数据。在 Android 10 里唯一一种访问其他应用创建的非媒体文件的途径是使用存储访问框架 (Storage Access Framework) 提供的文档选择器。</p><p>在 Android 11 中，我们会通过下述的几点来继续优化分区存储 (Scoped Storage) 的开发者体验。</p><ul><li>Android 10 对外部存储权限行为https://developer.android.google.cn/training/data-storage#scoped-storage</li><li>请求 (READ_EXTERNAL_STORAGE) 存储权限https://developer.android.google.cn/reference/android/Manifest.permission#READ_EXTERNAL_STORAGE</li><li>它所属的文件https://developer.android.google.cn/training/data-storage/app-specific</li><li>存储访问框架 (Storage Access Framework)https://developer.android.google.cn/guide/topics/providers/document-provider</li></ul><p><strong>改进媒体存储</strong></p><p>Android 10 中要求所有应用都使用 MediaStore API 来访问照片、视频和音乐文件，我们也将继续秉承这个原则。但是我们也知道，很多深度依赖基于原始文件路径 API 的应用和第三方库是很难切换到使用文件描述符 (File Descriptor) 的。因此在 Android 11 里，依赖原始文件路径的 API 和库可以再次使用了。您需要在应用的 Manifest 文件里添加 requestLegacyExternalStorage 属性，以保证 Android 10 的用户也可以使用该特性。在实际的运行中，依赖原始文件路径的 I/O 请求会被重定向到使用 MediaStore API，当使用这种方式访问本应用存储空间之外的文件时，这次重定向会造成性能影响。而且直接使用原始文件路径，并不会比使用 MediaStore API 有更多优势，因此我们强烈建议直接使用 MediaStore API。在 Android 10 中，应用在对每一个文件请求编辑或删除时都必须得到用户的确认。而在 Android 11 中，应用可以一次请求修改或者删除多个媒体文件。系统的默认图库应用 (Gallery) 将不再展示这些对话框。我们希望这项改进能够使用户体验更加顺畅。</p><div class=pgc-img><img alt="Android 11 中的存储机制更新" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4cd8609fe4384d19809d13a24e35b675><p class=pgc-img-caption></p></div><ul><li>可以再次使用https://developer.android.google.cn/preview/privacy/storage#media-files-raw-paths</li><li>修改或者删除多个媒体文件https://developer.android.com/preview/privacy/storage#media-file-access</li></ul><p><strong>对 Storage Access Framework 的更新</strong></p><p>当我们对广泛的存储访问进行限制后，一些开发者试图使用 Storage Access Framework (SAF) 遍历整个文件系统。但是，SAF 并不适用于广泛地访问共享存储内容。因此，我们对其进行了更新，限制了它对某些路径的可见性。</p><p>在 Android 11 中，将不再允许用户授权访问 Downloads 的根目录、每个可用 SD 卡的根目录以及其它应用的目录。应用仍然可以通过 Storage Access Framework API 或者文件选择器来帮助用户从共享存储中选取个别文件。</p><ul><li>对其进行了更新https://developer.android.google.cn/preview/privacy/storage#file-directory-restrictions</li></ul><p><strong>针对文件管理应用的特殊权限</strong></p><p>针对文件管理器以及一些备份类的应用，它们需要获得共享存储的更广泛的访问权限。Android 11 里将会引入一个特别的权限叫做 <strong>MANAGE_EXTERNAL_STORAGE</strong>，该权限将授权读写所有共享存储内容，这也将同时包含非媒体类型的文件。但是获得这个权限的应用还是<strong>无法访问</strong>其他应用的应用专属目录 (app-specific directory)，无论是外部存储还是内部存储。</p><p>我们希望继续允许一些确实有广泛访问外部存储文件需求的应用。在 Android 11 中，已获得<strong>MANAGE_EXTERNAL_STORAGE</strong> 权限的应用，可以将用户引导至系统设置页面，让用户选择是否允许该应用 "访问所有文件" (All Files Access)。下面的两种应用示例是可以使用该权限的:</p><ul><li>文件管理器 —— 该类应用的主要功能是管理文件；</li><li>备份和恢复 —— 该类应用需要访问大批量的文件 (比如切换设备的时候进行数据迁移，或者将数据备份到云端)。</li></ul><p>如果您的应用需要访问单个文件，比如文字处理应用，则应该使用 Storage Access Framework (SAF)。</p><p>如果您的应用需要 <strong>MANAGE_EXTERNAL_STORAGE</strong> 权限或者调用了依赖原始文件路径的 API，那么您必须在 AndroidManifest 文件中添加 requestLegacyExternalStorage=true，这样您的应用才能够在搭载 Android 10 的设备上正常运行。更多相关信息请查看我们在去年 Android 开发者峰会的分享视频《准备好使用分区存储》:</p><ul><li>腾讯视频链接https://v.qq.com/x/page/d3026c1bpr3.html</li><li>Bilibili 视频链接https://www.bilibili.com/video/av77198618/</li></ul></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Android','11','存储'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>