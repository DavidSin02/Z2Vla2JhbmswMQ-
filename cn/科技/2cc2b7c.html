<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>知乎神回复：计算机CPU是如何认识代码的，当然是一看就会 | 极客快訊</title><meta property="og:title" content="知乎神回复：计算机CPU是如何认识代码的，当然是一看就会 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/2cd29caffa6f4427b6d778a8a1691707"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2cc2b7c.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2cc2b7c.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2cc2b7c.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2cc2b7c.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2cc2b7c.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2cc2b7c.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2cc2b7c.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2cc2b7c.html><meta property="article:published_time" content="2020-10-29T21:04:48+08:00"><meta property="article:modified_time" content="2020-10-29T21:04:48+08:00"><meta name=Keywords content><meta name=description content="知乎神回复：计算机CPU是如何认识代码的，当然是一看就会"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/2cc2b7c.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>知乎神回复：计算机CPU是如何认识代码的，当然是一看就会</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p class=ql-align-justify>又是读个大学就能懂系列的。</p><p class=ql-align-justify>行吧，老规矩，尽量简单的语言来解释一下。</p><p class=ql-align-justify>先说一下半导体，啥叫半导体？就是介于导体和绝缘体中间的一种东西，比如二极管。</p><p class=ql-align-justify></p><div class=pgc-img><img alt=知乎神回复：计算机CPU是如何认识代码的，当然是一看就会 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2cd29caffa6f4427b6d778a8a1691707><p class=pgc-img-caption></p></div><p class=ql-align-justify></p><p class=ql-align-justify>电流可以从A端流向C端，但反过来则不行。你可以把它理解成一种防止电流逆流的东西。</p><p class=ql-align-justify>当C端10V，A端0V，二极管可以视为断开。</p><p class=ql-align-justify>当C端0V，A端10V，二极管可以视为导线，结果就是A端的电流源源不断的流向C端，导致最后的结果就是A端=C端=10V</p><p class=ql-align-justify></p><div class=pgc-img><img alt=知乎神回复：计算机CPU是如何认识代码的，当然是一看就会 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8a2d703f91134056a107af1001357c54><p class=pgc-img-caption></p></div><p class=ql-align-justify></p><p class=ql-align-justify>等等，不是说好的C端0V，A端10V么？咋就变成结果是A端=C端=10V了？你可以把这个理解成初始状态，当最后稳定下来之后就会变成A端=C端=10V。</p><p class=ql-align-justify>文科的童鞋们对不住了，实在不懂问高中物理老师吧。反正你不能理解的话就记住这种情况下它相当于导线就行了。</p><p class=ql-align-justify>利用半导体，我们可以制作一些有趣的电路，比如【与门】</p><p class=ql-align-justify></p><div class=pgc-img><img alt=知乎神回复：计算机CPU是如何认识代码的，当然是一看就会 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b70318f4e1fd4ec7b7953fbeaf0ffcd5><p class=pgc-img-caption></p></div><p class=ql-align-justify></p><p class=ql-align-justify>此时A端B端只要有一个是0V，那Y端就会和0V地方直接导通，导致Y端也变成0V。只有AB两端都是10V，Y和AB之间才没有电流流动，Y端也才是10V。</p><p class=ql-align-justify>我们把这个装置成为【与门】，把有电压的地方计为1，0电压的地方计为0。至于具体几V电压，那不重要。</p><p class=ql-align-justify>也就是AB必须同时输入1，输出端Y才是1;AB有一个是0，输出端Y就是0。</p><p class=ql-align-justify>其他还有【或门】【非门】和【异或门】，跟这个都差不多，或门就是输入有一个是1输出就是1，输入00则输入0。</p><p class=ql-align-justify>非门也好理解，就是输入1输出0，输入0输出1。</p><p class=ql-align-justify>异或门难理解一些，不过也就那么回事，输入01或者10则输出1，输入00或者11则输出0。（即输入两个一样的值则输出0，输入两个不一样的值则输出1）。</p><p class=ql-align-justify>这几种门都可以用二极管做出来，具体怎么做就不演示了，有兴趣的童鞋可以自己试试。每次都画二极管也是个麻烦，我们就把门电路简化成下面几个符号。</p><p class=ql-align-justify></p><div class=pgc-img><img alt=知乎神回复：计算机CPU是如何认识代码的，当然是一看就会 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e122ca5ccd7242d68d0d73f379465d36><p class=pgc-img-caption></p></div><p class=ql-align-justify></p><p class=ql-align-justify>然后我们就可以用门电路来做CPU了。当然做CPU还是挺难的，我们先从简单的开始：加法器。</p><p class=ql-align-justify>加法器顾名思义，就是一种用来算加法的电路，最简单的就是下面这种。</p><p class=ql-align-justify></p><div class=pgc-img><img alt=知乎神回复：计算机CPU是如何认识代码的，当然是一看就会 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b222ded0d817489b801d2583d51a0e15><p class=pgc-img-caption></p></div><p class=ql-align-justify></p><p class=ql-align-justify>AB只能输入0或者1，也就是这个加法器能算0+0，1+0或者1+1。</p><p class=ql-align-justify>输出端S是结果，而C则代表是不是发生进位了，二进制1+1=10嘛。这个时候C=1，S=0</p><p class=ql-align-justify>费了大半天的力气，算个1+1是不是特别有成就感？</p><p class=ql-align-justify>那再进一步算个1+2吧（二进制01+10），然后我们就发现了一个新的问题：第二位需要处理第一位有可能进位的问题，所以我们还得设计一个全加法器。</p><p class=ql-align-justify></p><div class=pgc-img><img alt=知乎神回复：计算机CPU是如何认识代码的，当然是一看就会 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ebbd6928022b47afaac758fc5c86e7f0><p class=pgc-img-caption></p></div><p class=ql-align-justify></p><p class=ql-align-justify>每次都这么画实在太麻烦了，我们简化一下</p><p class=ql-align-justify></p><div class=pgc-img><img alt=知乎神回复：计算机CPU是如何认识代码的，当然是一看就会 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c2dfe31853084eb89af76a54eca33dd6><p class=pgc-img-caption></p></div><p class=ql-align-justify></p><p class=ql-align-justify>也就是有3个输入2个输出，分别输入要相加的两个数和上一位的进位，然后输入结果和是否进位。</p><p class=ql-align-justify>然后我们把这个全加法器串起来</p><p class=ql-align-justify></p><div class=pgc-img><img alt=知乎神回复：计算机CPU是如何认识代码的，当然是一看就会 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1ce47418d68845a0adc1ff3f09f8d69d><p class=pgc-img-caption></p></div><p class=ql-align-justify></p><p class=ql-align-justify>我们就有了一个4位加法器，可以计算4位数的加法也就是15+15，已经达到了幼儿园中班水平，是不是特别给力？</p><p class=ql-align-justify>做完加法器我们再做个乘法器吧，当然乘任意10进制数是有点麻烦的，我们先做个乘2的吧。</p><p class=ql-align-justify>乘2就很简单了，对于一个2进制数数我们在后面加个0就算是乘2了</p><p class=ql-align-justify>比如</p><p class=ql-align-justify>5=101（2）</p><p class=ql-align-justify>10=1010（2）</p><p class=ql-align-justify>所以我们只要把输入都往前移动一位，再在最低位上补个零就算是乘2了。具体逻辑电路图我就不画，你们知道咋回事就行了。</p><p class=ql-align-justify>那乘3呢？简单，先位移一次（乘2）再加一次。乘5呢？先位移两次（乘4）再加一次。</p><p class=ql-align-justify>所以一般简单的CPU是没有乘法的，而乘法则是通过位移和加算的组合来通过软件来实现的。这说的有点远了，我们还是继续做CPU吧。</p><p class=ql-align-justify>现在假设你有8位加法器了，也有一个位移1位的模块了。串起来你就能算</p><p class=ql-align-justify>（A+B）X2</p><p class=ql-align-justify>了！激动人心，已经差不多到了准小学生水平。</p><p class=ql-align-justify>那我要是想算</p><p class=ql-align-justify>AX2+B</p><p class=ql-align-justify>呢？简单，你把加法器模块和位移模块的接线改一下就行了，改成输入A先过位移模块，再进加法器就可以了。</p><p class=ql-align-justify>啥？？？？你说啥？？？你的意思是我改个程序还得重新接线？</p><p class=ql-align-justify>所以你以为呢？编程就是把线来回插啊。</p><p class=ql-align-justify></p><div class=pgc-img><img alt=知乎神回复：计算机CPU是如何认识代码的，当然是一看就会 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d89c38878f6f44959352121eda2937dc><p class=pgc-img-caption></p></div><p class=ql-align-justify></p><p class=ql-align-justify>惊喜不惊喜？意外不意外？</p><p class=ql-align-justify>早期的计算机就是这样编程的，几分钟就算完了但插线好几天。而且插线是个细致且需要耐心的工作，所以那个时候的程序员都是清一色的漂亮女孩子，穿制服的那种，就像照片上这样。是不是有种生不逢时的感觉？</p><p class=ql-align-justify>虽然和美女作伴是个快乐的事，但插线也是个累死人的工作。所以我们需要改进一下，让CPU可以根据指令来相加或者乘2。</p><p class=ql-align-justify>这里再引入两个模块，一个叫flip-flop，简称FF，中文好像叫触发器。</p><p class=ql-align-justify></p><div class=pgc-img><img alt=知乎神回复：计算机CPU是如何认识代码的，当然是一看就会 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7d2663de2a5c44fd9959159626637964><p class=pgc-img-caption></p></div><p class=ql-align-justify></p><p class=ql-align-justify>这个模块的作用是存储1bit数据。比如上面这个RS型的FF，R是Reset，输入1则清零。S是Set，输入1则保存1。RS都输入0的时候，会一直输出刚才保存的内容。</p><p class=ql-align-justify>我们用FF来保存计算的中间数据（也可以是中间状态或者别的什么），1bit肯定是不够的，不过我们可以并联嘛，用4个或者8个来保存4位或者8位数据。这种我们称之为寄存器（Register）。</p><p class=ql-align-justify>另外一个叫MUX，中文叫选择器。</p><p class=ql-align-justify></p><div class=pgc-img><img alt=知乎神回复：计算机CPU是如何认识代码的，当然是一看就会 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2c8902c5676c44f2abf7b7c40c9a64b6><p class=pgc-img-caption></p></div><p class=ql-align-justify></p><p class=ql-align-justify>这个就简单了，sel输入0则输出i0的数据，i0是什么就输出什么，01皆可。同理sel如果输入1则输出i1的数据。当然选择器可以做的很长，比如这种四进一出的</p><p class=ql-align-justify></p><div class=pgc-img><img alt=知乎神回复：计算机CPU是如何认识代码的，当然是一看就会 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/fd801ad34c2e47698fe519f37670296b><p class=pgc-img-caption></p></div><p class=ql-align-justify></p><p class=ql-align-justify>具体原理不细说了，其实看看逻辑图琢磨一下就懂了，知道有这个东西就行了。另外C/C++就是一个既可以强化思维能力，又可以打好编程基础的编程语言，你要做做软件开发，成为核心程序员的话，就来抠抠学习C/C++吧！你如果感觉自学C/C++语言有困难的话，C/C++编程学习，六七一，二七4和157。即使是零基础的学习者，都可以一起成长进步。</p><p class=ql-align-justify>有这个东西我们就可以给加法器和乘2模块（位移）设计一个激活针脚。</p><p class=ql-align-justify>这个激活针脚输入1则激活这个模块，输入0则不激活。这样我们就可以控制数据是流入加法器还是位移模块了。</p><p class=ql-align-justify>于是我们给CPU先设计8个输入针脚，4位指令，4位数据。</p><p class=ql-align-justify>我们再设计3个指令：</p><p class=ql-align-justify>0100，数据读入寄存器</p><p class=ql-align-justify>0001，数据与寄存器相加，结果保存到寄存器</p><p class=ql-align-justify>0010，寄存器数据向左位移一位（乘2）</p><p class=ql-align-justify>为什么这么设计呢，刚才也说了，我们可以为每个模块设计一个激活针脚。然后我们可以分别用指令输入的第二第三第四个针脚连接寄存器，加法器和位移器的激活针脚。</p><p class=ql-align-justify>这样我们输入0100这个指令的时候，寄存器输入被激活，其他模块都是0没有激活，数据就存入寄存器了。同理，如果我们输入0001这个指令，则加法器开始工作，我们就可以执行相加这个操作了。</p><p class=ql-align-justify>这里就可以简单回答这个问题的第一个小问题了：</p><p class=ql-align-justify>那cpu 是为什么能看懂这些二级制的数呢？</p><p class=ql-align-justify>为什么CPU能看懂，因为CPU里面的线就是这么接的呗。你输入一个二进制数，就像开关一样激活CPU里面若干个指定的模块以及改变这些模块的连同方式，最终得出结果。</p><p class=ql-align-justify>几个可能会被问道的问题</p><p class=ql-align-justify>Q：CPU里面可能有成千上万个小模块，一个32位/64位的指令能控制那么多吗？</p><p class=ql-align-justify>A：我们举例子的CPU里面只有3个模块，就直接接了。真正的CPU里会有一个解码器（decoder），把指令翻译成需要的形式。</p><p class=ql-align-justify>Q：你举例子的简单CPU，如果我输入指令0011会怎么样？</p><p class=ql-align-justify>A：当然是同时激活了加法器和位移器从而产生不可预料的后果，简单的说因为你使用了没有设计的指令，所以后果自负呗。（在真正的CPU上这么干大概率就是崩溃呗，当然肯定会有各种保护性的设计，死也就死当前进程）</p><p class=ql-align-justify>细心的小伙伴可能发现一个问题：你设计的指令</p><p class=ql-align-justify>【0001，数据与寄存器相加，结果保存到寄存器】</p><p class=ql-align-justify>这个一步做不出来吧？毕竟还有一个回写的过程，实际上确实是这样。我们设计的简易CPU执行一个指令差不多得三步，读取指令，执行指令，写寄存器。</p><p class=ql-align-justify>经典的RISC设计则是分5步：读取指令(IF)，解码指令(ID)，执行指令(EX)，内存操作(MEM)，写寄存器(WB)。我们平常用的x86的CPU有的指令可能要分将近20个步骤。</p><p class=ql-align-justify>你可以理解有这么一个开关，我们啪的按一下，CPU就走一步，你按的越快CPU就走的越快。咦？听说你有个想法？少年，你这个想法很危险啊，姑且不说你有没有麒麟臂，能不能按那么快（现代的CPU也就2GHz多，大概也就一秒按个20亿下左右吧）</p><p class=ql-align-justify>就算你能按那么快，虽然速度是上去了，但功耗会大大增加，发热上升稳定性下降。江湖上确实有这种玩法，名曰超频，不过新手不推荐你尝试哈。</p><p class=ql-align-justify>那CPU怎么知道自己走到哪一步了呢？前面不是介绍了FF么，这个不光可以用来存中间数据，也可以用来存中间状态，也就是走到哪了。</p><p class=ql-align-justify>具体的设计涉及到FSM（finite-state machine），也就是有限状态机理论，以及怎么用FF实装。这个也是很重要的一块，考试必考哈，只不过跟题目关系不大，这里就不展开讲了。</p><p class=ql-align-justify>我们再继续刚才的讲，现在我们有3个指令了。我们来试试算个（1+4）X2+3吧。</p><p class=ql-align-justify>0100 0001 ；寄存器存入1</p><p class=ql-align-justify>0001 0100 ；寄存器的数字加4</p><p class=ql-align-justify>0010 0000 ；乘2</p><p class=ql-align-justify>0001 0011 ；再加三</p><p class=ql-align-justify>太棒了，靠这台计算机我们应该可以打败所有的幼儿园小朋友，称霸大班了。而且现在我们用的是4位的，如果换成8位的CPU完全可以吊打低年级小学生了！</p><p class=ql-align-justify>实际上用程序控制CPU是个挺高级的想法，再此之前计算机（器）的CPU都是单独设计的。</p><p class=ql-align-justify>1969年一家日本公司BUSICOM想搞程控的计算器，而负责设计CPU的美国公司也觉得每次都重新设计CPU是个挺傻X的事，于是双方一拍即合，于1970年推出一种划时代的产品，世界上第一款微处理器4004。</p><p class=ql-align-justify>这个架构改变了世界，那家负责设计CPU的美国公司也一步一步成为了业界巨头。哦对了，它叫Intel，对，就是噔噔噔噔的那个。</p><p class=ql-align-justify>我们把刚才的程序整理一下，</p><p class=ql-align-justify>01000001000101000010000000010011</p><p class=ql-align-justify>你来把它输入CPU，我去准备一下去幼儿园大班踢馆的工作。</p><p class=ql-align-justify>神马？等我们输完了人家小朋友掰手指都能算出来了？？</p><p class=ql-align-justify>没办法机器语言就是这么反人类。哦，忘记说了，这种只有01组成的语言被称之为机器语言（机器码），是CPU唯一可以理解的语言。另外C/C++就是一个既可以强化思维能力，又可以打好编程基础的编程语言，你要做做软件开发，成为核心程序员的话，就来抠抠学习C/C++吧！你如果感觉自学C/C++语言有困难的话，C/C++编程学习，六七一，二七4和157。即使是零基础的学习者，都可以一起成长进步。不过你把机器语言让人读，绝对一秒变典韦，这谁也受不了。</p><p class=ql-align-justify></p><div class=pgc-img><img alt=知乎神回复：计算机CPU是如何认识代码的，当然是一看就会 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/09bdc64d39344165a1e3f5d178412ab8><p class=pgc-img-caption></p></div><p class=ql-align-justify></p><p class=ql-align-justify>所以我们还是改进一下吧。不过话虽这么讲，也就往前个30年，直接输入01也是个挺普遍的事情。</p><p class=ql-align-justify>于是我们把我们机器语言写成的程序</p><p class=ql-align-justify>0100 0001 ；寄存器存入1</p><p class=ql-align-justify>0001 0100 ；寄存器的数字加4</p><p class=ql-align-justify>0010 0000 ；乘2</p><p class=ql-align-justify>0001 0011 ；再加三</p><p class=ql-align-justify>改写成</p><p class=ql-align-justify>MOV 1 ；寄存器存入1</p><p class=ql-align-justify>ADD 4 ；寄存器的数字加4</p><p class=ql-align-justify>SHL 0 ；乘2</p><p class=ql-align-justify>ADD 3 ；再加三</p><p class=ql-align-justify>是不是容易读多了？这就叫汇编语言。</p><p class=ql-align-justify>知乎作者：Zign</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'知乎','计算机','CPU'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>