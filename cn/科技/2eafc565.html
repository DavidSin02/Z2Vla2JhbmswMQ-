<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ASP.NET Core如何使用压缩中间件提高Web应用程序性能 | 极客快訊</title><meta property="og:title" content="ASP.NET Core如何使用压缩中间件提高Web应用程序性能 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/2f7e2ee9a1f141b48f2b020e9b49f33a"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2eafc565.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2eafc565.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2eafc565.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2eafc565.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2eafc565.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2eafc565.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2eafc565.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2eafc565.html><meta property="article:published_time" content="2020-11-14T21:01:36+08:00"><meta property="article:modified_time" content="2020-11-14T21:01:36+08:00"><meta name=Keywords content><meta name=description content="ASP.NET Core如何使用压缩中间件提高Web应用程序性能"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/2eafc565.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ASP.NET Core如何使用压缩中间件提高Web应用程序性能</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><blockquote><p><strong>前言</strong></p></blockquote><p>压缩可以大大的降低我们Web服务器的响应速度,压缩从而提高我们网页的加载速度,以及节省一定的带宽.</p><blockquote><p><strong>何时使用相应压缩中间件</strong></p></blockquote><p>在IIS，Apache，Nginx中使用基于服务端的响应压缩技术。中间件的执行可能和服务端模块不匹配。HTTP.sys 和Kestrel server目前没有提供内置的压缩支持。</p><p><strong>什么时候使用Response Compression Middleware:</strong></p><ul><li>无法使用以下基于服务器的压缩技术时:</li></ul><ol><li>IIS 动态压缩模块</li><li>apache的GZIP压缩</li><li>Nginx 压缩</li></ol><ul><li>直接托管:</li></ul><ol><li>Http.sys 服务器</li><li>Kestrel 服务器</li></ol><blockquote><p><strong>如何添加MIME</strong></p></blockquote><p>中间件为压缩指定了一组默认的 MIME 类型:</p><ul><li>application/javascript</li><li>application/json</li><li>application/xml</li><li>text/css</li><li>text/html</li><li>text/json</li><li>text/plain</li><li>text/xml</li></ul><pre>Copy public void ConfigureServices(IServiceCollection services) { services.AddResponseCompression(); services.AddRazorPages(); } public void Configure(IApplicationBuilder app, IWebHostEnvironment env) { if (env.IsDevelopment()) { app.UseDeveloperExceptionPage(); } else { app.UseExceptionHandler("/Error"); app.UseHsts(); } app.UseResponseCompression(); app.UseStaticFiles(); app.UseRouting(); app.UseAuthorization(); app.UseEndpoints(endpoints =&gt; { endpoints.MapRazorPages(); }); }</pre><p>默认是采用Brotli压缩</p><p>Brotli is a generic-purpose lossless compression algorithm that compresses data using a combination of a modern variant of the LZ77 algorithm, Huffman coding and 2nd order context modeling, with a compression ratio comparable to the best currently available general-purpose compression methods. It is similar in speed with deflate but offers more dense compression.</p><p>Brotli 是基于LZ77算法的一个现代变体、霍夫曼编码和二阶上下文建模。Google软件工程师在2015年9月发布了包含通用无损数据压缩的Brotli增强版本，特别侧重于HTTP压缩。其中的编码器被部分改写以提高压缩比，编码器和解码器都提高了速度，流式API已被改进，增加更多压缩质量级别。</p><p>与常见的通用压缩算法不同，Brotli使用一个预定义的120千字节字典。该字典包含超过13000个常用单词、短语和其他子字符串，这些来自一个文本和HTML文档的大型语料库。预定义的算法可以提升较小文件的压缩密度。</p><p><strong>摘自：https://segmentfault.com/a/1190000009383543</strong></p><ul><li>MimeTypes:设定要进行压缩的MimeTypes</li><li>GzipCompressionProviderOptions:设置压缩方式(默认是CompressionLevel.Fastest快速压缩)</li></ul><p><strong>压缩前：</strong></p><div class=pgc-img><img alt="ASP.NET Core如何使用压缩中间件提高Web应用程序性能" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2f7e2ee9a1f141b48f2b020e9b49f33a><p class=pgc-img-caption></p></div><p><strong>压缩后：</strong></p><div class=pgc-img><img alt="ASP.NET Core如何使用压缩中间件提高Web应用程序性能" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d2db9dd8b07c424a8549c10940e43ce5><p class=pgc-img-caption></p></div><p>使用压缩的好处就是节省网络流量，压缩资源文件。但是消耗一点CPU性能.</p><p><strong>gzip</strong></p><ul><li>默认情况下, Brotli 压缩提供程序会随Gzip 压缩提供程序一起添加到压缩提供程序的数组中。</li><li>他默认采用的是Brotli压缩,如果客户端不支持Brotli,客户端支持Gzip,则默认为Gzip.</li></ul><pre>Copy public void ConfigureServices(IServiceCollection services) { services.AddResponseCompression(options=&gt; { options.Providers.Add&lt;BrotliCompressionProvider&gt;(); options.Providers.Add&lt;GzipCompressionProvider&gt;(); }); services.AddRazorPages(); }</pre><div class=pgc-img><img alt="ASP.NET Core如何使用压缩中间件提高Web应用程序性能" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/d44d361348394ccdb0290ea76fb57a2a><p class=pgc-img-caption></p></div><p>有些MIME类型是需要我们自己为他将其加入压缩类型中的,我们可以从图中看到目前有一些未被压缩,那么我们可以将他手动增加一下类型.</p><p>Copy</p><p>public void ConfigureServices(IServiceCollection services)</p><p>{</p><p>services.AddResponseCompression(options=> {</p><p>options.Providers.Add&lt;BrotliCompressionProvider>();</p><p>options.Providers.Add&lt;GzipCompressionProvider>();</p><p>options.MimeTypes = ResponseCompressionDefaults.MimeTypes.Concat(</p><p>new[] { "image/x-icon" });</p><p>});</p><p>services.AddRazorPages();</p><p>}</p><blockquote><p><strong>如何配置压缩级别</strong></p></blockquote><p>压缩级别描述CompressionLevel.Fastest压缩应该尽快完成, 即使生成的输出未以最佳方式压缩。CompressionLevel.NoCompression不应执行压缩。CompressionLevel.Optimal即使压缩需要更长的时间, 也应以最佳方式压缩响应。</p><pre>Copypublic void ConfigureServices(IServiceCollection services){ services.AddResponseCompression();  services.Configure&lt;GzipCompressionProviderOptions&gt;(options =&gt;  { options.Level = CompressionLevel.Fastest; }); })}</pre><blockquote><p><strong>安全协议压缩</strong></p></blockquote><p>可以使用EnableForHttps选项控制安全连接上的压缩响应，该选项默认情况下处于禁用状态。对动态生成的页面使用压缩可能会导致安全问题，例如CRIME和BREACH攻击。</p><ul><li>EnableForHttps:是否对HTTPS封包进行压缩(默认是false)</li></ul><pre>Copy public void ConfigureServices(IServiceCollection services) { services.AddResponseCompression(options=&gt; { options.Providers.Add&lt;BrotliCompressionProvider&gt;(); options.Providers.Add&lt;GzipCompressionProvider&gt;(); options.EnableForHttps = true; options.MimeTypes = ResponseCompressionDefaults.MimeTypes.Concat( new[] { "image/x-icon" }); }); services.AddRazorPages(); }</pre><p>作者：冯辉</p><p>出处：https://www.cnblogs.com/yyfh/p/11796421.html</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'ASP','NET','Core'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../cn/%E7%A7%91%E6%8A%80/bf86ceae.html alt="如何在ASP.NET Core中实现面向切面编程(AOP)" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/287c0bf906ec4fd88f87bd726019bf06 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/bf86ceae.html title="如何在ASP.NET Core中实现面向切面编程(AOP)">如何在ASP.NET Core中实现面向切面编程(AOP)</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/2c1045a1.html alt="ASP.NET Core中我们可以使用非常简单的方式，来使用响应压缩" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/7b9fcf79-6ed6-4933-8e57-61f4fa936d65 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/2c1045a1.html title="ASP.NET Core中我们可以使用非常简单的方式，来使用响应压缩">ASP.NET Core中我们可以使用非常简单的方式，来使用响应压缩</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/23b34058.html alt="为ASP.NET Core开发中间件压缩功能提高系统性能" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0e59ba59d6244b84844608d188600738 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/23b34058.html title="为ASP.NET Core开发中间件压缩功能提高系统性能">为ASP.NET Core开发中间件压缩功能提高系统性能</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>