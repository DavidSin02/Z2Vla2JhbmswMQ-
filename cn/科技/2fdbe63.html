<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>一篇文章搞懂android存储目录结构 | 极客快訊</title><meta property="og:title" content="一篇文章搞懂android存储目录结构 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/67a613a4cd9046a98c2db6a411bf0961"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2fdbe63.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2fdbe63.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2fdbe63.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2fdbe63.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2fdbe63.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2fdbe63.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2fdbe63.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2fdbe63.html><meta property="article:published_time" content="2020-10-29T20:53:03+08:00"><meta property="article:modified_time" content="2020-10-29T20:53:03+08:00"><meta name=Keywords content><meta name=description content="一篇文章搞懂android存储目录结构"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/2fdbe63.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一篇文章搞懂android存储目录结构</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><br></p><div class=pgc-img><img alt=一篇文章搞懂android存储目录结构 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/67a613a4cd9046a98c2db6a411bf0961><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right>前言</h1><p>前两天因为开发一个app更新的功能，我将从服务器下载的apk文件放在了内部存储目录（测试手机为小米，路径为：data/user/0/packagename/files）下面，然后安装的时候一直安装不了，提示解析包出错。后来查询发现，安装apk是调用了PackageInstaller，没有相关权限，这个无法获取内部路径，所以会安装不了。借机也复习了一遍Android下面存储相关的知识点，总结一番。</p><h1 class=pgc-h-arrow-right>存储分类</h1><p><br></p><div class=pgc-img><img alt=一篇文章搞懂android存储目录结构 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/08221e8ee0d94d0cbbc3e365becebb8c><p class=pgc-img-caption></p></div><p>对于Android存储目录，我总结成一张思维导图。上面这张图很清楚的展示了Android存储的目录，接下来我们详细分析每一个目录。</p><ul><li><strong>内部存储</strong></li></ul><p>内部存储位于系统中很特殊的一个位置，对于设备中每一个安装的 App，系统都会在 <strong>data/data/packagename/xxx</strong> 自动创建与之对应的文件夹。如果你想将文件存储于内部存储中，那么文件默认只能被你的应用访问到，且一个应用所创建的所有文件都在和应用包名相同的目录下。也就是说应用创建于内部存储的文件，与这个应用是关联起来的。当一个应用卸载之后，内部存储中的这些文件也被删除。对于这个内部目录，用户是无法访问的，除非获取root权限。</p><blockquote class=pgc-blockquote-abstract><p>String fileDir = this.getFilesDir().getAbsolutePath();</p><p>String cacheDir = this.getCacheDir().getAbsolutePath();</p></blockquote><p>一般情况下，我们获取到的路径为<strong>data/data/packagename/xxx</strong>，小米手机下面打印出来的结果如下：</p><p><br></p><div class=pgc-img><img alt=一篇文章搞懂android存储目录结构 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c9d2ec326370446a870160a63a40e156><p class=pgc-img-caption></p></div><p>对于内部存储路径，我们一般通过以下两种方式获取，内部存储空间的获取都需要使用Context：</p><p><strong>context.getFileDir()</strong></p><p>对应内部存储的路径为: <strong>data/data/packagename/files</strong>，但是对于有的手机如：华为，小米等获取到的路径为：<strong>data/user/0/packagename/files</strong></p><p><strong>context.getCacheDir()</strong></p><p>对应内部存储的路径为: <strong>data/data/packagename/cache</strong>，但是对于有的手机如：华为，小米等获取到的路径为：<strong>data/user/0/packagename/cache</strong>应用程序的缓存目录，该目录内的文件在设备内存不足时会优先被删除掉，所以存放在这里的文件是没有任何保障的，可能会随时丢掉。</p><ul><li><strong>外部存储</strong></li></ul><p>针对于外部存储比较容易混淆，因为在Android4.4以前，手机机身存储就叫内部存储，插入的SD卡就是外部存储，但是在Android4.4以后的话，就目前而言，现在的手机自带的存储就很大，现在Android10.0的话，有的手机能达到256G的存储，针对于这种情况，手机机身自带的存储也是外部存储，如果再插入SD卡的话也叫外部存储，因此对于外部存储分为两部分：SD卡和扩展卡内存</p><p>我们通过一段代码来获取手机的外部存储目录，我们用的测试手机是三星G4，带有插入SD卡的：</p><p><br></p><pre><code>if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) {            File[] files = getExternalFilesDirs(Environment.MEDIA_MOUNTED);            for (File file : files) {                Log.e("file_dir", file.getAbsolutePath());            }}</code></pre><p>对于以上代码，打印的结果如下：</p><p><br></p><div class=pgc-img><img alt=一篇文章搞懂android存储目录结构 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/7c9c019aba7a4c72ad4bf6030fa44b7e><p class=pgc-img-caption></p></div><p>打印出两行目录，第一行目录是机身自带的外部存储目录，目录结构为：/storage/emulated/0/Android/data/packagename/files 第二行是存储卡的目录结构，路径为：/storage/extSdCard/Android/data/packagename/files</p><p><strong>扩展外部存储</strong></p><p>此目录路径需要通过context来获取，同时在app卸载之后，这些文件也会被删除。类似于内部存储。</p><p><strong>getExternalCacheDir()</strong></p><p>对应外部存储路径:/storage/emulated/0/Android/data/packagename/cache</p><p><strong>getExternalFilesDir(String type)</strong></p><p>对应外部存储路径:/storage/emulated/0/Android/data/packagename/files</p><p><strong>SD卡存储</strong></p><p>SD卡里面的文件是可以被自由访问，即文件的数据对其他应用或者用户来说都是可以访问的，当应用被卸载之后，其卸载前创建的文件仍然保留。</p><p>对于SD卡上面的文件路径需要通过Environment获取，同时在获取前需要判断SD的状态：</p><blockquote class=pgc-blockquote-abstract><p>MEDIA_UNKNOWN SD卡未知</p><p>MEDIA_REMOVED SD卡移除</p><p>MEDIA_UNMOUNTED SD卡未安装</p><p>MEDIA_CHECKING SD卡检查中，刚装上SD卡时</p><p>MEDIA_NOFS SD卡为空白或正在使用不受支持的文件系统</p><p>MEDIA_MOUNTED SD卡安装</p><p>MEDIA_MOUNTED_READ_ONLY SD卡安装但是只读</p><p>MEDIA_SHARED SD卡共享</p><p>MEDIA_BAD_REMOVAL SD卡移除错误</p><p>MEDIA_UNMOUNTABLE 存在SD卡但是不能挂载，例如发生在介质损坏</p></blockquote><pre><code>String externalStorageState = Environment.getExternalStorageState(); if (externalStorageState.equals(Environment.MEDIA_MOUNTED)){            //sd卡已经安装，可以进行相关文件操作 }</code></pre><p>getExternalStorageDirectory()</p><p>对应外部存储路径:/storage/emulated/0</p><p>getExternalStoragePublicDirectory(String type)</p><p>获取外部存储的共享文件夹路径如：</p><blockquote class=pgc-blockquote-abstract><p>DIRECTORY_MUSIC 音乐目录</p><p>DIRECTORY_PICTURES 图片目录</p><p>DIRECTORY_MOVIES 电影目录</p><p>DIRECTORY_DOWNLOADS 下载目录</p><p>DIRECTORY_DCIM 相机拍照或录像文件的存储目录</p><p>DIRECTORY_DOCUMENTS 文件文档目录</p></blockquote><pre><code>String externalStoragePublicDirectory = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM).getPath();</code></pre><p>以上便是获取相机DCIM目录，对应获取的路径为:/storage/emulated/0/DCIM。</p><ul><li><strong>系统存储目录</strong></li></ul><p><strong>getRootDirectory()</strong></p><p>对应获取系统分区根路径:/system</p><p><strong>getDataDirectory()</strong></p><p>对应获取用户数据目录路径:/data</p><p><strong>getDownloadCacheDirectory()</strong></p><p>对应获取用户缓存目录路径:/cache</p><h1 class=pgc-h-arrow-right>相关概念区别</h1><ul><li><strong>getFileDir()和getCacheDir()区别</strong></li></ul><p>这两个都位于内部存储目录/data/data/packagename/下面，位于同一级别，前者是file目录下面，后面是cache目录下。<br></p><div class=pgc-img><img alt=一篇文章搞懂android存储目录结构 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/af33b68899654d8fb3c3b5e030dc5768><p class=pgc-img-caption></p></div><ul><li><strong>getFileDir()和getExternalFilesDir(String type)区别</strong></li></ul><p>前者位于内部存储目录/data/data/packagename/file下面，后者位于外部存储目录/storage/emulated/0/Android/data/packagename/files下面，它们都存在于应用包名下面，也就是说属于app应用的，所以当app卸载后，它们也会被删除的。</p><p>对于前面提到的app下载升级功能，我们从服务器端下载的app需要放到外部存储目录下面，而不是内部存储目录，因为内部存储目录的空间很小。另外我也做了相关测试，如果将apk放到内部存储目录file下面的话，安装时会出现问题，提示解析包出错。</p><ul><li><strong>清除数据和清除缓存的区别</strong></li></ul><p>在app中有清除数据和清除缓存这两个概念，那么这两者分别清除的是什么目录下面的数据呢？</p><p><strong>清除数据</strong></p><p>清除数据清除的是保存在app中所有数据，就是上面提到的位于packagename下面的所有文件，包含内部存储(/data/data/packagename/)和外部存储(/storage/emulated/0/Android/data/packagename/)。当然除了SD卡上面的数据，SD卡上面的数据当app卸载之后还会存在的。</p><p><strong>清除缓存</strong></p><p>缓存是程序运行时的临时存储空间，它可以存放从网络下载的临时图片，从用户的角度出发清除缓存对用户并没有太大的影响，但是清除缓存后用户再次使用该APP时，由于本地缓存已经被清理，所有的数据需要重新从网络上获取。为了在清除缓存的时候能够正常清除与应用相关的缓存，请将缓存文件存放在getCacheDir()或者 getExternalCacheDir()路径下。</p><p><br></p><div class=pgc-img><img alt=一篇文章搞懂android存储目录结构 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/b9461e8b893347768ddd37865f88bdac><p class=pgc-img-caption></p></div><p>以上便是Android系统中管存储目录的一些知识。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'搞懂','android','存储'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>