<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>汇编int21h指令以及软中断和硬中断的解释 | 极客快訊</title><meta property="og:title" content="汇编int21h指令以及软中断和硬中断的解释 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/0dac66b8b9f54acabbc241b6a38830a5"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/30d3c5d7.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/30d3c5d7.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/30d3c5d7.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/30d3c5d7.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/30d3c5d7.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/30d3c5d7.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/30d3c5d7.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/30d3c5d7.html><meta property="article:published_time" content="2020-11-14T21:04:32+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:32+08:00"><meta name=Keywords content><meta name=description content="汇编int21h指令以及软中断和硬中断的解释"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/30d3c5d7.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>汇编int21h指令以及软中断和硬中断的解释</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>CPU的设计者必须在中断信息和其处理程序的入口地址之间建立某种联系，使得CPU根据中断信息可以找到要执行的处理程序。</p><p>我们知道，中断信息中包含有标识中断源的类型码。根据CPU的设计，中断类型码的作用就是用来定位中断处理程序。</p><p>比如CPU 根据中断类型码 13，就可以找到13号中断的处理程序。</p><p>可随之而来的问题是，若要定位中断处理程序，需要知道它的段地址和偏移地址，而如何根据 8位的中断类型码得到中断处理程序的段地址和偏移地址呢？</p><p>CPU用 8 位的中断类型码通过中断向量表找到相应的中断处理程序的入口地址。</p><p>那么什么是中断向量表呢？</p><p>中断向量表就是用来存储中断向量的列表。</p><p>中断向量表在内存中保存，其中存放着 256个中断源所对应的中断处理程序的入口地址，<strong>每个入口地址占4个存储单元</strong>。如下图所示：</p><div class=pgc-img><img alt=汇编int21h指令以及软中断和硬中断的解释 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0dac66b8b9f54acabbc241b6a38830a5><p class=pgc-img-caption>图一</p></div><p>中断向量表在内存中存放，对于8086PC机，中断向量表指定放在内存地址0处。</p><p>从内存0000:0000到0000:03FF的1024个单元中存放着中断向量表。</p><p>从上面的讲解中，我们知道，可以用中断类型码，在中断向量表中找到中断处理程序的入口。</p><p>找到这个入口地址的最终目的是用它设置CS和IP，使CPU执行中断处理程序。</p><p>用中断类型码找到中断向量，并用它设置CS和IP，这个工作是由CPU的硬件自动完成的。</p><p>CPU 硬件完成这个工作的过程被称为中断过程。</p><p>int 21h 中断例程是DOS提供的中断例程，其中包含了DOS提供给程序员在编程时调用的子程序，DOS中断的功能主要包括：<br>1、DOS键盘功能调用<br>2、DOS显示功内能调用<br>3、DOS打印功能<br>4、DOS串行口通信功能调用。</p><p>因为int 21h 中断例程对应的中断类型码为21，它的中断处理程序的入口地址应该从21×4地址单元开始存放，段地址存放在 21×4+2 字单元中，偏移地址存放在21×4字单元中。</p><p>经常使用的是 int 21中断例程的4ch号功能，即程序返回功能，如下：</p><p>mov ah,4ch ;程序返回</p><p>mov al,0 ;返回值</p><p>int 21h</p><p><strong>(ah)=4ch表示调用第21h号中断例程的 4ch号子程序</strong>，功能为程序返回，可以提供返回值作为参数。</p><p>下面在Int 21H指令的基础上，举例说明软中断和硬中断的区别。</p><div class=pgc-img><img alt=汇编int21h指令以及软中断和硬中断的解释 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1a019dd688fc46b4a58fc53b49d9efbc><p class=pgc-img-caption>图二</p></div><p>图2是一个利用键盘和屏幕进行输入输出的汇编程序，其结果是从键盘输入数字的时候屏幕照样显示数字，输入其他字符的时候则显示‘*’号，输入回车键结束。运行结果如图3所示。程序中分别调用了</p><p>int 21h的9号功能：字符串显示；7号功能：字符输入；2号功能：字符显示。</p><div class=pgc-img><img alt=汇编int21h指令以及软中断和硬中断的解释 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/51e9bc756b8142b8a158eee90164113c><p class=pgc-img-caption>图三 图二程序的运行结果</p></div><p>内中断的意思是指，CPU不再接着刚执行完的指令向下执行，而是转去处理这个特殊信息。外中断是指CPU 在计算机系统中，除了能够执行指令，进行运算以外，还应该能够对外部设备进行控制，接收它们的输入，向它们进行输出。该程序中的语句</p><p>mov ah,7；</p><p>int 21h</p><p>属于DOS中断中的7号功能调用，用来接收键盘输入的信息，属于软中断，也称内中断，其过程是按照int 21h指令寻找中断程序入口地址，这一中断程序正是用来读取键盘输入字符的，中断由int 21h指令触发；指令</p><p>in al,60h</p><p>是直接读入60h号端口的信息，而60h号端口的信息同样来自于键盘输入，该指令执行时将触发 int 9H外中断处理程序，该外中断可以扫描相关键盘上的每一个按键所连接的开关电路状态的变换，从而判断出被按下的ascii码键值，先送入端口60H，再送入寄存器al，这一中断过程属于硬中断（外中断）。外中断是由外部因素引起（某人施加了力量在键盘的按键上，引起了相应开关电路的变化，这种变化触发了某个程序的执行，这个被触发的程序就属于外中断）。这个例子可以理解为in al,60h指令先接通了某个开关，允许int 9H中断执行，但这个中断是否执行，要看外部电路是否有变化。</p><p>指令</p><p>mov ah,7；</p><p>int 21h</p><p>和指令</p><p>in al,60h</p><p>可以相互替代。</p><p>这三条指令的相互替换很好地解释了软中断和硬中断之间的区别和联系。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'int21h','软中断','中断'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>