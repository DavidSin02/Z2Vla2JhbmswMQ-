<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>不会还有人不了解with语句和上下文管理器吧？ | 极客快訊</title><meta property="og:title" content="不会还有人不了解with语句和上下文管理器吧？ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/262a15608a9f4a7ea0c6cbb2111ffe09"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/30f6d38d.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/30f6d38d.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/30f6d38d.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/30f6d38d.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/30f6d38d.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/30f6d38d.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/30f6d38d.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/30f6d38d.html><meta property="article:published_time" content="2020-11-14T20:59:46+08:00"><meta property="article:modified_time" content="2020-11-14T20:59:46+08:00"><meta name=Keywords content><meta name=description content="不会还有人不了解with语句和上下文管理器吧？"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/30f6d38d.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>不会还有人不了解with语句和上下文管理器吧？</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>文件操作</h1><ul><li>文件操作的作用把一些内容(数据)存储存放起来，可以让程序下一次执行的时候直接使用，而不必重新制作一份,省时省力</li><li>文件的基本操作：可以只打开和关闭文件,不进行任何读写操作</li><li>打开</li><li>使用open函数, 可以打开一个已经存放的文件, 或者创建一个新的文件,</li><li>语法:</li><li>open(name, mode)</li><li>name: 是要打开的目录文件名的字符串(可以包含文件所在的具体位置)</li><li>mode: 设置文件的模式(访问模式)：只读、写入、追加等</li><li>例如：</li><li>f = open('test.txt', 'w') <em># 注意: 此时的f是open函数的文件对象</em></li><li>访问模式:</li><li>模式</li><li>描述</li><li>r</li><li>以只读方式打开文件。文件的指针将会放在文件的开头。这是默认模式。</li><li>rb</li><li>以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。这是默认模式。</li><li>r+</li><li>打开一个文件用于读写。文件指针将会放在文件的开头。</li><li>rb+</li><li>以二进制格式打开一个文件用于读写。文件指针将会放在文件的开头。</li><li>w</li><li>打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。</li><li>wb</li><li>以二进制格式打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。</li><li>w+</li><li>打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。</li><li>wb+</li><li>以二进制格式打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。</li><li>a</li><li>打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</li><li>a+</li><li>打开一个文件用于读写。如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是追加模式。如果该文件不存在，创建新文件用于读写。</li><li>ab</li><li>以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</li><li>ab+</li><li>以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。如果该文件不存在，创建新文件用于读写。</li><li>主访问模式的特点:</li><li><em># r: 如果文件不存在,报错; 不支持写入操作,表示只读</em></li><li>f = open('test1.txt','r')</li><li>f = open('test.txt','r')</li><li>f.write('aa')</li><li>f.close()</li><li><br></li><li><br></li><li><em># w：只写,如果文件不存在,新建文件; 如果执行写入会覆盖原有内容</em></li><li>f = open('1.txt','w')</li><li>f.write('bbb')</li><li>f.close()</li><li><br></li><li><br></li><li><em># a：追加,如果文件不存在,新建文件; 在原有内容基础上追加新内容</em></li><li>f = open('2.txt','a')</li><li>f.write('xyz')</li><li>f.close()</li><li><br></li><li><em># 访问模式参数是否可以省略, 如果省略表示访问模式为r</em></li><li>f = open('1.txt')</li><li>f.close()</li><li><br></li><li><br></li><li>访问模式特点2：</li><li><em># r+: r+没有该文件则报错; r特点:文件指针在开头,所以能读取出来数据</em></li><li>f = open('test1.txt', 'r+')</li><li>f = open('test.txt', 'r+')</li><li><br></li><li><em># w+: 没有该文件会新建文件; w特点: 文件指针在开头,用新内容覆盖原内容.</em></li><li>f = open('test1.txt', 'w+')</li><li>f = open('test.txt', 'w+')</li><li><br></li><li><em># a+: 没有该文件会新建文件; a特点: 文件指针在结尾,无法读取数据(文件指针后面没有数据)</em></li><li>f = open('test100.txt', 'a+')</li><li>f = open('test.txt', 'a+')</li><li>con = f.read()</li><li>print(con)</li><li>f.close()</li><li><br></li><li>写</li><li>语法：</li><li>文件对象. write('内容')</li><li>例如：</li><li><em># 1. 打开文件</em></li><li>f = open('test.txt', 'w')</li><li><em># 2. 文件写入</em></li><li>f.write('hello world')</li><li><em># 3. 关闭文件</em></li><li>f.close()</li><li><em># 注意:</em></li><li><em># 1. w和a模式: 如果文件不存在则创建文件;如果文件存在，w模式先清空再写入, a模式直接末尾追加</em></li><li><em># 2. r模式: 如果文件不存在则报错</em></li><li><br></li><li>读</li><li>语法一:</li><li>文件对象.read(num)</li><li>num表示要从这个文件中读取的数据的长度(单位是字节), 如果没有传入num，那么就表示读取文件中的所有的数据</li><li>例如:</li><li>f = open('test.txt','r')</li><li><em># 文件内容如果换行：底层有\n,会有字节的占位,导致read书写参数读取出来的眼睛看到的个数和参数值不匹配</em></li><li><em># read不写参数表示读取所有的;</em></li><li><em># print(f.read())</em></li><li>print(f.read(10)) f.close()</li><li><br></li><li>语法二：</li><li>文件对象.readlines()</li><li>readlines可以按照行的方式把整个文件中的内容进行一次性读取,并返回的是一个列表，其中一行的数据为一个元素</li><li>例如：</li><li>f = open('test.txt')</li><li>content = f.readlines()</li><li><em># ['hello world\n', 'abcdefg\n', 'aaa\n', 'bbb\n', 'ccc']</em></li><li>print(content)</li><li><br></li><li>语法三:</li><li>文件对象.readline()</li><li>readline()一次读取一行内容</li><li>f = open('test.txt','r')</li><li>content = f.readline()</li><li>print(f'第一行:{content}')</li><li>content = f.readlin()</li><li>pint(f'第二行:{content}')</li><li><em># 关闭文件</em></li><li>f.close()</li><li><br></li><li><br></li><li>语法四：</li><li>文件对象.seek(偏移量, 起始位置)</li><li>起始位置：0：文件开头 1：当前位置 2：文件结尾</li><li><em># f = open('test.txt', 'r+')</em></li><li>f = open('test.txt', 'a+')</li><li><em># 1. 改变读取数据开始位置</em></li><li><em># f.seek(2,0)</em></li><li><em># 1. 文件指针放在结尾(无法读取数据)</em></li><li><em># f.seek(0,2)</em></li><li><em>2. a 改变文件指针的位置,做到可以读取出来数据</em></li><li><em># f.seek(0,0)</em></li><li>f.seek(0)</li><li>con = f.read()</li><li>print(con)</li><li>f.close()</li><li>关闭语法：文件对象.close()</li></ul><ul><li>文件备份</li><li>文件备份的步骤</li><li>接收用户输入的文件名</li><li>规划备份文件名</li><li>备份文件写入数据</li><li>例如:</li><li><em># 1. 用户输入目标文件 sound.txt.mp3</em></li><li>old_name = input('请输入您要备份的文件名:')</li><li><em># print(old_name)</em></li><li><em># print(type(old_name))</em></li><li><em># 2. 规划备份文件的名字</em></li><li><em># 2.1 提取后缀 -- 找到名字中的点 -- 名字和后缀分离 -- 最右侧的点才是后缀的点 -- 字符串查找某个子串rfind</em></li><li>index = old_name.rfind('.')</li><li><em># print(index)</em></li><li><em># 2.2 组织新名字 = 原名字 + [备份] + 后缀</em></li><li><em># 原名字就是字符串中的一部分子串 -- 切片[开始:结束:步长]</em></li><li><em># print(old_name[:index])</em></li><li><em># print(old_name[index:])</em></li><li><em># 4. 思考: 有效文件才备份 .txt</em></li><li><strong>if</strong> index > 0:</li><li><em># 提取后缀</em></li><li>postfix = old_name[index:]</li><li>new_name = old_name[:index] + '[备份]' + postfix</li><li>print(new_name)</li><li><em># 3. 备份文件写入数据(数据和原文件一样)</em></li><li><em># 3.1 打开 原文件 和 备份文件</em></li><li>old_f = open(old_name, 'rb')</li><li>new_f = open(new_name, 'wb')</li><li><em># 3.2 原文件读取, 备份文件写入</em></li><li><em># 如果不确定目标文件大小,循环读取写入,当读取出来的数据没有了终止循环</em></li><li><strong>while</strong> <strong>True</strong>:</li><li>con = old_f.read(1024)</li><li><strong>if</strong> len(con) == 0:</li><li><em># 表示读取完成了</em></li><li><strong>break</strong></li><li>new_f.write(con)</li><li><em># 3.3 关闭文件</em></li><li>old_f.close()</li><li>new_f.close()</li></ul><ul><li>文件和文件夹操作</li><li>os模块使用</li><li>在Python中文件和文件夹的操作要借助os模块里面的相关功能</li><li>步骤：</li><li>导入os模块</li><li><strong>import</strong> os</li><li>b.使用os模块相关功能</li><li>os.函数名()</li><li>文件重命名</li><li>os.rename(目标文件名, 新文件名)</li><li>删除文件</li><li>os.remove(目标文件名)</li><li>创建文件夹</li><li>os.mkdir(文件夹名字)</li><li>删除文件夹</li><li>os.rmdir(文件夹名字)</li><li>获取当前目录</li><li>os.getcwd()</li><li>改变默认目录</li><li>os.chdir(目录)</li><li>获取目录列表</li><li>os.listdir(目录)</li></ul><p><br></p><div class=pgc-img><img alt=不会还有人不了解with语句和上下文管理器吧？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/262a15608a9f4a7ea0c6cbb2111ffe09><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right>with语句和上下文管理器</h1><ul><li>with语句的作用</li><li>python提供了with语句的写法, 即简单又安全</li><li>文件操作的时候使用with语句可以<strong>自动</strong>调用<strong>关闭文件操作</strong>，即使出现了<strong>异常</strong>也会<strong>自动调用关闭</strong></li><li><strong>文件操作文件使用完后必须关闭，因为文件对象会占用操作系统的资源，并且操作系统同一时间能打开的文件数量也是有限的。</strong></li><li>上下文管理器</li><li>with语句之所以这么强大，背后是由上下文管理器做支撑的</li><li>也就是说使用f = open('xxx')中的<strong>open函数</strong>创建的<strong>f文件对象</strong>就是一个上下文管理器对象</li><li><strong>什么是上下文管理器？</strong></li><li>一个类只要实现了__enter__()和__exit__()这两个方法</li><li>通过该类创建的<strong>对象</strong>我们就称之为<strong>上下文管理器</strong></li><li><strong>class</strong> <strong>File</strong>(object):</li><li><em># 初始化方法</em></li><li><strong>def</strong> <strong>__init__</strong>(self, file_name, file_mode1):</li><li><em># 定义变量保存文件名和打开模式</em></li><li>self.file_name = file_name</li><li>self.file_mode1 = file_mode1</li><li><em># 上文方法</em> <strong>def</strong> <strong>__enter__</strong>(self):</li><li>print('进入上文的方法')</li><li><em># 返回文件资源</em></li><li>self.file = open(self.file_name, self.file_mode1)</li><li><strong>return</strong> self.file</li><li><em># 下文方法</em> <strong>def</strong> <strong>__exit__</strong>(self, exc_type, exc_val, exc_tb):</li><li>print('进入下文的方法')</li><li>self.colose()</li><li>__enter__表示上文方法，需要返回一个操作文件的对象</li><li>__exit__表示下文方法，with语句执行完成后会自动执行，即使出现异常也</li><li>[原创]禁止转载</li><li><br></li></ul><p><br>最后，小编想说：我是一名python开发工程师，</p><p style=text-align:start>整理了一套最新的python系统学习教程，</p><p style=text-align:start>想要这些资料的可以关注私信小编“01”即可（免费分享哦）希望能对你有所帮助</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'管理器','不会还','了解'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>