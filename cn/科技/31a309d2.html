<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ä¼ä¸šAPIæ¥å£è®¾è®¡(tokenã€timestampã€sign)ä¹‹å…·ä½“å®ç° | æå®¢å¿«è¨Š</title><meta property="og:title" content="ä¼ä¸šAPIæ¥å£è®¾è®¡(tokenã€timestampã€sign)ä¹‹å…·ä½“å®ç° - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/030192793c5048239b469f5e5db8b18d"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/31a309d2.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/31a309d2.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/31a309d2.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/31a309d2.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/31a309d2.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/31a309d2.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/31a309d2.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/31a309d2.html><meta property="article:published_time" content="2020-11-14T21:00:28+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:28+08:00"><meta name=Keywords content><meta name=description content="ä¼ä¸šAPIæ¥å£è®¾è®¡(tokenã€timestampã€sign)ä¹‹å…·ä½“å®ç°"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/31a309d2.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ä¼ä¸šAPIæ¥å£è®¾è®¡(tokenã€timestampã€sign)ä¹‹å…·ä½“å®ç°</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right><strong>æœ¬å·ä¸»è¦ç”¨äºåˆ†äº«ä¼ä¸šä¸­å¸¸ç”¨çš„æŠ€æœ¯ï¼Œæ›´åŠ ä¾§é‡äºå®ç”¨ï¼Œæ¬¢è¿å…³æ³¨ã€æ”¶è—ï¼Œä¾¿äºæµè§ˆå…¶å®ƒæ›´å¤šå®ç”¨çš„å†å²æ–‡ç« ã€‚</strong></h1><div class=pgc-img><img alt=ä¼ä¸šAPIæ¥å£è®¾è®¡(tokenã€timestampã€sign)ä¹‹å…·ä½“å®ç° onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/030192793c5048239b469f5e5db8b18d><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>ä¸€ï¼štoken ç®€ä»‹</strong></h1><p>Tokenï¼šè®¿é—®ä»¤ç‰Œaccess token, ç”¨äºæ¥å£ä¸­, ç”¨äºæ ‡è¯†æ¥å£è°ƒç”¨è€…çš„èº«ä»½ã€å‡­è¯ï¼Œå‡å°‘ç”¨æˆ·åå’Œå¯†ç çš„ä¼ è¾“æ¬¡æ•°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹å®¢æˆ·ç«¯(æ¥å£è°ƒç”¨æ–¹)éœ€è¦å…ˆå‘æœåŠ¡å™¨ç«¯ç”³è¯·ä¸€ä¸ªæ¥å£è°ƒç”¨çš„è´¦å·ï¼ŒæœåŠ¡å™¨ä¼šç»™å‡ºä¸€ä¸ªappIdå’Œä¸€ä¸ªkey, keyç”¨äºå‚æ•°ç­¾åä½¿ç”¨ï¼Œæ³¨æ„keyä¿å­˜åˆ°å®¢æˆ·ç«¯ï¼Œéœ€è¦åšä¸€äº›å®‰å…¨å¤„ç†ï¼Œé˜²æ­¢æ³„éœ²ã€‚</p><p>Tokençš„å€¼ä¸€èˆ¬æ˜¯UUIDï¼ŒæœåŠ¡ç«¯ç”ŸæˆTokenåéœ€è¦å°†tokenåšä¸ºkeyï¼Œå°†ä¸€äº›å’Œtokenå…³è”çš„ä¿¡æ¯ä½œä¸ºvalueä¿å­˜åˆ°ç¼“å­˜æœåŠ¡å™¨ä¸­(redis)ï¼Œå½“ä¸€ä¸ªè¯·æ±‚è¿‡æ¥åï¼ŒæœåŠ¡å™¨å°±å»ç¼“å­˜æœåŠ¡å™¨ä¸­æŸ¥è¯¢è¿™ä¸ªTokenæ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™è°ƒç”¨æ¥å£ï¼Œä¸å­˜åœ¨è¿”å›æ¥å£é”™è¯¯ï¼Œä¸€èˆ¬é€šè¿‡æ‹¦æˆªå™¨æˆ–è€…è¿‡æ»¤å™¨æ¥å®ç°ï¼ŒTokenåˆ†ä¸ºä¸¤ç§ï¼š</p><p>API Token(æ¥å£ä»¤ç‰Œ): ç”¨äºè®¿é—®ä¸éœ€è¦ç”¨æˆ·ç™»å½•çš„æ¥å£ï¼Œå¦‚ç™»å½•ã€æ³¨å†Œã€ä¸€äº›åŸºæœ¬æ•°æ®çš„è·å–ç­‰ã€‚ è·å–æ¥å£ä»¤ç‰Œéœ€è¦æ‹¿appIdã€timestampå’Œsignæ¥æ¢ï¼Œsign=åŠ å¯†(timestamp+key)</p><p>USER Token(ç”¨æˆ·ä»¤ç‰Œ): ç”¨äºè®¿é—®éœ€è¦ç”¨æˆ·ç™»å½•ä¹‹åçš„æ¥å£ï¼Œå¦‚ï¼šè·å–æˆ‘çš„åŸºæœ¬ä¿¡æ¯ã€ä¿å­˜ã€ä¿®æ”¹ã€åˆ é™¤ç­‰æ“ä½œã€‚è·å–ç”¨æˆ·ä»¤ç‰Œéœ€è¦æ‹¿ç”¨æˆ·åå’Œå¯†ç æ¥æ¢</p><p>å…³äºTokençš„æ—¶æ•ˆæ€§ï¼štokenå¯ä»¥æ˜¯ä¸€æ¬¡æ€§çš„ã€ä¹Ÿå¯ä»¥åœ¨ä¸€æ®µæ—¶é—´èŒƒå›´å†…æ˜¯æœ‰æ•ˆçš„ï¼Œå…·ä½“ä½¿ç”¨å“ªç§çœ‹ä¸šåŠ¡éœ€è¦ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹æ¥å£æœ€å¥½ä½¿ç”¨httpsåè®®ï¼Œå¦‚æœä½¿ç”¨httpåè®®ï¼ŒTokenæœºåˆ¶åªæ˜¯ä¸€ç§å‡å°‘è¢«é»‘çš„å¯èƒ½æ€§ï¼Œå…¶å®åªèƒ½é˜²å›å­ä¸èƒ½é˜²å°äººã€‚</p><p>ä¸€èˆ¬tokenã€timestampå’Œsign ä¸‰ä¸ªå‚æ•°ä¼šåœ¨æ¥å£ä¸­ä¼šåŒæ—¶ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œæ¯ä¸ªå‚æ•°éƒ½æœ‰å„è‡ªçš„ç”¨é€”ã€‚</p><h1 class=pgc-h-arrow-right><strong>äºŒï¼štimestamp ç®€ä»‹</strong></h1><p>timestamp: æ—¶é—´æˆ³ï¼Œæ˜¯å®¢æˆ·ç«¯è°ƒç”¨æ¥å£æ—¶å¯¹åº”çš„å½“å‰æ—¶é—´æˆ³ï¼Œæ—¶é—´æˆ³ç”¨äºé˜²æ­¢DoSæ”»å‡»ã€‚å½“é»‘å®¢åŠ«æŒäº†è¯·æ±‚çš„urlå»DoSæ”»å‡»ï¼Œæ¯æ¬¡è°ƒç”¨æ¥å£æ—¶æ¥å£éƒ½ä¼šåˆ¤æ–­æœåŠ¡å™¨å½“å‰ç³»ç»Ÿæ—¶é—´å’Œæ¥å£ä¸­ä¼ çš„çš„timestampçš„å·®å€¼ï¼Œå¦‚æœè¿™ä¸ªå·®å€¼è¶…è¿‡æŸä¸ªè®¾ç½®çš„æ—¶é—´(å‡å¦‚5åˆ†é’Ÿ)ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚å°†è¢«æ‹¦æˆªæ‰ï¼Œå¦‚æœåœ¨è®¾ç½®çš„è¶…æ—¶æ—¶é—´èŒƒå›´å†…ï¼Œæ˜¯ä¸èƒ½é˜»æ­¢DoSæ”»å‡»çš„ã€‚ timestampæœºåˆ¶åªèƒ½å‡è½»DoSæ”»å‡»çš„æ—¶é—´ï¼Œç¼©çŸ­æ”»å‡»æ—¶é—´ã€‚å¦‚æœé»‘å®¢ä¿®æ”¹äº†æ—¶é—´æˆ³çš„å€¼å¯é€šè¿‡signç­¾åæœºåˆ¶æ¥å¤„ç†ã€‚</p><p>DoS</p><p>DoSæ˜¯Denial of Serviceçš„ç®€ç§°ï¼Œå³æ‹’ç»æœåŠ¡ï¼Œé€ æˆDoSçš„æ”»å‡»è¡Œä¸ºè¢«ç§°ä¸ºDoSæ”»å‡»ï¼Œå…¶ç›®çš„æ˜¯ä½¿è®¡ç®—æœºæˆ–ç½‘ç»œæ— æ³•æä¾›æ­£å¸¸çš„æœåŠ¡ã€‚æœ€å¸¸è§çš„DoSæ”»å‡»æœ‰è®¡ç®—æœºç½‘ç»œå¸¦å®½æ”»å‡»å’Œè¿é€šæ€§æ”»å‡»ã€‚</p><p>DoSæ”»å‡»æ˜¯æŒ‡æ•…æ„çš„æ”»å‡»ç½‘ç»œåè®®å®ç°çš„ç¼ºé™·æˆ–ç›´æ¥é€šè¿‡é‡è›®æ‰‹æ®µæ®‹å¿åœ°è€—å°½è¢«æ”»å‡»å¯¹è±¡çš„èµ„æºï¼Œç›®çš„æ˜¯è®©ç›®æ ‡è®¡ç®—æœºæˆ–ç½‘ç»œæ— æ³•æä¾›æ­£å¸¸çš„æœåŠ¡æˆ–èµ„æºè®¿é—®ï¼Œä½¿ç›®æ ‡ç³»ç»ŸæœåŠ¡ç³»ç»Ÿåœæ­¢å“åº”ç”šè‡³å´©æºƒï¼Œè€Œåœ¨æ­¤æ”»å‡»ä¸­å¹¶ä¸åŒ…æ‹¬ä¾µå…¥ç›®æ ‡æœåŠ¡å™¨æˆ–ç›®æ ‡ç½‘ç»œè®¾å¤‡ã€‚è¿™äº›æœåŠ¡èµ„æºåŒ…æ‹¬ç½‘ç»œå¸¦å®½ï¼Œæ–‡ä»¶ç³»ç»Ÿç©ºé—´å®¹é‡ï¼Œå¼€æ”¾çš„è¿›ç¨‹æˆ–è€…å…è®¸çš„è¿æ¥ã€‚è¿™ç§æ”»å‡»ä¼šå¯¼è‡´èµ„æºçš„åŒ®ä¹ï¼Œæ— è®ºè®¡ç®—æœºçš„å¤„ç†é€Ÿåº¦å¤šå¿«ã€å†…å­˜å®¹é‡å¤šå¤§ã€ç½‘ç»œå¸¦å®½çš„é€Ÿåº¦å¤šå¿«éƒ½æ— æ³•é¿å…è¿™ç§æ”»å‡»å¸¦æ¥çš„åæœã€‚</p><p>Pingflood: è¯¥æ”»å‡»åœ¨çŸ­æ—¶é—´å†…å‘ç›®çš„ä¸»æœºå‘é€å¤§é‡pingåŒ…ï¼Œé€ æˆç½‘ç»œå µå¡æˆ–ä¸»æœºèµ„æºè€—å°½ã€‚</p><p>Synflood: è¯¥æ”»å‡»ä»¥å¤šä¸ªéšæœºçš„æºä¸»æœºåœ°å€å‘ç›®çš„ä¸»æœºå‘é€SYNåŒ…ï¼Œè€Œåœ¨æ”¶åˆ°ç›®çš„ä¸»æœºçš„SYN ACKåå¹¶ä¸å›åº”ï¼Œè¿™æ ·ï¼Œç›®çš„ä¸»æœºå°±ä¸ºè¿™äº›æºä¸»æœºå»ºç«‹äº†å¤§é‡çš„è¿æ¥é˜Ÿåˆ—ï¼Œè€Œä¸”ç”±äºæ²¡æœ‰æ”¶åˆ°ACKä¸€ç›´ç»´æŠ¤ç€è¿™</p><p>äº›é˜Ÿåˆ—ï¼Œé€ æˆäº†èµ„æºçš„å¤§é‡æ¶ˆè€—è€Œä¸èƒ½å‘æ­£å¸¸è¯·æ±‚æä¾›æœåŠ¡ã€‚</p><p>Smurfï¼šè¯¥æ”»å‡»å‘ä¸€ä¸ªå­ç½‘çš„å¹¿æ’­åœ°å€å‘ä¸€ä¸ªå¸¦æœ‰ç‰¹å®šè¯·æ±‚ï¼ˆå¦‚ICMPå›åº”è¯·æ±‚ï¼‰çš„åŒ…ï¼Œå¹¶ä¸”å°†æºåœ°å€ä¼ªè£…æˆæƒ³è¦æ”»å‡»çš„ä¸»æœºåœ°å€ã€‚å­ç½‘ä¸Šæ‰€æœ‰ä¸»æœºéƒ½å›åº”å¹¿æ’­åŒ…è¯·æ±‚è€Œå‘è¢«æ”»å‡»ä¸»æœºå‘åŒ…ï¼Œä½¿è¯¥ä¸»æœºå—åˆ°æ”»å‡»ã€‚</p><p>Land-basedï¼šæ”»å‡»è€…å°†ä¸€ä¸ªåŒ…çš„æºåœ°å€å’Œç›®çš„åœ°å€éƒ½è®¾ç½®ä¸ºç›®æ ‡ä¸»æœºçš„åœ°å€ï¼Œç„¶åå°†è¯¥åŒ…é€šè¿‡IPæ¬ºéª—çš„æ–¹å¼å‘é€ç»™è¢«æ”»å‡»ä¸»æœºï¼Œè¿™ç§åŒ…å¯ä»¥é€ æˆè¢«æ”»å‡»ä¸»æœºå› è¯•å›¾ä¸è‡ªå·±å»ºç«‹è¿æ¥è€Œé™·å…¥æ­»å¾ªç¯ï¼Œä»è€Œå¾ˆå¤§ç¨‹åº¦åœ°é™ä½äº†ç³»ç»Ÿæ€§èƒ½ã€‚</p><p>Ping of Deathï¼šæ ¹æ®TCP/IPçš„è§„èŒƒï¼Œä¸€ä¸ªåŒ…çš„é•¿åº¦æœ€å¤§ä¸º65536å­—èŠ‚ã€‚å°½ç®¡ä¸€ä¸ªåŒ…çš„é•¿åº¦ä¸èƒ½è¶…è¿‡65536å­—èŠ‚ï¼Œä½†æ˜¯ä¸€ä¸ªåŒ…åˆ†æˆçš„å¤šä¸ªç‰‡æ®µçš„å åŠ å´èƒ½åšåˆ°ã€‚å½“ä¸€ä¸ªä¸»æœºæ”¶åˆ°äº†é•¿åº¦å¤§äº65536å­—èŠ‚çš„åŒ…æ—¶ï¼Œå°±æ˜¯å—åˆ°äº†Ping of Deathæ”»å‡»ï¼Œè¯¥æ”»å‡»ä¼šé€ æˆä¸»æœºçš„å®•æœºã€‚</p><p>Teardropï¼šIPæ•°æ®åŒ…åœ¨ç½‘ç»œä¼ é€’æ—¶ï¼Œæ•°æ®åŒ…å¯ä»¥åˆ†æˆæ›´å°çš„ç‰‡æ®µã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€ä¸¤æ®µï¼ˆæˆ–è€…æ›´å¤šï¼‰æ•°æ®åŒ…æ¥å®ç°TearDropæ”»å‡»ã€‚ç¬¬ä¸€ä¸ªåŒ…çš„åç§»é‡ä¸º0ï¼Œé•¿åº¦ä¸ºNï¼Œç¬¬äºŒä¸ªåŒ…çš„åç§»é‡å°äºNã€‚ä¸ºäº†åˆå¹¶è¿™äº›æ•°æ®æ®µï¼ŒTCP/IPå †æ ˆä¼šåˆ†é…è¶…ä¹å¯»å¸¸çš„å·¨å¤§èµ„æºï¼Œä»è€Œé€ æˆç³»ç»Ÿèµ„æºçš„ç¼ºä¹ç”šè‡³æœºå™¨çš„é‡æ–°å¯åŠ¨ã€‚</p><p>PingSweepï¼šä½¿ç”¨ICMP Echoè½®è¯¢å¤šä¸ªä¸»æœºã€‚</p><h1 class=pgc-h-arrow-right><strong>ä¸‰ï¼šsign ç®€ä»‹</strong></h1><p>nonceï¼šéšæœºå€¼ï¼Œæ˜¯å®¢æˆ·ç«¯éšæœºç”Ÿæˆçš„å€¼ï¼Œä½œä¸ºå‚æ•°ä¼ é€’è¿‡æ¥ï¼Œéšæœºå€¼çš„ç›®çš„æ˜¯å¢åŠ signç­¾åçš„å¤šå˜æ€§ã€‚éšæœºå€¼ä¸€èˆ¬æ˜¯æ•°å­—å’Œå­—æ¯çš„ç»„åˆï¼Œ6ä½é•¿åº¦ï¼Œéšæœºå€¼çš„ç»„æˆå’Œé•¿åº¦æ²¡æœ‰å›ºå®šè§„åˆ™ã€‚</p><p>sign: ä¸€èˆ¬ç”¨äºå‚æ•°ç­¾åï¼Œé˜²æ­¢å‚æ•°è¢«éæ³•ç¯¡æ”¹ï¼Œæœ€å¸¸è§çš„æ˜¯ä¿®æ”¹é‡‘é¢ç­‰é‡è¦æ•æ„Ÿå‚æ•°ï¼Œ signçš„å€¼ä¸€èˆ¬æ˜¯å°†æ‰€æœ‰éç©ºå‚æ•°æŒ‰ç…§å‡ç»­æ’åºç„¶å+token+key+timestamp+nonce(éšæœºæ•°)æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œç„¶åä½¿ç”¨æŸç§åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†ï¼Œä½œä¸ºæ¥å£ä¸­çš„ä¸€ä¸ªå‚æ•°signæ¥ä¼ é€’ï¼Œä¹Ÿå¯ä»¥å°†signæ”¾åˆ°è¯·æ±‚å¤´ä¸­ã€‚æ¥å£åœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­å¦‚æœè¢«é»‘å®¢æŒŸæŒï¼Œå¹¶ä¿®æ”¹å…¶ä¸­çš„å‚æ•°å€¼ï¼Œç„¶åå†ç»§ç»­è°ƒç”¨æ¥å£ï¼Œè™½ç„¶å‚æ•°çš„å€¼è¢«ä¿®æ”¹äº†ï¼Œä½†æ˜¯å› ä¸ºé»‘å®¢ä¸çŸ¥é“signæ˜¯å¦‚ä½•è®¡ç®—å‡ºæ¥çš„ï¼Œä¸çŸ¥é“signéƒ½æœ‰å“ªäº›å€¼æ„æˆï¼Œä¸çŸ¥é“ä»¥æ€æ ·çš„é¡ºåºæ‹¼æ¥åœ¨ä¸€èµ·çš„ï¼Œæœ€é‡è¦çš„æ˜¯ä¸çŸ¥é“ç­¾åå­—ç¬¦ä¸²ä¸­çš„keyæ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥é»‘å®¢å¯ä»¥ç¯¡æ”¹å‚æ•°çš„å€¼ï¼Œä½†æ²¡æ³•ä¿®æ”¹signçš„å€¼ï¼Œå½“æœåŠ¡å™¨è°ƒç”¨æ¥å£å‰ä¼šæŒ‰ç…§signçš„è§„åˆ™é‡æ–°è®¡ç®—å‡ºsignçš„å€¼ç„¶åå’Œæ¥å£ä¼ é€’çš„signå‚æ•°çš„å€¼åšæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰è¡¨ç¤ºå‚æ•°å€¼æ²¡æœ‰è¢«ç¯¡æ”¹ï¼Œå¦‚æœä¸ç­‰ï¼Œè¡¨ç¤ºå‚æ•°è¢«éæ³•ç¯¡æ”¹äº†ï¼Œå°±ä¸æ‰§è¡Œæ¥å£äº†ã€‚</p><h1 class=pgc-h-arrow-right><strong>å››ï¼šé˜²æ­¢é‡å¤æäº¤</strong></h1><p>å¯¹äºä¸€äº›é‡è¦çš„æ“ä½œéœ€è¦é˜²æ­¢å®¢æˆ·ç«¯é‡å¤æäº¤çš„(å¦‚éå¹‚ç­‰æ€§é‡è¦æ“ä½œ)ï¼Œå…·ä½“åŠæ³•æ˜¯å½“è¯·æ±‚ç¬¬ä¸€æ¬¡æäº¤æ—¶å°†signä½œä¸ºkeyä¿å­˜åˆ°redisï¼Œå¹¶è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶æ—¶é—´å’ŒTimestampä¸­è®¾ç½®çš„å·®å€¼ç›¸åŒã€‚å½“åŒä¸€ä¸ªè¯·æ±‚ç¬¬äºŒæ¬¡è®¿é—®æ—¶ä¼šå…ˆæ£€æµ‹redisæ˜¯å¦å­˜åœ¨è¯¥signï¼Œå¦‚æœå­˜åœ¨åˆ™è¯æ˜é‡å¤æäº¤äº†ï¼Œæ¥å£å°±ä¸å†ç»§ç»­è°ƒç”¨äº†ã€‚å¦‚æœsignåœ¨ç¼“å­˜æœåŠ¡å™¨ä¸­å› è¿‡æœŸæ—¶é—´åˆ°äº†ï¼Œè€Œè¢«åˆ é™¤äº†ï¼Œæ­¤æ—¶å½“è¿™ä¸ªurlå†æ¬¡è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼Œå› tokençš„è¿‡æœŸæ—¶é—´å’Œsignçš„è¿‡æœŸæ—¶é—´ä¸€ç›´ï¼Œsignè¿‡æœŸä¹Ÿæ„å‘³ç€tokenè¿‡æœŸï¼Œé‚£æ ·åŒæ ·çš„urlå†è®¿é—®æœåŠ¡å™¨ä¼šå› tokené”™è¯¯ä¼šè¢«æ‹¦æˆªæ‰ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆsignå’Œtokençš„è¿‡æœŸæ—¶é—´è¦ä¿æŒä¸€è‡´çš„åŸå› ã€‚æ‹’ç»é‡å¤è°ƒç”¨æœºåˆ¶ç¡®ä¿URLè¢«åˆ«äººæˆªè·äº†ä¹Ÿæ— æ³•ä½¿ç”¨ï¼ˆå¦‚æŠ“å–æ•°æ®ï¼‰ã€‚</p><p>å¯¹äºå“ªäº›æ¥å£éœ€è¦é˜²æ­¢é‡å¤æäº¤å¯ä»¥è‡ªå®šä¹‰ä¸ªæ³¨è§£æ¥æ ‡è®°ã€‚</p><p>æ³¨æ„ï¼š</p><p>æ‰€æœ‰çš„å®‰å…¨æªæ–½éƒ½ç”¨ä¸Šçš„è¯æœ‰æ—¶å€™éš¾å…å¤ªè¿‡å¤æ‚ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­éœ€è¦æ ¹æ®è‡ªèº«æƒ…å†µä½œå‡ºè£å‰ªï¼Œæ¯”å¦‚å¯ä»¥åªä½¿ç”¨ç­¾åæœºåˆ¶å°±å¯ä»¥ä¿è¯ä¿¡æ¯ä¸ä¼šè¢«ç¯¡æ”¹ï¼Œæˆ–è€…å®šå‘æä¾›æœåŠ¡çš„æ—¶å€™åªç”¨Tokenæœºåˆ¶å°±å¯ä»¥äº†ã€‚å¦‚ä½•è£å‰ªï¼Œå…¨çœ‹é¡¹ç›®å®é™…æƒ…å†µå’Œå¯¹æ¥å£å®‰å…¨æ€§çš„è¦æ±‚ã€‚</p><h1 class=pgc-h-arrow-right><strong>äº”ï¼šä½¿ç”¨æµç¨‹</strong></h1><p>æ¥å£è°ƒç”¨æ–¹(å®¢æˆ·ç«¯)å‘æ¥å£æä¾›æ–¹(æœåŠ¡å™¨)ç”³è¯·æ¥å£è°ƒç”¨è´¦å·ï¼Œç”³è¯·æˆåŠŸåï¼Œæ¥å£æä¾›æ–¹ä¼šç»™æ¥å£è°ƒç”¨æ–¹ä¸€ä¸ªappIdå’Œä¸€ä¸ªkeyå‚æ•°</p><p>å®¢æˆ·ç«¯æºå¸¦å‚æ•°appIdã€timestampã€signå»è°ƒç”¨æœåŠ¡å™¨ç«¯çš„API tokenï¼Œå…¶ä¸­sign=åŠ å¯†(appId + timestamp + key)</p><p>å®¢æˆ·ç«¯æ‹¿ç€api_token å»è®¿é—®ä¸éœ€è¦ç™»å½•å°±èƒ½è®¿é—®çš„æ¥å£</p><p>å½“è®¿é—®ç”¨æˆ·éœ€è¦ç™»å½•çš„æ¥å£æ—¶ï¼Œå®¢æˆ·ç«¯è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œé€šè¿‡ç”¨æˆ·åå’Œå¯†ç è°ƒç”¨ç™»å½•æ¥å£ï¼Œç™»å½•æ¥å£ä¼šè¿”å›ä¸€ä¸ªuser_token, å®¢æˆ·ç«¯æ‹¿ç€user_token å»è®¿é—®éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®çš„æ¥å£</p><p>signçš„ä½œç”¨æ˜¯é˜²æ­¢å‚æ•°è¢«ç¯¡æ”¹ï¼Œå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ç«¯æ—¶éœ€è¦ä¼ é€’signå‚æ•°ï¼ŒæœåŠ¡å™¨å“åº”å®¢æˆ·ç«¯æ—¶ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªsignç”¨äºå®¢æˆ·åº¦æ ¡éªŒè¿”å›çš„å€¼æ˜¯å¦è¢«éæ³•ç¯¡æ”¹äº†ã€‚å®¢æˆ·ç«¯ä¼ çš„signå’ŒæœåŠ¡å™¨ç«¯å“åº”çš„signç®—æ³•å¯èƒ½ä¼šä¸åŒã€‚</p><p>å…­ï¼šç¤ºä¾‹ä»£ç </p><p>1. dependency</p><pre><code>&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt;</code></pre><p>2. RedisConfiguration</p><pre><code>@Configurationpublic class RedisConfiguration { @Bean public JedisConnectionFactory jedisConnectionFactory(){ return new JedisConnectionFactory(); } /** * æ”¯æŒå­˜å‚¨å¯¹è±¡ * @return */ @Bean public RedisTemplate&lt;String, String&gt; redisTemplate(){ RedisTemplate&lt;String, String&gt; redisTemplate = new StringRedisTemplate(); redisTemplate.setConnectionFactory(jedisConnectionFactory()); Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class); ObjectMapper objectMapper = new ObjectMapper(); objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); jackson2JsonRedisSerializer.setObjectMapper(objectMapper); redisTemplate.setValueSerializer(jackson2JsonRedisSerializer); redisTemplate.afterPropertiesSet(); return redisTemplate; }}</code></pre><p>3. TokenController</p><pre><code>@Slf4j@RestController@RequestMapping("/api/token")public class TokenController { @Autowired private RedisTemplate redisTemplate; /** * API Token * * @param sign * @return */ @PostMapping("/api_token") public ApiResponse&lt;AccessToken&gt; apiToken(String appId, @RequestHeader("timestamp") String timestamp, @RequestHeader("sign") String sign) { Assert.isTrue(!StringUtils.isEmpty(appId) &amp;&amp; !StringUtils.isEmpty(timestamp) &amp;&amp; !StringUtils.isEmpty(sign), "å‚æ•°é”™è¯¯"); long reqeustInterval = System.currentTimeMillis() - Long.valueOf(timestamp); Assert.isTrue(reqeustInterval &lt; 5 * 60 * 1000, "è¯·æ±‚è¿‡æœŸï¼Œè¯·é‡æ–°è¯·æ±‚"); // 1. æ ¹æ®appIdæŸ¥è¯¢æ•°æ®åº“è·å–appSecret AppInfo appInfo = new AppInfo("1", "12345678954556"); // 2. æ ¡éªŒç­¾å String signString = timestamp + appId + appInfo.getKey(); String signature = MD5Util.encode(signString); log.info(signature); Assert.isTrue(signature.equals(sign), "ç­¾åé”™è¯¯"); // 3. å¦‚æœæ­£ç¡®ç”Ÿæˆä¸€ä¸ªtokenä¿å­˜åˆ°redisä¸­ï¼Œå¦‚æœé”™è¯¯è¿”å›é”™è¯¯ä¿¡æ¯ AccessToken accessToken = this.saveToken(0, appInfo, null); return ApiResponse.success(accessToken); } @NotRepeatSubmit(5000) @PostMapping("user_token") public ApiResponse&lt;UserInfo&gt; userToken(String username, String password) { // æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢å¯†ç , å¹¶æ¯”è¾ƒå¯†ç (å¯†ç å¯ä»¥RSAåŠ å¯†ä¸€ä¸‹) UserInfo userInfo = new UserInfo(username, "81255cb0dca1a5f304328a70ac85dcbd", "111111"); String pwd = password + userInfo.getSalt(); String passwordMD5 = MD5Util.encode(pwd); Assert.isTrue(passwordMD5.equals(userInfo.getPassword()), "å¯†ç é”™è¯¯"); // 2. ä¿å­˜Token AppInfo appInfo = new AppInfo("1", "12345678954556"); AccessToken accessToken = this.saveToken(1, appInfo, userInfo); userInfo.setAccessToken(accessToken); return ApiResponse.success(userInfo); } private AccessToken saveToken(int tokenType, AppInfo appInfo, UserInfo userInfo) { String token = UUID.randomUUID().toString(); // tokenæœ‰æ•ˆæœŸä¸º2å°æ—¶ Calendar calendar = Calendar.getInstance(); calendar.setTime(new Date()); calendar.add(Calendar.SECOND, 7200); Date expireTime = calendar.getTime(); // 4. ä¿å­˜token ValueOperations&lt;String, TokenInfo&gt; operations = redisTemplate.opsForValue(); TokenInfo tokenInfo = new TokenInfo(); tokenInfo.setTokenType(tokenType); tokenInfo.setAppInfo(appInfo); if (tokenType == 1) { tokenInfo.setUserInfo(userInfo); } operations.set(token, tokenInfo, 7200, TimeUnit.SECONDS); AccessToken accessToken = new AccessToken(token, expireTime); return accessToken; } public static void main(String[] args) { long timestamp = System.currentTimeMillis(); System.out.println(timestamp); String signString = timestamp + "1" + "12345678954556"; String sign = MD5Util.encode(signString); System.out.println(sign); System.out.println("-------------------"); signString = "password=123456&amp;username=1&amp;12345678954556" + "ff03e64b-427b-45a7-b78b-47d9e8597d3b1529815393153sdfsdfsfs" + timestamp + "A1scr6"; sign = MD5Util.encode(signString); System.out.println(sign); }}</code></pre><p>4. WebMvcConfiguration</p><pre><code>@Configurationpublic class WebMvcConfiguration extends WebMvcConfigurationSupport { private static final String[] excludePathPatterns = {"/api/token/api_token"}; @Autowired private TokenInterceptor tokenInterceptor; @Override public void addInterceptors(InterceptorRegistry registry) { super.addInterceptors(registry); registry.addInterceptor(tokenInterceptor) .addPathPatterns("/api/**") .excludePathPatterns(excludePathPatterns); }}</code></pre><p>5. TokenInterceptor</p><pre><code>@Componentpublic class TokenInterceptor extends HandlerInterceptorAdapter { @Autowired private RedisTemplate redisTemplate; /** * * @param request * @param response * @param handler è®¿é—®çš„ç›®æ ‡æ–¹æ³• * @return * @throws Exception */ @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { String token = request.getHeader("token"); String timestamp = request.getHeader("timestamp"); // éšæœºå­—ç¬¦ä¸² String nonce = request.getHeader("nonce"); String sign = request.getHeader("sign"); Assert.isTrue(!StringUtils.isEmpty(token) &amp;&amp; !StringUtils.isEmpty(timestamp) &amp;&amp; !StringUtils.isEmpty(sign), "å‚æ•°é”™è¯¯"); // è·å–è¶…æ—¶æ—¶é—´ NotRepeatSubmit notRepeatSubmit = ApiUtil.getNotRepeatSubmit(handler); long expireTime = notRepeatSubmit == null ? 5 * 60 * 1000 : notRepeatSubmit.value(); // 2. è¯·æ±‚æ—¶é—´é—´éš” long reqeustInterval = System.currentTimeMillis() - Long.valueOf(timestamp); Assert.isTrue(reqeustInterval &lt; expireTime, "è¯·æ±‚è¶…æ—¶ï¼Œè¯·é‡æ–°è¯·æ±‚"); // 3. æ ¡éªŒTokenæ˜¯å¦å­˜åœ¨ ValueOperations&lt;String, TokenInfo&gt; tokenRedis = redisTemplate.opsForValue(); TokenInfo tokenInfo = tokenRedis.get(token); Assert.notNull(tokenInfo, "tokené”™è¯¯"); // 4. æ ¡éªŒç­¾å(å°†æ‰€æœ‰çš„å‚æ•°åŠ è¿›æ¥ï¼Œé˜²æ­¢åˆ«äººç¯¡æ”¹å‚æ•°) æ‰€æœ‰å‚æ•°çœ‹å‚æ•°åå‡ç»­æ’åºæ‹¼æ¥æˆurl // è¯·æ±‚å‚æ•° + token + timestamp + nonce String signString = ApiUtil.concatSignString(request) + tokenInfo.getAppInfo().getKey() + token + timestamp + nonce; String signature = MD5Util.encode(signString); boolean flag = signature.equals(sign); Assert.isTrue(flag, "ç­¾åé”™è¯¯"); // 5. æ‹’ç»é‡å¤è°ƒç”¨(ç¬¬ä¸€æ¬¡è®¿é—®æ—¶å­˜å‚¨ï¼Œè¿‡æœŸæ—¶é—´å’Œè¯·æ±‚è¶…æ—¶æ—¶é—´ä¿æŒä¸€è‡´), åªæœ‰æ ‡æ³¨ä¸å…è®¸é‡å¤æäº¤æ³¨è§£çš„æ‰ä¼šæ ¡éªŒ if (notRepeatSubmit != null) { ValueOperations&lt;String, Integer&gt; signRedis = redisTemplate.opsForValue(); boolean exists = redisTemplate.hasKey(sign); Assert.isTrue(!exists, "è¯·å‹¿é‡å¤æäº¤"); signRedis.set(sign, 0, expireTime, TimeUnit.MILLISECONDS); } return super.preHandle(request, response, handler); }}</code></pre><p>6. MD5Util</p><pre><code>public class MD5Util { private static final String hexDigits[] = { "0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f" }; private static String byteArrayToHexString(byte b[]) { StringBuffer resultSb = new StringBuffer(); for (int i = 0; i &lt; b.length; i++) resultSb.append(byteToHexString(b[i])); return resultSb.toString(); } private static String byteToHexString(byte b) { int n = b; if (n &lt; 0) n += 256; int d1 = n / 16; int d2 = n % 16; return hexDigits[d1] + hexDigits[d2]; } public static String encode(String origin) { return encode(origin, "UTF-8"); } public static String encode(String origin, String charsetname) { String resultString = null; try { resultString = new String(origin); MessageDigest md = MessageDigest.getInstance("MD5"); if (charsetname == null || "".equals(charsetname)) resultString = byteArrayToHexString(md.digest(resultString .getBytes())); else resultString = byteArrayToHexString(md.digest(resultString .getBytes(charsetname))); } catch (Exception exception) { } return resultString; }}</code></pre><p>7. @NotRepeatSubmit</p><pre><code>/** * ç¦æ­¢é‡å¤æäº¤ */@Target(ElementType.METHOD)@Retention(RetentionPolicy.RUNTIME)public @interface NotRepeatSubmit { /** è¿‡æœŸæ—¶é—´ï¼Œå•ä½æ¯«ç§’ **/ long value() default 5000;}</code></pre><p>8. AccessToken</p><pre><code>@Data@AllArgsConstructorpublic class AccessToken { /** token */ private String token; /** å¤±æ•ˆæ—¶é—´ */ private Date expireTime;}</code></pre><p>9. AppInfo</p><pre><code>@Data@NoArgsConstructor@AllArgsConstructorpublic class AppInfo { /** App id */ private String appId; /** API ç§˜é’¥ */ private String key;}</code></pre><p>10. TokenInfo</p><pre><code>@Datapublic class TokenInfo { /** tokenç±»å‹: api:0 ã€user:1 */ private Integer tokenType; /** App ä¿¡æ¯ */ private AppInfo appInfo; /** ç”¨æˆ·å…¶ä»–æ•°æ® */ private UserInfo userInfo;}</code></pre><p>11. UserInfo</p><pre><code>@Datapublic class UserInfo { /** ç”¨æˆ·å */ private String username; /** æ‰‹æœºå· */ private String mobile; /** é‚®ç®± */ private String email; /** å¯†ç  */ private String password; /** ç› */ private String salt; private AccessToken accessToken; public UserInfo(String username, String password, String salt) { this.username = username; this.password = password; this.salt = salt; }}</code></pre><p>12. ApiCodeEnum</p><pre><code>/** * é”™è¯¯ç codeå¯ä»¥ä½¿ç”¨çº¯æ•°å­—,ä½¿ç”¨ä¸åŒåŒºé—´æ ‡è¯†ä¸€ç±»é”™è¯¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨çº¯å­—ç¬¦ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‰ç¼€+ç¼–å· * * é”™è¯¯ç ï¼šERR + ç¼–å· * * å¯ä»¥ä½¿ç”¨æ—¥å¿—çº§åˆ«çš„å‰ç¼€ä½œä¸ºé”™è¯¯ç±»å‹åŒºåˆ† Info(I) Error(E) Warning(W) * * æˆ–è€…ä»¥ä¸šåŠ¡æ¨¡å— + é”™è¯¯å· * * TODO é”™è¯¯ç è®¾è®¡ * * Alipay ç”¨äº†ä¸¤ä¸ªcodeï¼Œä¸¤ä¸ªmsg(https://docs.open.alipay.com/api_1/alipay.trade.pay) * * @author Mengday Zhang * @version 1.0 * @since 2018/6/22 */public enum ApiCodeEnum { SUCCESS("10000", "success"), UNKNOW_ERROR("ERR0001","æœªçŸ¥é”™è¯¯"), PARAMETER_ERROR("ERR0002","å‚æ•°é”™è¯¯"), TOKEN_EXPIRE("ERR0003","è®¤è¯è¿‡æœŸ"), REQUEST_TIMEOUT("ERR0004","è¯·æ±‚è¶…æ—¶"), SIGN_ERROR("ERR0005","ç­¾åé”™è¯¯"), REPEAT_SUBMIT("ERR0006","è¯·ä¸è¦é¢‘ç¹æ“ä½œ"), ; /** ä»£ç  */ private String code; /** ç»“æœ */ private String msg; ApiCodeEnum(String code, String msg) { this.code = code; this.msg = msg; } public String getCode() { return code; } public String getMsg() { return msg; }}</code></pre><p>13. ApiResult</p><pre><code>@Data@NoArgsConstructor@AllArgsConstructorpublic class ApiResult { /** ä»£ç  */ private String code; /** ç»“æœ */ private String msg;}</code></pre><p>14. ApiUtil</p><pre><code>public class ApiUtil { /** * æŒ‰å‚æ•°åå‡ç»­æ‹¼æ¥å‚æ•° * @param request * @return */ public static String concatSignString(HttpServletRequest request) { Map&lt;String, String&gt; paramterMap = new HashMap&lt;&gt;(); request.getParameterMap().forEach((key, value) -&gt; paramterMap.put(key, value[0])); // æŒ‰ç…§keyå‡ç»­æ’åºï¼Œç„¶åæ‹¼æ¥å‚æ•° Set&lt;String&gt; keySet = paramterMap.keySet(); String[] keyArray = keySet.toArray(new String[keySet.size()]); Arrays.sort(keyArray); StringBuilder sb = new StringBuilder(); for (String k : keyArray) { // æˆ–ç•¥æ‰çš„å­—æ®µ if (k.equals("sign")) { continue; } if (paramterMap.get(k).trim().length() &gt; 0) { // å‚æ•°å€¼ä¸ºç©ºï¼Œåˆ™ä¸å‚ä¸ç­¾å sb.append(k).append("=").append(paramterMap.get(k).trim()).append("&amp;"); } } return sb.toString(); } public static String concatSignString(Map&lt;String, String&gt; map) { Map&lt;String, String&gt; paramterMap = new HashMap&lt;&gt;(); map.forEach((key, value) -&gt; paramterMap.put(key, value)); // æŒ‰ç…§keyå‡ç»­æ’åºï¼Œç„¶åæ‹¼æ¥å‚æ•° Set&lt;String&gt; keySet = paramterMap.keySet(); String[] keyArray = keySet.toArray(new String[keySet.size()]); Arrays.sort(keyArray); StringBuilder sb = new StringBuilder(); for (String k : keyArray) { if (paramterMap.get(k).trim().length() &gt; 0) { // å‚æ•°å€¼ä¸ºç©ºï¼Œåˆ™ä¸å‚ä¸ç­¾å sb.append(k).append("=").append(paramterMap.get(k).trim()).append("&amp;"); } } return sb.toString(); } /** * è·å–æ–¹æ³•ä¸Šçš„@NotRepeatSubmitæ³¨è§£ * @param handler * @return */ public static NotRepeatSubmit getNotRepeatSubmit(Object handler) { if (handler instanceof HandlerMethod) { HandlerMethod handlerMethod = (HandlerMethod) handler; Method method = handlerMethod.getMethod(); NotRepeatSubmit annotation = method.getAnnotation(NotRepeatSubmit.class); return annotation; } return null; }}</code></pre><p>15. ApiResponse</p><pre><code>@Data@Slf4jpublic class ApiResponse&lt;T&gt; { /** ç»“æœ */ private ApiResult result; /** æ•°æ® */ private T data; /** ç­¾å */ private String sign; public static &lt;T&gt; ApiResponse success(T data) { return response(ApiCodeEnum.SUCCESS.getCode(), ApiCodeEnum.SUCCESS.getMsg(), data); } public static ApiResponse error(String code, String msg) { return response(code, msg, null); } public static &lt;T&gt; ApiResponse response(String code, String msg, T data) { ApiResult result = new ApiResult(code, msg); ApiResponse response = new ApiResponse(); response.setResult(result); response.setData(data); String sign = signData(data); response.setSign(sign); return response; } private static &lt;T&gt; String signData(T data) { // TODO æŸ¥è¯¢key String key = "12345678954556"; Map&lt;String, String&gt; responseMap = null; try { responseMap = getFields(data); } catch (IllegalAccessException e) { return null; } String urlComponent = ApiUtil.concatSignString(responseMap); String signature = urlComponent + "key=" + key; String sign = MD5Util.encode(signature); return sign; } /** * @param data åå°„çš„å¯¹è±¡,è·å–å¯¹è±¡çš„å­—æ®µåå’Œå€¼ * @throws IllegalArgumentException * @throws IllegalAccessException */ public static Map&lt;String, String&gt; getFields(Object data) throws IllegalAccessException, IllegalArgumentException { if (data == null) return null; Map&lt;String, String&gt; map = new HashMap&lt;&gt;(); Field[] fields = data.getClass().getDeclaredFields(); for (int i = 0; i &lt; fields.length; i++) { Field field = fields[i]; field.setAccessible(true); String name = field.getName(); Object value = field.get(data); if (field.get(data) != null) { map.put(name, value.toString()); } } return map; }}</code></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'ä¼ä¸š','API','è®¾è®¡'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>