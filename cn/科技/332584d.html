<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>科普虚拟内存 | 极客快訊</title><meta property="og:title" content="科普虚拟内存 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/5e7f0001fbf41536346d"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/332584d.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/332584d.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/332584d.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/332584d.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/332584d.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/332584d.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/332584d.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/332584d.html><meta property="article:published_time" content="2020-10-29T20:59:04+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:04+08:00"><meta name=Keywords content><meta name=description content="科普虚拟内存"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/332584d.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>科普虚拟内存</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>虚拟内存</p><p>虚拟内存是计算机系统内存管理的一种技术。它使得应用程序认为它拥有连续的可用的内存（一个连续完整的地址空间），而实际上，它通常是被分隔成多个物理内存碎片，还有部分暂时存储在外部磁盘存储器上，在需要时进行数据交换。目前，大多数操作系统都使用了虚拟内存，如Windows家族的“虚拟内存”；Linux的“交换空间”等。<br></p><p>技术介绍：虚拟内存别称虚拟存储器（Virtual Memory）。</p><p><img alt=科普虚拟内存 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/5e7f0001fbf41536346d></p><p>电脑中所运行的程序均需经由内存执行，若执行的程序占用内存很大或很多，则会导致内存消耗殆尽。为解决该问题，Windows中运用了虚拟内存 技术，即匀出一部分硬盘空间来充当内存使用。当内存耗尽时，电脑就会自动调用硬盘来充当内存，以缓解内存的紧张。若计算机运行程序或操作所需的随机存储器(RAM)不足时，则 Windows 会用虚拟存储器进行补偿。它将计算机的RAM和硬盘上的临时空间组合。当RAM运行速率缓慢时，它便将数据从RAM移动到称为“分页文件”的空间中。将数据移入分页文件可释放RAM，以便完成工作。 一般而言，计算机的RAM容量越大，程序运行得越快。若计算机的速率由于RAM可用空间匮乏而减缓，则可尝试通过增加虚拟内存来进行补偿。但是，计算机从RAM读取数据的速率要比从硬盘读取数据的速率快，因而扩增RAM容量（可加内存条）是最佳选择。</p><h1>虚拟内存是Windows 为作为内存使用的一部分硬盘空间。虚拟内存在硬盘上其实就是为一个硕大无比的文件，文件名是PageFile.Sys，通常状态下是看不到的。必须关闭资源管理器对系统文件的保护功能才能看到这个文件。虚拟内存有时候也被称为是“页面文件”就是从这个文件的文件名中来的。</h1><p>内存在计算机中的作用很大，电脑中所有运行的程序都需要经过内存来执行，如果执行的程序很大或很多，就会导致内存消耗殆尽。为了解决这个问题，WINDOWS运用了虚拟内存技术，即拿出一部分硬盘空间来充当内存使用，这部分空间即称为虚拟内存，虚拟内存在硬盘上的存在形式就是 PAGEFILE.SYS这个页面文件。<br></p><p>工作原理</p><p>虚拟存储器是由硬件和操作系统自动实现存储信息调度和管理的。它的工作过程包括6个步骤：</p><p>①中央处理器访问主存的逻辑地址分解成组号a和组内地址b，并对组号a进行地址变换，即将逻辑组号a作为索引，查地址变换表，以确定该组信息是否存放在主存内。</p><p>②如该组号已在主存内，则转而执行④；如果该组号不在主存内，则检查主存中是否有空闲区，如果没有，便将某个暂时不用的组调出送往辅存，以便将这组信息调入主存。</p><p>③从辅存读出所要的组，并送到主存空闲区，然后将那个空闲的物理组号a和逻辑组号a登录在地址变换表中。</p><p>④从地址变换表读出与逻辑组号a对应的物理组号a。</p><p>⑤从物理组号a和组内字节地址b得到物理地址。</p><p>⑥根据物理地址从主存中存取必要的信息。</p><p>调度方式有分页式、段式、段页式3种。页式调度是将逻辑和物理地址空间都分成固定大小的页。主存按页顺序编号，而每个独立编址的程序空间有自己的页号顺序，通过调度辅存中程序的各页可以离散装入主存中不同的页面位置，并可据表一一对应检索。页式调度的优点是页内零头小，页表对程序员来说是透明的，地址变换快，调入操作简单；缺点是各页不是程序的独立模块，不便于实现程序和数据的保护。段式调度是按程序的逻辑结构划分地址空间，段的长度是随意的，并且允许伸长，它的优点是消除了内存零头，易于实现存储保护，便于程序动态装配；缺点是调入操作复杂。将这两种方法结合起来便构成段页式调度。在段页式调度中把物理空间分成页，程序按模块分段，每个段再分成与物理空间页同样小的页面。段页式调度综合了段式和页式的优点。其缺点是增加了硬件成本，软件也较复杂。大型通用计算机系统多数采用段页式调度。</p><p>虚实地址</p><p>实地址与虚地址</p><p>用户编制程序时使用的地址称为虚地址或逻辑地址，其对应的存储空间称为虚存空间或逻辑地址空间；而计算机物理内存的访问地址则称为实地址或物理地址，其对应的存储空间称为物理存储空间或主存空间。程序进行虚地址到实地址转换的过程称为程序的再定位。<br></p><p>虚存的访问过程</p><p>虚存空间的用户程序按照虚地址编程并存放在辅存中。程序运行时，由地址变换机构依据当时分配给该程序的实地址空间把程序的一部分调入实存。每次访存时，首先判断该虚地址所对应的部分是否在实存中：如果是，则进行地址转换并用实地址访问主存；否则，按照某种算法将辅存中的部分程序调度进内存，再按同样的方法访问主存。由此可见，每个程序的虚地址空间可以远大于实地址空间，也可以远小于实地址空间。前一种情况以提高存储容量为目的，后一种情况则以地址变换为目的。后者通常出现在多用户或多任务系统中：实存空间较大，而单个任务并不需要很大的地址空间，较小的虚存空间则可以缩短指令中地址字段的长度。</p><p>异构体系</p><p>从虚存的概念可以看出，主存-辅存的访问机制与cache-主存的访问机制是类似的。这是由cache存储器、主存和辅存构成的三级存储体系中的两个层次。cache和主存之间以及主存和辅存之间分别有辅助硬件和辅助软硬件负责地址变换与管理，以便各级存储器能够组成有机的三级存储体系。cache和主存构成了系统的内存，而主存和辅存依靠辅助软硬件的支持构成了虚拟存储器。<br></p><p>在三级存储体系中，cache-主存和主存-辅存这两个存储层次有许多相同点：</p><p>(1)出发点相同：二者都是为了提高存储系统的性能价格比而构造的分层存储体系，都力图使存储系统的性能接近高速存储器，而价格和容量接近低速存储器。</p><p>(2)原理相同：都是利用了程序运行时的局部性原理把最近常用的信息块从相对慢速而大容量的存储器调入相对高速而小容量的存储器。</p><p>但cache-主存和主存-辅存这两个存储层次也有许多不同之处：</p><p>(1)侧重点不同：cache主要解决主存与CPU的速度差异问题；而就性能价格比的提高而言，虚存主要是解决存储容量问题，另外还包括存储管理、主存分配和存储保护等方面。</p><p>(2)数据通路不同：CPU与cache和主存之间均有直接访问通路，cache不命中时可直接访问主存；而虚存所依赖的辅存与CPU之间不存在直接的数据通路，当主存不命中时只能通过调页解决，CPU最终还是要访问主存。</p><p>(3)透明性不同：cache的管理完全由硬件完成，对系统程序员和应用程序员均透明；而虚存管理由软件（操作系统）和硬件共同完成，由于软件的介入，虚存对实现存储管理的系统程序员不透明，而只对应用程序员透明（段式和段页式管理对应用程序员“半透明”）。</p><p>(4)未命中时的损失不同：由于主存的存取时间是cache的存取时间的5～10倍，而主存的存取速度通常比辅存的存取速度快上千倍，故主存未命中时系统的性能损失要远大于cache未命中时的损失。</p><p>关键问题</p><p>(1)调度问题：决定哪些程序和数据应被调入主存。</p><p>(2)地址映射问题：在访问主存时把虚地址变为主存物理地址（这一过程称为内地址变换）；在访问辅存时把虚地址变成辅存的物理地址（这一过程称为外地址变换），以便换页。此外还要解决主存分配、存储保护与程序再定位等问题。</p><p>(3)替换问题：决定哪些程序和数据应被调出主存。</p><p>(4)更新问题：确保主存与辅存的一致性。</p><p>在操作系统的控制下，硬件和系统软件为用户解决了上述问题，从而使应用程序的编程大大简化。</p><p>调度介绍</p><p>页式调度</p><p>1、页式虚存地址映射页式虚拟存储系统中，虚地址空间被分成等长大小的页，称为逻辑页；主存空间也被分成同样大小的页，称为物理页。相应地，虚地址分为两个字段：高字段为逻辑页号，低字段为页内地址（偏移量）；实存地址也分两个字段：高字段为物理页号，低字段为页内地址。通过页表可以把虚地址（逻辑地址）转换成物理地址。</p><p>在大多数系统中，每个进程对应一个页表。页表中对应每一个虚存页面有一个表项，表项的内容包含该虚存页面所在的主存页面的地址（物理页号），以及指示该逻辑页是否已调入主存的有效位。地址变换时，用逻辑页号作为页表内的偏移地址索引页表（将虚页号看作页表数组下标）并找到相应物理页号，用物理页号作为实存地址的高字段，再与虚地址的页内偏移量拼接，就构成完整的物理地址。现代的中央处理机通常有专门的硬件支持地址变换。</p><p>2、转换后援缓冲器由于页表通常在主存中，因而即使逻辑页已经在主存中，也至少要访问两次物理存储器才能实现一次访存，这将使虚拟存储器的存取时间加倍。为了避免对主存访问次数的增多，可以对页表本身实行二级缓存，把页表中的最活跃的部分存放在高速存储器中，组成快表。这个专用于页表缓存的高速存储部件通常称为转换后援缓冲器(TLB)。保存在主存中的完整页表则称为慢表。</p><p>3、内页表是虚地址到主存物理地址的变换表，通常称为内页表。与内页表对应的还有外页表，用于虚地址与辅存地址之间的变换。当主存缺页时，调页操作首先要定位辅存，而外页表的结构与辅存的寻址机制密切相关。例如对磁盘而言，辅存地址包括磁盘机号、磁头号、磁道号和扇区号等。</p><p>段式调度</p><p>段是按照程序的自然分界划分的长度可以动态改变的区域。通常，程序员把子程序、操作数和常数等不同类型的数据划分到不同的段中，并且每个程序可以有多个相同类型的段。在段式虚拟存储系统中，虚地址由段号和段内地址（偏移量）组成。虚地址到实主存地址的变换通过段表实现。每个程序设置一个段表，段表的每一个表项对应一个段。每个表项至少包含下面三个字段：<br></p><p>(1)有效位：指明该段是否已经调入实存。</p><p>(2)段起址：指明在该段已经调入实存的情况下，该段在实存中的首地址。</p><p>(3)段长：记录该段的实际长度。设置段长字段的目的是为了保证访问某段的地址空间时，段内地址不会超出该段长度导致地址越界而破坏其他段。段表本身也是一个段，可以存在辅存中，但一般驻留在主存中。</p><p>段式虚拟存储器有许多优点：</p><p>①段的逻辑独立性使其易于编译、管理、修改和保护，也便于多道程序共享。②段长可以根据需要动态改变，允许自由调度，以便有效利用主存空间。段式虚拟存储器也有一些缺点：</p><p>①因为段的长度不固定，主存空间分配比较麻烦。②容易在段间留下许多外碎片，造成存储空间利用率降低。</p><p>③由于段长不一定是2的整数次幂，因而不能简单地像分页方式那样用虚地址和实地址的最低若干二进制位作为段内偏移量，并与段号进行直接拼接，必须用加法操作通过段起址与段内偏移量的求和运算求得物理地址。因此，段式存储管理比页式存储管理方式需要更多的硬件支持。</p><p>段页式调度</p><p>段页式虚拟存储器是段式虚拟存储器和页式虚拟存储器的结合。实存被等分成页。每个程序则先按逻辑结构分段，每段再按照实存的页大小分页，程序按页进行调入和调出操作，但可按段进行编程、保护和共享。它把程序按逻辑单位分段以后，再把每段分成固定大小的页。程序对主存的调入调出是按页面进行的，但它又可以按段实现共享和保护，兼备页式和段式的优点。缺点是在映象过程中需要多次查表。在段页式虚拟存储系统中，每道程序是通过一个段表和一组页表来进行定位的。段表中的每个表目对应一个段，每个表目有一个指向该段的页表起始地址及该段的控制保护信息。由页表指明该段各页在主存中的位置以及是否已装入、已修改等状态信息。如果有多个用户在机器上运行，多道程序的每一道需要一个基号,由它指明该道程序的段表起始地址。虚拟地址格式如下：<br></p><p>基号 段号 页号 页内地址</p><p>变换算法</p><p>虚拟存储器地址变换基本上有3种形虚拟存储器工作过程式：全联想变换、直接变换和组联想变换。任何逻辑空间页面能够变换到物理空间任何页面位置的方式称为全联想变换。每个逻辑空间页面只能变换到物理空间一个特定页面的方式称为直接变换。组联想变换是指各组之间是直接变换，而组内各页间则是全联想变换。替换规则用来确定替换主存中哪一部分，以便腾空部分主存，存放来自辅存要调入的那部分内容。常见的替换算法有4种。<br></p><p>①随机算法：用软件或硬件随机数产生器确定替换的页面。</p><p>②先进先出：先调入主存的页面先替换。</p><p>③近期最少使用算法（LRU，Least Recently Used）：替换最长时间不用的页面。</p><p>④最优算法：替换最长时间以后才使用的页面。这是理想化的算法，只能作为衡量其他各种算法优劣的标准。</p><p>虚拟存储器的效率是系统性能评价的重要内容，它与主存容量、页面大小、命中率，程序局部性和替换算法等因素有关。[</p><p>内存不足</p><p>【1】、感染病毒：有些病毒发作时会占用大量内存空间，导致系统出现内存不足问题。</p><p>【2】、虚拟内存设置不当：通常，应设置为物理内存大小的2倍。若设置过小，则会影响系统程序的正常运行。此时便需重设虚拟内存数值，以“Windows XP”为例，右击“我的电脑”，选择“属性”，在“高级”标签页点击“性能”框中的“设置”按钮，切换至“高级”标签页，后在“虚拟内存”框中点击“更改”按钮，接着重设虚拟内存数值，再点“设置”并“确定”，完后重启系统即可。</p><p>【3】、系统盘空间不足：在默认情况下，虚拟内存是以名为“Pagefile.sys”的交换文件存于硬盘的系统分区中。若系统盘剩余容量过小，即会出现该问题。系统盘至少应留有300MB的可用空间，当然此数值需据用户的实际需要而定。尽量不要将各种应用软件装在系统盘，以保证有足够的空间供虚拟内存文件使用，且最好将虚拟内存文件安放至非系统盘内。</p><p>【4】、System用户权限设置不当：基于NT内核的Windows系统启动时，System用户会为系统创建虚拟内存文件。有些用户为了系统的安全，采用NTFS文件系统，但却取消了System用户在系统盘“写入”和“修改”的权限，这样就无法为系统创建虚拟内存文件，运行大型程序时，也会出现此类问题。对策：重新赋予System用户“写入”和“修改”的权限即可。（注：该仅限于使用NTFS文件系统的用户。）</p><p>合理设置</p><p>如何确定虚拟内存大小？</p><p>新手篇</p><p>由系统或系统优化软件分配或设置为物理内存的1.5-3倍。</p><p>相对于设置步骤复杂的Linux系统，Windows系统下对虚拟内存的设置比较简单：</p><ol class=list-paddingleft-2><li><p>在我的电脑图标上单击右键，选择属性。</p></li><li><p>在系统属性窗口中选择高级，在性能区域中单击设置按钮。</p></li><li><p>在性能选项中选择高级，在虚拟内存区域中单击更改按钮。</p></li><li><p>选择一个比较空闲的分区用来存放虚拟内存的Pagefile.sys文件。</p></li><li><p>在自定义大小区域中设置虚拟内存的大小为物理内存的1.5倍到3倍。</p></li></ol><p>事实上，严格按照1.5-3倍的倍数关系来设置并不科学，因此我们可以根据系统的实际应用情况进行设置。在这过程中需要用到Windows 2000/XP Pro/2003自带的性能监视器。</p><ol class=list-paddingleft-2><li><p>运行“perfmon.msc”打开性能监视器，展开左侧的性能日志和警报，并点击选择计数器日志，在右侧的面板中空白处点击鼠标右键，选择新建日志设置，并命名为Pagefile，然后回车确认。</p></li><li><p>在常规选项卡下，点击添加计数器按钮，在新弹出的窗口的性能对象下拉菜单中选择Paging File，并选择“从列表选择计数器”，然后点击% Usage Peak，在范例中选择“_Total”，并接着点击“添加”按钮。</p></li><li><p>然后关闭这个窗口，并点击图三中的“确定”按钮。点击“是”创建日志文件。接着打开“日志文件”选项卡，在日志文件类型下拉菜单中选则“文本文件（逗号分隔）”，然后记住“例如”框中显示的日志文件的路径。</p></li><li><p>这样，点击确定后这个计数器已经开始运行了，你可以在电脑上进行你的日常操作，并尽可能多的打开和关闭各种经常使用的应用程序和游戏。经过几个小时的使用，基本上计数器已经可以对你的使用情况做出一个完整的评估。</p></li><li><p>这时你需要先停止这个记数器的运行，同样是在计数器日志窗口中，选中我们新建的Page File记数器，然后右键点击，并且选择停止。用记事本打开日志文件。</p></li><li><p>需要注意的是，在日志中的数值并不是分页文件的使用量，而是使用率。也就是说，根据日志文件的显示，该系统一般情况下的分页文件只使用了25%左右，而系统当前设置的分页文件足有2GB，那么为了节省硬盘空间，完全可以把分页文件最大值缩小为512MB大小。而对于最小值，可以先根据日志中的占用率求出平均占用率，然后再与最大值相乘，就可以得到了。</p></li></ol><p>相关信息</p><p>虚拟内存的位置</p><p>在设置虚拟内存的时候还需要注意，如果你有超过一块硬盘，那么最好能把分页文件设置在没有安装操作系统或应用程序的硬盘上，或者所有硬盘中速率最快的硬盘上。这样在系统繁忙的时候才不会产生同一个硬盘既忙于读取应用程序的数据又同时进行分页操作的情况。相反，如果应用程序和分页文件在不同的硬盘上，这样才能最大程度降低硬盘利用率，同时提高效率。当然，如果你只有一个硬盘，那么把页面文件设置在其他分区，也不会有提高磁盘效率的效果。</p><p>虚拟内存页面文件与磁盘碎片</p><p>由于虚拟内存使用了硬盘，硬盘上非连续写入的文件会产生磁盘碎片，因此一旦用于实现虚拟内存的文件或分区过于零碎，会加长硬盘的寻道时间，影响系统性能。有观点误认为Windows系统频繁读写pagefile.sys就会产生磁盘碎片，实则不然。因为pagefile.sys文件一旦创立，在分区中的分布连续形式就固定下来，文件内部读写并不增加或减少pagefile.sys的文件大小。仅当页面文件告罄后系统创建的temppf.sys会带来磁盘碎片。 而在Linux系统中，将用于虚拟内存的部分置於单独的分区中，不影响其他的分区或文件，则基本杜绝了磁盘碎片带来的影响。</p><p>虚拟内存太低的解决办法</p><p>一般windowsXP默认情况下是利用C盘的剩余空间来做虚拟内存的，因此，C盘的剩余空间越大，对系统运行就越好，虚拟内存是随着你的使用而动态地变化的，这样C盘就容易产生磁盘碎片，影响系统运行速率，所以，最好将虚拟内存设置在其它分区，如D盘中。查看虚拟内存设置情况如下：</p><p>右键点“我的电脑”，左键点“属性”，点选“高级”选项卡，点“性能”里的“设置”按钮，再选“高级”选项卡，点下面的“更改”按钮，所弹出的窗口就是虚拟内存设置窗口，一般默认的虚拟内存是从小到大的一段取值范围，这就是虚拟内存变化大小的范围，最好给它一个固定值，这样就不容易产生磁盘碎片了，具体数值根据你的物理内存大小来定，一般为物理内存的1.5到3倍，如512M内存，可以设置256-768MB(内存+虚拟内存之和一般比正常占用高256MB即可)。1GB的内存的话，设为128-1024MB(内存+虚拟内存之和一般比正常占用高256-512MB即可)，2GB内存以上的话，一般可以禁用虚拟内存了，部分确实会使用大量内存的人，如玩大型3D游戏、制作大幅图片、3D建模等，并收到系统内存不足警告的，才需要酌情设定虚拟内存[4]</p><p>，设置方法如下：</p><p>假设内存为256M，虚拟内存放在D盘，先要将默认的清除，保持C盘为选中状态，单选“无分页文件（N）”再按“设置”按钮，此时C盘旁的虚拟内存就消失了，然后选中D盘，单选“自定义大小”，在下面的“初始大小”和“最大值”两个方框里都添上512，再点一下“设置”按钮，会看到D盘的旁边出现了“512-512”的字样，这样就说明设置好了，再一路确定，最终，系统会要重新启动，重启一下，便完成了设置。</p><p>设置方法</p><p>手动设置</p><p>找出最合适的虚拟内存大小范围值后，</p><p>①用右键点击桌面上的“我的电脑”图标，在出现的右键菜单中选“属性”选项打开“系统属性”窗口。在窗口中点击“高级”选项卡，出现高级设置的对话框</p><p>②点击“性能”区域的“设置”按钮，在出现的“性能选项”窗口中选择“高级”选项卡，打开其对话框。</p><p>③在该对话框中可看到关于虚拟内存的区域，点击“更改”按钮进入“虚拟内存”的设置窗口。选择一个有较大空闲容量的分区，勾选“自定义大小”前的复选框，将具体数值填入“初始大小”、“最大值”栏中，而后依次点击“设置→确定”按钮即可，最后重新启动计算机使虚拟内存设置生效。</p><p>调整分页位置</p><p><img alt=科普虚拟内存 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/5e8500035a4d43d5fc6a></p><p>虚拟内存的显示</p><p>Windows9x的虚拟内存分页位置，其实就是保存在C盘根目录下的一个虚拟内存文件（也称为交换文件）Win386.swp，它的存放位置可以是任何一个分区，如果系统盘C容量有限，我们可以把Win386.swp调到别的分区中，方法是在记事本中打开System.ini（C:Windows下）文件，在[386Enh]小节中，将“PagingDrive=C:WindowsWin386.swp”，改为其他分区的路径，如将交换文件放在D:中，则改为“PagingDrive=D:Win386.swp”，如没有上述语句可以直接键入即可。</p><p>而对于使用Windows2000和WindowsXP的，可以选择“控制面板→系统→高级→性能”中的“设置→高级→更改”，打开虚拟内存设置窗口，在驱动器[卷标]中默认选择的是系统所在的分区，如果想更改到其他分区中，首先要把原先的分区设置为无分页文件，然后再选择其他分区。</p><p>或者，WinXP一般要求物理内存在256M以上。如果你喜欢玩大型3D游戏，而内存（包括显存）又不够大，系统会经常提示说虚拟内存不够，系统会自动调整（虚拟内存设置为系统管理）。</p><p>注意事项</p><p>允许设置的虚拟内存最小值为2MB，最大值不能超过当前硬盘的剩余空间值，同时也不能超过32位操作系统的内存寻址范围——4GB。</p><p>禁用页面文件</p><p>当拥有了1G以上的内存时，页面文件的作用将不再明显，因此我们可以将其禁用。方法是：依次进入注册表编辑器“HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SessionManager\MemoryManagement”下，在“DisablePagingExecutive”（禁用页面文件）选项中将其值设为“1”即可。</p><p>PS：此举可能会造成系统不稳定.某些程序无法运行或死机。请根据自己实际情况更改。</p><p>在拥有4G以上的内存时，虚拟内存已经无足轻重了。在关闭后日常使用中没有报错、收到系统内存不足警告以及出现卡死等情况，那么可以高枕无忧了，不用担心关闭虚拟内存带来的负面影响。</p><p>清空页面文件</p><p>在同一位置上有一个“ClearPageFileAtShutdown（关机时清除页面文件）”，将该值设为“1”。这里所说的“清除”页面文件并非是指从硬盘上完全删除pagefile.sys文件，而是对其进行“清洗”和整理，根据微软的说法，这是一个安全选项，与性能无关。</p><p>高级话题：使用 SweepRAM 工具。适用于 Windows 2000/XP/2003。网上可以找到 SweepRAM 程序。该程序最大的作用是把所有进程的工作集清空。所谓工作集是指进程已映射的物理内存部分（即这些内存块全在物理内存中，并且 CPU 可以直接访问），还有一部分不在工作集中的虚拟内存则可能在转换列表中（CPU 不能通过虚地址访问，需要 Windows 映射之后才能访问），还有一部分则在磁盘上的页面文件里。工作集在进程运行时会被 Windows 自动调整，频繁访问的页面（4KB 的块）会留在内存中，而不频繁访问的页面在内存紧张时会被从工作集中移出，暂时保存在内存中的“转换列表”中，或者进一步换出到页面文件中。当应用程序再次访问某一页面时，操作系统会将它重新加回工作集中。</p><p>SweepRAM 工具以一种适中的频率（大约 40 分钟一次）反复运行，可以将各进程的工作集清空，而之后各进程的工作集会慢慢恢复。这样可以保持更好的工作集平衡，从而提高系统性能。</p><p>关机自动清除</p><p>设置步骤如下：</p><ol class=list-paddingleft-2><li><p>运行：gpedit.msc进入组策略对象编辑器。</p></li><li><p>如图依次打开如下内容：“计算机配置”---“Windows 设置”---“安全设置”---“本地策略”---“安全选项”---“关机：清除虚拟内存页面”。</p></li><li><p>右击“属性”点击“已启用”。</p></li><li><p>确定，这样设置就ok了。</p></li></ol><p>对于没有组策略的解决方案如下：</p><ol class=list-paddingleft-2><li><p>按系统快捷键win+r运行regedit打开注册表编辑器。</p></li><li><p>查找到“HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Control/Session Manager/Memory Management”，然后在右边的列表中双击“ClearPageFileAtShutdown”。</p></li><li><p>在弹出的“编辑DWORD”值对话框中改为1。</p></li><li><p>重新启动计算机，使修改生效。</p></li></ol><p>使用技巧</p><p>对于虚拟内存如何设置的问题，微软已经给我们提供了官方的解决办法，对于一般情况下，我们推荐采用如下的设置方法：</p><ul class=list-paddingleft-2><li><p>页面文件，文件的大小由你对系统的设置决定。具体设置方法如下：打开"我的电脑"的"属性"设置窗口，切换到"高级"选项卡，在"启动和故障恢复"窗口的"写入调试信息"栏，如果你采用的是试和错误报告了。所以折中的办法是在系统盘设置较小的页面文件，只要够用就行了。</p></li><li><p>内存，其最小值设置为物理内存的1.5倍，最大值设置为物理内存的3倍，该分区专门用来存储页面文件，不要再存放其它任何文件。之所以单独划分一个分区用来设置虚拟内存，主要是基于两点考虑：其一，由于该分区上没有其它文件，这样分区不会产生磁盘碎片，这样能保证页面文件的数据读写不受磁盘碎片的干扰；其二，按照Windows对内存的管理技术，Windows会优先使用不经常访问的分区上的页面文件，这样也减少了读取系统盘里的页面文件的机会，减轻了系统盘的压力。</p></li></ul><ul class=list-paddingleft-2><li><li><p>页面文件，则其它硬盘分区不设置任何页面文件。因为过多的分区设置页面文件，这样会导致，硬盘磁头反复的在不同的分区来回读取。这样既耽误了系统速率，也会减少硬盘的寿命。当然，如果你有多个硬盘，则可以为每个硬盘都创建一个页面文件。当信息分布在多个页面文件上时，硬盘控制器可以同时在多个硬盘上执行读取和写入操作。这样系统性能将得到提高。[2]</p></li><li><p>需要注意！设置过大的虚拟内存将导致关机过慢甚至几十分钟，例如2G电脑设置16G虚拟内存虽然增加了电脑性能但是关机可能需要几分钟。</p></li></li></ul><p><img alt=科普虚拟内存 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/5e8900011fa2a5caba30></p><p class=pgc-img-caption>虚拟内存</p><p>虚拟内存，本词条由“科普中国”百科科学词条编写与应用工作项目 审核 。</p><p>信息来源百科</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'虚拟','内存','科普'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>