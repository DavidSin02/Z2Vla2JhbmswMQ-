<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>面向 Solidity 语言的变异测试系统 | 极客快訊</title><meta property="og:title" content="面向 Solidity 语言的变异测试系统 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/dcbae61fce31436a8639e1aa1cc31db2"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/348da37.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/348da37.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/348da37.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/348da37.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/348da37.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/348da37.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/348da37.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/348da37.html><meta property="article:published_time" content="2020-10-29T20:52:48+08:00"><meta property="article:modified_time" content="2020-10-29T20:52:48+08:00"><meta name=Keywords content><meta name=description content="面向 Solidity 语言的变异测试系统"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/348da37.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>面向 Solidity 语言的变异测试系统</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div class=pgc-img><img alt="面向 Solidity 语言的变异测试系统" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/dcbae61fce31436a8639e1aa1cc31db2><p class=pgc-img-caption>图 1 MuSC 基本流程图</p></div><p><br></p><h2 class=pgc-h-arrow-right>1. 项目意义</h2><p>以太坊是一个开放的区块链平台，它提供了图灵完备的编程语言——Solidity 以构建智能合约，从而首次将智能合约应用于区块链领域。智能合约作为一种运行在区块链上的、控制用户数字资产的特殊程序，极大扩展了区块链技术的应用场景。目前以太坊上已经部署了超过 100 万个智能合约，然而随着智能合约的发展，其质量问题也日益严重。一方面，智能合约通常用于金融和信贷等安全关键领域，因此常常是攻击者的有吸引力的目标。另一方面，区块链的持久性决定了合约一旦部署上链就难以更改，一旦出现问题，其修复的代价极高。因此，智能合约在部署前必须要进行充分的测试。</p><p>在软件测试领域，通常使用代码覆盖率来衡量测试的好坏。代码覆盖率反应了测试执行到的源代码的百分比，但无法度量测试的缺陷检测能力，而变异测试可以弥补这一点。变异测试是一种对测试套件的有效性、充分性进行评估的技术，已经应用于 Java、C++等多种语言，并诞生了一系列变异算子。这些变异算子的作用是模拟开发过程中可能发生的错误，从而测量测试套件检测这些错误的能力。Solidity 是一门面向合约的语言，它的语言特性也与传统语言不同。例如，Solidity 使用地址变量 address 来表示合约或账户的地址，并含有一些地址相关的全局变量，如 msg.sender（当前调用的发起者）、tx.origin（交易链的发起者）等。由于现有的变异算子无法涵盖智能合约开发中的一些常见错误，变异测试的效果会大打折扣。因此，为了使变异测试能够有效应用于以太坊智能合约测试领域，有必要针对 Solidity 语言设计新的变异算子。同时，应考虑到智能合约运行与测试的环境的特殊性，对其变异测试的流程也进行相应的改进。</p><h2 class=pgc-h-arrow-right>2. 项目内容</h2><p><br></p><div class=pgc-img><img alt="面向 Solidity 语言的变异测试系统" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6dfc23a24ef04c7e8ca8dd8981a92d75><p class=pgc-img-caption>表 1 Solidity 特殊变异算子</p></div><p>本文设计并实现了一个面向 Solidity 语言的变异测试系统。首先，我们研究了 Solidity 的语言特性，从关键字、全局变量/函数、异常检测以及合约漏洞四个方面提出了 16 个新的变异算子。这些变异算子如表 1 所示，它们分别对应一种合约编程中可能出现的错误，运用这些变异算子可以在代码中注入这些缺陷。随后，我们实现了一个变异测试工具 MuSC，它能够在抽象语法树（Abstract Syntax Tree, AST）的层次上高效且准确地生成大量变异体，并基于 Truffle 框架实现了合约的自动化部署及测试。为了提高可用性，MuSC 还提供了待测合约选择、变异算子选择、变异体展示、自定义测试链创建、测试报告生成等功能。</p><p>MuSC 的基本流程如图 1 所示，输入为被测智能合约（Smart Contract Under Test, SCUT）和测试套件（TS），输出为变异得分和测试报告。具体流程如下：（1）AST 生成。将 SCUT 解析为 AST 格式，以减少由于注释、空行等冗余语句而导致的变异精度损失。（2）AST 变异。对 AST 格式的代码应用变异算子，生成一系列 AST 格式的变异体。（3）变异体生成和过滤。每一个 AST 格式的变异体将被转换成一个源文件版本，该版本与 SCUT 具有相似的语义，但是注入了一个预定义的错误。等价变异体和重复变异体的过滤是一个可选步骤。（4）合约编译和部署。为了避免区块链状态影响测试结果，无论是 SCUT 还是每个源文件版本的变异体，系统都会先构建一个初始状态相同的以太坊测试链，再在该链上进行编译和部署。（5）测试套件执行。部署成功后，执行 TS 中的测试用例。对于每个变异体，系统记录其每次测试的执行结果（即通过或失败）。（6）变异得分计算。在所有的变异体检测完成后，计算变异得分并输出测试报告。根据上述流程对 MuSC 进行模块拆分，可以将本系统分为测试任务配置、变异体生成与展示、测试报告生成三个模块。</p><p>测试任务配置模块。该模块主要负责变异测试前的准备工作，包括测试前提验证子模块和测试参数配置子模块。其中，测试前提验证子模块主要负责验证用户输入的项目是否符合标准，即项目是否基于 Truffle 框架构建，且测试用例是否全部通过。Truffle 是针对 Solidity 语言的一套开发框架，提供了一套类似 maven 的项目构建机制，使用 Truffle 可以极大简化智能合约部署和测试的流程。测试用例需要全部通过是为了便于后续对变异体杀死情况进行判断。当测试前提检测通过后，进入参数配置子模块。参数配置子模块从本地项目路径获取全部待测合约并将合约名称展示到前端，用户可以在界面上勾选想要测试的合约文件以及使用的变异算子，随后这些数据被传递给后端并作为测试参数进行保存。</p><p>变异集合生成模块。该模块主要负责待测智能合约的变异操作以及对生成的变异体展示。系统在上一模块完成了测试参数的配置，在变异体生成阶段将针对选定的待测文件，运用每一个变异算子进行故障注入。本系统中的变异操作在 AST 级别上进行，它是代码语法结构的一种抽象表示。MuSC 首先使用基于 ANTLR 语法的 Solidity 语言转换器 solidity-parser-antlr 来生成 AST，随后将 AST 中的每个节点封装为一个 Java 对象，每个对象表示一个程序片段，原则上可以对其进行变异。一旦一个变异算子被成功运用，则记录该变异算子名、变异行号以及变异行具体内容作为变异体的存储形式。在缺陷注入完成以后，从根节点依次调用每个节点的输出方法即可得到源码级别的变异体。用户可以在页面上浏览这些变异体，系统展示变异体时会将变异行用红色字体显示，便于定位缺陷位置。</p><p>测试报告生成模块。该模块主要负责变异体的部署、测试套件的执行以及测试报告的生成。此阶段，MuSC 首先根据用户自定义命令或默认命令创建本地测试链，接着编译原合约或变异体并部署在该链上，再使用 truffle test 命令执行测试套件。对每一个变异体系统都会重置本地链的初始状态，以避免区块高度或账户余额等区块链状态影响测试的执行结果。在测试套件执行完毕后，系统会对比变异体上的测试输出与原始合约上的测试输出，从而判断变异体是否被杀死。所有变异体检测完成后，系统会生成一份详细的测试报告。图 2 展示了测试报告示例图，该报告中显示了总变异得分以及每一个变异体的存活情况，它可以帮助智能合约测试人员进行测试用例的扩充，以降低合约中包含缺陷的概率。</p><div class=pgc-img><img alt="面向 Solidity 语言的变异测试系统" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/49c75e509cbd490d8125b5d073155569><p class=pgc-img-caption>图 2 测试报告示例图</p></div><p><br></p><h2 class=pgc-h-arrow-right>3. 项目效益</h2><p>为了验证变异测试在以太坊智能合约测试领域的有效性，我们在四个真实以太坊分布式应用上进行了一组实证研究，实验设计如下：（1）变异体生成。针对实验对象中的所有合约，使用全部变异算子来生成变异体，并过滤等价变异体及编译失败的变异体。（2）变异体集构建。随机选择 1/2 的非等价变异体构建变异体集 MS1，其余变异体构建变异体集 MS2。其中 MS1 用于构建测试用例集，MS2 用于验证测试用例集。（3）测试用例集构建。在 MS1 上运行测试用例，获取每一个测试用例的覆盖率和变异杀死情况，并根据测试结果构建测试用例集 TScov 和 TSMS1。其中 TScov 表示基于覆盖率构建的测试用例集，其行覆盖率与分支覆盖率均与 TS 相同；TSMS1 表示基于变异测试结果构建的测试用例集，其变异杀死能力与 TS 相同。（4）测试用例集对比。分别计算 TScov 和 TSMS1 在验证集 MS2 上的变异得分，并进行对比。</p><div class=pgc-img><img alt="面向 Solidity 语言的变异测试系统" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/71922417bf484f878d77368c881bb7be><p class=pgc-img-caption>表 2 TScov 和 TSMS1 在 MS2 上的变异得分及覆盖率表</p></div><p><br></p><p>实验的结果如表 2 所示，可以看到 TSMS1 在 MS2 上的平均变异得分为 41.4，远高于 TScov 在 MS2 上的平均变异得分 24.0，这表明 TSMS1 在缺陷检测效果方面优于 TScov。本文采用配对 Wilcoxon 检验并进行了双尾替代假设，测试值为 0.005，得出 TSMS1 显著优于 TScov 的替代假设。因此，可以得出变异测试在评估智能合约测试集充分性方面更有效的结论。</p><p>为了证明我们提出的 Solidity 变异算子的有效性，我们还进行了一项调研。首先从 GitHub、DASP（Decentralized Application Security Project）、Peckshield 等开源社区或网站上查找与以太坊智能合约相关的各种问题和错误报告，再人工判断其是否与某一类型的变异算子相关。在 729 个报告中，117 个与新提出的变异算子相关，包括 41 个关键字算子错误、35 个全局变量/函数算子错误、19 个错误处理算子错误和 22 个漏洞相关算子错误。上述结果表明，本文提出的 Solidity 变异算子能够注入真实存在的缺陷，从而帮助测试人员避免一些可能的错误。</p><h2 class=pgc-h-arrow-right>4. 致谢</h2><p>本文由南京大学软件学院智能软件工程实验室 2018 级硕士生巫浩然撰写。</p><p>感谢国家自然科学基金（61932012）支持！</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Solidity','语言','变异'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>