<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>2阶段提交分布式事务中间件Raincat | 极客快訊</title><meta property="og:title" content="2阶段提交分布式事务中间件Raincat - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/257680b8c2514d67861f1984e8e50cfe"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/34c5ace.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/34c5ace.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/34c5ace.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/34c5ace.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/34c5ace.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/34c5ace.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/34c5ace.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/34c5ace.html><meta property="article:published_time" content="2020-10-29T20:50:41+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:41+08:00"><meta name=Keywords content><meta name=description content="2阶段提交分布式事务中间件Raincat"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/34c5ace.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>2阶段提交分布式事务中间件Raincat</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>架构设计</p><div class=pgc-img><img alt=2阶段提交分布式事务中间件Raincat onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/257680b8c2514d67861f1984e8e50cfe><p class=pgc-img-caption></p></div><p>流程图</p><div class=pgc-img><img alt=2阶段提交分布式事务中间件Raincat onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b7d2e30b10db4f14a388374e3b96d02d><p class=pgc-img-caption></p></div><p>流程图原理详解</p><div class=pgc-img><img alt=2阶段提交分布式事务中间件Raincat onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cee77c89003c492082be9a36b85d1ca0><p class=pgc-img-caption></p></div><p>首先用户发起request请求进入consume端（也可以是controller层），controller层进入AOP切面，开启分布式事务</p><ul><li>会与txManager通信，创建事务组</li><li>发起业务方法调用point.proceed(),这一步是分布式事务调用RPC方法的入口，会一个一个调用RPC方法</li><li>主线程调用provder1 提供的RPC方法，同样会进入切面，此时，会启动另一个线程去调用该RPC方法，当前线程wait</li></ul><pre>调用失败，调用业务方法线程，会唤醒等待的主线程，并把异常信息返回，走的就是one fial rollback这条线，消费方获取异常信息，自动回滚当前事务，分布式事务结束。调用成功 业务线程，将唤醒主线程，并返回数据。业务线程同txManager 通信 将自己加入到当前事务组中，业务线程进入等待，等待txManager指令，commit or rollback 即 图中的4,5,6</pre><ul><li>主线程继续调用provider2提供的RPC方法 ，同样会进入AOP切面，当前主线程等待，启动一个业务线程去调用业务方法</li></ul><pre>调用失败，调用业务方法线程，会唤醒等待的主线程，并把异常信息返回，走的就是two fial rollback这条线，消费方获取异常信息，自动回滚当前事务，并与txManager进行通信（two TransactionGroup fail 这条线），txManager发起rollback指令（two fail rollback 这条线），通知provider1 rollback调用成功 业务线程，将唤醒主线程，并返回数据。业务线程同txManager 通信 将自己加入到当前事务组中，业务线程进入等待，等待txManager指令，commit or rollback 即 图中的9,10,11</pre><ul><li>主线程point.proceed()方法成功执行，会向txManager发出commit请求，txManager接收请求后，会检查各模块的网络通信等状态，符合条件后，发出commit指令，即 14。通知各个模块提交自己的事务。</li></ul><p>三阶段提交最大的问题，在于当txManager发出commit指令后，业务方down机，或者网络通信断了。怎么解决事务一致性的问题。我们这么想，当txManager 发出commit指令的时候，其实业务方法都没有任何异常，都是执行成功的，那么数据就是需要提交的。那么我们本地的补偿机制正是为了该场景而考虑，如果down机，或者网络异常。本地服务恢复后，会执行补偿，达到数据的一致性。如果业务方是集群部署的话，会立刻执行补偿，达到数据的一致性。</p><p>重要提醒，如果调用服务方是timeout，那么会判断当前事务不成功，这次分布式事务统一不会执行。</p><p>快速开始：</p><h1><strong>Spring-Boot-Starter</strong></h1><p>导出</p><ul><li>首先引入rpc框架所支持的jar包,注意：版本号，根据你拉代码自己打包上传到私服一致</li><li>Dubbo</li></ul><pre>&lt;dependency&gt; &lt;groupId&gt;com.raincat&lt;/groupId&gt; &lt;artifactId&gt;raincat-spring-boot-starter-dubbo&lt;/artifactId&gt; &lt;version&gt;${your version}&lt;/version&gt; &lt;/dependency&gt;</pre><ul><li>SpringCloud</li></ul><pre>&lt;dependency&gt; &lt;groupId&gt;com.raincat&lt;/groupId&gt; &lt;artifactId&gt;raincat-spring-boot-starter-springcloud&lt;/artifactId&gt; &lt;version&gt;${your version}&lt;/version&gt; &lt;/dependency&gt;</pre><ul><li>Motan</li></ul><pre> &lt;dependency&gt; &lt;groupId&gt;com.raincat&lt;/groupId&gt; &lt;artifactId&gt;raincat-spring-boot-starter-motan&lt;/artifactId&gt; &lt;version&gt;${your version}&lt;/version&gt; &lt;/dependency&gt;</pre><ul><li>在你的 application.yml 中新增如下配置：</li></ul><pre>raincat: tx : txManagerUrl: http://localhost:8761 serializer: kroy nettySerializer: kroy compensation: true compensationCacheType : db txDbConfig : driverClassName : com.mysql.jdbc.Driver url : jdbc:mysql://10.4.4.202:3306/tx?useUnicode=true&amp;characterEncoding=utf8 username : root password : 123123 # repositorySupport : redis # txRedisConfig : # hostName : 192.168.1.68 # port : 6379 # password : # repositorySupport : zookeeper # tx-zookeeper-config : # host : 92.168.1.73:2181 # sessionTimeOut : 100000 # rootPath : /tx # repositorySupport : mongodb # tx-mongo-config : # mongoDbUrl : localost:27017 # mongoDbName : xiaoyu # mongoUserName : xiaoyu # mongoUserPwd : 123456 # repositorySupport : file # tx-file-config: # path : /consume # prefix : consume</pre><p>TxManager配置详解</p><ul><li>application.properties 主要是配置tmManager的http服务端口，redis信息,netty相关信息 注意：因为现在tmManager 是自己向自己注册，所以http端口（server.port）应该要与eureka的端口一致。</li></ul><p>server.port=8761 txManager 的http端口</p><p>tx.manager.netty.port=9998 对业务方提供的TCP 端口。</p><p>tx.manager.netty.serialize=kryo netty 序列化方式，注意应该要与业务方的序列化方式一致。</p><ul><li>bootstrap.yml 主要是配置eureka的相关属性，比如renew时间，注册地址等</li><li>部署集群配置： 1.修改application.properties中的 server.port 如： 第一份服务为 server.port=8761 tx.manager.netty.port=9998; 第二份服务为：server.port=8762 tx.manager.netty.port=9999; 2. 修改bootstrap.yml中的eureka:client:serviceUrl:defaultZone:http://localhost:8761/eureka/,http://localhost:8762/eureka/ 再依次启动</li></ul><p>业务方配置详解</p><pre> @TxTransaction 该注解为分布式事务的切面（AOP point），如果业务方的service服务需要参与分布式事务，则需要加上此注解</pre><p>applicationContext.xml 详解：</p><pre> &lt;!-- Aspect 切面配置，是否开启AOP切面--&gt; &lt;aop:aspectj-autoproxy expose-proxy="true"/&gt; &lt;!--扫描分布式事务的包--&gt; &lt;context:component-scan base-package="com.raincat.*"/&gt; &lt;!--启动类属性配置--&gt; &lt;bean id="txTransactionBootstrap" class="com.raincat.core.bootstrap.TxTransactionBootstrap"&gt; &lt;property name="txManagerUrl" value="http://192.168.1.66:8761"/&gt; &lt;property name="serializer" value="kryo"/&gt; &lt;property name="nettySerializer" value="kryo"/&gt; &lt;property name="blockingQueueType" value="Linked"/&gt; &lt;property name="compensation" value="true"/&gt; &lt;property name="compensationCacheType" value="db"/&gt; &lt;property name="txDbConfig"&gt; &lt;bean class="com.raincat.common.config.TxDbConfig"&gt; &lt;property name="url" value="jdbc:mysql://192.168.1.78:3306/order?useUnicode=true&amp;characterEncoding=utf8"/&gt; &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"/&gt; &lt;property name="password" value="password"/&gt; &lt;property name="username" value="xiaoyu"/&gt; &lt;/bean&gt; &lt;/property&gt; &lt;/bean&gt;TxTransactionBootstrap 详解（具体参见com.raincat.core.config.TxConfig）： &lt;!--这里配置的TxManager http请求的IP:PORT (如果TxManager有改动，这里要跟着改动)--&gt; &lt;property name="txManagerUrl" value="http://192.168.1.66:8761"/&gt; &lt;!-- 与txManager通信的序列化方式，spi扩展支持 kroy，hessian protostuff 推荐使用kroy--&gt; &lt;property name="nettySerializer" value="kryo"/&gt; &lt;!-- 线程池中的队列类型 spi扩展支持 Linked Array SynchronousQueue--&gt; &lt;property name="blockingQueueType" value="Linked"/&gt; &lt;!--线程池中的拒绝策略 spi扩展支持 Abort Blocking CallerRuns Discarded Rejected--&gt; &lt;property name="rejectPolicy" value="Abort"/&gt; &lt;!--开启本地补偿（默认开启）--&gt; &lt;property name="compensation" value="true"/&gt;  &lt;!--本地数据序列化方式 spi扩展支持 java kroy，hessian protostuff 推荐使用kroy--&gt; &lt;property name="serializer" value="kryo"/&gt;</pre><p>本地数据保存配置与详解(spi扩展支持db，redis，zookeeper，mongodb，file),详情配置请参照sample工程:</p><ol><li>本地数据存储为数据库（数据库支持mysql，oracle ，sqlServer），当业务模块为集群时，推荐使用 会自动创建表，表名称为 tx_transaction_模块名称（applicationName）,每个模块配置成一样的补偿方式，如果是用db进行存储，请使用同一个库来存储。</li></ol><pre> &lt;!--配置补偿类型为db--&gt; &lt;property name="compensationCacheType" value="db"/&gt; &lt;property name="txDbConfig"&gt; &lt;bean class="com.raincat.common.config.TxDbConfig"&gt; &lt;!--数据库url--&gt; &lt;property name="url" value="jdbc:mysql://192.168.1.78:3306/order?useUnicode=true&amp;characterEncoding=utf8"/&gt; &lt;!--数据库驱动名称 --&gt;  &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"/&gt; &lt;property name="password" value="1234567"/&gt; &lt;property name="username" value="xiaoyu"/&gt; &lt;/bean&gt; &lt;/property&gt;</pre><ol><li>本地数据存储为redis，当业务模块为集群时，推荐使用。（更多配置请参考 com.happylifeplat.transaction.core.config.TxRedisConfig）</li></ol><pre> &lt;!--配置补偿类型为reids--&gt; &lt;property name="compensationCacheType" value="redis"/&gt; &lt;property name="txRedisConfig"&gt; &lt;bean class="com.raincat.common.config.TxRedisConfig"&gt; &lt;!--redis host--&gt; &lt;property name="hostName" value="192.168.1.78"/&gt; &lt;!--redis port--&gt; &lt;property name="port" value="6379"/&gt; &lt;!--redis 密码 （有密码就配置，无密码则不需要配置）--&gt; &lt;property name="password" value=""/&gt;  &lt;/bean&gt; &lt;/property&gt;</pre><ol><li>本地数据存储为zookeeper，当业务模块为集群时，推荐使用</li></ol><pre> &lt;!--配置补偿类型为zookeeper--&gt; &lt;property name="compensationCacheType" value="zookeeper"/&gt; &lt;property name="txZookeeperConfig"&gt; &lt;bean class="com.raincat.common.config.TxZookeeperConfig"&gt; &lt;!--zookeeper host：port--&gt; &lt;property name="host" value="192.168.1.66:2181"/&gt; &lt;!--zookeeper session过期时间--&gt; &lt;property name="sessionTimeOut" value="2000"/&gt; &lt;!--zookeeper 根节点路径--&gt; &lt;property name="rootPath" value="/tx"/&gt; &lt;/bean&gt; &lt;/property&gt;</pre><ol><li>本地数据存储为mongodb，当业务模块为单节点时，可以使用。会自动创建集合，集合名称为 tx_transaction_模块名称（applicationName） 这里mongdb连接方式采用3.4.0版本推荐使用的Sha1,不是CR模式，同时mongdb应该开启权限认证，使用者需要注意</li></ol><pre> &lt;!--配置补偿类型为mongodb--&gt; &lt;property name="compensationCacheType" value="mongodb"/&gt; &lt;property name="txMongoConfig"&gt; &lt;bean class="com.raincat.common.config.TxMongoConfig"&gt; &lt;!--mongodb url--&gt; &lt;property name="mongoDbUrl" value="192.168.1.78:27017"/&gt; &lt;!--mongodb 数据库--&gt; &lt;property name="mongoDbName" value="happylife"/&gt; &lt;!--mongodb 用户名--&gt; &lt;property name="mongoUserName" value="xiaoyu"/&gt; &lt;!--mongodb 密码--&gt; &lt;property name="mongoUserPwd" value="123456"/&gt; &lt;/bean&gt; &lt;/property&gt;</pre><ol><li>本地数据存储为file，当业务模块为单节点时，可以使用。创建的文件名称TX_ + prefix配置 + 模块名称</li></ol><pre> &lt;!--配置补偿类型为file--&gt; &lt;property name="compensationCacheType" value="file"/&gt; &lt;property name="txFileConfig"&gt; &lt;bean class="com.raincat.common.config.TxFileConfig"&gt; &lt;!--指定文件路径（可填可不填，不填时候，默认就是当前项目所在的路径）--&gt; &lt;property name="path" value=""/&gt; &lt;!--指定文件前缀，生成文件名称--&gt; &lt;property name="prefix" value="consume"/&gt; &lt;/bean&gt; &lt;/property&gt;</pre><h1><strong>dubbo用户指南</strong></h1><p>导出</p><p>dubbo用户指南(jar包的版本问题可以自己git源代码，然后编译上传到自己公司的私服)</p><ul><li>配置并且启动txManager,在aoolication.properties修改你的服务端口，redis配置，具体可以参考配置详解</li><li>在你的dubbo服务端添加jar包，并在需要参与分布式事务的方法上添加 @TxTransaction注解</li></ul><pre> &lt;dependency&gt; &lt;groupId&gt;com.raincat&lt;/groupId&gt; &lt;artifactId&gt;raincat-dubbo&lt;/artifactId&gt; &lt;version&gt;${your.version}&lt;/version&gt; &lt;/dependency&gt;</pre><ul><li>配置applicationContext.xml,如下所示，如有其他问题可以参考配置详解</li></ul><pre>&lt;!-- Aspect 切面配置，是否开启AOP切面--&gt; &lt;aop:aspectj-autoproxy expose-proxy="true"/&gt; &lt;!--扫描分布式事务的包--&gt; &lt;context:component-scan base-package="com.raincat.*"/&gt; &lt;!--启动类属性配置--&gt; &lt;bean id="txTransactionBootstrap" class="com.raincat.core.bootstrap.TxTransactionBootstrap"&gt; &lt;!--这里的url是txMangager的ip+端口--&gt; &lt;property name="txManagerUrl" value="http://192.168.1.66:8761"/&gt; &lt;property name="serializer" value="kryo"/&gt; &lt;property name="nettySerializer" value="kryo"/&gt; &lt;property name="blockingQueueType" value="Linked"/&gt; &lt;property name="compensation" value="true"/&gt; &lt;property name="compensationCacheType" value="db"/&gt; &lt;property name="txDbConfig"&gt; &lt;bean class="com.raincat.common.config.TxDbConfig"&gt; &lt;property name="url" value="jdbc:mysql://192.168.1.78:3306/order?useUnicode=true&amp;characterEncoding=utf8"/&gt; &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"/&gt; &lt;property name="password" value="password"/&gt; &lt;property name="username" value="xiaoyu"/&gt; &lt;/bean&gt; &lt;/property&gt; &lt;/bean&gt;</pre><ul><li>在dubbo的消费方，也是如上配置，配置好以后，启动项目.</li></ul><p>快速体检，运行dubbo-sample（ 使用者JDK必须为1.8）</p><p>步骤一：</p><p>配置txManaager, 修改application.properties中你自己的redis配置</p><p>启动TxManagerApplication</p><p>注意：如果需要修改服务端口，则应该保证与eureka:client:serviceUrl:defaultZone中的端口一致</p><p>步骤二：</p><ol><li>引入依赖包（sample已经引入）</li></ol><pre>&lt;dependency&gt; &lt;groupId&gt;com.raincat&lt;/groupId&gt; &lt;artifactId&gt;raincat-dubbo&lt;/artifactId&gt; &lt;version&gt;${you.version}&lt;/version&gt; &lt;/dependency&gt;</pre><ol><li>执行 raincat-dubbo-sample 工程 sql文件 dubbo-sample.sql</li><li>在每个工程下的application.yml 中配置您的数据库连接(只需要改ip和端口)</li><li>在工程下的spring-dubbo.xml 中配置您的zookeeper注册中心</li><li>在每个工程下 applicationContext.xml中的TxDbConfig 配置您的补偿数据库连接，提供单独的库来存储。</li><li>在需要做分布式事务的接口上加上注解 @TxTransaction （sample已经加上）</li><li>依次启动order模块，stock 模块 ,consume模块</li><li>访问http://localhost:8888/swagger-ui.html 进行测试体验</li></ol><h1><strong>springcloud用户指南</strong></h1><p>导出</p><p>springcloud用户指南(jar包的版本问题可以自己git源代码，然后编译上传到自己公司的私服)</p><ul><li>配置并且启动txManager,在aoolication.properties修改你的服务端口，redis配置，具体可以参考配置详解</li><li>在你的springcloud服务端添加jar包，并在需要参与分布式事务的方法上添加 @TxTransaction注解</li></ul><pre>&lt;dependency&gt; &lt;groupId&gt;com.raincat&lt;/groupId&gt; &lt;artifactId&gt;raincat-springcloud&lt;/artifactId&gt; &lt;version&gt;${your.version}&lt;/version&gt;&lt;/dependency&gt;</pre><ul><li>配置applicationContext.xml,如下所示，如有其他问题可以参考配置详解</li></ul><pre>&lt;!-- Aspect 切面配置，是否开启AOP切面--&gt; &lt;aop:aspectj-autoproxy expose-proxy="true"/&gt; &lt;!--扫描分布式事务的包--&gt; &lt;context:component-scan base-package="com.raincat.*"/&gt; &lt;!--启动类属性配置--&gt; &lt;bean id="txTransactionBootstrap" class="com.raincat.core.bootstrap.TxTransactionBootstrap"&gt; &lt;!--这里的url是txMangager的ip+端口--&gt; &lt;property name="txManagerUrl" value="http://192.168.1.66:8761"/&gt; &lt;property name="serializer" value="kryo"/&gt; &lt;property name="nettySerializer" value="kryo"/&gt; &lt;property name="blockingQueueType" value="Linked"/&gt; &lt;property name="compensation" value="true"/&gt; &lt;property name="compensationCacheType" value="db"/&gt; &lt;property name="txDbConfig"&gt; &lt;bean class="com.raincat.common.config.TxDbConfig"&gt; &lt;property name="url" value="jdbc:mysql://192.168.1.78:3306/order?useUnicode=true&amp;characterEncoding=utf8"/&gt; &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"/&gt; &lt;property name="password" value="password"/&gt; &lt;property name="username" value="xiaoyu"/&gt; &lt;/bean&gt; &lt;/property&gt; &lt;/bean&gt;</pre><ul><li>在springcloud的消费方，也是如上配置，配置好以后，启动项目.</li></ul><p>快速体检，运行springcloud-sample（ 使用者JDK必须为1.8）</p><p>步骤一：</p><pre>配置txManaager, 修改application.properties中你自己的redis配置 启动TxManagerApplication</pre><p>注意：如果需要修改服务端口，则应该保证与eureka:client:serviceUrl:defaultZone中的端口一致</p><p>步骤二：</p><ul><li>引入依赖包（sample已经引入）</li></ul><pre> &lt;dependency&gt; &lt;groupId&gt;com.raincat&lt;/groupId&gt; &lt;artifactId&gt;raincat-springcloud&lt;/artifactId&gt; &lt;version&gt;${your.version}&lt;/version&gt; &lt;/dependency&gt;</pre><ul><li>执行 raincat-springcloud-sample 工程 sql文件 springcloud-sample.sql</li><li>在每个工程下 application.yml 中配置您的数据库连接(只需要改ip和端口)</li><li>在每个工程下 applicationContext.xml中的TxDbConfig 配置您的补偿数据库连接，提供单独的数据库来存储。</li><li>在需要做分布式事务的接口上加上注解 @TxTransaction （sample已经加上）</li><li>依次启动AliPayApplication，WechatApplication ,PayApplication</li><li>访问http://localhost:8881/pay-service/swagger-ui.html 进行体验测试</li></ul><h1><strong>启动事务管理后台（admin）</strong></h1><p>导出</p><p>raincat-admin 启动教程</p><p>启动前提：分布式事务项目已经部署并且运行起来，用户根据自己的RPC框架进行使用 dubbo 用户 springcloud 用户</p><ul><li>首先用户使用的JDK必须是1.8+ 本地安装了git ,maven ，执行以下命令</li></ul><pre>git clone https://github.com/yu199195/Raincat.gitmaven clean install</pre><ul><li>使用你的开发工具打开项目，比如idea Eclipse</li></ul><p>步骤一： 配置并且启动transaction-admin</p><ul><li>在项目中的application.properties文件中，修改您的服务端口，redis配置等配置:</li></ul><pre>#admin项目的tomcat端口server.port=8888#admin项目的上下文server.context-path=/adminserver.address=0.0.0.0#admin项目的应用名称spring.application.name=tx-transaction-admin# admin项目激活的类型，支持db，file，mongo，zookeeper，redis 下文会继续讲解spring.profiles.active=db# txManager redis 配置#集群配置#tx.redis.cluster=true#tx.redis.cluster.nodes=127.0.0.1:70001;127.0.1:7002#tx.redis.cluster.redirects=20#单机配置tx.redis.cluster=falsetx.redis.hostName=192.168.1.68#redis主机端口tx.redis.port=6379#tx.redis.password=happylifeplat01# admin管理后台的用户名，用户可以自己更改tx.admin.userName=admin# admin管理后台的密码，用户可以自己更改tx.admin.password=admin#采用二阶段提交项目的应用名称集合，这个必须要填写recover.application.list=alipay-service,wechat-service,pay-service#事务补偿最大重试次数recover.retry.max=10#事务补偿的序列方式recover.serializer.support=kryo#dbSuport 采用db进行的补偿方式的配置recover.db.driver=com.mysql.jdbc.Driverrecover.db.url=jdbc:mysql://192.168.1.68:3306/tx?useUnicode=true&amp;characterEncoding=utf8recover.db.username=xiaoyurecover.db.password=Wgj@555888#redis 采用redis进行补偿方式的配置recover.redis.cluster=falserecover.redis.hostName=192.168.1.68recover.redis.port=6379recover.redis.password=#recover.redis.clusterUrl=127.0.0.1:70001;127.0.1:7002#mongo 采用mongo 进行补偿方式的配置recover.mongo.url=192.168.1.68:27017recover.mongo.dbName=happyliferecover.mongo.userName=xiaoyurecover.mongo.password=123456#zookeeper 采用zookeeper进行补偿的方式配置recover.zookeeper.host=192.168.1.132:2181recover.zookeeper.sessionTimeOut=200000</pre><p>配置解释</p><ul><li>关于txManager的redis配置:其实就是在txManager项目中的redis配置，在这里需要配置成一样的； 注意，如果你的redis是集群模式请参考集群配置，并注释掉单机redis配置，同理redis单机模式也一样。</li><li>关于 recover.application.list配置：这里需要配置每个参与二阶段分布式事务的系统模块的applicationName，多个模块用 "," 分隔，这里必须要配置。</li><li>关于 recover.serializer.support 配置，这里是指参与二阶段分布式事务系统中，配置事务补偿信息的序列化方式。</li><li>关于 spring.profiles.active 配置 admin项目激活的类型，支持db，file，mongo，zookeeper， 这里是指参与二阶段分布式事务系统中，配置事务补偿信息存储方式，如果您用db存储，那这里就配置成db，同时配置好 recover.db等信息。 其他方式同理。 注意，每个模块请使用相同的序列化方式和存储类型</li><li>关于 tx.admin 等配置。 这里就是管理后台登录的用户与密码，用户可以进行自定义更改。</li></ul><p>步骤二：修改 index.html</p><pre>&lt;!--href 修改成你的ip 端口--&gt;&lt;a id="serverIpAddress" style="display: none" href="http://192.168.1.132:8888/admin"&gt;</pre><p>步骤三: 运行 AdminApplication 中的main方法。</p><p>步骤四:在浏览器访问 http://ip:prot/admin ,输入用户名，密码登录。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'阶段','事务','中间'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>