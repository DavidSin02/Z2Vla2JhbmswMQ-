<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>运维工程师必备技能：交换机上启动QOS | 极客快訊</title><meta property="og:title" content="运维工程师必备技能：交换机上启动QOS - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/228b4f9753a44d7593432b6f8f2b8dcb"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/35e1fd3.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/35e1fd3.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/35e1fd3.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/35e1fd3.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/35e1fd3.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/35e1fd3.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/35e1fd3.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/35e1fd3.html><meta property="article:published_time" content="2020-10-29T21:05:53+08:00"><meta property="article:modified_time" content="2020-10-29T21:05:53+08:00"><meta name=Keywords content><meta name=description content="运维工程师必备技能：交换机上启动QOS"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/35e1fd3.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>运维工程师必备技能：交换机上启动QOS</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>可限速的交换机一般都在三层或者以上的交换机，自2008年之后新出的交换机型号二层设备就可以 做到QOS限速，精确度达到1Mbps，例如Cisco 2960系列交换机。在这之后的大多数国内的标准二层交换机都可以做多限速，精确度基本能达到1Mbps，比如中兴的标准二层，H3C的标准二层都可以做 到。老式的CISCO标准二层交换机例如2950类的交换也可以做到限速，但是精确度只能达到10Mbps。2950G的交换和2950 为EI型 的交换没有太大的限速区别，因为限速和有关系，2950 系列的交换IOS版本一般都是在9.0 左右，最新的2960系列交换机 IOS 版本在 12.2 左右，高版本的IOS 提供了更强的系统功能。</p><div class=pgc-img><img alt=运维工程师必备技能：交换机上启动QOS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/228b4f9753a44d7593432b6f8f2b8dcb><p class=pgc-img-caption></p></div><p>下面针对一些限速的方法进行总结：</p><p>PC1接在Cisco3550 F0/1上，速率为1M;</p><p>PC1接在Cisco3550 F0/2上，速率为2M;</p><p>Cisco3550的G0/1为出口。</p><p>PC是直接接在三层交换机端口的，意思就是说限制的是三层交换机端口的上下行流量控制，同理，如果三层交换机端口不是接PC，而是一个二层交换机，那么可以对下层的设备进行上联限速。</p><p>注:每个接口每个方向只支持一个策略;一个策略可以用于多个接口。因此所有PC的下载速率的限制都应该定义。在同一个策略(在本例子当中为policy-map user-down)，而PC不同速率的区分是在Class-map分别定义。</p><p>1、在交换机上启动QOS</p><p>Switch(config)#mls qos //在交换机上启动QOS</p><p>2、分别定义PC1(10.10.1.1)和PC2(10.10.2.1)访问控制列表</p><p>Switch(config)#access-list 10 permit 10.10.1.0 0.0.0.255 //控制pc1上行流量</p><p>Switch(config)#access-list 100 permit ip any 10.10.1.0 0.0.0.255 //控制pc1下行流量</p><p>Switch(config)#access-list 11 permit 10.10.2.0 0.0.0.255 //控制pc2上行流量</p><p>Switch(config)#access-list 111 permit any 10.10.2.0 0.0.0.255 //控制pc2下行流量</p><p>3、定义类，并和上面定义的访问控制列表绑定</p><p>Switch(config)# class-map user1-up //定义PC1上行的类，并绑定访问列表10</p><p>Switch(config-cmap)# match access-group 10</p><p>Switch(config-cmap)# exit</p><p>Switch(config)# class-map user2-up</p><p>Switch(config-cmap)# match access-group 11 //定义PC2上行的类，并绑定访问列表10</p><p>Switch(config-cmap)# exit</p><p>Switch(config)# class-map user1-down</p><p>Switch(config-cmap)# match access-group 100 //定义PC1下行的类，并绑定访问列表100</p><p>Switch(config-cmap)# exit</p><p>Switch(config)# class-map user2-down</p><p>Switch(config-cmap)# match access-group 111 //定义PC2下行的类，并绑定访问列表111</p><p>Switch(config-cmap)# exit</p><p>4、定义策略，把上面定义的类绑定到该策略</p><p>Switch(config)# policy-map user1-up //定义PC1上行的速率为1M</p><p>Switch(config-pmap)# class user1-up</p><p>Switch(config-pmap-c)# trust dscp</p><p>Switch(config-pmap-c)# police 1024000 1024000 exceed-action drop</p><p>Switch(config)# policy-map user2-up //定义PC2上行的速率为2M</p><p>Switch(config-pmap)# class user2-up</p><p>Switch(config-pmap-c)# trust dscp</p><p>Switch(config-pmap-c)# police 2048000 1024000 exceed-action drop</p><p>Switch(config)# policy-map user-down //定义PC1下行的速率为1M</p><p>Switch(config-pmap)# class user1-down</p><p>Switch(config-pmap-c)# trust dscp</p><p>Switch(config-pmap-c)# police 1024000 1024000 exceed-action drop</p><p>Switch(config-pmap-c)# exit</p><p>Switch(config-pmap)# class user2-down //定义PC2下行的速率为2M</p><p>Switch(config-pmap-c)# trust dscp</p><p>Switch(config-pmap-c)# police 2048000 1024000 exceed-action drop</p><p>Switch(config-pmap-c)# exit</p><p>5、在接口上运用策略</p><p>Switch(config)# interface f0/1 //进入PC1端口上联交换机端口配置模式</p><p>Switch(config-if)# service-policy input user1-up //绑定PC1上行策略为user1-up</p><p>Switch(config)# interface f0/2 //进入PC2端口上联交换机端口配置模式</p><p>Switch(config-if)# service-policy input user2-up //绑定PC2上行策略为user2-up</p><p>Switch(config)# interface g0/1 //进入交换机上联千兆端口配置模式</p><p>Switch(config-if)# service-policy input user-down //绑定交换机上联端口策略为 user-down</p><p>利用三层交换中的strom-control（风暴控制）功能，该功能是基于端口控制单播\多播 \组播,可以精确到0.01%，但是一个近似值 。此方法是一个门限方式，限制监控时间为每秒，超过设置的门限便丢弃包，并且用户是不知情的，以为是网络终端，或者远程无响应，显然这种方式不能确保终端 用户每时每刻的网络畅通，所以本人认为此方法只适用于某些场合，或者和其它策略配合使用。</p><p>具体配置方法：</p><p>Switch(config)# interface f0/1 //进入交换机端口配置模式</p><p>Switch(config-if)# strom-control unicast/broadcast/multi level 10 //该port带宽的10%</p><p>理解风暴控制</p><p>风暴控制防止交换机的端口被局域网中的广播、多播或者一个物理端口上的单播风暴所破坏。局域网风暴发生在包在局域网中泛洪，建立的过多的流量并丧失了网络性能。协议栈中的错误或者网络配置上的错误可以导致风暴。</p><p>风暴控制(或者叫流量压制)管理进栈的流量状态，通过一段时间和对比测量带有预先设定的压制级别 门限值的方法来管理。门限值表现为该端口总的可用带宽的百分比。交换机支持单独的风暴控制门限给广播、组播和单播。如果流量类型的门限值达到了，更多这种 类型的流量就会受到压制，直到进栈流量下降到门限值级别以下。</p><p>注意：当组播的速度超出一组门限，所有的进站流量(广播组播单播)都会被丢弃，直到级别下降到门限级别以下。只有stp的包会被转发。当广播和单播门限超出的时候，只有超出门限的流量会被封闭。</p><p>当风暴控制开启了时，交换机监视通过接口的包来交换总线和决定这个包是单播，组播还是广播。交换机监视广播组播和单播的数目，每1秒钟一次，并且当某种类型流量的门限值到达了，这种流量就会被丢弃了。这个门限以可被广播使用的总的可用带宽的百分比被指定。</p><p>以下是一个接口上的一段时间内的广播流量的模型曲线图。</p><p>这个例子也可被组播和单播流量套用。在这个例子中，广播流量在T1-T2、T4-T5时间之间被转发超过配置门限值所有的该种流量都在下一个时间被丢弃。因此广播流量在T2和T5时间内是被封闭的。在下一个时断，T3，如果广播流量没有超出限制，那么它又被转发了。</p><p>风暴控制的工作是风暴控制抑制级别和每秒钟间隔控制的结合。一个更高的门限允许更多的包通过。如果把门限值设置成100%意味着将不会限制所有任何的流量。0%意味着所有的广播组播和单播流量都会被封闭。</p><p>注意：因为包不会在统一时间间隔内到达，每秒钟间隔间如果没有流量会影响风暴控制。</p><p>交换机持续监视端口的流量，而且当利用级别降到门限以下，这种被丢弃类型的流量，又会被再次转发。</p><p>你可以使用storm-control接口命令来设定门限值给每一种类型的流量。</p><p>默认的风暴控制配置：默认地，单播组播广播的风暴控制都是在交换机上关闭的，意味着：压制级别都是100%。</p><p>开启风暴控制：你在接口开启风暴控制，并输入总可用带宽的百分比来确定你要使用给该种流量；输入100%会允许所有流量。然而，因为硬件的限制以及包大小的不同的会导致偏差，门限值百分比是一个近似值。</p><p>注意：风暴控制仅支持在物理端口下使用；它不支持以太通道下使用，尽管能敲进去。</p><p>以下例子在f0/17下把组播风暴级别限制在70.5%</p><p>Switch# configure terminal</p><p>Switch(config)# interface fastethernet0/17</p><p>Switch(config-if)# storm-control multicast level 70.5 //限制组播类型的包</p><p>Switch(config-if)# end</p><p>Switch# show storm-control fastethernet0/17 multicast</p><p>Interface Filter State Level Current</p><p>--------- ------------- ------- -------</p><p>Fa0/17 Forwarding 70.50% 0.00%</p><p>这个是关闭风暴控制</p><p>Switch# configure terminal</p><p>Switch(config)# interface fastethernet0/17</p><p>Switch(config-if)# no storm-control multicast level</p><p>Switch(config-if)# end</p><p>Switch# show storm-control fastethernet0/17 multicast</p><p>Interface Filter State Level Current</p><p>--------- ------------- ------- -------</p><p>CISCO 3550-QOS的-接口限速</p><p>Building configuration...</p><p>Current configuration : 3123 bytes</p><p>version 12.1</p><p>no service pad</p><p>service timestamps debug uptime</p><p>service timestamps log datetime localtime</p><p>no service password-encryption</p><p>hostname shangwu</p><p>enable secret 5 $1$PmhU$dlsphRGumA1simUEIA87j0</p><p>enable password</p><p>ip subnet-zero</p><p>mls qos</p><p>class-map match-all user1-up</p><p>match access-group 10</p><p>class-map match-all user1-down</p><p>match access-group 100</p><p>policy-map user1-up</p><p>class user1-up</p><p>police 800000 800000 exceed-action drop</p><p>trust dscp</p><p>spanning-tree extend system-id</p><p>interface FastEthernet0/1</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/2</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/3</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/4</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/5</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/6</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/7</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/8</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/9</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/10</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/11</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/12</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/13</p><p>no ip address</p><p>service-policy input user1-up</p><p>interface FastEthernet0/14</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/15</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/16</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/17</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/18</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/19</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/20</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/21</p><p>no ip address</p><p>duplex full</p><p>service-policy input user1-up</p><p>interface FastEthernet0/22</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/23</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/24</p><p>description wan interface</p><p>switchport mode access</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface GigabitEthernet0/1</p><p>no ip address</p><p>interface GigabitEthernet0/2</p><p>no ip address</p><p>interface Vlan1</p><p>ip address ********255.255.255.0</p><p>ip default-gateway ********</p><p>ip classless</p><p>ip http server</p><p>logging trap debugging</p><p>logging source-interface FastEthernet0/24</p><p>logging ***********</p><p>access-list 10 permit *********.0 0.0.0.255</p><p>access-list 100 permit ip any ********.0 0.0.0.255</p><p>line con 0</p><p>exec-timeout 0 0</p><p>line vty 0 4</p><p>password</p><p>login</p><p>line vty 5 15</p><p>password</p><p>login</p><p>end</p><p>交换机的主机名、进入enable模式的密码、远程登陆的用户名和密码及设置、管理vlan的 IP地址、交换机的默认网关、交换机的端口、SNMP服务、交换机时间设置等。这些和之前的2950交换机都是一样的， 2960交换机和2950相比增加了限速等功能，由于今后客户新上架除了签署了流量合同的其他都要在交换机的端口上做限速。</p><p>首先也是十分重要的一点就是，在交换机的配置没有完成前，特别是VTP模式的配置（一般情况下VTP的初始模式因配置为transparent模式）没有完成前禁止将交换机接入网络，以免使网络中的VLAN信息发生改变，因当使用console线对其进行配置。</p><p>在刚开始配置2950的时候由于还没有设置密码，处于安全方面的考虑不要将其接入网络，因使用 console口对其进行配置。交换机刚加电启动时所有的端口会进行自检，开始时每个端口上的指示灯会呈琥珀色经过一段时间后熄灭。系统的指示等默认情况 下会亮在SYST和 STAT两个灯上。</p><p>交换机启动后使用console线对其进行设置。Console线使用的是串行接口，串行口与电 脑的串行口相连（如电脑没有串行口可以使用转接器连接），RJ-45的接头和交换机的console口相连。线连好后在windows上点击 开始→程序→附件→通讯→超级终端，在跳出新建连接对话框后在名称一栏中填入想要新建的连接名称，然后确定。接着所连接的COM口，在COM1属性里波特 率选择"9600"，数据位选择"8"，奇偶效验选择"无"，停止位选择"1"，流量控制选择"无"；或直接点击"还原默认值"，确定进入2950配置界 面。</p><p>2950如第一次启动会出现对话配置模式选项，选择yes进入对话配置模式，选择no进入CLI命令行界面。以下配置都在CLI模式下进行。</p><p>在CLI模式下交换机显示：switch></p><p>在此输入命令 switch> 用户模式</p><p>switch>enable 进入特权模式</p><p>switch# configure terminal 进入配置模式</p><p>switch(config)# 配置模式</p><p>设置主机名 switch(config)#hostname <em>主机名 </em>一般情况下主机名的设置规则是switch后面跟交换机编号，如switch20、switch21等</p><p>设置enable密码 switch(config)#enable secret <em>密码</em> 设置密码时使用secret命令，因为它比password命令有更好的安全性，密码用Password Agent软件随机生成12位包含数字和大小写字母的密码</p><p>设置远程登陆的 switch(config)# username <em>用户名</em>privilege <em>权限</em> secret <em>密码</em></p><p>用户名、权限和密码 在设置<em>权限</em>参数时一般填0(最低权限)，<em>用户名</em>统一为netmaster，密码用Password Agent软件随机生成12位包含数字和大小写字母的密码</p><p>对所设置的密码 switch(config)# service password-encryption 进行加密</p><p>设置管理vlan和 switch(config)# interface vlan1 进入管理vlan的配置</p><p>默认网关 switch(config-if)# ip address <em>IP地址 子网掩码 </em>设置管理vlan的IP，远程登陆使用此IP</p><p>switch(config-if)#no shutdown 启用管理vlan</p><p>switch(config-if)#exit 退出管理vlan的配置</p><p>switch(config)# ip default-gateway <em>IP地址 </em>设置默认网关</p><p>设置交换机端口 switch(config)# interface FastEthernet 0/1 进入交换机的1号端口</p><p>switch(config-if)# description uplink port 对端口进行描述，默认时交换机1号口为上连口</p><p>switch(config-if)# switchport mode trunk 将上连口设为trunk模式</p><p>switch(config-if)# speed 100 设置端口速率</p><p>switch(config-if)# duplex full 端口设为全双工模式</p><p>switch(config-if) interface range fastEthernet 0/2 -24</p><p>进入端口2至端口24的配置</p><p>switch(config-if-range)#shutdown 关闭这些端口，到使用时再打开</p><p>设置SNMP服务 switch(config)#snmp-server community <em>字符串LgB96G0o</em> RO</p><p>命令允许读访问到任何提交community string为<em>字符串</em>的软件，<em>字符串</em>设置要符合长度8位以上、需包含大小写字母和数字</p><p>关闭http服务 switch(config)#no ip http server 由于开启http服务在全全上存在隐患，因关闭</p><p>设置vty switch(config)#line vty 0 4 设置telnet为0至4共5条线路</p><p>switch24(config-line)# login local 使系统在远程登录时使用本地设置的用户名和密码进行验证</p><p>设置timestamps switch(config)# service timestamps debug datetime</p><p>switch(config)# service timestamps log datetime 默认时debug/log为uptime，改为datetime</p><p>设置VTP模式 switch#vlan database 进入VTP的设置</p><p>switch (vlan)#vtp transparent 将VTP模式设置为transparent模式</p><p>设置交换机时间 switch#clock set <em>hh:mm:ss</em></p><p>保存交换机的设置 switch#copy running-config startup-config</p><p>查看交换机设置 switch#show running-config 查看交换机的配置</p><p>端口流量的限制</p><p>交换机端口流量的限制是用policy-map来实现的。</p><p>switch (config)#ip access-list standard <em>name</em> // 建立标准的命名访问控制列表，<em>name</em>为ACL的名称</p><p>Switch (config-std-nacl)# permit any // 匹配任何ip</p><p>Switch (config)#class-map <em>name </em>//设置QoS Class Map</p><p>Switch (config-cmap)#match access-group name <em>name </em>// 绑定ACL列表</p><p>Switch (config)#policy-map <em>name</em> // 设置策略名称</p><p>Switch (config-pmap)#class <em>name</em> // 绑定class-map</p><p>Switch (config-pmap-c)#police <em>3000000 100000</em> exceed-action <em>drop</em> 定义策略正常速率为每秒3Mbit，允许超出的范围是100KByte，超出范围的数据包就<em>drop</em></p><p>Switch (config)#interface range fastEthernet 0/1 – 24 // 进入1－24端口，默认交换机除了上联口外都要做限速</p><p>Switch (config-if)#service-policy input <em>name</em> //在端口上进的方向绑定策略</p><p>Switch (config) #mls qos //启用mls qos使策略生效</p><p>端口绑定MAC地址</p><p>进入配置模式后用以下命令绑定：</p><p>Switch(config-if )switchport port-security mac-address MAC(主机的MAC地址)</p><p>解除绑定</p><p>Switch(config-if )no switchport port-security mac-address MAC(主机的MAC地址)</p><p>二层交换机如何限速？</p><p>使用cisco 2950 交换机，每个端口都是二层接入，如何限速？</p><p>使用service-policy可以进行端口限速：</p><p>可以先定义class，然后</p><p>Switch(config)# policy-map policy1</p><p>Switch(config-pmap)# class class1</p><p>Switch(config-pmap-c)# police 1000000 65536 exceed-action drop</p><p>然后在接口下配置：</p><p>Switch(config)# interface gigabitethernet0/17</p><p>Switch(config-if)# service-policy input plcmap1</p><p>可以限速，但是不精确。。。。。。</p><p>给个6500上的限速例子：</p><p>Mls qos aggregate-policer test 50000000 100000 conform-action transmit exceed-action drop</p><p>Mls qos</p><p>class-map match-any test_limite</p><p>match access-group name test_addr</p><p>policy-map rate-limit-uplink</p><p>class test_limite</p><p>police aggregate test</p><p>ip access-list extended test_addr</p><p>permit ip any x.x.x.x 0.0.0.255</p><p>inter g0/1</p><p>service-policy input rate-limit-uplink</p><p>总结:Cisco交换机端口限速常用配置，以前端口限速的工作都是由上级部门来做，最近由于分公司自己的内部客户需求，我们要为其提供50M的带宽.　为此我们可是煞费苦心作了两天的测试，先来说说我们测试的设备连接情况：</p><p>思科3560端口0/47（模拟用户）——————思科6509端口0/1、0/2（模拟局端，两条路有上联，热备）。</p><p>测试方法在3560及6509上分别起ftp进行测速</p><p>重点来了，来说说6509上的命令吧：</p><p>mls qos aggregate-policer test 50000000 100000 conform-action transmit exceed-action drop</p><p>mls qos</p><p>class-map match-any test_limite</p><p>match access-group name test_addr</p><p>policy-map rate-limit-uplink</p><p>class test_limite</p><p>police aggregate test</p><p>ip access-list extended test_addr (因为上下行都引用策略一样因此不单独做acl)</p><p>permit ip any x.x.x.x 0.0.0.3 (分配给用户的互联网地址段A）</p><p>permit ip x.x.x.x 0.0.0.3 any</p><p>permit ip any x.x.x.x 0.0.0.3 (分配给用户的互联网地址段B）</p><p>permit ip x.x.x.x 0.0.0.3 any</p><p>inter f0/1</p><p>ip addre x.x.x.x 255.255.255.252</p><p>service-policy input test_uplink限制上传</p><p>inter f0/2</p><p>ip addre x.x.x.x 255.255.255.252</p><p>service-policy input test_uplink限制上传</p><p>inter g0/47</p><p>service-policy input rate-limit-uplink限制下载</p><p>经过测试，这个方案成功了！有几点需要解释一下，因为35和65只有在input方向才能引 用策略，所以同时对上行和下载作限速需要在上联和下载两方向的端口上做，其次，我们中间有很多弯路，说来给大家提个醒，开始我们用的测试设备性能很低，所 以始终测试不出理想的结果，很泄气，无意中拿了最好的一台电脑去测试，结果居然出人意料，后来又找了一台高性能设备进行测试，结果非常理想，在此提醒大 家，低性能的设备在测试高带宽的时候要特别注意。</p><p>华为的2层交换机，是直接进端口后，用line-rate对上下行进行限速，不过好像是要双向做</p><p>下面是偶看到的 你试试看</p><p>access-list 2 permit any</p><p>mls qos</p><p>class-map match-all input-class</p><p>match access-group 2</p><p>class-map match-all output-class</p><p>match ip dscp 0</p><p>policy-map output-policy-2M</p><p>class output-class</p><p>police 2000000 200000 exceed-action drop</p><p>policy-map input-policy-2M</p><p>class input-class</p><p>police 2000000 200000 exceed-action drop</p><p>policy-map output-policy-5M</p><p>class output-class</p><p>police 5000000 500000 exceed-action drop</p><p>policy-map input-policy-5M</p><p>class input-class</p><p>police 5000000 500000 exceed-action drop</p><p>policy-map output-policy-10M</p><p>class output-class</p><p>police 10000000 1000000 exceed-action drop</p><p>policy-map input-policy-10M</p><p>class input-class</p><p>police 10000000 1000000 exceed-action drop</p><p>policy-map output-policy-20M</p><p>class output-class</p><p>police 20000000 1000000 exceed-action drop</p><p>policy-map input-policy-20M</p><p>class input-class</p><p>police 20000000 1000000 exceed-action drop</p><p>interface FastEthernet ?/?</p><p>service-policy input input-policy-5M</p><p>service-policy output output-policy-5M</p><p>系列智能以太网交换机</p><p>Cisco Catalyst 2960系列智能以太网交换机是一个全新的、固定配置的独立设备系列，提供桌面快速以太网和千兆以太网连接，可为入门级企业、中型市场和分支机构网络提供 增强LAN服务。Catalyst2960系列具有集成安全特性，包括网络准入控制(NAC)、高级服务质量(QoS)和永续性，可为网络边缘提供智能服 务。</p><p>Cisco Catalyst 2960系列提供：为网络边缘提供了智能特性，如先进的访问控制列表 (ACL)和增强安全特性双介质上行链路端口提供了千兆以太网上行链路灵活性，可以使用铜缆或光纤上行链路端口—每个介质上行链路端口都有一个 10/100/1000以太网端口和一个小型可插拔(SFP)千兆以太网端口，在使用时其中一个端口激活，但不能同时使用这两个端口。通过高级QoS、精 确速率限制、ACL和组播服务，实现了网络控制和带宽优化。通过多种验证方法、数据加密技术和基于用户、端口和MAC地址的网络准入控制，实现了网络安全 性，通过思科网络助理，简化了网络配置、升级和故障诊断，使用Smartports自动配置特定应用</p><p>Cisco Catalyst 2960-24TT：24个10/100以太网端口和2个10/100/1000固定以太网上行链路端口；1机架单元(RU)</p><p>Cisco Catalyst 2960-48TT：48个10/100以太网端口和2个10/100/1000固定以太网上行链路端口；1 RU</p><p>Cisco Catalyst 2960-24TC：24个10/100以太网端口和2个双介质上行链路端口；1 RU</p><p>Cisco Catalyst 2960-48TC：48个10/100以太网端口和2个双介质上行链路端口；1 RU</p><p>Cisco Catalyst 2960G-24TC：20个10/100/1000以太网端口，其中4个为双介质端口；1 RU</p><p>CiscoCatalyst2960系列软件镜像提供了一系列丰富的智能服务，包括高级QoS、 速率限制和ACL。SFP千兆以太网端口可安装多种SFP收发器，包括Cisco1000BASE-SX、1000BASE-LX、1000BASE- BX、1000BASE-ZX、100BASE-FX、100BASE-LX10、100BASE-BX和粗波分多路复用 (CWDM) SFP收发器。</p><p>高级QoS:</p><p>提供了802.1p CoS和DSCP现场分类，可以利用源和目的地IP地址、源和目的地MAC地址或者第四层TCP/UDP端口号</p><p>进行基於单个分组的标记和重新分类。</p><p>所有端口上的思科控制平面和数据平面QoS ACL可以确保在单个分组的基础上进行正确的标记。每个端口的4个输出队列让用户可以对堆叠中最多四种流量类型进行不同的管理。</p><p>SRR调度确保了用户可以通过智能化地服务于输入和输出队列，为数据流量提供不同的优先级。加权队尾丢弃（WTD）可以在发生中断之前，为输入和输出队列提供拥塞避免功能。</p><p>严格优先级排序可以确保优先级最高的分组先于所有其他流量获得服务。</p><p>高度精确的QoS功能不会对性能造成任何影响。</p><p>精确的速率限制:</p><p>思科CIR功能能够以低达1Mbps的精确度保障带宽。</p><p>速率限制基于源和目的地IP地址、源和目的地MAC地址、第四层TCP/UDP信息或者这些字段的任意组合，并利用QoS 、ACL（IP ACL或者MAC ACL）、级别图和策略图提供。</p><p>利用输入策略控制和输出整形，可以方便地管理来自于基站或者上行链路的异步上行和下行数据流。 每个快速以太网或者千兆以太网端口最多可以支持64个汇总或者单独策略控制器。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'运维','师必备','交换'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>