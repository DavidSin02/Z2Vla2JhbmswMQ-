<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ç®¡ç† Vue åº”ç”¨ä¸­çš„å¼‚æ­¥è°ƒç”¨ vue-asyn-manager | æå®¢å¿«è¨Š</title><meta property="og:title" content="ç®¡ç† Vue åº”ç”¨ä¸­çš„å¼‚æ­¥è°ƒç”¨  vue-asyn-manager  - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/dfic-imagehandler/7837421e-5bde-40e0-bcc4-4bd94bb40374"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/365303e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/365303e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/365303e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/365303e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/365303e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/365303e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/365303e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/365303e.html><meta property="article:published_time" content="2020-10-29T20:59:17+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:17+08:00"><meta name=Keywords content><meta name=description content="ç®¡ç† Vue åº”ç”¨ä¸­çš„å¼‚æ­¥è°ƒç”¨  vue-asyn-manager"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/365303e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ç®¡ç† Vue åº”ç”¨ä¸­çš„å¼‚æ­¥è°ƒç”¨ vue-asyn-manager</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><h1><strong>ä½¿ç”¨ vue-asyn-manager ç®¡ç† Vue åº”ç”¨ä¸­çš„å¼‚æ­¥è°ƒç”¨</strong></h1><div class=pgc-img><img alt="ç®¡ç† Vue åº”ç”¨ä¸­çš„å¼‚æ­¥è°ƒç”¨  vue-asyn-manager" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/7837421e-5bde-40e0-bcc4-4bd94bb40374><p class=pgc-img-caption></p></div><p>ä¸çŸ¥é“å¤§å®¶å¯¹ React Suspense æ˜¯å¦æœ‰è¿‡å…³æ³¨ï¼Œä¹Ÿè®¸ Suspense è®©äººæ¯”è¾ƒæ¿€åŠ¨çš„æ˜¯åœ¨æœåŠ¡ç«¯çš„æµå¼æ¸²æŸ“ï¼Œç„¶è€Œä»ç›®å‰æ¥çœ‹ï¼ŒReact Suspense çš„åŠŸèƒ½å…¶å®å°±æ˜¯ä¸ª Loadableã€‚å½“ç„¶å•¦è¿™æ˜¯æˆ‘ä¸ªäººçš„çœ‹æ³•ï¼Œä¸è¿‡è¿™ä¸æ˜¯ä»Šå¤©çš„é‡ç‚¹ï¼Œä»Šå¤©çš„é‡ç‚¹æ˜¯ä»‹ç»å¦‚ä½•åœ¨ Vue åº”ç”¨ä¸­æ›´å¥½çš„ç®¡ç†å¼‚æ­¥è°ƒç”¨ï¼Œé‚£ä¸ºä»€ä¹ˆä¼šæ‰¯åˆ° React Suspense å‘¢ï¼Ÿå› ä¸º vue-async-manager çš„çµæ„Ÿæ¥è‡ªäº React Suspenseï¼Œå› æ­¤è®©æˆ‘ä»¬å¼€å§‹å§ã€‚</p><p>vue-async-manager æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼š</p><ul><li>https://shuidi-fed.github.io/vue-async-manager/</li></ul><h1>æŒ‡å—</h1><blockquote><p>åœ¨ Vue åº”ç”¨ä¸­æ›´è½»æ¾çš„ç®¡ç†å¼‚æ­¥è°ƒç”¨</p></blockquote><p>å¼‚æ­¥è°ƒç”¨æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>è¿™é‡Œæ‰€è¯´çš„å¼‚æ­¥è°ƒç”¨ï¼Œä¸»è¦æŒ‡çš„æ˜¯ä¸¤ä»¶äº‹å„¿ï¼š</p><ul><li>å¼‚æ­¥ç»„ä»¶(Async Component)çš„åŠ è½½</li><li>å‘é€å¼‚æ­¥è¯·æ±‚ä» API ä¸­è·å–æ•°æ®</li></ul><p>ç­‰å¾…å¼‚æ­¥ç»„ä»¶çš„åŠ è½½</p><p>å®é™…ä¸Š Vue çš„å¼‚æ­¥ç»„ä»¶å·²ç»æ”¯æŒåœ¨åŠ è½½è¿‡ç¨‹ä¸­å±•ç¤º loading ç»„ä»¶çš„åŠŸèƒ½ï¼Œå¦‚ä¸‹ä»£ç å–è‡ªå®˜ç½‘ï¼š</p><pre>new Vue({ // ... components: { 'my-component': () =&gt; ({ // å¼‚æ­¥ç»„ä»¶ component: import('./my-async-component'), // åŠ è½½å¼‚æ­¥ç»„ä»¶è¿‡ç¨‹ä¸­å±•ç¤ºçš„ loading ç»„ä»¶ loading: LoadingComponent, // loading ç»„ä»¶å±•ç¤ºçš„å»¶è¿Ÿæ—¶é—´ delay: 200 }) }})å¤åˆ¶ä»£ç </pre><p>:::tip delay ç”¨äºæŒ‡å®š loading ç»„ä»¶å±•ç¤ºçš„å»¶è¿Ÿæ—¶é—´ï¼Œå¦‚ä¸Šä»£ç ä¸­å»¶è¿Ÿæ—¶é—´ä¸º 200msï¼Œå¦‚æœå¼‚æ­¥ç»„ä»¶çš„åŠ è½½åœ¨ 200ms ä¹‹å†…å®Œæˆï¼Œåˆ™ loading ç»„ä»¶å°±æ²¡æœ‰å±•ç¤ºçš„æœºä¼šã€‚ :::</p><p>ä½†å®ƒå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>1ã€loading ç»„ä»¶ä¸å¼‚æ­¥ç»„ä»¶ç´§å¯†å…³è”ï¼Œæ— æ³•å°† loading ç»„ä»¶æå‡ï¼Œå¹¶ç”¨äºå¤šä¸ªå¼‚æ­¥ç»„ä»¶çš„åŠ è½½ã€‚</li><li>2ã€å¦‚æœå¼‚æ­¥ç»„ä»¶è‡ªèº«ä»æœ‰å¼‚æ­¥è°ƒç”¨ï¼Œä¾‹å¦‚è¯·æ±‚ APIï¼Œé‚£ä¹ˆ loading ç»„ä»¶æ˜¯ä¸ä¼šç­‰å¾… API è¯·æ±‚å®Œæˆä¹‹åæ‰éšè—çš„ã€‚</li></ul><p>vue-async-manager æä¾›äº† &lt;Suspense> ç»„ä»¶ï¼Œå¯ä»¥è§£å†³å¦‚ä¸Šä¸¤ä¸ªé—®é¢˜ã€‚</p><p>1ã€ä½¿ç”¨ lazy å‡½æ•°åˆ›å»ºå¼‚æ­¥ç»„ä»¶</p><p>è¿‡å»æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ç»„ä»¶çš„æ–¹å¼æ˜¯ï¼š</p><pre>const asyncComponent = () =&gt; import('./my-async.component.vue')å¤åˆ¶ä»£ç </pre><p>ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ vue-async-manager æä¾›çš„ lazy å‡½æ•°æ¥åˆ›å»ºå¼‚æ­¥ç»„ä»¶ï¼š</p><pre>import { lazy } from 'vue-async-manager' const asyncComponent = lazy(() =&gt; import('./my-async.component.vue'))å¤åˆ¶ä»£ç </pre><p>å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œä»…ä»…æ˜¯å°†åŸæ¥çš„å¼‚æ­¥å·¥å‚å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™ lazy å‡½æ•°å³å¯ã€‚</p><p>2ã€ä½¿ç”¨ &lt;Suspense> ç»„ä»¶åŒ…è£¹å¼‚æ­¥ç»„ä»¶</p><pre>&lt;template&gt; &lt;div id="app"&gt; &lt;!-- ä½¿ç”¨ Suspense ç»„ä»¶åŒ…è£¹å¯èƒ½å‡ºç°å¼‚æ­¥ç»„ä»¶çš„ç»„ä»¶æ ‘ --&gt; &lt;Suspense&gt; &lt;!-- å±•ç¤º loading --&gt; &lt;div slot="fallback"&gt;loading&lt;/div&gt; &lt;!-- å¼‚æ­¥ç»„ä»¶ --&gt; &lt;asyncComponent1/&gt; &lt;asyncComponent2/&gt; &lt;/Suspense&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt;// åˆ›å»ºå¼‚æ­¥ç»„ä»¶const asyncComponent1 = lazy(() =&gt; import('./my-async.component1.vue'))const asyncComponent2 = lazy(() =&gt; import('./my-async.component2.vue')) export default { name: 'App', components: { // æ³¨å†Œç»„ä»¶ asyncComponent1, asyncComponent2 }}&lt;/script&gt;å¤åˆ¶ä»£ç </pre><p>åªæœ‰å½“ &lt;asyncComponent1/> å’Œ &lt;asyncComponent2/> å…¨éƒ¨åŠ è½½å®Œæ¯•åï¼Œloading ç»„ä»¶æ‰ä¼šæ¶ˆå¤±ã€‚</p><div class=pgc-img><img alt="ç®¡ç† Vue åº”ç”¨ä¸­çš„å¼‚æ­¥è°ƒç”¨  vue-asyn-manager" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/e0f9f202-5848-411d-a36b-fd7db67d6447><p class=pgc-img-caption></p></div><p>:::tip Live Demo: ç­‰å¾…æ‰€æœ‰å¼‚æ­¥ç»„ä»¶åŠ è½½å®Œæ¯• :::</p><p>é…åˆ vue-router ä½¿ç”¨</p><p>æˆ‘ä»¬åœ¨å¼€å‘ Vue åº”ç”¨æ—¶ï¼Œæœ€å¸¸ä½¿ç”¨å¼‚æ­¥ç»„ä»¶çš„æ–¹å¼æ˜¯é…åˆ vue-router åšä»£ç æ‹†åˆ†ï¼Œä¾‹å¦‚ï¼š</p><pre>const router = new VueRouter({ routes: [ { path: '/', component: () =&gt; import('./my-async-component.vue') } ]})å¤åˆ¶ä»£ç </pre><p>ä¸ºäº†è®© &lt;Suspense> ç»„ä»¶ç­‰å¾…è¿™ä¸ªå¼‚æ­¥ç»„ä»¶çš„åŠ è½½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ lazy å‡½æ•°åŒ…è£¹è¿™ä¸ªå¼‚æ­¥ç»„ä»¶å·¥å‚å‡½æ•°ï¼š</p><pre>const router = new VueRouter({ routes: [ { path: '/', component: lazy(() =&gt; import('./my-async-component.vue')) } ]})å¤åˆ¶ä»£ç </pre><p>æœ€åæˆ‘ä»¬åªéœ€è¦ç”¨ &lt;Suspense> ç»„ä»¶åŒ…è£¹æ¸²æŸ“å‡ºå£(&lt;router-view>)å³å¯ï¼š</p><pre>&lt;Suspense :delay="200"&gt; &lt;div slot="fallback"&gt;loading&lt;/div&gt; &lt;!-- æ¸²æŸ“å‡ºå£ --&gt; &lt;router-view/&gt;&lt;/Suspense&gt;å¤åˆ¶ä»£ç </pre><p>:::tip Live Demo: é…åˆ vue-router :::</p><p>APIè¯·æ±‚ä¸­å¦‚ä½•å±•ç¤º loading</p><p>è¿‡å»ï¼Œå¤§å¤šæ˜¯æ‰‹åŠ¨ç»´æŠ¤ loading çš„å±•ç¤ºï¼Œä¾‹å¦‚â€œå¼€å§‹è¯·æ±‚â€æ—¶å±•ç¤º loadingï¼Œâ€œè¯·æ±‚ç»“æŸâ€åéšè— loadingã€‚è€Œä¸”å¦‚æœæœ‰å¤šä¸ªè¯·æ±‚å¹¶å‘æ—¶ï¼Œä½ å°±å¾—ç­‰å¾…æ‰€æœ‰è¯·æ±‚å…¨éƒ¨å®Œæˆåå†éšè— loadingã€‚æ€»ä¹‹ä½ éœ€è¦è‡ªå·±ç»´æŠ¤ loading çš„çŠ¶æ€ï¼Œæ— è®ºè¿™ä¸ªçŠ¶æ€æ˜¯å­˜å‚¨åœ¨ç»„ä»¶å†…ï¼Œè¿˜æ˜¯ store ä¸­ã€‚</p><p>ç°åœ¨æ¥çœ‹çœ‹ vue-async-manager æ˜¯å¦‚ä½•è§£å†³ API è¯·æ±‚è¿‡ç¨‹ä¸­ loading å±•ç¤ºé—®é¢˜çš„ï¼Œå‡è®¾æœ‰å¦‚ä¸‹ä»£ç ï¼š</p><pre>&lt;Suspense&gt; &lt;div slot="fallback"&gt;loading...&lt;/div&gt; &lt;MyComponent/&gt;&lt;/Suspense&gt;å¤åˆ¶ä»£ç </pre><p>åœ¨ &lt;Suspense> ç»„ä»¶å†…æ¸²æŸ“äº† &lt;MyComponent> ç»„ä»¶ï¼Œè¯¥ç»„ä»¶æ˜¯ä¸€ä¸ªæ™®æ™®é€šé€šçš„ç»„ä»¶ï¼Œåœ¨è¯¥ç»„ä»¶å†…éƒ¨ï¼Œä¼šå‘é€ API è¯·æ±‚ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><pre>&lt;!-- MyComponent.vue --&gt;&lt;template&gt; &lt;!-- å±•ç¤ºè¯·æ±‚å›æ¥çš„æ•°æ® --&gt; &lt;div&gt;{{ res }}&lt;/div&gt;&lt;/template&gt; &lt;script&gt;import { getAsyncData } from 'api' export default { data: { res: {} }, async created() { // å¼‚æ­¥è¯·æ±‚æ•°æ® this.res = await getAsyncData(id) }}&lt;/script&gt;å¤åˆ¶ä»£ç </pre><p>è¿™æ˜¯æˆ‘ä»¬å¸¸è§çš„ä»£ç ï¼Œé€šå¸¸åœ¨ created æˆ–è€… mounted é’©å­ä¸­å‘é€å¼‚æ­¥è¯·æ±‚è·å–æ•°æ®ï¼Œç„¶è€Œè¿™æ ·çš„ä»£ç å¯¹äº &lt;Suspense> ç»„ä»¶æ¥è¯´ï¼Œå®ƒå¹¶ä¸çŸ¥é“éœ€è¦ç­‰å¾…å¼‚æ­¥æ•°æ®è·å–å®Œæˆåå†éšè— loadingã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ vue-async-manager æä¾›çš„ createResource å‡½æ•°åˆ›å»ºä¸€ä¸ª<strong>èµ„æºç®¡ç†å™¨</strong>ï¼š</p><pre>&lt;template&gt; &lt;!-- å±•ç¤ºè¯·æ±‚å›æ¥çš„æ•°æ® --&gt; &lt;div&gt;{{ $rm.$result }}&lt;/div&gt;&lt;/template&gt; &lt;script&gt;import { getAsyncData } from 'api'import { createResource } from 'vue-async-manager' export default { created() { // åˆ›å»ºä¸€ä¸ªèµ„æºç®¡ç†å™¨ this.$rm = createResource((params) =&gt; getAsyncData(params)) // è¯»å–æ•°æ® this.$rm.read(params) }}&lt;/script&gt;å¤åˆ¶ä»£ç </pre><p>ä¸º createResource å‡½æ•°ä¼ é€’ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<strong>èµ„æºç®¡ç†å™¨</strong> $rmï¼Œæ¥ç€è°ƒç”¨èµ„æºç®¡ç†å™¨çš„ $rm.read() å‡½æ•°è¿›è¡Œè¯»å–æ•°æ®ã€‚å¤§å®¶æ³¨æ„ï¼Œä¸Šé¢çš„ä»£ç æ˜¯ä»¥åŒæ­¥çš„æ–¹å¼æ¥ç¼–å†™çš„ï¼Œå¹¶ä¸” &lt;Suspense> ç»„ä»¶èƒ½å¤ŸçŸ¥é“è¯¥ç»„ä»¶æ­£åœ¨è¿›è¡Œå¼‚æ­¥è°ƒç”¨ï¼Œå› æ­¤ &lt;Suspense> ç»„ä»¶å°†ç­‰å¾…è¯¥å¼‚æ­¥è°ƒç”¨ç»“æŸä¹‹åå†éšè— loadingã€‚</p><p>å¦å¤–æˆ‘ä»¬è§‚å¯Ÿå¦‚ä¸Šä»£ç ä¸­çš„æ¨¡æ¿éƒ¨åˆ†ï¼Œæˆ‘ä»¬å±•ç¤ºçš„æ•°æ®æ˜¯ $rm.$resultï¼Œå®é™…ä¸Šå¼‚æ­¥æ•°æ®è·å–æˆåŠŸä¹‹åï¼Œå¾—åˆ°çš„æ•°æ®ä¼šä¿å­˜åœ¨<strong>èµ„æºç®¡ç†å™¨</strong>çš„ $rm.$result å±æ€§ä¸Šï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥å±æ€§æœ¬èº«å°±æ˜¯å“åº”å¼çš„ï¼Œå› æ­¤ä½ æ— éœ€åœ¨ç»„ä»¶çš„ data ä¸­äº‹å…ˆå£°æ˜ã€‚</p><hr><p>:::tip Live Demo: Suspense ç»„ä»¶ç­‰å¾…èµ„æºç®¡ç†å™¨è·å–æ•°æ®å®Œæˆ :::</p><p>é…åˆ vuex</p><p>é…åˆ vuex å¾ˆç®€å•ï¼Œåªéœ€è¦ä½¿ç”¨ mapActions å°† actions æ˜ å°„ä¸ºæ–¹æ³•å³å¯ï¼š</p><pre>export default { name: "AsyncComponent", methods: { ...mapActions(['increase']) }, created() { this.$rm = createResource(() =&gt; this.increase()) this.$rm.read() }};å¤åˆ¶ä»£ç </pre><p>:::tip Live Demo: é…åˆ vuex :::</p><p>æ•è·ç»„ä»¶æ ‘ä¸­çš„æ‰€æœ‰å¼‚æ­¥è°ƒç”¨</p><p>&lt;Suspense> ç»„ä»¶ä¸ä»…èƒ½æ•è·å¼‚æ­¥ç»„ä»¶çš„åŠ è½½ï¼Œå¦‚æœè¯¥å¼‚æ­¥ç»„ä»¶è‡ªèº«è¿˜æœ‰å…¶ä»–çš„å¼‚æ­¥è°ƒç”¨ï¼Œä¾‹å¦‚é€šè¿‡<strong>èµ„æºç®¡ç†å™¨</strong>è·å–æ•°æ®ï¼Œé‚£ä¹ˆ &lt;Suspense> ç»„ä»¶ä¹Ÿèƒ½å¤Ÿæ•è·åˆ°è¿™äº›å¼‚æ­¥è°ƒç”¨ï¼Œå¹¶ç­‰å¾…æ‰€æœ‰å¼‚æ­¥è°ƒç”¨ç»“æŸä¹‹åæ‰éšè— loading çŠ¶æ€ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><pre>&lt;Suspense&gt; &lt;div slot="fallback"&gt;loading&lt;/div&gt; &lt;!-- MyLazyComponent æ˜¯é€šè¿‡ lazy å‡½æ•°åˆ›å»ºçš„ç»„ä»¶ --&gt; &lt;MyLazyComopnent/&gt;&lt;/Suspense&gt;å¤åˆ¶ä»£ç </pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ&lt;MyLazyComopnent/> ç»„ä»¶æ˜¯ä¸€ä¸ªé€šè¿‡ lazy å‡½æ•°åˆ›å»ºçš„ç»„ä»¶ï¼Œå› æ­¤ &lt;Suspense> ç»„ä»¶å¯ä»¥ç­‰å¾…è¯¥å¼‚æ­¥ç»„ä»¶çš„åŠ è½½ï¼Œç„¶è€Œå¼‚æ­¥ç»„ä»¶è‡ªèº«åˆé€šè¿‡<strong>èµ„æºç®¡ç†å™¨</strong>è·å–æ•°æ®ï¼š</p><pre>// å¼‚æ­¥ç»„ä»¶export default { created() { // åˆ›å»ºä¸€ä¸ªèµ„æºç®¡ç†å™¨ this.$rm = createResource((params) =&gt; getAsyncData(params)) this.$rm.read(params) }}å¤åˆ¶ä»£ç </pre><p>è¿™æ—¶å€™ï¼Œ&lt;Suspense> ç»„ä»¶ä¼šç­‰å¾…ä¸¤ä¸ªå¼‚æ­¥è°ƒç”¨å…¨éƒ¨ç»“æŸä¹‹åæ‰éšè— loadingï¼Œè¿™ä¸¤ä¸ªå¼‚æ­¥è°ƒç”¨åˆ†åˆ«æ˜¯ï¼š</p><ul><li>1ã€å¼‚æ­¥ç»„ä»¶çš„åŠ è½½</li><li>2ã€å¼‚æ­¥ç»„ä»¶å†…éƒ¨é€šè¿‡<strong>èµ„æºç®¡ç†å™¨</strong>å‘å‡ºçš„å¼‚æ­¥è¯·æ±‚</li></ul><p>:::tip è¿™ä¸ª Demo ä¹Ÿå±•ç¤ºäº†å¦‚ä¸Šæè¿°çš„åŠŸèƒ½ï¼š</p><p>Live Demo: Suspense ç»„ä»¶ç­‰å¾…èµ„æºç®¡ç†å™¨è·å–æ•°æ®å®Œæˆ :::</p><p>èµ„æºç®¡ç†å™¨</p><p>å‰é¢æˆ‘ä»¬ä¸€ç›´åœ¨å¼ºè°ƒä¸€ä¸ªè¯ï¼š<strong>èµ„æºç®¡ç†å™¨</strong>ï¼Œæˆ‘ä»¬æŠŠé€šè¿‡ createResource() å‡½æ•°åˆ›å»ºçš„å¯¹è±¡ç§°ä¸º<strong>èµ„æºç®¡ç†å™¨(Resource Manager)</strong>ï¼Œå› æ­¤æˆ‘ä»¬çº¦å®šä½¿ç”¨åç§° $rm æ¥å­˜å‚¨ createResource() å‡½æ•°çš„è¿”å›å€¼ã€‚</p><p>èµ„æºç®¡ç†å™¨çš„å®Œæ•´å½¢æ€å¦‚ä¸‹ï¼š</p><pre>this.$rm = createResource(() =&gt; getAsyncData())this.$rm = { read(){}, // ä¸€ä¸ªå‡½æ•°ï¼Œè°ƒç”¨è¯¥å‡½æ•°ä¼šçœŸæ­£å‘é€å¼‚æ­¥è¯·æ±‚è·å–æ•°æ® $result, // åˆå§‹å€¼ä¸º nullï¼Œå¼‚æ­¥æ•°æ®è¯·æ±‚æˆåŠŸåï¼Œä¿å­˜ç€å–å¾—çš„æ•°æ® $error, // åˆå§‹å€¼ä¸º nullï¼Œå½“å¼‚æ­¥è¯·æ±‚å‡ºé”™æ—¶ï¼Œå…¶ä¿å­˜ç€ err æ•°æ® $loading, // ä¸€ä¸ªbooleanå€¼ï¼Œåˆå§‹å€¼ä¸º falseï¼Œä»£è¡¨ç€æ˜¯å¦æ­£åœ¨è¯·æ±‚ä¸­ fork() // æ ¹æ®å·²æœ‰èµ„æºç®¡ç†å™¨ fork ä¸€ä¸ªæ–°çš„èµ„æºç®¡ç†å™¨}å¤åˆ¶ä»£ç </pre><p>å…¶ä¸­ $rm.read() å‡½æ•°ç”¨æ¥å‘é€å¼‚æ­¥è¯·æ±‚è·å–æ•°æ®ï¼Œå¯å¤šæ¬¡è°ƒç”¨ï¼Œä¾‹å¦‚ç‚¹å‡»æŒ‰é’®å†æ¬¡è°ƒç”¨å…¶è·å–æ•°æ®ã€‚$rm.$result æˆ‘ä»¬ä¹Ÿå·²ç»è§è¿‡äº†ï¼Œç”¨æ¥å­˜å‚¨å¼‚æ­¥è·å–æ¥çš„æ•°æ®ã€‚$rm.$loading æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œä»£è¡¨ç€è¯·æ±‚æ˜¯å¦æ­£åœ¨è¿›è¡Œä¸­ï¼Œé€šå¸¸æˆ‘ä»¬å¯ä»¥åƒå¦‚ä¸‹è¿™æ ·è‡ªå®šä¹‰ loading å±•ç¤ºï¼š</p><pre>&lt;template&gt; &lt;!-- æ§åˆ¶ loading çš„å±•ç¤º --&gt; &lt;MyButton :loading="$rm.$loading" @click="submit" &gt;æäº¤&lt;/MyButton&gt;&lt;/template&gt; &lt;script&gt;import { getAsyncData } from 'api'import { createResource } from 'vue-async-manager' export default { created() { // åˆ›å»ºä¸€ä¸ªèµ„æºç®¡ç†å™¨ this.$rm = createResource((id) =&gt; getAsyncData(id)) }, methods: { submit() { this.$rm.read(id) } }}&lt;/script&gt;å¤åˆ¶ä»£ç </pre><p>:::tip æ›´é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼š<strong>èµ„æºç®¡ç†å™¨å¯ä»¥è„±ç¦» &lt;Suspense> å•ç‹¬ä½¿ç”¨ã€‚</strong> :::</p><p>å¦‚æœèµ„æºç®¡ç†å™¨åœ¨è¯·æ±‚æ•°æ®çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ï¼Œåˆ™é”™è¯¯æ•°æ®ä¼šä¿å­˜åœ¨ $rm.$error å±æ€§ä¸­ã€‚$rm.fork() å‡½æ•°ç”¨æ¥æ ¹æ®å·²æœ‰<strong>èµ„æºç®¡ç†å™¨</strong>åˆ›å»ºä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„èµ„æºç®¡ç†å™¨å‡ºæ¥ã€‚</p><p>fork ä¸€ä¸ªèµ„æºç®¡ç†å™¨</p><p>å½“ä¸€ä¸ª API ç”¨æ¥è·å–æ•°æ®ï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦å¹¶å‘çš„è·å–ä¸¤æ¬¡æ•°æ®ï¼Œé‚£ä¹ˆåªéœ€è¦è°ƒç”¨ä¸¤æ¬¡ $rm.read() å³å¯ï¼š</p><pre>&lt;script&gt;import { getAsyncData } from 'api'import { createResource } from 'vue-async-manager' export default { created() { // åˆ›å»ºä¸€ä¸ªèµ„æºç®¡ç†å™¨ this.$rm = createResource((type) =&gt; getAsyncData(type))  // è¿ç»­è·å–ä¸¤æ¬¡æ•°æ® this.$rm.read('top') this.$rm.read('bottom') }}&lt;/script&gt;å¤åˆ¶ä»£ç </pre><p>ä½†æ˜¯è¿™ä¹ˆåšä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œç”±äºä¸€ä¸ª<strong>èµ„æºç®¡ç†å™¨</strong>å¯¹åº”ä¸€ä¸ª $rm.$resultï¼Œå®ƒåªç»´æŠ¤ä¸€ä»½è¯·æ±‚å›æ¥çš„æ•°æ®ä»¥åŠ loading çŠ¶æ€ï¼Œå› æ­¤å¦‚ä¸Šä»£ç ä¸­ï¼Œ$rm.$result æœ€ç»ˆåªä¼šä¿å­˜ $rm.read('bottom') çš„æ•°æ®ã€‚å½“ç„¶äº†ï¼Œæœ‰æ—¶å€™è¿™æ˜¯ç¬¦åˆéœ€æ±‚çš„ï¼Œä½†å¦‚æœéœ€è¦ä¿å­˜ä¸¤æ¬¡è°ƒç”¨çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±éœ€è¦ fork å‡ºä¸€ä¸ªæ–°çš„èµ„æºç®¡ç†å™¨ï¼š</p><pre>&lt;script&gt;import { getAsyncData } from 'api'import { createResource } from 'vue-async-manager' export default { created() { // åˆ›å»ºä¸€ä¸ªèµ„æºç®¡ç†å™¨ this.$rm = createResource((type) =&gt; getAsyncData(type)) this.$rm2 = this.$rm.fork()  // è¿ç»­è·å–ä¸¤æ¬¡æ•°æ® this.$rm.read('top') this.$rm2.read('bottom') }}&lt;/script&gt;å¤åˆ¶ä»£ç </pre><p>è¿™æ ·ï¼Œç”±äº $rm ä¸ $rm2 æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„èµ„æºç®¡ç†å™¨ï¼Œå› æ­¤å®ƒä»¬äº’ä¸å½±å“ã€‚</p><p>prevent é€‰é¡¹ä¸é˜²æ­¢é‡å¤æäº¤</p><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨æäº¤è¡¨å•ï¼Œå¦‚æœç”¨æˆ·è¿ç»­ä¸¤æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œå°±ä¼šé€ æˆé‡å¤æäº¤ï¼Œå¦‚ä¸‹ä¾‹å­ï¼š</p><pre>&lt;template&gt; &lt;button @click="submit"&gt;æäº¤&lt;/button&gt;&lt;/template&gt;&lt;script&gt;import { getAsyncData } from 'api'import { createResource } from 'vue-async-manager' export default { created() { // åˆ›å»ºä¸€ä¸ªèµ„æºç®¡ç†å™¨ this.$rm = createResource((type) =&gt; getAsyncData(type)) }, methods: { submit() { this.$rm.read(data) } }}&lt;/script&gt;å¤åˆ¶ä»£ç </pre><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºèµ„æºç®¡ç†å™¨çš„æ—¶å€™æä¾› prevent é€‰é¡¹ï¼Œè¿™æ ·åˆ›å»ºå‡ºæ¥çš„èµ„æºç®¡ç†å™¨å°†è‡ªåŠ¨ä¸ºæˆ‘ä»¬é˜²æ­¢é‡å¤æäº¤ï¼š</p><pre>&lt;template&gt; &lt;button @click="submit"&gt;æäº¤&lt;/button&gt;&lt;/template&gt;&lt;script&gt;import { getAsyncData } from 'api'import { createResource } from 'vue-async-manager' export default { created() { // åˆ›å»ºä¸€ä¸ªèµ„æºç®¡ç†å™¨ this.$rm = createResource((type) =&gt; getAsyncData(type), { prevent: true }) }, methods: { submit() { this.$rm.read(data) } }}&lt;/script&gt;å¤åˆ¶ä»£ç </pre><p>å½“ç¬¬ä¸€æ¬¡ç‚¹å‡»æŒ‰é’®æ—¶ä¼šå‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œåœ¨è¿™ä¸ªè¯·æ±‚å®Œæˆä¹‹å‰ï¼Œå°†ä¸ä¼šå†æ¬¡å‘é€ä¸‹ä¸€æ¬¡è¯·æ±‚ã€‚ç›´åˆ°ä¸Šä¸€æ¬¡è¯·æ±‚å®Œæˆä¹‹åï¼Œ$rm.read() å‡½æ•°æ‰ä¼šå†æ¬¡å‘é€è¯·æ±‚ã€‚</p><p>loading çš„å±•ç¤ºå½¢æ€</p><p>loading çš„å±•ç¤ºå½¢æ€å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šä¸€ç§æ˜¯åªå±•ç¤º loadingï¼Œä¸å±•ç¤ºå…¶ä»–å†…å®¹ï¼›å¦ä¸€ç§æ˜¯æ­£å¸¸æ¸²æŸ“å…¶ä»–å†…å®¹çš„åŒæ—¶å±•ç¤º loadingï¼Œæ¯”å¦‚é¡µé¢é¡¶éƒ¨æœ‰ä¸€ä¸ªé•¿é•¿çš„åŠ è½½æ¡ï¼Œè¿™ä¸ªåŠ è½½æ¡ä¸å½±å“å…¶ä»–å†…å®¹çš„æ­£å¸¸æ¸²æŸ“ã€‚</p><p>å› æ­¤ vue-async-manager æä¾›äº†ä¸¤ç§æ¸²æŸ“æ¨¡å¼ï¼š</p><pre>import VueAsyncManager from 'vue-async-manager'Vue.use(VueAsyncManager, { mode: 'visible' // æŒ‡å®šæ¸²æŸ“æ¨¡å¼ï¼Œå¯é€‰å€¼ä¸º 'visible' | 'hidden'ï¼Œé»˜è®¤å€¼ä¸ºï¼š'visible'})å¤åˆ¶ä»£ç </pre><p>é»˜è®¤æƒ…å†µä¸‹é‡‡ç”¨ 'visible' çš„æ¸²æŸ“æ¨¡å¼ï¼Œæ„å‘³ç€ loading çš„å±•ç¤ºå¯ä»¥ä¸å…¶ä»–å†…å®¹å…±å­˜ï¼Œå¦‚æœä½ ä¸æƒ³è¦è¿™ç§æ¸²æŸ“æ¨¡å¼ï¼Œä½ å¯ä»¥æŒ‡å®š mode ä¸º 'hidden'ã€‚</p><p>å¦å¤–ä»¥ä¸Šä»‹ç»çš„å†…å®¹éƒ½æ˜¯ç”± &lt;Suspense> ç»„ä»¶æ¥æ§åˆ¶ loading çš„å±•ç¤ºï¼Œå¹¶ä¸” loading çš„å†…å®¹ç”± &lt;Suspense> ç»„ä»¶çš„ fallback æ’æ§½å†³å®šã€‚ä½†æœ‰çš„æ—¶å€™æˆ‘ä»¬å¸Œæœ›æ›´åŠ çµæ´»ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°è¿™æ ·çš„åœºæ™¯ï¼šç‚¹å‡»æŒ‰é’®çš„åŒæ—¶åœ¨æŒ‰é’®ä¸Šå±•ç¤ºä¸€ä¸ªå¾®å°çš„ loading çŠ¶æ€ï¼Œæˆ‘ä»¬çš„ä»£ç çœ‹ä¸Šå»å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p><pre>&lt;MyButton :loading="isLoading" &gt;æäº¤&lt;/MyButton&gt;å¤åˆ¶ä»£ç </pre><p>loading çš„å½¢æ€ç”± &lt;MyButton> ç»„ä»¶æä¾›ï¼Œæ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬æŠ›å¼ƒäº† &lt;Suspense> çš„ fallback æ’æ§½ä½œä¸º loading æ¥å±•ç¤ºã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ‰‹æ®µæ¥å¾—çŸ¥å½“å‰æ˜¯å¦å¤„äºæ­£åœ¨åŠ è½½çš„çŠ¶æ€ï¼Œåœ¨ä¸Šé¢æˆ‘ä»¬å·²ç»ä»‹ç»äº†è¯¥é—®é¢˜çš„è§£å†³åŠæ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨èµ„æºç®¡ç†å™¨çš„ $rm.$loading å±æ€§ï¼š</p><pre>&lt;MyButton :loading="$rm.$loading" &gt;æäº¤&lt;/MyButton&gt;å¤åˆ¶ä»£ç </pre><p>é”™è¯¯å¤„ç†</p><p>å½“ lazy ç»„ä»¶åŠ è½½å¤±è´¥ä¼šå±•ç¤º &lt;Suspense> ç»„ä»¶çš„ error æ’æ§½ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ç›‘å¬ &lt;Suspense> çš„ rejected äº‹ä»¶æ¥è‡ªå®šä¹‰é”™è¯¯å¤„ç†ã€‚</p><p>:::tip Live Demo: åŠ è½½å¤±è´¥å±•ç¤º error æ’æ§½ :::</p><p>å½“é”™è¯¯å‘ç”Ÿæ—¶é™¤äº†å±•ç¤º error æ’æ§½ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡ç›‘å¬ &lt;Suspense> ç»„ä»¶çš„ rejected äº‹ä»¶æ¥è‡ªå®šä¹‰å¤„ç†ï¼š</p><pre>&lt;template&gt; &lt;Suspense :delay="200" @rejected="handleError"&gt; &lt;p class="fallback" slot="fallback"&gt;loading&lt;/p&gt; &lt;AsyncComponent/&gt; &lt;/Suspense&gt;&lt;/template&gt;&lt;script&gt;export default { // ...... methods: { handleError() { // Custom behavior } }};&lt;/script&gt;å¤åˆ¶ä»£ç </pre><div class=pgc-img><img alt="ç®¡ç† Vue åº”ç”¨ä¸­çš„å¼‚æ­¥è°ƒç”¨  vue-asyn-manager" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/989fa71e-f05e-4a87-9e09-b1da24542257><p class=pgc-img-caption></p></div><p>:::tip Live Demo: é€šè¿‡äº‹ä»¶å¤„ç† error :::</p><p>å…³äº LRU ç¼“å­˜</p><p>React Cache ä½¿ç”¨ LRU ç®—æ³•ç¼“å­˜èµ„æºï¼Œè¿™è¦æ±‚ API å…·æœ‰å¹‚ç­‰æ€§ï¼Œç„¶è€Œåœ¨æˆ‘çš„å·¥ä½œç¯å¢ƒä¸­ï¼Œåœ¨ç»™å®šæ—¶é—´å‘¨æœŸå†…çœŸæ­£å¹‚ç­‰çš„ API å¾ˆå°‘ï¼Œå› æ­¤æš‚æ—¶æ²¡æœ‰æä¾›å¯¹ç¼“å­˜èµ„æºçš„èƒ½åŠ›ã€‚</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Vue','åº”ç”¨','å¼‚æ­¥'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>