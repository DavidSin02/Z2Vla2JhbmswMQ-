<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>自动驾驶研发中的软件架构问题 | 极客快訊</title><meta property="og:title" content="自动驾驶研发中的软件架构问题 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/fb53fc5aead048d7a2d3425aa66b729f"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/37b9dfe.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/37b9dfe.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/37b9dfe.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/37b9dfe.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/37b9dfe.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/37b9dfe.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/37b9dfe.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/37b9dfe.html><meta property="article:published_time" content="2020-10-29T20:52:47+08:00"><meta property="article:modified_time" content="2020-10-29T20:52:47+08:00"><meta name=Keywords content><meta name=description content="自动驾驶研发中的软件架构问题"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/37b9dfe.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>自动驾驶研发中的软件架构问题</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><strong>来源：知乎</strong></p><p><strong><br></strong></p><h1 class=pgc-h-arrow-right><strong>SW Architecture</strong></h1><p>软件架构（SA，software architecture）是上世纪90年代提出的，它对复杂的软件系统进行结构化，并给出其高级的系统描述。</p><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fb53fc5aead048d7a2d3425aa66b729f><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right><strong>AUTOSAR</strong></h1><p>以<strong>宝马汽车</strong>为首的几家OEM与一些<strong>Tier-1</strong>成立</p><p>AUTOSAR（AUTomotive Open System ARchitecture）联盟，是想为汽车工业开发一套支持分布式的、功能驱动的汽车电子软件开发的<strong>架构标准化方案</strong>。</p><p>基础软件层则被抽象为四级（如图）：</p><ul><li>1. 服务层（Services Layer）</li><li>2. ECU抽象层（ECU Abstraction Layer）</li><li>3. 微控制器抽象层（Microcontroller Abstraction Layer）</li><li>4. 复杂设备驱动（Complex Device Drivers）<br></li></ul><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6a65c85092ca473da7f5924766b81f49><p class=pgc-img-caption></p></div><p><br></p><p>AUTOSAR提供了一个三层的软件结构：</p><ul><li>1. 基础软件层 (BSW)：标准化的软件模块，没有任何功能任务，只提供运行上层功能部分的必要服务；</li><li>2. 运行环境(RTE)：中间件，从网络拓扑提取出来的，支持在应用软件部件之间或者应用软件部件与基础软件层之间ECU内部/之间的信息交换。</li><li>3. 应用层：应用软件部件，和RTE进行交互。</li></ul><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0cb0101f672e484f814cf8f60bf81193><p class=pgc-img-caption></p></div><p><br></p><p><strong>Adaptive AUTOSAR</strong></p><p>Adaptive AUTOSAR是一种ARA（AUTOSAR Runtime for Adaptive Applications)的标准化接口，如图所示。它包括两个部分：操作系统功能的接口和通信中间件，后者处理Adaptive AUTOSAR服务和各种本地/远程应用之间的数据交换。这些接口允许OEM实现自动驾驶，在线OTA （over-the-air）软件升级，物联网（IOT， Internet of Things），流媒体等服务。</p><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4b3721aaca0a4661b17657d5e3a3e37b><p class=pgc-img-caption></p></div><p><br></p><p>与经典AUTOSAR相比，这种自适应平台可以在ECU运行时实现服务-客户的动态链接，为此需要提供交通基础设施，云服务器，微处理器（如ARM）和HPC（GPU）硬件等。</p><p>执行管理（Execution Management）功能群负责ECU的启动和停止，并保持应用程序状态。和平台健康管理（Platform Health Management）一起，为那些启动降解（degradation）或者类似策略的应用程序维护必要的资源，这样ECU可根据定义好的策略在危机时刻作出反应。</p><p>通信中间件实现在本地应用程序之间以及本地应用程序和其他ECU中应用程序之间的服务定向通信，这个包括了AUTOSAR Adaptive 的服务接口。</p><h1 class=pgc-h-arrow-right><strong>ASAM (Association for Standardization of Automation and Measuring Systems)</strong></h1><p><strong>。。。。。。</strong></p><h1 class=pgc-h-arrow-right><strong>V-Model for Autonomous Driving software</strong></h1><p>如图是软件开发V-模型的流程图：汽车界已经采用这种软件开发模型很久了，也是工业标准MISRA（The Motor Industry Software Reliability Association）C编程规范的参考模型（有20年的历史），同时也是构建ISO 26262标准的参考模型。</p><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/abe64ae379044779b20de5db99e0bbb8><p class=pgc-img-caption></p></div><p><br></p><p>V-模型代表了一种软件构建加上可追溯性的验证（traceability & verification/validation）的条理化进程；V-模型的左侧是从需求-设计-实现的途径，而其中的每一步，可以分成多个子系统，彼此并行地看待（系统需求只有一组，但每个子系统可以有不同的设计）；V-模型的右侧是从小组件到系统级别的评估，迭代地可追溯性验证（trace & verify/validate）越来越大的系统部分。</p><p>根据V-模型看，自动驾驶的测试存在一些挑战性情况：</p><ul><li>1. 驾驶员不在环情况；</li><li>2. 过于复杂的需求；</li><li>3. 采用了非确定性算法；</li><li>4. 采用了归纳学习算法；</li><li>5. 需要故障-安全/-可操作的实现。</li></ul><p>解决这些问题，大家提出的一些可用方法包括：</p><ul><li>1. 通过依次松弛的操作场景的分阶段部署法；</li><li>2. 采用一种“监控-驱动”结构，将最复杂的自主功能和较为简单的安全功能分开；</li><li>3. 故障注入以得到更有效的边界情况（edge case）测试 。</li></ul><h1 class=pgc-h-arrow-right>aSPICE</h1><p>在汽车行业有两个公认的软件设计流程标准，一个是aSPICE（Automotive Software Performance Improvement and Capability dEtermination），另一个是ISO 26262的软件部分。</p><p>下图是aSPICE的流程图。aSPICE源自一般SPICE（ISO/IEC 15504）标准，它仍然建立在V-模型之上，这意味着从需求到源代码的每个过程都有相应的测试。按照“V-模型”，其左侧的开发过程如下：</p><ul><li>1) 客户的要求；</li><li>2) 将其映射到系统要求；</li><li>3) 将需求分解为逻辑服务，这包括设计决策；</li><li>4) 对于每个软件服务，从系统要求中获取软件要求；</li><li>5) 将软件需求细分为单元，管理可用资源（内存，CPU时间等）；</li><li>6) 设计并实施每个软件单元。</li></ul><p>它右侧的相应测试过程如下：</p><ul><li>1) 设计的单元测试；代码是否符合设计？是否满足了非功能性要求（如不崩溃）？</li><li>2) 软件架构的集成测试；作为服务的单位组成是否仍然有效？</li><li>3) 软件认证测试软件要求；服务是否符合其要求？</li><li>4) 系统集成测试系统架构；将所有服务组合到整个系统中，它是否有效？</li><li>5) 系统认证测试系统要求；整个系统/汽车是否符合要求？</li><li>6) 验收测试由客户完成。</li></ul><p>除了这些流程外，aSPICE还要支持和管理整个流程，包括存档和制定计划等内容。使用ASPICE可实现敏捷开发，灵活的方法会从少的要求开始，但仍执行整个V-模型过程。</p><p>ASPICE评估导致从“未实现”（N）到“完全实现”（F）0-5级的评级：</p><ul><li>a) 0级：流程最多可以“部分”（P）实现ASPICE定义的工作产品（源代码，需求，体系结构描述，测试报告等）。</li><li>b) 1级：“很大程度上”（L）能够生产指定的工作产品。</li><li>c) 2级：完全有能力生产工作产品，并且可以通过实现目标，检查进度以及在错过目标时作出反应。</li><li>d) 3级：拥有中央标准，而这些都要在工作和项目中遵循。</li><li>e) 4-5级：实际上不重要，目标是建立组织流程，更“可预测”和“创新”。</li></ul><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2ef2103066bd405097a30be789e1eabe><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right><strong>ISO 26262 SOFTWARE DEVELOPMENT PROCESS IN VEHICLE</strong></h1><p>ISO 26262（Part 6）依照V-模型也给出了一个修正的软件开发流程图如下：</p><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/741b709e8b0d45f0a3299436521805cb><p class=pgc-img-caption></p></div><p><br></p><p>这个文档规定了汽车应用软件级产品开发的要求，包括：</p><ul><li>- 软件级产品开发的一般主题;</li><li>- 软件安全要求的规范;</li><li>- 软件架构设计;</li><li>- 软件单元设计和实现;</li><li>- 软件单元验证;</li><li>- 软件集成和验证;和</li><li>- 测试嵌入式软件。</li></ul><p>它还规定了与使用可配置软件相关的要求。</p><p>重点的是有关软件架构设计的一些表格，比如如下的表1和表2：</p><p>表 1 ISO 26262 软件架构设计准则</p><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/939ef6cda4254cd8a8464d4307094cea><p class=pgc-img-caption></p></div><p><br></p><p>表2 ISO 26262 软件架构级别的误差检测机制</p><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a24aa26ebd07474696e5206e5ce4b643><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right><strong>42010-2011 - ISO/IEC/IEEE Systems and software engineering -- Architecture description</strong></h1><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/47b4ef20d4ab4e0eb5e82b3336ee30d6><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right><strong>ISO 26262 SW Configuration and Packaging Process</strong></h1><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/45922d4b0bd242e6bcefaba2470d7efb><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right><strong>EB SW Architecture for Autonomous Driving</strong></h1><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/d9da704056544458946a4447b06f5644><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right><strong>ADTF (Automotive Data and Time-Triggered Framework)</strong></h1><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/241cebb5e24c40d6b7ccffc6d8e45a28><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right><strong>Electronics Architecture and Software Technology - Architecture Description Language (EAST-ADL)</strong></h1><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9445e196932040d58d7166a78c2b5413><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right><strong>Nvidia Driveworks</strong></h1><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8514e376a65a48da85741cfce5647048><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right><strong>车载操作系统</strong></h1><p>车载操作系统必然是实时操作系统（real time operating system，RTOS），特别是对自动驾驶的支持（其他方面还有车载娱乐，车联网和中控显示屏）。</p><p>RTOS是旨在为实时处理数据的应用程序提供服务而且通常没有缓冲区延迟的操作系统。处理时间要求（包括任何OS延迟）0.1秒或更短的时间。</p><p>实时系统要求处理必须在规定的时间内完成，否则系统将失败。它们要么是事件驱动的，要么是分时的。事件驱动系统根据优先级在任务之间切换，而时间共享系统根据时钟中断切换任务。大多数RTOS使用先发制人的调度算法。</p><p>RTOS具有用于调度（scheduling）的高级算法，调度器的灵活性可实现更广泛的流程优先级编排（orchestration）。实时操作系统的关键因素是最小的中断延迟和最小的线程切换延迟;实时操作系统的重要性在于响应速度，而不是执行的工作量。</p><h1 class=pgc-h-arrow-right><strong>ROS</strong></h1><p>Robot Operating System (ROS) 是在机器人领域一个成熟和灵活的控制编程框架。整个ROS系统可以是分布式计算结构，即各个计算机执行控制过程中的各个部分，但作为一个实体（entity)即机器人在行动。</p><p>ROS系统是适合自动驾驶汽车的，原因是已经有大量的相关开源代码，可视化工具齐全，所以容易在ROS环境中开启一个自动驾驶项目。ROS存在的缺点是：</p><ul><li>1. 单点失败. 所有ROS应用，完全依赖于一个软件组件roscore，处理ROS不同部分之间的所有协调。</li><li>2.不安全性. 目前ROS不支持阻止第三方进入ROS网络的安全机制，也不读取节点之间的通信。</li></ul><p>如图给出ROS的工作方式，整个系统由一些节点组成，而一个节点通过发布/订阅（publicate/subscribe）的方式与其他节点进行通信。比如，图中一个传感器作为ROS的一个节点，它可以以信息流的方式发布其获得的信息，发布的信息可以被其他节点如感知，规划或者控制单元获得。</p><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e24b5db94932451eb3da10cc0f0350c7><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/727daa2972eb4bbd98f41dec36033e76><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right><strong>BlackBerry QNX Neutrino Realtime OS</strong></h1><p>QNX Neutrino是商业实时操作系统，开发该系统的公司已被手机公司黑莓并购。QNX采用微核设计和模块化架构，如图是QNX的结构图。</p><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0e98c58beee0443fb057fada9fd3ad1f><p class=pgc-img-caption></p></div><p><br></p><p>QNX Neutrino实时操作系统实现了应用级的高效性能和确定性响应时间。采用线程优先级继承消除了优先级反转（priority inversion）问题。</p><p>此外，QNX Neutrino支持在虚拟环境下的多核方案，比如Symmetric multiprocessing (SMP)，Asymmetric multiprocessing (AMP)，Bound multiprocessing (BMP)，具有固有的可扩展性。</p><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0e468d36273c4c83ad419759f568a5a7><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right><strong>PolySync</strong></h1><p>PolySync Core是一个自主操作系统，由中间件（middleware）和一组很常见的自动驾驶应用软件API服务（传感器融合、车辆控制和路径规划等）组成。通过将应用层与操作系统和硬件分离，PolySync Core具有一致性和可移植性，可构建自动驾驶应用程序。如图是PolySync结构图，可以看到支持的传感器有激光雷达、雷达、摄像头和超声波雷达。</p><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/3352b47a089746f88a01670e2a9a4de5><p class=pgc-img-caption></p></div><p><br></p><p>在PolySync，有一个底层控制子平台，叫开源车辆控制（Open Source Car Control，OSCC），是软硬件设计的集合体。它可以对汽车进行计算机控制，以推动自动驾驶汽车技术的发展。</p><p>OSCC能够向车辆发送控制命令，从车辆的CAN总线读取控制消息，并转发当前车辆控制状态的报告，如转向角和车速。通过各种传感器，如方向盘的扭矩传感器（torque sensor）、节气门（throttle）的位置传感器和刹车（brake）的位置传感器，OSCC给车辆各部件的ECU能够 n发出控制命令。</p><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0566338681d34076812b4aed72c9f724><p class=pgc-img-caption></p></div><p><br></p><hr><p><strong>“Treat autonomous navigation as a software problem”</strong></p><p><strong>Stanley from Stanford U. 2005</strong></p><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3bb1a979be4f4e8c836cbcf9af9c0566><p class=pgc-img-caption></p></div><p><br></p><p><strong>Junior from Stanford U. 2007</strong></p><p><br></p><div class=pgc-img><img alt=自动驾驶研发中的软件架构问题 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/691441611086409bb3ae4d94d33c0853><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'自动','驾驶','研发'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>