<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>常用网络连通性测试工具（上） | 极客快訊</title><meta property="og:title" content="常用网络连通性测试工具（上） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/ce7d050d685944e3a977a41d4520d20e"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3920fedb.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3920fedb.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3920fedb.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3920fedb.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3920fedb.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3920fedb.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3920fedb.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3920fedb.html><meta property="article:published_time" content="2020-11-14T21:02:20+08:00"><meta property="article:modified_time" content="2020-11-14T21:02:20+08:00"><meta name=Keywords content><meta name=description content="常用网络连通性测试工具（上）"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/3920fedb.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>常用网络连通性测试工具（上）</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ce7d050d685944e3a977a41d4520d20e><p class=pgc-img-caption></p></div><p><strong><span style="color:#b83232;--tt-darkmode-color: #B83232">阅读本文约需要10分钟，您可以先关注我们，避免下次无法找到。</span></strong></p><h1 class=pgc-h-arrow-right>01 前言</h1><p>不管你是敲代码的，搞运维的，玩管理项目的，就算你只是想在家上个网，你都可能会用到成哥总结的网络连通性工具。</p><p>成哥打算用上下两篇文章把下图总结的工具给大家讲透。</p><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a0c452f43a51449a82dcfea4852838b8><p class=pgc-img-caption></p></div><p>上篇给大家讲讲ICMP和TCP层面的网络连通性测试工具。</p><h1 class=pgc-h-arrow-right>02 ICMP</h1><p>ICMP（Internet Control Message Protocol）是IP层的一个组成部分，用于传递差错报文以及其它差错信息。说的简单点，ICMP协议就是用来确认网络是否正常，以及出现异常时进行问题诊断。</p><p><strong>PING和traceroute是ICMP协议的经典实用场景。</strong></p><p>ICMP报文格式很简单，ICMP所有报文的前4个字节都是一样的。格式如下图所示：</p><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8f433f205a314584b4a749bd18e61576><p class=pgc-img-caption></p></div><p>其中通过类型和代码字段数值组合，可以确认ICMP报文的类型，明确是查询报文还是差错报文。如果是差错报文，还能够进一步分析时何种原因导致的差错。</p><p>代码和类型的组合，如下图所示：</p><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8d4ebddc9ab547a38a8d4c3857fa1432><p class=pgc-img-caption></p></div><p>这里再提下，当发送一份ICMP差错报文时，报文始终包含IP的首部和产生ICMP差错报文的IP数据报的前8个字节（即能够包含TCP/UDP的源目端口号）。这样接收ICMP差错报文的模块就会把它与某个特定的协议联系起来。</p><h1 class=pgc-h-arrow-right>03 PING</h1><p>PING（Packet Internet Groper）是最常用的网络连通性情况探测工具。。</p><p>通过向对端主机发送ICMP ECHO请求消息（类型8，代码0）及接收对端主机发送过来的ICMP ECHO应答消息（类型0，代码0）来判断网络的可达性。</p><p>PING ECHO请求和应答的截图如下：</p><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b828caa9b9bd4da2b65695727f839c1f><p class=pgc-img-caption></p></div><p>例如使用ping 8.8.8.8来探测源主机到目标地址的可达性情况。</p><p>可看到PING命令简单易用，PING默认发送四个数据包，每个数据包都有回显，能够看到包括时间、TTL等信息。截图如下：</p><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2d9a7dd6fbe44a188cde60ccb7f8d087><p class=pgc-img-caption></p></div><p>除了直接PING地址外，PING还有一些常用的参数，如下：</p><p>（1）次数</p><p>ping –t x.x.x.x 一直PING下去</p><p>ping –n x.x.x.x PING具体的n次</p><p>（2）数据大小</p><p>ping –l x.x.x 设置每次PING包的数据大小</p><p>（3）PING域名</p><p>Ping baidu.com 可以直接ping域名</p><h1 class=pgc-h-arrow-right>04 tracert/traceroute</h1><p>tracert和traceroute都是路由跟踪的工具，用于确定IP数据包访问目标所经过的路径。</p><p><strong>虽然两者的作用相同，但是两者的实现原理不同。</strong></p><p>（1）tracert</p><p>tracert是windows系统上用于实现路由跟踪的工具。</p><p>实现方法是通过发送ICMP ECHO数据包来实现的，和PING工具的原理相同（用到ICMP报文的类型8和代码0、以及类型0和代码0）。</p><p>例如我们探测到8.8.8.8的路径。截图如下：</p><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4fdaeed6e7ee44f585c7efedaa4b397a><p class=pgc-img-caption></p></div><p>通过抓包可以看到，tracert工具通过发送ICMP ECHO数据包，并配合使用ICMP报文和IP首部中的TTL字段，来实现路径记录功能。</p><p>通过沿途每个处理数据报的网络设备都需要把TTL的值减1的原理。当网络设备收到一份IP数据报，如果其TTL字段是0或1，则网络设备不转发该数据报。相反，网络设备将该数据包丢弃，并给信源发送一份"ICMP超时"信息。发送ICMP超时的源地址即为该跳网络设备的IP地址。</p><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/3b25bd875a5e4f828e25ae98ce7811eb><p class=pgc-img-caption></p></div><p>（2）traceroute</p><p>traceroute是linux系统上用于实现路由跟踪的工具。</p><p>虽然tracerout也是通过沿途每个处理数据报的网络设备都需要把TTL的值减1的原理。但是它不是使用ICMP ECHO数据包来实现的。</p><p>Traceroute默认使用类型11和代码0的差错报文来实现的。过程如下：traceroute发送的UDP数据包给目的主机IP，和大数值的UDP端口号（一般大于30000，通常初始的端口为33434）,为了使目的主机的任何一个应用程序都不可能使用该端口。因为当该数据报到达时，目的主机的UDP模块会产生一份"端口不可达"错误的ICMP报文，即表示达到目的地。</p><p>同时需要注意，成哥刚说了traceroute默认使用的使用11和0的差错报文，并发送UDP消息。但是traceroute也可以使用ICMP ECHO数据包来探测路径，这就和tracert原理相同了。另外探测的协议也能从UDP修改为TCP。截图如下：</p><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f2758e52df5e43778d5868ae387567ca><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/26921f1e65d94e39afd229b291f9098b><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>05 TCP会话的建立过程</h1><p>TCP提供一种面向连接的、可靠的字节流服务。面向连接意味着两个使用TCP的应用在彼此交换数据之前必须先建立一个TCP连接。</p><p>telnet和tcping/tcpping就是用到了TCP连接的建立过程来探测网络连通性的。</p><p>我们来看下TCP连接的建立过程，如下图所示：</p><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/233e444b78e44284a42335ad24590179><p class=pgc-img-caption></p></div><p>（1）第一次握手</p><p>客户端执行主动打开（active open)连接，发送一个SYN段指明客户打算连接的服务器的端口，以及初始序号（ISN）。这个SYN段为报文段1。发送内容包括：SYN=1，Seq=J</p><p>（2）第二次握手</p><p>服务器端收到SYN，执行被动打开（passive open)连接，服务器发回包含服务器的初始序号的SYN报文段，作为应答。同时，将确认序号(Ack)设置为客户的ISN加1以对客户的SYN报文段进行确认。一个SYN将占用一个序号。发送内容包括：SYN=1，ACK=1，Seq=K，Ack=J+1</p><p>（3）第三次握手</p><p>客户端收到服务器ACK回包后，首先进入ESTABLISHED状态，之后发送ACK给服务器，最后服务器也进入ESTABLISHED状态。发送内容包括：ACK=1，Seq=J+1，Ack=K+1</p><h1 class=pgc-h-arrow-right>06 telnet</h1><p>telnet是Internet远程登录服务的标准协议和主要方式。</p><p>通过使用telnet工具来和目标主机建立TCP会话，即可验证目标主机的特定端口开放情况。</p><p>我们通过telnet baidu.com的TCP443端口，验证端口的开放情况，如下图所示：</p><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a2e2b671964343959f5a05d14d5d70a0><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/27b988497fe94e3b813f7e154b72038f><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>07 tcping/tcpping</h1><p>Tcping/tcpping命令的原理和telnet原理一样，都是通过和目标主机的特定端口建立TCP会话，来验证网络开放情况。</p><p>接来下详细介绍下windows平台中tcping的安装和使用。Linux平台的tcpping使用方法相同，不再赘述。</p><p>（1）下载tcping.exe工具</p><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/7bd6892a4543419886f5221406df0587><p class=pgc-img-caption></p></div><p>（2）存放tcping.exe工具</p><p>Tcping.exe是可执行文件，不用安装，直接运行。</p><p>这里成哥是放到了e盘下面，所以要切换到e盘来使用tcping的命令。</p><p>（3）使用示例</p><p>注意这里使用了-d ,-h ,-t三个参数，显示如下，能看到时间间隔，以及不停的探测。</p><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fc4fc2b5f90a45e8afd074f8059e9a43><p class=pgc-img-caption></p></div><p>我们通过抓包，来看看每一次探测的情况。</p><p>可以看到源主机和目标主机建立了TCP会话，之后又立刻进行了TCP会话释放。</p><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ec6eec43383c476f90dd345dc45ac01e><p class=pgc-img-caption></p></div><p>常用的参数如下：</p><p>-t 不停的发送数据包。可通过Ctrl+C停止发包。</p><p>-n 5 一次发送 5 个数据包，默认一次发送4个 ： tecping -n 5 www.baidu.com 会tcping 百度5次，也可以跟其他数字。</p><p>-d 在每行前面显示详细日期时间。</p><p>-g 5 失败5次就放弃（注意默认是80端口，端口没开也算失败）</p><p>-h 以http 的模式工作，可以测试主机是否提供http服务</p><h1 class=pgc-h-arrow-right>09 总结</h1><p>本篇文章介绍了使用ICMP协议和TCP协议的网络连通性测试工具，这些工具都是我们工作和生活中最常用的网络探测工具，希望对大家有帮助。</p><p style=text-align:center><strong>--END--</strong></p><p><a class=tteditor-mention data-concern-id data-id data-name=IT管理局 data-uid=92359791051>@IT管理局</a>专注计算机领域技术、大学生活、学习方法、求职招聘、职业规划、职场感悟等类型的原创内容。期待与你相遇，和你一同成长。</p><p><strong>相关文章推荐：</strong></p><ul><li><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6867341767478346252/?group_id=6867341767478346252" rel="noopener noreferrer" target=_blank>一文秒懂 TCP/IP实际五层结构（上篇）</a></li><li><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6883777593187762692/?group_id=6883777593187762692" rel="noopener noreferrer" target=_blank>Wireshark数据包分析实战：TCP报文段重组</a></li><li><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6881501894695617037/?group_id=6881501894695617037" rel="noopener noreferrer" target=_blank>为什么现在的网站都是HTTPS的？</a></li></ul><p><br></p><div class=pgc-img><img alt=常用网络连通性测试工具（上） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4d4b0a567d3b4fbc8969d4d80c1dd6d6><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'通性','网络连','测试'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>