<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Linux 终端(TTY) | 极客快訊</title><meta property="og:title" content="Linux 终端(TTY) - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/f70d528c640041c299cb98182c44777f"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/396fda9.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/396fda9.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/396fda9.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/396fda9.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/396fda9.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/396fda9.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/396fda9.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/396fda9.html><meta property="article:published_time" content="2020-10-29T20:51:46+08:00"><meta property="article:modified_time" content="2020-10-29T20:51:46+08:00"><meta name=Keywords content><meta name=description content="Linux 终端(TTY)"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/396fda9.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Linux 终端(TTY)</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>TTY 是 Teletype 或 Teletypewriter 的缩写，原来是指电传打字机，后来这种设备逐渐键盘和显示器取代。不管是电传打字机还是键盘显示器，都是作为计算机的终端设备存在的，所以 TTY 也泛指计算机的终端(terminal)设备。为了支持这些 TTY 设备，Linux 实现了一个叫做 TTY 的子系统。所以 TTY 既指终端，也指 Linux 的 TTY 子系统，当然 TTY 还有更丰富(混乱)的含义，本文试图把它们解释清楚。本文中演示部分使用的环境为 ubuntu 18.04。</p><h1><strong>硬件终端 terminal(TTY)</strong></h1><p>早期的终端(terminal) 是一台独立于计算机的机器(teletype 即, TTY)，大概像下面的样子：</p><div class=pgc-img><img alt="Linux 终端(TTY)" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f70d528c640041c299cb98182c44777f><p class=pgc-img-caption></p></div><p>它终端通过线缆与计算机连接，并完成计算机的输入输出功能：</p><div class=pgc-img><img alt="Linux 终端(TTY)" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ae50d1667d184bada241d9a1795becf1><p class=pgc-img-caption></p></div><p>现在物理终端实际上已经灭绝了，我们看到的所有 TTY 都是模拟视频终端，即软件仿真出来的终端。可以通过 toe -a 命令查看系统支持的终端类型，不要奇怪，这是一个挺长的列表。</p><h1><strong>控制台 console</strong></h1><p>提到终端就不能不提控制台 console。控制台的概念与终端含义非常相近，其实现在我们经常用它们表示相同的东西，但是在计算机的早期时代，它们确实是不同的东西。</p><p>一些数控设备(比如数控机床)的控制箱，通常会被称为控制台，顾名思义，控制台就是一个直接控制设备的面板，上面有很多控制按钮。 在计算机里，把那套直接连接在电脑上的键盘和显示器就叫做控制台。而终端是通过串口连接上的，不是计算机自身的设备，而控制台是计算机本身就有的设备，一个计算机只有一个控制台。<strong>计算机启动的时候，所有的信息都会显示到控制台上，而不会显示到终端上。</strong>这同样说明，控制台是计算机的基本设备，而终端是附加设备。计算机操作系统中，与终端不相关的信息，比如内核消息，后台服务消息，都可以显示到控制台上，但不会显示到终端上。比如在启动和关闭 Linux 系统时，我们可以在控制台上看到很多的内核信息.</p><p>现在终端和控制台都由硬件概念，逐渐演化成了软件的概念。简单的说，<strong>能直接显示系统消息的那个终端称为控制台，其他的则称为终端(控制台也是一个终端)。或者我们在平时的使用中压根就不区分 Linux 中的终端与控制台。</strong></p><p>下面的例子是通过 /dev/console 文件向控制台发送消息，这个这个例子我们可以看到控制台与终端的一点点不同之处。</p><p>打开 vSphere Client 中的 "Virtual Machine Console"(即控制台)，默认显示的是 tty1：</p><p>通过其他的终端向 /dev/console 中写入字符串 "hello world"：</p><p>root@esearch:~# echo "hello world" > /dev/console</p><p>字符串显示在了控制台中。然后通过 Ctrl + Alt + F2 把控制台中的终端切换到 tty2，再次向 /dev/console 写入字符串：</p><p>root@esearch:~# echo "hello world" > /dev/console</p><p>这次字符串写到了 tty2 中，这说明 Linux 总是把写入 /dev/console 的内容会显示在控制台中当前的虚拟终端(tty1-tty6)里。</p><h1><strong>TTY 设备</strong></h1><p>从历史上看，终端刚开始就是终端机，配有打印机，键盘，带有一个串口，通过串口传送数据到主机端，然后主机处理完交给终端打印出来。电传打字机(teletype)可以被看作是这类设备的统称，因此终端也被简称为 TTY(teletype 的缩写)。</p><p>如下图所示(下图来自互联网)：</p><p><strong>UART 驱动</strong></p><p>如上图所示，物理终端通过电缆连接到计算机上的 UART(通用异步接收器和发射器)。操作系统中有一个 UART 驱动程序用于管理字节的物理传输。</p><p><strong>行规范</strong></p><p>上图中内核中的 Line discipline(行规范)用来提供一个编辑缓冲区和一些基本的编辑命令(退格，清除单个单词，清除行，重新打印)，主要用来支持用户在输入时的行为(比如输错了，需要退格)。</p><p><strong>TTY 驱动</strong></p><p>TTY 驱动用来进行会话管理，并且处理各种终端设备。</p><p>UART 驱动、行规范和 TTY 驱动都位于内核中，它们的一端是终端设备，另一端是用户进程。因为在 Linux 下所有的设备都是文件，所以它们三个加在一起被称为 "TTY 设备"，即我们常说的 TTY。</p><h1><strong>从软件仿真终端到伪终端</strong></h1><p>后来的终端慢慢演变成了键盘 + 显示器。如果我们要把内容输出到显示器，只要把这些内容写入到显示器对应的 TTY 设备就可以了，然后由 TTY 层负责匹配合适的驱动完成输出，这也是 Linux 控制台的工作原理(下图来自互联网)：</p><p>上图中，TTY 驱动和行规范的行为与前面的示例类似，但不再有 UART 或物理终端。相反，软件仿真出视频终端，并最终被渲染到 VGA 显示器。注意，这里出现了软件仿真终端，它们是运行在内核态的。显示器和 vSphere Client "Virtual Machine Console" 中的 tty1-tty6 都是<strong>软件仿真终端</strong>：</p><p>/dev/tty1-/dev/tty6 是这些仿真终端在文件系统中的表示，程序通过对这些文件的读写实现对仿真终端的读写。</p><p>如果我们在用户空间也进行终端仿真，情况会变得更加灵活，下图是 xterm 及其克隆的工作方式(下图来自互联网)：</p><p>为了便于将终端仿真移入用户空间，同时仍保持 TTY 子系统(TTY 子系统指 TTY 驱动和行规范)的完整，伪终端被发明了出来(pseudo terminal 或 pty)。伪终端在内核中分为两部分，分别是 master side 和 在 TTY 驱动中实现的 slave side。注意上图中的 xterm，这是一个运行在用户态的终端仿真程序，比如 Ubuntu Desktop 中的 GNOME Terminal：</p><p>当创建一个伪终端时，会在 /dev/pts 目录下创建一个设备文件：</p><p>如果是通过 PuTTY 等终端仿真程序通过 SSH 的方式远程连接 Linux，那么终端仿真程序通过 SSH 与 PTY master side 交换数据。</p><h1><strong>终端与伪终端的区别</strong></h1><p>至此我们可以得出这样的结论：现在所说的终端已经不是硬件终端了，而是软件仿真终端(终端模拟软件)。</p><p>关于终端和伪终端，可以简单的理解如下：</p><ul><li>真正的硬件终端基本上已经看不到了，现在所说的终端、伪终端都是软件仿真终端(即终端模拟软件)</li><li>一些连接了键盘和显示器的系统中，我们可以接触到运行在内核态的软件仿真终端(tty1-tty6)</li><li>通过 SSH 等方式建立的连接中使用的都是伪终端</li><li>伪终端是运行在用户态的软件仿真终端</li></ul><h1><strong>总结</strong></h1><p>通过本文我们可以了解到，真正的硬件终端基本上已经看不到了。在一些连接了键盘和显示器的系统中(当然也包括一些 vsphere 等虚拟环境)，我们可以接触到运行在内核态的软件仿真终端。而我们使用最多的则是伪终端。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Linux','终端','TTY'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>