<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>å¼‚æ­¥ç¼–ç¨‹å®ä¾‹ï¼šJava8 APIçš„ç†è§£å’ŒCompletableFutureç±»çš„å®ç° | æå®¢å¿«è¨Š</title><meta property="og:title" content="å¼‚æ­¥ç¼–ç¨‹å®ä¾‹ï¼šJava8 APIçš„ç†è§£å’ŒCompletableFutureç±»çš„å®ç° - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/1522150125651deaa9d51b2"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3a0dfd7.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3a0dfd7.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3a0dfd7.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3a0dfd7.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3a0dfd7.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3a0dfd7.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3a0dfd7.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3a0dfd7.html><meta property="article:published_time" content="2020-10-29T20:50:33+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:33+08:00"><meta name=Keywords content><meta name=description content="å¼‚æ­¥ç¼–ç¨‹å®ä¾‹ï¼šJava8 APIçš„ç†è§£å’ŒCompletableFutureç±»çš„å®ç°"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/3a0dfd7.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>å¼‚æ­¥ç¼–ç¨‹å®ä¾‹ï¼šJava8 APIçš„ç†è§£å’ŒCompletableFutureç±»çš„å®ç°</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><p>å¼‚æ­¥ç¼–ç¨‹æœ€å¤§çš„ç‰¹ç‚¹è«è¿‡äºå®ƒèƒ½æé«˜ç³»ç»Ÿçš„ååç‡ï¼Œä»è€Œæé«˜å·¥ä½œæ•ˆç‡ã€‚ä¸‹é¢æ˜¯å…³äºJava APIå’ŒCompletableFutureç±»çš„é™ˆè¿°å’Œå®ä¾‹ï¼Œå¸®ä½ æ›´å¥½çš„ç†è§£Javaå¼‚æ­¥ç¼–ç¨‹ã€‚</p><p>Javaå¼‚æ­¥ç¼–ç¨‹ä¸­ï¼ŒFutureå¯ä»¥ç”¨æ¥è¿›è¡Œå¼‚æ­¥è®¡ç®—ï¼Œå®ƒä½äºjava.util.concurrentåŒ…ä¸­ã€‚å®ƒçš„å®ç°å¯ä»¥ç†è§£æˆï¼šæˆ‘æœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œçº¦å®šç”±Futureæ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚æœŸé—´æˆ‘å¯ä»¥å»åšå…¶ä»–æƒ³åšçš„äº‹æƒ…ã€‚ä¸€æ®µæ—¶é—´ä¹‹åï¼Œæˆ‘å¯ä»¥ç›´æ¥ä»Futureé‚£å„¿å–å‡ºç»“æœã€‚å¯¹äºJavaå¼‚æ­¥ç¼–ç¨‹ï¼Œä¸ä¸€å®šéè¦ä½¿ç”¨rxJava, Javaæœ¬èº«çš„åº“ä¸­çš„CompletableFutureå¯ä»¥å¾ˆå¥½çš„åº”å¯¹å¤§å¤šæ•°åœºåˆã€‚</p><p><img alt="å¼‚æ­¥ç¼–ç¨‹å®ä¾‹ï¼šJava8 APIçš„ç†è§£å’ŒCompletableFutureç±»çš„å®ç°" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1522150125651deaa9d51b2></p><p>è¿™é‡Œæ˜¯ä»‹ç» Java 8 çš„ CompletionStage APIå’Œå®ƒçš„æ ‡å‡†åº“çš„å®ç° CompletableFutureçš„ä¸€ç¯‡æ–‡ç« ã€‚APIé€šè¿‡ä¾‹å­çš„æ–¹å¼æ¼”ç¤ºäº†å®ƒçš„è¡Œä¸ºï¼Œæ¯ä¸ªä¾‹å­æ¼”ç¤ºä¸€åˆ°ä¸¤ä¸ªè¡Œä¸ºã€‚</p><p>æ—¢ç„¶CompletableFutureç±»å®ç°äº†CompletionStageæ¥å£ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦ç†è§£è¿™ä¸ªæ¥å£çš„å¥‘çº¦ã€‚å®ƒä»£è¡¨äº†ä¸€ä¸ªç‰¹å®šçš„è®¡ç®—çš„é˜¶æ®µï¼Œå¯ä»¥åŒæ­¥æˆ–è€…å¼‚æ­¥çš„è¢«å®Œæˆã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ä¸ªè®¡ç®—æµæ°´çº¿ä¸Šçš„ä¸€ä¸ªå•å…ƒï¼Œæœ€ç»ˆä¼šäº§ç”Ÿä¸€ä¸ªæœ€ç»ˆç»“æœï¼Œè¿™æ„å‘³ç€å‡ ä¸ªCompletionStageå¯ä»¥ä¸²è”èµ·æ¥ï¼Œä¸€ä¸ªå®Œæˆçš„é˜¶æ®µå¯ä»¥è§¦å‘ä¸‹ä¸€é˜¶æ®µçš„æ‰§è¡Œï¼Œæ¥ç€è§¦å‘ä¸‹ä¸€æ¬¡ï¼Œæ¥ç€â€¦â€¦</p><p>é™¤äº†å®ç°CompletionStageæ¥å£ï¼ŒCompletableFutureä¹Ÿå®ç°äº†futureæ¥å£, ä»£è¡¨ä¸€ä¸ªæœªå®Œæˆçš„å¼‚æ­¥äº‹ä»¶ã€‚</p><p>CompletableFutureæä¾›äº†æ–¹æ³•ï¼Œèƒ½å¤Ÿæ˜¾å¼åœ°å®Œæˆè¿™ä¸ªfuture,æ‰€ä»¥å®ƒå«CompletableFutureã€‚</p><p>1ã€ åˆ›å»ºä¸€ä¸ªå®Œæˆçš„CompletableFuture</p><p>æœ€ç®€å•çš„ä¾‹å­å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªé¢„å®šä¹‰çš„ç»“æœåˆ›å»ºä¸€ä¸ªå®Œæˆçš„CompletableFuture,é€šå¸¸æˆ‘ä»¬ä¼šåœ¨è®¡ç®—çš„å¼€å§‹é˜¶æ®µä½¿ç”¨å®ƒã€‚</p><p><code>static</code><code>void</code><code>completedFutureExample() {</code></p><p><code>CompletableFuture cf = CompletableFuture.completedFuture(</code><code>"message"</code><code>);</code></p><p><code>assertTrue(cf.isDone());</code></p><p><code>assertEquals(</code><code>"message"</code><code>, cf.getNow(</code><code>null</code><code>));</code></p><p><code>}</code></p><p>getNow(null)</p><p>æ–¹æ³•åœ¨futureå®Œæˆçš„æƒ…å†µä¸‹ä¼šè¿”å›ç»“æœï¼Œå°±æ¯”å¦‚ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œå¦åˆ™è¿”å›null (ä¼ å…¥çš„å‚æ•°)ã€‚</p><p>2ã€è¿è¡Œä¸€ä¸ªç®€å•çš„å¼‚æ­¥é˜¶æ®µ</p><p>è¿™ä¸ªä¾‹å­åˆ›å»ºä¸€ä¸ªä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œçš„é˜¶æ®µï¼š</p><p><code>static</code><code>void</code><code>runAsyncExample() {</code></p><p><code>CompletableFuture cf = CompletableFuture.runAsync(() -> {</code></p><p><code>assertTrue(Thread.currentThread().isDaemon());</code></p><p><code>randomSleep();</code></p><p><code>});</code></p><p><code>assertFalse(cf.isDone());</code></p><p><code>sleepEnough();</code></p><p><code>assertTrue(cf.isDone());</code></p><p><code>}</code></p><p>é€šè¿‡è¿™ä¸ªä¾‹å­å¯ä»¥å­¦åˆ°ä¸¤ä»¶äº‹æƒ…ï¼š</p><p>CompletableFutureçš„æ–¹æ³•å¦‚æœä»¥</p><p>Async</p><p>ç»“å°¾ï¼Œå®ƒä¼šå¼‚æ­¥çš„æ‰§è¡Œ(æ²¡æœ‰æŒ‡å®šexecutorçš„æƒ…å†µä¸‹)ï¼Œ å¼‚æ­¥æ‰§è¡Œé€šè¿‡ForkJoinPoolå®ç°ï¼Œ å®ƒä½¿ç”¨å®ˆæŠ¤çº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ã€‚æ³¨æ„è¿™æ˜¯CompletableFutureçš„ç‰¹æ€§ï¼Œ å…¶å®ƒCompletionStageå¯ä»¥overrideè¿™ä¸ªé»˜è®¤çš„è¡Œä¸ºã€‚</p><p>3ã€åœ¨å‰ä¸€ä¸ªé˜¶æ®µä¸Šåº”ç”¨å‡½æ•°</p><p>ä¸‹é¢è¿™ä¸ªä¾‹å­ä½¿ç”¨å‰é¢ #1 çš„å®Œæˆçš„CompletableFutureï¼Œ #1è¿”å›ç»“æœä¸ºå­—ç¬¦ä¸²</p><p>message</p><p>,ç„¶ååº”ç”¨ä¸€ä¸ªå‡½æ•°æŠŠå®ƒå˜æˆå¤§å†™å­—æ¯ã€‚</p><p><code>static</code><code>void</code><code>thenApplyExample() {</code></p><p><code>CompletableFuture cf = CompletableFuture.completedFuture(</code><code>"message"</code><code>).thenApply(s -> {</code></p><p><code>assertFalse(Thread.currentThread().isDaemon());</code></p><p><code>return</code><code>s.toUpperCase();</code></p><p><code>});</code></p><p><code>assertEquals(</code><code>"MESSAGE"</code><code>, cf.getNow(</code><code>null</code><code>));</code></p><p><code>}</code></p><p>æ³¨æ„</p><p>thenApply</p><p>æ–¹æ³•åç§°ä»£è¡¨çš„è¡Œä¸ºã€‚</p><p>then</p><p>æ„å‘³ç€è¿™ä¸ªé˜¶æ®µçš„åŠ¨ä½œå‘ç”Ÿå½“å‰çš„é˜¶æ®µæ­£å¸¸å®Œæˆä¹‹åã€‚æœ¬ä¾‹ä¸­ï¼Œå½“å‰èŠ‚ç‚¹å®Œæˆï¼Œè¿”å›å­—ç¬¦ä¸²</p><p>message</p><p>ã€‚</p><p>Apply</p><p>æ„å‘³ç€è¿”å›çš„é˜¶æ®µå°†ä¼šå¯¹ç»“æœå‰ä¸€é˜¶æ®µçš„ç»“æœåº”ç”¨ä¸€ä¸ªå‡½æ•°ã€‚</p><p>å‡½æ•°çš„æ‰§è¡Œä¼šè¢«é˜»å¡ï¼Œè¿™æ„å‘³ç€</p><p>getNow()</p><p>åªæœ‰æ‰“æ–œæ“ä½œè¢«å®Œæˆåæ‰è¿”å›ã€‚</p><p>4ã€åœ¨å‰ä¸€ä¸ªé˜¶æ®µä¸Šå¼‚æ­¥åº”ç”¨å‡½æ•°</p><p>é€šè¿‡è°ƒç”¨å¼‚æ­¥æ–¹æ³•(æ–¹æ³•åè¾¹åŠ Asyncåç¼€)ï¼Œä¸²è”èµ·æ¥çš„CompletableFutureå¯ä»¥å¼‚æ­¥åœ°æ‰§è¡Œï¼ˆä½¿ç”¨ForkJoinPool.commonPool()ï¼‰ã€‚</p><p><code>static</code> <code>void</code> <code>thenApplyAsyncExample() {</code></p><p><code>CompletableFuture cf = CompletableFuture.completedFuture(</code><code>"message"</code><code>).thenApplyAsync(s -> {</code></p><p><code>assertTrue(Thread.currentThread().isDaemon());</code></p><p><code>randomSleep();</code></p><p><code>return</code> <code>s.toUpperCase();</code></p><p><code>});</code></p><p><code>assertNull(cf.getNow(</code><code>null</code><code>));</code></p><p><code>assertEquals(</code><code>"MESSAGE"</code><code>, cf.join());</code></p><p><code>}</code></p><p>5ã€ä½¿ç”¨å®šåˆ¶çš„Executoråœ¨å‰ä¸€ä¸ªé˜¶æ®µä¸Šå¼‚æ­¥åº”ç”¨å‡½æ•°</p><p>å¼‚æ­¥æ–¹æ³•ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ç‰¹æ€§å°±æ˜¯èƒ½å¤Ÿæä¾›ä¸€ä¸ªExecutoræ¥å¼‚æ­¥åœ°æ‰§è¡ŒCompletableFutureã€‚è¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± æ¥åº”ç”¨å¤§å†™å‡½æ•°ã€‚<span>static</span></p><p><code>ExecutorService executor = Executors.newFixedThreadPool(</code><code>3</code><code>, </code><code>new</code><code>ThreadFactory() {</code></p><p><code>int</code> <code>count = </code><code>1</code><code>;</code></p><p><code>@Override</code></p><p><code>public</code> <code>Thread newThread(Runnable runnable) {</code></p><p><code>return</code> <code>new</code> <code>Thread(runnable, </code><code>"custom-executor-"</code> <code>+ count++);</code></p><p><code>}</code></p><p><code>});</code></p><p><code>static</code> <code>void</code> <code>thenApplyAsyncWithExecutorExample() {</code></p><p><code>CompletableFuture cf = CompletableFuture.completedFuture(</code><code>"message"</code><code>).thenApplyAsync(s -> {</code></p><p><code>assertTrue(Thread.currentThread().getName().startsWith(</code><code>"custom-executor-"</code><code>));</code></p><p><code>assertFalse(Thread.currentThread().isDaemon());</code></p><p><code>randomSleep();</code></p><p><code>return</code> <code>s.toUpperCase();</code></p><p><code>}, executor);</code></p><p><code>assertNull(cf.getNow(</code><code>null</code><code>));</code></p><p><code>assertEquals(</code><code>"MESSAGE"</code><code>, cf.join());</code></p><p><code>}</code></p><p>6ã€æ¶ˆè´¹å‰ä¸€é˜¶æ®µçš„ç»“æœ</p><p>å¦‚æœä¸‹ä¸€é˜¶æ®µæ¥æ”¶äº†å½“å‰é˜¶æ®µçš„ç»“æœï¼Œä½†æ˜¯åœ¨è®¡ç®—çš„æ—¶å€™ä¸éœ€è¦è¿”å›å€¼(å®ƒçš„è¿”å›ç±»å‹æ˜¯void)ï¼Œ é‚£ä¹ˆå®ƒå¯ä»¥ä¸åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œ è°ƒç”¨æ–¹æ³•ä¹Ÿå˜æˆäº†</p><p>thenAcceptï¼š</p><p><code>static</code> <code>void</code> <code>thenAcceptExample() {</code></p><p><code>StringBuilder result = </code><code>new</code> <code>StringBuilder();</code></p><p><code>CompletableFuture.completedFuture(</code><code>"thenAccept message"</code><code>)</code></p><p><code>.thenAccept(s -> result.append(s));</code></p><p><code>assertTrue(</code><code>"Result was empty"</code><code>, result.length() > </code><code>0</code><code>);</code></p><p><code>}</code></p><p>æœ¬ä¾‹ä¸­æ¶ˆè´¹è€…åŒæ­¥åœ°æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦åœ¨CompletableFutureè°ƒç”¨</p><p>join</p><p>æ–¹æ³•ã€‚</p><p>7ã€å¼‚æ­¥åœ°æ¶ˆè´¹è¿ç§»é˜¶æ®µçš„ç»“æœ</p><p>åŒæ ·ï¼Œå¯ä»¥ä½¿ç”¨</p><p>thenAcceptAsync</p><p>æ–¹æ³•ï¼Œ ä¸²è”çš„CompletableFutureå¯ä»¥å¼‚æ­¥åœ°æ‰§è¡Œã€‚</p><p><code>static</code> <code>void</code> <code>thenAcceptAsyncExample() {</code></p><p><code>StringBuilder result = </code><code>new</code> <code>StringBuilder();</code></p><p><code>CompletableFuture cf = CompletableFuture.completedFuture(</code><code>"thenAcceptAsync message"</code><code>)</code></p><p><code>.thenAcceptAsync(s -> result.append(s));</code></p><p><code>cf.join();</code></p><p><code>assertTrue(</code><code>"Result was empty"</code><code>, result.length() > </code><code>0</code><code>);</code></p><p><code>}</code></p><p>8ã€å®Œæˆè®¡ç®—å¼‚å¸¸</p><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¼‚æ­¥æ“ä½œå¦‚ä½•æ˜¾å¼åœ°è¿”å›å¼‚å¸¸ï¼Œç”¨æ¥æŒ‡ç¤ºè®¡ç®—å¤±è´¥ã€‚æˆ‘ä»¬ç®€åŒ–è¿™ä¸ªä¾‹å­ï¼Œæ“ä½œå¤„ç†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæŠŠå®ƒè½¬æ¢æˆç­”è°¢ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿå»¶è¿Ÿä¸€ç§’ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨</p><p>thenApplyAsync(Function, Executor)</p><p>æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥å¤§å†™å‡½æ•°ï¼Œ executoræ˜¯ä¸€ä¸ªdelayed executor,åœ¨æ‰§è¡Œå‰ä¼šå»¶è¿Ÿä¸€ç§’ã€‚</p><p><code>static</code> <code>void</code> <code>completeExceptionallyExample() {</code></p><p><code>CompletableFuture cf = CompletableFuture.completedFuture(</code><code>"message"</code><code>).thenApplyAsync(String::toUpperCase,</code></p><p><code>CompletableFuture.delayedExecutor(</code><code>1</code><code>, TimeUnit.SECONDS));</code></p><p><code>CompletableFuture exceptionHandler = cf.handle((s, th) -> { </code><code>return</code> <code>(th != </code><code>null</code><code>) ? </code><code>"message upon cancel"</code> <code>: </code><code>""</code><code>; });</code></p><p><code>cf.completeExceptionally(</code><code>new</code> <code>RuntimeException(</code><code>"completed exceptionally"</code><code>));</code></p><p><code>assertTrue(</code><code>"Was not completed exceptionally"</code><code>, cf.isCompletedExceptionally());</code></p><p><code>try</code> <code>{</code></p><p><code>cf.join();</code></p><p><code>fail(</code><code>"Should have thrown an exception"</code><code>);</code></p><p><code>} </code><code>catch</code><code>(CompletionException ex) { </code><code>// just for testing</code></p><p><code>assertEquals(</code><code>"completed exceptionally"</code><code>, ex.getCause().getMessage());</code></p><p><code>}</code></p><p><code>assertEquals(</code><code>"message upon cancel"</code><code>, exceptionHandler.join());</code></p><p><code>}</code></p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç»†èŠ‚ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªCompletableFuture, å®Œæˆåè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</p><p>message</p><p>,æ¥ç€æˆ‘ä»¬è°ƒç”¨</p><p>thenApplyAsync</p><p>æ–¹æ³•ï¼Œå®ƒè¿”å›ä¸€ä¸ªCompletableFutureã€‚è¿™ä¸ªæ–¹æ³•åœ¨ç¬¬ä¸€ä¸ªå‡½æ•°å®Œæˆåï¼Œå¼‚æ­¥åœ°åº”ç”¨è½¬å¤§å†™å­—æ¯å‡½æ•°ã€‚</p><p>è¿™ä¸ªä¾‹å­è¿˜æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡</p><p>delayedExecutor(timeout, timeUnit)</p><p>å»¶è¿Ÿæ‰§è¡Œä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ã€‚</p><p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåˆ†ç¦»çš„</p><p>handler</p><p>é˜¶æ®µï¼š exceptionHandlerï¼Œ å®ƒå¤„ç†å¼‚å¸¸å¼‚å¸¸ï¼Œåœ¨å¼‚å¸¸æƒ…å†µä¸‹è¿”å›</p><p>message upon cancel</p><p>ã€‚</p><p>ä¸‹ä¸€æ­¥æˆ‘ä»¬æ˜¾å¼åœ°ç”¨å¼‚å¸¸å®Œæˆç¬¬äºŒä¸ªé˜¶æ®µã€‚ åœ¨é˜¶æ®µä¸Šè°ƒç”¨</p><p>join</p><p>æ–¹æ³•ï¼Œå®ƒä¼šæ‰§è¡Œå¤§å†™è½¬æ¢ï¼Œç„¶åæŠ›å‡ºCompletionExceptionï¼ˆæ­£å¸¸çš„joinä¼šç­‰å¾…1ç§’ï¼Œç„¶åå¾—åˆ°å¤§å†™çš„å­—ç¬¦ä¸²ã€‚ä¸è¿‡æˆ‘ä»¬çš„ä¾‹å­è¿˜æ²¡ç­‰å®ƒæ‰§è¡Œå°±å®Œæˆäº†å¼‚å¸¸ï¼‰ï¼Œ ç„¶åå®ƒè§¦å‘äº†handleré˜¶æ®µã€‚</p><p>9ã€å–æ¶ˆè®¡ç®—</p><p>å’Œå®Œæˆå¼‚å¸¸ç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨</p><p>cancel(boolean mayInterruptIfRunning)</p><p>å–æ¶ˆè®¡ç®—ã€‚å¯¹äºCompletableFutureç±»ï¼Œå¸ƒå°”å‚æ•°å¹¶æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œè¿™æ˜¯å› ä¸ºå®ƒå¹¶æ²¡æœ‰ä½¿ç”¨ä¸­æ–­å»å–æ¶ˆæ“ä½œï¼Œç›¸åï¼Œ</p><p>cancel</p><p>ç­‰ä»·äº</p><p>completeExceptionally(new CancellationException())</p><p>ã€‚</p><p><code>static</code> <code>void</code> <code>cancelExample() {</code></p><p><code>CompletableFuture cf = CompletableFuture.completedFuture(</code><code>"message"</code><code>).thenApplyAsync(String::toUpperCase,</code></p><p><code>CompletableFuture.delayedExecutor(</code><code>1</code><code>, TimeUnit.SECONDS));</code></p><p><code>CompletableFuture cf2 = cf.exceptionally(throwable -> </code><code>"canceled message"</code><code>);</code></p><p><code>assertTrue(</code><code>"Was not canceled"</code><code>, cf.cancel(</code><code>true</code><code>));</code></p><p><code>assertTrue(</code><code>"Was not completed exceptionally"</code><code>, cf.isCompletedExceptionally());</code></p><p><code>assertEquals(</code><code>"canceled message"</code><code>, cf2.join());</code></p><p><code>}</code></p><p>10ã€åœ¨ä¸¤ä¸ªå®Œæˆçš„é˜¶æ®µå…¶ä¸­ä¹‹ä¸€ä¸Šåº”ç”¨å‡½æ•°</p><p>ä¸‹é¢çš„ä¾‹å­åˆ›å»ºäº†</p><p>CompletableFuture</p><p>,</p><p>applyToEither</p><p>å¤„ç†ä¸¤ä¸ªé˜¶æ®µï¼Œ åœ¨å…¶ä¸­ä¹‹ä¸€ä¸Šåº”ç”¨å‡½æ•°(åŒ…ä¿è¯å“ªä¸€ä¸ªè¢«æ‰§è¡Œ)ã€‚ æœ¬ä¾‹ä¸­çš„ä¸¤ä¸ªé˜¶æ®µä¸€ä¸ªæ˜¯åº”ç”¨å¤§å†™è½¬æ¢åœ¨åŸå§‹çš„å­—ç¬¦ä¸²ä¸Šï¼Œ å¦ä¸€ä¸ªé˜¶æ®µæ˜¯åº”ç”¨å°äº›è½¬æ¢ã€‚</p><p><code>static</code> <code>void</code> <code>applyToEitherExample() {</code></p><p><code>String original = </code><code>"Message"</code><code>;</code></p><p><code>CompletableFuture cf1 = CompletableFuture.completedFuture(original)</code></p><p><code>.thenApplyAsync(s -> delayedUpperCase(s));</code></p><p><code>CompletableFuture cf2 = cf1.applyToEither(</code></p><p><code>CompletableFuture.completedFuture(original).thenApplyAsync(s -> delayedLowerCase(s)),</code></p><p><code>s -> s + </code><code>" from applyToEither"</code><code>);</code></p><p><code>assertTrue(cf2.join().endsWith(</code><code>" from applyToEither"</code><code>));</code></p><p><code>}</code></p><p>11ã€åœ¨ä¸¤ä¸ªå®Œæˆçš„é˜¶æ®µå…¶ä¸­ä¹‹ä¸€ä¸Šè°ƒç”¨æ¶ˆè´¹å‡½æ•°</p><p>å’Œå‰ä¸€ä¸ªä¾‹å­å¾ˆç±»ä¼¼äº†ï¼Œåªä¸è¿‡æˆ‘ä»¬è°ƒç”¨çš„æ˜¯æ¶ˆè´¹è€…å‡½æ•° (Functionå˜æˆConsumer):</p><p><code>static</code> <code>void</code> <code>acceptEitherExample() {</code></p><p><code>String original = </code><code>"Message"</code><code>;</code></p><p><code>StringBuilder result = </code><code>new</code> <code>StringBuilder();</code></p><p><code>CompletableFuture cf = CompletableFuture.completedFuture(original)</code></p><p><code>.thenApplyAsync(s -> delayedUpperCase(s))</code></p><p><code>.acceptEither(CompletableFuture.completedFuture(original).thenApplyAsync(s -> delayedLowerCase(s)),</code></p><p><code>s -> result.append(s).append(</code><code>"acceptEither"</code><code>));</code></p><p><code>cf.join();</code></p><p><code>assertTrue(</code><code>"Result was empty"</code><code>, result.toString().endsWith(</code><code>"acceptEither"</code><code>));</code></p><p><code>}</code></p><p>12ã€åœ¨ä¸¤ä¸ªé˜¶æ®µéƒ½æ‰§è¡Œå®Œåè¿è¡Œä¸€ä¸ª</p><p>Runnable</p><p>è¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†ä¾èµ–çš„CompletableFutureå¦‚æœç­‰å¾…ä¸¤ä¸ªé˜¶æ®µå®Œæˆåæ‰§è¡Œäº†ä¸€ä¸ªRunnableã€‚ æ³¨æ„ä¸‹é¢æ‰€æœ‰çš„é˜¶æ®µéƒ½æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œç¬¬ä¸€ä¸ªé˜¶æ®µæ‰§è¡Œå¤§å†™è½¬æ¢ï¼Œç¬¬äºŒä¸ªé˜¶æ®µæ‰§è¡Œå°å†™è½¬æ¢ã€‚</p><p><code>static</code> <code>void</code> <code>runAfterBothExample() {</code></p><p><code>String original = </code><code>"Message"</code><code>;</code></p><p><code>StringBuilder result = </code><code>new</code> <code>StringBuilder();</code></p><p><code>CompletableFuture.completedFuture(original).thenApply(String::toUpperCase).runAfterBoth(</code></p><p><code>CompletableFuture.completedFuture(original).thenApply(String::toLowerCase),</code></p><p><code>() -> result.append(</code><code>"done"</code><code>));</code></p><p><code>assertTrue(</code><code>"Result was empty"</code><code>, result.length() > </code><code>0</code><code>);</code></p><p><code>}</code></p><p>13ã€ ä½¿ç”¨BiConsumerå¤„ç†ä¸¤ä¸ªé˜¶æ®µçš„ç»“æœ</p><p>ä¸Šé¢çš„ä¾‹å­è¿˜å¯ä»¥é€šè¿‡BiConsumeræ¥å®ç°:</p><p><code>static</code> <code>void</code> <code>thenAcceptBothExample() {</code></p><p><code>String original = </code><code>"Message"</code><code>;</code></p><p><code>StringBuilder result = </code><code>new</code> <code>StringBuilder();</code></p><p><code>CompletableFuture.completedFuture(original).thenApply(String::toUpperCase).thenAcceptBoth(</code></p><p><code>CompletableFuture.completedFuture(original).thenApply(String::toLowerCase),</code></p><p><code>(s1, s2) -> result.append(s1 + s2));</code></p><p><code>assertEquals(</code><code>"MESSAGEmessage"</code><code>, result.toString());</code></p><p><code>}</code></p><p>14ã€ä½¿ç”¨BiFunctionå¤„ç†ä¸¤ä¸ªé˜¶æ®µçš„ç»“æœ</p><p>å¦‚æœCompletableFutureä¾èµ–ä¸¤ä¸ªå‰é¢é˜¶æ®µçš„ç»“æœï¼Œ å®ƒå¤åˆä¸¤ä¸ªé˜¶æ®µçš„ç»“æœå†è¿”å›ä¸€ä¸ªç»“æœï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨</p><p>thenCombine()</p><p>å‡½æ•°ã€‚æ•´ä¸ªæµæ°´çº¿æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥</p><p>getNow()</p><p>ä¼šå¾—åˆ°æœ€ç»ˆçš„ç»“æœï¼Œå®ƒæŠŠå¤§å†™å’Œå°å†™å­—ç¬¦ä¸²è¿æ¥èµ·æ¥ã€‚</p><p><code>static</code> <code>void</code> <code>thenCombineExample() {</code></p><p><code>String original = </code><code>"Message"</code><code>;</code></p><p><code>CompletableFuture cf = CompletableFuture.completedFuture(original).thenApply(s -> delayedUpperCase(s))</code></p><p><code>.thenCombine(CompletableFuture.completedFuture(original).thenApply(s -> delayedLowerCase(s)),</code></p><p><code>(s1, s2) -> s1 + s2);</code></p><p><code>assertEquals(</code><code>"MESSAGEmessage"</code><code>, cf.getNow(</code><code>null</code><code>));</code></p><p><code>}</code></p><p>15ã€å¼‚æ­¥ä½¿ç”¨BiFunctionå¤„ç†ä¸¤ä¸ªé˜¶æ®µçš„ç»“æœ</p><p>ç±»ä¼¼ä¸Šé¢çš„ä¾‹å­ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹ä¸åŒï¼š ä¾èµ–çš„å‰ä¸¤ä¸ªé˜¶æ®µå¼‚æ­¥åœ°æ‰§è¡Œï¼Œæ‰€ä»¥</p><p>thenCombine()</p><p>ä¹Ÿå¼‚æ­¥åœ°æ‰§è¡Œï¼Œå³æ—¶å®ƒæ²¡æœ‰</p><p>Async</p><p>åç¼€ã€‚</p><p>Javadocä¸­æœ‰æ³¨é‡Šï¼š</p><blockquote><p>Actions supplied for dependent completions of non-async methods may be performed by the thread that completes the current CompletableFuture, or by any other caller of a completion method</p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦</p><p>join</p><p>æ–¹æ³•ç­‰å¾…ç»“æœçš„å®Œæˆã€‚</p><p><code>static</code> <code>void</code> <code>thenCombineAsyncExample() {</code></p><p><code>String original = </code><code>"Message"</code><code>;</code></p><p><code>CompletableFuture cf = CompletableFuture.completedFuture(original)</code></p><p><code>.thenApplyAsync(s -> delayedUpperCase(s))</code></p><p><code>.thenCombine(CompletableFuture.completedFuture(original).thenApplyAsync(s -> delayedLowerCase(s)),</code></p><p><code>(s1, s2) -> s1 + s2);</code></p><p><code>assertEquals(</code><code>"MESSAGEmessage"</code><code>, cf.join());</code></p><p><code>}</code></p><p>16ã€ç»„åˆ CompletableFuture</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨</p><p>thenCompose()</p><p>å®Œæˆä¸Šé¢ä¸¤ä¸ªä¾‹å­ã€‚è¿™ä¸ªæ–¹æ³•ç­‰å¾…ç¬¬ä¸€ä¸ªé˜¶æ®µçš„å®Œæˆ(å¤§å†™è½¬æ¢)ï¼Œ å®ƒçš„ç»“æœä¼ ç»™ä¸€ä¸ªæŒ‡å®šçš„è¿”å›CompletableFutureå‡½æ•°ï¼Œå®ƒçš„ç»“æœå°±æ˜¯è¿”å›çš„CompletableFutureçš„ç»“æœã€‚</p><p>æœ‰ç‚¹æ‹—å£ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹ä¾‹å­æ¥ç†è§£ã€‚å‡½æ•°éœ€è¦ä¸€ä¸ªå¤§å†™å­—ç¬¦ä¸²åšå‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªCompletableFuture, è¿™ä¸ªCompletableFutureä¼šè½¬æ¢å­—ç¬¦ä¸²å˜æˆå°å†™ç„¶åè¿æ¥åœ¨å¤§å†™å­—ç¬¦ä¸²çš„åé¢ã€‚</p><p><code>static</code> <code>void</code> <code>thenComposeExample() {</code></p><p><code>String original = </code><code>"Message"</code><code>;</code></p><p><code>CompletableFuture cf = CompletableFuture.completedFuture(original).thenApply(s -> delayedUpperCase(s))</code></p><p><code>.thenCompose(upper -> CompletableFuture.completedFuture(original).thenApply(s -> delayedLowerCase(s))</code></p><p><code>.thenApply(s -> upper + s));</code></p><p><code>assertEquals(</code><code>"MESSAGEmessage"</code><code>, cf.join());</code></p><p><code>}</code></p><p>17ã€å½“å‡ ä¸ªé˜¶æ®µä¸­çš„ä¸€ä¸ªå®Œæˆï¼Œåˆ›å»ºä¸€ä¸ªå®Œæˆçš„é˜¶æ®µ</p><p>ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†å½“ä»»æ„ä¸€ä¸ªCompletableFutureå®Œæˆåï¼Œ åˆ›å»ºä¸€ä¸ªå®Œæˆçš„CompletableFuture.</p><p>å¾…å¤„ç†çš„é˜¶æ®µé¦–å…ˆåˆ›å»ºï¼Œ æ¯ä¸ªé˜¶æ®µéƒ½æ˜¯è½¬æ¢ä¸€ä¸ªå­—ç¬¦ä¸²ä¸ºå¤§å†™ã€‚å› ä¸ºæœ¬ä¾‹ä¸­è¿™äº›é˜¶æ®µéƒ½æ˜¯åŒæ­¥åœ°æ‰§è¡Œ(thenApply), ä»</p><p>anyOf</p><p>ä¸­åˆ›å»ºçš„CompletableFutureä¼šç«‹å³å®Œæˆï¼Œè¿™æ ·æ‰€æœ‰çš„é˜¶æ®µéƒ½å·²å®Œæˆï¼Œæˆ‘ä»¬ä½¿ç”¨</p><p>whenComplete(BiConsumer&lt;? super Object, ? super Throwable> action)</p><p>å¤„ç†å®Œæˆçš„ç»“æœã€‚</p><p><span>static</span></p><p><code>void</code> <code>anyOfExample() {</code></p><p><code>StringBuilder result = </code><code>new</code> <code>StringBuilder();</code></p><p><code>List messages = Arrays.asList(</code><code>"a"</code><code>, </code><code>"b"</code><code>, </code><code>"c"</code><code>);</code></p><p><code>List&lt;CompletableFuture> futures = messages.stream()</code></p><p><code>.map(msg -> CompletableFuture.completedFuture(msg).thenApply(s -> delayedUpperCase(s)))</code></p><p><code>.collect(Collectors.toList());</code></p><p><code>CompletableFuture.anyOf(futures.toArray(</code><code>new</code><code>CompletableFuture[futures.size()])).whenComplete((res, th) -> {</code></p><p><code>if</code><code>(th == </code><code>null</code><code>) {</code></p><p><code>assertTrue(isUpperCase((String) res));</code></p><p><code>result.append(res);</code></p><p><code>}</code></p><p><code>});</code></p><p><code>assertTrue(</code><code>"Result was empty"</code><code>, result.length() > </code><code>0</code><code>);</code></p><p><code>}</code></p><p>18ã€å½“æ‰€æœ‰çš„é˜¶æ®µéƒ½å®Œæˆååˆ›å»ºä¸€ä¸ªé˜¶æ®µ</p><p>ä¸Šä¸€ä¸ªä¾‹å­æ˜¯å½“ä»»æ„ä¸€ä¸ªé˜¶æ®µå®Œæˆåæ¥ç€å¤„ç†ï¼Œæ¥ä¸‹æ¥çš„ä¸¤ä¸ªä¾‹å­æ¼”ç¤ºå½“æ‰€æœ‰çš„é˜¶æ®µå®Œæˆåæ‰ç»§ç»­å¤„ç†, åŒæ­¥åœ°æ–¹å¼å’Œå¼‚æ­¥åœ°æ–¹å¼ä¸¤ç§ã€‚</p><p><code>static</code> <code>void</code> <code>allOfExample() {</code></p><p><code>StringBuilder result = </code><code>new</code> <code>StringBuilder();</code></p><p><code>List messages = Arrays.asList(</code><code>"a"</code><code>, </code><code>"b"</code><code>, </code><code>"c"</code><code>);</code></p><p><code>List&lt;CompletableFuture> futures = messages.stream()</code></p><p><code>.map(msg -> CompletableFuture.completedFuture(msg).thenApply(s -> delayedUpperCase(s)))</code></p><p><code>.collect(Collectors.toList());</code></p><p><code>CompletableFuture.allOf(futures.toArray(</code><code>new</code><code>CompletableFuture[futures.size()])).whenComplete((v, th) -> {</code></p><p><code>futures.forEach(cf -> assertTrue(isUpperCase(cf.getNow(</code><code>null</code><code>))));</code></p><p><code>result.append(</code><code>"done"</code><code>);</code></p><p><code>});</code></p><p><code>ass</code></p><p>19ã€å½“æ‰€æœ‰çš„é˜¶æ®µéƒ½å®Œæˆåå¼‚æ­¥åœ°åˆ›å»ºä¸€ä¸ªé˜¶æ®µ</p><p>ä½¿ç”¨</p><p>thenApplyAsync()</p><p>æ›¿æ¢é‚£äº›å•ä¸ªçš„CompletableFuturesçš„æ–¹æ³•ï¼Œ</p><p>allOf()</p><p>ä¼šåœ¨é€šç”¨æ± ä¸­çš„çº¿ç¨‹ä¸­å¼‚æ­¥åœ°æ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è°ƒç”¨</p><p>join</p><p>æ–¹æ³•ç­‰å¾…å®ƒå®Œæˆã€‚</p><p><code>static</code> <code>void</code> <code>allOfAsyncExample() {</code></p><p><code>StringBuilder result = </code><code>new</code> <code>StringBuilder();</code></p><p><code>List messages = Arrays.asList(</code><code>"a"</code><code>, </code><code>"b"</code><code>, </code><code>"c"</code><code>);</code></p><p><code>List&lt;CompletableFuture> futures = messages.stream()</code></p><p><code>.map(msg -> CompletableFuture.completedFuture(msg).thenApplyAsync(s -> delayedUpperCase(s)))</code></p><p><code>.collect(Collectors.toList());</code></p><p><code>CompletableFuture allOf = CompletableFuture.allOf(futures.toArray(</code><code>new</code><code>CompletableFuture[futures.size()]))</code></p><p><code>.whenComplete((v, th) -> {</code></p><p><code>futures.forEach(cf -> assertTrue(isUpperCase(cf.getNow(</code><code>null</code><code>))));</code></p><p><code>result.append(</code><code>"done"</code><code>);</code></p><p><code>});</code></p><p><code>allOf.join();</code></p><p><code>assertTrue(</code><code>"Result was empty"</code><code>, result.length() > </code><code>0</code><code>);</code></p><p><code>}</code></p><p>20ã€çœŸå®çš„ä¾‹å­</p><p>Now that the functionality of CompletionStage and specifically CompletableFuture is explored, the below example applies them in a practical scenario:</p><p>ç°åœ¨ä½ å·²ç»äº†è§£äº†CompletionStage å’Œ CompletableFuture çš„ä¸€äº›å‡½æ•°çš„åŠŸèƒ½ï¼Œä¸‹é¢çš„ä¾‹å­æ˜¯ä¸€ä¸ªå®è·µåœºæ™¯ï¼š</p><ul class=list-paddingleft-2><li><p>é¦–å…ˆå¼‚æ­¥è°ƒç”¨</p><p>cars</p><p>æ–¹æ³•è·å¾—Carçš„åˆ—è¡¨ï¼Œå®ƒè¿”å›CompletionStageåœºæ™¯ã€‚</p><p>cars</p><p>æ¶ˆè´¹ä¸€ä¸ªè¿œç¨‹çš„REST APIã€‚</p></li><li><p>ç„¶åæˆ‘ä»¬å¤åˆä¸€ä¸ªCompletionStageå¡«å†™æ¯ä¸ªæ±½è½¦çš„è¯„åˆ†ï¼Œé€šè¿‡</p><p>rating(manufacturerId)</p><p>è¿”å›ä¸€ä¸ªCompletionStage, å®ƒä¼šå¼‚æ­¥åœ°è·å–æ±½è½¦çš„è¯„åˆ†(å¯èƒ½åˆæ˜¯ä¸€ä¸ªREST APIè°ƒç”¨)</p></li><li><p>å½“æ‰€æœ‰çš„æ±½è½¦å¡«å¥½è¯„åˆ†åï¼Œæˆ‘ä»¬ç»“æŸè¿™ä¸ªåˆ—è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è°ƒç”¨</p><p>allOf</p><p>å¾—åˆ°æœ€ç»ˆçš„é˜¶æ®µï¼Œ å®ƒåœ¨å‰é¢é˜¶æ®µæ‰€æœ‰é˜¶æ®µå®Œæˆåæ‰å®Œæˆã€‚</p></li><li><p>åœ¨æœ€ç»ˆçš„é˜¶æ®µè°ƒç”¨</p><p>whenComplete()</p><p>,æˆ‘ä»¬æ‰“å°å‡ºæ¯ä¸ªæ±½è½¦å’Œå®ƒçš„è¯„åˆ†ã€‚</p></li></ul><p><code>cars().thenCompose(cars -> {</code></p><p><code>List&lt;CompletionStage> updatedCars = cars.stream()</code></p><p><code>.map(car -> rating(car.manufacturerId).thenApply(r -> {</code></p><p><code>car.setRating(r);</code></p><p><code>return</code> <code>car;</code></p><p><code>})).collect(Collectors.toList());</code></p><p><code>CompletableFuture done = CompletableFuture</code></p><p><code>.allOf(updatedCars.toArray(</code><code>new</code> <code>CompletableFuture[updatedCars.size()]));</code></p><p><code>return</code> <code>done.thenApply(v -> updatedCars.stream().map(CompletionStage::toCompletableFuture)</code></p><p><code>.map(CompletableFuture::join).collect(Collectors.toList()));</code></p><p><code>}).whenComplete((cars, th) -> {</code></p><p><code>if</code> <code>(th == </code><code>null</code><code>) {</code></p><p><code>cars.forEach(System.out::println);</code></p><p><code>} </code><code>else</code> <code>{</code></p><p><code>throw</code> <code>new</code> <code>RuntimeException(th);</code></p><p><code>}</code></p><p><code>}).toCompletableFuture().join();</code></p><p>å› ä¸ºæ¯ä¸ªæ±½è½¦çš„å®ä¾‹éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå¾—åˆ°æ¯ä¸ªæ±½è½¦çš„è¯„åˆ†éƒ½å¯ä»¥å¼‚æ­¥åœ°æ‰§è¡Œï¼Œè¿™ä¼šæé«˜ç³»ç»Ÿçš„æ€§èƒ½(å»¶è¿Ÿ)ï¼Œè€Œä¸”ï¼Œç­‰å¾…æ‰€æœ‰çš„æ±½è½¦è¯„åˆ†è¢«å¤„ç†ä½¿ç”¨çš„æ˜¯</p><p>allOf</p><p>æ–¹æ³•ï¼Œè€Œä¸æ˜¯æ‰‹å·¥çš„çº¿ç¨‹ç­‰å¾…(Thread#join() æˆ– a CountDownLatch)ã€‚</p><p>è¿™äº›ä¾‹å­å¯ä»¥å¸®åŠ©ä½ æ›´å¥½çš„ç†è§£ç›¸å…³çš„API,ä½ å¯ä»¥åœ¨githubä¸Šå¾—åˆ°æ‰€æœ‰çš„ä¾‹å­çš„ä»£ç ã€‚</p><p><strong>#JAVAä»£ç æŸ¥é”™#</strong></p><p>æ­¤å¤„ï¼ŒSomethingç±»çš„æ–‡ä»¶åå«OtherThing.java</p><p>class Something {</p><p>private static void main(String[] something_to_do) {</p><p>System.out.println("Do something ...");</p><p>}è¿™ä¸ªå¥½åƒå¾ˆæ˜æ˜¾ã€‚</p><p>ç­”æ¡ˆ: æ­£ç¡®ã€‚ä»æ¥æ²¡æœ‰äººè¯´è¿‡Javaçš„Classåå­—å¿…é¡»å’Œå…¶æ–‡ä»¶åç›¸åŒã€‚ä½†public classçš„åå­—å¿…é¡»å’Œæ–‡ä»¶åç›¸åŒã€‚</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'å¼‚æ­¥','ç¼–ç¨‹','å®ä¾‹'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>