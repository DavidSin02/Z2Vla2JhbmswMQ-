<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>自语之Mysql隐式提交和事务隔离级别的关系 | 极客快訊</title><meta property="og:title" content="自语之Mysql隐式提交和事务隔离级别的关系 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/dfic-imagehandler/e563bef1-a1b9-42e0-94e6-4cd3de1ed8b8"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3dfec47.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3dfec47.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3dfec47.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3dfec47.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3dfec47.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3dfec47.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3dfec47.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3dfec47.html><meta property="article:published_time" content="2020-10-29T20:50:42+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:42+08:00"><meta name=Keywords content><meta name=description content="自语之Mysql隐式提交和事务隔离级别的关系"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/3dfec47.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>自语之Mysql隐式提交和事务隔离级别的关系</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>前言</p><p>笔者自诩对Mysql的知识积累已经很不错了，现在看来不过是对CRUD操作比较熟悉罢了。</p><p>用了那么久的Mysql, 直到前几日才知道隐式提交和事务隔离级别的联系(内幕)。</p><div class=pgc-img><img alt=自语之Mysql隐式提交和事务隔离级别的关系 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/e563bef1-a1b9-42e0-94e6-4cd3de1ed8b8><p class=pgc-img-caption></p></div><p>那么，什么是隐式提交？</p><ul><li>顾名思义, 就是偷偷的提交事务(手动狗头)。</li><li>讲道理在Mysql中, 开启一个事务后, 需要使用commit关键字进行提交事务，这种提交方式叫做显式提交。但是，我们在当前事务中输入某些语句之后, 会造成当前事务悄悄的提交，那么这种导致事务悄悄提交的情况, 我们称为隐藏提交。</li><li>那么, 触发隐式提交的语句有哪些？</li><li class=ql-indent-1>使用create、alter、delete语句去修改数据库、表、视图、存储过程等数据库对象的时候，就会隐式提交当前事务。</li><li class=ql-indent-1>使用ALTER USER、CREATE USER、DROP USER、GRANT、RENAME USER、REVOKE、SET PASSWORD等语句, 也会触发隐式提交。</li><li>当然有很多操作多会造成隐式提交, 经常使用的则是对数据库表的增、删、改操作。</li></ul><pre>delete ... fromupdate set frominsert into ....复制代码</pre><p>事务并发带来的问题</p><p>在笔者之前的知识体系中, 只是知道事务并发的概念，却不知是Mysql为什么会发生事务的并发。请原谅笔者, 到现在才知道事务的并发，是因为Mysql的C/S架构引起的…..</p><ul><li>事务并发诱因：</li><li>讲道理, Mysql是一个C/S架构, 即客户端/服务器架构。所以，在使用过程中, 肯定会出现多个客户端访问服务器的场景。其中，每一个客户端向服务端发起访问, 可以称为建立一次数据库连接(session会话)。而每一个连接都可以发起数据库的事务。</li><li>所以，不同的数据库连接之间的事务，有可能是并发执行的。</li></ul><p>我们都知道，一旦产生并发有可能会对共享数据的状态，产生巨大的影响。</p><p>对于一次数据库连接而言，当两个事务同时操作同一种表的数据的时候, 可能会产生以下问题：</p><pre>create table X ( id int(10),	name varchar(10));insert into X values(1, '张三');复制代码</pre><ul><li>肮读/写：一个事务能够读取/修改, 另一个事务<strong>未提交</strong>的数据。</li><li>不可重复读：同一个事务内, 根据同一个条件对同一个行记录进行查询，但是搜出来的结果却不一致。</li></ul><div class=pgc-img><img alt=自语之Mysql隐式提交和事务隔离级别的关系 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/22ee89439b2a48f4b6e98169ec29696c><p class=pgc-img-caption></p></div><ul><li><br></li><li>在数据库连接1中, 事务T1根据查询条件id = 1, 查询行记录name的值为张三, 且T1未提交。之后, 在另外一个数据库连接中, 根据条件id = 1, 把行记录name的值更新为李四。</li><li>紧接着, 事务T1根据查询条件id = 1, 再次查询行记录name的值, 结果显示为李四。这种情况, 称为不可重复读。</li><li class=ql-indent-1>注意：在上图的右边更新语句, 触发了隐式提交。</li><li>幻读：同一个事务内, 多次查询相同的条件返回的结果集不一样。</li></ul><div class=pgc-img><img alt=自语之Mysql隐式提交和事务隔离级别的关系 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e9e15890c96d460dadc936465381523d><p class=pgc-img-caption></p></div><ul><li><br></li><li class=ql-indent-1>在数据库连接1中, 事务T1先根据查询H的所有记录, 这时返回结果为张三。之后, 另外一个事务T2对表插入李四这条记录。此时事务T1再次查询H表的所有记录, 返回的结果为张三和李四, 此时发生这种情况称为幻读。</li></ul><p>写到这里, 并发带来的问题差不多描述完了。</p><p>那么, 如何解决事务并发所带来的问题呢？事务的隔离级别, 了解一下!</p><p>事务的隔离级别</p><p>如果, 在事务隔离性方面, 直接一杆子打死。要求，所有的并发事务都必须串行化执行(一个接一个, 即不允许并发), 那么这样做会造成执行效率过低。</p><div class=pgc-img><img alt=自语之Mysql隐式提交和事务隔离级别的关系 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/dfic-imagehandler/2348b504-0096-4119-82a2-1941e94fd188><p class=pgc-img-caption></p></div><p>所以, 在性能和隔离性方面, 我们需要一种折中的办法, 即允许并发问题的出现(脏读、不可重复读、幻读), 根据出现的问题, 设置隔离强度。</p><p>在SQL标准中,具有四种隔离级别, 分别是<strong>读已提交</strong>、<strong>读未提交</strong>、<strong>可重复读</strong>、<strong>可串行化</strong>。</p><ul><li>READ UNCOMMITTED：可能发生脏读、不可重读读、幻读</li><li>READ COMMITTED：解决脏读, 可能会发生不可重复读、幻读</li><li>REPEATABLE READ：解决脏读、不可重复读, 可能发生幻读</li><li>SERIALIZABLE：串行化执行, 并不会发生并发问题。即, 解决脏读, 不可重复读、幻读。</li></ul><p>上述的四种隔离级别, 是所有数据库通用的标准。因为不同数据库, 隔离级别的支持情况并不一样。</p><div class=pgc-img><img alt=自语之Mysql隐式提交和事务隔离级别的关系 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/dfic-imagehandler/183bcb3e-3bef-4009-a7e3-81f69ae19e1f><p class=pgc-img-caption></p></div><p>但是, Mysq包含且支持四种上述的四种隔离级别。</p><p>唯一不同的是, Mysql在可重复读(REPEATABLE READ)的隔离级别下, 是可以解决幻读问题。所以, Mysql的默认隔离级别为可重复读！</p><p>总结</p><ul><li>根据事务并发带来的问题的严重性, 可以适度选择相应的隔离级别来解决。</li><li>脏写是并发事务带来的最最最严重的问题, 所以四种隔离级别中, 直接禁止脏写的出现。</li><li>在Mysql标准中的可重复读, 是可以解决幻读问题。</li><li>幻读主要强调, 使用同一个条件多次进行查询后, 返回之前查询结果中, 没有获取到的记录。</li><li>比如这种场景, 算不算幻读？</li><li class=ql-indent-1>事务T1, 第一次查询得到结果集合：A、B、C、D</li><li class=ql-indent-1>期间, 事务T2, 删除了C、D记录</li><li class=ql-indent-1>事务T2, 第二次查询得到结果集合：A、B</li><li>其实, 上述情况属于不可重复读, 而不是幻读。</li></ul></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'自语','Mysql','隐式'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>