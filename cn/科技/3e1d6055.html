<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>开源物联网平台Thingsboard——（核心章节）第四节规则引擎详解 | 极客快訊</title><meta property="og:title" content="开源物联网平台Thingsboard——（核心章节）第四节规则引擎详解 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/3cbaac454b9745e9b25a5eea118586ca"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3e1d6055.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3e1d6055.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3e1d6055.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3e1d6055.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3e1d6055.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3e1d6055.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3e1d6055.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3e1d6055.html><meta property="article:published_time" content="2020-11-14T20:59:54+08:00"><meta property="article:modified_time" content="2020-11-14T20:59:54+08:00"><meta name=Keywords content><meta name=description content="开源物联网平台Thingsboard——（核心章节）第四节规则引擎详解"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/3e1d6055.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>开源物联网平台Thingsboard——（核心章节）第四节规则引擎详解</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>一、规则引擎是什么？</h1><ul><li>官方解释：“规则引擎由推理引擎发展而来，是一种嵌入在应用程序中的组件，实现了将业务决策从应用程序代码中分离出来，并使用预定义的语义模块编写业务决策。接受数据输入，解释业务规则，并根据业务规则做出业务决策。”</li><li>Thingsboard解释：Thingsboard平台的核心处理引擎，好比一台车子的发动机，是基于事件构建的工作流，是一个高度可定制的框架，用于复杂事件的处理。</li></ul><div class=pgc-img><img alt=开源物联网平台Thingsboard——（核心章节）第四节规则引擎详解 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/3cbaac454b9745e9b25a5eea118586ca><p class=pgc-img-caption>thingsboard规则引擎</p></div><p><br></p><p>二、Thingsboard 规则引擎能力是什么？</p><ul><li>1、在设备数据（实时数据/属性数据）保存到数据库之前，支持对接收的遥测数据或属性数据进行拦截验证和修改；</li><li>2、将设备遥测数据（实时数据）或者设备属性从设备复制到相关资产，以便可以汇总遥测；</li><li>3、自定义告警规则/函数，进行设备告警触发、更新、清除；</li><li>4、根据设备生命周期事件触发操作。如设备上线、设备离线状态，创建告警事件；</li><li>5、加载所需的其他处理数据。在客户设备或租户属性中定义的设备的负载温度阈值；</li><li>7、发生复杂事件时发送电子邮件，并使用“电子邮件模板”中其他实体的属性；</li><li>8、根据定义的条件进行远程设备控制的RPC调用。</li><li>9、将设备实时数据、远程控制RPC指令，或者由规则引擎触发的告警或者事件，推送到与外部消息中间件或者第三方系统（如Kafka，MQTT，RabbitMQ, Spark，AWS服务等等）</li></ul><p>简单的总结：能够用于接收任何事件，可以是来自设备的，设备生命周期事件、REST API事件、RPC请求等的传入；能够处理单个传入消息并生成一个或多个传出消息，发往不同的规则链路进行消息的路由处理，同时可以过滤，丰富，转换传入消息，执行操作或与外部系统通信。</p><p>三、规则引擎的组成有哪几部分？</p><p>1.规则消息（Message）</p><ul><li>作用：用于接收任何事件，可以是来自设备的，设备生命周期事件、REST API事件、RPC请求等的传入</li><li>特点：可以被序列化的有着规定的数据结构，表示系统中的各种消息</li><li>消息组成：消息ID(MessageId)，基于时间的通用唯一标识符；消息发起者（Originator of the Message)，Device,Asset或者其他Entity标识符；消息类型（Type Of the Message），遥测或者不活动的事件；消息负载（Payload of the message），带有实际消息有效负载的json报文；元数据（Metadata），键值对的列表以及消息有关的其他数据。</li><li>消息类型：类型太多不一一列举。如有需要请私信。文档免费共享。</li></ul><div class=pgc-img><img alt=开源物联网平台Thingsboard——（核心章节）第四节规则引擎详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5c8b389162924b489ea445a3fbd3a125><p class=pgc-img-caption>消息类型</p></div><p>2.规则节点（Rule Node）</p><ul><li>是什么？规则节点是规则引擎的基本组件，它一次处理单个传入消息并生成一个或多个传出消息。规则节点是规则引擎的主要逻辑单元。规则节点可以过滤，丰富，转换传入消息，执行操作或与外部系统通信。</li><li>作用：规则节点可以过滤，丰富，转换传入消息，执行操作或与外部系统通信。提供节点自定义能力，实现数据的运算。</li><li>节点间的关系：规则节点可能与其他规则节点相关。每个关系都有关系类型，这是用于标识关系的逻辑含义的标签。当规则节点生成传出消息时，它总是指定用于将消息路由到下一个节点的关系类型。</li><li>规则节点类型：</li></ul><p>a、过滤节点（用于消息过滤和路由，过滤成功走真链、错误走假链）。示例1：script（脚本过滤器节点）使用javascript条件进行消息过滤（消息msg，metadata消息元数据，msgType消息类型）；示例2：switch（交换节点）将传入消息路由到一个或多个输出链，节点执行已配置的JavaScript函数。</p><div class=pgc-img><img alt=开源物联网平台Thingsboard——（核心章节）第四节规则引擎详解 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/8b7f720ae0fa4745a392cf4dcd836308><p class=pgc-img-caption>过滤节点</p></div><p><br></p><p>b、属性集节点：用于更新传入消息的元数据。比如1：消息发起方用户属性（customer attributes），将消息发起方属性信息或者遥测数据加入Metadata元数据中。比如2：设备属性（device attributes），将消息发起方的设备属性或者遥测数据加入metadata。</p><p><br></p><div class=pgc-img><img alt=开源物联网平台Thingsboard——（核心章节）第四节规则引擎详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4db9d54c07f041c2952b12a941852721><p class=pgc-img-caption>属性集节点</p></div><p>c、变换节点：用户更改创立的消息字段，比如，发起方、类型、有效负载，元数据。比如1：脚本转换节点（script），作用：修改消息内容（msg（消息负载）,msgType（消息类型）,metadata（元数据））,可增加，可改。比如2：转换到电子邮件节点（to email），通过使用从消息元数据派生的值填充电子邮件字段，将消息转换为电子邮件消息。设置“ SEND_EMAIL”输出消息类型，以后可以被“ 发送电子邮件节点”接受。可以将所有电子邮件字段配置为使用元数据中的值。</p><p><br></p><div class=pgc-img><img alt=开源物联网平台Thingsboard——（核心章节）第四节规则引擎详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ce037b43228b41dab5ece118bd93eab3><p class=pgc-img-caption>变换节点</p></div><p>d、动作节点：根据传入的消息执行各种动作。比如1：create alarm（创建告警），通过过滤节点中的过滤脚本判断后，对满足条件的消息进行告警的触发。比如2：log（创建日志），对于系统中的关键系统进行日志输出，比如3：rpc call request（远程RPC调用），监控系统rpc请求，下发控制命令请求。</p><p><br></p><div class=pgc-img><img alt=开源物联网平台Thingsboard——（核心章节）第四节规则引擎详解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3b4bedc7aae04dcf94817a40f8f2b91c><p class=pgc-img-caption>动作节点</p></div><p>e、外部节点：提供将消息及数据路由到外部中间件，或者其他第三方云平台中。用于与外部系统进行交互。实例1：kafka(kafka消息中间件)，MQTT(外部MQTT代理)，RabbitMQ,支持将系统中的数据发布到kafka/MQTT代理/RabbitMQ中，供第三方消费者订阅数据。实例2：send email （向外部发送邮件）。实例3：aws sns：将消息发布到aws sns（亚马逊简单消息通知服务，是一种发布\订阅模式的消息收发服务）。</p><p><br></p><div class=pgc-img><img alt=开源物联网平台Thingsboard——（核心章节）第四节规则引擎详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e9f459cc4cae415e8a25eb6b3b7473f1><p class=pgc-img-caption>外部节点</p></div><p><br></p><p>3.规则链（Rule Chain）</p><ul><li>是什么？规则链是规则节点及其关系的逻辑组。接收来自节点的出站消息将其发送至下一个节点。</li><li>用法：租户管理员可以定义一个“ 根”规则链，还可以定义多个其他规则链。根规则链处理所有传入的消息，并将其转发到其他规则链以进行其他处理。其他规则链也可以将消息转发到不同的规则链。</li></ul><p>四、使用特点</p><ul><li>组态化拖拽式布局编辑</li></ul><p>每个规则节点可以具有取决于规则节点实现的特定配置参数。例如，“过滤器-脚本”规则节点可通过处理传入数据的自定义JS函数进行配置。</p><p><br></p><div class=pgc-img><img alt=开源物联网平台Thingsboard——（核心章节）第四节规则引擎详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ea673f6c5e6d4d6484c547ec613cd87c><p class=pgc-img-caption>组态化拖拽式布局</p></div><p><br></p><ul><li>基于调试—事件模式的规则测试</li></ul><p>每个规则节点可以设置为调试模式，启用之后，在事件中可以查看到入站-出站消息</p><p><br></p><div class=pgc-img><img alt=开源物联网平台Thingsboard——（核心章节）第四节规则引擎详解 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/ba4ebb8695e745c48e2b06caabb215db><p class=pgc-img-caption>调试-事件模式</p></div><p><br></p><ul><li>JavaScript函数测试台</li></ul><p>一些规则节点具有特定的UI功能，允许用户测试JS函数。单击“ 测试过滤器功能”后，您将看到JS编辑器，可使用该编辑器替换输入参数并验证函数的输出。</p><p><br></p><div class=pgc-img><img alt=开源物联网平台Thingsboard——（核心章节）第四节规则引擎详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7bc4a575b2b54b219327e38e6a4b26b3><p class=pgc-img-caption>js函数测试台</p></div><ul><li>规则节点可自定义：</li></ul><p>如果thingsboard现有的规则处理节点，无法处理有些定制化业务场景，比如：对于数据进行分类统计，或者分组统计、或者将数据推送到外部Hadoop生态去存储、或者将指定一段时间的数据，生成文件导出，推送到远程服务器上之类的小场景，可以通过自定义规则节点实现。官方预留扩展开发的接口，很容易构建自己的处理逻辑。</p><h1 class=pgc-h-arrow-right>5、总结：</h1><ul><li>本次对于thingsboard的规则引擎的基本概念、可以使用的能力、规则引擎的组成，以及各个规则节点的用法、规则模型的使用特点做了简单的介绍。相信通过本次的讲解，对于规则引擎的基础、能力、用法有了大概的了解，具体的规则引擎的实战讲解，规划在设备物联接入之后，再进行演示。谢谢大家浏览，望大家持续关注，支持原创，成就更好的自己！</li></ul><p>下一节，开源物联网平台Thingsboard——（核心章节）第五节设备物联接入。</p><p></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'开源','物联','网平'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>