<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>python窗口编程-7：收尾与打包 | 极客快訊</title><meta property="og:title" content="python窗口编程-7：收尾与打包 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/5b0c3fb0e053447da70e5d204c0a53ba"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3e78fb28.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3e78fb28.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3e78fb28.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3e78fb28.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3e78fb28.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3e78fb28.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3e78fb28.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3e78fb28.html><meta property="article:published_time" content="2020-10-29T21:10:24+08:00"><meta property="article:modified_time" content="2020-10-29T21:10:24+08:00"><meta name=Keywords content><meta name=description content="python窗口编程-7：收尾与打包"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/3e78fb28.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>python窗口编程-7：收尾与打包</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>一个看似简单的计算器项目，算上这次，我们一共用了六节课才把它讲完整。这次我们解决最后剩下的几个问题，然后将做好的代码制作成EXE文件。并对整个项目做一个总结。</p><p><br></p><div class=pgc-img><img alt=python窗口编程-7：收尾与打包 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5b0c3fb0e053447da70e5d204c0a53ba><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>改变风格</h1><p>前面几节课一直是深棕色风格，不知道大家看得有没有审美疲劳，但一声多少有一点了。好在python开发的窗口程序更改风格比较容易，这次让我们换一个色调的风格。改变风格后，所有默认的颜色都会自动改变，但我们主动设置的颜色却不会变，可以手工调整一下。</p><p><em>这里看到的效果是已经打包成EXE文件后的效果，具体的打包方法后面介绍。</em></p><div class=pgc-img><img alt=python窗口编程-7：收尾与打包 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/81cfa013ae994fd6ab20512a908e8c94><p class=pgc-img-caption></p></div><p><br></p><pre><code>sg.theme('GreenMono')funColor= '#239221'textColor= 'green'</code></pre><p>代码中更换了主题风格（theme），把功能键的颜色（funColor）和文本框的颜色（textColor）都重新定义了。</p><p>我们注意到，颜色的定义，都是一个字符串。但内容既可以用颜色的英文名（'green'），也可以用更加精确的RGB方式来定义（'#239221'）。具体地说：开头必须为#，后面跟6个数字，2位一段，分为三段，分别代表红色R，绿色G，蓝色B的成分。数字是<strong>十六进制</strong>的，最小是00，最大是FF。</p><div class=pgc-img><img alt=python窗口编程-7：收尾与打包 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/662889cb2f7d4575ac2914a886f9993b><p class=pgc-img-caption>颜色设置改为变量</p></div><p>以前代码中，设置颜色背景按钮的地方，我们用的是常量，现在的修改，我们把它改为变量。因为它<strong>既然能够改变一次，就有可能改变第二次</strong>。以后再改变按钮，我们就只须改一个地方就可以了。朋友们如果想调整按钮文字的颜色，可以做类似的修改。</p><h1 class=pgc-h-arrow-right>涉及小数的计算</h1><p>从我们代码的内部机制来看，涉及小数的计算没有什么大问题，虽然<strong>浮点数不够精确</strong>，对于我们这个只有12位数码的显示屏的计算器来说，也够用了。唯一的问题是显示问题。</p><p>由于我们的显示屏宽度有限，所以如果结果是一个小数，那么我们该显示小数点后面多少位呢？</p><p>比较合理的是这样一个逻辑：首先保证整数部分完全显示，剩下的宽度，有多少位就给小数部分多少位，最后一位四舍五入即可。</p><p>对于无限小数，这个逻辑没有问题。但对于有限小数来说，就不合理了。9/6=1.5，不应当显示为1.5000000（如果是按键输入当然可以）。所以逻辑补充：小数部分按分配的位数显示时，舍去末尾的0。</p><p>上面这个逻辑，是自然语言描述的，我们看看它翻译为python语言是什么样。</p><p><em><strong>话说，作为一个编程者，我们的工作在某种意义上，很像一个翻译，不是么？</strong></em></p><pre><code>if isinstance(result, float):    # 第一次显示小数，保留20位小数，实际我们只关心整数    str1= '%.20f'%result    # 计算有多少位整数    v1= len(str1.split(".")[0])    if v1&lt;11:        # 四舍五入到保留的小数位11-v1        result= round(result, 11-v1)        # 再次显示小数，按最大可分配的位数，这次关注小数尾有多少个0        str1= ('%%.%df'%(11-v1))%result        # 舍去结尾的0，得到正确小数位        decNum= len(str1.strip('0').split(".")[1])+1    else:        # 如果整数位超范围，简单粗暴置0        result= 0        decNum= 0else:    # 如果是整数，并且超范围，简单粗暴置0    str1= '%d'%result    v1= len(str1)    if v1&gt;11:        result=0</code></pre><p>详细的讲解，请看代码中的注释。文章里重点讲三个新引入的字符串用法。</p><ol start=1><li>字符串切割（split）这个功能将一个字符串以某个字符（参数）为标记，切分成一个列表。对于小数来说，以小数点为标记的切割，第一个（编号[0]）是整数部分，第二个（编号[1]）就是小数了部分。</li><li>字符串削皮（strip）这个功能，是去掉字符串两边的指定字符（参数），严格来说，这里为了去掉小数尾部的0，可以用rstrip（strip, lstrip, rstrip）但这里因为并不关心左边，所以strip也得到正确的结果。</li><li>连百分号（%%），前面课程学到%d，%f都具有特殊含义，如果是两个连续的百分号%%，就代表%本身了。这样可以把动态的字符串写在一行代码中。<em>这种技巧多了，代码会更简短，但人类阅读起来就更加难懂了</em>。</li></ol><p>关于超范围的处理，当然还有其它的方法，有兴趣可以自己创意。比如：再增加一个状态error，在error状态下，屏幕给出相应提示。</p><p><br></p><div class=pgc-img><img alt=python窗口编程-7：收尾与打包 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0e16afc73da84703bd9c303d5c18305f><p class=pgc-img-caption></p></div><p>现在的效果是，如果运算的结果足够大，会直接变成0；而当小数运算时，如果数字足够小，也会直接变成0。</p><h1 class=pgc-h-arrow-right>被0除的问题</h1><p>数位超长，并不是一个真正的错误。在我们所提供的计算功能中，还真有一个出错的可能，就是被0除。如果我们点击9/0=这组按钮，程序会报错。如果计算功能更加复杂，比如我们开发的是一个科学计算器，那就有更多的出错可能了（比如试图计算负数的对数等）。</p><p>让程序报出内部错误，不像是一个正规软件的作为。我们应当在代码中捕获这种错误，并进行相应的提示和处理。</p><pre><code>try:    result= opnd1/ opnd2except BaseException:    result=0</code></pre><p>这里我们就看到了python编程中的错误捕获代码try...except。在解决问题的逻辑中，可以完全没有try...except的存在，但在稍微复杂一点的实际应用中，我们到处会发现 try...except 的身影。这说明<strong>解决问题（在大多数情况下）其实只是很简单是一件事</strong>。全面地考虑各种可能出现的问题，才是复杂的地方。</p><p>这里的BasicException代表任何错误，说明我们不关心实际出错的细节，只是急于把结果简单置0。这当然这样处理并不严谨，只是因为异常捕获的问题不是本节课的重点。我们现在只需记住有这样一种表达方法即可。</p><p>这与我们开车有点类似：开车本身并不难，直接地解决问题就如同沿着笔直的大路驾驶，即使是新手也能做得很好；真正的麻烦是处理各种可能的错误，就如同驾驶过程中出现的各种突发事件（前车忽然急刹、有人强行并线等等），那才是老司机展示能力的领域。</p><p>引申一下：如果你当前编程学习的状态是不断提升解决问题的能力，这是一个很有趣的世界，希望你能感受到编程学习的乐趣；如果你发现几乎已经没有问题不能解决，恭喜你来到真实世界（<strong>Welcome to the real world.</strong>），可以开始用编程语言和这个世界对话了。</p><h1 class=pgc-h-arrow-right>编译成EXE发布</h1><p>做出一个完整的窗口界面程序，我们就会希望制作成EXE并与他人分享，这个时候我们的程序就可以叫做一个“<strong>软件产品</strong>”了。如果你做的这个软件真的能解决一些实际的问题，说不定真的会流行起来（那就是另一个领域的话题了）。</p><p><em>“打包”这个词语，我们理解它的本意是：打成一个完整的包裹，便于发布。所以，把python源代码做成EXE的过程，可以算是“<strong>打包</strong>”。如果你的程序除了可运行的EXE文件，还有其它资源文件，打包一般就指制作安装文件。因为我们的计算器软件只包含一个EXE可运行文件，所以把它进一步压缩成一个ZIP或RAR文件，也就可以算是一个绿色安装包了。所以压缩文件，有时也称打包。下文为了简便，说打包一概指制作EXE文件。</em></p><p><strong>1、安装pyInstaller</strong></p><p>python默认没有打包功能，需安装pyInstaller库，执行安装代码如下：</p><pre><code>pip install pyinstaller -i https://pypi.doubanio.com/simple/</code></pre><p>如果代码执行过程出错，出现这样的提示</p><blockquote><p>error: invalid command 'bdist_wheel'</p></blockquote><p>则须先安装一下 wheel工具，代码如下：</p><pre><code>pip3 install wheel</code></pre><p>然后再次用前面的代码安装pyInstaller即可</p><p><strong>2、生成EXE</strong></p><p>生成窗口EXE的一般指令是：</p><pre><code>pyinstaller -wF calc.py</code></pre><p>在Python代码的目录下，打开命令行窗口，执行即可。</p><p>如果想使用自带的图标也是可以的。首先找到一个图标文件（扩展名是.ico），有些资源网站会提供这类资源。将这个文件与python代码放在同一个目录下，执行指令：</p><pre><code>pyinstaller -i calc.ico -wF calc.py</code></pre><p>这样，生成的EXE文件，就带有你选择的图标了。</p><p><br></p><div class=pgc-img><img alt=python窗口编程-7：收尾与打包 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3db5624dd88b4feaa477b1a0aa20e27b><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>项目总结</h1><p>如果有可能，每个项目做一个总结，对提高编程能力会有很大帮助。我们从这个计算器项目中，学习了这样一些知识：</p><ul><li>用Python描述复杂窗口界面布局的方法</li><li>窗口主题风格的设置</li><li>标准的窗口软件的事件逻辑</li><li>数学中整数和小数的数位在编程中是怎样实现的</li><li>通过设置状态变量，来描述复杂的程序逻辑</li><li>捕获错误并进行处理的基本方法</li><li>将Python程序打包成EXE的方法</li><li>以及一些字符串处理的常用函数等</li></ul><p>希望通过这个项目的开发实践，朋友们能够理解python窗口编程的基本方法，并体验一个小规模项目开发的完整过程。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'python','编程','收尾'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>