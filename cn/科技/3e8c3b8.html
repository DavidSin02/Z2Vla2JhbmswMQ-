<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>详解编程中的同步和异步 | 极客快訊</title><meta property="og:title" content="详解编程中的同步和异步 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/b292fb03b256422bb94215ce3ec3bbaf"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3e8c3b8.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3e8c3b8.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3e8c3b8.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3e8c3b8.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3e8c3b8.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3e8c3b8.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3e8c3b8.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3e8c3b8.html><meta property="article:published_time" content="2020-10-29T20:58:13+08:00"><meta property="article:modified_time" content="2020-10-29T20:58:13+08:00"><meta name=Keywords content><meta name=description content="详解编程中的同步和异步"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/3e8c3b8.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>详解编程中的同步和异步</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>本文主要总结一些自己对异步的理解，话不多说 下面开始。</p><h1 class=pgc-h-arrow-right>一. 单线程</h1><p>我们常说“JavaScript是单线程的”，所谓单线程，是指在JS引擎中负责解释和执行JavaScript代码的线程只有一个。不妨叫它<strong>主线程</strong></p><p>但是实际上还存在其他的线程。例如：处理AJAX请求的线程、处理DOM事件的线程、定时器线程、读写文件的线程(例如在Node.js中)等等。这些线程可能存在于JS引擎之内，也可能存在于JS引擎之外，在此我们不做区分。不妨叫它们<strong>工作线程</strong>。</p><p><strong>说白了单线程就是在一段时间内只能处理一件事情，然后才能接下来完成其他的事情</strong></p><h1 class=pgc-h-arrow-right>二. 同步和异步</h1><p><strong>同步</strong>：如果在函数返回的时候，调用者就能够得到预期结果(即拿到了预期的返回值或者看到了预期的效果)，那么这个函数就是同步的。</p><p>例：</p><pre><code>Math.sqrt(2);console.log('Hi');</code></pre><p>第一个函数返回时，就拿到了预期的返回值：2的平方根。</p><p>第二个函数返回时，就看到了预期的效果：在控制台打印了一个字符串。</p><p><strong>上面这种 普通的函数 执行后 紧跟着就可以拿到结果。</strong></p><p><strong>异步</strong>：如果在函数A返回的时候，调用者还不能够得到预期结果，而是需要在将来通过一定的手段得到，那么这个函数就是异步的。</p><p>例如：</p><pre><code>fs.readFile('foo.txt','utf8',function(err, data){console.log(data);});</code></pre><p>在上面的代码中，我们希望通过fs.readFile函数读取文件foo.txt中的内容，并打印出来。</p><p>但是在fs.readFile函数返回时，我们期望的结果并不会发生，而是要等到文件全部读取完成之后。如果文件很大的话可能要很长时间。</p><p><strong>下面以AJAX请求为例，来看一下同步和异步的区别：</strong></p><p>异步AJAX：</p><p><br></p><div class=pgc-img><img alt=详解编程中的同步和异步 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b292fb03b256422bb94215ce3ec3bbaf><p class=pgc-img-caption></p></div><p>同步AJAX：</p><p><br></p><div class=pgc-img><img alt=详解编程中的同步和异步 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/47f68b6990a84acea7cbd53691ea3e6c><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right>三. 异步过程的构成要素</h1><p>从上文可以看出，异步函数实际上很快就调用完成了。但是后面还有工作线程执行异步任务、通知主线程、主线程调用回调函数等很多步骤。我们把整个过程叫做异步过程。异步函数的调用在整个异步过程中，只是一小部分。</p><p><strong>总结一下，一个异步过程通常是这样的：</strong></p><p>主线程发起一个异步请求，相应的工作线程接收请求并告知主线程已收到(异步函数返回)；主线程可以继续执行后面的代码，同时工作线程执行异步任务；工作线程完成工作后，通知主线程；主线程收到通知后，执行一定的动作(调用回调函数)。</p><p><strong>从主线程的角度看，一个异步过程包括下面两个要素：</strong></p><p>1.发起函数(或叫注册函数)A</p><p>2.回调函数callbackFn</p><p>它们都是在主线程上调用的，其中注册函数用来发起异步过程，回调函数用来处理结果。</p><h1 class=pgc-h-arrow-right>四. 消息队列和事件循环</h1><p>上文讲到，异步过程中，工作线程在异步操作完成后需要通知主线程。那么这个<strong>通知机制</strong>是怎样实现的呢？答案是利用消息队列和事件循环。</p><p><strong>用一句话概括：</strong></p><p>工作线程将消息放到消息队列，主线程通过事件循环过程去取消息。</p><p><strong>消息队列</strong>：消息队列是一个先进先出的队列，它里面存放着各种消息。</p><p><strong>事件循环</strong>：事件循环是指主线程重复从消息队列中取消息、执行的过程。</p><p>实际上，主线程只会做一件事情，就是从消息队列里面取消息、执行消息，再取消息、再执行。当消息队列为空时，就会等待直到消息队列变成非空。而且主线程只有在将当前的消息执行完成后，才会去取下一个消息。这种机制就叫做事件循环机制，取一个消息并执行的过程叫做一次循环。</p><p><strong>用图表示这个过程就是：</strong></p><p><br></p><div class=pgc-img><img alt=详解编程中的同步和异步 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/25523f2970484bff8b8b8574a019c8b0><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right>五. 异步与事件</h1><p>上文中说的“事件循环”，为什么里面有个事件呢？那是因为：</p><p>消息队列中的每条消息实际上都对应着一个事件。</p><p>上文中一直没有提到一类很重要的异步过程：<strong>DOM事件</strong>。</p><p>举例来说：</p><pre><code>varbutton =document.getElement('#btn');button.addEventListener('click',function(e){console.log();});</code></pre><p>从事件的角度来看，上述代码表示：在按钮上添加了一个鼠标单击事件的事件监听器；当用户点击按钮时，鼠标单击事件触发，事件监听器函数被调用。</p><p>从异步过程的角度看，addEventListener函数就是异步过程的发起函数，事件监听器函数就是异步过程的回调函数。事件触发时，表示异步任务完成，会将事件监听器函数封装成一条消息放到消息队列中，等待主线程执行。</p><p><strong>事件</strong>的概念实际上并不是必须的，事件机制实际上就是异步过程的通知机制。我觉得它的存在是为了编程接口对开发者更友好。</p><p>另一方面，所有的异步过程也都可以用事件来描述。例如：setTimeout可以看成对应一个时间到了！的事件。前文的setTimeout(fn, 1000);可以看成：</p><pre><code>timer.addEventListener('timeout', 1000, fn);</code></pre><h1 class=pgc-h-arrow-right>六. 生产者与消费者</h1><p>工作线程是生产者，主线程是消费者(只有一个消费者)。工作线程执行异步任务，执行完成后把对应的回调函数封装成一条消息放到消息队列中；主线程不断地从消息队列中取消息并执行，当消息队列空时主线程阻塞，直到消息队列再次非空。</p><h1 class=pgc-h-arrow-right>七. 总结一下</h1><p>最后再用一个生活中的例子总结一下同步和异步：在公路上，汽车一辆接一辆，有条不紊的运行。这时，有一辆车坏掉了。假如它停在原地进行修理，那么后面的车就会被堵住没法行驶，交通就乱套了。幸好旁边有应急车道，可以把故障车辆推到应急车道修理，而正常的车流不会受到任何影响。等车修好了，再从应急车道回到正常车道即可。唯一的影响就是，应急车道用多了，原来的车辆之间的顺序会有点乱。</p><p>这就是同步和异步的区别。同步可以保证顺序一致，但是容易导致阻塞；异步可以解决阻塞问题，但是会改变顺序性。改变顺序性其实也没有什么大不了的，只不过让程序变得稍微难理解了一些 :)</p><blockquote class=pgc-blockquote-abstract><p>作者：webj<br>链接：https://www.jianshu.com/p/1734963f6f0b<br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'详解','编程','异步'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>