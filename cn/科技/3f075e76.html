<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Python Selenium破解滑块验证码最新版 | 极客快訊</title><meta property="og:title" content="Python Selenium破解滑块验证码最新版 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/e96151e103f840a089fd27281f201aaf"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f075e76.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f075e76.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3f075e76.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f075e76.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f075e76.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3f075e76.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3f075e76.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f075e76.html><meta property="article:published_time" content="2020-11-14T20:55:11+08:00"><meta property="article:modified_time" content="2020-11-14T20:55:11+08:00"><meta name=Keywords content><meta name=description content="Python Selenium破解滑块验证码最新版"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/3f075e76.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Python Selenium破解滑块验证码最新版</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><strong>通过率高达百分之95！真的强！</strong></p><h1 class=pgc-h-arrow-right>一、滑块验证码简述</h1><p style=text-align:start>有爬虫，自然就有反爬虫，就像病毒和杀毒软件一样，有攻就有防，两者彼此推进发展。而目前最流行的反爬技术验证码，为了防止爬虫自动注册，批量生成垃圾账号，几乎所有网站的注册页面都会用到验证码技术。其实验证码的英文为 CAPTCHA（Completely Automated Public Turing test to tell Computers and Humans Apart），翻译成中文就是全自动区分计算机和人类的公开图灵测试，它是一种可以区分用户是计算机还是人的测试，只要能通过 CAPTCHA 测试，该用户就可以被认为是人类。由此也可知道破解滑块验证码的关键即是让计算机更好的模拟人的行为，这也是破解的难点所在。</p><h1 class=pgc-h-arrow-right>二、环境配置</h1><h1 class=pgc-h-arrow-right>1.安装</h1><p style=text-align:start>selenium 支持 python2.7 以及 python3.5 等主流 python 版本，其安装较为简单，有网的环境下，打开cmd输入即可自动安装: pip install selenium</p><h1 class=pgc-h-arrow-right>2.webdriver</h1><p style=text-align:start>selenium 安装完成后，下载所选浏览器的 webdriver，本文以 ChromeDriver为例，下载解压后切记将.exe文件放入对应Python应用程序的同级目录下，以确保将 webdriver 的路径添加至系统 PATH 变量中。同时还需将.exe文件放入Chrome应用程序的同级目录下，注意下载的ChromeDriver版本需与Chrome浏览器版本对应才可使用。ChromeDriver下载地址</p><h1 class=pgc-h-arrow-right>3.相关库与模板</h1><pre><code>#图像处理标准库from PIL import Image   #web测试from selenium import webdriver#鼠标操作from selenium.webdriver.common.action_chains import ActionChains#等待时间 产生随机数 import time,random</code></pre><h1 class=pgc-h-arrow-right>三、破解步骤</h1><p style=text-align:start>本文以春秋官网为例：</p><ol start=1><li>保存滑块验证码原图到本地。</li><li>利用selenium进入滑块验证码页面，截取所需页面图片。</li><li>通过图片像素对比分析获取缺口位置与滑块移动距离。</li><li>机器模拟人工滑动轨迹。</li></ol><h1 class=pgc-h-arrow-right>四、代码实现</h1><p style=text-align:start>首先通过selenium对网页元素爬取进入滑块验证码页面</p><blockquote class=pgc-blockquote-abstract><p>#打开页面至屏幕最大尺寸</p><p>driver = webdriver.Chrome()</p><p>driver.get('https://account.ch.com/NonRegistrations-Regist')</p><p>driver.maximize_window()</p><p>#获取输入手机号码的表单</p><p>input1 = driver.find_element_by_name('phoneNumberInput')</p><p># 输入注册号码</p><p>input1.send_keys(phoneNumber)</p><p>time.sleep(0.2)</p><p>#获取打开滑块验证码页面的元素</p><p>getcheck=driver.find_element_by_id('getDynamicPwd')</p><p>#点击进入滑块验证码页面</p><p>getcheck.click()</p><p><br></p></blockquote><div class=pgc-img><img alt="Python Selenium破解滑块验证码最新版" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e96151e103f840a089fd27281f201aaf><p class=pgc-img-caption></p></div><p>上周国内最大的验证码平台极验（GEETEST）进行了滑块验证码更新，向反爬虫又迈进了一步，新浪、斗鱼等使用极验验证码的各大网站页也随之更新，当然春秋也不例外，此次更新显然是针对了破解滑块验证码的关键痛点，在此之前点击获取验证码，出现滑块验证码界面之后并不会直接出现滑块，此时可对屏幕进行截图，当点击滑动圆球之后才会出现滑块与缺口，此时再次进行截图，即可根据两次截图的像素RGB值逐一遍历，找到缺口位置。但更新之后点击获取验证码，直接会出现滑块与缺口，如图1所见。问题来了，现在没有原图作为参照，怎么找到缺口位置呢？？？仔细一想，其实这个问题并不难，无非就是需要一张原图作为参照，经过观察发现每个网站的验证码背景图片不过区区几张，那么我们可以考虑通过人工滑动滑块，在成功拼图后出现完整原图的那一瞬间进行屏幕截图，将原图逐一截图保存至本地，再通过缺口图片与本地保存的原图进行像素RGB值匹配，原图岂不速速现出原形，缺口图圆球需滑至最右再进行截图，下文详细解释。</p><pre><code># 获取拖拽的圆球slideblock = driver.find_element_by_class_name('geetest_slider_button')# 鼠标点击圆球不松开ActionChains(driver).click_and_hold(slideblock).perform()# 将圆球滑至相对起点位置的最右边ActionChains(driver).move_by_offset(xoffset=250, yoffset=0).perform()time.sleep(0.4)# 保存包含滑块及缺口的页面截图driver.save_screenshot('D:\quekou.png')# 放开圆球ActionChains(driver).release(slideblock).perform()#打开保存至本地的缺口页面截图quekouimg=Image.open('d://quekou.png')# 匹配本地对应原图sourceimg=match_source(quekouimg)def match_source(image):    imagea=Image.open('d://source1.png')    imageb=Image.open('d://source2.png')    imagec=Image.open('d://source3.png')    imaged=Image.open('d://source4.png')    list=[imagea,imageb,imagec,imaged]    #通过像素差遍历匹配本地原图    for i in list:       #本人电脑原图与缺口图对应滑块图片横座标相同，纵座标原图比缺口图大88px，可根据实际情况修改        pixel1=image.getpixel((868,340))        pixel2=i.getpixel((868,428))        #pixel[0]代表R值，pixel[1]代表G值，pixel[2]代表B值        if abs(pixel1[0]-pixel2[0])&lt;5:           return i    return image</code></pre><p>为了更快捷获取滑块移动距离，我们可以考虑将滑块先滑至最右端再进行截图，因为采用从左往右对比遍历的方式，采用这种方式能保证第一次获取到的便是缺口位置，由于滑块起点相同，此种方法可减少计算滑块大小这一步（毕竟滑块大小计算也是通过像素遍历，没必要再计算一次）。</p><pre><code># 获取缺口位置visualstack=get_diff_location(sourceimg,quekouimg)# 获取移动距离loc，827为滑块起点位置loc=visualstack-827# 计算滑块位移距离def get_diff_location(image1,image2):    #（825,1082）（335,463）为滑块图片区域，可根据实际情况修改    for i in range(825,1082):        for j in range(335,463):            #遍历原图与缺口图像素值寻找缺口位置            if is_similar(image1,image2,i,j)==False:               return i    return -1# 对比RGB值得到缺口位置def is_similar(image1,image2,x,y):    pixel1=image1.getpixel((x, y+88))    pixel2=image2.getpixel((x, y))    # 截图像素也许存在误差，50作为容差范围    if abs(pixel1[0]-pixel2[0])&gt;=50 and abs(pixel1[1]-pixel2[1])&gt;=50 and abs(pixel1[2]-pixel2[2])&gt;=50:        return False    return True</code></pre><p>接下来，破解滑块验证码最关键也最难的一步来了，机器模拟人工滑动轨迹，或许你可以精准滑动到缺口位置，但还是会被识别为机器被怪物吃掉拼图，本人在测试的时候也是一把辛酸泪，最后经过不断调试学习，得到一种通过率还OK的滑动轨迹算法，即采用物理加速度位移相关公式按照先快后慢的人工滑动规律进行轨迹计算，同时还采用了模拟人滑动超过了缺口位置再滑回至缺口的情况以使轨迹更契合人工滑动轨迹。由于项目时间有限，本人就没花过多时间研究了，如果想要99%通过率可以尝试机器学习，采集人工滑动轨迹进行曲线拟合的方法获取轨迹。</p><pre><code>#滑块移动轨迹def get_track(self,distance):    track=[]    current=0    mid=distance*3/4    t=random.randint(2,3)/10    v=0    while current&lt;distance:          if current&lt;mid:             a=2          else:             a=-3          v0=v          v=v0+a*t          move=v0*t+1/2*a*t*t          current+=move          track.append(round(move))    return track# 生成拖拽移动轨迹，加3是为了模拟滑过缺口位置后返回缺口的情况track_list=get_track(loc+3)time.sleep(2)ActionChains(driver).click_and_hold(slideblock).perform()time.sleep(0.2)# 根据轨迹拖拽圆球for track in track_list:    ActionChains(driver).move_by_offset(xoffset=track,yoffset=0).perform()# 模拟人工滑动超过缺口位置返回至缺口的情况，数据来源于人工滑动轨迹，同时还加入了随机数，都是为了更贴近人工滑动轨迹imitate=ActionChains(driver).move_by_offset(xoffset=-1, yoffset=0)time.sleep(0.015)imitate.perform()time.sleep(random.randint(6,10)/10)imitate.perform()time.sleep(0.04)imitate.perform()time.sleep(0.012)imitate.perform()time.sleep(0.019)imitate.perform()time.sleep(0.033)ActionChains(driver).move_by_offset(xoffset=1, yoffset=0).perform()# 放开圆球ActionChains(driver).pause(random.randint(6,14)/10).release(slideblock).perform()time.sleep(2)#务必记得加入quit()或close()结束进程，不断测试电脑只会卡卡西driver.close()</code></pre><p>至此，小白破解滑块验证码就算基本了结，整个步骤看起来挺简单的，但其中的坑大概只有实践才会知道，出BUG之后第一件事请认真检查你的代码，不要放过任何一个地方，参数、范围、返回值、取值等等，甚至可能是你最觉得没问题的地方，往往是问题所在……over</p><p style=text-align:start><strong>此文转载文 原作者：</strong>PANDA 如有侵权联系小编删除</p><p style=text-align:start><strong>如需获取源码私信小编01</strong></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'最新版','Python','Selenium'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>