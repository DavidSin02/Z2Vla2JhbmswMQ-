<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>思科访问控制列表(ACL)设置，控制网络访问 | 极客快訊</title><meta property="og:title" content="思科访问控制列表(ACL)设置，控制网络访问 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/4a1afd30bb704aeca0e37c1ba4905a9a"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f17315.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f17315.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3f17315.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f17315.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f17315.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3f17315.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3f17315.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f17315.html><meta property="article:published_time" content="2020-10-29T21:05:53+08:00"><meta property="article:modified_time" content="2020-10-29T21:05:53+08:00"><meta name=Keywords content><meta name=description content="思科访问控制列表(ACL)设置，控制网络访问"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/3f17315.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>思科访问控制列表(ACL)设置，控制网络访问</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>一、访问控制列表的作用：</p><p>过滤：通过过滤经过路由器的数据包来管理IP流量</p><p>分类：标识流量以进行特殊处理</p><p>ACL在作用的时候有两个动作，即允许和拒绝。</p><p>允许或拒绝经过路由器的数据包</p><p>允许或拒绝来自路由器或到路由器的vty访问</p><p>如果没有ACL，所有数据包会发往网络的所有部分。</p><p>配置完以后一定要记得调用ACL的访问控制列表。</p><p>二、访问列表的分类：</p><p>*标准 检查源地址.通常允许、拒绝的是完整的协议</p><p>*扩展 检查源地址和目的地址、通常允许、拒绝的是某个特定的协议</p><p>*进方向和出方向</p><p>出方向 先查路由表，如果有去往目的网段的路由，就转到出接口，如果出接口调用了访问控制列表ACL，那么就看是否和ACL的访问控制列表匹配，是允许permit还是拒绝deny，如果是允许，就根据路由表转发数据，如果是拒绝就直接将数据包丢弃了。</p><p>入方向 当入接口收到数据包的时候，先跟入接口的ACL访问控制列表进行匹配，如果允许则查看路由表从而进行转发，如果拒绝则直接丢弃。</p><p>而在这个deny的机制中，有一条隐藏的deny所有报文的语句。也就是说，当接收到的数据包和前面所有的访问控制列表ACL都不匹配的时候，则就会触发这条隐藏的命令。</p><p>三、如何来标识ACL</p><p>标准编号IPV4列表（1-99）可测试源地址的所有IP数据包的条件。扩展范围是（1300-1999）</p><p>扩展编号IPV4列表（100-199）可测试源地址和目的地址、特定TCP/IP协议和目的端口条件。扩展范围（2000-2699）</p><p>命名ACL用字母数字字符串（名称）标识IP标准ACL和扩展ACL。</p><div class=pgc-img><img alt=思科访问控制列表(ACL)设置，控制网络访问 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4a1afd30bb704aeca0e37c1ba4905a9a><p class=pgc-img-caption></p></div><p>四、配置标准访问控制列表的命令：</p><p>标准访问控制列表可以用来匹配：</p><p>1用来匹配源地址和目标地址</p><p>2用来匹配远程登录</p><p>标准访问控制列表建议配在接近于目标的位置，因为如果配置在接近于源的目标的位置，那么发出来的报文就会立刻被deny掉了，而且数据包不仅发送不到目标位置，甚至连接近于源的目标位置以外的其他的路由器也发送不到了，都不可以访问了。所以标准访问控制列表一定要放在接近于目标的位置。</p><p><br></p><p>实验一：</p><p><br></p><p>RouterX(config)#access-listaccess-list-number {permit|deny} sourse [mark]</p><p>Permit：允许。Deny：拒绝。Sourse：源地址。Mark：反掩码。</p><p>R3(config)#access-list 1 deny 192.168.1.0 0.0.0.255 意思就是只要是192.168.1.0网段的（1-254）的IP地址发过来的数据包都会被拒绝。</p><p>接着要写一个permit语句去保证允许其他网段的数据报文可以通过。</p><p>即：R3(config)#access-list 1 permit 0.0.0.0 255.255.255.255</p><p>当然 0.0.0.0 255.255.255.255 代表所有网段也可以用 any 来表示。</p><p>即：R3(config)#access-list 1 permit any 可以这样来写，也是可以生效的。</p><p>隐藏的deny所有的命令：R3(config)#access-list 1 deny any</p><p>所以要记得相反的permit允许其他所有的命令：R3(config)#access-list1 deny any</p><div class=pgc-img><img alt=思科访问控制列表(ACL)设置，控制网络访问 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/cf695673360c49dea3384f207b782e3e><p class=pgc-img-caption></p></div><p>1.然后在接口下来掉用这个访问控制列表ACL"</p><p>RouterX(config-if)#ipaccess-group access-list-number {in|out} 标识是出方向还是入方向</p><p>如果用192.168.1.2来ping192.168.2.2则可以是R3的F0/1的入方向或者F0/0的出方向。</p><p>R3(config)#interfacef0/1</p><p>R3(config-if)#ipaccess-gourp 1 in 同样建议配置在in方向，因为可以少一次查询的动作。</p><p>到这里访问控制列表ACL就调用成功了，这个时候在去ping就会告诉你目的主机不可达。</p><p>即：Destination host unreachable。</p><p>2.可以通过show access-lists来产看到当前所被deny掉的数据状态。</p><div class=pgc-img><img alt=思科访问控制列表(ACL)设置，控制网络访问 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1e42252552d4462f99ee5d9ae7738a62><p class=pgc-img-caption></p></div><p>3.删除访问控制列表：</p><p>R3(config)#no access-list 1 它会将之前配置的deny的语句和permit any的语句在访问控制列表1里面同时删除。</p><p>4.如果是只是deny某一个IP地址的数据报文，可以使用完全匹配的方式：</p><p>即：R3(config)#access-list 1 deny 192.168.1.2 0.0.0.0 这样后面的四个零就是完全匹配的意思。当然这个四个零0.0.0.0 也可以用host 来表示：</p><p>即：R3(config)#access-list1 deny host 192.168.1.2</p><p>而为了能让其他的数据能够被转发，所以必须要加上permit any的命令，以便让其他的报文可以通过。</p><p><br></p><p>即：R3(config)#access-list 1 deny host 192.168.1.2</p><p>R3(config)#access-list 1 permit any</p><p>此外，因为在输入访问控制列表的时候，是按照输入的顺序来进行排列的，所有如果将permit any或者deny any语句放在具体的permit或者deny语句之前，即：</p><p>先配置了R3(config)#access-list1 permit any</p><p>再配置了R3(config)#access-list1 deny host 192.168.1.2</p><p>就会发现，后面配置的"R3(config)#access-list1 deny host 192.168.1.2"完全没有生效，报文依旧可以转发。</p><p>所以在配置的时候一定要注意先后的顺序，严谨的放在后面。</p><p>实验二：</p><p>如果在R3上配置远程管理：</p><p>R3(config)#line vty 04</p><p>R3(config-line)#passwordcisco</p><p>R3(config-line)#login</p><p>R3(config-line)#exit</p><p>R3(config)#enable password cisco</p><p>然后不允许192.168.1.2来远程访问R3，则:</p><p>R3(config)#access-list 1 deny host 192.168.1.2</p><p>R3(config)#access-list 1 permit any</p><p>但是调用的时候则是在line下面来调用的：</p><p>R3(config)#line vty 04</p><p>R3(config-line)#access-class 1 in</p><p>如果不在line调用的话，也可以在接口下面调用：</p><p>R3(config)#interfacef0/1</p><p>R3(config-if)#ipaccess-group 1 in</p><p>五、扩展访问控制列表：</p><p>扩展访问控制列表可以用来匹配：</p><p>不仅可以匹配源地址还可以匹配协议</p><p>还可以匹配目标地址</p><p>还可以匹配端口号</p><p>扩展访问控制列表建议配置在接近于源的位置，如果配置在接近于目标位置或其他位置的路由器上面，因为产生的结构都是一样的，所以会浪费大量的带宽，而如果配置在接近于源的的目标位置就不会出现这种情况，所以，扩展访问控制列表一定要配置在接近于源的目标位置。</p><p><br></p><p>实验一：</p><p>命令：</p><p>建立扩展访问控制列表：</p><p>RouterX(config)#access-listaccess-list-number {permit|deny} protocol source source-wildcard [operator port] Destination destination-wildcard [operator port] [established] [log]</p><p>Permit：允许。Deny：拒绝。Protocol：协议。Source: 源地址。source-wildcard：源地址反掩码 。operatorport：相应端口。Destination：目标地址。destination-wildcard：目标地址反掩码。</p><p>调用扩展访问控制列表：</p><p>RouterX(config-if)#ipaccess-group access-list-number {in|out}</p><p>"ping"命令是基于ICMP协议的命令。且下面的命令是deny掉了去的报文和回的报文。</p><p>即：</p><p>R3(config)#access-list 100 deny icmp192.168.1.0 0.0.0.255 192.168.2.0 0.0.0.255 echo 报文格式</p><p>R3(config)#access-list 100 deny icmp 192.168.1.00.0.0.255 192.168.2.0 0.0.0.255 echo-reply 回应报文格式</p><p>R3(config)#access-list 100 permit ip any any 因为三层所用的协议是IP协议，所以是ip anyany，这里的IP表示的是协议号。</p><p>接下来调用，在R1的入方向来调用这个ACL。</p><p>R1(config)#interfacef0/1</p><p>R2(config-if)#ipaccess-group 100 in</p><p>实验二：</p><p>要求：不允许192.168.1.2去telnet远程连接R3路由器。而telnet的协议是基于tcp协议的。</p><p>R1(config)#access-list100 deny tcp host 192.168.1.2 host 23.1.1.3 eq telnet 这里的eq指的是"等于"</p><p>R1(config)#access-list100 permit ip any any</p><p>然后去接口调用：</p><p>R1(config)#ipaccess-group 100 in</p><p><br></p><p>常见的协议端口号：</p><p>http 80</p><p>dhcp server67 client68</p><p>tftp 69</p><p>DNS tcp的53号端口和udp的53号端口，而我们平时上网的时候都是用的UDP的53号端口。只有在DNS服务器之间同步DNS服务的时候，才会用到基于TCP的53号端口。或者发的报文比较大的时候也才会用到DNS的第53号端口。</p><p>NTP 是网络时间协议，使用的是123号端口</p><p>Email 一个是SMTP的25号端口，还有一个是POP3的110号端口。</p><p>FTP 一个是20号端口，一个是21号端口，通常情况下被动模式是使用的是21号端口来建立连接的，而传输数据的是随机端口，而如果设置的是主动模式的话，则是用21号端口来建立连接，用20号端口来传输数据。</p><p>ACL配置指导：</p><p>-标准或扩展代表可过滤经过路由器的内容</p><p>-每隔接口、协议、方向只允许有一个ACL</p><p>-ACL语句的顺序控制着测试，因此最具体的语句位于列表顶部。</p><p>-最后的ACL测试始终是隐式拒绝其他所有语句，因此每隔列表需要至少一条permit语句</p><p>-在全局范围内创建ACL，然后将其应用到入站流量或出站流量的接口</p><p>-ACL可过滤经过路由器的流量或往返路由器的流量，具体取决于其应用方式</p><p>-将ACL置于网络中时:</p><p>*标准ACL应靠近目的地址</p><p>*扩展ACL应靠近源地址。</p><div class=pgc-img><img alt=思科访问控制列表(ACL)设置，控制网络访问 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/60d06a879de0467e89904c9fbf3f4952><p class=pgc-img-caption></p></div><p>【总结】</p><p>-标准IPv4 ACL允许根据源IP地址进行过滤</p><p>-扩展ACL允许根据源IP地址、目的IP地址、协议和端口号进行过滤</p><p>-命名ACL允许从一条ACL中删除单挑语句</p><p>-可以使用show access-lists和show ipinterface命令排除ACL配置的常见错误。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'访问','ACL','设置'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>