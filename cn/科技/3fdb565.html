<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>深入理解Linux磁盘文件系统之inode详解 | 极客快訊</title><meta property="og:title" content="深入理解Linux磁盘文件系统之inode详解 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/c6b8a86418a147d1a9606329d980b535"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3fdb565.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3fdb565.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3fdb565.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3fdb565.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3fdb565.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3fdb565.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3fdb565.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3fdb565.html><meta property="article:published_time" content="2020-10-29T21:07:20+08:00"><meta property="article:modified_time" content="2020-10-29T21:07:20+08:00"><meta name=Keywords content><meta name=description content="深入理解Linux磁盘文件系统之inode详解"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/3fdb565.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>深入理解Linux磁盘文件系统之inode详解</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>inode是什么？</h1><blockquote><p>inode中文译名为"索引节点"</p></blockquote><p>文件储存在硬盘上，硬盘的最小存储单位叫做"扇区"（Sector）。每个扇区储存512字节（相当于0.5KB）。</p><p>操作系统读取硬盘的时候，不会一个个扇区地读取，这样效率太低，而是一次性连续读取多个扇区，即一次性读取一个"块"（block）。这种由多个扇区组成的"块"，是文件存取的最小单位。"块"的大小，最常见的是4KB，即连续八个 sector组成一个 block。</p><p>文件数据都储存在"块"中，那么很显然，我们还必须找到一个地方储存文件的元信息，比如文件的创建者、文件的创建日期、文件的大小等等。这种储存文件元信息的区域就叫做inode，中文译名为"索引节点"。</p><h1>inode的内容</h1><p><strong>inode包含文件的元信息，具体来说有以下内容：</strong></p><blockquote><p>* 文件的字节数</p><p>* 文件拥有者的User ID</p><p>* 文件的Group ID</p><p>* 文件的读、写、执行权限</p><p>*文件的时间戳，共有三个：ctime指inode上一次变动的时间，mtime指文件内容上一次变动的时间，atime指文件上一次打开的时间。</p><p>* 链接数，即有多少文件名指向这个inode</p><p>* 文件数据block的位置</p></blockquote><p><strong>示例1：</strong></p><p>stat命令，查看某个文件的inode信息</p><pre>[root@localhost mytest]# stat a.txt </pre><div class=pgc-img><img alt=深入理解Linux磁盘文件系统之inode详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c6b8a86418a147d1a9606329d980b535><p class=pgc-img-caption></p></div><p>mtime ： modify time,修改文件内容的时间</p><p>即指文件内容上一次变动的时间。如：echo aa >> a.sh 或vim a.sh 修改内容</p><p>atime ： access time 访问文件内容的时间</p><p>即指文件上一次查看文件的时间，如： cat a.sh</p><p>ctime指inode上一次文件属性变动的时间，change time 。 比如： chmod +x a.sh</p><h1>inode的大小</h1><p>inode也会消耗硬盘空间，所以硬盘格式化的时候，操作系统自动将硬盘分成两个区域。一个是数据区，存放文件数据；另一个是inode区（inode table），存放inode所包含的信息。</p><p>每个inode节点的大小，一般是128字节或256字节。inode节点的总数，在格式化时就给定，假定在一块1GB的硬盘中，每个inode节点的大小为128字节，每1KB就设置一个inode，那么inode table的大小就会达到128MB，占整块硬盘的12.8%。</p><h1>inode号码</h1><p>每个inode都有一个号码，操作系统用inode号码来识别不同的文件。</p><p>Unix/Linux系统内部不使用文件名，而使用inode号码来识别文件。对于系统来说，文件名只是inode号码便于识别的别称或者绰号。表面上，用户通过文件名，打开文件。实际上，系统内部这个过程分成三步：首先，系统找到这个文件名对应的inode号码；其次，通过inode号码，获取inode信息；最后，根据inode信息，找到文件数据所在的block，读出数据。</p><p><strong>示例2</strong></p><p>使用ls -i命令，可以看到文件名对应的inode号码</p><pre>[root@localhost mytest]# ls -i 或[root@localhost mytest]# ll -i</pre><div class=pgc-img><img alt=深入理解Linux磁盘文件系统之inode详解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/54cee5d259a0454f91350222820cd08c><p class=pgc-img-caption></p></div><p><strong>示例3</strong></p><p>查看每个硬盘分区的inode总数和已经使用的数量，可以使用df命令</p><pre>[root@localhost mytest]# df -i</pre><div class=pgc-img><img alt=深入理解Linux磁盘文件系统之inode详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ce1b5481f1914748bd41db10e2254762><p class=pgc-img-caption></p></div><h1>目录文件</h1><blockquote><p>Unix/Linux系统中，目录（directory）也是一种文件。打开目录，实际上就是打开目录文件。</p></blockquote><p>目录文件的结构非常简单，就是一系列目录项的列表。每个目录项，由两部分组成：所包含文件的文件名，以及该文件名对应的inode号码。</p><pre>[root@localhost mytest]# ls -id /etc/</pre><div class=pgc-img><img alt=深入理解Linux磁盘文件系统之inode详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2d76aeeb6c2f47b795132aa3ec1c5b91><p class=pgc-img-caption></p></div><p><strong>示例4</strong></p><p>ls -i命令列出整个目录文件，即文件名和inode号码：</p><pre>[root@localhost mytest]# ls -id /etc/</pre><div class=pgc-img><img alt=深入理解Linux磁盘文件系统之inode详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e97a50361baf4a9197d12b64ce3a2062><p class=pgc-img-caption></p></div><h1>实战</h1><blockquote><p>解决磁盘有空间但创建不了文件</p></blockquote><h1>场景</h1><blockquote><p>在一台配置较低的Linux服务器（内存、硬盘比较小）的/data分区内创建文件时，系统提示磁盘空间不足，用df -h命令查看了一下磁盘使用情况，发现/data分区只使用了80%，还有1.9G的剩余空间，但是无法创建新的文件。当时使用的是root用户。服务器没有被黑。</p></blockquote><pre>[root@localhost mytest]# df -h</pre><blockquote><p>文件系统 容量 已用 可用 已用% 挂载点</p><p>/dev/sda3 10G 8.0G 1.9G 80% /</p></blockquote><p><strong>常识： 只要权限够，磁盘上有空间一定可以创建文件。 这个是错的。</strong></p><p><strong>排查过程</strong></p><p><strong>第一步：</strong></p><pre>用df -i</pre><p>查看了一下/data所在的分区的索引节点(inode)，发现已经用满(IUsed=100%)，导致系统无法创建新目录和文件。</p><p><strong>问题原因：</strong></p><blockquote><p>/data/cache目录中存在数量非常多的小字节缓存文件，占用的Block不多，但是占用了大量的inode。</p></blockquote><pre>[root@localhost mytest] # df -i </pre><blockquote><p>文件系统 Inode 已用(I) 可用(I) 已用(I)% 挂载点</p><p>/dev/sda3 5242880 5242880 0 100% /</p></blockquote><h1>解决方案</h1><p><strong>第一种方案：</strong></p><p>删除/data/cache目录中的部分文件，释放出/data分区的一部分inode。</p><p><strong>第二种方案 :</strong></p><p>在/data备份好一些文件，然后删除这些文件，释放一些inode，然后创建一个文件夹/data/cache2。在cache2下挂载一个新分区： sda4 ，下次写数据需要写到新分区cache2目录下。</p><p>inode分区完后，是不可以再增加的, inode总数是在格式化时定下来。</p><pre>[root@localhost mytest] # mkfs.ext4 -I 500000000000 /dev/sda1 #可以指定大小</pre><blockquote><p>参数：</p><p>[-i bytes-per-inode] [-I inode-size]</p></blockquote><div class=pgc-img><img alt=深入理解Linux磁盘文件系统之inode详解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/dbfe8019947443b799e2ecdff783f3d4><p class=pgc-img-caption></p></div><h1>扩展</h1><p><strong>inode的特殊作用</strong></p><p>由于inode号码与文件名分离，这种机制导致了一些Unix/Linux系统特有的现象。</p><blockquote><p>1. 有时，文件名包含特殊字符，无法正常删除。这时，直接删除inode节点，就能起到删除文件的作用。</p><p>2. 移动文件或重命名文件，只是改变文件名，不影响inode号码。</p><p>3. 打开一个文件以后，系统就以inode号码来识别这个文件，不再考虑文件名。</p></blockquote><p>因此，通常来说，系统无法从inode号码得知文件名。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Linux','磁盘','系统'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../cn/%E7%A7%91%E6%8A%80/789611b.html alt="Linux 的磁盘系统，和你了解的Windows差别很大" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/9529da833a0a4f1c891cd9fc6187e6ef style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/789611b.html title="Linux 的磁盘系统，和你了解的Windows差别很大">Linux 的磁盘系统，和你了解的Windows差别很大</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>