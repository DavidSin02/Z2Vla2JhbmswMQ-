<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>基于LNMP架构部署NextCloud私有云盘 | 极客快訊</title><meta property="og:title" content="基于LNMP架构部署NextCloud私有云盘 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/7c530ace20274a47a93d6fa05440eeab"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/40915a39.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/40915a39.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/40915a39.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/40915a39.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/40915a39.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/40915a39.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/40915a39.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/40915a39.html><meta property="article:published_time" content="2020-11-14T21:01:37+08:00"><meta property="article:modified_time" content="2020-11-14T21:01:37+08:00"><meta name=Keywords content><meta name=description content="基于LNMP架构部署NextCloud私有云盘"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/40915a39.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>基于LNMP架构部署NextCloud私有云盘</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h3 class=pgc-h-arrow-right><strong>一、NextCloud介绍</strong></h3><p><strong>1、简介</strong></p><p><strong>Nextcloud是一款开源免费的私有云存储网盘项目，可以让你快速便捷地搭建一套属于自己或团队的云同步网盘，从而实现跨平台跨设备文件同步、共享、版本控制、团队协作等功能。它的客户端覆盖了Windows、Mac、Android、iOS、Linux 等各种平台，也提供了网页端以及 WebDAV接口，所以你几乎可以在各种设备上方便地访问你的云盘。</strong></p><p><strong>Nextcloud也提供了许多应用安装，包括但不限于Markdown在线编辑、OnlyOffice（需另外部署服务端）、思维导图、日历等，你可以自行选择以丰富个人网盘的功能。</strong></p><p><strong>Nextcloud的服务端部署方式有很多种，本文采用基于LNMP环境源码安装。</strong></p><p><strong>2、Nextcloud部署</strong></p><p><strong>#本文采用的LNMP环境可参考我另一篇文章部署（LNMP环境部署）</strong></p><p><strong>1)下载Nextcloud安装包</strong></p><p><strong>[root@localhost ~]# wget https://download.nextcloud.com/server/releases/nextcloud-18.0.1.tar.bz2</strong></p><p><strong>2）解压Nextcloud安装包</strong></p><p><strong>[root@localhost ~]# tar xf nextcloud-18.0.1.tar.bz2</strong></p><p><strong>3）拷贝Nextcloud到发布目录</strong></p><p><strong>[root@localhost ~]# mv nextcloud /usr/local/nginx/html</strong></p><p><strong>4）编辑Nginx.conf配置文件</strong></p><p><strong>[root@localhost ~]# vim /usr/local/nginx/conf/nginx.conf</strong></p><p><strong>#配置内容如下</strong></p><pre><code>        #定义Nginx运行的用户和用户组	user www www;	#启动进程,通常设置成和cpu的数量相等	worker_processes  auto;	#定义最大打开文件数	worker_rlimit_nofile 10240;	#定义PID文件	pid logs/nginx.pid;events	{	#epoll是多路复用IO(I/O Multiplexing)中的一种方式,但是仅用于linux2.6以上内核,可以大大提高nginx的性能	use epoll;	#单个后台worker process进程的最大并发链接数 （最大连接数=连接数*进程数）	worker_connections  10240;	#尽可能多的接受请求	multi_accept on;	}http	{	#设定mime类型,类型由mime.type文件定义	include       mime.types;	default_type  application/octet-stream;	#设定日志格式	log_format main '$remote_addr - $remote_user [$time_local] "$request" '			'$status $body_bytes_sent "$http_referer" '			'"$http_user_agent" "$http_x_forwarded_for"';	#定义访问日志存放路径	access_log logs/access.log main;	#定义错误日志存放路径	error_loglogs/error.log warn;	#limit_req_zone定义在http块中，$binary_remote_addr表示保存客户端IP地址的二进制形式。Zone定义IP状态及URL访问频率的共享内存区域,zone=keyword标识区域的名字，以及冒号后面跟区域大小。16000个IP地址的状态信息约1MB，区域可以存储160000个IP地址Rate定义最大请求速率。速率不能超过每秒20个请求。	limit_req_zone $binary_remote_addr zone=mylimit:10m rate=20r/s;	#sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，对于普通应用必须设为 on	sendfile        on;	#防止网络阻塞	tcp_nopush      on;	#keepalive超时时间，客户端到服务器端的连接持续有效时间，当出现对服务器的后继请求时，keepalive-timeout功能可避免建立或重新建立连接。(节省服务器资源、CPU、内存、网卡)	keepalive_timeout  120;	#提高数据的实时响应性	tcp_nodelay         on;	#隐藏版本号	#server_tokens off;	#开启gzip压缩	gzip    on;	#设置允许压缩的页面最小字节数	gzip_min_length 1k;	#设置系统获取几个单位的缓存用于存储gzip的压缩结果数据流。 例如 4 4k 代表以4k为单位，按照原始数据大小以4k为单位的4倍申请内存。4 8k 代表以8k为单位，按照原始数据大小以8k为单位的4倍申请内存	gzip_buffers    4 64k;	#设置压缩响应所需的最小http协议版本	gzip_http_version 1.1;	#压缩级别大小，最大为9，值越小，压缩后比例越小，CPU处理更快，值越大，消耗CPU比较高。	gzip_comp_level 4;	#设置匹配MIME类型进行压缩	gzip_types      text/plain application/x-javascript text/css application/xml;	#给CDN和代理服务器使用，针对相同url，可以根据头信息返回压缩和非压缩副本	gzip_vary       on;	#允许客户端请求的最大单文件字节数	client_max_body_size 10m;	#缓冲区代理缓冲用户端请求的最大字节数	client_body_buffer_size 128k;	#nginx跟后端服务器连接超时时间(代理连接超时)	proxy_connect_timeout 90;	#后端服务器数据回传时间(代理发送超时)	proxy_send_timeout 90;	#连接成功后，后端服务器响应时间(代理接收超时)	proxy_read_timeout 90;	#设置代理服务器（nginx）保存用户头信息的缓冲区大小	proxy_buffer_size 4k;	#proxy_buffers缓冲区，网页平均在32k以下的话，这样设置	proxy_buffers 4 32k;	#高负荷下缓冲大小（proxy_buffers*2）	proxy_busy_buffers_size 64k;	#设定请求缓冲	large_client_header_buffers 4 4k;	#客户端请求头部的缓冲区大小，这个可以根据你的系统分页大小来设置，一般一个请求的头部大小不会超过1k,不过由于一般系统分页都要大于1k，所以这里设置为分页大小。分页大小可以用命令getconf PAGESIZE取得。	client_header_buffer_size 4k;	#这个将为打开文件指定缓存，默认是没有启用的，max指定缓存数量，建议和打开文件数一致，inactive是指经过多长时间文件没被请求后删除缓存	open_file_cache max=102400 inactive=20s;	#这个是指多长时间检查一次缓存的有效信息	open_file_cache_valid 30s;	#open_file_cache指令中的inactive参数时间内文件的最少使用次数，如果超过这个数字，文件描述符一直是在缓存中打开的	open_file_cache_min_uses 1;	#定义引用配置文件路径	include domains/*.conf;}</code></pre><p><strong>5）编辑Nginx.conf配置文件</strong></p><p><strong>[root@localhost ~]# mkdir /usr/local/nginx/conf/domains</strong></p><p><strong>[root@localhost ~]# vim /usr/local/nginx/conf/domains/nextcloud.conf</strong></p><pre><code>server  {	listen 80;	server_name localhost;	root html/nextcloud;	access_log logs/access_nextcloud.log; 	error_log logs/error_nextcloud.log;	add_header Referrer-Policy "no-referrer" always;	add_header X-Content-Type-Options "nosniff" always;	add_header X-Download-Options "noopen" always;	add_header X-Frame-Options "SAMEORIGIN" always;	add_header X-Permitted-Cross-Domain-Policies "none" always;	add_header X-Robots-Tag "none" always;	add_header X-XSS-Protection "1; mode=block" always;	fastcgi_hide_header X-Powered-By;        location ~ ^\/(?:index|remote|public|cron|core\/ajax\/update|status|ocs\/v[12]|updater\/.+|oc[ms]-provider\/.+)\.php(?:$|\/) {	fastcgi_split_path_info ^(.+?\.php)(\/.*|)$;	set $path_info $fastcgi_path_info;	try_files $fastcgi_script_name =404;	include fastcgi_params;	fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;	fastcgi_param PATH_INFO $path_info;	fastcgi_param modHeadersAvailable true;	fastcgi_param front_controller_active true;	fastcgi_intercept_errors on;	fastcgi_request_buffering off;	fastcgi_pass 127.0.0.1:9000;    #自定义	}        rewrite /.well-known/carddav /remote.php/dav permanent;        rewrite /.well-known/caldav /remote.php/dav permanent;        location / {        	rewrite ^ /index.php;        }        location ~ \.(?:png|html|ttf|ico|jpg|jpeg|bcmap)$ {        	try_files $uri /index.php$request_uri;        	access_log off;        }        location ~ ^\/(?:updater|oc[ms]-provider)(?:$|\/) {        	try_files $uri/ =404;        	index index.php;        }        location ~ ^\/(?:\.|autotest|occ|issue|indie|db_|console) {        	deny all;        }        location ~ ^\/(?:build|tests|config|lib|3rdparty|templates|data)\/ {        	deny all;        }        location ~ \.(?:css|js|woff2?|svg|gif|map)$ {	try_files $uri /index.php$request_uri;	add_header Cache-Control "public, max-age=15778463";	add_header Referrer-Policy "no-referrer" always;	add_header X-Content-Type-Options "nosniff" always;	add_header X-Download-Options "noopen" always;	add_header X-Frame-Options "SAMEORIGIN" always;	add_header X-Permitted-Cross-Domain-Policies "none" always;	add_header X-Robots-Tag "none" always;	add_header X-XSS-Protection "1; mode=block" always;	access_log off;        }  }</code></pre><p><strong>6）重启Nginx服务</strong></p><p><strong>[root@localhost ~]# /usr/local/nginx/sbin/nginx -t</strong></p><p><strong>[root@localhost ~]# /usr/local/nginx/sbin/nginx -s reload</strong></p><p><strong>7）创建Nextcloud数据库</strong></p><p><strong>[root@localhost ~]# mysql</strong></p><p><strong>mysql> create database nextcloud charset=utf8;</strong></p><p><strong>mysql> show grant on nextcloud.* to nextcloud@’localhost’ identified by‘123456’;</strong></p><p><strong>mysql> flush privileges;</strong></p><p><strong>8）创建NextCloud 数据存储目录、并为其设置权限</strong></p><p><strong>[root@localhost ~]# mkdir -p /usr/local/nginx/html/nextcloud/data</strong></p><p><strong>[root@localhost ~]# chown -R www.www /usr/local/nginx/html/nextcloud</strong></p><p><strong>9）确认所有服务都已全部启动</strong></p><p><strong>[root@localhost ~]# netstat -lntup</strong></p><p><strong>Active Internet connections (only servers)</strong></p><p><strong>Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program nam</strong></p><p><strong>tcp 0 0 127.0.0.1:9000 0.0.0.0:* LISTEN 679/php-fpm: master</strong></p><p><strong>tcp 0 0 0.0.0.0:3306 0.0.0.0:* LISTEN 32182/mysqld</strong></p><p><strong>tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN 16792/nginx: worker</strong></p><h3 class=pgc-h-arrow-right><strong>二、Nextcloud使用</strong></h3><p><strong>1）初始化 NextCloud</strong></p><p><strong>提示：在浏览器中、输入服务器IP（192.168.0.117）即可出现如下界面</strong></p><p><br></p><div class=pgc-img><img alt=基于LNMP架构部署NextCloud私有云盘 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7c530ace20274a47a93d6fa05440eeab><p class=pgc-img-caption></p></div><p><strong>2）按照提示输入相关信息</strong></p><p><br></p><div class=pgc-img><img alt=基于LNMP架构部署NextCloud私有云盘 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7cf01e79c4c44f73bfad13e246fc6e7f><p class=pgc-img-caption></p></div><p><strong>点击安装完成即可</strong></p><p><strong>3）安装完成后，会出现以下界面</strong></p><p><br></p><div class=pgc-img><img alt=基于LNMP架构部署NextCloud私有云盘 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8c122940eefb4da4afa3b3432eeab6ef><p class=pgc-img-caption></p></div><p><strong>至此，NextCloud私有网盘部署成功。</strong></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'LNMP','架构','NextCloud'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>