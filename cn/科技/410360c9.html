<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>SpringBooté¡¹ç›®ä½¿ç”¨TrueLicenseç”Ÿæˆå’ŒéªŒè¯ | æå®¢å¿«è¨Š</title><meta property="og:title" content="SpringBooté¡¹ç›®ä½¿ç”¨TrueLicenseç”Ÿæˆå’ŒéªŒè¯ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/c258f6f3636b44dfb9c72c23d2fc50ef"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/410360c9.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/410360c9.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/410360c9.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/410360c9.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/410360c9.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/410360c9.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/410360c9.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/410360c9.html><meta property="article:published_time" content="2020-10-29T21:10:34+08:00"><meta property="article:modified_time" content="2020-10-29T21:10:34+08:00"><meta name=Keywords content><meta name=description content="SpringBooté¡¹ç›®ä½¿ç”¨TrueLicenseç”Ÿæˆå’ŒéªŒè¯"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/410360c9.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>SpringBooté¡¹ç›®ä½¿ç”¨TrueLicenseç”Ÿæˆå’ŒéªŒè¯</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>ä¸€ ç®€ä»‹</h1><p>Licenseï¼Œå³ç‰ˆæƒè®¸å¯è¯ï¼Œä¸€èˆ¬ç”¨äºæ”¶è´¹è½¯ä»¶ç»™ä»˜è´¹ç”¨æˆ·æä¾›çš„è®¿é—®è®¸å¯è¯æ˜ã€‚æ ¹æ®åº”ç”¨éƒ¨ç½²ä½ç½®çš„ä¸åŒï¼Œä¸€èˆ¬å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§æƒ…å†µè®¨è®ºï¼š</p><ul><li>åº”ç”¨éƒ¨ç½²åœ¨å¼€å‘è€…è‡ªå·±çš„äº‘æœåŠ¡å™¨ä¸Šã€‚è¿™ç§æƒ…å†µä¸‹ç”¨æˆ·é€šè¿‡è´¦å·ç™»å½•çš„å½¢å¼è¿œç¨‹è®¿é—®ï¼Œå› æ­¤åªéœ€è¦åœ¨è´¦å·ç™»å½•çš„æ—¶å€™æ ¡éªŒç›®æ ‡è´¦å·çš„æœ‰æ•ˆæœŸã€è®¿é—®æƒé™ç­‰ä¿¡æ¯å³å¯ã€‚</li><li>åº”ç”¨éƒ¨ç½²åœ¨å®¢æˆ·çš„å†…ç½‘ç¯å¢ƒã€‚å› ä¸ºè¿™ç§æƒ…å†µå¼€å‘è€…æ— æ³•æ§åˆ¶å®¢æˆ·çš„ç½‘ç»œç¯å¢ƒï¼Œä¹Ÿä¸èƒ½ä¿è¯åº”ç”¨æ‰€åœ¨æœåŠ¡å™¨å¯ä»¥è®¿é—®å¤–ç½‘ï¼Œå› æ­¤é€šå¸¸çš„åšæ³•æ˜¯ä½¿ç”¨æœåŠ¡å™¨è®¸å¯æ–‡ä»¶ï¼Œåœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™åŠ è½½è¯ä¹¦ï¼Œç„¶ååœ¨ç™»å½•æˆ–è€…å…¶ä»–å…³é”®æ“ä½œçš„åœ°æ–¹æ ¡éªŒè¯ä¹¦çš„æœ‰æ•ˆæ€§ã€‚</li></ul><p>æ³¨ï¼šé™äºæ–‡ç« ç¯‡å¹…ï¼Œè¿™é‡Œåªè®¨è®ºä»£ç å±‚é¢çš„è®¸å¯é™åˆ¶ï¼Œæš‚ä¸è€ƒè™‘é€†å‘ç ´è§£ç­‰é—®é¢˜ã€‚æ­¤å¤–ï¼Œåœ¨ä¸‹é¢æˆ‘åªè®²è§£å…³é”®ä»£ç å®ç°ï¼Œå®Œæ•´ä»£ç å¯ä»¥å‚è€ƒï¼šgitee.com/zifangsky/Lâ€¦</p><h1 class=pgc-h-arrow-right>äºŒ ä½¿ç”¨ TrueLicense ç”ŸæˆLicense</h1><h1 class=pgc-h-arrow-right>ï¼ˆ1ï¼‰ä½¿ç”¨Spring Bootæ„å»ºæµ‹è¯•é¡¹ç›®ServerDemoï¼Œç”¨äºä¸ºå®¢æˆ·ç”ŸæˆLicenseè®¸å¯æ–‡ä»¶ï¼š</h1><p>æ³¨ï¼šè¿™ä¸ªå®Œæ•´çš„Demoé¡¹ç›®å¯ä»¥å‚è€ƒï¼šgitee.com/zifangsky/Lâ€¦</p><p>iï¼‰åœ¨pom.xmlä¸­æ·»åŠ å…³é”®ä¾èµ–ï¼š</p><pre><code>&lt;dependency&gt;    &lt;groupId&gt;de.schlichtherle.truelicense&lt;/groupId&gt;    &lt;artifactId&gt;truelicense-core&lt;/artifactId&gt;    &lt;version&gt;1.33&lt;/version&gt;    &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;</code></pre><p>iiï¼‰æ ¡éªŒè‡ªå®šä¹‰çš„Licenseå‚æ•°ï¼š</p><p>TrueLicenseçš„ de.schlichtherle.license.LicenseManager ç±»è‡ªå¸¦çš„verifyæ–¹æ³•åªæ ¡éªŒäº†æˆ‘ä»¬åé¢é¢å‘çš„è®¸å¯æ–‡ä»¶çš„ç”Ÿæ•ˆå’Œè¿‡æœŸæ—¶é—´ï¼Œç„¶è€Œåœ¨å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬å¯èƒ½éœ€è¦é¢å¤–æ ¡éªŒåº”ç”¨éƒ¨ç½²çš„æœåŠ¡å™¨çš„IPåœ°å€ã€MACåœ°å€ã€CPUåºåˆ—å·ã€ä¸»æ¿åºåˆ—å·ç­‰ä¿¡æ¯ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¤å†™æ¡†æ¶çš„éƒ¨åˆ†æ–¹æ³•ä»¥å®ç°æ ¡éªŒè‡ªå®šä¹‰å‚æ•°çš„ç›®çš„ã€‚</p><p>é¦–å…ˆéœ€è¦æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„å¯è¢«å…è®¸çš„æœåŠ¡å™¨ç¡¬ä»¶ä¿¡æ¯çš„å®ä½“ç±»ï¼ˆå¦‚æœæ ¡éªŒå…¶ä»–å‚æ•°ï¼Œå¯è‡ªè¡Œè¡¥å……ï¼‰ï¼š</p><pre><code>package cn.zifangsky.license;import java.io.Serializable;import java.util.List;/** * è‡ªå®šä¹‰éœ€è¦æ ¡éªŒçš„Licenseå‚æ•° * * @author zifangsky * @date 2018/4/23 * @since 1.0.0 */public class LicenseCheckModel implements Serializable{    private static final long serialVersionUID = 8600137500316662317L;    /**     * å¯è¢«å…è®¸çš„IPåœ°å€     */    private List&lt;String&gt; ipAddress;    /**     * å¯è¢«å…è®¸çš„MACåœ°å€     */    private List&lt;String&gt; macAddress;    /**     * å¯è¢«å…è®¸çš„CPUåºåˆ—å·     */    private String cpuSerial;    /**     * å¯è¢«å…è®¸çš„ä¸»æ¿åºåˆ—å·     */    private String mainBoardSerial;    //çœç•¥setterå’Œgetteræ–¹æ³•    @Override    public String toString() {        return "LicenseCheckModel{" +                "ipAddress=" + ipAddress +                ", macAddress=" + macAddress +                ", cpuSerial='" + cpuSerial + '\'' +                ", mainBoardSerial='" + mainBoardSerial + '\'' +                '}';    }}</code></pre><p>å…¶æ¬¡ï¼Œæ·»åŠ ä¸€ä¸ªLicenseç”Ÿæˆç±»éœ€è¦çš„å‚æ•°ï¼š</p><pre><code>package cn.zifangsky.license;import com.fasterxml.jackson.annotation.JsonFormat;import java.io.Serializable;import java.util.Date;/** * Licenseç”Ÿæˆç±»éœ€è¦çš„å‚æ•° * * @author zifangsky * @date 2018/4/19 * @since 1.0.0 */public class LicenseCreatorParam implements Serializable {    private static final long serialVersionUID = -7793154252684580872L;    /**     * è¯ä¹¦subject     */    private String subject;    /**     * å¯†é’¥åˆ«ç§°     */    private String privateAlias;    /**     * å¯†é’¥å¯†ç ï¼ˆéœ€è¦å¦¥å–„ä¿ç®¡ï¼Œä¸èƒ½è®©ä½¿ç”¨è€…çŸ¥é“ï¼‰     */    private String keyPass;    /**     * è®¿é—®ç§˜é’¥åº“çš„å¯†ç      */    private String storePass;    /**     * è¯ä¹¦ç”Ÿæˆè·¯å¾„     */    private String licensePath;    /**     * å¯†é’¥åº“å­˜å‚¨è·¯å¾„     */    private String privateKeysStorePath;    /**     * è¯ä¹¦ç”Ÿæ•ˆæ—¶é—´     */    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss", timezone = "GMT+8")    private Date issuedTime = new Date();    /**     * è¯ä¹¦å¤±æ•ˆæ—¶é—´     */    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss", timezone = "GMT+8")    private Date expiryTime;    /**     * ç”¨æˆ·ç±»å‹     */    private String consumerType = "user";    /**     * ç”¨æˆ·æ•°é‡     */    private Integer consumerAmount = 1;    /**     * æè¿°ä¿¡æ¯     */    private String description = "";    /**     * é¢å¤–çš„æœåŠ¡å™¨ç¡¬ä»¶æ ¡éªŒä¿¡æ¯     */    private LicenseCheckModel licenseCheckModel;    //çœç•¥setterå’Œgetteræ–¹æ³•    @Override    public String toString() {        return "LicenseCreatorParam{" +                "subject='" + subject + '\'' +                ", privateAlias='" + privateAlias + '\'' +                ", keyPass='" + keyPass + '\'' +                ", storePass='" + storePass + '\'' +                ", licensePath='" + licensePath + '\'' +                ", privateKeysStorePath='" + privateKeysStorePath + '\'' +                ", issuedTime=" + issuedTime +                ", expiryTime=" + expiryTime +                ", consumerType='" + consumerType + '\'' +                ", consumerAmount=" + consumerAmount +                ", description='" + description + '\'' +                ", licenseCheckModel=" + licenseCheckModel +                '}';    }}</code></pre><p>æ·»åŠ æŠ½è±¡ç±»AbstractServerInfosï¼Œç”¨æˆ·è·å–æœåŠ¡å™¨çš„ç¡¬ä»¶ä¿¡æ¯ï¼š</p><pre><code>package cn.zifangsky.license;import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.Logger;import java.net.InetAddress;import java.net.NetworkInterface;import java.net.SocketException;import java.util.ArrayList;import java.util.Enumeration;import java.util.List;/** * ç”¨äºè·å–å®¢æˆ·æœåŠ¡å™¨çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚ï¼šIPã€Macåœ°å€ã€CPUåºåˆ—å·ã€ä¸»æ¿åºåˆ—å·ç­‰ * * @author zifangsky * @date 2018/4/23 * @since 1.0.0 */public abstract class AbstractServerInfos {    private static Logger logger = LogManager.getLogger(AbstractServerInfos.class);    /**     * ç»„è£…éœ€è¦é¢å¤–æ ¡éªŒçš„Licenseå‚æ•°     * @author zifangsky     * @date 2018/4/23 14:23     * @since 1.0.0     * @return demo.LicenseCheckModel     */    public LicenseCheckModel getServerInfos(){        LicenseCheckModel result = new LicenseCheckModel();        try {            result.setIpAddress(this.getIpAddress());            result.setMacAddress(this.getMacAddress());            result.setCpuSerial(this.getCPUSerial());            result.setMainBoardSerial(this.getMainBoardSerial());        }catch (Exception e){            logger.error("è·å–æœåŠ¡å™¨ç¡¬ä»¶ä¿¡æ¯å¤±è´¥",e);        }        return result;    }    /**     * è·å–IPåœ°å€     * @author zifangsky     * @date 2018/4/23 11:32     * @since 1.0.0     * @return java.util.List&lt;java.lang.String&gt;     */    protected abstract List&lt;String&gt; getIpAddress() throws Exception;    /**     * è·å–Macåœ°å€     * @author zifangsky     * @date 2018/4/23 11:32     * @since 1.0.0     * @return java.util.List&lt;java.lang.String&gt;     */    protected abstract List&lt;String&gt; getMacAddress() throws Exception;    /**     * è·å–CPUåºåˆ—å·     * @author zifangsky     * @date 2018/4/23 11:35     * @since 1.0.0     * @return java.lang.String     */    protected abstract String getCPUSerial() throws Exception;    /**     * è·å–ä¸»æ¿åºåˆ—å·     * @author zifangsky     * @date 2018/4/23 11:35     * @since 1.0.0     * @return java.lang.String     */    protected abstract String getMainBoardSerial() throws Exception;    /**     * è·å–å½“å‰æœåŠ¡å™¨æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„InetAddress     * @author zifangsky     * @date 2018/4/23 17:38     * @since 1.0.0     * @return java.util.List&lt;java.net.InetAddress&gt;     */    protected List&lt;InetAddress&gt; getLocalAllInetAddress() throws Exception {        List&lt;InetAddress&gt; result = new ArrayList&lt;&gt;(4);        // éå†æ‰€æœ‰çš„ç½‘ç»œæ¥å£        for (Enumeration networkInterfaces = NetworkInterface.getNetworkInterfaces(); networkInterfaces.hasMoreElements(); ) {            NetworkInterface iface = (NetworkInterface) networkInterfaces.nextElement();            // åœ¨æ‰€æœ‰çš„æ¥å£ä¸‹å†éå†IP            for (Enumeration inetAddresses = iface.getInetAddresses(); inetAddresses.hasMoreElements(); ) {                InetAddress inetAddr = (InetAddress) inetAddresses.nextElement();                //æ’é™¤LoopbackAddressã€SiteLocalAddressã€LinkLocalAddressã€MulticastAddressç±»å‹çš„IPåœ°å€                if(!inetAddr.isLoopbackAddress() /*&amp;&amp; !inetAddr.isSiteLocalAddress()*/                        &amp;&amp; !inetAddr.isLinkLocalAddress() &amp;&amp; !inetAddr.isMulticastAddress()){                    result.add(inetAddr);                }            }        }        return result;    }    /**     * è·å–æŸä¸ªç½‘ç»œæ¥å£çš„Macåœ°å€     * @author zifangsky     * @date 2018/4/23 18:08     * @since 1.0.0     * @param     * @return void     */    protected String getMacByInetAddress(InetAddress inetAddr){        try {            byte[] mac = NetworkInterface.getByInetAddress(inetAddr).getHardwareAddress();            StringBuffer stringBuffer = new StringBuffer();            for(int i=0;i&lt;mac.length;i++){                if(i != 0) {                    stringBuffer.append("-");                }                //å°†åå…­è¿›åˆ¶byteè½¬åŒ–ä¸ºå­—ç¬¦ä¸²                String temp = Integer.toHexString(mac[i] &amp; 0xff);                if(temp.length() == 1){                    stringBuffer.append("0" + temp);                }else{                    stringBuffer.append(temp);                }            }            return stringBuffer.toString().toUpperCase();        } catch (SocketException e) {            e.printStackTrace();        }        return null;    }}</code></pre><p>è·å–å®¢æˆ·LinuxæœåŠ¡å™¨çš„åŸºæœ¬ä¿¡æ¯ï¼š</p><pre><code>package cn.zifangsky.license;import org.apache.commons.lang3.StringUtils;import java.io.BufferedReader;import java.io.InputStreamReader;import java.net.InetAddress;import java.util.List;import java.util.stream.Collectors;/** * ç”¨äºè·å–å®¢æˆ·LinuxæœåŠ¡å™¨çš„åŸºæœ¬ä¿¡æ¯ * * @author zifangsky * @date 2018/4/23 * @since 1.0.0 */public class LinuxServerInfos extends AbstractServerInfos {    @Override    protected List&lt;String&gt; getIpAddress() throws Exception {        List&lt;String&gt; result = null;        //è·å–æ‰€æœ‰ç½‘ç»œæ¥å£        List&lt;InetAddress&gt; inetAddresses = getLocalAllInetAddress();        if(inetAddresses != null &amp;&amp; inetAddresses.size() &gt; 0){            result = inetAddresses.stream().map(InetAddress::getHostAddress).distinct().map(String::toLowerCase).collect(Collectors.toList());        }        return result;    }    @Override    protected List&lt;String&gt; getMacAddress() throws Exception {        List&lt;String&gt; result = null;        //1. è·å–æ‰€æœ‰ç½‘ç»œæ¥å£        List&lt;InetAddress&gt; inetAddresses = getLocalAllInetAddress();        if(inetAddresses != null &amp;&amp; inetAddresses.size() &gt; 0){            //2. è·å–æ‰€æœ‰ç½‘ç»œæ¥å£çš„Macåœ°å€            result = inetAddresses.stream().map(this::getMacByInetAddress).distinct().collect(Collectors.toList());        }        return result;    }    @Override    protected String getCPUSerial() throws Exception {        //åºåˆ—å·        String serialNumber = "";        //ä½¿ç”¨dmidecodeå‘½ä»¤è·å–CPUåºåˆ—å·        String[] shell = {"/bin/bash","-c","dmidecode -t processor | grep 'ID' | awk -F ':' '{print $2}' | head -n 1"};        Process process = Runtime.getRuntime().exec(shell);        process.getOutputStream().close();        BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));        String line = reader.readLine().trim();        if(StringUtils.isNotBlank(line)){            serialNumber = line;        }        reader.close();        return serialNumber;    }    @Override    protected String getMainBoardSerial() throws Exception {        //åºåˆ—å·        String serialNumber = "";        //ä½¿ç”¨dmidecodeå‘½ä»¤è·å–ä¸»æ¿åºåˆ—å·        String[] shell = {"/bin/bash","-c","dmidecode | grep 'Serial Number' | awk -F ':' '{print $2}' | head -n 1"};        Process process = Runtime.getRuntime().exec(shell);        process.getOutputStream().close();        BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));        String line = reader.readLine().trim();        if(StringUtils.isNotBlank(line)){            serialNumber = line;        }        reader.close();        return serialNumber;    }}</code></pre><p>è·å–å®¢æˆ·WindowsæœåŠ¡å™¨çš„åŸºæœ¬ä¿¡æ¯ï¼š</p><pre><code>package cn.zifangsky.license;import java.net.InetAddress;import java.util.List;import java.util.Scanner;import java.util.stream.Collectors;/** * ç”¨äºè·å–å®¢æˆ·WindowsæœåŠ¡å™¨çš„åŸºæœ¬ä¿¡æ¯ * * @author zifangsky * @date 2018/4/23 * @since 1.0.0 */public class WindowsServerInfos extends AbstractServerInfos {    @Override    protected List&lt;String&gt; getIpAddress() throws Exception {        List&lt;String&gt; result = null;        //è·å–æ‰€æœ‰ç½‘ç»œæ¥å£        List&lt;InetAddress&gt; inetAddresses = getLocalAllInetAddress();        if(inetAddresses != null &amp;&amp; inetAddresses.size() &gt; 0){            result = inetAddresses.stream().map(InetAddress::getHostAddress).distinct().map(String::toLowerCase).collect(Collectors.toList());        }        return result;    }    @Override    protected List&lt;String&gt; getMacAddress() throws Exception {        List&lt;String&gt; result = null;        //1. è·å–æ‰€æœ‰ç½‘ç»œæ¥å£        List&lt;InetAddress&gt; inetAddresses = getLocalAllInetAddress();        if(inetAddresses != null &amp;&amp; inetAddresses.size() &gt; 0){            //2. è·å–æ‰€æœ‰ç½‘ç»œæ¥å£çš„Macåœ°å€            result = inetAddresses.stream().map(this::getMacByInetAddress).distinct().collect(Collectors.toList());        }        return result;    }    @Override    protected String getCPUSerial() throws Exception {        //åºåˆ—å·        String serialNumber = "";        //ä½¿ç”¨WMICè·å–CPUåºåˆ—å·        Process process = Runtime.getRuntime().exec("wmic cpu get processorid");        process.getOutputStream().close();        Scanner scanner = new Scanner(process.getInputStream());        if(scanner.hasNext()){            scanner.next();        }        if(scanner.hasNext()){            serialNumber = scanner.next().trim();        }        scanner.close();        return serialNumber;    }    @Override    protected String getMainBoardSerial() throws Exception {        //åºåˆ—å·        String serialNumber = "";        //ä½¿ç”¨WMICè·å–ä¸»æ¿åºåˆ—å·        Process process = Runtime.getRuntime().exec("wmic baseboard get serialnumber");        process.getOutputStream().close();        Scanner scanner = new Scanner(process.getInputStream());        if(scanner.hasNext()){            scanner.next();        }        if(scanner.hasNext()){            serialNumber = scanner.next().trim();        }        scanner.close();        return serialNumber;    }}</code></pre><p>æ³¨ï¼šè¿™é‡Œä½¿ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå°†ä¸å˜éƒ¨åˆ†çš„ç®—æ³•å°è£…åˆ°æŠ½è±¡ç±»ï¼Œè€ŒåŸºæœ¬æ–¹æ³•çš„å…·ä½“å®ç°åˆ™ç”±å­ç±»æ¥å®ç°ã€‚æ›´å¤šå†…å®¹å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„æ–‡æ¡£ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼</p><p>è‡ªå®šä¹‰LicenseManagerï¼Œç”¨äºå¢åŠ é¢å¤–çš„æœåŠ¡å™¨ç¡¬ä»¶ä¿¡æ¯æ ¡éªŒï¼š</p><pre><code>package cn.zifangsky.license;import de.schlichtherle.license.LicenseContent;import de.schlichtherle.license.LicenseContentException;import de.schlichtherle.license.LicenseManager;import de.schlichtherle.license.LicenseNotary;import de.schlichtherle.license.LicenseParam;import de.schlichtherle.license.NoLicenseInstalledException;import de.schlichtherle.xml.GenericCertificate;import org.apache.commons.lang3.StringUtils;import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.Logger;import java.beans.XMLDecoder;import java.io.BufferedInputStream;import java.io.ByteArrayInputStream;import java.io.UnsupportedEncodingException;import java.util.Date;import java.util.List;/** * è‡ªå®šä¹‰LicenseManagerï¼Œç”¨äºå¢åŠ é¢å¤–çš„æœåŠ¡å™¨ç¡¬ä»¶ä¿¡æ¯æ ¡éªŒ * * @author zifangsky * @date 2018/4/23 * @since 1.0.0 */public class CustomLicenseManager extends LicenseManager{    private static Logger logger = LogManager.getLogger(CustomLicenseManager.class);    //XMLç¼–ç     private static final String XML_CHARSET = "UTF-8";    //é»˜è®¤BUFSIZE    private static final int DEFAULT_BUFSIZE = 8 * 1024;    public CustomLicenseManager() {    }    public CustomLicenseManager(LicenseParam param) {        super(param);    }    /**     * å¤å†™createæ–¹æ³•     * @author zifangsky     * @date 2018/4/23 10:36     * @since 1.0.0     * @param     * @return byte[]     */    @Override    protected synchronized byte[] create(            LicenseContent content,            LicenseNotary notary)            throws Exception {        initialize(content);        this.validateCreate(content);        final GenericCertificate certificate = notary.sign(content);        return getPrivacyGuard().cert2key(certificate);    }    /**     * å¤å†™installæ–¹æ³•ï¼Œå…¶ä¸­validateæ–¹æ³•è°ƒç”¨æœ¬ç±»ä¸­çš„validateæ–¹æ³•ï¼Œæ ¡éªŒIPåœ°å€ã€Macåœ°å€ç­‰å…¶ä»–ä¿¡æ¯     * @author zifangsky     * @date 2018/4/23 10:40     * @since 1.0.0     * @param     * @return de.schlichtherle.license.LicenseContent     */    @Override    protected synchronized LicenseContent install(            final byte[] key,            final LicenseNotary notary)            throws Exception {        final GenericCertificate certificate = getPrivacyGuard().key2cert(key);        notary.verify(certificate);        final LicenseContent content = (LicenseContent)this.load(certificate.getEncoded());        this.validate(content);        setLicenseKey(key);        setCertificate(certificate);        return content;    }    /**     * å¤å†™verifyæ–¹æ³•ï¼Œè°ƒç”¨æœ¬ç±»ä¸­çš„validateæ–¹æ³•ï¼Œæ ¡éªŒIPåœ°å€ã€Macåœ°å€ç­‰å…¶ä»–ä¿¡æ¯     * @author zifangsky     * @date 2018/4/23 10:40     * @since 1.0.0     * @param     * @return de.schlichtherle.license.LicenseContent     */    @Override    protected synchronized LicenseContent verify(final LicenseNotary notary)            throws Exception {        GenericCertificate certificate = getCertificate();        // Load license key from preferences,        final byte[] key = getLicenseKey();        if (null == key){            throw new NoLicenseInstalledException(getLicenseParam().getSubject());        }        certificate = getPrivacyGuard().key2cert(key);        notary.verify(certificate);        final LicenseContent content = (LicenseContent)this.load(certificate.getEncoded());        this.validate(content);        setCertificate(certificate);        return content;    }    /**     * æ ¡éªŒç”Ÿæˆè¯ä¹¦çš„å‚æ•°ä¿¡æ¯     * @author zifangsky     * @date 2018/5/2 15:43     * @since 1.0.0     * @param content è¯ä¹¦æ­£æ–‡     */    protected synchronized void validateCreate(final LicenseContent content)            throws LicenseContentException {        final LicenseParam param = getLicenseParam();        final Date now = new Date();        final Date notBefore = content.getNotBefore();        final Date notAfter = content.getNotAfter();        if (null != notAfter &amp;&amp; now.after(notAfter)){            throw new LicenseContentException("è¯ä¹¦å¤±æ•ˆæ—¶é—´ä¸èƒ½æ—©äºå½“å‰æ—¶é—´");        }        if (null != notBefore &amp;&amp; null != notAfter &amp;&amp; notAfter.before(notBefore)){            throw new LicenseContentException("è¯ä¹¦ç”Ÿæ•ˆæ—¶é—´ä¸èƒ½æ™šäºè¯ä¹¦å¤±æ•ˆæ—¶é—´");        }        final String consumerType = content.getConsumerType();        if (null == consumerType){            throw new LicenseContentException("ç”¨æˆ·ç±»å‹ä¸èƒ½ä¸ºç©º");        }    }    /**     * å¤å†™validateæ–¹æ³•ï¼Œå¢åŠ IPåœ°å€ã€Macåœ°å€ç­‰å…¶ä»–ä¿¡æ¯æ ¡éªŒ     * @author zifangsky     * @date 2018/4/23 10:40     * @since 1.0.0     * @param content LicenseContent     */    @Override    protected synchronized void validate(final LicenseContent content)            throws LicenseContentException {        //1. é¦–å…ˆè°ƒç”¨çˆ¶ç±»çš„validateæ–¹æ³•        super.validate(content);        //2. ç„¶åæ ¡éªŒè‡ªå®šä¹‰çš„Licenseå‚æ•°        //Licenseä¸­å¯è¢«å…è®¸çš„å‚æ•°ä¿¡æ¯        LicenseCheckModel expectedCheckModel = (LicenseCheckModel) content.getExtra();        //å½“å‰æœåŠ¡å™¨çœŸå®çš„å‚æ•°ä¿¡æ¯        LicenseCheckModel serverCheckModel = getServerInfos();        if(expectedCheckModel != null &amp;&amp; serverCheckModel != null){            //æ ¡éªŒIPåœ°å€            if(!checkIpAddress(expectedCheckModel.getIpAddress(),serverCheckModel.getIpAddress())){                throw new LicenseContentException("å½“å‰æœåŠ¡å™¨çš„IPæ²¡åœ¨æˆæƒèŒƒå›´å†…");            }            //æ ¡éªŒMacåœ°å€            if(!checkIpAddress(expectedCheckModel.getMacAddress(),serverCheckModel.getMacAddress())){                throw new LicenseContentException("å½“å‰æœåŠ¡å™¨çš„Macåœ°å€æ²¡åœ¨æˆæƒèŒƒå›´å†…");            }            //æ ¡éªŒä¸»æ¿åºåˆ—å·            if(!checkSerial(expectedCheckModel.getMainBoardSerial(),serverCheckModel.getMainBoardSerial())){                throw new LicenseContentException("å½“å‰æœåŠ¡å™¨çš„ä¸»æ¿åºåˆ—å·æ²¡åœ¨æˆæƒèŒƒå›´å†…");            }            //æ ¡éªŒCPUåºåˆ—å·            if(!checkSerial(expectedCheckModel.getCpuSerial(),serverCheckModel.getCpuSerial())){                throw new LicenseContentException("å½“å‰æœåŠ¡å™¨çš„CPUåºåˆ—å·æ²¡åœ¨æˆæƒèŒƒå›´å†…");            }        }else{            throw new LicenseContentException("ä¸èƒ½è·å–æœåŠ¡å™¨ç¡¬ä»¶ä¿¡æ¯");        }    }    /**     * é‡å†™XMLDecoderè§£æXML     * @author zifangsky     * @date 2018/4/25 14:02     * @since 1.0.0     * @param encoded XMLç±»å‹å­—ç¬¦ä¸²     * @return java.lang.Object     */    private Object load(String encoded){        BufferedInputStream inputStream = null;        XMLDecoder decoder = null;        try {            inputStream = new BufferedInputStream(new ByteArrayInputStream(encoded.getBytes(XML_CHARSET)));            decoder = new XMLDecoder(new BufferedInputStream(inputStream, DEFAULT_BUFSIZE),null,null);            return decoder.readObject();        } catch (UnsupportedEncodingException e) {            e.printStackTrace();        } finally {            try {                if(decoder != null){                    decoder.close();                }                if(inputStream != null){                    inputStream.close();                }            } catch (Exception e) {                logger.error("XMLDecoderè§£æXMLå¤±è´¥",e);            }        }        return null;    }    /**     * è·å–å½“å‰æœåŠ¡å™¨éœ€è¦é¢å¤–æ ¡éªŒçš„Licenseå‚æ•°     * @author zifangsky     * @date 2018/4/23 14:33     * @since 1.0.0     * @return demo.LicenseCheckModel     */    private LicenseCheckModel getServerInfos(){        //æ“ä½œç³»ç»Ÿç±»å‹        String osName = System.getProperty("os.name").toLowerCase();        AbstractServerInfos abstractServerInfos = null;        //æ ¹æ®ä¸åŒæ“ä½œç³»ç»Ÿç±»å‹é€‰æ‹©ä¸åŒçš„æ•°æ®è·å–æ–¹æ³•        if (osName.startsWith("windows")) {            abstractServerInfos = new WindowsServerInfos();        } else if (osName.startsWith("linux")) {            abstractServerInfos = new LinuxServerInfos();        }else{//å…¶ä»–æœåŠ¡å™¨ç±»å‹            abstractServerInfos = new LinuxServerInfos();        }        return abstractServerInfos.getServerInfos();    }    /**     * æ ¡éªŒå½“å‰æœåŠ¡å™¨çš„IP/Macåœ°å€æ˜¯å¦åœ¨å¯è¢«å…è®¸çš„IPèŒƒå›´å†…&lt;br/&gt;     * å¦‚æœå­˜åœ¨IPåœ¨å¯è¢«å…è®¸çš„IP/Macåœ°å€èŒƒå›´å†…ï¼Œåˆ™è¿”å›true     * @author zifangsky     * @date 2018/4/24 11:44     * @since 1.0.0     * @return boolean     */    private boolean checkIpAddress(List&lt;String&gt; expectedList,List&lt;String&gt; serverList){        if(expectedList != null &amp;&amp; expectedList.size() &gt; 0){            if(serverList != null &amp;&amp; serverList.size() &gt; 0){                for(String expected : expectedList){                    if(serverList.contains(expected.trim())){                        return true;                    }                }            }            return false;        }else {            return true;        }    }    /**     * æ ¡éªŒå½“å‰æœåŠ¡å™¨ç¡¬ä»¶ï¼ˆä¸»æ¿ã€CPUç­‰ï¼‰åºåˆ—å·æ˜¯å¦åœ¨å¯å…è®¸èŒƒå›´å†…     * @author zifangsky     * @date 2018/4/24 14:38     * @since 1.0.0     * @return boolean     */    private boolean checkSerial(String expectedSerial,String serverSerial){        if(StringUtils.isNotBlank(expectedSerial)){            if(StringUtils.isNotBlank(serverSerial)){                if(expectedSerial.equals(serverSerial)){                    return true;                }            }            return false;        }else{            return true;        }    }}</code></pre><p>æœ€åæ˜¯Licenseç”Ÿæˆç±»ï¼Œç”¨äºç”ŸæˆLicenseè¯ä¹¦ï¼š</p><pre><code>package cn.zifangsky.license;import de.schlichtherle.license.CipherParam;import de.schlichtherle.license.DefaultCipherParam;import de.schlichtherle.license.DefaultLicenseParam;import de.schlichtherle.license.KeyStoreParam;import de.schlichtherle.license.LicenseContent;import de.schlichtherle.license.LicenseManager;import de.schlichtherle.license.LicenseParam;import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.Logger;import javax.security.auth.x500.X500Principal;import java.io.File;import java.text.MessageFormat;import java.util.prefs.Preferences;/** * Licenseç”Ÿæˆç±» * * @author zifangsky * @date 2018/4/19 * @since 1.0.0 */public class LicenseCreator {    private static Logger logger = LogManager.getLogger(LicenseCreator.class);    private final static X500Principal DEFAULT_HOLDER_AND_ISSUER = new X500Principal("CN=localhost, OU=localhost, O=localhost, L=SH, ST=SH, C=CN");    private LicenseCreatorParam param;    public LicenseCreator(LicenseCreatorParam param) {        this.param = param;    }    /**     * ç”ŸæˆLicenseè¯ä¹¦     * @author zifangsky     * @date 2018/4/20 10:58     * @since 1.0.0     * @return boolean     */    public boolean generateLicense(){        try {            LicenseManager licenseManager = new CustomLicenseManager(initLicenseParam());            LicenseContent licenseContent = initLicenseContent();            licenseManager.store(licenseContent,new File(param.getLicensePath()));            return true;        }catch (Exception e){            logger.error(MessageFormat.format("è¯ä¹¦ç”Ÿæˆå¤±è´¥ï¼š{0}",param),e);            return false;        }    }    /**     * åˆå§‹åŒ–è¯ä¹¦ç”Ÿæˆå‚æ•°     * @author zifangsky     * @date 2018/4/20 10:56     * @since 1.0.0     * @return de.schlichtherle.license.LicenseParam     */    private LicenseParam initLicenseParam(){        Preferences preferences = Preferences.userNodeForPackage(LicenseCreator.class);        //è®¾ç½®å¯¹è¯ä¹¦å†…å®¹åŠ å¯†çš„ç§˜é’¥        CipherParam cipherParam = new DefaultCipherParam(param.getStorePass());        KeyStoreParam privateStoreParam = new CustomKeyStoreParam(LicenseCreator.class                ,param.getPrivateKeysStorePath()                ,param.getPrivateAlias()                ,param.getStorePass()                ,param.getKeyPass());        LicenseParam licenseParam = new DefaultLicenseParam(param.getSubject()                ,preferences                ,privateStoreParam                ,cipherParam);        return licenseParam;    }    /**     * è®¾ç½®è¯ä¹¦ç”Ÿæˆæ­£æ–‡ä¿¡æ¯     * @author zifangsky     * @date 2018/4/20 10:57     * @since 1.0.0     * @return de.schlichtherle.license.LicenseContent     */    private LicenseContent initLicenseContent(){        LicenseContent licenseContent = new LicenseContent();        licenseContent.setHolder(DEFAULT_HOLDER_AND_ISSUER);        licenseContent.setIssuer(DEFAULT_HOLDER_AND_ISSUER);        licenseContent.setSubject(param.getSubject());        licenseContent.setIssued(param.getIssuedTime());        licenseContent.setNotBefore(param.getIssuedTime());        licenseContent.setNotAfter(param.getExpiryTime());        licenseContent.setConsumerType(param.getConsumerType());        licenseContent.setConsumerAmount(param.getConsumerAmount());        licenseContent.setInfo(param.getDescription());        //æ‰©å±•æ ¡éªŒæœåŠ¡å™¨ç¡¬ä»¶ä¿¡æ¯        licenseContent.setExtra(param.getLicenseCheckModel());        return licenseContent;    }}</code></pre><p>iiiï¼‰æ·»åŠ ä¸€ä¸ªç”Ÿæˆè¯ä¹¦çš„Controllerï¼š</p><p>è¿™ä¸ªControllerå¯¹å¤–æä¾›äº†ä¸¤ä¸ªRESTfulæ¥å£ï¼Œåˆ†åˆ«æ˜¯ã€Œè·å–æœåŠ¡å™¨ç¡¬ä»¶ä¿¡æ¯ã€å’Œã€Œç”Ÿæˆè¯ä¹¦ã€ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>package cn.zifangsky.controller;import cn.zifangsky.license.AbstractServerInfos;import cn.zifangsky.license.LicenseCheckModel;import cn.zifangsky.license.LicenseCreator;import cn.zifangsky.license.LicenseCreatorParam;import cn.zifangsky.license.LinuxServerInfos;import cn.zifangsky.license.WindowsServerInfos;import org.apache.commons.lang3.StringUtils;import org.springframework.beans.factory.annotation.Value;import org.springframework.http.MediaType;import org.springframework.web.bind.annotation.RequestBody;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.RestController;import java.util.HashMap;import java.util.Map;/** * * ç”¨äºç”Ÿæˆè¯ä¹¦æ–‡ä»¶ï¼Œä¸èƒ½æ”¾åœ¨ç»™å®¢æˆ·éƒ¨ç½²çš„ä»£ç é‡Œ * @author zifangsky * @date 2018/4/26 * @since 1.0.0 */@RestController@RequestMapping("/license")public class LicenseCreatorController {    /**     * è¯ä¹¦ç”Ÿæˆè·¯å¾„     */    @Value("${license.licensePath}")    private String licensePath;    /**     * è·å–æœåŠ¡å™¨ç¡¬ä»¶ä¿¡æ¯     * @author zifangsky     * @date 2018/4/26 13:13     * @since 1.0.0     * @param osName æ“ä½œç³»ç»Ÿç±»å‹ï¼Œå¦‚æœä¸ºç©ºåˆ™è‡ªåŠ¨åˆ¤æ–­     * @return com.ccx.models.license.LicenseCheckModel     */    @RequestMapping(value = "/getServerInfos",produces = {MediaType.APPLICATION_JSON_UTF8_VALUE})    public LicenseCheckModel getServerInfos(@RequestParam(value = "osName",required = false) String osName) {        //æ“ä½œç³»ç»Ÿç±»å‹        if(StringUtils.isBlank(osName)){            osName = System.getProperty("os.name");        }        osName = osName.toLowerCase();        AbstractServerInfos abstractServerInfos = null;        //æ ¹æ®ä¸åŒæ“ä½œç³»ç»Ÿç±»å‹é€‰æ‹©ä¸åŒçš„æ•°æ®è·å–æ–¹æ³•        if (osName.startsWith("windows")) {            abstractServerInfos = new WindowsServerInfos();        } else if (osName.startsWith("linux")) {            abstractServerInfos = new LinuxServerInfos();        }else{//å…¶ä»–æœåŠ¡å™¨ç±»å‹            abstractServerInfos = new LinuxServerInfos();        }        return abstractServerInfos.getServerInfos();    }    /**     * ç”Ÿæˆè¯ä¹¦     * @author zifangsky     * @date 2018/4/26 13:13     * @since 1.0.0     * @param param ç”Ÿæˆè¯ä¹¦éœ€è¦çš„å‚æ•°ï¼Œå¦‚ï¼š{"subject":"ccx-models","privateAlias":"privateKey","keyPass":"5T7Zz5Y0dJFcqTxvzkH5LDGJJSGMzQ","storePass":"3538cef8e7","licensePath":"C:/Users/zifangsky/Desktop/license.lic","privateKeysStorePath":"C:/Users/zifangsky/Desktop/privateKeys.keystore","issuedTime":"2018-04-26 14:48:12","expiryTime":"2018-12-31 00:00:00","consumerType":"User","consumerAmount":1,"description":"è¿™æ˜¯è¯ä¹¦æè¿°ä¿¡æ¯","licenseCheckModel":{"ipAddress":["192.168.245.1","10.0.5.22"],"macAddress":["00-50-56-C0-00-01","50-7B-9D-F9-18-41"],"cpuSerial":"BFEBFBFF000406E3","mainBoardSerial":"L1HF65E00X9"}}     * @return java.util.Map&lt;java.lang.String,java.lang.Object&gt;     */    @RequestMapping(value = "/generateLicense",produces = {MediaType.APPLICATION_JSON_UTF8_VALUE})    public Map&lt;String,Object&gt; generateLicense(@RequestBody(required = true) LicenseCreatorParam param) {        Map&lt;String,Object&gt; resultMap = new HashMap&lt;&gt;(2);        if(StringUtils.isBlank(param.getLicensePath())){            param.setLicensePath(licensePath);        }        LicenseCreator licenseCreator = new LicenseCreator(param);        boolean result = licenseCreator.generateLicense();        if(result){            resultMap.put("result","ok");            resultMap.put("msg",param);        }else{            resultMap.put("result","error");            resultMap.put("msg","è¯ä¹¦æ–‡ä»¶ç”Ÿæˆå¤±è´¥ï¼");        }        return resultMap;    }}</code></pre><h1 class=pgc-h-arrow-right>ï¼ˆ2ï¼‰ä½¿ç”¨JDKè‡ªå¸¦çš„ keytool å·¥å…·ç”Ÿæˆå…¬ç§é’¥è¯ä¹¦åº“ï¼š</h1><p>å‡å¦‚æˆ‘ä»¬è®¾ç½®å…¬é’¥åº“å¯†ç ä¸ºï¼š<strong>public_password1234</strong>ï¼Œç§é’¥åº“å¯†ç ä¸ºï¼š<strong>private_password1234</strong>ï¼Œåˆ™ç”Ÿæˆå‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>#ç”Ÿæˆå‘½ä»¤keytool -genkeypair -keysize 1024 -validity 3650 -alias "privateKey" -keystore "privateKeys.keystore" -storepass "public_password1234" -keypass "private_password1234" -dname "CN=localhost, OU=localhost, O=localhost, L=SH, ST=SH, C=CN"#å¯¼å‡ºå‘½ä»¤keytool -exportcert -alias "privateKey" -keystore "privateKeys.keystore" -storepass "public_password1234" -file "certfile.cer"#å¯¼å…¥å‘½ä»¤keytool -import -alias "publicCert" -file "certfile.cer" -keystore "publicCerts.keystore" -storepass "public_password1234"</code></pre><p>ä¸Šè¿°å‘½ä»¤æ‰§è¡Œå®Œæˆä¹‹åï¼Œä¼šåœ¨å½“å‰è·¯å¾„ä¸‹ç”Ÿæˆä¸‰ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ï¼šprivateKeys.keystoreã€publicCerts.keystoreã€certfile.cerã€‚<strong>å…¶ä¸­æ–‡ä»¶certfile.cerä¸å†éœ€è¦å¯ä»¥åˆ é™¤ï¼Œæ–‡ä»¶privateKeys.keystoreç”¨äºå½“å‰çš„ ServerDemo é¡¹ç›®ç»™å®¢æˆ·ç”Ÿæˆlicenseæ–‡ä»¶ï¼Œè€Œæ–‡ä»¶publicCerts.keystoreåˆ™éšåº”ç”¨ä»£ç éƒ¨ç½²åˆ°å®¢æˆ·æœåŠ¡å™¨ï¼Œç”¨æˆ·è§£å¯†licenseæ–‡ä»¶å¹¶æ ¡éªŒå…¶è®¸å¯ä¿¡æ¯</strong>ã€‚</p><h1 class=pgc-h-arrow-right>ï¼ˆ3ï¼‰ä¸ºå®¢æˆ·ç”Ÿæˆlicenseæ–‡ä»¶ï¼š</h1><p>å°† ServerDemo é¡¹ç›®éƒ¨ç½²åˆ°å®¢æˆ·æœåŠ¡å™¨ï¼Œé€šè¿‡ä»¥ä¸‹æ¥å£è·å–æœåŠ¡å™¨çš„ç¡¬ä»¶ä¿¡æ¯ï¼ˆç­‰licenseæ–‡ä»¶ç”Ÿæˆåéœ€è¦åˆ é™¤è¿™ä¸ªé¡¹ç›®ã€‚å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤æ‰‹åŠ¨è·å–å®¢æˆ·æœåŠ¡å™¨çš„ç¡¬ä»¶ä¿¡æ¯ï¼Œç„¶ååœ¨å¼€å‘è€…è‡ªå·±çš„ç”µè„‘ä¸Šç”Ÿæˆlicenseæ–‡ä»¶ï¼‰ï¼š</p><div class=pgc-img><img alt=SpringBooté¡¹ç›®ä½¿ç”¨TrueLicenseç”Ÿæˆå’ŒéªŒè¯ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c258f6f3636b44dfb9c72c23d2fc50ef><p class=pgc-img-caption></p></div><p>æ³¨ï¼šä¸Šå›¾ä½¿ç”¨çš„æ˜¯Firefoxçš„RESTClientæ’ä»¶</p><p>ç„¶åç”Ÿæˆlicenseæ–‡ä»¶ï¼š</p><div class=pgc-img><img alt=SpringBooté¡¹ç›®ä½¿ç”¨TrueLicenseç”Ÿæˆå’ŒéªŒè¯ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9dec056f34cc4b519c520fe33b3848a9><p class=pgc-img-caption></p></div><p>è¯·æ±‚æ—¶éœ€è¦åœ¨Headerä¸­æ·»åŠ ä¸€ä¸ªContent-Typeï¼Œå…¶å€¼ä¸ºï¼šapplication/json;charset=UTF-8ã€‚å‚æ•°ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>{	"subject": "license_demo",	"privateAlias": "privateKey",	"keyPass": "private_password1234",	"storePass": "public_password1234",	"licensePath": "C:/Users/zifangsky/Desktop/license_demo/license.lic",	"privateKeysStorePath": "C:/Users/zifangsky/Desktop/license_demo/privateKeys.keystore",	"issuedTime": "2018-07-10 00:00:01",	"expiryTime": "2019-12-31 23:59:59",	"consumerType": "User",	"consumerAmount": 1,	"description": "è¿™æ˜¯è¯ä¹¦æè¿°ä¿¡æ¯",	"licenseCheckModel": {		"ipAddress": ["192.168.245.1", "10.0.5.22"],		"macAddress": ["00-50-56-C0-00-01", "50-7B-9D-F9-18-41"],		"cpuSerial": "BFEBFBFF000406E3",		"mainBoardSerial": "L1HF65E00X9"	}}</code></pre><p>å¦‚æœè¯·æ±‚æˆåŠŸï¼Œé‚£ä¹ˆæœ€åä¼šåœ¨ licensePath å‚æ•°è®¾ç½®çš„è·¯å¾„ç”Ÿæˆä¸€ä¸ªlicense.licçš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯ç»™å®¢æˆ·éƒ¨ç½²ä»£ç çš„æœåŠ¡å™¨è®¸å¯æ–‡ä»¶ã€‚</p><h1 class=pgc-h-arrow-right>ä¸‰ ç»™å®¢æˆ·éƒ¨ç½²çš„åº”ç”¨ä¸­æ·»åŠ Licenseæ ¡éªŒ</h1><h1 class=pgc-h-arrow-right>ï¼ˆ1ï¼‰ä½¿ç”¨Spring Bootæ„å»ºæµ‹è¯•é¡¹ç›®ServerDemoï¼Œç”¨äºæ¨¡æ‹Ÿç»™å®¢æˆ·éƒ¨ç½²çš„åº”ç”¨ï¼š</h1><p>æ³¨ï¼šè¿™ä¸ªå®Œæ•´çš„Demoé¡¹ç›®å¯ä»¥å‚è€ƒï¼šgitee.com/zifangsky/Lâ€¦</p><h1 class=pgc-h-arrow-right>ï¼ˆ2ï¼‰æ·»åŠ Licenseæ ¡éªŒç±»éœ€è¦çš„å‚æ•°ï¼š</h1><pre><code>package cn.zifangsky.license;/** * Licenseæ ¡éªŒç±»éœ€è¦çš„å‚æ•° * * @author zifangsky * @date 2018/4/20 * @since 1.0.0 */public class LicenseVerifyParam {    /**     * è¯ä¹¦subject     */    private String subject;    /**     * å…¬é’¥åˆ«ç§°     */    private String publicAlias;    /**     * è®¿é—®å…¬é’¥åº“çš„å¯†ç      */    private String storePass;    /**     * è¯ä¹¦ç”Ÿæˆè·¯å¾„     */    private String licensePath;    /**     * å¯†é’¥åº“å­˜å‚¨è·¯å¾„     */    private String publicKeysStorePath;    public LicenseVerifyParam() {    }    public LicenseVerifyParam(String subject, String publicAlias, String storePass, String licensePath, String publicKeysStorePath) {        this.subject = subject;        this.publicAlias = publicAlias;        this.storePass = storePass;        this.licensePath = licensePath;        this.publicKeysStorePath = publicKeysStorePath;    }    //çœç•¥setterå’Œgetteræ–¹æ³•    @Override    public String toString() {        return "LicenseVerifyParam{" +                "subject='" + subject + '\'' +                ", publicAlias='" + publicAlias + '\'' +                ", storePass='" + storePass + '\'' +                ", licensePath='" + licensePath + '\'' +                ", publicKeysStorePath='" + publicKeysStorePath + '\'' +                '}';    }}</code></pre><p>ç„¶åå†æ·»åŠ Licenseæ ¡éªŒç±»ï¼š</p><pre><code>package cn.zifangsky.license;import de.schlichtherle.license.*;import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.Logger;import java.io.File;import java.text.DateFormat;import java.text.MessageFormat;import java.text.SimpleDateFormat;import java.util.prefs.Preferences;/** * Licenseæ ¡éªŒç±» * * @author zifangsky * @date 2018/4/20 * @since 1.0.0 */public class LicenseVerify {    private static Logger logger = LogManager.getLogger(LicenseVerify.class);    /**     * å®‰è£…Licenseè¯ä¹¦     * @author zifangsky     * @date 2018/4/20 16:26     * @since 1.0.0     */    public synchronized LicenseContent install(LicenseVerifyParam param){        LicenseContent result = null;        DateFormat format = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");        //1. å®‰è£…è¯ä¹¦        try{            LicenseManager licenseManager = LicenseManagerHolder.getInstance(initLicenseParam(param));            licenseManager.uninstall();            result = licenseManager.install(new File(param.getLicensePath()));            logger.info(MessageFormat.format("è¯ä¹¦å®‰è£…æˆåŠŸï¼Œè¯ä¹¦æœ‰æ•ˆæœŸï¼š{0} - {1}",format.format(result.getNotBefore()),format.format(result.getNotAfter())));        }catch (Exception e){            logger.error("è¯ä¹¦å®‰è£…å¤±è´¥ï¼",e);        }        return result;    }    /**     * æ ¡éªŒLicenseè¯ä¹¦     * @author zifangsky     * @date 2018/4/20 16:26     * @since 1.0.0     * @return boolean     */    public boolean verify(){        LicenseManager licenseManager = LicenseManagerHolder.getInstance(null);        DateFormat format = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");        //2. æ ¡éªŒè¯ä¹¦        try {            LicenseContent licenseContent = licenseManager.verify();//            System.out.println(licenseContent.getSubject());            logger.info(MessageFormat.format("è¯ä¹¦æ ¡éªŒé€šè¿‡ï¼Œè¯ä¹¦æœ‰æ•ˆæœŸï¼š{0} - {1}",format.format(licenseContent.getNotBefore()),format.format(licenseContent.getNotAfter())));            return true;        }catch (Exception e){            logger.error("è¯ä¹¦æ ¡éªŒå¤±è´¥ï¼",e);            return false;        }    }    /**     * åˆå§‹åŒ–è¯ä¹¦ç”Ÿæˆå‚æ•°     * @author zifangsky     * @date 2018/4/20 10:56     * @since 1.0.0     * @param param Licenseæ ¡éªŒç±»éœ€è¦çš„å‚æ•°     * @return de.schlichtherle.license.LicenseParam     */    private LicenseParam initLicenseParam(LicenseVerifyParam param){        Preferences preferences = Preferences.userNodeForPackage(LicenseVerify.class);        CipherParam cipherParam = new DefaultCipherParam(param.getStorePass());        KeyStoreParam publicStoreParam = new CustomKeyStoreParam(LicenseVerify.class                ,param.getPublicKeysStorePath()                ,param.getPublicAlias()                ,param.getStorePass()                ,null);        return new DefaultLicenseParam(param.getSubject()                ,preferences                ,publicStoreParam                ,cipherParam);    }}</code></pre><h1 class=pgc-h-arrow-right>ï¼ˆ3ï¼‰æ·»åŠ Listenerï¼Œç”¨äºåœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™å®‰è£…Licenseè¯ä¹¦ï¼š</h1><pre><code>package cn.zifangsky.license;import org.apache.commons.lang3.StringUtils;import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.Logger;import org.springframework.beans.factory.annotation.Value;import org.springframework.context.ApplicationContext;import org.springframework.context.ApplicationListener;import org.springframework.context.event.ContextRefreshedEvent;import org.springframework.stereotype.Component;/** * åœ¨é¡¹ç›®å¯åŠ¨æ—¶å®‰è£…è¯ä¹¦ * * @author zifangsky * @date 2018/4/24 * @since 1.0.0 */@Componentpublic class LicenseCheckListener implements ApplicationListener&lt;ContextRefreshedEvent&gt; {    private static Logger logger = LogManager.getLogger(LicenseCheckListener.class);    /**     * è¯ä¹¦subject     */    @Value("${license.subject}")    private String subject;    /**     * å…¬é’¥åˆ«ç§°     */    @Value("${license.publicAlias}")    private String publicAlias;    /**     * è®¿é—®å…¬é’¥åº“çš„å¯†ç      */    @Value("${license.storePass}")    private String storePass;    /**     * è¯ä¹¦ç”Ÿæˆè·¯å¾„     */    @Value("${license.licensePath}")    private String licensePath;    /**     * å¯†é’¥åº“å­˜å‚¨è·¯å¾„     */    @Value("${license.publicKeysStorePath}")    private String publicKeysStorePath;    @Override    public void onApplicationEvent(ContextRefreshedEvent event) {        //root application context æ²¡æœ‰parent        ApplicationContext context = event.getApplicationContext().getParent();        if(context == null){            if(StringUtils.isNotBlank(licensePath)){                logger.info("++++++++ å¼€å§‹å®‰è£…è¯ä¹¦ ++++++++");                LicenseVerifyParam param = new LicenseVerifyParam();                param.setSubject(subject);                param.setPublicAlias(publicAlias);                param.setStorePass(storePass);                param.setLicensePath(licensePath);                param.setPublicKeysStorePath(publicKeysStorePath);                LicenseVerify licenseVerify = new LicenseVerify();                //å®‰è£…è¯ä¹¦                licenseVerify.install(param);                logger.info("++++++++ è¯ä¹¦å®‰è£…ç»“æŸ ++++++++");            }        }    }}</code></pre><p>æ³¨ï¼šä¸Šé¢ä»£ç ä½¿ç”¨å‚æ•°ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>#Licenseç›¸å…³é…ç½®license.subject=license_demolicense.publicAlias=publicCertlicense.storePass=public_password1234license.licensePath=C:/Users/zifangsky/Desktop/license_demo/license.liclicense.publicKeysStorePath=C:/Users/zifangsky/Desktop/license_demo/publicCerts.keystore</code></pre><h1 class=pgc-h-arrow-right>ï¼ˆ4ï¼‰æ·»åŠ æ‹¦æˆªå™¨ï¼Œç”¨äºåœ¨ç™»å½•çš„æ—¶å€™æ ¡éªŒLicenseè¯ä¹¦ï¼š</h1><pre><code>package cn.zifangsky.license;import com.alibaba.fastjson.JSON;import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.Logger;import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.util.HashMap;import java.util.Map;/** * LicenseCheckInterceptor * * @author zifangsky * @date 2018/4/25 * @since 1.0.0 */public class LicenseCheckInterceptor extends HandlerInterceptorAdapter{    private static Logger logger = LogManager.getLogger(LicenseCheckInterceptor.class);    @Override    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {        LicenseVerify licenseVerify = new LicenseVerify();        //æ ¡éªŒè¯ä¹¦æ˜¯å¦æœ‰æ•ˆ        boolean verifyResult = licenseVerify.verify();        if(verifyResult){            return true;        }else{            response.setCharacterEncoding("utf-8");            Map&lt;String,String&gt; result = new HashMap&lt;&gt;(1);            result.put("result","æ‚¨çš„è¯ä¹¦æ— æ•ˆï¼Œè¯·æ ¸æŸ¥æœåŠ¡å™¨æ˜¯å¦å–å¾—æˆæƒæˆ–é‡æ–°ç”³è¯·è¯ä¹¦ï¼");            response.getWriter().write(JSON.toJSONString(result));            return false;        }    }}</code></pre><h1 class=pgc-h-arrow-right>ï¼ˆ5ï¼‰æ·»åŠ ç™»å½•é¡µé¢å¹¶æµ‹è¯•ï¼š</h1><p>æ·»åŠ ä¸€ä¸ªç™»å½•é¡µé¢ï¼Œå¯ä»¥åœ¨licenseæ ¡éªŒå¤±è´¥çš„æ—¶å€™ç»™å‡ºé”™è¯¯æç¤ºï¼š</p><pre><code>&lt;html xmlns:th="http://www.thymeleaf.org"&gt;&lt;head&gt;    &lt;meta content="text/html;charset=UTF-8"/&gt;    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"/&gt;    &lt;meta name="viewport" content="width=device-width, initial-scale=1"/&gt;    &lt;title&gt;ç™»å½•é¡µé¢&lt;/title&gt;    &lt;script src="https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"&gt;&lt;/script&gt;    &lt;link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"&gt;    &lt;link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"&gt;    &lt;script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"&gt;&lt;/script&gt;    &lt;link rel="stylesheet" th:href="@{/css/style.css}"/&gt;    &lt;script&gt;        //å›è½¦ç™»å½•        function enterlogin(e) {            var key = window.event ? e.keyCode : e.which;            if (key === 13) {                userLogin();            }        }        //ç”¨æˆ·å¯†ç ç™»å½•        function userLogin() {            //è·å–ç”¨æˆ·åã€å¯†ç             var username = $("#username").val();            var password = $("#password").val();            if (username == null || username === "") {                $("#errMsg").text("è¯·è¾“å…¥ç™»é™†ç”¨æˆ·åï¼");                $("#errMsg").attr("style", "display:block");                return;            }            if (password == null || password === "") {                $("#errMsg").text("è¯·è¾“å…¥ç™»é™†å¯†ç ï¼");                $("#errMsg").attr("style", "display:block");                return;            }            $.ajax({                url: "/check",                type: "POST",                dataType: "json",                async: false,                data: {                    "username": username,                    "password": password                },                success: function (data) {                    if (data.code == "200") {                        $("#errMsg").attr("style", "display:none");                        window.location.href = '/userIndex';                    } else if (data.result != null) {                        $("#errMsg").text(data.result);                        $("#errMsg").attr("style", "display:block");                    } else {                        $("#errMsg").text(data.msg);                        $("#errMsg").attr("style", "display:block");                    }                }            });        }    &lt;/script&gt;&lt;/head&gt;&lt;body onkeydown="enterlogin(event);"&gt;&lt;div class="container"&gt;    &lt;div class="form row"&gt;        &lt;div class="form-horizontal col-md-offset-3" id="login_form"&gt;            &lt;h3 class="form-title"&gt;LOGIN&lt;/h3&gt;            &lt;div class="col-md-9"&gt;                &lt;div class="form-group"&gt;                    &lt;i class="fa fa-user fa-lg"&gt;&lt;/i&gt;                    &lt;input class="form-control required" type="text" placeholder="Username" id="username"                           name="username" autofocus="autofocus" maxlength="20"/&gt;                &lt;/div&gt;                &lt;div class="form-group"&gt;                    &lt;i class="fa fa-lock fa-lg"&gt;&lt;/i&gt;                    &lt;input class="form-control required" type="password" placeholder="Password" id="password"                           name="password" maxlength="8"/&gt;                &lt;/div&gt;                &lt;div class="form-group"&gt;                    &lt;span class="errMsg" id="errMsg" style="display: none"&gt;é”™è¯¯æç¤º&lt;/span&gt;                &lt;/div&gt;                &lt;div class="form-group col-md-offset-9"&gt;                    &lt;button type="submit" class="btn btn-success pull-right" name="submit" onclick="userLogin()"&gt;ç™»å½•                    &lt;/button&gt;                &lt;/div&gt;            &lt;/div&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>iï¼‰å¯åŠ¨é¡¹ç›®ï¼Œå¯ä»¥å‘ç°ä¹‹å‰ç”Ÿæˆçš„licenseè¯ä¹¦å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼š</p><div class=pgc-img><img alt=SpringBooté¡¹ç›®ä½¿ç”¨TrueLicenseç”Ÿæˆå’ŒéªŒè¯ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/886e0435eacb42dcb77e7b67d85b17a3><p class=pgc-img-caption></p></div><p>è¿™æ—¶è®¿é—® http://127.0.0.1:7080/login ï¼Œå¯ä»¥æ­£å¸¸ç™»å½•ï¼š</p><div class=pgc-img><img alt=SpringBooté¡¹ç›®ä½¿ç”¨TrueLicenseç”Ÿæˆå’ŒéªŒè¯ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/951dcc275472495abb3b32ecf23631f3><p class=pgc-img-caption></p></div><p>iiï¼‰é‡æ–°ç”Ÿæˆlicenseè¯ä¹¦ï¼Œå¹¶è®¾ç½®å¾ˆçŸ­çš„æœ‰æ•ˆæœŸã€‚</p><p>iiiï¼‰é‡æ–°å¯åŠ¨ClientDemoï¼Œå¹¶å†æ¬¡ç™»å½•ï¼Œå¯ä»¥å‘ç°çˆ†ä»¥ä¸‹æç¤ºä¿¡æ¯ï¼š</p><div class=pgc-img><img alt=SpringBooté¡¹ç›®ä½¿ç”¨TrueLicenseç”Ÿæˆå’ŒéªŒè¯ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c3983d2e5aa9422bac9d045eb70f350a><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=SpringBooté¡¹ç›®ä½¿ç”¨TrueLicenseç”Ÿæˆå’ŒéªŒè¯ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ddfc4417b3684a79bea75ae697343f03><p class=pgc-img-caption></p></div><p>è‡³æ­¤ï¼Œå…³äºä½¿ç”¨ TrueLicense ç”Ÿæˆå’ŒéªŒè¯Licenseå°±ç»“æŸäº†ï¼Œæ–‡ç« ä¸­æ²¡æœ‰è¯´åˆ°çš„ç±»å¯ä»¥è‡ªè¡Œå‚è€ƒç¤ºä¾‹æºç ï¼Œè°¢è°¢é˜…è¯»ã€‚</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'SpringBoot','é¡¹ç›®','TrueLicense'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>