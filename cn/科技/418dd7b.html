<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>「安卓逆向」去除某银行app签名校验 | 极客快訊</title><meta property="og:title" content="「安卓逆向」去除某银行app签名校验 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/7018e55f6c3a4397af1e14a01e6fbb13"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/418dd7b.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/418dd7b.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/418dd7b.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/418dd7b.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/418dd7b.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/418dd7b.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/418dd7b.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/418dd7b.html><meta property="article:published_time" content="2020-10-29T21:04:28+08:00"><meta property="article:modified_time" content="2020-10-29T21:04:28+08:00"><meta name=Keywords content><meta name=description content="「安卓逆向」去除某银行app签名校验"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/418dd7b.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>「安卓逆向」去除某银行app签名校验</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>首先，祝大家新年快乐！新的一年红红火火！</p><p>前段时间有个朋友联系到我 ，说有家安全公司招聘(哪家公司我就不说了) 但是面试题目第一题就难着了。这我哪儿能忍，直接干!</p><p>拿到app的时候我心凉了一下 ，这银行我搞个锤子，但是逆向工程师绝不认输!</p><p>直接重新签名安装 ，果然不出意外崩溃。</p><p>现在勒让我们捋捋思路，在程序一启动就崩溃，说明校验是存放在入口点或者入口页面的初始化函数里面。先掏出我们的逆向工具 jadx反编译一波，找到AndroidManifest.xml文件里面 我们知道入口点比入口页面执行的时机要早 ，直接先从入口点的onCreate()函数入手。</p><div class=pgc-img><img alt=「安卓逆向」去除某银行app签名校验 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7018e55f6c3a4397af1e14a01e6fbb13><p class=pgc-img-caption></p></div><p><br></p><div class=pgc-img><img alt=「安卓逆向」去除某银行app签名校验 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15359a922dfe46ee9339251fef713e7c><p class=pgc-img-caption></p></div><p>直接往下跟捋捋逻辑</p><p>Java层其实没啥东西，只要你思路清晰一眼就能看出来 ，这个onCreate()函数首先调用了一些super 然后注册了一些事件 ，下面我们看到了一句代码：</p><div class=pgc-img><img alt=「安卓逆向」去除某银行app签名校验 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/39c5906940de417387913acfb7084f0d><p class=pgc-img-caption></p></div><p>Init这又在初始化什么??? 过去看看：</p><div class=pgc-img><img alt=「安卓逆向」去除某银行app签名校验 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/3ff1a9fff6de409eb7748a3a6d23f07a><p class=pgc-img-caption></p></div><p><br></p><p>System.loadLibrary加载了这个so库 ，上面还有个native关键词修饰的getSignatures();函数。</p><p>这就有点敏感了，心里已经10有8 9确定了签名校验在so层 ，然后这个init又调用了一个native_init函数 传入了一个context ，既然如此就去so看看：</p><p><br></p><div class=pgc-img><img alt=「安卓逆向」去除某银行app签名校验 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a27f3955c6dd44269d5411e0be9705b5><p class=pgc-img-caption></p></div><p>So文件还是挺多的 直接拖出来 ，放进ida反编译一波。</p><p>找到节区分析，逆向分析思路一定得要清晰 ，先不慌搜索注册得函数，先看一波init跟init_array ，不清楚这部操作的小贴友们不要慌 ，推荐学习一下so文件的加载流程以及ELF文件结构 (可能下篇文章会详细讲到，不过市面上也有很多百度一波就行。看不懂就留言我抽空自己写一下以我理解的流程 ，嚼碎了给你)</p><p>言归正转，接着来：</p><div class=pgc-img><img alt=「安卓逆向」去除某银行app签名校验 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/aa704f06b40740638754fe91a8689a60><p class=pgc-img-caption></p></div><p>没有东西 ，可以松口气了，要是再有东西就又多了几步了。</p><p>接着找到导出函数窗口搜索一波</p><div class=pgc-img><img alt=「安卓逆向」去除某银行app签名校验 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f9a564ccae1d4e9592ea8bd8a5f9f97b><p class=pgc-img-caption></p></div><p>采用了静态注册问题不大，来到这个函数</p><div class=pgc-img><img alt=「安卓逆向」去除某银行app签名校验 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4f28685193e94279950b0aca75619990><p class=pgc-img-caption></p></div><p>没啥操作直接调用了_Z8init_libP7_JNIEnvP8_jobject 这个函数初始化，跟进</p><div class=pgc-img><img alt=「安卓逆向」去除某银行app签名校验 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/da7519fdd9604d7cb9fe53b242eb7a79><p class=pgc-img-caption></p></div><p>又调用了_Z9check_appP7_JNIEnvP8_jobject函数 ，跟进</p><p>来到这个check_app函数里面</p><div class=pgc-img><img alt=「安卓逆向」去除某银行app签名校验 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/de4a2b7fa68b4a2a8f932212e7056ec5><p class=pgc-img-caption></p></div><p>发现这里调用了这个get_sign这个函数，我们往上看他传入了那些参数，R0寄存器是R4传入的env ，R1寄存器就是R5传入的jobject，R2寄存器就是调用上面的函数的返回值。</p><p>这里先不看，现在分析到这里我们可以通过他的函数名称确定在这里get获取这个sign签名。</p><div class=pgc-img><img alt=「安卓逆向」去除某银行app签名校验 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/710676327beb490da6509015913d7b36><p class=pgc-img-caption></p></div><p>紧接着进行md5 sha系列的签名运算</p><div class=pgc-img><img alt=「安卓逆向」去除某银行app签名校验 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b5ab4a653345419f81d1217e4536b19c><p class=pgc-img-caption></p></div><p>我们也可以看一下他的运行流程</p><p>没有混淆就是为所欲为</p><p>找到了这个get_sign获取当前签名了就好办了，直接改这个调用就行，要是要改的干净一点可以从下面的判断入手，直接改nop指令你就得注意下面的寄存器相关的使用了，稍不注意就gg。</p><p>改好以后直接运行，完美!</p><p><br></p><p>好了这个就讲到这里了，听说月薪小20k ，流下了我月薪1800的泪水！</p><p><br></p><p>总结一下:现在安卓逆向安全行业的门槛还是挺低的，你品，你细品。这个银行如果加壳(当然了银行基本不会加壳) 就费时间了，还有就是对so文件的保护不够好，关键点很好定位，基本不用动态就能分析出来 ，混淆也没有，不过混淆也没啥用，对咱逆向安全工程师来说都问题不大!</p><p>本面试题案例来源与网络，如有侵权，请联系删除</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'安卓','某银行','app'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>