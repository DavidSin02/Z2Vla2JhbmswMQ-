<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>æ¯å‘¨ä¸€ä¸ª Python æ¨¡å— | socket | æå®¢å¿«è¨Š</title><meta property="og:title" content="æ¯å‘¨ä¸€ä¸ª Python æ¨¡å— | socket - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/dfic-imagehandler/5276b6c4-ac34-470d-b72c-8f2e22a6ac3e"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4194d1c.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4194d1c.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4194d1c.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4194d1c.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4194d1c.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4194d1c.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4194d1c.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4194d1c.html><meta property="article:published_time" content="2020-10-29T21:04:30+08:00"><meta property="article:modified_time" content="2020-10-29T21:04:30+08:00"><meta name=Keywords content><meta name=description content="æ¯å‘¨ä¸€ä¸ª Python æ¨¡å— | socket"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/4194d1c.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>æ¯å‘¨ä¸€ä¸ª Python æ¨¡å— | socket</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div class=pgc-img><img alt="æ¯å‘¨ä¸€ä¸ª Python æ¨¡å— | socket" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/5276b6c4-ac34-470d-b72c-8f2e22a6ac3e><p class=pgc-img-caption></p></div><p>Socket æä¾›äº†æ ‡å‡†çš„ BSD Socket APIï¼Œä»¥ä¾¿ä½¿ç”¨ BSD å¥—æ¥å­—æ¥å£é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚å®ƒåŒ…æ‹¬ç”¨äºå¤„ç†å®é™…æ•°æ®é€šé“çš„ç±»ï¼Œè¿˜åŒ…æ‹¬ä¸ç½‘ç»œç›¸å…³çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å°†æœåŠ¡å™¨çš„åç§°è½¬æ¢ä¸ºåœ°å€ä»¥åŠæ ¼å¼åŒ–è¦é€šè¿‡ç½‘ç»œå‘é€çš„æ•°æ®ã€‚</p><p>å¯»å€ã€åè®®æ—å’Œå¥—æ¥å­—ç±»å‹</p><p>socket æ˜¯ç”±ç¨‹åºç”¨æ¥ä¼ é€’æ•°æ®æˆ–é€šè¿‡äº’è”ç½‘é€šä¿¡çš„ä¿¡é“çš„ä¸€ä¸ªç«¯ç‚¹ã€‚å¥—æ¥å­—æœ‰ä¸¤ä¸ªä¸»è¦å±æ€§æ¥æ§åˆ¶å®ƒä»¬å‘é€æ•°æ®çš„æ–¹å¼ï¼š åœ°å€æ—æ§åˆ¶æ‰€ä½¿ç”¨çš„ OSI ç½‘ç»œå±‚åè®®ï¼Œ ä»¥åŠå¥—æ¥å­—ç±»å‹æ§åˆ¶ä¼ è¾“å±‚åè®®ã€‚</p><p>Python æ”¯æŒä¸‰ç§åœ°å€æ—ã€‚æœ€å¸¸è§çš„æ˜¯ AF_INETï¼Œç”¨äº IPv4 ç½‘ç»œå¯»å€ã€‚IPv4 åœ°å€é•¿åº¦ä¸ºå››ä¸ªå­—èŠ‚ï¼Œé€šå¸¸è¡¨ç¤ºä¸ºå››ä¸ªæ•°å­—çš„åºåˆ—ï¼Œæ¯å…«å­—èŠ‚ä¸€ä¸ªï¼Œç”¨ç‚¹åˆ†éš”ï¼ˆä¾‹å¦‚ï¼Œ10.1.1.5å’Œ127.0.0.1ï¼‰ã€‚è¿™äº›å€¼é€šå¸¸è¢«ç§°ä¸º IP åœ°å€ã€‚</p><p>AF_INET6ç”¨äºIPv6 ç½‘ç»œå¯»å€ã€‚IPv6 æ˜¯ç½‘ç»œåè®®çš„ä¸‹ä¸€ä»£ç‰ˆæœ¬ï¼Œæ”¯æŒ IPv4 ä¸‹ä¸å¯ç”¨çš„ 128 ä½åœ°å€ï¼Œæµé‡æ•´å‹å’Œè·¯ç”±åŠŸèƒ½ã€‚IPv6 çš„é‡‡ç”¨ç‡æŒç»­å¢é•¿ï¼Œç‰¹åˆ«æ˜¯éšç€äº‘è®¡ç®—çš„å‘å±•ï¼Œä»¥åŠç”±äºç‰©è”ç½‘é¡¹ç›®è€Œæ·»åŠ åˆ°ç½‘ç»œä¸­çš„é¢å¤–è®¾å¤‡çš„æ¿€å¢ã€‚</p><p>AF_UNIXæ˜¯ Unix åŸŸå¥—æ¥å­—ï¼ˆUDSï¼‰çš„åœ°å€æ—ï¼Œå®ƒæ˜¯ POSIX å…¼å®¹ç³»ç»Ÿä¸Šå¯ç”¨çš„è¿›ç¨‹é—´é€šä¿¡åè®®ã€‚UDS çš„å®ç°å…è®¸æ“ä½œç³»ç»Ÿå°†æ•°æ®ç›´æ¥ä»ä¸€ä¸ªè¿›ç¨‹ä¼ é€’åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œæ— éœ€é€šè¿‡ç½‘ç»œå †æ ˆã€‚è¿™æ¯”ä½¿ç”¨ AF_INET æ›´é«˜æ•ˆï¼Œä½†ç”±äºæ–‡ä»¶ç³»ç»Ÿç”¨ä½œå¯»å€çš„å‘½åç©ºé—´ï¼Œå› æ­¤ UDS ä»…é™äºåŒä¸€ç³»ç»Ÿä¸Šçš„è¿›ç¨‹ã€‚ä½¿ç”¨ UDS è€Œä¸æ˜¯å…¶ä»– IPC æœºåˆ¶ï¼ˆå¦‚å‘½åç®¡é“æˆ–å…±äº«å†…å­˜ï¼‰çš„å¸å¼•åŠ›åœ¨äºç¼–ç¨‹æ¥å£ä¸ IP ç½‘ç»œç›¸åŒï¼Œå› æ­¤åº”ç”¨ç¨‹åºå¯ä»¥åœ¨å•ä¸ªä¸»æœºä¸Šè¿è¡Œæ—¶é«˜æ•ˆé€šä¿¡ã€‚</p><p>æ³¨æ„ï¼šAF_UNIXå¸¸é‡ä»…å®šä¹‰åœ¨æ”¯æŒ UDS çš„ç³»ç»Ÿä¸Šã€‚</p><p>å¥—æ¥å­—ç±»å‹é€šå¸¸ç”¨ SOCK_DGRAM å¤„ç†é¢å‘æ¶ˆæ¯çš„æ•°æ®æŠ¥ä¼ è¾“ï¼Œç”¨ SOCK_STREAM å¤„ç†é¢å‘å­—èŠ‚æµçš„ä¼ è¾“ã€‚æ•°æ®æŠ¥å¥—æ¥å­—é€šå¸¸ä¸ UDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰ç›¸å…³è” ï¼Œå®ƒä»¬æä¾›ä¸å¯é çš„å•ä¸ªæ¶ˆæ¯ä¼ é€’ã€‚é¢å‘æµçš„å¥—æ¥å­—ä¸ TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰ç›¸å…³è” ã€‚å®ƒä»¬åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æä¾›å­—èŠ‚æµï¼Œé€šè¿‡è¶…æ—¶ç®¡ç†ï¼Œé‡ä¼ å’Œå…¶ä»–åŠŸèƒ½ç¡®ä¿æ¶ˆæ¯ä¼ é€’æˆ–æ•…éšœé€šçŸ¥ã€‚</p><p>å¤§å¤šæ•°æä¾›å¤§é‡æ•°æ®çš„åº”ç”¨ç¨‹åºåè®®ï¼ˆå¦‚ HTTPï¼‰éƒ½æ˜¯åŸºäº TCP æ„å»ºçš„ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨è‡ªåŠ¨å¤„ç†æ¶ˆæ¯æ’åºå’Œä¼ é€’æ—¶æ›´è½»æ¾åœ°åˆ›å»ºå¤æ‚çš„åº”ç”¨ç¨‹åºã€‚UDP é€šå¸¸ç”¨äºæ¶ˆæ¯ä¸å¤ªé‡è¦çš„åè®®ï¼ˆä¾‹å¦‚é€šè¿‡ DNS æŸ¥æ‰¾åç§°ï¼‰ï¼Œæˆ–è€…ç”¨äºå¤šæ’­ï¼ˆå°†ç›¸åŒæ•°æ®å‘é€åˆ°å¤šä¸ªä¸»æœºï¼‰ã€‚UDP å’Œ TCP éƒ½å¯ä»¥ä¸ IPv4 æˆ– IPv6 å¯»å€ä¸€èµ·ä½¿ç”¨ã€‚</p><p>æ³¨æ„ï¼šPython çš„socketæ¨¡å—è¿˜æ”¯æŒå…¶ä»–å¥—æ¥å­—ç±»å‹ï¼Œä½†ä¸å¤ªå¸¸ç”¨ï¼Œå› æ­¤è¿™é‡Œä¸åšä»‹ç»ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ ‡å‡†åº“æ–‡æ¡£ã€‚</p><p>åœ¨ç½‘ç»œä¸ŠæŸ¥æ‰¾ä¸»æœº</p><p>socket åŒ…å«ä¸ç½‘ç»œåŸŸåæœåŠ¡æ¥å£ç›¸å…³çš„åŠŸèƒ½ï¼Œå› æ­¤ç¨‹åºå¯ä»¥å°†æœåŠ¡å™¨ä¸»æœºåè½¬æ¢ä¸ºå…¶æ•°å­—ç½‘ç»œåœ°å€ã€‚è™½ç„¶ç¨‹åºåœ¨ä½¿ç”¨å®ƒä»¬è¿æ¥æœåŠ¡å™¨ä¹‹å‰ä¸éœ€è¦æ˜¾å¼è½¬æ¢åœ°å€ï¼Œä½†åœ¨æŠ¥é”™æ—¶ï¼ŒåŒ…å«æ•°å­—åœ°å€ä»¥åŠä½¿ç”¨çš„åç§°ä¼šå¾ˆæœ‰ç”¨ã€‚</p><p>è¦æŸ¥æ‰¾å½“å‰ä¸»æœºçš„æ­£å¼åç§°ï¼Œå¯ä»¥ä½¿ç”¨ gethostname()ã€‚</p><pre>import socketprint(socket.gethostname())	# apu.hellfly.net</pre><p>è¿”å›çš„åç§°å–å†³äºå½“å‰ç³»ç»Ÿçš„ç½‘ç»œè®¾ç½®ï¼Œå¦‚æœä½äºä¸åŒçš„ç½‘ç»œï¼ˆä¾‹å¦‚è¿æ¥åˆ°æ— çº¿ LAN çš„ç¬”è®°æœ¬ç”µè„‘ï¼‰ï¼Œåˆ™å¯èƒ½ä¼šæ›´æ”¹ã€‚</p><p>ä½¿ç”¨ gethostbyname() å°†æœåŠ¡å™¨åç§°è½¬æ¢ä¸ºå®ƒçš„æ•°å­—åœ°å€ã€‚</p><pre>import socketHOSTS = [ 'apu', 'pymotw.com', 'www.python.org', 'nosuchname',]for host in HOSTS: try: print('{} : {}'.format(host, socket.gethostbyname(host))) except socket.error as msg: print('{} : {}'.format(host, msg)) # output# apu : 10.9.0.10# pymotw.com : 66.33.211.242# www.python.org : 151.101.32.223# nosuchname : [Errno 8] nodename nor servname provided, or not known</pre><p>å¦‚æœå½“å‰ç³»ç»Ÿçš„ DNS é…ç½®åœ¨æœç´¢ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªåŸŸï¼Œåˆ™ name å‚æ•°ä¸å¿…è¦æ˜¯å®Œæ•´çš„åç§°ï¼ˆå³ï¼Œå®ƒä¸éœ€è¦åŒ…æ‹¬åŸŸåä»¥åŠåŸºæœ¬ä¸»æœºåï¼‰ã€‚å¦‚æœæ‰¾ä¸åˆ°è¯¥åç§°ï¼Œåˆ™ä¼šå¼•å‘ socket.error ç±»å‹å¼‚å¸¸ã€‚</p><p>è¦è®¿é—®æœåŠ¡å™¨çš„æ›´å¤šå‘½åä¿¡æ¯ï¼Œè¯·ä½¿ç”¨ gethostbyname_ex()ã€‚å®ƒè¿”å›æœåŠ¡å™¨çš„è§„èŒƒä¸»æœºåï¼Œåˆ«åä»¥åŠå¯ç”¨äºè®¿é—®å®ƒçš„æ‰€æœ‰å¯ç”¨ IP åœ°å€ã€‚</p><pre>import socketHOSTS = [ 'apu', 'pymotw.com', 'www.python.org', 'nosuchname',]for host in HOSTS: print(host) try: name, aliases, addresses = socket.gethostbyname_ex(host) print(' Hostname:', name) print(' Aliases :', aliases) print(' Addresses:', addresses) except socket.error as msg: print('ERROR:', msg) print() # output# apu# Hostname: apu.hellfly.net# Aliases : ['apu']# Addresses: ['10.9.0.10']# # pymotw.com# Hostname: pymotw.com# Aliases : []# Addresses: ['66.33.211.242']# # www.python.org# Hostname: prod.python.map.fastlylb.net# Aliases : ['www.python.org', 'python.map.fastly.net']# Addresses: ['151.101.32.223']# # nosuchname# ERROR: [Errno 8] nodename nor servname provided, or not known</pre><p>æ‹¥æœ‰æœåŠ¡å™¨çš„æ‰€æœ‰å·²çŸ¥ IP åœ°å€åï¼Œå®¢æˆ·ç«¯å¯ä»¥å®ç°è‡ªå·±çš„è´Ÿè½½å‡è¡¡æˆ–æ•…éšœè½¬ç§»ç®—æ³•ã€‚</p><p>ä½¿ç”¨getfqdn() å°†éƒ¨åˆ†åç§°è½¬æ¢ä¸ºä¸€ä¸ªå®Œæ•´çš„åŸŸåã€‚</p><pre>import socketfor host in ['apu', 'pymotw.com']: print('{:&gt;10} : {}'.format(host, socket.getfqdn(host))) # output# apu : apu.hellfly.net# pymotw.com : apache2-echo.catalina.dreamhost.com</pre><p>å¦‚æœè¾“å…¥æ˜¯åˆ«åï¼Œåˆ™è¿”å›çš„åç§°ä¸ä¸€å®šä¸è¾“å…¥å‚æ•°åŒ¹é…ï¼Œä¾‹å¦‚æ­¤å¤„çš„ wwwã€‚</p><p>å½“æœåŠ¡å™¨åœ°å€å¯ç”¨æ—¶ï¼Œä½¿ç”¨gethostbyaddr() å¯¹åç§°æ‰§è¡Œâ€œåå‘â€æŸ¥æ‰¾ã€‚</p><pre>import sockethostname, aliases, addresses = socket.gethostbyaddr('10.9.0.10')print('Hostname :', hostname)	# Hostname : apu.hellfly.netprint('Aliases :', aliases)	# Aliases : ['apu']print('Addresses:', addresses)	# Addresses: ['10.9.0.10']</pre><p>è¿”å›å€¼æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«å®Œæ•´ä¸»æœºåï¼Œåˆ«åä»¥åŠä¸è¯¥åç§°å…³è”çš„æ‰€æœ‰ IP åœ°å€ã€‚</p><p>æŸ¥æ‰¾æœåŠ¡ä¿¡æ¯</p><p>é™¤ IP åœ°å€å¤–ï¼Œæ¯ä¸ªå¥—æ¥å­—åœ°å€è¿˜åŒ…æ‹¬ä¸€ä¸ªæ•´æ•°ç«¯å£å·ã€‚è®¸å¤šåº”ç”¨ç¨‹åºå¯ä»¥åœ¨åŒä¸€ä¸»æœºä¸Šè¿è¡Œï¼Œç›‘å¬å•ä¸ª IP åœ°å€ï¼Œä½†ä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªå¥—æ¥å­—å¯ä»¥ä½¿ç”¨è¯¥åœ°å€çš„ç«¯å£ã€‚IP åœ°å€ï¼Œåè®®å’Œç«¯å£å·çš„ç»„åˆå”¯ä¸€åœ°æ ‡è¯†é€šä¿¡ä¿¡é“ï¼Œå¹¶ç¡®ä¿é€šè¿‡å¥—æ¥å­—å‘é€çš„æ¶ˆæ¯åˆ°è¾¾æ­£ç¡®çš„ç›®çš„åœ°ã€‚</p><p>æŸäº›ç«¯å£å·æ˜¯ä¸ºç‰¹å®šåè®®é¢„å…ˆåˆ†é…çš„ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ SMTP çš„ç”µå­é‚®ä»¶æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œä½¿ç”¨ TCP åœ¨ç«¯å£å· 25 ä¸Šè¿›è¡Œï¼Œè€Œ Web å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨ç«¯å£ 80 è¿›è¡Œ HTTP é€šä¿¡ã€‚å¯ä»¥ä½¿ç”¨ getservbyname() æŸ¥æ‰¾å…·æœ‰æ ‡å‡†åŒ–åç§°çš„ç½‘ç»œæœåŠ¡çš„ç«¯å£å·ã€‚</p><pre>import socketfrom urllib.parse import urlparseURLS = [ 'http://www.python.org', 'https://www.mybank.com', 'ftp://prep.ai.mit.edu', 'gopher://gopher.micro.umn.edu', 'smtp://mail.example.com', 'imap://mail.example.com', 'imaps://mail.example.com', 'pop3://pop.example.com', 'pop3s://pop.example.com',]for url in URLS: parsed_url = urlparse(url) port = socket.getservbyname(parsed_url.scheme) print('{:&gt;6} : {}'.format(parsed_url.scheme, port)) # output# http : 80# https : 443# ftp : 21# gopher : 70# smtp : 25# imap : 143# imaps : 993# pop3 : 110# pop3s : 995</pre><p>è™½ç„¶æ ‡å‡†åŒ–æœåŠ¡ä¸å¤ªå¯èƒ½æ”¹å˜ç«¯å£ï¼Œä½†æ˜¯åœ¨æœªæ¥æ·»åŠ æ–°æœåŠ¡æ—¶ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥æŸ¥æ‰¾è€Œä¸æ˜¯ç¡¬ç¼–ç ä¼šæ›´çµæ´»ã€‚</p><p>è¦åè½¬æœåŠ¡ç«¯å£æŸ¥æ‰¾ï¼Œä½¿ç”¨getservbyport()ã€‚</p><pre>import socketfrom urllib.parse import urlunparsefor port in [80, 443, 21, 70, 25, 143, 993, 110, 995]: url = '{}://example.com/'.format(socket.getservbyport(port)) print(url) # output# http://example.com/# https://example.com/# ftp://example.com/# gopher://example.com/# smtp://example.com/# imap://example.com/# imaps://example.com/# pop3://example.com/# pop3s://example.com/</pre><p>åå‘æŸ¥æ‰¾å¯¹äºä»ä»»æ„åœ°å€æ„é€ æœåŠ¡çš„ URL éå¸¸æœ‰ç”¨ã€‚</p><p>å¯ä»¥ä½¿ç”¨ getprotobyname() æ£€ç´¢åˆ†é…ç»™ä¼ è¾“åè®®çš„ç¼–å·ã€‚</p><pre>import socketdef get_constants(prefix): """Create a dictionary mapping socket module constants to their names. """ return { getattr(socket, n): n for n in dir(socket) if n.startswith(prefix) }protocols = get_constants('IPPROTO_')for name in ['icmp', 'udp', 'tcp']: proto_num = socket.getprotobyname(name) const_name = protocols[proto_num] print('{:&gt;4} -&gt; {:2d} (socket.{:&lt;12} = {:2d})'.format( name, proto_num, const_name, getattr(socket, const_name))) # output# icmp -&gt; 1 (socket.IPPROTO_ICMP = 1)# udp -&gt; 17 (socket.IPPROTO_UDP = 17)# tcp -&gt; 6 (socket.IPPROTO_TCP = 6)</pre><p>åè®®å·çš„å€¼æ˜¯æ ‡å‡†åŒ–çš„ï¼Œç”¨å‰ç¼€ IPPROTO_ å®šä¹‰ä¸ºå¸¸é‡ã€‚</p><p>æŸ¥æ‰¾æœåŠ¡å™¨åœ°å€</p><p>getaddrinfo() å°†æœåŠ¡çš„åŸºæœ¬åœ°å€è½¬æ¢ä¸ºå…ƒç»„åˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«å»ºç«‹è¿æ¥æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚æ¯ä¸ªå…ƒç»„çš„å†…å®¹ä¼šæœ‰æ‰€ä¸åŒï¼ŒåŒ…å«ä¸åŒçš„ç½‘ç»œåœ°å€æ—æˆ–åè®®ã€‚</p><pre>import socketdef get_constants(prefix): """Create a dictionary mapping socket module constants to their names. """ return { getattr(socket, n): n for n in dir(socket) if n.startswith(prefix) }families = get_constants('AF_')types = get_constants('SOCK_')protocols = get_constants('IPPROTO_')for response in socket.getaddrinfo('www.python.org', 'http'): # Unpack the response tuple family, socktype, proto, canonname, sockaddr = response print('Family :', families[family]) print('Type :', types[socktype]) print('Protocol :', protocols[proto]) print('Canonical name:', canonname) print('Socket address:', sockaddr) print() # output# Family : AF_INET# Type : SOCK_DGRAM# Protocol : IPPROTO_UDP# Canonical name:# Socket address: ('151.101.32.223', 80)# # Family : AF_INET# Type : SOCK_STREAM# Protocol : IPPROTO_TCP# Canonical name:# Socket address: ('151.101.32.223', 80)# # Family : AF_INET6# Type : SOCK_DGRAM# Protocol : IPPROTO_UDP# Canonical name:# Socket address: ('2a04:4e42:8::223', 80, 0, 0)# # Family : AF_INET6# Type : SOCK_STREAM# Protocol : IPPROTO_TCP# Canonical name:# Socket address: ('2a04:4e42:8::223', 80, 0, 0)</pre><p>è¯¥ç¨‹åºæ¼”ç¤ºäº†å¦‚ä½•æŸ¥æ‰¾ www.python.org çš„è¿æ¥ä¿¡æ¯ã€‚</p><p>getaddrinfo()é‡‡ç”¨å‡ ä¸ªå‚æ•°æ¥è¿‡æ»¤ç»“æœåˆ—è¡¨ã€‚hostå’Œportæ˜¯å¿…ä¼ å‚æ•°ã€‚å¯é€‰çš„å‚æ•°æ˜¯familyï¼Œ socktypeï¼Œprotoï¼Œå’Œflagsã€‚å¯é€‰å€¼åº”è¯¥æ˜¯0æˆ–ç”± socket å®šä¹‰çš„å¸¸é‡ä¹‹ä¸€ã€‚</p><pre>import socketdef get_constants(prefix): """Create a dictionary mapping socket module constants to their names. """ return { getattr(socket, n): n for n in dir(socket) if n.startswith(prefix) }families = get_constants('AF_')types = get_constants('SOCK_')protocols = get_constants('IPPROTO_')responses = socket.getaddrinfo( host='www.python.org', port='http', family=socket.AF_INET, type=socket.SOCK_STREAM, proto=socket.IPPROTO_TCP, flags=socket.AI_CANONNAME,)for response in responses: # Unpack the response tuple family, socktype, proto, canonname, sockaddr = response print('Family :', families[family]) print('Type :', types[socktype]) print('Protocol :', protocols[proto]) print('Canonical name:', canonname) print('Socket address:', sockaddr) print() # output# Family : AF_INET# Type : SOCK_STREAM# Protocol : IPPROTO_TCP# Canonical name: prod.python.map.fastlylb.net# Socket address: ('151.101.32.223', 80)</pre><p>ç”±äºflagsåŒ…å«AI_CANONNAMEï¼ŒæœåŠ¡å™¨çš„è§„èŒƒåç§°ï¼ˆå¯èƒ½ä¸ä¸»æœºå…·æœ‰åˆ«åæ—¶ç”¨äºæŸ¥æ‰¾çš„å€¼ä¸åŒï¼‰åŒ…å«åœ¨ç»“æœä¸­ã€‚å¦‚æœæ²¡æœ‰è¯¥æ ‡å¿—ï¼Œåˆ™è§„èŒƒåç§°å°†ä¿ç•™ä¸ºç©ºã€‚</p><p>IP åœ°å€è¡¨ç¤º</p><p>ç”¨ C ç¼–å†™çš„ç½‘ç»œç¨‹åºä½¿ç”¨æ•°æ®ç±»å‹å°† IP åœ°å€è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶å€¼ï¼ˆè€Œä¸æ˜¯é€šå¸¸åœ¨ Python ç¨‹åºä¸­çš„å­—ç¬¦ä¸²åœ°å€ï¼‰ã€‚è¦åœ¨ Python è¡¨ç¤ºå’Œ C è¡¨ç¤ºä¹‹é—´è½¬æ¢ IPv4 åœ°å€ï¼Œè¯·ä½¿ç”¨structsockaddrã€inet_aton() å’Œ inet_ntoa()ã€‚</p><pre>import binasciiimport socketimport structimport sysfor string_address in ['192.168.1.1', '127.0.0.1']: packed = socket.inet_aton(string_address) print('Original:', string_address) print('Packed :', binascii.hexlify(packed)) print('Unpacked:', socket.inet_ntoa(packed)) print() # output# Original: 192.168.1.1# Packed : b'c0a80101'# Unpacked: 192.168.1.1# # Original: 127.0.0.1# Packed : b'7f000001'# Unpacked: 127.0.0.1</pre><p>æ‰“åŒ…æ ¼å¼ä¸­çš„å››ä¸ªå­—èŠ‚å¯ä»¥ä¼ é€’ç»™ C åº“ï¼Œé€šè¿‡ç½‘ç»œå®‰å…¨ä¼ è¾“ï¼Œæˆ–è€…ç´§å‡‘åœ°ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p><p>ç›¸å…³å‡½æ•° inet_pton() å’Œ inet_ntop() æ”¯æŒ IPv4 å’Œ IPv6ï¼Œæ ¹æ®ä¼ å…¥çš„åœ°å€æ—å‚æ•°ç”Ÿæˆé€‚å½“çš„æ ¼å¼ã€‚</p><pre>import binasciiimport socketimport structimport sysstring_address = '2002:ac10:10a:1234:21e:52ff:fe74:40e'packed = socket.inet_pton(socket.AF_INET6, string_address)print('Original:', string_address)print('Packed :', binascii.hexlify(packed))print('Unpacked:', socket.inet_ntop(socket.AF_INET6, packed))# output# Original: 2002:ac10:10a:1234:21e:52ff:fe74:40e# Packed : b'2002ac10010a1234021e52fffe74040e'# Unpacked: 2002:ac10:10a:1234:21e:52ff:fe74:40e</pre><p>IPv6 åœ°å€å·²ç»æ˜¯åå…­è¿›åˆ¶å€¼ï¼Œå› æ­¤å°†æ‰“åŒ…ç‰ˆæœ¬è½¬æ¢ä¸ºä¸€ç³»åˆ—åå…­è¿›åˆ¶æ•°å­—ä¼šç”Ÿæˆç±»ä¼¼äºåŸå§‹å€¼çš„å­—ç¬¦ä¸²ã€‚</p><p>TCP/IP å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯</p><p>Sockets å¯ä»¥ä½œä¸ºæœåŠ¡ç«¯å¹¶ç›‘å¬ä¼ å…¥æ¶ˆæ¯ï¼Œæˆ–ä½œä¸ºå®¢æˆ·ç«¯è¿æ¥å…¶ä»–åº”ç”¨ç¨‹åºã€‚è¿æ¥ TCP/IP å¥—æ¥å­—çš„ä¸¤ç«¯åï¼Œé€šä¿¡æ˜¯åŒå‘çš„ã€‚</p><p>æœåŠ¡ç«¯</p><p>æ­¤ç¤ºä¾‹ç¨‹åºåŸºäºæ ‡å‡†åº“æ–‡æ¡£ä¸­çš„ç¤ºä¾‹ç¨‹åºï¼Œæ¥æ”¶ä¼ å…¥çš„æ¶ˆæ¯å¹¶å°†å®ƒä»¬å›é€ç»™å‘é€æ–¹ã€‚å®ƒé¦–å…ˆåˆ›å»ºä¸€ä¸ª TCP/IP å¥—æ¥å­—ï¼Œç„¶åç”¨ bind() å°†å¥—æ¥å­—ä¸æœåŠ¡å™¨åœ°å€ç›¸å…³è”ã€‚åœ°å€æ˜¯localhostæŒ‡å½“å‰æœåŠ¡å™¨ï¼Œç«¯å£å·æ˜¯ 10000ã€‚</p><pre># socket_echo_server.pyimport socketimport sys# Create a TCP/IP socketsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# Bind the socket to the portserver_address = ('localhost', 10000)print('starting up on {} port {}'.format(*server_address))sock.bind(server_address)# Listen for incoming connectionssock.listen(1)while True: # Wait for a connection print('waiting for a connection') connection, client_address = sock.accept() try: print('connection from', client_address) # Receive the data in small chunks and retransmit it while True: data = connection.recv(16) print('received {!r}'.format(data)) if data: print('sending data back to the client') connection.sendall(data) else: print('no data from', client_address) break finally: # Clean up the connection connection.close()</pre><p>è°ƒç”¨listen()å°†å¥—æ¥å­—ç½®äºæœåŠ¡å™¨æ¨¡å¼ï¼Œå¹¶ç”¨ accept()ç­‰å¾…ä¼ å…¥è¿æ¥ã€‚æ•´æ•°å‚æ•°è¡¨ç¤ºåå°æ’é˜Ÿçš„è¿æ¥æ•°ï¼Œå½“è¿æ¥æ•°è¶…å‡ºæ—¶ï¼Œç³»ç»Ÿä¼šæ‹’ç»ã€‚æ­¤ç¤ºä¾‹ä»…æœŸæœ›ä¸€æ¬¡ä½¿ç”¨ä¸€ä¸ªè¿æ¥ã€‚</p><p>accept()è¿”å›æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„å¼€æ”¾è¿æ¥ä»¥åŠå®¢æˆ·ç«¯çš„åœ°å€ã€‚è¯¥è¿æ¥å®é™…ä¸Šæ˜¯å¦ä¸€ä¸ªç«¯å£ä¸Šçš„ä¸åŒå¥—æ¥å­—ï¼ˆç”±å†…æ ¸åˆ†é…ï¼‰ã€‚ä»è¿æ¥ä¸­ç”¨ recv() è¯»å–æ•°æ®å¹¶ç”¨ sendall() ä¼ è¾“æ•°æ®ã€‚</p><p>ä¸å®¢æˆ·ç«¯é€šä¿¡å®Œæˆåï¼Œéœ€è¦ä½¿ç”¨ close() æ¸…ç†è¿æ¥ã€‚æ­¤ç¤ºä¾‹ä½¿ç”¨ try:finallyå—æ¥ç¡®ä¿close()å§‹ç»ˆè°ƒç”¨ï¼Œå³ä½¿å‡ºç°é”™è¯¯ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>å®¢æˆ·ç«¯</p><p>å®¢æˆ·ç«¯ç¨‹åºçš„ socket è®¾ç½®ä¸æœåŠ¡ç«¯çš„ä¸åŒã€‚å®ƒä¸æ˜¯ç»‘å®šåˆ°ç«¯å£å¹¶ç›‘å¬ï¼Œè€Œæ˜¯ç”¨äºconnect()å°†å¥—æ¥å­—ç›´æ¥è¿æ¥åˆ°è¿œç¨‹åœ°å€ã€‚</p><pre># socket_echo_client.pyimport socketimport sys# Create a TCP/IP socketsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# Connect the socket to the port where the server is listeningserver_address = ('localhost', 10000)print('connecting to {} port {}'.format(*server_address))sock.connect(server_address)try: # Send data message = b'This is the message. It will be repeated.' print('sending {!r}'.format(message)) sock.sendall(message) # Look for the response amount_received = 0 amount_expected = len(message) while amount_received &lt; amount_expected: data = sock.recv(16) amount_received += len(data) print('received {!r}'.format(data))finally: print('closing socket') sock.close()</pre><p>å»ºç«‹è¿æ¥åï¼Œæ•°æ®å¯ä»¥é€šè¿‡ sendall() å‘é€ recv() æ¥æ”¶ã€‚å‘é€æ•´ä¸ªæ¶ˆæ¯å¹¶æ”¶åˆ°åŒæ ·çš„å›å¤åï¼Œå…³é—­å¥—æ¥å­—ä»¥é‡Šæ”¾ç«¯å£ã€‚</p><p>è¿è¡Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯</p><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åº”è¯¥åœ¨å•ç‹¬çš„ç»ˆç«¯çª—å£ä¸­è¿è¡Œï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ç›¸äº’é€šä¿¡ã€‚æœåŠ¡ç«¯è¾“å‡ºæ˜¾ç¤ºä¼ å…¥çš„è¿æ¥å’Œæ•°æ®ï¼Œä»¥åŠå‘é€å›å®¢æˆ·ç«¯çš„å“åº”ã€‚</p><pre>$ python3 socket_echo_server.pystarting up on localhost port 10000waiting for a connectionconnection from ('127.0.0.1', 65141)received b'This is the mess'sending data back to the clientreceived b'age. It will be'sending data back to the clientreceived b' repeated.'sending data back to the clientreceived b''no data from ('127.0.0.1', 65141)waiting for a connection</pre><p>å®¢æˆ·ç«¯è¾“å‡ºæ˜¾ç¤ºä¼ å‡ºæ¶ˆæ¯å’Œæ¥è‡ªæœåŠ¡ç«¯çš„å“åº”ã€‚</p><pre>$ python3 socket_echo_client.pyconnecting to localhost port 10000sending b'This is the message. It will be repeated.'received b'This is the mess'received b'age. It will be'received b' repeated.'closing socket</pre><p>ç®€æ˜“å®¢æˆ·ç«¯è¿æ¥</p><p>é€šè¿‡ä½¿ç”¨ä¾¿æ·åŠŸèƒ½create_connection()è¿æ¥åˆ°æœåŠ¡ç«¯ï¼ŒTCP/IP å®¢æˆ·ç«¯å¯ä»¥èŠ‚çœä¸€äº›æ­¥éª¤ ã€‚è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œä¸€ä¸ªåŒ…å«æœåŠ¡å™¨åœ°å€çš„åŒå€¼å…ƒç»„ï¼Œå¹¶æ´¾ç”Ÿå‡ºç”¨äºè¿æ¥çš„æœ€ä½³åœ°å€ã€‚</p><pre>import socketimport sysdef get_constants(prefix): """Create a dictionary mapping socket module constants to their names. """ return { getattr(socket, n): n for n in dir(socket) if n.startswith(prefix) }families = get_constants('AF_')types = get_constants('SOCK_')protocols = get_constants('IPPROTO_')# Create a TCP/IP socketsock = socket.create_connection(('localhost', 10000))print('Family :', families[sock.family])print('Type :', types[sock.type])print('Protocol:', protocols[sock.proto])print()try: # Send data message = b'This is the message. It will be repeated.' print('sending {!r}'.format(message)) sock.sendall(message) amount_received = 0 amount_expected = len(message) while amount_received &lt; amount_expected: data = sock.recv(16) amount_received += len(data) print('received {!r}'.format(data))finally: print('closing socket') sock.close() # output# Family : AF_INET# Type : SOCK_STREAM# Protocol: IPPROTO_TCP# # sending b'This is the message. It will be repeated.'# received b'This is the mess'# received b'age. It will be'# received b' repeated.'# closing socket</pre><p>create_connection()ç”¨getaddrinfo() æ–¹æ³•è·å¾—å¯é€‰å‚æ•°ï¼Œå¹¶socketä½¿ç”¨åˆ›å»ºæˆåŠŸè¿æ¥çš„ç¬¬ä¸€ä¸ªé…ç½®è¿”å›å·²æ‰“å¼€çš„è¿æ¥å‚æ•°ã€‚familyï¼Œtypeå’Œprotoå±æ€§å¯ä»¥ç”¨æ¥æ£€æŸ¥è¿”å›çš„ç±»å‹æ˜¯ socket ç±»å‹ã€‚</p><p>é€‰æ‹©ç›‘å¬åœ°å€</p><p>å°†æœåŠ¡ç«¯ç»‘å®šåˆ°æ­£ç¡®çš„åœ°å€éå¸¸é‡è¦ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯å¯ä»¥ä¸ä¹‹é€šä¿¡ã€‚å‰é¢çš„ç¤ºä¾‹éƒ½ç”¨ 'localhost' ä½œä¸º IP åœ°å€ï¼Œä½†è¿™æ ·æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œåªæœ‰åœ¨åŒä¸€æœåŠ¡å™¨ä¸Šè¿è¡Œçš„å®¢æˆ·ç«¯æ‰èƒ½è¿æ¥ã€‚ä½¿ç”¨æœåŠ¡å™¨çš„å…¬å…±åœ°å€ï¼ˆä¾‹å¦‚ gethostname() çš„è¿”å›å€¼ï¼‰æ¥å…è®¸å…¶ä»–ä¸»æœºè¿›è¡Œè¿æ¥ã€‚ä¿®æ”¹ä¸Šé¢çš„ä¾‹å­ï¼Œè®©æœåŠ¡ç«¯ç›‘å¬é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šçš„åœ°å€ã€‚</p><pre># socket_echo_server_explicit.pyimport socketimport sys# Create a TCP/IP socketsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# Bind the socket to the address given on the command lineserver_name = sys.argv[1]server_address = (server_name, 10000)print('starting up on {} port {}'.format(*server_address))sock.bind(server_address)sock.listen(1)while True: print('waiting for a connection') connection, client_address = sock.accept() try: print('client connected:', client_address) while True: data = connection.recv(16) print('received {!r}'.format(data)) if data: connection.sendall(data) else: break finally: connection.close()</pre><p>å¯¹å®¢æˆ·ç«¯ç¨‹åºè¿›è¡Œç±»ä¼¼çš„ä¿®æ”¹ã€‚</p><pre># socket_echo_client_explicit.pyimport socketimport sys# Create a TCP/IP socketsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# Connect the socket to the port on the server# given by the callerserver_address = (sys.argv[1], 10000)print('connecting to {} port {}'.format(*server_address))sock.connect(server_address)try: message = b'This is the message. It will be repeated.' print('sending {!r}'.format(message)) sock.sendall(message) amount_received = 0 amount_expected = len(message) while amount_received &lt; amount_expected: data = sock.recv(16) amount_received += len(data) print('received {!r}'.format(data))finally: sock.close()</pre><p>ä½¿ç”¨å‚æ•° hubert å¯åŠ¨æœåŠ¡ç«¯ï¼Œ netstatå‘½ä»¤æ˜¾ç¤ºå®ƒæ­£åœ¨ç›‘å¬æŒ‡å®šä¸»æœºçš„åœ°å€ã€‚</p><pre>$ host hubert.hellfly.nethubert.hellfly.net has address 10.9.0.6$ netstat -an | grep 10000Active Internet connections (including servers)Proto Recv-Q Send-Q Local Address Foreign Address (state)...tcp4 0 0 10.9.0.6.10000 *.* LISTEN...</pre><p>åœ¨å¦ä¸€å°ä¸»æœºä¸Šè¿è¡Œå®¢æˆ·ç«¯ï¼Œhubert.hellfly.net ä½œä¸ºå‚æ•°ï¼š</p><pre>$ hostnameapu$ python3 ./socket_echo_client_explicit.py hubert.hellfly.netconnecting to hubert.hellfly.net port 10000sending b'This is the message. It will be repeated.'received b'This is the mess'received b'age. It will be'received b' repeated.'</pre><p>æœåŠ¡ç«¯è¾“å‡ºæ˜¯ï¼š</p><pre>$ python3 socket_echo_server_explicit.py hubert.hellfly.netstarting up on hubert.hellfly.net port 10000waiting for a connectionclient connected: ('10.9.0.10', 33139)received b''waiting for a connectionclient connected: ('10.9.0.10', 33140)received b'This is the mess'received b'age. It will be'received b' repeated.'received b''waiting for a connection</pre><p>è®¸å¤šæœåŠ¡ç«¯å…·æœ‰å¤šä¸ªç½‘ç»œæ¥å£ï¼Œå› æ­¤ä¹Ÿä¼šæœ‰å¤šä¸ª IP åœ°å€è¿æ¥ã€‚ä¸ºæ¯ä¸ª IP åœ°å€è¿è¡ŒæœåŠ¡ç«¯è‚¯å®šæ˜¯ä¸æ˜æ™ºçš„ï¼Œå¯ä»¥ä½¿ç”¨ç‰¹æ®Šåœ°å€INADDR_ANY åŒæ—¶ç›‘å¬æ‰€æœ‰åœ°å€ã€‚å°½ç®¡ socket ä¸º INADDR_ANY å®šä¹‰äº†ä¸€ä¸ªå¸¸é‡ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå¿…é¡»å…ˆå°†å…¶è½¬æ¢ä¸ºç‚¹ç¬¦å·åˆ†éš”çš„å­—ç¬¦ä¸²åœ°å€æ‰èƒ½ä¼ é€’ç»™ bind()ã€‚ä½œä¸ºæ›´æ–¹ä¾¿çš„æ–¹å¼ï¼Œä½¿ç”¨â€œ 0.0.0.0â€æˆ–ç©ºå­—ç¬¦ä¸²ï¼ˆ''ï¼‰å°±å¯ä»¥äº†ï¼Œè€Œä¸æ˜¯è¿›è¡Œè½¬æ¢ã€‚</p><pre>import socketimport sys# Create a TCP/IP socketsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# Bind the socket to the address given on the command lineserver_address = ('', 10000)sock.bind(server_address)print('starting up on {} port {}'.format(*sock.getsockname()))sock.listen(1)while True: print('waiting for a connection') connection, client_address = sock.accept() try: print('client connected:', client_address) while True: data = connection.recv(16) print('received {!r}'.format(data)) if data: connection.sendall(data) else: break finally: connection.close()</pre><p>è¦æŸ¥çœ‹å¥—æ¥å­—ä½¿ç”¨çš„å®é™…åœ°å€ï¼Œå¯ä»¥ä½¿ç”¨ getsockname() æ–¹æ³•ã€‚å¯åŠ¨æœåŠ¡åï¼Œå†æ¬¡è¿è¡Œ netstat ä¼šæ˜¾ç¤ºå®ƒæ­£åœ¨ç›‘å¬ä»»ä½•åœ°å€ä¸Šçš„ä¼ å…¥è¿æ¥ã€‚</p><pre>$ netstat -anActive Internet connections (including servers)Proto Recv-Q Send-Q Local Address Foreign Address (state)...tcp4 0 0 *.10000 *.* LISTEN...</pre><p>ç”¨æˆ·æ•°æ®æŠ¥å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯</p><p>ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼ˆUDPï¼‰ä¸ TCP/IP çš„å·¥ä½œæ–¹å¼ä¸åŒã€‚TCP æ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Œæ‰€æœ‰æ•°æ®ä»¥æ­£ç¡®çš„é¡ºåºä¼ è¾“ï¼ŒUDP æ˜¯é¢å‘æ¶ˆæ¯çš„åè®®ã€‚UDP ä¸éœ€è¦é•¿è¿æ¥ï¼Œå› æ­¤è®¾ç½® UDP å¥—æ¥å­—æ›´ç®€å•ä¸€äº›ã€‚å¦ä¸€æ–¹é¢ï¼ŒUDP æ¶ˆæ¯å¿…é¡»é€‚åˆå•ä¸ªæ•°æ®æŠ¥ï¼ˆå¯¹äº IPv4ï¼Œè¿™æ„å‘³ç€å®ƒä»¬åªèƒ½å®¹çº³ 65,507 ä¸ªå­—èŠ‚ï¼Œå› ä¸º 65,535 å­—èŠ‚çš„æ•°æ®åŒ…ä¹ŸåŒ…å«å¤´ä¿¡æ¯ï¼‰å¹¶ä¸”ä¸èƒ½ä¿è¯ä¼ é€ä¸ TCP ä¸€æ ·å¯é ã€‚</p><p>æœåŠ¡ç«¯</p><p>ç”±äºæ²¡æœ‰è¿æ¥æœ¬èº«ï¼ŒæœåŠ¡å™¨ä¸éœ€è¦ç›‘å¬å’Œæ¥æ”¶è¿æ¥ã€‚å®ƒåªéœ€è¦ bind() åœ°å€å’Œç«¯å£ï¼Œç„¶åç­‰å¾…å•ä¸ªæ¶ˆæ¯ã€‚</p><pre># socket_echo_server_dgram.py import socketimport sys# Create a UDP socketsock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)# Bind the socket to the portserver_address = ('localhost', 10000)print('starting up on {} port {}'.format(*server_address))sock.bind(server_address)while True: print('\nwaiting to receive message') data, address = sock.recvfrom(4096) print('received {} bytes from {}'.format(len(data), address)) print(data) if data: sent = sock.sendto(data, address) print('sent {} bytes back to {}'.format(sent, address))</pre><p>ä½¿ç”¨ recvfrom() ä»å¥—æ¥å­—è¯»å–æ¶ˆæ¯ï¼Œç„¶åæŒ‰ç…§å®¢æˆ·ç«¯åœ°å€è¿”å›æ•°æ®ã€‚</p><p>å®¢æˆ·ç«¯</p><p>UDP å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ç±»ä¼¼ï¼Œä½†ä¸éœ€è¦ bind()ã€‚å®ƒç”¨ sendto()å°†æ¶ˆæ¯ç›´æ¥å‘é€åˆ°æœåŠ¡ç®—ï¼Œå¹¶ç”¨ recvfrom()æ¥æ”¶å“åº”ã€‚</p><pre># socket_echo_client_dgram.py import socketimport sys# Create a UDP socketsock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)server_address = ('localhost', 10000)message = b'This is the message. It will be repeated.'try: # Send data print('sending {!r}'.format(message)) sent = sock.sendto(message, server_address) # Receive response print('waiting to receive') data, server = sock.recvfrom(4096) print('received {!r}'.format(data))finally: print('closing socket') sock.close()</pre><p>è¿è¡Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯</p><p>è¿è¡ŒæœåŠ¡ç«¯ä¼šäº§ç”Ÿï¼š</p><pre>$ python3 socket_echo_server_dgram.pystarting up on localhost port 10000waiting to receive messagereceived 42 bytes from ('127.0.0.1', 57870)b'This is the message. It will be repeated.'sent 42 bytes back to ('127.0.0.1', 57870)waiting to receive message</pre><p>å®¢æˆ·ç«¯è¾“å‡ºæ˜¯ï¼š</p><pre>$ python3 socket_echo_client_dgram.pysending b'This is the message. It will be repeated.'waiting to receivereceived b'This is the message. It will be repeated.'closing socket</pre><p>Unix åŸŸå¥—æ¥å­—</p><p>ä»ç¨‹åºå‘˜çš„è§’åº¦æ¥çœ‹ï¼Œä½¿ç”¨ Unix åŸŸå¥—æ¥å­—å’Œ TCP/IP å¥—æ¥å­—æœ‰ä¸¤ä¸ªæœ¬è´¨åŒºåˆ«ã€‚é¦–å…ˆï¼Œå¥—æ¥å­—çš„åœ°å€æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸Šçš„è·¯å¾„ï¼Œè€Œä¸æ˜¯åŒ…å«æœåŠ¡å™¨åç§°å’Œç«¯å£çš„å…ƒç»„ã€‚å…¶æ¬¡ï¼Œåœ¨å¥—æ¥å­—å…³é—­åï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºçš„è¡¨ç¤ºå¥—æ¥å­—çš„èŠ‚ç‚¹ä»ç„¶å­˜åœ¨ï¼Œå¹¶ä¸”æ¯æ¬¡æœåŠ¡ç«¯å¯åŠ¨æ—¶éƒ½éœ€è¦åˆ é™¤ã€‚é€šè¿‡åœ¨è®¾ç½®éƒ¨åˆ†è¿›è¡Œä¸€äº›æ›´æ”¹ï¼Œä½¿ä¹‹å‰çš„æœåŠ¡ç«¯ç¨‹åºæ”¯æŒ UDSã€‚</p><p>åˆ›å»º socket æ—¶ä½¿ç”¨åœ°å€æ— AF_UNIXã€‚ç»‘å®šå¥—æ¥å­—å’Œç®¡ç†ä¼ å…¥è¿æ¥æ–¹å¼ä¸ TCP/IP å¥—æ¥å­—ç›¸åŒã€‚</p><pre># socket_echo_server_uds.py import socketimport sysimport osserver_address = './uds_socket'# Make sure the socket does not already existtry: os.unlink(server_address)except OSError: if os.path.exists(server_address): raise# Create a UDS socketsock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)# Bind the socket to the addressprint('starting up on {}'.format(server_address))sock.bind(server_address)# Listen for incoming connectionssock.listen(1)while True: # Wait for a connection print('waiting for a connection') connection, client_address = sock.accept() try: print('connection from', client_address) # Receive the data in small chunks and retransmit it while True: data = connection.recv(16) print('received {!r}'.format(data)) if data: print('sending data back to the client') connection.sendall(data) else: print('no data from', client_address) break finally: # Clean up the connection connection.close()</pre><p>è¿˜éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯è®¾ç½®ä»¥ä½¿ç”¨ UDSã€‚å®ƒåº”è¯¥å‡å®šå¥—æ¥å­—çš„æ–‡ä»¶ç³»ç»ŸèŠ‚ç‚¹å­˜åœ¨ï¼Œå› ä¸ºæœåŠ¡ç«¯é€šè¿‡ç»‘å®šåˆ°è¯¥åœ°å€æ¥åˆ›å»ºå®ƒã€‚å‘é€å’Œæ¥æ”¶æ•°æ®åœ¨ UDS å®¢æˆ·ç«¯ä¸­çš„å·¥ä½œæ–¹å¼ä¸ä¹‹å‰çš„ TCP/IP å®¢æˆ·ç«¯ç›¸åŒã€‚</p><pre># socket_echo_client_uds.py import socketimport sys# Create a UDS socketsock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)# Connect the socket to the port where the server is listeningserver_address = './uds_socket'print('connecting to {}'.format(server_address))try: sock.connect(server_address)except socket.error as msg: print(msg) sys.exit(1)try: # Send data message = b'This is the message. It will be repeated.' print('sending {!r}'.format(message)) sock.sendall(message) amount_received = 0 amount_expected = len(message) while amount_received &lt; amount_expected: data = sock.recv(16) amount_received += len(data) print('received {!r}'.format(data))finally: print('closing socket') sock.close()</pre><p>ç¨‹åºè¾“å‡ºå¤§è‡´ç›¸åŒï¼Œå¹¶å¯¹åœ°å€ä¿¡æ¯è¿›è¡Œé€‚å½“æ›´æ–°ã€‚æœåŠ¡ç«¯æ˜¾ç¤ºæ”¶åˆ°çš„æ¶ˆæ¯å¹¶å°†å…¶å‘é€å›å®¢æˆ·ç«¯ã€‚</p><pre>$ python3 socket_echo_server_uds.pystarting up on ./uds_socketwaiting for a connectionconnection fromreceived b'This is the mess'sending data back to the clientreceived b'age. It will be'sending data back to the clientreceived b' repeated.'sending data back to the clientreceived b''no data fromwaiting for a connection</pre><p>å®¢æˆ·ç«¯ä¸€æ¬¡æ€§å‘é€æ¶ˆæ¯ï¼Œå¹¶ä»¥é€’å¢æ–¹å¼æ¥æ”¶éƒ¨åˆ†æ¶ˆæ¯ã€‚</p><pre>$ python3 socket_echo_client_uds.pyconnecting to ./uds_socketsending b'This is the message. It will be repeated.'received b'This is the mess'received b'age. It will be'received b' repeated.'closing socket</pre><p>æƒé™</p><p>ç”±äº UDS å¥—æ¥å­—ç”±æ–‡ä»¶ç³»ç»Ÿä¸Šçš„èŠ‚ç‚¹è¡¨ç¤ºï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿæƒé™æ¥æ§åˆ¶æœåŠ¡ç«¯çš„è®¿é—®ã€‚</p><pre>$ ls -l ./uds_socketsrwxr-xr-x 1 dhellmann dhellmann 0 Aug 21 11:19 uds_socket$ sudo chown root ./uds_socket$ ls -l ./uds_socketsrwxr-xr-x 1 root dhellmann 0 Aug 21 11:19 uds_socket</pre><p>ä»¥érootç”¨æˆ·è¿è¡Œå®¢æˆ·ç«¯ä¼šå¯¼è‡´é”™è¯¯ï¼Œå› ä¸ºè¯¥è¿›ç¨‹æ— æƒæ‰“å¼€å¥—æ¥å­—ã€‚</p><pre>$ python3 socket_echo_client_uds.pyconnecting to ./uds_socket[Errno 13] Permission denied</pre><p>çˆ¶å­è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡</p><p>ä¸ºäº†åœ¨ Unix ä¸‹è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼Œé€šè¿‡ socketpair() å‡½æ•°æ¥è®¾ç½® UDS å¥—æ¥å­—å¾ˆæœ‰ç”¨ã€‚å®ƒåˆ›å»ºäº†ä¸€å¯¹è¿æ¥çš„å¥—æ¥å­—ï¼Œå½“å­è¿›ç¨‹è¢«åˆ›å»ºåï¼Œåœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚</p><pre>import socketimport osparent, child = socket.socketpair()pid = os.fork()if pid: print('in parent, sending message') child.close() parent.sendall(b'ping') response = parent.recv(1024) print('response from child:', response) parent.close()else: print('in child, waiting for message') parent.close() message = child.recv(1024) print('message from parent:', message) child.sendall(b'pong') child.close() # output# in parent, sending message# in child, waiting for message# message from parent: b'ping'# response from child: b'pong'</pre><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šåˆ›å»ºä¸€ä¸ª UDS å¥—æ¥å­—ï¼Œä½†ä¹Ÿå¯ä»¥ä¼ é€’åœ°å€æ—ï¼Œå¥—æ¥å­—ç±»å‹ç”šè‡³åè®®é€‰é¡¹æ¥æ§åˆ¶å¥—æ¥å­—çš„åˆ›å»ºæ–¹å¼ã€‚</p><p>ç»„æ’­</p><p>ç‚¹å¯¹ç‚¹è¿æ¥å¯ä»¥å¤„ç†å¤§é‡é€šä¿¡éœ€æ±‚ï¼Œä½†éšç€ç›´æ¥è¿æ¥æ•°é‡çš„å¢åŠ ï¼ŒåŒæ—¶ç»™å¤šä¸ªæ¥æ”¶è€…ä¼ é€’ç›¸åŒçš„ä¿¡æ¯å˜å¾—å…·æœ‰æŒ‘æˆ˜æ€§ã€‚åˆ†åˆ«å‘æ¯ä¸ªæ¥æ”¶è€…å‘é€æ¶ˆæ¯ä¼šæ¶ˆè€—é¢å¤–çš„å¤„ç†æ—¶é—´å’Œå¸¦å®½ï¼Œè¿™å¯¹äºè¯¸å¦‚æµå¼è§†é¢‘æˆ–éŸ³é¢‘ä¹‹ç±»çš„åº”ç”¨æ¥è¯´å¯èƒ½æ˜¯ä¸ªé—®é¢˜ã€‚ä½¿ç”¨ç»„æ’­ä¸€æ¬¡å‘å¤šä¸ªç«¯ç‚¹ä¼ é€’æ¶ˆæ¯å¯ä»¥ä½¿æ•ˆç‡æ›´é«˜ã€‚</p><p>ç»„æ’­æ¶ˆæ¯é€šè¿‡ UDP å‘é€ï¼Œå› ä¸º TCP æ˜¯ä¸€å¯¹ä¸€çš„é€šä¿¡ç³»ç»Ÿã€‚ç»„æ’­åœ°å€ï¼ˆç§°ä¸º ç»„æ’­ç»„ï¼‰æ˜¯ä¸ºç»„æ’­æµé‡ä¿ç•™çš„å¸¸è§„ IPv4 åœ°å€èŒƒå›´ï¼ˆ224.0.0.0åˆ°230.255.255.255ï¼‰çš„å­é›†ã€‚è¿™äº›åœ°å€ç”±ç½‘ç»œè·¯ç”±å™¨å’Œäº¤æ¢æœºä¸“é—¨å¤„ç†ï¼Œå› æ­¤å‘é€åˆ°è¯¥ç»„çš„é‚®ä»¶å¯ä»¥é€šè¿‡ Internet åˆ†å‘ç»™å·²åŠ å…¥è¯¥ç»„çš„æ‰€æœ‰æ”¶ä»¶äººã€‚</p><p>æ³¨æ„ï¼šæŸäº›æ‰˜ç®¡äº¤æ¢æœºå’Œè·¯ç”±å™¨é»˜è®¤ç¦ç”¨ç»„æ’­æµé‡ã€‚å¦‚æœåœ¨ä½¿ç”¨ç¤ºä¾‹ç¨‹åºæ—¶é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ç½‘ç»œç¡¬ä»¶è®¾ç½®ã€‚</p><p>å‘é€ç»„æ’­æ¶ˆæ¯</p><p>ä¿®æ”¹ä¸Šé¢çš„å®¢æˆ·ç«¯ç¨‹åºä½¿å…¶å‘ç»„æ’­ç»„å‘é€æ¶ˆæ¯ï¼Œç„¶åæŠ¥å‘Šå®ƒæ”¶åˆ°çš„æ‰€æœ‰å“åº”ã€‚ç”±äºæ— æ³•çŸ¥é“é¢„æœŸä¼šæœ‰å¤šå°‘å“åº”ï¼Œå› æ­¤å®ƒä¼šä½¿ç”¨å¥—æ¥å­—çš„è¶…æ—¶å€¼æ¥é¿å…åœ¨ç­‰å¾…ç­”æ¡ˆæ—¶æ— é™æœŸåœ°é˜»å¡ã€‚</p><p>å¥—æ¥å­—è¿˜éœ€è¦é…ç½®æ¶ˆæ¯çš„ç”Ÿå­˜æ—¶é—´å€¼ï¼ˆTTLï¼‰ã€‚TTL æ§åˆ¶æ¥æ”¶æ•°æ®åŒ…çš„ç½‘ç»œæ•°é‡ã€‚ä½¿ç”¨IP_MULTICAST_TTL å’Œ setsockopt() è®¾ç½® TTLã€‚é»˜è®¤å€¼1è¡¨ç¤ºè·¯ç”±å™¨ä¸ä¼šå°†æ•°æ®åŒ…è½¬å‘åˆ°å½“å‰ç½‘æ®µä¹‹å¤–ã€‚è¯¥å€¼æœ€å¤§å¯è¾¾ 255ï¼Œå¹¶ä¸”åº”æ‰“åŒ…ä¸ºå•ä¸ªå­—èŠ‚ã€‚</p><pre># socket_multicast_sender.py import socketimport structimport sysmessage = b'very important data'multicast_group = ('224.3.29.71', 10000)# Create the datagram socketsock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)# Set a timeout so the socket does not block# indefinitely when trying to receive data.sock.settimeout(0.2)# Set the time-to-live for messages to 1 so they do not# go past the local network segment.ttl = struct.pack('b', 1)sock.setsockopt(socket.IPPROTO_IP, socket.IP_MULTICAST_TTL, ttl)try: # Send data to the multicast group print('sending {!r}'.format(message)) sent = sock.sendto(message, multicast_group) # Look for responses from all recipients while True: print('waiting to receive') try: data, server = sock.recvfrom(16) except socket.timeout: print('timed out, no more responses') break else: print('received {!r} from {}'.format(data, server))finally: print('closing socket') sock.close()</pre><p>å‘ä»¶äººçš„å…¶ä½™éƒ¨åˆ†çœ‹èµ·æ¥åƒ UDP å®¢æˆ·ç«¯ï¼Œé™¤äº†å®ƒéœ€è¦å¤šä¸ªå“åº”ï¼Œå› æ­¤ä½¿ç”¨å¾ªç¯è°ƒç”¨ recvfrom() ç›´åˆ°è¶…æ—¶ã€‚</p><p>æ¥æ”¶ç»„æ’­æ¶ˆæ¯</p><p>å»ºç«‹ç»„æ’­æ¥æ”¶å™¨çš„ç¬¬ä¸€æ­¥æ˜¯åˆ›å»º UDP å¥—æ¥å­—ã€‚åˆ›å»ºå¸¸è§„å¥—æ¥å­—å¹¶ç»‘å®šåˆ°ç«¯å£åï¼Œå¯ä»¥ä½¿ç”¨setsockopt()æ›´æ”¹IP_ADD_MEMBERSHIPé€‰é¡¹å°†å…¶æ·»åŠ åˆ°ç»„æ’­ç»„ã€‚é€‰é¡¹å€¼æ˜¯ç»„æ’­ç»„åœ°å€çš„ 8 å­—èŠ‚æ‰“åŒ…è¡¨ç¤ºï¼Œåè·ŸæœåŠ¡ç«¯ç›‘å¬æµé‡çš„ç½‘ç»œæ¥å£ï¼Œç”±å…¶ IP åœ°å€æ ‡è¯†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¥æ”¶ç«¯ä½¿ç”¨ INADDR_ANY æ‰€æœ‰æ¥å£ã€‚</p><pre># socket_multicast_receiver.py import socketimport structimport sysmulticast_group = '224.3.29.71'server_address = ('', 10000)# Create the socketsock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)# Bind to the server addresssock.bind(server_address)# Tell the operating system to add the socket to# the multicast group on all interfaces.group = socket.inet_aton(multicast_group)mreq = struct.pack('4sL', group, socket.INADDR_ANY)sock.setsockopt(socket.IPPROTO_IP, socket.IP_ADD_MEMBERSHIP, mreq)# Receive/respond loopwhile True: print('\nwaiting to receive message') data, address = sock.recvfrom(1024) print('received {} bytes from {}'.format(len(data), address)) print(data) print('sending acknowledgement to', address) sock.sendto(b'ack', address)</pre><p>æ¥æ”¶å™¨çš„ä¸»å¾ªç¯å°±åƒå¸¸è§„çš„ UDP æœåŠ¡ç«¯ä¸€æ ·ã€‚</p><p>ç¤ºä¾‹è¾“å‡º</p><p>æ­¤ç¤ºä¾‹æ˜¾ç¤ºåœ¨ä¸¤ä¸ªä¸åŒä¸»æœºä¸Šè¿è¡Œçš„ç»„æ’­æ¥æ”¶å™¨ã€‚Aåœ°å€192.168.1.13å’ŒBåœ°å€ 192.168.1.14ã€‚</p><pre>[A]$ python3 socket_multicast_receiver.pywaiting to receive messagereceived 19 bytes from ('192.168.1.14', 62650)b'very important data'sending acknowledgement to ('192.168.1.14', 62650)waiting to receive message[B]$ python3 source/socket/socket_multicast_receiver.pywaiting to receive messagereceived 19 bytes from ('192.168.1.14', 64288)b'very important data'sending acknowledgement to ('192.168.1.14', 64288)waiting to receive message</pre><p>å‘ä»¶äººæ­£åœ¨ä¸»æœºä¸Šè¿è¡ŒBã€‚</p><pre>[B]$ python3 socket_multicast_sender.pysending b'very important data'waiting to receivereceived b'ack' from ('192.168.1.14', 10000)waiting to receivereceived b'ack' from ('192.168.1.13', 10000)waiting to receivetimed out, no more responsesclosing socket</pre><p>æ¶ˆæ¯è¢«å‘é€ä¸€æ¬¡ï¼Œå¹¶ä¸”æ¥æ”¶åˆ°ä¸¤ä¸ªä¼ å‡ºæ¶ˆæ¯çš„ç¡®è®¤ï¼Œåˆ†åˆ«æ¥è‡ªä¸»æœºAå’ŒBã€‚</p><p>å‘é€äºŒè¿›åˆ¶æ•°æ®</p><p>å¥—æ¥å­—ä¼ è¾“å­—èŠ‚æµã€‚è¿™äº›å­—èŠ‚å¯ä»¥åŒ…å«ç¼–ç ä¸ºå­—èŠ‚çš„æ–‡æœ¬æ¶ˆæ¯ï¼Œå¦‚å‰é¢ç¤ºä¾‹ä¸­æ‰€ç¤ºï¼Œæˆ–è€…å®ƒä»¬ä¹Ÿå¯ä»¥æ˜¯ç”± struct æ‰“åŒ…åˆ°ç¼“å†²åŒºä¸­çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</p><p>æ­¤å®¢æˆ·ç«¯ç¨‹åºå°†æ•´æ•°ï¼Œä¸¤ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²å’Œæµ®ç‚¹å€¼ï¼Œç¼–ç ä¸ºå¯ä¼ é€’åˆ°å¥—æ¥å­—ä»¥è¿›è¡Œä¼ è¾“çš„å­—èŠ‚åºåˆ—ã€‚</p><pre># socket_binary_client.py import binasciiimport socketimport structimport sys# Create a TCP/IP socketsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)server_address = ('localhost', 10000)sock.connect(server_address)values = (1, b'ab', 2.7)packer = struct.Struct('I 2s f')packed_data = packer.pack(*values)print('values =', values)try: # Send data print('sending {!r}'.format(binascii.hexlify(packed_data))) sock.sendall(packed_data)finally: print('closing socket') sock.close()</pre><p>åœ¨ä¸¤ä¸ªç³»ç»Ÿä¹‹é—´å‘é€å¤šå­—èŠ‚äºŒè¿›åˆ¶æ•°æ®æ—¶ï¼Œé‡è¦çš„æ˜¯è¦ç¡®ä¿è¿æ¥çš„ä¸¤ç«¯éƒ½çŸ¥é“å­—èŠ‚çš„é¡ºåºï¼Œä»¥åŠå¦‚ä½•å°†å®ƒä»¬è§£å‹å›åŸæ¥çš„ç»“æ„ã€‚æœåŠ¡ç«¯ç¨‹åºä½¿ç”¨ç›¸åŒçš„ Structè¯´æ˜ç¬¦æ¥è§£å‹ç¼©æ¥æ”¶çš„å­—èŠ‚ï¼Œä»¥ä¾¿æŒ‰æ­£ç¡®çš„é¡ºåºè¿˜åŸå®ƒä»¬ã€‚</p><pre># socket_binary_server.py import binasciiimport socketimport structimport sys# Create a TCP/IP socketsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)server_address = ('localhost', 10000)sock.bind(server_address)sock.listen(1)unpacker = struct.Struct('I 2s f')while True: print('\nwaiting for a connection') connection, client_address = sock.accept() try: data = connection.recv(unpacker.size) print('received {!r}'.format(binascii.hexlify(data))) unpacked_data = unpacker.unpack(data) print('unpacked:', unpacked_data) finally: connection.close()</pre><p>è¿è¡Œå®¢æˆ·ç«¯ä¼šäº§ç”Ÿï¼š</p><pre>$ python3 source/socket/socket_binary_client.pyvalues = (1, b'ab', 2.7)sending b'0100000061620000cdcc2c40'closing socket</pre><p>æœåŠ¡ç«¯æ˜¾ç¤ºå®ƒæ”¶åˆ°çš„å€¼ï¼š</p><pre>$ python3 socket_binary_server.pywaiting for a connectionreceived b'0100000061620000cdcc2c40'unpacked: (1, b'ab', 2.700000047683716)waiting for a connection</pre><p>æµ®ç‚¹å€¼åœ¨æ‰“åŒ…å’Œè§£åŒ…æ—¶ä¼šä¸¢å¤±ä¸€äº›ç²¾åº¦ï¼Œå¦åˆ™æ•°æ®ä¼šæŒ‰é¢„æœŸä¼ è¾“ã€‚è¦è®°ä½çš„ä¸€ä»¶äº‹æ˜¯ï¼Œå–å†³äºæ•´æ•°çš„å€¼ï¼Œå°†å…¶è½¬æ¢ä¸ºæ–‡æœ¬ç„¶åä¼ è¾“è€Œä¸ä½¿ç”¨ struct å¯èƒ½æ›´é«˜æ•ˆã€‚æ•´æ•°1åœ¨è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²æ—¶ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œä½†åœ¨æ‰“åŒ…åˆ°ç»“æ„ä¸­æ—¶ä½¿ç”¨å››ä¸ªå­—èŠ‚ã€‚</p><p>éé˜»å¡é€šä¿¡å’Œè¶…æ—¶</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½® socket æ¥å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œå½“å¥—æ¥å­—å‡†å¤‡å°±ç»ªæ—¶ä¼šé˜»å¡ç¨‹åºæ‰§è¡Œã€‚è°ƒç”¨send()ç­‰å¾…ç¼“å†²åŒºç©ºé—´å¯ç”¨äºä¼ å‡ºæ•°æ®ï¼Œè°ƒç”¨recv()ç­‰å¾…å…¶ä»–ç¨‹åºå‘é€å¯è¯»å–çš„æ•°æ®ã€‚è¿™ç§å½¢å¼çš„ I/O æ“ä½œå¾ˆå®¹æ˜“ç†è§£ï¼Œä½†å¦‚æœä¸¤ä¸ªç¨‹åºæœ€ç»ˆéƒ½åœ¨ç­‰å¾…å¦ä¸€ä¸ªå‘é€æˆ–æ¥æ”¶æ•°æ®ï¼Œåˆ™å¯èƒ½å¯¼è‡´ç¨‹åºä½æ•ˆï¼Œç”šè‡³æ­»é”ã€‚</p><p>æœ‰å‡ ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ç§æƒ…å†µã€‚ä¸€ç§æ˜¯ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹åˆ†åˆ«ä¸æ¯ä¸ªå¥—æ¥å­—è¿›è¡Œé€šä¿¡ã€‚ä½†æ˜¯ï¼Œè¿™å¯èƒ½ä¼šå¼•å…¥å…¶ä»–å¤æ‚çš„é—®é¢˜ï¼Œå³çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚å¦ä¸€ä¸ªé€‰æ‹©æ˜¯å°†å¥—æ¥å­—æ›´æ”¹ä¸ºä¸é˜»å¡çš„ï¼Œå¦‚æœå°šæœªå‡†å¤‡å¥½å¤„ç†æ“ä½œï¼Œåˆ™ç«‹å³è¿”å›ã€‚ä½¿ç”¨setblocking()æ–¹æ³•æ›´æ”¹å¥—æ¥å­—çš„é˜»æ­¢æ ‡å¿—ã€‚é»˜è®¤å€¼ä¸º1ï¼Œè¡¨ç¤ºé˜»æ­¢ã€‚0è¡¨ç¤ºä¸é˜»å¡ã€‚å¦‚æœå¥—æ¥å­—å·²å…³é—­é˜»å¡å¹¶ä¸”å°šæœªå‡†å¤‡å¥½ï¼Œåˆ™ä¼šå¼•å‘ socket.error é”™è¯¯ã€‚</p><p>å¦ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ä¸ºå¥—æ¥å­—æ“ä½œè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè°ƒç”¨ settimeout() å‡½æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªæµ®ç‚¹å€¼ï¼Œè¡¨ç¤ºåœ¨ç¡®å®šå¥—æ¥å­—æœªå‡†å¤‡å¥½ä¹‹å‰è¦é˜»å¡çš„ç§’æ•°ã€‚è¶…æ—¶åˆ°æœŸæ—¶ï¼Œå¼•å‘ timeout å¼‚å¸¸ã€‚</p><p>ç›¸å…³æ–‡æ¡£ï¼š</p><p>https://pymotw.com/3/socket/index.html</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'æ¯å‘¨','ä¸€ä¸ª','Python'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>