<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>「 java架构师之路必备 」 Java规则引擎 Easy Rules | 极客快訊</title><meta property="og:title" content="「 java架构师之路必备 」 Java规则引擎 Easy Rules - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/489b8a2776e84f01bcea4276f80bdaf1"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/42060af5.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/42060af5.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/42060af5.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/42060af5.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/42060af5.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/42060af5.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/42060af5.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/42060af5.html><meta property="article:published_time" content="2020-11-14T20:59:53+08:00"><meta property="article:modified_time" content="2020-11-14T20:59:53+08:00"><meta name=Keywords content><meta name=description content="「 java架构师之路必备 」 Java规则引擎 Easy Rules"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/42060af5.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>「 java架构师之路必备 」 Java规则引擎 Easy Rules</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><br></p><p>1. Easy Rules 概述</p><p>Easy Rules是一个Java规则引擎，灵感来自一篇名为《Should I use a Rules Engine?》的文章</p><blockquote><p>规则引擎就是提供一种可选的计算模型。与通常的命令式模型（由带有条件和循环的命令依次组成）不同，规则引擎基于生产规则系统。这是一组生产规则，每条规则都有一个条件（condition）和一个动作（action）———— 简单的说，可以将其看作是一组if-then语句。</p><p>精妙之处在于规则可以按任何顺序编写，引擎会决定何时使用对顺序有意义的任何方式来计算它们。考虑它的一个好方法是系统运行所有规则，选择条件成立的规则，然后执行相应的操作。这样做的好处是，很多问题都很自然地符合这个模型：</p><p>if car.owner.hasCellPhone then premium += 100; if car.model.theftRating > 4 then premium += 200; if car.owner.livesInDodgyArea && car.model.theftRating > 2 then premium += 300;</p><p>规则引擎是一种工具，它使得这种计算模型编程变得更容易。它可能是一个完整的开发环境，或者一个可以在传统平台上工作的框架。生产规则计算模型最适合仅解决一部分计算问题，因此规则引擎可以更好地嵌入到较大的系统中。</p><p>你可以自己构建一个简单的规则引擎。你所需要做的就是创建一组带有条件和动作的对象，将它们存储在一个集合中，然后遍历它们以评估条件并执行这些动作。</p></blockquote><p>Easy Rules它提供Rule抽象以创建具有条件和动作的规则，并提供RuleEngine API，该API通过一组规则运行以评估条件并执行动作。</p><p>Easy Rules简单易用，只需两步：</p><p>首先，定义规则，方式有很多种</p><p>方式一：注解</p><pre><code>@Rule(name = "weather rule", description = "if it rains then take an umbrella")public class WeatherRule {    @Condition    public boolean itRains(@Fact("rain") boolean rain) {        return rain;    }        @Action    public void takeAnUmbrella() {        System.out.println("It rains, take an umbrella!");    }}</code></pre><p>方式二：链式编程</p><pre><code>Rule weatherRule = new RuleBuilder()        .name("weather rule")        .description("if it rains then take an umbrella")        .when(facts -&gt; facts.get("rain").equals(true))        .then(facts -&gt; System.out.println("It rains, take an umbrella!"))        .build();</code></pre><p>方式三：表达式</p><pre><code>Rule weatherRule = new MVELRule()        .name("weather rule")        .description("if it rains then take an umbrella")        .when("rain == true")        .then("System.out.println(\"It rains, take an umbrella!\");");</code></pre><p>方式四：yml配置文件</p><p>例如：weather-rule.yml</p><pre><code>name: "weather rule"description: "if it rains then take an umbrella"condition: "rain == true"actions:  - "System.out.println(\"It rains, take an umbrella!\");"</code></pre><pre><code>MVELRuleFactory ruleFactory = new MVELRuleFactory(new YamlRuleDefinitionReader());Rule weatherRule = ruleFactory.createRule(new FileReader("weather-rule.yml"));</code></pre><p>接下来，应用规则</p><pre><code>public class Test {    public static void main(String[] args) {        // define facts        Facts facts = new Facts();        facts.put("rain", true);        // define rules        Rule weatherRule = ...        Rules rules = new Rules();        rules.register(weatherRule);        // fire rules on known facts        RulesEngine rulesEngine = new DefaultRulesEngine();        rulesEngine.fire(rules, facts);    }}</code></pre><p><strong>入门案例：Hello Easy Rules</strong></p><pre><code>&lt;dependency&gt;    &lt;groupId&gt;org.jeasy&lt;/groupId&gt;    &lt;artifactId&gt;easy-rules-core&lt;/artifactId&gt;    &lt;version&gt;4.0.0&lt;/version&gt;&lt;/dependency&gt;</code></pre><p>通过骨架创建maven项目：</p><pre><code>mvn archetype:generate \    -DarchetypeGroupId=org.jeasy \    -DarchetypeArtifactId=easy-rules-archetype \    -DarchetypeVersion=4.0.0</code></pre><p>默认给我们生成了一个HelloWorldRule规则，如下：</p><pre><code>package com.cjs.example.rules;import org.jeasy.rules.annotation.Action;import org.jeasy.rules.annotation.Condition;import org.jeasy.rules.annotation.Rule;@Rule(name = "Hello World rule", description = "Always say hello world")public class HelloWorldRule {    @Condition    public boolean when() {        return true;    }    @Action    public void then() throws Exception {        System.out.println("hello world");    }}</code></pre><div class=pgc-img><img alt="「 java架构师之路必备 」 Java规则引擎 Easy Rules" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/489b8a2776e84f01bcea4276f80bdaf1><p class=pgc-img-caption></p></div><p>2. 规则定义</p><p>2.1. 定义规则</p><p>大多数业务规则可以用以下定义表示：</p><ul><li>Name : 一个命名空间下的唯一的规则名称</li><li>Description : 规则的简要描述</li><li>Priority : 相对于其他规则的优先级</li><li>Facts : 事实，可立即为要处理的数据</li><li>Conditions : 为了应用规则而必须满足的一组条件</li><li>Actions : 当条件满足时执行的一组动作</li></ul><p>Easy Rules为每个关键点提供了一个抽象来定义业务规则。</p><p>在Easy Rules中，Rule接口代表规则</p><pre><code>public interface Rule {    /**    * This method encapsulates the rule's conditions.    * @return true if the rule should be applied given the provided facts, false otherwise    */    boolean evaluate(Facts facts);    /**    * This method encapsulates the rule's actions.    * @throws Exception if an error occurs during actions performing    */    void execute(Facts facts) throws Exception;    //Getters and setters for rule name, description and priority omitted.}</code></pre><p>evaluate方法封装了必须计算结果为TRUE才能触发规则的条件。execute方法封装了在满足规则条件时应该执行的动作。条件和操作由Condition和Action接口表示。</p><p>定义规则有两种方式：</p><ul><li>通过在POJO类上添加注解</li><li>通过RuleBuilder API编程</li></ul><p>可以在一个POJO类上添加@Rule注解，例如：</p><pre><code>@Rule(name = "my rule", description = "my rule description", priority = 1)public class MyRule {    @Condition    public boolean when(@Fact("fact") fact) {        //my rule conditions        return true;    }    @Action(order = 1)    public void then(Facts facts) throws Exception {        //my actions    }    @Action(order = 2)    public void finally() throws Exception {        //my final actions    }}</code></pre><p>@Condition注解指定规则条件@Fact注解指定参数@Action注解指定规则执行的动作</p><p>RuleBuilder支持链式风格定义规则，例如：</p><pre><code>Rule rule = new RuleBuilder()                .name("myRule")                .description("myRuleDescription")                .priority(3)                .when(condition)                .then(action1)                .then(action2)                .build();</code></pre><p>组合规则</p><p>CompositeRule由一组规则组成。这是一个典型地组合设计模式的实现。</p><p>组合规则是一个抽象概念，因为可以以不同方式触发组合规则。</p><p>Easy Rules自带三种CompositeRule实现：</p><ul><li>UnitRuleGroup : 要么应用所有规则，要么不应用任何规则（AND逻辑）</li><li>ActivationRuleGroup : 它触发第一个适用规则，并忽略组中的其他规则（XOR逻辑）</li><li>ConditionalRuleGroup : 如果具有最高优先级的规则计算结果为true，则触发其余规则</li></ul><p>复合规则可以从基本规则创建并注册为常规规则：</p><pre><code>//Create a composite rule from two primitive rulesUnitRuleGroup myUnitRuleGroup = new UnitRuleGroup("myUnitRuleGroup", "unit of myRule1 and myRule2");myUnitRuleGroup.addRule(myRule1);myUnitRuleGroup.addRule(myRule2);//Register the composite rule as a regular ruleRules rules = new Rules();rules.register(myUnitRuleGroup);RulesEngine rulesEngine = new DefaultRulesEngine();rulesEngine.fire(rules, someFacts);</code></pre><p>每个规则都有优先级。它代表触发注册规则的默认顺序。默认情况下，较低的值表示较高的优先级。可以重写compareTo方法以提供自定义优先级策略。</p><p>2.2. 定义事实</p><p>在Easy Rules中，Fact API代表事实</p><pre><code>public class Fact&lt;T&gt; {     private final String name;     private final T value;}</code></pre><div class=pgc-img><img alt="「 java架构师之路必备 」 Java规则引擎 Easy Rules" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bd381996b2b84fd5926d42f98eea093c><p class=pgc-img-caption></p></div><p>举个例子：</p><pre><code>Fact&lt;String&gt; fact = new Fact("foo", "bar");Facts facts = new Facts();facts.add(fact);</code></pre><p>或者，也可以用这样简写形式</p><pre><code>Facts facts = new Facts();facts.put("foo", "bar");</code></pre><p>用@Fact注解可以将Facts注入到condition和action方法中</p><pre><code>@Ruleclass WeatherRule {    @Condition    public boolean itRains(@Fact("rain") boolean rain) {        return rain;    }    @Action    public void takeAnUmbrella(Facts facts) {        System.out.println("It rains, take an umbrella!");        // can add/remove/modify facts    }}</code></pre><p>2.3. 定义规则引擎</p><p>Easy Rules提供两种RulesEngine接口实现：</p><ul><li>DefaultRulesEngine : 根据规则的自然顺序应用规则</li><li>InferenceRulesEngine : 持续对已知事实应用规则，直到不再适用任何规则为止</li></ul><p>创建规则引擎：</p><pre><code>RulesEngine rulesEngine = new DefaultRulesEngine();// orRulesEngine rulesEngine = new InferenceRulesEngine();</code></pre><p>然后，注册规则</p><pre><code>rulesEngine.fire(rules, facts);</code></pre><p>规则引擎有一些可配置的参数，如下图所示：</p><div class=pgc-img><img alt="「 java架构师之路必备 」 Java规则引擎 Easy Rules" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/816642eed04041e1b8e6e53db3e64c93><p class=pgc-img-caption></p></div><p>举个例子：</p><pre><code>RulesEngineParameters parameters = new RulesEngineParameters()    .rulePriorityThreshold(10)    .skipOnFirstAppliedRule(true)    .skipOnFirstFailedRule(true)    .skipOnFirstNonTriggeredRule(true);RulesEngine rulesEngine = new DefaultRulesEngine(parameters);</code></pre><div class=pgc-img><img alt="「 java架构师之路必备 」 Java规则引擎 Easy Rules" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8e0c6ef2ef5345c1857573c5fa605e6d><p class=pgc-img-caption></p></div><p>2.4. 定义规则监听器</p><p>通过实现RuleListener接口</p><pre><code>public interface RuleListener {    /**     * Triggered before the evaluation of a rule.     *     * @param rule being evaluated     * @param facts known before evaluating the rule     * @return true if the rule should be evaluated, false otherwise     */    default boolean beforeEvaluate(Rule rule, Facts facts) {        return true;    }    /**     * Triggered after the evaluation of a rule.     *     * @param rule that has been evaluated     * @param facts known after evaluating the rule     * @param evaluationResult true if the rule evaluated to true, false otherwise     */    default void afterEvaluate(Rule rule, Facts facts, boolean evaluationResult) { }    /**     * Triggered on condition evaluation error due to any runtime exception.     *     * @param rule that has been evaluated     * @param facts known while evaluating the rule     * @param exception that happened while attempting to evaluate the condition.     */    default void onEvaluationError(Rule rule, Facts facts, Exception exception) { }    /**     * Triggered before the execution of a rule.     *     * @param rule the current rule     * @param facts known facts before executing the rule     */    default void beforeExecute(Rule rule, Facts facts) { }    /**     * Triggered after a rule has been executed successfully.     *     * @param rule the current rule     * @param facts known facts after executing the rule     */    default void onSuccess(Rule rule, Facts facts) { }    /**     * Triggered after a rule has failed.     *     * @param rule the current rule     * @param facts known facts after executing the rule     * @param exception the exception thrown when attempting to execute the rule     */    default void onFailure(Rule rule, Facts facts, Exception exception) { }}</code></pre><p>3. 示例</p><pre><code>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;    &lt;groupId&gt;com.cjs.example&lt;/groupId&gt;    &lt;artifactId&gt;easy-rules-quickstart&lt;/artifactId&gt;    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;    &lt;packaging&gt;jar&lt;/packaging&gt;    &lt;dependencies&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.jeasy&lt;/groupId&gt;            &lt;artifactId&gt;easy-rules-core&lt;/artifactId&gt;            &lt;version&gt;4.0.0&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.jeasy&lt;/groupId&gt;            &lt;artifactId&gt;easy-rules-support&lt;/artifactId&gt;            &lt;version&gt;4.0.0&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.jeasy&lt;/groupId&gt;            &lt;artifactId&gt;easy-rules-mvel&lt;/artifactId&gt;            &lt;version&gt;4.0.0&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;            &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;            &lt;version&gt;1.7.30&lt;/version&gt;        &lt;/dependency&gt;    &lt;/dependencies&gt;&lt;/project&gt;</code></pre><div class=pgc-img><img alt="「 java架构师之路必备 」 Java规则引擎 Easy Rules" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/078d31def54640f39ea45002a3c16c31><p class=pgc-img-caption></p></div><p>4. 扩展</p><p>规则本质上是一个函数，如y=f(x1,x2,..,xn)</p><p>规则引擎就是为了解决业务代码和业务规则分离的引擎，是一种嵌入在应用程序中的组件，实现了将业务决策从应用程序代码中分离。</p><p>还有一种常见的方式是Java+Groovy来实现，Java内嵌Groovy脚本引擎进行业务规则剥离。</p><p><strong>编辑不易，希望看到的小伙伴多多转发，收藏，给小编一个 关注！感谢您的阅读，下面小编给大家准备了一份（淘宝1998买的马士兵大佬的视频，面试资料技术文档）免费分享：<br>https://docs.qq.com/doc/DR2J4V01FZERaam91（粘贴之后去浏览器打开）免费送给大家！也可以私信[ 高并发 ]免费获得！</strong></p><p><br></p><div class=pgc-img><img alt="「 java架构师之路必备 」 Java规则引擎 Easy Rules" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fcf16fbd247e4e63bc9988ed42c3c656><p class=pgc-img-caption></p></div><p>如果你想成为一名优秀的 Java 架构师，那么这份手册上的内容几乎是必须要掌握的。如果你想获取这份学习资料的小伙伴，关注小编，转发，收藏文章，私信[高并发]即可获得获取方式！</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'java','架构','师之路'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>