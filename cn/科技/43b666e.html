<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Mysql进阶-存储过程 | 极客快訊</title><meta property="og:title" content="Mysql进阶-存储过程 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/15379551361751db25328d2"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/43b666e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/43b666e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/43b666e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/43b666e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/43b666e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/43b666e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/43b666e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/43b666e.html><meta property="article:published_time" content="2020-10-29T20:51:12+08:00"><meta property="article:modified_time" content="2020-10-29T20:51:12+08:00"><meta name=Keywords content><meta name=description content="Mysql进阶-存储过程"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/43b666e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Mysql进阶-存储过程</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>测试环境</h1><p>mysql-5.7.20 -log , win10</p><h1>为什么需要存储过程</h1><p>一组可编程的函数，是为了完成特定功能的SQL语句集，经编译创建并保存在数据库中，用户可通过指定存储过程的名字并给定参数(需要时)来调用执行。</p><p>优势：</p><p>①将重复性很高的一些操作，封装到一个存储过程中，简化了对这些SQL的调用</p><p>②批量处理：SQL+循环，减少流量，也就是“跑批”</p><p>③统一接口，确保数据的安全</p><h1>创建存储过程</h1><pre>CREATE [DEFINER = { user | CURRENT_USER }]　PROCEDURE sp_name ([proc_parameter[,...]]) [characteristic ...] routine_bodyproc_parameter: [ IN | OUT | INOUT ] param_name typecharacteristic: COMMENT 'string' | LANGUAGE SQL | [NOT] DETERMINISTIC | { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA } | SQL SECURITY { DEFINER | INVOKER }routine_body:　　Valid SQL routine statement[begin_label:] BEGIN　　[statement_list]　　　　……END [end_label]</pre><div class=pgc-img><img alt=Mysql进阶-存储过程 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15379551361751db25328d2><p class=pgc-img-caption>测试表</p></div><div class=pgc-img><img alt=Mysql进阶-存储过程 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15379551748824803249250><p class=pgc-img-caption>创建存储过程并执行</p></div><pre>IN输入参数类型，OUT输出参数类型，而INOUT既是输入类型又是输出类型，所谓的IN输入参数类型就是把要传递的参数输入到存储过程的内部以便编写存储过程流程语句时可以使用。上述演示过的例子就是这种类型。关键字OUT则是指明相应参数用来从存储过程传出的一个值,也可以理解为存储过程的返回值，而对于INOUT则是两者结合体</pre><p>默认情况下，存储过程和默认数据库相关联，如果想指定存储过程创建在某个特定的数据库下，那么在过程名前面加数据库名做前缀；</p><p>在定义过程时，使用DELIMITER $$ 命令将语句的结束符号从分号 ; 临时改为两个$$，使得过程体中使用的分号被直接传递到服务器，而不会被客户端（如mysql）解释。</p><p><strong>下面演示OUT参数，创建一个存储过程，用来输出level的最大值，最小值和平均值</strong></p><div class=pgc-img><img alt=Mysql进阶-存储过程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1538013897735e05072dae9><p class=pgc-img-caption>OUT参数示例</p></div><h1>存储体过程</h1><p>存储过程体包含了在过程调用时必须执行的语句，例如：dml、ddl语句，if-then-else和while-do语句、声明变量的declare语句等</p><p>过程体格式：以begin开始，以end结束(可嵌套)</p><pre>BEGIN　　BEGIN　　　　BEGIN　　　　　　statements; 　　　　END　　ENDEND</pre><p>每个嵌套块及其中的每条语句，必须以分号结束，表示过程体结束的begin-end块(又叫做复合语句compound statement)，则不需要分号。</p><h1>为语句块贴标签</h1><pre>[begin_label:] BEGIN　　[statement_list]END [end_label]sh示例label1: BEGIN　　label2: BEGIN　　　　label3: BEGIN　　　　　　statements; 　　　　END label3 ;　　END label2;END label1标签的作用：①增强代码的可读性②在某些语句(例如:leave和iterate语句)，需要用到标签</pre><h1><strong>删除存储过程</strong></h1><p>DROP PROCEDURE [IF EXISTS] 存储过程名称;</p><h1><strong>查看存储过程的状态</strong></h1><p>SHOW PROCEDURE STATUS [LIKE 'pattern']</p><div class=pgc-img><img alt=Mysql进阶-存储过程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15380144021579bdad31993><p class=pgc-img-caption></p></div><h1><strong>查看存储过程的创建语句</strong></h1><p>SHOW CREATE PROCEDURE 存储过程名;</p><div class=pgc-img><img alt=Mysql进阶-存储过程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15380144939801a449e6b32><p class=pgc-img-caption></p></div><h1><strong>存储过程的流程控制语句</strong></h1><p>1.<strong>IF 条件语句</strong></p><pre>IF 条件表达式1 THEN 条件表达式1为true执行[ELSEIF 条件表达式2 THEN 条件表达式2为true执行 ] [ELSE 全部条件为false时执行] END IF；</pre><p>2.<strong>多分支条件语句</strong></p><pre>CASE 表达式1 WHEN 值1 THEN 表达式=值1时执行命令 [WHEN 值N THEN 表达式=值N时执行该语句] [ELSE 上述值以外执行该语句]END CASE </pre><p>3.<strong>repeat 循环控制语句</strong></p><pre>REPEAT  直至条件表达式为True时执行的语句UNTIL 条件表达式 END REPEAT;</pre><p>4.<strong>while循环控制语句</strong></p><pre>WHILE 条件表达式 DO  系列语句END WHILE</pre><h1><strong>使用DECLARE定义局部变量</strong></h1><pre>DECLARE 变量名[,变量名2...] 数据类型(type) [DEFAULT value];-- 定义变量num，数据类型为INT型，默认值为10DECLARE num INT DEFAULT 10 ; </pre><p>DECLARE关键字是用来声明变量的；变量名即变量的名称，这里可以同时定义多个变量；type参数用来指定变量的类型；DEFAULT value子句将变量默认值设置为value，没有使用DEFAULT子句时，默认值为NULL。声明后，我们就可以在存储过程使用该变量，设置变量值可以使用以下语法：</p><pre>SET 变量名1 = expr [, 变量名2 = expr] ... </pre><p>其中，SET关键字是用来为变量赋值的；expr参数是赋值表达式或某个值。一个SET语句可以同时为多个变量赋值，各个变量的赋值语句之间用逗号隔开。除了这种赋值方式，前面我们还提到过使用SELECT…INTO语句为变量赋值，那也是可行的。</p><h1>其他变量定义</h1><p>1.用户变量：以”@”开始，形式为”@变量名”，用户变量跟mysql客户端是绑定的，设置的变量，只对当前用户使用的客户端生效，声明或者定义用户变量使用set语句，如 set @var 若没有指定GLOBAL 或SESSION ，那么默认将会定义用户变量。</p><pre>mysql&gt; SET @@global.sort_buffer_size=value</pre><p>2.全局变量：定义时，以如下两种形式出现，set GLOBAL 变量名 或者 set @@global.name，对所有客户端生效。只有具有super权限才可以设置全局变量。</p><pre>mysql&gt; SET GLOBAL sort_buffer_size=value;</pre><p>3.会话变量：只对连接的客户端有效。</p><pre>mysql&gt; SET SESSION sort_buffer_size=value;</pre></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Mysql','进阶','存储'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>