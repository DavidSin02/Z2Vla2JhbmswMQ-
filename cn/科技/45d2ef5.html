<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ALIENTEK 阿波罗 STM32F767 开发板资料连载第九章 外部中断实验 | 极客快訊</title><meta property="og:title" content="ALIENTEK 阿波罗 STM32F767 开发板资料连载第九章 外部中断实验 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/9d1edd66723f4966b44d3cab502c055f"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/45d2ef5.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/45d2ef5.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/45d2ef5.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/45d2ef5.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/45d2ef5.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/45d2ef5.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/45d2ef5.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/45d2ef5.html><meta property="article:published_time" content="2020-10-29T20:50:02+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:02+08:00"><meta name=Keywords content><meta name=description content="ALIENTEK 阿波罗 STM32F767 开发板资料连载第九章 外部中断实验"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/45d2ef5.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ALIENTEK 阿波罗 STM32F767 开发板资料连载第九章 外部中断实验</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><strong>1）实验平台：</strong>alientek 阿波罗 STM32F767 开发板<br><strong>2）摘自《STM32F7 开发指南(HAL 库版)》关注官方微信号公众号，获取更多资料：正点原子</strong><br></p><div class=pgc-img><img alt="ALIENTEK 阿波罗 STM32F767 开发板资料连载第九章 外部中断实验" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9d1edd66723f4966b44d3cab502c055f><p class=pgc-img-caption></p></div><p><strong>第九章 外部中断实验</strong></p><p>这一章，我们将向大家介绍如何使用 STM32F7 的外部输入中断。在前面几章的学习中，</p><p>我们掌握了 STM32F7 的 IO 口最基本的操作。本章我们将介绍如何将 STM32F7 的 IO 口作为外</p><p>部中断输入，在本章中，我们将以中断的方式，实现我们在第七章所实现的功能。本章分为如</p><p>下几个部分：</p><p>9.1 STM32F7 外部中断简介</p><p>9.2 硬件设计</p><p>9.3 软件设计</p><p>9.4 下载验证</p><p>9.5 STM32CubeMX 配置外部中断</p><p><strong>9.1 STM32F7 外部中断简介</strong></p><p>STM32F7 的 IO 口在第六章有详细介绍，而中断优先级分组管理在前面也有详细的阐述。</p><p>这里我们将介绍 STM32F7 外部 IO 口的中断功能，通过中断的功能，达到第八章实验的效果，</p><p>即：通过板载的 4 个按键，控制板载的两个 LED 的亮灭。</p><p>这里我们首先讲解 STM32F7 IO 口中断的一些基础概念。STM32F7 的每个 IO 都可以作为</p><p>外部中断的中断输入口，这点也是 STM32F7 的强大之处。STM32F7 的中断控制器支持 22 个外</p><p>部中断/事件请求。每个中断设有状态位，每个中断/事件都有独立的触发和屏蔽设置。STM32F7</p><p>的 23 个外部中断为：</p><p>EXTI 线 0~15：对应外部 IO 口的输入中断。</p><p>EXTI 线 16：连接到 PVD 输出。</p><p>EXTI 线 17：连接到 RTC 闹钟事件。</p><p>EXTI 线 18：连接到 USB OTG FS 唤醒事件。</p><p>EXTI 线 19：连接到以太网唤醒事件。</p><p>EXTI 线 20：连接到 USB OTG HS(在 FS 中配置)唤醒事件。</p><p>EXTI 线 21：连接到 RTC 入侵和时间戳事件。</p><p>EXTI 线 22：连接到 RTC 唤醒事件。</p><p>EXTI 线 23：连接到 LPTIM1 异步事件。</p><p>从上面可以看出，中断线 0-15 对应外部 IO 口的输入中断，一共是 16 个外部中断线。</p><p>STM32F7 供 IO 口使用的中断线只有 16 个，但是 STM32F7 的 IO 口却远远不止 16 个，那么</p><p>STM32F7 是怎么把 16 个中断线和 IO 口一一对应起来的呢？于是 STM32 就这样设计，GPIO</p><p>的引脚 GPIOx.0~GPIOx.15(x=A,B,C,D,E，F,G,H,I)分别对应中断线 0~15。这样每个中断线对应</p><p>了最多 9 个 IO 口，以线 0 为例：它对应了 GPIOA.0、GPIOB.0、GPIOC.0、GPIOD.0、GPIOE.0、</p><p>GPIOF.0、GPIOG.0,GPIOH.0,GPIOI.0。而中断线每次只能连接到 1 个 IO 口上，这样就需要通</p><p>过配置来决定对应的中断线配置到哪个 GPIO 上了。下面我们看看 GPIO 跟中断线的映射关系</p><p>图：</p><div class=pgc-img><img alt="ALIENTEK 阿波罗 STM32F767 开发板资料连载第九章 外部中断实验" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/317c93308b3e4b06b2a3d8c68ea95b2a><p class=pgc-img-caption>图 9.1.1 GPIO 和中断线的映射关系图</p></div><p><br></p><p>GPIO 和中断线映射关系是在寄存器 SYSCFG_EXTICR1~ SYSCFG_EXTICR4 中配置的。</p><p>所以我们要配置外部中断，还需要打开 SYSCFG 时钟。</p><p>接下来我们来看看使用 HAL 库配置外部中断的一般步骤。HAL 中外部中断相关配置函数</p><p>和定义在文件 stm32f7xx_hal_exti.h 和 stm32f7xx_hal_exti.c 文件中。</p><p><strong>1) 使能 IO 口时钟。</strong></p><p>首先，我们要使用 IO 口作为中断输入，所以我们要使能相应的 IO 口时钟，具体的操作方</p><p>法跟我们按键实验是一致的，这里就不做过多讲解。</p><p><strong>2) 设置 IO 口模式，触发条件，开启 SYSCFG 时钟，设置 IO 口与中断线的映射关系。</strong></p><p>该步骤如果我们使用标准库那么需要多个函数分部实现。而当我们使用 HAL 库的时候，</p><p>则都是在函数 HAL_GPIO_Init 中一次性完成的。例如我们要设置 PA0 链接中断线 0，并且为上</p><p>升沿触发，代码为：GPIO_InitTypeDef GPIO_Initure;</p><p>GPIO_Initure.Pin=GPIO_PIN_0;</p><p>//PA0</p><p>GPIO_Initure.Mode=GPIO_MODE_IT_RISING; //外部中断，上升沿触发</p><p>GPIO_Initure.Pull=GPIO_PULLDOWN;</p><p>//默认下拉</p><p>HAL_GPIO_Init(GPIOA,&GPIO_Initure);</p><p>当我们调用 HAL_GPIO_Init 设置 IO 的 Mode 值为 GPIO_MODE_IT_RISING（外部中断上</p><p>升 沿 触 发 ）， GPIO_MODE_IT_FALLING （ 外 部 中 断 下 降 沿 触 发 ） 或 者</p><p>GPIO_MODE_IT_RISING_FALLING（外部中断双边沿触发）的时候，该函数内部会通过判断</p><p>Mode 的值来开启 SYSCFG 时钟，并且设置 IO 口和中断线的映射关系。</p><p>因为我们这里初始化的是 PA0，根据图 9.1.1 可知，调用该函数后中断线 0 会自动连接到</p><p>PA0。如果某个时间，我们又同样的方式初始化了 PB0，那么 PA0 与中断线的链接将被清除，</p><p>而直接链接 PB0 到中断线 0。</p><p><strong>3) 配置中断优先级（NVIC），并使能中断。</strong></p><p>我们设置好中断线和 GPIO 映射关系，然后又设置好了中断的触发模式等初始化参数。既</p><p>然是外部中断，涉及到中断我们当然还要设置 NVIC 中断优先级。这个在前面已经讲解过，这</p><p>里我们就接着上面的范例， 设置中断线 0 的中断优先级并使能外部中断 0 的方法为：</p><p>HAL_NVIC_SetPriority(EXTI0_IRQn,2,1); //抢占优先级为 2，子优先级为 1</p><p>HAL_NVIC_EnableIRQ(EXTI0_IRQn); //使能中断线 2</p><p>上面这段代码相信大家都不陌生，我们在前面的串口实验的时候讲解过，这里不再讲解。</p><p><strong>4) 编写中断服务函数。</strong></p><p>我们配置完中断优先级之后，接着要做的就是编写中断服务函数。中断服务函数的名字是</p><p>在 HAL 库中事先有定义的。这里需要说明一下，STM32F7 的 IO 口外部中断函数只有 7 个，分</p><p>别为：</p><p>void EXTI0_IRQHandler();</p><p>void EXTI1_IRQHandler();</p><p>void EXTI2_IRQHandler();</p><p>void EXTI3_IRQHandler();</p><p>void EXTI4_IRQHandler();</p><p>void EXTI9_5_IRQHandler();</p><p>void EXTI15_10_IRQHandler();</p><p>中断线 0-4 每个中断线对应一个中断函数，中断线 5-9 共用中断函数 EXTI9_5_IRQHandler，中</p><p>断线 10-15 共用中断函数 EXTI15_10_IRQHandler。一般情况下，我们可以把中断控制逻辑直接</p><p>编写在中断服务函数中，但是 HAL 库把中断处理过程进行了简单封装，请看下面步骤 5 讲解。</p><p><strong>5） 编写中断处理回调函数 HAL_GPIO_EXTI_Callback</strong></p><p>在使用 HAL 库的时候，我们也可以跟使用标准库一样，在中断服务函数中编写控制逻辑。</p><p>但 是 HAL 库 为 了 用 户 使 用 方 便 ， 它 提 供 了 一 个 中 断 通 用 入 口 函 数</p><p>HAL_GPIO_EXTI_IRQHandler，在该函数内部直接调用回调函数 HAL_GPIO_EXTI_Callback。</p><p>我们可以看看 HAL_GPIO_EXTI_IRQHandler 函数定义：</p><p>void HAL_GPIO_EXTI_IRQHandler(uint16_t GPIO_Pin)</p><p>{</p><p>if(__HAL_GPIO_EXTI_GET_IT(GPIO_Pin) != RESET)</p><p>{</p><p>__HAL_GPIO_EXTI_CLEAR_IT(GPIO_Pin);</p><p><strong>HAL_GPIO_EXTI_Callback(GPIO_Pin);</strong></p><p>}</p><p>}</p><p>该函数实现的作用非常简单，通过入口参数 GPIO_Pin 判断中断来自哪个 IO 口，然后清除</p><p>相应的中断标志位，最后调用回调函数 HAL_GPIO_EXTI_Callback()实现控制逻辑。所以我们</p><p>编写中断控制逻辑将跟串口实验类似，在所有的外部中断服务函数中直接调用外部中断共用处</p><p>理函数 HAL_GPIO_EXTI_IRQHandler，然后在回调函数 HAL_GPIO_EXTI_Callback 中通过判</p><p>断中断是来自哪个 IO 口编写相应的中断服务控制逻辑。</p><p>讲到这里，相信大家对 STM32 的 IO 口外部中断已经有了一定的了解。下面我们再总结一</p><p>下配置 IO 口外部中断的一般步骤：</p><p>1）使能 IO 口时钟。</p><p>2）调用函数 HAL_GPIO_Init 设置 IO 口模式，触发条件，使能 SYSCFG 时钟以及设置 IO</p><p>口与中断线的映射关系。</p><p>3）配置中断优先级（NVIC），并使能中断。</p><p>4）在中断服务函数中调用外部中断共用入口函数 HAL_GPIO_EXTI_IRQHandler。</p><p>5）编写外部中断回调函数 HAL_GPIO_EXTI_Callback 实现控制逻辑。</p><p>通过以上几个步骤的设置，我们就可以正常使用外部中断了。</p><p>本章，我们要实现同第七章差不多的功能，但是这里我们使用的是中断来检测按键，还是</p><p>KEY_UP 控制 DS0，DS1 互斥点亮；KEY2 控制 DS0，按一次亮，再按一次灭；KEY1 控制 DS1，</p><p>效果同 KEY2；KEY0 则同时控制 DS0 和 DS1，按一次，他们的状态就翻转一次。</p><p><strong>9.2 硬件设计</strong></p><p>本实验用到的硬件资源和第七章实验的一模一样，不再多做介绍了。</p><p><strong>9.3 软件设计</strong></p><p>我们直接打开我们的光盘的实验 3 外部中断实验工程，可以看到相比上一个工程，我们的</p><p>HARDWARE 目录下面增加了 exti.c 文件，并且包含了头文件 exti.h。extic.c 文件代码如下：</p><p>//外部中断初始化</p><p>void EXTI_Init(void)</p><p>{</p><p>GPIO_InitTypeDef GPIO_Initure;</p><p>__HAL_RCC_GPIOA_CLK_ENABLE();</p><p>//开启 GPIOA 时钟</p><p>__HAL_RCC_GPIOC_CLK_ENABLE(); //开启 GPIOC 时钟</p><p>__HAL_RCC_GPIOH_CLK_ENABLE();</p><p>//开启 GPIOH 时钟</p><p>GPIO_Initure.Pin=GPIO_PIN_0; //PA0</p><p>GPIO_Initure.Mode=GPIO_MODE_IT_RISING; //上升沿触发</p><p>GPIO_Initure.Pull=GPIO_PULLDOWN;</p><p>//下拉</p><p>HAL_GPIO_Init(GPIOA,&GPIO_Initure);</p><p>GPIO_Initure.Pin=GPIO_PIN_13; //PC13</p><p>GPIO_Initure.Mode=GPIO_MODE_IT_FALLING; //下降沿触发</p><p>GPIO_Initure.Pull=GPIO_PULLUP;</p><p>//上拉</p><p>HAL_GPIO_Init(GPIOC,&GPIO_Initure);</p><p>GPIO_Initure.Pin=GPIO_PIN_2|GPIO_PIN_3; //PH2,3 下降沿触发，上拉</p><p>HAL_GPIO_Init(GPIOH,&GPIO_Initure);</p><p>//中断线 0</p><p>HAL_NVIC_SetPriority(EXTI0_IRQn,2,0); //抢占优先级为 2，子优先级为 0</p><p>HAL_NVIC_EnableIRQ(EXTI0_IRQn);</p><p>//使能中断线 0</p><p>//中断线 2</p><p>HAL_NVIC_SetPriority(EXTI2_IRQn,2,1); //抢占优先级为 2，子优先级为 1</p><p>HAL_NVIC_EnableIRQ(EXTI2_IRQn);</p><p>//使能中断线 2</p><p>//中断线 3</p><p>HAL_NVIC_SetPriority(EXTI3_IRQn,2,2); //抢占优先级为 2，子优先级为 2</p><p>HAL_NVIC_EnableIRQ(EXTI3_IRQn);</p><p>//使能中断线 2</p><p>//中断线 13</p><p>HAL_NVIC_SetPriority(EXTI15_10_IRQn,2,3); //抢占优先级为 3，子优先级为 3</p><p>HAL_NVIC_EnableIRQ(EXTI15_10_IRQn); //使能中断线 13</p><p>}</p><p>//中断服务函数</p><p>void EXTI0_IRQHandler(void)</p><p>{</p><p>HAL_GPIO_EXTI_IRQHandler(GPIO_PIN_0); //调用中断处理公用函数</p><p>}</p><p>void EXTI2_IRQHandler(void)</p><p>{</p><p>HAL_GPIO_EXTI_IRQHandler(GPIO_PIN_2); //调用中断处理公用函数</p><p>}</p><p>void EXTI3_IRQHandler(void)</p><p>{</p><p>HAL_GPIO_EXTI_IRQHandler(GPIO_PIN_3); //调用中断处理公用函数</p><p>}</p><p>void EXTI15_10_IRQHandler(void)</p><p>{</p><p>HAL_GPIO_EXTI_IRQHandler(GPIO_PIN_13); //调用中断处理公用函数</p><p>}</p><p>//中断服务程序中需要做的事情</p><p>//在 HAL 库中所有的外部中断服务函数都会调用此函数</p><p>//GPIO_Pin:中断引脚号</p><p>void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin)</p><p>{</p><p>static u8 led0sta=1,led1sta=1;</p><p>delay_ms(50); //消抖</p><p>switch(GPIO_Pin)</p><p>{</p><p>case GPIO_PIN_0:</p><p>if(WK_UP==1)</p><p>//控制 LED0,LED1 互斥点亮</p><p>{</p><p>led1sta=!led1sta;</p><p>led0sta=!led1sta;</p><p>LED1(led1sta);</p><p>LED0(led0sta);</p><p>}</p><p>break;</p><p>case GPIO_PIN_2:</p><p>if(KEY1==0) //控制 LED1 翻转</p><p>{</p><p>led1sta=!led1sta;</p><p>LED1(led1sta);</p><p>};</p><p>break;</p><p>case GPIO_PIN_3:</p><p>if(KEY0==0)</p><p>//同时控制 LED0,LED1 翻转</p><p>{</p><p>led1sta=!led1sta;</p><p>led0sta=!led0sta;</p><p>LED1(led1sta);</p><p>LED0(led0sta);</p><p>}</p><p>break;</p><p>case GPIO_PIN_13:</p><p>if(KEY2==0)</p><p>//控制 LED0 翻转</p><p>{</p><p>led0sta=!led0sta;</p><p>LED0(led0sta);</p><p>}</p><p>break;</p><p>}</p><p>}</p><p>exti.c 文件总共包含 6 个函数。外部中断初始化函数 void EXTIX_Init 用来配置 IO 口外部中</p><p>断相关步骤并使能中断，另一个函数 HAL_GPIO_EXTI_Callback 是外部中断共用回调函数，用</p><p>来处理所有外部中断真正的控制逻辑。其他 4 个都是中断服务函数。</p><p>void EXTI0_IRQHandler(void)是外部中断 0 的服务函数，负责 KEY_UP 按键的中断检测；</p><p>void EXTI2_IRQHandler(void)是外部中断 2 的服务函数，负责 KEY2 按键的中断检测；</p><p>void EXTI3_IRQHandler(void)是外部中断 3 的服务函数，负责 KEY1 按键的中断检测；</p><p>void EXTI4_IRQHandler(void)是外部中断 4 的服务函数，负责 KEY0 按键的中断检测；</p><p>下面我们分别介绍这几个函数。</p><p>首先是外部中断初始化函数 void EXTIX_Init(void)，该函数内部主要做了两件事情。先是</p><p>调用 IO 口初始化函数 HAL_GPIO_Init 来初始化 IO 口，该函数的配置含义请看 9.1 小节中关于</p><p>HAL_GPIO_Init 函数讲解，然后设置中断优先级并使能中断线。</p><p>接下来我们看看外部中断服务函数，一共 4 个。所有的中断服务函数内部都只调用了同样</p><p>一个函数 HAL_GPIO_EXTI_IRQHandler，该函数是外部中断共用入口函数，函数内部会进行中</p><p>断标志位清零， 并且调用中断处理共用回调函数 HAL_GPIO_EXTI_Callback。这在 9.1 小节我</p><p>们也有详细的讲解。</p><p>最后是外部中断回调函数 HAL_GPIO_EXTI_Callback，该函数用来编写真正的外部中断控</p><p>制逻辑。该函数有一个入口参数就是 IO 口序号。所以我们在该函数内部，一般通过判断 IO 口</p><p>序号值来确定中断是来自哪个 IO 口，也就是哪个中断线，然后编写相应的控制逻辑。所以在</p><p>该函数内部，我们通过 switch 语句判断 IO 口来源，例如是来自 GPIO_PIN_0，那么一定是来自</p><p>PA0，因为中断线一次只能连接一个 IO 口，而四个 IO 口中序号为 0 的 IO 口只有 PA0，所以中</p><p>断线 0 一定是连接 PA0，也就是外部中断由 PA0 触发。在回调函数内部，我们仅仅只是编写了</p><p>简单的测试逻辑，通过不同的中断来源来控制 DS0 和 DS1 的状态。</p><p>接下来我们看看主函数，main 函数代码如下：</p><p>int main(void)</p><p>{</p><p>Cache_Enable(); //打开 L1-Cache</p><p>HAL_Init();</p><p>//初始化 HAL 库</p><p>Stm32_Clock_Init(432,25,2,9); //设置时钟,216Mhz</p><p>delay_init(216);</p><p>//延时初始化</p><p>uart_init(115200);</p><p>//串口初始化</p><p>LED_Init(); //初始化 LED</p><p>EXTI_Init();</p><p>//外部中断初始化</p><p>while(1)</p><p>{</p><p>printf("OK\r\n");</p><p>//打印 OK 提示程序运行</p><p>delay_ms(1000); //每隔 1s 打印一次</p><p>}</p><p>}</p><p>该部分代码很简单，先进行各项初始化之后，在 while 死循环中不停的打印字符串到串口。</p><p>当有某个外部按键按下之后，会触发中断服务函数做出相应的反应。</p><p><strong>9.4 下载验证</strong></p><p>在编译成功之后，我们就可以下载代码到阿波罗 STM32 开发板上，实际验证一下我们的</p><p>程序是否正确。下载代码后，在串口调试助手里面可以看到如图 9.4.1 所示信息：</p><div class=pgc-img><img alt="ALIENTEK 阿波罗 STM32F767 开发板资料连载第九章 外部中断实验" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7a3de7a56ac04a53a7818a3ff51a1656><p class=pgc-img-caption>图 9.4.1 串口收到的数据</p></div><p><br></p><p>从图 9.4.1 可以看出，程序已经在运行了，此时可以通过按下 KEY0、KEY1、KEY2 和</p><p>KEY_UP 来观察 DS0、DS1 是否跟着按键的变化而变化。</p><p><strong>9.5 STM32CubeMX 配置外部中断</strong></p><p>本小节我们将教会大家用 STM32CubeMX 配置外部中断相关的初始化代码。关于</p><p>STM32CubeMX 的配置，从本小节开始，我们对于每个实验只讲解实验相关关键配置部分，如</p><p>果大家不知道具体怎么进入相关界面，请仔细看看前面几个章节实验。</p><p>对于外部中断的配置，首先在 MCU 引脚配置图界面选择相应的 GPIO 设置其模式为外部</p><p>中断模式。这里以 PH3 为例，如下图 9.5.1:</p><div class=pgc-img><img alt="ALIENTEK 阿波罗 STM32F767 开发板资料连载第九章 外部中断实验" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/50242a0025a145a983fbb4ac8340e4a6><p class=pgc-img-caption>图 9.5.1 PH3 引脚配置</p></div><p><br></p><p>使用同样的方法依次配置 PC13 和 PH2/PH3，然后我们打开依次点击 Configuration->GPIO</p><p>进入 GPIO 详细配置界面 Pin Configuration，界面会列出 4 个 IO 口的配置信息。我们选中 PA0，</p><p>看看此时 IO 口配置信息详情如下图 9.5.2 所示：</p><div class=pgc-img><img alt="ALIENTEK 阿波罗 STM32F767 开发板资料连载第九章 外部中断实验" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/23aa7273072d42c98da691d38f1a32a0><p class=pgc-img-caption>图 9.5.2 GPIO 配置详情界面</p></div><p>从上图界面可以看出，当我们配置 IO 口作为外部中断触发引脚之后，其详细配置界面便</p><p>只有三个选项。第一个选项 GPIO mode 用来设置外部中断触发方法，上升沿触发还是下降沿触</p><p>发还是双边沿触发。第二个选项 GPIO Pull-up/Pull-down 用来设置是默认上拉还是下拉。这两个</p><p>参数根据我们前面讲解的外部中断知识就很好理解了。这里除了设置 PA0 为上升沿触发默认下</p><p>拉外，其他 IO 口都设置为下降沿触发默认上拉。</p><p>配置好 IO 口信息之后，接下来就需要配置 NVIC 中断优先级设置。依次点击</p><p>Configuration->NVIC，进入 NVIC 配置界面。在界面可以看到有四个外部中断线可配置，这是</p><p>因为我们前面开启了四个 IO 口的外部中断（对应 4 个外部中断线）。我们按照实验讲解，依次</p><p>配置四个中断线的 NVIC 即可，配置完成后如下图 9.5.3 所示：</p><div class=pgc-img><img alt="ALIENTEK 阿波罗 STM32F767 开发板资料连载第九章 外部中断实验" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6331a180eb9b4f3fb8459641064483e3><p class=pgc-img-caption>图 9.5.3 NVIC 配置界面</p></div><p><br></p><p>最后生成工程，为了篇幅考虑，这里我们就不再列出生成的关键代码。在 main.c 中生成的</p><p>函数 MX_GPIO_Init 和我们实验工程中 exti.c 文件中的函数 EXTI_Init 内容一致，在</p><p>stm32f7xx_it.c 中生成了 4 个中断服务函数，和 exti.c 文件中的中断服务函数内容一致。当然，</p><p>回调函数 HAL_GPIO_EXTI_Callback 的内容软件是无法自动生成的，需要我们自己编写。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'ALIENTEK','阿波罗','STM32F767'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../cn/%E7%A7%91%E6%8A%80/24fcab2.html alt="ALIENTEK 阿波罗 STM32F767 开发板资料连载第十二章 定时器中断" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/9d1edd66723f4966b44d3cab502c055f style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/24fcab2.html title="ALIENTEK 阿波罗 STM32F767 开发板资料连载第十二章 定时器中断">ALIENTEK 阿波罗 STM32F767 开发板资料连载第十二章 定时器中断</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>