<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>CPU体系结构以及指令流水原理 | 极客快訊</title><meta property="og:title" content="CPU体系结构以及指令流水原理 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/85b39cd5b52c4ffda882a5a4cf90fb86"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/46b2b20.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/46b2b20.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/46b2b20.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/46b2b20.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/46b2b20.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/46b2b20.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/46b2b20.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/46b2b20.html><meta property="article:published_time" content="2020-10-29T21:04:24+08:00"><meta property="article:modified_time" content="2020-10-29T21:04:24+08:00"><meta name=Keywords content><meta name=description content="CPU体系结构以及指令流水原理"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/46b2b20.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>CPU体系结构以及指令流水原理</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>计算机CPU的体系结构</h1><p><strong>什么是cpu指令流水</strong></p><p><strong>指令流水线</strong>（英语：Instruction pipeline）是为了让计算机和其它数字电子设备能够加速指令的通过速度（单位时间内被运行的指令数量）而设计的技术。</p><div class=pgc-img><img alt=CPU体系结构以及指令流水原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/85b39cd5b52c4ffda882a5a4cf90fb86><p class=pgc-img-caption></p></div><p>流水线在处理器的内部被组织成层级，各个层级的流水线能半独立地单独运作。每一个层级都被管理并且链接到一条“链”，因而每个层级的输出被送到其它层级直至任务完成。 处理器的这种组织方式能使总体的处理时间显著缩短。</p><p>未流水线的架构产生的效率低，因为有些CPU的模块在其他模块运行时是闲置的。流水线虽并不会完全消除CPU的闲置时间，但是能够让这些模块并发运作而大幅提升程序运行的效率。</p><p>但并不是所有的指令都是独立的。在一条简单的流水线中，完成一个指令可能需要5层。如右图所示，要在最佳性能下运算，当第一个指令被运行时，这个流水线需要运行随后4条独立的指令。如果随后4条指令依赖于第一条指令的输出，流水线控制逻辑必须插入延迟时脉周期到流水线内，直到依赖被解除。而转发技术能显著减少延时。凭借多个层，虽然流水线在理论上能提高性能，优胜于无流水线的内核（假设时脉也因应层的数量按比例增加），但事实上，许多脚本设计中并不会考虑到理想的运行。</p><div class=pgc-img><img alt=CPU体系结构以及指令流水原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/882442d34b9c46928e0b0ec26724097d><p class=pgc-img-caption></p></div><p><strong>指令流水的原理</strong></p><p>为简单起见，把指令的处理过程分为取指令和执行指令两个阶段，在不采用指令流水技术的计算机里，取指令和执行指令是周而复始地重复出现，各条指令按顺序串行执行着，如下如所示：</p><p>取指令1 -->> 执行指令1 -->> 取指令2 -->> 执行指令2 -->> 取指令3 -->> 执行指令3 -->> ......</p><p>上述流程中，取指令操作可由指令部件完成，执行指令的操作可由执行部件完成。进一步分析发现，这种顺序执行虽然控制简单，但执行中各部件的利用率不高，如指令部件在工作时，执行部件基本空闲，而执行部件工作时，指令部件基本空闲。</p><p>其实，当一条指令在执行阶段，我们完全可以利用这段时间取下一条指令，这样就使取下一条指令的操作和执行当前指令的操作同时进行，这样就达到两条不同的指令可以重叠的被CPU处理，这就是指令的二级流水。如下图所示：</p><p>为了进一步提高处理速度，可将指令的处理过程分解为更细的子阶段，如下：</p><blockquote><p>(1)取指FI</p><p>从存储器取出一条指令并暂时存入指令部件的缓存区</p><p>(2)指令译码DI</p><p>确定操作性质和操作数地址的形成方式</p><p>(3)计算操作数地址CO</p><p>计算操作数的有效地址，涉及寄存器间接寻址、间接寻址、变址、基址、相对寻址等各种地址计算方式</p><p>(4)取操作数FO</p><p>从存储器中取操作数</p><p>(5)执行指令EI</p><p>执行指令所需的操作，并将结果存于目的位置(寄存器中)</p><p>(6)写操作数WO</p></blockquote><p><strong>将结果存入寄存器</strong></p><p>为了方便起见，假设上述各段的时间都是相等的，于是采用指令流水技术后，可形成指令六级流水时序，如下图：</p><p><strong>指令流水的多种优化技术</strong></p><p>流水线技术是计算机系统结构产生了重大革新，为了进一步发展，处理采用好的指令调度算法、重新组织指令执行顺序、减低相关带来的干扰以及优化编译外，还可开发流水线中的多发技术，设法在一个时钟周期(机器CPU主频的倒数)内，产生更多条指令的结果。常见的多发技术有超标量（Super Scalar）技术、超流水线技术和超长指令字技术。假设处理一条指令分4个阶段，分别为取指FI、译码ID、执行EX和回写WR。下图是三种多发技术与普通的四级流水线的比较：</p><p>流水线是将组合逻辑分割成多个小块，因为每段的关键路径变短了，所以能提高系统主频。同时能让任务以类似并行方式处理，提高硬件模块的利用率，<strong>提高系统频率，提高吞吐量(throughput)</strong>。</p><blockquote><p>为什么CPU流水线设计的级越长，完成一条指令的速度就越快？</p></blockquote><p>答：流水线级越长，一条指令执行速度反而更慢了，因为要插入寄存器分割组合逻辑，而寄存器读写也需要时间。流水线提高的是系统吞吐量，也就是<strong>单位时间内处理的指令条数</strong>。</p><p>那为什么一条指令执行速度更慢，而单位时间内处理的指令条数增多呢？ 因为 <strong>流水线能同时处理多条指令，类似并行形式。</strong>如下图，五条指令在同时处理。</p><div class=pgc-img><img alt=CPU体系结构以及指令流水原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/16b83f7c23ae49259d84066b6ecd432f><p class=pgc-img-caption></p></div><h1>cpu流水的本质</h1><p><strong>以空间换取时间(吞吐量)</strong>。</p><h1>优缺点</h1><p><strong>优点</strong></p><ol><li>减少了处理器执行指令所需要的时脉周期，在通常情况下增加了指令的输入频率（issue-rate）。</li><li>一些集成电路（combinational circuits），例如加法器（adders）或者乘法器（multipliers），通过添加更多的环路（circuitry）使其工作得更快。如果以流水线替代，能相对地减少环路。</li></ol><p><strong>缺点</strong></p><ol><li>非流水线的处理器每次（at a time）只运行一个指令。防止分支延时（事实上，每个分支都会产生延时）和串行指令被并行运行产生的问题。设计比较简单和较低生产成本。</li><li>在运行相同的指令时，非流水线处理器的指令传输延迟时间（The instruction latency）比流水线处理器明显较短。这是因为流水线的处理器必须在数据路径（data path）中添加额外触发器（flip-flops）。</li><li>非流水线处理器有固定指令位宽（a stable instruction bandwidth）。流水线处理器的性能更难以预测，并且不同的程序之间的变化（vary）可能更大。</li></ol></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'CPU','体系','结构'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>