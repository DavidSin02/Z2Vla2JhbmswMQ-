<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>å¦‚ä½•å……åˆ†åˆ©ç”¨å¤šæ ¸CPUï¼Œè®¡ç®—å¾ˆå¤§çš„Listä¸­æ‰€æœ‰æ•´æ•°çš„å’Œ | æå®¢å¿«è¨Š</title><meta property="og:title" content="å¦‚ä½•å……åˆ†åˆ©ç”¨å¤šæ ¸CPUï¼Œè®¡ç®—å¾ˆå¤§çš„Listä¸­æ‰€æœ‰æ•´æ•°çš„å’Œ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/5f031909ec724f89918149df43f7977c"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/470d0ef7.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/470d0ef7.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/470d0ef7.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/470d0ef7.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/470d0ef7.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/470d0ef7.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/470d0ef7.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/470d0ef7.html><meta property="article:published_time" content="2020-11-14T21:06:27+08:00"><meta property="article:modified_time" content="2020-11-14T21:06:27+08:00"><meta name=Keywords content><meta name=description content="å¦‚ä½•å……åˆ†åˆ©ç”¨å¤šæ ¸CPUï¼Œè®¡ç®—å¾ˆå¤§çš„Listä¸­æ‰€æœ‰æ•´æ•°çš„å’Œ"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/470d0ef7.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>å¦‚ä½•å……åˆ†åˆ©ç”¨å¤šæ ¸CPUï¼Œè®¡ç®—å¾ˆå¤§çš„Listä¸­æ‰€æœ‰æ•´æ•°çš„å’Œ</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>æœ‰ä¸ªé˜¿é‡Œé¢è¯•é¢˜ï¼Œæ˜¯è¿™æ ·æè¿°çš„ï¼šæœ‰ä¸€ä¸ªå¾ˆå¤§çš„æ•´æ•°listï¼Œéœ€è¦æ±‚è¿™ä¸ªlistä¸­æ‰€æœ‰æ•´æ•°çš„å’Œï¼Œå†™ä¸€ä¸ªå¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸CPUçš„ä»£ç ï¼Œæ¥è®¡ç®—ç»“æœã€‚</p><hr><h1 class=pgc-h-arrow-right>ä¸€ï¼šåˆ†æé¢˜ç›®</h1><p>ä»é¢˜ä¸­å¯ä»¥çœ‹åˆ°â€œå¾ˆå¤§çš„Listâ€ä»¥åŠâ€œå……åˆ†åˆ©ç”¨å¤šæ ¸CPUâ€ï¼Œè¿™å°±å·²ç»å……åˆ†å‘Šè¯‰æˆ‘ä»¬è¦é‡‡ç”¨å¤šçº¿ç¨‹(ä»»åŠ¡)è¿›è¡Œç¼–å†™ã€‚å…·ä½“æ€ä¹ˆåšå‘¢ï¼Ÿå¤§æ¦‚çš„æ€è·¯å°±æ˜¯åˆ†å‰²Listï¼Œæ¯ä¸€å°å—çš„Listé‡‡ç”¨ä¸€ä¸ªçº¿ç¨‹(ä»»åŠ¡)è¿›è¡Œè®¡ç®—å…¶å’Œï¼Œæœ€åç­‰å¾…æ‰€æœ‰çš„çº¿ç¨‹(ä»»åŠ¡)éƒ½æ‰§è¡Œå®Œåå°±å¯å¾—åˆ°è¿™ä¸ªâ€œå¾ˆå¤§çš„Listâ€ä¸­æ‰€æœ‰æ•´æ•°çš„å’Œã€‚</p><h1 class=pgc-h-arrow-right>äºŒï¼šå…·ä½“åˆ†æå’ŒæŠ€æœ¯æ–¹æ¡ˆ</h1><p>æ—¢ç„¶æˆ‘ä»¬å·²ç»å†³å®šé‡‡ç”¨å¤šçº¿ç¨‹(ä»»åŠ¡)ï¼Œå¹¶ä¸”è¿˜è¦åˆ†å‰²Listï¼Œæ¯ä¸€å°å—çš„Listé‡‡ç”¨ä¸€ä¸ªçº¿ç¨‹(ä»»åŠ¡)è¿›è¡Œè®¡ç®—å…¶å’Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…é¡»è¦ç­‰å¾…æ‰€æœ‰çš„çº¿ç¨‹(ä»»åŠ¡)å®Œæˆä¹‹åæ‰èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œé‚£ä¹ˆ<strong>æ€ä¹ˆæ‰èƒ½ä¿è¯â€œç­‰å¾…æ‰€æœ‰çš„çº¿ç¨‹(ä»»åŠ¡)å®Œæˆä¹‹åè¾“å‡ºç»“æœå‘¢â€ï¼Ÿè¿™å°±è¦é java.util.concurrentåŒ…ä¸­çš„CyclicBarrierç±»äº†ã€‚å®ƒæ˜¯ä¸€ä¸ªåŒæ­¥è¾…åŠ©ç±»ï¼Œå®ƒå…è®¸ä¸€ç»„çº¿ç¨‹(ä»»åŠ¡)äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°åˆ°è¾¾æŸä¸ªå…¬å…±å±éšœç‚¹ (common barrier point)ã€‚</strong></p><p>åœ¨æ¶‰åŠä¸€ç»„å›ºå®šå¤§å°çš„çº¿ç¨‹(ä»»åŠ¡)çš„ç¨‹åºä¸­ï¼Œè¿™äº›çº¿ç¨‹(ä»»åŠ¡)å¿…é¡»ä¸æ—¶åœ°äº’ç›¸ç­‰å¾…ï¼Œæ­¤æ—¶ CyclicBarrier å¾ˆæœ‰ç”¨ã€‚ç®€å•çš„æ¦‚æ‹¬å…¶é€‚åº”åœºæ™¯å°±æ˜¯ï¼šå½“ä¸€ç»„çº¿ç¨‹(ä»»åŠ¡)å¹¶å‘çš„æ‰§è¡Œä¸€ä»¶å·¥ä½œçš„æ—¶å€™ï¼Œå¿…é¡»ç­‰å¾…æ‰€æœ‰çš„çº¿ç¨‹(ä»»åŠ¡)éƒ½å®Œæˆæ—¶æ‰èƒ½è¿›è¡Œä¸‹ä¸€ä¸ªæ­¥éª¤ã€‚</p><p>å…·ä½“æŠ€æœ¯æ–¹æ¡ˆæ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>åˆ†å‰²Listï¼Œæ ¹æ®é‡‡ç”¨çš„çº¿ç¨‹(ä»»åŠ¡)æ•°å¹³å‡åˆ†é…ï¼Œå³list.size()/threadCountsã€‚</li><li>å®šä¹‰ä¸€ä¸ªè®°å½•â€œå¾ˆå¤§Listâ€ä¸­æ‰€æœ‰æ•´æ•°å’Œçš„å˜é‡sumï¼Œé‡‡ç”¨ä¸€ä¸ªçº¿ç¨‹(ä»»åŠ¡)å¤„ç†ä¸€ä¸ªåˆ†å‰²åçš„å­Listï¼Œè®¡ç®—å­Listä¸­æ‰€æœ‰æ•´æ•°å’Œ(subSum)ï¼Œç„¶åæŠŠå’Œ(subSum)ç´¯åŠ åˆ°sumä¸Šã€‚</li><li>ç­‰å¾…æ‰€æœ‰çº¿ç¨‹(ä»»åŠ¡)å®Œæˆåè¾“å‡ºæ€»å’Œ(sum)çš„å€¼ã€‚</li></ul><p><br></p><div class=pgc-img><img alt=å¦‚ä½•å……åˆ†åˆ©ç”¨å¤šæ ¸CPUï¼Œè®¡ç®—å¾ˆå¤§çš„Listä¸­æ‰€æœ‰æ•´æ•°çš„å’Œ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5f031909ec724f89918149df43f7977c><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>ä¸‰ï¼šè¯¦ç»†ç¼–ç å®ç°</h1><pre><code>/**  * è®¡ç®—Listä¸­æ‰€æœ‰æ•´æ•°çš„å’Œ&lt;br&gt;  * é‡‡ç”¨å¤šçº¿ç¨‹ï¼Œåˆ†å‰²Listè®¡ç®—  */  public class CountListIntegerSum {      private long sum;//å­˜æ”¾æ•´æ•°çš„å’Œ      private CyclicBarrier barrier;//éšœæ …é›†åˆç‚¹(åŒæ­¥å™¨)      private List&lt;Integer&gt; list;//æ•´æ•°é›†åˆList      private int threadCounts;//ä½¿ç”¨çš„çº¿ç¨‹æ•°      public CountListIntegerSum(List&lt;Integer&gt; list,int threadCounts) {          this.list=list;          this.threadCounts=threadCounts;      }      /**      * è·å–Listä¸­æ‰€æœ‰æ•´æ•°çš„å’Œ      * @return      */      public long getIntegerSum(){          ExecutorService exec=Executors.newFixedThreadPool(threadCounts);          int len=list.size()/threadCounts;//å¹³å‡åˆ†å‰²List          //Listä¸­çš„æ•°é‡æ²¡æœ‰çº¿ç¨‹æ•°å¤šï¼ˆå¾ˆå°‘å­˜åœ¨ï¼‰          if(len==0){              threadCounts=list.size();//é‡‡ç”¨ä¸€ä¸ªçº¿ç¨‹å¤„ç†Listä¸­çš„ä¸€ä¸ªå…ƒç´               len=list.size()/threadCounts;//é‡æ–°å¹³å‡åˆ†å‰²List          }          barrier=new CyclicBarrier(threadCounts+1);          for(int i=0;i&lt;threadCounts;i++){              //åˆ›å»ºçº¿ç¨‹ä»»åŠ¡              if(i==threadCounts-1){//æœ€åä¸€ä¸ªçº¿ç¨‹æ‰¿æ‹…å‰©ä¸‹çš„æ‰€æœ‰å…ƒç´ çš„è®¡ç®—                  exec.execute(new SubIntegerSumTask(list.subList(i*len,list.size())));              }else{                  exec.execute(new SubIntegerSumTask(list.subList(i*len, len*(i+1)&gt;list.size()?list.size():len*(i+1))));              }          }          try {              barrier.await();//å…³é”®ï¼Œä½¿è¯¥çº¿ç¨‹åœ¨éšœæ …å¤„ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çš„çº¿ç¨‹éƒ½åˆ°è¾¾éšœæ …å¤„          } catch (InterruptedException e) {              System.out.println(Thread.currentThread().getName()+":Interrupted");          } catch (BrokenBarrierException e) {              System.out.println(Thread.currentThread().getName()+":BrokenBarrier");          }          exec.shutdown();          return sum;      }      /**      * åˆ†å‰²è®¡ç®—Listæ•´æ•°å’Œçš„çº¿ç¨‹ä»»åŠ¡      */      public class SubIntegerSumTask implements Runnable{          private List&lt;Integer&gt; subList;          public SubIntegerSumTask(List&lt;Integer&gt; subList) {              this.subList=subList;          }          public void run() {              long subSum=0L;              for (Integer i : subList) {                  subSum += i;              }                synchronized(CountListIntegerSum.this){//åœ¨CountListIntegerSumå¯¹è±¡ä¸ŠåŒæ­¥                  sum+=subSum;              }              try {                  barrier.await();//å…³é”®ï¼Œä½¿è¯¥çº¿ç¨‹åœ¨éšœæ …å¤„ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çš„çº¿ç¨‹éƒ½åˆ°è¾¾éšœæ …å¤„              } catch (InterruptedException e) {                  System.out.println(Thread.currentThread().getName()+":Interrupted");              } catch (BrokenBarrierException e) {                  System.out.println(Thread.currentThread().getName()+":BrokenBarrier");              }              System.out.println("åˆ†é…ç»™çº¿ç¨‹ï¼š"+Thread.currentThread().getName()+"é‚£ä¸€éƒ¨åˆ†Listçš„æ•´æ•°å’Œä¸ºï¼š\tSubSum:"+subSum);          }                }        }  </code></pre><p>æœ‰äººå¯èƒ½å¯¹barrier=new CyclicBarrier(threadCounts+1); //åˆ›å»ºçš„çº¿ç¨‹æ•°å’Œä¸»çº¿ç¨‹mainæœ‰ç‚¹ä¸è§£ï¼Œä¸æ˜¯é‡‡ç”¨çš„çº¿ç¨‹(ä»»åŠ¡)æ•°æ˜¯threadCountsä¸ªå—ï¼Ÿæ€ä¹ˆä¸ºCyclicBarrierè®¾ç½®çš„ç»™å®šæ•°é‡çš„çº¿ç¨‹å‚ä¸è€…æ¯”æˆ‘ä»¬è¦é‡‡ç”¨çš„çº¿ç¨‹æ•°å¤šä¸€ä¸ªå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯è¿™ä¸ªå¤šå‡ºæ¥çš„ä¸€ä¸ªç”¨äºæ§åˆ¶mainä¸»çº¿ç¨‹çš„ï¼Œä¸»çº¿ç¨‹ä¹Ÿè¦ç­‰å¾…ï¼Œå®ƒè¦ç­‰å¾…å…¶ä»–æ‰€æœ‰çš„çº¿ç¨‹å®Œæˆæ‰èƒ½è¾“å‡ºsumå€¼ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯sumå€¼çš„æ­£ç¡®æ€§ï¼Œå¦‚æœmainä¸ç­‰å¾…çš„è¯ï¼Œé‚£ä¹ˆç»“æœå°†æ˜¯ä¸å¯é¢„æ–™çš„ã€‚</p><pre><code>/**  * è®¡ç®—Listä¸­æ‰€æœ‰æ•´æ•°çš„å’Œæµ‹è¯•ç±»  */  public class CountListIntegerSumMain {        public static void main(String[] args) {          List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();          int threadCounts = 10;//é‡‡ç”¨çš„çº¿ç¨‹æ•°          //ç”Ÿæˆçš„Listæ•°æ®          for (int i = 1; i &lt;= 1000000; i++) {              list.add(i);          }          CountListIntegerSum countListIntegerSum=new CountListIntegerSum(list,threadCounts);          long sum=countListIntegerSum.getIntegerSum();          System.out.println("Listä¸­æ‰€æœ‰æ•´æ•°çš„å’Œä¸º:"+sum);      }    }  </code></pre><h1 class=pgc-h-arrow-right>å››ï¼šæ€»ç»“</h1><p>æœ¬æ–‡ä¸»è¦é€šè¿‡ä¸€ä¸ªæ·˜å®çš„é¢è¯•é¢˜ä¸ºå¼•å­ï¼Œä»‹ç»äº†å¹¶å‘çš„ä¸€ç‚¹å°çŸ¥è¯†ï¼Œä¸»è¦æ˜¯ä»‹ç»é€šè¿‡CyclicBarrieråŒæ­¥è¾…åŠ©å™¨è¾…åŠ©å¤šä¸ªå¹¶å‘ä»»åŠ¡å…±åŒå®Œæˆä¸€ä»¶å·¥ä½œã€‚Java SE5çš„java.util.concurrentå¼•å…¥äº†å¤§é‡çš„è®¾è®¡æ¥è§£å†³å¹¶å‘é—®é¢˜ï¼Œä½¿ç”¨å®ƒä»¬æœ‰åŠ©äºæˆ‘ä»¬ç¼–å†™æ›´åŠ ç®€å•è€Œå¥å£®çš„å¹¶å‘ç¨‹åºã€‚</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'CPU','è®¡ç®—','List'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>