<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ä»é›¶å¼€å§‹å­¦ä¹ æ¯”ç‰¹å¸å¼€å‘ï¼šåˆ›å»ºé’±åŒ…é‡è¦æ–¹æ³•ä¹‹åˆ›å»ºç§é’¥åŠå…¬é’¥ | æå®¢å¿«è¨Š</title><meta property="og:title" content="ä»é›¶å¼€å§‹å­¦ä¹ æ¯”ç‰¹å¸å¼€å‘ï¼šåˆ›å»ºé’±åŒ…é‡è¦æ–¹æ³•ä¹‹åˆ›å»ºç§é’¥åŠå…¬é’¥ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/476b088.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/476b088.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/476b088.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/476b088.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/476b088.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/476b088.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/476b088.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/476b088.html><meta property="article:published_time" content="2020-10-29T20:51:34+08:00"><meta property="article:modified_time" content="2020-10-29T20:51:34+08:00"><meta name=Keywords content><meta name=description content="ä»é›¶å¼€å§‹å­¦ä¹ æ¯”ç‰¹å¸å¼€å‘ï¼šåˆ›å»ºé’±åŒ…é‡è¦æ–¹æ³•ä¹‹åˆ›å»ºç§é’¥åŠå…¬é’¥"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/476b088.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ä»é›¶å¼€å§‹å­¦ä¹ æ¯”ç‰¹å¸å¼€å‘ï¼šåˆ›å»ºé’±åŒ…é‡è¦æ–¹æ³•ä¹‹åˆ›å»ºç§é’¥åŠå…¬é’¥</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p><h2>å†™åœ¨å‰é¢</h2>åˆ›å»ºé’±åŒ…å’Œäº¤æ˜“æ˜¯æ¯”ç‰¹å¸æœ€é‡è¦çš„ä¸¤æ–¹é¢ï¼Œæ¶‰åŠåˆ°å¾ˆå¤šå¾ˆå¤šçš„å†…å®¹ï¼Œè¿œéä¸€ç¯‡æ–‡ç« èƒ½æ¦‚æ‹¬çš„å®Œã€‚ä¸Šä¸€ç¯‡ä»æ•´ä½“ä¸Šè®²è§£äº†é’±åŒ…çš„åˆ›å»ºæµç¨‹ï¼Œè™½ç„¶å·²ç»å¾ˆè¯¦ç»†äº†ï¼Œä½†è¿˜æ˜¯æ¼æ‰äº†å‡ ä¸ªé‡è¦çš„æ–¹æ³•ï¼Œä»æœ¬ç¯‡å¼€å§‹æˆ‘ä»¬è®²è§£è¿™å‡ ä¸ªç‰¹åˆ«é‡è¦çš„æ–¹æ³•ã€‚å¯¹é’±åŒ…æ„Ÿå…´è¶£çš„æœ‹å‹ä¸€å®šä¸è¦é”™è¯¯ã€‚<h2>GenerateNewSeed</h2></p><p>è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨æ¥ç”Ÿæˆç§é’¥/å…¬é’¥ï¼Œåœ¨ç”Ÿæˆå…¬é’¥åï¼Œè°ƒç”¨é’±åŒ…å¯¹è±¡çš„ <code>SetHDSeed</code>æ–¹æ³•ï¼Œæ ¹æ®å…¬é’¥ç”Ÿæˆä¸€ä¸ª<code>CHDChain</code>å¯¹è±¡ï¼ŒæŠŠå…¬é’¥ç»è¿‡ SHA256ã€RIPEMD160 ä¸¤æ¬¡å“ˆå¸Œè¿”å›åçš„ 20ä¸ªå­—èŠ‚ 180 ä½å­—ç¬¦ä¸²ä½œä¸ºå®ƒçš„<code>seed_id</code>å±æ€§ï¼Œä»è€Œä»¥åå¯ä»¥è¡ç”Ÿæ›´çš„æ‰©å±•å…¬é’¥ã€‚</p><pre><code>void CWallet::SetHDSeed(const CPubKey&amp; seed){    LOCK(cs_wallet);    CHDChain newHdChain;    newHdChain.nVersion = CanSupportFeature(FEATURE_HD_SPLIT) ? CHDChain::VERSION_HD_CHAIN_SPLIT : CHDChain::VERSION_HD_BASE;    newHdChain.seed_id = seed.GetID;    SetHDChain(newHdChain, false);}</code></pre><p>åœ¨åˆ›å»ºé’±åŒ…çš„è¿‡ç¨‹ä¸­ï¼Œæœ¬æ–¹æ³•åŠä¸‹é¢çš„ <code>TopUpKeyPool</code>æ–¹æ³•ï¼Œå¯èƒ½ä¼šè¢«è°ƒç”¨ä¸¤æ¬¡ï¼Œä¸€æ¬¡åœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºé’±åŒ…æ—¶ï¼Œå¦ä¸€æ¬¡åœ¨ç”¨æˆ·æ˜ç¡®å‡çº§ï¼Œä¸”é’±åŒ…æ”¯æŒ HDï¼Œä½† HD æ²¡å¯ç”¨çš„æƒ…å†µä¸‹ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹æ­£å¼è®²è§£è¿™ä¸ªæ–¹æ³•ã€‚</p><ol><li>é¦–å…ˆï¼Œç”Ÿæˆå¹¶è°ƒç”¨ç§é’¥çš„ <code>MakeNewKey</code>æ¥åˆå§‹åŒ–ç§é’¥ã€‚<pre><code>CKey key; key.MakeNewKey(true); </code></pre></li><li>ç„¶åï¼Œè°ƒç”¨ <code>DeriveNewSeed</code>æ–¹æ³•ï¼Œç”Ÿæˆå¹¶è¿”å›ç§é’¥å¯¹åº”çš„å…¬é’¥ã€‚<pre><code>return DeriveNewSeed(key); </code></pre></li></ol><p>æˆ‘ä»¬å…ˆæ¥çœ‹ <code>MakeNewKey</code>è¿™ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯éå¸¸é‡è¦ï¼Œå› ä¸ºæ­£æ˜¯è¿™ä¸ªæ–¹æ³•ï¼Œç”Ÿæˆäº†çœŸæ­£æ„ä¹‰ä¸Šçš„ç§é’¥ã€‚</p><pre><code>void CKey::MakeNewKey(bool fCompressedIn) {    do {        GetStrongRandBytes(keydata.data, keydata.size);    } while (!Check(keydata.data));    fValid = true;    fCompressed = fCompressedIn;}</code></pre><p><code>GetStrongRandBytes</code>æ–¹æ³•ï¼Œæ­£æ˜¯ç”Ÿæˆç§é’¥çš„è¿‡ç¨‹ã€‚è¿™ä¸ªæ–¹æ³•çš„æ‰§è¡Œé€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li>ç”Ÿæˆä¸€ä¸ª SHA512å¯¹è±¡å’Œä¸€ä¸ªæ— ç¬¦å·å­—ç¬¦æ•°ç»„ã€‚<pre><code>CSHA512 hasher; unsigned char buf[64]; </code></pre></li><li>é¦–å…ˆï¼Œè°ƒç”¨ <code>RandAddSeedPerfmon</code>æ–¹æ³•ï¼Œé€šè¿‡ OpenSSL's RNG ç”Ÿæˆéšæœºæ•°ï¼Œå¹¶è¿›è¡Œ SHA512 å“ˆå¸Œã€‚<pre><code>RandAddSeedPerfmon; GetRandBytes(buf, 32); hasher.Write(buf, 32); </code></pre></li><li>ç„¶åï¼Œè°ƒç”¨ <code>GetOSRand</code>æ–¹æ³•ï¼Œé€šè¿‡ OS RNG ç”Ÿæˆéšæœºæ•°ï¼Œå¹¶è¿›è¡Œ SHA512 å“ˆå¸Œã€‚<pre><code>GetOSRand(buf); hasher.Write(buf, 32); </code></pre></li><li>æœ€åï¼Œå¦‚æœ HW å¯ç”¨ï¼Œé€šè¿‡ HW ç”Ÿæˆéšæœºæ•°ï¼Œå¹¶è¿›è¡Œ SHA512 å“ˆå¸Œã€‚<pre><code>if (GetHWRand(buf)) { hasher.Write(buf, 32); } </code></pre></li><li>æ¥ä¸‹æ¥ï¼Œåˆå¹¶å¹¶æ›´æ–°çŠ¶æ€ã€‚<pre><code>{ WAIT_LOCK(cs_rng_state, lock); hasher.Write(rng_state, sizeof(rng_state)); hasher.Write((const unsigned char*)&amp;rng_counter, sizeof(rng_counter)); ++rng_counter; hasher.Finalize(buf); memcpy(rng_state, buf + 32, 32); } </code></pre></li><li>ç„¶åï¼ŒæŠŠ <code>buf</code>æ•°ç»„ä¸­çš„å†…å®¹æ‹·è´åˆ°è¾“å‡ºå‚æ•°ä¸­ï¼Œå¹¶æ¸…ç©ºæ•°ç»„ä¸­çš„å†…å®¹ã€‚<pre><code>memcpy(out, buf, num); memory_cleanse(buf, 64); </code></pre></li></ol><p><code>Check</code>æ–¹æ³•å†…éƒ¨é€šè¿‡è°ƒç”¨<code>secp256k1_ec_seckey_verify</code>æ–¹æ³•ï¼Œæ£€æŸ¥ç§é’¥çš„æ•°æ®æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œåè€…æ­£æ˜¯æ¤­åœ†æ›²çº¿ç®—æ³•ç›¸å…³çš„ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ <code>DeriveNewSeed</code>æ–¹æ³•æ˜¯å¦‚ä½•ç”Ÿæˆå…¬é’¥çš„ã€‚æ–¹æ³•æ‰§è¡Œé€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li>ç”Ÿæˆå½“å‰æ—¶é—´ï¼Œå¹¶ç”¨å½“å‰æ—¶é—´åˆå§‹åŒ–èœœé’¥å…ƒæ•°æ®ã€‚<pre><code>int64_t nCreationTime = GetTime; CKeyMetadata metadata(nCreationTime); </code></pre></li><li>è°ƒç”¨ç§é’¥çš„ <code>GetPubKey</code>æ–¹æ³•ï¼Œç”Ÿæˆå…¬é’¥ã€‚æ–¹æ³•å†…éƒ¨æ­£æ˜¯é€šè¿‡æ¤­åœ†æ›²çº¿ç®—æ³•æ¥ç”Ÿæˆç§é’¥å¯¹åº”çš„å…¬é’¥ã€‚ä»£ç å¦‚ä¸‹ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œç ”ç©¶ã€‚<pre><code>assert(fValid); secp256k1_pubkey pubkey; size_t clen = CPubKey::PUBLIC_KEY_SIZE; CPubKey result; int ret = secp256k1_ec_pubkey_create(secp256k1_context_sign, &amp;pubkey, begin); assert(ret); secp256k1_ec_pubkey_serialize(secp256k1_context_sign, (unsigned char*)result.begin, &amp;clen, &amp;pubkey, fCompressed ? SECP256K1_EC_COMPRESSED : SECP256K1_EC_UNCOMPRESSED); assert(result.size == clen); assert(result.IsValid); return result; </code></pre></li><li>æ‰§è¡Œ <code>assert(key.VerifyPubKey(seed));</code>æ–¹æ³•ï¼ŒéªŒè¯å…¬é’¥ç¡®å®æœ‰ç§é’¥ç›¸åŒ¹é…ã€‚</li><li>è®¾ç½®èœœé’¥å…ƒæ•°æ®çš„ä¸¤ä¸ªå±æ€§ã€‚<pre><code>metadata.hdKeypath = "s"; metadata.hd_seed_id = seed.GetID; </code></pre><code>GetID</code>æ–¹æ³•ï¼Œç”¨å…¬é’¥çš„æ•°æ®ç»è¿‡ SHA256ã€RIPEMD160 ä¸¤æ¬¡å“ˆå¸Œåç”Ÿæˆçš„å­—ç¬¦ä¸²æ¥ç”Ÿæˆä¸€ä¸ª<code>CKeyID</code>å¯¹è±¡ã€‚</li><li>æŠŠå¯†é’¥å…ƒæ•°æ®ä¿å­˜åœ¨ <code>mapKeyMetadata</code>é›†åˆä¸­ã€‚<pre><code>mapKeyMetadata[seed.GetID()] = metadata; </code></pre></li><li>è°ƒç”¨ <code>AddKeyPubKey</code>æ–¹æ³•ï¼ŒæŠŠç§é’¥/å…¬é’¥åŠå…ƒæ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ã€‚å¦‚æœå‡ºé”™ï¼ŒæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚<pre><code>if (!AddKeyPubKey(key, seed)) throw std::runtime_error(std::string(__func__) + ": AddKeyPubKey failed"); </code></pre><code>AddKeyPubKey</code>æ–¹æ³•ç”Ÿæˆä¸€ä¸ªè®¿é—®æ•°æ®åº“çš„å¯¹è±¡ï¼Œç„¶åè°ƒç”¨é’±åŒ…å¯¹è±¡çš„<code>AddKeyPubKeyWithDB</code>æ–¹æ³•æ¥ä¿å­˜å¯†é’¥æ•°æ®ã€‚åè€…çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š<ul><li>å¦‚æœå˜é‡ <code>encrypted_batch</code>ä¸ºç©ºï¼Œé‚£ä¹ˆè®¾ç½®å˜é‡<code>needsDB</code>ä¸ºçœŸã€‚å¦‚æœåè€…ä¸ºçœŸï¼Œé‚£ä¹ˆè®¾ç½®<code>encrypted_batch</code>å±æ€§ä¸ºå‚æ•°æŒ‡å®šçš„å¯¹è±¡ã€‚<pre><code>bool needsDB = !encrypted_batch; if (needsDB) { encrypted_batch = &amp;batch; } </code></pre></li><li>è°ƒç”¨ <code>CCryptoKeyStore::AddKeyPubKey</code>æ–¹æ³•ï¼Œä¿å­˜ç§é’¥å’Œå…¬é’¥ã€‚å¦‚æœä¸æˆåŠŸï¼Œè¿›ä¸€æ­¥ï¼Œå¦‚æœå˜é‡<code>needsDB</code>ä¸ºçœŸï¼Œåˆ™è®¾ç½®å˜é‡<code>encrypted_batch</code>ä¸ºå‡ã€‚<pre><code>if (!CCryptoKeyStore::AddKeyPubKey(secret, pubkey)) { if (needsDB) encrypted_batch = nullptr; return false; } </code></pre><code>CCryptoKeyStore::AddKeyPubKey</code>æ–¹æ³•å†…éƒ¨æ‰§è¡Œé€»è¾‘å¦‚ä¸‹ï¼š<ul><li>å¦‚æœæ²¡æœ‰åŠ å¯†ï¼Œé‚£ä¹ˆè°ƒç”¨ <code>CBasicKeyStore::AddKeyPubKey</code>æ¥ä¿å­˜ç§é’¥å’Œå…¬é’¥ï¼Œç„¶åè¿”å›ã€‚<pre><code>if (!IsCrypted) { return CBasicKeyStore::AddKeyPubKey(key, pubkey); } </code></pre><code>IsCrypted</code>æ–¹æ³•ï¼Œåˆå§‹åŒ–æ—¶æ˜¯æ²¡æœ‰åŠ å¯†çš„ï¼Œåªæœ‰åœ¨æ‰§è¡ŒåŠ é”ã€è§£é”ã€æ·»åŠ åŠ å¯†å¯†é’¥çš„æƒ…å†µä¸‹æ‰ä¼šæ˜¯åŠ å¯†çš„ã€‚å½“å‰æƒ…æ™¯æ˜¯æ²¡æœ‰åŠ å¯†çš„ï¼Œæ‰€ä»¥æ‰§è¡ŒåŸºç±»çš„æ–¹æ³•æ¥ä¿å­˜ç§é’¥å’Œå…¬é’¥ã€‚<p><code>CBasicKeyStore::AddKeyPubKey</code>æ–¹æ³•ï¼Œé¦–å…ˆæŠŠç§é’¥ä¿å­˜åœ¨<code>mapKeys</code>é›†åˆä¸­ï¼Œç„¶åè°ƒç”¨<code>ImplicitlyLearnRelatedKeyScripts</code>æ–¹æ³•æ¥å¤„ç†è„šæœ¬ï¼Œå› ä¸ºå…¬é’¥é»˜è®¤æ˜¯å‹ç¼©çš„ï¼Œæ‰€ä»¥åœ¨æ–¹æ³•å†…ä¼šç”Ÿæˆè„šæœ¬ï¼Œå¹¶æŠŠè„šæœ¬ä¿å­˜åœ¨<code>mapScripts</code>é›†åˆä¸­ã€‚</p><pre><code>bool CBasicKeyStore::AddKeyPubKey(const CKey&amp; key, const CPubKey &amp;pubkey) { LOCK(cs_KeyStore); mapKeys[pubkey.GetID()] = key; ImplicitlyLearnRelatedKeyScripts(pubkey); return true; } </code></pre></li><li>å¦‚æœæ˜¯é”å®šçš„ï¼Œé‚£ä¹ˆè¿”å›å‡ã€‚<pre><code>if (IsLocked) { return false; } </code></pre><code>IsLocked</code>æ–¹æ³•ï¼Œé¦–å…ˆè°ƒç”¨<code>IsCrypted</code>æ–¹æ³•ï¼Œç¡®å®šæ˜¯å¦æ˜¯åŠ å¯†çš„ï¼Œå¦‚æœä¸æ˜¯åŠ å¯†çš„ï¼Œåˆ™ç›´æ¥è¿”å›å‡ï¼›å¦åˆ™ï¼ŒæŠŠ<code>vMasterKey</code>é›†åˆæ¸…ç©ºã€‚<pre><code>bool CCryptoKeyStore::IsLocked const { if (!IsCrypted) { return false; } LOCK(cs_KeyStore); return vMasterKey.empty; } </code></pre></li><li>æ¥ä¸‹æ¥ï¼Œç”ŸæˆåŠ å¯†ç§é’¥ã€‚<pre><code>std::vector&lt;unsigned char&gt; vchCryptedSecret; CKeyingMaterial vchSecret(key.begin, key.end); if (!EncryptSecret(vMasterKey, vchSecret, pubkey.GetHash, vchCryptedSecret)) { return false; } </code></pre></li><li>æœ€åï¼Œè°ƒç”¨ <code>AddCryptedKey</code>æ–¹æ³•ï¼Œä¿å­˜åŠ å¯†ç§é’¥ï¼Œå¹¶è¿”å›<pre><code>if (!AddCryptedKey(pubkey, vchCryptedSecret)) { return false; } return true; </code></pre><code>AddCryptedKey</code>æ–¹æ³•ï¼Œé¦–å…ˆç¡®å®šæ˜¯å¦æ˜¯åŠ å¯†çš„ï¼Œå¦‚æœæ²¡æœ‰åŠ å¯†åˆ™è¿”å›å‡ã€‚æ¥ä¸‹æ¥ï¼ŒæŠŠç§é’¥ä¿å­˜åœ¨<code>mapCryptedKeys</code>é›†åˆä¸­ï¼Œç„¶åè°ƒç”¨<code>ImplicitlyLearnRelatedKeyScripts</code>æ–¹æ³•æ¥å¤„ç†è„šæœ¬ï¼Œå› ä¸ºå…¬é’¥é»˜è®¤æ˜¯å‹ç¼©çš„ï¼Œæ‰€ä»¥åœ¨æ–¹æ³•å†…ä¼šç”Ÿæˆè„šæœ¬ï¼Œå¹¶æŠŠè„šæœ¬ä¿å­˜åœ¨<code>mapScripts</code>é›†åˆä¸­ã€‚<pre><code>bool CCryptoKeyStore::AddCryptedKey(const CPubKey &amp;vchPubKey, const std::vector&lt;unsigned char&gt; &amp;vchCryptedSecret) { LOCK(cs_KeyStore); if (!SetCrypted) { return false; } mapCryptedKeys[vchPubKey.GetID()] = make_pair(vchPubKey, vchCryptedSecret); ImplicitlyLearnRelatedKeyScripts(vchPubKey); return true; } </code></pre></li></ul></li><li>å¦‚æœå˜é‡ <code>needsDB</code>ä¸ºçœŸï¼Œåˆ™è®¾ç½®å˜é‡<code>encrypted_batch</code>ä¸ºç©ºæŒ‡é’ˆã€‚</li><li>è°ƒç”¨ <code>GetScriptForDestination</code>æ–¹æ³•ï¼Œè·å¾—å…¬é’¥å¯¹åº”çš„è„šæœ¬ã€‚<pre><code>CScript script; script = GetScriptForDestination(pubkey.GetID); </code></pre></li><li>è°ƒç”¨ <code>HaveWatchOnly</code>æ–¹æ³•ï¼Œæ£€æŸ¥<code>setWatchOnly</code>é›†åˆä¸­æ˜¯å¦æœ‰è¿™ä¸ªè„šæœ¬ã€‚å¦‚æœæœ‰ï¼Œåˆ™è°ƒç”¨<code>RemoveWatchOnly</code>æ–¹æ³•ï¼Œæ¸…é™¤å…¬é’¥å¯¹åº”çš„è„šæœ¬ã€‚<pre><code>if (HaveWatchOnly(script)) { RemoveWatchOnly(script); } </code></pre><code>RemoveWatchOnly</code>æ–¹æ³•æ‰§è¡Œé€»è¾‘å¦‚ä¸‹ï¼š<ul><li>è°ƒç”¨ <code>CCryptoKeyStore::RemoveWatchOnly</code>æ–¹æ³•æ¥ç§»é™¤è„šæœ¬ã€‚æ–¹æ³•å†…éƒ¨æ‰§è¡Œé€»è¾‘å¦‚ä¸‹ï¼šä»<code>setWatchOnly</code>é›†åˆä¸­ç§»é™¤å¯¹åº”çš„è„šæœ¬ï¼›ç„¶åï¼Œè°ƒç”¨<code>ExtractPubKey</code>æ–¹æ³•ï¼Œé€šè¿‡è„šæœ¬æ¥è§£æå‡ºå…¬é’¥ï¼Œå¦‚æœå¯ä»¥å¾—åˆ°å…¬é’¥ï¼Œåˆ™ä»<code>mapWatchKeys</code>é›†åˆä¸­ç§»é™¤å¯¹åº”çš„å…¬é’¥ï¼›æœ€åï¼Œè¿”å›çœŸã€‚</li><li>è°ƒç”¨æ•°æ®åº“è®¿é—®å¯¹è±¡çš„ <code>EraseWatchOnly</code>æ–¹æ³•ï¼Œä»æ•°æ®åº“ä¸­ç§»é™¤<code>watchmeta</code>å’Œ<code>watchs</code>å¯¹åº”çš„æ•°æ®ã€‚</li><li>è¿”å›çœŸã€‚</li></ul></li><li>è°ƒç”¨ <code>GetScriptForRawPubKey</code>æ–¹æ³•ï¼Œä»åŸå§‹å…¬é’¥è·å¾—è„šæœ¬ã€‚<pre><code>script = GetScriptForRawPubKey(pubkey); </code></pre></li><li>è°ƒç”¨ <code>HaveWatchOnly</code>æ–¹æ³•ï¼Œæ£€æŸ¥<code>setWatchOnly</code>é›†åˆä¸­æ˜¯å¦æœ‰è¿™ä¸ªè„šæœ¬ã€‚å¦‚æœæœ‰ï¼Œåˆ™è°ƒç”¨<code>RemoveWatchOnly</code>æ–¹æ³•ï¼Œæ¸…é™¤å…¬é’¥å¯¹åº”çš„è„šæœ¬ã€‚æ–¹æ³•æ‰§è¡Œé€»è¾‘å¦‚ä¸Šæ‰€è¿°ï¼Œè¿™é‡Œä¸è®²ã€‚</li><li>å¦‚æœä¸æ˜¯åŠ å¯†çš„ï¼Œåˆ™è°ƒç”¨æ•°æ®åº“çš„è®¿é—®å¯¹è±¡çš„ <code>WriteKey</code>æ–¹æ³•ï¼ŒæŠŠç§é’¥å’Œå…¬é’¥åŠå¯†é’¥å…ƒæ•°æ®å†™å…¥æ•°æ®åº“ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œé¦–å…ˆï¼Œä»¥<code>keymeta</code>ä¸ºé”®ï¼Œä¿å­˜å¯¹åº”çš„å…ƒæ•°æ®ï¼›ç„¶åï¼ŒæŠŠå…¬é’¥/ç§é’¥ä¿å­˜åˆ°å‘é‡ä¸­ï¼Œä»¥<code>key</code>ä¸ºé”®ï¼Œä¿å­˜å¯¹åº”çš„å…¬é’¥/ç§é’¥ã€‚</li><li>æœ€åï¼Œè¿”å›çœŸã€‚</li></ul></li></ol></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'é›¶å¼€å§‹','å­¦ä¹ ','å¸å¼€å‘'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>