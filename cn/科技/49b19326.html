<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>一文带你了解linux标准输入输出、重定向及管道运用 | 极客快訊</title><meta property="og:title" content="一文带你了解linux标准输入输出、重定向及管道运用 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/1d3e05acdeab4aa29280d50a011fb80e"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/49b19326.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/49b19326.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/49b19326.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/49b19326.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/49b19326.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/49b19326.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/49b19326.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/49b19326.html><meta property="article:published_time" content="2020-10-29T21:09:47+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:47+08:00"><meta name=Keywords content><meta name=description content="一文带你了解linux标准输入输出、重定向及管道运用"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/49b19326.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一文带你了解linux标准输入输出、重定向及管道运用</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>概述</h1><p>当我们在shell中执行命令的时候，每个进程都和三个打开的文件相联系，并使用文件描述符来引用这些文件。由于文件描述符不容易记忆，shell同时也给出了相应的文件名。</p><hr><p>下面就是这些文件描述符及它们通常所对应的文件名：</p><h1><strong>文件文件描述符</strong></h1><p>系统中实际上有12个文件描述符，但是正如我们在上表中所看到的， 0、1、2是标准输入、输出和错误。可以任意使用文件描述符3到9。</p><div class=pgc-img><img alt=一文带你了解linux标准输入输出、重定向及管道运用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1d3e05acdeab4aa29280d50a011fb80e><p class=pgc-img-caption></p></div><p>标准<strong>输入</strong>是文件描述符<strong>0</strong>。它是命令的输入，缺省是键盘，也可以是文件或其他命令的输出。</p><p>标准<strong>输出</strong>是文件描述符<strong>1</strong>。它是命令的输出，缺省是屏幕，也可以是文件。</p><p>标准<strong>错误</strong>是文件描述符<strong>2</strong>。这是命令错误的输出，缺省是屏幕，同样也可以是文件。</p><hr><h1><strong>文件重定向</strong></h1><p>在执行命令时，可以指定命令的标准输入、输出和错误，要实现这一点就需要使用文件重定向。下面列出了最常用的重定向组合，并给出了相应的文件描述符。</p><p>在对标准错误进行重定向时，必须要使用文件描述符，但是对于标准输入和输出来说，这不是必须的。</p><p><strong>command &lt;&lt; delimiter 把从标准输入中读入，直至遇到delimiter分界符</strong></p><p><strong>command &lt;&m 把把文件描述符m作为标准输入</strong></p><p><strong>command >&m 把把标准输出重定向到文件描述符m中</strong></p><p><strong>command &lt;&- 把关闭标准输入 //？这个“-”代表什么意思</strong></p><div class=pgc-img><img alt=一文带你了解linux标准输入输出、重定向及管道运用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6e8595866335482696e463caf8379e58><p class=pgc-img-caption></p></div><hr><h1><strong>重定向标准输出</strong></h1><p>在下面的命令中，把/etc/passwd文件中的用户ID域按照用户命排列。</p><p>该命令的输出重定向到sort.out文件中。要提醒注意的是，在使用sort命令的时候(或其他含有相似输入文件参数的命令)，重定向符号一定要离开sort命令两个空格，否则该命令会把它当作输入文件。</p><p>$ cat passwd | awk -F: '{print $1}' | sort 1>sort.out //错误信息不会输出到sort.out</p><p>也可以使用如下的表达方式，结果和上面一样：</p><p>$ cat passwd | awk -F: '{print $1}' | sort >sort.out //与上面的等价，什么也不写的>，默认就是1【标准输出】</p><hr><h1><strong>重定向标准输入</strong></h1><p>可以指定命令的标准输入。在awk一章就会遇到这样的情况。下面给出一个这样的例子：</p><p>$ sort &lt; name.txt</p><p>在上面的命令中， sort命令的输入是采用重定向的方式给出的，不过也可以直接把相应的</p><p>文件作为该命令的参数：</p><p>$ sort name.txt</p><p>在上面的例子中，还可以更进一步地通过重定向为sort命令指定一个输出文件name.out。</p><p>这样屏幕上将不会出现任何信息(<strong>除了错误信息</strong>以外)：</p><p>$ sort &lt;name.txt >name.out</p><p><strong>实例说明：</strong></p><pre>cat &gt;&gt; myfile &lt;&lt;hwb //直到遇到字符串“hwb”,会停止输入&gt; Hello there I am using a $TERIM terminal &gt; and my user name is $LOGNAME &gt; bye&gt; test&gt; hwb</pre><div class=pgc-img><img alt=一文带你了解linux标准输入输出、重定向及管道运用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/aa88842e98ec419896109d34e1e4cbe8><p class=pgc-img-caption></p></div><hr><h1><strong>重定向标准错误</strong></h1><p>为了重定向标准错误，可以指定文件描述符2。</p><p>grep命令没有找到该文件，缺省地向终端输出了一个错误信息。现在让我们把错误重定向到文件/dev/null中(实际就上是系统的垃圾箱)：</p><p>$ grep "abc" test 2>/dev/null</p><div class=pgc-img><img alt=一文带你了解linux标准输入输出、重定向及管道运用 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/423895db15374715b14012484ce98a3c><p class=pgc-img-caption></p></div><p>这样所有的错误输出都输送到了/dev/null，不再出现在屏幕上。</p><hr><h1><strong>合并标准输出和标准错误</strong></h1><p>在合并标准输出和标准错误的时候，切记shell是从左至右分析相应的命令的。下面给出一个例子：</p><p>$ echo test >test.out 2>&1</p><div class=pgc-img><img alt=一文带你了解linux标准输入输出、重定向及管道运用 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/0e0b7ba9bf17473690d781d790637218><p class=pgc-img-caption></p></div><p>在上面的例子中，我们将test脚本的输出重定向到>test.out文件中，而且其错误也被重定向到相同的文件中。</p><p>shell中可能经常能看到：>/dev/null 2>&1 //即忽略所有输出信息。</p><hr><h1>复杂案例</h1><p><strong>需求</strong>：命令 cmd1, cmd2, cmd3, cmd4. 如何利用单向管道完成下列功能：</p><pre>1. 所有命令并行执行。2. cmd1 和 cmd2 不需要 stdin。3. cmd1 和 cmd2 的 stdout 定向到 cmd3 的 stdin。4. cmd1 和 cmd2 的 stderr 定向到 cmd4 的 stdin。5. cmd3 的 stdout 定向到文件 a, stderr 定向到屏幕。6. cmd4 的 stdout 定向到文件 b, stderr 定向到屏幕。7. cmd1 的返回码赋给变量 s。8. 不能利用临时文件。</pre><p><strong>解决方法：</strong></p><pre>exec 3&gt;&amp;1; exec 4&gt;&amp;1 s=$(((((cmd1 1&gt;&amp;3 ; echo $? &gt;&amp;4 )| cmd2 ) 3&gt;&amp;1 | cmd3 &gt;a 2&gt;&amp;3 ) 2&gt;&amp;1 | cmd4 &gt;b ) 4&gt;&amp;1) exec 3&gt;&amp;-; exec 4&gt;&amp;-</pre><p><strong>说明：</strong></p><p>exec 3>&amp;1; exec 4>&1就是建立FD3 ，给cmd1恢复其FD1用和给cmd3 恢复其FD2用，建立FD4，保存“echo $?”输出值的“草稿纸”。</p><p>第一对括号：(cmd1 1>&3 ; echo $? >&4 ) 和其后（第一个）管道。在第一个括号（子shell）中，其FD1已经连到 管道中了，所以用 FD3 将 FD1恢复正常，不让他往管道跑；这里的cmd1没有stdin，接着将 cmd1 运行的返回码 保存到 FD4 中。</p><p>第二对括号：((cmd1 1>&3 ; echo $? >&4 )| cmd2 ) 3>&1 和其后（第二个）管道。前面的 FD1 已经不送给 cmd2了，FD2 默认也不送过来，所以cmd2 也没有stdin ，所以在第二对括号里面：cmd1和cmd2 的stdout、stderr 为默认输出，一直遇到 “3>&1”为止。请注意：“3>&1”，先将第二对括号看出一个命令，他们遇到 第二个管道时，其FD1 连到 管道 “|”，由于“3>&1”的作用，子shell的FD1 送给FD3 使用，所以所有FD3 的输出都 “流往”cmd3，又由于继承关系（继承第一行的命令），FD3实际上就是cmd1和cmd2的stdout，于是“ cmd1 和 cmd2 的 stdout 定向到 cmd3 的 stdin”</p><p>第 三对括号：(((cmd1 1>&3 ; echo $? >&4 )| cmd2 ) 3>&1 | cmd3 >a 2>&3 ) 2>&1 和其后的第三个管道。cmd1 和 cmd2 的 stdout 已经定向到 cmd3 的 stdin，处理之后，cmd3 >a 意味着将其 stdout 送给 a 文件。而2>&3的意思是：恢复cmd3的错误输出为FD3，即送往 monitor。于是“cmd3 的 stdout 定向到文件 a, stderr 定向到屏幕”。如果没有“2>&3”，那么cmd3的错误输出就会干扰cmd1和cmd2的错误输出，所以它是必须的！请注意第三对括号后 的 “2>&1”| ，其子shell的FD1 本来连接着管道“|”，但子shell FD1 慷慨大方，送给了 FD2，于是FD2 连接着管道。还记得前面的 cmd1 和 cmd2 吗？他们的stderr一直没动了。于是在这里，通过管道送给了 第四个命令cmd4 了。即“cmd1 和 cmd2 的 stderr 定向到 cmd4 的 stdin”。后面就比较简单了。cmd4 >b 表示“cmd4 的 stdout 定向到文件 b, stderr 定向到屏幕（默认）”</p><p>第 四对括号：((((cmd1 1>&3 ; echo $? >&4 )| cmd2 ) 3>&1 | cmd3 >a 2>&3 ) 2>&1 | cmd4 >b ) 与其后的 4>&1。四对括号里面的 FD1、FD2都处理完了。但是还记得前面“echo $? >&4”那块“草稿纸”吗？“4>&1”的作用就是“将草稿纸上的内容送给monitor”，但是由于最外面还有 $() 将其“包着”。于是其值赋给变量“s”。</p><hr><div class=pgc-img><img alt=一文带你了解linux标准输入输出、重定向及管道运用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/796f61c1ad39469dab5f72355bd9ccab><p class=pgc-img-caption></p></div><p><strong>重定向的使用有如下规律：</strong></p><p><strong>1）标准输入0、输出1、错误2需要分别重定向，一个重定向只能改变它们中的一个。</strong></p><p><strong>2）标准输入0和标准输出1可以省略。（当其出现重定向符号左侧时）</strong></p><p><strong>3）文件描述符在重定向符号左侧时直接写即可，在右侧时前面加& 【类似于指针前要加*号，来区分这、两种情况】。</strong></p><p><strong>4）文件描述符与重定向符号之间不能有空格</strong></p><p><strong>后面会分享更多关于devops和DBA方面内容，大家可以关注下~</strong></p><div class=pgc-img><img alt=一文带你了解linux标准输入输出、重定向及管道运用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/150800a0d5dd426cac647eaf40963e64><p class=pgc-img-caption></p></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'了解','linux','标准'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>