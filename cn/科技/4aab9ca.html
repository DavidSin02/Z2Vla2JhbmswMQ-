<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ä½¿ç”¨Spring Cloud Streamæ„å»ºå’Œæµ‹è¯•æ¶ˆæ¯é©±åŠ¨çš„å¾®æœåŠ¡ | æå®¢å¿«è¨Š</title><meta property="og:title" content="ä½¿ç”¨Spring Cloud Streamæ„å»ºå’Œæµ‹è¯•æ¶ˆæ¯é©±åŠ¨çš„å¾®æœåŠ¡ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/100485be79b4405d9bda1e684cd4d460"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4aab9ca.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4aab9ca.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4aab9ca.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4aab9ca.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4aab9ca.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4aab9ca.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4aab9ca.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4aab9ca.html><meta property="article:published_time" content="2020-10-29T21:04:30+08:00"><meta property="article:modified_time" content="2020-10-29T21:04:30+08:00"><meta name=Keywords content><meta name=description content="ä½¿ç”¨Spring Cloud Streamæ„å»ºå’Œæµ‹è¯•æ¶ˆæ¯é©±åŠ¨çš„å¾®æœåŠ¡"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/4aab9ca.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ä½¿ç”¨Spring Cloud Streamæ„å»ºå’Œæµ‹è¯•æ¶ˆæ¯é©±åŠ¨çš„å¾®æœåŠ¡</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><h1>èƒŒæ™¯</h1><p>Spring Bootå’ŒSpring Cloudä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªä½¿ç”¨ä¸åŒé€šä¿¡æ–¹å¼å¿«é€Ÿæ„å»ºå¾®æœåŠ¡æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥åŸºäºSpring Cloud Netflixåº“åˆ›å»ºåŒæ­¥RESTå¾®æœåŠ¡ï¼Œå¯ä»¥åˆ›å»ºä½¿ç”¨Spring WebFluxåœ¨Nettyä¸Šéƒ¨ç½²çš„å¼‚æ­¥ï¼Œååº”å¼å¾®æœåŠ¡ï¼Œå¹¶å°†å…¶ä¸Spring Cloudåº“æˆåŠŸç»“åˆï¼Œå¯ä»¥ä½¿ç”¨Spring Cloud Streamå’ŒApache Kafkaæˆ–RabbitMQç­‰æ¶ˆæ¯ä»£ç†ï¼ŒåŸºäºå‘å¸ƒ/è®¢é˜…æ¨¡å‹æ¥å®ç°æ¶ˆæ¯é©±åŠ¨çš„å¾®æœåŠ¡ã€‚æˆ‘ä»¬æ¼”ç¤ºåŸºäºRabbitMQä»£ç†æœ‰æ•ˆåœ°æ„å»ºï¼Œæ‰©å±•ï¼Œè¿è¡Œå’Œæµ‹è¯•æ¶ˆæ¯ä¼ é€’å¾®æœåŠ¡ã€‚</p><div class=pgc-img><img alt="ä½¿ç”¨Spring Cloud Streamæ„å»ºå’Œæµ‹è¯•æ¶ˆæ¯é©±åŠ¨çš„å¾®æœåŠ¡" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/100485be79b4405d9bda1e684cd4d460><p class=pgc-img-caption></p></div><h1><strong>æ¶æ„</strong></h1><p>é‡‡ç”¨Spring Cloud Streamçš„åŠŸèƒ½ï¼Œè®¾è®¡ä¸€ä¸ªç¤ºä¾‹ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿä½¿ç”¨å‘å¸ƒ/è®¢é˜…æ¨¡å‹è¿›è¡ŒæœåŠ¡é—´é€šä¿¡ã€‚å®ƒæä¾›ä¸‰ç§å¾®æœåŠ¡ï¼šè®¢è´­æœåŠ¡ï¼Œäº§å“æœåŠ¡å’Œå¸æˆ·æœåŠ¡ã€‚åº”ç”¨ç¨‹åºè®¢å•æœåŠ¡å…¬å¼€äº†ä¸€ä¸ªHTTPç«¯ç‚¹ï¼Œè¯¥ç«¯ç‚¹è´Ÿè´£å¤„ç†å‘é€åˆ°æˆ‘ä»¬ç³»ç»Ÿçš„è®¢å•ã€‚æ‰€æœ‰ä¼ å…¥çš„è®¢å•éƒ½è¢«å¼‚æ­¥å¤„ç†-è®¢å•æœåŠ¡å‡†å¤‡å¹¶å‘RabbitMQäº¤æ¢å‘é€æ¶ˆæ¯ï¼Œç„¶åå“åº”è°ƒç”¨å®¢æˆ·ç«¯è¯¥è¯·æ±‚å·²è¢«æ¥å—è¿›è¡Œå¤„ç†ã€‚åº”ç”¨ç¨‹åºå¸æˆ·æœåŠ¡å’Œäº§å“æœåŠ¡æ­£åœ¨ä¾¦å¬ä¼ å…¥äº¤æ¢æœºçš„è®¢å•æ¶ˆæ¯ã€‚å¾®æœåŠ¡å¸æˆ·æœåŠ¡è´Ÿè´£æ£€æŸ¥å®¢æˆ·å¸æˆ·ä¸­æ˜¯å¦æœ‰è¶³å¤Ÿçš„èµ„é‡‘æ¥å®ç°è®¢å•ï¼Œç„¶åä»è¯¥å¸æˆ·ä¸­æå–ç°é‡‘ã€‚å¾®æœåŠ¡äº§å“æœåŠ¡æ£€æŸ¥å•†åº—ä¸­æ˜¯å¦æœ‰è¶³å¤Ÿæ•°é‡çš„äº§å“ï¼Œå¹¶åœ¨å¤„ç†è®¢å•åæ›´æ”¹å¯ç”¨äº§å“çš„æ•°é‡ã€‚å¸æˆ·æœåŠ¡å’Œäº§å“æœåŠ¡éƒ½é€šè¿‡RabbitMQäº¤æ¢ï¼ˆè¿™æ˜¯ä½¿ç”¨ç›´æ¥äº¤æ¢çš„ä¸€å¯¹ä¸€é€šä¿¡ï¼‰å‘é€å¤„äºè¿è¡ŒçŠ¶æ€çš„å¼‚æ­¥å“åº”ã€‚æ”¶åˆ°å“åº”æ¶ˆæ¯åï¼Œå¾®æœåŠ¡è®¢å•æœåŠ¡ä¼šè®¾ç½®è®¢å•çš„é€‚å½“çŠ¶æ€ï¼Œå¹¶é€šè¿‡RESTç«¯ç‚¹GET / order / {id}å‘å¤–éƒ¨å®¢æˆ·ç«¯å…¬å¼€ã€‚</p><div class=pgc-img><img alt="ä½¿ç”¨Spring Cloud Streamæ„å»ºå’Œæµ‹è¯•æ¶ˆæ¯é©±åŠ¨çš„å¾®æœåŠ¡" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b079c6dc33314a928be2812814e73d57><p class=pgc-img-caption></p></div><h1>å¯ç”¨Spring Cloud Stream</h1><p>å»ºè®®åœ¨é¡¹ç›®ä¸­åŒ…å«Spring Cloud Streamçš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¾èµ–é¡¹ç®¡ç†ç³»ç»Ÿã€‚ Spring Cloud Streamå…·æœ‰ç›¸å¯¹äºæ•´ä¸ªSpring Cloudæ¡†æ¶çš„ç‹¬ç«‹å‘è¡ŒåŸ¹è®­ç®¡ç†ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä¾èµ–ç®¡ç†å†…éƒ¨çš„Elmhurst.RELEASEç‰ˆæœ¬ä¸­å£°æ˜äº†spring-cloud-dependencieséƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¸å¿…åœ¨pom.xmlä¸­å£°æ˜å…¶ä»–ä»»ä½•å†…å®¹ã€‚ å¦‚æœæ‚¨åªæƒ³ä½¿ç”¨Spring Cloud Streamé¡¹ç›®ï¼Œåˆ™åº”å®šä¹‰ä»¥ä¸‹éƒ¨åˆ†ã€‚</p><pre>&lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-stream-dependencies&lt;/artifactId&gt; &lt;version&gt;Elmhurst.RELEASE&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/dependencyManagement&gt;</pre><p>ä¸‹ä¸€æ­¥æ˜¯å°†spring-cloud-streamå·¥ä»¶æ·»åŠ åˆ°é¡¹ç›®ä¾èµ–é¡¹ä¸­ã€‚ æˆ‘è¿˜å»ºè®®æ‚¨è‡³å°‘åŒ…æ‹¬spring-cloud-sleuthåº“ï¼Œä»¥æä¾›ä¸å®šå•æœåŠ¡ä¼ å…¥çš„æºè¯·æ±‚å…·æœ‰ç›¸åŒtraceIdçš„å‘é€æ¶ˆæ¯ã€‚</p><pre>&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-stream&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-sleuth&lt;/artifactId&gt;&lt;/dependency&gt;</pre><h1><strong>Spring Cloud Streamç¼–ç¨‹æ¨¡å‹</strong></h1><p>è¦ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºå¯ç”¨åˆ°æ¶ˆæ¯ä»£ç†çš„è¿æ¥ï¼Œè¯·ä½¿ç”¨@EnableBindingæ³¨é‡Šä¸»ç±»ã€‚ @EnableBindingæ‰¹æ³¨å°†ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ä½œä¸ºå‚æ•°ã€‚ æ‚¨å¯ä»¥åœ¨Spring Cloud Streamæä¾›çš„ä¸‰ä¸ªæ¥å£ä¹‹é—´è¿›è¡Œé€‰æ‹©ï¼š</p><ul><li>æ¥æ”¶å™¨ï¼šç”¨äºæ ‡è®°ä»å…¥ç«™é€šé“æ¥æ”¶æ¶ˆæ¯çš„æœåŠ¡ã€‚</li><li>æ¥æºï¼šç”¨äºå°†æ¶ˆæ¯å‘é€åˆ°å‡ºç«™é€šé“ã€‚</li><li>å¤„ç†å™¨ï¼šå½“æ‚¨åŒæ—¶éœ€è¦å…¥ç«™é€šé“å’Œå‡ºç«™é€šé“æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ƒæ‰©å±•äº†Sourceå’ŒSinkæ¥å£ã€‚ ç”±äºorder-serviceå¯ä»¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼Œå› æ­¤å…¶ä¸»ç±»å·²ä½¿ç”¨@EnableBindingï¼ˆProcessor.classï¼‰è¿›è¡Œäº†æ³¨é‡Šã€‚</li></ul><p>è¿™æ˜¯å¯ç”¨Spring Cloud Streamç»‘å®šçš„è®¢å•æœåŠ¡çš„ä¸»è¦ç±»åˆ«ã€‚</p><pre>@SpringBootApplication@EnableBinding(Processor.class)public class OrderApplication { public static void main(String[] args) { new SpringApplicationBuilder(OrderApplication.class).web(true).run(args); }}</pre><h1><strong>æ·»åŠ æ¶ˆæ¯ä»£ç†</strong></h1><p>åœ¨Spring Cloud Streamæœ¯è¯­ä¸­ï¼Œè´Ÿè´£ä¸ç‰¹å®šæ¶ˆæ¯ä»£ç†é›†æˆçš„å®ç°ç§°ä¸ºç»‘å®šç¨‹åºã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Cloud Streamä¸ºKafkaå’ŒRabbitMQæä¾›ç»‘å®šå®ç°ã€‚ å®ƒèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹å’Œä½¿ç”¨åœ¨ç±»è·¯å¾„ä¸Šæ‰¾åˆ°çš„ç»‘å®šã€‚ ä»»ä½•ç‰¹å®šäºä¸­é—´ä»¶çš„è®¾ç½®éƒ½å¯ä»¥é€šè¿‡Spring Bootæ”¯æŒçš„å½¢å¼çš„å¤–éƒ¨é…ç½®å±æ€§æ¥è¦†ç›–ï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åºå‚æ•°ï¼Œç¯å¢ƒå˜é‡æˆ–åªæ˜¯application.ymlæ–‡ä»¶ã€‚ ä¸ºäº†åŒ…æ‹¬å¯¹RabbitMQï¼ˆæœ¬æ–‡ä¸­ç”¨ä½œæ¶ˆæ¯ä»£ç†ï¼‰çš„æ”¯æŒï¼Œæ‚¨åº”å°†ä»¥ä¸‹ä¾èµ–é¡¹æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚</p><pre>&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-stream-rabbit&lt;/artifactId&gt;&lt;/dependency&gt;</pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéœ€è¦è¿æ¥ä¸€ä¸ªRabbitMQä»£ç†çš„å…±äº«å®ä¾‹ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘åœ¨é»˜è®¤5672ç«¯å£ä¸Šè¿è¡ŒRabbitMQæš´éœ²åœ¨å¤–éƒ¨çš„Dockeræ˜ åƒçš„åŸå› ã€‚ å®ƒè¿˜ä¼šå¯åŠ¨Webä»ªè¡¨æ¿ï¼Œå…¶åœ°å€ä¸ºhttp://192.168.99.100:15672ã€‚</p><pre>docker run -d --name rabbit -p 15672:15672 -p 5672:5672 rabbitmq:management</pre><p>æˆ‘ä»¬éœ€è¦é€šè¿‡å°†å±æ€§spring.rabbitmq.hostè®¾ç½®ä¸ºDockerè®¡ç®—æœºIP 192.168.99.100ï¼Œæ¥ä¸ºæ¯ä¸ªSpring Bootåº”ç”¨ç¨‹åºè¦†ç›–RabbitMQçš„é»˜è®¤åœ°å€ã€‚</p><pre>spring: rabbitmq: host: 192.168.99.100 port: 5672</pre><h1><strong>å®ç°æ¶ˆæ¯é©±åŠ¨çš„å¾®æœåŠ¡</strong></h1><p>Spring Cloud Streamæ„å»ºåœ¨Spring Integrationé¡¹ç›®ä¹‹ä¸Šã€‚ Spring Integrationæ‰©å±•äº†Springç¼–ç¨‹æ¨¡å‹ï¼Œä»¥æ”¯æŒè‘—åçš„ä¼ä¸šé›†æˆæ¨¡å¼ï¼ˆEIPï¼‰ã€‚ EIPå®šä¹‰äº†è®¸å¤šé€šå¸¸ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸šåŠ¡æµç¨‹çš„ç»„ä»¶ã€‚ æ‚¨å¯èƒ½å·²ç»å¬è¯´è¿‡è¯¸å¦‚æ¶ˆæ¯é€šé“ï¼Œè·¯ç”±å™¨ï¼Œèšåˆå™¨æˆ–ç«¯ç‚¹ä¹‹ç±»çš„æ¨¡å¼ã€‚</p><p>æˆ‘ä»¬ä»è®¢å•æœåŠ¡å¼€å§‹ï¼Œè¯¥æœåŠ¡è´Ÿè´£æ¥å—è®¢å•ï¼Œåœ¨å…±äº«ä¸»é¢˜ä¸Šå‘å¸ƒè®¢å•ï¼Œç„¶åä»ä¸‹æ¸¸æœåŠ¡æ”¶é›†å¼‚æ­¥å“åº”ã€‚ è¿™æ˜¯@Serviceï¼Œå®ƒä½¿ç”¨Source beanç”Ÿæˆä¸€æ¡æ¶ˆæ¯å¹¶å°†å…¶å‘å¸ƒåˆ°è¿œç¨‹ä¸»é¢˜ã€‚</p><pre>@Servicepublic class OrderSender { @Autowired private Source source; public boolean send(Order order) { return this.source.output().send(MessageBuilder.withPayload(order).build()); }}</pre><p>è¯¥@Serviceç”±æ§åˆ¶å™¨è°ƒç”¨ï¼Œè¯¥æ§åˆ¶å™¨å…¬å¼€HTTPç«¯ç‚¹ï¼Œç”¨äºæäº¤æ–°è®¢å•å¹¶è·å–IDä¸ºIDçš„è®¢å•ã€‚</p><pre>@RestControllerpublic class OrderController { private static final Logger LOGGER = LoggerFactory.getLogger(OrderController.class); private ObjectMapper mapper = new ObjectMapper(); @Autowired OrderRepository repository; @Autowired OrderSender sender; @PostMapping public Order process(@RequestBody Order order) throws JsonProcessingException { Order o = repository.add(order); LOGGER.info("Order saved: {}", mapper.writeValueAsString(order)); boolean isSent = sender.send(o); LOGGER.info("Order sent: {}", mapper.writeValueAsString(Collections.singletonMap("isSent", isSent))); return o; } @GetMapping("/{id}") public Order findById(@PathVariable("id") Long id) { return repository.findById(id); }}</pre><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨æ¶ˆè´¹è€…æ–¹é¢è¿›è¡Œä»”ç»†ç ”ç©¶ã€‚ ç”±OrderSender beanä»è®¢å•æœåŠ¡å‘é€çš„æ¶ˆæ¯ç”±å¸æˆ·æœåŠ¡å’Œäº§å“æœåŠ¡æ¥æ”¶ã€‚ è¦ä»ä¸»é¢˜äº¤æµä¸­æ¥æ”¶æ¶ˆæ¯ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨@StreamListeneræ³¨é‡Šå°†Orderå¯¹è±¡ä½œä¸ºå‚æ•°çš„æ–¹æ³•å³å¯ã€‚ æˆ‘ä»¬è¿˜å¿…é¡»ä¸ºä¾¦å¬å™¨å®šä¹‰ç›®æ ‡é€šé“-åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯Processor.INPUTã€‚</p><pre>@SpringBootApplication@EnableBinding(Processor.class)public class OrderApplication { private static final Logger LOGGER = LoggerFactory.getLogger(OrderApplication.class); @Autowired OrderService service; public static void main(String[] args) { new SpringApplicationBuilder(OrderApplication.class).web(true).run(args); } @StreamListener(Processor.INPUT) public void receiveOrder(Order order) throws JsonProcessingException { LOGGER.info("Order received: {}", mapper.writeValueAsString(order)); service.process(order); }}</pre><p>ç„¶åç”±AccountService beanå¤„ç†æ”¶åˆ°çš„è®¢å•ã€‚ è®¢å•æœåŠ¡å¯ä»¥æ¥å—æˆ–æ‹’ç»è®¢å•ï¼Œå…·ä½“å–å†³äºå®¢æˆ·å¸æˆ·ä¸­è¶³å¤Ÿçš„èµ„é‡‘ä»¥å®ç°è®¢å•ã€‚ å¸¦æœ‰æ¥å—çŠ¶æ€çš„å“åº”å°†é€šè¿‡OrderSender beanè°ƒç”¨çš„è¾“å‡ºé€šé“å‘é€å›è®¢å•æœåŠ¡ã€‚</p><p>æœ€åä¸€æ­¥æ˜¯é…ç½®ã€‚ å®ƒåœ¨application.ymlæ–‡ä»¶ä¸­æä¾›ã€‚ æˆ‘ä»¬å¿…é¡»æ­£ç¡®å®šä¹‰é¢‘é“çš„ç›®çš„åœ°ã€‚ å½“è®¢è´­æœåŠ¡å°†è®¢è´­ç›®çš„åœ°åˆ†é…åˆ°è¾“å‡ºé€šé“ï¼Œå°†è®¢è´­ç›®çš„åœ°åˆ†é…ç»™è¾“å…¥é€šé“æ—¶ï¼Œå¸æˆ·æœåŠ¡å’Œäº§å“æœåŠ¡åˆ™ç›¸åã€‚ è¿™æ˜¯åˆä¹é€»è¾‘çš„ï¼Œå› ä¸ºè®¢è´­æœåŠ¡é€šè¿‡å…¶è¾“å‡ºç›®çš„åœ°å‘é€çš„æ¶ˆæ¯æ˜¯ç”±æ¶ˆè´¹æœåŠ¡é€šè¿‡å…¶è¾“å…¥ç›®çš„åœ°æ¥æ”¶çš„ã€‚ ä½†æ˜¯ï¼Œå®ƒä»ç„¶æ˜¯å…±äº«ç»çºªäººäº¤æ˜“æ‰€çš„ç›¸åŒç›®çš„åœ°ã€‚ è¿™æ˜¯è®¢è´­æœåŠ¡çš„é…ç½®è®¾ç½®ã€‚</p><pre>spring: cloud: stream: bindings: output: destination: orders-out input: destination: orders-in rabbit: bindings: input: consumer: exchangeType: direct</pre><pre>spring: cloud: stream: bindings: output: destination: orders-in input: destination: orders-out rabbit: bindings: output: producer: exchangeType: direct routingKeyExpression: '"#"'</pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦è¿è¡Œæ¯ä¸ªå¾®æœåŠ¡çš„å•ä¸ªå®ä¾‹ã€‚ æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œæ¨¡å—è®¢è´­æœåŠ¡å†…éƒ¨æºä»£ç å­˜å‚¨åº“ä¸­æä¾›çš„JUnitæµ‹è¯•ç±»OrderControllerTestè½»æ¾ç”Ÿæˆä¸€äº›æµ‹è¯•è¯·æ±‚ã€‚</p><h1><strong>è‡ªåŠ¨åŒ–æµ‹è¯•</strong></h1><p>æ‚¨å¯ä»¥è½»æ¾æµ‹è¯•æ‚¨çš„å¾®æœåŠ¡ï¼Œè€Œæ— éœ€è¿æ¥åˆ°æ¶ˆæ¯ä»£ç†ã€‚ ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦åœ¨é¡¹ç›®ä¾èµ–é¡¹ä¸­åŒ…å«spring-cloud-stream-test-supportã€‚ å®ƒåŒ…å«TestSupportBinder beanï¼Œä½¿ç”¨å®ƒå¯ä»¥ä¸ç»‘å®šçš„é€šé“è¿›è¡Œäº¤äº’ï¼Œå¹¶æ£€æŸ¥åº”ç”¨ç¨‹åºå‘é€å’Œæ¥æ”¶çš„æ‰€æœ‰æ¶ˆæ¯ã€‚</p><pre>&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-stream-test-support&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;</pre><p>åœ¨æµ‹è¯•ç±»ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜MessageCollector beanï¼Œè¯¥beanè´Ÿè´£æ¥æ”¶TestSupportBinderä¿ç•™çš„æ¶ˆæ¯ã€‚ è¿™æ˜¯æˆ‘çš„å¸æˆ·æœåŠ¡æµ‹è¯•è¯¾ç¨‹ã€‚ ä½¿ç”¨å¤„ç†å™¨beanï¼Œæˆ‘å°†æµ‹è¯•å‘½ä»¤å‘é€åˆ°è¾“å…¥é€šé“ã€‚ ç„¶åï¼ŒMessageCollectoræ¥æ”¶é€šè¿‡è¾“å‡ºé€šé“å‘é€å›è®¢å•æœåŠ¡çš„æ¶ˆæ¯ã€‚ æµ‹è¯•æ–¹æ³•testAcceptedåˆ›å»ºä¸€ä¸ªåº”ç”±å¸æˆ·æœåŠ¡æ¥å—çš„è®¢å•ï¼Œè€ŒtestRejectedæ–¹æ³•è®¾ç½®çš„è®¢å•ä»·æ ¼è¿‡é«˜ï¼Œå¯¼è‡´æ‹’ç»è¯¥è®¢å•ã€‚</p><pre>@RunWith(SpringRunner.class)@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)public class OrderReceiverTest { private static final Logger LOGGER = LoggerFactory.getLogger(OrderReceiverTest.class); @Autowired private Processor processor; @Autowired private MessageCollector messageCollector; @Test @SuppressWarnings("unchecked") public void testAccepted() { Order o = new Order(); o.setId(1 L); o.setAccountId(1 L); o.setCustomerId(1 L); o.setPrice(500); o.setProductIds(Collections.singletonList(2 L)); processor.input().send(MessageBuilder.withPayload(o).build()); Message received = (Message) messageCollector.forChannel(processor.output()).poll(); LOGGER.info("Order response received: {}", received.getPayload()); assertNotNull(received.getPayload()); assertEquals(OrderStatus.ACCEPTED, received.getPayload().getStatus()); } @Test @SuppressWarnings("unchecked") public void testRejected() { Order o = new Order(); o.setId(1 L); o.setAccountId(1 L); o.setCustomerId(1 L); o.setPrice(100000); o.setProductIds(Collections.singletonList(2 L)); processor.input().send(MessageBuilder.withPayload(o).build()); Message received = (Message) messageCollector.forChannel(processor.output()).poll(); LOGGER.info("Order response received: {}", received.getPayload()); assertNotNull(received.getPayload()); assertEquals(OrderStatus.REJECTED, received.getPayload().getStatus()); }}</pre><h1><strong>ç»“è®º</strong></h1><p>æ¯å½“æ‚¨ä¸éœ€è¦APIçš„åŒæ­¥å“åº”æ—¶ï¼Œæ¶ˆæ¯é©±åŠ¨çš„å¾®æœåŠ¡å°±æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ å¾®æœåŠ¡ä¹‹é—´çš„æœåŠ¡é—´é€šä¿¡é‡‡ç”¨å‘å¸ƒ/è®¢é˜…æ¨¡å‹ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Spring','Cloud','Stream'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>