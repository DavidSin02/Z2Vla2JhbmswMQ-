<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Android Notification é€šçŸ¥å­¦ä¹ è¯¦ç»†ç¬”è®° | æå®¢å¿«è¨Š</title><meta property="og:title" content="Android Notification é€šçŸ¥å­¦ä¹ è¯¦ç»†ç¬”è®° - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/1537157071419b1605a9208"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4bc4df7.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4bc4df7.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4bc4df7.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4bc4df7.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4bc4df7.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4bc4df7.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4bc4df7.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4bc4df7.html><meta property="article:published_time" content="2020-10-29T21:08:29+08:00"><meta property="article:modified_time" content="2020-10-29T21:08:29+08:00"><meta name=Keywords content><meta name=description content="Android Notification é€šçŸ¥å­¦ä¹ è¯¦ç»†ç¬”è®°"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/4bc4df7.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Android Notification é€šçŸ¥å­¦ä¹ è¯¦ç»†ç¬”è®°</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><p>é€šçŸ¥æ é€šçŸ¥åœ¨Android APPä¸­çš„ä½¿ç”¨æä¸ºé¢‘ç¹ï¼Œæ¯”å¦‚çŸ­ä¿¡é€šçŸ¥ï¼ŒQQï¼Œå¾®ä¿¡æ¶ˆæ¯é€šçŸ¥ï¼ŒApp æ›´æ–°è¿›åº¦è½¬æ€æ˜¾ç¤ºï¼Œæˆªå›¾æ—¶åå›¾ç‰‡è¿›è¡Œåˆ é™¤æˆ–åˆ†äº«ï¼ŒæŸ¥çœ‹æ“ä½œç­‰ç­‰ã€‚æœ¬ç¯‡æ–‡ç« è®°å½•äº†å¦‚ä½•ä½¿ç”¨ Notification æ˜¾ç¤ºæ¶ˆæ¯, è®¾ç½®æç¤ºéŸ³ï¼Œå‘¼å¸ç¯ï¼Œéœ‡åŠ¨ï¼Œä»¥åŠå“åº”ç”¨æˆ·å¯¹æ¶ˆæ¯çš„å¤„ç†åŠ¨ä½œã€‚</p><h1>Notification çŠ¶æ€æ é€šçŸ¥</h1><ul><li>å»ºé€ è€…æ¨¡å¼æ„å»ºé€šçŸ¥ç±»ï¼š Notification.Builder</li><li>é€šçŸ¥ç®¡ç†å™¨(ç”¨äºå‘å‡ºé€šçŸ¥)ï¼š NotificationManager</li><li>é€šçŸ¥é€šé“(API 26æ–°å¢ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©æ€§å±è”½é€šçŸ¥)ï¼šNotificationChannel</li><li>é€šçŸ¥åŠ¨ä½œ(ç”¨æˆ·ç‚¹å‡»æ»‘åŠ¨é€šçŸ¥ç­‰)ï¼šPaddingIntent</li></ul><p><strong>å‘é€é€šçŸ¥çš„æ­¥éª¤</strong></p><ol><li>è·å– NotificationManager</li><li>åˆ›å»º Notification</li><li>ç»™ Notification è®¾ç½®å‚æ•°</li><li>ä½¿ç”¨ NotificationManager å‘é€é€šçŸ¥</li></ol><p><strong>Android 7.0 æ–°å†…å®¹</strong></p><p>Notification.Builder.serPriority: è®¾ç½®é€šçŸ¥ä¼˜å…ˆçº§ Notification.Builder.setStyle: è®¾ç½®é€šçŸ¥æ‰©å±•å¸ƒå±€ MessagingStyle: å¿«é€Ÿå›å¤</p><p><strong>Android 8.0 æ–°å†…å®¹</strong></p><p>NotificationChannelï¼šç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰é€šçŸ¥çš„æ˜¾ç¤ºï¼Œä»¥åŠå…³é—­æŸä¸ªé€šçŸ¥çš„æç¤ºéŸ³éœ‡åŠ¨ç­‰</p><h1>æ„å»ºä¸€ä¸ªæœ€ç®€å•çš„ Notification</h1><p>ä¸€ä¸ªç®€å•çš„é€šçŸ¥åŒ…å«ï¼Œä¸€ä¸ªå°å›¾æ ‡ï¼Œä¸€ä¸ªæ ‡é¢˜å’Œå†…å®¹å¦‚å›¾ï¼š</p><div class=pgc-img><img alt="Android Notification é€šçŸ¥å­¦ä¹ è¯¦ç»†ç¬”è®°" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1537157071419b1605a9208><p class=pgc-img-caption></p></div><p>ä»£ç </p><pre>// è·å–ç³»ç»Ÿ é€šçŸ¥ç®¡ç† æœåŠ¡NotificationManager notificationManager = (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);// æ„å»º NotificationNotification.Builder builder = new Notification.Builder(this);builder.setContentTitle("ContentTitle") .setSmallIcon(R.drawable.ic_launcher_background) .setContentText("Content Text Here");// å…¼å®¹ API 26ï¼ŒAndroid 8.0if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O){ // ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºé€šçŸ¥çš„é‡è¦ç¨‹åº¦ï¼Œé»˜è®¤åˆ™åªåœ¨é€šçŸ¥æ é—ªçƒä¸€ä¸‹ NotificationChannel notificationChannel = new NotificationChannel("AppTestNotificationId", "AppTestNotificationName", NotificationManager.IMPORTANCE_DEFAULT); // æ³¨å†Œé€šé“ï¼Œæ³¨å†Œåé™¤éå¸è½½å†å®‰è£…å¦åˆ™ä¸æ”¹å˜ notificationManager.createNotificationChannel(notificationChannel); builder.setChannelId("AppTestNotificationId");}// å‘å‡ºé€šçŸ¥notificationManager.notify(1, builder.build());</pre><h1>æ§åˆ¶ Notification çš„éœ‡åŠ¨ï¼Œå‘¼å¸ç¯ã€æç¤ºéŸ³ä»¥åŠå¦‚ä½•æ˜¾ç¤º</h1><p>æ„å»º Notification ä»£ç </p><pre>// æ„å»º NotificationNotification.Builder builder = new Notification.Builder(this);builder.setContentTitle("ContentTitle") .setSmallIcon(R.drawable.ic_launcher_background) .setContentText("Content Text Here") .setDefaults(Notification.DEFAULT_ALL);</pre><p>è¿™é‡Œå…³é”®çš„åœ¨äº SetDefaults è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª intï¼Œå¯é€‰å€¼å¦‚ä¸‹ï¼š</p><ul><li>Notification.DEFAULT_VIBRATE ï¼šéœ‡åŠ¨æç¤º</li><li>Notification.DEFAULT_SOUNDï¼šæç¤ºéŸ³</li><li>Notification.DEFAULT_LIGHTSï¼šä¸‰è‰²ç¯</li><li>Notification.DEFAULT_ALLï¼šä»¥ä¸Šä¸‰ç§å…¨éƒ¨</li></ul><p>æ§åˆ¶éœ‡åŠ¨æ—¶é•¿</p><p>setVibrate æ¥æ”¶ä¸€ä¸ªlong[], ä¸‹æ ‡ä¸ºå¥‡æ•°ä¸ºå»¶æ—¶ï¼Œå¶æ•°ä¸ºéœ‡åŠ¨æ—¶é•¿ï¼Œæœ¬ä¾‹ä¸­ä¸ºï¼Œå»¶æ—¶0ms,éœ‡åŠ¨300ms,å»¶æ—¶200ms,éœ‡åŠ¨300</p><pre>builder.setVibrate(new long[]{0, 300, 200, 300});// Android 8.0 éœ€ç”¨ä»¥ä¸‹æ–¹æ³•// notificationChannel.enableVibration(true);// notificationChannel.setVibrationPattern(new long[]{0,300,300,500,300,800});</pre><p>æ§åˆ¶ç¯é¢œè‰²</p><p>ä¸‰ä¸ªå‚æ•°ä¾æ¬¡æ˜¯ int ARGB é¢œè‰²å€¼ã€äº®çš„æ—¶é•¿ã€ä¸äº®çš„æ—¶é•¿ã€‚</p><pre>builder.setLights(0xFFFF0000, 1000,1000);// Android 8.0 éœ€ç”¨ä»¥ä¸‹æ–¹æ³•ï¼Œä¸å¯è®¾ç½®æ—¶é•¿// notificationChannel.enableLights(true);// notificationChannel.setLightColor(0xFFFF0000);</pre><p>æ§åˆ¶å£°éŸ³</p><pre>builder.setSound(Uri.parse("android.resource://" + getPackageName() + "/" + R.raw.a))// Android 8.0 éœ€ç”¨ä»¥ä¸‹æ–¹æ³•ï¼Œ è¿™é‡Œç”¨çš„æ˜¯åŠ è½½res/rawçš„å£°éŸ³èµ„æº// notificationChannel.setSound(Uri.parse("android.resource://" + getPackageName() + "/" + R.raw.a), null);</pre><p>åœ¨é”å±ä¸Šçš„æ˜¾ç¤ºæ–¹å¼</p><p>è¿™ä¸ªæ–¹æ³•éœ€è¦ä½¿ç”¨é”å±å¹¶åœ¨è®¾ç½®ä¸­éšè—æ•æ„Ÿä¿¡æ¯æ‰èƒ½ç”Ÿæ•ˆ</p><pre>builder.setVisibility(Notification.VISIBILITY_PUBLIC);// Android 8.0 éœ€ç”¨ä¸€ä¸‹æ–¹æ³•// notificationChannel.setLockscreenVisibility(Notification.VISIBILITY_PUBLIC);</pre><p>è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸€ä¸ª int</p><ul><li>Notification.VISIBILITY_PUBLIC æ˜¾ç¤ºæ‰€æœ‰é€šçŸ¥å†…å®¹</li><li>Notification.VISIBILITY_PRIVATE åªæ˜¾ç¤ºæ ‡é¢˜</li><li>Notification.VISIBILITY_SECRET ä¸æ˜¾ç¤ºä»»ä½•å†…å®¹</li></ul><p>å¦‚ä½•å–æ¶ˆé€šçŸ¥</p><ol><li>ç”¨æˆ·æ¸…é™¤</li><li>setAutoCancel()ï¼Œç‚¹å‡»é€šçŸ¥ä¼šæ¸…é™¤</li><li>NotificationManager.cancel(int id)</li><li>NotificationManager.cancel(String tag, int id)</li><li>NotificationManager.cancelAll() æ¸…é™¤æ‰€æœ‰è¯¥åº”ç”¨çš„é€šçŸ¥</li></ol><p>å…¶ä»–</p><p><strong>æŒç»­çš„é€šçŸ¥</strong></p><p>å¦‚æ’­æ”¾éŸ³ä¹ï¼Œåå°ä»»åŠ¡ï¼Œä¸‹è½½, å½“è¿™ä¸ªæ–¹æ³•ä¼ å…¥ true æ—¶ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªæŒç»­çš„é€šçŸ¥ï¼Œç”¨æˆ·æ— æ³•åˆ é™¤å®ƒï¼Œåªèƒ½åœ¨ä»£ç ä¸­è®©é€šçŸ¥æ¶ˆå¤±ã€‚</p><pre>builder.setOngoing(true);</pre><p><strong>æ˜¾ç¤ºè¿›åº¦æ¡</strong></p><p>åœ¨åå°å¤„ç†æŸä¸ªè€—æ—¶ä»»åŠ¡æ—¶éœ€è¦ä½¿ç”¨åˆ°è¿›åº¦æ¡, å‚æ•°ä½œç”¨ä¾æ¬¡æ˜¯ è¿›åº¦æ¡æœ€å¤§å€¼ã€å½“å‰è¿›åº¦ã€è¿›åº¦æ˜¯å¦ç¡®å®šï¼Œindeterminate è¡¨ç¤ºä»»åŠ¡çš„è¿›åº¦æ˜¯å¦å¯ä»¥å‡†ç¡®è·å–</p><pre>builder.setProgress(int max, int progress, boolean indeterminate);</pre><p><strong>å¦‚ä½•æ›´æ–°é€šçŸ¥</strong></p><p>åªéœ€åœ¨å‘å‡ºé€šçŸ¥æ—¶ä½¿ç”¨ç›¸åŒçš„ id å³å¯æ›´æ–°ï¼Œå¦‚æœè¿™æ¡é€šçŸ¥å·²è¢«ç§»é™¤åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„é€šçŸ¥</p><pre>notificationManager.notify(int id, Notification.Builder);</pre><h1>å¦‚ä½•å“åº”ç”¨æˆ·åŠ¨ä½œ</h1><p>ç»™ Notification è®¾ç½® PendingIntent ç”¨äºå“åº”ç‚¹å‡»ã€æ¸…é™¤åŠ¨ä½œ</p><p>PendingIntent æ˜¯ä¸€ç§ç‰¹æ®Šçš„ Intentï¼Œ ä½œç”¨å’Œ Intent ä¸€æ ·æ˜¯ç”¨äºå¯åŠ¨ä¸€ä¸ª Activityæˆ–è€…Serviceï¼Œæˆ–å‘é€ä¸€æ¡ Broadcastã€‚é€šçŸ¥å“åº”ç”¨æˆ·åŠ¨ä½œä¾¿æ˜¯ç”¨è¿™ä¸ªï¼Œ å½“å¯¹é€šçŸ¥åšå‡ºä¸€ä¸ªåŠ¨ä½œåï¼Œç³»ç»Ÿä¾¿ä¼šè°ƒç”¨ PendingIntentï¼Œå¯åŠ¨ä¸€ä¸ªæ´»åŠ¨ï¼ŒæœåŠ¡æˆ–å¹¿æ’­ï¼Œè¿™å–å†³äºä½ è·å–çš„æ˜¯é‚£ç§ PendingIntentã€‚</p><p>åœ¨ PendingIntent ä¸­ä¼ å…¥çš„ Context é”€æ¯ä»¥åï¼ŒPendingIntent ä¾æ—§æœ‰æ•ˆï¼Œå®ƒä¸€èˆ¬ä½¿ç”¨åœ¨å½“ Context é”€æ¯åéœ€è¦æ‰§è¡Œ Intentçš„åœ°æ–¹ï¼Œä¸€èˆ¬ä¸æ˜¯ç”¨äºç«‹å³æ‰§è¡Œçš„æ—¶å€™ï¼Œæ¯”å¦‚åœ¨ç‚¹å‡»é€šçŸ¥åå”¤é†’ä¸€ä¸ª Activityã€‚ã€‚</p><p>è·å– PendingIntent</p><pre>// è·å–ç”¨äºå¯åŠ¨ Activity PendingIntent.getActivity(Context context, int requestCode, Intent intent, int flags);// è·å–ç”¨äºå‘é€ BroadcastPendingIntent.getBroadcast(Context context, int requestCode, Intent intent, int flags);// è·å–ç”¨äºå¯åŠ¨æœåŠ¡PendingIntent.getService(Context context, int requestCode, Intent intent, int flags);PendingIntent.getActivities(Context context, int reqeustCode, Intent[] intents, int flags);PendingIntent.getForgroundService(Context, int reqeustCode, Intent intent, int flags)</pre><p>å„ä¸ªå‚æ•°çš„ç”¨é€”åˆ†åˆ«å¦‚ä¸‹</p><ul><li>context, å½“å‰ä¸Šä¸‹æ–‡</li><li>requestCode, è¯·æ±‚æ ‡è¯†ï¼Œå¦‚æœå¤šæ¬¡è·å–æ—¶è¿™ä¸ªå€¼ç›¸åŒï¼Œåˆ™è¿”å›çš„ç»“æœä¸ flags å‚æ•°ç›¸å…³</li><li>intent, è¯·æ±‚æ„å›¾</li><li>flags, æ§åˆ¶è·å– PendingIntent çš„æ–¹å¼ï¼Œå¯é€‰å€¼å¦‚ä¸‹</li><li class=ql-indent-1>PendingIntent.FLAG_CANCEL_CURRENTï¼Œå¦‚æœå½“å‰å·²å­˜åœ¨åˆ™å–æ¶ˆå½“å‰çš„å¹¶è¿”å›ä¸€ä¸ªæ–°çš„ PendingIntent</li><li class=ql-indent-1>PendingIntent.FLAG_UPDATE_CURRENTï¼Œå¦‚æœå·²å­˜åœ¨åˆ™æ›´æ–°ä¹‹å‰çš„</li><li class=ql-indent-1>PendingIntent.FLAG_NO_CREATEï¼Œå¦‚æœå·²å­˜åœ¨åˆ™è¿”å›å½“å‰å­˜åœ¨çš„ï¼Œå¦åˆ™è¿”å› null</li><li class=ql-indent-1>PendingIntent.FLAG_ONE_SHOTï¼Œè¡¨æ˜è¿™ä¸ª PendingIntent åªèƒ½ç”¨ä¸€æ¬¡ï¼Œè§¦å‘ä¸€æ¬¡åè‡ªåŠ¨ cancel</li><li class=ql-indent-1>PendingIntent.FLAG_IMMUTABLEï¼Œè¡¨æ˜è¿™ä¸ªPendingIntent ä¸å¯å˜</li></ul><p>å…¶ä¸­ï¼ŒrequestCode å’Œ flags æ˜¯ç›¸å…³è”çš„ï¼Œå¦‚æœå¤šæ¬¡è·å– PendingIntent æ—¶ requestCode ç›¸åŒï¼Œæ­¤æ—¶è¿”å›çš„ç»“æœå°±éœ€è¦å‚è€ƒ flags çš„å€¼ã€‚ä¾‹å¦‚</p><pre> Intent intent1 = new Intent("NotificationAction"); intent1.putExtra("A", "value AA"); intent1.putExtra("B", "value BB"); Intent intent11 = new Intent("NotificationAction"); intent11.putExtra("B", "BBB"); PendingIntent pendingIntent = PendingIntent.getBroadcast(this, 1, intent1, PendingIntent.FLAG_CANCEL_CURRENT); PendingIntent pendingIntent11 = PendingIntent.getBroadcast(this, 1, intent11, PendingIntent.FLAG_UPDATE_CURRENT);</pre><p>è¿™ä¸¤ä¸ª PendingIntent çš„ requestCode æ˜¯ç›¸åŒçš„ï¼Œç¬¬äºŒä¸ªè·å–æ—¶ä¼ å…¥çš„ flags ä¸º PendingIntent.FLAG_UPDATE_CURRENT ï¼Œè¡¨ç¤ºå­˜åœ¨ requestCode ä¸º 1ï¼Œçš„PendingIntentåˆ™æ›´æ–°è¿™ä¸ªPendingIntent çš„ Intent å€¼ï¼Œæ­¤æ—¶ getStringExtr("A") çš„å€¼ä¸º nullï¼ŒgetStringExtra("B"), çš„å€¼ä¸º BBBã€‚</p><p>å½“æˆ‘ä»¬è·å–äº† PendingIntent ä¹‹åï¼Œåªéœ€è¦ç»™ builder çš„ç‰¹å®šæ–¹æ³•ä¼ å…¥å°±å¯ä»¥å“åº”ç‚¹å‡»ã€æ¸…é™¤åŠ¨ä½œäº†</p><p>è®¾ç½®ç‚¹å‡»ï¼Œæ¸…é™¤ PendingIntent ä»£ç ï¼š</p><pre>builder.setContentIntent(PendingIntent intent);builder.setDeleteIntent(PendingIntent intent);</pre><p>æ·»åŠ å‡ ä¸ªç®€å•çš„æŒ‰é’®</p><p>åœ¨éœ€è¦å¯¹é€šçŸ¥å†…å®¹è¿›è¡Œç®€å•æ“ä½œçš„æ—¶å€™ï¼Œæ¯”å¦‚çŸ­ä¿¡çš„â€˜æ ‡è®°ä¸ºå·²è¯»â€™ï¼Œâ€˜åˆ é™¤â€™ã€‚æˆ‘ä»¬å¯ä»¥å¯¹æŒ‰é’®è®¾ç½®å›¾æ ‡ã€æ ‡é¢˜ä»¥åŠè®¾ç½® PendingIntent ä»¥ä¾¿å“åº”åŠ¨ä½œã€‚è¿™ç§æŒ‰é’®æœ€å¤šå¯ä»¥æ·»åŠ ä¸‰ä¸ªï¼ŒæŒ‰æ·»åŠ çš„é¡ºåºä»å·¦å¾€å³ä¾æ¬¡æ’åˆ—ã€‚<strong>api 23 ä¹‹åå›¾æ ‡ä¸æ˜¾ç¤º</strong></p><pre>Intent intent2 = new Intent("NotificationAction");intent2.putExtra("A", "Action button1 clicked");PendingIntent pendingIntent1 = PendingIntent.getBroadcast(this, 3, intent2, PendingIntent.FLAG_UPDATE_CURRENT);otification.Action.Builder actionBuilder = new Notification.Action.Builder(Icon.createWithResource(getApplicationContext(), R.drawable.ic_launcher_background), "Action1", pendingIntent1);builder.addAction(actionBuilder.build());</pre><p>ç»“æœå¦‚å›¾ï¼Œç‚¹å‡» Action1 æŒ‰é’®åå°†å‘å‡ºä¸€æ¡å¹¿æ’­</p><div class=pgc-img><img alt="Android Notification é€šçŸ¥å­¦ä¹ è¯¦ç»†ç¬”è®°" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1537157071995497d637ba2><p class=pgc-img-caption></p></div><h1>è¶…é•¿å†…å®¹çš„ Notification, å„ç§ Style</h1><p>è¶…é•¿å†…å®¹çš„ Notificationï¼Œæ¯”å¦‚å†…å®¹ä¸ºæ–‡å­—å¾ˆå¤šï¼Œæˆ–è€…ä¸€ä¸ªå¤§å›¾ç‰‡ï¼Œä¸€ä¸ªè‡ªå®šä¹‰çš„ Viewï¼Œé€šè¿‡ builder.setStyle(Style style) è¿™ä¸ªæ–¹æ³•è®¾ç½®ã€‚è®¾ç½® style ä¹‹åï¼Œä¹‹å‰çš„ setContent è®¾ç½®çš„å†…å®¹å°†ä¼šå¤±æ•ˆã€‚å„ç§ style çš„é«˜åº¦æœ€å¤§ä¸º 256 dpã€‚</p><p>BigTextStyleï¼Œè¶…é•¿æ–‡æœ¬</p><pre>Notification.BigTextStyle bigTextStyle = new Notification.BigTextStyle().bigText( "This is big text notification. This is big text notification. " + "This is big text notification. This is big text notification. " + "This is big text notification. This is big text notification. " + "This is big text notification. This is big text notification. " + "This is big text notification. This is big text notification. " + "This is big text notification. This is big text notification. " + "This is big text notification. This is big text notification. " + "This is big text notification. This is big text notification. " + "This is big text notification. This is big text notification. ");builder.setStyle(bigTextStyle);</pre><p>InboxStyleï¼Œåˆ—è¡¨</p><p>inboxstyle æ˜¾ç¤ºä¸ºä¸€ä¸ªæ–‡å­—åˆ—è¡¨ï¼Œæ˜¾ç¤º addline çš„é¡ºåºçš„æ–‡å­—ï¼Œæœ€å¤šæ”¯æŒå…­è¡Œã€‚</p><pre>Notification.InboxStyle inboxStyle = new Notification.InboxStyle();// æ·»åŠ è¡ŒinboxStyle.addLine("First line.");inboxStyle.addLine("Second line");inboxStyle.addLine("Third line");inboxStyle.addLine("Last line");// è®¾ç½®æ ‡é¢˜ä»¥åŠç®€ä»‹æ–‡å­—inboxStyle.setBigContentTitle("ContentTitle");inboxStyle.setSummaryText("SummaryText");builder.setStyle(inboxStyle);</pre><p>BigPictureStyle, å¤§å›¾ç‰‡</p><pre>// æ„å»ºä¸€ä¸ª StyleNotification.BigPictureStyle bigPictureStyle =  new Notification.BigPictureStyle().bigPicture(BitmapFactory.decodeResource(getResources(),R.drawable.big));// è®¾ç½®æ ‡é¢˜bigPictureStyle.setBigContentTitle("ContentTitle");// è®¾ç½®å‰¯æ ‡é¢˜ï¼Œç®€ä»‹æ–‡å­—bigPictureStyle.setSummaryText("SummaryText");// è®¾ç½®å¤§å›¾æ ‡bigPictureStyle.bigLargeIcon(BitmapFactory.decodeResource(getResources(), R.drawable.big));builder.setStyle(bigPictureStyle);</pre><p>MediaStyle</p><p>ç•¥</p><h1>å¿«é€Ÿå›å¤ MessageNotification</h1><p>æœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹é€šçŸ¥å†…å®¹è¿›è¡Œå¿«é€Ÿå›å¤ï¼Œæ¯”å¦‚æ”¶åˆ°ä¸€æ¡é‚®ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿå›å¤ã€‚å½“ç‚¹å‡»é€šçŸ¥çš„ä¸€ä¸ª Action æŒ‰é’®åå°†ä¼šå‡ºç°ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œå¯ä»¥è¿›è¡Œå‘é€æ¶ˆæ¯ã€‚æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ª MessageStyle å’Œ ä¸€ä¸ªå¸¦ RemoteInput çš„ Actionï¼Œè¿™ä¸ªé€šçŸ¥ä¾¿èƒ½æ”¯æŒå¿«é€Ÿå›å¤ã€‚<strong>è¿™ä¸ªåŠŸèƒ½éœ€è¦ api ç‰ˆæœ¬å¤§äº 24</strong></p><p>é¦–å…ˆï¼Œæ„å»ºä¸€ä¸ª MessageStyleï¼Œå¹¶è®¾ç½®å¥½</p><pre>Notification.MessagingStyle messagingStyle = new Notification .MessagingStyle("UserDisplayName"). addMessage("MessageStyle", 1000, "sender");builder.setStyle(messagingStyle);</pre><p>ç„¶åå†åˆ›å»ºä¸€ä¸ª Actionï¼ŒAction éœ€æ·»åŠ ä¸€ä¸ª RemoteInputï¼Œä¸€ä¸ªå“åº”å‘é€åŠ¨ä½œçš„ PendingIntentï¼Œè¿™ä¸ªä¾‹å­ä¸­ç‚¹å‡»å‘é€æŒ‰é’®åå°†å‘é€ä¸€æ¡å¹¿æ’­ã€‚</p><pre>Intent intent = new Intent("NotificationAction");PendingIntent pendingIntent = PendingIntent.getBroadcast(this, 11, intent, PendingIntent.FLAG_UPDATE_CURRENT);RemoteInput remoteInput = new RemoteInput .Builder("RemoteInputKey") .setLabel("RemoteInputLabel") .build();Notification.Action action = new Notification.Action .Builder(Icon.createWithResource(this, R.mipmap.ic_launcher_round), "ReplayAction", pendingIntent) .addRemoteInput(remoteInput) .build();// å‘é€è¯¥é€šçŸ¥notificationManager.notify(22, builder.build());</pre><p>æ¥å—è¾“å…¥æ•°æ®ç”¨çš„å¹¿æ’­ï¼Œæˆ‘ä»¬åœ¨è·å–åˆ°è¾“å…¥æ•°æ®åéœ€è¦æ‰‹åŠ¨å–æ¶ˆè¯¥é€šçŸ¥ï¼Œå¦åˆ™ä¸ä¼šè‡ªåŠ¨å–æ¶ˆã€‚</p><pre>class MBroadcast extends Broadcast{ [@Override](https://my.oschina.net/u/1162528) public void onReceive(Context context, Intent intent) { Bundle bundle = RemoteInput.getResultsFromIntent(intent); if (bundle != null){ String replayContent = bundle.getString("RemoteInputKey"); Log.d("MBroadcast", "onReceive: " + replayContent); // å–æ¶ˆè¯¥é€šçŸ¥ ((NotificationManager)getSystemService(Context.NOTIFICATION_SERVICE)).cancel(22); }  }}</pre><h1>ç»™ Notification æ·»åŠ ä¸€ä¸ª View æ‰©å±•è§†å›¾</h1><p>åœ¨é€šçŸ¥æ è¿›è¡Œå¯¹åå°ä»»åŠ¡çš„æ§åˆ¶çš„æ—¶å€™éœ€è¦ç”¨åˆ°è¿™ä¸ªåŠŸèƒ½ï¼Œ æ¯”å¦‚ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶æ—¶å¯ä»¥ å–æ¶ˆï¼Œæš‚åœï¼Œåå°æ’­æ”¾éŸ³ä¹æ—¶å¯ä»¥ åˆ‡æ¢æš‚åœå’Œæ˜¾ç¤ºæ­Œè¯ç­‰ã€‚é€šçŸ¥çš„è‡ªå®šä¹‰ view æœ€å¤§é«˜åº¦ä¸º 256 dpï¼Œä¸”åªæœ‰ <strong>Android N ä»¥ä¸Šç‰ˆæœ¬æ‰æ”¯æŒ</strong> è‡ªå®šä¹‰ viewã€‚</p><div class=pgc-img><img alt="Android Notification é€šçŸ¥å­¦ä¹ è¯¦ç»†ç¬”è®°" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1537157071418385a22e806><p class=pgc-img-caption></p></div><p>RemoteViews åªæ”¯æŒå‡ ä¸ª Viewï¼Œåœ¨è¿™é‡Œæˆ‘ä½¿ç”¨ ConstraintLayout ä½œä¸ºæ ¹ Layout çš„æ—¶å€™å‘ç°ä¼šå‡ºç° android.app.RemoteServiceException: Bad notification posted from package xxx è¿™ä¸ªé”™è¯¯ï¼Œæ¢äº† LinearLayout åå°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚æ”¯æŒçš„ View å¦‚ä¸‹</p><ul><li>Layout</li><li class=ql-indent-1>FrameLayout</li><li class=ql-indent-1>LinearLayout</li><li class=ql-indent-1>RelativeLayout</li><li class=ql-indent-1>GridLayout</li><li>View Buttonï¼ŒImageViewï¼ŒImageButtonï¼ŒTextViewï¼ŒProgressBarï¼ŒListViewï¼ŒGridViewï¼ŒStackViewï¼ŒViewStubï¼ŒAdapterViewFlipperï¼ŒViewFlipperï¼ŒAnalogClockï¼ŒChronometer</li></ul><p>é¦–å…ˆæ„å»ºä¸€ä¸ªé€šçŸ¥ï¼Œåˆ›å»ºä¸€ä¸ª RemoteViewsï¼ŒRemoteViews æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªåŒ…å« view æ‰€åœ¨çš„åŒ…åå’Œä¸€ä¸ª View èµ„æºã€‚RemoteViews æ„æ€å°±æ˜¯è¿œç¨‹ viewï¼Œè¯¥ view ä¸å­˜åœ¨ä¸ å½“å‰ Activityï¼Œè¿›ç¨‹ï¼Œé€šå¸¸ç”¨äºé€šçŸ¥ä¸­çš„è‡ªå®šä¹‰ view å’Œæ¡Œé¢å°éƒ¨ä»¶ã€‚</p><pre>Notification.Builder builder = new Notification.Builder(this) .setContentTitle("ContentTitle") .setTicker("ThisIsTicker") .setSmallIcon(R.drawable.ic_launcher_background) .setContentText("ContentText");RemoteViews remoteViews = new RemoteViews(getPackageName(), R.layout.notify_view);</pre><p>è¿™é‡Œçš„ notify_view å¾ˆç®€å•ï¼Œå¦‚ä¸‹</p><pre>&lt;LinearLayout ...&gt;  &lt;ImageView id="@+id/notify_iv" .../&gt; &lt;TextView id="@+id/notify_tv" .../&gt; &lt;Button id="@+id/notify_bt" .../&gt;&lt;/LinearLayout&gt;</pre><p>è®¾ç½® CustomContentView å’Œ Styleã€‚</p><pre>builder.setCustomContentView(remoteViews);Notification.DecoratedCustomViewStyle viewStyle = new Notification.DecoratedCustomViewStyle();builder.setStyle(viewStyle);</pre><p>å¦‚ä½•ç›‘å¬è‡ªå®šä¹‰ view RemoteViews ä¸­çš„ç‚¹å‡»äº‹ä»¶ï¼Œå’Œæ›´æ–° view</p><p>ç°åœ¨å·²ç»æ·»åŠ äº†ä¸€ä¸ª viewï¼Œå¦‚ä½•ä¿®æ”¹ view ä¸­çš„æ•°æ®ä»¥åŠå“åº” view çš„äº‹ä»¶å‘¢ï¼Ÿé€šè¿‡ RemoteViews.setOnClickPendingIntent(int r, PendingIntent intnet) è¿™ä¸ªæ–¹æ³•ä¸º ä¸€ä¸ª view ç»‘å®šä¸€ä¸ª PendingIntentï¼Œå½“ç‚¹å‡»äº†è¯¥view åä¾¿æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚</p><pre>Intent intent = new Intent("NotificationAction");intent.putExtra("action", "bt_click");PendingIntent pendingIntent = PendingIntent.getBroadcast(this, 12, intent, PendingIntent.FLAG_UPDATE_CURRENT);remoteViews.setOnClickPendingIntent(R.id.notify_bt, pendingIntent);</pre><p>æ›´æ–° RemoteView ä¸­çš„æ•°æ®ï¼Œæ›´æ–°ä¸€ä¸ª ImageViewä¸­çš„å›¾ç‰‡ï¼Œå¯¹å„ç§ view æ›´æ–°éƒ½æœ‰ç›¸åº”çš„æ–¹æ³•ã€‚</p><pre>remoteViews.setBitmap(R.id.notify_iv, "setImageBitmap", BitmapFactory.decodeResource(getResources(), R.drawable.me));</pre><p>ï¼ˆå®Œï¼‰</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Android','Notification','å­¦ä¹ '</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>