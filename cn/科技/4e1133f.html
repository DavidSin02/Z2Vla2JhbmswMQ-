<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>万字详文讲解视频和视频帧基础知识，关于视频和帧看这篇就够了 | 极客快訊</title><meta property="og:title" content="万字详文讲解视频和视频帧基础知识，关于视频和帧看这篇就够了 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/6cef7e799c9840bcaabf4c9eeae857ca"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4e1133f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4e1133f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4e1133f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4e1133f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4e1133f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4e1133f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4e1133f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4e1133f.html><meta property="article:published_time" content="2020-10-29T21:06:37+08:00"><meta property="article:modified_time" content="2020-10-29T21:06:37+08:00"><meta name=Keywords content><meta name=description content="万字详文讲解视频和视频帧基础知识，关于视频和帧看这篇就够了"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/4e1133f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>万字详文讲解视频和视频帧基础知识，关于视频和帧看这篇就够了</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>写在前面</h1><p>从18年12月接手在基于x86平台的边缘计算设备上进行取流解码的工作至今，已有数月。笔者还记得当初对流媒体、视频、帧、图像等概念完全云里雾里，慢慢跟着项目一步步学习走过来，受益良多，以这篇文章励志作为后续继续学习的里程碑吧！</p><p>本文将介绍的是：</p><ol start=1><li>视频的基础知识。包括：<strong>视频协议和格式</strong>、<strong>视频流</strong>。</li><li>视频帧的基础知识。包括：<strong>YUV帧格式</strong>、<strong>常见的帧名词（帧率fps、分辨率、码率）</strong>、<strong>“奇怪”的帧名词（1080p和1080i）</strong>、<strong>视频编解码而衍生的帧名词（GOP、I\B\P帧）</strong>。</li></ol><hr><h1 class=pgc-h-arrow-right><strong>修改记录</strong></h1><p>2019年4月8日首次完成该文章，内容包括：</p><ol start=1><li>视频协议、格式、播放原理等基础内容；</li><li>YUV格式、fps、分辨率、GOP和I/B/P帧等视频帧相关的基础知识；</li><li>提到了H264等视频压缩技术。</li></ol><p>2019年9月7日进行二次修改，修改内容如下：</p><ol start=1><li>第一章节增加视频流介绍，删除了播放原理介绍；</li><li>第二章增加了YUV采样和存储格式的示意图，场、1080p和1080i的介绍；删除了YUV的颜色值域（Color Range）介绍；</li><li>删除了原第三章的内容，这块会在后续中出专文介绍。</li></ol><hr><h1 class=pgc-h-arrow-right><strong>I. 视频的基础知识</strong></h1><p>相信所有人对视频一定不陌生，平时也一定经常在各大视频网站（如腾讯视频、哔哩哔哩）浏览，甚至偶尔也会把视频缓存到本地，保存成.mkv，.avi文件之类啦。前者是我们常说的『网络流媒体』，后者是『本地视频文件』。提到这里，两个问题来了：</p><ol start=1><li>本地视频文件常见有MP4、MKV、AVI等，这些都是什么？有什么区别？</li><li>在腾讯视频、哔哩哔哩网上看的视频，与本地播放的MP4、MKV、AVI文件，有什么区别？</li></ol><p>介绍第一个问题之前，必须引入一个名词『<strong>视频封装格式</strong>』，简称『<strong>视频格式</strong>』，也称为『<strong>容器</strong>』。有的说法还要区分是视频文件格式和视频封装格式，本文统一称『<strong>视频封装格式</strong>』。</p><h1 class=pgc-h-arrow-right><strong>视频格式</strong></h1><p><strong>问题1：本地视频文件常见有MP4、MKV、AVI等，这些都是什么？有什么区别？</strong></p><p>首先，MP4、AVI、MKV都是本地视频文件的后缀，在windows系统下，用于提示操作系统应该采用哪个应用程序打开。而在流媒体领域，这些都被称为『<strong>视频封装格式</strong>』，因为除了音视频流之外，它们还包含了一些辅助信息以及组织视音频的方式。不同格式的视频在不同平台上用户体验不同，很大原因在于对视音频的组织方式带来的差异。笔者以为百度百科上的解释蛮通俗易懂的（维基百科的说法不够直白）：</p><blockquote><p><span style="color:#646464;--tt-darkmode-color: #646464">视频格式是视频播放软件为了能够播放视频文件而赋予视频文件的一种识别符号。</span></p></blockquote><p>简言之，视频格式规定了和播放器的通信协议。</p><p>其次，笔者最近准备开始深入研究MP4、AVI、MKV等内部原理，主要是对视音频的组织方式，比如在播放视频的时候，我们可以选择国语、粤语、英语等各种语言，这就意味着这段视音频中包括了多个音频流。【给自己留个坑吧。】</p><p>最后，笔者推荐一篇非常棒的博客：视频文件格式知多少，汇总的非常全。</p><p><strong>问题1引申：对要做视音频处理的开发们来说，接触MP4、MKV、AVI等各种格式视音频文件时，有什么需要注意的吗？</strong></p><p>视音频处理可以延展出很多领域，包括解码、编码、过滤、增强处理等等。笔者目前只在解码领域探索，答案是：<strong>对于解码而言，没有区别</strong>。其他领域暂不清楚。</p><p>『视频封装格式』，是在编码的视音频基础上进行一次“包装”，添加与播放相关的协议数据（<em>这个是笔者的认知，如有表述不准确，欢迎批评指正</em>）。目前主流开源的框架，在“解包装”工作上做的已经非常成熟了，如<span style="background-color:#f6f6f6;--tt-darkmode-bgcolor: #1B1B1B">FFMpeg</span>，提供了用于打开视音频的API，开发人员无需关注具体视频格式，直接可以取出视音频流做处理。</p><p>接下来，介绍第二个问题，笔者再引入名词『<strong>视频协议</strong>』，也有说法认为『<strong>视频协议</strong>』也属于『<strong>视频封装格式</strong>』。</p><h1 class=pgc-h-arrow-right><strong>视频协议</strong></h1><p><strong>问题2：在腾讯视频、哔哩哔哩网上看的视频，与本地播放的MP4、MKV、AVI文件，有什么区别？</strong></p><p>『<strong>视频协议</strong>』是针对网络流媒体而言的，也就是只有在有网络时通过浏览器或者移动端APP才能看到的视频，目前常见的协议有RTSP、RTMP、HLS、HTTP等。笔者短暂地接触过GStreamer开发，在连接到RSTP视频时，发现除了视音频流和metadata之外，还携带了播放的信令。</p><p>也有文章会把『视频协议』归入『视频封装格式』。笔者看来，这么分类也有其道理：『视频协议』和『视频封装格式』都同时携带了视音频和metadata，以及协议/格式需要的其他信息。以<span style="background-color:#f6f6f6;--tt-darkmode-bgcolor: #1B1B1B">FFMpeg</span>为例，并不区分视频格式和视频协议；但是<span style="background-color:#f6f6f6;--tt-darkmode-bgcolor: #1B1B1B">GStreamer</span>的话，还是需要指定『视频协议』，但是不区分『视频封装格式』。</p><p>剥开『视频封装格式』和『视频协议』的外壳，接下来了解视音频流本身，这才是流媒体领域中真正的主角。本文仅介绍视频流。</p><h1 class=pgc-h-arrow-right><strong>视频流</strong></h1><p>就视频流而言，相信大家平时一定经常听到类似“h264码流”、“yuv流”、“编码流”、“解码流”，“原始流”、“裸流”，“压缩后的流”或者“未压缩的流”等等。归纳而言，提到『<strong>视频流</strong>』的时候，一定只有两种形式：</p><ul><li>经过压缩算法压缩的流数据，称为『<strong>编码流</strong>』，又因为目前压缩/编码算法以H264为主，因此也常常称为『<strong>H264码流</strong>』。</li><li>未经压缩的流数据，是解码后的流数据，称为『<strong>原始流</strong>』，可以想象视频是由一幅一幅在时间上连续的“图像”组成的，而因为视频内部的“图像”是『YUV』（后文将介绍），因此也常常称为『<strong>YUV流</strong>』。</li></ul><p>总结出现的名称，“h264码流”、“编码流”、“压缩后的流”是压缩/编码后的视频流；而“yuv流”、“解码流”、“未压缩的流”则是未经压缩/编码的视频流。“裸流”是一个具有歧义的词，是上下文内容，既可以是前者，也可以是后者。</p><p>因此，如果以后阅读任何流媒体相关的文章时，看到『<strong>视频流</strong>』都应该搞清楚，这究竟是编码/压缩的，还是没有。在生活中，接触到的视频文件绝大部分都是编码/压缩后的；在网络传输场景中，绝大部分也是编码/压缩后的。只有在视频播放时，观众观赏到的时一帧帧被『转码』为『RGB』的解码后视频流。</p><p>编码/压缩在流媒体领域是一项非常重要的技术：从『H264码流』到『YUV流』的过程称为<strong>解码</strong>，反之称为<strong>编码</strong>。</p><hr><h1 class=pgc-h-arrow-right><strong>II. 帧</strong></h1><p>流媒体领域，『<strong>流</strong>』很重要，『<strong>流</strong>』的基本元素『<strong>帧</strong>』同样重要。原因在于：对于<strong>视频编码/压缩</strong>而言，它的核心是采用尽量小的空间存储一组时间上连续的帧数据；而对于<strong>视频解码</strong>而言，就是把被编码/压缩后的一组帧数据尽量恢复成原来的样子。能够被100%恢复的编码/压缩算法称为<strong>无损压缩</strong>，反之称为<strong>有损压缩</strong>（虽然无损压缩是最理想的，但是在很多实际场景中为了追求高压缩率，比如为了减小网络带宽压力，常常不得不选择有损压缩）。由此可见，『<strong>帧</strong>』是视频流媒体领域的核心。接下来，一起来认识什么是『<strong>帧</strong>』。</p><p>『帧』，可以联想成我们平时看到的一幅幅“图像”，只不过我们平时接触的图片是『RGB』格式的，而视频帧通常是『YUV』格式的。既然提到了『RGB』和『YUV』，那么就来了解下帧的格式『YUV』，引出第一个问题：</p><p><strong>问题3：帧为什么采用『YUV』格式？『YUV』是什么？</strong></p><p>为此，笔者曾经花了很久去了解颜色空间、电视成像的发展史等，整理结论如下：</p><ol start=1><li><strong>在达到最大压缩率的情况下，能够保证对人眼感知的失真度最小。</strong>『YUV』的三通道中，其中"Y"表示明亮度（Lumina nce或Luma），也就是灰阶值；而"U"和"V"表示的则是色度（Chrominance或Chroma）。有一堆科学家研究发现，人眼对UV的敏感度最低，因此可以极大比例地压缩UV两个通道的数值。见视频编解码学习一 yuv格式。</li><li><strong>为了向前兼容黑白电视</strong>。这个就涉及历史原因了，笔者非常推荐零基础入门音视频开发。历史上在制定视频帧格式时，是有人提出过用RGB的，最终决定用YUV的真正原因其实是这个（见影像使用YUV格式，为什么不用RGB呢?。</li></ol><p>接下来解释『YUV』是什么，笔者以为，『YUV』是一种广义的概念，在视频领域，当提到『YUV』的时候，往往是以下几个意思：</p><ol start=1><li><strong>颜色空间</strong></li></ol><p>“Y”表示明亮度（Luminance、Luma），“U”和“V”则是色度（Chrominance）、浓度（Chroma）。这里表示的是<strong>色彩空间的基</strong>，即类似XYZ座标系的一种色标表示基准，也就是说每一种颜色可以通过三维向量&lt;y^i^,u^i^,v^i^>来表示。与其类似的还有RGB颜色空间、HSV颜色空间等。下图来自How does the YUV color coding work?</p><div class=pgc-img><img alt=万字详文讲解视频和视频帧基础知识，关于视频和帧看这篇就够了 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6cef7e799c9840bcaabf4c9eeae857ca><p class=pgc-img-caption>图1. YUV座标轴示意图</p></div><p>随着通信行业的发展，实际应用之多之复杂，导致『YUV』衍生出了一个大家族。接触视频领域的一定听说过<strong>YCbCr</strong>，甚至还有<strong>YPbPr</strong>、<strong>YIQ</strong>等。它们有的已经被时代淘汰，有的现在还在使用。之所以出现『YUV』大家族，完全是因为实际电路系统之间的差异，导致要从『YUV』转到『RGB』空间，实际对应的转化系数是有些许差异的，于是各个部门开始制定各种规范，才有了我们现在看到的『YUV』大家族。</p><p><strong>YCbCr</strong>是专门针对数字电路而诞生的；<strong>YPbPr</strong>则是模拟电路。但是，现在是数字时代，所以为了模拟电路而生的<strong>YPbPr</strong>已经逐渐被淘汰了，而<strong>YCbCr</strong>还一直发挥著作用。因此现在，<strong>YCbCr</strong>有时也会被简单地称为/认为『YUV』。</p><p><strong>2. 采样率</strong></p><p>读者可能听说过“<strong>YUV444</strong>”，“<strong>YUV422</strong>”，“<strong>YUV420</strong>”，到这里可能会纳闷：“YUV不是颜色空间吗？为什么后面还会跟着一串数字？” 因为当你看到YUV后面跟着一串数字的时候，『YUV』已经不再是颜色空间的基本含义了，而是意味着在原始『YUV流』上的采样。<br>在以前流媒体刚刚兴起时，还没有什么4G/5G，当时为了减小网络传输的带宽的压力，可谓做了种种努力。除了编码/压缩之外，YUV采样率也是一种。<br><strong>444</strong>，<strong>422</strong>和<strong>420</strong>是三种『YUV』（在数字电路中指代YCbCr）的采样，三位数分别代表Y\U\V（数字电路中为Y\Cb\Cr，本段后同）通道的抽样比。所以可以理解，<strong>444</strong>是全采样；而<strong>422</strong>是对Y进行全采样，对U\V分别进行1/2均匀采样。有趣的问题来了，<strong>420</strong>难道是完全丢弃了V通道/分量数据嘛？答案是否定的。<br>首先，必须要搞明白一个问题，一帧图像是由一个个像素组成的矩形，譬如4x4的尺寸的图像，就是由16个像素点组成的。在平时接触的『RGB』图像中，每个像素必然至少由R\G\B这三个通道组成的（有的图像还有\alpha分量），每个分量的取值一般都是[0,255]，也就是[2^0，2^8]，因此经常说一个像素占用3字节（如果还有其他分量，比如RGBA，就另当别论）。『YUV』图像同理，它的每个像素是由Y\U\V组成的。<br>接下来，从整张图像宏观考虑采样问题。还是以4X4的图像为例，<strong>444</strong>的如下图2-1，这个是形象化成图像的样子，实际在机器内存储并不是这样，具体可以参见博客《图像原始格式一探究竟》。<strong>422</strong>和<strong>420</strong>分别如下图2-2和2-3。</p><div class=pgc-img><img alt=万字详文讲解视频和视频帧基础知识，关于视频和帧看这篇就够了 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/7b69861186f345e6ac78955bf181e2f3><p class=pgc-img-caption>图2-1. YUV444采样示意图</p></div><p>​图2-1对应<strong>YUV444</strong>采样，即全采样，图示中可以看出每个像素中的Y\U\V通道都保留下来了，一般来说<strong>YUV444</strong>太大了，因此很少使用。</p><div class=pgc-img><img alt=万字详文讲解视频和视频帧基础知识，关于视频和帧看这篇就够了 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/f12b0c0fab0c4fd6824ed1f775ac7e11><p class=pgc-img-caption>​图2-2. YUV422采样示意图</p></div><p>图2-2对应<strong>YUV422</strong>采样，这种采样方式是：每个扫描线或者说每行相邻2个像素，只取1个像素的U\V分量。此外，可以计算出来，每个像素占用的大小为原来的2/3，因此说<strong>YUV422</strong>是<strong>YUV444</strong>的2/3大小。</p><p>这个时候就有一个问题，在『YUV』转『RGB』时，被抽走了U\V分量的像素要怎么办呢？<strong>做法很简单，就是相邻2个像素的Y分量公用保留着的U\V分量。</strong></p><div class=pgc-img><img alt=万字详文讲解视频和视频帧基础知识，关于视频和帧看这篇就够了 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/35f4ce5826794efba415a93d759707cc><p class=pgc-img-caption>​图2-2. YUV422采样示意图</p></div><p>图2-3对应<strong>YUV420</strong>采样，这种采样方式是：隔行进行<strong>YUV422</strong>每行采样的办法，即相邻2个像素只取1个像素的U\V分量；下一行丢弃所有的U\V分量。此外，可以计算出来，每个像素占用的大小为原来的1/2，因此说<strong>YUV420</strong>是<strong>YUV444</strong>的1/2大小。恢复U\V分量的办法同<strong>YUV422</strong>，只不过这里是2X2的矩阵共享保留着的U\V分量。</p><p>这种设计办法真的很巧妙！前文提到的<strong>"人眼对UV的敏感度最低，因此可以极大比例地压缩UV两个通道的数值"</strong>，且对于图像而言，相邻的区域像素的色彩、饱和度一般非常接近，因此这种以2X2矩阵为基本单位，只保留1组U\V分量合情合理。</p><p><strong>3. 编码/存储格式</strong></p><p>大家肯定还听说过<strong>YV12</strong>、<strong>YU12</strong>、<strong>NV12</strong>、<strong>NV21</strong>吧，看到这里是不是又纳闷：“后面的数字怎么变成2个了？而且前面的英文字母还变了？”<br>以上统称为『<strong>视频的存储格式</strong>』，也就是说，计算机是如何存储一帧视频的。<br>首先，『<strong>视频的存储格式</strong>』总分为两大类：『<strong>打包格式（packed）</strong>』和『<strong>平面格式（planar）</strong>』。前者又被称作『<strong>紧凑格式（packed）</strong>』。其实除此之外还有『<strong>半平面模式（Semi-Planar）</strong>』，估计是使用的比较少，因此在很多文章中常被忽略。<br>笔者很感兴趣，为什么会出现『<strong>打包格式</strong>』和『<strong>平面格式</strong>』两大派系，网上搜了很多资料也没找到原因，博客【音视频基础】：I420、YV12、NV12、NV21等常见的YUV420存储格式提到了需要约定存储格式，但也没提到为什么会分成这两种。要么就是派系之争，类似贝叶斯学派和频率学派；要么就是实际应用中逐渐衍生出这两大格式。时至今日，这两个格式还在被使用，因此对于多媒体开发者们都有必要了解。<br>『<strong>打包格式</strong>』是把Y\U\V分量交叉存储，『<strong>平面格式</strong>』则是把Y\U\V严格分开存储，『<strong>半平面模式</strong>』介于两者之间，Y分量分开存储，U\V交叉存储。<br>以下图为例说明『<strong>打包格式</strong>』、『<strong>平面格式</strong>』和『<strong>半平面模式</strong>』应该是非常清楚的，图摘自博客YUV格式初探：</p><p><br></p><div class=pgc-img><img alt=万字详文讲解视频和视频帧基础知识，关于视频和帧看这篇就够了 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/675407e1ef114e7eb40da9f094e0c553><p class=pgc-img-caption>​图3-1. YUV420P存储示意图</p></div><div class=pgc-img><img alt=万字详文讲解视频和视频帧基础知识，关于视频和帧看这篇就够了 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cd36cc3bb6b14035a743c9d7ba6e48b1><p class=pgc-img-caption>​图3-2. YUV420SP存储示意图</p></div><div class=pgc-img><img alt=万字详文讲解视频和视频帧基础知识，关于视频和帧看这篇就够了 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/70b8a16639a243c1ba4746d6a587af9c><p class=pgc-img-caption>​图3-3. YUV420Packet存储示意图</p></div><p>但是关于上图的『打包格式』，笔者是是有一点疑惑的，大多数的说法是”Y\U\V通道交叉存储，相邻的像素尽量打包在一起“，图3-3中U1后面跟着的是U2而不是V1，而且Y\U\V的排列方式似乎也不完全是交叉？笔者尝试在网上搜索『打包格式』更多的例子，没有找到特别好的资料，【这里给自己挖一个坑吧】。</p><p><br></p><p>接下来，我们继续了解一些帧相关的概念。</p><p><strong>常见的帧名词</strong></p><ol start=1><li><strong>帧率（FPS）</strong><br>『帧率』，FPS，全称Frames Per Second。指每秒传输的帧数，或者每秒显示的帧数，一般来说，『帧率』影响画面流畅度，且成正比：帧率越大，画面越流畅；帧率越小，画面越有跳动感。一个较权威的说法：<br>当视频帧率不低于24fps时，人眼才会觉得视频时连贯的，称为“视觉暂留”现象。<br>因此，才有说法：尽管『帧率』越高越流畅，但在很多实际应用场景中24fps就可以了。</li><li><strong>分辨率（Resolution）</strong><br>『分辨率』，也常被俗称为『图像的尺寸』或者『图像的大小』。指一帧图像包含的像素的多少，常见有1280x720（720P），1920X1080（1080P）等规格。『分辨率』影响图像大小，且与之成正比：『分辨率』越高，图像越大；反之，图像越小。</li><li><strong>码率（BPS）</strong><br>『码率』，BPS，全称Bits Per Second。指每秒传送的数据位数，常见单位KBPS（千位每秒）和MBPS（兆位每秒）。笔者认为这个概念真正要理解起来还是需要好好说明的，网上一说：“『码率』与体积成正比：码率越大，体积越大；码率越小，体积越小”；另一说：“『码率』越大，说明单位时间内取样率越大，数据流精度就越高，这样表现出来的的效果就是：视频画面更清晰画质更高”；还有说法是：”『码率』就是『失真度』“。但是笔者有一段时间就是不理解，每秒传输的数据越大，为什么必然就对应画面更清晰？还有体积怎么理解呢？且看下文”<strong>三者之间的关系</strong>“。</li></ol><p><strong>『帧率』『分辨率』和『码率』三者之间的关系</strong><br>最理想的情况是画面越清晰、越流畅是最好的。但在实际应用中，还需要结合硬件的处理能力、实际带宽条件选择。高『帧率』高『分辨率』，也就意味着高『码率』，也意味着需要高带宽和强大的硬件能力进行编解码和图像处理。所以『帧率』和『分辨率』应该视情况而定。<br>要说三者之间的关系，其实就是对于『码率』的理解。在<strong>码率（BPS）</strong>概念中提到了几段摘自网上的说法，说的都太模糊了，笔者直到阅读了文章Video Bitrate Vs. Frame Rate，才真的理解了『码率』。<br>首先，这些说法都没有交代一个前提：<strong>『帧率』、『分辨率』和『压缩率』都会影响『码率』</strong>。Video Bitrate Vs. Frame Rate](https://www.techwalla.com/articles/video-bitrate-vs-frame-rate)文章在一开始就明确指出：</p><blockquote><p><span style="color:#646464;--tt-darkmode-color: #646464">Bitrate serves as a more general indicator of quality, with higher resolutions, higher frame rates and lower compression all leading to an increased bitrate.<br>『码率』是更广泛的（视频）质量指标：更高的『分辨率』，更高的『帧率』和更低的『压缩率』，都会导致『码率』增加。</span></p></blockquote><p>文章后面又特别强调『分辨率』和『压缩率』对『码率』的影响：<strong>高分辨率意味着图片可以包括更多的细节，低压缩率意味着图片压缩损失越少，即失真越少，越清晰。</strong>那为什么不特地讨论『帧率』呢？笔者认为原因有二：一个是『帧率』的影响非常直观，每秒帧数增加必然导致数据量增加；另一个是实际应用场景中『帧率』是相对固定的，我们观看的一般视频都在25-30fps之间，现在一些高帧视频是60fps，可见视频『帧率』在实际场景中被讨论的很少。</p><p><br></p><p><strong>奇怪的帧名词：1080p和1080i、场</strong></p><p>笔者仅仅出于觉得有趣才放上来的，<strong>1080p和1080i、场</strong>都是相对比较“老”的概念了，在还是CRT电视的时代，显示器显示画面都是靠电子枪一行一行扫描画面才能产生一副完整的图像，这就被称作『<strong>场</strong>』，后来这个名词也不常使用了，被取代它的是『<strong>帧</strong>』。【科技在进步，过时的概念、应用都会被新兴的替换，所以真的要不断学习紧跟时代啊！】</p><p><strong>1080p</strong>和<strong>1080i</strong>也是『<strong>场</strong>』同一时期的概念：</p><ul><li><strong>${数字}i</strong>的字母”<strong>i</strong>“表示Interlace，代表隔行扫描，比如奇数『<strong>场</strong>』只扫描奇数行，后一『<strong>场</strong>』即偶数『<strong>场</strong>』只扫描偶数行。这在过去是非常有用的，当时网络条件差，带宽受限，隔行扫描可以很大程度上减少传输的数据，又不至于影响观众观看体验。</li><li><strong>${数字}p</strong>的字母”<strong>p</strong>“表示Progressive，即逐行扫描，也就是一『<strong>场</strong>』把全部画面扫描完整。这是后来才提出的概念，这也代表时代进步，带宽条件上来了。</li></ul><p>既然都是老概念了，那为什么还要再提呢？借用文章1080P和1080i是什么意思？第一段来说：</p><blockquote><p><span style="color:#646464;--tt-darkmode-color: #646464">进入液晶时代的如今，隔行和逐行其实已经没有太大的意义了，现在的电视或者是显示器都属于固定像素设备，像素点同时发光，并不需要扫描，但是硬要说的话可以认为现在的显示设备都是逐行扫描的，但也并不是说1080P和1080i等就可以淘汰了，毕竟还涉及到摄像机的格式，不过普通观众也不会关心是用什么摄像机拍的，只关心呈现出来的样貌就好了。</span></p></blockquote><p><br></p><p>视频『帧』和编解码密切相关，因此还有不少『帧』的概念是和视频编解码相关的。</p><p><strong>视频编解码而衍生的帧名词</strong></p><ol start=1><li><strong>I帧、P帧、B帧和IDR帧</strong><br>但凡接触过一点视频编解码的读者，一定见过I\P\B帧，至于IDR可能见的少一些。下面，简单解释每种类型：</li></ol><ul><li><strong>I帧</strong>，英文全写<strong>Intra Picture</strong>，又称<strong>帧内编码帧</strong>，俗称<strong>关键帧</strong>。一般来说<strong>I帧</strong>不需要依赖前后帧信息，可独立进行解码。有数据表明，仅<strong>I帧</strong>的压缩率，可以达到7，这里其实可以把I帧的压缩等同於单独压缩一幅图片。至于说<strong>I帧</strong>的压缩只压缩了空间上的冗余信息，放在后续编码相关的系列文章中会详述。【这里再挖一个坑，免得自己忘记了】</li><li><strong>P帧</strong>，英文全写<strong>predictive-frame</strong>，又称<strong>前向预测编码帧</strong>，也有<strong>帧间预测编码帧</strong>。顾名思义，<strong>P帧</strong>需要依赖前面的<strong>I帧</strong>或者<strong>P帧</strong>才能进行编解码，因为一般来说，<strong>P帧</strong>存储的是当前帧画面与前一帧（前一帧可能是<strong>I帧</strong>也可能是<strong>P帧</strong>）的差别，较专业的说法是<strong>压缩了时间冗余信息，或者说提取了运动特性</strong>。<strong>P帧</strong>的压缩率约在20左右，几乎所有的H264编码流都带有大量的<strong>P帧</strong>。</li><li><strong>B帧</strong>，英文全写<strong>bi-directional interpolatedprediction frame</strong>，又称 <strong>双向预测内插编码帧</strong>，简称<strong>双向预测编码帧</strong>。<strong>B帧</strong>非常特殊，它存储的是本帧与前后帧的差别，因此带有B帧的视频在解码时的逻辑会更复杂些，CPU开销会更大。因此，不是所有的视频都带有<strong>B帧</strong>，笔者目前还没有接触过带<strong>B帧</strong>的视频。【找到带B帧视频一定要珍藏起来好好研究！】不过，<strong>B帧</strong>的压缩率能够达到50甚至更高，在压缩率指标上还是很客观的。</li><li><strong>IDR帧</strong>，英文全写<strong>Instantaneous Decoding Refresh</strong>，翻译过来是<strong>即时解码刷新</strong>。听上去，这类帧并不是名词概念，倒像是个动词？<strong>IDR帧</strong>是一种特殊的<strong>I帧</strong>，它是为了服务于编解码而提出的概念，<strong>IDR帧的作用是立刻刷新,使错误不致传播,从IDR帧开始,重新算一个新的序列开始编码</strong>（摘自博客H264中I帧和IDR帧的区别）。</li></ul><p><strong>I/P/B帧</strong>，并不是依据视频帧数据内部的元素的不同来区分的，从解码后的帧本身而言，它们没有任何区别。仅仅是在编码时，对帧处理的方式不同而已。</p><ol start=1><li><strong>GOP</strong><br>英文全称<strong>Group Of Pictures</strong>，一般来说，指的就是两个<strong>I帧</strong>之间的间隔，严格来说，是两个<strong>IDR帧</strong>之间的间隔。笔者对<strong>GOP</strong>研究的不多，对于网上的说法：“<strong>GOP</strong>在一定程度上会影响视频画面质量 - 在码率相同的情况下，GOP越大，意味着P\B帧越多，也就更容易获取较好的图像质量”这个说法存疑。【这里留个坑待填】</li><li><strong>PTS、DTS</strong><br>笔者是在对视频文件硬做解码的时候，发现实际解码输出的fps是硬解的能力上限，比如一个24fps的视频文件，在用硬件解码时，能够达到100+，当时接到一个需求是：“需要控制视频文件的解码率，让它和文件的fps保持一致”。后来查阅了大量的资料，进而了解了<strong>DTS</strong>和<strong>PTS</strong>的概念：</li></ol><ul><li><strong>DTS</strong>，英文全称<strong>Decoding Time Stamp</strong>，即解码时间戳，这个时间戳的意义在于告诉解码器该在什么时候解码这一帧的数据。</li><li><strong>PTS</strong>，英文全称<strong>Presentation Time Stamp</strong>，即显示时间戳，这个时间戳用来告诉播放器该在什么时候显示这一帧的数据。</li></ul><p>这个概念在做视音频同步的时候特别重要，尤其是<strong>PTS</strong>，目前常见的视音频同步的三种策略“同步到音频的<strong>PTS</strong>”、“同步到视频的<strong>PTS</strong>”和“同步到系统/外部时钟”，都是基于<strong>PTS</strong>完成的。</p><hr><h1 class=pgc-h-arrow-right><strong>写在后面</strong></h1><p>尽管每个概念网上都可以搜到一大堆的资料，但是笔者从一个多媒体开发小白走过来，觉得能有相对系统入门的综合性介绍就会更好了！本文每个地方，都是基于笔者自己的理解，而不是简单地从网上“复制粘贴”过来的，希望能够对大家有所帮助！当然，文章中有不严谨的地方，欢迎留言告知；或者有什么有趣的话题探讨，也欢迎私信留言！</p><p>最后，笔者目前在腾讯优图的边缘计算开发小团队，目前我们正在计划开源一款能够适配设备（以边缘设备为主）视觉AI计算落地应用框架-RapidAIoT，内容包括视频取流、AI计算、消息结果上报下发中间件。也欢迎大家咨询了解。</p><p><br>本文转自：小北的技术笔记，更多干货尽在腾讯技术工程</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'万字','详文讲','解视频'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>