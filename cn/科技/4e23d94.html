<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Nginxç®€ä»‹åŠé…ç½®æ–‡ä»¶è¯¦è§£ | æå®¢å¿«è¨Š</title><meta property="og:title" content="Nginxç®€ä»‹åŠé…ç½®æ–‡ä»¶è¯¦è§£ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/153570866559467f5003722"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4e23d94.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4e23d94.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4e23d94.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4e23d94.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4e23d94.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4e23d94.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4e23d94.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4e23d94.html><meta property="article:published_time" content="2020-10-29T20:59:54+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:54+08:00"><meta name=Keywords content><meta name=description content="Nginxç®€ä»‹åŠé…ç½®æ–‡ä»¶è¯¦è§£"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/4e23d94.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Nginxç®€ä»‹åŠé…ç½®æ–‡ä»¶è¯¦è§£</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><p><strong>ä¸€ Nginxç®€ä»‹</strong></p><p>Nginxæ˜¯ä¸€æ¬¾å¼€æºä»£ç çš„é«˜æ€§èƒ½HTTPæœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼ŒåŒæ—¶æ”¯æŒIMAP/POP3/SMTPä»£ç†æœåŠ¡</p><p>1.Nginxå·¥ä½œåŸç†</p><p>Nginxç”±å†…æ ¸å’Œæ¨¡å—ç»„æˆï¼Œå®Œæˆå·¥ä½œæ˜¯é€šè¿‡æŸ¥æ‰¾é…ç½®æ–‡ä»¶å°†å®¢æˆ·ç«¯è¯·æ±‚æ˜ å°„åˆ°ä¸€ä¸ªlocation block(locationæ˜¯ç”¨äºURLåŒ¹é…çš„å‘½ä»¤)ï¼Œlocationé…ç½®çš„å‘½ä»¤ä¼šå¯åŠ¨ä¸åŒæ¨¡å—å®Œæˆå·¥ä½œã€‚</p><p>Nginxæ¨¡å—åˆ†ä¸ºæ ¸å¿ƒæ¨¡å—ï¼ŒåŸºç¡€æ¨¡å—å’Œç¬¬ä¸‰æ–¹æ¨¡å—ã€‚</p><p>æ ¸å¿ƒæ¨¡å—ï¼šHTTPæ¨¡å—ã€EVENTæ¨¡å—(äº‹ä»¶)ã€MAILæ¨¡å—ã€‚</p><p>åŸºç¡€æ¨¡å—ï¼šHTTP Accessæ¨¡å—ã€HTTP FastCGIæ¨¡å—ã€HTTP Proxyæ¨¡å—ã€HTTP Rewriteæ¨¡å—ã€‚</p><p>ç¬¬ä¸‰æ–¹æ¨¡å—ï¼šHTTP Upstream Request Hashæ¨¡å—ã€Noticeæ¨¡å—ã€HTTP Access Keyæ¨¡å—ã€‚</p><p>2.æ€§èƒ½ä¼˜åŠ¿</p><p>webæœåŠ¡å™¨ï¼Œå¤„ç†é™æ€æ–‡ä»¶ã€ç´¢å¼•æ–‡ä»¶ä»¥åŠè‡ªåŠ¨ç´¢å¼•æ•ˆç‡é«˜ã€‚</p><p>ä»£ç†æœåŠ¡å™¨ï¼Œå¿«é€Ÿé«˜æ•ˆåå‘ä»£ç†ï¼Œæå‡ç½‘ç«™æ€§èƒ½ã€‚</p><p>è´Ÿè½½å‡è¡¡å™¨ï¼Œå†…éƒ¨æ”¯æŒRailså’ŒPHP,ä¹Ÿå¯æ”¯æŒHTTPä»£ç†æœåŠ¡å™¨ï¼Œå¯¹å¤–è¿›è¡ŒæœåŠ¡ã€‚åŒæ—¶æ”¯æŒç®€å•å®¹é”™å’Œåˆ©ç”¨ç®—æ³•è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚</p><p>æ€§èƒ½æ–¹é¢ï¼ŒNginxä¸“é—¨ä¸ºæ€§èƒ½è®¾è®¡ï¼Œå®ç°æ³¨é‡æ•ˆç‡ã€‚é‡‡ç”¨Pollæ¨¡å‹ï¼Œå¯ä»¥æ”¯æŒæ›´å¤šçš„å¹¶å‘è¿æ¥ï¼Œå¹¶åœ¨å¤§å¹¶å‘æ—¶å ç”¨å¾ˆä½å†…å­˜ã€‚</p><p>ç¨³å®šæ€§æ–¹é¢ï¼Œé‡‡ç”¨åˆ†é˜¶æ®µèµ„æºåˆ†é…æŠ€æœ¯ï¼Œä½¿CPUèµ„æºå ç”¨ç‡ä½ã€‚</p><p>é«˜å¯ç”¨æ€§æ–¹é¢ï¼Œæ”¯æŒçƒ­å¤‡ï¼Œå¯åŠ¨è¿…é€Ÿã€‚</p><p><strong>äºŒ Nginxç¼–è¯‘å®‰è£…,é…ç½®æ–‡ä»¶è¯¦è§£</strong></p><p>1.Nginxå®‰è£…</p><pre>#å®‰è£…éƒ¨ç½²nginxæ‰€ç”¨åˆ°çš„å®‰è£…å·¥å…·å’Œç›¸å…³åº“#é»˜è®¤å®‰è£…çš„http_rewrite_moduleï¼ˆä½¿ç”¨æ­£åˆ™å¯¹è¯·æ±‚é‡å†™ï¼‰éœ€pcreåº“#é»˜è®¤å®‰è£…çš„httP_gzip_moduleï¼ˆGzipå‹ç¼©ï¼‰éœ€zlibåº“#å®‰è£…http_ssl_module(HTTPS/SLL)éœ€opensslåº“yum -y install gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel#ä¸‹è½½nginxæºç åŒ…ï¼Œå¹¶è§£å‹wget http://nginx.org/download/nginx-1.10.3.tar.gztar -zxvf nginx-1.10.3.tar.gzcd nginx-1.10.3#è®¾ç½®å‚æ•° å‚æ•°å…·ä½“å‚è€ƒã€ŠNginxç¼–è¯‘å‚æ•°ã€‹./configure \--prefix=/usr/local/nginx \--with-http_ssl_module #ç¼–è¯‘å¹¶å®‰è£… make &amp;&amp; make install</pre><p>2.Nginxé…ç½®æ–‡ä»¶ï¼ˆ/usr/local/nginx/conf/nginx.confï¼‰</p><p>é…ç½®æ–‡ä»¶ä¸»è¦ç”±å››éƒ¨åˆ†ç»„æˆï¼šmain(å…¨åŒºè®¾ç½®)ï¼Œserver(ä¸»æœºé…ç½®)ï¼Œupstream(è´Ÿè½½å‡è¡¡æœåŠ¡å™¨è®¾ç½®)ï¼Œå’Œlocation(URLåŒ¹é…ç‰¹å®šä½ç½®è®¾ç½®)ã€‚</p><p>1ï¼‰å…¨å±€å˜é‡</p><pre>#Nginxçš„workerè¿›ç¨‹è¿è¡Œç”¨æˆ·ä»¥åŠç”¨æˆ·ç»„#user nobody nobody;#Nginxå¼€å¯çš„è¿›ç¨‹æ•°worker_processes 1;#worker_processes auto;#ä»¥ä¸‹å‚æ•°æŒ‡å®šäº†å“ªä¸ªcpuåˆ†é…ç»™å“ªä¸ªè¿›ç¨‹ï¼Œä¸€èˆ¬æ¥è¯´ä¸ç”¨ç‰¹æ®ŠæŒ‡å®šã€‚å¦‚æœä¸€å®šè¦è®¾çš„è¯ï¼Œç”¨0å’Œ1æŒ‡å®šåˆ†é…æ–¹å¼.#è¿™æ ·è®¾å°±æ˜¯ç»™1-4ä¸ªè¿›ç¨‹åˆ†é…å•ç‹¬çš„æ ¸æ¥è¿è¡Œï¼Œå‡ºç°ç¬¬5ä¸ªè¿›ç¨‹æ˜¯å°±æ˜¯éšæœºåˆ†é…äº†ã€‚eg:#worker_processes 4 #4æ ¸CPU #worker_cpu_affinity 0001 0010 0100 1000#å®šä¹‰å…¨å±€é”™è¯¯æ—¥å¿—å®šä¹‰ç±»å‹ï¼Œ[debug|info|notice|warn|crit]#error_log logs/error.log info;#æŒ‡å®šè¿›ç¨‹IDå­˜å‚¨æ–‡ä»¶ä½ç½®#pid logs/nginx.pid;#ä¸€ä¸ªnginxè¿›ç¨‹æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œç†è®ºå€¼åº”è¯¥æ˜¯æœ€å¤šæ‰“å¼€æ–‡ä»¶æ•°ï¼ˆulimit -nï¼‰ä¸nginxè¿›ç¨‹æ•°ç›¸é™¤ï¼Œä½†æ˜¯nginxåˆ†é…è¯·æ±‚å¹¶ä¸æ˜¯é‚£ä¹ˆå‡åŒ€ï¼Œæ‰€ä»¥æœ€å¥½ä¸ulimit -nçš„å€¼ä¿æŒä¸€è‡´ã€‚#vim /etc/security/limits.conf# * soft nproc 65535# * hard nproc 65535# * soft nofile 65535# * hard nofile 65535worker_rlimit_nofile 65535;</pre><p>2ï¼‰äº‹ä»¶é…ç½®</p><pre>events { #use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epollæ¨¡å‹æ˜¯Linux 2.6ä»¥ä¸Šç‰ˆæœ¬å†…æ ¸ä¸­çš„é«˜æ€§èƒ½ç½‘ç»œI/Oæ¨¡å‹ï¼Œå¦‚æœè·‘åœ¨FreeBSDä¸Šé¢ï¼Œå°±ç”¨kqueueæ¨¡å‹ã€‚ use epoll; #æ¯ä¸ªè¿›ç¨‹å¯ä»¥å¤„ç†çš„æœ€å¤§è¿æ¥æ•°ï¼Œç†è®ºä¸Šæ¯å°nginxæœåŠ¡å™¨çš„æœ€å¤§è¿æ¥æ•°ä¸ºworker_processes*worker_connectionsã€‚ç†è®ºå€¼ï¼šworker_rlimit_nofile/worker_processes #æ³¨æ„ï¼šæœ€å¤§å®¢æˆ·æ•°ä¹Ÿç”±ç³»ç»Ÿçš„å¯ç”¨socketè¿æ¥æ•°é™åˆ¶ï¼ˆ~ 64Kï¼‰ï¼Œæ‰€ä»¥è®¾ç½®ä¸åˆ‡å®é™…çš„é«˜æ²¡ä»€ä¹ˆå¥½å¤„ worker_connections 65535;  #workerå·¥ä½œæ–¹å¼ï¼šä¸²è¡Œï¼ˆä¸€å®šç¨‹åº¦é™ä½è´Ÿè½½ï¼Œä½†æœåŠ¡å™¨ååé‡å¤§æ—¶ï¼Œå…³é—­ä½¿ç”¨å¹¶è¡Œæ–¹å¼ï¼‰ #multi_accept on; }</pre><p>3ï¼‰httpå‚æ•°</p><pre> #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨ include mime.types; #é»˜è®¤æ–‡ä»¶ç±»å‹ default_type application/octet-stream;#æ—¥å¿—ç›¸å…³å®šä¹‰ #log_format main '$remote_addr - $remote_user [$time_local] "$request" ' # '$status $body_bytes_sent "$http_referer" ' # '"$http_user_agent" "$http_x_forwarded_for"'; #å®šä¹‰æ—¥å¿—çš„æ ¼å¼ã€‚åé¢å®šä¹‰è¦è¾“å‡ºçš„å†…å®¹ã€‚ #1.$remote_addr ä¸$http_x_forwarded_for ç”¨ä»¥è®°å½•å®¢æˆ·ç«¯çš„ipåœ°å€ï¼› #2.$remote_user ï¼šç”¨æ¥è®°å½•å®¢æˆ·ç«¯ç”¨æˆ·åç§°ï¼› #3.$time_local ï¼šç”¨æ¥è®°å½•è®¿é—®æ—¶é—´ä¸æ—¶åŒºï¼› #4.$request ï¼šç”¨æ¥è®°å½•è¯·æ±‚çš„urlä¸httpåè®®ï¼› #5.$status ï¼šç”¨æ¥è®°å½•è¯·æ±‚çŠ¶æ€ï¼›  #6.$body_bytes_sent ï¼šè®°å½•å‘é€ç»™å®¢æˆ·ç«¯æ–‡ä»¶ä¸»ä½“å†…å®¹å¤§å°ï¼› #7.$http_referer ï¼šç”¨æ¥è®°å½•ä»é‚£ä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„ï¼› #8.$http_user_agent ï¼šè®°å½•å®¢æˆ·ç«¯æµè§ˆå™¨çš„ç›¸å…³ä¿¡æ¯ #è¿æ¥æ—¥å¿—çš„è·¯å¾„ï¼ŒæŒ‡å®šçš„æ—¥å¿—æ ¼å¼æ”¾åœ¨æœ€åã€‚ #access_log logs/access.log main; #åªè®°å½•æ›´ä¸ºä¸¥é‡çš„é”™è¯¯æ—¥å¿—ï¼Œå‡å°‘IOå‹åŠ› error_log logs/error.log crit; #å…³é—­æ—¥å¿— #access_log off; #é»˜è®¤ç¼–ç  #charset utf-8; #æœåŠ¡å™¨åå­—çš„hashè¡¨å¤§å° server_names_hash_bucket_size 128; #å®¢æˆ·ç«¯è¯·æ±‚å•ä¸ªæ–‡ä»¶çš„æœ€å¤§å­—èŠ‚æ•° client_max_body_size 8m; #æŒ‡å®šæ¥è‡ªå®¢æˆ·ç«¯è¯·æ±‚å¤´çš„hearerbufferå¤§å° client_header_buffer_size 32k; #æŒ‡å®šå®¢æˆ·ç«¯è¯·æ±‚ä¸­è¾ƒå¤§çš„æ¶ˆæ¯å¤´çš„ç¼“å­˜æœ€å¤§æ•°é‡å’Œå¤§å°ã€‚ large_client_header_buffers 4 64k; #å¼€å¯é«˜æ•ˆä¼ è¾“æ¨¡å¼ã€‚ sendfile on; #é˜²æ­¢ç½‘ç»œé˜»å¡ tcp_nopush on; tcp_nodelay on;  #å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ keepalive_timeout 60; #å®¢æˆ·ç«¯è¯·æ±‚å¤´è¯»å–è¶…æ—¶æ—¶é—´ client_header_timeout 10; #è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚ä¸»ä½“è¯»å–è¶…æ—¶æ—¶é—´ client_body_timeout 10; #å“åº”å®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´ send_timeout 10;#FastCGIç›¸å…³å‚æ•°æ˜¯ä¸ºäº†æ”¹å–„ç½‘ç«™çš„æ€§èƒ½ï¼šå‡å°‘èµ„æºå ç”¨ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚ fastcgi_connect_timeout 300; fastcgi_send_timeout 300; fastcgi_read_timeout 300; fastcgi_buffer_size 64k; fastcgi_buffers 4 64k; fastcgi_busy_buffers_size 128k; fastcgi_temp_file_write_size 128k;#gzipæ¨¡å—è®¾ç½® #å¼€å¯gzipå‹ç¼©è¾“å‡º gzip on;  #æœ€å°å‹ç¼©æ–‡ä»¶å¤§å° gzip_min_length 1k;  #å‹ç¼©ç¼“å†²åŒº gzip_buffers 4 16k; #å‹ç¼©ç‰ˆæœ¬ï¼ˆé»˜è®¤1.1ï¼Œå‰ç«¯å¦‚æœæ˜¯squid2.5è¯·ä½¿ç”¨1.0ï¼‰ gzip_http_version 1.0; #å‹ç¼©ç­‰çº§ 1-9 ç­‰çº§è¶Šé«˜ï¼Œå‹ç¼©æ•ˆæœè¶Šå¥½ï¼ŒèŠ‚çº¦å®½å¸¦ï¼Œä½†CPUæ¶ˆè€—å¤§ gzip_comp_level 2; #å‹ç¼©ç±»å‹ï¼Œé»˜è®¤å°±å·²ç»åŒ…å«text/htmlï¼Œæ‰€ä»¥ä¸‹é¢å°±ä¸ç”¨å†å†™äº†ï¼Œå†™ä¸Šå»ä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªwarnã€‚ gzip_types text/plain application/x-javascript text/css application/xml; #å‰ç«¯ç¼“å­˜æœåŠ¡å™¨ç¼“å­˜ç»è¿‡å‹ç¼©çš„é¡µé¢ gzip_vary on;</pre><p>4ï¼‰è™šæ‹Ÿä¸»æœºåŸºæœ¬è®¾ç½®</p><pre>#è™šæ‹Ÿä¸»æœºå®šä¹‰ server { #ç›‘å¬ç«¯å£ listen 80; #è®¿é—®åŸŸå server_name localhost; #ç¼–ç æ ¼å¼ï¼Œè‹¥ç½‘é¡µæ ¼å¼ä¸æ­¤ä¸åŒï¼Œå°†è¢«è‡ªåŠ¨è½¬ç  #charset koi8-r; #è™šæ‹Ÿä¸»æœºè®¿é—®æ—¥å¿—å®šä¹‰ #access_log logs/host.access.log main; #å¯¹URLè¿›è¡ŒåŒ¹é… location / { #è®¿é—®è·¯å¾„ï¼Œå¯ç›¸å¯¹ä¹Ÿå¯ç»å¯¹è·¯å¾„ root html; #é¦–é¡µæ–‡ä»¶ã€‚ä»¥ä¸‹æŒ‰é¡ºåºåŒ¹é… index index.html index.htm; }#é”™è¯¯ä¿¡æ¯è¿”å›é¡µé¢ #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html { root html; }#è®¿é—®URLä»¥.phpç»“å°¾åˆ™è‡ªåŠ¨è½¬äº¤ç»™127.0.0.1 # proxy the PHP scripts to Apache listening on 127.0.0.1:80 # #location ~ \.php$ { # proxy_pass http://127.0.0.1; #}#phpè„šæœ¬è¯·æ±‚å…¨éƒ¨è½¬å‘ç»™FastCGIå¤„ç† # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 # #location ~ \.php$ { # root html; # fastcgi_pass 127.0.0.1:9000; # fastcgi_index index.php; # fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name; # include fastcgi_params; #}#ç¦æ­¢è®¿é—®.hté¡µé¢ ï¼ˆéœ€ngx_http_access_moduleæ¨¡å—ï¼‰ # deny access to .htaccess files, if Apache's document root # concurs with nginx's one # #location ~ /\.ht { # deny all; #} }#HTTPSè™šæ‹Ÿä¸»æœºå®šä¹‰ # HTTPS server # #server { # listen 443 ssl; # server_name localhost; # ssl_certificate cert.pem; # ssl_certificate_key cert.key; # ssl_session_cache shared:SSL:1m; # ssl_session_timeout 5m; # ssl_ciphers HIGH:!aNULL:!MD5; # ssl_prefer_server_ciphers on; # location / { # root html; # index index.html index.htm; # } #}</pre><p>5ï¼‰NignxçŠ¶æ€ç›‘æ§</p><pre>#Nginxè¿è¡ŒçŠ¶æ€ï¼ŒStubStatusæ¨¡å—è·å–Nginxè‡ªå¯åŠ¨çš„å·¥ä½œçŠ¶æ€ï¼ˆç¼–è¯‘æ—¶è¦å¼€å¯å¯¹åº”åŠŸèƒ½ï¼‰ #location /NginxStatus { # #å¯ç”¨StubStatusçš„å·¥ä½œè®¿é—®çŠ¶æ€  # stub_status on; # #æŒ‡å®šStubStausæ¨¡å—çš„è®¿é—®æ—¥å¿—æ–‡ä»¶ # access_log logs/Nginxstatus.log; # #Nginxè®¤è¯æœºåˆ¶ï¼ˆéœ€Apacheçš„htpasswdå‘½ä»¤ç”Ÿæˆï¼‰ # #auth_basic "NginxStatus"; # #ç”¨æ¥è®¤è¯çš„å¯†ç æ–‡ä»¶ # #auth_basic_user_file ../htpasswd;  #}è®¿é—®ï¼šhttp://IP/NginxStatus(æµ‹è¯•å°±ä¸åŠ å¯†ç éªŒè¯ç›¸å…³) </pre><p>6ï¼‰åå‘ä»£ç†</p><pre>#ä»¥ä¸‹é…ç½®è¿½åŠ åœ¨HTTPçš„å…¨å±€å˜é‡ä¸­#nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)proxy_connect_timeout 5;#åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)proxy_send_timeout 5;#è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)proxy_read_timeout 60;#è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°proxy_buffer_size 16k;#proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½®proxy_buffers 4 32k;#é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰proxy_busy_buffers_size 64k;#è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼ proxy_temp_file_write_size 64k;#åå‘ä»£ç†ç¼“å­˜ç›®å½•proxy_cache_path /data/proxy/cache levels=1:2 keys_zone=cache_one:500m inactive=1d max_size=1g;#levels=1:2 è®¾ç½®ç›®å½•æ·±åº¦ï¼Œç¬¬ä¸€å±‚ç›®å½•æ˜¯1ä¸ªå­—ç¬¦ï¼Œç¬¬2å±‚æ˜¯2ä¸ªå­—ç¬¦#keys_zone:è®¾ç½®webç¼“å­˜åç§°å’Œå†…å­˜ç¼“å­˜ç©ºé—´å¤§å°#inactive:è‡ªåŠ¨æ¸…é™¤ç¼“å­˜æ–‡ä»¶æ—¶é—´ã€‚#max_size:ç¡¬ç›˜ç©ºé—´æœ€å¤§å¯ä½¿ç”¨å€¼ã€‚#æŒ‡å®šä¸´æ—¶ç¼“å­˜æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„(è·¯å¾„éœ€å’Œä¸Šé¢è·¯å¾„åœ¨åŒä¸€åˆ†åŒº)proxy_temp_path /data/proxy/temp#æœåŠ¡é…ç½®server { #ä¾¦å¬çš„80ç«¯å£ listen 80; server_name localhost; location / { #åå‘ä»£ç†ç¼“å­˜è®¾ç½®å‘½ä»¤(proxy_cache zone|off,é»˜è®¤å…³é—­æ‰€ä»¥è¦è®¾ç½®) proxy_cache cache_one; #å¯¹ä¸åŒçš„çŠ¶æ€ç ç¼“å­˜ä¸åŒæ—¶é—´ proxy_cache_valid 200 304 12h; #è®¾ç½®ä»¥ä»€ä¹ˆæ ·å‚æ•°è·å–ç¼“å­˜æ–‡ä»¶å proxy_cache_key $host$uri$is_args$args; #å7ç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr;  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;   #ä»£ç†è®¾ç½® proxy_pass http://IP;  #æ–‡ä»¶è¿‡æœŸæ—¶é—´æ§åˆ¶ expires 1d; } #é…ç½®æ‰‹åŠ¨æ¸…æ¥šç¼“å­˜(å®ç°æ­¤åŠŸèƒ½éœ€ç¬¬ä¸‰æ–¹æ¨¡å— ngx_cache_purge) #http://www.123.com/2017/0316/17.htmlè®¿é—® #http://www.123.com/purge/2017/0316/17.htmlæ¸…æ¥šURLç¼“å­˜ location ~ /purge(/.*) { allow 127.0.0.1; deny all; proxy_cache_purge cache_one $host$1$is_args$args; } #è®¾ç½®æ‰©å±•åä»¥.jspã€.phpã€.jspxç»“å°¾çš„åŠ¨æ€åº”ç”¨ç¨‹åºä¸åšç¼“å­˜ location ~.*\.(jsp|php|jspx)?$ {  proxy_set_header Host $host;  proxy_set_header X-Real-IP $remote_addr;  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;   proxy_pass http://http://IP; }</pre><p>7ï¼‰è´Ÿè½½å‡è¡¡</p><pre>#è´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ± upstream my_server_pool { #è°ƒåº¦ç®—æ³• #1.è½®å¾ªï¼ˆé»˜è®¤ï¼‰ï¼ˆweightè½®å¾ªæƒå€¼ï¼‰ #2.ip_hashï¼šæ ¹æ®æ¯ä¸ªè¯·æ±‚è®¿é—®IPçš„hashç»“æœåˆ†é…ã€‚ï¼ˆä¼šè¯ä¿æŒï¼‰ #3.fair:æ ¹æ®åç«¯æœåŠ¡å™¨å“åº”æ—¶é—´æœ€çŸ­è¯·æ±‚ã€‚ï¼ˆupstream_fairæ¨¡å—ï¼‰ #4.url_hash:æ ¹æ®è®¿é—®çš„urlçš„hashç»“æœåˆ†é…ã€‚ï¼ˆéœ€hashè½¯ä»¶åŒ…ï¼‰ #å‚æ•°ï¼š #downï¼šè¡¨ç¤ºä¸å‚ä¸è´Ÿè½½å‡è¡¡ #backup:å¤‡ä»½æœåŠ¡å™¨ #max_fails:å…è®¸æœ€å¤§è¯·æ±‚é”™è¯¯æ¬¡æ•° #fail_timeout:è¯·æ±‚å¤±è´¥åæš‚åœæœåŠ¡æ—¶é—´ã€‚ server 192.168.1.109:80 weight=1 max_fails=2 fail_timeout=30; server 192.168.1.108:80 weight=2 max_fails=2 fail_timeout=30;}#è´Ÿè½½å‡è¡¡è°ƒç”¨server { ... location / { proxy_pass http://my_server_pool; }}</pre><p>8ï¼‰URLé‡å†™</p><pre>#æ ¹æ®ä¸åŒçš„æµè§ˆå™¨URLé‡å†™if($http_user_agent ~ Firefox){rewrite ^(.*)$ /firefox/$1 break; }if($http_user_agent ~ MSIE){rewrite ^(.*)$ /msie/$1 break; }#å®ç°åŸŸåè·³è½¬location / { rewrite ^/(.*)$ https://web8.example.com$1 permanent;}</pre><p>9ï¼‰IPé™åˆ¶</p><pre>#é™åˆ¶IPè®¿é—®location / { deny 192.168.0.2ï¼› allow 192.168.0.0/24; allow 192.168.1.1; deny all;}</pre><p>10ï¼‰Nginxç›¸å…³å‘½ä»¤</p><pre>#å¯åŠ¨nginxnginx #å…³é—­nginxnginx -s stop#å¹³æ»‘é‡å¯kill -HUP `cat /usr/local/nginx/logs/nginx.pid`</pre><p>11ï¼‰Nginxå¯åŠ¨è„šæœ¬</p><pre>#!/bin/bash#chkconfig: 2345 80 90#description:auto_runPATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/binexport PATH# Check if user is rootif [ $(id -u) != "0" ]; then echo "Error: You must be root to run this script!\n" exit 1fiNGINXDAEMON=/usr/local/nginx/sbin/nginxPIDFILE=/usr/local/nginx/logs/nginx.pidfunction_start(){ echo -en "\033[32;49;1mStarting nginx......\n" echo -en "\033[39;49;0m"  if [ -f $PIDFILE ]; then printf "Nginx is runing!\n" exit 1 else  $NGINXDAEMON printf "Nginx is the successful start!\n" fi}function_stop(){ echo -en "\033[32;49;1mStoping nginx......\n" echo -en "\033[39;49;0m" if [ -f $PIDFILE ]; then kill `cat $PIDFILE` printf "Nginx program is stoped\n" else  printf "Nginx program is not runing!\n" fi}function_reload(){ echo -en "\033[32;49;1mReload nginx......\n" echo -en "\033[39;49;0m" function_stop function_start}function_restart(){ echo -en "\033[32;49;1mRestart nginx......\n" echo -en "\033[39;49;0m" printf "Reload Nginx configure...\n" $NGINXDAEMON -t kill -HUP `cat $PIDFILE` printf "Nginx program is reloding!\n"}function_kill(){ killall nginx}function_status(){ if ! ps -ef|grep -v grep|grep 'nginx:' &gt; /dev/null 2&gt;&amp;1 then printf "Nginx is down!!!\n" else printf "Nginx is running now!\n" fi}if [ "$1" = "start" ]; then function_startelif [ "$1" = "stop" ]; then function_stopelif [ "$1" = "reload" ]; then function_reloadelif [ "$1" = "restart" ]; then function_restartelif [ "$1" = "kill" ]; then function_killelif [ "$1" = "status" ]; then function_statuselse echo -en "\033[32;49;1m Usage: nginx {start|stop|reload|restart|kill|status}\n" echo -en "\033[39;49;0m"fi</pre><div class=pgc-img><img alt=Nginxç®€ä»‹åŠé…ç½®æ–‡ä»¶è¯¦è§£ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/153570866559467f5003722><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=Nginxç®€ä»‹åŠé…ç½®æ–‡ä»¶è¯¦è§£ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/153570867905170f25f6d1e><p class=pgc-img-caption></p></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'é…ç½®æ–‡ä»¶','Nginx','ç®€ä»‹åŠ'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>