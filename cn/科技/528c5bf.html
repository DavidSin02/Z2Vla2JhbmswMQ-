<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>工业网络环网协议介绍：MRP和HRP | 极客快訊</title><meta property="og:title" content="工业网络环网协议介绍：MRP和HRP - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/4607a6c81b5c44be8e9e67a2722527f4"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/528c5bf.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/528c5bf.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/528c5bf.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/528c5bf.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/528c5bf.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/528c5bf.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/528c5bf.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/528c5bf.html><meta property="article:published_time" content="2020-10-29T21:05:37+08:00"><meta property="article:modified_time" content="2020-10-29T21:05:37+08:00"><meta name=Keywords content><meta name=description content="工业网络环网协议介绍：MRP和HRP"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/528c5bf.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>工业网络环网协议介绍：MRP和HRP</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>1数据链路层概述</h1><p style=text-align:start>数据链路层负责网络中相邻节点间的帧的传输，通过数据链路层的协议完成帧的同步、节点间传输链路的管理、传输控制及实现节点间传输的差错控制和流量控制，在不太可靠的物理链路上实现了数据帧可靠地传输。</p><blockquote><p><strong>局域网（LAN）和广域网（WAN）工作于物理层和数据链路层</strong></p></blockquote><h1 class=pgc-h-arrow-right>1.0局域网和以太网</h1><p style=text-align:start>以太网（Ethernet ）是目前应用最普遍的局域网技术，取代了其它局域网技术如令牌环、FDDI和ARCNET。</p><blockquote><p>IEEE组织的IEEE 802.3标准制定了以太网的技术标准。</p></blockquote><h1 class=pgc-h-arrow-right>1.1数据链路和帧</h1><p style=text-align:start><strong>链路</strong>：从一个结点到相邻结点的一段<strong>物理链路</strong>，中间没有任何其它交换结点。链路只是一条路径的组成部分，两个设备间的通信路径往往要经过许多段这样的路径。</p><p style=text-align:start><strong>数据链路</strong>：当需要在一条线路上传送数据时，除了物理线路外，还必须有通信协议来控制这些数据的传输。若<strong>把实现这些协议的硬件和软件加到链路上</strong>，就构成了数据链路。</p><p style=text-align:start><strong>帧</strong>：数据在数据链路层上是以很小的称为帧（Frame）的单位传输的，帧由几部分组成，不同的部分执行不同的功能。</p><h1 class=pgc-h-arrow-right>2数据链路层协议</h1><h1 class=pgc-h-arrow-right>2.1数据链路层协议的3个共同基本问题</h1><p style=text-align:start><strong>封装成帧</strong><br>封装成帧就是在一段数据前后分别添加首部和尾部，帧长就等于数据部分长的加上帧首部和帧尾部的长度。帧首部和帧尾部的一个重要作用就是进行<strong>帧定界</strong>，帧定界就是标识帧的开始与结束，目的是让接收方能从接收到的二进制比特流中区分出帧的起始与终止。SOH（start of heading）放在帧的最前面，表示帧首部开始。EOT（end of transmission)表示帧的结束。<br><strong>最大传输单元</strong>（Maximum Transmission Unit，MTU）指每种链路层协议规定的数据部分的长度上限。</p><p style=text-align:start><strong>透明传输</strong><br>透明传输中的“透明”就是指在传输过程中，传输业务对外界透明，只负责将需要传送的业务传送到目的节点，同时保证传输的质量即可，而不对传输的业务进行处理。从上层角度看，似乎就是一个透明的管道，什么都可以传。<br>透明传输是指不管所传数据是什么样的比特组合，都应当能够在链路上传送。当所传数据中的比特组合恰巧与某一个控制信息完全一样时，就必须采取适当的措施，使接收方不会将这样的数据误认为是某种控制信息。</p><p style=text-align:start><strong>差错检测</strong><br>如奇偶校验、循环冗余校验码(CRC)等。</p><h1 class=pgc-h-arrow-right>2.2点对点协议（PPP)</h1><p style=text-align:start><strong>点对点协议</strong>（PPP，Point-to-Point Protocol）是计算机网络中一种在同步或异步线路上对数据包进行封装的<strong>数据链路层协议</strong>，主要是用来通过拨号或专线方式在两个网络节点之间建立连接、发送数据。PPP是各类型主机、网桥和路由器之间简单连接的一种解决方案。</p><h1 class=pgc-h-arrow-right>3VLAN</h1><p style=text-align:start>使用交换机技术可产生VLAN（Virtual Local Area Network，虚拟局域网）。在计算机网络中，一个数据链路层网络可以被<strong>从逻辑上被划分为多个不同的广播域</strong>，一个广播域对应了一个特定的用户组，默认情况下这些不同的广播域是相互隔离的。不同的广播域之间想要通信，需要通过一个或多个路由器。这样的一个广播域就称为VLAN。每个VLAN被分配一个标识，帧只在具有相同VLAN标识的网段间转发。<br>与连接到物理上的LAN的节点不同，组成VLAN的节点并非在物理上连接到同一网段，它们是通过特殊的软件将交换机中的几个端口，在虚拟的意义上连接在一起。<br>基于交换机的虚拟局域网能为局域网解决冲突域、广播域、带宽问题。</p><h1 class=pgc-h-arrow-right>3.1VLAN三种端口模式：Access、Hybrid和Trunk</h1><p style=text-align:start><strong>Access类型端口</strong>：只能属于1个VLAN，一般用于连接计算机端口；</p><p style=text-align:start><strong>Trunk（中继）类型端口</strong>：可以允许多个VLAN通过,可以接收和发送多个VLAN 报文,一般用于交换机与交换机相关的接口。</p><p style=text-align:start><strong>Hybrid（混合）类型端口</strong>：可以允许多个VLAN通过，可以接收和发送多个VLAN 报文，可以用于交换机的间连接也可以用于连接用户计算机。</p><blockquote><p>Hybrid接口和Trunk接口在很多应用场景下可以通用，不同之处：Trunk端口报文发送一般都要打标，而Hybrid可以允许多个VLAN不打标。</p></blockquote><h1 class=pgc-h-arrow-right>3.2广播域、VLAN、网段的区别</h1><blockquote><p>引自https://blog.csdn.net/Joshua_bu/article/details/80766514<br>【网段】【vlan】【广播域】关于网段，vlan和广播域的关系的个人理解</p></blockquote><p style=text-align:start>广播域是一个二层概念，所有能够接收到同一个广播的设备处于同一广播域。<br>VLAN是一个二层概念，相当于基于原来的广播域划分更小的广播域，而在没有vlan的时候，默认所有设备都属于vlan1。因此广播域的范围等于vlan。<br>网段是一个三层概念，一个路由器接口对应着一个网段，在有路由器存在的情况下，网段和广播域是一样大的。</p><h1 class=pgc-h-arrow-right>3.3 IEEE 802.1和IEEE 802.11</h1><p style=text-align:start>二者都属于802标准，工作于数据链路层。</p><p style=text-align:start>IEEE 802.1 (higher layer LAN protocol，高层局域网协议）是一组协议的集合，如生成树协议、VLAN协议等。IEEE在制定某一个协议时，会在IEEE 802.1后面加上不同的小写字母加以区别。</p><blockquote><p>IEEE 802.1a定义局域网体系结构；<br>IEEE 802.1b定义网际互连，网络管理及寻址；<br>IEEE 802.1d定义生成树协议；<br>IEEE 802.1p定义优先级队列；<br>IEEE 802.1q定义VLAN标记协议；<br>IEEE 802.1x定义局域网安全认证</p></blockquote><p style=text-align:start>IEEE 802.11【Wireless LAN(WLAN) & Mesh (Wi-Fi certification）】是现今<strong>无线局域网</strong>通用的标准。</p><h1 class=pgc-h-arrow-right>4硬件设备</h1><h1 class=pgc-h-arrow-right>4.1网桥（bridge）</h1><p style=text-align:start>又名桥接器，是一种存储/转发设备，他能将一个大局域网<strong>分割</strong>为多个网段或将两个以上的局域网<strong>互联</strong>成一个逻辑局域网。<br>它的作用是通过其“过滤和转发”功能来实现的。当网桥收到一个MAC帧时，就检查该帧的源地址和目的地址，如果目的站点和源站点在同一个网络，则不对其进行转发，这就实现了<strong>过滤</strong>功能，也完成了对网络的隔离。否则根据它所保持的路由表选择正确的网络进行<strong>转发</strong>。</p><h1 class=pgc-h-arrow-right>4.2网络适配器（network adapter ）&MAC地址</h1><p style=text-align:start>计算机是通过<strong>网络适配器</strong>（或称网卡）连接到局域网上的。由于其拥有MAC地址，因此属于OSI模型的第2层。</p><p style=text-align:start>网络的绝对寻址要求每一个站点本身都必须有可以访问的地址，这个地址就是<strong>MAC地址</strong>（Media Access Control Address，媒体存取控制位址），也称为局域网地址（LAN Address）或物理地址（Physical Address）。它是一个用来确认网络设备位置的位址，由网络设备制造商生产时烧录在<strong>网卡</strong>的存储器中。每个网卡有一个唯一的MAC地址，一台设备若有一或多个网卡，则每个网卡都需要并会有一个唯一的MAC地址。</p><h1 class=pgc-h-arrow-right>4.3二层交换机（switch）</h1><blockquote><p>注意同三层交换机的区分。<br>竞赛中使用的是网管型交换机，属于三层交换机，这里我将工业交换机剥离成两部分方便理解。</p></blockquote><p style=text-align:start>交换机从本质上说是多端口的网桥，或高效能的网桥。它们的主要区别在于体系结构不同，网桥是为共享介质的局域网设计的，而交换机允许多个端口之间的并发通信。交换机每个端口都分配一个MAC地址，端口之间的数据通信时硬件实现并且是交换机内部电路的一部分。<br><strong>二层交换机</strong>工作于OSI模型的第2层（数据链路层），故而称为二层交换机。二层交换机可以识别数据包中的MAC地址信息，根据MAC地址进行转发，并将这些MAC地址与对应的端口记录在<strong>内部地址表</strong>中。具体而言，当一个数据帧进入交换机的某个端口，端口的网络适配器将该帧的MAC地址转换成具体的交换机端口地址，对帧的转发采用了高效的交换逻辑来实现，然后将其送到其目的端口。<br>交换机最显著的特点在于<strong>端口带宽的独享</strong>，同一时刻可进行多个端口对之间的数据传输，每一端口都是一个独立的冲突域，连接在其上的网络设备独自享有全部带宽，无须同其他设备竞争使用。此外交换机支持<strong>全双工模式</strong>，能够同时通过一个端口发送和接收帧。</p><blockquote><p>集线器为<strong>共享式带宽</strong>，连接在集线器上的任何一个设备发送数据时，其他所有设备必须等待，此设备享有全部带宽，通讯完毕，再由其他设备使用带宽。</p></blockquote><p style=text-align:start>工业交换机分为管理型交换机和非管理型交换机。非网管型交换机属于数据链路层设备。</p><h1 class=pgc-h-arrow-right>5几个标准</h1><h1 class=pgc-h-arrow-right>5.1链路汇聚</h1><p style=text-align:start>又称为端口聚合。链路汇聚指将多条物理链路（物理端口）聚合成一条逻辑上的链路（逻辑端口）（这条逻辑链路带宽相当于物理链路带宽之和），不单独配置物理口，这些物理链路作为这个逻辑通道的成员，配置时只配置这个逻辑通道。<strong>交换机根据用户配置的端口负荷分担策略决定网络封包从哪个成员端口发送到对端的交换机</strong>。<br>当交换机检测到其中一个成员端口的链路发生故障时，就停止在此端口上发送封包，并根据负荷分担策略在剩下的链路中重新计算报文的发送端口，故障端口恢复后再次担任收发端口。<br>链路聚合在增加链路带宽、实现链路传输弹性和工程冗余等方面是一项很重要的技术。</p><h1 class=pgc-h-arrow-right>5.2服务类别和服务质量</h1><p style=text-align:start><strong>服务质量</strong>（Quality of Service，QoS）指一个网络能够利用各种基础技术，<strong>为指定的网络通信提供更好的服务能力</strong>，是网络的一种安全机制, 用来解决网络延迟和阻塞等问题的一种技术。<br>与传输的带宽、传送的时延、数据的丢包率相关。</p><p style=text-align:start><strong>服务类别</strong> (Class of Service, CoS)就是让数据享受不同待遇的一种机制，是服务质量控制标准的一部分。<strong>CoS为每个应用分配不同的传输状态</strong>，从而使具有不同优先级的数据传输得到不同的对待。</p><p style=text-align:start><strong>二者区别</strong><br>Cos只是QoS的一种标记机制。</p><h1 class=pgc-h-arrow-right>5.3 其它</h1><blockquote><p>以下摘自西门子交换机配置手册。</p></blockquote><p style=text-align:start><strong>动态 MAC 老化 (Dynamic MAC Aging)</strong><br>设备自动学习连接节点的源地址。 此信息用于将数据帧转发到具体涉及的节点。这将减少其它节点的网络负载。如果设备在特定时间内未收到源地址与学习的地址相匹配的帧，则设备会删除学习的地址，这种机制称为“Aging”。</p><p style=text-align:start><strong>DCP转发</strong><br>DCP （Discovery and basic Configuration Protocol）是发现和基本配置协议，属于PROFINET 协议，用于<strong>发现无IP地址的节点</strong>，然后设置其IP地址、默认网关、子关掩码。</p><p style=text-align:start><strong>LLDP</strong><br>LLDP（Link Layer Discovery Protocol，链路层发现协议）是一种用来<strong>发现网络拓扑</strong>的方法。 网络组件使用 LLDP 与其相邻设备交换信息。支持 LLDP 的网络组件具有 LLDP 代理。 LLDP 代理会定期发送与其自身有关的信息，并从所连接设备接收信息。 接收到的信息存储在MIB 中。</p><p style=text-align:start><strong>RMON</strong><br>远程监视 (RMON) 允许在设备上收集和准备诊断数据，并由同样支持 RMON 的网络管理站使用 SNMP 读出诊断数据。</p><h1 class=pgc-h-arrow-right>6交换机冗余机制</h1><p style=text-align:start>通过构建冗余网络来保证工业网络的可靠性，确保车间与控制中心任意一条通讯线路故障，工业网络都能自动判断和进行网络重构。这种冗余结构会形成环网冗余，因此使用冗余协议来防止环网中间形成广播风暴。</p><h1 class=pgc-h-arrow-right>——<em>单环冗余</em>————</h1><h1 class=pgc-h-arrow-right>6.1生成树</h1><p style=text-align:start>当一个交换机有两个及以上的端口与其它交换机相连时，由于会产生冗余链路，从而产生“拓扑环”，即当某个网段的数据包通过某台交换机传输到另一个网段，而返回的数据包通过另一台交换机返回源地址的现象（<strong>即网络风暴</strong>）</p><blockquote><p>下图摘自https://blog.51cto.com/dengqi/1253320?source=drt<br>详解生成树协议(STP)</p></blockquote><div class=pgc-img><img alt=工业网络环网协议介绍：MRP和HRP onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4607a6c81b5c44be8e9e67a2722527f4><p class=pgc-img-caption></p></div><p><br>生成树协议（英语：Spanning Tree Protocol，STP）基本应用是防止交换机冗余链路产生的环路.用于确保以太网中无环路的逻辑拓扑结构.从而避免了广播风暴,大量占用交换机的资源.<br><strong>生成树协议工作原理</strong>:任意一交换机中如果到达根网桥有两条或者两条以上的链路，生成树协议都根据算法把其中一条切断,仅保留一条，从而保证任意两个交换机之间只有一条单一的活动链路。因为这种生成的这种拓扑结构很像是以根交换机为树干的树形结构，故为生成树协议。</p><p style=text-align:start><em>——以下为西门子自有协议（ HRP MRP 冗余 standby）——</em></p><h1 class=pgc-h-arrow-right>6.2HRP</h1><p style=text-align:start>高速冗余协议（HRP, High Redundancy Protocol)是适用于环型拓扑网络的一种冗余方法。 交换机通过环网端口互连。其中一台交换机组态为<strong>冗余管理器</strong> (RM, Redundancy Manager)，其它交换机为<strong>冗余客户端</strong>。 冗余管理器通过测试帧检查环网以确保其没有中断；冗余管理器通过环网端口发送测试帧并检查其它环网端口是否接收到这些测试帧；冗余客户端转发测试帧。</p><p style=text-align:start>1正常情况下，从冗余管理器端口发送的检测帧被第二个环网端口接受，则说明环网正常。接下来数据只从接通端口发送数据。</p><p style=text-align:start>2故障情况下，如果由于网络中断导致 RM 发送的测试帧无法到达其它环网端口，则 RM 将在自身的两个环网端口之间切换并立即将切换情况通知给冗余客户端。环中断后的重新组态时间最长为 0.3 秒。</p><blockquote><p>一般使用HRP代替生成树，因为HRP重组时间短，性能强。<br>如果要组成HRP，环中所有交换机都必须支持此功能。</p></blockquote><h1 class=pgc-h-arrow-right>6.3MRP</h1><p style=text-align:start>介质冗余协议(MRP, Media Redundancy Protocol)，用于环网内与非西门子设备组态。</p><h1 class=pgc-h-arrow-right>——<em>环网间冗余</em>————</h1><p style=text-align:start>环网间如果没有适当的协议就会产生环网，如果一个网络节点向网络中发送广播，则该广播会在环网间的环路中无限循环。几秒之后，网络负荷变高，以至于通讯无法进行。</p><h1 class=pgc-h-arrow-right>6.4冗余standby/备用冗余</h1><p style=text-align:start>该协议是HRP的扩展。<br>分为备用主交换机（主动端口）和备用从交换机（被动端口）。<br>1正常情况下，环网中交换机第一次启动，备用主交换机与备用从交换机会进行同步。 主交换机检查它的所有备用端口是否都连接有链路。有链路，它会向备用从交换机发出就绪信号。 备用从交换机也检查其备用端口，如果检查成功完成，则向备用主交换机发送“就绪”信号。此时，备用主交换机的备用端口才开始启用。 这就确保了启动交换机时不产生环路。</p><p style=text-align:start>2有两种故障情况：耦合中断和主交换机故障<br>2.1 <strong>耦合中断</strong>：如果主交换机有备用端口检测到中断，则主交换机向从交换机发送“被动”帧。从设备收到信息后，切换链路。<br>2.2 <strong>主交换机故障</strong>：如果主交换机故障，则主交换机没有向从交换机发送“主动”或“被动”帧。从设备由于未收到“主动”信息，会判断主设备故障，从而切换链路。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'工业','网络','环网'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>