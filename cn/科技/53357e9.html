<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>西门子PLC组织块与中断处理 | 极客快訊</title><meta property="og:title" content="西门子PLC组织块与中断处理 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/c18c30c3eb354da5b386d6588060c8da"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/53357e9.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/53357e9.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/53357e9.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/53357e9.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/53357e9.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/53357e9.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/53357e9.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/53357e9.html><meta property="article:published_time" content="2020-10-29T20:50:02+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:02+08:00"><meta name=Keywords content><meta name=description content="西门子PLC组织块与中断处理"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/53357e9.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>西门子PLC组织块与中断处理</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>组织块OB是操作系统与用户程序之间的接口，组织块由操作系统调用，组织块中的程序是用户编写的。S7 plc的组织块用来创建在特定的时间执行的程序或相应特定事件的程序，例如延时中断OB、外部硬件中断OB和错误中断OB等。</p><p>一、中断的基本概念</p><p>1、中断过程</p><p>中断处理用来实现对特殊内部事件或外部事件的快速响应，如果没有中断，CPU循环执行组织块OB1,因为除了背景组织块OB90以外，OB1的中断优先级最低，CPU检测到中断源的中断请求，操作系统在执行完当前程序的当前指令（即断点处）后，立即响应中断。CPU暂停正在执行的程序，调用中断源的中断组织块OB来处理，执行完中断组织块后，返回被中断的程序断点处继续执行原来的程序。</p><p>有中断事件发生时，如果没有下载相应的组织块，CPU将会进入STOP模式，即使生成和下载一个空的组织块，出现相应的中断事件时，CPU也不会进入STOP模式。</p><p>PLC的中断源可能来自I/O模块的硬件中断，或者来自CPU模块内部的软件中断，例如时间中断、延时中断、循环中断和编程错误引起的中断。</p><p>一个OB的执行被另一个OB中断时，操作系统对现场进行保护，被中断的OB的局部数据压入L堆栈（局部数据堆栈），被中断的断点处的现场信息保存在I堆栈（中断堆栈）和B堆栈（块堆栈）中。中断程序不是由逻辑块调用，而是在中断事件发生时由操作系统调用，因为不能预知系统何时调用中断程序，中断程序不能改写其他程序中可能正在使用的存储器，中断程序应尽可能的使用局部变量。编写中断程序应越短越好，减少中断程序的执行时间，减少对其他事件处理的延迟，否则可能引起主程序控制的设备操作异常。</p><p>2、组织块的分类</p><p>组织块只能由操作系统启动，它由变量声明表和用户编写的控制程序组成。</p><p>（1）启动组织块：用于系统初始化，CPU上电或操作模式切换到RUN时，S7-300执行OB100,S7-400根据组态的启动方式执行OB100~OB102中的一个。</p><p>（2）循环执行OB1:需要连续执行的程序放在OB1中，循环执行。</p><p>（3）定期执行的组织块：包括时间中断组织块OB10~OB17，和循环中断组织块OB30~OB38，可以根据设定的日期时间或时间间隔执行中断程序。</p><p>（4）事件驱动的组织块：延时中断OB20~OB23在过程事件出现后延时一定时间再执行中断程序，硬件中断OB40~OB47用于需要快速响应的过程事件，时间出现时马上中止当前正在执行的程序，执行对应的中断程序。diangon.com版权所有！异步错误中断0B80~OB87和同步错误中断OB121、OB122用来决定出现错误时系统如何响应。</p><p>3、中断的优先级：也就是组织块的优先级，如果在执行中断程序（组织块）时，又检测到一个终端请求，CPU将比较两个中断源的中断优先级，如果优先级相同，按照产生中断请求的先后次序进行处理。如果后者的优先级比正在执行的OB的优先级高，将中止当前的正在处理的OB，</p><p>4、对终端的控制：时间中断和延时中断有专用的允许处理中断和禁止中断的系统功能SFC。</p><p>SFC39“DIS_INT”用来禁止中断和异步错误处理，可以禁止所有中断，有选择的禁用某些优先级范围的中断，或者只禁止指定的某个中断；</p><p>SFC40“EN_INT”用来激活新的中断和异步错误处理，激活中断是指允许处理中断，做好了在中断事件出现时执行对应的组织块的准备。可以全部允许或有选择的允许。</p><p>SFC41“DIS_AIRT”延迟处理比当前优先级更高的中断和异步错误，直到用SFC42允许处理中断或当前OB执行完毕，SFC42“EN_AIRT”用来允许立即处理被SFC41暂时禁止的中断和异步错误，SFC41和SFC42配对使用。</p><p><br></p><p>二、启动组织块</p><p>1、CPU的启动模式和启动组织块</p><p>400的CPU有3中启动方式，暖启动、热启动和冷启动，300CPU只能暖启动，参见下图：</p><div class=pgc-img><img alt=西门子PLC组织块与中断处理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c18c30c3eb354da5b386d6588060c8da><p class=pgc-img-caption></p></div><p>用户可以通过在启动组织块中编写程序，用来设置CPU的初始化操作，例如设置开始运行时的某些变量的初始值和输出模块的初始值等。</p><p>1）暖启动过程映像数据以及非保持的存储器位、定时器和计数器被复位。具有保持功能的存储器位、定时器、计数器和所有的数据块将保留原数值，执行一个OB100后，循环执行OB1，将模式选择开关从STOP切换到RUN，执行一次暖启动。</p><p>2）热启动：400CPU在RUN模式下电源突然丢失，很快又重新上电，将执行OB101，自动完成热启动，从上次RUN模式结束时程序被中断之处继续执行，不对计数器等复位。</p><p>3）冷启动：所有系统存储区均被清除，即复位为零，包括有保持功能的存储区。调用OB102后循环执行OB1。</p><p>2、循环中断组织块</p><p>循环中断组织块用于按精确时间间隔循环执行中断程序，例如周期性执行闭环控制系统PID控制程序，间隔时间从cpu从STOP切换到RUN开始计算。S7-300大多数只能使用OB35,其余CPU可以实用的循环中断OB的个数和CPU型号有关。时间间隔不能小于5ms。时间间隔过短，还没有执行完循环中断程序又开始调用它，将会产生时间错误时间，调用OB80,如果没有调用OB80,CPU将进入STOP。</p><p>举例说明：</p><p>硬件组态如下：采用CPU315-2DP，双击硬件组态中的CPU，打开属性对话框，由【周期性中断】选项卡可知只能使用OB35。</p><div class=pgc-img><img alt=西门子PLC组织块与中断处理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b95bef87b24d4d0aa005d6a4d3e57811><p class=pgc-img-caption></p></div><p>默认的循环周期为100ms，改成1000ms。</p><p>OB100程序</p><p><br></p><p>3、时间中断组织块</p><p>300CPU只能使用OB10，400CPU可以使用OB10~17，可以设置在某一个特定的日期时间产生一次时间中断，也可以设置从设定日期时间开始，周期性的重复产生中断，可以用SFC28~SFC30设置、取消和激活时间中断。</p><p>1）、基于硬件组态的时间中断</p><p>要求在到达设置的日期和时间时，用Q4.0自动启动某台设备。具体如下：</p><p>硬件组态：打开CPU属性中的“时刻中断”选项卡，设置执行启动设备的日期和时间，执行方式为“一次”。</p><div class=pgc-img><img alt=西门子PLC组织块与中断处理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/43e10b6a21cd411a809c09ed3597af46><p class=pgc-img-caption></p></div><p>生成OB10</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'西门子','PLC','组织'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>