<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Pythonè‡ªåŠ¨åŒ–åŠå…¬â€”â€”è¿™é‡Œæœ‰ä½ ä¸çŸ¥é“çš„Pythonæ‰¹é‡å¤„ç†å°æŠ€å·§ | æå®¢å¿«è¨Š</title><meta property="og:title" content="Pythonè‡ªåŠ¨åŒ–åŠå…¬â€”â€”è¿™é‡Œæœ‰ä½ ä¸çŸ¥é“çš„Pythonæ‰¹é‡å¤„ç†å°æŠ€å·§ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/dfic-imagehandler/07750aec-3b5a-4984-8fcb-ff0c813cfb40"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/543d61c.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/543d61c.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/543d61c.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/543d61c.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/543d61c.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/543d61c.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/543d61c.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/543d61c.html><meta property="article:published_time" content="2020-10-29T20:54:10+08:00"><meta property="article:modified_time" content="2020-10-29T20:54:10+08:00"><meta name=Keywords content><meta name=description content="Pythonè‡ªåŠ¨åŒ–åŠå…¬â€”â€”è¿™é‡Œæœ‰ä½ ä¸çŸ¥é“çš„Pythonæ‰¹é‡å¤„ç†å°æŠ€å·§"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/543d61c.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Pythonè‡ªåŠ¨åŒ–åŠå…¬â€”â€”è¿™é‡Œæœ‰ä½ ä¸çŸ¥é“çš„Pythonæ‰¹é‡å¤„ç†å°æŠ€å·§</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>ä»Šå¤©ç»™å¤§å®¶åˆ†äº«å‡ ä¸ªPythonæ‰¹é‡å¤„ç†çš„åŸºæ“ï¼Œè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€æ•´ï¼</p><p>å–œæ¬¢çš„æ”¶è—ï¼Œè½¬å‘ï¼Œç‚¹èµå…³æ³¨ï¼Œæ„Ÿè°¢æ‚¨ä¸€ç›´ä»¥æ¥çš„æ”¯æŒï¼</p><p><br></p><div class=pgc-img><img alt=Pythonè‡ªåŠ¨åŒ–åŠå…¬â€”â€”è¿™é‡Œæœ‰ä½ ä¸çŸ¥é“çš„Pythonæ‰¹é‡å¤„ç†å°æŠ€å·§ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/07750aec-3b5a-4984-8fcb-ff0c813cfb40><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>æ‰¹é‡å‹ç¼©</strong></h1><pre><code>import  zipfileimport osimport time#å¾…å‹ç¼©çš„æ–‡ä»¶å¤¹start_dir = r"C:\Users\CQ375\Desktop\å‹ç¼©å‰"  #ç›®çš„åœ°æ–‡ä»¶å¤¹target_dir = r"C:\Users\CQ375\Desktop\å‹ç¼©å"#å¦‚å½“å‰æ—¥æœŸçš„æ–‡ä»¶å¤¹ä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªï¼Œå¦‚æœå­˜åœ¨åˆ™æ— éœ€è¦åˆ›å»ºtoday = target_dir + os.sep + time.strftime('%Y%m%d')if not os.path.exists(today):    os.mkdir(today)    print('Successfully created directory', today)#å–å‡ºstart_diræ–‡ä»¶å¤¹ä¸‹çš„æ¯ä¸ªæ–‡ä»¶è¿›è¡Œå‹ç¼©å¤‡ä»½for item in os.listdir(start_dir):    file_news = today+os.sep+item+'.zip'     z = zipfile.ZipFile(file_news,'w')     z.write(start_dir+os.sep+item,item) #ä»å¾…å‹ç¼©æ–‡ä»¶å¤¹å–å‡ºæ–‡ä»¶ï¼Œå†™å…¥åˆ°å¯¹è±¡zï¼›start_dir+os.sep+itemä»£è¡¨çš„æ˜¯è¦å†™å…¥zçš„æ–‡ä»¶æ˜¯å“ªä¸€ä¸ªz.close() #å®Œæˆå†™å…¥åå…³é—­å¯¹è±¡print(item)print ('å‹ç¼©æˆåŠŸ')</code></pre><h1 class=pgc-h-arrow-right><strong>æ‰¹é‡æ–°å»ºæ–‡ä»¶å¤¹</strong></h1><pre><code>import os file_path=os.path.abspath(r"C:\Users\CQ375\Desktop\æ–°å»ºæ–‡ä»¶å¤¹")for i in range(1,26):    a="å»ºç­‘ç¼–å·{0}".format(i)    file_name=file_path+"\\"+a    os.makedirs(file_name)</code></pre><h1 class=pgc-h-arrow-right><strong>æ‰¹é‡è½¬æ¢æ–‡ä»¶æ ¼å¼ï¼ˆxls-xlsxï¼‰</strong></h1><pre><code>import win32com.client as win32import os.pathimport osdef GetDesktopPath():    return os.path.join(os.path.expanduser("~"), 'Desktop')def xlsToxlsx():    rootdir = f'{GetDesktopPath()}\\data\\è½¬æ¢å‰' #éœ€è¦è½¬æ¢çš„xlsæ–‡ä»¶å­˜æ”¾å¤„    rootdir1 = r"C:\Users\CQ375\Desktop\data\è½¬æ¢å" #è½¬æ¢å¥½çš„xlsxæ–‡ä»¶å­˜æ”¾å¤„    files = os.listdir(rootdir) #åˆ—å‡ºxlsæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶    num = len(files) #åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶çš„ä¸ªæ•°    for i in range(num): #æŒ‰æ–‡ä»¶ä¸ªæ•°æ‰§è¡Œæ¬¡æ•°        kname = os.path.splitext(files[i])[1] #åˆ†ç¦»æ–‡ä»¶åä¸æ‰©å±•åï¼Œè¿”å›(f_name, f_extension)å…ƒç»„        if kname == '.xls': #åˆ¤å®šæ‰©å±•åæ˜¯å¦ä¸ºxls,å±è”½å…¶å®ƒæ–‡ä»¶            fname = rootdir + '\\' + files[i] #åˆæˆéœ€è¦è½¬æ¢çš„è·¯å¾„ä¸æ–‡ä»¶å            fname1 = rootdir1 + '\\' + files[i] #åˆæˆå‡†å¤‡å­˜æ”¾è½¬æ¢å¥½çš„è·¯å¾„ä¸æ–‡ä»¶å            excel = win32.gencache.EnsureDispatch('Excel.Application') #è°ƒç”¨win32æ¨¡å—            wb = excel.Workbooks.Open(fname) #æ‰“å¼€éœ€è¦è½¬æ¢çš„æ–‡ä»¶            wb.SaveAs(fname1+"x", FileFormat=51) #æ–‡ä»¶å¦å­˜ä¸ºxlsxæ‰©å±•åçš„æ–‡ä»¶            wb.Close()            excel.Application.Quit()if __name__ == '__main__':    xlsToxlsx()</code></pre><h1 class=pgc-h-arrow-right><strong>æ‰¹é‡åˆå¹¶</strong></h1><pre><code>#æ•°æ®åˆå¹¶ï¼Œä¸åŒçš„æ–‡ä»¶åˆå¹¶åˆ°åŒä¸ªè¡¨ä¸­ä¸åŒçš„sheetä¸­import pandas as pdimport os# ç»“æœæ–‡ä»¶result = pd.ExcelWriter('C:/Users/CQ375/Desktop/data/åˆå¹¶ç»“æœ.xlsx')# è·å–è¡¨æ ¼åˆ—è¡¨origin_file_list = os.listdir(r'C:\Users\CQ375\Desktop\data\è½¬æ¢å')print(origin_file_list)# å¾ªç¯éå†è¡¨æ ¼for i in origin_file_list:    print(i)    excel_file_name = i    #æ‹¼æ¥æ¯ä¸ªæ–‡ä»¶çš„è·¯å¾„    file_path = 'C:/Users/CQ375/Desktop/data/è½¬æ¢å/%s' % i    print(file_path)# è¯»å–æ–‡ä»¶å†…å®¹         #content = pd.read_excel(file_path, skiprows=[0])  # è·³è¿‡0è¡Œ    content = pd.read_excel(file_path)    sheet_name = i[:len(i) - 4]    content.to_excel(result, sheet_name, index=False)result.save()</code></pre><h1 class=pgc-h-arrow-right><strong>æ‰¹é‡æå–åŸºæœ¬ä¿¡æ¯è¡¨</strong></h1><pre><code>#åŠ è½½æ–‡ä»¶æ¸…å•root=r"C:\Users\CQ375\Desktop\èµ„æ–™æ–‡ä»¶å¤¹"mylist=[]for dirpath,dirnames,filenames in os.walk(root):    for filepath in filenames:        mylist.append(os.path.join(filepath))#æ„å»ºæå–æ•°æ®è¡¨å¤´data=pd.DataFrame({"åç§°":["å»ºç­‘ç¼–å·","å»ºç­‘åœ°å€","å»ºç­‘é¢ç§¯","è”ç³»ç”µè¯"]})    for i in range(len(mylist)):    try:        pd.set_option("display.max.columns",None)        pd.set_option("display.precision",2)        df=pd.read_excel(r"C:\Users\CQ375\Desktop\èµ„æ–™æ–‡ä»¶å¤¹\{0}".format(mylist[i]),header=2)        df1=df.iloc[:,[0,2,3,4]]        df2=df1.copy()        building_name=df2.loc[1][1]        #å»ºç­‘ç¼–å·        building_id=df2.loc[2][1]        #å»ºç­‘åœ°å€        address=df2.loc[1][1]        # å»ºç­‘é¢ç§¯        building_area=df2.loc[4][1]        # è”ç³»ç”µè¯        TEL=df2.loc[3][3]        data[mylist[i]]=[building_id,address,building_area,TEL]    except Exception as e:        continue DATA=data.set_index("åç§°").T DATA</code></pre><h1 class=pgc-h-arrow-right><strong>æ‰¹é‡æå–å³°å€¼æ•°æ®</strong></h1><pre><code>DATA=pd.DataFrame({"æå–å‚æ•°":["å»ºç­‘åç§°","å»ºç­‘åˆ†ç±»","æ—¶é—´","å°æ—¶ç”µè€—é‡"]})  for i in range(len(mylist)):    try:        df=pd.read_excel(r"C:\Users\CQ375\Desktop\data\æŒ‡æ ‡æå–\{0}.xlsx".format(mylist[4]))        building_name=df.å»ºç­‘åç§°.unique()[0]        building_type=df.å»ºç­‘åˆ†ç±».unique()[0]        df1=df[["æ—¶é—´","ç”µè€—é‡"]].set_index("æ—¶é—´")        df2=pd.DataFrame(df1).dropna()        df3=df2.drop_duplicates("ç”µè€—é‡")        df4=df3.sort_values(by="ç”µè€—é‡",ascending=False)         EP_list1=list(df4["ç”µè€—é‡"].values)        median_a = np.median(list(EP_list1))        #æˆªå–å¤§äºä¸­ä½æ•°çš„æ•°æ®ç­›é€‰æ¯”è¾ƒ        df5=df4[df4.ç”µè€—é‡&gt;median_a].copy()        data=list(df5["ç”µè€—é‡"].values)#æˆªå–æ»¡è¶³ä¸€å®šæ¡ä»¶çš„æ•°æ®ä¿å­˜ï¼Œå»é™¤å¼‚å¸¸ç‚¹        def spread(lst):            length=len(lst)            for k in range(1,length):                if lst[k-1]/lst[k]&lt;1.5:                    yield k-1,lst[k-1]        #æ—¶é—´ç‚¹        time_index=list(spread(data))[0][0]        time_point=df5.index[time_index]        max_1=list(spread(data))[0][1]        DATA[mylist[i]]=[building_name,building_type,time_point,max_1]    except Exception as e:            continueDATA.T.to_excel(r"C:\Users\CQ375\Desktop\data\ç»“æœ.xlsx")</code></pre><p>åŸºæ“å‹¿6ï¼Œå–œæ¬¢çš„æ”¶è—ï¼Œä¸€é”®æ‰¹é‡å¤„ç†ï¼Œè§£æ”¾ä½ çš„åŒæ‰‹ã€‚</p><p><br></p><div class=pgc-img><img alt=Pythonè‡ªåŠ¨åŒ–åŠå…¬â€”â€”è¿™é‡Œæœ‰ä½ ä¸çŸ¥é“çš„Pythonæ‰¹é‡å¤„ç†å°æŠ€å·§ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/9805979d-40e8-4f39-9468-d268e351beff><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Python','è‡ªåŠ¨åŒ–','åŠå…¬'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>