<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Python实用案例编程入门：第八章 如何自动连接WIFI | 极客快訊</title><meta property="og:title" content="Python实用案例编程入门：第八章 如何自动连接WIFI - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/73b91c7a09fc41a89e2b87813b6ab246"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/56b406e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/56b406e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/56b406e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/56b406e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/56b406e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/56b406e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/56b406e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/56b406e.html><meta property="article:published_time" content="2020-10-29T20:54:13+08:00"><meta property="article:modified_time" content="2020-10-29T20:54:13+08:00"><meta name=Keywords content><meta name=description content="Python实用案例编程入门：第八章 如何自动连接WIFI"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/56b406e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Python实用案例编程入门：第八章 如何自动连接WIFI</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>本章的主题为介绍如何自动连接WIFI。如果你们公司也是使用WIFI网络环境办公，那么也有可能遇到同样的问题。在介绍具体实现之前，会先介绍一些常用的基础库，比如sys，time等。</p><div class=pgc-img><img alt="Python实用案例编程入门：第八章 如何自动连接WIFI" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/73b91c7a09fc41a89e2b87813b6ab246><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>8.1 要解决什么问题</h1><p>如果公司的网络环境是WIFI，那么随着笔记本位置的移动，就需要接入就近的无线路由器。正常情况下使用是没问题的，但是有段时间网络有点问题，不能很快的正常接入网络。需要手动重新连接。即使电脑位置不变，也总是会断网，只有手动重新连接。所以，既然手动能解决的问题，那么我们为何不写个程序帮助我们默默的把这件事做了呢？</p><h1 class=pgc-h-arrow-right>8.2 实现思路</h1><p>现在我们需要思考一下如何去实现。一个最简单的思路就是让程序模拟我们自己的动作。</p><p>我们会去先ping一下百度，如果能ping通，那就表明网络是通的，否则就表明网络断了。一旦检测到网络断了，那么就需要去进行连接。一个最简单的方法就是利用dos命令种的netsh命令来管理网络。</p><p>如果觉得上面的办法太简易且不专业，那我们可以再用更专业的思路去实现我们的想法。那就是pywifi模块，不需要去通过ping百度来确定网络是否正常了。而且代码也会更灵活，可以配置WIFI名称密码等。</p><p>用上面思路实现的程序都需要我们手动去执行一次。我们还有办法，那就是将上面的程序实现为服务，这样就不用每次启动都执行一次了。</p><p>我们这里有点过设计的嫌疑，也有点类似茴香豆的茴字有多少中写法的味道。但从做技术的角度来讲，我们需要也应该知道不同方案的优缺点，以便于我们做出更适合我们需求的方案选择。</p><h1 class=pgc-h-arrow-right>8.3 相关模块的安装及介绍</h1><p>本节将会涉及time模块，sys模块，subprocess模块和pywifi模块。接下来会逐个进行详细介绍。</p><h1 class=pgc-h-arrow-right>8.3.1 time模块</h1><p>time模块提供了时间相关的各种函数。</p><p>time.asctime()函数可以将结构体struct_time所代表的时间转换为这样的字符串'Sun Jun 19 13:31:15 1994'。我们可以通过time.localtime()函数得到结构体struct_time。</p><p>time.sleep()函数的入参单位是秒，如果线程需要被挂起，可以通过调用此函数达到该目的。这里的入参也可以是小数，表示更精确的睡眠时间。我们将会使用该函数进行必要的等待以确保另一件事情结束。</p><p>time.strftime()函数也用于格式化时间。</p><pre><code>&gt;&gt;&gt; import time&gt;&gt;&gt; time.strftime('%Y%m%d',time.localtime(time.time()))'20190714'&gt;&gt;&gt;&gt;&gt;&gt; time.strftime('%Y-%m-%d')'2019-07-14'&gt;&gt;&gt;</code></pre><h1 class=pgc-h-arrow-right>8.3.2 sys模块</h1><p>sys模块提供了对Python解释器使用的一些变量的访问，并可以进行一些修改，例如对环境变量PATH的读取和修改，并提供了某些和解释器进行交互的函数以使我们的程序能够和解释器进行交互。</p><p>例如，sys.argv会将命令行参数以list的形式传递给Python脚本，sys.argv[0]是脚本的名字，sys.argv[1]是第一个参数，以此类推。</p><p>sys.exit()表示退出程序，也可以带参数表示退出码，如果有其他程序调用该程序，即可以通过返回的数字来确定被调用程序的退出原因。</p><p>sys.implementation查看当前正在运行的Python解释器的版本信息。</p><pre><code>&gt;&gt;&gt; sys.implementationnamespace(cache_tag='cpython-36', hexversion=50726384, name='cpython', version=sys.version_info(major=3, minor=6, micro=5, releaselevel='final', serial=0))&gt;&gt;&gt;</code></pre><p>sys.stdin，sys.stddout，sys.stderr解释器用于标准输入，标准输出和错误。</p><h1 class=pgc-h-arrow-right>8.3.3 subprocess模块</h1><p>subprocess模块，我们可以利用该模块创建一个新的进程。如果需要的话，可以通过入口连接到程序的输入，输出和错误管道，并通过相应的管道获取程序的输入，输出和错误返回。</p><p>subprocess.run()函数可以运行由参数组成的命令的字符串，并且直到命令完成，在完成后返回一个完成实例。</p><pre><code>&gt;&gt;&gt; import subprocess&gt;&gt;&gt; subprocess.run("ping -n 1 www.baidu.com", shell=True)正在 Ping www.a.shifen.com [180.97.33.108] 具有 32 字节的数据:来自 180.97.33.108 的回复: 字节=32 时间=33ms TTL=55180.97.33.108 的 Ping 统计信息:数据包: 已发送 = 1，已接收 = 1，丢失 = 0 (0% 丢失)，往返行程的估计时间(以毫秒为单位):最短 = 33ms，最长 = 33ms，平均 = 33msCompletedProcess(args='ping -n 1 www.baidu.com', returncode=0)&gt;&gt;&gt;</code></pre><p>subprocess.PIPE代表管道是一个特殊的值，使用该值可以将标准流的管道打开。打开后可以通过sys.stdin获取输入，通过sys.stdout读出输出结果，同时也可以通过sys.stderr得到错误输出。</p><p>subprocess.Popen()在新进程中执行子程序，在本书中我们将会多次使用该接口，某些场景下我们不需要等待被调用程序执行完成或返回，只需要将其启动即可。在预订测试线章节的例子中，我们将使用该接口去启动升级切换程序，启动后无需等待其返回。如果需要等待执行完成，则只需要调用wait()接口等待其完成即可。</p><pre><code>import subprocess, osp = subprocess.Popen("dir", cwd=os.getcwd(), shell=True,stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)p.wait()</code></pre><p>如上面代码中使用的一样，wait()等待子程序结束。同时可以设置等待超时时间。</p><h1 class=pgc-h-arrow-right>8.3.4 pywifi模块</h1><p>pywifi模块提供了一个跨平台的wifi控制模块，是用Python实现的，可以利用该模块进行操控wifi，这也是本章的例子要进行介绍的主题。</p><p>在命令行中输入下面的命令进行安装：</p><pre><code>C:\Users\ggangliu&gt;pip install pywifiCollecting pywifiDownloading https://files.pythonhosted.org/packages/89/55/170a52685eeefeab36bfaf26bdca629263a0a28efffc3b556b2cc86ab966/pywifi-1.1.12-py3-none-any.whlInstalling collected packages: pywifiSuccessfully installed pywifi-1.1.12C:\Users\ggangliu&gt;</code></pre><p>通常只有一个wifi接口，所以可以用索引0来得到WIFI接口。这里可以看到本机的WIFI接口名为Intel(R) Dual Band Wireless-AC 8265。</p><pre><code>&gt;&gt;&gt; import pywifi&gt;&gt;&gt; wifi = pywifi.PyWiFi()&gt;&gt;&gt; iface = wifi.interfaces()[0]&gt;&gt;&gt; iface&lt;pywifi.iface.Interface object at 0x000001829BB18358&gt;&gt;&gt;&gt; print(iface.name())Intel(R) Dual Band Wireless-AC 8265&gt;&gt;&gt;</code></pre><h1 class=pgc-h-arrow-right>8.4 代码实现</h1><p>到现在，我们万事俱备只欠编码。接下来就开始将我们的思想变为代码。</p><h1 class=pgc-h-arrow-right>8.4.1 编写伪码</h1><p>开始编码前，我们先写个基本的伪码，相当于概要设计。在小的程序中编写伪码的优势不是很明显，但希望初学者能够给从一开始就养成一个良好的习惯。这些良好的习惯不局限于写伪码，有很多好的编码规则，我们应该在学习之初就进行学习，并强迫自己遵守。慢慢的就变成自己编程能力的一部分，而这些好习惯也一定让您终身受益。</p><pre><code>#首先，我们需要周期性的检测，所以必须起一个while循环#while True:#ping一下百度看看能否ping通#如果可以ping通，证明网络没问题，#否则认为网络断了#if 网络断了:#重连网络#sleep(5) 5秒后重新检测</code></pre><h1 class=pgc-h-arrow-right>8.4.2 Python代码</h1><p>基于伪码的思想，我们编写的第一个简易版本的程序如下。如我们最初所想的，就是用ping百度的方法来确认网络是否正常。虽然简易，但功能没问题，能解决我们的问题，所以不管黑猫白猫能抓住老鼠的就是好猫。</p><pre><code># -*- coding: utf-8 -*-"""该程序用于重连wifi，避免人手动去重连我们利用dos命令netsh进行重连操作，假设我的网络名为GGangnetsh wlan connect name=GGang"""from time import sleepfrom subprocess import runwhile True:sleep(3)p = run("ping -n 1 www.baidu.com", shell=True)print(p)if 1 == p.returncode:run("netsh wlan connect name=GGang", shell=True)sleep(5)</code></pre><p>现在，我们不满足于解决问题，我们想让代码更专业点，通过检测WIFI接口的状态来确认网络是否正常。</p><p>下面就是我们的优化，主要目的重新实现网络状态判断的部分。</p><pre><code># -*- coding: utf-8 -*-"""Created on Mon Nov 5 15:48:47 2018@author: ggang.liu"""import pywifi, time, sys#保存包中写义的常量from pywifi import constdef wifi_connect_status():"""判断本机是否有无线网卡,以及连接状态:return: 已连接或存在无线网卡返回1,否则返回0"""#创建一个院线对象wifi = pywifi.PyWiFi()#取当前机器,第一个无线网卡iface = wifi.interfaces()[0] #有可能有多个无线网卡,所以要指定#判断是否连接成功if iface.status() in [const.IFACE_CONNECTED,const.IFACE_INACTIVE]:print('wifi已连接')return 1else:print('wifi未连接')return 0def scan_wifi():"""扫苗附件wifi:return: 扫苗结果对象"""#扫苗附件wifiwifi = pywifi.PyWiFi()iface = wifi.interfaces()[0]iface.scan() #扫苗附件wifitime.sleep(1)basewifi = iface.scan_results()for i in basewifi:print('wifi扫苗结果:{}'.format(i.ssid)) # ssid 为wifi名称print('wifi设备MAC地址:{}'.format(i.bssid))return basewifidef connect_wifi(ssid, password):wifi = pywifi.PyWiFi() # 创建一个wifi对象ifaces = wifi.interfaces()[0] # 取第一个无限网卡print(ifaces.name()) # 输出无线网卡名称ifaces.disconnect() # 断开网卡连接time.sleep(3) # 缓冲3秒profile = pywifi.Profile() # 配置文件profile.ssid = ssid # wifi名称profile.auth = const.AUTH_ALG_OPEN # 需要密码profile.akm.append(const.AKM_TYPE_WPA2PSK) # 加密类型profile.cipher = const.CIPHER_TYPE_CCMP # 加密单元profile.key = password #wifi密码ifaces.remove_all_network_profiles() # 删除其他配置文件tmp_profile = ifaces.add_network_profile(profile) # 加载配置文件print("Connecting, wait a moment...")ifaces.connect(tmp_profile) # 连接time.sleep(5) # 尝试10秒能否成功连接isok = Trueif ifaces.status() == const.IFACE_CONNECTED:print("Connection successful")else:print("Connection failed")isok = Falsetime.sleep(1)return isokif __name__ == "__main__":password = ''if len(sys.argv) &gt;= 2:password = sys.argv[1]else:print("Usage: connect-wifi-while-start.exe [password]")connect_wifi('GGang', password)</code></pre><h1 class=pgc-h-arrow-right>8.4.3 打包为exe文件进行发布</h1><p>我们的程序编写好了，也运行良好，能解决我们的问题。现在如果想把它分享给我们亲爱的其他同事，我们该怎么做呢？最好是将它打包为EXE文件，否则使用的人也需要安装Python，且必须安装所有的依赖库，似乎太麻烦了。没等听您解释完就不想用了。</p><p>这里我们同时也提供了打包为EXE的代码。由于我们使用pyinstaller进行打包，所以需要提前安装。当然安装也很简单，使用pip命令就可以安装。</p><pre><code>C:\Users\ggangliu&gt;pip install pyinstallerCollecting pyinstallerUsing cached https://files.pythonhosted.org/packages/e2/c9/0b44b2ea87ba36395483a672fddd07e6a9cb2b8d3c4a28d7ae76c7e7e1e5/PyInstaller-3.5.tar.gzInstalling build dependencies ... doneGetting requirements to build wheel ... donePreparing wheel metadata ... doneRequirement already satisfied: setuptools in c:\python36-32\lib\site-packages (from pyinstaller) (40.6.2)Collecting altgraph (from pyinstaller)Downloading https://files.pythonhosted.org/packages/0a/cc/646187eac4b797069e2e6b736f14cdef85dbe405c9bfc7803ef36e4f62ef/altgraph-0.16.1-py2.py3-none-any.whlCollecting pefile&gt;=2017.8.1 (from pyinstaller)Downloading https://files.pythonhosted.org/packages/36/58/acf7f35859d541985f0a6ea3c34baaefbfaee23642cf11e85fe36453ae77/pefile-2019.4.18.tar.gz (62kB)|████████████████████████████████| 71kB 24kB/sCollecting pywin32-ctypes&gt;=0.2.0 (from pyinstaller)Downloading https://files.pythonhosted.org/packages/9e/4b/3ab2720f1fa4b4bc924ef1932b842edf10007e4547ea8157b0b9fc78599a/pywin32_ctypes-0.2.0-py2.py3-none-any.whlRequirement already satisfied: future in c:\python36-32\lib\site-packages (from pefile&gt;=2017.8.1-&gt;pyinstaller) (0.17.1)Building wheels for collected packages: pyinstallerBuilding wheel for pyinstaller (PEP 517) ... doneCreated wheel for pyinstaller: filename=PyInstaller-3.5-cp36-none-any.whl size=2877932 sha256=0a9c02249d51dc0dab0929d145bba34b557890514e969488d96df61440888f50Stored in directory: C:\Users\ggangliu\AppData\Local\pip\Cache\wheels\c6\a4\e0\d9a1c5d3d876eb0675171281c293aed80839115e2eb022e6d2Successfully built pyinstallerInstalling collected packages: altgraph, pefile, pywin32-ctypes, pyinstallerRunning setup.py install for pefile ... doneSuccessfully installed altgraph-0.16.1 pefile-2019.4.18 pyinstaller-3.5 pywin32-ctypes-0.2.0C:\Users\ggangliu&gt;安装成功后我们就可以通过下面的代码进行打包了。import os, shutil#删除上次打包生成的临时目录if os.path.exists('dist'):shutil.rmtree("dist")if os.path.exists('build'):shutil.rmtree("build")if os.path.exists('__pycache__'):shutil.rmtree("__pycache__")os.system("pyinstaller -F -c -i images/wifi.ico connect-wifi-while-start.py")shutil.copyfile("dist/connect-wifi-while-start.exe", "./connect-wifi-while-start.exe")shutil.rmtree("dist")shutil.rmtree("build")shutil.rmtree("__pycache__")</code></pre><p>注意，images/wifi.ico这个图标文件如果不存在，可以将打包命令中的这个参数删除。</p><p>这里顺便提一下，有一些网站是可以将图片转换为ico图标文件，所以有需要的话，可以进行百度或谷歌就找到这样的网站进行转换。</p><h1 class=pgc-h-arrow-right>8.5 本章小结</h1><p>本章我们学习如何自动连接WIFI，在这个过程中我们认识了几个基本的库sys，time，subprocess和pywifi。通过一些基本的学习代码以及实战案例中的使用，您应该能有一个基本的了解。在后面的章节中我们将会不断使用到这些基础库，随着不断的重复学习，我相信逐渐的都能够熟练的掌握其用法。</p><p>编程就是这样一个过程，每过一段时间我们再回头看我们写过的代码就会看出一些问题，或者一些让你自己觉得不满意的地方。这证明我们在不断的进步。所以坚持学习，定会有所收获。</p><hr><p>欢迎关注，转发，收藏，感谢支持</p><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6843408184133026316/?group_id=6843408184133026316" rel="noopener noreferrer" target=_blank>Python实用案例编程入门：第一章 Python概述及为什么学Python</a></p><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6848120388161896963/?group_id=6848120388161896963" rel="noopener noreferrer" target=_blank>Python实用案例编程入门：第二章 字符串</a></p><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6848251233933722116/?group_id=6848251233933722116" rel="noopener noreferrer" target=_blank>Python实用案例编程入门：第三章 列表和元组</a></p><p></p><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6848984476630925827/?group_id=6848984476630925827" rel="noopener noreferrer" target=_blank>Python实用案例编程入门：第四章 字典和文件</a></p><p></p><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6849368336879485452/?group_id=6849368336879485452" rel="noopener noreferrer" target=_blank>Python实用案例编程入门：第五章 函数和类</a></p><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6849726990082130436/?group_id=6849726990082130436" rel="noopener noreferrer" target=_blank>Python实用案例编程入门：第六章 控制流语句</a></p><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6850107165097591300/?group_id=6850107165097591300" rel="noopener noreferrer" target=_blank>Python实用案例编程入门：第七章 调式手段</a></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Python','实用','编程'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>