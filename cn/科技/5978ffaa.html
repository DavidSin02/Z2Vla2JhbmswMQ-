<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Googleå®˜æ–¹MVP+Dagger2æ¶æ„è¯¦è§£ | æå®¢å¿«è¨Š</title><meta property="og:title" content="Googleå®˜æ–¹MVP+Dagger2æ¶æ„è¯¦è§£ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/d46de2bbbe8a4c669aab49adf79e1104"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5978ffaa.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5978ffaa.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5978ffaa.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5978ffaa.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5978ffaa.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5978ffaa.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5978ffaa.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5978ffaa.html><meta property="article:published_time" content="2020-10-29T21:12:37+08:00"><meta property="article:modified_time" content="2020-10-29T21:12:37+08:00"><meta name=Keywords content><meta name=description content="Googleå®˜æ–¹MVP+Dagger2æ¶æ„è¯¦è§£"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/5978ffaa.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Googleå®˜æ–¹MVP+Dagger2æ¶æ„è¯¦è§£</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>1 å‰è¨€</h1><p>å‰æ®µæ—¶é—´åˆ†äº«äº†ä¸€ç¯‡æ–‡ç« ï¼š<strong>googleå®˜æ–¹æ¶æ„MVPè§£æä¸å®æˆ˜</strong> ï¼Œé’ˆå¯¹è¿™æ˜¯å¯¹googleå®˜æ–¹ç¤ºä¾‹æ¶æ„ï¼ˆgooglesamples/<strong>android-architecture</strong>ï¼‰çš„ä¸€ä¸ªåˆ†æ”¯todo-mvp/ çš„é¡¹ç›®è§£æä¸å®é™…è¿ç”¨</p><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ„è¯¦è§£ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d46de2bbbe8a4c669aab49adf79e1104><p class=pgc-img-caption></p></div><p>googleå®˜æ–¹ç¤ºä¾‹æ¶æ„é¡¹ç›®</p><p><br></p><p>åœ¨æˆ‘çš„å‰ä¸€ç¯‡æ–‡ç« åˆ†äº«çš„æ—¶å€™ï¼Œå½“æ—¶todo-mvp-dagger/ è¿™ä¸ªåˆ†æ”¯ä¹Ÿè¿˜æ²¡æœ‰å¼€å‘å®Œæ¯•ã€‚æœ€è¿‘çš„é¡¹ç›®ä¸­ä¹Ÿåœ¨ç”¨åˆ°Dagger2 ä½œä¸ºä¾èµ–æ³¨å…¥ï¼Œæ‰€ä»¥é€šè¿‡è¿™ä¸ªé¡¹ç›®ä¸€èµ·æ¥å­¦ä¹ ä¸‹ï¼Œmvp+Dagger2 çš„å®ç°å§ã€‚</p><h1 class=pgc-h-arrow-right>2 Dagger2åŸºç¡€</h1><blockquote><p>ä»¥ä¸‹Dagger2åŸºç¡€éƒ¨åˆ†ä¸»è¦æ˜¯å¯¹å‚è€ƒèµ„æ–™é‡Œé¢çš„å‡ ç¯‡å¤–æ–‡é“¾æ¥çš„çŸ¥è¯†ç‚¹çš„æ•´åˆï¼Œæ‰€ä»¥ç¿»è¯‘çš„è¯­å¥å¯èƒ½æœ‰äº›ç”Ÿç¡¬ï¼Œåœ¨é€‚å½“çš„åœ°æ–¹ä¼šå‡ºç°è‹±æ–‡åŸæ–‡ã€‚ åŸæ–‡ç« é“¾æ¥ï¼ˆ70%æ¥è‡ªäºä¸‹é¢çš„åŸæ–‡ï¼Œåšå‡ºäº†é€‚å½“ä¿®æ”¹ï¼‰ï¼š Dependency Injection with Dagger 2</p></blockquote><h3 class=pgc-h-arrow-right>2.1 ä»€ä¹ˆæ˜¯Dagger2</h3><p>é¢å‘å¯¹è±¡ç¼–ç¨‹ç»å¸¸éœ€è¦å¤„ç†å„ç§ä¾èµ–å…³ç³»ã€‚å®‰å“å¼€å‘ä¹Ÿä¸ä¾‹å¤–ï¼Œæ¯”å¦‚è¯´ç½‘ç»œè®¿é—®ä¸­ä½¿ç”¨Retrofitï¼ŒGsonï¼Œæœ¬åœ°å­˜å‚¨ä¸­ä½¿ç”¨shared preferenceã€‚æ— ä¸€ä¾‹å¤–ï¼Œæˆ‘ä»¬éƒ½éƒ½éœ€è¦åœ¨ä½¿ç”¨å®ƒä»¬çš„åœ°æ–¹è¿›è¡Œå®ä¾‹å¯¹è±¡æ„å»ºï¼Œå¯¹è±¡ä¹‹é—´å¯èƒ½è¿˜å­˜åœ¨ç€å„ç§å„æ ·çš„ä¾èµ–å…³ç³»ã€‚</p><p>ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼Œç®€ç§°DIï¼‰æ˜¯ç”¨äºå‰Šå‡è®¡ç®—æœºç¨‹åºçš„è€¦åˆé—®é¢˜çš„ä¸€ä¸ªæ³•åˆ™ã€‚å¯¹è±¡åœ¨è¢«åˆ›å»ºçš„æ—¶å€™ï¼Œç”±ä¸€ä¸ªè°ƒæ§ç³»ç»Ÿå†…æ‰€æœ‰å¯¹è±¡çš„å¤–ç•Œå®ä½“å°†å…¶æ‰€ä¾èµ–çš„å¯¹è±¡çš„å¼•ç”¨ä¼ é€’ç»™å®ƒã€‚ä¹Ÿå¯ä»¥è¯´ï¼Œä¾èµ–è¢«æ³¨å…¥åˆ°å¯¹è±¡ä¸­ã€‚</p><p>åœ¨J2EEåå°å¼€å‘ä¸­ï¼Œå½“å‰æ¯”è¾ƒçŸ¥åçš„ä¾èµ–æ³¨å…¥æ¡†æ¶æœ‰ï¼šPico Containerã€Avalon ã€Springã€JBossã€HiveMindã€EJBç­‰ã€‚</p><p>Dagger2 ï¼ˆA fast dependency injector for Android and Java. http://google.github.io/daggerï¼‰æ­£æ˜¯ä¸€ä¸ªå®‰å“å’ŒJavaçš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œä½¿ç”¨ä»£ç è‡ªåŠ¨ç”Ÿæˆåˆ›å»ºä¾èµ–å…³ç³»éœ€è¦çš„ä»£ç ã€‚å‡å°‘å¾ˆå¤šæ¨¡æ¿åŒ–çš„ä»£ç ï¼Œæ›´æ˜“äºæµ‹è¯•ï¼Œé™ä½è€¦åˆï¼Œåˆ›å»ºå¯å¤ç”¨å¯äº’æ¢çš„æ¨¡å—ã€‚</p><h3 class=pgc-h-arrow-right>2.2 Dagger2çš„ä¼˜ç‚¹</h3><ul><li><strong>å…¨å±€å¯¹è±¡å®ä¾‹çš„ç®€å•è®¿é—®æ–¹å¼</strong><br>å’ŒButterKnife åº“å®šä¹‰äº†viewï¼Œäº‹ä»¶å¤„ç†ä»¥åŠèµ„æºçš„å¼•ç”¨ä¸€æ ·ï¼ŒDagger2 æä¾›å…¨å±€å¯¹è±¡å¼•ç”¨çš„ç®€æ˜“è®¿é—®æ–¹å¼ã€‚å£°æ˜äº†å•ä¾‹çš„å®ä¾‹éƒ½å¯ä»¥ä½¿ç”¨@injectè¿›è¡Œè®¿é—®ã€‚æ¯”å¦‚ä¸‹é¢çš„MyTwitterApiClient å’ŒSharedPreferences çš„å®ä¾‹ï¼š</li></ul><pre><code>public class MainActivity extends Activity {   @Inject MyTwitterApiClient mTwitterApiClient;   @Inject SharedPreferences sharedPreferences;   public void onCreate(Bundle savedInstance) {       // assign singleton instances to fields       InjectorClass.inject(this);   } </code></pre><ul><li><strong>å¤æ‚çš„ä¾èµ–å…³ç³»åªéœ€è¦ç®€å•çš„é…ç½®</strong><br>Dagger2 ä¼šé€šè¿‡ä¾èµ–å…³ç³»å¹¶ä¸”ç”Ÿæˆæ˜“æ‡‚æ˜“åˆ†æçš„ä»£ç ã€‚ä»¥å‰é€šè¿‡æ‰‹å†™çš„å¤§é‡æ¨¡æ¿ä»£ç ä¸­çš„å¯¹è±¡å¼•ç”¨å°†ä¼šç”±å®ƒç»™ä½ åˆ›å»ºå¹¶ä¼ é€’åˆ°ç›¸åº”å¯¹è±¡ä¸­ã€‚å› æ­¤ä½ å¯ä»¥æ›´å¤šçš„å…³æ³¨æ¨¡å—ä¸­æ„å»ºçš„å†…å®¹è€Œä¸æ˜¯æ¨¡å—ä¸­çš„å¯¹è±¡å®ä¾‹çš„åˆ›å»ºé¡ºåºã€‚</li><li><strong>è®©å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•æ›´åŠ æ–¹ä¾¿</strong><br>å› ä¸ºä¾èµ–å…³ç³»å·²ç»ä¸ºæˆ‘ä»¬ç‹¬ç«‹å‡ºæ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è½»æ¾çš„æŠ½å–å‡ºä¸åŒçš„æ¨¡å—è¿›è¡Œæµ‹è¯•ã€‚ä¾èµ–çš„æ³¨å…¥å’Œé…ç½®ç‹¬ç«‹äºç»„ä»¶ä¹‹å¤–ã€‚å› ä¸ºå¯¹è±¡æ˜¯åœ¨ä¸€ä¸ªç‹¬ç«‹ã€ä¸è€¦åˆçš„åœ°æ–¹åˆå§‹åŒ–ï¼Œæ‰€ä»¥å½“æ³¨å…¥æŠ½è±¡æ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹å¯¹è±¡çš„å®ç°æ–¹æ³•ï¼Œè€Œä¸ç”¨å¤§æ”¹ä»£ç åº“ã€‚ä¾èµ–å¯ä»¥æ³¨å…¥åˆ°ä¸€ä¸ªç»„ä»¶ä¸­ï¼šæˆ‘ä»¬å¯ä»¥æ³¨å…¥è¿™äº›ä¾èµ–çš„æ¨¡æ‹Ÿå®ç°ï¼Œè¿™æ ·ä½¿å¾—æµ‹è¯•æ›´åŠ ç®€å•ã€‚</li><li><strong>ä½œç”¨åŸŸå®ä¾‹ï¼ˆScoped instancesï¼‰</strong><br>æˆ‘ä»¬ä¸ä»…å¯ä»¥è½»æ¾çš„ç®¡ç†å…¨å±€å®ä¾‹å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Dagger2ä¸­çš„scopeå®šä¹‰ä¸åŒçš„ä½œç”¨åŸŸã€‚ï¼ˆæ¯”å¦‚æ ¹æ®user sessionï¼Œactivityçš„ç”Ÿå‘½å‘¨æœŸï¼‰</li></ul><h3 class=pgc-h-arrow-right>2.3 Dagger2çš„å¼•ç”¨</h3><ul><li>åœ¨æ•´ä¸ªé¡¹ç›®çš„build.gradleä¸­åŠ å…¥ï¼š</li></ul><pre><code> dependencies {     // other classpath definitions here     classpath 'com.neenbedankt.gradle.plugins:android-apt:1.8' }</code></pre><ul><li>åœ¨app/build.gradleä¸­åˆ†åˆ«åŠ å…¥ï¼š</li></ul><pre><code>// add after applying plugin: 'com.android.application'  apply plugin: 'com.neenbedankt.android-apt'</code></pre><pre><code>dependencies {    // apt command comes from the android-apt plugin    apt 'com.google.dagger:dagger-compiler:2.2'    compile 'com.google.dagger:dagger:2.2'    provided 'javax.annotation:jsr250-api:1.0'}</code></pre><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯providedä»£è¡¨ç¼–è¯‘æ—¶éœ€è¦çš„ä¾èµ–ï¼ŒDaggerçš„ç¼–è¯‘å™¨ç”Ÿæˆä¾èµ–å…³ç³»çš„ä»£ç ï¼Œå¹¶åœ¨ç¼–è¯‘æ—¶æ·»åŠ åˆ°IDE çš„class pathä¸­ï¼Œåªå‚ä¸ç¼–è¯‘ï¼Œå¹¶ä¸ä¼šæ‰“åŒ…åˆ°æœ€ç»ˆçš„apkä¸­ã€‚aptæ˜¯ç”±android-aptæ’ä»¶æä¾›ï¼Œå®ƒå¹¶ä¸ä¼šæ·»åŠ è¿™äº›ç±»åˆ°class pathä¸­ï¼Œè¿™äº›ç±»åªç”¨äºæ³¨è§£è§£æï¼Œç¼–å†™ä»£ç çš„æ—¶å€™åº”å½“é¿å…ä½¿ç”¨è¿™äº›ç±»ã€‚</p></blockquote><h3 class=pgc-h-arrow-right>2.4 Dagger2çš„ä½¿ç”¨ï¼Œä¾èµ–æ³¨å…¥æµç¨‹</h3><p>Dagger2 ä¸­ä½¿ç”¨äº†å¾ˆå¤šæ³¨è§£ï¼Œæ¥ä¸‹æ¥ä¸€æ­¥ä¸€æ­¥çš„åˆ†æDagger2çš„ä½¿ç”¨ï¼Œå…ˆæ¥ä¸€å¼ è¡¨å’Œä¸€å¼ å›¾æŠŠDagger2ä¸­çš„æ³¨è§£è®²è§£ä¸€ä¸‹ã€‚å¦‚æœæœ‰ç‚¹ä¸æ¸…æ™°ï¼Œè¯·æ¥ç€å¾€ä¸‹çœ‹ï¼Œç„¶åå†å›æ¥çœ‹ä¸€éã€‚</p><p>æ³¨è§£ ç”¨æ³• @Module Modulesç±»é‡Œé¢çš„æ–¹æ³•ä¸“é—¨æä¾›ä¾èµ–ï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»ï¼Œç”¨@Moduleæ³¨è§£ï¼Œè¿™æ ·Daggeråœ¨æ„é€ ç±»çš„å®ä¾‹çš„æ—¶å€™ï¼Œå°±çŸ¥é“ä»å“ªé‡Œå»æ‰¾åˆ°éœ€è¦çš„ ä¾èµ–ã€‚modulesçš„ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯å®ƒä»¬è®¾è®¡ä¸ºåˆ†åŒºå¹¶ç»„åˆåœ¨ä¸€èµ·ï¼ˆæ¯”å¦‚è¯´ï¼Œåœ¨æˆ‘ä»¬çš„appä¸­å¯ä»¥æœ‰å¤šä¸ªç»„æˆåœ¨ä¸€èµ·çš„modules) @Provide åœ¨modulesä¸­ï¼Œæˆ‘ä»¬å®šä¹‰çš„æ–¹æ³•æ˜¯ç”¨è¿™ä¸ªæ³¨è§£ï¼Œä»¥æ­¤æ¥å‘Šè¯‰Daggeræˆ‘ä»¬æƒ³è¦æ„é€ å¯¹è±¡å¹¶æä¾›è¿™äº›ä¾èµ–ã€‚ @Singleton å½“å‰æä¾›çš„å¯¹è±¡å°†æ˜¯å•ä¾‹æ¨¡å¼ ,ä¸€èˆ¬é…åˆ@Providesä¸€èµ·å‡ºç° @Component ç”¨äºæ¥å£ï¼Œè¿™ä¸ªæ¥å£è¢«Dagger2ç”¨äºç”Ÿæˆç”¨äºæ¨¡å—æ³¨å…¥çš„ä»£ç  @Inject åœ¨éœ€è¦ä¾èµ–çš„åœ°æ–¹ä½¿ç”¨è¿™ä¸ªæ³¨è§£ã€‚ï¼ˆä½ ç”¨å®ƒå‘Šè¯‰Daggerè¿™ä¸ª æ„é€ æ–¹æ³•ï¼Œæˆå‘˜å˜é‡æˆ–è€…å‡½æ•°æ–¹æ³•éœ€è¦ä¾èµ–æ³¨å…¥ã€‚è¿™æ ·ï¼ŒDaggerå°±ä¼šæ„é€ ä¸€ä¸ªè¿™ä¸ªç±»çš„å®ä¾‹å¹¶æ»¡è¶³ä»–ä»¬çš„ä¾èµ–ã€‚ï¼‰ @Scope Scopeså¯æ˜¯éå¸¸çš„æœ‰ç”¨ï¼ŒDagger2å¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ³¨è§£é™å®šæ³¨è§£ä½œç”¨åŸŸã€‚</p><p><strong>æ²¡çœ‹æ‡‚ï¼Ÿæ¥ç€å¾€ä¸‹çœ‹</strong></p><p>çœ‹çœ‹Dagger2 çš„æµç¨‹ï¼š</p><p><br></p><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ„è¯¦è§£ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/90971247a2bc4fb890359232d7e66547><p class=pgc-img-caption></p></div><p>Dagger2 æµç¨‹</p><p>é¦–å…ˆçœ‹çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Okhttpï¼ŒRetrofitå’ŒGsonåšä¸€ä¸ªTwitter å®¢æˆ·ç«¯çš„ç½‘ç»œè®¿é—®ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨onCreateä¸­åŠ è½½ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·åˆå§‹åŒ–ã€‚</p><pre><code>public class MainActivity extends Activity {OkHttpClient client = new OkHttpClient();// Enable caching for OkHttpint cacheSize = 10 * 1024 * 1024; // 10 MiBCache cache = new Cache(getApplication().getCacheDir(), cacheSize);client.setCache(cache);// Used for caching authentication tokensSharedPreferences sharedPrefeences = PreferenceManager.getDefaultSharedPreferences(this);// Instantiate GsonGson gson = new GsonBuilder().create();GsonConverterFactory converterFactory = GsonConverterFactory.create(Gson);// Build RetrofitRetrofit retrofit = new Retrofit.Builder()                                .baseUrl("https://api.github.com")                                .addConverterFactory(converterFactory)                                .client(client)  // custom client                                .build();public void onCreate(Bundle savedInstance) {    retrofit.xxx();    sharedPrefeences.xxx();    gson.xxx() } } </code></pre><p><strong>å¦‚æœæˆ‘ä»¬ä½¿ç”¨Dagger2å®Œæˆä¸Šè¿°è¿‡ç¨‹å‘¢ï¼Ÿ</strong></p><p>é¦–å…ˆæˆ‘ä»¬è¦åˆ›å»ºå‡ ä¸ªDaggeræ¨¡å—ï¼ˆModuleï¼‰ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªDaggeræ¨¡å—ï¼ˆModuleï¼‰AppModule.java(ä½¿ç”¨@Moduleè¿›è¡Œç±»æ³¨è§£)ï¼Œå°†ä¼šæä¾›Application çš„contextå¼•ç”¨ã€‚æˆ‘ä»¬ä½¿ç”¨@Providesæ³¨è§£å‘Šè¯‰Dagger providesApplication()è¿™ä¸ªæ–¹æ³•æ˜¯Applicationçš„å®ä¾‹çš„æä¾›è€…ã€‚ä½¿ç”¨@Singletonæ³¨è§£å‘Šè¯‰Daggeræ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡ã€‚</p><pre><code>@Modulepublic class AppModule {    Application mApplication;    public AppModule(Application application) {        mApplication = application;    }    @Provides    @Singleton    Application providesApplication() {        return mApplication;    }}</code></pre><p>å’Œä¸Šé¢ç±»ä¼¼æ„å»ºç¬¬äºŒä¸ªæ¨¡å—ï¼ˆModuleï¼‰ï¼Œä¸‹é¢è¿™æ®µä»£ç æˆ‘ä»¬è¿›è¡Œäº†Gsonï¼ŒCacheï¼ŒOkHttpClientä»¥åŠRetrofit çš„å®ä¾‹åŒ–ï¼Œè¿™äº›æ–¹æ³•çš„è¿”å›ç±»å‹éƒ½ä¼šåœ¨å®šä¹‰åˆ°<strong>ä¾èµ–å…³ç³»ï¼ˆä¾èµ–è¡¨ dependency graphï¼‰</strong>ä¸­ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ˜¯ä¸‰ä¸ªæ³¨è§£çš„@Module,@Provides,@Singletonçš„å®šä¹‰ä½ç½®ã€‚</p><pre><code>@Modulepublic class NetModule {    String mBaseUrl;    // Constructor needs one parameter to instantiate.      public NetModule(String baseUrl) {        this.mBaseUrl = baseUrl;    }    // Dagger will only look for methods annotated with @Provides    @Provides    @Singleton    // Application reference must come from AppModule.class    SharedPreferences providesSharedPreferences(Application application) {        return PreferenceManager.getDefaultSharedPreferences(application);    }    @Provides    @Singleton    Cache provideOkHttpCache(Application application) {         int cacheSize = 10 * 1024 * 1024; // 10 MiB        Cache cache = new Cache(application.getCacheDir(), cacheSize);        return cache;    }   @Provides    @Singleton   Gson provideGson() {         GsonBuilder gsonBuilder = new GsonBuilder();       gsonBuilder.setFieldNamingPolicy(FieldNamingPolicy.LOWER_CASE_WITH_UNDERSCORES);       return gsonBuilder.create();   }   @Provides   @Singleton   OkHttpClient provideOkHttpClient(Cache cache) {      OkHttpClient client = new OkHttpClient();      client.setCache(cache);      return client;   }   @Provides   @Singleton   Retrofit provideRetrofit(Gson gson, OkHttpClient okHttpClient) {      Retrofit retrofit = new Retrofit.Builder()                .addConverterFactory(GsonConverterFactory.create(gson))                .baseUrl(mBaseUrl)                .client(okHttpClient)                .build();        return retrofit;    }}</code></pre><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬é€šè¿‡@Moduleæ ‡æ³¨ç±»ï¼Œ@Provideå’Œ@Singletonæ ‡æ³¨æ–¹æ³•å®Œæˆäº†è¿™äº›å¯¹è±¡å®ä¾‹çš„åˆ›å»ºã€‚é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆè·å–è¿™äº›å¯¹è±¡å®ä¾‹å‘¢ï¼Ÿ</p><p>Dagger2é€šè¿‡@injectæ³¨è§£æä¾›äº†å®ä¾‹çš„è·å–,é€šè¿‡è°ƒç”¨@injectä¼šè®©Dagger2 åœ¨<strong>ä¾èµ–å…³ç³»ï¼ˆä¾èµ–è¡¨ dependency graphï¼‰</strong>ä¸­æ‰¾åˆ°å¯¹åº”çš„å®ä¾‹å¯¹è±¡å¹¶èµ‹å€¼ç»™è¯¥å­—æ®µã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­å°±ä¼šè¿”å›MyTwitterApiClient,SharedPreferencesçš„å®ä¾‹å¯¹è±¡ã€‚</p><pre><code>public class MainActivity extends Activity {   @Inject MyTwitterApiClient mTwitterApiClient;   @Inject SharedPreferences sharedPreferences;  public void onCreate(Bundle savedInstance) {       // assign singleton instances to fields       InjectorClass.inject(this);   } </code></pre><p>ä¸Šé¢çš„Moduleç±»éƒ½ä¼šéœ€è¦ä¸€ä¸ªcontextï¼Œæœ‰çš„æ—¶å€™æ˜¯Activity contextï¼Œæœ‰çš„æ—¶å€™æ˜¯Application contextï¼Œæ‰€ä»¥ä¸Šé¢å®Œæˆäº†æä¾› å’Œä½¿ç”¨å®ä¾‹ ã€‚</p><p>å¯ä»¥çœ‹åˆ°ä¸Šé¢é€šè¿‡InjectorClass.inject(this)æŠŠå½“å‰activityå¯¹è±¡æ³¨å…¥åˆ°InjectorClassï¼Œé‚£ä¹ˆInjectorClassæ˜¯ä»€ä¹ˆå‘¢?æ­£æ˜¯è¿™ä¸ªå…³è”è¿‡ç¨‹ã€‚</p><p>åœ¨Dagger2 ä¸­ ï¼Œæ³¨å…¥ç±»ï¼ˆinjector classï¼‰è¢«ç§°ä½œç»„ä»¶ï¼ˆComponentï¼‰ï¼Œæˆ‘ä»¬é€šè¿‡injectæ–¹æ³•ä¼ é€’activityï¼Œserviceæˆ–è€…fragmentå¯¹è±¡åˆ°æ³¨å…¥ç±»componentä¸­ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªç±»ã€‚æˆ‘ä»¬é€šè¿‡@Componentæ³¨è§£å½“å‰ç±»ï¼Œå¹¶ä¸”æŠŠä¹‹å‰çš„ä¸¤ä¸ªæ¨¡å—AppModule.class, NetModule.classä¹Ÿæ·»åŠ åˆ°componentä¸­ã€‚ï¼ˆ<strong>Componentsä»æ ¹æœ¬ä¸Šæ¥è¯´å°±æ˜¯ä¸€ä¸ªæ³¨å…¥å™¨ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯@Injectå’Œ@Moduleçš„æ¡¥æ¢ã€‚</strong>ï¼‰</p><pre><code>@Singleton@Component(modules={AppModule.class, NetModule.class})public interface NetComponent {   void inject(MainActivity activity);   // void inject(MyFragment fragment);   // void inject(MyService service);}</code></pre><p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±æŠŠDagger2 çš„å¤§è‡´æµç¨‹æ¢³ç†äº†ä¸€éã€‚</p><blockquote><p>æä¾›ï¼ˆ@Moduleï¼‰&lt;->å…³è”ï¼ˆ@Componentï¼‰&lt;->ä½¿ç”¨ï¼ˆ@Injectï¼‰</p></blockquote><blockquote><p>ä¾èµ–æ³¨å…¥ï¼Œè¿™è®©æˆ‘æƒ³èµ·äº†å°æ—¶å€™æœ€æ€•çš„æ‰“é’ˆã€‚å°±å¥½åƒæ‰“é’ˆè¿‡ç¨‹ä¸€æ ·ï¼Œæˆ‘ä»¬æœ‰äº†è¯ç‰©ï¼ˆæä¾›çš„å®ä¾‹ï¼‰ï¼Œä½ çš„èº«ä½“ç”Ÿç—…äº†éœ€è¦è¯ç‰©ï¼ˆä½¿ç”¨è¿™ä¸ªå®ä¾‹ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦æ³¨å°„å™¨æŠŠè¯ç‰©æ³¨å…¥ä½ çš„èº«ä½“é‡Œé¢ã€‚ï¼ˆå…³è”è¿™ä¸ªå®ä¾‹ï¼‰ é‚£ä¹ˆä½ å°±ä¼šå¥½å¥‡è¿™ä¸ªæ³¨è§£ç±»æ˜¯æ€ä¹ˆå®Œæˆæ•´ä¸ªæ³¨å…¥çš„å‘¢ï¼Ÿ(ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå…³è”è¿‡ç¨‹)</p></blockquote><p>Dagger2ä¸­å¾ˆé‡è¦çš„ä¸€ç‚¹å°±æ˜¯å®ƒä¼šä¸º@Componentæ³¨è§£çš„ç±»ç”Ÿæˆä»£ç ã€‚å®ƒä¼šåœ¨ç±»çš„å‰é¢æ·»åŠ ä¸ŠDaggerå‰ç¼€ï¼ˆæ¯”å¦‚ä¸Šé¢çš„ç±»å°±ä¼šç”ŸæˆDaggerNetComponent .javaï¼‰,ä¹Ÿå°±æ˜¯è¿™ä¸ªç±»è´Ÿè´£åˆå§‹åŒ–<strong>ä¾èµ–å…³ç³»ï¼ˆä¾èµ–è¡¨ dependency graphï¼‰</strong>ä¸­çš„å®ä¾‹ï¼Œå¹¶ä¸ºæ³¨è§£äº†@Inject çš„å­—æ®µæ‰§è¡Œæ³¨å…¥æ“ä½œã€‚æ¥ç€å¾€ä¸‹çœ‹ã€‚</p><h3 class=pgc-h-arrow-right>2.5 åˆå§‹åŒ–ç»„ä»¶ï¼ˆInstantiating the componentï¼‰</h3><p>åˆå§‹åŒ–ç»„ä»¶æ“ä½œåº”å½“åœ¨Applicationä¸­è¿›è¡Œæ“ä½œï¼Œå› ä¸ºè¿™äº›å®ä¾‹åœ¨æ•´ä¸ªapplicationç”Ÿå‘½å‘¨æœŸä¸­åªä¼šè¢«å®ä¾‹åŒ–ä¸€æ¬¡ã€‚</p><pre><code>public class MyApp extends Application {    private NetComponent mNetComponent;    @Override    public void onCreate() {        super.onCreate();        // Dagger%COMPONENT_NAME%        mNetComponent = DaggerNetComponent.builder()                // list of modules that are part of this component need to be created here too                .appModule(new AppModule(this)) // This also corresponds to the name of your module: %component_name%Module                .netModule(new NetModule("https://api.github.com"))                .build();        // If a Dagger 2 component does not have any constructor arguments for any of its modules,        // then we can use .create() as a shortcut instead:        //  mAppComponent = com.codepath.dagger.components.DaggerNetComponent.create();    }    public NetComponent getNetComponent() {       return mNetComponent;    }}</code></pre><p>å¯ä»¥çœ‹åˆ°çš„æ˜¯æˆ‘ä»¬ç›´æ¥ä½¿ç”¨NetComponentç”Ÿæˆçš„ç±»DaggerNetComponentå¹¶ä¸”ç”Ÿæˆçš„æ–¹æ³•appModuleå’ŒnetModuleå®Œæˆäº†ä¸¤ä¸ªå¯¹åº”moduleçš„åˆå§‹åŒ–ã€‚</p><blockquote><p>å› ä¸ºè¿™é‡Œæˆ‘ä»¬ç»§æ‰¿äº†Applicationå¹¶ä½œå‡ºäº†ä¿®æ”¹ï¼Œæ‰€ä»¥éœ€è¦åœ¨AndroidManifest.xmlä¸­ä½œå‡ºä¿®æ”¹å¦‚ä¸‹ã€‚</p></blockquote><pre><code>&lt;application      android:allowBackup="true"      android:name=".MyApp"&gt;</code></pre><p>åœ¨activityä¸­ï¼Œæˆ‘ä»¬éœ€è¦è·å–componentå¹¶ä¸”è°ƒç”¨inject()æ–¹æ³•ã€‚æ³¨æ„éœ€è¦å°†è·å–çš„Applicationå¼ºåˆ¶è½¬æ¢ä¸ºMyAppã€‚è¿™ä¹Ÿå®Œæˆäº†ä¸Šé¢InjectorClass.inject(this);ä»£ç çš„æ›¿æ¢ã€‚</p><pre><code>public class MyActivity extends Activity {  @Inject OkHttpClient mOkHttpClient;  @Inject SharedPreferences sharedPreferences;  public void onCreate(Bundle savedInstance) {        // assign singleton instances to fields        // We need to cast to `MyApp` in order to get the right method        ((MyApp) getApplication()).getNetComponent().inject(this);    } </code></pre><blockquote><p>åˆ°è¿™é‡Œå°±å®Œæˆäº†æ•´ä¸ªDagger2çš„ä¾èµ–æ³¨å…¥æµç¨‹.</p></blockquote><h4 class=pgc-h-arrow-right>Dagger2çš„ä½¿ç”¨è¿˜æœ‰ä¸€äº›æ³¨æ„ç‚¹ã€‚ä¸‹é¢è¿›è¡Œè®²è§£ã€‚åŒ…æ‹¬ä¸‹é¢çš„é™å®šç±»å‹ï¼Œä½œç”¨åŸŸï¼Œç»„å»ºä¾èµ–ï¼Œä»¥åŠå­ç»„ä»¶ã€‚</h4><h3 class=pgc-h-arrow-right>2.6 é™å®šç±»å‹ï¼ˆQualified typesï¼‰</h3><p><br></p><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ„è¯¦è§£ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e9ed79a0b06f46069aa3dd5d95f83081><p class=pgc-img-caption></p></div><p>Dagger ä¿®é¥°ç¬¦</p><p><br>å¦‚æœå¯¹äºä¸åŒçš„å¯¹è±¡æœ‰åŒæ ·çš„è¿”å›ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Namedä¿®é¥°ç¬¦æ³¨è§£ã€‚ä½ éœ€è¦åœ¨æä¾›å•ä¾‹çš„åœ°æ–¹(@Providesæ³¨è§£)å’Œæ³¨å…¥çš„åœ°æ–¹ï¼ˆ@Injectæ³¨è§£ï¼‰éƒ½ä½¿ç”¨@Namedæ³¨è§£ã€‚<br>æ¯”å¦‚ï¼Œå¯¹äºåŒæ ·çš„è¿”å›OkHttpClient ï¼Œè¿™é‡Œæä¾›ä¸åŒçš„æ–¹æ³•ï¼Œå’Œjavaä¸­å¤šæ€ä¸€æ ·ï¼Œåªä¸è¿‡è¿™é‡Œéœ€è¦é¢å¤–é€šè¿‡@Namedæ³¨è§£æ¥æ ‡æ³¨ï¼š</p><p><br></p><pre><code>@Provides @Named("cached")@SingletonOkHttpClient provideOkHttpClient(Cache cache) {    OkHttpClient client = new OkHttpClient();    client.setCache(cache);    return client;}@Provides @Named("non_cached") @SingletonOkHttpClient provideOkHttpClient() {    OkHttpClient client = new OkHttpClient();    return client;}</code></pre><pre><code>@Inject @Named("cached") OkHttpClient client;@Inject @Named("non_cached") OkHttpClient client2;</code></pre><p>å¦‚ä¸‹ï¼Œ@Namedæ˜¯åœ¨Daggerä¸­é¢„å…ˆå®šä¹‰å¥½çš„ä¿®é¥°ç¬¦ï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„ä¿®é¥°ç¬¦æ³¨è§£ã€‚å…³äºè‡ªå®šä¹‰æ³¨è§£ï¼Œæˆ‘ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ã€è¯‘ã€‘ä»javaæ³¨è§£åˆ†æButterKnifeå·¥ä½œæµç¨‹æœ‰æ‰€æåŠã€‚</p><pre><code>@Qualifier@Documented@Retention(RUNTIME)public @interface DefaultPreferences {}</code></pre><h3 class=pgc-h-arrow-right>2.7 ä½œç”¨åŸŸï¼ˆScopesï¼‰</h3><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ„è¯¦è§£ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/110d321a3ccd446d91328d25f57018a1><p class=pgc-img-caption></p></div><p>dagger ä½œç”¨åŸŸ</p><p>Scopeså¯æ˜¯éå¸¸çš„æœ‰ç”¨ï¼ŒDagger2å¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ³¨è§£é™å®šæ³¨è§£ä½œç”¨åŸŸã€‚@Singletonæ˜¯è¢«Daggeré¢„å…ˆå®šä¹‰çš„ä½œç”¨åŸŸæ³¨è§£ï¼ˆ scope annotation ï¼‰ã€‚æ²¡æœ‰æŒ‡å®šä½œç”¨åŸŸçš„@Providesæ–¹æ³•å°†ä¼šåœ¨æ¯æ¬¡æ³¨å…¥çš„æ—¶å€™éƒ½åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚åŒæ ·çš„ï¼Œä½ ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„Scopeæ³¨è§£ã€‚</p><pre><code>@Scope@Documented@Retention(value=RUNTIME)public @interface MyActivityScope</code></pre><blockquote><p>ä½ å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°è¿™æ ·ä¸€æ®µæ–‡å­—</p></blockquote><pre><code>/** * In Dagger, an unscoped component cannot depend on a scoped component. As * {@link edu.com.app.injection.component.ApplicationComponent} is a scoped component ({@code @Singleton}, we create a custom * scope to be used by all fragment components. Additionally, a component with a specific scope * cannot have a sub component with the same scope. */</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæ²¡æœ‰scopeçš„ç»„ä»¶componentä¸å¯ä»¥ä»¥æ¥ä¸€ä¸ªæœ‰scopeçš„ç»„ä»¶componentã€‚å­ç»„ä»¶å’Œçˆ¶ç»„ä»¶çš„scopeä¸èƒ½ç›¸åŒã€‚æˆ‘ä»¬é€šå¸¸çš„ApplicationComponentéƒ½ä¼šä½¿ç”¨Singletonæ³¨è§£ï¼Œä¹Ÿå°±ä¼šæ˜¯è¯´æˆ‘ä»¬å¦‚æœè‡ªå®šä¹‰componentå¿…é¡»æœ‰è‡ªå·±çš„scopeã€‚åœ¨ä¸‹é¢ç»„ä»¶ä¾èµ–ä¸­ä¼šå†æ¬¡æåŠã€‚</p><h3 class=pgc-h-arrow-right>2.8 ç»„ä»¶ä¾èµ–ï¼ˆComponent Dependenciesï¼‰</h3><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ„è¯¦è§£ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/41f2ae070e8540b0b0e9095742cb2a17><p class=pgc-img-caption></p></div><p>dagger ä¾èµ–</p><p><br></p><p>ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬åˆ›å»ºäº†applicationçš„å…¨å±€å•ä¾‹.å¦‚æœæˆ‘ä»¬æƒ³åœ¨å†…å­˜ä¸­æ€»æ˜¯æ‹¥æœ‰å¤šä¸ªç»„ä»¶ï¼ˆä¾‹å¦‚åœ¨activityå’Œfragmentç”Ÿå‘½å‘¨æœŸï¼Œç”¨æˆ·ç™»å½•æ³¨å†Œåˆ›å»ºçš„componentï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç»„ä»¶ä¾èµ–ï¼ˆComponent Dependenciesï¼‰ï¼Œä½¿ç”¨ç»„ä»¶ä¾èµ–æœ‰ä¸‹é¢å‡ ä¸ªè€ƒè™‘ç‚¹ï¼š</p><ul><li>ä¸¤ä¸ªä¾èµ–çš„ç»„ä»¶ä¸èƒ½å…±äº«ä½œç”¨åŸŸï¼Œæ¯”å¦‚ä¸¤ä¸ªç»„ä»¶ä¸èƒ½å…±äº«@Singletonä½œç”¨åŸŸã€‚è¿™ä¸ªé™åˆ¶äº§ç”Ÿçš„åŸå› çœ‹è¿™é‡Œã€‚ä¾èµ–çš„ç»„ä»¶éœ€è¦å®šä¹‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚</li><li>å°½ç®¡Dagger2 æœ‰åˆ›å»ºä½œç”¨åŸŸå®ä¾‹çš„èƒ½åŠ›ï¼Œä½ ä¹Ÿéœ€è¦åˆ›å»ºå’Œåˆ é™¤å¼•ç”¨æ¥æ»¡è¶³è¡Œä¸ºçš„ä¸€è‡´æ€§ã€‚Dagger2 ä¸ä¼šçŸ¥é“ä»»ä½•åº•å±‚çš„å®ç°ã€‚å¯ä»¥çœ‹çœ‹Stack Overflow çš„è¿™ä¸ª è®¨è®º</li><li>å½“åˆ›å»ºä¾èµ–ç»„ä»¶çš„æ—¶å€™ï¼Œçˆ¶ç»„ä»¶éœ€è¦æ˜¾ç¤ºçš„æš´éœ²å¯¹è±¡ç»™å­ç»„ä»¶ã€‚æ¯”å¦‚å­ç»„ä»¶éœ€è¦çŸ¥é“Retrofit å¯¹è±¡ï¼Œä¹Ÿå°±éœ€è¦æ˜¾ç¤ºçš„æš´éœ²å‡ºæ¥ã€‚</li></ul><pre><code>@Singleton@Component(modules={AppModule.class, NetModule.class})public interface NetComponent {//ä¾èµ–äºå½“å‰componentçš„componentä¼šå¾—åˆ°Retrofitå®ä¾‹ï¼Œè¿™é‡Œçš„æ–¹æ³•åä¸å›ºå®š    Retrofit retrofit();}</code></pre><p>è¿™é‡Œå‚è€ƒæˆ‘è‡ªå·±é¡¹ç›®çš„ActivityComponentï¼Œä¾èµ–äºApplicationComponentï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¼šè‡ªå®šä¹‰ScopePerActivityã€‚ä¹Ÿå¯ä»¥çœ‹åˆ°çš„æ˜¯@ActivityContextä¼šåœ¨componentå’Œmoduleä¸­å¾—åˆ°ä½¿ç”¨ã€‚å‚è€ƒä¸‹é¢ä¸‰æ®µä»£ç ã€‚</p><pre><code>@PerActivity@Component(dependencies = ApplicationComponent.class, modules = ActivityModule.class)public interface ActivityComponent {    void inject(MainActivity mainActivity);  //......    void inject(SettingsFragment settingsFragment);}</code></pre><pre><code>@Documented@Scope@Retention(RetentionPolicy.RUNTIME)public @interface PerActivity {}</code></pre><pre><code>@Modulepublic class ActivityModule {    private Activity mActivity;    public ActivityModule(Activity activity) {        mActivity = activity;    }    @Provides    Activity provideActivity() {        return mActivity;    }    @Provides    @ActivityContext    Context providesContext() {        return mActivity;    }}</code></pre><h3 class=pgc-h-arrow-right>2.9 å­ç»„ä»¶ï¼ˆSubcomponentsï¼‰</h3><p><br></p><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ„è¯¦è§£ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/245b1dd07c014b649cd028e0a9d557fd><p class=pgc-img-caption></p></div><p>dagger å­ç»„ä»¶</p><p><br>é™¤äº†ä¾èµ–å…³ç³»ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å­ç»„ä»¶è¿›è¡Œ<strong>å¯¹è±¡å…³ç³»ï¼ˆå¯¹è±¡è¡¨/å›¾ object graphï¼‰</strong>ç»§æ‰¿ã€‚å’Œç»„ä»¶ä¹‹é—´æ·»åŠ ä¾èµ–å…³ç³»ä¸€æ ·ï¼Œå­ç»„ä»¶ä¹Ÿæœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿä¼šåœ¨æ‰€æœ‰å¯¹å…¶åº”ç”¨ä¸åœ¨çš„æ—¶å€™è¢«åƒåœ¾å›æ”¶ï¼Œä¹Ÿæœ‰åŒæ ·çš„ä½œç”¨åŸŸé™åˆ¶ã€‚åŒºåˆ«äºç»„ä»¶ä¾èµ–çš„ä¸åŒç‚¹ä¸»è¦æ˜¯ï¼š</p><p><br></p><ul><li>éœ€è¦åœ¨çˆ¶ç»„ä»¶çš„æ¥å£ä¸­å£°æ˜ï¼ˆåœ¨æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•å¯¹äºç”Ÿæˆçš„å¯¹è±¡æ˜¯å¯è®¿é—®çš„ã€‚ï¼‰ã€‚</li><li>èƒ½å¤Ÿè·å–çˆ¶ç»„ä»¶çš„æ‰€æœ‰å…ƒç´ ï¼ˆä¸ä»…ä»…æ˜¯åœ¨æ¥å£ä¸­å£°æ˜çš„å…ƒç´ ï¼‰ã€‚<br>æ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š</li></ul><pre><code>@Modulepublic class MyActivityModule {    private final MyActivity activity;    public MyActivityModule(MyActivity activity) { this.activity = activity; }    @Provides @MyActivityScope @Named("my_list")    public ArrayAdapter providesMyListAdapter() {        return new ArrayAdapter&lt;String&gt;(activity, android.R.layout.my_list);    }    ...}@MyActivityScope@Subcomponent(modules={ MyActivityModule.class })public interface MyActivitySubComponent {    @Named("my_list") ArrayAdapter myListAdapter();}@Singleton@Component(modules={ ... })public interface MyApplicationComponent {    MyActivitySubComponent newMyActivitySubcomponent(MyActivityModule activityModule);}</code></pre><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå­ç»„ä»¶çš„å®ä¾‹åœ¨æ¯æ¬¡æˆ‘ä»¬è°ƒç”¨newMyActivitySubcomponent()çš„æ—¶å€™éƒ½ä¼šè¢«åˆ›å»ºã€‚ä½¿ç”¨å­æ¨¡å—å»æ³¨å…¥ä¸€ä¸ªactivityï¼š</p><pre><code>public class MyActivity extends Activity {  @Inject ArrayAdapter arrayAdapter;  public void onCreate(Bundle savedInstance) {        // assign singleton instances to fields        // We need to cast to `MyApp` in order to get the right method        ((MyApp) getApplication()).getApplicationComponent())            .newMyActivitySubcomponent(new MyActivityModule(this))            .inject(this);    } }</code></pre><blockquote><p>æœ€åå†æ¥æ¢³ç†ä¸€ä¸‹Dagger2 ä¸­çš„ä¸€äº›æ³¨æ„ç‚¹ï¼š</p></blockquote><ul><li>Componentsä»æ ¹æœ¬ä¸Šæ¥è¯´å°±æ˜¯ä¸€ä¸ªæ³¨å…¥å™¨ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯@Injectå’Œ@Moduleçš„æ¡¥æ¢ã€‚ Componentså¯ä»¥æä¾›æ‰€æœ‰å®šä¹‰äº†çš„ç±»å‹çš„å®ä¾‹ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬å¿…é¡»ç”¨@Componentæ³¨è§£ä¸€ä¸ªæ¥å£ç„¶ååˆ—å‡ºæ‰€æœ‰çš„@Modulesç»„æˆè¯¥ç»„ä»¶ï¼Œå¦‚ æœç¼ºå¤±äº†ä»»ä½•ä¸€å—éƒ½ä¼šåœ¨ç¼–è¯‘çš„æ—¶å€™æŠ¥é”™ã€‚@Componentæ¥å£å®šä¹‰äº†å¯¹è±¡æä¾›è€…ï¼ˆmoduleï¼‰å’Œå¯¹è±¡ä¹‹é—´çš„è”ç³»ï¼Œä¹Ÿè¡¨è¿°äº†ä¸€ç§ä¾èµ–å…³ç³»ã€‚</li><li>ç”±äºDagger2ä½¿ç”¨ç”Ÿæˆçš„ä»£ç å»è®¿é—®å­—æ®µï¼Œæ‰€ä»¥å­—æ®µä½¿ç”¨äº†Dagger2 æ˜¯ä¸å…è®¸æ ‡æ³¨ä¸ºprivateçš„ã€‚</li><li>Dagger2 åŸºäºJSR 330ï¼ˆä¸ºäº†æœ€å¤§ç¨‹åº¦çš„æé«˜ä»£ç çš„å¤ç”¨æ€§ã€æµ‹è¯•æ€§å’Œç»´æŠ¤æ€§ï¼Œjavaçš„ä¾èµ–æ³¨å…¥ä¸ºæ³¨å…¥ç±»ä¸­çš„ä½¿ç”¨å®šä¹‰äº†ä¸€æ•´å¥—æ³¨è§£ï¼ˆå’Œæ¥å£ï¼‰æ ‡å‡†ã€‚Dagger1å’ŒDagger2ï¼ˆè¿˜æœ‰Guiceï¼‰éƒ½æ˜¯åŸºäºè¿™å¥—æ ‡å‡†ï¼Œç»™ç¨‹åºå¸¦æ¥äº†ç¨³å®šæ€§å’Œæ ‡å‡†çš„ä¾èµ–æ³¨å…¥æ–¹æ³•ã€‚ï¼‰</li><li>ä½¿ç”¨@injectæ³¨è§£è¡¨ç¤ºä¾èµ–å…³ç³»å¯ä»¥ç”¨äºä¸‰ä¸ªåœ°æ–¹ã€‚æ„é€ å‡½æ•°ï¼Œå­—æ®µæˆ–è€…æ–¹æ³•ä¸­ï¼‰ã€‚</li><li>Dagger2ä¼šåœ¨ç¼–è¯‘æ—¶é€šè¿‡aptç”Ÿæˆä»£ç è¿›è¡Œæ³¨å…¥ã€‚</li></ul><p>ä»¥åçš„å¼€å‘ä¸­ï¼Œé‚£ä¹ˆå¤šéœ€è¦ä½¿ç”¨å®ä¾‹çš„åœ°æ–¹ï¼Œåªéœ€è¦ç®€ç®€å•å•åœ°æ¥ä¸€ä¸ª@injectï¼Œè€Œä¸éœ€è¦å…³å¿ƒæ˜¯å¦‚ä½•æ³¨å…¥çš„ã€‚Dagger2è®©ä½ çˆ±ä¸é‡Šæ‰‹ã€‚ é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æå®˜æ–¹æ¶æ„Dagger2 åˆæ˜¯æ€ä¹ˆä½¿ç”¨çš„å§ï¼Ÿ</p><hr><h1 class=pgc-h-arrow-right>3 googleå®˜æ–¹MVPæ¶æ„å›é¡¾</h1><p><br></p><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ„è¯¦è§£ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9d9ff10e0e7f45818079dde365a89bbc><p class=pgc-img-caption></p></div><p><br>ä¸Šä¸€ç¯‡æ–‡ç« <strong>googleå®˜æ–¹æ¶æ„MVPè§£æä¸å®æˆ˜</strong> ä¸­ï¼Œæˆ‘ä»¬åˆ†æåˆ°æ•´ä¸ªé¡¹ç›®æ˜¯æŒ‰ç…§åŠŸèƒ½æ¨¡å—è¿›è¡Œåˆ’åˆ†ï¼ˆaddedittaskï¼Œstatisticsï¼Œtaskdetailï¼Œtaskså››ä¸ªæ¨¡å—ï¼‰å¹¶ä¸”å°†æ•°æ®å’Œå·¥å…·ç±»åˆ†åˆ«æå–åˆ°dataå’ŒutilåŒ…ä¸­ã€‚æˆ‘ä»¬å¯¹taskdetialæ¨¡å—è¿›è¡Œäº†åˆ†æã€‚è¿™é‡Œæå–ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„ç»“è®º</p><p><br></p><blockquote><p><strong>3.1</strong> å®˜æ–¹MVPå®ä¾‹ï¼Œé€šè¿‡åè®®ç±»XXXContractæ¥å¯¹Viewå’ŒPresenterçš„æ¥å£è¿›è¡Œå†…éƒ¨ç»§æ‰¿ã€‚æ˜¯å¯¹BaseViewå’ŒBasePresenterçš„è¿›ä¸€æ­¥å°è£…ï¼Œæ‰€ä»¥æˆ‘ä»¬å®ç°çš„Viewå’ŒPresenterä¹Ÿåªéœ€è¦ç»§æ‰¿XXXContractä¸­çš„å¯¹åº”å†…éƒ¨æ¥å£å°±è¡Œã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„æ–¹å¼ç®¡ç†MVPä¸­çš„viewå’Œpresenterã€‚(å±€é™åœ¨äºXXXContract ä»¥æ¥å£çš„å½¢å¼è¿›è¡Œæä¾›ï¼Œæ‰€ä»¥å®ƒçš„å†…éƒ¨ç±»viewå’Œpresenteréƒ½ä¸èƒ½åšä¸€äº›å…¬å…±åˆå§‹åŒ–æ“ä½œï¼Œåªèƒ½ä»¥æ¥å£å½¢å¼æä¾›ç»™å­ç±»å®ç°ã€‚)</p><p><br></p></blockquote><blockquote><p><strong>3.2</strong> activityçš„ä½œç”¨ä¸»è¦æ˜¯åˆ›å»ºMVPä¸­Viewï¼ˆè¿™é‡Œæ˜¯ç›¸åº”çš„fragmentï¼‰ï¼Œä»¥åŠåˆ›å»ºpresenterï¼Œå¹¶æŠŠviewå’Œpresenterç»‘å®šã€‚ï¼ˆåœ¨å®é™…å¼€å‘ä¸­å¯ä»¥çµæ´»è¿ç”¨ï¼Œactivityï¼Œfragmentä»¥åŠè‡ªå®šä¹‰viewéƒ½å¯ä»¥ä½œä¸ºMVPä¸­çš„viewä½¿ç”¨ã€‚ï¼‰</p><p><br></p></blockquote><blockquote><p><strong>3.3</strong> åœ¨presenterçš„å®ç°ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œé€šè¿‡viewçš„setPresenterï¼Œè®©viewè·å¾—äº†presenterå®ä¾‹ã€‚è¿™æ ·viewä¸­å°±å¯ä»¥å¯¹Presenterä¸­çš„æ–¹æ³•è¿›è¡Œæ“ä½œäº†ã€‚</p><p><br></p></blockquote><blockquote><p><strong>3.4</strong> åœ¨presenterçš„å®ç°ç±»ä¸­ï¼Œå¯ä»¥å¯¹Modelæ•°æ®(è¿™é‡Œçš„TaskRespository)è¿›è¡Œæ“ä½œã€‚å®ä¾‹ä¸­ï¼Œæ•°æ®çš„è·å–ã€å­˜å‚¨ã€æ•°æ®çŠ¶æ€å˜åŒ–éƒ½æ˜¯modelå±‚çš„ä»»åŠ¡ï¼Œpresenterä¼šæ ¹æ®éœ€è¦è°ƒç”¨è¯¥å±‚çš„æ•°æ®å¤„ç†é€»è¾‘å¹¶åœ¨éœ€è¦æ—¶å°†å›è°ƒä¼ å…¥ã€‚è¿™æ ·modelã€presenterã€viewéƒ½åªå¤„ç†å„è‡ªçš„ä»»åŠ¡ï¼Œæ­¤ç§å®ç°ç¡®å®æ˜¯å•ä¸€èŒè´£æœ€å¥½çš„è¯ é‡Šã€‚</p><p><br></p></blockquote><hr><h1 class=pgc-h-arrow-right>4 Googleå®˜æ–¹æ¶æ„MVP+Dagger2æ¶æ„è¯¦è§£</h1><h3 class=pgc-h-arrow-right>4.1 å¯¹æ¯”</h3><p>è¿™é‡Œæˆ‘ä»¬æ¥ç€MVPé¡¹ç›®è®²è§£MVP+Dagger2é¡¹ç›®ï¼Œä¹Ÿæ˜¯å¯¹taskdetialæ¨¡å—åšå‡ºåˆ†æã€‚</p><p><br></p><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ„è¯¦è§£ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fe544df3ddd04fc2a4f17e16709deaed><p class=pgc-img-caption></p></div><p>é€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæ·»åŠ äº†å››ä¸ªä¸ªç±»æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯å…¨å±€çš„ApplicationModuleå’ŒToDoApplicationã€‚ä»¥åŠå¯¹åº”XXXæ¨¡å—ä¸­çš„XXXComponentå’ŒXXXPresenterModuleã€‚å…¶ä»–æ¨¡å—ä¹Ÿç±»ä¼¼ã€‚</p><h3 class=pgc-h-arrow-right>4.2 åˆ†æ</h3><ul><li>é¦–å…ˆçœ‹çœ‹ToDoApplication,æä¾›äº†TasksRepositoryComponentçš„åˆå§‹åŒ–ã€‚</li></ul><pre><code>public class ToDoApplication extends Application {    private TasksRepositoryComponent mRepositoryComponent;    @Override    public void onCreate() {        super.onCreate();        mRepositoryComponent = DaggerTasksRepositoryComponent.builder()                .applicationModule(new ApplicationModule((getApplicationContext())))                .tasksRepositoryModule(new TasksRepositoryModule()).build();    }    public TasksRepositoryComponent getTasksRepositoryComponent() {        return mRepositoryComponent;    }}</code></pre><p>DaggerTasksRepositoryComponent æ˜¯ç”±Dagger2ç”Ÿæˆçš„ä»£ç ã€‚æˆ‘ä»¬é€šè¿‡å®ƒæ¥åˆå§‹åŒ–TasksRepositoryComponentã€‚å¹¶ä¸”å¯ä»¥çœ‹åˆ°çš„æ˜¯ApplicationModuleå’ŒTasksRepositoryModuleä¹Ÿåœ¨è¿™é‡Œè¿›è¡Œäº†ä¸€æ¬¡æ€§åˆå§‹åŒ–ã€‚TasksRepositoryéœ€è¦è¯´æ˜çš„æ˜¯æ•´ä¸ªæ•°æ®modelå±‚çš„æ ¸å¿ƒã€‚</p><ul><li>æ¥çœ‹çœ‹ApplicationModule</li></ul><pre><code>@Modulepublic final class ApplicationModule {    private final Context mContext;    ApplicationModule(Context context) {        mContext = context;    }    @Provides    Context provideContext() {        return mContext;    }}</code></pre><p>å¯ä»¥çœ‹åˆ°çš„æ˜¯è¿™é‡Œéœ€è¦çš„æ˜¯ä¸€ä¸ªapplication context çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢ToDoApplicationçš„onCreateä¸­åˆå§‹åŒ–çš„æ—¶å€™ä¼ å…¥çš„getApplicationContext()ã€‚å®ƒæœ€ç»ˆä¼šæä¾›ä¸€ä¸ªé€šè¿‡provideContext()æ–¹æ³•æä¾›ä¸€ä¸ªContextå®ä¾‹ã€‚</p><ul><li>æ¥çœ‹çœ‹TasksRepositoryModule</li></ul><pre><code>@Modulepublic class TasksRepositoryModule {    @Singleton    @Provides    @Local    TasksDataSource provideTasksLocalDataSource(Context context) {        return new TasksLocalDataSource(context);    }    @Singleton    @Provides    @Remote    TasksDataSource provideTasksRemoteDataSource() {        return new FakeTasksRemoteDataSource();    }}</code></pre><p>è¿™æ˜¯ç”¨äºmockæµ‹è¯•çš„ä¸€ä¸ªç±»ï¼Œé‡Œé¢çš„ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«è¡¨ç¤ºæœ¬åœ°æ•°æ®å’Œè¿œç¨‹æ•°æ®ï¼Œæœ€ç»ˆè¿”å›çš„éƒ½æ˜¯TasksDataSourceã€‚mockæµ‹è¯•å°±æ˜¯åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå¯¹äºæŸäº›ä¸å®¹æ˜“æ„é€ æˆ–è€…ä¸å®¹æ˜“è·å–çš„å¯¹è±¡ï¼Œç”¨ä¸€ä¸ªè™šæ‹Ÿçš„å¯¹è±¡æ¥åˆ›å»ºä»¥ä¾¿æµ‹è¯•çš„æµ‹è¯•æ–¹æ³•ã€‚è¿™é‡Œå¯¹äºæ•°æ®å¯¹è±¡ç›´æ¥åœ¨è¿™é‡Œè¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œä¸æ˜¯åœ¨æ‰€æœ‰çš„ç”¨åˆ°è¯¥æ•°æ®çš„åœ°æ–¹newä¸€éã€‚è¿™ä¹Ÿå°±ä½“ç°äº†Dagger2çš„å¼•å…¥å¯¹æµ‹è¯•æ˜¯ä¸€ä¸ªæå¤§çš„ä¾¿åˆ©ã€‚</p><ul><li>ç°åœ¨å›åˆ°æ•´ä¸ªåº”ç”¨çš„æ ¸å¿ƒTasksRepositoryComponent,ä¹Ÿå°±æ˜¯åœ¨ToDoApplicationä¸­åˆå§‹åŒ–çš„æ ¸å¿ƒç±»ã€‚</li></ul><pre><code>@Singleton@Component(modules = {TasksRepositoryModule.class, ApplicationModule.class})public interface TasksRepositoryComponent {    TasksRepository getTasksRepository();}</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™é‡ŒDagger2å…è®¸æˆ‘ä»¬ä¸ºComponentä½¿ç”¨@Singletonæ¥ä¿æŒå•ä¾‹æ¨¡å¼ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ToDoApplicationä¹Ÿå†æ¬¡è¿›è¡Œäº†å•ä¾‹åˆ›å»ºï¼Œè¿™æ˜¯å¿…è¦çš„ä¸€æ­¥ã€‚åŒæ—¶è¿™é‡Œå®šä¹‰çš„TasksRepositoryModule.classå’ŒApplicationModule.class ä¹Ÿæ˜¯åœ¨ToDoApplicationè¿›è¡Œåˆå§‹åŒ–åˆ›å»ºçš„ã€‚ éƒ½è¯´Componentå°±æ˜¯ä¸€ä¸ªæ³¨å…¥å™¨ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯@Injectå’Œ@Moduleçš„æ¡¥æ¢ã€‚ é‚£ä¹ˆé“¾æ¥äº†@Moduleï¼Œæˆ‘ä»¬çœ‹çœ‹æ˜¯å¦‚ä½•é“¾æ¥@Injectçš„å§ï¼Ÿ</p><ul><li>ç°åœ¨è¿›å…¥å¯¹åº”æ¨¡å—taskdetailæ¨¡å—ï¼Œé¦–å…ˆçœ‹çœ‹TaskDetailComponent.</li></ul><pre><code>@FragmentScoped@Component(dependencies = TasksRepositoryComponent.class, modules = TaskDetailPresenterModule.class)public interface TaskDetailComponent {        void inject(TaskDetailActivity taskDetailActivity);}</code></pre><pre><code>@Documented@Scope@Retention(RetentionPolicy.RUNTIME)public @interface FragmentScoped {}</code></pre><p>è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æä¾›æ³¨å…¥injectæ–¹æ³•çš„åœ°æ–¹ã€‚ä»æ³¨è§£ä¸­å¯ä»¥çœ‹åˆ°ä¾èµ–äºTasksRepositoryComponent.classæ‰€ä»¥å…¶ä¸­çš„TaskRespositoryå¯¹äºå½“å‰componentæ˜¯å¯ç”¨çš„ã€‚</p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯åœ¨Daggerä¸­ï¼Œä¸€ä¸ªæ²¡æœ‰ä½œç”¨åŸŸï¼ˆunscoped ï¼‰çš„ç»„ä»¶ä¸å¯ä»¥ä¾èµ–æœ‰ä½œç”¨åŸŸçš„ç»„ä»¶ã€‚æ¯”å¦‚è¿™é‡Œçš„TasksRepositoryComponentä½œç”¨åŸŸä¸º@Singletonã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œè‡ªå®šä¹‰äº†ä¸€ä¸ªç”±æ‰€æœ‰fragmentä½¿ç”¨çš„FragmentScopedã€‚å¦å¤–ï¼Œç»„ä»¶æœ‰ç¡®å®šä½œç”¨åŸŸï¼Œé‚£ä¹ˆä¾èµ–å®ƒçš„ç»„ä»¶ä¸èƒ½æœ‰ç›¸åŒçš„ä½œç”¨åŸŸã€‚</p></blockquote><ul><li>æ¥ä¸‹æ¥çœ‹çœ‹TaskDetailComponentä¸­å®šä¹‰çš„æ¨¡å—TaskDetailPresenterModule.class</li></ul><pre><code>@Modulepublic class TaskDetailPresenterModule {    private final TaskDetailContract.View mView;    private final String mTaskId;    public TaskDetailPresenterModule(TaskDetailContract.View view, String taskId) {        mView = view;        mTaskId = taskId;    }    @Provides    TaskDetailContract.View provideTaskDetailContractView() {        return mView;    }    @Provides    String provideTaskId() {        return mTaskId;    }}</code></pre><p>ä¸»è¦æ˜¯æä¾›MVPä¸­ç›¸åº”æ¨¡å—çš„Viewçš„è¿”å›ï¼Œè¿™åœ¨ä¸Šé¢ä¸€èŠ‚ä¸­æåˆ°è¿‡ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°è¿”å›ç±»å‹æ˜¯TaskDetailContract.View ã€‚ä¹Ÿæ˜¯åœ¨è¿™é‡Œå®ŒæˆMVPæ¨¡å¼ä¸­é‡è¦çš„ä¸€ç¯ï¼Œä¹Ÿå°±æ˜¯Presenterå’ŒViewçš„å®ä¾‹çš„è·å–ï¼Œä¸ç„¶Presenteræ€ä¹ˆå‘Šè¯‰Viewæ€ä¹ˆæ›´æ–°Viewå‘¢ï¼</p><ul><li>æ¥ä¸‹æ¥çœ‹çœ‹Presenterçš„åˆ›å»ºã€‚åœ¨ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬å°±çŸ¥é“äº†Presenterç”±TaskDetailActivityè¿›è¡Œåˆ›å»ºã€‚å®é™…ä¸Šçš„MVPä¸­çš„Viewæ˜¯TaskDetailFragmentã€‚å› ä¸ºè¿™é‡Œæ˜¯é€šè¿‡view.setPresenteræ–¹å¼å®Œæˆpresenterå’Œviewçš„é“¾æ¥ã€‚æ‰€ä»¥è¿™é‡Œä¸å†èµ˜è¿°Viewä¸­çš„ç»†èŠ‚ã€‚</li></ul><pre><code>public class TaskDetailActivity extends AppCompatActivity {    @Inject TaskDetailPresenter mTaskDetailPresenter;    @Override    protected void onCreate(Bundle savedInstanceState) {       ......        if (taskDetailFragment == null) {            taskDetailFragment = TaskDetailFragment.newInstance(taskId);            ActivityUtils.addFragmentToActivity(getSupportFragmentManager(),                    taskDetailFragment, R.id.contentFrame);        }        // Create the presenter        DaggerTaskDetailComponent.builder()                .taskDetailPresenterModule(new TaskDetailPresenterModule(taskDetailFragment, taskId))                .tasksRepositoryComponent(((ToDoApplication) getApplication())                .getTasksRepositoryComponent()).build()                .inject(this);    }......}</code></pre><ul><li>çœ‹çœ‹TaskDetailPresenter</li></ul><pre><code>final class TaskDetailPresenter implements TaskDetailContract.Presenter {    private TasksRepository mTasksRepository;//Model    private TaskDetailContract.View mTaskDetailView;//View    /**     * Dagger strictly enforces that arguments not marked with {@code @Nullable} are not injected     * with {@code @Nullable} values.     */    @Nullable String mTaskId;    /**     * Dagger strictly enforces that arguments not marked with {@code @Nullable} are not injected     * with {@code @Nullable} values.     */    @Inject    TaskDetailPresenter(@Nullable String taskId,            TasksRepository tasksRepository,            TaskDetailContract.View taskDetailView) {        mTasksRepository = tasksRepository;        mTaskDetailView = taskDetailView;        mTaskId = taskId;    }    /**     * Method injection is used here to safely reference {@code this} after the object is created.     * For more information, see Java Concurrency in Practice.     */    @Inject    void setupListeners() {        mTaskDetailView.setPresenter(this);    }...Presenterä¸­çš„æ“ä½œ...}</code></pre><p>é™¤äº†Presenterä¸­çš„æ“ä½œï¼Œè¿™é‡Œä¸»è¦å°±æ˜¯æœ‰ä¸€ä¸ª@injectæ ‡æ³¨çš„æ–¹æ³•ï¼Œæ„é€ å‡½æ•°ï¼Œè¿˜æœ‰å­—æ®µã€‚åˆ°è¿™é‡Œä¹Ÿå°±å®Œæˆäº†MVPä¸­Dagger2 çš„ä½¿ç”¨ ã€‚è¿˜åœ¨ç­‰ä»€ä¹ˆï¼Ÿèµ¶å¿«å°†å®ƒç”¨åˆ°ä½ çš„é¡¹ç›®ä¸­å§ï¼</p><hr><h1 class=pgc-h-arrow-right>5 Dagger2æ·»åŠ æ­¥éª¤ï¼š</h1><p>è¿™é‡Œå†æ¬¡æ€»ç»“ä¸€ä¸‹Dagger2æ·»åŠ æ­¥éª¤ã€‚</p><ul><li>step 1ï¼šæ·»åŠ android-apt, dagger 2, dagger2-compilerä»¥åŠjavax annotationåˆ°build.gradle.(æ³¨æ„ä»–ä»¬ä¸éƒ½æ˜¯compileçš„å½¢å¼)</li><li>step 2ï¼šæ·»åŠ æ¨¡å—ï¼ˆmoduleï¼‰,ApplicationModuleå°†ä¼šæ³¨å…¥Application Context åˆ°éœ€è¦çš„ç±»ä¸­ã€‚</li><li>step 3ï¼šæ·»åŠ ç»„ä»¶Component, Dagger2 å°†ä¼šä¸ºä½ åˆ›å»ºçš„æ‰€æœ‰componentç”Ÿæˆä»£ç ã€‚ä½¿ç”¨æ–‡ä»¶åDaggerï¼ˆComponentï¼‰çš„å½¢å¼ã€‚Componentå¯ä»¥æ‹¥æœ‰å¤šä¸ªmoduleã€‚ï¼ˆæ¯”å¦‚DaggerTaskDetailComponentæ‹¥æœ‰TaskDetailPresenterModuleæ¨¡å—ï¼‰</li><li>step 4: ç»§æ‰¿android.app.Applicationç±»ï¼Œå¹¶ä¸”åœ¨AndroidManifest.xmlä¸­å£°æ˜ä½¿ç”¨çš„applicationç±»ã€‚åœ¨å®ƒçš„onCreate()æ–¹æ³•ä¸­æ„å»ºä¸»è¦ç»„ä»¶ï¼ˆmain componentï¼‰</li></ul><pre><code>       mRepositoryComponent = DaggerTasksRepositoryComponent.builder()                .applicationModule(new ApplicationModule((getApplicationContext())))                .tasksRepositoryModule(new TasksRepositoryModule()).build();</code></pre><ul><li>step 5: æ·»åŠ æ³¨å…¥æ–¹æ³•ï¼ˆinjectï¼‰åˆ°Component æ¥å£ä¸­ï¼Œä½ éœ€è¦ä¸ºæ¯ä¸€ä¸ªå‚ä¸åˆ°ä¾èµ–æ³¨å…¥çš„ç±»æ·»åŠ inject()æ–¹æ³•ã€‚(æ³¨æ„åœ¨dagger2ä¸­ï¼šä¸ºçˆ¶ç±»æ³¨å…¥çš„ä¾èµ–å¹¶ä¸ä¼šä¸ºå­ç±»æ³¨å…¥ä¾èµ–å…³ç³»ï¼Œä¸ºå­ç±»æ³¨å…¥çš„ä¾èµ–å…³ç³»åˆ™å¯ä»¥ä¸ºçˆ¶ç±»æ³¨å…¥ä¾èµ–å…³ç³»)å‚è€ƒä¸Šé¢çš„TaskDetailPresenteræ–¹æ³•ã€‚</li><li>step 6: æ³¨å…¥ä¾èµ–ï¼Œç”¨injectï¼Œæ›¿æ¢ä½ æ–°å»ºå¯¹è±¡å®ä¾‹çš„åœ°æ–¹ã€‚æŠŠè¿™äº›æ–°å»ºå®ä¾‹çš„åœ°æ–¹ç§»åˆ°Modulesä¸­å¹¶ä¸”æ·»åŠ @Providesæ ‡æ³¨ã€‚å¯ä»¥å‚è€ƒä¸Šé¢çš„ ApplicationModule.java,åœ¨ä½¿ç”¨@Injectï¼Œè¯·ç¡®ä¿è°ƒç”¨Component.inject()æ–¹æ³•ã€‚å¯ä»¥å‚è€ƒä¸Šé¢çš„TaskDetailActivity.</li><li>step 7: (å¯é€‰ï¼Œæ¨è)å°†getApplicationComponent()ç§»åˆ°çˆ¶ç±»ä¸­ï¼ˆä¸€èˆ¬æ˜¯æŒ‡BaseActivityï¼‰</li></ul><p>å®è·µå‡ºçœŸçŸ¥ï¼Œè¿˜æ˜¯å¸Œæœ›ä½ å¯ä»¥äº²æ‰‹å†™å†™ï¼Œç„¶åå†å›è¿‡å¤´æ¥çœ‹è¿™ç¯‡æ–‡ç« ã€‚</p><p><br>å…³æ³¨å°ç¼–ä¸è¿·è·¯ï¼Œåç»­è¿˜ä¼šæ›´æ–°æ›´å¤šç²¾å½©å†…å®¹å“¦</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Google','MVP','Dagger2'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>