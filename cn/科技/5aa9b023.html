<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ | æå®¢å¿«è¨Š</title><meta property="og:title" content="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/RiGWAV4Aw9MAi3"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5aa9b023.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5aa9b023.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5aa9b023.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5aa9b023.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5aa9b023.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5aa9b023.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5aa9b023.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5aa9b023.html><meta property="article:published_time" content="2020-10-29T21:09:45+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:45+08:00"><meta name=Keywords content><meta name=description content="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/5aa9b023.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><img alt="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/RiGWAV4Aw9MAi3><p>ä½œè€… | æµ·æ˜Ÿ</p><p>æ¥æº | JavaKeeperï¼ˆIDï¼šJavaKeeperï¼‰</p><p><strong>Keeperå¯¼è¯»</strong>ï¼šå‰å‡ å¤©èµ·èº«å»â€œå¤–è¾¹â€çœ‹äº†çœ‹ï¼Œé˜¿é‡Œå¥åº·çš„ä¸€ä¸ªé¢è¯•å®˜ä¸€ç›´åœ¨é—®æˆ‘è¿™ä¸ªé—®é¢˜ï¼Œå›ç­”çš„ä¸€èˆ¬ï¼Œç”¨äº†ä¸¤å¤©æ—¶é—´æ•´ç†ï¼Œå¸Œæœ›å¤§å®¶ä¹Ÿèƒ½çœŸæ­£ç†è§£äº†ã€‚</p><img alt="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RT4Gwk56bt5iOJ><p><strong>å‰è¨€</strong></p><p>å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œç®—æ˜¯ä¸€é“çƒ‚å¤§è¡—çš„é¢è¯•é¢˜äº†ï¼Œè§£æ¯’ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><p>åˆå­¦ Spring çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±çŸ¥é“ IOCï¼Œæ§åˆ¶åè½¬ä¹ˆï¼Œå®ƒå°†åŸæœ¬åœ¨ç¨‹åºä¸­æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡çš„æ§åˆ¶æƒï¼Œäº¤ç”± Spring æ¡†æ¶æ¥ç®¡ç†ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»å„ç§ new XXXã€‚</p><p>å°½ç®¡æ˜¯ Spring ç®¡ç†ï¼Œä¸ä¹Ÿå¾—åˆ›å»ºå¯¹è±¡å—ï¼Œ Java å¯¹è±¡çš„åˆ›å»ºæ­¥éª¤å¾ˆå¤šï¼Œå¯ä»¥ new XXXã€åºåˆ—åŒ–ã€clone ç­‰ç­‰ï¼Œ åªæ˜¯ Spring æ˜¯é€šè¿‡åå°„ + å·¥å‚çš„æ–¹å¼åˆ›å»ºå¯¹è±¡å¹¶æ”¾åœ¨å®¹å™¨çš„ï¼Œåˆ›å»ºå¥½çš„å¯¹è±¡æˆ‘ä»¬ä¸€èˆ¬è¿˜ä¼šå¯¹å¯¹è±¡å±æ€§è¿›è¡Œèµ‹å€¼ï¼Œæ‰å»ä½¿ç”¨ï¼Œå¯ä»¥ç†è§£æ˜¯åˆ†äº†ä¸¤ä¸ªæ­¥éª¤ã€‚</p><p>å¥½äº†ï¼Œå¯¹è¿™ä¸¤ä¸ªæ­¥éª¤æœ‰ä¸ªå°è±¡å°±è¡Œï¼Œæ¥ç€æˆ‘ä»¬è¿›å…¥å¾ªç¯ä¾èµ–ï¼Œå…ˆè¯´ä¸‹å¾ªç¯ä¾èµ–çš„æ¦‚å¿µã€‚</p><p>æ‰€è°“çš„å¾ªç¯ä¾èµ–æ˜¯æŒ‡ï¼ŒA ä¾èµ– Bï¼ŒB åˆä¾èµ– Aï¼Œå®ƒä»¬ä¹‹é—´å½¢æˆäº†å¾ªç¯ä¾èµ–ã€‚æˆ–è€…æ˜¯ A ä¾èµ– Bï¼ŒB ä¾èµ– Cï¼ŒC åˆä¾èµ– Aï¼Œå½¢æˆäº†å¾ªç¯ä¾èµ–ã€‚æ›´æˆ–è€…æ˜¯è‡ªå·±ä¾èµ–è‡ªå·±ã€‚å®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»å¦‚ä¸‹ï¼š</p><img alt="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/S9o5jNS6sXa4uU><p>è¿™é‡Œä»¥ä¸¤ä¸ªç±»ç›´æ¥ç›¸äº’ä¾èµ–ä¸ºä¾‹ï¼Œä»–ä»¬çš„å®ç°ä»£ç å¯èƒ½å¦‚ä¸‹ï¼š</p><pre><div><pre><p>public class BeanB {</p><p>private BeanA beanA;</p><p>public void <strong class=highlight-text toutiao-origin=span>setBeanA</strong>(BeanA beanA) {</p><p>this.beanA = beanA;</p><p>}</p><p>}</p><p>public class BeanA {</p><p>private BeanB beanB;</p><p>public void <strong class=highlight-text toutiao-origin=span>setBeanB</strong>(BeanB beanB) {</p><p>this.beanB = beanB;</p><p>}</p><p>}</p></pre></div></pre><p>é…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼ˆç”¨æ³¨è§£æ–¹å¼æ³¨å…¥åŒç†ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œç”¨äº†é…ç½®æ–‡ä»¶ï¼‰ï¼š</p><pre><div><pre><p>&lt;bean id="beanA" class="priv.starfish.BeanA"&gt;</p><p>&lt;property name="beanB" ref="beanB"/&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean id="beanB" class="priv.starfish.BeanB"&gt;</p><p>&lt;property name="beanA" ref="beanA"/&gt;</p><p>&lt;/bean&gt;</p></pre></div></pre><p>Spring å¯åŠ¨åï¼Œè¯»å–å¦‚ä¸Šçš„é…ç½®æ–‡ä»¶ï¼Œä¼šæŒ‰é¡ºåºå…ˆå®ä¾‹åŒ– Aï¼Œä½†æ˜¯åˆ›å»ºçš„æ—¶å€™åˆå‘ç°å®ƒä¾èµ–äº† Bï¼Œæ¥ç€å°±å»å®ä¾‹åŒ– B ï¼ŒåŒæ ·åˆå‘ç°å®ƒä¾èµ–äº† A ï¼Œè¿™å°¼ç›å’‹æ•´ï¼Ÿæ— é™å¾ªç¯å‘€ã€‚</p><p>Spring â€œè‚¯å®šâ€ä¸ä¼šè®©è¿™ç§äº‹æƒ…å‘ç”Ÿçš„ï¼Œå¦‚å‰è¨€æˆ‘ä»¬è¯´çš„ Spring å®ä¾‹åŒ–å¯¹è±¡åˆ†ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥ä¼šå…ˆåˆ›å»ºä¸€ä¸ªåŸå§‹å¯¹è±¡ï¼Œåªæ˜¯æ²¡æœ‰è®¾ç½®å±æ€§ï¼Œå¯ä»¥ç†è§£ä¸º"åŠæˆå“"â€”â€” å®˜æ–¹å« A å¯¹è±¡çš„æ—©æœŸå¼•ç”¨ï¼ˆEarlyBeanReferenceï¼‰ï¼Œæ‰€ä»¥å½“å®ä¾‹åŒ– B çš„æ—¶å€™å‘ç°ä¾èµ–äº† Aï¼Œ B å°±ä¼šæŠŠè¿™ä¸ªâ€œåŠæˆå“â€è®¾ç½®è¿›å»å…ˆå®Œæˆå®ä¾‹åŒ–ï¼Œæ—¢ç„¶ B å®Œæˆäº†å®ä¾‹åŒ–ï¼Œæ‰€ä»¥ A å°±å¯ä»¥è·å¾— B çš„å¼•ç”¨ï¼Œä¹Ÿå®Œæˆå®ä¾‹åŒ–äº†ï¼Œè¿™å…¶å®å°±æ˜¯ Spring è§£å†³å¾ªç¯ä¾èµ–çš„æ€æƒ³ã€‚</p><p>ä¸ç†è§£æ²¡å…³ç³»ï¼Œå…ˆæœ‰ä¸ªå¤§æ¦‚çš„å°è±¡ï¼Œç„¶åæˆ‘ä»¬ä»æºç æ¥çœ‹ä¸‹ Spring å…·ä½“æ˜¯æ€ä¹ˆè§£å†³çš„ã€‚</p><img alt="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RT7S2kzFTfre26><p></p><h1 toutiao-origin=h2>æºç è§£æ¯’</h1><blockquote><p>ä»£ç ç‰ˆæœ¬ï¼š5.0.16.RELEASE</p></blockquote><p>åœ¨ Spring IOC å®¹å™¨è¯»å– Bean é…ç½®åˆ›å»º Bean å®ä¾‹ä¹‹å‰, å¿…é¡»å¯¹å®ƒè¿›è¡Œå®ä¾‹åŒ–ã€‚åªæœ‰åœ¨å®¹å™¨å®ä¾‹åŒ–åï¼Œæ‰å¯ä»¥ä» IOC å®¹å™¨é‡Œè·å– Bean å®ä¾‹å¹¶ç”¨ï¼Œå¾ªç¯ä¾èµ–é—®é¢˜ä¹Ÿå°±æ˜¯å‘ç”Ÿåœ¨å®ä¾‹åŒ– Bean çš„è¿‡ç¨‹ä¸­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå›é¡¾ä¸‹è·å– Bean çš„è¿‡ç¨‹ã€‚</p><p></p><h2 toutiao-origin=h3><strong>è·å– Bean æµç¨‹</strong></h2><p>Spring IOC å®¹å™¨ä¸­è·å– bean å®ä¾‹çš„ç®€åŒ–ç‰ˆæµç¨‹å¦‚ä¸‹ï¼ˆæ’é™¤äº†å„ç§åŒ…è£…å’Œæ£€æŸ¥çš„è¿‡ç¨‹ï¼‰</p><img alt="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/S9o5jNsDOKJHqz><p>å¤§æ¦‚çš„æµç¨‹é¡ºåºï¼ˆå¯ä»¥ç»“åˆè‘—æºç çœ‹ä¸‹ï¼Œæˆ‘å°±ä¸è´´äº†ï¼‰ï¼š</p><ol><li><p>æµç¨‹ä» getBean æ–¹æ³•å¼€å§‹ï¼ŒgetBean æ˜¯ä¸ªç©ºå£³æ–¹æ³•ï¼Œæ‰€æœ‰é€»è¾‘ç›´æ¥åˆ° doGetBean æ–¹æ³•ä¸­ã€‚</p></li><li><p>transformedBeanName å°† name è½¬æ¢ä¸ºçœŸæ­£çš„ beanNameï¼ˆname å¯èƒ½æ˜¯ FactoryBean ä»¥ & å­—ç¬¦å¼€å¤´æˆ–è€…æœ‰åˆ«åçš„æƒ…å†µï¼Œæ‰€ä»¥éœ€è¦è½¬åŒ–ä¸‹ï¼‰ã€‚</p></li><li><p>ç„¶åé€šè¿‡ getSingleton(beanName) æ–¹æ³•å°è¯•ä»ç¼“å­˜ä¸­æŸ¥æ‰¾æ˜¯ä¸æ˜¯æœ‰è¯¥å®ä¾‹ sharedInstanceï¼ˆå•ä¾‹åœ¨ Spring çš„åŒä¸€å®¹å™¨åªä¼šè¢«åˆ›å»ºä¸€æ¬¡ï¼Œåç»­å†è·å– beanï¼Œå°±ç›´æ¥ä»ç¼“å­˜è·å–å³å¯ï¼‰ã€‚</p></li><li><p>å¦‚æœæœ‰çš„è¯ï¼ŒsharedInstance å¯èƒ½æ˜¯å®Œå…¨å®ä¾‹åŒ–å¥½çš„ beanï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªåŸå§‹çš„ beanï¼Œæ‰€ä»¥å†ç» getObjectForBeanInstance å¤„ç†å³å¯è¿”å›ã€‚</p></li><li><p>å½“ç„¶ sharedInstance ä¹Ÿå¯èƒ½æ˜¯ ï¼Œè¿™æ—¶å€™å°±ä¼šæ‰§è¡Œåˆ›å»º bean çš„é€»è¾‘ï¼Œå°†ç»“æœè¿”å›ã€‚</p></li></ol><p>ç¬¬ä¸‰æ­¥çš„æ—¶å€™æˆ‘ä»¬æåˆ°äº†ä¸€ä¸ªç¼“å­˜çš„æ¦‚å¿µï¼Œè¿™ä¸ªå°±æ˜¯ Spring ä¸ºäº†è§£å†³å•ä¾‹çš„å¾ªç¯ä¾èµ–é—®é¢˜è€Œè®¾è®¡çš„ä¸‰çº§ç¼“å­˜ï¼š</p><pre><div><pre><p>/** Cache of singleton objects: bean name --&gt; bean instance */</p><p>private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;&gt;(256);</p><p>/** Cache of singleton factories: bean name --&gt; ObjectFactory */</p><p>private final Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = new HashMap&lt;&gt;(16);</p><p>/** Cache of early singleton objects: bean name --&gt; bean instance */</p><p>private final Map&lt;String, Object&gt; earlySingletonObjects = new HashMap&lt;&gt;(16);</p></pre></div></pre><p>è¿™ä¸‰çº§ç¼“å­˜çš„ä½œç”¨åˆ†åˆ«æ˜¯ï¼š</p><ul><li><p>singletonObjectsï¼šå®Œæˆåˆå§‹åŒ–çš„å•ä¾‹å¯¹è±¡çš„ cacheï¼Œè¿™é‡Œçš„ bean ç»å†è¿‡ å®ä¾‹åŒ–->å±æ€§å¡«å……->åˆå§‹åŒ– ä»¥åŠå„ç§åç½®å¤„ç†ï¼ˆä¸€çº§ç¼“å­˜ï¼‰ã€‚</p></li><li><p>earlySingletonObjectsï¼šå­˜æ”¾åŸå§‹çš„ bean å¯¹è±¡ï¼ˆå®Œæˆå®ä¾‹åŒ–ä½†æ˜¯å°šæœªå¡«å……å±æ€§å’Œåˆå§‹åŒ–ï¼‰ï¼Œä»…ä»…èƒ½ä½œä¸ºæŒ‡é’ˆæå‰æ›å…‰ï¼Œè¢«å…¶ä»– bean æ‰€å¼•ç”¨ï¼Œç”¨äºè§£å†³å¾ªç¯ä¾èµ–çš„ ï¼ˆäºŒçº§ç¼“å­˜ï¼‰ã€‚</p></li><li><p>singletonFactoriesï¼šåœ¨ bean å®ä¾‹åŒ–å®Œä¹‹åï¼Œå±æ€§å¡«å……ä»¥åŠåˆå§‹åŒ–ä¹‹å‰ï¼Œå¦‚æœå…è®¸æå‰æ›å…‰ï¼ŒSpring ä¼šå°†å®ä¾‹åŒ–åçš„ bean æå‰æ›å…‰ï¼Œä¹Ÿå°±æ˜¯æŠŠè¯¥ bean è½¬æ¢æˆ beanFactory å¹¶åŠ å…¥åˆ° singletonFactoriesï¼ˆä¸‰çº§ç¼“å­˜ï¼‰ã€‚</p></li></ul><p>æˆ‘ä»¬é¦–å…ˆä»ç¼“å­˜ä¸­è¯•ç€è·å– beanï¼Œå°±æ˜¯ä»è¿™ä¸‰çº§ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼š</p><pre><div><pre><p>protected Object getSingleton(String beanName, boolean allowEarlyReference) {</p><p>// ä» singletonObjects è·å–å®ä¾‹ï¼ŒsingletonObjects ä¸­çš„å®ä¾‹éƒ½æ˜¯å‡†å¤‡å¥½çš„ bean å®ä¾‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨</p><p>Object singletonObject = this.singletonObjects.get(beanName);</p><p>//isSingletonCurrentlyInCreation åˆ¤æ–­å½“å‰å•ä¾‹beanæ˜¯å¦æ­£åœ¨åˆ›å»ºä¸­</p><p>if (singletonObject ==  &amp;&amp; isSingletonCurrentlyInCreation(beanName)) {</p><p>synchronized (this.singletonObjects) {</p><p>// ä¸€çº§ç¼“å­˜æ²¡æœ‰ï¼Œå°±å»äºŒçº§ç¼“å­˜æ‰¾</p><p>singletonObject = this.earlySingletonObjects.get(beanName);</p><p>if (singletonObject ==  &amp;&amp; allowEarlyReference) {</p><p>// äºŒçº§ç¼“å­˜ä¹Ÿæ²¡æœ‰ï¼Œå°±å»ä¸‰çº§ç¼“å­˜æ‰¾</p><p>ObjectFactory&lt;?&gt; singletonFactory = this.singletonFactories.get(beanName);</p><p>if (singletonFactory != ) {</p><p>// ä¸‰çº§ç¼“å­˜æœ‰çš„è¯ï¼Œå°±æŠŠä»–ç§»åŠ¨åˆ°äºŒçº§ç¼“å­˜,.getObject åç»­ä¼šè®²åˆ°</p><p>singletonObject = singletonFactory.getObject;</p><p>this.earlySingletonObjects.put(beanName, singletonObject);</p><p>this.singletonFactories.remove(beanName);</p><p>}</p><p>}</p><p>}</p><p>}</p><p>return singletonObject;</p><p>}</p></pre></div></pre><p>å¦‚æœç¼“å­˜æ²¡æœ‰çš„è¯ï¼Œæˆ‘ä»¬å°±è¦åˆ›å»ºäº†ï¼Œæ¥ç€æˆ‘ä»¬ä»¥å•ä¾‹å¯¹è±¡ä¸ºä¾‹ï¼Œå†çœ‹ä¸‹åˆ›å»º bean çš„é€»è¾‘ï¼ˆå¤§æ‹¬å·è¡¨ç¤ºå†…éƒ¨ç±»è°ƒç”¨æ–¹æ³•ï¼‰ï¼š</p><img alt="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/S9o5jOVA7vGz4K><p>1ã€åˆ›å»º bean ä»ä»¥ä¸‹ä»£ç å¼€å§‹ï¼Œä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»æ–¹æ³•å‚æ•°ï¼ˆæ€»è§‰å¾— Lambda çš„æ–¹å¼å¯è¯»æ€§ä¸å¦‚å†…éƒ¨ç±»å¥½ç†è§£ï¼‰ã€‚</p><pre><div><pre><p>if (mbd.isSingleton) {</p><p>sharedInstance = getSingleton(beanName,  -&gt; {</p><p>try {</p><p>return createBean(beanName, mbd, args);</p><p>}</p><p>catch (BeansException ex) {</p><p>destroySingleton(beanName);</p><p>throw ex;</p><p>}</p><p>});</p><p>bean = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);</p><p>}</p></pre></div></pre><p>getSingleton æ–¹æ³•å†…éƒ¨ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p><pre><div><pre><p>public Object getSingleton(String beanName, ObjectFactory&lt;?&gt; singletonFactory) {</p><p>// åˆ›å»º singletonObject</p><p>singletonObject = singletonFactory.getObject;</p><p>// å°† singletonObject æ”¾å…¥ç¼“å­˜</p><p>addSingleton(beanName, singletonObject);</p><p>}</p></pre></div></pre><p>2ã€getObject åŒ¿åå†…éƒ¨ç±»çš„å®ç°çœŸæ­£è°ƒç”¨çš„åˆæ˜¯ createBean(beanName, mbd, args)ã€‚</p><p>3ã€å¾€é‡Œèµ°ï¼Œä¸»è¦çš„å®ç°é€»è¾‘åœ¨ doCreateBeanæ–¹æ³•ï¼Œå…ˆé€šè¿‡ createBeanInstance åˆ›å»ºä¸€ä¸ªåŸå§‹ bean å¯¹è±¡ã€‚</p><p>4ã€æ¥ç€ addSingletonFactory æ·»åŠ  bean å·¥å‚å¯¹è±¡åˆ° singletonFactories ç¼“å­˜ï¼ˆä¸‰çº§ç¼“å­˜ï¼‰ã€‚</p><p>5ã€é€šè¿‡ populateBean æ–¹æ³•å‘åŸå§‹ bean å¯¹è±¡ä¸­å¡«å……å±æ€§ï¼Œå¹¶è§£æä¾èµ–ï¼Œå‡è®¾è¿™æ—¶å€™åˆ›å»º A ä¹‹åå¡«å……å±æ€§æ—¶å‘ç°ä¾èµ– Bï¼Œç„¶ååˆ›å»ºä¾èµ–å¯¹è±¡ B çš„æ—¶å€™åˆå‘ç°ä¾èµ– Aï¼Œè¿˜æ˜¯åŒæ ·çš„æµç¨‹ï¼Œåˆå» getBean(A)ï¼Œè¿™ä¸ªæ—¶å€™ä¸‰çº§ç¼“å­˜å·²ç»æœ‰äº† beanA çš„â€œåŠæˆå“â€ï¼Œè¿™æ—¶å°±å¯ä»¥æŠŠ A å¯¹è±¡çš„åŸå§‹å¼•ç”¨æ³¨å…¥ B å¯¹è±¡ï¼ˆå¹¶å°†å…¶ç§»åŠ¨åˆ°äºŒçº§ç¼“å­˜ï¼‰æ¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ã€‚è¿™æ—¶å€™ getObject æ–¹æ³•å°±ç®—æ‰§è¡Œç»“æŸäº†ï¼Œè¿”å›å®Œå…¨å®ä¾‹åŒ–çš„ beanã€‚</p><p>6ã€æœ€åè°ƒç”¨ addSingleton æŠŠå®Œå…¨å®ä¾‹åŒ–å¥½çš„ bean å¯¹è±¡æ”¾å…¥ singletonObjects ç¼“å­˜ï¼ˆä¸€çº§ç¼“å­˜ï¼‰ä¸­ï¼Œæ‰“å®Œæ”¶å·¥ã€‚</p><p></p><h2 toutiao-origin=h3><strong>Spring è§£å†³å¾ªç¯ä¾èµ–</strong></h2><p>å»ºè®®æ­é…ç€â€œæºç â€çœ‹ä¸‹è¾¹çš„é€»è¾‘å›¾ï¼Œæ›´å¥½ä¸‹é¥­ã€‚</p><img alt="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/S9o5jPO8NyCje3><p>æµç¨‹å…¶å®ä¸Šè¾¹éƒ½å·²ç»è¯´è¿‡äº†ï¼Œç»“åˆè‘—ä¸Šå›¾æˆ‘ä»¬å†çœ‹ä¸‹å…·ä½“ç»†èŠ‚ï¼Œç”¨å¤§ç™½è¯å†æ‹ä¸€æ‹ï¼š</p><ol><li><p>Spring åˆ›å»º bean ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼Œåˆ›å»ºåŸå§‹ bean å¯¹è±¡ï¼Œæ¥ç€å»å¡«å……å¯¹è±¡å±æ€§å’Œåˆå§‹åŒ–ã€‚</p></li><li><p>æ¯æ¬¡åˆ›å»º bean ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½ä¼šä»ç¼“å­˜ä¸­æŸ¥ä¸‹æœ‰æ²¡æœ‰è¯¥ beanï¼Œå› ä¸ºæ˜¯å•ä¾‹ï¼Œåªèƒ½æœ‰ä¸€ä¸ªã€‚</p></li><li><p>å½“æˆ‘ä»¬åˆ›å»º beanA çš„åŸå§‹å¯¹è±¡åï¼Œå¹¶æŠŠå®ƒæ”¾åˆ°ä¸‰çº§ç¼“å­˜ä¸­ï¼Œæ¥ä¸‹æ¥å°±è¯¥å¡«å……å¯¹è±¡å±æ€§äº†ï¼Œè¿™æ—¶å€™å‘ç°ä¾èµ–äº† beanBï¼Œæ¥ç€å°±åˆå»åˆ›å»º beanBï¼ŒåŒæ ·çš„æµç¨‹ï¼Œåˆ›å»ºå®Œ beanB å¡«å……å±æ€§æ—¶åˆå‘ç°å®ƒä¾èµ–äº† beanAï¼Œåˆæ˜¯åŒæ ·çš„æµç¨‹ï¼Œä¸åŒçš„æ˜¯ï¼Œè¿™æ—¶å€™å¯ä»¥åœ¨ä¸‰çº§ç¼“å­˜ä¸­æŸ¥åˆ°åˆšæ”¾è¿›å»çš„åŸå§‹å¯¹è±¡ beanAï¼Œæ‰€ä»¥ä¸éœ€è¦ç»§ç»­åˆ›å»ºï¼Œç”¨å®ƒæ³¨å…¥ beanBï¼Œå®Œæˆ beanB çš„åˆ›å»ºã€‚</p></li><li><p>æ—¢ç„¶ beanB åˆ›å»ºå¥½äº†ï¼Œæ‰€ä»¥ beanA å°±å¯ä»¥å®Œæˆå¡«å……å±æ€§çš„æ­¥éª¤äº†ï¼Œæ¥ç€æ‰§è¡Œå‰©ä¸‹çš„é€»è¾‘ï¼Œé—­ç¯å®Œæˆã€‚</p></li></ol><p>è¿™å°±æ˜¯å•ä¾‹æ¨¡å¼ä¸‹ Spring è§£å†³å¾ªç¯ä¾èµ–çš„æµç¨‹äº†ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªåœ°æ–¹ï¼Œä¸ç®¡æ˜¯è°çœ‹æºç éƒ½ä¼šæœ‰ä¸ªå°ç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜å‘¢ï¼Œæˆ‘èµ¶è„šäºŒçº§ä»–ä¹Ÿå¤Ÿäº†å‘€ï¼Ÿ</p><p>é©å‘½å°šæœªæˆåŠŸï¼ŒåŒå¿—ä»éœ€åŠªåŠ›ï¼</p><p>è·Ÿæºç çš„æ—¶å€™ï¼Œå‘ç°åœ¨åˆ›å»º beanB éœ€è¦å¼•ç”¨ beanA è¿™ä¸ªâ€œåŠæˆå“â€çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘"å‰æœŸå¼•ç”¨"ï¼Œå³å¦‚ä¸‹ä»£ç ï¼š</p><pre><div><pre><p>ObjectFactory&lt;?&gt; singletonFactory = this.singletonFactories.get(beanName);</p><p>if (singletonFactory != ) {</p><p>// ä¸‰çº§ç¼“å­˜æœ‰çš„è¯ï¼Œå°±æŠŠä»–ç§»åŠ¨åˆ°äºŒçº§ç¼“å­˜</p><p>singletonObject = singletonFactory.getObject;</p><p>this.earlySingletonObjects.put(beanName, singletonObject);</p><p>this.singletonFactories.remove(beanName);</p><p>}</p></pre></div></pre><p>singletonFactory.getObject æ˜¯ä¸€ä¸ªæ¥å£æ–¹æ³•ï¼Œè¿™é‡Œå…·ä½“çš„å®ç°æ–¹æ³•åœ¨ï¼š</p><pre><div><pre><p>protected Object getEarlyBeanReference(String beanName, RootBeanDefinition mbd, Object bean) {</p><p>Object exposedObject = bean;</p><p>if (!mbd.isSynthetic &amp;&amp; hasInstantiationAwareBeanPostProcessors) {</p><p>for (BeanPostProcessor bp : getBeanPostProcessors) {</p><p>if (bp instanceof SmartInstantiationAwareBeanPostProcessor) {</p><p>SmartInstantiationAwareBeanPostProcessor ibp = (SmartInstantiationAwareBeanPostProcessor) bp;</p><p>// è¿™ä¹ˆä¸€å¤§æ®µå°±è¿™å¥è¯æ˜¯æ ¸å¿ƒï¼Œä¹Ÿå°±æ˜¯å½“beanè¦è¿›è¡Œæå‰æ›å…‰æ—¶ï¼Œ</p><p>// ç»™ä¸€ä¸ªæœºä¼šï¼Œé€šè¿‡é‡å†™åç½®å¤„ç†å™¨çš„getEarlyBeanReferenceæ–¹æ³•ï¼Œæ¥è‡ªå®šä¹‰æ“ä½œbean</p><p>// å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæå‰æ›å…‰äº†ï¼Œä½†æ˜¯æ²¡æœ‰è¢«æå‰å¼•ç”¨ï¼Œåˆ™è¯¥åç½®å¤„ç†å™¨å¹¶ä¸ç”Ÿæ•ˆ!!!</p><p>// è¿™ä¹Ÿæ­£å¼ä¸‰çº§ç¼“å­˜å­˜åœ¨çš„æ„ä¹‰ï¼Œå¦åˆ™äºŒçº§ç¼“å­˜å°±å¯ä»¥è§£å†³å¾ªç¯ä¾èµ–çš„é—®é¢˜</p><p>exposedObject = ibp.getEarlyBeanReference(exposedObject, beanName);</p><p>}</p><p>}</p><p>}</p><p>return exposedObject;</p><p>}</p></pre></div></pre><p>è¿™ä¸ªæ–¹æ³•å°±æ˜¯ Spring ä¸ºä»€ä¹ˆä½¿ç”¨ä¸‰çº§ç¼“å­˜ï¼Œè€Œä¸æ˜¯äºŒçº§ç¼“å­˜çš„åŸå› ï¼Œå®ƒçš„ç›®çš„æ˜¯ä¸ºäº†åç½®å¤„ç†ï¼Œå¦‚æœæ²¡æœ‰ AOP åç½®å¤„ç†ï¼Œå°±ä¸ä¼šèµ°è¿› if è¯­å¥ï¼Œç›´æ¥è¿”å›äº† exposedObject ï¼Œç›¸å½“äºå•¥éƒ½æ²¡å¹²ï¼ŒäºŒçº§ç¼“å­˜å°±å¤Ÿç”¨äº†ã€‚</p><p>æ‰€ä»¥åˆå¾—å‡ºç»“è®ºï¼Œè¿™ä¸ªä¸‰çº§ç¼“å­˜åº”è¯¥å’Œ AOP æœ‰å…³ç³»ï¼Œç»§ç»­ã€‚</p><p>åœ¨ Spring çš„æºç ä¸­getEarlyBeanReference æ˜¯ SmartInstantiationAwareBeanPostProcessor æ¥å£çš„é»˜è®¤æ–¹æ³•ï¼ŒçœŸæ­£å®ç°è¿™ä¸ªæ–¹æ³•çš„åªæœ‰**AbstractAutoProxyCreator** è¿™ä¸ªç±»ï¼Œç”¨äºæå‰æ›å…‰çš„ AOP ä»£ç†ã€‚</p><pre><div><pre><p>@Override</p><p>public Object getEarlyBeanReference(Object bean, String beanName) throws BeansException {</p><p>Object cacheKey = getCacheKey(bean.getClass, beanName);</p><p>this.earlyProxyReferences.put(cacheKey, bean);</p><p>// å¯¹beanè¿›è¡Œæå‰Spring AOPä»£ç†</p><p>return wrapIfNecessary(bean, beanName, cacheKey);</p><p>}</p></pre></div></pre><p>è¿™ä¹ˆè¯´æœ‰ç‚¹å¹²ï¼Œæ¥ä¸ªå° demo å§ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ Spring AOPã€äº‹åŠ¡ç­‰éƒ½æ˜¯é€šè¿‡ä»£ç†å¯¹è±¡æ¥å®ç°çš„ï¼Œè€Œäº‹åŠ¡çš„ä»£ç†å¯¹è±¡æ˜¯ç”±è‡ªåŠ¨ä»£ç†åˆ›å»ºå™¨æ¥è‡ªåŠ¨å®Œæˆçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ Spring æœ€ç»ˆç»™æˆ‘ä»¬æ”¾è¿›å®¹å™¨é‡Œé¢çš„æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œè€ŒéåŸå§‹å¯¹è±¡ï¼Œå‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹ä¸€æ®µä¸šåŠ¡ä»£ç ï¼š</p><pre><div><pre><p>@Service</p><p>public class HelloServiceImpl implements HelloService {</p><p>@Autowired</p><p>private HelloService helloService;</p><p>@Override</p><p>@Transactional</p><p>public Object hello {</p><p>return "Hello JavaKeeper";</p><p>}</p><p>}</p></pre></div></pre><p>æ­¤ Service ç±»ä½¿ç”¨åˆ°äº†äº‹åŠ¡ï¼Œæ‰€ä»¥æœ€ç»ˆä¼šç”Ÿæˆä¸€ä¸ª JDK åŠ¨æ€ä»£ç†å¯¹è±¡ Proxyã€‚åˆšå¥½å®ƒåˆå­˜åœ¨è‡ªå·±å¼•ç”¨è‡ªå·±çš„å¾ªç¯ä¾èµ–ï¼Œå®Œç¾ç¬¦åˆæˆ‘ä»¬çš„åœºæ™¯éœ€æ±‚ã€‚</p><p>æˆ‘ä»¬å†è‡ªå®šä¹‰ä¸€ä¸ªåç½®å¤„ç†ï¼Œæ¥çœ‹ä¸‹æ•ˆæœï¼š</p><pre><div><pre><p>@Component</p><p>public class HelloProcessor implements SmartInstantiationAwareBeanPostProcessor {</p><p>@Override</p><p>public Object getEarlyBeanReference(Object bean, String beanName) throws BeansException {</p><p>System.out.println("æå‰æ›å…‰äº†ï¼š"+beanName);</p><p>return bean;</p><p>}</p><p>}</p></pre></div></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè°ƒç”¨æ–¹æ³•æ ˆä¸­æœ‰æˆ‘ä»¬è‡ªå·±å®ç°çš„ HelloProcessorï¼Œè¯´æ˜è¿™ä¸ª bean ä¼šé€šè¿‡ AOP ä»£ç†å¤„ç†ã€‚</p><img alt="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/S9o5nd9DDx4KUe><p>å†ä»æºç çœ‹ä¸‹è¿™ä¸ªè‡ªå·±å¾ªç¯è‡ªå·±çš„ bean çš„åˆ›å»ºæµç¨‹ï¼š</p><pre><div><pre><p>protected Object doCreateBean( ... ){</p><p>...</p><p>boolean earlySingletonExposure = (mbd.isSingleton &amp;&amp; this.allowCircularReferences &amp;&amp; isSingletonCurrentlyInCreation(beanName));</p><p>// éœ€è¦æå‰æš´éœ²ï¼ˆæ”¯æŒå¾ªç¯ä¾èµ–ï¼‰ï¼Œå°±æ³¨å†Œä¸€ä¸ªObjectFactoryåˆ°ä¸‰çº§ç¼“å­˜</p><p>if (earlySingletonExposure) { </p><p>// æ·»åŠ  bean å·¥å‚å¯¹è±¡åˆ° singletonFactories ç¼“å­˜ä¸­ï¼Œå¹¶è·å–åŸå§‹å¯¹è±¡çš„æ—©æœŸå¼•ç”¨</p><p>//åŒ¿åå†…éƒ¨æ–¹æ³• getEarlyBeanReference å°±æ˜¯åç½®å¤„ç†å™¨ </p><p>// SmartInstantiationAwareBeanPostProcessor çš„ä¸€ä¸ªæ–¹æ³•ï¼Œ</p><p>// å®ƒçš„åŠŸæ•ˆä¸ºï¼šä¿è¯è‡ªå·±è¢«å¾ªç¯ä¾èµ–çš„æ—¶å€™ï¼Œå³ä½¿è¢«åˆ«çš„Bean @Autowireè¿›å»çš„ä¹Ÿæ˜¯ä»£ç†å¯¹è±¡</p><p>addSingletonFactory(beanName,  -&gt; getEarlyBeanReference(beanName, mbd, bean));</p><p>}</p><p>// æ­¤å¤„æ³¨æ„ï¼šå¦‚æœæ­¤å¤„è‡ªå·±è¢«å¾ªç¯ä¾èµ–äº† é‚£å®ƒä¼šèµ°ä¸Šé¢çš„getEarlyBeanReferenceï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ä» ä¸‰çº§ç¼“å­˜è½¬ç§»åˆ°äºŒçº§ç¼“å­˜é‡Œ</p><p>// æ³¨æ„æ­¤æ—¶å€™å¯¹è±¡è¿˜åœ¨äºŒçº§ç¼“å­˜é‡Œï¼Œå¹¶æ²¡æœ‰åœ¨ä¸€çº§ç¼“å­˜ã€‚å¹¶ä¸”æ­¤æ—¶åç»­çš„è¿™ä¸¤æ­¥æ“ä½œè¿˜æ˜¯ç”¨çš„ exposedObjectï¼Œå®ƒä»æ—§æ˜¯åŸå§‹å¯¹è±¡~~~</p><p>populateBean(beanName, mbd, instanceWrapper);</p><p>exposedObject = initializeBean(beanName, exposedObject, mbd);</p><p>// å› ä¸ºäº‹åŠ¡çš„AOPè‡ªåŠ¨ä»£ç†åˆ›å»ºå™¨åœ¨getEarlyBeanReference åˆ›å»ºä»£ç†åï¼ŒinitializeBean å°±ä¸ä¼šå†é‡å¤åˆ›å»ºäº†ï¼ŒäºŒé€‰ä¸€çš„ï¼‰</p><p>// æ‰€ä»¥ç»è¿‡è¿™ä¸¤å¤§æ­¥åï¼ŒexposedObject è¿˜æ˜¯åŸå§‹å¯¹è±¡ï¼Œé€šè¿‡ getEarlyBeanReference åˆ›å»ºçš„ä»£ç†å¯¹è±¡è¿˜åœ¨ä¸‰çº§ç¼“å­˜å‘¢</p><p>...</p><p>// å¾ªç¯ä¾èµ–æ ¡éªŒ</p><p>if (earlySingletonExposure) {</p><p>// æ³¨æ„æ­¤å¤„ç¬¬äºŒä¸ªå‚æ•°ä¼ çš„falseï¼Œè¡¨ç¤ºä¸å»ä¸‰çº§ç¼“å­˜é‡Œå†å»è°ƒç”¨ä¸€æ¬¡getObjectæ–¹æ³•äº†~~~ï¼Œæ­¤æ—¶ä»£ç†å¯¹è±¡è¿˜åœ¨äºŒçº§ç¼“å­˜ï¼Œæ‰€ä»¥è¿™é‡Œæ‹¿å‡ºæ¥çš„å°±æ˜¯ä¸ª ä»£ç†å¯¹è±¡</p><p>// æœ€åèµ‹å€¼ç»™exposedObject ç„¶åreturnå‡ºå»ï¼Œè¿›è€Œæœ€ç»ˆè¢«addSingletonæ·»åŠ è¿›ä¸€çº§ç¼“å­˜é‡Œé¢å» </p><p>// è¿™æ ·å°±ä¿è¯äº†æˆ‘ä»¬å®¹å™¨é‡Œ æœ€ç»ˆå®é™…ä¸Šæ˜¯ä»£ç†å¯¹è±¡ï¼Œè€ŒéåŸå§‹å¯¹è±¡~~~~~</p><p>Object earlySingletonReference = getSingleton(beanName, false);</p><p>if (earlySingletonReference != ) {</p><p>if (exposedObject == bean) { </p><p>exposedObject = earlySingletonReference;</p><p>}</p><p>}</p><p>...</p><p>}</p><p>}</p></pre></div></pre><p></p><h2 toutiao-origin=h4>è‡ªæˆ‘è§£æƒ‘ï¼š</h2><p>é—®ï¼šè¿˜æ˜¯ä¸å¤ªæ‡‚ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡å‘¢ï¼Œå³ä½¿æœ‰ä»£ç†ï¼Œåœ¨äºŒçº§ç¼“å­˜ä»£ç†ä¹Ÿå¯ä»¥å§ | ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸‰çº§ç¼“å­˜å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸‹ç›¸å…³ä»£ç ï¼Œå‡è®¾æˆ‘ä»¬ç°åœ¨æ˜¯äºŒçº§ç¼“å­˜æ¶æ„ï¼Œåˆ›å»º A çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸çŸ¥é“æœ‰æ²¡æœ‰å¾ªç¯ä¾èµ–ï¼Œæ‰€ä»¥æ”¾å…¥äºŒçº§ç¼“å­˜æå‰æš´éœ²ï¼Œæ¥ç€åˆ›å»º Bï¼Œä¹Ÿæ˜¯æ”¾å…¥äºŒçº§ç¼“å­˜ï¼Œè¿™æ—¶å€™å‘ç°åˆå¾ªç¯ä¾èµ–äº† Aï¼Œå°±å»äºŒçº§ç¼“å­˜æ‰¾ï¼Œæ˜¯æœ‰ï¼Œä½†æ˜¯å¦‚æœæ­¤æ—¶è¿˜æœ‰ AOP ä»£ç†å‘¢ï¼Œæˆ‘ä»¬è¦çš„æ˜¯ä»£ç†å¯¹è±¡å¯ä¸æ˜¯åŸå§‹å¯¹è±¡ï¼Œè¿™æ€ä¹ˆåŠï¼Œåªèƒ½æ”¹é€»è¾‘ï¼Œåœ¨ç¬¬ä¸€æ­¥çš„æ—¶å€™ï¼Œä¸ç®¡3721ï¼Œæ‰€æœ‰ Bean ç»Ÿç»Ÿå»å®Œæˆ AOP ä»£ç†ï¼Œå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œå°±ä¸éœ€è¦ä¸‰çº§ç¼“å­˜äº†ï¼Œä½†æ˜¯è¿™æ ·ä¸ä»…æ²¡æœ‰å¿…è¦ï¼Œè€Œä¸”è¿èƒŒäº† Spring åœ¨ç»“åˆ AOP è·Ÿ Bean çš„ç”Ÿå‘½å‘¨æœŸçš„è®¾è®¡ã€‚</p><p>æ‰€ä»¥ Spring â€œå¤šæ­¤ä¸€ä¸¾â€çš„å°†å®ä¾‹å…ˆå°è£…åˆ° ObjectFactory ä¸­ï¼ˆä¸‰çº§ç¼“å­˜ï¼‰ï¼Œä¸»è¦å…³é”®ç‚¹åœ¨ getObject æ–¹æ³•å¹¶éç›´æ¥è¿”å›å®ä¾‹ï¼Œè€Œæ˜¯å¯¹å®ä¾‹åˆä½¿ç”¨ SmartInstantiationAwareBeanPostProcessor çš„ getEarlyBeanReference æ–¹æ³•å¯¹ bean è¿›è¡Œå¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ Spring ä¸­å­˜åœ¨è¯¥åç½®å¤„ç†å™¨ï¼Œæ‰€æœ‰çš„å•ä¾‹ bean åœ¨å®ä¾‹åŒ–åéƒ½ä¼šè¢«è¿›è¡Œæå‰æ›å…‰åˆ°ä¸‰çº§ç¼“å­˜ä¸­ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„ bean éƒ½å­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯ä¸‰çº§ç¼“å­˜åˆ°äºŒçº§ç¼“å­˜çš„æ­¥éª¤ä¸ä¸€å®šéƒ½ä¼šè¢«æ‰§è¡Œï¼Œæœ‰å¯èƒ½æ›å…‰åç›´æ¥åˆ›å»ºå®Œæˆï¼Œæ²¡è¢«æå‰å¼•ç”¨è¿‡ï¼Œå°±ç›´æ¥è¢«åŠ å…¥åˆ°ä¸€çº§ç¼“å­˜ä¸­ã€‚å› æ­¤å¯ä»¥ç¡®ä¿åªæœ‰æå‰æ›å…‰ä¸”è¢«å¼•ç”¨çš„ bean æ‰ä¼šè¿›è¡Œè¯¥åç½®å¤„ç†ã€‚</p><pre><div><pre><p>protected Object getSingleton(String beanName, boolean allowEarlyReference) {</p><p>Object singletonObject = this.singletonObjects.get(beanName);</p><p>if (singletonObject ==  &amp;&amp; isSingletonCurrentlyInCreation(beanName)) {</p><p>synchronized (this.singletonObjects) {</p><p>singletonObject = this.earlySingletonObjects.get(beanName);</p><p>if (singletonObject ==  &amp;&amp; allowEarlyReference) {</p><p>// ä¸‰çº§ç¼“å­˜è·å–ï¼Œkey=beanName value=objectFactoryï¼ŒobjectFactoryä¸­å­˜å‚¨ //getObjectæ–¹æ³•ç”¨äºè·å–æå‰æ›å…‰çš„å®ä¾‹</p><p>ObjectFactory&lt;?&gt; singletonFactory = this.singletonFactories.get(beanName);</p><p>if (singletonFactory != ) {</p><p>// ä¸‰çº§ç¼“å­˜æœ‰çš„è¯ï¼Œå°±æŠŠä»–ç§»åŠ¨åˆ°äºŒçº§ç¼“å­˜</p><p>singletonObject = singletonFactory.getObject;</p><p>this.earlySingletonObjects.put(beanName, singletonObject);</p><p>this.singletonFactories.remove(beanName);</p><p>}</p><p>}</p><p>}</p><p>}</p><p>return singletonObject;</p><p>}</p><p>boolean earlySingletonExposure = (mbd.isSingleton &amp;&amp; this.allowCircularReferences &amp;&amp;</p><p>isSingletonCurrentlyInCreation(beanName));</p><p>if (earlySingletonExposure) {</p><p>if (logger.isDebugEnabled) {</p><p>logger.debug("Eagerly caching bean '" + beanName +</p><p>"' to allow for resolving potential circular references");</p><p>}</p><p>// æ·»åŠ  bean å·¥å‚å¯¹è±¡åˆ° singletonFactories ç¼“å­˜ä¸­ï¼Œå¹¶è·å–åŸå§‹å¯¹è±¡çš„æ—©æœŸå¼•ç”¨</p><p>//åŒ¿åå†…éƒ¨æ–¹æ³• getEarlyBeanReference å°±æ˜¯åç½®å¤„ç†å™¨</p><p>// SmartInstantiationAwareBeanPostProcessor çš„ä¸€ä¸ªæ–¹æ³•ï¼Œ</p><p>// å®ƒçš„åŠŸæ•ˆä¸ºï¼šä¿è¯è‡ªå·±è¢«å¾ªç¯ä¾èµ–çš„æ—¶å€™ï¼Œå³ä½¿è¢«åˆ«çš„Bean @Autowireè¿›å»çš„ä¹Ÿæ˜¯ä»£ç†å¯¹è±¡~~~~ AOPè‡ªåŠ¨ä»£ç†åˆ›å»ºå™¨æ­¤æ–¹æ³•é‡Œä¼šåˆ›å»ºçš„ä»£ç†å¯¹è±¡~~~</p><p>addSingletonFactory(beanName,  -&gt; getEarlyBeanReference(beanName, mbd, bean));</p><p>}</p></pre></div></pre><p>å†é—®ï¼šAOP ä»£ç†å¯¹è±¡æå‰æ”¾å…¥äº†ä¸‰çº§ç¼“å­˜ï¼Œæ²¡æœ‰ç»è¿‡å±æ€§å¡«å……å’Œåˆå§‹åŒ–ï¼Œè¿™ä¸ªä»£ç†åˆæ˜¯å¦‚ä½•ä¿è¯ä¾èµ–å±æ€§çš„æ³¨å…¥çš„å‘¢ï¼Ÿ</p><p>è¿™ä¸ªåˆæ¶‰åŠåˆ°äº† Spring ä¸­åŠ¨æ€ä»£ç†çš„å®ç°ï¼Œä¸ç®¡æ˜¯cglibä»£ç†è¿˜æ˜¯jdkåŠ¨æ€ä»£ç†ç”Ÿæˆçš„ä»£ç†ç±»ï¼Œä»£ç†æ—¶ï¼Œä¼šå°†ç›®æ ‡å¯¹è±¡ target ä¿å­˜åœ¨æœ€åç”Ÿæˆçš„ä»£ç† $proxy ä¸­ï¼Œå½“è°ƒç”¨ $proxy æ–¹æ³•æ—¶ä¼šå›è°ƒ h.invokeï¼Œè€Œ h.invoke åˆä¼šå›è°ƒç›®æ ‡å¯¹è±¡ target çš„åŸå§‹æ–¹æ³•ã€‚æ‰€æœ‰ï¼Œå…¶å®åœ¨ AOP åŠ¨æ€ä»£ç†æ—¶ï¼ŒåŸå§‹ bean å·²ç»è¢«ä¿å­˜åœ¨ æå‰æ›å…‰ä»£ç†ä¸­äº†ï¼Œä¹‹å åŸå§‹ bean ç»§ç»­å®Œæˆå±æ€§å¡«å……å’Œåˆå§‹åŒ–æ“ä½œã€‚å› ä¸º AOP ä»£ç†$proxyä¸­ä¿å­˜ç€ traget ä¹Ÿå°±æ˜¯æ˜¯ åŸå§‹bean çš„å¼•ç”¨ï¼Œå› æ­¤åç»­ åŸå§‹bean çš„å®Œå–„ï¼Œä¹Ÿå°±ç›¸å½“äºSpring AOPä¸­çš„ target çš„å®Œå–„ï¼Œè¿™æ ·å°±ä¿è¯äº† AOP çš„å±æ€§å¡«å……ä¸åˆå§‹åŒ–äº†ï¼</p><p></p><h2 toutiao-origin=h3>éå•ä¾‹å¾ªç¯ä¾èµ–</h2><p>çœ‹å®Œäº†å•ä¾‹æ¨¡å¼çš„å¾ªç¯ä¾èµ–ï¼Œæˆ‘ä»¬å†çœ‹ä¸‹éå•ä¾‹çš„æƒ…å†µï¼Œå‡è®¾æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶æ˜¯è¿™æ ·çš„ï¼š</p><pre><div><pre><p>&lt;bean id="beanA" class="priv.starfish.BeanA" scope="prototype"&gt;</p><p>&lt;property name="beanB" ref="beanB"/&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean id="beanB" class="priv.starfish.BeanB" scope="prototype"&gt;</p><p>&lt;property name="beanA" ref="beanA"/&gt;</p><p>&lt;/bean&gt;</p></pre></div></pre><p>å¯åŠ¨ Springï¼Œç»“æœå¦‚ä¸‹ï¼š</p><pre><div><pre><p>Error creating bean with name 'beanA' defined in class path resource [applicationContext.xml]: Cannot resolve reference to bean 'beanB' while setting bean property 'beanB';</p><p>Error creating bean with name 'beanB' defined in class path resource [applicationContext.xml]: Cannot resolve reference to bean 'beanA' while setting bean property 'beanA';</p><p>Caused by: org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'beanA': Requested bean is currently in creation: Is there an unresolvable circular reference?</p></pre></div></pre><p>å¯¹äº prototype ä½œç”¨åŸŸçš„ beanï¼ŒSpring å®¹å™¨æ— æ³•å®Œæˆä¾èµ–æ³¨å…¥ï¼Œå› ä¸º Spring å®¹å™¨ä¸è¿›è¡Œç¼“å­˜ prototype ä½œç”¨åŸŸçš„ bean ï¼Œå› æ­¤æ— æ³•æå‰æš´éœ²ä¸€ä¸ªåˆ›å»ºä¸­çš„bean ã€‚</p><p>åŸå› ä¹ŸæŒºå¥½ç†è§£çš„ï¼ŒåŸå‹æ¨¡å¼æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œå³ä½¿åŠ äº†ç¼“å­˜ï¼Œå¾ªç¯å¼•ç”¨å¤ªå¤šçš„è¯ï¼Œå°±æ¯”è¾ƒéº»çƒ¦äº†å°±ï¼Œæ‰€ä»¥ Spring ä¸æ”¯æŒè¿™ç§æ–¹å¼ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼š</p><pre><div><pre><p>if (isPrototypeCurrentlyInCreation(beanName)) {</p><p>throw new BeanCurrentlyInCreationException(beanName);</p><p>}</p></pre></div></pre><p></p><h2 toutiao-origin=h3>æ„é€ å™¨å¾ªç¯ä¾èµ–</h2><p>ä¸Šæ–‡æˆ‘ä»¬è®²çš„æ˜¯é€šè¿‡ Setter æ–¹æ³•æ³¨å…¥çš„å•ä¾‹ bean çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œç”¨ Spring çš„å°ä¼™ä¼´ä¹Ÿéƒ½çŸ¥é“ï¼Œä¾èµ–æ³¨å…¥çš„æ–¹å¼è¿˜æœ‰æ„é€ å™¨æ³¨å…¥ã€å·¥å‚æ–¹æ³•æ³¨å…¥çš„æ–¹å¼ï¼ˆå¾ˆå°‘ä½¿ç”¨ï¼‰ï¼Œé‚£å¦‚æœæ„é€ å™¨æ³¨å…¥æ–¹å¼ä¹Ÿæœ‰å¾ªç¯ä¾èµ–ï¼Œå¯ä»¥æä¸ï¼Ÿ</p><p>æˆ‘ä»¬å†æ”¹ä¸‹ä»£ç å’Œé…ç½®æ–‡ä»¶ã€‚</p><pre><div><pre><p>public class BeanA {</p><p>private BeanB beanB;</p><p>public <strong class=highlight-text toutiao-origin=span>BeanA</strong>(BeanB beanB) {</p><p>this.beanB = beanB;</p><p>}</p><p>}</p><p>public class BeanB {</p><p>private BeanA beanA;</p><p>public <strong class=highlight-text toutiao-origin=span>BeanB</strong>(BeanA beanA) {</p><p>this.beanA = beanA;</p><p>}</p><p>}</p></pre></div></pre><pre><div><pre><p>&lt;bean id="beanA" class="priv.starfish.BeanA"&gt;</p><p>&lt;constructor-arg ref="beanB"/&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean id="beanB" class="priv.starfish.BeanB"&gt;</p><p>&lt;constructor-arg ref="beanA"/&gt;</p><p>&lt;/bean&gt;</p></pre></div></pre><p>æ‰§è¡Œç»“æœï¼Œåˆæ˜¯å¼‚å¸¸</p><img alt="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/S9o5ndtA3mcWV8><p>çœ‹çœ‹å®˜æ–¹ç»™å‡ºçš„è¯´æ³•ï¼š</p><blockquote><p>Circular dependencies</p><p>If you use predominantly constructor injection, it is possible to create an unresolvable circular dependency scenario.</p><p>For example: Class A requires an instance of class B through constructor injection, and class B requires an instance of class A through constructor injection. If you configure beans for classes A and B to be injected into each other, the Spring IoC container detects this circular reference at runtime, and throws a BeanCurrentlyInCreationException.</p><p>One possible solution is to edit the source code of some classes to be configured by setters rather than constructors. Alternatively, avoid constructor injection and use setter injection only. In other words, although it is not recommended, you can configure circular dependencies with setter injection.</p><p>Unlike the typical case (with no circular dependencies), a circular dependency between bean A and bean B forces one of the beans to be injected into the other prior to being fully initialized itself (a classic chicken-and-egg scenario).</p></blockquote><p>å¤§æ¦‚æ„æ€æ˜¯ï¼š</p><p>å¦‚æœæ‚¨ä¸»è¦ä½¿ç”¨æ„é€ å™¨æ³¨å…¥ï¼Œå¾ªç¯ä¾èµ–åœºæ™¯æ˜¯æ— æ³•è§£å†³çš„ã€‚å»ºè®®ä½ ç”¨ setter æ³¨å…¥æ–¹å¼ä»£æ›¿æ„é€ å™¨æ³¨å…¥</p><p>å…¶å®ä¹Ÿä¸æ˜¯è¯´åªè¦æ˜¯æ„é€ å™¨æ³¨å…¥å°±ä¼šæœ‰å¾ªç¯ä¾èµ–é—®é¢˜ï¼ŒSpring åœ¨åˆ›å»º Bean çš„æ—¶å€™é»˜è®¤æ˜¯æŒ‰ç…§è‡ªç„¶æ’åºæ¥è¿›è¡Œåˆ›å»ºçš„ï¼Œæˆ‘ä»¬æš‚ä¸”æŠŠå…ˆåˆ›å»ºçš„ bean å«ä¸» beanï¼Œä¸Šæ–‡çš„ A å³ä¸» beanï¼Œåªè¦ä¸» bean æ³¨å…¥ä¾èµ– bean çš„æ–¹å¼æ˜¯ setter æ–¹å¼ï¼Œä¾èµ– bean çš„æ³¨å…¥æ–¹å¼æ— æ‰€è°“ï¼Œéƒ½å¯ä»¥è§£å†³ï¼Œåä¹‹äº¦ç„¶</p><p>æ‰€ä»¥ä¸Šæ–‡æˆ‘ä»¬ AB å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œåªè¦ A çš„æ³¨å…¥æ–¹å¼æ˜¯ setter ï¼Œå°±ä¸ä¼šæœ‰å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</p><p>é¢è¯•å®˜é—®ï¼šä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>Spring è§£å†³å¾ªç¯ä¾èµ–ä¾é çš„æ˜¯ Bean çš„â€œä¸­é—´æ€â€è¿™ä¸ªæ¦‚å¿µï¼Œè€Œè¿™ä¸ªä¸­é—´æ€æŒ‡çš„æ˜¯å·²ç»å®ä¾‹åŒ–ï¼Œä½†è¿˜æ²¡åˆå§‹åŒ–çš„çŠ¶æ€ã€‚å®ä¾‹åŒ–çš„è¿‡ç¨‹åˆæ˜¯é€šè¿‡æ„é€ å™¨åˆ›å»ºçš„ï¼Œå¦‚æœ A è¿˜æ²¡åˆ›å»ºå¥½å‡ºæ¥ï¼Œæ€ä¹ˆå¯èƒ½æå‰æ›å…‰ï¼Œæ‰€ä»¥æ„é€ å™¨çš„å¾ªç¯ä¾èµ–æ— æ³•è§£å†³ï¼Œæˆ‘ä¸€ç›´è®¤ä¸ºåº”è¯¥å…ˆæœ‰é¸¡æ‰èƒ½æœ‰è›‹ã€‚</p><img alt="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTJXJ1kBqzfCnu><p></p><h1 toutiao-origin=h2>å°æ€»ç»“ | é¢è¯•è¿™ä¹ˆç­”</h1><p></p><h2 toutiao-origin=h4>B ä¸­æå‰æ³¨å…¥äº†ä¸€ä¸ªæ²¡æœ‰ç»è¿‡åˆå§‹åŒ–çš„ A ç±»å‹å¯¹è±¡ä¸ä¼šæœ‰é—®é¢˜å—ï¼Ÿ</h2><p>è™½ç„¶åœ¨åˆ›å»º B æ—¶ä¼šæå‰ç»™ B æ³¨å…¥äº†ä¸€ä¸ªè¿˜æœªåˆå§‹åŒ–çš„ A å¯¹è±¡ï¼Œä½†æ˜¯åœ¨åˆ›å»º A çš„æµç¨‹ä¸­ä¸€ç›´ä½¿ç”¨çš„æ˜¯æ³¨å…¥åˆ° B ä¸­çš„ A å¯¹è±¡çš„å¼•ç”¨ï¼Œä¹‹åä¼šæ ¹æ®è¿™ä¸ªå¼•ç”¨å¯¹ A è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰€ä»¥è¿™æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p><p></p><h2 toutiao-origin=h4>Spring æ˜¯å¦‚ä½•è§£å†³çš„å¾ªç¯ä¾èµ–ï¼Ÿ</h2><p>Spring ä¸ºäº†è§£å†³å•ä¾‹çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½¿ç”¨äº†ä¸‰çº§ç¼“å­˜ã€‚å…¶ä¸­ä¸€çº§ç¼“å­˜ä¸ºå•ä¾‹æ± ï¼ˆsingletonObjectsï¼‰ï¼ŒäºŒçº§ç¼“å­˜ä¸ºæå‰æ›å…‰å¯¹è±¡ï¼ˆearlySingletonObjectsï¼‰ï¼Œä¸‰çº§ç¼“å­˜ä¸ºæå‰æ›å…‰å¯¹è±¡å·¥å‚ï¼ˆsingletonFactoriesï¼‰ã€‚</p><p>å‡è®¾Aã€Bå¾ªç¯å¼•ç”¨ï¼Œå®ä¾‹åŒ– A çš„æ—¶å€™å°±å°†å…¶æ”¾å…¥ä¸‰çº§ç¼“å­˜ä¸­ï¼Œæ¥ç€å¡«å……å±æ€§çš„æ—¶å€™ï¼Œå‘ç°ä¾èµ–äº† Bï¼ŒåŒæ ·çš„æµç¨‹ä¹Ÿæ˜¯å®ä¾‹åŒ–åæ”¾å…¥ä¸‰çº§ç¼“å­˜ï¼Œæ¥ç€å»å¡«å……å±æ€§æ—¶åˆå‘ç°è‡ªå·±ä¾èµ– Aï¼Œè¿™æ—¶å€™ä»ç¼“å­˜ä¸­æŸ¥æ‰¾åˆ°æ—©æœŸæš´éœ²çš„ Aï¼Œæ²¡æœ‰ AOP ä»£ç†çš„è¯ï¼Œç›´æ¥å°† A çš„åŸå§‹å¯¹è±¡æ³¨å…¥ Bï¼Œå®Œæˆ B çš„åˆå§‹åŒ–åï¼Œè¿›è¡Œå±æ€§å¡«å……å’Œåˆå§‹åŒ–ï¼Œè¿™æ—¶å€™ B å®Œæˆåï¼Œå°±å»å®Œæˆå‰©ä¸‹çš„ A çš„æ­¥éª¤ï¼Œå¦‚æœæœ‰ AOP ä»£ç†ï¼Œå°±è¿›è¡Œ AOP å¤„ç†è·å–ä»£ç†åçš„å¯¹è±¡ Aï¼Œæ³¨å…¥ Bï¼Œèµ°å‰©ä¸‹çš„æµç¨‹ã€‚</p><p></p><h2 toutiao-origin=h4>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸‰çº§ç¼“å­˜å‘¢ï¼ŸäºŒçº§ç¼“å­˜èƒ½è§£å†³å¾ªç¯ä¾èµ–å—ï¼Ÿ</h2><p>å¦‚æœæ²¡æœ‰ AOP ä»£ç†ï¼ŒäºŒçº§ç¼“å­˜å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯æœ‰ AOP ä»£ç†çš„æƒ…å†µä¸‹ï¼Œåªç”¨äºŒçº§ç¼“å­˜å°±æ„å‘³ç€æ‰€æœ‰ Bean åœ¨å®ä¾‹åŒ–åå°±è¦å®Œæˆ AOP ä»£ç†ï¼Œè¿™æ ·è¿èƒŒäº† Spring è®¾è®¡çš„åŸåˆ™ï¼ŒSpring åœ¨è®¾è®¡ä¹‹åˆå°±æ˜¯é€šè¿‡ AnnotationAwareAspectJAutoProxyCreator è¿™ä¸ªåç½®å¤„ç†å™¨æ¥åœ¨ Bean ç”Ÿå‘½å‘¨æœŸçš„æœ€åä¸€æ­¥æ¥å®Œæˆ AOP ä»£ç†ï¼Œè€Œä¸æ˜¯åœ¨å®ä¾‹åŒ–åå°±ç«‹é©¬è¿›è¡Œ AOP ä»£ç†ã€‚</p><p></p><h2 toutiao-origin=h3>å‚è€ƒä¸æ„Ÿè°¢ï¼š</h2><p>ã€ŠSpring æºç æ·±åº¦è§£æã€‹- éƒä½³ç€</p><p>https://developer.aliyun.com/article/766880</p><p>http://www.tianxiaobo.com/2018/06/08/Spring-IOC-å®¹å™¨æºç åˆ†æ-å¾ªç¯ä¾èµ–çš„è§£å†³åŠæ³•</p><p>https://cloud.tencent.com/developer/article/1497692</p><p>https://blog.csdn.net/chaitoudaren/article/details/105060882</p><img alt="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/R69FpRH4d90a7d><img alt="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/S9fvQrwFxdO6Si><pre><div><div><div><div><div><div><img alt="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/S3V0kpbJ0CLyq7></div></div><p><strong toutiao-origin=span>ç‚¹åˆ†äº«</strong></p></div><div><div><div><div><img alt="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/S3Y8EjO3S3jH6O></div></div></div><div><div><div><img alt="çƒ‚äº†å¤§è¡—çš„ Spring å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½ ä»¥ä¸ºè‡ªå·±å°±çœŸä¼šäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/S3V0kpwDUoK9Jv></div></div></div></div></div></div></div></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'çƒ‚äº†','Spring','å¾ªç¯'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>