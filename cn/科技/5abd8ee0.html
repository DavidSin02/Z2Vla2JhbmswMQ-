<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>å››ã€JDK1.7ä¸­HashMapå“ˆå¸Œå†²çªè§£å†³æ–¹æ¡ˆ-é˜¿é‡Œé¢è¯•ç» | æå®¢å¿«è¨Š</title><meta property="og:title" content="å››ã€JDK1.7ä¸­HashMapå“ˆå¸Œå†²çªè§£å†³æ–¹æ¡ˆ-é˜¿é‡Œé¢è¯•ç» - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/af6b4034b7db48f0907aff6d641e490c"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5abd8ee0.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5abd8ee0.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5abd8ee0.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5abd8ee0.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5abd8ee0.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5abd8ee0.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5abd8ee0.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5abd8ee0.html><meta property="article:published_time" content="2020-10-29T21:09:19+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:19+08:00"><meta name=Keywords content><meta name=description content="å››ã€JDK1.7ä¸­HashMapå“ˆå¸Œå†²çªè§£å†³æ–¹æ¡ˆ-é˜¿é‡Œé¢è¯•ç»"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/5abd8ee0.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>å››ã€JDK1.7ä¸­HashMapå“ˆå¸Œå†²çªè§£å†³æ–¹æ¡ˆ-é˜¿é‡Œé¢è¯•ç»</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>å¯¼è¯»</h1><p>å‰é¢æ–‡ç« <a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6876269894007161348/?group_id=6876269894007161348?group_id=6876269894007161348" rel="noopener noreferrer" target=_blank>ä¸€ã€æ·±å…¥ç†è§£-Javaé›†åˆåˆç¯‡</a> ä¸­æˆ‘ä»¬å¯¹Javaçš„é›†åˆä½“ç³»è¿›è¡Œä¸€ä¸ªç®€å•çš„åˆ†æä»‹ç»ï¼Œä¸Šä¸¤ç¯‡æ–‡ç« <a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6877007182232027655/?group_id=6877007182232027655?group_id=6877007182232027655" rel="noopener noreferrer" target=_blank>äºŒã€Jdk1.7å’Œ1.8ä¸­HashMapæ•°æ®ç»“æ„åŠæºç åˆ†æ</a> ã€<a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6877050052326457860/?group_id=6877050052326457860?group_id=6877050052326457860" rel="noopener noreferrer" target=_blank>äºŒã€JDK1.7å’Œ1.8HashMapæ•°æ®ç»“æ„åŠæºç åˆ†æ-ç»­</a> ä¸­æˆ‘ä»¬åˆ†åˆ«å¯¹JDK1.7å’ŒJDK1.8ä¸­HashMapçš„æ•°æ®ç»“æ„ã€ä¸»è¦å£°æ˜å˜é‡ã€æ„é€ å‡½æ•°ã€HashMapçš„putæ“ä½œæ–¹æ³•åšäº†æ·±å…¥çš„è®²è§£å’Œæºç åˆ†æã€‚<a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6877362834460639757/?group_id=6877362834460639757?group_id=6877362834460639757" rel="noopener noreferrer" target=_blank>ä¸‰ã€æ·±å…¥ç†è§£Javaä¸­çš„HashMapã€Œç½‘æ˜“é¢è¯•å¿«ç­”ã€</a> æ–‡ç« ä¸­ä¸»è¦é’ˆå¯¹é¢è¯•ä¸­å¸¸è§çš„æ–‡ä»¶è¿›è¡Œç®€å•è§£ç­”ã€‚</p><p><strong>æœ¬ç¯‡æ–‡ç« æˆ‘ä»¬å°†è¦å¯¹JDK1.7ä¸­HashMapçš„å“ˆå¸Œå†²çªåŠå‡å°‘å“ˆå¸Œå†²çªçš„è§£å†³æ–¹æ¡ˆåšè¯¦ç»†çš„ä»‹ç»ï¼Œå¹¶é€šè¿‡æºç åŠ æ·±å¤§å®¶çš„ç†è§£ã€‚</strong></p><p><br></p><p><strong class=highlight-text>å¦‚æœå¤§å®¶åœ¨é¢è¯•ä¸­é’ˆå¯¹Javaé›†åˆæˆ–è€…Javaä¸­çš„HashMapå¤§å®¶è¿˜æœ‰ä»€ä¹ˆç–‘é—®æˆ–è€…å…¶ä»–é—®é¢˜ï¼Œå¯ä»¥è¯„è®ºåŒºå‘Šè¯‰æˆ‘ã€‚</strong></p><h1 class=pgc-h-arrow-right>ç®€å•ä»‹ç»</h1><p>JDK1.7---ã€‹å“ˆå¸Œè¡¨ï¼Œé“¾è¡¨</p><p>JDK1.8---ã€‹å“ˆå¸Œè¡¨ï¼Œé“¾è¡¨ï¼Œçº¢é»‘æ ‘--- JDK1.8ä¹‹åï¼Œå½“é“¾è¡¨é•¿åº¦è¶…è¿‡8ä½¿ç”¨çº¢é»‘æ ‘ã€‚</p><p><strong class=highlight-text>éçº¿ç¨‹å®‰å…¨</strong></p><p><strong class=highlight-text>0.75çš„è´Ÿè½½å› å­ï¼Œæ‰©å®¹å¿…é¡»ä¸ºåŸæ¥çš„ä¸¤å€ã€‚</strong></p><p><strong class=highlight-text>é»˜è®¤å¤§å°ä¸º16ï¼Œä¼ å…¥çš„åˆå§‹å¤§å°å¿…é¡»ä¸º2çš„å¹‚æ¬¡æ–¹çš„å€¼ï¼Œå¦‚æœä¸ä¸ºä¹Ÿä¼šå˜ä¸º2çš„å¹‚æ¬¡æ–¹çš„å€¼ã€‚</strong></p><p>æ ¹æ®HashCodeå­˜å‚¨æ•°æ®ã€‚</p><h1 class=pgc-h-arrow-right>JDK1.7çš„å“ˆå¸Œå†²çªè§£å†³æ–¹æ¡ˆ</h1><h1 class=pgc-h-arrow-right>1.é…ç½®thresholdï¼šjdk.map.althashing.thresholdï¼ˆé˜€å€¼-é—¨æ§›ï¼‰</h1><p><strong>é…ç½®æ”¹å˜hashå†²çªçš„é—¨æ§›</strong></p><p><strong>æºç ï¼š</strong></p><pre><code>/**Â * The default threshold of map capacity above which alternative hashing isÂ * used for String keys. Alternative hashing reduces the incidence ofÂ * collisions due to weak hash code calculation for String keys.Â * &lt;p/&gt;Â * This value may be overridden by defining the system propertyÂ * {@code jdk.map.althashing.threshold}. A property value of {@code 1}Â * forces alternative hashing to be used at all times whereasÂ * {@code -1} value ensures that alternative hashing is never used.Â */static final int ALTERNATIVE_HASHING_THRESHOLD_DEFAULT = Integer.MAX_VALUE;</code></pre><p><strong></strong></p><p>-Djdk.map.althashing.threshold = -1: è¡¨ç¤ºä¸åšä¼˜åŒ–ï¼ˆä¸é…ç½®è¿™ä¸ªå€¼ä½œç”¨ä¸€æ ·ï¼‰<br>-Djdk.map.althashing.threshold &lt; 0: æŠ¥é”™</p><p>-Djdk.map.althashing.threshold = 1: è¡¨ç¤ºæ€»æ˜¯å¯ç”¨éšæœºHashSeed<br>-Djdk.map.althashing.threshold >= 0 : è¡¨ç¤ºhashMapå†…éƒ¨çš„æ•°ç»„é•¿åº¦è¶…è¿‡è¯¥å€¼äº†å°±ä½¿ç”¨éšæœºHashSeedï¼Œé™ä½ç¢°æ’</p><p><strong class=highlight-text>å¦‚æœ é…ç½®è¯¥å€¼ä¸º-1ï¼Œè¡¨ç¤ºä¸åšhashå†²çªçš„ä¼˜åŒ–ï¼›</strong></p><p><strong class=highlight-text>å¦‚æœ é…ç½®è¯¥å€¼å°äº0ï¼Œåˆ™æŠ¥é”™ï¼›</strong></p><p><strong class=highlight-text>å¦‚æœ é…ç½®è¯¥å€¼ä¸º1 åˆ™è¡¨ç¤ºæ€»æ˜¯ä½¿ç”¨ä¸€ä¸ªéšæœºå€¼ï¼ˆå“ˆå¸Œå› å­hashseedï¼‰å¯¹hashå†²çª.</strong></p><p><strong class=highlight-text>å¦‚æœ é…ç½®è¯¥å€¼å¤§äºç­‰äº0 è¡¨ç¤ºå½“HashMapä¸­æ•°ç»„é•¿åº¦è¶…è¿‡è¯¥å€¼çš„æ—¶å€™å°±ä½¿ç”¨éšæœºå€¼ï¼ˆå“ˆå¸Œå› å­hashseedï¼‰æ¥é™ä½å“ˆå¸Œå†²çªçš„å¯èƒ½æ€§ã€‚</strong></p><p></p><h1 class=pgc-h-arrow-right>2ä½¿ç”¨ä¸€ä¸ªç§æœ‰çš„é™æ€å†…éƒ¨ç±»HolderåŠ è½½è™šæ‹Ÿæœºå¼•å¯¼ä¹‹åæ‰è¢«åˆå§‹åŒ–çš„å€¼ã€‚</h1><p>ä½¿ç”¨ç§æœ‰çš„é™æ€å†…éƒ¨ç±»HolderåŠ è½½ä¸Šä¸€æ­¥é…ç½®çš„Jdk.map.althashing.thresholdã€‚</p><p><strong>æºç ï¼š</strong></p><pre><code>/**Â * The default threshold of map capacity above which alternative hashing isÂ * used for String keys. Alternative hashing reduces the incidence ofÂ * collisions due to weak hash code calculation for String keys.Â * &lt;p/&gt;Â * This value may be overridden by defining the system propertyÂ * {@code jdk.map.althashing.threshold}. A property value of {@code 1}Â * forces alternative hashing to be used at all times whereasÂ * {@code -1} value ensures that alternative hashing is never used.Â */static final int ALTERNATIVE_HASHING_THRESHOLD_DEFAULT = Integer.MAX_VALUE;/**Â * holds values which can't be initialized until after VM is booted.Â */private static class Holder {Â Â Â  /**Â Â Â Â  * Table capacity above which to switch to use alternative hashing.Â Â Â Â  */Â Â Â  static final int ALTERNATIVE_HASHING_THRESHOLD;Â Â Â  static {Â Â Â Â Â Â Â  String altThreshold = java.security.AccessController.doPrivileged(Â Â Â Â Â Â Â Â Â Â Â  new sun.security.action.GetPropertyAction(Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  "jdk.map.althashing.threshold"));Â Â Â Â Â Â Â  int threshold;Â Â Â Â Â Â Â  try {Â Â Â Â Â Â Â Â Â Â Â  threshold = (null != altThreshold)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  ? Integer.parseInt(altThreshold)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  : ALTERNATIVE_HASHING_THRESHOLD_DEFAULT;Â Â Â Â Â Â Â Â Â Â Â  // disable alternative hashing if -1Â Â Â Â Â Â Â Â Â Â Â  if (threshold == -1) {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  threshold = Integer.MAX_VALUE;Â Â Â Â Â Â Â Â Â Â Â  }Â Â Â Â Â Â Â Â Â Â Â  if (threshold &lt; 0) {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  throw new IllegalArgumentException("value must be positive integer.");Â Â Â Â Â Â Â Â Â Â Â  }Â Â Â Â Â Â Â  } catch(IllegalArgumentException failed) {Â Â Â Â Â Â Â Â Â Â Â  throw new Error("Illegal value for 'jdk.map.althashing.threshold'", failed);Â Â Â Â Â Â Â  }Â Â Â Â Â Â Â  ALTERNATIVE_HASHING_THRESHOLD = threshold;Â Â Â  }}/**Â * A randomizing value associated with this instance that is applied toÂ * hash code of keys to make hash collisions harder to find. If 0 thenÂ * alternative hashing is disabled.Â */transient int hashSeed = 0;</code></pre><p><strong>æºç è§£è¯»ï¼š</strong></p><p>1ã€static final int ALTERNATIVE_HASHING_THRESHOLD_DEFAULT = Integer.MAX_VALUE;</p><p>å¦‚æœåœ¨ä¸Šä¸€æ­¥ä¸­æ²¡æœ‰é…ç½®â€œjdk.map.althashing.thresholdâ€,åˆ™ä½¿ç”¨è¯¥å€¼è¡¨ç¤ºæ˜¯å¦å¯¹HashMapä¸­çš„å“ˆå¸Œå†²çªåšå¹²æ‰°ã€‚è¯¥å€¼çš„é»˜è®¤å€¼æ˜¯Integerçš„æœ€å¤§å€¼ã€‚è¡¨ç¤ºåªæœ‰å½“HashMapä¸­æ•°ç»„å®¹é‡è¾¾åˆ°Integerçš„æœ€å¤§å€¼æ—¶å€™æ‰ä¼šåšå“ˆå¸Œå†²çªçš„å¹²æ‰°ã€‚è®¾ç½®è¿™ä¸ªå€¼è¿™ä¹ˆå¤§ï¼Œå…¶å®å°±æ˜¯ä¸åšå“ˆå¸Œå†²çªå¹²æ‰°ã€‚</p><p>2ã€åœ¨ç§æœ‰çš„é™æ€å†…éƒ¨ç±»Holderä¸­åšåˆ¤æ–­åˆ¤æ–­ã€‚</p><p>â‘ åŠ è½½ï¼ˆjdk.map.althashing.thresholdï¼‰é…ç½®çš„altThreshold;</p><pre><code>String altThreshold = java.security.AccessController.doPrivileged(Â Â Â  new sun.security.action.GetPropertyAction(Â Â Â Â Â Â Â  "jdk.map.althashing.threshold"));</code></pre><p>â‘¡å¦‚æœä»é…ç½®ä¸­åŠ è½½åˆ°çš„altThresholdä¸ä¸ºç©ºï¼Œåˆ™æŠŠthresholdèµ‹å€¼ä¸ºåŠ è½½åˆ°çš„altThreshold;</p><p>å¦‚æœæ²¡æœ‰é…ç½®è¯¥altThresholdåˆ™ä½¿ç”¨é»˜è®¤çš„ALTERNATIVE_HASHING_THRESHOLD_DEFAULTï¼Œå³Integer.MAX_VALUE;</p><pre><code>threshold = (null != altThreshold)Â Â Â Â Â Â Â  ? Integer.parseInt(altThreshold)Â Â Â Â Â Â Â  : ALTERNATIVE_HASHING_THRESHOLD_DEFAULT;</code></pre><p>â‘¢å¦‚æœåœ¨JDKä¸­é…ç½®çš„jdk.map.althashing.thresholdä¸ºé»˜è®¤å€¼-1ï¼Œåˆ™æŠŠthresholdè®¾ç½®ä¸ºInteger.MAX_VALUE;</p><pre><code>// disable alternative hashing if -1if (threshold == -1) {Â Â Â  threshold = Integer.MAX_VALUE;}</code></pre><p>â‘£ï¼å¦‚æœåœ¨JDKä¸­é…ç½®çš„jdk.map.althashing.thresholdå€¼å°äº0ï¼Œåˆ™æŠ¥é”™ï¼Œè¡¨ç¤ºè¯¥å€¼ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆå€¼ã€‚</p><pre><code>if (threshold &lt; 0) {Â Â Â  throw new IllegalArgumentException("value must be positive integer.");}</code></pre><p>â‘¤ï¼æŠŠç»è¿‡è®¡ç®—çš„thresholdçš„å€¼èµ‹å€¼ç»™â€œALTERNATIVE_HASHING_THRESHOLDâ€.</p><p><strong class=highlight-text>ä¹Ÿå°±æ˜¯è¯´æœ€ç»ˆæ˜¯å¦å¯¹å“ˆå¸Œå†²çªåšå¹²æ‰°ï¼Œæˆ–è€…åœ¨ä»€ä¹ˆæƒ…å†µè¿›è¡Œå¹²æ‰°æ˜¯å­˜å‚¨åœ¨â€œALTERNATIVE_HASHING_THRESHOLDâ€ä¸­çš„ã€‚</strong></p><pre><code>ALTERNATIVE_HASHING_THRESHOLD = threshold;</code></pre><p>â‘¥ï¼è§£å†³å“ˆå¸Œå†²çªçš„å¹²æ‰°å› å­ã€‚æ ¹æ®ä¸Šä¸€æ­¥ä¸­è®¡ç®—çš„é…ç½®â€œALTERNATIVE_HASHING_THRESHOLDâ€åˆ¤æ–­æ˜¯å¦å¯ç”¨è¯¥å¹²æ‰°å› å­ã€‚</p><pre><code>/**Â * A randomizing value associated with this instance that is applied toÂ * hash code of keys to make hash collisions harder to find. If 0 thenÂ * alternative hashing is disabled.Â */transient int hashSeed = 0;</code></pre><p><strong>ä»ä»£ç çœ‹å‡ºjdk.map.althashing.thresholdè¿™ä¸ªå˜é‡è®¾ç½®çš„å€¼æœ€ç»ˆä¼šå­˜æ”¾åœ¨é™æ€å¸¸é‡ALTERNATIVE_HASHING_THRESHOLD</strong></p><h1 class=pgc-h-arrow-right>3.æ ¹æ®åˆå§‹åŒ–çš„HashMapå®¹é‡å¤§å°ï¼Œå†³å®šå¹²æ‰°å› å­çš„å€¼ã€‚</h1><p><strong>æºç ï¼š</strong></p><pre><code>/**åˆå§‹åŒ–å“ˆå¸Œå¹²æ‰°çš„æ©ç å€¼ï¼Œæˆ‘ä»¬æŠŠå®ƒçš„è®¾ç½®å»¶è¿Ÿåˆ°äº†çœŸæ­£ä½¿ç”¨å®ƒçš„æ—¶å€™ã€‚Â * Initialize the hashing mask value. We defer initialization until weÂ * really need it.Â */final boolean initHashSeedAsNeeded(int capacity) {Â Â Â /**åˆ¤æ–­æ˜¯å¦å¼€å¯äº†hashå¹²æ‰°ã€‚å¦‚æœhashseed ç­‰äº 0ï¼Œåˆ™currentAltHashing = false;å¦‚æœhashseed ä¸ç­‰äº 0 ï¼Œåˆ™currentAltHashing = true;**/ Â Â Â  boolean currentAltHashing = hashSeed != 0;/** åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ä¸ºå¹²æ‰°1.å¦‚æœå½“å‰HashMapæ•°ç»„å®¹é‡çš„å¤§å°ç­‰äºjdké…ç½®    ä¸­â€œjdk.map.althashing.thresholdâ€çš„å€¼æ—¶å€™ï¼Œ    ä¸”VM .isbooted ä¸ºtrue æ—¶å€™ï¼ŒuserAltHashing ä¸ºtrue;2.å¦‚æœå½“å‰HashMapæ•°ç»„å®¹é‡çš„å°äºjdké…ç½®    ä¸­â€œjdk.map.althashing.thresholdâ€çš„å€¼æ—¶å€™ï¼Œ    ä¸”VM .isbooted ä¸ºtrue æ—¶å€™ï¼ŒuserAltHashing ä¸ºfalse;3. å¦‚æœå½“å‰HashMapæ•°ç»„å®¹é‡çš„å¤§å°ç­‰äºjdké…ç½®    ä¸­â€œjdk.map.althashing.thresholdâ€çš„å€¼æ—¶å€™ï¼Œ    ä¸”VM .isbooted ä¸ºfalse æ—¶å€™ï¼ŒuserAltHashing ä¸ºfalse;4. å¦‚æœå½“å‰HashMapæ•°ç»„å®¹é‡çš„å°äºjdké…ç½®    ä¸­â€œjdk.map.althashing.thresholdâ€çš„å€¼æ—¶å€™ï¼Œ    ä¸”VM .isbooted ä¸ºfalse æ—¶å€™ï¼ŒuserAltHashing ä¸ºfalse;**/Â Â Â  boolean useAltHashing = sun.misc.VM.isBooted() &amp;&amp;Â Â Â Â Â Â Â Â Â Â Â  (capacity &gt;= Holder.ALTERNATIVE_HASHING_THRESHOLD);/** å¯¹ä»¥ä¸Šçš„ä¸¤ä¸ªå€¼è¿›è¡Œâ€œå¼‚æˆ–â€å¤„ç†å¼‚æˆ–çš„ç»“æœä¸º ä¸¤ä¸ªå€¼ç›¸åŒä¸º0ï¼Œä¸¤ä¸ªå€¼ä¸åŒä¸º1.ä¹Ÿå°±æ˜¯è¯´ currentAltHashing ä¸ºtrueæ—¶ä¸”useAltHashingä¹Ÿä¸ºtrueæ—¶ï¼Œæˆ–è€… currentAltHashing ä¸ºfalseæ—¶ä¸”useAltHashingä¹Ÿä¸ºfalseæ—¶switchingçš„ç»“æœä¸º true.å…¶ä»–æƒ…å†µæ—¶å€™ï¼Œswitchingä¸ºfalse.**/Â Â Â  boolean switching = currentAltHashing ^ useAltHashing;Â Â Â  if (switching) {/**å¦‚æœswitchingä¸ºtrue ï¼Œè®¾ç½®hashSeed(å¹²æ‰°å› å­)çš„å€¼ã€‚å¦‚æœuseAltHashingçš„å€¼ä¸ºtrueï¼Œåˆ™éšæœºä¸€ä¸ªå¹²æ‰°å€¼ç»™HashSeedã€‚å¦åˆ™èµ‹å€¼ä¸º0.**/ Â Â Â Â Â Â Â  hashSeed = useAltHashingÂ Â Â Â Â Â Â Â Â Â Â  ? sun.misc.Hashing.randomHashSeed(this)Â Â Â Â Â Â Â Â Â Â Â  : 0;Â Â Â  }//è¿”å›æ˜¯å¦å¯ç”¨å¹²æ‰°å› å­Â Â Â  return switching;}</code></pre><p><strong>æºç è§£è¯»ï¼š</strong></p><p><strong class=highlight-text>å½“hashMapæ‰©å¤§å®¹é‡æ—¶ï¼Œéƒ½æ˜¯è°ƒç”¨è¯¥æ–¹æ³•ã€‚ä»ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå½“æ•°ç»„å®¹é‡è¶…è¿‡ï¼Œæˆ‘ä»¬è®¾å®šçš„å€¼ALTERNATIVE_HASHING_THRESHOLDä¸”æ˜¯vm bootedï¼ŒåŒæ—¶ hashSeed==0çš„æ—¶å€™ï¼ŒhashSeedçš„å€¼å°±æ˜¯ç”¨éšæœºé‡ï¼Œè€Œä¸æ˜¯å›ºå®šçš„ç­‰äº0ã€‚è¿™æ ·å°±èƒ½é™ä½ç¢°æ’ï¼Œå°±èƒ½é™ä½æ¼”åŒ–æˆé“¾è¡¨æ¦‚ç‡ã€‚</strong></p><p><strong>ä»£ç å…·ä½“è¿‡ç¨‹ï¼š</strong></p><pre><code>å½“ hashSeed==0 åˆ™Â currentAltHashing=falseå½“ capacity &lt; Holder.ALTERNATIVE_HASHING_THRESHOLD åˆ™currentAltHashing =falseç»“æœ:switching=falseÂ å½“ hashSeed==0 åˆ™Â currentAltHashing=falseå½“ capacity &gt;= Holder.ALTERNATIVE_HASHING_THRESHOLD Â åˆ™Â currentAltHashing =trueç»“æœ:switching=trueÂ Â å½“ hashSeed !=0 åˆ™Â currentAltHashing=trueå½“ capacity &lt; Holder.ALTERNATIVE_HASHING_THRESHOLD Â åˆ™Â currentAltHashing =falseç»“æœ:å½“ switching=trueÂ å½“ hashSeed !=0 åˆ™Â currentAltHashing=trueå½“ capacity &gt;= Holder.ALTERNATIVE_HASHING_THRESHOLD Â åˆ™Â currentAltHashing =trueç»“æœ:switching=false</code></pre><p>å›å¤´å†çœ‹ä»£ç ï¼Œå‘ç°å¾ˆå·§å¦™</p><p>ç»“è®ºï¼š</p><p>â‘ .å¦‚æœä¸é…ç½®â€œjdk.map.althashing.thresholdâ€,åˆ™HashMapä¸­çš„ç§æœ‰é™æ€å†…éƒ¨ç±»ä¸­çš„â€™ALTERNATIVE_HASHING_THRESHOLDâ€˜çš„å€¼ä¸ºInteger.MAX_VALUEï¼Œä¸”HashSeedé»˜è®¤å€¼ä¸º0ï¼Œåˆ™switchingçš„å€¼æ°¸è¿œä¸ºfalseï¼Œä¹Ÿå°±æ°¸è¿œä¸ä¼šæ”¹å˜å¹²æ‰°å› å­ï¼ˆHashSeedï¼‰çš„å€¼ã€‚</p><p>â‘¡ï¼å¦‚æœé…ç½®äº†â€œjdk.map.althashing.thresholdâ€,åˆ™ä¼šæ ¹æ®å½“å‰HashMapä¸­çš„æ•°ç»„å®¹é‡åŠ¨æ€çš„å˜æ›´HashSeedçš„å€¼ï¼Œä»¥ä¾¿äºå¼•å…¥HashSeedé™ä½å“ˆå¸Œå†²çªã€‚</p><p>-Djdk.map.althashing.threshold=-1:è¡¨ç¤ºä¸åšä¼˜åŒ–ï¼ˆä¸é…ç½®è¿™ä¸ªå€¼ä½œç”¨ä¸€æ ·ï¼‰<br>-Djdk.map.althashing.threshold&lt;0:æŠ¥é”™</p><p>-Djdk.map.althashing.threshold=1:è¡¨ç¤ºæ€»æ˜¯å¯ç”¨éšæœºHashSeed<br>-Djdk.map.althashing.threshold>=0:ä¾¿æ˜¯hashMapå†…éƒ¨çš„æ•°ç»„é•¿åº¦è¶…è¿‡è¯¥å€¼äº†å°±ä½¿ç”¨éšæœºHashSeedï¼Œé™ä½ç¢°æ’</p><h1 class=pgc-h-arrow-right>4.è·å–keyçš„Hashå€¼ï¼Œä½å¹²æ‰°ã€‚</h1><p><strong>æºç ï¼š</strong></p><pre><code>/**Â * Retrieve object hash code and applies a supplemental hash function to theÂ * result hash, which defends against poor quality hash functions.Â  This isÂ * critical because HashMap uses power-of-two length hash tables, thatÂ * otherwise encounter collisions for hashCodes that do not differÂ * in lower bits. Note: Null keys always map to hash 0, thus index 0.Â */final int hash(Object k) {/** è·å–å“ˆå¸Œå¹²æ‰°å› å­ï¼Œè¯¥å› å­ä¼šè·Ÿæ ¹æ®HashMapçš„å®¹é‡è¿›è¡Œå˜æ›´å˜æ›´æƒ…å†µæ ¹æ®ä¸Šä¸€æ­¥çš„â€œfinal boolean initHashSeedAsNeeded(int capacity)â€æ–¹æ³•åŠ¨æ€å˜æ›´**/ Â Â Â  int h = hashSeed;//å¦‚æœä¸ºå¹²æ‰°å› å­ä¸ä¸º0ï¼Œä¸”ä¼ å…¥çš„keyç±»å‹ä¸ºString,åˆ™ä½¿ç”¨ç‰¹å®šçš„ç®—æ³•ï¼ˆsun.misc.Hashing.stringHash32((String) k)ï¼‰å¯¹è¯¥keyè¿›è¡Œhashè®¡ç®—ã€‚å¹¶è¿”å›Â Â Â  if (0 != h &amp;&amp; k instanceof String) {Â Â Â Â Â Â Â  return sun.misc.Hashing.stringHash32((String) k);Â Â Â  }//å¦‚æœå“ˆå¸Œå¹²æ‰°å› å­ä¸º0 æˆ–è€… kçš„ç±»å‹ä¸ä¸ºStringåˆ™ä½¿ç”¨å¼‚æˆ–æ“ä½œå˜æ›´keyçš„hashcodeÂ Â Â  h ^= k.hashCode();//ä¸ºäº†å‡å°‘Hashå†²çªå‡ºç°æ¬¡æ•°è¿›è¡Œå¿…è¦çš„ä½å¹²æ‰°ï¼Œé»˜è®¤è´Ÿè½½å› å­æ˜¯8.Â Â Â  // This function ensures that hashCodes that differ only byÂ Â Â  // constant multiples at each bit position have a boundedÂ Â Â  // number of collisions (approximately 8 at default load factor).Â Â Â  h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12);Â Â Â  return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4);}</code></pre><p><strong>æºç è§£è¯»ï¼š</strong></p><p>å¯ä»¥çœ‹å‡ºç”Ÿæˆçš„hashå€¼å’ŒhashSeed è¿™ä¸ªå€¼æœ‰ç€ç´§å¯†çš„å…³ç³»ï¼Œä½†æ˜¯è¿™ä¸ªå€¼é»˜è®¤æ˜¯0ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸ç®¡HashMapå­˜å¤šå°‘æ•°æ®ï¼ŒhashSeed éƒ½æ˜¯ä¸ä¼šå˜çš„ï¼Œå¯ä»¥çœ‹å‡ºéšç€hashMap çš„å®¹é‡å¢å¤§ï¼Œhashç¢°æ’çš„æ¦‚ç‡å¢å¤§çš„å¯èƒ½æ€§ä¹Ÿå°±å¢å¤§ã€‚å¦‚æœhashå€¼ï¼Œç¢°æ’å¾ˆé«˜çš„è¯ï¼Œé‚£ä¹ˆhashMapé€æ¸æ¼”åŒ–æˆé“¾è¡¨ï¼Œæ€§èƒ½å°±æ€¥å‰§ä¸‹é™ã€‚</p><p>åœ¨hash(Object k)ä¸­æœ‰è¿™ä¹ˆä¸€æ®µä½è¿ç®—çš„ä»£ç ï¼š</p><pre><code>h ^= k.hashCode();h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12);return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4);</code></pre><p>çœ‹èµ·æ¥æ—¢ç®€å•åˆæ·±å¥¥çš„æ ·å­ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ®µä»£ç éšè—çš„ä¸œè¥¿å§ã€‚</p><p>k.hashCode()å‡½æ•°è°ƒç”¨çš„æ˜¯keyé”®å€¼ç±»å‹è‡ªå¸¦çš„å“ˆå¸Œå‡½æ•°ï¼Œç”±äºä¸åŒçš„å¯¹è±¡å…¶hashCode()æœ‰å¯èƒ½ç›¸åŒï¼Œæ‰€ä»¥éœ€å¯¹hashCode()å†æ¬¡å“ˆå¸Œï¼Œä»¥é™ä½ç›¸åŒç‡ã€‚</p><p>æ¥ä¸‹æ¥çš„ä¸€ä¸²ä¸è¿ç®—å’Œå¼‚æˆ–è¿ç®—ï¼Œç§°ä¹‹ä¸ºâ€œæ‰°åŠ¨å‡½æ•°â€ï¼Œæ‰°åŠ¨çš„æ ¸å¿ƒæ€æƒ³åœ¨äºä½¿è®¡ç®—å‡ºæ¥çš„å€¼åœ¨ä¿ç•™åŸæœ‰ç›¸å…³ç‰¹æ€§çš„åŸºç¡€ä¸Šï¼Œå¢åŠ å…¶å€¼çš„ä¸ç¡®å®šæ€§ï¼Œä»è€Œé™ä½å†²çªçš„æ¦‚ç‡ã€‚ä¸åŒçš„ç‰ˆæœ¬å®ç°çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œä½†å…¶æ ¹æœ¬æ€æƒ³æ˜¯ä¸€è‡´çš„ã€‚<br>è¿™é‡Œçš„å…·ä½“å®ç°æ–¹å¼æ˜¯å¦‚ä½•ä¿è¯çš„å‘¢ï¼Ÿç¬”è€…åŠŸåŠ›æµ…è–„ï¼Œæš‚æ—¶è¿˜æ²¡æœ‰ç­”æ¡ˆï¼Œå¦‚æœæœ‰æœ‹å‹çŸ¥é“çš„è¯å¯ä»¥äº¤æµã€‚ä½†æ˜¯ï¼Œâ€œæ‰°åŠ¨å‡½æ•°â€çš„æ ¸å¿ƒæ€æƒ³ä¸€å®šè¦æ˜ç™½ã€‚</p><div class=pgc-img><img alt=å››ã€JDK1.7ä¸­HashMapå“ˆå¸Œå†²çªè§£å†³æ–¹æ¡ˆ-é˜¿é‡Œé¢è¯•ç» onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/af6b4034b7db48f0907aff6d641e490c><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>å¾€æœŸæ–‡ç« é“¾æ¥</h1><p><strong>Javaé›†åˆ</strong></p><p><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6876269894007161348/?group_id=6876269894007161348?group_id=6876269894007161348" rel="noopener noreferrer" target=_blank>ä¸€ã€æ·±å…¥ç†è§£-Javaé›†åˆåˆç¯‡</a></p><p><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6877007182232027655/?group_id=6877007182232027655?group_id=6877007182232027655" rel="noopener noreferrer" target=_blank>äºŒã€Jdk1.7å’Œ1.8ä¸­HashMapæ•°æ®ç»“æ„åŠæºç åˆ†æ</a></p><p><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6877050052326457860/?group_id=6877050052326457860?group_id=6877050052326457860" rel="noopener noreferrer" target=_blank>äºŒã€JDK1.7å’Œ1.8HashMapæ•°æ®ç»“æ„åŠæºç åˆ†æ-ç»­</a></p><p><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6877362834460639757/?group_id=6877362834460639757?group_id=6877362834460639757" rel="noopener noreferrer" target=_blank>ä¸‰ã€æ·±å…¥ç†è§£Javaä¸­çš„HashMapã€Œç½‘æ˜“é¢è¯•å¿«ç­”ã€</a></p><p><br></p><p><strong>Java-IOä½“ç³»</strong></p><p><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6873764446930633230/?group_id=6873764446930633230" rel="noopener noreferrer" target=_blank>ä¸€ã€JAVA IO/NIOä½“ç³»ä»‹ç»</a></p><p><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6873765094426313219/?group_id=6873765094426313219" rel="noopener noreferrer" target=_blank>äºŒã€ç½‘ç»œIOåŸç†-åˆ›å»ºServerSocket-å½»åº•å¼„æ‡‚IO</a></p><p><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6873765826462220814/?group_id=6873765826462220814" rel="noopener noreferrer" target=_blank>ä¸‰ã€JAVAä¸­ServerSocketè°ƒç”¨Linuxç³»ç»Ÿå†…æ ¸</a></p><p><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6874772531308724750/?group_id=6874772531308724750" rel="noopener noreferrer" target=_blank>å››ã€ã€Œå¤§å‚èŒå‘˜æ•™ä½ ã€IOè¿›åŒ–è¿‡ç¨‹ä¹‹BIO</a></p><p><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6874782223262810635/?group_id=6874782223262810635" rel="noopener noreferrer" target=_blank>äº”ã€ã€Œå¤§å‚èŒå‘˜æ•™ä½ ã€Java-IOè¿›åŒ–è¿‡ç¨‹ä¹‹NIO</a></p><p><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6875153531486077448/?group_id=6875153531486077448" rel="noopener noreferrer" target=_blank>å…­ã€Selectorå®ç°Nettyä¸­Reactorå•çº¿ç¨‹æ¨¡å‹</a></p><p><br><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6875498967183032840/?group_id=6875498967183032840" rel="noopener noreferrer" target=_blank>ä¸ƒã€Selectorå®ç°Nettyä¸­Reactorä¸»ä»æ¨¡å‹</a></p><p><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6875960048917414407/?group_id=6875960048917414407" rel="noopener noreferrer" target=_blank>å…«ã€Nettyå…¥é—¨æœåŠ¡ç«¯ä»£ç </a></p><p><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6877376837149065741/?group_id=6877376837149065741" rel="noopener noreferrer" target=_blank>ä¹ã€IOè¿›åŒ–è¿‡ç¨‹ä¹‹EVENTï¼ˆEPOLL-äº‹ä»¶é©±åŠ¨å¼‚æ­¥æ¨¡å‹ï¼‰</a></p><p>å¦‚éœ€äº†è§£æ›´å¤šæ›´è¯¦ç»†å†…å®¹ä¹Ÿå¯å…³æ³¨æœ¬äººCSDNåšå®¢ï¼š<strong>ä¸åƒ_èŠ±æ¤’</strong></p><h1 class=pgc-h-arrow-right>Javaé›†åˆè¿˜éœ€è¦å­¦ä¹ çš„å†…å®¹</h1><p><br></p><div class=pgc-img><img alt=å››ã€JDK1.7ä¸­HashMapå“ˆå¸Œå†²çªè§£å†³æ–¹æ¡ˆ-é˜¿é‡Œé¢è¯•ç» onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/525daadbc273400c9608cc01da77bed7><p class=pgc-img-caption></p></div><p><br></p><div class=pgc-img><img alt=å››ã€JDK1.7ä¸­HashMapå“ˆå¸Œå†²çªè§£å†³æ–¹æ¡ˆ-é˜¿é‡Œé¢è¯•ç» onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a4c1effd30384d50974b96b130200436><p class=pgc-img-caption></p></div><p><br></p><div class=pgc-img><img alt=å››ã€JDK1.7ä¸­HashMapå“ˆå¸Œå†²çªè§£å†³æ–¹æ¡ˆ-é˜¿é‡Œé¢è¯•ç» onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/21837c954b8b448fab8a03b1a0bbe55c><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'JDK1.7','HashMap','å“ˆå¸Œ'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>