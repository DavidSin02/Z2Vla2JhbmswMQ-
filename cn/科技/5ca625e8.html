<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>CAN总线学习笔记：CAN总线的相关概念 | 极客快訊</title><meta property="og:title" content="CAN总线学习笔记：CAN总线的相关概念 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/78bcf8acd3d144378e48d70442ebec14"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ca625e8.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ca625e8.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5ca625e8.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ca625e8.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ca625e8.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5ca625e8.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5ca625e8.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ca625e8.html><meta property="article:published_time" content="2020-10-29T21:09:30+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:30+08:00"><meta name=Keywords content><meta name=description content="CAN总线学习笔记：CAN总线的相关概念"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/5ca625e8.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>CAN总线学习笔记：CAN总线的相关概念</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p class=ql-align-justify><strong>一、什么是CAN总线？</strong></p><p class=ql-align-justify>CAN，全称为“Controller Area Network”，即控制器局域网，是国际上应用最广泛的现场总线之一。最初，CAN被设计作为汽车环境中的微控制器通讯，在车载各电子控制装置ECU之间交换信息，形成汽车电子控制网络。比如：发动机管理系统、变速箱控制器、仪表装备、电子主干系统中，均嵌入CAN控制装置。</p><p class=ql-align-justify>一个由CAN总线构成的单一网络中，理论上可以挂接无数个节点。实际应用中，节点数目受网络硬件的电气特性所限制。例如，当使用Philips P82C250作为CAN收发器时，同一网络中允许挂接110个节点。CAN 可提供高达1Mbit/s的数据传输速率，这使实时控制变得非常容易。另外，硬件的错误检定特性也增强了CAN的抗电磁干扰能力。</p><p class=ql-align-justify><strong>二、CAN 总线是如何发展的？</strong></p><p class=ql-align-justify>CAN最初出现在80年代末的汽车工业中，由德国Bosch公司最先提出。当时，由于消费者对于汽车功能的要求越来越多，而这些功能的实现大多是基于电子操作的，这就使得电子装置之间的通讯越来越复杂，同时意味着需要更多的连接信号线。提出CAN总线的最初动机就是为了解决现代汽车中庞大的电子控制装置之间的通讯，减少不断增加的信号线。于是，他们设计了一个单一的网络总线，所有的外围器件可以被挂接在该总线上。1993年，CAN 已成为国际标准ISO11898(高速应用)和ISO11519（低速应用）。</p><p class=ql-align-justify>CAN是一种多主方式的串行通讯总线，基本设计规范要求有高的位速率，高抗电磁干扰性，而且能够检测出产生的任何错误。当信号传输距离达到10Km时，CAN 仍可提供高达50Kbit/s的数据传输速率。</p><p class=ql-align-justify>由于CAN总线具有很高的实时性能，因此，CAN已经在汽车工业、航空工业、工业控制、安全防护等领域中得到了广泛应用。</p><p class=ql-align-justify><strong>三、CAN 总线是如何工作的？</strong></p><p class=ql-align-justify>CAN通讯协议主要描述设备之间的信息传递方式。CAN层的定义与开放系统互连模型（OSI）一致。每一层与另一设备上相同的那一层通讯。实际的通讯发生在每一设备上相邻的两层，而设备只通过模型物理层的物理介质互连。CAN的规范定义了模型的最下面两层：数据链路层和物理层。下表中展示了OSI开放式互连模型的各层。应用层协议可以由CAN用户定义成适合特别工业领域的任何方案。已在工业控制和制造业领域得到广泛应用的标准是DeviceNet，这是为PLC和智能传感器设计的。在汽车工业，许多制造商都应用他们自己的标准。</p><div class=pgc-img><img alt=CAN总线学习笔记：CAN总线的相关概念 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/78bcf8acd3d144378e48d70442ebec14><p class=pgc-img-caption>表1 OSI开放系统互连模型</p></div><p class=ql-align-justify>CAN能够使用多种物理介质，例如双绞线、光纤等。最常用的就是双绞线。信号使用差分电压传送，两条信号线被称为“CAN_H”和“CAN_L”，静态时均是2.5V左右，此时状态表示为逻辑“1”，也可以叫做“隐性”。用CAN_H比CAN_L高表示逻辑“0”，称为“显形”，此时，通常电压值为：CAN_H = 3.5V 和CAN_L = 1.5V。</p><p class=ql-align-justify><strong>四、CAN 有哪些特性？</strong></p><p class=ql-align-justify>CAN具有十分优越的特点，使人们乐于选择。这些特性包括：</p><p class=ql-align-justify>1、低成本；</p><p class=ql-align-justify>2、极高的总线利用率；</p><p class=ql-align-justify>3、很远的数据传输距离(长达10Km)；</p><p class=ql-align-justify>4、高速的数据传输速率（高达1Mbit/s）；</p><p class=ql-align-justify>5、可根据报文的ID决定接收或屏蔽该报文；</p><p class=ql-align-justify>6、可靠的错误处理和检错机制；</p><p class=ql-align-justify>7、发送的信息遭到破坏后，可自动重发；</p><p class=ql-align-justify>8、节点在错误严重的情况下具有自动退出总线的功能；</p><p class=ql-align-justify>9、报文不包含源地址或目标地址，仅用标志符来指示功能信息、优先级信息。</p><p class=ql-align-justify><strong>五、Philips制造的CAN芯片有哪些？</strong></p><div class=pgc-img><img alt=CAN总线学习笔记：CAN总线的相关概念 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/122bc2539baf410785ab55a3dd4e6bf3><p class=pgc-img-caption></p></div><p><strong>六、CAN总线如何进行位仲裁？</strong></p><p class=ql-align-justify>CSMA/CD是“载波侦听多路访问/冲突检测”（Carrier Sense Multiple Access with Collision Detect）的缩写。</p><p class=ql-align-justify>利用CSMA访问总线，可对总线上信号进行检测，只有当总线处于空闲状态时，才允许发送。利用这种方法，可以允许多个节点挂接到同一网络上。当检测到一个冲突位时，所有 节点重新回到‘监听’总线状态，直到该冲突时间过后，才开始发送。在总线超载的情况下，这种技术可能会造成发送信号经过许多延迟。为了避免发送时延，可利 用CSMA/CD方式访问总线。当总线上有两个节点同时进行发送时，必须通过“无损的逐位仲裁”方法来使有最高优先权的的报文优先发送。在CAN总线上发送的每一条报文都具有唯一的一个11位或29位数字的ID。CAN总线状态取决于二进制数‘0’而不是‘1’，所以ID号越小，则该报文拥有越高的优先权。因此一个为全‘0’标志符的报文具有总线上的最高级优先权。可用另外的方法来解释：在消息冲突的位置，第一个节点发送0而另外的节点发送1，那么发送0的节点将取得总线的控制权，并且能够成功的发送出它的信息。</p><p class=ql-align-justify><strong>七、CAN的高层协议</strong></p><p class=ql-align-justify>CAN的高层协议（也可理解为应用层协议）是一种在现有的底层协议（物理层和数据链路层）之上实现的协议。高层协议是在CAN规范的基础上发展起来的应用层。许多系统（像汽车工业）中，可以特别制定一个合适的应用层，但对于许多的行业来说，这种方法是不经济的。一些组织已经研究并开放了应用层标准，以使系统的综合应用变得十分容易。</p><p class=ql-align-justify>一些可使用的CAN高层协议有：</p><p class=ql-align-justify>1、制定组织主要高层协议</p><p class=ql-align-justify>2、CiA CAL协议</p><p class=ql-align-justify>3、CiA CANOpen协议</p><p class=ql-align-justify>4、ODVA DeviceNet 协议</p><p class=ql-align-justify>5、Honeywell SDS 协议</p><p class=ql-align-justify>6、Kvaser CANKingdom协议</p><p class=ql-align-justify><strong>八、什么是标准格式CAN和扩展格式CAN？</strong></p><p class=ql-align-justify>标准CAN的标志符长度是11位，而扩展格式CAN的标志符长度可达29位。CAN 协议的2.0A版本规定CAN控制器必须有一个11位的标志符。同时，在2.0B版本中规定，CAN控制器的标志符长度可以是11位或29位。遵循CAN2.0B协议的CAN控制器可以发送和接收11位标识符的标准格式报文或29位标识符的扩展格式报文。如果禁止CAN2.0B,则CAN 控制器只能发送和接收11位标识符的标准格式报文，而忽略扩展格式的报文结构，但不会出现错误。</p><p class=ql-align-justify>目前，Philips公司主要推广的CAN独立控制器均支持CAN2.0B协议，即支持29位标识符的扩展格式报文结构。</p><p class=ql-align-justify><strong>九、CAN的报文格式：</strong></p><p class=ql-align-justify>（关于这部分内容，对于我下一步要进行编程实验控制CAN总线是很重要的一个知识点。很郁闷的是搜了老半天只看见有文字叙述这部分内容的，不仅说得不系统完整，而且远没有贴图说明来的具体直观。不过还好，搜到了一份E文版的CAN总线资料，再把这个资料详细看了下，再做了整理，还是用图来说明CAN传输的报文格式比较容易理解。老外写的东西确实比国内的好，这个不是我吹出来的，有兴趣下了看看就知道了，见附件下载。）</p><p class=ql-align-justify>CAN通信是一种点对多点的传输协议，不是基于地址的传统的点对点传输协议。当一个点传输数据时，总线上的其它点都可以为接受方，它们可以通过ID来作出对总线上传送数据的处理（接收或者丢弃）。并且当数据被正确接收到以后，接收方便会作出应答响应。CAN协议还有一个很实用的功能，就是总线上的任一个节点可以请求其它节点向其发送数据，这被称作远程发送请求（RTR）。除此以外，CAN协议还有一个优点，当总线新加入一个节点进行通信时无需更改原有的程序，新节点只要通过ID就可以知道是接收还是丢弃数据。</p><p class=ql-align-justify>CAN协议定义了四种不同的帧。</p><p class=ql-align-justify>1、数据帧，这个帧被用于当一个节点把信息传送给系统的任何其它节点。数据帧由7个不同的位场组成，即帧起始、仲裁场、控制场、数据场、CRC场、应答场、帧结束。</p><p class=ql-align-justify>2、远程帧，此帧是基于数据帧格式，只要把RTR位设置成远程发送请求（Remote Transmit Request），并且没有数据场。总线上发送此帧后，表示请求接收与该帧ID相符的数据帧。远程帧由6个不同的位场组成，即帧起始、仲裁场、控制场、CRC场、应答场、帧结束。</p><p class=ql-align-justify>3、错误帧，任何单元监测到错误时就发送错误帧。错误帧由两个不同的场组成。第一个场是错误标志，用做为不同站提供错误标志的叠加；第二个场是错误界定符。</p><p class=ql-align-justify>4、超载帧，节点需要增加时间来处理接收到的数据时便发送过载帧。超载帧包括两个位场：超载标志和超载界定符。</p><div class=pgc-img><img alt=CAN总线学习笔记：CAN总线的相关概念 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/225769f0e1bd441689b14ea67c84b9cb><p class=pgc-img-caption>图1 帧起始位</p></div><p class=ql-align-justify>CAN总线传输的起始帧如图1。帧起始标志数据帧或远程帧的起始，由一个单独的“显性”位（0）组成。由控制芯片完成。</p><div class=pgc-img><img alt=CAN总线学习笔记：CAN总线的相关概念 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1523c503d6dc426182346f3a67b6dbe4><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><div class=pgc-img><img alt=CAN总线学习笔记：CAN总线的相关概念 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/c00108eb27ce4d9890791b3cfcfc7ec7><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>由图2和图3可以看到数据帧的两种不同格式，两种格式的差别只是它们的ID位数不同。</p><p class=ql-align-justify><strong>1、帧起始。</strong></p><p class=ql-align-justify><strong>2、仲裁场</strong>，仲裁场包括标识符和远程发送请求位（RTR）。</p><p class=ql-align-justify>对于CAN2.0A标准，标识符的长度为11位。RTR位在数据帧中必须是显性位，而在远程帧必须为隐性位。</p><p class=ql-align-justify>对于CAN2.0，标准格式和扩展格式的仲裁场不同。在标准格式中，仲裁场由11位标识符和远程发送请求位组成。在扩展格式中，仲裁场由29位标识符和替代远程请求位（SRR） 、标志位（IDE）和远程发送请求位组成。</p><p class=ql-align-justify>仲裁场的作用之一是说明数据帧或远程帧发送目的地；之二是指出是数据帧还是远程帧。</p><p class=ql-align-justify><strong>3、控制场</strong>，控制场由6个位组成，说明数据帧中有效数据的长度。标准帧的最高位是IDE位，扩展帧的最高位是保留位RB1，它们的次高位都是保留位RB0。低四位是DLC（Data Length Code）位，标识传送的数据字节数（0-8字节）。</p><p class=ql-align-justify><strong>4、数据场</strong>，数据场由数据帧中的发送数据组成。它可以为0-8个字节。</p><p class=ql-align-justify><strong>5、CRC场</strong>，CRC场包括CRC序列，这部分由SJA1000控制芯片完成。</p><p class=ql-align-justify><strong>6、应答场</strong>，应答场长度为两个位，包括应答间隙和应答界定符。由SJA1000控制芯片自动完成。</p><p class=ql-align-justify><strong>7、帧结束</strong>，每一个数据帧和远程帧均由一标志序列界定，这个标志序列由7个“隐性”位组成。这部分由SJA1000控制芯片自动完成。</p><p class=ql-align-justify>仲裁场、控制场、数据场由软件编程配置SJA1000完成；帧起始、CRC场、应答场、帧结束由CAN总线控制芯片SJA1000自动完成。</p><p class=ql-align-justify><strong>十、CAN的数据错误检测：</strong></p><p class=ql-align-justify>不同于其它总线,CAN协议不能使用应答信息。事实上,它可以将发生的任何错误用信号发出。CAN协议可使用五种检查错误的方法,其中前三种为基于报文内容检查。</p><p class=ql-align-justify><strong>1、循环冗余检查(CRC)</strong></p><p class=ql-align-justify>在一帧报文中加入冗余检查位可保证报文正确。接收站通过CRC可判断报文是否有错。</p><p class=ql-align-justify><strong>2、帧检查</strong></p><p class=ql-align-justify>这种方法通过位场检查帧的格式和大小来确定报文的正确性,用于检查格式上的错误。</p><p class=ql-align-justify><strong>3、应答错误</strong></p><p class=ql-align-justify>如前所述,被接收到的帧由接收站通过明确的应答来确认。如果发送站未收到应答,那么表明接收站发现帧中有错误,也就是说,ACK场已损坏或网络中的报文无站接收。CAN协议也可通过位检查的方法探测错误。</p><p class=ql-align-justify><strong>4、总线检测</strong></p><p class=ql-align-justify>有时,CAN中的一个节点可监测自己发出的信号。因此,发送报文的站可以观测总线电平并探测发送位和接收位的差异。</p><p class=ql-align-justify><strong>5、位填充</strong></p><p class=ql-align-justify>一帧报文中的每一位都由不归零码表示,可保证位编码的最大效率。然而,如果在一帧报文中有太多相同电平的位,就有可能失去同步。为保证同步,同步沿用位填充产生。在五个生。在五个连续相等位后,发送站自动插入一个与之互补的补码位;接收时,这个填充位被自动丢掉。例如,五个连续的低电平位后,CAN自动插入一个高电平位。CAN通过这种编码规则检查错误,如果在一帧报文中有6个相同位,CAN就知道发生了错误。</p><p class=ql-align-justify>如果至少有一个站通过以上方法探测到一个或多个错误,它将发送出错标志终止当前的发送。这可以阻止其它站接收错误的报文,并保证网络上报文的一致性。当大量发送数据被终止后,发送站会自动地重新发送数据。作为规则,在探测到错误后23个位周期内重新开始发送。在特殊场合,系统的恢复时间为31个位周期。</p><p class=ql-align-justify>但这种方法存在一个问题,即一个发生错误的站将导致所有数据被终止,其中也包括正确的数据。因此,如果不采取自监测措施,总线系统应采用模块化设计。为此,CAN协议提供一种将偶然错误从永久错误和局部站失败中区别出来的办法。这种方法可以通过对出错站统计评估来确定一个站本身的错误并进入一种不会对其它站产生不良影响的运行方法来实现,即站可以通过关闭自己来阻止正常数据因被错误地当成不正确的数据而被终止。</p><p class=ql-align-justify><strong>6、CAN可靠性</strong></p><p class=ql-align-justify>为防止汽车在使用寿命期内由于数据交换错误而对司机造成危险,汽车的安全系统要求数据传输具有较高的安全性。如果数据传输的可靠性足够高,或者残留下来的数据错误足够低的话,这一目标不难实现。从总线系统数据的角度看,可靠性可以理解为,对传输过程产生的数据错误的识别能力。</p><p class=ql-align-justify>残余数据错误的概率可以通过对数据传输可靠性的统计测量获得。它描述了传送数据被破坏和这种破坏不能被探测出来的概率。残余数据错误概率必须非常小,使其在系统整个寿命周期内,按平均统计时几乎检测不到。计算残余错误概率要求能够对数据错误进行分类 ,并且数据传输路径可由一模型描述。如果要确定CAN的残余错误概率,我们可将残留错误的概率作为具有80～90位的报文传送时位错误概率的函数,并假定这个系统中有5～10个站,并且错误率为1/1000,那么最大位错误概率为10—13数量级。例如,CAN网络的数据传输率最大为1Mbps,如果数据传输能力仅使用50%,那么对于一个工作寿命4000小时、平均报文长度为 80位的系统,所传送的数据总量为9×1010。在系统运行寿命期内,不可检测的传输错误的统计平均小于10—2量级。换句话说,一个系统按每年365 天,每天工作8小时,每秒错误率为0. 7计算,那么按统计平均,每1000年才会发生一个不可检测的错误。</p><p class=ql-align-justify>广告商务合作，请联系0755-33248146</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'总线','学习','笔记'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>