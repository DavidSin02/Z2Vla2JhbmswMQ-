<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>C++ï½œç±»å°è£…å¦‚ä½•æå‡å®‰å…¨å’Œå¯ç»´æŠ¤æ€§ï¼Œä»¥æ™ºèƒ½æŒ‡é’ˆå°è£…è£¸æŒ‡é’ˆä¸ºä¾‹ | æå®¢å¿«è¨Š</title><meta property="og:title" content="C++ï½œç±»å°è£…å¦‚ä½•æå‡å®‰å…¨å’Œå¯ç»´æŠ¤æ€§ï¼Œä»¥æ™ºèƒ½æŒ‡é’ˆå°è£…è£¸æŒ‡é’ˆä¸ºä¾‹ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5e4f2831.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5e4f2831.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5e4f2831.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5e4f2831.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5e4f2831.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5e4f2831.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5e4f2831.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5e4f2831.html><meta property="article:published_time" content="2020-11-14T21:05:50+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:50+08:00"><meta name=Keywords content><meta name=description content="C++ï½œç±»å°è£…å¦‚ä½•æå‡å®‰å…¨å’Œå¯ç»´æŠ¤æ€§ï¼Œä»¥æ™ºèƒ½æŒ‡é’ˆå°è£…è£¸æŒ‡é’ˆä¸ºä¾‹"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/5e4f2831.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>C++ï½œç±»å°è£…å¦‚ä½•æå‡å®‰å…¨å’Œå¯ç»´æŠ¤æ€§ï¼Œä»¥æ™ºèƒ½æŒ‡é’ˆå°è£…è£¸æŒ‡é’ˆä¸ºä¾‹</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºCé£æ ¼çš„åŠ¨æ€å­—ç¬¦ä¸²ï¼Œéœ€è¦ç¨‹åºå‘˜è‡ªå·±ç®¡ç†å†…å­˜ï¼Œä¹Ÿæ²¡æœ‰ç›´è§‚çš„æ“ä½œç¬¦è¿ç®—ï¼ˆåªèƒ½ä½¿ç”¨Cé£æ ¼çš„stringå‡½æ•°ï¼‰ï¼Œå°è£…æˆç±»å°±ä¸ä¸€æ ·çš„ï¼Œå­—ç¬¦ä¸²ç±»ç®€å•ä¸€ç‚¹æ¥è¯´å°±æ˜¯å°è£…ä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆä»¥åŠä¸€äº›æˆå‘˜å‡½æ•°å’Œè¿ç®—ç¬¦é‡è½½å‡½æ•°ï¼Œå¯ä»¥æœ‰è¾¹ç•Œæ£€æŸ¥ã€‚å¤æ‚ä¸€ç‚¹å°±æ˜¯å†å°è£…ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆï¼Œå¦‚åŒ…å«å¼•ç”¨è®¡æ•°çš„æ™ºèƒ½æŒ‡é’ˆã€‚</p><p>æ™ºèƒ½æŒ‡é’ˆå°±æ˜¯å¯¹è£¸æŒ‡é’ˆçš„å°è£…ï¼Œç”¨æ¥è§£å†³å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚æˆ‘ä»¬çŸ¥é“ç±»çš„ææ„å¯ä»¥è‡ªåŠ¨æ¸…ç†åŠ¨æ€å†…å­˜ï¼ˆå½“ç„¶è¦æœ‰æ˜¾å¼çš„delete(æˆ–free)è¯­å¥åŒ…å«åœ¨å†…ï¼Œç±»å¯¹è±¡åœ¨ç¦»å¼€ä½œç”¨åŸŸåä¼šè‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°ï¼‰ï¼Œä½œç”¨åŸŸå¯ä»¥è‡ªåŠ¨ç®¡ç†æ ˆä¸Šå†…å­˜ï¼Œå¦‚æœä¸€ä¸ªæ ˆä¸Šçš„æŒ‡é’ˆæŒ‡å‘äº†ä¸€ä¸ªå †ä¸Šçš„åŠ¨æ€å†…å­˜å—ï¼Œå¦‚ä½•åˆ©ç”¨ç±»çš„ææ„ä¸æ ˆä¸Šå†…å­˜ä½œç”¨åŸŸçš„æœºåˆ¶æ¥é¿å…å†…å­˜æ³„æ¼ï¼Ÿå†è€ƒè™‘åˆ°å †ä¸ŠåŠ¨æ€å†…å­˜å—æ˜¯å¦å…±äº«çš„é—®é¢˜ï¼Œè¿™å°±æ˜¯auto_ptrã€unique_ptrã€shared_ptrç­‰æ™ºèƒ½æŒ‡é’ˆçš„æ¦‚å¿µã€‚</p><p>å¦‚æœä¸€ä¸ªæ ˆä¸Šçš„æŒ‡é’ˆï¼ˆå¦‚nudePtrï¼‰æŒ‡å‘äº†ä¸€ä¸ªå †ä¸Šçš„åŠ¨æ€å†…å­˜å—ï¼Œå¦‚æœæ²¡æœ‰delete(æˆ–free)ï¼Œå½“nudePtrç¦»å¼€ä½œç”¨åŸŸåï¼Œé‡Šæ”¾äº†nudePtræœ¬èº«ï¼Œå¹¶æ²¡æœ‰é‡Šæ”¾å †ä¸Šçš„å†…å­˜ï¼ˆéœ€è¦delete(æˆ–free)ï¼‰ã€‚å¦‚æœå°†nudePtrå°è£…æˆsmartPtrï¼ˆæ¨¡æ¿ç±»å®ç°ï¼‰ï¼Œå½“smartPtræŒ‡å‘å †ä¸Šå†…å­˜å—æ—¶ï¼Œåœ¨smartPtrç¦»å¼€ä½œç”¨åŸŸåï¼Œä½œä¸ºç±»å¯¹è±¡ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°ï¼Œå¦‚æœåœ¨smartPtrçš„ææ„å‡½æ•°ä¸­æœ‰delete(æˆ–free)é‡Šæ”¾æ‰å †ä¸Šå†…å­˜ï¼Œåˆ™å†…å­˜æ³„æ¼å°±ä¸æ˜¯é—®é¢˜äº†ï¼Œå½“ç„¶è¿˜æœ‰å †ä¸Šå†…å­˜å…±äº«çš„é—®é¢˜ï¼ˆé€šè¿‡å¤åˆ¶ã€èµ‹å€¼äº§ç”Ÿçš„ï¼‰ï¼Œæ­¤å†…å­˜æ‰€æœ‰æƒçš„é—®é¢˜æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</p><blockquote><p>å¼•ç”¨è®¡æ•°</p><p>å†™æ—¶å¤åˆ¶ã€èµ‹å€¼å³é‡Šæ”¾å¯¹è±¡æ‹¥æœ‰æƒé™</p><p>æ§åˆ¶æƒé™è½¬ç§»ï¼ˆç§»åŠ¨è¯­ä¹‰ï¼‰</p></blockquote><p>æ‹¥æœ‰ä¸åŒçš„æ–¹æ³•å¯¹åº”ç€ä¸åŒç±»å‹çš„æ™ºèƒ½æŒ‡é’ˆï¼Œæ¯”å¦‚C++11åœ¨STLä¸­å¼•å…¥çš„shared_ptrå°±å®ç°äº†å¼•ç”¨è®¡æ•°çš„åŠŸèƒ½ï¼Œå·²ç»è¢«C++11æ‘’å¼ƒçš„auto_ptrå®ç°äº†èµ‹å€¼å³é‡Šæ”¾å¯¹è±¡æ‹¥æœ‰æƒé™ï¼ŒC++11å¼•å…¥çš„unique_ptråˆ™å®ç°äº†æ§åˆ¶æƒé™çš„è½¬ç§»åŠŸèƒ½ã€‚</p><p>auto_ptr ä¸»è¦æœ‰ä¸¤å¤§é—®é¢˜ï¼š</p><p>å¤åˆ¶å’Œèµ‹å€¼ä¼šæ”¹å˜èµ„æºçš„æ‰€æœ‰æƒï¼Œä¸ç¬¦åˆäººçš„ç›´è§‰ã€‚</p><p>åœ¨ STL å®¹å™¨ä¸­æ— æ³•ä½¿ç”¨auto_ptr ï¼Œå› ä¸ºå®¹å™¨å†…çš„å…ƒç´ å¿…éœ€æ”¯æŒå¯å¤åˆ¶ï¼ˆcopy constructableï¼‰å’Œå¯èµ‹å€¼ï¼ˆassignableï¼‰ã€‚</p><p>unique_ptré€šè¿‡ç§»åŠ¨è¯­ä¹‰æ¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚</p><p>ä»¥ä¸‹å°±æ˜¯ä¸€ä¸ªunique_ptrå®ç°çš„ç®€å•é›å½¢ï¼š</p><pre>#include &lt;iostream&gt; template&lt;class T&gt;class Unique_ptr{	T* m_ptr;public:	Unique_ptr(T* ptr = nullptr):m_ptr(ptr)	{} 	~Unique_ptr()	{		delete m_ptr;	} 	// Copy constructor -- no copying allowed!	Unique_ptr(const Unique_ptr&amp; a) = delete; 	// Move constructor	// Transfer ownership of a.m_ptr to m_ptr	Unique_ptr(Unique_ptr&amp;&amp; a)		: m_ptr(a.m_ptr)	{		a.m_ptr = nullptr;	} 	// Copy assignment -- no copying allowed!	Unique_ptr&amp; operator=(const Unique_ptr&amp; a) = delete; 	// Move assignment	// Transfer ownership of a.m_ptr to m_ptr	Unique_ptr&amp; operator=(Unique_ptr&amp;&amp; a)	{		// Self-assignment detection		if (&amp;a == this)			return *this; 		// Release any resource we&#39;re holding		delete m_ptr; 		// Transfer ownership of a.m_ptr to m_ptr		m_ptr = a.m_ptr;		a.m_ptr = nullptr; 		return *this;	} 	T&amp; operator*() const { return *m_ptr; }	T* operator-&gt;() const { return m_ptr; }	bool isNull() const { return m_ptr == nullptr; }}; class Resource{public:	Resource() { std::cout &lt;&lt; &#34;Resource acquired\n&#34;; }	~Resource() { std::cout &lt;&lt; &#34;Resource destroyed\n&#34;; }}; int main(){	Unique_ptr&lt;Resource&gt; res1(new Resource);	Unique_ptr&lt;Resource&gt; res2; // Start as nullptr 	std::cout &lt;&lt; &#34;res1 is &#34; &lt;&lt; (res1.isNull() ? &#34;null\n&#34; : &#34;not null\n&#34;);	std::cout &lt;&lt; &#34;res2 is &#34; &lt;&lt; (res2.isNull() ? &#34;null\n&#34; : &#34;not null\n&#34;); 	//res2 = res1; // auto_ptr 	Resource* nudePtr(new Resource);// è£¸æŒ‡é’ˆ	delete nudePtr; //å¦‚æœå¿˜è®°deleteï¼Œåˆ™nudePtrè¶…å‡ºä½œç”¨åŸŸæ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œ	// é‡Šæ”¾çš„æ˜¯è‡ªèº«ï¼Œå…¶æŒ‡å‘çš„åŠ¨æ€å†…å­˜å´å†ä¹Ÿæ²¡æœ‰æœºä¼šé‡Šæ”¾ï¼Œé€ æˆåŠ¨æ€å†…å­˜æ³„æ¼	// res2è¶…å‡ºä½œç”¨åŸŸæ—¶ä¼šè‡ªåŠ¨åœ¨æ ˆä¸Šé‡Šæ”¾ï¼ŒåŒæ—¶ä¼šè°ƒç”¨ææ„å‡½æ•°ï¼Œdelete m_ptrï¼Œé‡Šæ”¾å †ä¸Šå†…å­˜	// å°è£…çš„æŒ‡é’ˆï¼ˆæ™ºèƒ½æŒ‡é’ˆï¼‰åœ¨é‡Šæ”¾è‡ªèº«ï¼ˆæ ˆï¼‰çš„åŒæ—¶é‡Šæ”¾äº†å…¶æˆå‘˜æŒ‡é’ˆæŒ‡å‘çš„åŠ¨æ€å†…å­˜ï¼ˆå †å†…å­˜ï¼‰	// è£¸æŒ‡é’ˆé‡Šæ”¾è‡ªèº«ï¼ˆæ ˆï¼‰çš„åŒæ—¶å´è®©å…¶æŒ‡å‘çš„åŠ¨æ€å†…å­˜å¤±å»äº†é‡Šæ”¾çš„æœºä¼šï¼ˆå¦‚æœæ²¡æœ‰deleteï¼‰	// deleteçš„ä¸æ˜¯nudePtræœ¬èº«ï¼ˆæœ¬èº«è¶…å‡ºä½œç”¨åŸŸä¼šè‡ªåŠ¨åœ¨æ ˆä¸Šé‡Šæ”¾ï¼‰ï¼Œ	// deleteé’ˆå¯¹çš„æ˜¯å…¶æŒ‡å‘çš„å †å†…å­˜ï¼Œå…¶å®æœ¬è´¨ä¸Šä¹Ÿæ²¡æœ‰deleteï¼Œåªæ˜¯æ ‡è¯†ä¸ºå¯é‡æ–°é“¾æ¥çš„å †å†…å­˜ã€‚	return 0;}/*Resource acquired res1 is not null res2 is null Resource acquired Resource destroyed Resource destroyed */</pre><p>ï¼Endï¼</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'æŒ‡é’ˆ','C++','ç±»å°è£…'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>