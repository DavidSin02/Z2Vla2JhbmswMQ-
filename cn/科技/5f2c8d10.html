<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Linuxç¯å¢ƒä¸‹æ®µé”™è¯¯çš„äº§ç”ŸåŸå› åŠè°ƒè¯•æ–¹æ³•å°ç»“ | æå®¢å¿«è¨Š</title><meta property="og:title" content="Linuxç¯å¢ƒä¸‹æ®µé”™è¯¯çš„äº§ç”ŸåŸå› åŠè°ƒè¯•æ–¹æ³•å°ç»“ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5f2c8d10.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5f2c8d10.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5f2c8d10.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5f2c8d10.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5f2c8d10.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5f2c8d10.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5f2c8d10.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5f2c8d10.html><meta property="article:published_time" content="2020-10-29T21:12:09+08:00"><meta property="article:modified_time" content="2020-10-29T21:12:09+08:00"><meta name=Keywords content><meta name=description content="Linuxç¯å¢ƒä¸‹æ®µé”™è¯¯çš„äº§ç”ŸåŸå› åŠè°ƒè¯•æ–¹æ³•å°ç»“"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/5f2c8d10.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Linuxç¯å¢ƒä¸‹æ®µé”™è¯¯çš„äº§ç”ŸåŸå› åŠè°ƒè¯•æ–¹æ³•å°ç»“</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><html><body><p>æœ€è¿‘åœ¨Linuxç¯å¢ƒä¸‹åšCè¯­è¨€é¡¹ç›®ï¼Œç”±äºæ˜¯åœ¨ä¸€ä¸ªåŸæœ‰é¡¹ç›®åŸºç¡€ä¹‹ä¸Šè¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œè€Œä¸”é¡¹ç›®å·¥ç¨‹åºå¤§å¤æ‚ï¼Œå‡ºç°äº†ä¸å°‘é—®é¢˜ï¼Œå…¶ä¸­é‡åˆ°æœ€å¤šã€èŠ±è´¹æ—¶é—´æœ€é•¿çš„é—®é¢˜å°±æ˜¯è‘—åçš„â€œæ®µé”™è¯¯â€ï¼ˆSegmentation Faultï¼‰ã€‚å€Ÿæ­¤æœºä¼šç³»ç»Ÿå­¦ä¹ äº†ä¸€ä¸‹ï¼Œè¿™é‡Œå¯¹Linuxç¯å¢ƒä¸‹çš„æ®µé”™è¯¯åšä¸ªå°ç»“ï¼Œæ–¹ä¾¿ä»¥ååŒç±»é—®é¢˜çš„æ’æŸ¥ä¸è§£å†³ã€‚</p><p></p><h1 toutiao-origin=h1>1. æ®µé”™è¯¯æ˜¯ä»€ä¹ˆ</h1><p>ä¸€å¥è¯æ¥è¯´ï¼Œæ®µé”™è¯¯æ˜¯æŒ‡è®¿é—®çš„å†…å­˜è¶…å‡ºäº†ç³»ç»Ÿç»™è¿™ä¸ªç¨‹åºæ‰€è®¾å®šçš„å†…å­˜ç©ºé—´ï¼Œä¾‹å¦‚è®¿é—®äº†ä¸å­˜åœ¨çš„å†…å­˜åœ°å€ã€è®¿é—®äº†ç³»ç»Ÿä¿æŠ¤çš„å†…å­˜åœ°å€ã€è®¿é—®äº†åªè¯»çš„å†…å­˜åœ°å€ç­‰ç­‰æƒ…å†µã€‚è¿™é‡Œè´´ä¸€ä¸ªå¯¹äºâ€œæ®µé”™è¯¯â€çš„å‡†ç¡®å®šä¹‰ï¼ˆå‚è€ƒAnswers.comï¼‰ï¼š</p><pre><code>A segmentation fault (often shortened to segfault) is a particular error </code><code>condition that can occur during the operation of computer software. </code><code>In short, a segmentation fault occurs when a program attempts to access </code><code>a memory location that it is not allowed to access, or attempts to access </code><code>a memory location in a way that is not allowed (e.g., attempts to write to </code><code>a read-only location, or to overwrite part of the operating system). Systems </code><code>based on processors like the Motorola 68000 tend to refer to these events as </code><code>Address or Bus errors.</code><br><code>Segmentation is one approach to memory management and protection in the </code><code>operating system. It has been superseded by paging for most purposes, but </code><code>much of the terminology of segmentation is still used, "segmentation fault" </code><code>being an example. Some operating systems still have segmentation at some </code><code>logical level although paging is used as the main memory management policy.</code><br><code>On Unix-like operating systems, a process that accesses invalid memory </code><code>receives the SIGSEGV signal. On Microsoft Windows, a process that accesses </code><code>invalid memory receives the STATUS_ACCESS_VIOLATION exception.</code></pre><p></p><h1 toutiao-origin=h1>2. æ®µé”™è¯¯äº§ç”Ÿçš„åŸå› </h1><h2 toutiao-origin=h2><strong toutiao-origin=span>2.1 è®¿é—®ä¸å­˜åœ¨çš„å†…å­˜åœ°å€</strong></h2><pre><code>#include&lt;stdio.h&gt;</code><code>#include&lt;stdlib.h&gt;</code><code>void main</code><code>{</code><code>int *ptr = ;</code><code> *ptr = 0;</code><code>}</code></pre><p></p><h2 toutiao-origin=h2><strong toutiao-origin=span>2.2 è®¿é—®ç³»ç»Ÿä¿æŠ¤çš„å†…å­˜åœ°å€</strong></h2><pre><code>#include&lt;stdio.h&gt;</code><code>#include&lt;stdlib.h&gt;</code><code>void main</code><code>{</code><code>int *ptr = (int *)0;</code><code> *ptr = 100;</code><code>}</code></pre><p></p><h2 toutiao-origin=h2><strong toutiao-origin=span>2.3 è®¿é—®åªè¯»çš„å†…å­˜åœ°å€</strong></h2><pre><code>#include&lt;stdio.h&gt;</code><code>#include&lt;stdlib.h&gt;</code><code>#include&lt;string.h&gt;</code><code>void main</code><code>{</code><code>char *ptr = "test";</code><code> strcpy(ptr, "TEST");</code><code>}</code></pre><p></p><h2 toutiao-origin=h2><strong toutiao-origin=span>2.4 æ ˆæº¢å‡º</strong></h2><pre><code>#include&lt;stdio.h&gt;</code><code>#include&lt;stdlib.h&gt;</code><code>void main</code><code>{</code><code> main;</code><code>}</code></pre><p>ç­‰ç­‰å…¶ä»–åŸå› ã€‚</p><p></p><h1 toutiao-origin=h1>3. æ®µé”™è¯¯ä¿¡æ¯çš„è·å–</h1><p>ç¨‹åºå‘ç”Ÿæ®µé”™è¯¯æ—¶ï¼Œæç¤ºä¿¡æ¯å¾ˆå°‘ï¼Œä¸‹é¢æœ‰å‡ ç§æŸ¥çœ‹æ®µé”™è¯¯çš„å‘ç”Ÿä¿¡æ¯çš„é€”å¾„ã€‚</p><p></p><h2 toutiao-origin=h2><strong toutiao-origin=span>3.1 dmesg</strong></h2><p>dmesgå¯ä»¥åœ¨åº”ç”¨ç¨‹åºcrashæ‰æ—¶ï¼Œæ˜¾ç¤ºå†…æ ¸ä¸­ä¿å­˜çš„ç›¸å…³ä¿¡æ¯ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œé€šè¿‡dmesgå‘½ä»¤å¯ä»¥æŸ¥çœ‹å‘ç”Ÿæ®µé”™è¯¯çš„ç¨‹åºåç§°ã€å¼•èµ·æ®µé”™è¯¯å‘ç”Ÿçš„å†…å­˜åœ°å€ã€æŒ‡ä»¤æŒ‡é’ˆåœ°å€ã€å †æ ˆæŒ‡é’ˆåœ°å€ã€é”™è¯¯ä»£ç ã€é”™è¯¯åŸå› ç­‰ã€‚ä»¥ç¨‹åº2.3ä¸ºä¾‹ï¼š</p><pre><code>panfeng@ubuntu:~/segfault$ dmesg</code><code>[ 2329.479037] segfault3[2700]: segfault at 80484e0 ip 00d2906a sp bfbbec3c error 7 in libc-2.10.1.so[cb4000+13e000]</code></pre><p></p><h2 toutiao-origin=h2><strong toutiao-origin=span>3.2 -g</strong></h2><p>ä½¿ç”¨gccç¼–è¯‘ç¨‹åºçš„æºç æ—¶ï¼ŒåŠ ä¸Š-gå‚æ•°ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­åŠ å…¥å¯ä»¥ç”¨äºgdbè°ƒè¯•çš„æœ‰ç”¨ä¿¡æ¯ã€‚ä»¥ç¨‹åº2.3ä¸ºä¾‹ï¼š</p><pre><code>panfeng@ubuntu:~/segfault$ gcc -g -o segfault3 segfault3.c</code></pre><p></p><h2 toutiao-origin=h2><strong toutiao-origin=span>3.3 nm</strong></h2><p>ä½¿ç”¨nmå‘½ä»¤åˆ—å‡ºäºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨ï¼ŒåŒ…æ‹¬ç¬¦å·åœ°å€ã€ç¬¦å·ç±»å‹ã€ç¬¦å·åç­‰ï¼Œè¿™æ ·å¯ä»¥å¸®åŠ©å®šä½åœ¨å“ªé‡Œå‘ç”Ÿäº†æ®µé”™è¯¯ã€‚ä»¥ç¨‹åº2.3ä¸ºä¾‹ï¼š</p><pre><code>panfeng@ubuntu:~/segfault$ nm segfault3</code><code>08049f20 d _DYNAMIC</code><code>08049ff4 d _GLOBAL_OFFSET_TABLE_</code><code>080484dc R _IO_stdin_used</code><code> w _Jv_RegisterClasses</code><code>08049f10 d __CTOR_END__</code><code>08049f0c d __CTOR_LIST__</code><code>08049f18 D __DTOR_END__</code><code>08049f14 d __DTOR_LIST__</code><code>080484ec r __FRAME_END__</code><code>08049f1c d __JCR_END__</code><code>08049f1c d __JCR_LIST__</code><code>0804a014 A __bss_start</code><code>0804a00c D __data_start</code><code>08048490 t __do_global_ctors_aux</code><code>08048360 t __do_global_dtors_aux</code><code>0804a010 D __dso_handle</code><code> w __gmon_start__</code><code>0804848a T __i686.get_pc_thunk.bx</code><code>08049f0c d __init_array_end</code><code>08049f0c d __init_array_start</code><code>08048420 T __libc_csu_fini</code><code>08048430 T __libc_csu_init</code><code> U __libc_start_main@@GLIBC_2.0</code><code>0804a014 A _edata</code><code>0804a01c A _end</code><code>080484bc T _fini</code><code>080484d8 R _fp_hw</code><code>080482bc T _init</code><code>08048330 T _start</code><code>0804a014 b completed.6990</code><code>0804a00c W data_start</code><code>0804a018 b dtor_idx.6992</code><code>080483c0 t frame_dummy</code><code>080483e4 T main</code><code> U memcpy@@GLIBC_2.0</code></pre><p></p><h2 toutiao-origin=h2><strong toutiao-origin=span>3.4 ldd</strong></h2><p>ä½¿ç”¨lddå‘½ä»¤æŸ¥çœ‹äºŒè¿›åˆ¶ç¨‹åºçš„å…±äº«é“¾æ¥åº“ä¾èµ–ï¼ŒåŒ…æ‹¬åº“çš„åç§°ã€èµ·å§‹åœ°å€ï¼Œè¿™æ ·å¯ä»¥ç¡®å®šæ®µé”™è¯¯åˆ°åº•æ˜¯å‘ç”Ÿåœ¨äº†è‡ªå·±çš„ç¨‹åºä¸­è¿˜æ˜¯ä¾èµ–çš„å…±äº«åº“ä¸­ã€‚ä»¥ç¨‹åº2.3ä¸ºä¾‹ï¼š</p><pre><code>panfeng@ubuntu:~/segfault$ ldd ./segfault3</code><code> linux-gate.so.1 =&gt; (0x00e08000)</code><code> libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0x00675000)</code><code> /lib/ld-linux.so.2 (0x00482000)</code></pre><p></p><h1 toutiao-origin=h1>4. æ®µé”™è¯¯çš„è°ƒè¯•æ–¹æ³•</h1><h2 toutiao-origin=h2><strong toutiao-origin=span>4.1 ä½¿ç”¨printfè¾“å‡ºä¿¡æ¯</strong></h2><p>è¿™ä¸ªæ˜¯çœ‹ä¼¼æœ€ç®€å•ä½†å¾€å¾€å¾ˆå¤šæƒ…å†µä¸‹ååˆ†æœ‰æ•ˆçš„è°ƒè¯•æ–¹å¼ï¼Œä¹Ÿè®¸å¯ä»¥è¯´æ˜¯ç¨‹åºå‘˜ç”¨çš„æœ€å¤šçš„è°ƒè¯•æ–¹å¼ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨ç¨‹åºçš„é‡è¦ä»£ç é™„è¿‘åŠ ä¸Šåƒprintfè¿™ç±»è¾“å‡ºä¿¡æ¯ï¼Œè¿™æ ·å¯ä»¥è·Ÿè¸ªå¹¶æ‰“å°å‡ºæ®µé”™è¯¯åœ¨ä»£ç ä¸­å¯èƒ½å‡ºç°çš„ä½ç½®ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤#ifdef DEBUGå’Œ#endifæŠŠprintfå‡½æ•°åŒ…èµ·æ¥ã€‚è¿™æ ·åœ¨ç¨‹åºç¼–è¯‘æ—¶ï¼Œå¦‚æœåŠ ä¸Š-DDEBUGå‚æ•°å°±èƒ½æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯ï¼›å¦åˆ™ä¸åŠ è¯¥å‚æ•°å°±ä¸ä¼šæ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ã€‚</p><p></p><h2 toutiao-origin=h2><strong toutiao-origin=span>4.2 ä½¿ç”¨gccå’Œgdb</strong></h2><h2 toutiao-origin=h3><strong toutiao-origin=span>4.2.1 è°ƒè¯•æ­¥éª¤</strong></h2><p>1ã€ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨gdbè°ƒè¯•ç¨‹åºï¼Œåœ¨ç¼–è¯‘é˜¶æ®µåŠ ä¸Š-gå‚æ•°ï¼Œä»¥ç¨‹åº2.3ä¸ºä¾‹ï¼š</p><pre><code>panfeng@ubuntu:~/segfault$ gcc -g -o segfault3 segfault3.c</code></pre><p>2ã€ä½¿ç”¨gdbå‘½ä»¤è°ƒè¯•ç¨‹åºï¼š</p><pre><code>panfeng@ubuntu:~/segfault$ gdb ./segfault3</code><code>GNU gdb (GDB) 7.0-ubuntu</code><code>Copyright (C) 2009 Free Software Foundation, Inc.</code><code>License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</code><code>This is free software: you are free to change and redistribute it.</code><code>There is NO WARRANTY, to the extent permitted by law. Type "show copying"</code><code>and "show warranty" for details.</code><code>This GDB was configured as "i486-linux-gnu".</code><code>For bug reporting instructions, please see:</code><code>&lt;http://www.gnu.org/software/gdb/bugs/&gt;...</code><code>Reading symbols from /home/panfeng/segfault/segfault3...done.</code><code>(gdb)</code></pre><p>3ã€è¿›å…¥gdbåï¼Œè¿è¡Œç¨‹åºï¼š</p><pre><code>(gdb) run</code><code>Starting program: /home/panfeng/segfault/segfault3</code><br><code>Program received signal SIGSEGV, Segmentation fault.</code><code>0x001a306a in memcpy  from /lib/tls/i686/cmov/libc.so.6</code><code>(gdb)</code></pre><p>ä»è¾“å‡ºçœ‹å‡ºï¼Œç¨‹åº2.3æ”¶åˆ°SIGSEGVä¿¡å·ï¼Œè§¦å‘æ®µé”™è¯¯ï¼Œå¹¶æç¤ºåœ°å€0x001a306aã€è°ƒç”¨memcpyæŠ¥çš„é”™ï¼Œä½äº/lib/tls/i686/cmov/libc.so.6åº“ä¸­ã€‚</p><p>4ã€å®Œæˆè°ƒè¯•åï¼Œè¾“å…¥quitå‘½ä»¤é€€å‡ºgdbï¼š</p><pre><code>(gdb) quit</code><code>A debugging session is active.</code><br><code> Inferior 1 [process 3207] will be killed.</code><br><code>Quit anyway? (y or n) y</code></pre><p></p><h2 toutiao-origin=h3><strong toutiao-origin=span>4.2.2 é€‚ç”¨åœºæ™¯</strong></h2><p>1ã€ä»…å½“èƒ½ç¡®å®šç¨‹åºä¸€å®šä¼šå‘ç”Ÿæ®µé”™è¯¯çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</p><p>2ã€å½“ç¨‹åºçš„æºç å¯ä»¥è·å¾—çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨-gå‚æ•°ç¼–è¯‘ç¨‹åºã€‚</p><p>3ã€ä¸€èˆ¬ç”¨äºæµ‹è¯•é˜¶æ®µï¼Œç”Ÿäº§ç¯å¢ƒä¸‹gdbä¼šæœ‰å‰¯ä½œç”¨ï¼šä½¿ç¨‹åºè¿è¡Œå‡æ…¢ï¼Œè¿è¡Œä¸å¤Ÿç¨³å®šï¼Œç­‰ç­‰ã€‚</p><p>4ã€å³ä½¿åœ¨æµ‹è¯•é˜¶æ®µï¼Œå¦‚æœç¨‹åºè¿‡äºå¤æ‚ï¼Œgdbä¹Ÿä¸èƒ½å¤„ç†ã€‚</p><p></p><h2 toutiao-origin=h2><strong toutiao-origin=span>4.3 ä½¿ç”¨coreæ–‡ä»¶å’Œgdb</strong></h2><p>åœ¨4.2èŠ‚ä¸­æåˆ°æ®µé”™è¯¯ä¼šè§¦å‘SIGSEGVä¿¡å·ï¼Œé€šè¿‡man 7 signalï¼Œå¯ä»¥çœ‹åˆ°SIGSEGVé»˜è®¤çš„handlerä¼šæ‰“å°æ®µé”™è¯¯å‡ºé”™ä¿¡æ¯ï¼Œå¹¶äº§ç”Ÿcoreæ–‡ä»¶ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥å€ŸåŠ©äºç¨‹åºå¼‚å¸¸é€€å‡ºæ—¶ç”Ÿæˆçš„coreæ–‡ä»¶ä¸­çš„è°ƒè¯•ä¿¡æ¯ï¼Œä½¿ç”¨gdbå·¥å…·æ¥è°ƒè¯•ç¨‹åºä¸­çš„æ®µé”™è¯¯ã€‚</p><p></p><h2 toutiao-origin=h3><strong toutiao-origin=span>4.3.1 è°ƒè¯•æ­¥éª¤</strong></h2><p>1ã€åœ¨ä¸€äº›Linuxç‰ˆæœ¬ä¸‹ï¼Œé»˜è®¤æ˜¯ä¸äº§ç”Ÿcoreæ–‡ä»¶çš„ï¼Œé¦–å…ˆå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿcoreæ–‡ä»¶çš„å¤§å°é™åˆ¶ï¼š</p><pre><code>panfeng@ubuntu:~/segfault$ ulimit -c</code><code>0</code></pre><p>2ã€å¯ä»¥çœ‹åˆ°é»˜è®¤è®¾ç½®æƒ…å†µä¸‹ï¼Œæœ¬æœºLinuxç¯å¢ƒä¸‹å‘ç”Ÿæ®µé”™è¯¯æ—¶ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆcoreæ–‡ä»¶ï¼Œä¸‹é¢è®¾ç½®ä¸‹coreæ–‡ä»¶çš„å¤§å°é™åˆ¶ï¼ˆå•ä½ä¸ºKBï¼‰ï¼š</p><pre><code>panfeng@ubuntu:~/segfault$ ulimit -c 1024</code><code>panfeng@ubuntu:~/segfault$ ulimit -c</code><code>1024</code></pre><p>3ã€è¿è¡Œç¨‹åº2.3ï¼Œå‘ç”Ÿæ®µé”™è¯¯ç”Ÿæˆcoreæ–‡ä»¶ï¼š</p><pre><code>panfeng@ubuntu:~/segfault$ ./segfault3</code><code>æ®µé”™è¯¯ (core dumped)</code></pre><p>4ã€åŠ è½½coreæ–‡ä»¶ï¼Œä½¿ç”¨gdbå·¥å…·è¿›è¡Œè°ƒè¯•ï¼š</p><pre><code>panfeng@ubuntu:~/segfault$ gdb ./segfault3 ./core</code><code>GNU gdb (GDB) 7.0-ubuntu</code><code>Copyright (C) 2009 Free Software Foundation, Inc.</code><code>License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</code><code>This is free software: you are free to change and redistribute it.</code><code>There is NO WARRANTY, to the extent permitted by law. Type "show copying"</code><code>and "show warranty" for details.</code><code>This GDB was configured as "i486-linux-gnu".</code><code>For bug reporting instructions, please see:</code><code>&lt;http://www.gnu.org/software/gdb/bugs/&gt;...</code><code>Reading symbols from /home/panfeng/segfault/segfault3...done.</code><br><code>warning: Can't read pathname for load map: è¾“å…¥/è¾“å‡ºé”™è¯¯.</code><code>Reading symbols from /lib/tls/i686/cmov/libc.so.6...(no debugging symbols found)...done.</code><code>Loaded symbols for /lib/tls/i686/cmov/libc.so.6</code><code>Reading symbols from /lib/ld-linux.so.2...(no debugging symbols found)...done.</code><code>Loaded symbols for /lib/ld-linux.so.2</code><code>Core was generated by `./segfault3'.</code><code>Program terminated with signal 11, Segmentation fault.</code><code>#0 0x0018506a in memcpy  from /lib/tls/i686/cmov/libc.6</code></pre><p>ä»è¾“å‡ºçœ‹å‡ºï¼ŒåŒ4.2.1ä¸­ä¸€æ ·çš„æ®µé”™è¯¯ä¿¡æ¯ã€‚</p><p>5ã€å®Œæˆè°ƒè¯•åï¼Œè¾“å…¥quitå‘½ä»¤é€€å‡ºgdbï¼š</p><pre><code>(gdb) quit</code></pre><p></p><h2 toutiao-origin=h3><strong toutiao-origin=span>4.3.2 é€‚ç”¨åœºæ™¯</strong></h2><p>1ã€é€‚åˆäºåœ¨å®é™…ç”Ÿæˆç¯å¢ƒä¸‹è°ƒè¯•ç¨‹åºçš„æ®µé”™è¯¯ï¼ˆå³åœ¨ä¸ç”¨é‡æ–°å‘ç”Ÿæ®µé”™è¯¯çš„æƒ…å†µä¸‹é‡ç°æ®µé”™è¯¯ï¼‰ã€‚</p><p>2ã€å½“ç¨‹åºå¾ˆå¤æ‚ï¼Œcoreæ–‡ä»¶ç›¸å½“å¤§æ—¶ï¼Œè¯¥æ–¹æ³•ä¸å¯ç”¨ã€‚</p><p></p><h2 toutiao-origin=h2><strong toutiao-origin=span>4.4 ä½¿ç”¨objdump</strong></h2><h2 toutiao-origin=h3><strong toutiao-origin=span>4.4.1 è°ƒè¯•æ­¥éª¤</strong></h2><p>1ã€ä½¿ç”¨dmesgå‘½ä»¤ï¼Œæ‰¾åˆ°æœ€è¿‘å‘ç”Ÿçš„æ®µé”™è¯¯è¾“å‡ºä¿¡æ¯ï¼š</p><pre><code>panfeng@ubuntu:~/segfault$ dmesg</code><code>... ...</code><code>[17257.502808] segfault3[3320]: segfault at 80484e0 ip 0018506a sp bfc1cd6c error 7 in libc-2.10.1.so[110000+13e000]</code></pre><p>å…¶ä¸­ï¼Œå¯¹æˆ‘ä»¬æ¥ä¸‹æ¥çš„è°ƒè¯•è¿‡ç¨‹æœ‰ç”¨çš„æ˜¯å‘ç”Ÿæ®µé”™è¯¯çš„åœ°å€ï¼š80484e0å’ŒæŒ‡ä»¤æŒ‡é’ˆåœ°å€ï¼š0018506aã€‚</p><p>2ã€ä½¿ç”¨objdumpç”ŸæˆäºŒè¿›åˆ¶çš„ç›¸å…³ä¿¡æ¯ï¼Œé‡å®šå‘åˆ°æ–‡ä»¶ä¸­ï¼š</p><pre><code>panfeng@ubuntu:~/segfault$ objdump -d ./segfault3 &gt; segfault3Dump</code></pre><p>å…¶ä¸­ï¼Œç”Ÿæˆçš„segfault3Dumpæ–‡ä»¶ä¸­åŒ…å«äº†äºŒè¿›åˆ¶æ–‡ä»¶çš„segfault3çš„æ±‡ç¼–ä»£ç ã€‚</p><p>3ã€åœ¨segfault3Dumpæ–‡ä»¶ä¸­æŸ¥æ‰¾å‘ç”Ÿæ®µé”™è¯¯çš„åœ°å€ï¼š</p><pre><code>panfeng@ubuntu:~/segfault$ grep -n -A 10 -B 10 "80484e0" ./segfault3Dump</code><code>121- 80483df: ff d0 call *%eax</code><code>122- 80483e1: c9 leave</code><code>123- 80483e2: c3 ret</code><code>124- 80483e3: 90 nop</code><code>125-</code><code>126-080483e4 &lt;main&gt;:</code><code>127- 80483e4: 55 push %ebp</code><code>128- 80483e5: 89 e5 mov %esp,%ebp</code><code>129- 80483e7: 83 e4 f0 and $0xfffffff0,%esp</code><code>130- 80483ea: 83 ec 20 sub $0x20,%esp</code><code>131: 80483ed: c7 44 24 1c e0 84 04 movl $0x80484e0,0x1c(%esp)</code><code>132- 80483f4: 08</code><code>133- 80483f5: b8 e5 84 04 08 mov $0x80484e5,%eax</code><code>134- 80483fa: c7 44 24 08 05 00 00 movl $0x5,0x8(%esp)</code><code>135- 8048401: 00</code><code>136- 8048402: 89 44 24 04 mov %eax,0x4(%esp)</code><code>137- 8048406: 8b 44 24 1c mov 0x1c(%esp),%eax</code><code>138- 804840a: 89 04 24 mov %eax,(%esp)</code><code>139- 804840d: e8 0a ff ff ff call 804831c &lt;memcpy@plt&gt;</code><code>140- 8048412: c9 leave</code><code>141- 8048413: c3 ret</code></pre><p>é€šè¿‡å¯¹ä»¥ä¸Šæ±‡ç¼–ä»£ç åˆ†æï¼Œå¾—çŸ¥æ®µé”™è¯¯å‘ç”Ÿmainå‡½æ•°ï¼Œå¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤æ˜¯movl $0x80484e0,0x1c(%esp)ï¼Œæ¥ä¸‹æ¥æ‰“å¼€ç¨‹åºçš„æºç ï¼Œæ‰¾åˆ°æ±‡ç¼–æŒ‡ä»¤å¯¹åº”çš„æºç ï¼Œä¹Ÿå°±å®šä½åˆ°æ®µé”™è¯¯äº†ã€‚</p><p></p><h2 toutiao-origin=h3><strong toutiao-origin=span>4.4.2 é€‚ç”¨åœºæ™¯</strong></h2><p>1ã€ä¸éœ€è¦-gå‚æ•°ç¼–è¯‘ï¼Œä¸éœ€è¦å€ŸåŠ©äºcoreæ–‡ä»¶ï¼Œä½†éœ€è¦æœ‰ä¸€å®šçš„æ±‡ç¼–è¯­è¨€åŸºç¡€ã€‚</p><p>2ã€å¦‚æœä½¿ç”¨äº†gccç¼–è¯‘ä¼˜åŒ–å‚æ•°ï¼ˆ-O1ï¼Œ-O2ï¼Œ-O3ï¼‰çš„è¯ï¼Œç”Ÿæˆçš„æ±‡ç¼–æŒ‡ä»¤å°†ä¼šè¢«ä¼˜åŒ–ï¼Œä½¿å¾—è°ƒè¯•è¿‡ç¨‹æœ‰äº›éš¾åº¦ã€‚</p><p></p><h2 toutiao-origin=h2><strong toutiao-origin=span>4.5 ä½¿ç”¨catchsegv</strong></h2><p>catchsegvå‘½ä»¤ä¸“é—¨ç”¨æ¥æ‰‘è·æ®µé”™è¯¯ï¼Œå®ƒé€šè¿‡åŠ¨æ€åŠ è½½å™¨ï¼ˆld-linux.soï¼‰çš„é¢„åŠ è½½æœºåˆ¶ï¼ˆPRELOADï¼‰æŠŠä¸€ä¸ªäº‹å…ˆå†™å¥½çš„åº“ï¼ˆ/lib/libSegFault.soï¼‰åŠ è½½ä¸Šï¼Œç”¨äºæ•æ‰æ–­é”™è¯¯çš„å‡ºé”™ä¿¡æ¯ã€‚</p><pre><code>panfeng@ubuntu:~/segfault$ catchsegv ./segfault3</code><code>Segmentation fault (core dumped)</code><code>*** Segmentation fault</code><code>Register dump:</code><br><code> EAX: 00000000 EBX: 00fb3ff4 ECX: 00000002 EDX: 00000000</code><code> ESI: 080484e5 EDI: 080484e0 EBP: bfb7ad38 ESP: bfb7ad0c</code><br><code> EIP: 00ee806a EFLAGS: 00010203</code><br><code> CS: 0073 DS: 007b ES: 007b FS: 0000 GS: 0033 SS: 007b</code><br><code> Trap: 0000000e Error: 00000007 OldMask: 00000000</code><code> ESP/signal: bfb7ad0c CR2: 080484e0</code><br><code>Backtrace:</code><code>/lib/libSegFault.so[0x3b606f]</code><code>??:0(??)[0xc76400]</code><code>/lib/tls/i686/cmov/libc.so.6(__libc_start_main+0xe6)[0xe89b56]</code><code>/build/buildd/eglibc-2.10.1/csu/../sysdeps/i386/elf/start.S:122(_start)[0x8048351]</code><br><code>Memory map:</code><br><code>00258000-00273000 r-xp 00000000 08:01 157 /lib/ld-2.10.1.so</code><code>00273000-00274000 r--p 0001a000 08:01 157 /lib/ld-2.10.1.so</code><code>00274000-00275000 rw-p 0001b000 08:01 157 /lib/ld-2.10.1.so</code><code>003b4000-003b7000 r-xp 00000000 08:01 13105 /lib/libSegFault.so</code><code>003b7000-003b8000 r--p 00002000 08:01 13105 /lib/libSegFault.so</code><code>003b8000-003b9000 rw-p 00003000 08:01 13105 /lib/libSegFault.so</code><code>00c76000-00c77000 r-xp 00000000 00:00 0 [vdso]</code><code>00e0d000-00e29000 r-xp 00000000 08:01 4817 /lib/libgcc_s.so.1</code><code>00e29000-00e2a000 r--p 0001b000 08:01 4817 /lib/libgcc_s.so.1</code><code>00e2a000-00e2b000 rw-p 0001c000 08:01 4817 /lib/libgcc_s.so.1</code><code>00e73000-00fb1000 r-xp 00000000 08:01 1800 /lib/tls/i686/cmov/libc-2.10.1.so</code><code>00fb1000-00fb2000 ---p 0013e000 08:01 1800 /lib/tls/i686/cmov/libc-2.10.1.so</code><code>00fb2000-00fb4000 r--p 0013e000 08:01 1800 /lib/tls/i686/cmov/libc-2.10.1.so</code><code>00fb4000-00fb5000 rw-p 00140000 08:01 1800 /lib/tls/i686/cmov/libc-2.10.1.so</code><code>00fb5000-00fb8000 rw-p 00000000 00:00 0</code><code>08048000-08049000 r-xp 00000000 08:01 303895 /home/panfeng/segfault/segfault3</code><code>08049000-0804a000 r--p 00000000 08:01 303895 /home/panfeng/segfault/segfault3</code><code>0804a000-0804b000 rw-p 00001000 08:01 303895 /home/panfeng/segfault/segfault3</code><code>09432000-09457000 rw-p 00000000 00:00 0 [heap]</code><code>b78cf000-b78d1000 rw-p 00000000 00:00 0</code><code>b78df000-b78e1000 rw-p 00000000 00:00 0</code><code>bfb67000-bfb7c000 rw-p 00000000 00:00 0 [stack]</code></pre><p></p><h1 toutiao-origin=h1>5. ä¸€äº›æ³¨æ„äº‹é¡¹</h1><p>1ã€å‡ºç°æ®µé”™è¯¯æ—¶ï¼Œé¦–å…ˆåº”è¯¥æƒ³åˆ°æ®µé”™è¯¯çš„å®šä¹‰ï¼Œä»å®ƒå‡ºå‘è€ƒè™‘å¼•å‘é”™è¯¯çš„åŸå› ã€‚</p><p>2ã€åœ¨ä½¿ç”¨æŒ‡é’ˆæ—¶ï¼Œå®šä¹‰äº†æŒ‡é’ˆåè®°å¾—åˆå§‹åŒ–æŒ‡é’ˆï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™è®°å¾—åˆ¤æ–­æ˜¯å¦ä¸ºã€‚</p><p>3ã€åœ¨ä½¿ç”¨æ•°ç»„æ—¶ï¼Œæ³¨æ„æ•°ç»„æ˜¯å¦è¢«åˆå§‹åŒ–ï¼Œæ•°ç»„ä¸‹æ ‡æ˜¯å¦è¶Šç•Œï¼Œæ•°ç»„å…ƒç´ æ˜¯å¦å­˜åœ¨ç­‰ã€‚</p><p>4ã€åœ¨è®¿é—®å˜é‡æ—¶ï¼Œæ³¨æ„å˜é‡æ‰€å åœ°å€ç©ºé—´æ˜¯å¦å·²ç»è¢«ç¨‹åºé‡Šæ”¾æ‰ã€‚</p><p>5ã€åœ¨å¤„ç†å˜é‡æ—¶ï¼Œæ³¨æ„å˜é‡çš„æ ¼å¼æ§åˆ¶æ˜¯å¦åˆç†ç­‰ã€‚</p><p></p><h1 toutiao-origin=h1>6. å‚è€ƒèµ„æ–™åˆ—è¡¨</h1><p>1ã€http://www.docin.com/p-105923877.html</p><p>2ã€http://blog.chinaunix.net/space.php?uid=317451&do=blog&id=92412</p></body></html></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Linux','ç¯å¢ƒ','é”™è¯¯'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>