<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>超值干货！三菱FX5UPLC和松下A5伺服实现无协议串口通信 | 极客快訊</title><meta property="og:title" content="超值干货！三菱FX5UPLC和松下A5伺服实现无协议串口通信 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/c061d62942844f13b922f52d76b500d5"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5f4d06d6.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5f4d06d6.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5f4d06d6.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5f4d06d6.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5f4d06d6.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5f4d06d6.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5f4d06d6.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5f4d06d6.html><meta property="article:published_time" content="2020-11-14T20:59:29+08:00"><meta property="article:modified_time" content="2020-11-14T20:59:29+08:00"><meta name=Keywords content><meta name=description content="超值干货！三菱FX5UPLC和松下A5伺服实现无协议串口通信"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/5f4d06d6.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>超值干货！三菱FX5UPLC和松下A5伺服实现无协议串口通信</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right><span style="color:#222;--tt-darkmode-color: #A3A3A3">一、系统概述：</span></h1><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">柳钢某车间一期控制系统主控制器使用松下FPXH系列PLC、主驱动器使用松下A5系列伺服控制器，二期项目立项开工，控制系统主控制器使用三菱FX5U系列PLC，该三菱FX5U系列PLC本体集成1路以太网通信口、1路RS485串行通信口。现今要求二期控制系统主控制器三菱FX5U系列PLC通过通信方式定时读取一期主驱动器松下A5系列伺服绝对式数据（单圈数据和多圈数据），经查松下A5系列伺服通信协议为非Modbus协议，故而三菱FX5U只能通过RS2指令无协议编程实现和松下A5系列伺服串口通信。</span></p><p style=text-align:justify><br></p><h1 class=pgc-h-arrow-right><span style="color:#222;--tt-darkmode-color: #A3A3A3">二、通信参数约定：</span></h1><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">1、三菱FX5U系列PLC通信参数：协议格式为无顺序通信、数据</span><span style="color:#222;--tt-darkmode-color: #A3A3A3">位</span><span style="color:#222;--tt-darkmode-color: #A3A3A3">设置为8位、校验方式设置为偶校验、停止位设置为1位、通信物理层为RS485、通信波特率为9600bps、数据处理模式为16位模式、帧头无添加、帧尾无添加、和校验不添加、无添加回车和换行符、超时时间设置为1000ms，详细设置如下图所示：</span></p><div class=pgc-img><img alt=超值干货！三菱FX5UPLC和松下A5伺服实现无协议串口通信 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c061d62942844f13b922f52d76b500d5><p class=pgc-img-caption></p></div><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">2、松下A5系列伺服通信参数：数据位设置为8位、校验方式设置为偶校验、停止位设置为1位、通信物理层为RS485、通信波特率为9600bps、轴编号设置为1。</span></p><p style=text-align:justify><br></p><h1 class=pgc-h-arrow-right><span style="color:#222;--tt-darkmode-color: #A3A3A3">三、松下A5系列伺服通信协议：</span></h1><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">三菱FX5U系列PLC要读取松下A5系列伺服绝对式数据要经过4次通信发送和接收才能完成，其松下A5系列伺服通信协议流程图和数据格式如下两图所示：</span></p><div class=pgc-img><img alt=超值干货！三菱FX5UPLC和松下A5伺服实现无协议串口通信 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/27cde88da2fe4f8c81114559dda391ed><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=超值干货！三菱FX5UPLC和松下A5伺服实现无协议串口通信 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b2b6f4f73a4b4e8582effed2f99b3d46><p class=pgc-img-caption></p></div><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">其中通信命令详解如下：</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">（1）三菱FX5U发送：81 05</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">（2）松下A5返回：81 04</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">（3）三菱FX5U发送：00 01 D2 2D（2D为LRC校验码）</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">（4）松下A5返回：06 或 15</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">（5）松下A5返回：80 05</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">（6）三菱FX5U发送：80 04</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">（7）松下A5返回：0B 01 D2 03 11 00 00 D8 FF 01 00 00 00 00 36（36是LRC校验码）</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">（8）三菱FX5U返回：06 或 15</span></p><p style=text-align:justify><br></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">其中数据格式详解如下所示：</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">以0B 01 D2 03 11 00 00 D8 FF 01 00 00 00 00 36为例说明：<br>0B：起始符</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">01：axis轴编号</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">D2：2为mode命令执行模式、D为command控制命令</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">03：编码器ID低8位</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">11：编码器ID高8位</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">00：编码器状态低8位</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">00：编码器状态高8位</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">D8：单圈数据</span><span style="color:#222;--tt-darkmode-color: #A3A3A3">低</span><span style="color:#222;--tt-darkmode-color: #A3A3A3">8位</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">FF：单圈数据中8位</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">01：单圈数据高8位</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">00：多圈数据</span><span style="color:#222;--tt-darkmode-color: #A3A3A3">低</span><span style="color:#222;--tt-darkmode-color: #A3A3A3">8位</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">00：多圈数据高8位</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">00：固定为0</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">00：错误码，无错时为00</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">36：前14个字节的LRC校验码</span></p><p style=text-align:justify><br></p><h1 class=pgc-h-arrow-right><span style="color:#222;--tt-darkmode-color: #A3A3A3">四、三菱FX5U系列PLC通信编程详解：</span></h1><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">1、初始化程序命令段：上电初始化时置位M0、复位其他所有标志位和寄存器，M0置位后开始延时，延时时间到达时置位M1、复位M0，M1置位后开始执行和松下A5伺服串口通信程序段，程序梯形图如下图所示：</span></p><div class=pgc-img><img alt=超值干货！三菱FX5UPLC和松下A5伺服实现无协议串口通信 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3f1ee279c8fe48759d9ef0d623d74379><p class=pgc-img-caption></p></div><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">2、通信命令程序段1：RS2指令发送缓冲区首地址为D10、发送字节计数为2、接收缓冲区首地址为D20、接收字节计数为2，标志位M1置位后开始延时，延时时间到达后，给发送缓冲区依次填写数据81、05，将开始发送标志位SM8561手动置位，发送完成后进入到等待接收程序命令段。如果接收超时则进入到继续定时发送数据H0581程序段；如果接收完成，接收完成标志位SM8562自动置位，判断接收到的数据是否为81 04，如果接收到的数据为81 04则进入到下一个通信命令程序段；如果接收到的数据非81 04则继续定时发送数据81 05，梯形图程序如下图所示：</span></p><div class=pgc-img><img alt=超值干货！三菱FX5UPLC和松下A5伺服实现无协议串口通信 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9e2d922ff98a47fd820aabd8589a873c><p class=pgc-img-caption></p></div><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">3、通信命令程序段2：RS2指令发送缓冲区首地址为D40、发送字节计数为4、接收缓冲区首地址为D50、接收字节计数为1，标志位M4置位后开始延时，延时时间到达后依次给发送缓冲区填写数据00 01 D2 2D，将开始发送标志位SM8561手动置位，发送完成后进入到等待接收程序命令段。如果接收完成，接收完成标志位SM8562自动置位，判断接收到的数据是否为06，如果接收到的数据为06则进入到下一个通信命令程序段；如果接收到的数据非H06则进入继续定时发送数据81 05程序命令段，梯形图程序如下图所示：</span></p><div class=pgc-img><img alt=超值干货！三菱FX5UPLC和松下A5伺服实现无协议串口通信 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f71e42ffe5c544c18d0247eb9ccda4cf><p class=pgc-img-caption></p></div><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">4、通信命令程序段3：RS2指令发送缓冲区首地址为D70、发送字节计数为2、接收缓冲区首地址为D80、接收字节计数为2，标志位M7置位后则进入到等待接收程序命令段，如果接收超时则进入到继续定时发送数据81 05程序段；如果接收到的数据为80 05则开始给松下A5伺服发送80 04，发送完成进入到下一个程序命令段；如果接收到的数据非80 05则进入到继续定时发送数据81 05程序命令段，程序梯形图如下图所示：</span></p><div class=pgc-img><img alt=超值干货！三菱FX5UPLC和松下A5伺服实现无协议串口通信 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/84c5b85eeaac48ed85f7d3688c7e9ce0><p class=pgc-img-caption></p></div><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">5、松下A5伺服绝对式数据的处理与保存：D130、D131、D132等3个寄存器中保存的是松下A5伺服单圈数据和多圈数据的原始值，经过数据处理，D200和D201组成的32位寄存器中保存的是单圈数据、D202保存的是多圈数据，程序梯形图如下图所示：</span></p><div class=pgc-img><img alt=超值干货！三菱FX5UPLC和松下A5伺服实现无协议串口通信 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0d7d1da91a784786a2757386b96a73a7><p class=pgc-img-caption></p></div><p style=text-align:justify><br></p><h1 class=pgc-h-arrow-right><span style="color:#222;--tt-darkmode-color: #A3A3A3">五、松下A5系列伺服通信测试：</span></h1><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">使用USB转RS485电缆连接电脑和松下A5系列伺服，串口调试助手通信测试命令如下所示：</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">串口调试助手发送：81 05、松下A5伺服返回81 04</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">串口调试助手发送：00 01 D2 2D、松下A5伺服返回06</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">松下A5伺服发送：80 05、串口调试助手返回80 04</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">松下A5伺服发送：0B 01 D2 03 11 00 00 D8 FF 01 00 00 00 00 36、串口调试助手返回06</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">以上说明，松下A5伺服通信测试无误。</span></p><div class=pgc-img><img alt=超值干货！三菱FX5UPLC和松下A5伺服实现无协议串口通信 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0828b6a1b78246fda8a3311ebedac5f1><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right><span style="color:#222;--tt-darkmode-color: #A3A3A3">六、三菱FX5U系列PLC通信测试：</span></h1><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">使用USB转RS485电缆连接电脑和三菱FX5U系列PLC，串口调试助手通信测试命令如下所示：</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">三菱FX5U发送：81 05、串口调试助手返回81 04</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">三菱FX5U：00 01 D2 2D、串口调试助手返回06</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">串口调试助手发送：80 05、三菱FX5U返回80 04</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">串口调试助手发送：0B 01 D2 03 11 00 00 D8 FF 01 00 00 00 00 36、三菱FX5U返回06</span></p><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">以上说明，三菱FX5U通信测试无误。</span></p><div class=pgc-img><img alt=超值干货！三菱FX5UPLC和松下A5伺服实现无协议串口通信 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0d1c35200b7541eea866508114e0d015><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><span style="color:#222;--tt-darkmode-color: #A3A3A3">七、系统联调：</span></h1><p style=text-align:justify><span style="color:#222;--tt-darkmode-color: #A3A3A3">将三菱FX5U系列PLC和松下A5系列伺服连接起来，通信测试后，发现PLC可以定时读取到伺服绝对式数据，并可将读取到的绝对式数据保存至指定的寄存器中，通信已然成功。</span></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'串口','干货','FX5UPLC'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>