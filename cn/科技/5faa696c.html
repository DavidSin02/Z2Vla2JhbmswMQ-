<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>入门Python必备：一文看懂NumPy基础操作 | 极客快訊</title><meta property="og:title" content="入门Python必备：一文看懂NumPy基础操作 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/a798e639c50f4aa5ae5061371ef9d0b4"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5faa696c.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5faa696c.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5faa696c.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5faa696c.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5faa696c.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5faa696c.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5faa696c.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5faa696c.html><meta property="article:published_time" content="2020-10-29T21:09:42+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:42+08:00"><meta name=Keywords content><meta name=description content="入门Python必备：一文看懂NumPy基础操作"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/5faa696c.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>入门Python必备：一文看懂NumPy基础操作</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><blockquote><p><strong>导读：</strong>NumPy是Python的基础，更是数据科学的通用语言。</p><p>本文简单介绍NumPy模块的两个基本对象ndarray、ufunc，介绍ndarray对象的几种生成方法及如何存取其元素、如何操作矩阵或多维数组、如何进行数据合并与展平等。最后说明通用函数及广播机制。</p></blockquote><p>作者：吴茂贵，王冬，李涛，杨本法</p><p>如需转载请联系大数据（ID：hzdashuju）</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=入门Python必备：一文看懂NumPy基础操作 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a798e639c50f4aa5ae5061371ef9d0b4><p class=pgc-img-caption></p></div><p><strong>NumPy为何如此重要？</strong>实际上Python本身含有列表（list）和数组（array），但对于大数据来说，这些结构有很多不足。因列表的元素可以是任何对象，因此列表中所保存的是对象的指针。这样为了保存一个简单的[1,2,3]，都需要有3个指针和3个整数对象。</p><p>对于数值运算来说，这种结构显然比较浪费内存和CPU计算时间。至于array对象，它直接保存数值，和C语言的一维数组比较类似。但是由于它不支持多维，也没有各种运算函数，因此也不适合做数值运算。</p><p>NumPy（Numerical Python 的简称）的诞生弥补了这些不足，它提供了两种基本的对象：ndarray（N-dimensional array object）和 ufunc（universal function object）。<strong>ndarray是存储单一数据类型的多维数组，而ufunc则是能够对数组进行处理的函数。</strong></p><p>NumPy的主要特点：</p><ul><li>ndarray，快速，节省空间的多维数组，提供数组化的算术运算和高级的广播功能。</li><li>使用标准数学函数对整个数组的数据进行快速运算，而不需要编写循环。</li><li>读取/写入磁盘上的阵列数据和操作存储器映像文件的工具。</li><li>线性代数，随机数生成，以及傅里叶变换的能力。</li><li>集成C、C++、Fortran代码的工具。</li></ul><p>在使用 NumPy 之前，需要先导入该模块：</p><pre>import numpy as np</pre><h1><strong>01 生成ndarray的几种方式</strong></h1><p>NumPy封装了一个新的数据类型ndarray，一个多维数组对象，该对象封装了许多常用的数学运算函数，方便我们进行数据处理以及数据分析，那么如何生成ndarray呢？这里我们介绍生成ndarray的几种方式，如从已有数据中创建；利用random创建；创建特殊多维数组；使用arange函数等。</p><p><strong>1. 从已有数据中创建</strong></p><p>直接对python的基础数据类型（如列表、元组等）进行转换来生成ndarray。</p><p>（1）将列表转换成ndarray</p><pre>import numpy as nplist1 = [3.14,2.17,0,1,2]nd1 = np.array(list1)print(nd1)print(type(nd1))</pre><p>打印结果：</p><pre>[ 3.14 2.17 0. 1. 2. ]&lt;class 'numpy.ndarray'&gt;</pre><p>（2）嵌套列表可以转换成多维ndarray</p><pre>import numpy as nplist2 = [[3.14,2.17,0,1,2],[1,2,3,4,5]]nd2 = np.array(list2)print(nd2)print(type(nd2))</pre><p>打印结果：</p><pre>[[ 3.14 2.17 0. 1. 2. ] [ 1. 2. 3. 4. 5. ]]&lt;class 'numpy.ndarray'&gt;</pre><p>如果把（1）和（2）中的列表换成元组也同样适合。</p><p><strong>2. 利用random模块生成ndarray</strong></p><p>在深度学习中，我们经常需要对一些变量进行初始化，适当的初始化能提高模型的性能。通常我们用随机数生成模块random来生成，当然random模块又分为多种函数：</p><ul><li>random生成0到1之间的随机数；</li><li>uniform生成均匀分布随机数；</li><li>randn生成标准正态的随机数；</li><li>normal生成正态分布；</li><li>shuffle随机打乱顺序；</li><li>seed设置随机数种子等。</li></ul><p>下面我们列举几个简单示例。</p><pre>import numpy as npnd5 = np.random.random([3,3])print(nd5)print(type(nd5))</pre><p>打印结果：</p><pre>[[ 0.88900951 0.47818541 0.91813526] [ 0.48329167 0.63730656 0.14301479] [ 0.9843789 0.99257093 0.24003961]]&lt;class 'numpy.ndarray'&gt;</pre><p>生成一个随机种子，对生成的随机数打乱。</p><pre>import numpy as npnp.random.seed(123)nd5_1 = np.random.randn(2,3)print(nd5_1)np.random.shuffle(nd5_1)print("随机打乱后数据")print(nd5_1)print(type(nd5_1))</pre><p>打印结果：</p><pre>[[-1.0856306 0.99734545 0.2829785 ] [-1.50629471 -0.57860025 1.65143654]]</pre><p>随机打乱后数据为：</p><pre>[[-1.50629471 -0.57860025 1.65143654] [-1.0856306 0.99734545 0.2829785 ]]&lt;class 'numpy.ndarray'&gt;</pre><p><strong>3. 创建特定形状的多维数组</strong></p><p>数据初始化时，有时需要生成一些特殊矩阵，如0或1的数组或矩阵，这时我们可以利用np.zeros、np.ones、np.diag来实现，下面我们通过几个示例来说明。</p><pre>import numpy as np#生成全是0的3x3矩阵nd6 = np.zeros([3,3])#生成全是1的3x3矩阵nd7 = np.ones([3,3])#生成3阶的单位矩阵nd8= np.eye(3)#生成3阶对角矩阵print (np.diag([1, 2, 3]))</pre><p>我们还可以把生成的数据保存到磁盘，然后从磁盘读取。</p><pre>import numpy as npnd9 = np.random.random([5,5])np.savetxt(X=nd9,fname='./test2.txt')nd10 = np.loadtxt('./test2.txt')</pre><p><strong>4. 利用arange函数</strong></p><p>arange是numpy模块中的函数，其格式为：arange([start,] stop[, step,], dtype=None)。根据start与stop指定的范围，以及step设定的步长，生成一个 ndarray，其中start默认为0，步长step可为小数。</p><pre>import numpy as npprint(np.arange(10))print(np.arange(0,10))print(np.arange(1, 4,0.5))print(np.arange(9, -1, -1))</pre><h1><strong>02 存取元素</strong></h1><p>上节我们介绍了生成ndarray的几种方法，数据生成后，如何读取我们需要的数据？这节我们介绍几种读取数据的方法。</p><pre>import numpy as npnp.random.seed(2018)nd11 = np.random.random([10])#获取指定位置的数据，获取第4个元素nd11[3]#截取一段数据nd11[3:6]#截取固定间隔数据nd11[1:6:2]#倒序取数nd11[::-2]#截取一个多维数组的一个区域内数据nd12=np.arange(25).reshape([5,5])nd12[1:3,1:3]#截取一个多维数组中，数值在一个值域之内的数据nd12[(nd12&gt;3)&amp;(nd12&lt;10)]#截取多维数组中，指定的行,如读取第2,3行nd12[[1,2]] #或nd12[1:3,:]##截取多维数组中，指定的列,如读取第2,3列nd12[:,1:3]</pre><p>如果你对上面这些获取方式还不是很清楚，没关系，下面我们通过图形的方式说明如何获取多维数组中的元素，如图1-1所示，左边为表达式，右边为对应获取元素。</p><div class=pgc-img><img alt=入门Python必备：一文看懂NumPy基础操作 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b39bdde693d542ec9919bc17db0014ca><p class=pgc-img-caption>▲图1-1 获取多维数组中的元素</p></div><p>获取数组中的部分元素除通过指定索引标签外，还可以使用一些函数来实现，如通过random.choice函数从指定的样本中进行随机抽取数据。</p><pre>import numpy as npfrom numpy import random as nra=np.arange(1,25,dtype=float)c1=nr.choice(a,size=(3,4)) #size指定输出数组形状c2=nr.choice(a,size=(3,4),replace=False) #replace缺省为True，即可重复抽取#下式中参数p指定每个元素对应的抽取概率，默认为每个元素被抽取的概率相同c3=nr.choice(a,size=(3,4),p=a / np.sum(a)) print("随机可重复抽取")print(c1)print("随机但不重复抽取")print(c2)print("随机但按制度概率抽取")print(c3)</pre><p>打印结果：</p><pre>随机可重复抽取[[ 7. 22. 19. 21.] [ 7. 5. 5. 5.] [ 7. 9. 22. 12.]]随机但不重复抽取[[ 21. 9. 15. 4.] [ 23. 2. 3. 7.] [ 13. 5. 6. 1.]]随机但按制度概率抽取[[ 15. 19. 24. 8.] [ 5. 22. 5. 14.] [ 3. 22. 13. 17.]]</pre><h1><strong>03 矩阵操作</strong></h1><p>深度学习中经常涉及多维数组或矩阵的运算，正好NumPy模块提供了许多相关的计算方法，下面介绍一些常用的方法。</p><pre>import numpy as npnd14=np.arange(9).reshape([3,3])#矩阵转置np.transpose(nd14)#矩阵乘法运算a=np.arange(12).reshape([3,4])b=np.arange(8).reshape([4,2])a.dot(b)#求矩阵的迹a.trace()#计算矩阵行列式np.linalg.det(nd14)#计算逆矩阵c=np.random.random([3,3])np.linalg.solve(c,np.eye(3))</pre><p>上面介绍的几种方法是numpy.linalg模块中的函数，numpy.linalg模块中的函数是满足行业标准级的Fortran库。</p><p>numpy.linalg中常用函数：</p><ul><li>diag：以一维数组方式返回方阵的对角线元素</li><li>dot：矩阵乘法</li><li>trace：求迹，即计算对角线元素的和</li><li>det：计算矩阵列式</li><li>eig：计算方阵的本征值和本征向量</li><li>inv：计算方阵的逆</li><li>qr：计算qr分解</li><li>svd：计算奇异值分解svd</li><li>solve：解线性方程组Ax = b，其中A为方阵</li><li>lstsq：计算Ax=b的最小二乘解</li></ul><h1><strong>04 数据合并与展平</strong></h1><p>在机器学习或深度学习中，会经常遇到需要把多个向量或矩阵按某轴方向进行合并的情况，也会遇到展平的情况，如在卷积或循环神经网络中，在全连接层之前，需要把矩阵展平。这节介绍几种数据合并和展平的方法。</p><p><strong>1. 合并一维数组</strong></p><pre>import numpy as npa=np.array([1,2,3])b=np.array([4,5,6])c=np.append(a,b)print(c)#或利用concatenated=np.concatenate([a,b])print(d)</pre><p>打印结果：</p><pre>[1 2 3 4 5 6][1 2 3 4 5 6]</pre><p><strong>2. 多维数组的合并</strong></p><pre>import numpy as npa=np.arange(4).reshape(2,2)b=np.arange(4).reshape(2,2)#按行合并c=np.append(a,b,axis=0)print(c)print("合并后数据维度",c.shape)#按列合并d=np.append(a,b,axis=1)print("按列合并结果:")print(d)print("合并后数据维度",d.shape)</pre><p>打印结果：</p><pre>[[0 1] [2 3] [0 1] [2 3]]合并后数据维度 (4, 2)按列合并结果:[[0 1 0 1] [2 3 2 3]]合并后数据维度 (2, 4) </pre><p><strong>3. 矩阵展平</strong></p><pre>import numpy as npnd15=np.arange(6).reshape(2,-1)print(nd15)#按照列优先，展平。print("按列优先,展平")print(nd15.ravel('F'))#按照行优先，展平。print("按行优先,展平")print(nd15.ravel())</pre><p>打印结果：</p><pre>[[0 1 2] [3 4 5]]按列优先,展平[0 3 1 4 2 5]按行优先,展平[0 1 2 3 4 5]</pre><h1><strong>05 通用函数</strong></h1><p>NumPy提供了两种基本的对象，即ndarray和ufunc对象。前面我们对ndarray做了简单介绍，本节将介绍它的另一个对象ufunc。</p><p>ufunc(通用函数)是universal function的缩写，它是一种能对数组的每个元素进行操作的函数。许多ufunc函数都是在C语言级别实现的，因此它们的计算速度非常快。</p><p>此外，功能比math模块中的函数更灵活。math模块的输入一般是标量，但NumPy中的函数可以是向量或矩阵，而利用向量或矩阵可以避免循环语句，这点在机器学习、深度学习中经常使用。以下为NumPy中的常用几个通用函数：</p><ul><li>sqrt：计算序列化数据的平方根</li><li>sin,cos：三角函数</li><li>abs：计算序列化数据的绝对值</li><li>dot：矩阵运算</li><li>log,log10,log2：对数函数</li><li>exp：指数函数</li><li>cumsum,cumproduct：累计求和，求积</li><li>sum：对一个序列化数据进行求和</li><li>mean：计算均值</li><li>median：计算中位数</li><li>std：计算标准差</li><li>var：计算方差</li><li>corrcoef：计算相关系数</li></ul><p><strong>1. 使用math与numpy函数性能比较</strong></p><pre>import timeimport mathimport numpy as npx = [i * 0.001 for i in np.arange(1000000)]start = time.clock()for i, t in enumerate(x): x[i] = math.sin(t)print ("math.sin:", time.clock() - start )x = [i * 0.001 for i in np.arange(1000000)]x = np.array(x)start = time.clock()np.sin(x)print ("numpy.sin:", time.clock() - start )</pre><p>打印结果：</p><pre>math.sin: 0.5169950000000005numpy.sin: 0.05381199999999886</pre><p>由此可见，numpy.sin比math.sin快近10倍。</p><p><strong>2. 使用循环与向量运算比较</strong></p><p>充分使用Python的NumPy库中的内建函数（built-in function），实现计算的向量化，可大大提高运行速度。NumPy库中的内建函数使用了SIMD指令。例如下面所示在Python中使用向量化要比使用循环计算速度快得多。</p><pre>import timeimport numpy as npx1 = np.random.rand(1000000)x2 = np.random.rand(1000000)##使用循环计算向量点积tic = time.process_time()dot = 0for i in range(len(x1)): dot+= x1[i]*x2[i]toc = time.process_time()print ("dot = " + str(dot) + "\n for loop----- Computation time = " + str(1000*(toc - tic)) + "ms")##使用numpy函数求点积tic = time.process_time()dot = 0dot = np.dot(x1,x2)toc = time.process_time()print ("dot = " + str(dot) + "\n verctor version---- Computation time = " + str(1000*(toc - tic)) + "ms")</pre><p>打印结果：</p><pre>dot = 250215.601995 for loop----- Computation time = 798.3389819999998msdot = 250215.601995 verctor version---- Computation time = 1.885051999999554ms</pre><p>从程序运行结果上来看，该例子使用for循环的运行时间是使用向量运算的运行时间的约400倍。因此，深度学习算法中，一般都使用向量化矩阵运算。</p><h1><strong>06 广播机制</strong></h1><p>广播机制（Broadcasting）的功能是为了方便不同shape的数组（NumPy库的核心数据结构）进行数学运算。广播提供了一种向量化数组操作的方法，以便在C中而不是在Python中进行循环，这通常会带来更高效的算法实现。广播的兼容原则为：</p><ul><li>对齐尾部维度。</li><li>shape相等or其中shape元素中有一个为1。</li></ul><p>以下通过实例来具体说明。</p><pre>import numpy as npa=np.arange(10)b=np.arange(10)#两个shape相同的数组相加print(a+b)#一个数组与标量相加print(a+3)#两个向量相乘print(a*b)#多维数组之间的运算c=np.arange(10).reshape([5,2])d=np.arange(2).reshape([1,2])#首先将d数组进行复制扩充为[5,2],如何复制请参考图1-2，然后相加。print(c+d)</pre><p class=ql-align-center><br></p><div class=pgc-img><img alt=入门Python必备：一文看懂NumPy基础操作 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/ab0f44abb7064287a989263380cc2842><p class=pgc-img-caption>▲图1-2 NumPy多维数组相加</p></div><p>打印结果：</p><pre>[ 0 2 4 6 8 10 12 14 16 18][ 3 4 5 6 7 8 9 10 11 12][ 0 1 4 9 16 25 36 49 64 81][[ 0 2] [ 2 4] [ 4 6] [ 6 8] [ 8 10]]</pre><p>有时为了保证矩阵运算正确，我们可以使用reshape()函数来变更矩阵的维度。</p><h1><strong>07 小结</strong></h1><p>阅读完本文，你已get到如下技能：</p><p>√ 如何生成NumPy的ndarray的几种方式。</p><p>√ 如何存取元素。</p><p>√ 如何操作矩阵。</p><p>√ 如何合并或拆分数据。</p><p>√ NumPy的通用函数。</p><p>√ NumPy的广播机制。</p><blockquote><p>如果想进一步了解NumPy，大家可参考：</p><p>http://www.numpy.org/</p></blockquote><blockquote><p>关于作者：吴茂贵，BI和大数据专家，就职于中国外汇交易中心，在BI、数据挖掘与分析、数据仓库、机器学习等领域有超过20年的工作经验，在Spark机器学习、TensorFlow深度学习领域大量的实践经验。</p><p>王冬，任职于博世（中国）投资有限公司，负责Bosch企业BI及工业4.0相关大数据和数据挖掘项目。对机器学习、人工智能有多年实践经验。</p><p>李涛，参与过多个人工智能项目，如研究开发服务机器人、无人售后店等项目。熟悉python、caffe、TensorFlow等，对深度学习、尤其对计算机视觉方面有较深理解。</p><p>杨本法，高级算法工程师，在机器学习、文本挖掘、可视化等领域有多年实践经验。熟悉Hadoop、Spark生态圈的相关技术，对Python有丰富的实战经验。</p></blockquote><p>本文摘编自《Python深度学习：基于TensorFlow》，经出版方授权发布。</p><div class=pgc-img><img alt=入门Python必备：一文看懂NumPy基础操作 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/3265d263a5cd48418f68e5f9d6e2519d><p class=pgc-img-caption>延伸阅读《Python深度学习：基于TensorFlow》</p></div><p><strong>推荐语：</strong>从Python和数学，到机器学习和TensorFlow，再到深度学习的应用和扩展，为深度学习提供全栈解决方案。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'入门','Python','必备'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>