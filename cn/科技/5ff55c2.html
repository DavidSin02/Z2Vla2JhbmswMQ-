<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>å†™ä¸€ä¸ªjavaå·¥å…·ä»æ•°æ®åº“ç”Ÿæˆå®ä½“ç±» | æå®¢å¿«è¨Š</title><meta property="og:title" content="å†™ä¸€ä¸ªjavaå·¥å…·ä»æ•°æ®åº“ç”Ÿæˆå®ä½“ç±» - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ff55c2.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ff55c2.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5ff55c2.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ff55c2.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ff55c2.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5ff55c2.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5ff55c2.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ff55c2.html><meta property="article:published_time" content="2020-10-29T20:59:31+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:31+08:00"><meta name=Keywords content><meta name=description content="å†™ä¸€ä¸ªjavaå·¥å…·ä»æ•°æ®åº“ç”Ÿæˆå®ä½“ç±»"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/5ff55c2.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>å†™ä¸€ä¸ªjavaå·¥å…·ä»æ•°æ®åº“ç”Ÿæˆå®ä½“ç±»</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><p><strong>å¼€å§‹å†™ä¹‹å‰çš„è¯´æ˜</strong></p><p>â€‹ è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„è§£ææ•°æ®åº“å»ºè¡¨è¯­å¥ä¹‹åï¼Œæ ¹æ®è§£æç»“æœç”Ÿæˆjavaæ–‡ä»¶çš„ä¸€ä¸ªç®€å•å·¥å…·ã€‚å†™çš„åŸå› æœ‰ä¸¤ä¸ªã€‚</p><p>â€‹ 1ï¼šé¡¹ç›®ä¸­æ²¡æœ‰äººå†™å®ä½“ç±»çš„æ³¨é‡Šï¼Œå­—æ®µçš„æ³¨é‡Šï¼Œç°æœ‰çš„å·¥å…·ä¹Ÿæ²¡æ³•æ ¹æ®æ•°æ®åº“çš„æ³¨é‡Šè‡ªåŠ¨æ·»åŠ åˆ°classæ–‡ä»¶ä¸Šã€‚</p><p>â€‹ 2ï¼šè‡ªå·±å†™ä¸€ä¸ªä¹Ÿä¼¼ä¹ä¸æ˜¯å¾ˆéš¾ã€‚</p><p>â€‹ æ‰€ä»¥å°±è‡ªå·±å†™äº†ä¸€ä¸ªã€‚</p><p>è¿™é‡Œåœ¨ç”Ÿæˆjavaæ–‡ä»¶çš„æ—¶å€™ç”¨çš„æ˜¯<strong>freemarker</strong>ã€‚ç”¨äº†<strong>jdbc</strong>ä½œä¸ºæ‰§è¡Œsqlçš„å·¥å…·ã€‚</p><p>è¿™ä¸ªé¡¹ç›®å·²ç»æ”¾åœ¨githubä¸Šäº†ï¼Œåœ°å€ï¼šhttps://github.com/hjx601496320/entityMaker ã€‚</p><p><strong>ç”¨åˆ°çš„ä¾èµ–ï¼š</strong></p><pre>&lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.freemarker&lt;/groupId&gt; &lt;artifactId&gt;freemarker&lt;/artifactId&gt; &lt;version&gt;2.3.28&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.45&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.mchange&lt;/groupId&gt; &lt;artifactId&gt;c3p0&lt;/artifactId&gt; &lt;version&gt;0.9.5.2&lt;/version&gt;&lt;/dependency&gt;</pre><p><strong>è·å–æ•°æ®åº“ä¸­çš„æ‰€æœ‰çš„è¡¨åç§°</strong></p><p>æƒ³è¦æ ¹æ®æ•°æ®åº“ä¸­çš„å»ºè¡¨è¯­å¥æ¥åˆ›å»ºjavaæ–‡ä»¶é¦–å…ˆè¦å…ˆçŸ¥é“æ•°æ®åº“ä¸­éƒ½æœ‰é‚£äº›è¡¨ã€‚soï¼Œå¼€å§‹ã€‚</p><p><strong>é…ç½®æ•°æ®åº“çš„ç›¸å…³ä¿¡æ¯</strong></p><p>åœ¨è·å–æ•°æ®åº“é“¾æ¥å‰ï¼Œæˆ‘ä»¬å…ˆå†™ä¸€ä¸ªæ–‡ä»¶ç”¨æ¥ä¿å­˜æ•°æ®åº“é“¾æ¥çš„å„ç§ä¿¡æ¯ã€‚</p><p>æ–°å»ºæ–‡ä»¶<strong>config.xml</strong></p><pre>&lt;xml&gt; &lt;jdbc.url&gt;&lt;/jdbc.url&gt; &lt;jdbc.username&gt;&lt;/jdbc.username&gt; &lt;jdbc.password&gt;&lt;/jdbc.password&gt;&lt;/xml&gt;</pre><p><strong>jdbc.url</strong>ï¼šé“¾æ¥æ•°æ®åº“çš„urlã€‚ä¾‹å¦‚ï¼šjdbc:mysql://127.0.0.1:3306/demo?useSSL=true</p><p><strong>jdbc.username</strong>ï¼šæ•°æ®åº“çš„ç”¨æˆ·åã€‚</p><p><strong>jdbc.password</strong>ï¼šæ•°æ®åº“çš„å¯†ç ã€‚</p><p>è¿™æ ·å°±é…ç½®å¥½äº†ã€‚</p><p><strong>å†™ä¸€ä¸ªå·¥å…·ç±»è¯»å–xmlï¼šXmlUtils.java</strong></p><pre>import org.w3c.dom.Document;import javax.xml.parsers.DocumentBuilder;import javax.xml.parsers.DocumentBuilderFactory;import java.io.ByteArrayInputStream;import java.io.InputStream;import java.util.Scanner;/** * è¯»å–xml */public class XmlUtils { /** * è¯»å– Document * * @param xmlPath * @return */ public static Document getConfigDocument(String xmlPath) { try { InputStream resourceAsStream = Thread.currentThread().getContextClassLoader().getResourceAsStream(xmlPath); Scanner scanner = new Scanner(resourceAsStream); StringBuilder stringBuilder = new StringBuilder(); while (scanner.hasNextLine()) { stringBuilder.append(scanner.nextLine()).append("\n"); } DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance(); DocumentBuilder documentBuilde = documentBuilderFactory.newDocumentBuilder(); Document document = documentBuilde.parse(new ByteArrayInputStream(stringBuilder.toString().getBytes())); return document; } catch (Exception e) { e.printStackTrace(); return null; } }}</pre><p><strong>æ‰“å¼€æ•°æ®åº“é“¾æ¥</strong></p><pre>//è·å–æ•°æ®åº“é…ç½®ä¿¡æ¯Document configXml = XmlUtils.getConfigDocument(CONFIG_PATH);Element element = configXml.getDocumentElement();String jdbcUrl = element.getElementsByTagName("jdbc.url").item(0).getTextContent();String username = element.getElementsByTagName("jdbc.username").item(0).getTextContent();String password = element.getElementsByTagName("jdbc.password").item(0).getTextContent();//æ‰“å¼€æ•°æ®åº“é“¾æ¥Connection conn = (Connection) DriverManager.getConnection(jdbcUrl, username, password);</pre><p>è·å–åˆ°é“¾æ¥ä¹‹åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è¦è¯»å–æ•°æ®åº“ä¸­çš„è¡¨æ•°æ®äº†ã€‚</p><p><strong>è·å–æ•°æ®åº“ä¸­çš„è¡¨</strong></p><pre>Statement statement = connection.createStatement();ResultSet resultSet = statement.executeQuery("SHOW TABLES;");while (resultSet.next()) { //è¿™é‡Œå°±è·å–åˆ°äº†æ•°æ®åº“ä¸­çš„æ‰€æœ‰çš„è¡¨çš„åç§°äº†ã€‚ String tableName = resultSet.getString(1);}</pre><p>è¿™é‡Œæ‹¿åˆ°è¡¨åç§°åå°±å¯ä»¥ä¾æ¬¡å¾—åˆ°å»ºè¡¨è¯­å¥ï¼Œå¹¶è§£æå»ºè¡¨è¯­å¥äº†ã€‚</p><p>è¿™é‡Œä¹‹æ‰€ä»¥ä½¿ç”¨è§£æå»ºè¡¨è¯­å¥çš„æ–¹æ³•æ˜¯å› ä¸ºè¿™æ ·å¯ä»¥æ¯”è¾ƒå®Œæ•´çš„å¾—åˆ°æ³¨é‡Šä¿¡æ¯ã€‚ç”¨å¦ä¸€ç§æ–¹æ³•çš„æ—¶å€™è¡¨çš„æ³¨é‡Šä¸€ç›´è·å–ä¸åˆ°ï¼ˆå¦ä¸€ç§æ–¹æ³•æˆ‘å¿˜è®°æ€ä¹ˆè¯´äº†ï½ï¼‰ã€‚</p><p><strong>å¾—åˆ°å»ºè¡¨è¯­å¥</strong></p><p>è¿™é‡Œå°±æ˜¯æ‹¼æ¥sqlï¼Œç„¶åæ‰§è¡Œå°±å¥½äº†ã€‚ä¸‹é¢æ˜¯ä»£ç ï¼š</p><pre>Statement statement = connection.createStatement();ResultSet resultSet = statement.executeQuery("show CREATE TABLE è¡¨åç§°");while (resultSet.next()) { //è¿™é‡Œå°±å¾—åˆ°äº†è¡¨çš„å»ºè¡¨è¯­å¥ String createTableSql = resultSet.getString(2);}</pre><p>åšåˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±å®Œæ•´çš„å¾—åˆ°äº†æ•°æ®åº“ä¸­çš„æ‰€æœ‰çš„å»ºè¡¨è¯­å¥äº†ã€‚æ¥ä¸‹æ¥å°±æ˜¯è¦åˆ†æå»ºè¡¨è¯­å¥å¹¶ä¸”ç”¨æ¥ç”Ÿæˆå®ä½“ç±»äº†ã€‚</p><p><strong>å»ºè¡¨è¯­å¥åˆ†æ</strong></p><p><strong>å»ºè¡¨sql</strong></p><p>ä¸‹é¢æ˜¯æ‰§è¡Œ sql <strong>show create table user</strong> çš„ç»“æœï¼š</p><pre>CREATE TABLE `user` (  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·id',  `name` varchar(225) DEFAULT NULL COMMENT 'ç”¨æˆ·å',  `create_date` datetime DEFAULT NULL,  `status` int(11) DEFAULT NULL,  `age` int(11) DEFAULT NULL COMMENT 'å¹´é¾„',  `mark` varchar(225) DEFAULT NULL,  PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=2104778081 DEFAULT CHARSET=latin1 COMMENT='ç”¨æˆ·è¡¨' </pre><p>è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œè¦åˆ›å»ºçš„å®ä½“ç±»çš„åç§°å°±åœ¨ç¬¬ä¸€è¡Œçš„<strong>CREATE TABLE</strong> åçš„ä¸¤ä¸ª<strong>`</strong>ç¬¦å·ä¸­é—´ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ­£åˆ™å°†è¡¨çš„åç§°å–å‡ºæ¥ï¼Œç„¶åè½¬æ¢æˆä¸ºæˆ‘ä»¬éœ€è¦çš„classåç§°ã€‚é¦–å…ˆæˆ‘ä»¬å…ˆå†™ä¸€ä¸ªé€šè¿‡æ­£åˆ™æå–æ•°æ®çš„æ–¹æ³•ï¼Œä¸‹é¢æ˜¯ä»£ç ï¼š</p><p><strong>æ­£åˆ™ä»£ç </strong></p><pre> /** * æ ¹æ®æ­£åˆ™æŸ¥æ‰¾ * * @param sql * @param pattern * @param group * @return */ static String getByPattern(String sql, String pattern, int group) { Pattern compile = Pattern.compile(pattern); Matcher matcher = compile.matcher(sql); while (matcher.find()) { return matcher.group(group); } return null; }</pre><p>ç°åœ¨å¼€å§‹ä»å»ºè¡¨è¯­å¥ä¸­æå–tableçš„åç§°ï¼ˆè™½ç„¶åœ¨è·å¾—æ•°æ®åº“æ‰€æœ‰è¡¨çš„æ—¶å€™å°±å·²ç»çŸ¥é“äº†ï¼Œä½†æ˜¯åœ¨å†™ä¸€æ¬¡ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ä¸æ˜¯å— ~~~ï¼‰ï¼Œä¸‹é¢æ˜¯ä»£ç ï¼š</p><p><strong>è·å–è¡¨çš„åç§°</strong></p><pre> /** * è·å¾—è¡¨çš„åç§° * * @param sql * @return */ public static String getTableName(String sql) { return getByPattern(sql, "CREATE TABLE `(.*)`", 1); }</pre><p>è¿™é‡Œå°±å·²ç»å°†è¡¨çš„åç§°å–å‡ºæ¥äº†ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯è·å–è¡¨ä¸Šçš„æ³¨é‡Šï¼Œè¿™é‡Œæˆ‘ä»¬å–è¡¨çš„æ³¨é‡Šã€‚ä¸‹é¢æ˜¯ä»£ç ï¼š</p><p><strong>æå–è¡¨æ³¨é‡Š</strong></p><pre> public static String getTableComment(String sql) { return getByPattern(sql, "\\) .* COMMENT='(.*)'", 1); }</pre><p>ç°åœ¨å¼€å§‹è·å–idä¿¡æ¯ã€‚</p><p><strong>è·å–id</strong></p><p>è·å–idä¾ç„¶æ˜¯ä½¿ç”¨æ­£åˆ™å°±å¥½äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre>public static String getId(String sql) { return getByPattern(sql, "PRIMARY KEY \\(`(.*)`\\)", 1);}</pre><p>å› ä¸ºåŸæœ¬è¯­å¥ä¸­æœ‰ä¸€å¯¹æ‹¬å·ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå¯¹å¤–é¢çš„æ‹¬å·åšäº†è½¬ä¹‰å¤„ç†ã€‚æ¥ä¸‹æ¥å¼€å§‹æå–æ•°æ®åº“ä¸­çš„å­—æ®µï¼Œå­—æ®µç±»å‹ï¼Œå­—æ®µæ³¨é‡Šã€‚</p><p><strong>å­—æ®µï¼Œå­—æ®µç±»å‹ï¼Œå­—æ®µæ³¨é‡Š</strong></p><p><strong>å…ˆå–å‡ºæ¥å»ºè¡¨è¯­å¥ä¸­çš„å’Œå­—æ®µç›¸å…³çš„sql</strong></p><p>2019å¹´01æœˆ21æ—¥ï¼Œä¿®æ”¹ï¼š</p><p>æ²¡æƒ³åˆ°æœ‰çš„è¡¨é‡Œæ²¡æœ‰idï¼Œå°±å¯¼è‡´ä¸‹é¢çš„ä»£ç æ‰§è¡Œåå‡ºé”™äº†ï¼Œä¿®æ”¹ä¸€ä¸‹ç»“æŸçš„åˆ¤æ–­ã€‚</p><pre> /** * è·å–å»ºè¡¨è¯­å¥ä¸­å’Œå­—æ®µç›¸å…³çš„sql * * @param sql * @return */ public static List&lt;String&gt; getColumnSqls(String sql) { List&lt;String&gt; lines = new ArrayList&lt;&gt;(); Scanner scanner = new Scanner(sql); boolean start = false; while (scanner.hasNextLine()) { String nextLine = scanner.nextLine(); if (nextLine.indexOf("CREATE TABLE") != -1) { start = true; continue; } //æ²¡æƒ³åˆ°æœ‰çš„è¡¨æ²¡æœ‰id /(ã„’oã„’)/~~ if (nextLine.indexOf("PRIMARY KEY") != -1 || nextLine.indexOf("ENGINE=") != -1) { start = false; continue; } if (start) { lines.add(nextLine); } } return lines; }</pre><p>è¿™é‡Œçš„è¿è¡Œç»“æœæ˜¯ï¼š</p><pre> `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·id',  `name` varchar(225) DEFAULT NULL COMMENT 'ç”¨æˆ·å',  `create_date` datetime DEFAULT NULL,  `status` int(11) DEFAULT NULL,  `age` int(11) DEFAULT NULL COMMENT 'å¹´é¾„',  `mark` varchar(225) DEFAULT NULL, </pre><p>è¿™ä¹Ÿå°±å–åˆ°äº†tableä¸­æ‰€æœ‰çš„å­—æ®µç›¸å…³ä¿¡æ¯äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥è·å–å­—æ®µåç§°ï¼š</p><p><strong>è·å–åˆ—åï¼Œæ³¨é‡Šï¼Œæ•°æ®ç±»å‹</strong></p><pre>List&lt;String&gt; columns = SqlUtils.getColumnSqls(sql);for (String oneLine : columns) { System.out.println(oneLine); String columnName = SqlUtils.getByPattern(oneLine, "`(.*)`", 1); String comment = SqlUtils.getByPattern(oneLine, "COMMENT '(.*)'", 1); String columnType = SqlUtils.getByPattern(oneLine, "`" + columnName + "` ([A-Za-z]*)", 1); System.out.printf("åç§°ï¼š%-20s ç±»å‹ï¼š%-20s æ³¨é‡Šï¼š%-20s \n", columnName, columnType, comment);}</pre><p>è¾“å‡ºç»“æœï¼š</p><pre> `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·id', åç§°ï¼šid ç±»å‹ï¼šint æ³¨é‡Šï¼šç”¨æˆ·id  `name` varchar(225) DEFAULT NULL COMMENT 'ç”¨æˆ·å', åç§°ï¼šname ç±»å‹ï¼švarchar æ³¨é‡Šï¼šç”¨æˆ·å  `create_date` datetime DEFAULT NULL, åç§°ï¼šcreate_date ç±»å‹ï¼šdatetime æ³¨é‡Šï¼šnull  `status` int(11) DEFAULT NULL, åç§°ï¼šstatus ç±»å‹ï¼šint æ³¨é‡Šï¼šnull  `age` int(11) DEFAULT NULL COMMENT 'å¹´é¾„', åç§°ï¼šage ç±»å‹ï¼šint æ³¨é‡Šï¼šå¹´é¾„  `mark` varchar(225) DEFAULT NULL, åç§°ï¼šmark ç±»å‹ï¼švarchar æ³¨é‡Šï¼šnull</pre><p>åˆ°äº†è¿™ï¼Œæˆ‘å°±å°±å·²ç»ä»å»ºè¡¨è¯­å¥é‡Œæ‹¿åˆ°äº†æ‰€æœ‰éœ€è¦çš„æ•°æ®äº†ï¼Œä¸‹é¢å°±å¼€å§‹ä½¿ç”¨è¿™äº›æ•°æ®æ¥ç”Ÿæˆjavaæ–‡ä»¶äº†ã€‚</p><p><strong>æ ¹æ®ä¸Šé¢è·å–çš„æ•°æ®å¼€å§‹åˆ›å»ºjavaæ–‡ä»¶</strong></p><p>ç»ˆäºå¼€å§‹è¦åˆ›å»ºjavaæ–‡ä»¶äº†ã€‚</p><p>ä½†æ˜¯ï½åœ¨åˆ›å»ºjavaæ–‡ä»¶çš„æ—¶å€™è¦å…ˆå§ä¹‹å‰è·å–çš„æ•°ç¨å¾®å¤„ç†ä¸€ä¸‹ï¼Œå°†sqlä¸­çš„æ ¼å¼è½¬æ¢ä¸ºjavaä¸­çš„æ ¼å¼ã€‚æ¯”å¦‚å±æ€§åç§°ï¼Œæ•°æ®ç±»å‹ï¼Œclassåç§°ä¹‹ç±»çš„ï¼Œç°åœ¨å¼€å§‹ï½</p><p><strong>å°†è¡¨åç§°è½¬æ¢ä¸ºåˆé€‚çš„classåç§°</strong></p><p>å°±æ˜¯é¦–å­—æ¯å¤§å†™ï¼Œé©¼å³°å¼çš„å‘½åè§„èŒƒã€‚ä¾‹å¦‚å°†<strong>user_log</strong>æˆ–è€…<strong>USER_LOG</strong>è½¬æ¢ä¸ºUserLogã€‚</p><p>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><pre> /** * ç±»åç§°è½¬æ¢ * * @param tableName * @return */ public static String entityName(String tableName) { String lowerCaseName = tableName.toLowerCase(); StringBuilder newName = new StringBuilder(); char[] chars = lowerCaseName.toCharArray(); boolean change = false; for (int i = 0; i &lt; chars.length; i++) { char aChar = chars[i]; if (aChar == '_' &amp;&amp; !change) { change = true; continue; } //é¦–å­—æ¯å¤§å†™ if (i == 0) { aChar = Character.toUpperCase(aChar); } if (change) { aChar = Character.toUpperCase(aChar); change = false; } newName.append(aChar); } return newName.toString(); }</pre><p>è¿™æ ·å°±å¾—åˆ°äº†æˆ‘ä»¬éœ€è¦çš„classçš„åç§°äº†ã€‚</p><p><strong>å°†å­—æ®µåç§°è½¬æ¢ä¸ºjavaä¸­çš„å±æ€§åç§°</strong></p><p>è¿™é‡Œå°±æ˜¯å°†ä¸Šä¸€æ­¥æ“ä½œçš„é¦–å­—æ¯å¤§å†™å»æ‰å°±å¥½äº†ï¼Œä¸‹é¢æ˜¯ä»£ç ï¼š</p><pre> /** * å±æ€§åç§°è½¬æ¢ * * @param name * @return */ public static String fieldName(String name) { name = name.toLowerCase(); StringBuilder newName = new StringBuilder(); char[] chars = name.toCharArray(); boolean change = false; for (int i = 0; i &lt; chars.length; i++) { char aChar = chars[i]; if (aChar == '_' &amp;&amp; !change) { change = true; continue; } if (change) { aChar = Character.toUpperCase(aChar); change = false; } newName.append(aChar); } return newName.toString(); }</pre><p>æ¥ä¸‹æ¥æ˜¯å°†sqlä¸­çš„æ•°æ®ç±»å‹è½¬æ¢ä¸ºjavaä¸­çš„æ•°æ®ç±»å‹ã€‚</p><p><strong>sqlæ•°æ®ç±»å‹è½¬æ¢</strong></p><p>è¿™é‡Œç”¨mapåšäº†ä¸€ä¸ªæ˜ å°„ï¼Œæœ‰è‡ªå·±ç‰¹å®šè¦æ±‚çš„å¯ä»¥è‡ªå·±ä¿®æ”¹ã€‚</p><pre>public class ColumnFieldTypeMapping { private Map&lt;String, Class&gt; sqlFieldTypeMapping = new HashMap&lt;&gt;(); { sqlFieldTypeMapping.put("VARCHAR", String.class); sqlFieldTypeMapping.put("CHAR", String.class); sqlFieldTypeMapping.put("TEXT", String.class); sqlFieldTypeMapping.put("MEDIUMTEXT", String.class); sqlFieldTypeMapping.put("LONGTEXT", String.class); sqlFieldTypeMapping.put("TINYTEXT", String.class); sqlFieldTypeMapping.put("BIT", Boolean.class); sqlFieldTypeMapping.put("INT", int.class); sqlFieldTypeMapping.put("BIGINT", long.class); sqlFieldTypeMapping.put("DOUBLE", double.class); sqlFieldTypeMapping.put("TINYINT", int.class); sqlFieldTypeMapping.put("FLOAT", float.class); sqlFieldTypeMapping.put("DECIMAL", BigDecimal.class); sqlFieldTypeMapping.put("INT UNSIGNED", int.class); sqlFieldTypeMapping.put("BIGINT UNSIGNED", int.class); sqlFieldTypeMapping.put("DECIMAL UNSIGNED", BigDecimal.class); sqlFieldTypeMapping.put("DATETIME", Date.class); sqlFieldTypeMapping.put("TIME", Date.class); sqlFieldTypeMapping.put("DATE", Date.class); sqlFieldTypeMapping.put("TIMESTAMP", Date.class); } /** * æ ¹æ®sqlæ•°æ®ç±»å‹è·å–Javaæ•°æ®ç±»å‹ * * @param columnType * @return */ public Class getFieldType(String columnType) { Class aClass = sqlFieldTypeMapping.get(columnType); if (aClass == null) { return sqlFieldTypeMapping.get(columnType.toUpperCase()); } return null; }}</pre><p>å†™åˆ°è¿™é‡Œï¼Œæ‰€æœ‰å‚ä¸ç”Ÿæˆjavaæ–‡ä»¶çš„ä¿¡æ¯å°±å·²ç»è·å–å®Œæˆäº†ã€‚</p><p>è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦æŠŠä»–ä»¬ç»„è£…èµ·æ¥ï¼Œç”¨æ¥æ”¾è¿›freemarkerä¸­æ¥è§£æå¹¶ç”Ÿæˆjavaæ–‡ä»¶ä¸­çš„å†…å®¹ã€‚</p><p><strong>ç»„è£…å‚æ•°</strong></p><p>è¿™é‡Œå¯èƒ½æˆ‘ä»¥åç”¨è¿™ä¸ªä»£ç å¹²åˆ«çš„äº‹æƒ…æ‰€ä»¥æˆ‘å»ºäº†ä¸¤ä¸ªç±»ï¼Œä¸€ä¸ªæ˜¯<strong>ClassModel.java</strong>ï¼Œä¸€ä¸ªæ˜¯<strong>EntityModel.java</strong>ã€‚</p><p>EntityModelç»§æ‰¿äº†ClassModelã€‚æˆ‘ä»¬ä¸»è¦ç”¨çš„æ˜¯<strong>EntityModel.java</strong>ã€‚ä¸‹é¢æ˜¯ä»£ç ï¼š</p><pre>import java.util.*;/** * ç”¨äºç”Ÿæˆjava Entityæ–‡ä»¶çš„ç±» */public class ClassModel { /** * java ä¸­ä¸éœ€è¦å¼•åŒ…çš„ç±»å‹ */ private static List&lt;Class&gt; baseClass = Arrays.asList( int.class, double.class, float.class, long.class, short.class, byte.class, char.class, boolean.class, String.class ); /** * ç±»æ³¨é‡Š */ private String classDoc; /** * ç±»å */ private String className; /** * ç±» åŒ…å */ private String packageName; /** * K:å±æ€§åç§° * V:å±æ€§ç±»å‹ */ private Map&lt;String, Class&gt; fields = new HashMap&lt;&gt;(); /** * å±æ€§çš„æ³¨é‡Š */ private Map&lt;String, String&gt; fieldDoc = new HashMap&lt;&gt;(); ; private List&lt;Class&gt; imports = new ArrayList&lt;&gt;(); /** * æ·»åŠ éœ€è¦å¯¼å…¥çš„åŒ… * * @param importClass */ public void addImport(Class importClass) { if (baseClass.indexOf(importClass) != -1) { return; } if (imports.indexOf(importClass) == -1) { imports.add(importClass); } } /** * æ·»åŠ å±æ€§ * * @param fieldName å±æ€§åç§° * @param fieldClass å±æ€§ç±»å‹ */ public void addfield(String fieldName, Class fieldClass) { if (!fields.containsKey(fieldName)) { fields.put(fieldName, fieldClass); } } /** * æ·»åŠ å±æ€§æ³¨é‡Š * * @param fieldName å±æ€§åç§° * @param fieldDoc å±æ€§æ³¨é‡Š */ public void addfieldDoc(String fieldName, String fieldDoc) { if (!this.fieldDoc.containsKey(fieldName)) { this.fieldDoc.put(fieldName, fieldDoc); } } public List&lt;Class&gt; getImports() { return imports; } public void setImports(List&lt;Class&gt; imports) { this.imports = imports; } public String getClassDoc() { return classDoc; } public void setClassDoc(String classDoc) { this.classDoc = classDoc; } public String getClassName() { return className; } public void setClassName(String className) { this.className = className; } public String getPackageName() { return packageName; } public void setPackageName(String packageName) { this.packageName = packageName; } public Map&lt;String, Class&gt; getFields() { return fields; } public void setFields(Map&lt;String, Class&gt; fields) { this.fields = fields; } public Map&lt;String, String&gt; getFieldDoc() { return fieldDoc; } public void setFieldDoc(Map&lt;String, String&gt; fieldDoc) { this.fieldDoc = fieldDoc; } @Override public String toString() { final StringBuilder sb = new StringBuilder("{"); sb.append(" \"classDoc\"=\"").append(classDoc).append('\"'); sb.append(", \"className\"=\"").append(className).append('\"'); sb.append(", \"packageName\"=\"").append(packageName).append('\"'); sb.append(", \"fields\"=").append(fields); sb.append(", \"fieldDoc\"=").append(fieldDoc); sb.append(", \"imports\"=").append(imports); sb.append('}'); return sb.toString(); }}import java.util.ArrayList;import java.util.HashMap;import java.util.List;import java.util.Map;/** * æ•°æ®åº“æ˜ å°„ */public class EntityModel extends ClassModel { /** * æ•°æ®åº“åç§° */ private String tableName; /** * æ•°æ®åº“ä¸­çš„Idå­—æ®µåç§° */ private List&lt;String&gt; idColumnNames = new ArrayList&lt;&gt;(); /** * ç±»å±æ€§åå¯¹åº”æ•°æ®åº“å­—æ®µæ˜ å°„ * key: class å±æ€§åç§° * valueï¼šæ•°æ®åº“å­—æ®µå */ private Map&lt;String, String&gt; fieldSqlName = new HashMap&lt;&gt;(); /** * æ·»åŠ class å±æ€§æ˜ å°„å’Œ æ•°æ®åº“ å­—æ®µæ˜ å°„ * * @param fieldName * @param sqlName */ public void addfieldSqlName(String fieldName, String sqlName) { if (!fieldSqlName.containsKey(fieldName)) { fieldSqlName.put(fieldName, sqlName); } } /** * æ·»åŠ idå­—æ®µå * * @param idColumnName */ public void addIdColumnName(String idColumnName) { idColumnNames.add(idColumnName); } public String getTableName() { return tableName; } public void setTableName(String tableName) { this.tableName = tableName; } public Map&lt;String, String&gt; getFieldSqlName() { return fieldSqlName; } public void setFieldSqlName(Map&lt;String, String&gt; fieldSqlName) { this.fieldSqlName = fieldSqlName; } public List&lt;String&gt; getIdColumnNames() { return idColumnNames; } public void setIdColumnNames(List&lt;String&gt; idColumnNames) { this.idColumnNames = idColumnNames; }}</pre><p>åœ¨è¿™é‡Œå°†ä»æ•°æ®åº“ä¸­å¾—åˆ°çš„æ•°æ®éƒ½ç»„è£…å¥½ï¼Œå°±å¯ä»¥ä½¿ç”¨freemarkeræ¥ç”ŸæˆJavaæ–‡ä»¶çš„å†…å®¹äº†ã€‚ä¸‹é¢æ˜¯ä»£ç ï¼š</p><pre>/** * æ ¹æ®å»ºè¡¨è¯­å¥ç»„è£…EntityModel * * @param createTableSql * @return */EntityModel makeModelBySql(String createTableSql) { Formatter formatter = new Formatter(); EntityModel model = new EntityModel(); String tableComment = SqlUtils.getTableComment(createTableSql); String tableName = SqlUtils.getTableName(createTableSql); String id = SqlUtils.getId(createTableSql); model.addIdColumnName(id); model.setClassName(NameConvert.entityName(tableName)); model.setTableName(tableName); //æ³¨é‡Šæ˜¯nullçš„æ—¶å€™ç”¨æ•°æ®åº“è¡¨åä½œä¸ºæ³¨é‡Š model.setClassDoc(tableComment == null ? tableName : tableComment); List&lt;String&gt; line = SqlUtils.getColumnSqls(createTableSql); for (String oneLine : line) { String columnName = SqlUtils.getByPattern(oneLine, "`(.*)`", 1); String comment = SqlUtils.getByPattern(oneLine, "COMMENT '(.*)'", 1); String columnType = SqlUtils.getByPattern(oneLine, "`" + columnName + "` ([A-Za-z]*)", 1); String fieldName = NameConvert.fieldName(columnName); Class fieldClass = columnFieldTypeMapping.getFieldType(columnType); if (fieldClass == null) { formatter.format("table:%s columnName:%s sqlç±»å‹:%s æ²¡æœ‰æ˜ å°„ç±»å‹", tableName, columnName, columnType); throw new UnsupportedOperationException(formatter.toString()); } model.addfield(fieldName, fieldClass); //å­—æ®µæ³¨é‡Šæ˜¯nullçš„æ—¶å€™ç”¨æ•°æ®åº“å­—æ®µåä½œä¸ºæ³¨é‡Š model.addfieldDoc(fieldName, comment == null ? columnName : comment); model.addfieldSqlName(fieldName, columnName); model.addImport(fieldClass); } return model;}</pre><p>è¿™æ ·ä¸€ä¸ªæˆ‘ä»¬éœ€è¦çš„å‚æ•°å°±ç»„è£…å¥½äº†ã€‚ç°åœ¨å¼€å§‹ç¼–å†™freemarkerç”¨çš„ä»£ç ã€‚</p><p><strong>freemarkerå·¥å…·ç±»</strong></p><p>ç”¨æ¥åŠ è½½freemarkeræ¨¡æ¿å’Œå¤„ç†æ¨¡æ¿ä¸­çš„å‚æ•°ã€‚<strong>FreeMarkerUtils.java</strong>,ä»£ç å¦‚ä¸‹ï¼š</p><pre>import freemarker.cache.StringTemplateLoader;import freemarker.template.Configuration;import freemarker.template.DefaultObjectWrapper;import freemarker.template.Template;import java.io.StringWriter;import java.io.Writer;import java.util.Locale;import java.util.Scanner;public class FreeMarkerUtils { /** * freemarkerå·¥å…·ï¼Œ * * @param subjectParams * @param templetPath * @return * @throws Exception */ public static String getJavaClass(Object subjectParams, String templetPath) throws Exception { StringTemplateLoader loader = new StringTemplateLoader(); Scanner scanner = new Scanner(Thread.currentThread().getContextClassLoader().getResourceAsStream(templetPath)); StringBuilder builder = new StringBuilder(); while (scanner.hasNext()) { builder.append(scanner.nextLine()).append("\n"); } String name = System.currentTimeMillis() + ""; loader.putTemplate(name, builder.toString()); //ç¬¬ä¸€æ­¥ï¼šå®ä¾‹åŒ–Freemarkerçš„é…ç½®ç±» Configuration conf = new Configuration(); conf.setObjectWrapper(new DefaultObjectWrapper()); conf.setLocale(Locale.CHINA); conf.setDefaultEncoding("utf-8"); conf.setTemplateLoader(loader); //å¤„ç†ç©ºå€¼ä¸ºç©ºå­—ç¬¦ä¸² conf.setClassicCompatible(true); Template template = conf.getTemplate(name); Writer out = new StringWriter(2048); template.process(subjectParams, out); String javaClass = out.toString(); return javaClass; }}</pre><p>ç°åœ¨æœ‰äº†å·¥å…·ç±»ä¹‹åï¼Œè¿˜ä¸èƒ½ç«‹å³å¼€å§‹ç”Ÿæˆjavaæ–‡ä»¶ï¼Œå› ä¸ºè¿˜è¦ç»§ç»­è®¾ç½®javaçš„packageå’Œç”Ÿæˆæ–‡ä»¶çš„è·¯å¾„ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¹‹å‰å†™çš„<strong>config.xml</strong></p><p><strong>ä¿®æ”¹config.xml</strong></p><pre>&lt;xml&gt; &lt;jdbc.url&gt;&lt;/jdbc.url&gt; &lt;jdbc.username&gt;&lt;/jdbc.username&gt; &lt;jdbc.password&gt;&lt;/jdbc.password&gt; &lt;basePath&gt;/home/hjx/work/demo/src/main/java&lt;/basePath&gt; &lt;entityPackage&gt;top.hejiaxuan.demo.entity&lt;/entityPackage&gt;&lt;/xml&gt;</pre><p>è¿™é‡Œæ·»åŠ äº†ä¸¤ä¸ªå‚æ•°ï¼š<strong>basePath</strong>å’Œ<strong>entityPackage</strong>ã€‚ä¸€ä¸ªæ˜¯è¦ç”Ÿæˆjavaçš„æ–‡ä»¶çš„è·¯å¾„ï¼Œä¸€ä¸ªæ˜¯javaæ–‡ä»¶çš„åŒ…åã€‚</p><p>ç„¶åæˆ‘ä»¬å†å†™ä¸€ä¸ªå†™å‡ºæ–‡ä»¶çš„å·¥å…·ç±»<strong>FileUtils.java</strong></p><p><strong>ç¼–å†™FileUtils.java</strong></p><pre>import java.io.*;public class FileUtils { /** * å†™å…¥æ–‡ä»¶ * * @param path æ–‡ä»¶è·¯å¾„ * @param content æ–‡ä»¶å†…å®¹ */ public static void write(String path, String content) { File file = new File(path); File parentFile = file.getParentFile(); try { if (!parentFile.exists()) { parentFile.mkdirs(); } if (!file.exists()) { file.createNewFile(); } FileWriter fileWriter = new FileWriter(file); fileWriter.write(content); fileWriter.close(); } catch (FileNotFoundException e) { e.printStackTrace(); } catch (IOException e) { e.printStackTrace(); } }}</pre><p>è¿™æ ·å°±ä¸‡äº‹å…·å¤‡ï¼Œå°±å·®ç”Ÿæˆæ–‡ä»¶å•¦ã€‚ä¸‹é¢å°±å¼€å§‹å•¦ï½ï½ï½</p><p><strong>å¼€å§‹ç”Ÿæˆjavaæ–‡ä»¶</strong></p><p>åœ¨ç”Ÿæˆæ–‡ä»¶å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŠŠ<strong>basePath</strong>ï¼Œ<strong>entityPackage</strong>ä»é…ç½®æ–‡ä»¶é‡Œå–å‡ºæ¥ï¼Œè¿™ä¸€æ­¥æˆ‘å°±ä¸å†™äº†ï½ï½</p><pre>static final String DOT = ".";static final String FILE_TYPE = ".java";static final String ENTITY_TEMPLET_PATH = "EntityTemp.ftl";/** * ç”¨äºç”Ÿæˆä¸€ä¸ªç±»æ–‡ä»¶ * * @param entityModel * @return */boolean makeOneClass(EntityModel entityModel) { entityModel.setPackageName(entityPackage); String filePath = basePath + "/" + entityPackage.replace(DOT, "/") + "/" + entityModel.getClassName() + FILE_TYPE; try { String javaClassString = FreeMarkerUtils.getJavaClass(entityModel, ENTITY_TEMPLET_PATH); FileUtils.write(filePath, javaClassString); return true; } catch (Exception e) { e.printStackTrace(); } return false;}</pre><p>å¥½å•¦ï½ï½ï½å¤§åŠŸå‘Šæˆã€‚</p><p><strong>é¢ï½ï½ï½</strong></p><p>å¥½åƒå°‘ç‚¹å•¥ï½ï½ï½</p><p>æ¨¡æ¿æ–‡ä»¶æ²¡æœ‰æ”¾å‡ºæ¥ï½ï½ï½</p><p>ç¼–å†™<strong>EntityTemp.ftl</strong></p><pre>package ${packageName};&lt;#--å¯¼å…¥çš„åŒ…--&gt;&lt;#list imports as import&gt;import ${import.name};&lt;/#list&gt;&lt;#--ç±»å--&gt;&lt;#if classDoc?length gt 0&gt;/** * ${classDoc} * @author hejiaxuan */&lt;/#if&gt;public class ${className} {&lt;#--å±æ€§åç§°--&gt;&lt;#list fields?keys as key&gt; &lt;#assign fieldDocStr = fieldDoc[key]&gt; &lt;#if fieldDocStr?length gt 0&gt; /**${fieldDocStr}*/ &lt;/#if&gt; &lt;#if idColumnNames?seq_contains(fieldSqlName[key])&gt; &lt;/#if&gt; private ${fields[key].simpleName} ${key};&lt;/#list&gt;&lt;#list fields?keys as key&gt; &lt;#assign fieldClass = fields[key].simpleName&gt;&lt;#--setter--&gt; public void set${key?cap_first}(${fieldClass} ${key}) { this.${key} = ${key}; }&lt;#--getter--&gt; public ${fieldClass} &lt;#if fieldClass="boolean"&gt;is&lt;#else&gt;get&lt;/#if&gt;${key?cap_first}() { return this.${key}; }&lt;/#list&gt; @Override public String toString() { final StringBuilder sb = new StringBuilder("[");&lt;#list fields?keys as key&gt; sb.append("${key}:").append(${key}).append("; ");&lt;/#list&gt; sb.append("]"); return sb.toString(); }}</pre></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'ä¸€ä¸ª','java','æ•°æ®åº“'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>