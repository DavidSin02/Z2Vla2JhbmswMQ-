<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>SpringBoot配置文件详解 | 极客快訊</title><meta property="og:title" content="SpringBoot配置文件详解 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/0a45e7ad17914e0e9efbef923ec8be39"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/62c273e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/62c273e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/62c273e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/62c273e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/62c273e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/62c273e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/62c273e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/62c273e.html><meta property="article:published_time" content="2020-10-29T20:59:54+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:54+08:00"><meta name=Keywords content><meta name=description content="SpringBoot配置文件详解"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/62c273e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>SpringBoot配置文件详解</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>前言</h1><p>约定 > 配置 > 编码</p><p>Spring Boot 对于开发人员最大的好处在于可以对 Spring 应用进行自动配置。在SpringBoot项目中，很多时候需要用到一些配置的信息，这些信息可能在测试环境和生产环境下会有不同的配置，针对这种情况，项目所需属性就需要灵活设置，尽可能地不要将这些配置在代码中写死，最好就是写到配置文件中，以便后面根据实际业务需求灵活修正。</p><h1 class=pgc-h-arrow-right>1、自动化配置</h1><p>Spring Boot会根据应用中声明的第三方依赖来自动配置 Spring 框架，而不需要进行显式的声明。比如当声明了对 HSQLDB 的依赖时，Spring Boot 会自动配置成使用 HSQLDB 进行数据库操作。</p><p>Spring Boot 推荐采用基于Java 注解的配置方式，而不是传统的 XML。只需在主配置Java类引@EnableAutoConfiguration”注解就可以启用自动配置。当然，根据目前SpringBoot版本的迭代更新，在多数情况下，我们只需注入@SpringBootApplication这个注解即可替代。</p><p>而且，Spring Boot 的自动配置功能是没有侵入性的，只是作为一种基本的默认实现。开发人员可以通过定义其他bean来替代自动配置所提供的功能。比如当应用中定义了自己的数据源bean时，自动配置所提供的 HSQLDB 就不会生效。这给予了开发人员很大的灵活性。既可以快速的创建一个可以立即运行的原型应用，又可以不断的修改和调整以适应应用开发在不同阶段的需要。可能在应用最开始的时候，嵌入式的内存数据库（如 HSQLDB）就足够了，在后期则需要换成MySQL数据库。Spring Boot 使得这样的切换变得很简单。</p><h1 class=pgc-h-arrow-right>2、外部化配置</h1><p>在应用中管理配置并不是一个容易的任务，尤其是在应用需要部署到多个环境中时。通常会需要为每个环境提供一个对应的属性文件，用来配置各自的数据库连接信息、服务器信息和第三方服务账号等。</p><p>通常的应用部署会包含开发、测试和生产等若干个环境，不同的环境之间的配置存在覆盖关系。测试环境中的配置会覆盖开发环境，而生产环境中的配置会覆盖测试环境。Spring 框架本身提供了多种的方式来管理配置属性文件，Spring 3.1 之前可以使用 PropertyPlaceholderConfigurer。Spring 3.1 引入了新的环境（Environment）和概要信息（Profile）API，是一种更加灵活的处理不同环境和配置文件的方式。不过 Spring 这些配置管理方式的问题在于选择太多，让开发人员无所适从。Spring Boot 提供了一种统一的方式来管理应用的配置，允许开发人员使用属性文件、YAML 文件、环境变量和命令行参数来定义优先级不同的配置值。<br>Spring Boot 所提供的配置优先级顺序比较复杂。按照优先级从高到低的顺序，具体的列表如下所示。</p><p>命令行参数。</p><ul><li>通过 System.getProperties() 获取的 Java 系统参数。</li><li>操作系统环境变量。</li><li>从 java:comp/env 得到的 JNDI 属性。</li><li>通过 RandomValuePropertySource 生成的“random.*”属性。</li><li>应用 Jar 文件之外的属性文件。</li><li>应用 Jar 文件内部的属性文件。</li><li>在应用配置 Java 类（包含“@Configuration”注解的 Java 类）中通过“@PropertySource”注解声明的属性文件。</li><li>通过“SpringApplication.setDefaultProperties”声明的默认属性。</li></ul><p>Spring Boot 的这个配置优先级看似复杂，其实是很合理的。比如命令行参数的优先级被设置为最高。这样的好处是可以在测试或生产环境中快速地修改配置参数值，而不需要重新打包和部署应用。</p><h1 class=pgc-h-arrow-right>2.1 配置文件</h1><p>举个栗子：</p><p>搭建一个最基础的SpringBoot工程。</p><div class=pgc-img><img alt=SpringBoot配置文件详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0a45e7ad17914e0e9efbef923ec8be39><p class=pgc-img-caption></p></div><p>如上边所示，Spring Boot工程的基础结构包括四个部分(具体路径根据用户生成项目时填写的GroupId和ArtifactId有所差异)。</p><ul><li>src/main/java：存放主要编码的区域。如上，SpringBootMavenApplication.java这个类就是工程的主程序入口类，可以通过直接运行该类来启动Spring Boot应用。</li><li>src/main/reources：存放默认配置的目录。 该目录存放应用级别配置文件----application.yml文件(看个人喜好，这个文件作用等同于application.peoperties文件，唯一区别在于语法格式的不同)，用来存放应用的一些配置信息， 如应用名、服务端口、数据库链接等。如果在搭建工程初期就引入Web模块，maven工程会自动产生static目录与templates目录，前者用于存放静态资源， 如图片、css、JavaScript等；后者存放Web页面的模板文件， 可根据实际需要灵活产生或删除这两个目录。</li><li>src/test：单元测试目录。 生成的测试类通过JUnit 4实现， 可以直接用运行Spring Boot应用的测试。</li><li>pom.xml：SpringBoot项目级别的核心配置文件。这个pom.xml主要描述了项目的maven座标，依赖关系，属性配置，开发者需要遵循的规则，缺陷管理系统，组织和licenses，maven插件配置以及其他所有项目相关因素。</li></ul><p>Spring Boot的配置文件除了可以使用传统的 properties文件之外，还支持现在被广泛推荐使用的YAML文件。Spring Boot 的默认配置文件位置为：src/main/reources/application.yml。SpringBoot应用的配置内容都可以集中在该文件中， 根据pom.xml文件中引入的不同Starter模块，可以在application.yml文件内定义容器端口号、 数据库连接信息、 日志级别、MyBatis、redis等等各种配置信息。</p><p>比如， 我们需要自定义Web模块的服务端口号，可以在application.yml中添加如下内容来指定SpringBoot项目的应用配置信息。#application-level config</p><pre><code>#profiles activeserver:         port: 8080#log configlogging:         config: /HL/IdeaProjects/SpringBoot-Item/springboot-slf4j/src/main/resources/logback.xml  level:           com.hl.magic: error</code></pre><p>关于YML文件定义，这里简单总结一下。</p><p>YAML (英语发音为l'j知回／，， 尾音类似camel骆驼）是 一个可读性高， 用来表达资籵序列的格式。YAML参考了其他多种语言， 包括C语言、Python、Perl,并从XML、 电子邮件的数据格式(RFC 2822)中获得灵感。 Clark Evans在2001年首次发表了这种语言，Ingy dot Net与OrenBen寸q如也是这种语言的共同设计者。 目前已经有数种编程语言或脚本语言支持（或者说解析）这种语言。</p><p>YAML是 YAML 扣n't a Markup Lan伊1age (YAML 不是一种标记语言）的缩写。在开发这种语言时， YAML的意思其实是： Yet Another Markup Language (仍是一种标记语言），但为了强调这种语言以数据作为中心，而不是以标记语言为重点，而用反向缩略语重新命名。</p><blockquote class=pgc-blockquote-abstract><p>YAML的语法和其他高阶语言类似， 并且可以简单地表达清单、 散列表、 标量等形态。它使用空白符号缩排和大量依赖外观的特色， 特别适合用来表达或编辑数据结构、各种设定文档、 文件大纲（例如， 许多电子邮件标题格式和 YAML 非常接近）。尽管它比较适合表达阶层式 (hierarchical model)的数据结构， 不过也有精致的语法可以表示关联性 (relational model)的资籵。 由于YAML 使用空白符号和分行未分隔资籵， 使得它特别适合用 grep / Python / Perl /Ruby操作。其让人最容易上手的特色是巧妙避开各种封闭符号，如引号、各种括号等， 这些符号在巢状结构时会变得复杂而难以辨认。——————维基百科</p></blockquote><p>YAML 采用的配置格式不像 properties 的配置那样以单纯的键值对形式来表示，而是以类似大纲的缩进形式来表示。 下面是一段 YAML 配置信息：spring:</p><pre><code>  profiles:           active: dev#MVC  mvc:           servlet:                    load-on-startup: 1</code></pre><p>上边的配置信息在application.properties文件中等同配置如下：</p><blockquote class=pgc-blockquote-abstract><p>spring.profiles.active=dev</p><p>spring.mvc.servlet.load-on-startup=1</p></blockquote><p>通过 YAML 的配置方式我们可以看到，配置信息利用阶梯化缩进的方式， 其结构更为清晰易读， 同时配置内容的字符量也得到显著减少。</p><p>除此之外，YAML 还可以在一个单个文件中通过使用 spring.profiles 属性来定义多个不同的环境配置。 例如下面的内容，在指定为test环境时，server.port 将使用8081端口；在 prod 环境中，server.port将使用8082端口；而在 dev环境中，server.port将使用8083端口；如果没有指定环境，server.port将使用默认的8080端口。</p><pre><code>server:         port: 8080---spring:         profilea: testserver:         port: 8081---spring:         profilea: prodserver:         port: 8082---spring:         profilea: devserver:         port: 80832.2 </code></pre><h1 class=pgc-h-arrow-right>2.2 自定义参数</h1><p>除了可以在 Spring Boot 的配置文件中设置各个Starter 模块中预定义的配置属性， 也可以在配置文件中定义一些我们需要的自定义属性。 针对application.yml文件和 application.properties文件中自定义参数，栗子。</p><p>【1】在 application.yml文件中定义如下：</p><pre><code>book:         name: Spring Boot In Action         author: xiaoming </code></pre><p>【2】在application.properties文件中定义如下：</p><pre><code>book.name=Spring Boot In Actionbook.author=xiaoming</code></pre><p>上边两种文件内的自定义参数，实际上是等效的。</p><p>接下来，我们在应用中可以通过@Value注解来加载这些自定义的参数，如：</p><pre><code>@Componentpublic class Book {    @Value("${book.name}")    private String name;    @Value("${book.author}")    private String author;    /**省略getter和setter方法*/} </code></pre><p>@Value 注解加载属性值的时候可以支持两种表达式来进行配置， 如下所示。</p><blockquote class=pgc-blockquote-abstract><p>• 一种是上面介绍的 PlaceHolder 方式，格式为＄{．．．}，大括号内为 PlaceHolder。</p><p>• 另一种是使用SpEL 表达式 (Spring Expression Language), 格式为#{．．．}， 大括号内为 SpEL 表达式。</p></blockquote><h1 class=pgc-h-arrow-right>2.3 参数引用</h1><p>对于参数引用的方式， 其主要区别在于application.yml文件和 application.properties文件中对于参数定义及引用方式。</p><p>【1】 application.yml文件</p><p>在 application.yml中的各个参数之间可以直接通过使用 PlaceHolder 的方式来进行引用 ， 就像下面的设置：</p><pre><code>book:         name: Spring Boot In Action         author: xiaoming         desc: ${book.name} is writing 《${book.name}》</code></pre><p>book.desc 参数引用了上边中定义的book.name和book.author 属性， 最后该属性的值就是xiaoming is writing《Spring Boot In Action》。</p><p>【2】 application.properties文件</p><p>在 application.yml中的各个参数之间可以直接通过使用 PlaceHolder 的方式来进行引用 ， 就像下面的设置：</p><pre><code>book.name=Spring Boot In Actionbook.author=xiaoming</code></pre><p>book.des=${book.name} is writing 《${book.name}》 book.desc 参数引用了上边中定义的book.name和book.author 属性， 最后该属性的值就是xiaoming is writing《Spring Boot In Action》。</p><h1 class=pgc-h-arrow-right>2.4 使用随机数</h1><p>在一些特殊情况下， 我们希望有些参数每次被加载的时候不 一个固定的值， 比如密钥、 服务端口等。 在 SpringBoot的属性配置文件中， 可以 通过 使用${random}配置来产生随机的int值、long值或者string字符串，这样我们就可以容易地通过配置随机生成属性，而不是在程序中通过编码来实现这些逻辑。</p><p>【1】 application.yml文件</p><p>${random}的配置方式主要有以下几种， 读者可作为参考使用。</p><pre><code>＃随机字符串com：         didispace：                  blog：                           value: ${random.value} ＃随机int                           number: ${random.int} ＃随机long                           bignumber: ${random.long} # 10以内的随机数                           test1: ${random.int(l0)}# 10-20的随机数                           test2: ${random.int[l0,20]}</code></pre><p>【2】 application.properties文件${random}的配置方式主要有以下几种， 读者可作为参考使用。</p><pre><code>＃随机字符串com.didispace.blog.value=${random.value} ＃随机intcom.didispace.blog.number=${random.int} ＃随机longcom.didispace.blog.bignumber=${random.long} # 10以内的随机数com.didispace.blog.tes七 1=${random.int(l0)}# 10-20的随机数com.didispace.blog.test2=${random.int[l0,20]}</code></pre><h1 class=pgc-h-arrow-right>2.5 命令行参数</h1><p>启动SpringBoot应用， 可以使用命令java -jar 来启动的方式。 当然，该命令除了启动应用之外， 还可以在命令行中指定应用的参数， 比如java -jar xxx.jar --server.port = 8080，直接以命令行的方式来设置server.port属性， 并将启动应用的端口设为8080。</p><p>在用命令行方式启 动 Spring Boot 应用时， 连续的两个减号“- -”就是对application.properties中的属性值进行赋值的标识。 所以 ， java -jar xxx.jar--server.port = 8080命令， 等价于在 application.properies中添加属性server.port = 8080。</p><p>通过命令行来修改属性值是 SpringBoot非常重要的一个特性。 通过此特性， 理论上已经使得应用的属性在启动前是可变的， 所以其中的端口号也好、 数据库连接也好， 都是可以在应用启动时发生改变的， 而不同于以往的Spring应用通过Maven的Profile在编译器中进行不同环境的构建。</p><p>SpringBoot的这种方式， 可以让应用程序的打包内容贯穿开发、测试以及线上部署， 而Maven不同Profile的方案为每个环境所构建的包，其内容本质上是不同的。 但是， 如果 每个参数都需要通过命令行来指定， 这显然也不是 一个好的方案， 所以下面我们看看如何在SpringBoot中实现多环境的配置。</p><p>————————————————</p><p><strong>愿你就像早晨八九点钟的太阳，活力十足，永远年轻。</strong></p><p>————————————————</p><p>一入IT深似海，从此学习是常态，上面内容只是冰山一角。关注"<strong>JohnnyHL</strong>"，决战秋名山，coding到天亮。更多的干货，敬请期待！！</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'配置文件','SpringBoot','详解'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>