<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>PHPè¿›é˜¶æ•™ç¨‹-phperéœ€è¦çŸ¥é“å¸¸é©»å†…å­˜ä¸­çš„ä¸Šä¸‹æ–‡æ˜¯ä»€ä¹ˆä¸œè¥¿ | æå®¢å¿«è¨Š</title><meta property="og:title" content="PHPè¿›é˜¶æ•™ç¨‹-phperéœ€è¦çŸ¥é“å¸¸é©»å†…å­˜ä¸­çš„ä¸Šä¸‹æ–‡æ˜¯ä»€ä¹ˆä¸œè¥¿ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/bc66832213514f2996f2e48c9e9cc747"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/637cf111.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/637cf111.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/637cf111.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/637cf111.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/637cf111.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/637cf111.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/637cf111.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/637cf111.html><meta property="article:published_time" content="2020-11-14T21:07:27+08:00"><meta property="article:modified_time" content="2020-11-14T21:07:27+08:00"><meta name=Keywords content><meta name=description content="PHPè¿›é˜¶æ•™ç¨‹-phperéœ€è¦çŸ¥é“å¸¸é©»å†…å­˜ä¸­çš„ä¸Šä¸‹æ–‡æ˜¯ä»€ä¹ˆä¸œè¥¿"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/637cf111.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>PHPè¿›é˜¶æ•™ç¨‹-phperéœ€è¦çŸ¥é“å¸¸é©»å†…å­˜ä¸­çš„ä¸Šä¸‹æ–‡æ˜¯ä»€ä¹ˆä¸œè¥¿</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>â€‹æˆ‘ä»¬åœ¨è®²è¿›ç¨‹ã€çº¿ç¨‹çš„æ—¶å€™å¤šæ¬¡æåŠäº†ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸Šä¸‹æ–‡å…¶å®åœ¨æˆ‘ä»¬ç”Ÿæ´»ä¸­ä¹Ÿç»å¸¸é‡åˆ°ï¼Œå¯èƒ½åªæ˜¯æˆ‘ä»¬æ²¡æœ‰ç»†å¿ƒç•™æ„ã€‚</p><h3 class=pgc-h-arrow-right><strong>ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡ï¼Ÿ</strong></h3><p>ä¸Šå°å­¦è€ƒè¯•çš„æ—¶å€™ï¼Œç»å¸¸æˆ‘ä»¬è¯•å·ä¸Šä¼šæœ‰ä¸€æ®µæ–‡ç« çš„å¥å­ï¼Œè®©æˆ‘ä»¬è§£é‡Šå‡ºé‚£å¥è¯çš„å‰å› åæœï¼›æˆ‘ä»¬ä¹Ÿå­¦è¿‡æ‰¿ä¸Šå¯ä¸‹ï¼Œä¸Šä¸‹æ–‡è·Ÿè¿™ä¸ªå·®ä¸å¤šï¼Œæ ¹æ®æ–‡ç« å‰é¢çš„å†…å®¹å’Œåé¢çš„å†…å®¹å¾—çŸ¥è¿™å¥è¯çš„æ„æ€ã€‚ä¸ç„¶ç»™ä½ ä¸€æ®µè¯ï¼Œä½ æ ¹æœ¬ä¸çŸ¥é“è¿™æ®µè¯å‡ºç°åœ¨æ–‡ç« çš„è¿™ä¸ªåœ°æ–¹è¡¨ç¤ºä»€ä¹ˆã€‚</p><p>ä¾‹å¦‚ï¼šæˆ‘å’Œå¥¹å‡æœŸå»æ—…æ¸¸ã€‚</p><p>è¿™å¥è¯æˆ‘ä»¬å¯ä»¥å¼•å‡ºä¸‰ä¸ªé—®é¢˜ã€‚å¥¹æ˜¯æŒ‡çš„è°ï¼Ÿå‡æœŸæ˜¯å“ªä¸ªå‡æœŸï¼Ÿå»å“ªé‡Œæ—…æ¸¸ï¼Ÿè´¸ç„¶çš„ç»™æˆ‘ä»¬ä¸€å¥è¯æˆ‘ä»¬ä¸çŸ¥é“è¿™æ®µè¯è¯´çš„æ„æ€ã€‚å› ä¸ºè¿™æ®µè¯æ²¡æœ‰ä¸Šæ–‡ä¹Ÿæ²¡æœ‰ä¸‹æ–‡ï¼Œæˆ‘ä»¬ä¸çŸ¥é“è¯´çš„å¥¹æ˜¯è°ï¼›è¿˜æœ‰è¿™ä¸ªå‡æœŸæ˜¯è¿‡å»å¼è¿˜æ˜¯å°†æ¥æ—¶ï¼›å¦‚æœè¿™å¥è¯æ”¹ä¸€æ”¹ï¼ŒæŠŠä¸Šä¸‹æ–‡å¸¦è¿›æ¥ã€‚</p><p>ä¸‹é¢æ˜¯å°æ˜å’Œå°å¼ºçš„å¯¹ç™½ï¼š</p><p>å°æ˜ï¼šå°å¼ºä¸å¥½æ„æ€å•Šã€‚æˆ‘å‡æœŸæ²¡ç©ºå’Œä½ ä¸€èµ·åŠ ç­äº†ã€‚</p><p>å°å¼ºï¼šä¸ºä»€ä¹ˆå•Šï¼Ÿ</p><p>å°æ˜ï¼šæˆ‘å’Œå¥¹å‡æœŸå»æ—…æ¸¸ã€‚</p><p>å°å¼ºï¼šå’Œè°å»å“ªå‘¢ï¼Ÿ</p><p>å°æ˜ï¼šå°çº¢å•Šï¼Œå¥¹è¯´äº”ä¸€æœ‰ç©ºï¼Œæˆ‘å’Œå¥¹ä¸€èµ·å‡ºå»ä¸‰äºšä¸‹æµ·ã€‚</p><p>å°å¼ºï¼šæ»šå§ï¼Œé‡è‰²è½»å‹çš„æ··è›‹ã€‚</p><p>è¿™æ ·å°±æœ‰äº†ä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬å°±çŸ¥é“è¿™ä¸ªå¥¹æ˜¯è°ï¼Œå‡æœŸæ˜¯ä»€ä¹ˆæ—¶å€™ï¼Œç›®çš„åœ°æ˜¯å“ªé‡Œã€‚è¿™å°±æ˜¯è¯­æ–‡é‡Œé¢ç†è§£çš„ä¸Šä¸‹æ–‡çš„å·¦å³ã€‚</p><p>ä¸Šä¸‹æ–‡æ²¡æœ‰å…·ä½“çš„è§£é‡Šï¼Œä¹Ÿæ²¡æœ‰æŸä¸€ä¸ªå…·ä½“çš„å®ä¾‹æ¥è§£é‡Šï¼Œä¸Šä¸‹æ–‡ä¼šæ ¹æ®åº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸè€Œå˜åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´åŒæ ·çš„ä¸€å¥è¯åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ï¼Œæ‰€è¡¨ç¤ºçš„æ„æ€ä¸ä¸€æ ·ã€‚</p><h3 class=pgc-h-arrow-right><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ä¸Šä¸‹æ–‡ï¼Ÿ</strong></h3><p>æˆ‘ä»¬ç†è§£äº†ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´è¯´ç¼–ç¨‹é‡Œé¢çš„ä¸Šä¸‹æ–‡ï¼Œè¯´ç™½äº†ç¼–ç¨‹é‡Œé¢çš„ä¸Šä¸‹æ–‡å°±æ˜¯ä¸€ä¸ªç¯å¢ƒã€‚è·Ÿå‰é¢äº†è§£çš„æƒ…å†µä¸€ä¸‹ï¼Œæ²¡æœ‰ä¸Šä¸‹æ–‡æˆ‘ä»¬ä¸çŸ¥é“æŸä¸€ä¸ªå˜é‡å¤„äºæŸä¸€ä¸ªæ—¶åˆ»æˆ–è€…æŸä¸€è¿›ç¨‹ï¼Œçº¿ç¨‹ä»£è¡¨ä»€ä¹ˆæ„æ€ã€‚å› æ­¤ä¸Šä¸‹æ–‡å°±æ˜¯å‘Šè¯‰è¿™äº›å˜é‡æ‰€å¤„çš„ä½ç½®ï¼Œä¾‹å¦‚ä¸€ä¸ªè¿›ç¨‹åˆ‡æ¢çš„æ—¶å€™éœ€è¦ä¿å­˜è¿›ç¨‹çš„çŠ¶æ€ï¼Œèµ„æºä¿æŠ¤å¥½ç°åœºï¼Œç­‰åˆ°å†æ¬¡åˆ‡æ¢å›æ¥çš„æ—¶å€™ä»ä¸­æ–­çš„åœ°æ–¹æ¢å¤ã€‚</p><div class=pgc-img><img alt=PHPè¿›é˜¶æ•™ç¨‹-phperéœ€è¦çŸ¥é“å¸¸é©»å†…å­˜ä¸­çš„ä¸Šä¸‹æ–‡æ˜¯ä»€ä¹ˆä¸œè¥¿ onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/bc66832213514f2996f2e48c9e9cc747><p class=pgc-img-caption></p></div><p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬åœ¨æ¯ä¸€ä¸ªè¯·æ±‚éƒ½æœ‰å˜é‡ã€æ•°æ®åº“èµ„æºã€æ–‡ä»¶èµ„æºç­‰ç­‰ã€‚åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ï¼Œè¿™äº›è¯·æ±‚çš„å€¼æ‰€è¡¨ç¤ºä¸ä¸€æ ·çš„å†…å®¹ã€‚ä¾‹å¦‚åœ¨è¯·æ±‚1ä¸­useridæ˜¯1002ï¼Œåœ¨è¯·æ±‚2ä¸­useridæ˜¯999ã€‚</p><p><br></p><p>åœ¨ä½¿ç”¨å¸¸é©»å†…å­˜æ¡†æ¶çš„æ—¶å€™å¾ˆå¤šæ—¶å€™ä¸ºäº†æ€§èƒ½ï¼Œæ§åˆ¶å™¨ä¼šå¼„æˆå•ä¾‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™ä¸èƒ½åƒä»¥å¾€åœ¨fpmæ¨¡å¼ä¸‹å¼€å‘ä¸€æ ·ï¼Œä½¿ç”¨åŸºç±»æ¥ç»§æ‰¿å±æ€§åœ¨æ§åˆ¶å™¨ä½¿ç”¨å…±åŒå±æ€§ï¼›ä¾‹å¦‚æˆ‘ä»¬åœ¨ä¸­é—´ä»¶åšæˆæƒéªŒè¯ï¼Œå¦‚æœæƒ³è¦æŠŠè¿™ä¸ªç”¨æˆ·idç»§ç»­ä¼ åˆ°æ§åˆ¶å™¨ä½¿ç”¨ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬åˆä¸èƒ½é€šè¿‡åŸºç±»çš„æ–¹å¼æ¥ç»§æ‰¿ï¼Œè¿™æ—¶å€™å¯ä»¥æŠŠè¿™ä¸ªidæŒ‚è½½åˆ°ä¸Šä¸‹æ–‡ä¸­ã€‚</p><p><br></p><p>æœ€ç›´è§‚çš„ç†è§£å°±æ˜¯æ¯ä¸€æ¬¡è¯·æ±‚éƒ½ä¼šæœ‰ä¸€ä¸ªä¸Šä¸‹æ–‡æ¥ç®¡ç†è¿™ä¸ªè¯·æ±‚çš„æ‰€æœ‰äº§ç”Ÿçš„å†…å®¹ï¼Œåšåˆ°æ¯ä¸€ä¸ªè¯·æ±‚çš„å˜é‡å’Œèµ„æºè¾¾åˆ°éš”ç¦»çŠ¶æ€ï¼Œé¿å…äº†ä¸åŒçš„è¯·æ±‚ä¼šå‡ºç°æ•°æ®æ±¡æŸ“çš„æƒ…å†µã€‚</p><p><br></p><h3 class=pgc-h-arrow-right><strong>ä¸ºä»€ä¹ˆåœ¨php-fpmä¸éœ€è¦ä¸Šä¸‹æ–‡ï¼Ÿ</strong></h3><p>å…¶å®åœ¨php-fpmæ¨¡å¼å¼€å‘æˆ‘ä»¬ç»å¸¸ä¸éœ€è¦ç®¡ç†ä¸Šä¸‹æ–‡ï¼Œå› ä¸ºåœ¨php-fpmæ¨¡å¼å¼€å‘ä¸æ˜¯å¸¸é©»å†…å­˜çš„ï¼Œå¹¶ä¸”php-fpmå¸®æˆ‘ä»¬ç®¡ç†äº†ä¸Šä¸‹æ–‡ï¼Œä¸éœ€è¦å¼€å‘è€…è‡ªå·±ç®¡ç†ï¼Œè€Œåœ¨å¸¸é©»å†…å­˜å¼€å‘ä¸­éœ€è¦ç»´æŠ¤æ¯ä¸ªè¯·æ±‚çš„ç¯å¢ƒã€‚</p><p><br></p><p><strong>å¸¸é©»å†…å­˜æ²¡æœ‰ä¸Šä¸‹æ–‡éš”ç¦»äº§ç”Ÿçš„é—®é¢˜</strong></p><p><br></p><p>å¸¸é©»å†…å­˜ä¸‹é‡‡ç”¨å•ä¾‹çš„æ§åˆ¶å™¨ï¼Œä¸ä¼šå› ä¸ºæ¯æ¬¡è¯·æ±‚éƒ½newä¸€æ¬¡æ§åˆ¶å™¨ã€‚</p><p>BaseController.php</p><pre><code>class BaseController{    protected $num = 0;}</code></pre><p><br></p><p>Controller.php</p><pre><code>class Controller extends BaseController{    public function index(){        $this-&gt;num++;        return "index:".$this-&gt;num;    }    public function test(){        $this-&gt;num++;        return "test:".$this-&gt;num;    }}</code></pre><p>Server.php</p><pre><code>include './BaseController.php';include './Controller.php';class Server{    private $server;    private $controller;    public function __construct(){        $this-&gt;controller = new Controller();        $this-&gt;server = new Swoole\Http\Server("127.0.0.1", 9501);        $this-&gt;server-&gt;on('request', function ($request, $response){            $c = $request-&gt;get['c']??'index';            $res = call_user_func([$this-&gt;controller,$c]);            $response-&gt;end($res);        });        $this-&gt;server-&gt;start();    }}new Server();</code></pre><p><br></p><p>åˆ†åˆ«è¯·æ±‚ä¸€ä¸‹ï¼š</p><ul><li>http://127.0.0.1:9501/</li><li>http://127.0.0.1:9501?c=test</li></ul><p><br></p><h3 class=pgc-h-arrow-right><strong>å®æˆ˜ï¼šæ‰‹å†™swooleæ¡†æ¶ä¸Šä¸‹æ–‡ç®¡ç†</strong></h3><p>é€šè¿‡ä¸Šä¸‹æ–‡éš”ç¦»æ¯ä¸€ä¸ªè¯·æ±‚çš„ä¿¡æ¯ï¼Œé¿å…æ•°æ®æ±¡æŸ“ã€‚</p><p>Context.php</p><pre><code>use Swoole\Coroutine;class Context{    private static $context = [];    public static function get($key = null){        $tid = Coroutine::getCid();        if ($key == null){            return self::$context[$tid] ?? null;        }else{            return self::$context[$tid][$key] ?? null;        }    }    /**     * Set context     * @param $key     * @param $context     */    public static function set($key,$context){        $tid = Coroutine::getCid();        self::$context[$tid][$key] = $context;    }    public static function destroy(){        $tid = Coroutine::getCid();        unset(self::$context[$tid]);    }    public static function printContext(){        print_r(self::$context);    }}</code></pre><p>Controller.php</p><pre><code>class Controller{    public function index(){        $num = Context::get("num");        $num++;        return "index:".$num;    }    public function test(){        $num = Context::get("num");        $num++;        return "test:".$num;    }}</code></pre><p>Server.php</p><pre><code>include './Context.php';include './Controller.php';class Server{    private $server;    private $controller;    public function __construct(){        $this-&gt;controller = new Controller();        $this-&gt;server = new Swoole\Http\Server("127.0.0.1", 9501);        $this-&gt;server-&gt;on('request', function ($request, $response){            defer(function(){                Context::destroy();            });            Context::set('num',0);            Context::printContext();            $c = $request-&gt;get['c']??'index';            $res = call_user_func([$this-&gt;controller,$c]);            $response-&gt;end($res);        });        $this-&gt;server-&gt;start();    }}new Server();</code></pre><p>å¯ä»¥é€šè¿‡åç¨‹idè·å–å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä»»æ„åœ°æ–¹åªè¦å¾—åˆ°åç¨‹idå°±å¯ä»¥è·å–ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥æŠŠä¸€äº›å’Œå½“å‰è¯·æ±‚å…³è”çš„æ•°æ®é€šè¿‡ä¸Šä¸‹æ–‡ä¼ é€’ã€‚</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'PHP','è¿›é˜¶','phper'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>