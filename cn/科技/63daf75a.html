<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>你辛辛苦苦做出的Excel数据模型同事不会用？参数表格可以拯救你 | 极客快訊</title><meta property="og:title" content="你辛辛苦苦做出的Excel数据模型同事不会用？参数表格可以拯救你 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/dfic-imagehandler/fc8071e2-b79a-43d6-b5e4-4e4136051bb0"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/63daf75a.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/63daf75a.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/63daf75a.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/63daf75a.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/63daf75a.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/63daf75a.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/63daf75a.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/63daf75a.html><meta property="article:published_time" content="2020-11-14T21:07:05+08:00"><meta property="article:modified_time" content="2020-11-14T21:07:05+08:00"><meta name=Keywords content><meta name=description content="你辛辛苦苦做出的Excel数据模型同事不会用？参数表格可以拯救你"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/63daf75a.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>你辛辛苦苦做出的Excel数据模型同事不会用？参数表格可以拯救你</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>需求场景</h1><p>假设你用微软的Excel做了一个牛叉到没朋友的报告模板，有各种复杂的计算。这个模板使用的N个原始文件是从某个系统导出的。如果这个模板只供你一个人使用，毫无问题；当你需要把这个模板提交给其他伙伴使用时，他们就需要自己从系统中导出N个原始文件然后修改模板的PowerQuery代码，这将是一场你无法想象的灾难。怎么避免这样的灾难发生？</p><div class=pgc-img><img alt=你辛辛苦苦做出的Excel数据模型同事不会用？参数表格可以拯救你 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/fc8071e2-b79a-43d6-b5e4-4e4136051bb0><p class=pgc-img-caption></p></div><p>避免灾难的方法是：<strong>尽可能将模板代码封装，只让其他伙伴导出系统文件放到某个特定文件夹，然后把模板文件丢到原始文件所在的文件夹。然后打开模板文件刷新即可。</strong></p><p>这就是<strong>参数表格</strong>发挥作用的地方。</p><p>不知道“Parameter Table”确切翻译是什么，我直译为“参数表格”。参数表格的意思是：PowerQuery的参数可以根据用户输入来实现动态化。</p><h1>首先在Excel中创建参数表格并进行初始化</h1><p>这个表格只有两列：参数和值。因为这整个思路是我抄的英文资源的，所以我偷懒照搬英文列名：“Parameter”和“Value”。然后用插入表格或套用表格的方式，将区域转化成表格，记得将表格命名为“Parameters”【图1】。注意左上角的“表名称”。Value列就是需要用户输入的地方。</p><p>现在进行参数表格初始化：由于需要用的数据源有多个且放在了一个固定的文件夹内（假设叫"原始数据"），因此，在Parameter列下面添加一个”FolderPath"。Value的值里填入下面的公式：</p><pre>=LEFT(CELL("filename",A1),FIND("[",CELL("filename",A1),1)-1)&amp;"原始数据\"</pre><div class=pgc-img><img alt=你辛辛苦苦做出的Excel数据模型同事不会用？参数表格可以拯救你 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/e619af877dd6466784f0f91a26f930c4><p class=pgc-img-caption></p></div><h1>然后把参数表格引入到PowerQuery</h1><p>选择“从表格”创建然后新建一个查询，这一步是创建包含参数值的查询，便于后面从这个查询里引用参数值。创建过程比较简单，一路默认和确定即可，不再截图演示。因为是从已经命名的表格创建的，所以查询名自动继承了表格名字“Parameters”。</p><div class=pgc-img><img alt=你辛辛苦苦做出的Excel数据模型同事不会用？参数表格可以拯救你 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/fb7c40c11da84218bbd78a274de0fef8><p class=pgc-img-caption></p></div><h1>创建引用参数表格值的函数</h1><p>现在要创建一个函数，因为只有函数才会拥有动态变化的值。直接点击“新建查询-从其他源-空白查询”，创建一个空白查询，点击“高级编辑器”，删除里边的所有代码，把下面代码粘贴进去然后保存，并把该查询命名为“fnGetParameter”。</p><blockquote><p>//括号和等号加右箭头是函数的标志，括号里的是函数的参数，或者叫变量。如果把第一行拿掉，其实就是一个完整的查询。加上第一行就把这个查询封装成为一个函数了。</p><p>(ParameterName as text) =></p><p>let</p><p>//获取刚才创建的Parameters表格</p><p>ParamSource = Excel.CurrentWorkbook(){[Name="Parameters"]}[Content],</p><p>//这一步其实是让参数表格的行可以无限扩充，不再局限于本例中的三行。注意在“in”前的都是一条语句，并且有缩进，我这里偷懒没缩进。整条语句蛮抽象，我自己也还没完全弄懂其内部的运作原理，直接照搬了。</p><p>ParamRow = Table.SelectRows(ParamSource, each ([Parameter] = ParameterName)),</p><p>Value=</p><p>if Table.IsEmpty(ParamRow)=true</p><p>then null</p><p>else Record.Field(ParamRow{0},"Value")</p><p>in</p><p>Value</p></blockquote><h1>现在可以创建你牛叉的数据模型了</h1><p>接下来创建你的数据模型，无需考虑原始文件的引用路径是否硬编码。进行各种复杂的Shaping也好，Calculating也好，然后加载到数据模型，。根据需要添加计算列、计算字段，创建数据透视表、数据透视图乃至PowerView。十八般武艺样样上吧。具体步骤不赘述。</p><div class=pgc-img><img alt=你辛辛苦苦做出的Excel数据模型同事不会用？参数表格可以拯救你 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/0e893253-0018-4229-8c34-6a76798f90ef><p class=pgc-img-caption></p></div><h1><strong>把你模型中原始文件的引用路径全部用引用参数表格函数来代替</strong></h1><p>报告创建好之后，你同事能够轻松使用你的牛逼报告模板的关键一步来了：将上一步写死的源文件位置，替换成参数表格里的值。类似于下面这样的：</p><blockquote><p>源 = Excel.Workbook(File.Contents(fnGetParameter("FolderPath")), null, true),</p></blockquote><p class=ql-align-center>其中的FolderPath就是你同事电脑上保存源文件的路径。但<strong>不需要你同事自己写路径，模型文件会自动获取，这就是它牛叉的地方</strong>。</p><p class=ql-align-center>保存该Excel文件。</p><h1 class=ql-align-center>你同事不费吹灰之力就可以使用你的牛叉模板</h1><p>同事拿到这个Excel数据模型文件后，放到ta想放的位置。在同一个文件夹下新建一个叫“原始数据”的空文件夹，把系统中的原始数据文件都丢到这个叫“原始数据”的文件夹中。</p><p>然后打开模板文件，点击“刷新”，大概几秒到几分钟就获取到最新的数据了（取决于数据量大小和模型的复杂程度），你模型中的数据透视表、图表及其他各种丰富多彩的可视化结果都自动更新好了。</p><div class=pgc-img><img alt=你辛辛苦苦做出的Excel数据模型同事不会用？参数表格可以拯救你 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/e17c2dc4-de71-459e-8154-428d4086ac3f><p class=pgc-img-caption></p></div><p>怎么样，心动了吗？要不要立即试试看？</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Excel','数据','不会用'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>