<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>5行代码实现微信模版消息推送，java实现微信推送 | 极客快訊</title><meta property="og:title" content="5行代码实现微信模版消息推送，java实现微信推送 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/a9f6e94d9ffd44e7915ceb1d31e50332"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6474cc44.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6474cc44.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6474cc44.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6474cc44.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6474cc44.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6474cc44.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6474cc44.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6474cc44.html><meta property="article:published_time" content="2020-11-14T21:00:09+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:09+08:00"><meta name=Keywords content><meta name=description content="5行代码实现微信模版消息推送，java实现微信推送"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/6474cc44.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>5行代码实现微信模版消息推送，java实现微信推送</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><blockquote><p>今天来带大家学习下<span>微信模版</span>消息推送。</p></blockquote><p>先看效果图：</p><div class=pgc-img><img alt=5行代码实现微信模版消息推送，java实现微信推送 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a9f6e94d9ffd44e7915ceb1d31e50332><p class=pgc-img-caption></p></div><p>核心代码只有下面几行，即可轻松实现微信模版消息推送</p><pre>//1，配置WxMpInMemoryConfigStorage wxStorage = new WxMpInMemoryConfigStorage();wxStorage.setAppId("wx77bb69292323a000");wxStorage.setSecret("29bd368145806115ad6820133e62806e");WxMpService wxMpService = new WxMpServiceImpl();wxMpService.setWxMpConfigStorage(wxStorage);//2,推送消息WxMpTemplateMessage templateMessage = WxMpTemplateMessage.builder().toUser("o5kho6DgC7SDry8zCmXuvHJGvrgI")//要推送的用户openid.templateId("Tpln-Eue2obJ0B-8JNkgkiRJaDMPgVeIgGxna982xrg")//模版id.url("https://30paotui.com/")//点击模版消息要访问的网址.build();try { wxMpService.getTemplateMsgService().sendTemplateMsg(templateMessage);} catch (Exception e) { System.out.println("推送失败：" + e.getMessage());}</pre><p><strong>所用知识点</strong></p><ul><li>1， springboot实现java后台</li><li>2，微信测试账号的申请</li><li>3，微信模版推送的配置</li><li>接下来就带领大家来一步步实现微信模版消息推送。</li></ul><p><strong>一，springboot创建java后台</strong></p><p>至于springboot怎么创建java后台，我这里就不再唠叨了，大家百度一下，一大堆的文章。这里只需要重点讲解下以下几点。</p><ul><li>1，在pom.xml文件里引入下面类库</li></ul><pre>&lt;!--微信模版消息推送三方sdk--&gt;&lt;dependency&gt;&lt;groupId&gt;com.github.binarywang&lt;/groupId&gt;&lt;artifactId&gt;weixin-java-mp&lt;/artifactId&gt;&lt;version&gt;3.3.0&lt;/version&gt;&lt;/dependency&gt;</pre><ul><li>2，写一个推送的controller</li></ul><pre>package com.qiushi.wxpush;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RestController;import me.chanjar.weixin.mp.api.WxMpInMemoryConfigStorage;import me.chanjar.weixin.mp.api.WxMpService;import me.chanjar.weixin.mp.api.impl.WxMpServiceImpl;import me.chanjar.weixin.mp.bean.template.WxMpTemplateMessage;/*** Created by qcl on 2019-03-28* 微信：2501902696* desc: 模版消息推送模拟*/@RestControllerpublic class PushController {/** 微信测试账号推送* */@GetMapping("/push")public void push() {//1，配置WxMpInMemoryConfigStorage wxStorage = new WxMpInMemoryConfigStorage();wxStorage.setAppId("wx77bb69292323a000");wxStorage.setSecret("29bd368145806115ad6820133e62806e");WxMpService wxMpService = new WxMpServiceImpl();wxMpService.setWxMpConfigStorage(wxStorage);//2,推送消息WxMpTemplateMessage templateMessage = WxMpTemplateMessage.builder().toUser("o5kho6DgC7SDry8zCmXuvHJGvrgI")//要推送的用户openid.templateId("Tpln-Eue2obJ0B-8JNkgkiRJaDMPgVeIgGxna982xrg")//模版id.url("https://30paotui.com/")//点击模版消息要访问的网址.build();//3,如果是正式版发送模版消息，这里需要配置你的信息// templateMessage.addData(new WxMpTemplateData("name", "value", "#FF00FF"));// templateMessage.addData(new WxMpTemplateData(name2, value2, color2));try { wxMpService.getTemplateMsgService().sendTemplateMsg(templateMessage); } catch (Exception e) { System.out.println("推送失败：" + e.getMessage()); e.printStackTrace(); }}} </pre><p><strong>二，接下来就来重点讲讲我们如何注册微信测试账号，并实现推送功能。</strong></p><blockquote><p>正常我们企业开发，实现微信<span>模版</span>消息推送，必须要有微信公众号，备案的网址，并且最麻烦的一点是要获取到用户的openid，作为个人，这些条件基本上都不具备。所以今天就来带大家注册微信开发测试账号，来轻松实现微信<span>模版</span>消息推送。</p></blockquote><ul><li>1，微信扫码登录下面网址</li><li>https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login</li><li>扫码登录成功后，就会给我们生成微信公号的appid和appsecret</li></ul><div class=pgc-img><img alt=5行代码实现微信模版消息推送，java实现微信推送 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/72a9c89e878d4e92b49bd065cf5e49c9><p class=pgc-img-caption></p></div><ul><li>2，微信扫码关注 测试号二维码，微信给我们返回我们的openid，这个openid在推送时特别重要。因为你推送肯定要知道推送给 谁啊，就比如你打电话，肯定要知道用户的电话号码吧。这个openid就是我们要推送给那个用户的唯一标示。</li></ul><div class=pgc-img><img alt=5行代码实现微信模版消息推送，java实现微信推送 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/850b7bc3-89f0-4eb1-84e1-dd4c108fd8c0><p class=pgc-img-caption></p></div><ul><li>3，拿到这些以后，我们就可以去实现微信推送了。推送的代码就只有下面这么点。</li></ul><pre>//1，配置WxMpInMemoryConfigStorage wxStorage = new WxMpInMemoryConfigStorage();wxStorage.setAppId("wx77bb69292323a000");//appidwxStorage.setSecret("29bd368145806115ad6820133e62806e");//appsecretWxMpService wxMpService = new WxMpServiceImpl();wxMpService.setWxMpConfigStorage(wxStorage);//2,推送消息WxMpTemplateMessage templateMessage = WxMpTemplateMessage.builder().toUser("o5kho6DgC7SDry8zCmXuvHJGvrgI")//要推送的用户openid.templateId("Tpln-Eue2obJ0B-8JNkgkiRJaDMPgVeIgGxna982xrg")//模版id.url("https://30paotui.com/")//点击模版消息要访问的网址.build();//3,如果是正式版发送模版消息，这里需要配置你的信息// templateMessage.addData(new WxMpTemplateData("name", "value", "#FF00FF"));// templateMessage.addData(new WxMpTemplateData(name2, value2, color2));//发起推送try {String msg = wxMpService.getTemplateMsgService().sendTemplateMsg(templateMessage);System.out.println("推送成功：" + msg);} catch (Exception e) {System.out.println("推送失败：" + e.getMessage());e.printStackTrace();}</pre><p><strong>三，推送测试</strong></p><p>代码都完成后，我们就可以来测试推送了。测试我们这个分两种</p><ul><li>1，java的单元测试</li><li>2，运行springboot，通过get请求来触发推送</li></ul><p><strong>单元测试</strong></p><pre>package com.qiushi.wxpush;import org.junit.Test;import org.junit.runner.RunWith;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.test.context.SpringBootTest;import org.springframework.test.context.junit4.SpringRunner;import static org.junit.Assert.*;/*** Created by qcl on 2019-03-28* 微信：2501902696* desc:测试用例*/@RunWith(SpringRunner.class)@SpringBootTestpublic class PushControllerTest {@AutowiredPushController pushController;@Testpublic void push() {pushController.push();}}</pre><p>单元测试其实很简单，我们只需要点击箭头所指的绿色按钮，即可运行单元测试，运行通过后就可以看到发送消息成功了。</p><div class=pgc-img><img alt=5行代码实现微信模版消息推送，java实现微信推送 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9fba1dae042c456c97b735a84a8cd832><p class=pgc-img-caption>java单元测试</p></div><p>log里可以看出我们是10:46发起推送的，看下图我们微信接受到的推送消息也是10:46</p><div class=pgc-img><img alt=5行代码实现微信模版消息推送，java实现微信推送 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9b88f019bba44cb7bcdefed2248a257b><p class=pgc-img-caption></p></div><p><strong>运行springboot，通过get请求来触发推送</strong></p><p>这个就更简单了，我们启动springboot项目，然后调用get请求：</p><div class=pgc-img><img alt=5行代码实现微信模版消息推送，java实现微信推送 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9e74cd9254294ef5aaa5b95a97f87cde><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=5行代码实现微信模版消息推送，java实现微信推送 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/864cf973794e4b03af4e3249e71eeec2><p class=pgc-img-caption></p></div><p>image.png</p><p>可以看到我们也推送成功了。</p><p>到这里我们就轻松通过简单几行代码实现了微信模版消息推送的功能了。</p><blockquote><p>我们在企业生产环境时，实现这个功能，步骤和这里是一样的。代码也和这里差不多，只不过多了一个获取用户openid的步骤，这个步骤微信要求比较严格，必须要有备案的网址作为回调，今天就不给大家深入讲解了，后期我会专门写一篇获取微信用户openid的文章出来。</p></blockquote><p>视频讲解：https://edu.csdn.net/course/detail/23750</p><blockquote><p>编程小石头，为分享干货而生！据说，每个年轻上进，颜值又高的互联网人都关注我了</p></blockquote></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'实现','微信','推送'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>