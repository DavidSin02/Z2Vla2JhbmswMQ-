<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>数据传输过程详解 | 极客快訊</title><meta property="og:title" content="数据传输过程详解 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/0907a2193228482d84471d6aeeb3fc90"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/674e4c8e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/674e4c8e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/674e4c8e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/674e4c8e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/674e4c8e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/674e4c8e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/674e4c8e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/674e4c8e.html><meta property="article:published_time" content="2020-11-14T21:03:09+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:09+08:00"><meta name=Keywords content><meta name=description content="数据传输过程详解"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/674e4c8e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>数据传输过程详解</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>一、FTP客户端发送数据到FTP服务器端，详述其工作过程。两台机器的连接情况如下图所示：</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/0907a2193228482d84471d6aeeb3fc90><p class=pgc-img-caption></p></div><p>详细解答如下</p><p>1.1、假设初始设置如下所示：</p><p>客户端FTP端口号为：32768</p><p>服务器端FTP端口号为：21</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/050b3bfdbb6b4aeeaea07a6c8bf4a6b5><p class=pgc-img-caption></p></div><p>1.2、不同网络段上的两台计算机通过TCP/IP协议通讯的过程如下所示：</p><p>协议是水平的，服务是垂直的。</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/51c5cdd37a1043489627ef10887b83df><p class=pgc-img-caption></p></div><p>物理层，指的是电信号的传递方式，透明的传输比特流。</p><p>链路层，在两个相邻结点间的线路上无差错地传送以帧为单位的数据。</p><p>网络层，负责为分组交换网上的不同主机提供通信，数据传送的单位是分组或包。</p><p>传输层，负责主机中两个进程之间的通信，数据传输的单位是报文段。</p><p>网络层负责点到点（point-to-point）的传输（这里的“点”指主机或路由器），而传输层负责端到端（end-to-end）的传输（这里的“端”指源主机和目的主机）。</p><p class=ql-align-justify><br></p><p>1.3、数据包的封装过程</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/9e5ffea700994a94bff3878d4c6eb895><p class=pgc-img-caption></p></div><p>不同的协议层对数据包有不同的称谓，在传输层叫做段（segment），在网络层叫做数据报（datagram），在链路层叫做帧（frame）。数据封装成帧后发到传输介质上，到达目的主机后每层协议再剥掉相应的首部，最后将应用层数据交给应用程序处理。两台计算机在不同的网段中，那么数据从一台计算机到另一台计算机传输过程中要经过一个或多个路由器。</p><p>1.4、工作过程</p><p>（1）在PC1客户端，将原始数据封装成帧，然后通过物理链路发送给Switch1的端口1。形成的帧为：</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fda2876f3d104203888b4f64fd17d9bc><p class=pgc-img-caption></p></div><p>注：发送方怎样知道目的站是否和自己在同一个网络段？每个IP地址都有网络前缀，发送方只要将目的IP地址中的网络前缀提取出来，与自己的网络前缀比较，若匹配，则意味着数据报可以直接发送。也就是说比较二者的网络号是否相同。本题中，PC1和PC2在两个网络段。</p><p>（2）Switch1收到数据并对数据帧进行校验后，查看目的MAC地址，得知数据是要发送给PC2，所以Switch1就对数据帧进行存储转发，查看自己的MAC地址列表后，从端口2将数据转发给路由器的S0端口。</p><p>（3）Router收到数据后，先对数据进行校验，然后对IP数据报进行分析，重新对数据进行封装，查看路由表后，从S1端口将数据发送出去，此时得到新的数据帧如下：</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/73c346c1790742fbb2afb0c586a838ea><p class=pgc-img-caption></p></div><p>注：目的IP和源IP地址不会被改的，改变的是MAC，路由器会把远端的源MAC地址改成下一跳的MAC地址，然后就发送出去</p><p>（4）Switch2接收到Router给它发送的数据后，进行校验后直接存储转发，查看自己的MAC地址列表后，将数据帧从端口1发送给PC2服务器端。</p><p>（5）PC2服务器端收到数据后，先进行校验，然后进行拆分，得到TCP报文段，由此可以知道目的端口号是21，然后把数据交付给相应的FTP应用进程进行处理。</p><p><strong>二、在数据的传输中会出现以下一些问题，该如何解决？</strong></p><p>1、针对数据链路层，传输的数据会出现差错或者丢失的问题，也有两端传输速度不同的问题，如何解决这些问题？</p><p>答：首先我们假设主机A向主机B发送数据</p><p>（1）差错控制</p><p>差错控制方法分两类，一类是自动请求重发ARQ，另一类是前向纠错FEC，也叫前向纠错码(Forward Error Correction简称FEC)。</p><p>在ARQ方式中，当接收端发现差错时，就设法通知发送端重发，直到收到正确的码字为止，ARQ方式只使用检错码。</p><p>在FEC方式中，接收端不但能发现差错，而且能确定二进制码元发生错误的位置，从而加以纠正，FEC方式必须使用纠错码。常用的纠错码有奇偶校验码、循环冗余码和海明码等</p><p>例如：在数据帧中加上CRC，这样主机B就可以检验所接收的数据是否有差错，如果有差错，那么主机B可以向主机A发送一个否认帧NAK，以表示主机A应当重传出现差错的那个数据帧。</p><p>（2）丢失的解决办法</p><p>超时重传。如果主机A在发送完数据给主机B之后，若到了超时计时器所设置的重传时间而还没有收到主机B的任何确认帧ACK，则主机A就重传前面所发送的这一数据帧。</p><p>（3）流量控制</p><p>①假设主机A向主机B传输的数据是无差错的，那么，最简单的流量控制方法就是：发送方每发送一帧数据就暂时停下来，接收方收到数据帧之后就交付给主机，然后发一信息给发送方，表示接收的任务已经完成，这时，发送方再接着发送下一个数据帧。在这种情况下，接收方的接收缓存的大小只要能够装得下一个数据帧即可。</p><p>②滑动窗口：分别在发送端和接收端设置发送窗口和接收窗口</p><p>发送窗口用来对发送端进行流量控制，为发送窗口的大小WT就是代表在还没有收到对方确认信息的情况下发送端最多可以发送多少个数据帧。每收到对一个帧的确认，发送窗口就向前滑动一个位置。由此也可以知道，第一种流量控制发法中，WT=1。</p><p>在接收端设置接收窗口时为了控制可以接收哪些数据而不可以接收哪些数据，在接收端只有当收到的数据帧的发送序号落入接收窗口内才允许将该数据帧收下。每收到一个序号正确的帧，接收窗口就向前滑动一个位置。</p><p>2、IP数据报有它的长度，而数据传输过程中，一些中间设备也有一个相关的设置MTU（最大传输单元），如果现在假设IP数据报的长度是5000字节，而MTU设置是1500字节，那么该怎么办？</p><p>答：解决的办法是对IP数据报进行分片与重组。详细过程如下：</p><p>2.1、 IP v4数据报格式</p><p>一个IP v4数据报由报头和数据两部分组成，其中数据包括高层需要传输的数据，而报头是为了正确传输高层数据而增加的控制信息。报头的前一部分是固定长度，共20字节，是所有IP数据报必须具有的。在报头的固定部分的后面是一些可选字段，其长度是可变的。下图给出了IPv4数据报的格式义。</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/c2170e3d5fc64237b414ac126750510d><p class=pgc-img-caption></p></div><p>IP数据报的格式</p><p>2.2、不同数据链路层协议的MTU值</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/2f390bd2a1cc449fa224976f77c52388><p class=pgc-img-caption></p></div><p>一个路由器可能连接不同MTU的网络，如下图</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/148f2614fb314e4491d0d4f705ac807d><p class=pgc-img-caption></p></div><p>2.3、IP数据报分片</p><p>数据报分片时，每个分片前都要加上相应的IP报头，形成新的IP数据报，除包含一些分片控制域（如标志、偏移量）外，分片的报头和原IP数据报的报头基本一样。</p><p>标识符、标志、偏移量3个字段在IP报头中的作用是：</p><p>标识：占16bit，标识数据报。当数据报长度超出网络最大传输单元（MTU）时，必须要进行分割，并且需要为分割段(fragment)提供标识。所有属于同一数据报的分割段被赋予相同的标识值。</p><p>标志：占3bit，指出该数据报是否可分段。目前只有前两个比特有意义。</p><p>标志字段中的最低位记为MF（More Fragment）。MF=1即表示后面“还有分片”的数据报。MF=0表这已是若干数据报片中的最后一个。</p><p>标志字段中间的一位记为DF（Don’t Fragment）。只有当DF=0时才允许分片。</p><p>片偏移：占13bit，若有分段时，用以指出该分段在数据报中的相对位置，也就是说，相对于用户数据字段的起点，该片从何处开始。片偏移以8字节为偏移单位，即每个分片的长度一定是8字节（64Bit）的整数倍。</p><p>2.4、IP数据报重组</p><p>在最终的目的主机上将接收到的所有分片进行重新组装的过程就是IP数据报重组。这时要根据数据报的标识、标志、偏移量等字段将分段的各个IP数据报重新组装成完整的原始数据报。</p><p>2.5本题的详解过程</p><p>数据报的数据部分为5000字节长（使用固定首部），需要分片长度不超过1500字节的数据报片。因固定首部长度为20字节，因此每个数据报片的长度不能超过1480字节。于是分为4个数据报片，其数据报片的数据部分长度分别为1480字节、1480字节、1480字节和560字节。原始数据报首部被复制为各数据报片的首部，但必须修改有关字段的值。分片结果如下图所示：</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a5692384010b4ee99143895cdd880c25><p class=pgc-img-caption></p></div><p><strong>3、两个主机的应用进程，也会出现差错和丢失，两端的缓存也不同，如何控制流量？应用进程如何与端口号进行匹配？</strong></p><p>答：因为运输层提供的功能是应用进程之间的逻辑通信，所以面向连接的传输控制协</p><p>议TCP就保证了全双工的可靠交付的服务。具体的有关差错控制和流量控制如下面的详细解释：</p><p>3.1、运输层为相互通信的应用进程提供了逻辑通信，如下图所示：</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cf97ccd5c23f42fea7f9f6424675a60b><p class=pgc-img-caption></p></div><p>3.2、TCP发送报文段的示意图如下：</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7d66cfab19e94d798a9c5131ccb77dd3><p class=pgc-img-caption></p></div><p>3.3、TCP 的数据编号与确认</p><p>TCP 协议是面向字节的。TCP 将所要传送的报文看成是字节组成的数据流，并使每一个字节对应于一个序号。</p><p>在连接建立时，双方要商定初始序号。TCP 每次发送的报文段的首部中的序号字段数值表示该报文段中的数据部分的第一个字节的序号。</p><p>TCP 的确认是对接收到的数据的最高序号表示确认。接收端返回的确认号是已收到的数据的最高序号加 1。因此确认号表示接收端期望下次收到的数据中的第一个数据字节的序号。</p><p>3.4、TCP 的流量控制与拥塞控制</p><p>（1）滑动窗口（进行流量控制）</p><p>TCP 采用大小可变的滑动窗口进行流量控制。窗口大小的单位是字节。</p><p>在 TCP 报文段首部的窗口字段写入的数值就是当前给对方设置的发送窗口数值的上限。</p><p>发送窗口在连接建立时由双方商定。但在通信的过程中，接收端可根据自己的资源情况，随时动态地调整对方的发送窗口上限值(可增大或减小)。</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a440d44b569449a086a37d0175da435d><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/01cde309b1bf42c3b7c20f545106c2ae><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/326636ca26394f7db5db5fb681ce4a32><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p>上图（a）表示发送端要发送 900 字节长的数据，划分为 9 个 100 字节长的报文段，而发送窗口确定为 500 字节。发送端只要收到了对方的确认，发送窗口就可前移。发送 TCP 要维护一个指针。每发送一个报文段，指针就向前移动一个报文段的距离。</p><p>上图（b）表示发送端已发送了 400 字节的数据，但只收到对前 200 字节数</p><p>据的确认，同时窗口大小不变。现在发送端还可发送 300 字节。</p><p>上图（c）表示发送端收到了对方对前 400 字节数据的确认，但对方通知发送端必须把窗口减小到 400 字节。现在发送端最多还可发送 400 字节的数据。</p><p>利用可变窗口大小进行流量控制双方确定的窗口值是 400，如下图所示：</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d7d19a2b1a544fe291abbcd602b27ee9><p class=pgc-img-caption></p></div><p>（2）拥塞控制</p><p>为了更好地进行拥塞控制，因特网标准推荐使用一下三种技术，慢启动(slow_start)、加速递减(multiplicative decrease)和拥塞避免(congestion avoidance)。</p><p>“拥塞避免”并非指完全能够避免了拥塞。利用以上的措施要完全避免网络拥塞还是不可能的。“拥塞避免”是说在拥塞避免阶段把拥塞窗口控制为按线性规律增长，使网络比较不容易出现拥塞。</p><p>3.5、端口号的识别</p><p>（1）端口的概念：</p><p>端口就是运输层服务访问点 TSAP。</p><p>端口的作用就是让应用层的各种应用进程都能将其数据通过端口向下交付给运输层，以及让运输层知道应当将其报文段中的数据向上通过端口交付给应用层相应的进程。</p><p>从这个意义上讲，端口是用来标志应用层的进程。</p><p>（2）端口在进程之间的通信中所起的作用</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f62fa688559543d0b70a79a66327937d><p class=pgc-img-caption></p></div><p>（3）端口号</p><p>端口用一个 16 bit 端口号进行标志。</p><p>端口号只具有本地意义，即端口号只是为了标志本计算机应用层中的各进程。在因特网中不同计算机的相同端口号是没有联系的。</p><p>端口号分为两类：</p><p>一类是熟知端口，其数值一般为 0～1023。当一种新的应用程序出现时，必须为它指派一个熟知端口。</p><p>另一类则是一般端口，用来随时分配给请求通信的客户进程。</p><p>端口的作用可用下图来表示：</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6902b0d5c3204e95bb7f8807690fdf97><p class=pgc-img-caption></p></div><p>（4）插口</p><p>TCP 使用“连接”(而不仅仅是“端口”)作为最基本的抽象，同时将 TCP 连接的端点称为插口(socket)，或套接字、套接口。插口包括IP地址(32bit)和端口号(16bit)，共48bit。插口和端口、IP 地址的关系是：</p><div class=pgc-img><img alt=数据传输过程详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a22d13009706449a9e0d9c6c0fda144e><p class=pgc-img-caption></p></div><p class=ql-align-center>---END---</p><p class=ql-align-justify></p><p class=ql-align-justify>本文来源：EDN电子技术设计</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'数据','传输','过程'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../cn/%E7%A7%91%E5%AD%A6/81b4c00c.html alt="在数据传输过程中的CRC 算法的简单说明" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/20b135a5-23ea-4f80-82c4-f5c8e793a748 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E5%AD%A6/81b4c00c.html title="在数据传输过程中的CRC 算法的简单说明">在数据传输过程中的CRC 算法的简单说明</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>