<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>SpringCloudé…ç½®ä¸­å¿ƒåŠ¨æ€åŠ è½½(åˆ·æ–°)é…ç½®æ–‡ä»¶ | æå®¢å¿«è¨Š</title><meta property="og:title" content="SpringCloudé…ç½®ä¸­å¿ƒåŠ¨æ€åŠ è½½(åˆ·æ–°)é…ç½®æ–‡ä»¶ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/34fe298ec0264860939b532c4cf0e0b6"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6760f5e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6760f5e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6760f5e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6760f5e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6760f5e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6760f5e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6760f5e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6760f5e.html><meta property="article:published_time" content="2020-10-29T20:59:54+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:54+08:00"><meta name=Keywords content><meta name=description content="SpringCloudé…ç½®ä¸­å¿ƒåŠ¨æ€åŠ è½½(åˆ·æ–°)é…ç½®æ–‡ä»¶"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/6760f5e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>SpringCloudé…ç½®ä¸­å¿ƒåŠ¨æ€åŠ è½½(åˆ·æ–°)é…ç½®æ–‡ä»¶</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>å‰è¨€</h1><p>ç°åœ¨çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨ä¸€ä¸ªä¸­é—´ä»¶ä½œä¸ºé…ç½®ä¸­å¿ƒï¼Œç›®çš„æ˜¯å®ç°åœ¨å¤šæœåŠ¡å™¨é›†ç¾¤çš„åœºæ™¯ä¸‹ï¼Œåªéœ€è¦ç»Ÿä¸€ä¿®æ”¹é…ç½®ä¸­å¿ƒçš„é…ç½®æ–‡ä»¶ï¼Œç„¶åæ‰€æœ‰çš„æœåŠ¡å™¨å…¨éƒ¨è·å–é…ç½®ä¸­å¿ƒæœ€æ–°çš„é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼ŒæœåŠ¡å™¨ä¸ç”¨é‡æ–°å¯åŠ¨ï¼Œå³å¯ä»¥åœ¨æ‰€æœ‰çš„æœåŠ¡å™¨ä¸Šé¢ç”Ÿæ•ˆã€‚è¦æƒ³å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå®ƒçš„åŸç†å¤§æ¦‚å¦‚ä¸‹ï¼š</p><p>åœºæ™¯1:æœåŠ¡å™¨é¦–æ¬¡å¯åŠ¨-->è·å–é…ç½®ä¸­å¿ƒæœ€æ–°çš„é…ç½®-->ç„¶åå®ä¾‹åŒ–beanï¼Œå¹¶æ ¹æ®é…ç½®æ–‡ä»¶ä¿¡æ¯åˆå§‹åŒ–beançš„æ‰€æœ‰çš„å±æ€§ã€‚è¿™ä¸ªåœºæ™¯å¾ˆå¥½ç†è§£ï¼Œé‚£äº›åŸæœ¬é…ç½®åœ¨æœ¬åœ°çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¿™æ ·ä½¿ç”¨çš„ï¼Œåªä¸è¿‡é…ç½®ä¸­å¿ƒçš„é…ç½®ï¼Œéœ€è¦è¿œç¨‹è·å–ä¸€ä¸‹ã€‚</p><p>åœºæ™¯2:é…ç½®ä¸­å¿ƒé…ç½®ä¿¡æ¯ä¿®æ”¹->é€šçŸ¥æœåŠ¡å™¨è·å–æœ€æ–°çš„é…ç½®-->è·å–åˆ°æœ€æ–°çš„é…ç½®åï¼Œé”€æ¯æ‰€æœ‰çš„bean-->é‡æ–°å®ä¾‹åŒ–æ‰€æœ‰çš„beanï¼Œç„¶åæ ¹æ®æœ€æ–°çš„é…ç½®æ–‡ä»¶ä¿¡æ¯åˆå§‹åŒ–æ‰€æœ‰çš„beanå±æ€§ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯SpringCloudæ¡†æ¶ï¼Œç»™æˆ‘ä»¬å®ç°çš„é…ç½®ä¸­å¿ƒåŠ¨æ€åŠ è½½(åˆ·æ–°)é…ç½®æ–‡ä»¶ã€‚</p><p>æ³¨ï¼šä¸‹é¢æ‰€è¯´çš„Springæ¡†æ¶åŒ…å«:Spring FrameWorkï¼ŒSpring Bootï¼ŒSpring Cloudã€‚</p><h1 class=pgc-h-arrow-right>Springæ¡†æ¶å®ç°</h1><p>åœ¨Springæ¡†æ¶ä¸­æ˜¯è¿™æ ·å®ç°çš„ã€‚</p><p>1.åœ¨ç±»ä¸ŠåŠ @RefreshScopeæ³¨è§£ã€‚</p><p>2.åœ¨å±æ€§ä¸­å¼•å…¥@Valueæ³¨è§£</p><p>3.æ‰‹åŠ¨è°ƒç”¨åˆ·æ–°http://localhost:8080/refreshï¼Œæˆ‘çŒœæƒ³è¿™ä¸ªæ¥å£ä¼šè§¦å‘é”€æ¯æ‰€æœ‰æ³¨è§£äº†@RefreshScopeæ³¨è§£çš„beanï¼Œç„¶åå†åç»­ä½¿ç”¨beançš„æ—¶å€™åœ¨å®ä¾‹åŒ–ï¼Œåˆå§‹åŒ–ã€‚å› ä¸ºæ²¡æœ‰çœ‹æºç ï¼Œæˆ‘çŒœæƒ³æ˜¯è¿™ä¸ªåŸç†ã€‚</p><div class=pgc-img><img alt=SpringCloudé…ç½®ä¸­å¿ƒåŠ¨æ€åŠ è½½(åˆ·æ–°)é…ç½®æ–‡ä»¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/34fe298ec0264860939b532c4cf0e0b6><p class=pgc-img-caption></p></div><p>æ–°ç‰ˆæœ¬ä¸­éœ€è¦å¼•å…¥actuatorï¼Œå¹¶æ·»åŠ å¦‚ä¸‹çš„é…ç½®ï¼Œæ¥æš´éœ²refreshæ¥å£ã€‚</p><div class=pgc-img><img alt=SpringCloudé…ç½®ä¸­å¿ƒåŠ¨æ€åŠ è½½(åˆ·æ–°)é…ç½®æ–‡ä»¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/bc70b46b75fe46c79474d6e87982ba26><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=SpringCloudé…ç½®ä¸­å¿ƒåŠ¨æ€åŠ è½½(åˆ·æ–°)é…ç½®æ–‡ä»¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/37be0f1afa3c46ab834476c7a3e45de4><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>æºç åˆ†æ</h1><p>æ¥çœ‹ä¸€ä¸‹è°ƒç”¨è¿‡ç¨‹ã€‚</p><pre><code>@Endpoint(id = "refresh")public class RefreshEndpoint {   private ContextRefresher contextRefresher;      public RefreshEndpoint(ContextRefresher contextRefresher) {      this.contextRefresher = contextRefresher;     }   @WriteOperation       public Collection&lt;String&gt; refresh() {      //refreshæ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨æ­¤é€»è¾‘     Set&lt;String&gt; keys = this.contextRefresher.refresh(); //å®é™…è°ƒç”¨ContextRefresherå»åšçš„åˆ·æ–°é€»è¾‘          return keys;      }}//this.contextRefresher.refresh();æ–¹æ³•public synchronized Set&lt;String&gt; refresh() {		Set&lt;String&gt; keys = refreshEnvironment();		this.scope.refreshAll();//å®é™…è°ƒç”¨è¿™ä¸ªæ–¹æ³•å»åˆ·æ–°		return keys;	}//this.scope.refreshAll();æ–¹æ³•@ManagedOperation(description = "Dispose of the current instance of all beans "			+ "in this scope and force a refresh on next method execution.")	public void refreshAll() {		super.destroy();//é”€æ¯æ‰€æœ‰çš„bean		this.context.publishEvent(new RefreshScopeRefreshedEvent());//å‘å¸ƒåˆ·æ–°äº‹ä»¶	}</code></pre><p>æˆ‘è‡ªå·±çš„ç–‘æƒ‘æ˜¯ï¼š</p><p>æˆ‘ç”¨zookeeperä½œä¸ºé…ç½®ä¸­å¿ƒï¼Œæˆ‘å‘ç°æˆ‘åœ¨zookeeperä¸Šé¢ä¿®æ”¹äº†é…ç½®ä¿¡æ¯ï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­è‡ªåŠ¨å°±ç”Ÿæ•ˆäº†ï¼Œå› ä¸ºæ²¡æœ‰æ‰¾åˆ°æºç ï¼Œæˆ‘çŒœæƒ³æ˜¯Springæ¡†æ¶æœ€ç»ˆåº•å±‚æ˜¯è°ƒç”¨äº†refreshAll()æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘å‘ç°å¯¹è±¡æ˜¯æ²¡æœ‰è¢«é‡æ–°å®ä¾‹åŒ–çš„ï¼Œå› ä¸ºé€šè¿‡IDEè°ƒè¯•æ—¶ï¼Œå¯¹è±¡çš„ç¼–ç è¿˜æ˜¯å’Œä»¥å‰ä¸€æ ·ï¼Œå¦‚ä¸‹å›¾ã€‚</p><p><br></p><div class=pgc-img><img alt=SpringCloudé…ç½®ä¸­å¿ƒåŠ¨æ€åŠ è½½(åˆ·æ–°)é…ç½®æ–‡ä»¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/11ff90b45781473cbda14dec88dbe9d5><p class=pgc-img-caption></p></div><p>å¸¦ç€è¿™ä¸ªç–‘æƒ‘ï¼Œç»§ç»­çœ‹æºç ä¸­...</p><p>åç»­ï¼š</p><p>1.å½“ä¿®æ”¹zookeeperé…ç½®ä¸­å¿ƒçš„é…ç½®æ—¶ï¼ŒRefreshEventListenerç›‘å¬å™¨ä¼šè¢«è§¦å‘ï¼Œéƒ¨åˆ† æºç å¦‚ä¸‹ï¼š</p><pre><code>private ContextRefresher refresh;public void handle(RefreshEvent event) {   if (this.ready.get()) { // don't handle events before app is ready          log.debug("Event received " + event.getEventDesc());          Set&lt;String&gt; keys = this.refresh.refresh();  //å®é™…è°ƒç”¨ContextRefresherå»åšçš„åˆ·æ–°é€»è¾‘ï¼Œ     //ä¸æ‰‹åŠ¨è°ƒç”¨   æœ€ç»ˆè§¦å‘çš„é€»è¾‘æ˜¯ä¸€æ ·çš„ã€‚      log.info("Refresh keys changed: " + keys);   }}</code></pre><p>åœ¨ContextRefresheræ–¹æ³•ä¸­ä¼šè§¦å‘é…ç½®ä¿¡æ¯åˆ·æ–°çš„é€»è¾‘ï¼Œéƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p><pre><code>public synchronized Set&lt;String&gt; refreshEnvironment() {   Map&lt;String, Object&gt; before = extract(         this.context.getEnvironment().getPropertySources());           addConfigFilesToEnvironment();  //è¿™ä¸ªé€»è¾‘ä¼šè§¦å‘é‡æ–°å»zookeeperè·å–æœ€æ–°çš„é…ç½®ä¿¡æ¯       Set&lt;String&gt; keys = changes(before,  extract(this.context.getEnvironment().getPropertySources())).keySet();     this.context.publishEvent(new EnvironmentChangeEvent(this.context, keys));     return keys;//è¿”å›å€¼æ˜¯valueå€¼æ”¹å˜äº†çš„keyé›†åˆ}</code></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'é…ç½®æ–‡ä»¶','SpringCloud','åŠ¨æ€'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>