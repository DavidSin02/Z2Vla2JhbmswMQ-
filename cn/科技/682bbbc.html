<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>MCS-51的中断结构与控制 | 极客快訊</title><meta property="og:title" content="MCS-51的中断结构与控制 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/16bd3171850a4d7d8e27ab5c0bda78f3"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/682bbbc.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/682bbbc.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/682bbbc.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/682bbbc.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/682bbbc.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/682bbbc.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/682bbbc.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/682bbbc.html><meta property="article:published_time" content="2020-10-29T20:50:02+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:02+08:00"><meta name=Keywords content><meta name=description content="MCS-51的中断结构与控制"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/682bbbc.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>MCS-51的中断结构与控制</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>MCS-51的中断源及中断结构</h1><p><strong>(一)中断源</strong></p><p>向CPU发出中断请求的信号称为中断源。在2.1.2节中我们已经了解到MCS-51系列单片机中有5个中断源，其中2个外部中断源，3个内部中断源，具体如下：</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/16bd3171850a4d7d8e27ab5c0bda78f3><p class=pgc-img-caption></p></div><p>：外部中断，由引脚P3.2引入中断请求。</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c56e980693884a48890df7f33b269000><p class=pgc-img-caption></p></div><p>：外部中断，由引脚P3.3引入中断请求。</p><p>➢ 定时计数器T0： 内部中断，定时计数器0溢出时发出中断请求。</p><p>➢ 定时计数器T1： 内部中断，定时计数器1溢出时发出中断请求。</p><p>➢ 串行口中断： 内部中断，包括串行接收中断RI和串行发送中断TI。</p><p>MCS-51单片机自然优先级如表4-1所示。</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6a3902fbdfaf4a5cb87e3f6b85b10d63><p class=pgc-img-caption>表4-1　优先级的排列</p></div><p><strong>(二)中断结构</strong></p><p>MCS-51系列单片机的中断系统结构如图4-2所示。</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e0530061af4e46a98fcd8834ac35b8c2><p class=pgc-img-caption>图4-2　MCS-51中断结构</p></div><p>由图4-2可以看出，中断系统中涉及TCON、SCON、IE以及IP四个特殊功能寄存器，它们主要有以下功能：</p><p>➢ 锁存中断请求标志： TCON和SCON锁存各中断源的中断请求标志位。</p><p>➢ 中断允许寄存器IE： 控制CPU是否响应中断源的请求。</p><p>➢ 中断优先级寄存器IP： 设置各中断源的优先级，每个中断源可编程为高优先级中断或低优先级中断。</p><p>1. TCON中的中断标志位</p><p>TCON的字节地址为88H，可进行位寻址，其具体的结构、位名称、位地址以及功能如表4-2所示。</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8770e44e52c64b699e91bbf70a86aec1><p class=pgc-img-caption>表4-2　TCON的结构、位名称、位地址以及功能</p></div><p>IT0(D0位)： 外部中断</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d6a917b8b86c401dbd94981539394849><p class=pgc-img-caption></p></div><p>的触发方式控制位，由软件进行置“1”和清“0”。IT0=1时，为边沿触发方式(即当引脚P3.2出现下降沿脉冲信号时，中断请求有效);IT0=0时，为电平触发方式(即当引脚P3.2为低电平信号时，中断请求有效)。</p><p>IE0(D1位)： 外部中断</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d6a917b8b86c401dbd94981539394849><p class=pgc-img-caption></p></div><p>的请求标志位。当CPU检测到外部中断请求时，该标志位置“1”，当CPU转向中断处理子程序时，由硬件自动清“0”(只适用于边沿触发方式)。</p><p>注意</p><p>在电平触发方式中，CPU转向中断处理子程序时，不能自动清除IE标志位，也不能由软件进行清除。所以在中断返回前需撤销引脚上的低电平，否则就会产生CPU多次响应一次中断的错误。</p><p>IT1(D2位)和IE1(D3位)： 外部中断</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/91f2ec432856434985e593b8f09d64d6><p class=pgc-img-caption></p></div><p>的触发方式控制位和请求标志位，其</p><p>含义与IT0和IE0相同。</p><p>➢ TR0(D4位)： 定时计数器T0的启动停止标志位，由用户编程确定。TR0=1时，定时器开始计数(即从设定的初值作加1计数);TR0=0时，定时器停止。</p><p>➢ TF0(D5位)： 定时计数器T0的中断溢出标志位。定时器作加1计数，当最高位产生进位时，定时器计数溢出，此时，由硬件置位TF0=1，CPU响应中断后，由硬件清“0”，TF0=0。</p><p>➢ TR1(D6位)和TF1(D7位)： 定时计数器T0的启动停止标志位和中断溢出标志位，其含义与TR0和TF0相同。</p><p>2. SCON中的中断标志位</p><p>SCON的字节地址为98H，可进行位寻址，其具体的结构、位名称、位地址以及功能如表4-3所示。</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/19fe8a92b11d4eceb7c8d9495e2a3f06><p class=pgc-img-caption>表4-3　SCON的结构、位名称、位地址以及功能</p></div><p>➢ RI： 串行口接收中断标志位，当串行口接收到一帧数据时，RI置1，CPU响应中断后，硬件不能自动清除RI，需要由软件清“0”。</p><p>➢ TI： 串行口发送中断标志位，当串行口发送一帧数据时，T1置1，CPU响应中断后，硬件不能自动清除RI，同样需要由软件清“0”。</p><p>提示</p><p>RI和TI通过一个或门向CPU发中断请求，CPU响应中断请求后，首先需要判断是RI和TI哪一个中断源发出的请求，才能去执行相应的中断子程序。</p><p>串行中断的有关内容以及SCON中的其他标志位含义将在项目六中进行详细讲述。</p><p>3. 中断允许控制寄存器IE</p><p>IE控制所有中断源的开放和屏蔽，字节地址为A8H，可进行位寻址，其具体的结构、位名称、位地址以及控制的相应中断源如表4-4所示。</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/93d2cad36cec4b578fd0a7229e4289bc><p class=pgc-img-caption>表4-4　IE的结构、位名称、位地址以及功能</p></div><p>EX0： 外部中断</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9e04a871dadf49fab18236d5361d5ba1><p class=pgc-img-caption></p></div><p>的中断允许控制位。EX0=1时，</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9e04a871dadf49fab18236d5361d5ba1><p class=pgc-img-caption></p></div><p>开中断;EX0=0时，</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9e04a871dadf49fab18236d5361d5ba1><p class=pgc-img-caption></p></div><p>关中断。</p><p>➢ ET0： 定时计数器T0中断允许控制位。ET0=1时，T0开中断;ET0=0时，T0关中断。</p><p>EX1： 外部中断</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b9cc1aa3dc5a4c47b7a5680df498d5d5><p class=pgc-img-caption></p></div><p>的中断允许控制位。EX1=1时，</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b9cc1aa3dc5a4c47b7a5680df498d5d5><p class=pgc-img-caption></p></div><p>开中断;EX1=0时，</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b9cc1aa3dc5a4c47b7a5680df498d5d5><p class=pgc-img-caption></p></div><p>关中断。</p><p>➢ ET1： 定时计数器T1中断允许控制位。ET0=1时，T1开中断;ET0=0时，T1关中断。</p><p>➢ ES： 串行口中断允许控制位。ES=1时，串行口开中断;ES=0时，串行口关中断。</p><p>➢ EA： CPU中断允许控制位。EA=1时，CPU全部开中断;EA=0时，CPU全部关中断。</p><p>提示</p><p>CPU复位时，IE各位清0，禁止所有中断。</p><p>4. 中断优先级控制寄存器IP</p><p>MCS-51单片机中有两个中断优先级，中断优先级控制寄存器IP用来定义每个中断源的中断优先级。IP的结构、位名称、位地址以及控制的中断源如表4-5所示。</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/aa9ba68055134d7e9aa6c7d499bcf0a7><p class=pgc-img-caption>表4-5　IP的结构、位名称、位地址以及功能</p></div><p>IP的状态由用户来设定，某位为1，则相应的中断源处于高优先级中断;某位为0，则相应的中断源处于低优先级中断。</p><p>提示</p><p>单片机复位时，IP各位清0，各中断源处于低优先级中断。</p><h1>MCS-51的中断处理过程</h1><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2ace12855c904aea987f25ed76e0e2a1><p class=pgc-img-caption>图4-3　中断处理过程</p></div><p>中断处理过程如图4-3所示，单片机工作时，在每个机器周期中都去查询各个中断标记位，如果某位是“1”，就说明有中断请求了;接下来需要判断中断请求是否满足响应条件;如果满足响应条件，CPU将进行相应的中断处理;中断处理完毕，进行中断返回，继续执行指令。</p><p>如果本次查询中没有中断请求或中断请求不能满足响应条件，CPU将继续原来的指令执行操作。</p><p><strong>(一)中断响应</strong></p><p>CPU检测到中断请求后，需要判断此中断请求是否满足响应条件，中断响应条件如下：</p><p>(1)CPU开中断，申请中断请求的中断源开中断。</p><p>(2)没有响应同级别或更高级别的中断。</p><p>提示</p><p>中断二级嵌套的响应原则：</p><p>① 同一中断优先级中，有多个中断请求时，按自然优先级进行响应(即查询顺序)。</p><p>② 当前进行的中断只能被高优先级的中断所打断(同级别或低优先级的中断请求不予响应)。</p><p>(3)当前处在所执行指令的最后一个周期。单片机有单周期指令、双周期指令、三周期指令和两个四周期指令，如果正在执行的是多字节指令，需要等整条指令执行结束，才能响应中断。</p><p>(4)如果正执行的指令是返回指令(RETI)或访问IP、IE寄存器的指令，那么CPU将至少再执行一条指令才能响应中断。</p><p>满足中断条件的情况下，CPU响应中断过程如下：</p><p>① 将IP中相应的优先级控制位置1，以阻断后来的同级和低级的中断请求。</p><p>② 撤销该中断源的中断请求标志，否则，中断返回后将重复响应该中断。</p><p>③ 保护断点地址，程序转向执行中断服务子程序。</p><p>提示</p><p>中断响应时间：</p><p>以外部中断0为例，INT0的引脚电平在每个机器周期的S5P2时刻经反相器锁存到TCON的IE0标志位，CPU在下一个机器周期查询新置入的IE0和IE1，满足相应条件，CPU将执行一条两个机器周期的长调用指令LCALL，由硬件将中断矢量地址装到PC中，使程序转入中断矢量入口。所以，从产生外部中断到中断执行，至少需要3个机器周期。</p><p>若正在处理的程序为RETI或访问IP，IE等，则额外等待的时间不会多于5个机器周期。所以外部中断的响应时间在3～8个机器周期之间。</p><p><strong>(二)中断处理</strong></p><p>中断处理过程一般可以分为保护现场、执行中断服务程序和恢复现场三个过程。</p><p>(1)保护现场</p><p>执行中断服务子程序之前，CPU只保护了一个地址(PC的值)，如果主程序和中断服务子程序中都用到一些公共存储空间(如A、PSW和DPTR等)，那么执行中断服务子程序前需要将这些数据保存起来，以免返回主程序时出现错误。</p><p>(2)执行中断服务程序</p><p>在MCS-51系列单片机中，五个中断源都有它们各自的中断入口地址。</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fd7fb5e4b8bc4ff4a399cf9adbfbf699><p class=pgc-img-caption></p></div><p>：0003H</p><p>➢ T0： 000BH</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1eea9948d927415f9fab808b85ef3285><p class=pgc-img-caption></p></div><p>：0013H</p><p>➢ T1： 001BH</p><p>➢ 串口中断： 0023H</p><p>可以看出，中断服务程序的存储空间很小，如果我们需要的程序超出了空间的限制，这时可以在中断处安排一条LJMP指令把中断服务程序跳转到其他地址。</p><p>提示</p><p>中断响应标志的清除：</p><p>CPU在响应中断请求后，该中断的中断请求在中断返回前应当清除，以免重复中断，被再次响应。</p><p>边沿触发的外部中断，定时器中断，均有硬件自动清除;串行口中断，需由软件清除;电平触发的外部中断需由外接触发器控制清除。</p><p>(3)恢复现场</p><p>恢复现场和保护现场相对，返回主程序前需要将保护现场过程中压入堆栈的相关数据弹出，以保证程序返回断点时能正确执行。</p><p><strong>(三)中断返回</strong></p><p>中断返回由中断返回指令RETI来实现。这条指令的功能是把断点地址从堆栈中弹出，送回到程序计数器PC;通知中断系统已完成中断处理，并同时清除优先级状态。</p><h1>C51中断函数的定义</h1><p>C51编译器支持在C源程序中直接开发中断过程，C51编译器及其对C语言的扩充允许编程者对中断所有方面的控制和寄存器组的使用。中断服务函数的完整语法如下：</p><p>函数的返回值 函数名([参数]) interrupt n [using m]</p><p>{</p><p>函数体;</p><p>}</p><p><strong>关于函数的使用进行以下说明：</strong></p><p>(1)对中断程序而言，函数的返回值和参数一般为void。</p><p>(2)interrupt n 中n的取值为0～31的常数，不允许用表达式，表示中断向量的编号。在8051中，一般0代表外部中断0，1代表定时器0，2代表外部中断1，3代表定时器1，4代表串行中断。</p><p>(3)using m 中m的取值为0～3的常数，不允许用表达式，表示内部RAM中的第r组工作寄存器。在调用中断函数时，要求中断过程调用的函数所使用的寄存器组必须与其相同。</p><p>下面我们看一个使用C51语言编写的中断程序。</p><p>【例】 设单片机的fosc=12MHz，要求用T0的方式1编程，在P1.0脚输出周期为2ms的方波。</p><p>用C语言编写的中断服务程序如下：</p><div class=pgc-img><img alt=MCS-51的中断结构与控制 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/9f988914fa094fe8b1f10e27346e2377><p class=pgc-img-caption></p></div><p>在编写中断服务程序时必须注意不能进行参数传递，不能有返回值。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'MCS','51','中断'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>