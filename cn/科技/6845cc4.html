<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>SpringBoot获取配置文件，就这么简单 | 极客快訊</title><meta property="og:title" content="SpringBoot获取配置文件，就这么简单 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/32a771927a234585855909887759b126"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6845cc4.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6845cc4.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6845cc4.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6845cc4.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6845cc4.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6845cc4.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6845cc4.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6845cc4.html><meta property="article:published_time" content="2020-10-29T20:59:54+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:54+08:00"><meta name=Keywords content><meta name=description content="SpringBoot获取配置文件，就这么简单"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/6845cc4.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>SpringBoot获取配置文件，就这么简单</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><br></p><div class=pgc-img><img alt=SpringBoot获取配置文件，就这么简单 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/32a771927a234585855909887759b126><p class=pgc-img-caption></p></div><p>在讲SpringBoot 获取配置文件之前我们需要对SpringBoot 的项目有一个整体的了解，如何创建SpringBoot 项目，项目结构等等知识点，我在这里就不一一讲述了，没有学过的小伙伴可以自己在网上找一些资料进行学习，很简单的。</p><p>下面让我们开始今天的内容讲解吧。</p><h2 class="md-end-block md-heading">一、SpringBoot 全局配置文件的加载顺序</h2><p>在SpringBoot 当中，全局配置文件有两种不同的格式，一个是我们常见的properties, 一种是yml.</p><p>这两种格式的文件其实也没什么太大的区别，使用的时候按照个人的习惯来就行，下面我们用的是yml文件。</p><p>首先，当我们创建SpringBoot 的项目时，默认在resources目录下创建一个application.properties文件，这时我们可以在这个文件当中对项目进行配置即可。但是在SpringBoot 中application.properties可以存放在以下几个位置：</p><blockquote><p>file:./config/ 项目根目录下的config文件夹下</p></blockquote><blockquote><p>file:./ 项目根目录下</p></blockquote><blockquote><p>classpath:/config/ 类路径下的config文件夹下</p></blockquote><blockquote><p>classpath:/ 类路径下</p></blockquote><p>文件的加载顺序：即根目录下的config目录下，然后是 根目录下，然后是classpath路径下的config目录下，最后是classpath路径下。</p><div class=pgc-img><img alt=SpringBoot获取配置文件，就这么简单 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8e40946a2c1a4648959e38ac0ae3f8ff><p class=pgc-img-caption></p></div><p>优先级由高到低，高优先级的配置会覆盖低优先级的配置。</p><p>假如：根目录下的config目录下定义端口为8084， 根目录下定义端口为8083 ，classpath路径下的config目录定义端口为8082，classpath路径下定义端口为8081，最后启动，启动的端口为8084 ，高优先级会覆盖低优先级。</p><p>注意： 并不是高优先级的被加载了，低优先级的就不会再加载，实际上是SpringBoot会从这四个位置全部加载主配置文件，并且还能产生互相配置的效果。</p><p>除此外，我们还可以通过spring.config.location来改变默认的配置文件位置。</p><p>项目打包好以后，我们可以使用命令行参数的形式，启动项目的时候来指定配置文件的新位置；指定默认加载的这些配置文件共同起作用形成互补配置。</p><p>在 G盘目录下，创建一个application.yml文件，定义端口为8085</p><p>打包项目，启动命令行：java -jar spring-boot-config-0.0.1-SNAPSHOT.jar --spring.config.location=G:/application.yml 回车运行。</p><p><strong>外部配置加载顺序</strong></p><ol start=0><li>命令行参数eg: java -jar spring-boot-config-0.0.1-SNAPSHOT.jar --server.port=8087</li></ol><p>---- 由jar包外向jar包内进行寻找：</p><p>2、 优先加载带profile</p><p>jar包外部的 application-{profile}.properties或application.yml（带spring.profile）配置文件</p><p>将打好的jar包放在一个目录下，然后在该文件夹下新建一个名为application.yml的文件，其中指定</p><p>port为8082 ，访问路径为/boot ,然后命令行直接启动项目。java -jar spring-boot-config-0.0.1-SNAPSHOT.jar --application.yml</p><h2 class="md-end-block md-heading"><br></h2><p><strong>在讲配置文件之前，我先说一说yml文件配置信息书写格式</strong></p><p>基本数据类型（8种基本数据类型）以k: v 形式书写即可</p><p>比如我在一个实体类（Person）中定义一个 属性（age），类型是 int ,在yml文件中的书写格式如下</p><pre><code>person:  age: 20</code></pre><p>实体类对象（Person）,Map ,k：v 在下一行来写对象的属性和值的关系,注意缩进</p><pre><code>person:  userName: zhans  age: 20</code></pre><pre><code>#另一种行内写法  person: {userName: zhans.age: 20}  </code></pre><p>List ,数组的书写，注意 - 后有空格</p><pre><code>pets: - cat - dog - pig</code></pre><pre><code>#另一种行内写法  pets:{cat,dog,pi}</code></pre><p><br></p><h2 class="md-end-block md-heading">二、SpringBoot 获取配置文件的方式</h2><p><strong>@Value</strong></p><p>创建配置类，由于篇幅问题这里省略了 setter、getter 方法，但是实际开发中这个是必须的，否则无法成功注入，@Component表示把当前配置类注入到Spring容器当中。</p><pre><code>@Componentpublic class PersonConfig {​    @Value("${person.userName}")    private String userName;    @Value("${person.age}")    private int age;    }</code></pre><p>在主配置文件中添加如下配置（application.yml）</p><pre><code>server:  port: 8081person:  userName: hello  age: 20</code></pre><p>测试类：</p><pre><code>@RestControllerpublic class PersonController {    @Autowired    private Person person;​    @RequestMapping(value = "/get",method = RequestMethod.GET)    public String findPerson(){        return "姓名："+person.getUserName()+"年龄："+person.getAge();    }}</code></pre><p>启动项目，访问地址http://localhost:8080/get运行结果：</p><pre><code>姓名：hello年龄：20</code></pre><blockquote><p>所以，我们就可以通过 @Value(${key})的方式获取全局配置文件中的指定配置项。</p></blockquote><p><strong>@ConfigurationProperties</strong></p><p>如果我们需要取 许多个配置项，通过 @Value 的方式去配置项需要一个一个去取，显然有点麻烦。所以我们可以使用 @ConfigurationProperties。</p><blockquote><p>标有 @ConfigurationProperties的类的所有属性和配置文件中相关的配置项进行绑定，绑定之后我们就可以通过这个类去访问全局配置文件中的属性值。</p></blockquote><p>代码实例如下：</p><ol start=0><li>在主配置文件中添加如下配置</li></ol><pre><code>user:  username: admin  password: 123456  map: {k1: v1,k2: v2}  list:    - cat    - dog  person:    userName: hello    age: 20  objects:    - aaa    - bbb    - ccc</code></pre><ol start=0><li>创建配置类，由于篇幅问题这里省略了 setter、getter ，toString 方法，但是实际开发中这个是必须的，否则无法成功注入。</li></ol><pre><code>@Component@ConfigurationProperties(prefix = "user")public class User {    private String  username;    private String password;    private Map&lt;String,String&gt; map;    private Person person;    private List&lt;String&gt; list;    private Object[] objects;​}​</code></pre><blockquote><p>这里 @ConfigurationProperties 有一个 prefix参数，主要是用来指定该配置项在配置文件中的前缀,即user。</p></blockquote><p>测试类</p><pre><code>@RestControllerpublic class PersonController {    @Autowired    private Person person;    @RequestMapping(value = "/findUser",method = RequestMethod.GET)    public String findUser(){        return user.toString();    }}</code></pre><p>我们在页面访问 http://localhost:8081/findUser,页面就显示我们在yml文件中配置的信息了。</p><pre><code>User{username='admin', password='123456', map={k1=v1, k2=v2}, person=com.zfcoding.config.Person@93471e6, list=[cat, dog], objects=[aaa, bbb, ccc]}</code></pre><p>以上的两种方式有什么区别呢？</p><p><strong>@ConfigurationProperties@Value</strong>功能批量注入配置文件的属性一个一个指定松散绑定支持不支持JSR303数据校验支持不支持复杂数据封装支持不支持（Map）</p><p>松散绑定,username 可以用user-name 表示，来获取值</p><p>JSR303数据校验,如果用@Value获取全局配置文件的属性，使用@Validated文件格式校验是不起作用的。</p><p><strong>@PropertySource 注解加载指定的配置文件。</strong></p><p>@PropertySource (value = “ ”) 指明加载类路径下的哪个配置文件来注入值</p><p>创建配置类，由于篇幅问题这里省略了 setter、getter ，toString 方法，但是实际开发中这个是必须的，否则无法成功注入。</p><pre><code>@Component@PropertySource( "classpath:student.properties")@ConfigurationProperties(prefix = "student")public class Student {​    private String sname;}</code></pre><p>在student.properties文件中添加如下配置</p><pre><code>student.sname=admin</code></pre><p>测试类</p><pre><code>@SpringBootTestclass SpringbootExampleApplicationTests {    @Autowired    private DogConfig dogConfig;    @Test    void contextLoads() {       System.out.println("注入的对象："+dogConfig.getName());    }​}</code></pre><p>运行结果：</p><pre><code>Student{sname='admin'}</code></pre><p><strong>@ImportResource 导入Spring 配置文件</strong></p><blockquote><p>@ImportResource 注解用来导入 Spring 的配置文件，如果Spring配置文件 "bean.xml"，从而让配置文件里面的内容生效,通常可以把@ImportResource标注在@SpringBootApplication的启动类上即可。</p></blockquote><p>举例说明：比如我们把PersonService注入到Spring容器当中，通过Spring配置文件的方式操作，代码示例如下：</p><pre><code>public class PersonService {}</code></pre><pre><code>@ImportResource("classpath:bean.xml")@SpringBootApplicationpublic class SpringBootConfigApplication {    public static void main(String[] args) {        SpringApplication.run(SpringBootConfigApplication.class, args);    }}</code></pre><p>Spring的配置文件：bean.xml</p><pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans"       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"&gt; &lt;bean id="personService" class="com.zfcoding.service.PersonService"&gt;&lt;/bean&gt;&lt;/beans&gt;</code></pre><p>测试的案例：</p><pre><code>@SpringBootTestclass SpringBootConfigApplicationTests {    @Autowired    private PersonService personSerivcer;    @Test    void contextLoads() {        System.out.println("注入的对象："+personSerivcer);    }}</code></pre><p>运行的结果：</p><pre><code>注入的对象：com.zfcoding.service.PersonService@5b84f14</code></pre><p>这Spring 中bean的配置实现，但是SpringBoot 推荐我们使用注解开发，那Springboot 中注解是如何实现bean 的注入呢？</p><p>@Configuration:指明当前类是配置类，就是代替上面说到的spring的配置文件.</p><p>@Bean 将方法返回值添加到容器当中，容器中这个组件默认的id 是方法名</p><pre><code>@Configurationpublic class MyConfig {    @Bean    public PersonSerivcer personSerivcer(){        return new PersonSerivcer();    }}</code></pre><p>这样就可以就可以通过注解实现代替Spring 中的配置文件了。</p><h2 class="md-end-block md-heading">三、SpringBoot 的Profile</h2><p>我们这里就以yml文件为例</p><p>第一种是我在 主配置文件编写的时候，文件名可以是 application-{profile}.yml(application-dev.yml, application-prod.yml) ，默认使用 文件application.yml 的配置</p><p><strong>1、如果我们想要使用的application-dev.yml 全局配置文件，在application.yml 指定即可。</strong></p><p>配置实例：</p><p>在application.yml 配置文件中添加如下配置</p><pre><code>spring:  profiles:    active: dev</code></pre><p>在application-dev.ym 配置文件中添加如下配置l</p><pre><code>server:  port: 8080#应用访问的项目路径  servlet:    context-path: /bootperson:   username: 占山</code></pre><p><strong>2、yml支持多文档快方式</strong></p><p>那么，在application-dev.ym 配置文件中添加如下配置l</p><pre><code>spring:  profiles:    active: prod---server:  port: 8080  servlet:    context-path: /zfspring:  profiles: dev---person:  userName: 啊哈server:  port: 8081  servlet:    context-path: /bootspring:  profiles: prod</code></pre><p><strong>3、Program arguments</strong></p><p>　　 在Program arguments中配置参数</p><blockquote><p>--spring.profiles.active=dev</p></blockquote><div class=pgc-img><img alt=SpringBoot获取配置文件，就这么简单 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7ca3631b255346f08ea65446f9263491><p class=pgc-img-caption></p></div><p><strong>4、虚拟机的方式</strong></p><blockquote><p>在VM options下使用命令：-Dspring.profiles.active=prod</p></blockquote><div class=pgc-img><img alt=SpringBoot获取配置文件，就这么简单 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ef84dd0b9a2841cb9408963663d0d0fc><p class=pgc-img-caption></p></div><h2 class="md-end-block md-heading">四、小结</h2><p>实际开发中我们如果如果我们需要取 许多个配置项，就使用@ConfigurationProperties注解，如果只是注入一个属性就使用@Value,</p><p>@PropertySource 注解加载指定的配置文件,@ImportResource 导入Spring 配置文件(这里可以使用注解来替代)。</p><h2 class="md-end-block md-heading">后记</h2><p>由于本人能力有限，若文章有错误的地方，请大家指出，一起交流学习。今天就和大家讲到这里，喜欢我的小伙伴们，动动你的小手点个关注呗。</p><p>欢迎大家关注我的公众号：阿福聊编程，长期更新Java各种技术文章。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'配置文件','SpringBoot','获取'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>