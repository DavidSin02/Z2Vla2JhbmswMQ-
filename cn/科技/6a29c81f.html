<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>grain是一个组件式的RPC框架，灵活且适合与任何框架整合 | 极客快訊</title><meta property="og:title" content="grain是一个组件式的RPC框架，灵活且适合与任何框架整合 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/22f4dc351f4e4534a2e6d8aea99154d4"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6a29c81f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6a29c81f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6a29c81f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6a29c81f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6a29c81f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6a29c81f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6a29c81f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6a29c81f.html><meta property="article:published_time" content="2020-10-29T21:09:13+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:13+08:00"><meta name=Keywords content><meta name=description content="grain是一个组件式的RPC框架，灵活且适合与任何框架整合"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/6a29c81f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>grain是一个组件式的RPC框架，灵活且适合与任何框架整合</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>grain是一个极简的、组件式的RPC框架，灵活且适合渐进学习，可与任何框架整合。同时包含（系统通用多线程模型与消息通讯、多对多关系的分布式锁、基于Servlet的HTTP框架、基于系统通用多线程模型的Websocket框架、支持行级锁的多线程锁）等组件，按需选择组件，不绑架开发者。</p><p>grain架构图及其依赖关系（深颜色的是核心组件强烈推荐）</p><div class=pgc-img><img alt=grain是一个组件式的RPC框架，灵活且适合与任何框架整合 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/22f4dc351f4e4534a2e6d8aea99154d4><p class=pgc-img-caption></p></div><p>核心组件介绍</p><hr><p>1、thread（系统通用多线程模型）</p><p>介绍：完美抽象了客观事物，包含：1、活跃于线程之间的活物，进入动作、离开动作、轮训动作（例如：人可以在线程间切换），2、处理完即销毁的非活物，处理动作（例如：各类消息包处理后即可销毁）。3、优秀的多线程轮训机制，队列机制（生产者与消费者），服务器掌握绝对的控制权。</p><div class=pgc-img><img alt=grain是一个组件式的RPC框架，灵活且适合与任何框架整合 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d9ddc107302648b98126ce47d71a5a0e><p class=pgc-img-caption></p></div><p>使用场景：rpc、distributedlock、threadwebsocket，都是基于此系统通用多线程模型。任何需要多线程的业务都可以使用：例如MMORPG、即时通讯等。</p><p>示例代码：</p><p>1、启动示例，创建10条线程，每条线程3个优先级，每次轮训间隔100毫秒，通过ILog实现类的对象打印日志，锁定线程0条。</p><pre>AsyncThreadManager.init(100, 10, 3, 0, ILog实现类的对象);AsyncThreadManager.start();</pre><p>2、将活物加入线程1、优先级1的进入队列（之后会触发进入动作、之后不断触发轮训动作）</p><pre>AsyncThreadManager.addCycle(ICycle实现类的对象, 1, 1);</pre><p>3、将活物加入线程1、优先级1的离开队列（之后会触发离开动作）</p><pre>AsyncThreadManager.removeCycle(ICycle实现类的对象, 1, 1);</pre><p>4、将非活物加入线程1、优先级1的处理队列（之后会触发处理动作，处理完即销毁）</p><pre>AsyncThreadManager.addHandle(IHandle实现类的对象, 1, 1);</pre><hr><p>2、threadmsg（系统通用多线程模型与消息通讯）。</p><p>介绍：支持与系统通用多线程模型、系统通用多线程模型之间进行消息通讯。可以进行消息配置、消息注册、消息分发、消息回调。</p><p>使用场景：需要系统通用多线程模型的场景，一般都需要进行消息通讯。可以一直跟thread绑定使用。</p><p>示例代码：</p><p>1、初始化，通过ILog实现类的对象打印日志</p><pre>MsgManager.init(true, Ilog日志);</pre><p>2、设置所有关注createuser消息的处理函数在线程1、优先级1进行处理（如果不设置，则随机线程随机优先级处理）</p><pre>ThreadMsgManager.addMapping("createuser", new int[] { 1, 1 });</pre><p>3、注册关注某消息及对应处理函数（第2步消息设置归属哪个线程，对应处理函数就在哪个线程回调）</p><pre>MsgManager.addMsgListener(IMsgListener实现类对象);</pre><p>4、派发createuser消息，携带数据111与额外数据222（第3步所有关注此消息的处理函数，进行回调）</p><pre>ThreadMsgManager.dispatchThreadMsg("createuser", 111, 222);</pre><hr><p>3、rpc（支持多对多关系的RPC框架，含：RPC客户端与RPC服务器）。</p><p>介绍：基于Mina网络层及Protobuf序列化开发的RPC通讯框架，相比7层HTTP通讯，4层TCP通讯消息包更小、传输速度更快、队列化处理消息包、消息包与线程可一一映射配置化，支持多对多关系、断线重连等。</p><div class=pgc-img><img alt=grain是一个组件式的RPC框架，灵活且适合与任何框架整合 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b48c54a44ef74780b5551689ca5c4cd4><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=grain是一个组件式的RPC框架，灵活且适合与任何框架整合 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/abe478ccb7054ff7901f38f85e0aeb7c><p class=pgc-img-caption></p></div><p>使用场景：生产环境内部网络的服务器之间进行消息通讯。</p><p>示例代码：</p><p>1、RPC客户端（启动类test.RPCClientTest.java，直接启动即可连接下面的RPC服务器）</p><p>>>>>>>RPC客户端Demo</p><p>2、RPC服务器（启动类test.RPCServerTest.java，直接启动即可接受上面的RPC客户端连接请求）</p><p>>>>>>>RPC服务器Demo</p><p>3、RPC方式获取数据示例</p><pre>//创建消息包RPCTestC.Builder builder = RPCTestC.newBuilder();builder.setName("RPC服务器你好啊");TcpPacket pt = new TcpPacket("TEST_RPC_C", builder.build());//RPC远程调用，返回结果TcpPacket ptReturn = WaitLockManager.lock(session, pt);</pre><hr><p>4、distributedlock（支持多对多关系的分布式锁，含：分布式锁客户端与分布式锁服务器）。</p><p>介绍：去中心化，支持行级锁（锁某类型的单键值）。不同类型互不影响，相同类型不同键值互不影响。仅当类型与键值都相等时会进行分布式阻塞。</p><p>注意：如果一台服务器已经承担了分布式锁服务器的角色，就不要用该服务器承担别的角色，因为这台服务器的大多数线程都会不时进行线程阻塞，等待锁客户端释放锁。</p><div class=pgc-img><img alt=grain是一个组件式的RPC框架，灵活且适合与任何框架整合 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/90418570aa4346b3990a5f8e5d3a0861><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=grain是一个组件式的RPC框架，灵活且适合与任何框架整合 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b50d36b27fc345d08d160e191b93600d><p class=pgc-img-caption></p></div><p>使用场景：在无中心化的服务器集群中，有很大的意义。不用依赖数据库Mysql，即可保障服务器集群业务的原子性，又大幅度提高服务器集群性能，减少错误的数据库提交。</p><p>获取方式</p><p>转发文章+关注，然后私住回复【GRA】，即可免费获得下载地址</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'框架','grain','一个'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>