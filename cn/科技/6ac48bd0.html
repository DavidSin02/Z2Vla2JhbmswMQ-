<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>如何编写 VS Code 扩展 | Linux 中国 | 极客快訊</title><meta property="og:title" content="如何编写 VS Code 扩展 | Linux 中国 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/699af8d9882b4ec69cdb3ca651b1871b"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6ac48bd0.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6ac48bd0.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6ac48bd0.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6ac48bd0.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6ac48bd0.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6ac48bd0.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6ac48bd0.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6ac48bd0.html><meta property="article:published_time" content="2020-11-14T21:01:00+08:00"><meta property="article:modified_time" content="2020-11-14T21:01:00+08:00"><meta name=Keywords content><meta name=description content="如何编写 VS Code 扩展 | Linux 中国"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/6ac48bd0.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>如何编写 VS Code 扩展 | Linux 中国</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div class=pgc-img><img alt="如何编写 VS Code 扩展 | Linux 中国" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/699af8d9882b4ec69cdb3ca651b1871b><p class=pgc-img-caption></p></div><blockquote><p>通过为流行的代码编辑器编写自己的扩展来添加缺失的功能。</p></blockquote><ul><li>来源：https://linux.cn/article-12310-1.html</li><li>作者：Ashique Hussain Ansari</li><li>译者：Xingyu.Wang</li></ul><p>（本文字数：11836，阅读时长大约：14 分钟）</p><p>Visual Studio Code（VS Code）是微软为 Linux、Windows 和 macOS 创建的跨平台代码编辑器。遗憾的是，微软版本的 VS Code 是在 Microsoft Software License 下发布的，这不是一个开源的许可证。然而，它的源代码是开源的，在 MIT 许可证下由 VSCodium 项目发布。</p><p>VSCodium 和 VS Code一样，支持扩展、内嵌式 Git 控制、GitHub 集成、语法高亮、调试、智能代码补完、代码片段等。换句话说，对于大多数用户来说，使用 VS Code 和 VSCodium 没有什么区别，而且后者是完全开源的！</p><h1 class=pgc-h-arrow-right>什么是 VS Code 扩展？</h1><p>扩展(extension)可以让你为 VS Code 或 VSCodium 添加功能。你可以在 GUI 中或从终端安装扩展。</p><p>你也可以构建自己的扩展。有几个你可能想学习如何构建扩展的原因：</p><ol start=1><li><strong>想要添加一些功能：</strong> 如果缺失你想要的功能，你可以创建一个扩展来添加它。</li><li><strong>为了乐趣和学习：</strong> 扩展 API 允许你探索 VSCodium 是如何工作的，这是一件有趣的事情。</li><li><strong>为了提高您的技能：</strong> 创建扩展可以提高你的编程技能。</li><li><strong>为了成名：</strong> 创建一个对他人有用的扩展可以提高你的公众形象。</li></ol><h1 class=pgc-h-arrow-right>安装工具</h1><p>在你开始之前，你必须已经安装了 Node.js 、 npm 和 VS Code 或 VSCodium 。</p><p>要生成一个扩展，你还需要以下工具： Yeoman ，是一个开源的客户端脚手架工具，可以帮助你搭建新项目；以及 vscode-generator-code ，是 VS Code 团队创建的 Yeoman 生成器。</p><h1 class=pgc-h-arrow-right>构建一个扩展</h1><p>在本教程中，你将构建一个扩展，它可以为应用程序初始化一个 Docker 镜像。</p><p><strong>生成一个扩展骨架</strong></p><p>要在全局范围内安装并运行 Yeoman 生成器，请在命令提示符或终端中输入以下内容：</p><pre><code>npm install -g yo generator-code</code></pre><p>导航到要生成扩展的文件夹，键入以下命令，然后按回车：</p><pre><code>yo code</code></pre><p>根据提示，你必须回答一些关于你的扩展的问题：</p><ul><li><strong>你想创建什么类型的扩展？</strong> 使用上下箭头选择其中一个选项。在本文中，我将只介绍第一个选项，New Extension (TypeScript)。</li><li><strong>你的扩展名称是什么？</strong> 输入你的扩展名称。我的叫 initdockerapp。（我相信你会有一个更好的名字。）</li><li><strong>你的扩展的标识符是什么？</strong> 请保持原样。</li><li><strong>你的扩展的描述是什么？</strong> 写一些关于你的扩展的内容（你可以现在填写或稍后编辑它）。</li><li><strong>初始化 Git 仓库？</strong> 这将初始化一个 Git 仓库，你可以稍后添加 set-remote。</li><li><strong>使用哪个包管理器？</strong> 你可以选择 yarn 或 npm；我使用 npm。</li></ul><p>按回车键后，就会开始安装所需的依赖项。最后显示：</p><blockquote><p>"Your extension <strong>initdockerapp</strong> has been created!"</p></blockquote><p>干的漂亮！</p><h1 class=pgc-h-arrow-right>检查项目的结构</h1><p>检查你生成的东西和项目结构。导航到新的文件夹，并在终端中键入 cd initdockerapp。</p><p>一旦你进入该目录，键入 .code。它将在你的编辑器中打开，看起来像这样。</p><div class=pgc-img><img alt="如何编写 VS Code 扩展 | Linux 中国" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e71fa3dcc4f74dd399850fb8a33326c5><p class=pgc-img-caption>Project file structure in VSCodium （Hussain Ansari, CC BY-SA 4.0 ）</p></div><p><br></p><p>最需要注意的两个文件是 src 文件夹内的 package.json 和 extension.ts。</p><p><strong>package.json</strong></p><p>首先来看看 package.json，它应该是这样的：</p><pre><code>{        "name": "initdockerapp",        "displayName": "initdockerapp",        "description": "",        "version": "0.0.1",        "engines": {                "vscode": "^1.44.0"        },        "categories": [                "Other"        ],        "activationEvents": [                "onCommand:initdockerapp.initialize"        ],        "main": "./out/extension.js",        "contributes": {                "commands": [                        {                                "command": "initdockerapp.initialize",                                "title": "Initialize A Docker Application"                        }                ]        },        "scripts": {                "vscode:prepublish": "npm run compile",                "compile": "tsc -p ./",                "lint": "eslint src --ext ts",                "watch": "tsc -watch -p ./",                "pretest": "npm run compile &amp;&amp; npm run lint",                "test": "node ./out/test/runTest.js"        },        "devDependencies": {                "@types/vscode": "^1.44.0",                "@types/glob": "^7.1.1",                "@types/mocha": "^7.0.2",                "@types/node": "^13.11.0",                "eslint": "^6.8.0",                "@typescript-eslint/parser": "^2.26.0",                "@typescript-eslint/eslint-plugin": "^2.26.0",                "glob": "^7.1.6",                "mocha": "^7.1.1",                "typescript": "^3.8.3",                "vscode-test": "^1.3.0"        }}{        "name": "initdockerapp",        "displayName": "initdockerapp",        "description": "",        "version": "0.0.1",        "engines": {                "vscode": "^1.44.0"        },        "categories": [                "Other"        ],        "activationEvents": [                "onCommand:initdockerapp.initialize"        ],        "main": "./out/extension.js",        "contributes": {                "commands": [                        {                                "command": "initdockerapp.initialize",                                "title": "Initialize A Docker Application"                        }                ]        },        "scripts": {                "vscode:prepublish": "npm run compile",                "compile": "tsc -p ./",                "lint": "eslint src --ext ts",                "watch": "tsc -watch -p ./",                "pretest": "npm run compile &amp;&amp; npm run lint",                "test": "node ./out/test/runTest.js"        },        "devDependencies": {                "@types/vscode": "^1.44.0",                "@types/glob": "^7.1.1",                "@types/mocha": "^7.0.2",                "@types/node": "^13.11.0",                "eslint": "^6.8.0",                "@typescript-eslint/parser": "^2.26.0",                "@typescript-eslint/eslint-plugin": "^2.26.0",                "glob": "^7.1.6",                "mocha": "^7.1.1",                "typescript": "^3.8.3",                "vscode-test": "^1.3.0"        }}</code></pre><p>如果你是 Node.js 开发者，其中一些可能看起来很熟悉，因为 name、description、version 和 scripts 是 Node.js 项目的常见部分。</p><p>有几个部分是非常重要的：</p><ul><li>engines：说明该扩展将支持哪个版本的 VS Code / VSCodium。</li><li>categories：设置扩展类型；你可以从 Languages、Snippets、Linters、Themes、Debuggers、Formatters、Keymaps 和 Other中选择。</li><li>contributes：可用于与你的扩展一起运行的命令清单。</li><li>main：扩展的入口点。</li><li>activationEvents：指定激活事件发生的时间。具体来说，这决定了扩展何时会被加载到你的编辑器中。扩展是懒加载的，所以在激活事件触发之前，它们不会被激活。</li></ul><p><strong>src/extension.ts</strong></p><p>接下来看看 src/extension.ts，它应该是这样的：</p><pre><code>// The module 'vscode' contains the VSCodium extensibility API// Import the module and reference it with the alias vscode in your code belowimport * as vscode from "vscode";const fs = require("fs");const path = require("path");// this method is called when your extension is activated// your extension is activated the very first time the command is executedexport function activate(context: vscode.ExtensionContext) {        // Use the console to output diagnostic information (console.log) and errors (console.error)        // This line of code will only be executed once when your extension is activated        console.log('Congratulations, your extension "initdockerapp" is now active!');               // The command has been defined in the package.json file        // Now provide the implementation of the command with registerCommand        // The commandId parameter must match the command field in package.json        let disposable = vscode.commands.registerCommand('initdockerapp.initialize', () =&gt; {                // The code you place here will be executed every time your command is executed                let fileContent =`                FROM node:alpine                WORKDIR /usr/src/app                COPY package.json .                RUN npm install                               COPY . .                               EXPOSE 3000                CMD ["npm", "start"]                `;                               fs.writeFile(path.join(vscode.workspace.rootPath, "Dockerfile"), fileContent, (err:any) =&gt; {                        if (err) {                                return vscode.window.showErrorMessage("Failed to initialize docker file!");                        }                        vscode.window.showInformationMessage("Dockerfile has been created!");                });        });        context.subscriptions.push(disposable);}// this method is called when your extension is deactivatedexport function deactivate() {}</code></pre><p>这是为你的扩展写代码的地方。已经有一些自动生成的代码了，我再来分析一下。</p><p>注意，vscode.command.registerCommand 里面的 initdockerapp.initialize 和 package.json 里面的命令是一样的。它需要两个参数。</p><ol start=1><li>要注册的命令名称</li><li>执行命令的功能</li></ol><p>另一个需要注意的函数是 fs.writeFile，这是你写在 vscode.command.registerCommand 函数里面的。这将在你的项目根目录下创建一个 Dockerfile，并在其中附加代码来创建一个 Docker 镜像。</p><h1 class=pgc-h-arrow-right>调试扩展</h1><p>现在你已经写好了扩展，是时候调试它了。点击“Run”菜单，选择“Start Debugging”（或者直接按 F5）打开调试窗口。</p><p>在调试窗口里面点击“Add Folder”或“Clone Repository”按钮，打开该项目。</p><p>接下来，用 Ctrl+Shift+P（在 macOS 上，用 Command 键代替 Ctrl）打开命令面板，运行 Initialize A Docker Application。</p><ul><li>第一次运行此命令时，自 VSCodium 启动后，激活函数尚未执行。因此，调用激活函数，并由激活 函数注册该命令。</li><li>如果命令已注册，那么它将被执行。</li></ul><p>你会看到右下角有一条信息，上面写着：Dockerfile has been created!。这就创建了一个 Dockerfile，里面有一些预定义的代码，看起来是这样的：</p><div class=pgc-img><img alt="如何编写 VS Code 扩展 | Linux 中国" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b247e9dfc4e445899c6c9f5191f74bcb><p class=pgc-img-caption>Running the new extension command （Hussain Ansari, CC BY-SA 4.0 ）</p></div><p><br></p><h1 class=pgc-h-arrow-right>总结</h1><p>有许多有用的 API 可以帮助你创建你想要构建的扩展。VS Code 扩展 API 还有许多其他强大的方法可以使用。</p><p>你可以在 VS Code 扩展 API 文档中了解更多关于 VS Code API 的信息。</p><hr><p>via: https://opensource.com/article/20/6/vs-code-extension</p><p>作者： Ashique Hussain Ansari 选题： lujun9972 译者： wxy 校对： wxy</p><p>本文由 LCTT 原创编译， Linux中国 荣誉推出</p><h1 class=pgc-h-arrow-right>点击“了解更多”可访问文内链接</h1></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'编写','VS','Code'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>