<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>C/C++编程笔记：推箱子小游戏，大一学习C语言练手项目 | 极客快訊</title><meta property="og:title" content="C/C++编程笔记：推箱子小游戏，大一学习C语言练手项目 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/2e0e939e0a6945c495eff4c30164d3ae"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6c983d7a.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6c983d7a.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6c983d7a.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6c983d7a.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6c983d7a.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6c983d7a.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6c983d7a.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6c983d7a.html><meta property="article:published_time" content="2020-11-14T20:59:46+08:00"><meta property="article:modified_time" content="2020-11-14T20:59:46+08:00"><meta name=Keywords content><meta name=description content="C/C++编程笔记：推箱子小游戏，大一学习C语言练手项目"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/6c983d7a.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>C/C++编程笔记：推箱子小游戏，大一学习C语言练手项目</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>C语言，作为大多数人的第一门编程语言，重要性不言而喻，很多编程习惯，逻辑方式在此时就已经形成了。这个是我在大一学习 C语言 后写的推箱子小游戏，自己的逻辑能力得到了提升，在这里同大家分享这个推箱子小游戏项目。</p><p>GitHub 仓库地址：github.com/weizhiwen/C…</p><p>先来看看最后的运行的效果。</p><div class=pgc-img><img alt=C/C++编程笔记：推箱子小游戏，大一学习C语言练手项目 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2e0e939e0a6945c495eff4c30164d3ae><p class=pgc-img-caption></p></div><p><br></p><p>这是一个在 Windows Dos 界面的小游戏，界面上有推箱子的地图，使用<strong>#</strong>来代表地图的边界，<strong>P</strong>来代表推箱子的小人，<strong>X</strong>来代表箱子，<strong>O</strong>来代表箱子要推到的目标位置。</p><p><strong>W（w）、S（s）、A（a）、D（d）</strong>分别对应小人向上、下、左、右移动。</p><p>要写这个小游戏，我们面临的问题有以下几个。</p><p>1、游戏地图怎么保存？</p><p>2、游戏怎么运行？</p><p>3、游戏地图怎样在位置固定的情况下不断变化？</p><p>4、小人的移动逻辑怎么写？</p><p>5、游戏怎么结束？</p><h1 class=pgc-h-arrow-right>1、游戏地图怎么保存？</h1><p>C语言中只有基本的数据类型，游戏地图是二维的平面结构，很容易想到使用二维数组来保存游戏地图，代码详情见 GitHub 仓库中的<strong>关卡.h</strong>文件。</p><div class=pgc-img><img alt=C/C++编程笔记：推箱子小游戏，大一学习C语言练手项目 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b053684376be4e6fa5fd5076fbb0500f><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right>2、游戏怎么运行？</h1><p>因为推箱子游戏在游戏结束之前要不断接受用户的输入，所以我们可以设置一个标志来判断游戏是否结束，把这个标志设置为一个 while 循环的条件。在每次循环中，都要接收用户的输入，根据用户输入的值，来进行下一步的操作，在游戏中就是小人的移动方向，上下左右，这里我们可以用一个 switch 语句判断。每一次循环，对应一次用户输入。</p><h1 class=pgc-h-arrow-right>3、游戏地图怎样在位置固定的情况下不断变化？</h1><p>在每次循环中，首先要把当前的地图显示出来，便于用户下一次的移动输入。我们将游戏地图设置为一个全局变量，这样在小人移动后，地图上的字符改变就是永久的，然后打印局部改变的新地图。这样程序不断循环，一遍遍的打印地图，游戏地图上的字符是可以不断改变了，但是地图的位置并不能固定下来。如果我们能刷新界面上的值，不就可以在位置固定的情况下不断变化了。刷新本质就是除旧迎新，即把原来的除去，迎来新的。在程序中，我们可以把原来的界面清除，再把新的界面显示在原来的位置。C语言中可以用system("cls")函数来清除控制台的内容，然后我们再把新的地图内容显示出来。</p><p>小人的移动逻辑属于具体的程序实现，我们放到下面再说，先来说说程序怎么结束。</p><h1 class=pgc-h-arrow-right>4、游戏怎么结束？</h1><p>前面我们说设置一个标志来判断游戏是否结束，但是游戏什么时候结束呢？推箱子的游戏目标是将每个箱子推到目标位置，这是一种游戏结束的情况，由于每次循环都要判断，可以将其写成一个函数。另外，如果用户不想玩了想退出，这也是一种游戏结束的情况，这里我只考虑了这两种情况，至于其他情况，读者可自行考虑。</p><p>到目前位置我们可以写出程序大致的框架了，外部一个大循环，每次循环都是先刷新界面，接收用户输入，处理用户的输入，判断游戏是否结束。</p><div class=pgc-img><img alt=C/C++编程笔记：推箱子小游戏，大一学习C语言练手项目 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/53afdba1d6e9485e99aa47ea750cd31d><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>5、小人的移动逻辑怎么写？</h1><p>在上面的程序截图中，可以看到我把小人的上下左右移动分别写到了四个函数中，分别是 MoveToUp()、MoveToDown()、MoveToLeft()、MoveToRight()。以 MoveToUp() 函数为例，我们来分析小人移动的逻辑。</p><p>理论上，小人是可以上下左右的移动的，但是，由于有地图的限制，小人不能穿墙的，只能在允许的道路上移动，比如下面这种情况，小人想向上移动，肯定是不允许的。</p><div class=pgc-img><img alt=C/C++编程笔记：推箱子小游戏，大一学习C语言练手项目 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8f7b4d165baa491c80f621f277038d9f><p class=pgc-img-caption></p></div><p><br></p><p>而下面这种的情况，小人是可以向上移动的，因为小人上面一格并没有限制物。</p><div class=pgc-img><img alt=C/C++编程笔记：推箱子小游戏，大一学习C语言练手项目 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9cf90fe76cd645e6a2dd751b827d0440><p class=pgc-img-caption></p></div><p><br></p><p>所以我们要对小人理论上可以移动到的那个（下一位置）进行判断，如果不是限制物（箱子和箱子要移动到的位置下面再详细说），小人就可以移动，如果有限制物就不能移动。所以我们需要记录一个座标点的值，这里“下一位置”的参照物可以选取小人当前的位置，游戏开始时，把小人的开始位置作为当前位置。小人向上移动，“下一位置”的横座标就是小人当前位置的横座标减一，纵座标就是小人当前位置的纵座标。然后我们就可以根据“下一位置”的横纵座标找到具体的字符值，如果是空的，就可以移动，如果是箱子要移动的目标位置，小人也可以移动，还有一种情况是“下一位置”是箱子，我们还要考虑箱子的“下一位置”，箱子的下一位置也很好得到。因为小人和箱子是在一条线上移动的，所以在小人向上移动时，箱子的“下一位置”的横座标就是小人“下一位置”的横座标减一，两者的纵座标相同。同样我们也要对箱子“下一位置”的字符值进行判断，如果字符值是空格和箱子可以移动的位置，就是可以移动的。小人向上移动的代码如下：</p><div class=pgc-img><img alt=C/C++编程笔记：推箱子小游戏，大一学习C语言练手项目 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/dc3b6068687f485692842468240ab3b0><p class=pgc-img-caption></p></div><p><br></p><p>小人向下、向左、向右移动的代码也是类似的，无非就是把小人移动的下一座标改一改，向下移动，“下一位置”的横座标就是小人的横座标位置加一，两者纵座标相同，代码详情见 GitHub 仓库中的<strong>控制.cpp</strong>文件。</p><p>到这里整个程序就算是完成了，可以运行整个程序效果如下，能发现哪里有 Bug 吗？</p><div class=pgc-img><img alt=C/C++编程笔记：推箱子小游戏，大一学习C语言练手项目 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4b81a1dc9bb54fefa67a913fd90f13e9><p class=pgc-img-caption></p></div><p><br></p><p>相信细心的你已经发现了，当小人移动到箱子要移动的目标位置，再移出，这个位置就会“消失”，为什么出现这种情况呢？我们在前面总是关注小人要移动的”下一位置“和箱子要移动的“下一位置”，却没有关注在移动之前，这个位置（上一位置）原本的值，我们可以记录这个“上一位置”的值，但是这样考虑的问题就比较多了，尤其是箱子和小人都在箱子要移动的目标位置时，情况很复杂，那么有木有简单的方法呢？其实到现在为止，我们的程序大体上是没什么问题的，只是箱子要移动的目标位置会出现“字符消失”。这只是个小 Bug，把用户当测试的微软是怎么做的呢？系统发行后不停的发布补丁，我们也可以像这样给这个程序打个“补丁”。箱子要移动的位置是不变的，我们可以能不能用一个二维数组来存放这些特殊位置呢？这些特殊位置的值也是特殊的，要不就是目标位置，要不就是箱子，要不就是小人，而不能是空白字符，所以我们可以写一个“补丁”——修复这个 Bug 的函数。当小人移动后，在每个方向的移动函数结尾加上下面这个修复函数。这里判断特殊位置是不是空白字符，如果是空白字符，就将特殊位置的值改为目标位置的字符值，这里是字符 “O”，这样就“修复”了程序的 Bug，“字符消失”的问题也被解决了。</p><div class=pgc-img><img alt=C/C++编程笔记：推箱子小游戏，大一学习C语言练手项目 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/a6730c4847564a17b3fe52fb051f1630><p class=pgc-img-caption></p></div><p><br></p><p>我将程序划分成了不同的文件，GitHub仓库也有程序目录的说明文件，读者在阅读代码时，会注意到<strong>extern</strong>关键字的使用，这个关键字是为了拆分的多个文件之间共用某个变量或者函数。将关卡中的游戏地图更换，就可以实现推箱子的多个关卡，读者有兴趣可自己尝试改进，本文也是起到一个抛砖引玉的作用。</p><p>最后想说的是，写程序很注重逻辑，无论用什么语言，程序的逻辑都是一样的，无非就是哪种语言更方便，更快捷。<strong>写程序真正玩的是逻辑</strong>，只有逻辑清晰，代码才能写得好，否则顶多也是代码的搬运工。</p><p>作者：Wizey</p><p>原文链接：https://juejin.im/post/5b874d4551882542ee71761b</p><hr><p>想要面试成功，自身的技术能力成为面试者的一大难点！自学C/C++编程难度很大，不妨和一些志同道合的小伙伴一起学习成长！</p><p><strong>C语言C++编程学习交流圈子，关注+私信【C/C++编程】</strong>微信公众号：C语言编程学习基地</p><p>有一些源码和资料分享，欢迎转行也学习编程的伙伴，和大家一起交流成长会比自己琢磨更快哦！</p><div class=pgc-img><img alt=C/C++编程笔记：推箱子小游戏，大一学习C语言练手项目 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5d387e4834b94158b6ee90a398c92326><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'C++','编程','笔记'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../cn/%E7%A7%91%E6%8A%80/94aaef2d.html alt=C/C++编程笔记：简单遍历二叉树，遍历源码献上 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/3058ca03-deee-4287-a38c-9163687a0673 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/94aaef2d.html title=C/C++编程笔记：简单遍历二叉树，遍历源码献上>C/C++编程笔记：简单遍历二叉树，遍历源码献上</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/57af4069.html alt=C/C++编程笔记：C语言结构体—位域，如何指定成员变量所占Bit？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1322941786864783877a7707ec15289f style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/57af4069.html title=C/C++编程笔记：C语言结构体—位域，如何指定成员变量所占Bit？>C/C++编程笔记：C语言结构体—位域，如何指定成员变量所占Bit？</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/5727a1aa.html alt=C/C++编程笔记：C语言开发黄金矿工游戏！项目源码分享学习 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b4fcdf4fd6ef4d98b5579675bfb07a87 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/5727a1aa.html title=C/C++编程笔记：C语言开发黄金矿工游戏！项目源码分享学习>C/C++编程笔记：C语言开发黄金矿工游戏！项目源码分享学习</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/35f99da2.html alt="C/C++编程笔记：《C语言》—— 数组知识详解，学编程建议收藏！" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/925551ca-8f79-45eb-91c7-6c36d0ec6953 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/35f99da2.html title="C/C++编程笔记：《C语言》—— 数组知识详解，学编程建议收藏！">C/C++编程笔记：《C语言》—— 数组知识详解，学编程建议收藏！</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/c6f4f655.html alt=C/C++编程笔记：C语言“井字棋”小游戏，井字棋走起来 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/82ab35a2de17490c96eff21a335413b8 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/c6f4f655.html title=C/C++编程笔记：C语言“井字棋”小游戏，井字棋走起来>C/C++编程笔记：C语言“井字棋”小游戏，井字棋走起来</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/72f2884c.html alt=C/C++编程笔记：流行的数字游戏2048，C语言400行源代码分享 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/810e773711f546b1bac33601023ef4e2 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/72f2884c.html title=C/C++编程笔记：流行的数字游戏2048，C语言400行源代码分享>C/C++编程笔记：流行的数字游戏2048，C语言400行源代码分享</a></li><hr><li><a href=../../cn/%E7%A7%91%E5%AD%A6/4bf4a6f.html alt="C/C++编程笔记：VC++6.0环境下调试 C语言 代码的方法和步骤" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/6c4aa61c734e4ad992ab68e994389b41 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E5%AD%A6/4bf4a6f.html title="C/C++编程笔记：VC++6.0环境下调试 C语言 代码的方法和步骤">C/C++编程笔记：VC++6.0环境下调试 C语言 代码的方法和步骤</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>