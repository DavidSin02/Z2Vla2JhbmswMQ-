<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>让你月薪飙升的秘籍：Java性能调优的9个实用技巧 | 极客快訊</title><meta property="og:title" content="让你月薪飙升的秘籍：Java性能调优的9个实用技巧 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/514e1bb8f99a45e6b5d26e4d79b77a17"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6dc3aaf.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6dc3aaf.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6dc3aaf.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6dc3aaf.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6dc3aaf.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6dc3aaf.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6dc3aaf.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6dc3aaf.html><meta property="article:published_time" content="2020-10-29T21:01:26+08:00"><meta property="article:modified_time" content="2020-10-29T21:01:26+08:00"><meta name=Keywords content><meta name=description content="让你月薪飙升的秘籍：Java性能调优的9个实用技巧"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/6dc3aaf.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>让你月薪飙升的秘籍：Java性能调优的9个实用技巧</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>现实里可能没有完美无缺的代码。如果有，那么，过来，我写一段代码给你看。</p><p>Java已经成为了编程语言的骄子。Java 技术具有卓越的通用性、高效性、平台移植性和安全性，广泛应用于PC、数据中心、游戏控制台、科学超级计算机、移动电话和互联网，越来越多的企业在数据结构、算法分析、软件开发等研究设计时，都选择以Java语言作为载体。这说明Java语言已经是人们构建软件系统时主要使用的一种语言。如何让Java程序运行是一回事，而如何让它们跑的快又是另外一回事了......</p><div class=pgc-img><img alt=让你月薪飙升的秘籍：Java性能调优的9个实用技巧 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/514e1bb8f99a45e6b5d26e4d79b77a17><p class=pgc-img-caption></p></div><p>下面我整理了一些Java性能调优的一些技巧，在此和大家浅浅的交流一下。</p><p><strong>Java性能优化的重要性:</strong></p><p>代码优化，一个很重要的课题。可能有些人觉得没用，一些细小的地方有什么好修改的，改与不改对于代码的运行效率有什么影响呢？这个问题我是这么考虑的，就像大海里面的鲸鱼一样，它吃一条小虾米有用吗？没用，但是，吃的小虾米一多之后，鲸鱼就被喂饱了。</p><p>代码优化也是一样，如果项目着眼于尽快无BUG上线，那么此时可以抓大放小，代码的细节可以不精打细磨；但是如果有足够的时间开发、维护代码，这时候就必须考虑每个可以优化的细节了，一个一个细小的优化点累积起来，对于代码的运行效率绝对是有提升的。</p><p><strong>代码优化的目标是：</strong></p><p>减小代码的体积</p><p>提高代码运行的效率</p><p>在我们分享基于Java的性能调优技巧之前，让我们先讨论一下这些通用的性能调优技巧。</p><p><strong>通用性能调优的4个实用技巧</strong></p><p><strong>1. 在必要之前，先不要优化</strong></p><p>这可能是最最重要的性能调优技巧之一。你应该遵循常见的最佳实践，并尝试有效地实现你的用例。但这并不意味着在证明它是必要之前，替换任何标准库或构建复杂的优化。</p><p>在大多数情况下，过早的优化占用了大量的时间，使得代码难以读取和维护。更糟糕的是，这些优化通常不会带来任何好处，因为你花费了大量时间来优化应用程序的非关键部分。</p><p>那么，你如何证明你需要优化某些东西呢?</p><p>首先，你需要确定应用程序代码的速度，例如，为所有API调用指定一个最大响应时间，或者指定在特定时间范围内导入的记录数量。完成之后，你可以度量应用程序的哪些部分太慢而需要改进。当这样做之后，那么请继续看第二个调优技巧。</p><p><strong>2. 使用分析器来找到真正的瓶颈</strong></p><p>在你遵循第一条建议，并确定你的应用程序的某些部分的确需要改进之后，问自己从哪里开始?</p><p>你可以用两种方法来解决这个问题：</p><p>你可以看一下你的代码，从看起来可疑或者你觉得它可能会产生问题的部分开始。</p><p>或者使用分析器，获取代码中每个部分的行为和性能的详细信息。</p><p>至于为什么应该总是遵循第二种方法。</p><p>答案应该很明显，基于分析器的方法能让你更好地理解代码的性能含义，并允许你关注最关键的部分。如果你曾经使用过分析器，你将会惊讶于代码的哪些部分造成了性能问题。然而，很多时候，你的第一次猜想会把你引向错误的方向。</p><p><strong>3. 为整个应用程序创建性能测试套件</strong></p><p>这是另一个帮助你避免许多意想不到问题的一般技巧，这些问题通常发生在性能改进部署到生产环境之后。你应该经常定义测试整个应用程序的性能测试套件，并在你完成性能改进之前和之后运行它。</p><p>这些额外的测试运行将帮助你识别更改的功能和性能方面的影响，并确保你不会发布一个弊大于利的更新。如果你的任务运行于应用程序的多个不同部分比如数据库或缓存，这一点尤其重要。</p><p><strong>4. 首先解决最大的瓶颈问题</strong></p><p>在创建了测试套件并使用分析器对应用程序进行分析之后，你就有了一个需要提高性能的问题列表，这很好，但它仍然不能回答你应该从哪里开始的问题。你可以从那些可以快速搞定的开始，亦或者从最重要的问题开始。</p><p>当然前者很诱人，因为这很快就能出结果。有时，可能需要说服其他团队成员或你的管理层，性能分析是值得的。</p><p>但总的来说，我建议首先着手处理最重要的性能问题。这将为你提供最大的性能改进，而且你可能只需要修复这些问题中的几个就可以解决你的性能需求。</p><p>在了解通用性能调优技巧之后，让我们再来仔细看看一些特定于Java的调优技巧。</p><p><strong>Java性能调优的5个技巧</strong></p><p><strong>1. 使用 StringBuilder</strong></p><p>几乎所有Java代码中你都应该考虑这个问题。避免使用+号。你可能会认为 StringBuilder 只是个语法糖，比如：</p><p>String x = "a" + args.length + "b";</p><p>会编译成</p><div class=pgc-img><img alt=让你月薪飙升的秘籍：Java性能调优的9个实用技巧 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6e73c524238a4f1b91748eef55af047c><p class=pgc-img-caption></p></div><p>但是之后你需要根据条件来修改字符串，会发生什么事情呢？</p><div class=pgc-img><img alt=让你月薪飙升的秘籍：Java性能调优的9个实用技巧 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ad29e73ec7714b359a1d6a1cb85eb4f8><p class=pgc-img-caption></p></div><p>你现在会有第二个 StringBuilder，这个 StringBuilder 本来没有存在的必要，它会消耗堆内存，给 GC 增加负担。你应该这样写：</p><div class=pgc-img><img alt=让你月薪飙升的秘籍：Java性能调优的9个实用技巧 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6c17268d3a0f4d3fac39423d374db941><p class=pgc-img-caption></p></div><p><strong>2. 避免正则表达式</strong></p><p>正则表达式相对便宜和方便。但是如果你在 N.O.P.E 分支 ，那很糟糕了。如果你必须在计算机密集的代码段中使用正则表达式，至少把 Pattern 的引用缓存下来，避免每次都对其重新编译：</p><p>static final Pattern HEAVY_REGEX =</p><p>Pattern.compile("(((X)*Y)*Z)*");</p><p>但是如果你的正则表达式真的很简单，就像</p><p>String[] parts = ipAddress.split("\\.");</p><p>然后你真的最好诉诸普通的 char[] 或基于索引的操作。例如下面一段代码做了同样的事情：</p><div class=pgc-img><img alt=让你月薪飙升的秘籍：Java性能调优的9个实用技巧 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ac4a17f3a76e44489f32835d6731c483><p class=pgc-img-caption></p></div><p>这也说明了为什么你不应该过早进行优化。与 split() 的版本相比，这简直不可维护。</p><p>正则表达式很有用，但需要代价。如果你在 N.O.P.E 分支 ，就必须避免正则表达式的代价。</p><p><strong>3. 不要使用 iterator()</strong></p><p>这个建议不太适用于常规用例，只适用于 N.O.P.E. 分支，但你也可以用用看。编写 Java-5 风格的 foreach 循环很方便。 你可以完全忽略循环内部变量，并编写：</p><p>for (String value : strings) {</p><p>// Do something useful here}</p><p>然而，每当你运行到循环内部时，如果 string 是一个 Iterable，你就要创建一个新的 Iterator 实例。如果你正在使用 ArrayList，这将会在堆上分配一个含 3 个 int 的对象：</p><p>private class Itr implements Iterator&lt;E> {</p><p>int cursor;</p><p>int lastRet = -1;</p><p>int expectedModCount = modCount;</p><p>// ...</p><p>相反，你可以编写以下代码——等价循环体，并且在栈上仅"浪费"一个 int 值，开销低：</p><p>int size = strings.size();for (int i = 0; i &lt; size; i++) {</p><p>String value : strings.get(i);</p><p>// Do something useful here}</p><p>… 或者，你可以选择不改变链表，在数组版本上使用同样的操作：</p><p>for (String value : stringArray) {</p><p>// Do something useful here}</p><p><strong>关键点</strong></p><p>从可写性和可读性以及从 API 设计的角度来看，Iterators、Iterable 和 foreach 循环都是非常有用的。但它们在堆上为每次单独的迭代创建一个小的新实例。 如果你运行这个迭代许多次，又想避免创建这个无用的实例，可以使用基于索引的迭代。</p><p><strong>4. 不要调用这些方法</strong></p><p>一些方法简单但开销不小。在N.O.P.E.分支示例中，我们没有在叶节点上使用这样的方法，但你可能使用到了。我们假设 JDBC 驱动程序需要耗费大量资源来计算 ResultSet.wasNull() 的值。你可能会用下列代码开发 SQL 框架：</p><p>if (type == Integer.class) {</p><p>result = (T) wasNull(rs,</p><p>Integer.valueOf(rs.getInt(index)));</p><p>}</p><p>// And then...static final &lt;T> T wasNull(ResultSet rs, T value) throws SQLException {</p><p>return rs.wasNull() ? null : value;</p><p>}</p><p>此处逻辑每次都会在你从结果集中获得一个 int 之后立即调用 ResultSet.wasNull()。但getInt() 的约定是：</p><p>返回: 列的数目；如果这个值是 SQL NULL，这个值将返回 0。</p><p>因此，对上述问题的简单但可能有效的改进将是：</p><p>static final &lt;T extends Number> T wasNull(</p><p>ResultSet rs, T value</p><p>) throws SQLException {</p><p>return (value == null ||</p><p>(value.intValue() == 0 && rs.wasNull()))</p><p>? null : value;</p><p>}</p><p>因此，这不需要过多考虑。</p><p><strong>关键点</strong></p><p>不要在算法的"叶节点"中调用开销昂贵的方法，而是缓存该调用，或者如果方法规约允许则规避之。</p><p><strong>5. 使用基本类型和栈</strong></p><p>上面的例子大量使用了泛型。泛型会强制对 byte、short、int 和 long 这些类型进行装箱 —— 至少在这之前：泛型会在 Java 10 和 Valhalla 项目中实现专业化。不过现在你的代码里并没实现这种约束，所以你得采取措施：</p><p>// Goes to the heapInteger i = 817598;</p><p>… 替换为下面这个：</p><p>// Stays on the stackint i = 817598;</p><p>如果你使用数组的话，情况不太妙：</p><p>// Three heap objects!Integer[] i = { 1337, 424242 };</p><p>… 替换成这个：</p><p>// One heap object.int[] i = { 1337, 424242 };</p><p>关键点</p><p>当你在深入 N.O.P.E. 分支时，要小心使用装箱类型。你可能会给 GC 制造很大的压力，因为它必须一直清理你的烂摊子。</p><p>有一个特别有效的办法对此进行优化，即使用某些基本类型，并为它创建一个巨大的一维数组，以及相应的定位变量来明确指出编码后的对象放在数组的哪个位置。</p><p>LGPL 授权的 trove4j 库实现了基本数据类型的集合，它看起来比 int[] 要好些。</p><p><strong>总结：</strong></p><p>正如你所看到的，提高应用程序的性能有时不需要做大量的工作。这篇文章中的大多数建议，其实只需要稍微的努力就可以将它们应用到代码中。</p><p>但通常最重要的建议是很编程语言无关的：</p><p>在你知道有必要之前，不要优化</p><p>使用分析器来找到真正的瓶颈</p><p>首先解决最大的瓶颈问题</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'飙升','Java','调优'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>