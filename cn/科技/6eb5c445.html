<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>数据库主从复制，读写分离，分库分表，分区讲解（可以收藏哦） | 极客快訊</title><meta property="og:title" content="数据库主从复制，读写分离，分库分表，分区讲解（可以收藏哦） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/900da73a61f44b99ae3c2ffb26771f14"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6eb5c445.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6eb5c445.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6eb5c445.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6eb5c445.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6eb5c445.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6eb5c445.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6eb5c445.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6eb5c445.html><meta property="article:published_time" content="2020-11-14T21:04:05+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:05+08:00"><meta name=Keywords content><meta name=description content="数据库主从复制，读写分离，分库分表，分区讲解（可以收藏哦）"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/6eb5c445.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>数据库主从复制，读写分离，分库分表，分区讲解（可以收藏哦）</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>随着互联网应用的广泛普及，海量数据的存储和访问成为了系统设计的瓶颈问题。对于一个大型的互联网应用，每天几十亿的PV无疑对数据库造成了相当高的负载。对于系统的稳定性和扩展性造成了极大的问题。通过数据切分来提高网站性能，横向扩展数据层已经成为架构研发人员首选的方式。</p><hr><p><strong>mysql主从复制原理</strong></p><p>主要涉及三个线程：binlog 线程、I/O 线程和 SQL 线程。</p><ul><li><strong>binlog 线程</strong> ：负责将主服务器上的数据更改写入二进制日志（Binary log）中。</li><li><strong>I/O 线程</strong> ：负责从主服务器上读取二进制日志，并写入从服务器的中继日志（Relay log）。</li><li><strong>SQL 线程</strong> ：负责读取中继日志，解析出主服务器已经执行的数据更改并在从服务器中重放（Replay）。</li></ul><h1><br></h1><div class=pgc-img><img alt=数据库主从复制，读写分离，分库分表，分区讲解（可以收藏哦） onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/900da73a61f44b99ae3c2ffb26771f14><p class=pgc-img-caption>这张图就很清晰表达出流程</p></div><h1><br></h1><hr><h1><br></h1><div class=pgc-img><img alt=数据库主从复制，读写分离，分库分表，分区讲解（可以收藏哦） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d3ca60cb404447c38742f922318e46c8><p class=pgc-img-caption></p></div><p>1：主库db的更新事件(update、insert、delete)被写到binlog</p><p>2：从库发起连接，连接到主库<br>3：此时主库创建一个binlog dump thread线程，把binlog的内容发送到从库</p><p>4：从库启动之后，创建一个I/O线程，读取主库传过来的binlog内容并写入到relay log</p><p>5：还会创建一个SQL线程，从relay log里面读取内容，从Exec_Master_Log_Pos位置开始执行读取到的更新事件，将更新内容写入到slave的db.</p><p><strong>主从同步复制模式：</strong></p><div class=pgc-img><img alt=数据库主从复制，读写分离，分库分表，分区讲解（可以收藏哦） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3c3c428ab9bc4ad4b81d314e7d6a9356><p class=pgc-img-caption></p></div><hr><p><strong>读写分离：</strong></p><p>MYSQL读写分离的原理其实就是让Master数据库处理事务性增、删除、修改、更新操作（CREATE、INSERT、UPDATE、DELETE），而让Slave数据库处理SELECT操作，MYSQL读写分离前提是基于MYSQL主从复制，这样可以保证在Master上修改数据，Slave同步之后，WEB应用可以读取到Slave端的数据。</p><div class=pgc-img><img alt=数据库主从复制，读写分离，分库分表，分区讲解（可以收藏哦） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6c6370ec147b45be937571f227f10f15><p class=pgc-img-caption></p></div><hr><p><strong>数据库分区：</strong></p><p>分区并不是生成新的数据表，而是将表的数据均衡分摊到不同的硬盘，系统或是不同服务器存储介子中，实际上还是一张表。另外，分区可以做到将表的数据均衡到不同的地方，提高数据检索的效率，降低数据库的频繁IO压力值，分区的优点如下：</p><p>1、相对於单个文件系统或是硬盘，分区可以存储更多的数据；</p><p>2、数据管理比较方便，比如要清理或废弃某年的数据，就可以直接删除该日期的分区数据即可；</p><p>3、精准定位分区查询数据，不需要全表扫描查询，大大提高数据检索效率；</p><p>4、可跨多个分区磁盘查询，来提高查询的吞吐量；</p><p>5、在涉及聚合函数查询时，可以很容易进行数据的合并；</p><p><strong>1、水平分区</strong></p><p>这种形式分区是对表的行进行分区，通过这样的方式不同分组里面的物理列分割的数据集得以组合，从而进行个体分割（单分区）或集体分割（1个或多个分区）。所有在表中定义的列在每个数据集中都能找到，所以表的特性依然得以保持。</p><p><strong>2、垂直分区</strong></p><p>这种分区方式一般来说是通过对表的垂直划分来减少目标表的宽度，使某些特定的列被划分到特定的分区，每个分区都包含了其中的列所对应的行。</p><p><strong>什么时候考虑使用分区？</strong></p><ul><li>一张表的查询速度已经慢到影响使用的时候。</li><li>sql经过优化</li><li>数据量大</li><li>表中的数据是分段的</li><li>对数据的操作往往只涉及一部分数据，而不是所有的数据</li></ul><hr><p><strong>分库分表：</strong></p><p>分库分表的原因：</p><p>1、随着单库中的数据量越来越大，相应的，查询所需要的时间也越来越多，相当于数据的处理遇到了瓶颈<br>2、单库发生意外的时候，需要修复的是所有的数据，而多库中的一个库发生意外的时候，只需要修复一个库（当然，也可以用物理分区的方式处理这种问题）</p><p><strong>什么时候考虑使用分库？</strong></p><ul><li>单台DB的存储空间不够</li><li>随着查询量的增加单台数据库服务器已经没办法支撑</li></ul><p><strong>分库解决的问题：</strong></p><p>其主要目的是为突破单节点数据库服务器的 I/O 能力限制，解决数据库扩展性问题。</p><p>垂直拆分</p><p>将系统中不存在关联关系或者需要join的表可以放在不同的数据库不同的服务器中。</p><p>按照业务垂直划分。比如：可以按照业务分为资金、会员、订单三个数据库。</p><p>需要解决的问题：跨数据库的事务、jion查询等问题。</p><p>水平拆分</p><p>例如，大部分的站点。数据都是和用户有关，那么可以根据用户，将数据按照用户水平拆分。</p><p>按照规则划分，一般水平分库是在垂直分库之后的。比如每天处理的订单数量是海量的，可以按照一定的规则水平划分。需要解决的问题：数据路由、组装。</p><p><strong>什么时候考虑分表？</strong></p><ul><li>一张表的查询速度已经慢到影响使用的时候。</li><li>sql经过优化</li><li>数据量大</li><li>当频繁插入或者联合查询时，速度变慢</li></ul><p><strong>分表解决的问题</strong></p><p>分表后，单表的并发能力提高了，磁盘I/O性能也提高了，写操作效率提高了</p><ul><li>查询一次的时间短了</li><li>数据分布在不同的文件，磁盘I/O性能提高</li><li>读写锁影响的数据量变小</li><li>插入数据库需要重新建立索引的数据减少</li></ul><div class=pgc-img><img alt=数据库主从复制，读写分离，分库分表，分区讲解（可以收藏哦） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6db63a3301414a2b92f4ae74c6385d15><p class=pgc-img-caption>垂直分表</p></div><div class=pgc-img><img alt=数据库主从复制，读写分离，分库分表，分区讲解（可以收藏哦） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a4fcafbce756451c89155c30816aee2c><p class=pgc-img-caption>水平分表</p></div><hr><p><strong>存储演变：</strong></p><p>单库单表</p><p>单库单表是最常见的数据库设计，例如，有一张用户(user)表放在数据库db中，所有的用户都可以在db库中的user表中查到。</p><p>单库多表</p><p>随着用户数量的增加，user表的数据量会越来越大，当数据量达到一定程度的时候对user表的查询会渐渐的变慢，从而影响整个DB的性能。如果使用mysql, 还有一个更严重的问题是，当需要添加一列的时候，mysql会锁表，期间所有的读写操作只能等待。</p><p>可以通过某种方式将user进行水平的切分，产生两个表结构完全一样的user_0000,user_0001等表，user_0000 + user_0001 + …的数据刚好是一份完整的数据。</p><p>多库多表</p><p>随着数据量增加也许单台DB的存储空间不够，随着查询量的增加单台数据库服务器已经没办法支撑。这个时候可以再对数据库进行水平拆分。</p><hr><p><strong>数据库额外小知识：</strong></p><p><strong>MySQL 使用自增ID主键和UUID 作为主键的优劣比较详细过程（从百万到千万表记录测试）</strong></p><p><strong>（1）单实例或者单节点组：</strong></p><p>经过500W、1000W的单机表测试，自增ID相对UUID来说，自增ID主键性能高于UUID，磁盘存储费用比UUID节省一半的钱。所以在单实例上或者单节点组上，使用自增ID作为首选主键。</p><p><strong>（2）分布式架构场景：</strong></p><p>20个节点组下的小型规模的分布式场景，为了快速实现部署，可以采用多花存储费用、牺牲部分性能而使用UUID主键快速部署；</p><p>20到200个节点组的中等规模的分布式场景，可以采用自增ID+步长的较快速方案。</p><p>200以上节点组的大数据下的分布式场景，可以借鉴类似twitter雪花算法构造的全局自增ID作为主键。</p><hr><div class=pgc-img><img alt=数据库主从复制，读写分离，分库分表，分区讲解（可以收藏哦） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/e062f7c4-1af1-4023-8358-a322c3179192><p class=pgc-img-caption></p></div><p>记录学习，每天进步一点点的橘子大王。</p><p>喜欢就关注我吧。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'数据','库主','读写'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>