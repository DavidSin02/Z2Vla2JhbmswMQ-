<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Hadoopä¹‹HDFS | æå®¢å¿«è¨Š</title><meta property="og:title" content="Hadoopä¹‹HDFS - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/1cea562f356248cc81e9df66fdf8b0a1"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/71da1592.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/71da1592.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/71da1592.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/71da1592.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/71da1592.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/71da1592.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/71da1592.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/71da1592.html><meta property="article:published_time" content="2020-11-14T21:03:23+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:23+08:00"><meta name=Keywords content><meta name=description content="Hadoopä¹‹HDFS"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/71da1592.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Hadoopä¹‹HDFS</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right><strong><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">HDFSé‡è¦æ¦‚å¿µ</span></strong></h1><ul><li><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">å…¸å‹çš„Master/Slaveæ¶æ„<br>HDFSå¾€å¾€æ˜¯ç”±ä¸€ä¸ªNameNodeï¼ˆHAæ¶æ„ä¼šæœ‰ä¸¤ä¸ªNameNodeï¼Œè”é‚¦æœºåˆ¶ï¼‰å’Œå¤šä¸ªDataNodeç»„æˆ</span></li><li><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">åˆ†å—å­˜å‚¨ï¼ˆBlockæœºåˆ¶ï¼‰<br>HDFSä¸­çš„æ–‡ä»¶åœ¨ç‰©ç†ä¸Šæ˜¯åˆ†å—å­˜å‚¨ï¼Œå—çš„å¤§å°å¯è°ƒæ•´ï¼Œ2.xç‰ˆæœ¬blockå¤§å°é»˜è®¤æ˜¯128Mã€‚å½“æ–‡ä»¶å¤§äº128Mï¼Œå°†æ–‡ä»¶åˆ‡ç‰‡å­˜å‚¨</span></li><li><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">å‘½åç©ºé—´(NameSpace)<br>HDFSæ”¯æŒä¼ ç»Ÿçš„å±‚æ¬¡å‹æ–‡ä»¶ç»„ç»‡ç»“æ„ã€‚ç”¨æˆ·å¯ä»¥åˆ›å»ºç›®å½•ï¼Œå¯ä»¥åˆ›å»ºã€åˆ é™¤ã€ç§»åŠ¨ã€é‡å‘½åæ–‡ä»¶<br>NameNode å¤åˆ¶ç»´æŠ¤æ–‡ä»¶ç³»ç»Ÿçš„åå­—ç©ºé—´ï¼Œä»»ä½•å¯¹æ–‡ä»¶ç³»ç»Ÿåå­—ç©ºé—´æˆ–å±æ€§çš„ä¿®æ”¹</span><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">éƒ½æŠ¤</span><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">è¢«NameNodeè®°å½•ä¸‹æ¥<br>HDFSæä¾›ç»™å®¢æˆ·ä¸€ä¸ªå•ä¸€æŠ½è±¡çš„ç›®å½•æ ‘ï¼Œå› ä¸ºæ•°æ®éƒ½å­˜æ”¾åœ¨DataNodeä¸­ï¼Œä¸ä¼šå»æ˜¾ç¤ºå­˜æ”¾åˆ°å“ªä¸ªDataNode,æ˜¯æŠŠå¤šä¸ªDataNodeæŠ½è±¡æˆä¸€ä¸ªç›®å½•æ ‘ï¼Œå®¢æˆ·ç«¯è®¿é—®å½¢å¼ï¼šhdfs://namenode:namenodeçš„port/test/input å³ hdfs://linux121:9000/test/input</span></li><li><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">NameNodeçš„å…ƒæ•°æ®ç®¡ç†<br>ç›®å½•ç»“æ„ã€æ–‡ä»¶åˆ†å—ä½ç½®ä¿¡æ¯å«åšå…ƒæ•°æ®ï¼ŒNameNodeçš„å…ƒæ•°æ®è®°å½•æ¯ä¸ªæ–‡ä»¶æ‰€å­˜æ”¾çš„blockä¿¡æ¯ï¼ˆblockçš„IDåŠæ‰€åœ¨çš„DataNodeèŠ‚ç‚¹çš„ä¿¡æ¯ï¼‰</span></li><li><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">DataNodeæ•°æ®å‚¨å­˜<br>æ–‡ä»¶å­˜æ”¾åœ¨Blockä¸­ï¼Œè€ŒBlockçš„å…·ä½“ç®¡ç†ç”±DataNodeèŠ‚ç‚¹æ‰¿æ‹…ï¼Œä¸€ä¸ªBlockä¼šæœ‰å¤šä¸ªDataNodeå­˜å‚¨ï¼ŒDataNodeä¼šå®šæ—¶ç›¸å…³NameNodeæ±‡æŠ¥è‡ªå·±æŒæœ‰çš„Blockçš„ä¿¡æ¯</span></li><li><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">å‰¯æœ¬æœºåˆ¶<br>ä¸ºäº†å®¹é”™ï¼Œæ–‡ä»¶æ‰€æœ‰çš„blockéƒ½æœ‰å‰¯æœ¬ï¼Œå¤§å°å’Œæ•°é‡éƒ½å¯ä»¥é…ç½®ï¼Œå‰¯æœ¬ä¸æ˜¯ä»¥æŸä¸ªæ–‡ä»¶è€Œæ˜¯ä»¥æ•´ä¸ªblockå¤‡ä»½ã€‚å‰¯æœ¬çš„é»˜è®¤æ•°é‡æ˜¯3ä¸ª</span></li><li><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">ä¸€æ¬¡å†™å…¥ï¼Œå¤šæ¬¡è¯»å‡º<br>HDFSé€‚åˆä¸€èµ·å†™å…¥ï¼Œå¤šæ¬¡è¯»å‡ºï¼Œä¸æ”¯æŒéšæœºä¿®æ”¹ï¼Œæ”¯æŒè¿½åŠ å†™å…¥æ“ä½œã€‚ä¸é€‚åˆåšç½‘ç›˜</span></li></ul><h1 class=pgc-h-arrow-right><strong><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">HDFSæ¶æ„</span></strong></h1><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1cea562f356248cc81e9df66fdf8b0a1><p class=pgc-img-caption>HDFSæ¶æ„å›¾.png</p></div><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/045e34d9b838472ba11659c7ce9d6134><p class=pgc-img-caption>HDFSæ¶æ„ä¸­æ–‡ç‰ˆæœ¬.png</p></div><ul><li>å®¢æˆ·ç«¯ ä¸Šä¼ æ–‡ä»¶åˆ°HDFSçš„æ—¶å€™ï¼ŒClientè´Ÿè´£æ–‡ä»¶çš„åˆ‡åˆ†Blockï¼Œç„¶åè¿›è¡Œä¸Šä¼  å‘DataNodeè´Ÿè´£ä¸Šä¼ ä¸‹è½½æ–‡ä»¶ ä¸NameNodeäº¤äº’ï¼Œè·å–æ–‡ä»¶Blockä½ç½®ä¿¡æ¯</li><li>NameNode ç»´æŠ¤ç®¡ç†HDFSçš„åç§°ç©ºé—´ï¼ˆNameSpaceï¼‰ ç»´æŠ¤å‰¯æœ¬ç­–ç•¥ è®°å½•æ–‡ä»¶å—ï¼ˆBlockï¼‰çš„æ˜ å°„ä¿¡æ¯ å¤„ç†å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚</li><li>DataNode å®é™…å­˜å‚¨Blockæ•°æ® è´Ÿè´£Blockè¯»å†™æ•°æ® å¤åˆ¶ï¼ˆå‰¯æœ¬ï¼‰</li></ul><h1 class=pgc-h-arrow-right><strong>Shellå‘½ä»¤è¡Œæ“ä½œHDFS</strong></h1><p>æŸ¥çœ‹æŸä¸ªå‘½ä»¤çš„å…·ä½“ç”¨æ³•ï¼Œå¦‚catçš„ç”¨æ³•</p><pre><code>hadoopÂ fsÂ -helpÂ cat</code></pre><p>æŸ¥çœ‹æŸä¸ªç›®å½•ä¸‹é¢çš„æ–‡ä»¶,ä¾‹å¦‚æ ¹ç›®å½•(æŸ¥çœ‹çš„æ˜¯HDFSçš„æ ¹ç›®å½•)</p><pre><code>hdfsÂ dfsÂ -lsÂ /</code></pre><p>åˆ›å»ºä¸€ä¸ªç›®å½•,åœ¨æ ¹ç›®å½•ä¸‹é¢åˆ›å»ºä¸€ä¸ªlgå’Œè‡ªå·±bigdata</p><pre><code>hadoopÂ fsÂ -mkdirÂ -pÂ /lagou/bigdata</code></pre><p>ä»æœ¬åœ°ç§»åŠ¨(å‰ªåˆ‡ç²˜è´´)ä¸ªæ–‡ä»¶åˆ°æœåŠ¡å™¨</p><pre><code>hadoopÂ fsÂ -moveFromLocalÂ ./test.txtÂ /lagou/bigdata</code></pre><p>æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶å†…å®¹</p><pre><code>Â hadoopÂ fsÂ -catÂ /lagou/bigdata/test.txt</code></pre><p>è¿½åŠ å†™å…¥</p><pre><code>#ç”Ÿäº§ä¸€ä¸ªhdfs.txtçš„æ–‡ä»¶ï¼Œéšä¾¿å†™ç‚¹å†…å®¹vimÂ hdfs.tx#æ‰§è¡Œè¿½åŠ å†™å…¥Â hadoopÂ fsÂ -appendToFileÂ ./hdfs.txÂ /lagou/bigdata/test.txt</code></pre><p>ä¿®æ”¹æ–‡ä»¶æƒé™</p><pre><code>hadoopÂ fsÂ -chmodÂ 777Â /lagou/bigdata/test.txt</code></pre><p>ä¿®æ”¹ç”¨æˆ·ç»„</p><pre><code>hadoopÂ fsÂ -chownÂ root:rootÂ /lagou/bigdata/test.txt</code></pre><p>ä»æœ¬åœ°ç§»åŠ¨(å¤åˆ¶ç²˜è´´)ä¸ªæ–‡ä»¶åˆ°æœåŠ¡å™¨</p><pre><code>hadoopÂ fsÂ -copyFromLocalÂ ./test.txtÂ /lagou/bigdatahadoopÂ fsÂ -putÂ ./test.txtÂ /lagou/bigdata</code></pre><p>ä»HDFSç§»åŠ¨ï¼ˆå¤åˆ¶ç²˜è´´ï¼‰åˆ°æœ¬åœ°</p><pre><code>hadoopÂ fsÂ -corpToLocalÂ /lagou/bigdata/test.txtÂ ./hadoopÂ fsÂ -getÂ /lagou/bigdata/test.txtÂ ./</code></pre><p>åˆ é™¤ç©ºæ–‡ä»¶å¤¹</p><pre><code>hadoopÂ fsÂ -rmdirÂ /test</code></pre><p>æ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶çš„æœ«å°¾</p><pre><code>hadoopÂ fsÂ -tailÂ /lagou/bigdata/test.txt</code></pre><p>ç»Ÿè®¡æ–‡ä»¶å¤¹å¤§å°ä¿¡æ¯</p><pre><code>hadoopÂ fsÂ -duÂ -sÂ -hÂ /lagou/bigdataÂ </code></pre><p>ç»Ÿè®¡æ–‡ä»¶å¤§å°ä¿¡æ¯</p><pre><code>hadoopÂ fsÂ -duÂ -sÂ -hÂ /lagou/bigdata/test.txt</code></pre><p>è®¾ç½®HDFSå‰¯æœ¬æ•°é‡</p><pre><code>hadoopÂ fsÂ -setrepÂ 10Â /test/input/test2.txt</code></pre><p><strong>è¿™é‡Œè®¾ç½®å‰¯æœ¬æ•°é‡åªæ˜¯è®°å½•åœ¨NameNodeé‡Œé¢ï¼Œå…·ä½“æœ‰æ²¡æœ‰åä¸ªå‰¯æœ¬éœ€è¦çœ‹æœ‰å¤šå°‘ä¸ªDataNodeï¼Œå› ä¸ºç›®å‰åªæœ‰3å°æœºå™¨ï¼Œæœ€æœ‰ä¹Ÿå°±ä¸‰ä¸ªå‰¯æœ¬ï¼Œåªæœ‰èŠ‚ç‚¹æ•°å¢åŠ åˆ°10å°çš„æ—¶å€™ï¼Œå‰¯æœ¬æ•°é‡æ‰ä¼šè¾¾åˆ°10ä¸ªã€‚æ‰€ä»¥ï¼Œæ–‡ä»¶çœŸæ­£çš„å‰¯æœ¬æ•°é‡å–å†³äºDataNodeæ•°é‡</strong></p><h1 class=pgc-h-arrow-right><strong>ä½¿ç”¨Ideaé“¾æ¥HDFS</strong></h1><p>å¯¼å…¥pom.xml</p><pre><code>&lt;dependencies&gt;    &lt;dependency&gt;        &lt;groupId&gt;junit&lt;/groupId&gt;        &lt;artifactId&gt;junit&lt;/artifactId&gt;        &lt;version&gt;RELEASE&lt;/version&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;        &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;        &lt;version&gt;2.8.2&lt;/version&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;        &lt;artifactId&gt;hadoop-common&lt;/artifactId&gt;        &lt;version&gt;2.9.2&lt;/version&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;        &lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;        &lt;version&gt;2.9.2&lt;/version&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;        &lt;artifactId&gt;hadoop-hdfs&lt;/artifactId&gt;        &lt;version&gt;2.9.2&lt;/version&gt;    &lt;/dependency&gt;&lt;/dependencies&gt;</code></pre><p>ä»£ç ï¼š</p><pre><code>packageÂ com.hhb.hdfs;importÂ org.apache.hadoop.conf.Configuration;importÂ org.apache.hadoop.fs.*;importÂ org.apache.hadoop.fs.permission.FsPermission;importÂ org.apache.hadoop.io.IOUtils;importÂ org.junit.After;importÂ org.junit.Before;importÂ org.junit.Test;importÂ java.io.File;importÂ java.io.FileInputStream;importÂ java.io.FileOutputStream;importÂ java.io.IOException;importÂ java.net.URI;importÂ java.net.URISyntaxException;/**Â *Â @Date:Â 2020-07-02Â 14:47Â *Â @Description:Â */publicÂ classÂ HdfsClientÂ {Â Â Â Â privateÂ FileSystemÂ fileSystemÂ =Â null;Â Â Â Â privateÂ ConfigurationÂ configurationÂ =Â null;Â Â Â Â @BeforeÂ Â Â Â publicÂ voidÂ init()Â throwsÂ URISyntaxException,Â IOException,Â InterruptedExceptionÂ {Â Â Â Â Â Â Â Â //Â 1.Â è·å–Hadoopé›†ç¾¤configurationå¯¹è±¡Â Â Â Â Â Â Â Â configurationÂ =Â newÂ Configuration();Â Â Â Â Â Â Â Â //è®¾ç½®å®¢æˆ·ç«¯è®¿é—®datanodeä½¿ç”¨hostnameæ¥è¿›è¡Œè®¿é—®Â Â Â Â Â Â Â Â configuration.set("dfs.client.use.datanode.hostname",Â "true");Â Â Â Â Â Â Â Â //Â è®¾ç½®å‰¯æœ¬æ•°é‡,ç”Ÿæ•ˆçš„ä¼˜å…ˆçº§ï¼Œä»£ç é‡Œçš„Â Â &gt;Â Â é…ç½®æ–‡ä»¶Â &gt;Â hadoop-hdfs.jarÂ é‡Œçš„é»˜è®¤hdfs-default.xmlé…ç½®//Â Â Â Â Â Â Â Â configuration.set("dfs.replication",Â "2");Â Â Â Â Â Â Â Â //Â 2.Â æ ¹æ®configurationå¯¹è±¡è·å–FileSystemå¯¹è±¡Â Â Â Â Â Â Â Â fileSystemÂ =Â FileSystem.get(newÂ URI("hdfs://linux121:9000"),Â configuration,Â "root");Â Â Â Â }Â Â Â Â @AfterÂ Â Â Â publicÂ voidÂ destroy()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â fileSystem.close();Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â åˆ›å»ºç›®å½•Â Â Â Â Â *Â Â Â Â Â *Â @throwsÂ URISyntaxExceptionÂ Â Â Â Â *Â @throwsÂ IOExceptionÂ Â Â Â Â *Â @throwsÂ InterruptedExceptionÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ testMkdirs()Â throwsÂ URISyntaxException,Â IOException,Â InterruptedExceptionÂ {//Â Â Â Â Â Â Â Â //Â 1.Â è·å–Hadoopé›†ç¾¤configurationå¯¹è±¡//Â Â Â Â Â Â Â Â ConfigurationÂ configurationÂ =Â newÂ Configuration();//Â Â Â Â Â Â Â Â configuration.set("fs.defaultFs",Â "hdfs://linux121:9000");//Â Â Â Â Â Â Â Â //Â 2.Â æ ¹æ®configurationå¯¹è±¡è·å–FileSystemå¯¹è±¡//Â Â Â Â Â Â Â Â FileSystemÂ fileSystemÂ =Â FileSystem.get(newÂ URI("hdfs://linux121:9000"),Â configuration,Â "root");Â Â Â Â Â Â Â Â //Â 3.Â ä½¿ç”¨FileSystemå¯¹è±¡åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç›®å½•Â Â Â Â Â Â Â Â booleanÂ mkdirsÂ =Â fileSystem.mkdirs(newÂ Path("/api_test"));Â Â Â Â Â Â Â Â System.err.println(mkdirs);Â Â Â Â Â Â Â Â //Â 4.Â é‡Šæ”¾FileSystemå¯¹è±¡//Â Â Â Â Â Â Â Â fileSystem.close();Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â åˆ›å»ºç›®å½•Â Â Â Â Â *Â Â Â Â Â *Â @throwsÂ IOExceptionÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ testMkdirs2()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â //Â 1.Â è·å–Hadoopé›†ç¾¤configurationå¯¹è±¡//Â Â Â Â Â Â Â Â ConfigurationÂ configurationÂ =Â newÂ Configuration();//Â Â Â Â Â Â Â Â configuration.set("fs.defaultFS",Â "hdfs://linux121:9000");//Â Â Â Â Â Â Â Â //Â 2.Â æ ¹æ®configurationå¯¹è±¡è·å–FileSystemå¯¹è±¡//Â Â Â Â Â Â Â Â FileSystemÂ fileSystemÂ =Â FileSystem.get(configuration);Â Â Â Â Â Â Â Â //Â 3.Â ä½¿ç”¨FileSystemå¯¹è±¡åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç›®å½•Â Â Â Â Â Â Â Â booleanÂ mkdirsÂ =Â fileSystem.mkdirs(newÂ Path("/api_test"));Â Â Â Â Â Â Â Â System.err.println(mkdirs);Â Â Â Â Â Â Â Â //Â 4.Â é‡Šæ”¾FileSystemå¯¹è±¡//Â Â Â Â Â Â Â Â fileSystem.close();Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â ä¸Šä¼ æ–‡ä»¶Â Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ copyFromLocalToHDFS()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â fileSystem.copyFromLocalFile(newÂ Path("/Users/baiwang/Desktop/yarn-site.xml"),Â newÂ Path("/api_test"));Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â ä¸‹è½½æ–‡ä»¶Â Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ copyFromHDFSToLocal()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â //Â ç¬¬ä¸€ä¸ªå‚æ•°ï¼šè¡¨ç¤ºæ˜¯å¦åˆ é™¤æºæ–‡ä»¶Â Â Â Â Â Â Â Â fileSystem.copyToLocalFile(true,Â newÂ Path("/api_test/yarn-site.xml"),Â newÂ Path("/Users/baiwang/Desktop/"));Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â åˆ é™¤æ–‡ä»¶Â Â Â Â Â *Â Â Â Â Â *Â @throwsÂ IOExceptionÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ deleteFile()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â //ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦é€’å½’åˆ é™¤Â Â Â Â Â Â Â Â fileSystem.delete(newÂ Path("/api_test"),Â true);Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â éå†HDFSçš„æ ¹ç›®å½•ï¼Œå¾—åˆ°æ–‡ä»¶ä»¥åŠæ–‡ä»¶å¤¹ä¿¡æ¯ï¼šåç§°ï¼Œæƒé™ï¼Œé•¿åº¦Â Â Â Â Â *Â Â Â Â Â *Â @throwsÂ IOExceptionÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ listsFile()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â //ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦é€’å½’ï¼Œè¯¥æ–¹æ³•è¿”å›çš„ä¸€ä¸ªè¿­ä»£å™¨ï¼Œé‡Œé¢å­˜æ”¾çš„æ˜¯æ–‡ä»¶çŠ¶æ€ä¿¡æ¯Â Â Â Â Â Â Â Â RemoteIterator&lt;LocatedFileStatus&gt;Â remoteIteratorÂ =Â fileSystem.listFiles(newÂ Path("/"),Â true);Â Â Â Â Â Â Â Â whileÂ (remoteIterator.hasNext())Â {Â Â Â Â Â Â Â Â Â Â Â Â LocatedFileStatusÂ fileStatusÂ =Â remoteIterator.next();Â Â Â Â Â Â Â Â Â Â Â Â //æ–‡ä»¶åç§°Â Â Â Â Â Â Â Â Â Â Â Â StringÂ nameÂ =Â fileStatus.getPath().getName();Â Â Â Â Â Â Â Â Â Â Â Â //æ–‡ä»¶å¤§å°Â Â Â Â Â Â Â Â Â Â Â Â longÂ lenÂ =Â fileStatus.getLen();Â Â Â Â Â Â Â Â Â Â Â Â //è·å–æƒé™Â Â Â Â Â Â Â Â Â Â Â Â FsPermissionÂ permissionÂ =Â fileStatus.getPermission();Â Â Â Â Â Â Â Â Â Â Â Â //è·å–åˆ†ç»„ä¿¡æ¯Â Â Â Â Â Â Â Â Â Â Â Â StringÂ groupÂ =Â fileStatus.getGroup();Â Â Â Â Â Â Â Â Â Â Â Â //è·å–æ‰€å±ç”¨æˆ·Â Â Â Â Â Â Â Â Â Â Â Â StringÂ ownerÂ =Â fileStatus.getOwner();Â Â Â Â Â Â Â Â Â Â Â Â System.err.println(nameÂ +Â "\t"Â +Â lenÂ +Â "\t"Â +Â permissionÂ +Â "\t"Â +Â groupÂ +Â "\t"Â +Â owner);Â Â Â Â Â Â Â Â Â Â Â Â //å—ä¿¡æ¯Â Â Â Â Â Â Â Â Â Â Â Â BlockLocation[]Â blockLocationsÂ =Â fileStatus.getBlockLocations();Â Â Â Â Â Â Â Â Â Â Â Â forÂ (BlockLocationÂ blockLocationÂ :Â blockLocations)Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â String[]Â hostsÂ =Â blockLocation.getHosts();Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â forÂ (StringÂ hostÂ :Â hosts)Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â System.err.println("ä¸»æœºåç§°ï¼š"Â +Â host);Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â Â Â Â Â System.err.println("============");Â Â Â Â Â Â Â Â }Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â åˆ¤è¯»æ˜¯æ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶å¤¹Â Â Â Â Â *Â Â Â Â Â *Â @throwsÂ IOExceptionÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ isFile()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â FileStatus[]Â fileStatusesÂ =Â fileSystem.listStatus(newÂ Path("/"));Â Â Â Â Â Â Â Â forÂ (FileStatusÂ fileStatusÂ :Â fileStatuses)Â {Â Â Â Â Â Â Â Â Â Â Â Â booleanÂ fileÂ =Â fileStatus.isFile();Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (file)Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â System.err.println("æ–‡ä»¶ï¼š"Â +Â fileStatus.getPath().getName());Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â System.err.println("æ–‡ä»¶å¤¹ï¼š"Â +Â fileStatus.getPath().getName());Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â }Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â ä½¿ç”¨IOæµæ“ä½œHDFSÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ uploadFileIO()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â //1.Â è·å–æœ¬åœ°è¾“å…¥æµÂ Â Â Â Â Â Â Â FileInputStreamÂ fileInputStreamÂ =Â newÂ FileInputStream(newÂ File("/Users/baiwang/Desktop/yarn-site.xml"));Â Â Â Â Â Â Â Â //2.Â è·å–å†™æ•°æ®çš„è¾“å‡ºæµÂ Â Â Â Â Â Â Â FSDataOutputStreamÂ fsDataOutputStreamÂ =Â fileSystem.create(newÂ Path("/lagou.txt"));Â Â Â Â Â Â Â Â //3.Â è¾“å…¥æµæ•°æ®æ‹·è´åˆ°è¾“å‡ºæµ,copyBytesæ–¹æ³•é‡Œæœ‰é»˜è®¤æ‹·è´å€¼å¤§å°ï¼ˆ4096ï¼‰ï¼Œä¹Ÿæœ‰æ˜¯å¦å…³é—­æµçš„æ“ä½œï¼ˆtrueï¼‰Â Â Â Â Â Â Â Â IOUtils.copyBytes(fileInputStream,Â fsDataOutputStream,Â configuration);Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â ä½¿ç”¨IOæµä¸‹è½½æ–‡ä»¶Â Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ downLoadFileIO()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â //1.Â è·å–HDFSè¾“å…¥æµÂ Â Â Â Â Â Â Â FSDataInputStreamÂ fsDataInputStreamÂ =Â fileSystem.open(newÂ Path("/lagou.txt"));Â Â Â Â Â Â Â Â //2.Â è·å–å†™æ•°æ®çš„è¾“å‡ºæµÂ Â Â Â Â Â Â Â FileOutputStreamÂ fileOutputStreamÂ =Â newÂ FileOutputStream(newÂ File("/Users/baiwang/Desktop/hhb.xml"));Â Â Â Â Â Â Â Â //3.Â è¾“å…¥æµæ•°æ®æ‹·è´åˆ°è¾“å‡ºæµ,copyBytesæ–¹æ³•é‡Œæœ‰é»˜è®¤æ‹·è´å€¼å¤§å°ï¼ˆ4096ï¼‰ï¼Œä¹Ÿæœ‰æ˜¯å¦å…³é—­æµçš„æ“ä½œï¼ˆtrueï¼‰Â Â Â Â Â Â Â Â IOUtils.copyBytes(fsDataInputStream,Â fileOutputStream,Â configuration);Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â seekÂ å®šä½è¯»å–,ä½¿ç”¨IOæµæŠŠlagou.txtÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ seekReadFile()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â //è·å–HDFSè¾“å…¥æµÂ Â Â Â Â Â Â Â FSDataInputStreamÂ fsDataInputStreamÂ =Â fileSystem.open(newÂ Path("/lagou.txt"));Â Â Â Â Â Â Â Â //å°†è¾“å…¥æµå¤åˆ¶åˆ°æ§åˆ¶å°ä¸­ï¼Œfalseè¡¨ç¤ºä¸ä¼šè‡ªåŠ¨å…³é—­æµÂ Â Â Â Â Â Â Â IOUtils.copyBytes(fsDataInputStream,Â System.out,Â 4096,Â false);Â Â Â Â Â Â Â Â //å°†è¾“å…¥æµå¤åˆ¶åˆ°æ§åˆ¶å°ä¸­ã€‚æ¸¸æ ‡åœ¨æœ€åçš„ä½ç½®ï¼Œç°åœ¨å°†æ¸¸æ ‡æŒ‡å‘æœ€å‰é¢Â Â Â Â Â Â Â Â fsDataInputStream.seek(0);Â Â Â Â Â Â Â Â //å°†è¾“å…¥æµå¤åˆ¶åˆ°æ§åˆ¶å°ä¸­ï¼Œfalseè¡¨ç¤ºä¸ä¼šè‡ªåŠ¨å…³é—­æµÂ Â Â Â Â Â Â Â IOUtils.copyBytes(fsDataInputStream,Â System.out,Â 4096,Â false);Â Â Â Â Â Â Â Â //å…³é—­è¾“å…¥æµÂ Â Â Â Â Â Â Â fsDataInputStream.close();Â Â Â Â }Â Â Â Â Â Â /**Â Â Â Â Â *Â éªŒè¯ä¸Šä¼ æ–‡ä»¶æ˜¯ä»¥packetä¸ºå•ä½Â Â Â Â Â *Â ç°è±¡ï¼šÂ Â Â Â Â *Â å½“Â hhb.xmlÂ ä¸­æ— ä¿¡æ¯ï¼Œä¸è¾“å‡º===Â Â Â Â Â *Â å½“Â hhb.xmlÂ ä¸­ä¿¡æ¯å¤§äº0KBï¼Œå°äº64KBï¼Œè¾“å‡ºä¸¤ä¸ªÂ ===Â Â Â Â Â *Â å½“Â hhb.xmlÂ ä¸­ä¿¡æ¯å¤§äº64KBï¼Œå°äº128KBï¼Œè¾“å‡ºä¸‰ä¸ªÂ ===Â Â Â Â Â *Â åŸå› ï¼šÂ Â Â Â Â *Â å½“hhb.xmlä¸­æ— ä¿¡æ¯çš„æ—¶å€™ï¼Œä¸ä¼šä¸NameNodeäº¤äº’ï¼Œæ‰€ä»¥ä¸ä¼šè¾“å‡ºï¼Œå½“äº§ç”Ÿäº¤äº’çš„æ—¶å€™ï¼Œå°±ä¼šå…ˆè¾“å‡ºä¸€ä¸ª====ã€‚Â Â Â Â Â *Â ç„¶åæ¯æ¬¡ä¸Šä¼ 64KBï¼Œæ‰€å°äº64KBçš„æ—¶å€™ä¼šè¾“å‡ºä¸¤ä¸ªã€‚ä¸€ä¸ªæ˜¯å»ºç«‹é“¾æ¥æ—¶å€™çš„è¾“å‡ºï¼Œä¸€ä¸ªæ˜¯ä¸Šä¼ æ•°æ®çš„è¾“å‡ºÂ Â Â Â Â *Â Â Â Â Â *Â @throwsÂ IOExceptionÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ testUploadFile()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â FileInputStreamÂ fileInputStreamÂ =Â newÂ FileInputStream(newÂ File("/Users/baiwang/Desktop/hhb.xml"));Â Â Â Â Â Â Â Â FSDataOutputStreamÂ fsDataOutputStreamÂ =Â fileSystem.create(newÂ Path("/lagou.txt"),Â ()Â -&gt;Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â System.err.println("===");Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â );Â Â Â Â Â Â Â Â IOUtils.copyBytes(fileInputStream,Â fsDataOutputStream,Â configuration);Â Â Â Â }}</code></pre><p>é—®é¢˜ï¼šä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™æŠ¥é”™ï¼Œå¦‚å›¾</p><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c2e70326b89948a5824f6e5b9d7e9f3c><p class=pgc-img-caption>Clientä¸Šä¼ æ–‡ä»¶æŠ¥é”™.png</p></div><p>åŸå› ï¼šå®¢æˆ·ç«¯åˆ›å»ºæ–‡ä»¶å…ˆè®¿é—®NameNodeæœåŠ¡å™¨è¿›è¡Œåˆ›å»ºæ–‡ä»¶Metaä¿¡æ¯ï¼Œä»¥åŠæ–‡ä»¶æ ‘ï¼Œæ­¤æ—¶è®¿é—®çš„çš„NameNodeçš„IPï¼ŒNameNodeæœåŠ¡å™¨åˆ›å»ºæ–‡ä»¶æˆåŠŸåï¼Œä¼šè¿”å›å¯¹åº”dataNodeçš„æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œä½†æ­¤æ—¶çš„èŠ‚ç‚¹ä¿¡æ¯ä¸­çš„ipæ˜¯ä¸NameNodeåœ¨åŒä¸€ç½‘ç»œä¸‹çš„å†…ç½‘IPï¼Œå®¢æˆ·ç«¯æ˜¯æ— æ³•è®¿é—®ï¼Œä¹Ÿå°±æ— æ³•å†™å…¥<br>è§£å†³ï¼šåœ¨å®¢æˆ·ç«¯ä¸­ï¼Œæˆ–è€…æœåŠ¡å™¨ç«¯etc/hadoop/hdfs-site.xmlä¸­é…ç½®</p><pre><code>conf.set("dfs.client.use.datanode.hostname","true");//è®¾ç½®å®¢æˆ·ç«¯è®¿é—®datanodeä½¿ç”¨hostnameæ¥è¿›è¡Œè®¿é—®</code></pre><p>ä½¿ç”¨æ­¤é…ç½®æœåŠ¡ç«¯è¿”å›çš„å°±æ˜¯åœ¨NameNodeçš„æ§åˆ¶å°ä¸­ç›¸åº”çš„DataNodeå¯¹åº”çš„HttpAddress</p><h1 class=pgc-h-arrow-right><strong>HDFSè¯»å†™è§£æ</strong></h1><h1 class=pgc-h-arrow-right><strong>HDFSè¯»æ•°æ®æµç¨‹</strong></h1><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/883560f48ff8473491477ab0ea703392><p class=pgc-img-caption>HDFSè¯»æ•°æ®æµç¨‹.png</p></div><ol start=1><li>å®¢æˆ·ç«¯é€šè¿‡Distributed FileSystemå‘NameNodeè¯·æ±‚ä¸‹è½½æ–‡ä»¶ï¼ŒNameNodeé€šè¿‡æŸ¥è¯¢å…ƒæ•°æ®æ‰¾åˆ°æ–‡ä»¶å—æ‰€åœ¨çš„DataNodeåœ°å€ã€‚NameNodeè¿”å›çš„æ•°æ®ï¼šç›®æ ‡æ–‡ä»¶çš„å—ä¿¡æ¯ä»¥åŠæ‰€åœ¨èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒNameNodeæ˜¯åˆ†æ‰¹è¿”å›ç»™çš„å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è¯»å–å®Œåè·å–ä¸‹ä¸€æ‰¹ã€‚</li><li>å®¢æˆ·ç«¯æŒ‘é€‰ä¸€æ¡DataNodeï¼ˆç‰©ç†è·ç¦»ï¼Œå°±è¿‘åŸåˆ™ï¼Œç„¶åéšæœºï¼‰æœåŠ¡å™¨ï¼Œè¯·æ±‚è¯»å–æ•°æ®ã€‚</li><li>DataNodeå¼€å§‹ä¼ è¾“æ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œï¼ˆä»ç£ç›˜é‡Œé¢è¯»å–æ•°æ®è¾“å…¥æµï¼Œä»¥Packetä¸ºå•ä½æ¥åšæ ¡éªŒï¼ŒPacketå¤§å°ä¸º64Kbï¼‰</li><li>å®¢æˆ·ç«¯ä»¥Packetä¸ºå•ä½æ¥æ”¶ï¼Œç°åœ¨æœ¬åœ°ç¼“å­˜ï¼Œç„¶åå†™å…¥ç›®æ ‡æ–‡ä»¶</li></ol><h1 class=pgc-h-arrow-right><strong>HDFSå†™æ•°æ®çš„æµç¨‹</strong></h1><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/297400de865e4e4bae42494ea7513eb7><p class=pgc-img-caption>HDFSå†™æ•°æ®çš„æµç¨‹.png</p></div><ol start=1><li>å®¢æˆ·ç«¯é€šè¿‡Distributed FileSystemæ¨¡å—å‘NameNodeè¯·æ±‚ä¸Šä¼ æ–‡ä»¶ï¼ŒNameNodeæ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œç›®æ ‡æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ã€‚</li><li>NameNodeè¿”å›æ˜¯å¦å¯ä»¥ä¸Šä¼ </li><li>å®¢æˆ·ç«¯è¯·æ±‚ç¬¬ä¸€ä¸ªBlockä¸Šä¼ åˆ°é‚£å‡ ä¸ªDataNodeæœåŠ¡å™¨ä¸Š</li><li>NameNodeè¿”å›3ä¸ªDataNodeèŠ‚ç‚¹ï¼Œåˆ†åˆ«ä¸ºdn1ã€dn2ã€dn3.</li><li>å®¢æˆ·ç«¯é€šè¿‡FSDataOutputStreamæ¨¡å—è¯·æ±‚dn1ä¸Šä¼ æ•°æ®ï¼Œdn1æ”¶åˆ°è¯·æ±‚ä¼šç»§ç»­è°ƒç”¨dn2ï¼Œç„¶ådn2è°ƒç”¨dn3ï¼Œå°†è¿™ä¸ªé€šä¿¡ç®¡é“å»ºç«‹å®Œæˆã€‚</li><li>dn1ã€dn2ã€dn3é€çº§åº”ç­”å®¢æˆ·ç«¯</li><li>å®¢æˆ·ç«¯å¼€å§‹å¾€dn1ä¸Šä¼ ç¬¬ä¸€ä¸ªblockï¼ˆå…ˆä»ç£ç›˜è¯»å–æ•°æ®æ”¾åˆ°ä¸€ä¸ªæœ¬åœ°å†…å­˜ç¼“å­˜ï¼‰ï¼Œä»¥Packetä¸ºå•ä½ï¼Œdn1æ”¶åˆ°ä¸€ä¸ªPacketå°±ä¼šä¼ ç»™dn2ï¼Œdn2ä¼ ç»™dn3ï¼Œdn1æ²¡ä¼ ä¸€ä¸ªpacketä¼šæ”¾å…¥åˆ°ç¡®è®¤é˜Ÿåˆ—ç­‰å¾…ç¡®è®¤,ç­‰å¾…dn2ã€dn3ç¡®è®¤æ•°æ®ä¼ è¾“å®Œæˆ</li><li>å½“ä¸€ä¸ªBlockä¼ è¾“å®Œæˆä¹‹åï¼Œå®¢æˆ·ç«¯å†æ¬¡è¯·æ±‚NameNodeä¸Šä¼ ç¬¬äºŒä¸ªblockçš„æœåŠ¡å™¨ï¼ˆé‡å¤æ‰§è¡Œ3-7ï¼‰</li></ol><p><strong>ä¸€è¾¹å†™å…¥ï¼Œä¸€è¾¹å®ç°å‰¯æœ¬åŒæ­¥ï¼Œè¿™æ ·è™½ç„¶ä¸Šä¼ æ•°æ®æ¯”è¾ƒæ…¢ï¼Œä½†æ˜¯ä¿è¯äº†æ•°æ®çš„å®‰å…¨</strong></p><h1 class=pgc-h-arrow-right><strong>NNä¸2NN</strong></h1><h1 class=pgc-h-arrow-right><strong>HDFSå…ƒæ•°æ®ç®¡ç†æœºåˆ¶</strong></h1><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/5e7af16492bd4106923a48cd47621f2a><p class=pgc-img-caption>å…ƒæ•°æ®ç®¡ç†æµç¨‹å›¾.png</p></div><ul><li>ç¬¬ä¸€é˜¶æ®µï¼šNameNodeå¯åŠ¨ ç¬¬ä¸€æ¬¡å¯åŠ¨NameNodeæ ¼å¼åŒ–åï¼Œåˆ›å»ºfsImagesï¼ˆç”Ÿæˆæ…¢ï¼Œæ¢å¤å¿«ï¼‰å’ŒEditsï¼ˆç”Ÿæˆå¿«ï¼Œæ¢å¤æ…¢ï¼‰æ–‡ä»¶ï¼Œå¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œç›´æ¥åŠ è½½ç¼–è¾‘æ—¥å¿—å’Œé•œåƒæ–‡ä»¶åˆ°å†…å­˜ã€‚ å®¢æˆ·ç«¯å¯¹å…ƒæ•°æ®è¿›è¡Œå¢åˆ æ”¹çš„è¯·æ±‚ NameNodeè®°å½•æ“ä½œæ—¥å¿—ï¼Œæ›´æ–°æ»šåŠ¨æ—¥å¿— NameNodeåœ¨å†…å­˜ä¸­å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹ã€‚</li><li>ç¬¬äºŒé˜¶æ®µï¼šSecondary NameNodeï¼ˆè¾…åŠ©NameNodeç»´æŠ¤å…ƒæ•°æ®ç®¡ç†ï¼‰å·¥ä½œ 2nnè¯¢é—®nnæ˜¯å¦éœ€è¦CheckPointï¼Œç›´æ¥å¸¦å›nnæ˜¯å¦æ‰§è¡Œæ£€å¯Ÿç‚¹æ“ä½œç»“æœ 2nnè¯·æ±‚æ‰§è¡ŒCheckPointã€‚ nnæ»šåŠ¨æ­£åœ¨å†™çš„Editsæ—¥å¿— å°†æ»šåŠ¨å‰çš„ç¼–è¾‘æ—¥å¿—å’Œé•œåƒæ–‡ä»¶æ‹·è´åˆ°2nn 2nnåŠ è½½ç¼–è¾‘æ—¥å¿—å’Œé•œåƒæ–‡ä»¶åˆ°å†…å­˜å¹¶åˆå¹¶ ç”Ÿäº§æ–°çš„é•œåƒæ–‡ä»¶fsimage.chkpoint æ‹·è´fsimage.chpointåˆ°nn nnå°†fsimage.chpoint é‡æ–°å‘½åä¸ºfsimage</li></ul><p>checkPointè§¦å‘æ—¶æœº</p><ol start=1><li>åˆ°å®šæ—¶æ—¶é—´</li><li>Editsç¼–è¾‘æ–‡ä»¶æ»¡ã€‚<br>Fsimageã€editså­˜æ”¾è·¯å¾„ï¼š</li></ol><pre><code>/opt/lagou/servers/hadoop-2.9.2/data/tmp/dfs/name/current</code></pre><h1 class=pgc-h-arrow-right><strong>FsImage ä¸Edits æ–‡ä»¶è§£æ</strong></h1><p>NameNodeåœ¨æ‰§è¡Œæ ¼å¼åŒ–ä¹‹åï¼Œä¼šåœ¨/opt/lg/servers/hadoop-2.9.2/data/tmp/dfs/name/currentç›®å½•ä¸‹ç”Ÿæˆæ–‡ä»¶ï¼š</p><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6a48fd6b710d42dda0c02b4c2b4226c7><p class=pgc-img-caption>FsImageä¸Editesæ–‡ä»¶è§£æ.png</p></div><ul><li>FsImageæ–‡ä»¶ï¼šæ˜¯NameNodeä¸­å…ƒæ•°æ®çš„é•œåƒï¼Œä¸€èˆ¬è¢«ç§°ä¸ºæ£€æŸ¥ç‚¹ï¼ŒåŒ…å«HDFSæ–‡ä»¶ç³»ç»Ÿæ‰€æœ‰ç›®å½•åŠæ–‡ä»¶ç›¸å…³ä¿¡æ¯ï¼ˆBlockæ•°é‡ã€å‰¯æœ¬æ•°é‡ã€æƒé™ï¼‰</li><li>Editsæ–‡ä»¶ï¼šå­˜å‚¨çš„æ˜¯å®¢æˆ·ç«¯å¯¹HDFSçš„å¢åˆ æ”¹æ“ä½œ</li><li>*.md5æ–‡ä»¶ï¼š æ ¡éªŒæ–‡ä»¶ã€‚</li><li>seen_txidä¿å­˜çš„æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå¯¹åº”ç€æœ€åä¸€ä¸ªEditsæ–‡ä»¶åçš„æ•°å­—</li><li>VERSIONï¼šè®°å½•namenodeçš„ä¸€äº›ç‰ˆæœ¬å·ä¿¡æ¯ï¼Œæ¯”å¦‚custerIDï¼ŒnamespaceId</li></ul><p>NameNodeå¯åŠ¨æ—¶ä¼šå°†FsImageåŠ è½½åˆ°å†…å­˜ä¸­ï¼ŒåŒæ—¶å°†ä¹‹å‰æ²¡æœ‰åˆå¹¶åˆ°å…ƒæ•°æ®çš„Editsæ–‡ä»¶åŠ è½½ï¼Œé›†åˆä¸¤ä¸ªæ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œè¿™æ ·ä¿è¯äº†å†…å­˜ä¸­çš„å…ƒæ•°æ®æ˜¯æœ€æ–°æœ€å…¨çš„ï¼Œ</p><h1 class=pgc-h-arrow-right><strong>æŸ¥çœ‹FsImageæ–‡ä»¶å†…å®¹</strong></h1><pre><code>##Â hdfsÂ oivÂ -pÂ æ–‡ä»¶ç±»å‹ï¼ˆå°±æ˜¯fsimageè½¬æˆä»€ä¹ˆç±»å‹ï¼‰-iÂ é•œåƒæ–‡ä»¶Â -oÂ è¾“å‡ºè·¯å¾„cdÂ /opt/lagou/servers/hadoop-2.9.2/data/tmp/dfs/name/currenthdfsÂ oivÂ -pÂ XMLÂ -iÂ fsimage_0000000000000000505Â -oÂ /opt/hhb.xml</code></pre><p>hhb.xmlæ–‡ä»¶å†…å®¹</p><pre><code>&lt;?xmlÂ version="1.0"Â encoding="utf-8"?&gt;&lt;fsimage&gt;Â Â &lt;version&gt;Â Â Â Â &lt;layoutVersion&gt;-63&lt;/layoutVersion&gt;Â Â Â Â &lt;onDiskVersion&gt;1&lt;/onDiskVersion&gt;Â Â Â Â &lt;oivRevision&gt;826afbeae31ca687bc2f8471dc841b66ed2c6704&lt;/oivRevision&gt;Â Â &lt;/version&gt;Â Â Â Â &lt;NameSection&gt;Â Â Â Â &lt;namespaceId&gt;853376951&lt;/namespaceId&gt;Â Â Â Â &lt;genstampV1&gt;1000&lt;/genstampV1&gt;Â Â Â Â &lt;genstampV2&gt;1045&lt;/genstampV2&gt;Â Â Â Â &lt;genstampV1Limit&gt;0&lt;/genstampV1Limit&gt;Â Â Â Â &lt;lastAllocatedBlockId&gt;1073741867&lt;/lastAllocatedBlockId&gt;Â Â Â Â &lt;txid&gt;505&lt;/txid&gt;Â Â &lt;/NameSection&gt;Â Â Â Â &lt;INodeSection&gt;Â Â Â Â &lt;lastInodeId&gt;16473&lt;/lastInodeId&gt;Â Â Â Â &lt;numInodes&gt;38&lt;/numInodes&gt;Â Â Â Â &lt;inode&gt;Â Â Â Â Â Â &lt;id&gt;16385&lt;/id&gt;Â Â Â Â Â Â &lt;type&gt;DIRECTORY&lt;/type&gt;Â Â Â Â Â Â &lt;name/&gt;Â Â Â Â Â Â &lt;mtime&gt;1593694994111&lt;/mtime&gt;Â Â Â Â Â Â &lt;permission&gt;root:supergroup:0777&lt;/permission&gt;Â Â Â Â Â Â &lt;nsquota&gt;9223372036854775807&lt;/nsquota&gt;Â Â Â Â Â Â &lt;dsquota&gt;-1&lt;/dsquota&gt;Â Â Â Â &lt;/inode&gt;Â Â Â Â Â Â &lt;inode&gt;Â Â Â Â Â Â &lt;id&gt;16386&lt;/id&gt;Â Â Â Â Â Â &lt;type&gt;DIRECTORY&lt;/type&gt;Â Â Â Â Â Â &lt;name&gt;test&lt;/name&gt;Â Â Â Â Â Â &lt;mtime&gt;1593598825098&lt;/mtime&gt;Â Â Â Â Â Â &lt;permission&gt;root:supergroup:0777&lt;/permission&gt;Â Â Â Â Â Â &lt;nsquota&gt;-1&lt;/nsquota&gt;Â Â Â Â Â Â &lt;dsquota&gt;-1&lt;/dsquota&gt;Â Â Â Â &lt;/inode&gt;Â Â Â Â Â Â ã€‚ã€‚ã€‚Â Â &lt;/INodeSection&gt;Â Â Â Â &lt;INodeReferenceSection/&gt;Â Â &lt;SnapshotSection&gt;Â Â Â Â &lt;snapshotCounter&gt;0&lt;/snapshotCounter&gt;Â Â Â Â &lt;numSnapshots&gt;0&lt;/numSnapshots&gt;Â Â &lt;/SnapshotSection&gt;Â Â Â Â &lt;INodeDirectorySection&gt;Â Â Â Â &lt;directory&gt;Â Â Â Â Â Â &lt;parent&gt;16385&lt;/parent&gt;Â Â Â Â Â Â &lt;child&gt;16471&lt;/child&gt;Â Â Â Â Â Â &lt;child&gt;16448&lt;/child&gt;Â Â Â Â Â Â &lt;child&gt;16473&lt;/child&gt;Â Â Â Â &lt;/directory&gt;Â Â Â &lt;/INodeDirectorySection&gt;Â Â Â Â &lt;FileUnderConstructionSection/&gt;Â Â Â Â &lt;SecretManagerSection&gt;Â Â Â Â &lt;currentId&gt;0&lt;/currentId&gt;Â Â Â Â &lt;tokenSequenceNumber&gt;0&lt;/tokenSequenceNumber&gt;Â Â Â Â &lt;numDelegationKeys&gt;0&lt;/numDelegationKeys&gt;Â Â Â Â &lt;numTokens&gt;0&lt;/numTokens&gt;Â Â &lt;/SecretManagerSection&gt;Â Â &lt;CacheManagerSection&gt;Â Â Â Â &lt;nextDirectiveId&gt;1&lt;/nextDirectiveId&gt;Â Â Â Â &lt;numDirectives&gt;0&lt;/numDirectives&gt;Â Â Â Â &lt;numPools&gt;0&lt;/numPools&gt;Â Â &lt;/CacheManagerSection&gt;Â &lt;/fsimage&gt;</code></pre><p><strong>Fsimageé‡Œé¢æ˜¯ä¸è®°å½•blockæ‰€åœ¨çš„èŠ‚ç‚¹ä¿¡æ¯çš„ï¼Œæ˜¯åœ¨é›†ç¾¤å¯åŠ¨æ—¶ï¼ŒNameNodeè¦æ±‚DataNodeä¸ŠæŠ¥æ•°æ®å—ä¿¡æ¯ï¼Œå¹¶é—´éš”ä¸€æ®µæ—¶é—´å†æ¬¡ä¸ŠæŠ¥ï¼Œè¿™ä¹ˆåšçš„ç†ç”±æ˜¯å› ä¸ºå¦‚æœFsImageé‡Œè®°å½•äº†DataNodeä¿¡æ¯ï¼Œä½†æ˜¯DataNodeæŒ‚äº†ï¼ŒNameNodeæ‹¿ç€å†å²çš„FsimageåŠ è½½åˆ°å†…å®¹ï¼Œè®°å½•çš„æ˜¯å†å²æ•°æ®ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</strong></p><h1 class=pgc-h-arrow-right><strong>æŸ¥çœ‹Editsæ–‡ä»¶å†…å®¹</strong></h1><pre><code>##Â hdfsÂ oevÂ -pÂ æ–‡ä»¶ç±»å‹ï¼ˆå°±æ˜¯editsè½¬æˆä»€ä¹ˆç±»å‹ï¼‰-iÂ ç¼–è¾‘æ—¥å¿—Â -oÂ è¾“å‡ºè·¯å¾„cdÂ /opt/lagou/servers/hadoop-2.9.2/data/tmp/dfs/name/currenthdfsÂ oivÂ -pÂ XMLÂ -iÂ fsimage_0000000000000000505Â -oÂ /opt/hhb.xml</code></pre><p>hhb2.xmlæ–‡ä»¶å†…å®¹</p><pre><code>&lt;?xmlÂ version="1.0"Â encoding="UTF-8"?&gt;&lt;EDITS&gt;Â Â &lt;EDITS_VERSION&gt;-63&lt;/EDITS_VERSION&gt;Â Â &lt;RECORD&gt;Â Â Â Â &lt;OPCODE&gt;OP_START_LOG_SEGMENT&lt;/OPCODE&gt;Â Â Â Â &lt;DATA&gt;Â Â Â Â Â Â &lt;TXID&gt;414&lt;/TXID&gt;Â Â Â Â &lt;/DATA&gt;Â Â &lt;/RECORD&gt;Â Â &lt;RECORD&gt;Â Â Â Â &lt;OPCODE&gt;OP_SET_GENSTAMP_V2&lt;/OPCODE&gt;Â Â Â Â &lt;DATA&gt;Â Â Â Â Â Â &lt;TXID&gt;415&lt;/TXID&gt;Â Â Â Â Â Â &lt;GENSTAMPV2&gt;1044&lt;/GENSTAMPV2&gt;Â Â Â Â &lt;/DATA&gt;Â Â &lt;/RECORD&gt;Â Â &lt;RECORD&gt;Â Â Â Â &lt;OPCODE&gt;OP_REASSIGN_LEASE&lt;/OPCODE&gt;Â Â Â Â &lt;DATA&gt;Â Â Â Â Â Â &lt;TXID&gt;416&lt;/TXID&gt;Â Â Â Â Â Â &lt;LEASEHOLDER&gt;DFSClient_NONMAPREDUCE_-968919369_1&lt;/LEASEHOLDER&gt;Â Â Â Â Â Â &lt;PATH&gt;/api_test&lt;/PATH&gt;Â Â Â Â Â Â &lt;NEWHOLDER&gt;HDFS_NameNode-2020-07-02Â 20:31:54,840+0800&lt;/NEWHOLDER&gt;Â Â Â Â &lt;/DATA&gt;Â Â &lt;/RECORD&gt;Â Â &lt;RECORD&gt;Â Â Â Â &lt;OPCODE&gt;OP_CLOSE&lt;/OPCODE&gt;Â Â Â Â &lt;DATA&gt;Â Â Â Â Â Â &lt;TXID&gt;417&lt;/TXID&gt;Â Â Â Â Â Â &lt;LENGTH&gt;0&lt;/LENGTH&gt;Â Â Â Â Â Â &lt;INODEID&gt;0&lt;/INODEID&gt;Â Â Â Â Â Â &lt;PATH&gt;/api_test&lt;/PATH&gt;Â Â Â Â Â Â &lt;REPLICATION&gt;3&lt;/REPLICATION&gt;Â Â Â Â Â Â &lt;MTIME&gt;1593693116738&lt;/MTIME&gt;Â Â Â Â Â Â &lt;ATIME&gt;1593689482882&lt;/ATIME&gt;Â Â Â Â Â Â &lt;BLOCKSIZE&gt;134217728&lt;/BLOCKSIZE&gt;Â Â Â Â Â Â &lt;CLIENT_NAME&gt;&lt;/CLIENT_NAME&gt;Â Â Â Â Â Â &lt;CLIENT_MACHINE&gt;&lt;/CLIENT_MACHINE&gt;Â Â Â Â Â Â &lt;OVERWRITE&gt;false&lt;/OVERWRITE&gt;Â Â Â Â Â Â &lt;PERMISSION_STATUS&gt;Â Â Â Â Â Â Â Â &lt;USERNAME&gt;root&lt;/USERNAME&gt;Â Â Â Â Â Â Â Â &lt;GROUPNAME&gt;supergroup&lt;/GROUPNAME&gt;Â Â Â Â Â Â Â Â &lt;MODE&gt;420&lt;/MODE&gt;Â Â Â Â Â Â &lt;/PERMISSION_STATUS&gt;Â Â Â Â &lt;/DATA&gt;Â Â &lt;/RECORD&gt;Â Â &lt;RECORD&gt;Â Â Â Â &lt;OPCODE&gt;OP_TIMES&lt;/OPCODE&gt;Â Â Â Â &lt;DATA&gt;Â Â Â Â Â Â &lt;TXID&gt;418&lt;/TXID&gt;Â Â Â Â Â Â &lt;LENGTH&gt;0&lt;/LENGTH&gt;Â Â Â Â Â Â &lt;PATH&gt;/lagou.txt&lt;/PATH&gt;Â Â Â Â Â Â &lt;MTIME&gt;-1&lt;/MTIME&gt;Â Â Â Â Â Â &lt;ATIME&gt;1593693390155&lt;/ATIME&gt;Â Â Â Â &lt;/DATA&gt;Â Â &lt;/RECORD&gt;Â Â &lt;RECORD&gt;Â Â Â Â &lt;OPCODE&gt;OP_TIMES&lt;/OPCODE&gt;Â Â Â Â &lt;DATA&gt;Â Â Â Â Â Â &lt;TXID&gt;419&lt;/TXID&gt;Â Â Â Â Â Â &lt;LENGTH&gt;0&lt;/LENGTH&gt;Â Â Â Â Â Â &lt;PATH&gt;/yarn-site.xml&lt;/PATH&gt;Â Â Â Â Â Â &lt;MTIME&gt;-1&lt;/MTIME&gt;Â Â Â Â Â Â &lt;ATIME&gt;1593693395993&lt;/ATIME&gt;Â Â Â Â &lt;/DATA&gt;Â Â &lt;/RECORD&gt;Â Â &lt;RECORD&gt;Â Â Â Â &lt;OPCODE&gt;OP_END_LOG_SEGMENT&lt;/OPCODE&gt;Â Â Â Â &lt;DATA&gt;Â Â Â Â Â Â &lt;TXID&gt;420&lt;/TXID&gt;Â Â Â Â &lt;/DATA&gt;Â Â &lt;/RECORD&gt;&lt;/EDITS&gt;</code></pre><h1 class=pgc-h-arrow-right><strong>CheckPointçš„å‘¨æœŸ</strong></h1><p>hdfs-default.xml</p><pre><code>&lt;!--Â å®šæ—¶ä¸€å°æ—¶Â --&gt;&lt;property&gt;Â Â Â Â &lt;name&gt;dfs.namenode.checkpoint.period&lt;/name&gt;Â Â Â Â &lt;value&gt;3600&lt;/value&gt;&lt;/property&gt;&lt;!--Â ä¸€åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ“ä½œæ¬¡æ•°ï¼Œå½“æ“ä½œæ¬¡æ•°è¾¾åˆ°1ç™¾ä¸‡æ—¶ï¼ŒSecondaryNameNodeæ‰§è¡Œä¸€æ¬¡Â --&gt;&lt;property&gt;Â Â Â Â &lt;name&gt;dfs.namenode.checkpoint.txns&lt;/name&gt;Â Â Â Â &lt;value&gt;1000000&lt;/value&gt;Â Â Â Â &lt;description&gt;æ“ä½œåŠ¨ä½œæ¬¡æ•°&lt;/description&gt;&lt;/property&gt;&lt;property&gt;Â Â Â Â &lt;name&gt;dfs.namenode.checkpoint.check.period&lt;/name&gt;Â Â Â Â &lt;value&gt;60&lt;/value&gt;Â Â Â Â &lt;description&gt;Â 1åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ“ä½œæ¬¡æ•°&lt;/description&gt;&lt;/propertyÂ &gt;</code></pre><h1 class=pgc-h-arrow-right><strong>NameNodeæ•…éšœå¤„ç†</strong></h1><p>NameNodeæ•…éšœåï¼ŒHDFSé›†ç¾¤å°±æ— æ³•æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºHDFSæ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®éœ€è¦NameNodeæ¥ç®¡ç†å¹¶ä¸Clientäº¤äº’ï¼Œå¦‚æœå…ƒæ•°æ®æŸåå’Œä¸¢å¤±ä¹Ÿä¼šæœ‰åŒæ ·çš„é—®é¢˜</p><p>å¦‚æœå…ƒæ•°æ®ä¸¢å¤±å¦‚ä½•æ¢å¤ï¼Ÿ</p><ol start=1><li>å°†2NNçš„å…ƒæ•°æ®æ‹·è´åˆ°NN ä½†æ˜¯è¿™ç§æƒ…å†µä¼šå­˜åœ¨å…ƒæ•°æ®ä¸¢å¤±</li><li>æ­å»ºHDFSçš„HAï¼ˆé«˜å¯ç”¨é›†ç¾¤ï¼‰ï¼Œè§£å†³NNçš„å•ç‚¹æ•…éšœé—®é¢˜ï¼å€ŸåŠ©zkå®ç°HAï¼Œä¸€ä¸ªæ˜¯Activeçš„NameNodeï¼Œä¸€ä¸ªæ˜¯Standbyçš„NameNode</li></ol><h1 class=pgc-h-arrow-right><strong>Hadoopçš„é™é¢ä¸å½’æ¡£ä»¥åŠé›†ç¾¤å®‰å…¨æ¨¡å¼</strong></h1><h1 class=pgc-h-arrow-right><strong>é«˜çº§å‘½ä»¤</strong></h1><ul><li>HDFSæ–‡ä»¶é™é¢ HDFSæ–‡ä»¶çš„é™é¢é…ç½®å…è®¸æˆ‘ä»¬ä»¥æ–‡ä»¶å¤§å°æˆ–è€…æ–‡ä»¶ä¸ªæ•°æ¥é™åˆ¶æˆ‘ä»¬åœ¨æŸä¸ªç›®å½•ä¸‹ä¸Šä¼ æ–‡ä»¶æ•°é‡æˆ–è€…æ–‡ä»¶å†…å®¹ã€‚ä»¥ä¾¿æˆ‘ä»¬è¾¾åˆ°ç±»ä¼¼ç™¾åº¦ç½‘ç›˜é™åˆ¶æ¯ä¸ªç”¨æˆ·ä¸Šä¼ çš„æœ€å¤§æ–‡ä»¶é‡</li></ul><ol start=1><li>æ•°é‡é™åˆ¶</li></ol><pre><code>#Â å¯¹hhbæ–‡ä»¶å¤¹ä¸Šä¼ æ•°é‡é™åˆ¶ï¼Œè®¾ç½®ä¸º2ï¼Œå®é™…é™åˆ¶ä¸º2-1hdfsÂ dfsadminÂ -setQuotaÂ 2Â Â /hhb#Â ä¸Šä¼ æ–‡ä»¶ã€‚æˆåŠŸhdfsÂ dfsÂ -copyFromLocalÂ /root/wc.txtÂ /hhb/#Â å†æ¬¡ä¸Šä¼ ï¼ŒæŠ¥é”™ï¼Œé”™è¯¯ï¼šcopyFromLocal:Â TheÂ NameSpaceÂ quotaÂ (directoriesÂ andÂ files)Â ofÂ directoryÂ /hhbÂ isÂ exceeded:Â quota=2Â fileÂ count=3hdfsÂ dfsÂ -copyFromLocalÂ /root/wc.txtÂ /hhb/hhh.txt#Â æ¸…é™¤é™é¢,å†æ¬¡ä¸Šä¼ ï¼ŒæˆåŠŸhdfsÂ dfsadminÂ -clrQuotaÂ /hhb</code></pre><ol start=2><li>ç©ºé—´å¤§å°é™åˆ¶</li></ol><pre><code>#Â å¯¹hhbæ–‡ä»¶å¤¹ä¸Šä¼ ç©ºé—´é™åˆ¶ï¼Œè®¾ç½®ä¸º4KBhdfsÂ dfsadminÂ -setSpaceQuotaÂ 4KÂ /hhb#Â ä¸Šä¼ æ–‡ä»¶æŠ¥é”™ï¼šput:Â TheÂ DiskSpaceÂ quotaÂ ofÂ /hhbÂ isÂ exceeded:Â quotaÂ =Â 4096Â BÂ =Â 4Â KBÂ butÂ diskspaceÂ consumedÂ =Â 402653646Â BÂ =Â 384.00Â MBhdfsÂ dfsÂ -putÂ /opt/lagou/software/hadoop-2.9.2.tar.gzÂ /hhb/#Â æ¸…é™¤é™åˆ¶ç©ºé—´å¤§å°,å†æ¬¡ä¸Šä¼ ï¼Œä¸Šä¼ æˆåŠŸhdfsÂ dfsadminÂ -clrSpaceQuotaÂ /hhb</code></pre><ul><li>HDFSå®‰å…¨æ¨¡å¼ HDFSé›†ç¾¤å¯åŠ¨æ—¶éœ€è¦åŠ è½½FsImageå’ŒEditsæ–‡ä»¶ï¼Œè€Œè¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½æ²¡æœ‰è®°å½•Blockå¯¹åº”çš„DataNodeä¿¡æ¯ï¼Œå¦‚æœclientè¯·æ±‚ä¸‹è½½æ–‡ä»¶ï¼Œé›†ç¾¤æ˜¯ä¸èƒ½å·¥ä½œçš„ <strong>å®‰å…¨æ¨¡å¼</strong>æ˜¯HDFSæ‰€å¤„çš„ä¸€ç§ç‰¹æ®ŠçŠ¶æ€ï¼Œåœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œæ–‡ä»¶ç³»ç»Ÿ<strong>åªæ¥å—è¯»æ•°æ®è¯·æ±‚ï¼Œè€Œä¸æ¥å—åˆ é™¤ã€ä¿®æ”¹ç­‰å˜æ›´è¯·æ±‚</strong>ï¼Œåœ¨NameNodeä¸»èŠ‚ç‚¹å¯åŠ¨æ—¶ï¼ŒHDFSé¦–å…ˆè¿›å…¥å®‰å…¨æ¨¡å¼ï¼ŒDataNodeåœ¨å¯åŠ¨æ—¶ä¼šå‘NameNodeæ±‡æŠ¥å¯ç”¨çš„Blockç­‰çŠ¶æ€ï¼Œå½“æ•´ä¸ªç³»ç»Ÿè¾¾åˆ°å®‰å…¨æ ‡å‡†æ—¶ï¼ŒHDFSè‡ªåŠ¨ç¦»å¼€å®‰å…¨æ¨¡å¼ï¼Œå¦‚æœHDFSå¤„äºå®‰å…¨æ¨¡å¼ä¸‹ï¼Œåˆ™æ–‡ä»¶Blockä¸èƒ½è¿›è¡Œä»»ä½•çš„å‰¯æœ¬å¤åˆ¶æ“ä½œï¼Œå› æ­¤è¾¾åˆ°æœ€å°å‰¯æœ¬æ•°é‡æ˜¯è¦æ±‚åŸºäºDataNodeå¯åŠ¨æ—¶çš„çŠ¶æ€æ¥åˆ¤å®šçš„ï¼Œå¯åŠ¨æ—¶ä¸ä¼šåšä»»ä½•æ¶å¾·å¤åˆ¶ï¼ˆä»è€Œè¾¾åˆ°æœ€å°å‰¯æœ¬æ•°é‡è¦æ±‚ï¼‰ï¼ŒHDFSé›†ç¾¤åˆšå¯åŠ¨çš„æ—¶å€™ï¼Œé»˜è®¤30æ—¶é—´æ—¶å¤„äºå®‰å…¨æœŸçš„ï¼Œåªæœ‰è¿‡äº†30åï¼Œé›†ç¾¤è„±ç¦»å®‰å…¨æœŸï¼Œç„¶åæ‰å¯ä»¥å¯¹é›†ç¾¤è¿›è¡Œè¿‡æ“ä½œã€‚</li></ul><pre><code>##Â è¿›å…¥å®‰å…¨æ¨¡å¼hdfsÂ dfsadminÂ -safemodeÂ enter##Â é€€å‡ºå®‰å…¨æ¨¡å¼hdfsÂ dfsadminÂ -safemodeÂ leave #åœ¨é¡µé¢çš„Summaryæ¨¡å—çš„ç¬¬äºŒè¡Œå¯ä»¥çœ‹è§å½“å‰é›†ç¾¤å¤„äºä¸å¤„äºå®‰å…¨æ¨¡å¼ </code></pre><ul><li>Hadoopå½’æ¡£æŠ€æœ¯</li></ul><p><strong>ä¸»è¦è§£å†³HDFSé›†ç¾¤å­˜åœ¨å¤§é‡å°æ–‡ä»¶çš„é—®é¢˜ã€‚</strong></p><p>ç”±äºå¤§é‡çš„å°æ–‡ä»¶ä¼šå ç”¨NameNodeçš„å†…å­˜ï¼Œå› æ­¤å­˜å‚¨å¤§é‡å°æ–‡ä»¶ä¼šé€ æˆNameNodeå†…å­˜èµ„æºçš„æµªè´¹ã€‚</p><p>Hadoopå­˜æ¡£æ–‡ä»¶HARæ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªé«˜æ•ˆçš„æ–‡ä»¶å­˜æ¡£å·¥å…·ï¼ŒHARæ–‡ä»¶æ˜¯ç”±ä¸€ç»„æ–‡ä»¶é€šè¿‡archiveå·¥å…·åˆ›å»ºè€Œæ¥ï¼Œåœ¨å‡å°‘äº†NameNodeçš„å†…å­˜ä½¿ç”¨çš„åŒæ—¶ï¼Œå¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œé€æ˜é˜²é—®ï¼Œé€šä¿—æ¥è¯´å°±æ˜¯HARæ–‡ä»¶å¯¹NameNodeæ¥è¯´æ˜¯ä¸€ä¸ªæ–‡ä»¶å‡å°‘äº†å†…å­˜çš„æµªè´¹ï¼Œå¯¹äºå®é™…æ“ä½œè¿˜æ˜¯ä¸€ä¸ªä¸ªç‹¬ç«‹çš„æ–‡ä»¶ã€‚<br></p><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/09c2836e66f244e8b3137f71ddedf618><p class=pgc-img-caption>HARæ–‡ä»¶å½’æ¡£.png</p></div><p>ç›®å‰hhbç›®å½•ä¸‹æœ‰ä¸¤ä¸ªå°æ–‡ä»¶,æ‰§è¡Œå‘½ä»¤</p><pre><code>hadoopÂ archiveÂ -archiveNameÂ hhb.harÂ -pÂ /hhbÂ /hhbhar</code></pre><p>åœ¨hhbharç›®å½•ä¸‹å°±ä¼šæœ‰hhb.haræ–‡ä»¶,å±•ç¤ºhhb.haræ–‡ä»¶å†…å®¹</p><pre><code>hdfsÂ dfsÂ -lsÂ -RÂ /hhbhar/hhb.harÂ </code></pre><p>å†…å®¹ï¼š</p><pre><code>-rw-r--r--Â Â Â 3Â rootÂ supergroupÂ Â Â Â Â Â Â Â Â Â 0Â 2020-07-04Â 14:37Â /hhbhar/hhb.har/_SUCCESS-rw-r--r--Â Â Â 3Â rootÂ supergroupÂ Â Â Â Â Â Â Â 188Â 2020-07-04Â 14:37Â /hhbhar/hhb.har/_index-rw-r--r--Â Â Â 3Â rootÂ supergroupÂ Â Â Â Â Â Â Â Â 23Â 2020-07-04Â 14:37Â /hhbhar/hhb.har/_masterindex-rw-r--r--Â Â Â 3Â rootÂ supergroupÂ Â Â Â Â Â Â Â 154Â 2020-07-04Â 14:37Â /hhbhar/hhb.har/part-0</code></pre><p>åœ¨hhbharç›®å½•ä¸‹å°±ä¼šæœ‰hhb.haræ–‡ä»¶,å±•ç¤ºhhb.haræ–‡ä»¶å†…å®¹</p><pre><code>Â hdfsÂ dfsÂ -lsÂ -RÂ har:///hhbhar/hhb.har</code></pre><p>å†…å®¹ï¼š</p><pre><code>-rw-r--r--Â Â Â 3Â rootÂ supergroupÂ Â Â Â Â Â Â Â Â 77Â 2020-07-04Â 14:11Â har:///hhbhar/hhb.har/hhh.txt-rw-r--r--Â Â Â 3Â rootÂ supergroupÂ Â Â Â Â Â Â Â Â 77Â 2020-07-04Â 14:09Â har:///hhbhar/hhb.har/wc.txt</code></pre><p>å°†/hhbæ–‡ä»¶å¤¹ä¸‹é¢çš„å†…å®¹åˆ é™¤ï¼Œç„¶åå°†hhb.harå†…å®¹è§£å‹è¿‡å»</p><pre><code>hdfsÂ dfsÂ -rmÂ /hhb/*hdfsÂ dfsÂ -lsÂ /hhbhdfsÂ dfsÂ -cpÂ har:///hhbhar/hhb.har/*Â /hhb/hdfsÂ dfsÂ -lsÂ /hhb</code></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Hadoop','HDFS'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>