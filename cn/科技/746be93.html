<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>让步进电机动起来——L298N驱动步进电机 | 极客快訊</title><meta property="og:title" content="让步进电机动起来——L298N驱动步进电机 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/9ec67e97f2164f22b65fd33c4fe77112"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/746be93.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/746be93.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/746be93.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/746be93.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/746be93.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/746be93.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/746be93.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/746be93.html><meta property="article:published_time" content="2020-10-29T21:00:31+08:00"><meta property="article:modified_time" content="2020-10-29T21:00:31+08:00"><meta name=Keywords content><meta name=description content="让步进电机动起来——L298N驱动步进电机"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/746be93.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>让步进电机动起来——L298N驱动步进电机</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>步进电机特点：</h1><ul><li>它是通过输入脉冲信号来进行控制的</li><li>电机的总转动角度由输入脉冲数决定</li><li>电机的转速由脉冲信号频率决定</li></ul><p><strong>步进电机</strong>主要用于一些有定位要求、进行精确控制的场合。特别适合要求运行平稳、低噪音、响应快、使用寿命长、高输出扭矩的应用场合。比如3D打印机、工业机器人等场景。</p><div class=pgc-img><img alt=让步进电机动起来——L298N驱动步进电机 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9ec67e97f2164f22b65fd33c4fe77112><p class=pgc-img-caption>步进电机在工业机器人中的应用</p></div><p></p><h1 class=pgc-h-arrow-right>步进电机相关概念：</h1><ul><li><strong>拍数</strong></li></ul><blockquote><p>完成一个磁场周期性变化所需脉冲数或导电状态用n表示，或指电机转过一个齿距角所需脉冲数，以四相电机为例，有四相四拍运行方式即AB-BC-CD-DA-AB，四相八拍运行方式即A-AB-B-BC-C-CD-D-DA-A。</p></blockquote><ul><li><strong>步距角</strong></li></ul><blockquote><p>控制系统每发一个步进脉冲信号，电机所转动的角度。现在市场上常规的二、四相混合式步进电机基本步距角都是1.8°。</p></blockquote><h1 class=pgc-h-arrow-right>相关问题：</h1><blockquote><p>问题：</p><p>有一步进电机参数，如下：</p><p>[电压 12VDC 相数 4 减速比 1/64 步距角 1.8° /64 驱动方式 四相八拍 ]</p><p>请问： 步距角1.8°/64 ，后面的 “/64”表示什么意思？此步进电机转一圈，要多少步？</p><p><br></p><p><strong>答案</strong>：12VDC的步进电机，L298N的VS接12V直流电源。步进电机本身到电机轴之间是有一级齿轮减速的，64指减速比，即：电机本身的转子转64圈，输出的电机轴才转1圈。步距角1.8° /64表示，每走动64拍，转过角度为1.8度，转一圈共需要(360/1.8)*64=12800拍(步)</p></blockquote><hr><p>若是新手，不知道怎么设计电机驱动电路，可以直接购买电机驱动模块，市面上这种功能模块非常多，比如L298N电机驱动模块，只需要单片机6个IO外加一个电机供电电源即可驱动步进电机。</p><div class=pgc-img><img alt=让步进电机动起来——L298N驱动步进电机 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/6091294d7d0047f787e20356323e89e7><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>L298N主要参数说明</h1><ul><li>控制信号供电：直流5V；</li><li>电机供电：直流3V~46V（建议使用36V以下）</li><li>最大工作电流：2.5A</li><li>额定功率：25W</li><li>控制信号输入电压范围：</li></ul><blockquote><p>低电平：-0.3V &lt;= Vin &lt;= 1.5V高电平：2.3V &lt;= Vin &lt;= Vss</p></blockquote><ul><li>使能信号输入电压范围：</li></ul><blockquote><p>低电平：-0.3V &lt;= Vin &lt;= 1.5V（控制信号无效）</p><p>高电平：2.3V &lt;= Vin &lt;= Vss（控制信号有效）</p></blockquote><ul><li>L298N芯片的输入电压有两个:</li></ul><blockquote><p>VSS：逻辑电压，提供逻辑器件的电源，允许4.5~7V，建议为5V。</p><p>VS：小于或等于46V，供给电机，和L298内部输出端的工作电源，根据电机的额定电压来接。</p><p><br></p><p>如果步进电机为5VDC供电，那么VSS和VS可以短接到一起；</p><p>VSS和VS两个电源要共地；</p><p>L298N使用的过程中，发热较大，最好添加散热片。</p></blockquote><p><br></p><p>如果想自己设计电路实现电机的驱动，可以参考如下电路。</p><h1 class=pgc-h-arrow-right>L298N原理图</h1><div class=pgc-img><img alt=让步进电机动起来——L298N驱动步进电机 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/66fa2daf9e9d4aceb468d891a6866b2f><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>应用实例</h1><h1 class=pgc-h-arrow-right>驱动步进电机</h1><p>驱动四线两相电机，四个状态为1、AB正电压；2、A-B正电压；3、A-B-正电压；4、AB-正电压。</p><p><br></p><p>程序中使能ENA和ENB之后，令StepMotor_OUT1~StepMotor_OUT4按四个状态变化，时序控制如下图所示，即可控制步进电机的方向：</p><div class=pgc-img><img alt=让步进电机动起来——L298N驱动步进电机 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/552af627c4fb4c218cea50fc44654802><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>实现代码</h1><h1 class=pgc-h-arrow-right>1. 驱动步进电机的引脚初始化</h1><pre><code>void StepMotor_Init(void){         GPIO_InitTypeDef  GPIO_InitStructure;           RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB|RCC_APB2Periph_GPIOC, ENABLE);       //使能PB,PC端口时钟                GPIO_InitStructure.GPIO_Pin = GPIO_Pin_6|GPIO_Pin_7;        GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;        GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;               GPIO_Init(GPIOC, &amp;GPIO_InitStructure);              GPIO_SetBits(GPIOC,GPIO_Pin_6);         GPIO_SetBits(GPIOC,GPIO_Pin_7);                GPIO_InitStructure.GPIO_Pin = GPIO_Pin_12|GPIO_Pin_13|GPIO_Pin_14|GPIO_Pin_15;          GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;         GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;        GPIO_Init(GPIOB, &amp;GPIO_InitStructure);              L298D_1AA = 0;        L298D_2AA = 0;        L298D_3AA = 0;        L298D_4AA = 0;        L298D_12ENA = 0;        L298D_34ENA = 0;}</code></pre><h1 class=pgc-h-arrow-right>2. 两相电机驱动代码，包括正转和反转</h1><pre><code>void TwoPhaseMotor(unsigned char nInputData ,unsigned char nDirection){        if(1 == nDirection)             //逆时针        {                switch(nInputData)                {                        case 1:                        {                                L298D_1AA = 0;                                L298D_2AA = 1;                                L298D_3AA = 0;                                L298D_4AA = 1;                        }                        break;                        case 2:                        {                                L298D_1AA = 0;                                L298D_2AA = 1;                                L298D_3AA = 1;                                L298D_4AA = 0;                        }                        break;                        case 3:                        {                                L298D_1AA = 1;                                L298D_2AA = 0;                                L298D_3AA = 1;                                L298D_4AA = 0;                        }                        break;                        case 4:                        {                                L298D_1AA = 1;                                L298D_2AA = 0;                                L298D_3AA = 0;                                L298D_4AA = 1;                        }                        break;                }        }        else if(0 == nDirection)        //顺时针        {                switch(nInputData)                {                        case 1:                        {                                L298D_1AA = 1;                                L298D_2AA = 0;                                L298D_3AA = 0;                                L298D_4AA = 1;                        }                        break;                        case 2:                        {                                L298D_1AA = 1;                                L298D_2AA = 0;                                L298D_3AA = 1;                                L298D_4AA = 0;                        }                        break;                        case 3:                        {                                L298D_1AA = 0;                                L298D_2AA = 1;                                L298D_3AA = 1;                                L298D_4AA = 0;                        }                        break;                        case 4:                        {                                L298D_1AA = 0;                                L298D_2AA = 1;                                L298D_3AA = 0;                                L298D_4AA = 1;                        }                        break;                }        }}</code></pre><p>上面函数调用一次，步进电机走一步，对上面函数进行封装，既得到走任意步，可控制方向的函数：</p><pre><code>void TwoPhaseMotorNCircle(int n,unsigned char direction){    int i,j;            L298D_12ENA = 1;    //只有转的时候使能，否则持续供电，芯片和电机过热。    L298D_34ENA = 1;        for(i=0;i&lt;n;i++)    {        for(j=1;j&lt;=4;j++)        {            TwoPhaseMotor(j,direction);            delay_ms(2);        }    }            L298D_12ENA = 0;    L298D_34ENA = 0;}</code></pre><h1 class=pgc-h-arrow-right>3. 主函数中调用</h1><h1 class=pgc-h-arrow-right>说明</h1><ul><li>硬件实现中串口2与ESP8266模块相连，使用cJSON解析收到的阿里云物联网的数据包；</li><li>收到的{"PowerSwitch":1)，电机转动，{"PowerSwitch":0}，电机停止；</li><li>收到电机转动指令之后，此程序让步进电机左转N圈之后，再右转N圈，如此反复，所以为了不影响程序对其他指令的响应，所以将控制步进电机转动的步进代码放到了定时器中执行，主程序中，只控制ENA和ENB的使能开关</li></ul><blockquote><p>JSON字符串解析参考之前的网文：<a class=pgc-link data-content=mp href="https://www.toutiao.com/i6822619857079501320/?group_id=6822619857079501320" rel="noopener noreferrer" target=_blank>Keil环境下STM32工程加入cJSON</a></p></blockquote><h1 class=pgc-h-arrow-right>主函数代码如下：</h1><pre><code>int main(void) {        //解析payload数据包使用                 cJSON *receive_json, *item_obj;                 u16 i;        u16 uart2Len=0;                 u8 dtbuf[50];   //打印缓存器                         NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);         USART2_RX_STA=0;          memset(USART2_RX_BUF, 0, sizeof(USART2_RX_BUF));                 memset(dtbuf,'\0',50);        //初始化        //延时函数初始化                delay_init();                          uart_init(115200);                      //串口1:Debug,初始化为115200        uart2_init(115200);                //定时器3,--步进电机使用        TIM3_Int_Init(99,7199);         //1ms中断        TIM3_Set(0);        StepMotor_Init();                printf("System Init OK \r\n");                          //主循环           while(1)         {                               //ESP8266                if(USART2_RX_STA&amp;0x8000)                {                         uart2Len=USART2_RX_STA&amp;0x3f;                                                         receive_json = cJSON_Parse(USART2_RX_BUF);      //创建JSON解析对象，返回JSON格式是否正确                        if (!receive_json)                        {                                printf("JSON格式错误:%s\r\n", cJSON_GetErrorPtr()); //输出json格式错误信息                        }                        else                        {                                printf("JSON格式正确:\n%s\r\n",cJSON_Print(receive_json) );                                item_obj = receive_json-&gt;child; //获取name键对应的值的信息                                                                while(item_obj)                                {                                        char * string = item_obj-&gt;string;                                                                                if(!strcmp(string,"PowerSwitch"))                                        {                                                if(item_obj-&gt;valueint==1)                                                {                                                        L298D_12ENA = 1;        //只有转的时候使能，否则持续供电，芯片和电机过热。                                                        L298D_34ENA = 1;                                                                                                                TIM3_Set(1);                                                                                                                nRotationCounting = 0;                                                                                                                stuAliOSIoT.PowerSwitch = 1;                                                                                                                printf("PowerSwitch:1\r\n");                                                 }                                                else if(item_obj-&gt;valueint==0)                                                {                                                        //步进电机运动停止                                                        L298D_12ENA = 0;                                                        L298D_34ENA = 0;                                                                                                                TIM3_Set(0);                                                                                                                stuAliOSIoT.PowerSwitch = 0;                                                                                                                printf("PowerSwitch:0\r\n");                                                 }                                        }                                                                                                                       item_obj = item_obj-&gt;next;                                }                                                                cJSON_Delete(receive_json);                                                                     }                                                                       USART2_RX_STA=0;                           memset(USART2_RX_BUF, 0, sizeof(USART2_RX_BUF));   //清空数组                  }                                                               delay_ms(10);         }        }</code></pre><h1 class=pgc-h-arrow-right>定时器中代码如下：</h1><pre><code>//定时器3中断服务程序                void TIM3_IRQHandler(void){               if (TIM_GetITStatus(TIM3, TIM_IT_Update) != RESET)//是更新中断        {                                                  TIM_ClearITPendingBit(TIM3, TIM_IT_Update  );  //清除TIM3更新中断标志                                    nRotationCounting++;                if(nRotationCounting &gt; nSingleCycleDataPoints)                {                        if(nRotationDirection==0)                        {                                nRotationDirection=1;                        }                        else if(nRotationDirection==1)                        {                                nRotationDirection=0;                        }                                                nRotationCounting=0;                }                                if(stuAliOSIoT.PowerSwitch)                {                        if(nRotationDirection==0)                       //正转                        {                                TwoPhaseMotor(nRotationCounting%4+1,0);                         //顺时针                        }                        else if(nRotationDirection==1)          //反转                        {                                TwoPhaseMotor(nRotationCounting%4+1,1);                         }                }                                //TIM_Cmd(TIM3, DISABLE);  //关闭TIM3         }           }</code></pre><h1 class=pgc-h-arrow-right>实物图</h1><p>电源座用于提供外部VS供电；</p><div class=pgc-img><img alt=让步进电机动起来——L298N驱动步进电机 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e7b687eeae764fdf8551f4cc9227a360><p class=pgc-img-caption></p></div><p><br></p><p>喜欢请关注微信公众号：<strong>程序员小哈</strong></p><div class=pgc-img><img alt=让步进电机动起来——L298N驱动步进电机 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/06aa6af2684a4d1d9721724c8957f3f4><p class=pgc-img-caption></p></div><p>有啥想玩的模块，留言给我，咱们一起玩</p><p>若觉得本次分享的文章对您有帮助，随手收藏并转发分享，也是对我的支持。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'步进','电机动','起来'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>