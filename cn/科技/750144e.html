<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>LTE下VOLTE和CSFB介绍 | 极客快訊</title><meta property="og:title" content="LTE下VOLTE和CSFB介绍 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/dfic-imagehandler/d3c9bf0e-b532-407d-ba4e-3c0ee25d8af2"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/750144e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/750144e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/750144e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/750144e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/750144e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/750144e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/750144e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/750144e.html><meta property="article:published_time" content="2020-10-29T21:04:19+08:00"><meta property="article:modified_time" content="2020-10-29T21:04:19+08:00"><meta name=Keywords content><meta name=description content="LTE下VOLTE和CSFB介绍"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/750144e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>LTE下VOLTE和CSFB介绍</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>LTE下有两种通话方式：</p><p>1.VoLTE(Voice over Long-Term Evolution)即在LTE下通过数据域进行通话；</p><p>2.CSFB（circuit Switched Fallback）即从LTE回落到3G或者2G下进行通话，默认联通是回落到3G下通话，移动是回落到2G下通话</p><p>下面分别介绍这两种方式下的通话机制：</p><p><strong>volte流程介绍：</strong></p><p>VOLTE是基于SIP协议的语音通话，所有与IMS交互的信令全部为SIP信令，在理解VOLTE信令方面必须对SIP信令进行了解，EPC只是做为业务承载体</p><p>SIP 提供了发现机制，如果用户要发起和另一个用户的会话，SIP 必须发现可到达目的用户的当前主机，注册将记录地址 URI 和一个或者多个联系地址相关联，这样才能进行呼叫等业务。</p><p>严格意义上说，SUBSCRIBE和NOTIFY过程不属于注册过程，但由于该过程在注册完成后紧跟着出现，所以本文将该过程放在注册流程中进行说明。用户的注销过程与注册过程相似。用户的注销过程与注册过程相似，主要就是注销请求中,expire值为0，所以本文中不再进行单独说明，注销过程无SUBSCRIBE信令，是因为UE注册时已有SUBSCRIBE。</p><p><strong>注册流程介绍：</strong></p><div class=pgc-img><img alt=LTE下VOLTE和CSFB介绍 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/d3c9bf0e-b532-407d-ba4e-3c0ee25d8af2><p class=pgc-img-caption>IMS注册过程</p></div><p>信令说明如下： </p><p>1. UE进行Attach，建立QCI=9的默认承载，并使用IMS APN建立PDN连接； </p><p>2. 建立立QCI=5的默认承载，用于传送SIP信令；</p><p>3. UE通过QCI=5的默认承载向IMS发起注册请求； </p><p>4. P-CSCF通过HSS获知用户信息不在数据库中，便向终端代理回送401</p><p>Unauthorized 质询信息，其中包含安全认证所需的令牌； </p><p>5. 终端将用户标识和密码根据安全认证令牌加密后，再次用REGISTER消息报Unauthorized 质询信息，其中包含安全认证所需的令牌； </p><p>6. P-CSCF将REGISTER 消息中的用户信息解密，验证其合法后，IMS核心网将该用户信息登记到数据库中，并向终端返回成功响应消息200 OK；</p><p>7. 用户向IMS订阅注册事件包；</p><p>8. 服务器应答订阅成功；</p><p>9.IMS 服务器发送notify消息，由于订阅的用户已经注册，所有IMS服务器回应Notify消息中状态为active，同时携带XML信息</p><p>VoLTE 通话流程介绍，具体如下流程：</p><div class=pgc-img><img alt=LTE下VOLTE和CSFB介绍 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/710a4a57-8a0c-49df-8e6e-7f03b60ee326><p class=pgc-img-caption>续下面的图</p></div><div class=pgc-img><img alt=LTE下VOLTE和CSFB介绍 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/118b0d4c-687e-4305-9bf7-fa673bdbef18><p class=pgc-img-caption>整个VoLTE通话过程</p></div><p><strong>通话流程各个阶段介绍</strong></p><p>1、用户发起呼叫，CM 通知IMS ，IMS 创建并发送INVITE 消息</p><p>Reliable provisional responses (100 Rel)</p><p>SDP for audio codec support</p><p>2、当LTE栈接收到该消息时，它启动一个服务请求过程。 RRC层执行RACH过程以进入RRC连接状态并发送该消息。</p><p>3、LTE栈发送INVITE 消息</p><p>a、INVITE到达P-CSCF1。 它通过I-CSCF路由到服务UE的S-CSCF。 S-CSCF确定目的地可通 过IMS（不是CS /固定电话用户）到达并转发请求到相应的I-CSCF。 该消息最终被传递给服务UE2的PGW通过其P-CSCF（P-CSCF2）。</p><p>b、UE2在E-UTRAN上寻呼，并执行RACH过程以响应LTE寻呼</p><p>c、INVITE消息被发送到UE2并被路由到IMS客户端2。</p><p>4、P-CSCF1向IMS客户端1发送100：Trying，以指示INVITE已被转发到目的地。</p><p>5、IMS client2 响应180 Ringing</p><p>180（Ringing）消息在SDP中仅包含一个编解码器选择</p><p>180（Ringing）消息通过INVITE消息之后的反向路径到达IMS客户端1。</p><p>6、当P-CSCF1和P-CSCF2收到180（振铃）消息时，它们触发专用承载的网络启动推送。 P-CSCF通过与PCRF建立Diameter会话触发网络发起的专用EPS承载创建。 这是通过发送一个包含以下内容的AARequest完成的：</p><p>由IMS PDN分配给UE的IP地址</p><p>媒体组件描述，它在180（Ringing）消息中指定来自SDP的编解码器和业务流模板（TFT）</p><p>7、响应于步骤6中的AA-Requsest消息，PCRF使用从P-CSCF获得的IP地址来识别IP连通性接入网络（IP-CAN）会话。 它使用在IP-CAN会话建立期间从HSS /用户简档库（SPR）下载的QoS策略信息和从P-CSCF接收的媒体描述来确定用于承载语音业务的专用EPS承载的QoS和过滤器信息。 它通过发送带有QoS信息和FlowDescription字段的（直径）RAR命令来执行IP-CAN会话修改</p><p>QoS-Information specifies QCI, ARP, GBR/MBR parameters.</p><p>For GPRS Tunneling Protocol (GTP), this command reaches PGW.</p><p>8、在GTP的情况下，PGW通过基于接收到的RAR命令的Flow-Description字段安装分组过滤器来创建S5 EPS承载。 它向SGW发送创建承载请求。 该消息包含EPS承载QoS，S5 / S8-Tunnel-ID，TFT和LBI（专用承载链接到的默认承载的EPS承载ID）。</p><p>9、SGW向MME发送包含EPS承载QoS，S1-Tunnel-ID，TFT和LBI的创建承载请求。</p><p>10、MME为专用承载选择EPS bearer ID。 它创建NAS消息激活专用EPS承载上下文请求消息，并在称为承载建立请求的MME消息中将其发送到eNB。 重要的领域是：</p><p>承载建立请求，其中包含EPS承载ID，EPS QoS，S1-Tunnel-ID和NAS消息</p><p>激活专用EPS承载上下文请求消息，指定EPS承载ID，TFT，QoS参数和LBI的NAS消息。</p><p>11、eNB将EPS承载QoS映射到无线承载QoS。 它发送RRC连接重配置消息，该消息包含链接到EPS承载ID的数据无线承载（DRB），该承载ID能够在无线电级别保证QoS。 RRC连接重配置也包含来自MME的NAS消息。</p><p>12、当UE使用RRCConnection重配置完成确认无线承载激活时，eNB向MME发送承载建立响应，指示可以分配EPS承载QoS。 该消息包含EPS承载ID和S1-Tunnel-ID。</p><p>如果eNB没有资源，它会回应失败。</p><p>13、UE中的NAS层以UL信息传输消息中的NAS消息激活专用EPS承载上下文接受进行响应。 而且，当网络发起的专用承载被创建时，LTE栈：</p><p>使用NAS消息/ RRC消息的内容来创建到无线承载的业务流之间的映射。</p><p>预计安装的UL TFT在SDP应答中具有目的地IP地址/端口，并且在SDP报价中具有广告的源IP /端口的DL TFT。</p><p>14、eNB在UL NAS传输中将NAS消息转发给MME。</p><p>15、The MME sends a Create Bearer Response message to the SGW</p><p>16、The SGW sends a Create Bearer Response message to the PGW.</p><p>17、The PGW sends an RAR response message to the PCRF</p><p>18、收到RAR响应消息后，PCRF向P-CSCF发送AA-Answer命令，指示专用承载建立成功。</p><p>19、UE1中的IMS客户端发送PRACK SIP消息。 该PRACK消息通过与步骤3中相同的一组节点到达UE2上的IMS客户端。</p><p>20、UE2中的IMS客户端在接收PRACK时以200（OK）响应。 此响应确认PRACK并接受SDP-Offer。</p><p>UE2中的IMS客户端在接收到确认180（振铃）的PRACK之后提醒用户。</p><p>21、当目标用户应答呼叫时，IMS客户端2向源IMS客户端1发送200（OK）消息。 该消息用作初始INVITE消息的200（OK）。</p><p>22、IMS客户端1用ACK确认200（OK），媒体流已准备好建立</p><p><strong>CSFB流程介绍</strong></p><p><strong>主叫CSFB流程说明</strong></p><p>1） UE发起CS Fallback语音业务请求。UE语音拨打时，会发一条extended service request，消息里会携带CSFB信息。其中service-type信元指示业务类型为始发CSFB语音业务，同时携带该UE在联合附着过程中CS域给它分配的TMSI。之后会在基站的辅助下回落至2G。</p><p>2） MME发送Initial Context Setup Request消息给eNodeB，包含CS Fallback Indicator。该消息指示eNodeB，UE因CS Fallback业务需要回落到UTRAN/GERAN。</p><p>3） eNodeB要求UE开始系统的小区测量，并获得UE上报的测量报告，确定重定向的目标系统小区。然后向UE发送目标系统具体的无线配置信息，并释放连接。LTE网络通过RIM流程（无线消息管理流程）提前获取2G目标小区广播信息，将2G网络的广播信息一并填充至RRC Release消息中下发，省去终端读取2G广播信息的时间（约省1.83秒）</p><p>4） UE接入目标系统小区，发起CS域的业务请求CM Service Request。如果CM业务请求消息中携带“CSMO”标志，则MSC Server记录本次呼叫是移动始端CSFB呼叫。</p><p>5） 如果目标系统小区归属的MSC Server与UE附着EPS网络时登记的MSC Server不同，则该MSC Server收到UE的业务请求时，由于没有该UE的信息，可以采取隐式位置更新流程，接受用户请求。如果MSC Server不支持隐式位置更新，且MSC Server没有用户数据，则拒绝该用户的业务请求。如果MSC Server拒绝用户的业务请求会导致UE发起一个CS域位置更新流程。终端发起位置更新请求，且位置更新请求消息中的Additional update parameters信元中携带CSMO标识，同时该标识有效，则MSC Server会记录本次呼叫是CSFB呼叫。（CS fallback紧急呼叫流程中，CM_SERVICE_REQUEST消息前无需位置更新。）</p><p>6）完成位置更新后UE再次在 CS域建立语音呼叫流程。</p><p>7） 通话结束后，MSC Server向主叫回落到的BSC发送的拆线消息CLEAR_COMMAND消息中携带CSFB Indication信元，指示BSC拆除空口连接并指示UE回到LTE网络。 或者MSC Server向主叫回落到的RNC发送IU_RELEASE_COMMAND消息，携带End Of CSFB信元，指示RNC拆除空口连接并指示UE回到LTE网络。</p><p>8） MSC收到BSC的CLEAR_COMPLETE消息/RNC的IU_RELEASE_COMPLETE消息表示呼叫结束，A口拆链完成。接入侧在指示终端重选网络时只针对CSFB用户通话前携带LTE频点，实现CSFB终端快速返回LTE，快速回落过程也称为FastReturn（用户不可及时间可缩短为1-2秒。）。</p><p><strong>2.6.2 CSFB被叫流程</strong></p><p>MSC Server收到对UE的被叫语音请求，通过存在的SGs关联和MME信息，向该MME发起寻呼请求。MME通过eNodeB在空口寻呼该UE，并指示UE回落到目标GERAN/UTRAN网络。UE接入到目标网络后，在电路域继续进行语音呼叫。</p><p><strong>被叫CSFB流程说明</strong></p><p>1） GMSC Server向被叫用户归属HLR发送取路由信息请求。</p><p>2） HLR收到该SRI消息后，向被叫用户当前附着到的old MSC Server获取漫游号码。</p><p>3） old MSC Server为该次呼叫分配漫游号码MSRN1，并返回给HLR。</p><p>4） HLR将该漫游号码发送给GMSC。</p><p>5） GMSC收到该漫游号码后，进行号码分析，根据分析结果将呼叫路由到old MSC Server。</p><p>6） MSC Server收到IAM入局（例如中继ISUP入局）消息后，根据存在的SGs关联和MME信息，发送SGsAP-PAGING-REQUEST(携带IMSI，TMSI，Service indicator ，CLI，LAC)消息给MME。</p><p>7） MME发送Paging消息给eNodeB。eNodeB发起空口的Paging流程。</p><p>8） UE建立连接并发送Extended Service Request消息给MME（消息中携带“CSMT”移动终端标识）。</p><p>9） MME发送SGsAP-SERVICE-REQUEST消息给MSC Server。MSC Server收到此消息，不再向MME重发寻呼请求消息。为避免呼叫接续过程中，主叫等待时间过长，MSC Server收到包含空闲态指</p><p>示的SGs Service Request消息，先通知主叫，呼叫正在接续过程中。</p><p>10） MME发送Initial UE Context Setup消息给eNodeB，包含CS Fallback Indicator。该消息指示eNodeB，UE因CSFB业务需要回落到UTRAN/GERAN。</p><p>11） UE回落到CS域之后，UE检测到当前的位置区信息和存储的位置区不同，将发起位置更新。MSC Server收到UE发送的LOCATION_UPDATE_REQUEST消息。这种情况下，UE不需要回Paging Response给MSC Server，UE直接发送SETUP消息建立呼叫。如果位置更新消息中携带“CSMT”标志，则MSC Server记录本次呼叫是CSFB呼叫。</p><p>12） 伴随着空口、A/Iu-CS接口连接的建立，UE回Paging Response消息给MSC Server，该消息中携带CSMT标识，即使BSC/RNC没有向该UE发起过寻呼请求，也需要能处理UE的寻呼响应。如果寻呼响应消息中的位置区信息和VLR中保存的不一致，则VLR在业务接入成功之后将SGs关联置为非关联。</p><p>13） 建立CS呼叫。</p><p>14）通话结束后，指示BSC/RNC拆除空口连接并指示UE回到LTE网络。</p><p>15） MSC收到BSC的CLEAR_COMPLETE消息/RNC的IU_RELEASE_COMPLETE消息表示呼叫结束。接入侧在指示终端重选网络时只针对CSFB用户携带LTE频点，实现CSFB终端快速返回E-UTRAN。FastReturn方案也需要网络的支持，如果网络不支持，则通过网络优先级的方式返回LTE（一般为最高优先级）</p><p><strong>如下log流程</strong>：</p><div class=pgc-img><img alt=LTE下VOLTE和CSFB介绍 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/dfic-imagehandler/c2d74978-9ae9-4296-bbfe-99da910e5921><p class=pgc-img-caption>CSFB流程</p></div><p><strong>VoLTE和CSFB的</strong><strong>有缺点</strong>：</p><p>csfb需要2g3g网络和4g网络重叠覆盖，这样驻留4g的手机在拨语音呼叫zhidao时候可以回滚到2g3g<br>大多数手机都支持csfb，lte网络初始阶段都要csfb方式支持语音，但是呼叫时延长<br>volte是在lte网络覆盖达到绝大部分区域时候部回署，优点是使用4g一张单独的网络就支持语音和数据业务，不需要2g3g网络的帮助，呼叫时延短。但是需要手机端支持。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'LTE','VOLTE','CSFB'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>