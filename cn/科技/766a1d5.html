<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>基于MicroPython的自动网络时间校准器 | 极客快訊</title><meta property="og:title" content="基于MicroPython的自动网络时间校准器 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/17a69278b11e472491122610781af459"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/766a1d5.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/766a1d5.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/766a1d5.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/766a1d5.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/766a1d5.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/766a1d5.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/766a1d5.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/766a1d5.html><meta property="article:published_time" content="2020-10-29T20:54:13+08:00"><meta property="article:modified_time" content="2020-10-29T20:54:13+08:00"><meta name=Keywords content><meta name=description content="基于MicroPython的自动网络时间校准器"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/766a1d5.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>基于MicroPython的自动网络时间校准器</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><div class=pgc-img><img alt=基于MicroPython的自动网络时间校准器 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/17a69278b11e472491122610781af459><p class=pgc-img-caption></p></div><p><strong>前言</strong></p><p>之前使用TPYBoard v202（主控ESP8266模块）开发板做过一款WIFI攻击神器，一开始使用Arduino源码做的，后来又接触到micropython。觉得使用micropython真是方便，而且ESP8266模块上面有很多可以挖掘出来的好玩的。后期用它又做过<span>智能家庭</span>控制平台，说白了就是用v202开发板作为Web服务器。最近，接触到了DS3231时钟模块，结合OLED显示屏，做了一个简单的时钟。为了防止时间偏差，从网上找了一个免费的获取时间的API，程序很简单，分享出来，有需要的小伙伴可以直接用。</p><div class=pgc-img><img alt=基于MicroPython的自动网络时间校准器 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/9b1a7cc0-1d78-4e62-9d12-cf0a65fe0c5e><p class=pgc-img-caption></p></div><p>WIFI攻击神器-Arduino篇：</p><p><strong><em>邪恶改装：TPYBoard制作廉价WIFI干扰器</em></strong></p><p><strong><em>邪恶改装2：用单片机实现一次简单的WIFI密码欺骗</em></strong></p><p>WIFI攻击神器-micropython篇： <strong><em>MicroPython实现WIFI干扰与抓包</em></strong></p><p>智能家庭控制平台： <strong><em>利用单片机快速实现家庭智能控制平台</em></strong></p><p><strong>材料准备</strong></p><p><strong>名称数量</strong>TPYBoard v202开发板1块DS3231时钟模块1个OLED显示屏1个面包板1个杜邦线若干</p><p>准备好材料，接下来就是接线。</p><p><strong>TPYBoard v202DS3231时钟模块</strong>3V3VCCGNDGNDSDASDASCLSCL<strong>TPYBoard v202OLED显示屏</strong>GNDGND3V33V3MISCKMOSDAG16RESG15DCG5CS</p><p><strong>程序编写</strong></p><p>先说下程序的思路：</p><p>1、开机上连接家中的WIFI网络，确保可以访问网络；</p><p>2、然后访问API获取到时间，更新DS3231的设置，并进行显示屏显示；</p><p>3、开启定时器，每隔1秒钟刷新下显示屏时间信息；</p><p>4、设定每天获取一次API更新下时间，用于时间的校正。</p><p>首先，编辑一个boot.py文件，里面主要是连接WIFI的程序。然后编辑一个main.py，里面主要是访问API、操作DS3231、显示屏等主要功能程序。v202开机会先运行boot.py再运行main.py文件。</p><p><strong>boot.py</strong></p><pre>import networkimport timefrom machine import PinLED = Pin(2,Pin.OUT)#根据设定连接网络count = 0wlan = network.WLAN(network.STA_IF)wlan.active(True)if not wlan.isconnected(): print('connecting to TurnipSmart...') wlan.connect('WIFI名称','WIFI密码') while not wlan.isconnected() and count &lt; 20: LED.value(not LED.value()) count += 1 time.sleep(0.5)if wlan.isconnected():  LED.value(0) print('ip address:',wlan.ifconfig()[0])else: LED.value(1) print('TurnipSmart connect fail')</pre><p><strong>main.py</strong></p><pre>import urequestsimport jsonimport timefrom machine import SPI,Pin #导入SPI、Pin库import ssd1306 #导入OLED显示屏驱动库from ds3231 import DS3231 #导入DS3231时钟模块库from machine import Timer #导入Timer库#-----------------------DS3231模块-----------------------#ds=DS3231() #ds3231初始化NOW_DATE = ''#-----------------------OLED显示屏-----------------------##SPI接口对应的引脚定义spi = SPI(baudrate=10000000, polarity=1, phase=0, sck=Pin(12,Pin.OUT), mosi=Pin(13,Pin.OUT), miso=Pin(2))#OLED显示屏的设置，128宽 64高 spi对象 DC接的G15 RES接的G16 CS接的G5display = ssd1306.SSD1306_SPI(128, 64, spi, Pin(15),Pin(16), Pin(5))display.poweron() #打开显示屏display.init_display() #初始化显示display.text('Waiting.....',1,1) #显示的内容，x座标，y座标display.show() #进行显示def getNetTime(): url = 'http://quan.suning.com/getSysTime.do' res=urequests.get(url).text print(res) j=json.loads(res) t2_date = j['sysTime2'].split()[0] #日期 t2_time = j['sysTime2'].split()[1] #时间 display.fill(0) #清屏 display.text(t2_date,1,2) display.text(t2_time,1,15) display.show() #初始日期和时间，设置一次即可 ds.DATE([int(x) for x in t2_date[2:].split('-')]) #设置初始日期年、月、日 ds.TIME([int(x) for x in t2_time.split(':')]) #设置初始时间时、分、秒def updateTime(t): global NOW_DATE #读取日期和时间，拼接成正常的时间格式 date = '20'+'-'.join(ds.DATE()) time = ':'.join(ds.TIME()) if NOW_DATE != date: getNetTime() #设定每天校对一下时间 NOW_DATE = date else: display.fill(0) #清屏 display.text(date,1,2) display.text(time,1,15) display.show()if __name__ == '__main__': getNetTime() time.sleep(1) #-----------------------Timer定时器-----------------------# tim = Timer(-1) #新建一个定时器 #每隔1秒执行一次updateTime函数调用，用于更新OLED显示屏上的时间 tim.init(period=1000, mode=Timer.PERIODIC, callback=updateTime)</pre><p>里面还需要用到DS3231时钟模块库，已经写好了，直接拿来用就可以。记得也要下载到板子里，否则会提示找不到。文章末会有下载。</p><p><strong>程序下载与调试</strong></p><p>v202通过micro USB数据线接入PC，即可进行程序下载和REPL操作。插入PC之前，先确保一下器件的电源线没有接错，防止出现器件或开发板烧坏的情况。</p><p>1、插上PC之后，设备管理器会出现一个虚拟串口，开发板上用的是CH340芯片（USB转TTL串口），电脑没驱动的话，需要手动安装。</p><p><strong><em>CH34X驱动下载</em></strong></p><p>2、使用 MicroPython File Uploader 工具进行程序的下载，在这里就不介绍具体下载的步骤，大家可去参考现有教程。 <strong><em>TPYBoard v202 快速入手教程</em></strong> boot.py 、main.py 和 ds3231.py 都需要下载到v202板子里。下载完毕后，点击【RUN】或者按板子的RST键都可以运行程序。</p><p>没找到上传附件的功能，把代码放到了GitHub上了。 <strong><em>GitHub地址</em></strong></p><p><strong>效果演示</strong></p><div class=pgc-img><img alt=基于MicroPython的自动网络时间校准器 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/192109423d394c188b1ba1049f9020fb><p class=pgc-img-caption></p></div><blockquote><p>“我自己是一名从事了多年开发的Python老程序员，辞职目前在做自己的Python私人定制课程，今年年初我花了一个月整理了一份最适合2019年学习的Python学习干货，从最基础的到各种框架都有整理，送给每一位喜欢Python小伙伴，想要获取的可以转发文章并关注我的头条。在后台私信我：01，即可免费获取。"</p></blockquote><div class=pgc-img><img alt=基于MicroPython的自动网络时间校准器 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/20a3661d34c849d28485bac09a5a7a96><p class=pgc-img-caption></p></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'MicroPython','自动','网络'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>