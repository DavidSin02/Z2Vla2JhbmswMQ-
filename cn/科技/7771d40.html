<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>5分钟！用Java实现目标检测 | PyTorch | 极客快訊</title><meta property="og:title" content="5分钟！用Java实现目标检测 | PyTorch - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/bcf4256f45fe4ac29cbc234e7f84961c"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7771d40.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7771d40.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7771d40.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7771d40.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7771d40.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7771d40.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7771d40.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7771d40.html><meta property="article:published_time" content="2020-10-29T21:04:31+08:00"><meta property="article:modified_time" content="2020-10-29T21:04:31+08:00"><meta name=Keywords content><meta name=description content="5分钟！用Java实现目标检测 | PyTorch"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/7771d40.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>5分钟！用Java实现目标检测 | PyTorch</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><blockquote class=pgc-blockquote-abstract><p>鱼羊 编辑整理<br>量子位 报道 | 公众号 QbitAI</p></blockquote><p>编者按：作为一个Java开发者，你是否曾为在PyTorch上部署模型而苦恼？这篇来自AWS软件工程师的投稿，结合实例，详细介绍了DJL这个为Java开发者设计的深度学习库：5分钟，你就能在PyTorch上，用Java实现目标检测。</p><h1 class=pgc-h-arrow-right><strong>5分钟，用Java实现目标检测</strong></h1><p>文 / 知乎用户@Lanking</p><div class=pgc-img><img alt="5分钟！用Java实现目标检测 | PyTorch" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bcf4256f45fe4ac29cbc234e7f84961c><p class=pgc-img-caption></p></div><p>PyTorch在深度学习领域中的应用日趋广泛，得益于它独到的设计。无论是数据的并行处理还是动态计算图，一切都为Python做出了很多简化。很多论文都选择使用PyTorch去实现也证明了它在训练方面的效率以及易用性。</p><p>在PyTorch领域，尽管部署一个模型有很多选择，可为Java开发人员准备的选项却屈指可数。</p><p>在过去，用户可以用PyTorch C++ 写JNI (Java Native Interface) 来实现这个过程。最近，PyTorch 1.4 也发布了试验性的Java 前端。</p><p>可是这两种解决方案都没有办法能让Java开发者很好的使用：用户需要从易于使用和易于维护中二选一。</p><p>针对于这个问题，亚马逊云服务 (AWS)开源了 Deep Java Library (DJL)，一个为Java开发者设计的深度学习库。它兼顾了易用性和可维护性，一切运行效率以及内存管理问题都得到了很好的处理。</p><p>DJL使用起来异常简单。只需几行代码，用户就可以轻松部署深度学习模型用作推理。那么我们就开始上手用DJL部署一个PyTorch 模型吧。</p><h1 class=pgc-h-arrow-right><strong>前期准备</strong></h1><p>用户可以轻松使用maven或者gradle等Java常用配置管理包来引用DJL。下面是一个示例：</p><pre><code>plugins {    id 'java'}repositories {                               jcenter()}dependencies {    implementation "ai.djl:api:0.4.0"    implementation "ai.djl:repository:0.4.0"    runtimeOnly "ai.djl.pytorch:pytorch-model-zoo:0.4.0"    runtimeOnly "ai.djl.pytorch:pytorch-native-auto:1.4.0"}</code></pre><p>然后只需gradle build，基本配置就大功告成了。</p><h1 class=pgc-h-arrow-right><strong>开始部署模型</strong></h1><p>我们用到的目标检测模型来源于NVIDIA在torchhub发布的预训练模型。我们用下面这张图来推理几个可以识别的物体（狗，自行车以及皮卡）。</p><div class=pgc-img><img alt="5分钟！用Java实现目标检测 | PyTorch" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c19cb712daf84647a5199748aa8de011><p class=pgc-img-caption></p></div><p>可以通过下面的代码来实现推理的过程：</p><pre><code>public static void main(String[] args) throws IOException, ModelException, TranslateException {    String url = "https://github.com/awslabs/djl/raw/master/examples/src/test/resources/dog_bike_car.jpg";    BufferedImage img = BufferedImageUtils.fromUrl(url);    Criteria&lt;BufferedImage, DetectedObjects&gt; criteria =            Criteria.builder()                    .optApplication(Application.CV.OBJECT_DETECTION)                    .setTypes(BufferedImage.class, DetectedObjects.class)                    .optFilter("backbone", "resnet50")                    .optProgress(new ProgressBar())                    .build();    try (ZooModel&lt;BufferedImage, DetectedObjects&gt; model = ModelZoo.loadModel(criteria)) {        try (Predictor&lt;BufferedImage, DetectedObjects&gt; predictor = model.newPredictor()) {            DetectedObjects detection = predictor.predict(img);            System.out.println(detection);        }    }}</code></pre><p>然后，就结束了。相比于其他解决方案动辄上百行的代码，DJL把所有过程简化到了不到30行完成。那么我们看看输出的结果:</p><pre><code>[    class: "dog", probability: 0.96709, bounds: [x=0.165, y=0.348, width=0.249, height=0.539]    class: "bicycle", probability: 0.66796, bounds: [x=0.152, y=0.244, width=0.574, height=0.562]    class: "truck", probability: 0.64912, bounds: [x=0.609, y=0.132, width=0.284, height=0.166]]</code></pre><p>你也可以用我们目标检测图形化API来看一下实际的检测效果：</p><div class=pgc-img><img alt="5分钟！用Java实现目标检测 | PyTorch" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/a70b5cf56afa43978d5c48e768dffef5><p class=pgc-img-caption></p></div><p>你也许会说，这些代码都包装的过于厉害，真正的小白该如何上手呢？</p><p>让我们仔细的看一下刚才的那段代码：</p><pre><code> // 读取一张图片    String url = "https://github.com/awslabs/djl/raw/master/examples/src/test/resources/dog_bike_car.jpg";    BufferedImage img = BufferedImageUtils.fromUrl(url);    // 创建一个模型的寻找标准    Criteria&lt;BufferedImage, DetectedObjects&gt; criteria =            Criteria.builder()                    // 设置应用类型：目标检测                    .optApplication(Application.CV.OBJECT_DETECTION)                    // 确定输入输出类型 （使用默认的图片处理工具）                    .setTypes(BufferedImage.class, DetectedObjects.class)                    // 模型的过滤条件                    .optFilter("backbone", "resnet50")                    .optProgress(new ProgressBar())                    .build();    // 创建一个模型对象    try (ZooModel&lt;BufferedImage, DetectedObjects&gt; model = ModelZoo.loadModel(criteria)) {        // 创建一个推理对象        try (Predictor&lt;BufferedImage, DetectedObjects&gt; predictor = model.newPredictor()) {            // 推理            DetectedObjects detection = predictor.predict(img);            System.out.println(detection);        }    }</code></pre><p>这样是不是清楚了很多？DJL建立了一个模型库(ModelZoo)的概念，引入了来自于GluonCV, TorchHub, Keras 预训练模型, huggingface自然语言处理模型等70多个模型。所有的模型都可以一键导入，用户只需要使用默认或者自己写的输入输出工具就可以实现轻松的推理。我们还在不断的添加各种预训练模型。</p><h1 class=pgc-h-arrow-right><strong>了解DJL</strong></h1><div class=pgc-img><img alt="5分钟！用Java实现目标检测 | PyTorch" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/dd0c4e1fb92d419ca5e3df4daa418075><p class=pgc-img-caption></p></div><p>DJL是亚马逊云服务在2019年re:Invent大会推出的专为Java开发者量身定制的深度学习框架，现已运行在亚马逊数以百万的推理任务中。</p><p>如果要总结DJL的主要特色，那么就是如下三点：</p><ul><li>DJL不设限制于后端引擎：用户可以轻松的使用 MXNet, PyTorch, TensorFlow和fastText来在Java上做模型训练和推理。</li><li>DJL的算子设计无限趋近于numpy：它的使用体验上和numpy基本是无缝的，切换引擎也不会造成结果改变。</li><li>DJL优秀的内存管理以及效率机制：DJL拥有自己的资源回收机制，100个小时连续推理也不会内存溢出。</li></ul><p>James Gosling (Java 创始人) 在使用后给出了赞誉:</p><div class=pgc-img><img alt="5分钟！用Java实现目标检测 | PyTorch" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c4163ef0a97842fb875cd85e93ac7583><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>对于PyTorch的支持</strong></h1><p>DJL现已支持PyTorch 1.5。我们深度整合了PyTorch C++ API，开发了一套JNI提供Java的底层支持。DJL提供各类PyTorch原生算子算法，现在支持所有的 TorchScript模型。</p><p>现在可以在 Mac/Linux/Windows全平台运行DJL PyTorch。DJL具有自检测CUDA版本的功能，也会自动采用对应的CUDA版本包来运行gpu任务。</p><p>想了解更多，请参见下面几个链接：https://djl.aihttps://github.com/awslabs/djl</p><p>也欢迎加入我们slack论坛：https://app.slack.com/client/TPX8YGQTW</p><p>— 完 —</p><p style=text-align:start>量子位 QbitAI · 头条号签约作者</p><p style=text-align:start>关注我们，第一时间获知前沿科技动态</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'分钟','Java','实现'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>