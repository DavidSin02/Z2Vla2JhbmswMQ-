<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>è¶…è¯¦ç»†sharding-jdbcåˆ†åº“åˆ†è¡¨å®ç°ï¼ŒåŠåŸç†åˆ†æ | æå®¢å¿«è¨Š</title><meta property="og:title" content="è¶…è¯¦ç»†sharding-jdbcåˆ†åº“åˆ†è¡¨å®ç°ï¼ŒåŠåŸç†åˆ†æ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/d0c843f1033e4e00b52839371049731b"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/77ec56f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/77ec56f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/77ec56f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/77ec56f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/77ec56f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/77ec56f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/77ec56f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/77ec56f.html><meta property="article:published_time" content="2020-10-29T21:06:50+08:00"><meta property="article:modified_time" content="2020-10-29T21:06:50+08:00"><meta name=Keywords content><meta name=description content="è¶…è¯¦ç»†sharding-jdbcåˆ†åº“åˆ†è¡¨å®ç°ï¼ŒåŠåŸç†åˆ†æ"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/77ec56f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>è¶…è¯¦ç»†sharding-jdbcåˆ†åº“åˆ†è¡¨å®ç°ï¼ŒåŠåŸç†åˆ†æ</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>èƒŒæ™¯</h1><p>ä¼ ç»Ÿåº”ç”¨é€šå¸¸å°†æ•°æ®é›†ä¸­å­˜å‚¨åœ¨å•ä¸€çš„æ•°æ®èŠ‚ç‚¹ä¸­ï¼Œå·²ç»è¶Šæ¥è¶Šä¸èƒ½æ»¡è¶³ç°ä»£äº’è”ç½‘çš„æµ·é‡æ•°æ®åœºæ™¯ã€‚éšç€ç”¨äºç”¨æˆ·çš„å¢é•¿ï¼Œå¯¹å¹¶å‘æ€§èƒ½è¦æ±‚è¶Šæ¥è¶Šé«˜ï¼Œç³»ç»Ÿåå°æœåŠ¡å¯ä»¥å¾ˆå®¹æ˜“çš„è¿›è¡Œæ‰©å®¹ï¼ˆè´Ÿè½½å‡è¡¡ç­‰ï¼‰ï¼Œè¿™æ ·æœ€ç»ˆçš„ç“¶é¢ˆå°±æ˜¯æ•°æ®åº“äº†ï¼Œå•ä¸€çš„æ•°æ®èŠ‚ç‚¹æˆ–è€…ç®€å•çš„ä¸»ä»ç»“æ„æ˜¯éš¾ä»¥æ‰¿å—çš„ã€‚â€ƒâ€ƒå°½ç®¡ç›®å‰å·²ç»æœ‰ nosql/newsql èƒ½å¤Ÿæ”¯æ’‘æµ·é‡çš„æ•°æ®ï¼Œä½†æ˜¯å…¶å¯¹ä¼ ç»Ÿ sql æ˜¯ä¸å…¼å®¹çš„ï¼Œè€Œä¸”ç”Ÿæ€åœˆé¡µä¸å¤ªå®Œå–„ï¼Œå…³ç³»å‹æ•°æ®åº“çš„åœ°ä½è¿˜æ˜¯æ— æ³•æ’¼åŠ¨çš„ã€‚â€ƒâ€ƒç”±æ­¤äº§ç”Ÿäº†æ•°æ®åˆ†ç‰‡çš„æ¦‚å¿µã€‚æŒ‰ç…§æŸä¸ªåˆ†ç‰‡ç»´åº¦å°†å­˜æ”¾åœ¨å•ä¸€æ•°æ®åº“ä¸­çš„æ•°æ®åˆ†æ•£åœ°å­˜æ”¾è‡³å¤šä¸ªæ•°æ®åº“æˆ–è¡¨ä¸­ä»¥æå‡æ€§èƒ½ã€‚æ•°æ®åˆ†ç‰‡çš„æ‹†åˆ†æ–¹å¼åˆ†ä¸ºï¼šå‚ç›´åˆ†ç‰‡å’Œæ°´å¹³åˆ†ç‰‡ä¸¤ç§ã€‚</p><h1 class=pgc-h-arrow-right>å‚ç›´åˆ†ç‰‡</h1><p>æŒ‰ç…§ä¸šåŠ¡é€»è¾‘æ‹†åˆ†çš„æ–¹å¼ç§°ä¸ºå‚ç›´åˆ†ç‰‡ï¼Œåˆç§°ä¸ºçºµå‘æ‹†åˆ†ã€‚æ ¸å¿ƒç†å¿µå°±æ˜¯ä¸“åº“ä¸“ç”¨ã€‚å°†ä¸€ä¸ªå¤§çš„æ•°æ®åº“æŒ‰ç…§ä¸šåŠ¡é€»è¾‘åˆ†ç±»ï¼Œæ‹†åˆ†ä¸ºå¤šä¸ªå°çš„æ•°æ®åº“ï¼Œæ¯ä¸ªä¸šåŠ¡é€»è¾‘ä½¿ç”¨å„è‡ªçš„æ•°æ®åº“ï¼Œä»è€Œå°†å‹åŠ›åˆ†æ•£åˆ°ä¸åŒçš„æ•°æ®åº“ä¸­ã€‚å‚ç›´åˆ†ç‰‡å¾€å¾€éœ€è¦å¯¹æ¶æ„å’Œè®¾è®¡è¿›è¡Œè°ƒæ•´ï¼Œç±»ä¼¼å¾®æœåŠ¡çš„æ¦‚å¿µã€‚ä½†æ˜¯å‚ç›´æ‹†åˆ†åªèƒ½å±äºä¸€ä¸ªæ²»æ ‡ä¸æ²»æœ¬çš„åŠæ³•ï¼Œéšç€ä¸šåŠ¡é‡è¿›ä¸€æ­¥åŠ å¤§ï¼Œè¶…è¿‡äº†å•ä¸ªè¡¨èƒ½æ‰¿å—çš„é˜ˆå€¼ï¼Œè¿˜æ˜¯ä¼šå‡ºç°æ€§èƒ½é—®é¢˜ã€‚ç„¶åå°±éœ€è¦æ°´å¹³åˆ†ç‰‡æ¥è¿›ä¸€æ­¥å¤„ç†äº†ã€‚</p><div class=pgc-img><img alt=è¶…è¯¦ç»†sharding-jdbcåˆ†åº“åˆ†è¡¨å®ç°ï¼ŒåŠåŸç†åˆ†æ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d0c843f1033e4e00b52839371049731b><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>æ°´å¹³åˆ†ç‰‡</h1><p>æ°´å¹³åˆ†ç‰‡åˆç§°æ¨ªå‘åˆ†ç‰‡ã€‚ç›¸å¯¹äºå‚ç›´åˆ†ç‰‡ï¼Œä¸æ ¹æ®ä¸šåŠ¡é€»è¾‘åˆ†ï¼Œè€Œæ˜¯é€šè¿‡æŸä¸ªï¼ˆå‡ ä¸ªï¼‰å­—æ®µï¼Œæ ¹æ®æŸç§è§„åˆ™å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªåº“æˆ–è¡¨ä¸­ï¼Œæ¯ä¸ªåˆ†ç‰‡ä»…åŒ…å«æ•°æ®çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚æ ¹æ®ç”¨æˆ·ä¸»é”®åˆ†ç‰‡ï¼Œå¯¹ 2 å–ä½™ä¸º 0 çš„æ”¾å…¥ 0 åº“ï¼ˆæˆ–è¡¨ï¼‰ï¼Œä¸º 1 çš„æ”¾å…¥ 1 åº“ï¼ˆæˆ–è¡¨ï¼‰ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class=pgc-img><img alt=è¶…è¯¦ç»†sharding-jdbcåˆ†åº“åˆ†è¡¨å®ç°ï¼ŒåŠåŸç†åˆ†æ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e02b335c6e71439f86c639b20645f5e2><p class=pgc-img-caption></p></div><p>ä»ç†è®ºä¸Šæ¥è¯´æ°´å¹³åˆ†ç‰‡æ˜¯å¯ä»¥æ— é™æ‹“å±•çš„ï¼Œå±äºåˆ†åº“åˆ†è¡¨çš„æ ‡å‡†è§£å†³åŠæ³•ã€‚ä½†æ˜¯æœ‰åˆ©å°±ä¼šæœ‰å¼Šï¼Œè™½ç„¶åˆ†ç‰‡è§£å†³äº†æ€§èƒ½é—®é¢˜ï¼Œä½†æ˜¯åˆ†å¸ƒå¼çš„æ¶æ„é¡µå¼•å…¥äº†æ–°çš„é—®é¢˜ã€‚é¦–å…ˆé¢å¯¹çš„å°±æ˜¯æ•°æ®åº“çš„è¿ç»´ç®¡ç†æ›´åŠ å¤æ‚ï¼Œä¹‹å‰åªæ˜¯å•åº“æœ‰é™çš„å‡ å¼ è¡¨ï¼Œç°åœ¨æ•°æ®è¢«åˆ†æ•£åˆ°äº†å¤šåº“å¤šè¡¨ä¸­ï¼Œéš¾ä»¥è¿ç»´ã€‚å…¶æ¬¡å°±æ˜¯å¾ˆå¤šä¹‹å‰èƒ½å¤Ÿæ­£å¸¸è¿è¡Œçš„ sql è¯­å¥ï¼Œåœ¨æ°´å¹³åˆ†ç‰‡åæ— æ³•æ­£å¸¸è¿è¡Œï¼Œæ¯”å¦‚åˆ†é¡µã€æ’åºã€èšåˆåˆ†ç»„ç­‰æ“ä½œã€‚â€ƒæœ€åå°±æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ã€‚è·¨åº“äº‹åŠ¡ç›®å‰ä»»ç„¶æ˜¯ä¸€ä¸ªè¾ƒä¸ºæ£˜æ‰‹çš„äº‹æƒ…ã€‚ä¸»è¦æœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼šåŸºäº XA çš„åˆ†å¸ƒå¼äº‹åŠ¡å’Œæœ€ç»ˆä¸€è‡´æ€§çš„æŸ”æ€§äº‹åŠ¡ã€‚</p><h1 class=pgc-h-arrow-right>å®æˆ˜</h1><p>äº†è§£äº†åˆ†åº“åˆ†è¡¨çš„æ¦‚å¿µä¸‹é¢å°±æ˜¯å®æˆ˜äº†ï¼Œæœ€åˆæ˜¯è€ƒè™‘ä½¿ç”¨ Mycat çš„ï¼Œä½†æœ€ç»ˆæ²¡æœ‰é‡‡ç”¨çš„åŸå› ä¸»è¦æ˜¯ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><li>Mycat è¾ƒä¸ºæ··ä¹±ï¼Œæ²¡æœ‰æ˜ç¡®çš„å¼€å‘è®¡åˆ’å’Œå®Œå–„çš„æ–‡æ¡£ï¼ˆæ–‡æ¡£æ˜¯ä¸€æœ¬ä¹¦ï¼‰ã€‚è€Œä¸”é¦–é¡µçœ‹ç€åƒæ˜¯ 90 å¹´ä»£çš„é¡µé¢ã€‚</li><li>æœ€å…³é”®çš„ä¸€ç‚¹ï¼ŒMycat å·²ç»å¾ˆä¹…æ²¡æœ‰æ›´æ–°äº†ï¼Œè‡ªä» 17 å¹´å‘å¸ƒäº†æœ€åä¸€ä¸ªç‰ˆæœ¬å°±å†æ²¡æœ‰åŠ¨é™äº†ï¼ˆå®˜ç½‘è¯´çš„æ˜¯ç­¹å¤‡ 2.0 ä¸­ï¼‰ â€ƒâ€ƒåœ¨æŸ¥æ‰¾èµ„æ–™çš„è¿‡ç¨‹ä¸­äº†è§£åˆ°å½“å½“çš„ä¸€æ¬¾å¼€æºåˆ†åº“åˆ†è¡¨äº§å“â€“sharding-jdbc.ç›®å‰å·²ç»è¿ç§»åˆ° apache å­µåŒ–ä¸­å¿ƒï¼Œé¦–é¡µä¹Ÿç›¸åº”çš„æ¢äº†ï¼Œç°åœ¨çš„å®˜ç½‘é¦–é¡µ,åŒæ—¶ä¹Ÿæ”¹åäº†ï¼šShardingSphereã€‚ç›®å‰æœ€æ–°çš„å‘å¸ƒç‰ˆæœ¬æ˜¯ 3.1ï¼Œæœ‰ä»¥ä¸‹ä¸‰ä¸ªäº§å“ï¼š</li><li>Sharding-JDBCã€‚ShardingSphere å°±æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šå‘å±•æ¥çš„ã€‚ä»…æ”¯æŒ javaï¼Œå±äºè½»é‡çº§ java æ¡†æ¶ï¼Œåœ¨ java çš„ JDBC å±‚æé«˜é¢å¤–æœåŠ¡ï¼Œç›¸å½“äºåŠ å¼ºç‰ˆ JDBC é©±åŠ¨ï¼Œå› æ­¤å¯ä»¥ä¸ä»»ä½•ä¸Šå±‚ ORM æ¡†æ¶é…åˆä½¿ç”¨ï¼Œæ”¯æŒä»»æ„çš„æ•°æ®åº“è¿æ¥æ± ï¼Œæ”¯æŒä»»æ„å®ç° JDBC è§„èŒƒçš„æ•°æ®åº“ã€‚æœ¬ç¯‡ä»£ç å°±æ˜¯åŸºäº Shardingâ€”JDBCã€‚</li><li>Sharding-Proxy:è·Ÿ MyCat ä¸€æ ·å±äºæ•°æ®åº“ä»£ç†ï¼Œå¯¹ä»£ç é€æ˜ï¼Œç›®å‰ä»…æ”¯æŒ MySQL æ•°æ®åº“ã€‚</li><li>Sharding-Sidecar:è§„åˆ’ä¸­çš„äº§å“ï¼Œå®šä½ä¸ºäº‘åŸç”Ÿæ•°æ®åº“ä»£ç†ã€‚â€ƒâ€ƒä¸‹é¢å¼€å§‹åŸºäº Spring-boot çš„å®æˆ˜ã€‚æ€»ä½“å¦‚ä¸‹ï¼š</li><li>åˆ†åº“åˆ†è¡¨ä½¿ç”¨</li><li>å¹¿æ’­è¡¨ä½¿ç”¨</li><li>é»˜è®¤åº“ä½¿ç”¨ ï¼ˆPSï¼šå®˜æ–¹ä¹Ÿæœ‰ä½¿ç”¨ç¤ºä¾‹ï¼šhttps://github.com/apache/incubator-shardingsphere-exampleï¼‰</li><h1 class=pgc-h-arrow-right>å»ºç«‹æ•°æ®è¡¨</h1><p>æœ¬ä¾‹ä¸­å…±ç”¨åˆ°ä¸‰ä¸ªåº“å››ä¸ªè¡¨,å¦‚ä¸‹ï¼š</p><ul><li>ds0:</li></ul><p>user(åˆ†åº“ä¸åˆ†è¡¨)</p><p>order(åˆ†åº“åˆ†è¡¨)</p><p>order(åˆ†åº“åˆ†è¡¨)</p><p>order_item(åˆ†åº“åˆ†è¡¨)</p><p>dictionary(å¹¿æ’­è¡¨ï¼Œä¸åˆ†åº“ä¸åˆ†è¡¨åœ¨ï¼Œåœ¨æ‰€æœ‰åº“ä¸­éƒ½æœ‰ç›¸åŒçš„æ•°æ®)</p><ul><li>ds1:(åŒä¸Š)</li></ul><p>user</p><p>order</p><p>order_item</p><p>dictionary</p><ul><li>ds2:(é»˜è®¤æ•°æ®åº“ï¼Œé™¤ä¸Šé¢çš„è¡¨å¤–å…¶ä»–çš„è¡¨)</li></ul><p>other_table</p><p>å»ºè¡¨è¯­å¥åœ¨æ­¤ï¼šhttps://github.com/FleyX/demo-project/tree/master/spring-boot/sjdemo/init</p><h1 class=pgc-h-arrow-right>POM ä¾èµ–</h1><pre><code>&lt;!--è¿™é‡Œæœ‰ä¸ªå¤§å‘ï¼Œç‰ˆæœ¬è¿‡é«˜ä½¿ç”¨xaäº‹åŠ¡ä¼šæŠ¥é”™æœªæŒ‡å®šæ•°æ®åº“ï¼Œå‚è§:https://github.com/apache/incubator-shardingsphere/issues/1842--&gt;&lt;dependency&gt;         &lt;groupId&gt;mysql&lt;/groupId&gt;         &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;         &lt;version&gt;5.1.24&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;         &lt;groupId&gt;io.shardingsphere&lt;/groupId&gt;         &lt;artifactId&gt;sharding-jdbc-spring-boot-starter&lt;/artifactId&gt;         &lt;version&gt;3.1.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;          &lt;groupId&gt;com.alibaba&lt;/groupId&gt;          &lt;artifactId&gt;druid&lt;/artifactId&gt;          &lt;version&gt;1.1.14&lt;/version&gt;&lt;/dependency&gt;&lt;!--  --&gt;&lt;dependency&gt;          &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;          &lt;artifactId&gt;lombok&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt;          &lt;groupId&gt;com.alibaba&lt;/groupId&gt;          &lt;artifactId&gt;fastjson&lt;/artifactId&gt;          &lt;version&gt;1.2.56&lt;/version&gt;&lt;/dependency&gt;&lt;!--xaåˆ†å¸ƒå¼äº‹åŠ¡--&gt;&lt;dependency&gt;          &lt;groupId&gt;io.shardingsphere&lt;/groupId&gt;          &lt;artifactId&gt;sharding-transaction-2pc-xa&lt;/artifactId&gt;          &lt;version&gt;3.1.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;          &lt;groupId&gt;io.shardingsphere&lt;/groupId&gt;          &lt;artifactId&gt;sharding-transaction-spring-boot-starter&lt;/artifactId&gt;             &lt;version&gt;3.1.0&lt;/version&gt;&lt;/dependency&gt;</code></pre><h1 class=pgc-h-arrow-right>yaml é…ç½®</h1><pre><code># application.ymlspring:  profiles:    active: shardingmybatis:  mapper-locations: classpath:mapper/*.xml  type-aliases-package: com.fanxb.sjdemo.entity  # å¼€å¯mybatis sqlæ‰“å°  configuration:    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl</code></pre><p>è¿™é‡Œæ˜¯å…³é”®ï¼Œåˆ†åº“åˆ†è¡¨é…ç½®ã€‚éœ€è¦å°†æ‰€æœ‰çš„è¡¨åˆ—å‡ºï¼ˆåŒ…å«å¹¿æ’­è¡¨ï¼‰ï¼Œæœªåˆ—å‡ºçš„è¡¨å°†ä½¿ç”¨é»˜è®¤åº“ã€‚éœ€ç»™æ‰€æœ‰é…ç½®äº†åˆ†åº“åˆ†è¡¨çš„æ•°æ®è¡¨åŠ ä¸Šä¸€ä¸ª userId å­—æ®µï¼Œå› ä¸ºè¦æ ¹æ® userId æ¥åˆ¤æ–­å†™å…¥åˆ°å“ªä¸ªåº“ä¸­ï¼Œå¦åˆ™å›å‘æ‰€æœ‰åº“æ’å…¥ã€‚</p><pre><code>sharding:  jdbc:    datasource:      # é…ç½®æ•°æ®æº      names: ds0,ds1,ds2      ds0:        type: com.alibaba.druid.pool.DruidDataSource        driver-class-name: com.mysql.jdbc.Driver        url: jdbc:mysql://10.82.27.177:3306/ds0        username: root        password: 123456      ds1:        type: com.alibaba.druid.pool.DruidDataSource        driver-class-name: com.mysql.jdbc.Driver        url: jdbc:mysql://10.82.27.177:3306/ds1        username: root        password: 123456      ds2:        type: com.alibaba.druid.pool.DruidDataSource        driver-class-name: com.mysql.jdbc.Driver        url: jdbc:mysql://10.82.27.177:3306/ds2        username: root        password: 123456    config:      sharding:        # é»˜è®¤æ•°æ®æºï¼Œå¯ä»¥å°†ä¸åˆ†åº“åˆ†è¡¨çš„æ•°æ®è¡¨æ”¾åœ¨è¿™é‡Œ(æ­¤å¤„çš„è¡¨éœ€ä¸å·²ç»åˆ†åº“åˆ†è¡¨çš„è¡¨å®Œå…¨æ²¡æœ‰å…³è”ï¼Œä¸ä¼šäº§ç”Ÿè”è¡¨æŸ¥è¯¢æ“ä½œï¼Œå› ä¸ºè·¨åº“è¿è¡¨æŸ¥è¯¢æ˜¯æ²¡åŠæ³•å®ç°çš„)        # 3.1.0ç‰ˆæœ¬ä¸­dqlæŸ¥è¯¢å­˜åœ¨bugï¼Œä¸ä½¿ç”¨é»˜è®¤åº“.ä¼šåœ¨ä¸‹ä¸ªç‰ˆæœ¬ä¸­ä¿®å¤        default-data-source-name: ds2        # é»˜è®¤åˆ†åº“ç­–ç•¥,æ ¹æ®userIdå¯¹2å–ä½™ç¡®å®šåº“        default-database-strategy:          inline:            sharding-column: userId            algorithm-expression: ds$-&gt;{userId % 2}        # é…ç½®è¡¨ç­–ç•¥        tables:          # å…¬å…±è¡¨(æ¯”å¦‚å­—å…¸è¡¨,è§’è‰²è¡¨ï¼Œæƒé™è¡¨ç­‰),ä¸åˆ†åº“åˆ†è¡¨,æ•°æ®å°†å‘é€åˆ°æ‰€æœ‰åº“ä¸­,æ–¹ä¾¿è”è¡¨æŸ¥è¯¢          dictionary:            # é…ç½®ä¸»é”®ï¼Œä»¥ä¾¿sharding-jdbcç”Ÿæˆä¸»é”®            key-generator-column-name: dictionaryId            actual-data-nodes: ds$-&gt;{0..1}.dictionary          # user å·²ç»æ ¹æ®userIdåˆ†åº“ï¼Œå› æ­¤userè¡¨ä¸è¿›è¡Œåˆ†è¡¨          user:            key-generator-column-name: userId            actual-data-nodes: ds$-&gt;{0..1}.user          order:            key-generator-column-name: orderId            actual-data-nodes: ds$-&gt;{0..1}.order$-&gt;{0..1}            table-strategy:              inline:                # è®¾ç½®åˆ†ç‰‡é”®ï¼Œç›¸åŒåˆ†ç‰‡é”®çš„è¿è¡¨æŸ¥è¯¢ä¸ä¼šå‡ºç°ç¬›å¡å„¿ç§¯                sharding-column: orderId                # è®¾ç½®åˆ†è¡¨è§„åˆ™,æ ¹æ®è®¢å•idå¯¹2å–ä½™åˆ†ä¸¤ä¸ªè¡¨                algorithm-expression: order$-&gt;{orderId%2}          order_item:            key-generator-column-name: orderItemId            actual-data-nodes: ds$-&gt;{0..1}.order_item$-&gt;{0..1}            table-strategy:              inline:                sharding-column: orderId                # è®¾ç½®åˆ†è¡¨è§„åˆ™,æ ¹æ®è®¢å•idå¯¹2å–ä½™åˆ†ä¸¤ä¸ªè¡¨                algorithm-expression: order_item$-&gt;{orderId%2}      # æ‰“å°sqlè§£æè¿‡ç¨‹      props:        sql.show: true</code></pre><p>åˆ°è¿™é‡Œå°±ç®—é…ç½®å®Œæ¯•äº†ï¼Œå‰©ä¸‹çš„è¿‡ç¨‹å’Œæ™®é€š spring boot+mybatis é¡¹ç›®ä¸€æ ·ï¼Œä¸å†èµ˜è¿°ã€‚</p><p>äº‹åŠ¡å¤„ç†</p><p>â€ƒâ€ƒé»˜è®¤ä½¿ç”¨çš„æ˜¯æœ¬åœ°äº‹åŠ¡ï¼Œä½†æ˜¯å¦‚æœä¸šåŠ¡é€»è¾‘æŠ›å‡ºé”™è¯¯ï¼Œè¿˜æ˜¯ä¼šå¯¹æ‰€æœ‰çš„åº“è¿›è¡Œå›é€€æ“ä½œçš„ï¼Œåªæ˜¯å¦‚æœå‡ºç°æ–­ç”µæ–­ç½‘çš„æƒ…å†µä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚è¯¦è§ï¼šå®˜æ–¹æ–‡æ¡£. å¯é€šè¿‡@ShardingTransactionType(TransactionType.XA)æ³¨è§£ï¼Œåˆ‡æ¢ä¸º XA äº‹åŠ¡æˆ–è€…æŸ”æ€§äº‹åŠ¡ï¼ˆç¤ºä¾‹ä¸­æœªé…ç½®ï¼Œåˆ‡æ¢ä¸ºæŸ”æ€§äº‹åŠ¡ä¼šæŠ¥é”™ï¼‰ã€‚</p><h2 class=pgc-h-arrow-right>æµ‹è¯•</h2><p>è¿è¡Œcom.fanxb.sjdemo.MainTestæŸ¥çœ‹æµ‹è¯•ç»“æœã€‚</p><p><br></p><blockquote><p>ä¸“æ³¨äºæŠ€æœ¯çƒ­ç‚¹å¤§æ•°æ®ï¼Œäººå·¥æ™ºèƒ½ï¼ŒJAVAã€Pythonã€ C ã€GOã€Javascriptç­‰è¯­è¨€æœ€æ–°å‰è¨€æŠ€æœ¯ï¼ŒåŠä¸šåŠ¡ç—›ç‚¹é—®é¢˜åˆ†æï¼Œè¯·å…³æ³¨ã€ç¼–ç¨‹æˆ‘æœ€æ‡‚ã€‘å…±åŒäº¤æµå­¦ä¹ ã€‚</p></blockquote></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'è¶…è¯¦ç»†','sharding','jdbc'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>