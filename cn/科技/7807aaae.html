<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>你知道什么是 MySQL 的模糊查询？ | 极客快訊</title><meta property="og:title" content="你知道什么是 MySQL 的模糊查询？ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/RrCKQME5aFEzoz"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7807aaae.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7807aaae.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7807aaae.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7807aaae.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7807aaae.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7807aaae.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7807aaae.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7807aaae.html><meta property="article:published_time" content="2020-11-14T21:01:02+08:00"><meta property="article:modified_time" content="2020-11-14T21:01:02+08:00"><meta name=Keywords content><meta name=description content="你知道什么是 MySQL 的模糊查询？"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/7807aaae.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>你知道什么是 MySQL 的模糊查询？</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RrCKQME5aFEzoz><p>作者 | luanhz</p><p>责编 | 郭芮</p><p>本文对MySQL中几种常用的模糊搜索方式进行了介绍，包括LIKE通配符、RegExp正则匹配、内置字符串函数以及全文索引，最后给出了性能对比。</p><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RT4Gwk56bt5iOJ><p><strong>引言</strong></p><p>MySQL根据不同的应用场景，支持的模糊搜索方式有多种，例如应用最广泛的可能是Like匹配和RegExp正则匹配，二者虽然用法和原理都很相似，但实际上匹配原则却不尽相同，其中Like要求模式串与整个目标字段完全匹配才检索该记录，而RegExp则是要求目标字段包含模式串即可。</p><p>对于简单的判断模式串是否存在类型的模糊搜索，应用MySQL内置函数即可实现，例如Instr、Locate、Position等。</p><p>当然，提到MySQL查询性能就不得不提到索引，对于字段模糊查询需求，我们也可以考虑添加全文索引(Fulltext)。</p><p>注：本文所用MySQL版本8.0.19，可视化工具Navicat Primium。</p><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RT7S2kzFTfre26><p><strong>4种模糊查询</strong></p><p>为了便于描述和测试不同模糊查询方式结果，首先给出一个简单的测试用数据表tests如下：</p><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RxKUm8ACGLu78N><p>其中，tests表仅含有一个名为words的字段，并对该字段添加全文索引。表中共有6条记录。</p><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RxKUm8Y4gUDSLg><p><strong>Like</strong></p><p>Like算作MySQL中的谓词，其应用与is、=、>和&lt;等符号用法类似。Like主要支持两种通配符，分别是"_"和"%"，其中前者代表匹配1个任意字符，常用于充当占位符；而后者代表匹配0个或多个任意字符。从某种意义上讲，Like可看作是一个精简的正则表达式功能。</p><p>例如，在如上表中查找所有以"hello"开头的记录，则其SQL语句为：</p><pre><code>1SELECT words FROM tests WHERE words LIKE 'hello%';</code></pre><p>查询结果：</p><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RxKUm8mAPiwdPE><p>如果想查找所有以"hello"开头且至少含有6个字符的记录，则可简单修改SQL语句如下：</p><pre><code>1SELECT words FROM tests WHERE words LIKE 'hello_%';</code></pre><p>查询结果：</p><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RxKUm8zAflEFIr><p>另外：当在Like模式字段中，若不包含任何"_"和"%"通配符，则等价于"="，表示精确匹配，例如查询语句……Like "hello"，则仅返回hello一条记录；还可在Like前加限定词Not，表示结果取反。</p><p><strong>RegExp</strong></p><p>正则表达式具有庞大而丰富的语法，MySQL语法中支持绝大部分正则表达式功能，几乎可以满足所有需求。本文不过多展开正则表达式相关介绍，仅在Like的基础上，简单介绍其与Like模糊搜索方式的区别。</p><p>如前所述，Like匹配原则是要求模式串与整个目标字段匹配时，才返回该条记录；而RegExp中则是当目标字段包含模式串时即返回该条记录。例如如下SQL语句将返回所有包含"hello"的记录：</p><pre><code>1SELECT words FROM tests WHERE words REGEXP 'hello';</code></pre><p>而在Like中这样的写法仅返回记录="hello"的记录。为了限定正则表达式以某个模式串开头或者结尾，可以通过添加"^"和"$"标识符来限定，例如仍然搜索以"hello"开头的目标字段，则其SQL语句为：</p><pre><code>1SELECT words FROM tests WHERE words REGEXP '^hello';</code></pre><p><strong>内置函数</strong></p><p>对于包含某些特定模式串的模糊搜索，可以通过MySQL内置函数实现。可以完成这一功能的函数包括Instr、Locate和Position等，其功能语法很相近，均是返回子串在字符串中的索引，且索引下标从1开始，当子串不存在是返回0。需要注意的是三个函数中子串和字符串的先后顺序是不一致的。例如以下语句均成功检索，且返回目标索引1</p><pre><code>1SELECT INSTR("hello,world", 'hello');-- 1</code><code>2SELECT LOCATE('hello', "hello,world");-- 1</code><code>3SELECT POSITION('hello' in "hello, world"); -- 1</code></pre><p>应用以上3个内置函数，搜索上述测试表中包含"hello"的记录，则相应SQL语句为：</p><pre><code>1SELECT words FROM tests WHERE INSTR(words, 'hello');</code><code>2SELECT words FROM tests WHERE LOCATE('hello', words);</code><code>3SELECT words FROM tests WHERE POSITION('hello' in words);</code></pre><p><strong>全文索引</strong></p><p>抛开索引谈查询性能，都是耍流氓！</p><p>全文索引是MySQL中索引的一种，曾经仅在引擎为MyISAM的表中支持，从5.6版本开始在InnoDB中也开始支持全文索引，支持的字段格式包括CHAR、VARCHAR和TEXT。在如上已经添加了全文索引的tests表中，仍然查询包含"hello"的记录，应用全文索引查询的SQL语句为：</p><pre><code>1SELECT words FROM tests WHERE MATCH(words) against('hello');</code></pre><p>实际上，MATCH(words) against('hello')返回的是字段words对目标字符"hello"的匹配程度：当不存在任何匹配结果时，返回0；否则，根据匹配次数的多少和位置先后返回一个匹配度。例如，如下SQL语句返回表中每条记录对目标字段"hello"的匹配度：</p><pre><code>1SELECT MATCH(words) against('hello') FROM tests;</code></pre><p>返回结果如下：</p><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RxKUmZmEctZuIX><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTJXJ1kBqzfCnu><p><strong>查询性能对比</strong></p><p>为了对比以上4种模糊搜索方式的性能，我们这里构建一个规模较大且更具一般性的数据表。本文选择采集若干条英文格言，用于创建目标数据库。</p><p><strong>创建数据表</strong></p><p>为简单起见，仅创建一个名为says的字段，且对其添加全文索引。</p><pre><code>1CREATE TABLE IF NOT EXISTS sayings(says TEXT, FULLTEXT (says));</code></pre><p><strong>英文格言信息获取</strong></p><p>在网上找了个英文格言的网站，并写了一个python小爬虫爬取页面全部300条英文格言，爬虫源码如下（为了增加记录条数，将300条记录重写100词，即数据库中包含30000条记录）：</p><pre><code> 1from pyquery import PyQuery as pq</code><code> 2from pymysql import connect</code><code> 3</code><code> 4doc = pq(url='http://www.1juzi.com/new/43141.html', encoding = 'gb18030')</code><code> 5items=doc("div.content&gt;p:nth-child(2n+1)").items</code><code> 6hots = [item.text() for item in items]</code><code> 7with connect(host="localhost", user="root", password="123456", db='teststr', charset='utf8') as cur:</code><code> 8 sql_insert = 'insert into sayings values (%s);'</code><code> 9 for _ in range(100):</code><code>10 cur.executemany(sql_insert, hots)</code></pre><p>对爬取的英文短句写入创建的数据表中，结果如下：</p><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/RxKUmaLCGFntIm><p>既然是英文励志格言短句，那么我们就来查询其中包括"success"的记录。</p><p>首先查询语句中任意位置包含"success"的记录，4种方式SQL语句及执行时间为：</p><pre><code> 1-- LIKE通配符</code><code> 2SELECT says FROM sayings WHERE says LIKE '%success%'</code><code> 3&gt; OK</code><code> 4&gt; 时间: 0.036s</code><code> 5</code><code> 6-- REGEXP正则匹配</code><code> 7SELECT says FROM sayings WHERE says REGEXP 'success'</code><code> 8&gt; OK</code><code> 9&gt; 时间: 0.053s</code><code>10</code><code>11-- 内置函数查找</code><code>12SELECT says FROM sayings WHERE INSTR(says, 'success')</code><code>13&gt; OK</code><code>14&gt; 时间: 0.045s</code><code>15</code><code>16SELECT says FROM sayings WHERE LOCATE('success', says)</code><code>17&gt; OK</code><code>18&gt; 时间: 0.044s</code><code>19</code><code>20SELECT says FROM sayings WHERE POSITION('success' in says)</code><code>21&gt; OK</code><code>22&gt; 时间: 0.047s</code><code>23</code><code>24-- 全文索引</code><code>25SELECT says FROM sayings WHERE MATCH(says) against('Success')</code><code>26&gt; OK</code><code>27&gt; 时间: 0.006s</code></pre><p>可见，全文索引速度最宽，领先其他方式接近一个量级；Like通配符速度其次，但与其他几种查询方式效率相差不大。</p><p>通过Explain查询计划，我们可以发现全文索引方式由于应用了索引而无需全表查询，所以执行速度快，而其他三种模糊查询方式均为执行全表查询。</p><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RxKUmavFSnp52f><p>全文索引查询计划</p><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/RxKUmbF88oiGNi><p>Like通配符查询计划</p><p>实际上，对于添加索引的字段应用Like查询时，可以应用索引加速查询，为勒验证全文索引条件下是否仍然可以应用索引，我们进行第二组性能测试：</p><p>查询语句中以"success"开头的记录（全文索引方式不支持指定单词开头的查询任务），相应SQL语句即执行时间如下：</p><pre><code> 1SELECT says FROM sayings WHERE says LIKE 'success%'</code><code> 2&gt; OK</code><code> 3&gt; 时间: 0.015s</code><code> 4</code><code> 5SELECT says FROM sayings WHERE says REGEXP '^success'</code><code> 6&gt; OK</code><code> 7&gt; 时间: 0.046s</code><code> 8</code><code> 9SELECT says FROM sayings WHERE INSTR(says, 'success')=1</code><code>10&gt; OK</code><code>11&gt; 时间: 0.042s</code><code>12</code><code>13SELECT says FROM sayings WHERE LOCATE('success', says)=1</code><code>14&gt; OK</code><code>15&gt; 时间: 0.051s</code><code>16</code><code>17SELECT says FROM sayings WHERE POSITION('success' in says)=1</code><code>18&gt; OK</code><code>19&gt; 时间: 0.049s</code><code>20</code><code>21SELECT says FROM sayings WHERE MATCH(says) against('Success')</code><code>22&gt; OK</code><code>23&gt; 时间: 0.007s</code></pre><p>可以看到，修改后的Like查询效率提升明显，并大幅超过其他方式。但解释查询计划发现，虽然possible_key显示了索引字段，但实际仍然未应用任何索引（key为），即仍然进行全表查询（Type = All）。之所以带来速度上的大幅提升，仅仅是因为对'success%'要比'%success%'执行字符串匹配要快得多（后者要整列匹配，前者仅需匹配开头的单词即可），而与索引无关。</p><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RxKUmbX3RAKHyD><p>Like'success%'仍然无法应用全文索引</p><p>所以，得到的结论是Like通配符无法有效利用全文索引加速查询，但在特定模式下的查询速度可快于通配符%模式下的查询。</p><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTJXJ7YR5xGDl><p><strong>总结</strong></p><p>本文探讨了MySQL中4中模糊查询方式，包括：</p><ul><li><p>Like通配符用于查询目标字段与模式串完全匹配的记录，且无法应用全文索引提高查询速度，但以特定字符开头的模糊查询比以"%"开头时速度提升明显；</p></li><li><p>RegExp正则表达式功能强大，可实现任意模式查询，但执行效率一般；</p></li><li><p>简单的子串有无查询还可应用MySQL内置函数，包括Instr、Locate和Position等，用法相近，但效率一般；</p></li><li><p>对于包含全文索引的目标字段查询，应用全文索引查询效率最高，但可定制性差，不支持任意匹配查询；</p></li><li><p>记录数目较少时，几种查询方式效率均可接受，可根据任务需求灵活选用。</p></li></ul><p>声明：本文为作者投稿，版权归其所有。</p><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/Rx9nihO9EAw0sy><img alt="你知道什么是 MySQL 的模糊查询？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/Rr3netS9s5VuTc><p><strong>今日福利</strong></p><p><strong>遇见大咖</strong></p><p>由 CSDN 全新专为技术人打造的高端对话栏目《大咖来了》来啦！</p><p>CSDN 创始人&董事长、极客帮创投创始合伙人蒋涛携手京东集团技术副总裁、IEEE Fellow、京东人工智能研究院常务副院长、深度学习及语音和语言实验室负责人何晓冬，来也科技 CTO 胡一川，共话中国 AI 应用元年来了，开发者及企业的路径及发展方向！</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'什么','MySQL','查询'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>