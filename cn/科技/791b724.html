<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>彩票数据收集！学会利用python库爬取双色球历史数据 | 极客快訊</title><meta property="og:title" content="彩票数据收集！学会利用python库爬取双色球历史数据 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/1539455922015041c78142e"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/791b724.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/791b724.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/791b724.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/791b724.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/791b724.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/791b724.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/791b724.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/791b724.html><meta property="article:published_time" content="2020-10-29T20:59:17+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:17+08:00"><meta name=Keywords content><meta name=description content="彩票数据收集！学会利用python库爬取双色球历史数据"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/791b724.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>彩票数据收集！学会利用python库爬取双色球历史数据</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1539455922015041c78142e><p class=pgc-img-caption></p></div><hr><h1><strong>阅读建议</strong></h1><p>你可能感兴趣的关键词：python3、爬虫、彩票数据</p><p>阅读时长：15分钟</p><p>建议阅读方式：阅读+收藏+动手实践</p><hr><h1><strong>前言</strong></h1><p>首先声明，这个爬取的意义不会太大，因为目前很多网站都有下载按钮可以直接下载从2003-02-23到最新的全部数据：</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15394536518334ac447d602><p class=pgc-img-caption></p></div><p>但是通过这次爬取，你可以熟悉python3、网页解析库的使用、正则的使用，以及linux相关的知识，当以后有爬取其他数据需求的时候，就能够用得上啦~</p><p>在我的博客文章《用Python爬取双色球开奖信息（升级版）》中介绍了简单的urllib+re正则的方式来提取每天的双色球数据，当然这是有用的，虽然数据量少，但是可以用来做一些比如“<strong>买了股票自动比对中奖情况然后推送</strong>”这一类程序或网页。</p><p>但这种爬取方式仍然存在问题：容易被网站的反爬虫或者反作弊发现。也就是说，你爬取这些接口，那边的服务器系统会有日志的，并且有自动处理程序，甚至会有机器学习的程序。尽管这种数据没有什么敏感性，根本不会来封你的IP，不过也要养成良好的爬虫习惯，至少——在爬取的时候加个header，不要被一句简单的awk命令就给筛选出来安排得明明白白了（我在实习的时候经常一句awk就筛出那些刷金币刷花接口的萌新同学，尽管大佬们提供了svm机器学习模型来自动处理）。</p><p>注意到有的网站提供了大量的历史开奖数据，比如500彩票网双色球历史数据、中彩网双色球历史数据，我们可以都爬下来，然后自行对比使用，一个可能的用途是<strong>用机器学习去预测走势</strong>（虽然国内的双色球……em……每天停售后两个小时才开奖……），用来玩玩吧。</p><h1><strong>运行环境</strong></h1><p>解释器：python3.5.2</p><p>IDE：Pycharm 2016.3.2</p><p>浏览器：Chrome</p><h1><strong>爬取500双色球的历史数据</strong></h1><p>500彩票网的网页比较规矩，没有什么花里胡哨的东西。</p><p><strong>1、进入网页，查看接口</strong></p><p>用Chrome浏览器进入500双色球历史数据网页（http://datachart.500.com/ssq/history/history.shtml），然后右键→检查，翻到Network→XHR的一栏。</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1539454105917f03193d169><p class=pgc-img-caption></p></div><p>网页上随便选择期数，点击查看，就能看到网页异步获取数据的接口了：</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1539454175711b2b4e18575><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1539454175889cf9c408562><p class=pgc-img-caption></p></div><p>点进去看一看，非常简单的get请求：</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/153945417589124579ba072><p class=pgc-img-caption></p></div><p>翻看一下Response，竟然直接返回的HTML而不是JSON……</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1539454175520c2857638cd><p class=pgc-img-caption></p></div><p><strong>2、分析数据</strong></p><p>这就比较烦了，需要解析html了，首先分析一下彩票数据html的数据结构：</p><pre>&lt;tbody id="tdata"&gt;	&lt;tr class="t_tr1"&gt;		&lt;!--&lt;td&gt;2&lt;/td&gt;--&gt;		&lt;td&gt;18092&lt;/td&gt;		&lt;td class="t_cfont2"&gt;06&lt;/td&gt;		&lt;td class="t_cfont2"&gt;10&lt;/td&gt;		&lt;td class="t_cfont2"&gt;16&lt;/td&gt;		&lt;td class="t_cfont2"&gt;19&lt;/td&gt;		&lt;td class="t_cfont2"&gt;24&lt;/td&gt;		&lt;td class="t_cfont2"&gt;33&lt;/td&gt;		&lt;td class="t_cfont4"&gt;16&lt;/td&gt;		&lt;td class="t_cfont4"&gt; &lt;/td&gt;		&lt;td&gt;921,043,817&lt;/td&gt;		&lt;td&gt;1&lt;/td&gt;		&lt;td&gt;10,000,000&lt;/td&gt;		&lt;td&gt;95&lt;/td&gt;		&lt;td&gt;269,198&lt;/td&gt;		&lt;td&gt;318,819,890&lt;/td&gt;		&lt;td&gt;2018-08-09&lt;/td&gt;	&lt;/tr&gt;	&lt;tr class="t_tr1"&gt;		&lt;!--&lt;td&gt;2&lt;/td&gt;--&gt;		&lt;td&gt;18091&lt;/td&gt;		&lt;td class="t_cfont2"&gt;06&lt;/td&gt;		&lt;td class="t_cfont2"&gt;11&lt;/td&gt;		&lt;td class="t_cfont2"&gt;13&lt;/td&gt;		&lt;td class="t_cfont2"&gt;17&lt;/td&gt;		&lt;td class="t_cfont2"&gt;25&lt;/td&gt;		&lt;td class="t_cfont2"&gt;32&lt;/td&gt;		&lt;td class="t_cfont4"&gt;07&lt;/td&gt;		&lt;td class="t_cfont4"&gt; &lt;/td&gt;		&lt;td&gt;854,322,188&lt;/td&gt;		&lt;td&gt;4&lt;/td&gt;		&lt;td&gt;8,999,907&lt;/td&gt;		&lt;td&gt;81&lt;/td&gt;		&lt;td&gt;246,907&lt;/td&gt;		&lt;td&gt;315,853,082&lt;/td&gt;		&lt;td&gt;2018-08-07&lt;/td&gt;	&lt;/tr&gt;&lt;/tbody&gt;</pre><p>非常完整标准的表格结构，这里要注意几个细节：</p><p>（1）中间有一栏是&nbsp，也就是空格，这一栏的体现是一个名为<strong>快乐星期天</strong>的属性。快乐星期天是指开出两个蓝球，第一个正常开，该中啥中啥；第二个蓝号中了，并且前面红号任意中5个，就能得到固定的3000元奖金。</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1539454175522608963f460><p class=pgc-img-caption></p></div><p>这里由于只是一个活动，不清楚以后是否会用，而且快乐星期天数据格式有：空格（&nbsp，unicode显示为a0）；0；1个数字；3个逗号分隔的数字，因此可以考虑把这个属性变为用“-”连接的字符串，如果以后有需要可以自行处理，如果不需要可以直接略过整个属性。</p><p>（2）数字采用了银行的那种逗号分隔的格式，这是方便浏览的格式；同时我们想做的也是用逗号分隔，这会产生歧义，并且我们需要的是存储使用而不是观看，所以需要在采集的时候把逗号去掉。</p><p>（3）多测几次数据，会发现500没有对数据进行分页，这对爬取来说非常有利。</p><p><strong>3、开始爬取</strong></p><p>那么，这次我们使用python强大的库吧，这里使用的是用于请求数据的requests以及用于解析HTML的HTMLParser。</p><p>requests的用法非常简单，注意编码格式不要中文乱码即可：</p><pre>def getHtml(url, method='get', headers={}, params={}): if method == 'get': html = requests.get(url, headers=headers, params=params) html.encoding = 'utf-8' #html.apparent_encoding else: html = requests.post(url, headers=headers, data=params) html.encoding = 'utf-8' return html.text</pre><p>header和params都是这样的字典：</p><pre>headers:{ "Host": "datachart.500.com", "Connection": "keep-alive", "Accept": "*/*", "X-Requested-With": "XMLHttpRequest", "User-Agent": "Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62." "0.3202.94 Safari/537.36", "Referer": "http://datachart.500.com/ssq/history/history.shtml", "Accept-Encoding": "gzip, deflate", "Accept-Language":"zh-CN,zh;q=0.9", "Cookie":"ck_RegFromUrl=http%3A//www.500.com/; sdc_session=1533916356798; _jzqy=1.1528606472.1533916357.1." "jzqsr=baidu.-; _jzqckmp=1; seo_key=baidu%7C%7Chttps://www.baidu.com/link?url=MQcB3-er5rK249eCQNw" "G8A4N-hontstLi8HIy9E7H_q&amp;wd=&amp;eqid=fec80b7400019715000000035b6db4d7; bdshare_firstime=15339164028" "59; WT_FPC=id=undefined:lv=1533916553308:ss=1533916402791; _qzja=1.190448226.1533829920533.15338" "29920534.1533916402865.1533916409059.1533916553371.0.0.0.5.2; _qzjc=1; _jzqa=1.20620370185900751" "00.1533829921.1533829921.1533916357.2; _jzqc=1; Hm_lvt_4f816d475bb0b9ed640ae412d6b42cab=15338299" "21,1533916357; Hm_lpvt_4f816d475bb0b9ed640ae412d6b42cab=1533916554; __utma=63332592.612539621.15" "33916358.1533916358.1533916358.1; __utmc=63332592; __utmz=63332592.1533916358.1.1.utmcsr=baidu|u" "tmccn=(organic)|utmcmd=organic; CLICKSTRN_ID=123.98.36.94-1533829945.911636::415C872F9F26292A610C" "843E6BD7FEB2; motion_id=1533920615560_0.37147948464863223",}params:{ 'start':'1', 'end':'18092'}</pre><p>start和end就是那个get请求的URL携带的参数啦，就是彩票期数。Cookie可以直接加在header里面发送，也可以单独地作为参数：</p><pre>requests.get(url, headers=headers, cookies=cookies, params=params)</pre><p>前面提到，爬下来是一个网页，需要解析，我们构建一个HTMLParser的处理类：</p><pre>class Parser500ssq(HTMLParser): flag_tbody = False # 定义一些变量 flag_tr = False flag_td = False linedata = [] result = []  def handle_starttag(self, tag, attrs): # 匹配开始标签 if (str(tag).startswith("tbody")): # 比如匹配tbody  for k,v in attrs: # 遍历tbody标签中的属性 if k == 'id' and v == 'tdata': # 如果匹配到指定属性 self.flag_tbody = True # 设置一个flag，表明匹配到了开始工作啦 return elif (self.flag_tbody == True):  if (str(tag).startswith("tr")): self.flag_tr = True if (str(tag).startswith("td")): self.flag_td = True  def handle_endtag(self, tag): # 匹配结束标签  if (self.flag_tbody == True): # 如果在tbody标签里面 if (str(tag).startswith("tr")): # 如果是&lt;/tr&gt;，说明行结束了，提交一波数据 self.result.append(self.linedata) self.linedata = [] self.flag_tr = False elif (str(tag).startswith("td")): # 如果是&lt;/td&gt;，说明一个属性结束了，关掉flag  self.flag_td = False elif (str(tag).startswith("tbody")): self.flag_tbody = False  def handle_data(self, data): # 处理&lt;xx&gt;data&lt;/xx&gt;里面的数据 if (self.flag_td == True): # 如果是在处理&lt;td&gt;内的数据 if 'a0' in data: self.linedata.append("-".join(data.replace(u'a0', u'').split(","))) # 空格特殊处理 else: self.linedata.append("".join(data.split(","))) # 数字去掉逗号''' def handle_startendtag(self, tag, attrs): # 匹配开始和结束标签，用不到 print('&lt;%s/&gt;' % tag)  def handle_comment(self, data): # 匹配&lt;!--&gt;comment&lt;--!&gt;这样的注释，用不到 print('&lt;!--', data, '--&gt;')  def handle_entityref(self, name): # 匹配特殊字符，比如&amp;nbps，用不到 print('&amp;%s;' % name)  def handle_charref(self, name): # 匹配特殊字符串，比如，用不到 print('%s;' % name)'''</pre><p>思路很简单，匹配到了开始符就设置flag，然后就开始收集数据，匹配到了结束符就存一波数据，这样数据就会被以列表的结构存在result里面。那么我们简单定义一个处理函数，就能够把它打入文件保存了。用feed给这个parser类喂数据，用with...as的结构来写文件：</p><pre>def parse500ssq(html,datapath): print("start grabbing...") parser = Parser500ssq() parser.feed(html) print(parser.result) with open(BASEPATH + datapath, 'w') as f: for line in parser.result: print(line) f.write(",".join(line)) f.write("\n") print("finished.")</pre><p>得到的结果是这样的：</p><pre>['18092', '06', '10', '16', '19', '24', '33', '16', '', '921043817', '1', '10000000', '95', '269198', '318819890', '2018-08-09']['11025', '08', '25', '26', '31', '32', '33', '09', '0', '310916704', '4', '8040679', '80', '228050', '335345846', '2011-03-06']['06050', '02', '06', '12', '15', '25', '31', '07', '09-14-05', '138448657', '1', '5000000', '39', '148511', '94915860', '2006-05-02']['03001', '10', '11', '12', '13', '26', '28', '11', '10', '2097070', '0', '0', '1', '898744', '10307806', '2003-02-23']</pre><h1><strong>爬取中彩网双色球的历史数据</strong></h1><p><strong>1、进入网页，查看接口</strong></p><p>进入中彩网双色球往期查询页面（http://www.zhcw.com/kj/qg/ssq/wqcx/），相同的方法，随便选择期数，点击查询，观察XHR。</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1539454175593c269a62979><p class=pgc-img-caption></p></div><p>然而XHR没有任何变化……</p><p>检查查询按钮的HTML，是一个调用js函数search()的input元素：</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1539454175664ab7406c064><p class=pgc-img-caption></p></div><p>网页上右键，查看网页源代码，ctrl+f搜索search()，竟然没搜到……</p><p>仔细观察发现是加载了一个iframe：</p><pre>&lt;iframe src="http://kaijiang.zhcw.com/lishishuju/jsp/ssqInfoList.jsp?czId=1" id="frmdetail" name="frmdetail" width="100%" frameborder="0" onload="this.height = 20+document.getElementById('frmdetail').contentDocument.body.offsetHeight; delNode('loading');"&gt;&lt;/iframe&gt;</pre><p>进入这个网址，是一个纯净的数据表HTML，赛高~</p><p>再次点击查询，观察XHR，仍然没有数据……</p><p>调整到All，原来它是直接跳转的网页而不是异步刷新数据：</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1539454175810b1e8d5c8a2><p class=pgc-img-caption></p></div><p>那么，又要解析html了………………</p><p><strong>2、分析数据</strong></p><p>仍然是标准的html表格：</p><pre>&lt;tbody&gt;	&lt;tr&gt;		&lt;td&gt;1&lt;/td&gt;		&lt;td&gt;2018-08-09&lt;/td&gt;		&lt;td&gt;2018092&lt;/td&gt;		&lt;td class="kaiHao"&gt;06 10 16 19 24 33 &lt;span&gt;16&lt;/span&gt;&lt;/td&gt;		&lt;td&gt;318,819,890&lt;/td&gt;		&lt;td&gt;1&lt;/td&gt;		&lt;td&gt;10,000,000&lt;/td&gt;		&lt;td&gt;95&lt;/td&gt;		&lt;td&gt;269,198&lt;/td&gt;		&lt;td&gt;882&lt;/td&gt;		&lt;td&gt;3,000&lt;/td&gt;		&lt;td&gt;921,043,817&lt;/td&gt;	&lt;/tr&gt;	 	&lt;tr&gt;		&lt;td&gt;2&lt;/td&gt;		&lt;td&gt;2018-08-07&lt;/td&gt;		&lt;td&gt;2018091&lt;/td&gt;		&lt;td class="kaiHao"&gt;06 11 13 17 25 32 &lt;span&gt;07&lt;/span&gt;&lt;/td&gt;		&lt;td&gt;315,853,082&lt;/td&gt;		&lt;td&gt;4&lt;/td&gt;		&lt;td&gt;8,999,907&lt;/td&gt;		&lt;td&gt;81&lt;/td&gt;		&lt;td&gt;246,907&lt;/td&gt;		&lt;td&gt;1107&lt;/td&gt;		&lt;td&gt;3,000&lt;/td&gt;		&lt;td&gt;854,322,188&lt;/td&gt;	&lt;/tr&gt;&lt;/tbody&gt;</pre><p>这里要注意：</p><p>（1）设计了分页，所以表面上是三个参数：</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1539454324489bb72cc3cef><p class=pgc-img-caption></p></div><p>实际上还有一个参数：</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1539454336897294f59cd5a><p class=pgc-img-caption></p></div><p>（2）蓝球是在span标签里面的，而不是td</p><p>（3）数字依然有逗号分隔</p><p><strong>3、开始爬取</strong></p><p>首先需要处理翻页的问题，观察到下一页翻到最后尾页是相同的，没有价值，我们可以比对上一页和尾页，如果上一页和尾页的差距在一页以上，就说明没爬完，需要进行翻页。</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/153945417591071f1b10470><p class=pgc-img-caption></p></div><p>举个例子，当前页数为1，上一页为0，尾页为2，一共有2页。那么当上一页为0的时候，所在页为1，需要翻页；上一页为1的时候，和尾页差距为1，这时候所在页为2，已经爬取完了。而翻页的方式仅仅需要修改提交请求的参数，很容易写出这样的代码：</p><pre>class ParserZhcwssq(HTMLParser): flag_tbody = False flag_tr = False flag_td = False flag_ballnum = False flag_nextpage = False linedata = [] result = [] url_nextpage = []  def reset_attr(self): self.flag_tbody = False self.flag_tr = False self.flag_td = False self.flag_ballnum = False self.flag_nextpage = False self.linedata = [] self.result = [] self.url_nextpage = []  def handle_starttag(self, tag, attrs): # start tag if (str(tag).startswith("tbody")): self.flag_tbody = True elif (self.flag_tbody == True): if (str(tag).startswith("tr")): self.flag_tr = True elif (str(tag).startswith("td")): self.flag_td = True for k,v in attrs: if k == 'class' and v == "kaiHao": self.flag_ballnum = True elif self.flag_nextpage == True and str(tag).startswith("a"): self.url_nextpage.append(attrs[0][1].split("PageNum=")[1])  def handle_endtag(self, tag): # end tag if (self.flag_tbody == True): if (str(tag).startswith("tr")): self.result.append(self.linedata) self.linedata = [] self.flag_tr = False elif (str(tag).startswith("td")): self.flag_td = False self.flag_ballnum = False elif (str(tag).startswith("tbody")): self.flag_tbody = False  def handle_data(self, data): # &lt;xx&gt;data&lt;/xx&gt; if (self.flag_td == True): if self.flag_ballnum == True: self.linedata.extend(data.rstrip().split(" ")) else: self.linedata.append("".join(data.split(",")))  def handle_comment(self, data): # &lt;!--&gt;comment&lt;--!&gt; if(data.strip() == '分页条'): self.flag_nextpage = True def parseZhcwssq(html,datapath,htmlurl,method,headers,params): print("start grabbing...") parser = ParserZhcwssq() wmode = 'w' while(1): parser.feed(html) print(parser.result) with open(BASEPATH + datapath, wmode) as f: for line in parser.result: f.write(",".join(line)) f.write("\n") if int(parser.url_nextpage[1]) != int(parser.url_nextpage[3]) - 1: print("grabbing nextpage...") wmode = 'a' params['currentPageNum'] = parser.url_nextpage[2].strip() html = getHtml(htmlurl, method, headers,params) parser.reset_attr() else: print("finished.") break</pre><p>爬取结果：</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1539454176073ec8bf2cf3c><p class=pgc-img-caption></p></div><h1><strong>总结</strong></h1><p>1、这次爬取的结果已经上传到github（BEWINDOWEB）上的lotterydata上面了，可以下载来直接使用。</p><p>2、完整的爬取代码上传到了github（BEWINDOWEB）上的lotteryhistorygrabber，可以下载来学习和实践。</p><p>3、数据格式：</p><p><strong>lot_500_ssq.txt：</strong></p><p>期号，红球1，红球2，红球3，红球4，红球5，红球6，蓝球，快乐星期天，奖金奖池（元），</p><p>一等奖注数，一等奖奖金（元），二等奖注数，二等奖奖金（元），总投注额（元），开奖日期</p><p><strong>lot_zhcw_ssq.txt：</strong></p><p>序号，开奖日期，期号，红球1，红球2，红球3，红球4，红球5，红球6，蓝球，销售额，</p><p>一等奖注数，一等奖奖金（元），二等奖注数，二等奖奖金（元），三等奖注数，三等奖奖金（元），奖池（元）</p><p>4、这次的爬取总的来说还是十分简单，没有涉及到任何异步加载延迟、复杂的iframe结构、登录cookie/session、js双重加密、服务器反爬虫封IP等等问题，但是可以当做一次基本练习，爬下来的数据也是很有价值的。更加复杂爬虫的推荐使用scrapy+splash等专业爬虫平台来构建项目。</p><p>talk is cheep，立刻动手，开始编写属于你的爬虫吧~</p><h1><strong>扩展阅读</strong></h1><p>私信“爬取双色球”可以得到以下内容：</p><p>（1）本人博客的<strong>完整版文章链接</strong></p><ul><li>《用Python简单爬取双色球开奖信息》</li><li>《用Python爬取双色球开奖信息（升级版）》</li><li>《5分钟学会利用python库爬取双色球历史数据》</li></ul><p>（2）爬取的结果<strong>lotterydata</strong>、完整的爬取代码<strong>lotteryhistorygrabber</strong></p><hr><h1>交流与福利</h1><p>由于很多小伙伴希望及时交流，我建立了两个交流群，欢迎加入。</p><p>工作日工作繁忙不常在线，我一定尽力及时回复，没有得到回复的小伙伴可以在群里问一问其他的大佬。</p><p>初次建立，长期招募JavaWeb和机器学习方向的大佬管理员~</p><p><strong>选择感兴趣的群加入</strong></p><p>（1）JavaWeb群：747111145</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1539507593601cd7a8e2124><p class=pgc-img-caption></p></div><p>（2）机器学习交流群：779749708</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15395075671712a53d7c9b7><p class=pgc-img-caption></p></div><p><strong>加入群你可以得到什么</strong></p><p>（1）日常关注的福利，比如云服务器打折等活动，我会及时分享</p><p>（2）内推资源福利</p><p>（3）学习资料</p><p>（4）解决实践过程中遇到的困难与疑惑</p><div class=pgc-img><img alt=彩票数据收集！学会利用python库爬取双色球历史数据 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1538637338587f6433a6b05><p class=pgc-img-caption></p></div><p>重大发现！</p><p><strong>关注</strong>三颗豆子分裂中的同学<strong>刚买了彩票就中奖</strong>！</p><p><strong>点赞评论</strong>三颗豆子分裂中文章的同学<strong>刚写完代码就跑通</strong>！</p><p><strong>收藏转发</strong>三颗豆子分裂中文章的同学<strong>刚转身就遇到了真爱</strong>！</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'数据','学会','python'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>