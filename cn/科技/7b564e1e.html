<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Spring bootå­¦ä¹ ï¼ˆå…­ï¼‰Spring bootå®ç°AOPè®°å½•æ“ä½œæ—¥å¿— | æå®¢å¿«è¨Š</title><meta property="og:title" content="Spring bootå­¦ä¹ ï¼ˆå…­ï¼‰Spring bootå®ç°AOPè®°å½•æ“ä½œæ—¥å¿— - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/6824f504d2264a748492cd7ceb6732ba"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7b564e1e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7b564e1e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7b564e1e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7b564e1e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7b564e1e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7b564e1e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7b564e1e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7b564e1e.html><meta property="article:published_time" content="2020-11-14T21:04:30+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:30+08:00"><meta name=Keywords content><meta name=description content="Spring bootå­¦ä¹ ï¼ˆå…­ï¼‰Spring bootå®ç°AOPè®°å½•æ“ä½œæ—¥å¿—"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/7b564e1e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Spring bootå­¦ä¹ ï¼ˆå…­ï¼‰Spring bootå®ç°AOPè®°å½•æ“ä½œæ—¥å¿—</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><p><strong>å‰è¨€</strong></p><p>åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œç‰¹åˆ«æ˜¯ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå¯¹äºé‚£äº›é‡è¦çš„æ“ä½œæˆ‘ä»¬é€šå¸¸éƒ½ä¼šè®°å½•æ“ä½œæ—¥å¿—ã€‚æ¯”å¦‚å¯¹æ•°æ®åº“çš„CRUDæ“ä½œï¼Œæˆ‘ä»¬éƒ½ä¼šå¯¹æ¯ä¸€æ¬¡é‡è¦çš„æ“ä½œè¿›è¡Œè®°å½•ï¼Œé€šå¸¸çš„åšæ³•æ˜¯å‘æ•°æ®åº“æŒ‡å®šçš„æ—¥å¿—è¡¨ä¸­æ’å…¥ä¸€æ¡è®°å½•ã€‚è¿™é‡Œå°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ï¼Œéš¾é“è¦æˆ‘ä»¬æ¯æ¬¡åœ¨ CRUDçš„æ—¶å€™éƒ½æ‰‹åŠ¨çš„æ’å…¥æ—¥å¿—è®°å½•å—ï¼Ÿè¿™è‚¯å®šæ˜¯ä¸åˆé€‚çš„ï¼Œè¿™æ ·çš„æ“ä½œæ— ç–‘æ˜¯åŠ å¤§äº†å¼€å‘é‡ï¼Œè€Œä¸”ä¸æ˜“ç»´æŠ¤ï¼Œæ‰€ä»¥å®é™…é¡¹ç›®ä¸­æ€»æ˜¯åˆ©ç”¨AOP(Aspect Oriented Programming)å³é¢å‘åˆ‡é¢ç¼–ç¨‹è¿™ä¸€æŠ€æœ¯æ¥è®°å½•ç³»ç»Ÿä¸­çš„æ“ä½œæ—¥å¿—ã€‚</p><p><strong>æ—¥å¿—åˆ†ç±»</strong></p><p>è¿™é‡Œæˆ‘æŠŠæ—¥å¿—æŒ‰ç…§é¢å‘çš„å¯¹è±¡ä¸åŒåˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>é¢å‘ç”¨æˆ·çš„æ—¥å¿—ï¼šç”¨æˆ·æ˜¯æŒ‡ä½¿ç”¨ç³»ç»Ÿçš„äººï¼Œè¿™ä¸€ç±»æ—¥å¿—é€šå¸¸è®°å½•åœ¨æ•°æ®åº“é‡Œè¾¹ï¼Œå¹¶ä¸”é€šå¸¸æ˜¯è®°å½•å¯¹æ•°æ®åº“çš„ä¸€äº›CRUDæ“ä½œã€‚</li><li>é¢å‘å¼€å‘è€…çš„æ—¥å¿—ï¼šæŸ¥çœ‹è¿™ä¸€ç±»æ—¥å¿—çš„ä¸€èˆ¬éƒ½æ˜¯å¼€å‘äººå‘˜ï¼Œè¿™ç±»æ—¥å¿—é€šå¸¸ä¿å­˜åœ¨æ–‡ä»¶æˆ–è€…åœ¨æ§åˆ¶å°æ‰“å°ï¼ˆå¼€å‘çš„æ—¶å€™åœ¨æ§åˆ¶å°ï¼Œé¡¹ç›®ä¸Šçº¿ä¹‹åä¹‹åä¿å­˜åœ¨æ–‡ä»¶ä¸­ï¼‰ï¼Œè¿™ä¸€ç±»æ—¥å¿—ä¸»è¦ç”¨äºå¼€å‘è€…å¼€å‘æ—¶æœŸå’ŒåæœŸç»´æŠ¤æ—¶æœŸå®šä½é”™è¯¯ã€‚</li></ul><p>é¢å‘ä¸åŒå¯¹è±¡çš„æ—¥å¿—ï¼Œæˆ‘ä»¬é‡‡ç”¨ä¸åŒçš„ç­–ç•¥å»è®°å½•ã€‚å¾ˆå®¹æ˜“çœ‹å‡ºï¼Œå¯¹äºé¢å‘ç”¨æˆ·çš„æ—¥å¿—å…·æœ‰å¾ˆå¼ºçš„çµæ´»æ€§ï¼Œéœ€è¦å¼€å‘è€…æ§åˆ¶ç”¨æˆ·çš„å“ªäº›æ“ä½œéœ€è¦å‘æ•°æ®åº“è®°å½•æ—¥å¿—ï¼Œæ‰€ä»¥è¿™ä¸€ç±»ä¿å­˜åœ¨æ•°æ®åº“çš„æ—¥å¿—æˆ‘ä»¬åœ¨ä½¿ç”¨ AOPè®°å½•æ—¶ç”¨è‡ªå®šä¹‰æ³¨è§£çš„æ–¹å¼å»åŒ¹é…ï¼›è€Œé¢å‘å¼€å‘è€…çš„æ—¥å¿—æˆ‘ä»¬åˆ™ä½¿ç”¨è¡¨è¾¾å¼å»åŒ¹é…å°±å¯ä»¥äº†ï¼ˆè¿™é‡Œæœ‰å¯èƒ½å™è¿°çš„æœ‰ç‚¹æ¨¡ç³Šï¼Œçœ‹äº†ä¸‹é¢å»æ¡ˆä¾‹å°†ä¼šå¾ˆæ¸…æ™°ï¼‰ï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸¤ç§æ—¥å¿—çš„å®ç°ã€‚</p><p><strong>å®ç°AOPè®°å½•é¢å‘ç”¨æˆ·çš„æ—¥å¿—</strong></p><p>æ¥ä¸‹æ¥åˆ†æ­¥éª¤ä»‹ç»Spring bootä¸­æ€æ ·å®ç°é€šè¿‡AOPè®°å½•æ“ä½œæ—¥å¿—ã€‚</p><p><strong>æ·»åŠ ä¾èµ–</strong></p><p>åœ¨pom.xmlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š</p><p>&lt;!-- aopä¾èµ– --></p><p>&lt;dependency></p><p>&lt;groupId>org.springframework.boot&lt;/groupId></p><p>&lt;artifactId>spring-boot-starter-aop&lt;/artifactId></p><p>&lt;/dependency></p><p><strong>ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p><p>åœ¨é¡¹ç›®çš„application.propertiesæ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢ä¸€å¥é…ç½®ï¼š</p><p>spring.aop.auto=true</p><blockquote>è¿™é‡Œç‰¹åˆ«è¯´æ˜ä¸‹ï¼Œè¿™å¥è¯ä¸åŠ å…¶å®ä¹Ÿå¯ä»¥ï¼Œå› ä¸ºé»˜è®¤å°±æ˜¯trueï¼Œåªè¦æˆ‘ä»¬åœ¨pom.xmlä¸­æ·»åŠ äº†ä¾èµ–å°±å¯ä»¥äº†ï¼Œè¿™é‡Œæå‡ºæ¥æ˜¯è®©å¤§å®¶çŸ¥é“æœ‰è¿™ä¸ªæœ‰è¿™ä¸ªé…ç½®ã€‚</blockquote><p><strong>è‡ªå®šä¹‰æ³¨è§£</strong></p><p>ä¸Šè¾¹ä»‹ç»è¿‡äº†äº†ï¼Œå› ä¸ºè¿™ç±»æ—¥å¿—æ¯”è¾ƒçµæ´»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Œä½¿ç”¨çš„æ—¶å€™åœ¨éœ€è¦è®°å½•æ—¥å¿—çš„æ–¹æ³•ä¸Šæ·»åŠ è¿™ä¸ªæ³¨è§£å°±å¯ä»¥äº†ï¼Œé¦–å…ˆåœ¨å¯åŠ¨ç±»çš„åŒçº§åŒ…ä¸‹è¾¹æ–°å»ºä¸€ä¸ªconfigåŒ…ï¼Œåœ¨è¿™ä¸ªæŠ¥ä¸‹è¾¹æ–°å»ºnewä¸€ä¸ªåä¸ºLogçš„Annotationæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><p>package com.web.springbootaoplog.config;</p><p>import java.lang.annotation.ElementType;</p><p>import java.lang.annotation.Retention;</p><p>import java.lang.annotation.RetentionPolicy;</p><p>import java.lang.annotation.Target;</p><p>/**</p><p>* @author Promise</p><p>* @createTime 2018å¹´12æœˆ18æ—¥ ä¸‹åˆ9:26:25</p><p>* @description å®šä¹‰ä¸€ä¸ªæ–¹æ³•çº§åˆ«çš„@logæ³¨è§£</p><p>*/</p><p>@Target(ElementType.METHOD)</p><p>@Retention(RetentionPolicy.RUNTIME)</p><p>public @interface Log {</p><p>String value() default "";</p><p>}</p><p>å‡†å¤‡æ•°æ®åº“æ—¥å¿—è¡¨ä»¥åŠå®ä½“ç±»ï¼Œsqlæ¥å£ï¼Œxmlæ–‡ä»¶</p><p>æ—¢ç„¶æ˜¯å‘æ•°æ®åº“ä¸­æ’å…¥è®°å½•ï¼Œé‚£ä¹ˆå‰ææ˜¯éœ€è¦åˆ›å»ºä¸€å¼ è®°å½•æ—¥å¿—çš„è¡¨ï¼Œä¸‹é¢ç»™å‡ºæˆ‘çš„è¡¨sql,ç”±äºæ˜¯å†™æ ·ä¾‹ï¼Œæˆ‘è¿™é‡Œè¿™å¼ è¡¨è®¾è®¡çš„å¾ˆç®€å•ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œè®¾è®¡ã€‚</p><p>CREATE TABLE `sys_log` (</p><p>`id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®',</p><p>`user_id` int(11) NOT NULL COMMENT 'æ“ä½œå‘˜id',</p><p>`user_action` varchar(255) NOT NULL COMMENT 'ç”¨æˆ·æ“ä½œ',</p><p>`create_time` datetime DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',</p><p>PRIMARY KEY (`id`)</p><p>) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8 COMMENT='æ—¥å¿—è®°å½•è¡¨';</p><p>å½“ç„¶è¿˜éœ€è¦åˆ›å»ºserviceæ¥å£æ–‡ä»¶ä»¥åŠæ¥å£å®ç°ç±»ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºä»£ç ï¼š</p><p><strong>ISysLogServcie.java</strong></p><p>package com.web.springbootaoplog.service;</p><p>import com.web.springbootaoplog.entity.SysLog;</p><p>/**</p><p>* @author Promise</p><p>* @createTime 2018å¹´12æœˆ18æ—¥ ä¸‹åˆ9:29:48</p><p>* @description æ—¥å¿—æ¥å£</p><p>*/</p><p>public interface ISysLogService {</p><p>/**</p><p>* æ’å…¥æ—¥å¿—</p><p>* @param entity</p><p>* @return</p><p>*/</p><p>int insertLog(SysLog entity);</p><p>}</p><p><strong>SysLogServiceImpl.java</strong></p><p>package com.web.springbootaoplog.service.impl;</p><p>import org.springframework.beans.factory.annotation.Autowired;</p><p>import org.springframework.stereotype.Service;</p><p>import com.web.springbootaoplog.config.Log;</p><p>import com.web.springbootaoplog.dao.SysLogMapper;</p><p>import com.web.springbootaoplog.entity.SysLog;</p><p>import com.web.springbootaoplog.service.ISysLogService;</p><p>/**</p><p>* @author Promise</p><p>* @createTime 2018å¹´12æœˆ18æ—¥ ä¸‹åˆ9:30:57</p><p>* @description</p><p>*/</p><p>@Service("sysLogService")</p><p>public class SysLogServiceImpl implements ISysLogService{</p><p>@Autowired</p><p>private SysLogMapper sysLogMapper;</p><p>@Override</p><p>public int insertLog(SysLog entity) {</p><p>// TODO Auto-generated method stub</p><p>return sysLogMapper.insert(entity);</p><p>}</p><p>}</p><p><strong>AOPçš„åˆ‡é¢å’Œåˆ‡ç‚¹</strong></p><p>å‡†å¤‡ä¸Šè¾¹çš„ç›¸å…³æ–‡ä»¶åï¼Œä¸‹é¢æ¥ä»‹ç»é‡ç‚¹--åˆ›å»ºAOPåˆ‡é¢å®ç°ç±»ï¼ŒåŒæ ·æˆ‘ä»¬è¿™é‡Œå°†è¯¥ç±»æ”¾åœ¨configåŒ…ä¸‹ï¼Œå‘½åä¸ºLogAsPect.java,å†…å®¹å¦‚ä¸‹ï¼š</p><p>package com.web.springbootaoplog.config;</p><p>import java.lang.reflect.Method;</p><p>import java.util.Arrays;</p><p>import java.util.Date;</p><p>import org.aspectj.lang.JoinPoint;</p><p>import org.aspectj.lang.ProceedingJoinPoint;</p><p>import org.aspectj.lang.annotation.Around;</p><p>import org.aspectj.lang.annotation.Aspect;</p><p>import org.aspectj.lang.annotation.Before;</p><p>import org.aspectj.lang.annotation.Pointcut;</p><p>import org.aspectj.lang.reflect.MethodSignature;</p><p>import org.hibernate.validator.internal.util.logging.LoggerFactory;</p><p>import org.slf4j.Logger;</p><p>import org.springframework.beans.factory.annotation.Autowired;</p><p>import org.springframework.core.LocalVariableTableParameterNameDiscoverer;</p><p>import org.springframework.stereotype.Component;</p><p>import com.web.springbootaoplog.entity.SysLog;</p><p>import com.web.springbootaoplog.service.ISysLogService;</p><p>/**</p><p>* @author Promise</p><p>* @createTime 2018å¹´12æœˆ18æ—¥ ä¸‹åˆ9:33:28</p><p>* @description åˆ‡é¢æ—¥å¿—é…ç½®</p><p>*/</p><p>@Aspect</p><p>@Component</p><p>public class LogAsPect {</p><p>private final static Logger log = org.slf4j.LoggerFactory.getLogger(LogAsPect.class);</p><p>@Autowired</p><p>private ISysLogService sysLogService;</p><p>//è¡¨ç¤ºåŒ¹é…å¸¦æœ‰è‡ªå®šä¹‰æ³¨è§£çš„æ–¹æ³•</p><p>@Pointcut("@annotation(com.web.springbootaoplog.config.Log)")</p><p>public void pointcut() {}</p><p>@Around("pointcut()")</p><p>public Object around(ProceedingJoinPoint point) {</p><p>Object result =null;</p><p>long beginTime = System.currentTimeMillis();</p><p>try {</p><p>log.info("æˆ‘åœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰æ‰§è¡Œï¼");</p><p>result = point.proceed();</p><p>long endTime = System.currentTimeMillis();</p><p>insertLog(point,endTime-beginTime);</p><p>} catch (Throwable e) {</p><p>// TODO Auto-generated catch block</p><p>}</p><p>return result;</p><p>}</p><p>private void insertLog(ProceedingJoinPoint point ,long time) {</p><p>MethodSignature signature = (MethodSignature)point.getSignature();</p><p>Method method = signature.getMethod();</p><p>SysLog sys_log = new SysLog();</p><p>Log userAction = method.getAnnotation(Log.class);</p><p>if (userAction != null) {</p><p>// æ³¨è§£ä¸Šçš„æè¿°</p><p>sys_log.setUserAction(userAction.value());</p><p>}</p><p>// è¯·æ±‚çš„ç±»å</p><p>String className = point.getTarget().getClass().getName();</p><p>// è¯·æ±‚çš„æ–¹æ³•å</p><p>String methodName = signature.getName();</p><p>// è¯·æ±‚çš„æ–¹æ³•å‚æ•°å€¼</p><p>String args = Arrays.toString(point.getArgs());</p><p>//ä»sessionä¸­è·å–å½“å‰ç™»é™†äººid</p><p>// Long useride = (Long)SecurityUtils.getSubject().getSession().getAttribute("userid");</p><p>Long userid = 1L;//åº”è¯¥ä»sessionä¸­è·å–å½“å‰ç™»å½•äººçš„idï¼Œè¿™é‡Œç®€å•æ¨¡æ‹Ÿä¸‹</p><p>sys_log.setUserId(userid);</p><p>sys_log.setCreateTime(new java.sql.Timestamp(new Date().getTime()));</p><p>log.info("å½“å‰ç™»é™†äººï¼š{},ç±»å:{},æ–¹æ³•å:{},å‚æ•°ï¼š{},æ‰§è¡Œæ—¶é—´ï¼š{}",userid, className, methodName, args, time);</p><p>sysLogService.insertLog(sys_log);</p><p>}</p><p>}</p><p>è¿™é‡Œç®€å•ä»‹ç»ä¸‹å…³äºAOPçš„å‡ ä¸ªé‡è¦æ³¨è§£ï¼š</p><ul><li>@Aspect:è¿™ä¸ªæ³¨è§£è¡¨ç¤ºå°†å½“å‰ç±»è§†ä¸ºä¸€ä¸ªåˆ‡é¢ç±»</li><li>@Componentï¼šè¡¨ç¤ºå°†å½“å‰ç±»äº¤ç”±Springç®¡ç†ã€‚</li><li>@Pointcut:åˆ‡ç‚¹è¡¨è¾¾å¼,å®šä¹‰æˆ‘ä»¬çš„åŒ¹é…è§„åˆ™ï¼Œä¸Šè¾¹æˆ‘ä»¬ä½¿ç”¨@Pointcut("@annotation(com.web.springbootaoplog.config.Log)")è¡¨ç¤ºåŒ¹é…å¸¦æœ‰æˆ‘ä»¬è‡ªå®šä¹‰æ³¨è§£çš„æ–¹æ³•ã€‚</li><li>@Around:ç¯ç»•é€šçŸ¥ï¼Œå¯ä»¥åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åæ‰§è¡Œä¸€äº›æ“ä½œï¼Œä»¥åŠç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶æ‰§è¡Œçš„æ“ä½œã€‚</li></ul><p>ä¸‹é¢çœ‹ä¸€æ®µå…³é”®çš„ä»£ç ï¼š</p><p>log.info("æˆ‘åœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰æ‰§è¡Œï¼");</p><p>result = point.proceed();</p><p>long endTime = System.currentTimeMillis();</p><p>insertLog(point,endTime-beginTime);</p><p>å…¶ä¸­result = point.proceed();è¿™å¥è¯è¡¨ç¤ºæ‰§è¡Œç›®æ ‡æ–¹æ³•,å¯ä»¥çœ‹å‡ºæˆ‘ä»¬åœ¨è¿™æ®µä»£ç æ‰§è¡Œä¹‹å‰æ‰“å°äº†ä¸€å¥æ—¥å¿—ï¼Œå¹¶åœ¨æ‰§è¡Œä¹‹åè°ƒç”¨äº†insertLog()æ’å…¥æ—¥å¿—çš„æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨æ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥æ‹¿åˆ°ç›®æ ‡æ–¹æ³•æ‰€åœ¨çš„ç±»åï¼Œæ–¹æ³•åï¼Œå‚æ•°ç­‰é‡è¦çš„ä¿¡æ¯ã€‚</p><p><strong>æµ‹è¯•æ§åˆ¶å™¨</strong></p><p>åœ¨controlleråŒ…ä¸‹æ–°å»ºä¸€ä¸ªHomeCOntroller.java(åå­—å¤§å®¶éšæ„),å†…å®¹å¦‚ä¸‹ï¼š</p><p>package com.web.springbootaoplog.controller;</p><p>import java.util.HashMap;</p><p>import java.util.Map;</p><p>import org.springframework.beans.factory.annotation.Autowired;</p><p>import org.springframework.stereotype.Controller;</p><p>import org.springframework.web.bind.annotation.RequestBody;</p><p>import org.springframework.web.bind.annotation.RequestMapping;</p><p>import org.springframework.web.bind.annotation.RequestMethod;</p><p>import org.springframework.web.bind.annotation.ResponseBody;</p><p>import com.web.springbootaoplog.config.Log;</p><p>import com.web.springbootaoplog.entity.SysLog;</p><p>import com.web.springbootaoplog.service.ISysLogService;</p><p>/**</p><p>* @author Promise</p><p>* @createTime 2019å¹´1æœˆ2æ—¥ ä¸‹åˆ10:35:30</p><p>* @description æµ‹è¯•controller</p><p>*/</p><p>@Controller</p><p>public class HomeController {</p><p>private final static Logger log = org.slf4j.LoggerFactory.getLogger(HomeController.class);</p><p>@Autowired</p><p>private ISysLogService logService;</p><p>@RequestMapping("/aop")</p><p>@ResponseBody</p><p>@Log("æµ‹è¯•aoplog")</p><p>public Object aop(String name, String nick) {</p><p>Map&lt;String, Object> map =new HashMap&lt;>();</p><p>log.info("æˆ‘è¢«æ‰§è¡Œäº†ï¼");</p><p>map.put("res", "ok");</p><p>return map;</p><p>}</p><p>}</p><p>å®šä¹‰ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ï¼Œå¸¦æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå¹¶ä¸”ä¸ºè¯¥æ–¹æ³•æ·»åŠ äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„@Logæ³¨è§£ï¼Œå¯åŠ¨é¡¹ç›®ï¼Œæµè§ˆå™¨è®¿é—®localhost:8080/aop?name=xfr&nick=eran,è¿™æ—¶å€™æŸ¥çœ‹eclipseæ§åˆ¶å°çš„éƒ¨åˆ†è¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š</p><p>2019-01-24 22:02:17.682 INFO 3832 --- [nio-8080-exec-1] c.web.springbootaoplog.config.LogAsPect : æˆ‘åœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰æ‰§è¡Œï¼</p><p>2019-01-24 22:02:17.688 INFO 3832 --- [nio-8080-exec-1] c.w.s.controller.HomeController : æˆ‘è¢«æ‰§è¡Œäº†ï¼</p><p>2019-01-24 22:02:17.689 INFO 3832 --- [nio-8080-exec-1] c.web.springbootaoplog.config.LogAsPect : å½“å‰ç™»é™†äººï¼š1,ç±»å:com.web.springbootaoplog.controller.HomeController,æ–¹æ³•å:aop,å‚æ•°ï¼š[xfr, eran],æ‰§è¡Œæ—¶é—´ï¼š6</p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åæ’å…¥äº†ä¸€äº›é€»è¾‘ä»£ç ï¼Œç°åœ¨å†çœ‹æ•°æ®åº“é‡Œè¾¹çš„æ•°æ®ï¼š</p><div class=pgc-img><img alt="Spring bootå­¦ä¹ ï¼ˆå…­ï¼‰Spring bootå®ç°AOPè®°å½•æ“ä½œæ—¥å¿—" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6824f504d2264a748492cd7ceb6732ba></div><p>æˆåŠŸè®°å½•äº†ä¸€æ¡æ•°æ®ã€‚</p><p><strong>å®ç°AOPè®°å½•é¢å‘å¼€å‘è€…çš„æ—¥å¿—</strong></p><p>é¦–å…ˆè¿™é‡Œæˆ‘åˆ—ä¸¾ä¸€ä¸ªä½¿ç”¨è¯¥æ–¹å¼çš„åº”ç”¨åœºæ™¯ï¼Œåœ¨é¡¹ç›®ä¸­å‡ºç°äº†bugï¼Œæˆ‘ä»¬æƒ³è¦çŸ¥é“å‰å°çš„è¯·æ±‚æ˜¯å¦è¿›å…¥äº†æˆ‘ä»¬æ§åˆ¶å™¨ä¸­ï¼Œä»¥åŠå‚æ•°çš„è·å–æƒ…å†µï¼Œä¸‹é¢å¼€å§‹ä»‹ç»å®ç°æ­¥éª¤ã€‚</p><p>å…¶å®åŸç†è·Ÿä¸Šè¾¹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯åˆ‡ç‚¹çš„åŒ¹é…è§„åˆ™å˜äº†è€Œå·²ï¼Œè€Œä¸”ä¸ç”¨å°†æ—¥å¿—è®°å½•åˆ°æ•°æ®åº“ï¼Œæ‰“å°å‡ºæ¥å³å¯ã€‚</p><p>é¦–å…ˆåœ¨LogAsPect.javaä¸­å®šä¹‰ä¸€ä¸ªæ–°çš„åˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œå¦‚ä¸‹ï¼š</p><p>@Pointcut("execution(public * com.web.springbootaoplog.controller..*.*(..))")</p><p>public void pointcutController() {}</p><p>@Pointcut("execution(public * com.web.springbootaoplog.controller..*.*(..))")è¡¨ç¤ºåŒ¹é…com.web.springbootaoplog.controlleråŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰å…¬æœ‰æ–¹æ³•ã€‚</p><p>å†æ·»åŠ åŒ¹é…åˆ°æ–¹æ³•æ—¶æˆ‘ä»¬è¦åšçš„æ“ä½œï¼š</p><p>@Before("pointcutController()")</p><p>public void around2(JoinPoint point) {</p><p>//è·å–ç›®æ ‡æ–¹æ³•</p><p>String methodNam = point.getSignature().getDeclaringTypeName() + "." + point.getSignature().getName();</p><p>//è·å–æ–¹æ³•å‚æ•°</p><p>String params = Arrays.toString(point.getArgs());</p><p>log.info("get in {} params :{}",methodNam,params);</p><p>}</p><p>@Before:è¡¨ç¤ºç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œä»¥ä¸‹æ–¹æ³•ä½“çš„å†…å®¹ã€‚</p><p>å†åœ¨æ§åˆ¶å™¨ä¸­æ·»åŠ ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ï¼š</p><p>@RequestMapping("/testaop3")</p><p>@ResponseBody</p><p>public Object testAop3(String name, String nick) {</p><p>Map&lt;String, Object> map = new HashMap&lt;>();</p><p>map.put("res", "ok");</p><p>return map;</p><p>}</p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬å¹¶æ²¡æœ‰åŠ ä¸Š@Logæ³¨è§£ï¼Œé‡å¯é¡¹ç›®ï¼Œæµè§ˆå™¨è®¿é—®localhost:8080/testaop3?name=xfr&nick=eran,è¿™æ—¶å€™æŸ¥çœ‹eclipseæ§åˆ¶å°çš„éƒ¨åˆ†è¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š</p><p>2019-01-24 23:19:49.108 INFO 884 --- [nio-8080-exec-1] c.web.springbootaoplog.config.LogAsPect : get in com.web.springbootaoplog.controller.HomeController.testAop3 params :[xfr, eran]</p><p>æ‰“å°å‡ºäº†å…³é”®æ—¥å¿—ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½çŸ¥é“æ˜¯ä¸æ˜¯è¿›å…¥äº†è¯¥æ–¹æ³•ï¼Œå‚æ•°è·å–æ˜¯å¦æ­£ç¡®ç­‰å…³é”®ä¿¡æ¯ã€‚</p><p>è¿™é‡Œæœ‰çš„æœ‹å‹æˆ–è®¸ä¼šæœ‰ç–‘é—®è¿™æ ·ä¼šä¸ä¼šä¸æ·»åŠ äº†@Logçš„æ–¹æ³•é‡å¤äº†å‘¢ï¼Œçš„ç¡®ä¼šï¼Œæ‰€ä»¥åœ¨é¡¹ç›®ä¸­æˆ‘é€šå¸¸éƒ½å°†@Logæ³¨è§£ç”¨åœ¨äº†Serviceå±‚çš„æ–¹æ³•ä¸Šï¼Œè¿™æ ·ä¹Ÿæ›´åŠ åˆç†ã€‚</p><p><strong>ç»“è¯­</strong></p><p>å¥½äº†ï¼Œå…³äºAopè®°å½•æ—¥å¿—çš„å†…å®¹å°±ä»‹ç»è¿™ä¹ˆå¤šäº†ï¼Œä¸‹ä¸€ç¯‡å†è§ã€‚bye~</p><div class=pgc-img><img alt="Spring bootå­¦ä¹ ï¼ˆå…­ï¼‰Spring bootå®ç°AOPè®°å½•æ“ä½œæ—¥å¿—" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/1f93e24e-004b-4597-9210-22c95dd7263f></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Spring','boot','å­¦ä¹ '</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>