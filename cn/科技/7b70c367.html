<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ä»£ç è§„èŒƒâ€”ä½¿ç”¨ TypeScript è£…é¥°å™¨ | æå®¢å¿«è¨Š</title><meta property="og:title" content="ä»£ç è§„èŒƒâ€”ä½¿ç”¨ TypeScript è£…é¥°å™¨ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/dfic-imagehandler/4b5097e2-c4fd-4d37-9c54-707760739775"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7b70c367.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7b70c367.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7b70c367.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7b70c367.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7b70c367.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7b70c367.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7b70c367.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7b70c367.html><meta property="article:published_time" content="2020-11-14T21:04:30+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:30+08:00"><meta name=Keywords content><meta name=description content="ä»£ç è§„èŒƒâ€”ä½¿ç”¨ TypeScript è£…é¥°å™¨"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/7b70c367.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ä»£ç è§„èŒƒâ€”ä½¿ç”¨ TypeScript è£…é¥°å™¨</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>è£…é¥°å™¨è®©ç¨‹åºå‘˜å¯ä»¥ç¼–å†™å…ƒä¿¡æ¯ä»¥å†…çœä»£ç ã€‚è£…é¥°å™¨çš„æœ€ä½³ä½¿ç”¨åœºæ™¯æ˜¯æ¨ªåˆ‡å…³æ³¨ç‚¹â€”â€”é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚<br></p><blockquote><p><strong>é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰</strong> æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒå…è®¸æˆ‘ä»¬åˆ†ç¦»æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œå€Ÿæ­¤è¾¾åˆ°å¢åŠ æ¨¡å—åŒ–ç¨‹åº¦çš„ç›®æ ‡ã€‚å®ƒå¯ä»¥åœ¨ä¸ä¿®æ”¹ä»£ç è‡ªèº«çš„å‰æä¸‹ï¼Œç»™å·²æœ‰ä»£ç å¢åŠ é¢å¤–çš„è¡Œä¸ºï¼ˆé€šçŸ¥ï¼‰ã€‚</p></blockquote><pre>@log// ç±»è£…é¥°å™¨classPerson { constructor(private firstName: string, private lastName: string) {}@log// æ–¹æ³•è£…é¥°å™¨ getFullName() {return`${this.firstName} ${this.lastName}`; }}const person = newPerson('Mohan', 'Ram');person.getFullName();</pre><p>ä¸Šé¢çš„ä»£ç å±•ç¤ºäº†è£…é¥°å™¨å¤šä¹ˆå…·æœ‰å£°æ˜æ€§ã€‚ä¸‹é¢æˆ‘ä»¬å°†ä»‹ç»è£…é¥°å™¨çš„ç»†èŠ‚ï¼š</p><ol start=1><li>ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿå®ƒçš„ç›®çš„å’Œç±»å‹</li><li>è£…é¥°å™¨çš„ç­¾å</li><li>æ–¹æ³•è£…é¥°å™¨</li><li>å±æ€§è£…é¥°å™¨</li><li>å‚æ•°è£…é¥°å™¨</li><li>è®¿é—®å™¨è£…é¥°å™¨</li><li>ç±»è£…é¥°å™¨</li><li>è£…é¥°å™¨å·¥å‚</li><li>å…ƒä¿¡æ¯åå°„ API</li><li>ç»“è¯­</li></ol><p>ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿå®ƒçš„ç›®çš„å’Œç±»å‹</p><blockquote><p>è£…é¥°å™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„å£°æ˜ï¼Œå¯é™„åŠ åœ¨ç±»ã€æ–¹æ³•ã€è®¿é—®å™¨ã€å±æ€§ã€å‚æ•°å£°æ˜ä¸Šã€‚</p></blockquote><p>è£…é¥°å™¨ä½¿ç”¨ @expression çš„å½¢å¼ï¼Œå…¶ä¸­ expression å¿…é¡»èƒ½å¤Ÿæ¼”ç®—ä¸ºåœ¨è¿è¡Œæ—¶è°ƒç”¨çš„å‡½æ•°ï¼Œå…¶ä¸­åŒ…æ‹¬è£…é¥°å£°æ˜ä¿¡æ¯ã€‚</p><p>å®ƒèµ·åˆ°äº†ä»¥å£°æ˜å¼æ–¹æ³•å°†å…ƒä¿¡æ¯æ·»åŠ è‡³å·²æœ‰ä»£ç çš„ä½œç”¨ã€‚</p><p>è£…é¥°å™¨ç±»å‹åŠå…¶æ‰§è¡Œä¼˜å…ˆçº§ä¸º</p><ol start=1><li>ç±»è£…é¥°å™¨â€”â€”ä¼˜å…ˆçº§ 4 ï¼ˆå¯¹è±¡å®ä¾‹åŒ–ï¼Œé™æ€ï¼‰</li><li>æ–¹æ³•è£…é¥°å™¨â€”â€”ä¼˜å…ˆçº§ 2 ï¼ˆå¯¹è±¡å®ä¾‹åŒ–ï¼Œé™æ€ï¼‰</li><li>è®¿é—®å™¨æˆ–å±æ€§è£…é¥°å™¨â€”â€”ä¼˜å…ˆçº§ 3 ï¼ˆå¯¹è±¡å®ä¾‹åŒ–ï¼Œé™æ€ï¼‰</li><li>å‚æ•°è£…é¥°å™¨â€”â€”ä¼˜å…ˆçº§ 1 ï¼ˆå¯¹è±¡å®ä¾‹åŒ–ï¼Œé™æ€ï¼‰</li></ol><p>æ³¨æ„ï¼Œå¦‚æœè£…é¥°å™¨åº”ç”¨äºç±»æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œé‚£ä¹ˆä¸åŒè£…é¥°å™¨çš„ä¼˜å…ˆçº§ä¸ºï¼š1. å‚æ•°è£…é¥°å™¨ï¼Œ2. æ–¹æ³•è£…é¥°å™¨ï¼Œ3. è®¿é—®å™¨æˆ–å‚æ•°è£…é¥°å™¨ï¼Œ4. æ„é€ å™¨å‚æ•°è£…é¥°å™¨ï¼Œ5. ç±»è£…é¥°å™¨ã€‚</p><pre>// è¿™æ˜¯ä¸€ä¸ªè£…é¥°å™¨å·¥å‚â€”â€”æœ‰åŠ©äºå°†ç”¨æˆ·å‚æ•°ä¼ ç»™è£…é¥°å™¨å£°æ˜function f() { console.log("f(): evaluated");returnfunction (target, propertyKey: string, descriptor: PropertyDescriptor) { console.log("f(): called"); }}function g() { console.log("g(): evaluated");returnfunction (target, propertyKey: string, descriptor: PropertyDescriptor) { console.log("g(): called"); }}class C {@f()@g() method() {}}// f(): evaluated// g(): evaluated// g(): called// f(): called</pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œä¸Šé¢çš„ä»£ç ä¸­ï¼Œ f å’Œ g è¿”å›äº†å¦ä¸€ä¸ªå‡½æ•°ï¼ˆè£…é¥°å™¨å‡½æ•°ï¼‰ã€‚f å’Œ g ç§°ä¸ºè£…é¥°å™¨å·¥å‚ã€‚</p><blockquote><p><strong>è£…é¥°å™¨å·¥å‚</strong> å¸®åŠ©ç”¨æˆ·ä¼ é€’å¯ä¾›è£…é¥°å™¨åˆ©ç”¨çš„å‚æ•°ã€‚</p></blockquote><p>æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼Œ<strong>æ¼”ç®—é¡ºåº</strong>ä¸º<strong>ç”±é¡¶å‘ä¸‹</strong>ï¼Œ<strong>æ‰§è¡Œé¡ºåº</strong>ä¸º<strong>ç”±åº•å‘ä¸Š</strong>ã€‚</p><p>è£…é¥°å™¨çš„ç­¾å</p><pre>declare type ClassDecorator = &lt;TFunctionextendsFunction&gt;(target: TFunction) =&gt; TFunction | void;declare type PropertyDecorator = (target: Object, propertyKey: string | symbol) =&gt; void;declare type MethodDecorator = &lt;T&gt;( target: Object, propertyKey: string | symbol, descriptor: TypedPropertyDescriptor&lt;T&gt;) =&gt;TypedPropertyDescriptor&lt;T&gt; | void;</pre><p>æ–¹æ³•è£…é¥°å™¨</p><p>ä»ä¸Šé¢çš„ç­¾åä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–¹æ³•è£…é¥°å™¨å‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼š</p><ol start=1><li><strong>target</strong> â€”â€” å½“å‰å¯¹è±¡çš„åŸå‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‡è®¾ Employee æ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆ target å°±æ˜¯ Employee.prototype</li><li><strong>propertyKey</strong> â€”â€” æ–¹æ³•çš„åç§°</li><li><strong>descriptor</strong> â€”â€” æ–¹æ³•çš„å±æ€§æè¿°ç¬¦ï¼Œå³ Object.getOwnPropertyDescriptor(Employee.prototype,propertyKey)</li></ol><pre>exportfunction logMethod( target: Object, propertyName: string, propertyDescriptor: PropertyDescriptor): PropertyDescriptor {// target === Employee.prototype// propertyName === "greet"// propertyDesciptor === Object.getOwnPropertyDescriptor(Employee.prototype, "greet")const method = propertyDesciptor.value; propertyDesciptor.value = function (...args: any[]) {// å°† greet çš„å‚æ•°åˆ—è¡¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²constparams = args.map(a =&gt; JSON.stringify(a)).join();// è°ƒç”¨ greet() å¹¶è·å–å…¶è¿”å›å€¼const result = method.apply(this, args);// è½¬æ¢ç»“å°¾ä¸ºå­—ç¬¦ä¸²const r = JSON.stringify(result);// åœ¨ç»ˆç«¯æ˜¾ç¤ºå‡½æ•°è°ƒç”¨ç»†èŠ‚ console.log(`Call: ${propertyName}(${params}) =&gt; ${r}`);// è¿”å›è°ƒç”¨å‡½æ•°çš„ç»“æœreturn result; }return propertyDesciptor;};classEmployee { constructor(private firstName: string, private lastName: string ) {}@logMethod greet(message: string): string {return`${this.firstName} ${this.lastName} says: ${message}`; }}const emp = newEmployee('Mohan Ram', 'Ratnakumar');emp.greet('hello');</pre><p>ä¸Šé¢çš„ä»£ç åº”è¯¥ç®—æ˜¯è‡ªè§£é‡Šçš„â€”â€”è®©æˆ‘ä»¬çœ‹çœ‹ç¼–è¯‘åçš„ JavaScript æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p><pre>"use strict";var __decorate = (this &amp;&amp; this.__decorate) ||function (decorators, target, key, desc) {// å‡½æ•°å‚æ•°é•¿åº¦var c = arguments.length/** * å¤„ç†ç»“æœ * å¦‚æœä»…ä»…ä¼ å…¥äº†è£…é¥°å™¨æ•°ç»„å’Œç›®æ ‡ï¼Œé‚£ä¹ˆåº”è¯¥æ˜¯ä¸ªç±»è£…é¥°å™¨ã€‚ * å¦åˆ™ï¼Œå¦‚æœæè¿°ç¬¦ï¼ˆç¬¬ 4 ä¸ªå‚æ•°ï¼‰ä¸º nullï¼Œå°±æ ¹æ®å·²çŸ¥å€¼å‡†å¤‡å±æ€§æè¿°ç¬¦ï¼Œ * åä¹‹åˆ™ä½¿ç”¨åŒä¸€æè¿°ç¬¦ã€‚ */var r = c &lt; 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc;// å£°æ˜å­˜å‚¨è£…é¥°å™¨çš„å˜é‡var d;// å¦‚æœåŸç”Ÿåå°„å¯ç”¨ï¼Œä½¿ç”¨åŸç”Ÿåå°„è§¦å‘è£…é¥°å™¨if (typeofReflect === "object" &amp;&amp; typeofReflect.decorate === "function") { r = Reflect.decorate(decorators, target, key, desc) }else {// è‡ªå³å‘å·¦è¿­ä»£è£…é¥°å™¨for (var i = decorators.length - 1; i &gt;= 0; i--) {// å¦‚æœè£…é¥°å™¨åˆæ³•ï¼Œå°†å…¶èµ‹å€¼ç»™ dif (d = decorators[i]) {/** * å¦‚æœä»…ä»…ä¼ å…¥äº†è£…é¥°å™¨æ•°ç»„å’Œç›®æ ‡ï¼Œé‚£ä¹ˆåº”è¯¥æ˜¯ç±»è£…é¥°å™¨ï¼Œ * ä¼ å…¥ç›®æ ‡è°ƒç”¨è£…é¥°å™¨ã€‚ * å¦åˆ™ï¼Œå¦‚æœ 4 ä¸ªå‚æ•°ä¿±å…¨ï¼Œé‚£ä¹ˆåº”è¯¥æ˜¯æ–¹æ³•è£…é¥°å™¨ï¼Œ * æ®æ­¤è¿›è¡Œè°ƒç”¨ã€‚ * åä¹‹åˆ™ä½¿ç”¨åŒä¸€æè¿°ç¬¦ã€‚ * å¦‚æœä¼ å…¥äº† 3 ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆåº”è¯¥æ˜¯å±æ€§è£…é¥°å™¨ï¼Œå¯è¿›è¡Œç›¸åº”çš„è°ƒç”¨ã€‚ * å¦‚æœä»¥ä¸Šæ¡ä»¶çš†ä¸æ»¡è¶³ï¼Œè¿”å›å¤„ç†çš„ç»“æœã€‚ */ r = (c &lt; 3 ? d(r) : c &gt; 3 ? d(target, key, r) : d(target, key)) || r } } };/** * ç”±äºåªæœ‰æ–¹æ³•è£…é¥°å™¨éœ€è¦æ ¹æ®åº”ç”¨è£…é¥°å™¨çš„ç»“æœä¿®æ­£å…¶å±æ€§ï¼Œ * æ‰€ä»¥æœ€åè¿”å›å¤„ç†å¥½çš„ r */return c &gt; 3 &amp;&amp; r &amp;&amp; Object.defineProperty(target, key, r), r; };varEmployee = /** @class */ (function () {functionEmployee(firstName, lastName) {this.firstName = firstName;this.lastName = lastName; }Employee.prototype.greet = function (message) {returnthis.firstName + " " + this.lastName + " says: " + message; };// typescript è°ƒç”¨ `__decorate` è¾…åŠ©å‡½æ•°ï¼Œ// ä»¥ä¾¿åœ¨å¯¹è±¡åŸå‹ä¸Šåº”ç”¨è£…é¥°å™¨ __decorate([ logMethod ], Employee.prototype, "greet");returnEmployee;}());var emp = newEmployee('Mohan Ram', 'Ratnakumar');emp.greet('hello');</pre><p>è®©æˆ‘ä»¬å¼€å§‹åˆ†æ Employee å‡½æ•°â€”â€”æ„é€ å™¨åˆå§‹åŒ– name å‚æ•°å’Œ greet æ–¹æ³•ï¼Œå°†å…¶åŠ å…¥åŸå‹ã€‚</p><pre>__decorate([logMethod], Employee.prototype, "greet");</pre><p>è¿™æ˜¯ TypeScript è‡ªåŠ¨ç”Ÿæˆçš„é€šç”¨æ–¹æ³•ï¼Œå®ƒæ ¹æ®è£…é¥°å™¨ç±»å‹å’Œç›¸åº”å‚æ•°å¤„ç†è£…é¥°å™¨å‡½æ•°è°ƒç”¨ã€‚</p><p>è¯¥å‡½æ•°æœ‰åŠ©äºå†…çœæ–¹æ³•è°ƒç”¨ï¼Œå¹¶ä¸ºå¼€å‘è€…é“ºå¹³äº†å¤„ç†ç±»ä¼¼<strong>æ—¥å¿—</strong>ã€<strong>è®°å¿†åŒ–</strong>ã€<strong>åº”ç”¨é…ç½®</strong>ç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹çš„é“è·¯ã€‚</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä»…ä»…æ‰“å°äº†å‡½æ•°è°ƒç”¨åŠå…¶å‚æ•°ã€å“åº”ã€‚</p><p>æ³¨æ„ï¼Œé˜…è¯» __decorate æ–¹æ³•ä¸­çš„è¯¦ç»†æ³¨é‡Šå¯ä»¥ç†è§£å…¶å†…éƒ¨æœºåˆ¶ã€‚</p><p>å±æ€§è£…é¥°å™¨</p><p>å±æ€§è£…é¥°å™¨å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼š</p><ol start=1><li><strong>target</strong> â€”â€” å½“å‰å¯¹è±¡çš„åŸå‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‡è®¾ Employee æ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆ target å°±æ˜¯ Employee.prototype</li><li><strong>propertyKey</strong> â€”â€” å±æ€§çš„åç§°</li></ol><pre>function logParameter(target: Object, propertyName: string) {// å±æ€§å€¼let _val = this[propertyName];// å±æ€§è¯»å–è®¿é—®å™¨const getter = () =&gt; { console.log(`Get: ${propertyName} =&gt; ${_val}`);return _val; };// å±æ€§å†™å…¥è®¿é—®å™¨const setter = newVal =&gt; { console.log(`Set: ${propertyName} =&gt; ${newVal}`); _val = newVal; };// åˆ é™¤å±æ€§if (deletethis[propertyName]) {// åˆ›å»ºæ–°å±æ€§åŠå…¶è¯»å–è®¿é—®å™¨ã€å†™å…¥è®¿é—®å™¨Object.defineProperty(target, propertyName, {get: getter,set: setter, enumerable: true, configurable: true }); }}classEmployee {@logParameter name: string;}const emp = newEmployee();emp.name = 'Mohan Ram';console.log(emp.name);// Set: name =&gt; Mohan Ram// Get: name =&gt; Mohan Ram// Mohan Ram</pre><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨è£…é¥°å™¨ä¸­å†…çœå±æ€§çš„å¯è®¿é—®æ€§ã€‚ä¸‹é¢æ˜¯ç¼–è¯‘åçš„ä»£ç ã€‚</p><pre>varEmployee = /** @class */ (function () {functionEmployee() { } __decorate([ logParameter ], Employee.prototype, "name");returnEmployee;}());var emp = newEmployee();emp.name = 'Mohan Ram'; // Set: name =&gt; Mohan Ramconsole.log(emp.name); // Get: name =&gt; Mohan Ram</pre><p>å‚æ•°è£…é¥°å™¨</p><p>å‚æ•°è£…é¥°å™¨å‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼š</p><ol start=1><li><strong>target</strong> â€”â€” å½“å‰å¯¹è±¡çš„åŸå‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‡è®¾ Employee æ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆ target å°±æ˜¯ Employee.prototype</li><li><strong>propertyKey</strong> â€”â€” å‚æ•°çš„åç§°</li><li><strong>index</strong> â€”â€” å‚æ•°æ•°ç»„ä¸­çš„ä½ç½®</li></ol><pre>function logParameter(target: Object, propertyName: string, index: number) {// ä¸ºç›¸åº”æ–¹æ³•ç”Ÿæˆå…ƒæ•°æ®é”®ï¼Œä»¥å‚¨å­˜è¢«è£…é¥°çš„å‚æ•°çš„ä½ç½®const metadataKey = `log_${propertyName}_parameters`;if (Array.isArray(target[metadataKey])) { target[metadataKey].push(index); }else { target[metadataKey] = [index]; }}classEmployee { greet(@logParameter message: string): string {return`hello ${message}`; }}const emp = newEmployee();emp.greet('hello');</pre><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ”¶é›†äº†æ‰€æœ‰è¢«è£…é¥°çš„æ–¹æ³•å‚æ•°çš„ç´¢å¼•æˆ–ä½ç½®ï¼Œä½œä¸ºå…ƒæ•°æ®åŠ å…¥å¯¹è±¡çš„åŸå‹ã€‚ä¸‹é¢æ˜¯ç¼–è¯‘åçš„ä»£ç ã€‚</p><pre>// è¿”å›æ¥å—å‚æ•°ç´¢å¼•å’Œè£…é¥°å™¨çš„å‡½æ•°var __param = (this &amp;&amp; this.__param) || function (paramIndex, decorator) {// è¯¥å‡½æ•°è¿”å›è£…é¥°å™¨returnfunction (target, key) { decorator(target, key, paramIndex); }};varEmployee = /** @class */ (function () {functionEmployee() {}Employee.prototype.greet = function (message) {return"hello " + message; }; __decorate([ __param(0, logParameter) ], Employee.prototype, "greet");returnEmployee;}());var emp = newEmployee();emp.greet('hello');</pre><p>ç±»ä¼¼ä¹‹å‰è§è¿‡çš„ __decorate å‡½æ•°ï¼Œ __param å‡½æ•°è¿”å›ä¸€ä¸ªå°è£…å‚æ•°è£…é¥°å™¨çš„è£…é¥°å™¨ã€‚</p><p>å¦‚æˆ‘ä»¬æ‰€è§ï¼Œè°ƒç”¨å‚æ•°è£…é¥°å™¨æ—¶ï¼Œä¼šå¿½ç•¥å…¶è¿”å›å€¼ã€‚è¿™æ„å‘³ç€ï¼Œè°ƒç”¨ __param å‡½æ•°æ—¶ï¼Œå…¶è¿”å›å€¼ä¸ä¼šç”¨æ¥è¦†ç›–å‚æ•°å€¼ã€‚</p><p>è¿™å°±æ˜¯<strong>å‚æ•°è£…é¥°å™¨ä¸è¿”å›</strong>çš„åŸå› æ‰€åœ¨ã€‚</p><p>è®¿é—®å™¨è£…é¥°å™¨</p><p>è®¿é—®å™¨ä¸è¿‡æ˜¯ç±»å£°æ˜ä¸­å±æ€§çš„è¯»å–è®¿é—®å™¨å’Œå†™å…¥è®¿é—®å™¨ã€‚</p><p><strong>è®¿é—®å™¨è£…é¥°å™¨</strong>åº”ç”¨äºè®¿é—®å™¨çš„<strong>å±æ€§æè¿°ç¬¦</strong>ï¼Œå¯ç”¨äºè§‚æµ‹ã€ä¿®æ”¹ã€æ›¿æ¢è®¿é—®å™¨çš„å®šä¹‰ã€‚</p><pre>function enumerable(value: boolean) {returnfunction ( target: any, propertyKey: string, descriptor: PropertyDescriptor) { console.log('decorator - sets the enumeration part of the accessor'); descriptor.enumerable = value; };}classEmployee {private _salary: number;private _name: string;@enumerable(false)get salary() { return`Rs. ${this._salary}`; }set salary(salary: any) { this._salary = +salary; }@enumerable(true)get name() {return`Sir/Madam, ${this._name}`; }set name(name: string) {this._name = name; }}const emp = newEmployee();emp.salary = 1000;for (let prop in emp) { console.log(`enumerable property = ${prop}`);}// salary å±æ€§ä¸åœ¨æ¸…å•ä¸Šï¼Œå› ä¸ºæˆ‘ä»¬å°†å…¶è®¾ä¸ºå‡// output:// decorator - sets the enumeration part of the accessor// decorator - sets the enumeration part of the accessor// enumerable property = _salary// enumerable property = name</pre><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªè®¿é—®å™¨ name å’Œ salaryï¼Œå¹¶é€šè¿‡è£…é¥°å™¨è®¾ç½®æ˜¯å¦å°†å…¶åˆ—å…¥æ¸…å•ï¼Œæ®æ­¤å†³å®šå¯¹è±¡çš„è¡Œä¸ºã€‚name å°†åˆ—å…¥æ¸…å•ï¼Œè€Œ salary ä¸ä¼šã€‚</p><p>æ³¨æ„ï¼šTypeScript ä¸å…è®¸åŒæ—¶è£…é¥°å•ä¸€æˆå‘˜çš„ get å’Œ set è®¿é—®å™¨ã€‚ç›¸åï¼Œæ‰€æœ‰æˆå‘˜çš„è£…é¥°å™¨éƒ½å¿…é¡»åº”ç”¨äºé¦–ä¸ªæŒ‡å®šçš„è®¿é—®å™¨ï¼ˆæ ¹æ®æ–‡æ¡£é¡ºåºï¼‰ã€‚è¿™æ˜¯å› ä¸ºè£…é¥°å™¨åº”ç”¨äºå±æ€§æè¿°ç¬¦ï¼Œå±æ€§æè¿°ç¬¦ç»“åˆäº† get å’Œ setè®¿é—®å™¨ï¼Œè€Œä¸æ˜¯åˆ†åˆ«åº”ç”¨äºæ¯é¡¹å£°æ˜ã€‚</p><p>ä¸‹é¢æ˜¯ç¼–è¯‘çš„ä»£ç ã€‚</p><pre>function enumerable(value) {returnfunction (target, propertyKey, descriptor) { console.log('decorator - sets the enumeration part of the accessor'); descriptor.enumerable = value; };}varEmployee = /** @class */ (function () {functionEmployee() { }Object.defineProperty(Employee.prototype, "salary", {get: function () { return"Rs. " + this._salary; },set: function (salary) { this._salary = +salary; }, enumerable: true, configurable: true });Object.defineProperty(Employee.prototype, "name", {get: function () {return"Sir/Madam, " + this._name; },set: function (name) {this._name = name; }, enumerable: true, configurable: true }); __decorate([ enumerable(false) ], Employee.prototype, "salary", null); __decorate([ enumerable(true) ], Employee.prototype, "name", null);returnEmployee;}());var emp = newEmployee();emp.salary = 1000;for (var prop in emp) { console.log("enumerable property = " + prop);}</pre><p>ç±»è£…é¥°å™¨</p><p>ç±»è£…é¥°å™¨åº”ç”¨äºç±»çš„æ„é€ å™¨ï¼Œå¯ç”¨äºè§‚æµ‹ã€ä¿®æ”¹ã€æ›¿æ¢ç±»å®šä¹‰ã€‚</p><pre>exportfunction logClass(target: Function) {// ä¿å­˜ä¸€ä»½åŸæ„é€ å™¨çš„å¼•ç”¨const original = target;// ç”Ÿæˆç±»çš„å®ä¾‹çš„è¾…åŠ©å‡½æ•°function construct(constructor, args) {const c: any = function () {return constructor.apply(this, args); } c.prototype = constructor.prototype;returnnew c(); }// æ–°æ„é€ å™¨è¡Œä¸ºconst f: any = function (...args) { console.log(`New: ${original['name']} is created`);return construct(original, args); }// å¤åˆ¶ prototype å±æ€§ï¼Œä¿æŒ intanceof æ“ä½œç¬¦å¯ç”¨ f.prototype = original.prototype;// è¿”å›æ–°æ„é€ å™¨ï¼ˆå°†è¦†ç›–åŸæ„é€ å™¨ï¼‰return f;}@logClassclassEmployee {}let emp = newEmployee();console.log('emp instanceof Employee');console.log(emp instanceofEmployee); // true</pre><p>ä¸Šé¢çš„è£…é¥°å™¨å£°æ˜äº†ä¸€ä¸ªåä¸º original çš„å˜é‡ï¼Œå°†å…¶å€¼è®¾ä¸ºè¢«è£…é¥°çš„ç±»æ„é€ å™¨ã€‚</p><p>æ¥ç€å£°æ˜äº†åä¸º construct çš„è¾…åŠ©å‡½æ•°ã€‚è¯¥å‡½æ•°ç”¨äºåˆ›å»ºç±»çš„å®ä¾‹ã€‚</p><p>æˆ‘ä»¬æ¥ä¸‹æ¥åˆ›å»ºäº†ä¸€ä¸ªåä¸º f çš„å˜é‡ï¼Œè¯¥å˜é‡å°†ç”¨ä½œæ–°æ„é€ å™¨ã€‚è¯¥å‡½æ•°è°ƒç”¨åŸæ„é€ å™¨ï¼ŒåŒæ—¶åœ¨æ§åˆ¶å°æ‰“å°å®ä¾‹åŒ–çš„ç±»åã€‚è¿™æ­£æ˜¯æˆ‘ä»¬<strong>ç»™åŸæ„é€ å™¨åŠ å…¥é¢å¤–è¡Œä¸º</strong>çš„åœ°æ–¹ã€‚</p><p>åŸæ„é€ å™¨çš„åŸå‹å¤åˆ¶åˆ° fï¼Œä»¥ç¡®ä¿åˆ›å»ºä¸€ä¸ª Employee æ–°å®ä¾‹çš„æ—¶å€™ï¼Œ instanceof æ“ä½œç¬¦çš„æ•ˆæœç¬¦åˆé¢„æœŸã€‚</p><p>æ–°æ„é€ å™¨ä¸€æ—¦å°±ç»ªï¼Œæˆ‘ä»¬ä¾¿è¿”å›å®ƒï¼Œä»¥å®Œæˆç±»æ„é€ å™¨çš„å®ç°ã€‚</p><p>æ–°æ„é€ å™¨å°±ç»ªä¹‹åï¼Œæ¯æ¬¡åˆ›å»ºå®ä¾‹æ—¶ä¼šåœ¨æ§åˆ¶å°æ‰“å°ç±»åã€‚</p><p>ç¼–è¯‘åçš„ä»£ç å¦‚ä¸‹ã€‚</p><pre>varEmployee = /** @class */ (function () {functionEmployee() { }Employee = __decorate([ logClass ], Employee);returnEmployee;}());var emp = newEmployee();console.log('emp instanceof Employee');console.log(emp instanceofEmployee);</pre><p>åœ¨ç¼–è¯‘åçš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ä¸¤å¤„ä¸åŒï¼š</p><ol start=1><li>å¦‚ä½ æ‰€è§ï¼Œä¼ ç»™ __decorate çš„å‚æ•°æœ‰ä¸¤ä¸ªï¼Œè£…é¥°å™¨æ•°ç»„å’Œæ„é€ å™¨å‡½æ•°ã€‚</li><li>TypeScript ç¼–è¯‘å™¨ä½¿ç”¨ __decorate çš„è¿”å›å€¼ä»¥è¦†ç›–åŸæ„é€ å™¨ã€‚</li></ol><p>è¿™æ­£æ˜¯<strong>ç±»è£…é¥°å™¨å¿…é¡»è¿”å›ä¸€ä¸ªæ„é€ å‡½æ•°</strong>çš„åŸå› æ‰€åœ¨ã€‚</p><p>è£…é¥°å™¨å·¥å‚</p><p>ç”±äºæ¯ç§è£…é¥°å™¨éƒ½æœ‰å®ƒè‡ªèº«çš„è°ƒç”¨ç­¾åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è£…é¥°å™¨å·¥å‚æ¥æ³›åŒ–è£…é¥°å™¨è°ƒç”¨ã€‚</p><pre>import { logClass } from'./class-decorator';import { logMethod } from'./method-decorator';import { logProperty } from'./property-decorator';import { logParameter } from'./parameter-decorator';// è£…é¥°å™¨å·¥å‚ï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°è°ƒç”¨ç›¸åº”çš„è£…é¥°å™¨exportfunction log(...args) {switch (args.length) {case3: // å¯èƒ½æ˜¯æ–¹æ³•è£…é¥°å™¨æˆ–å‚æ•°è£…é¥°å™¨// å¦‚æœç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ•°å­—ï¼Œé‚£ä¹ˆå®ƒæ˜¯ç´¢å¼•ï¼Œæ‰€ä»¥è¿™æ˜¯å‚æ•°è£…é¥°å™¨iftypeof args[2] === "number") {return logParameter.apply(this, args); }return logMethod.apply(this, args);case2: // å±æ€§è£…é¥°å™¨return logProperty.apply(this, args);case1: // ç±»è£…é¥°å™¨return logClass.apply(this, args);default: // å‚æ•°æ•°ç›®ä¸åˆæ³•thrownewError('Not a valid decorator'); }}@logclassEmployee {@logprivate name: string; constructor(name: string) {this.name = name; }@log greet(@log message: string): string {return`${this.name} says: ${message}`; }}</pre><p>å…ƒä¿¡æ¯åå°„ API</p><p>å…ƒä¿¡æ¯åå°„ API ï¼ˆä¾‹å¦‚ Reflectï¼‰èƒ½å¤Ÿç”¨æ¥ä»¥æ ‡å‡†æ–¹å¼ç»„ç»‡å…ƒä¿¡æ¯ã€‚</p><p>ã€Œåå°„ã€çš„æ„æ€æ˜¯ä»£ç å¯ä»¥ä¾¦æµ‹åŒä¸€ç³»ç»Ÿä¸­çš„å…¶ä»–ä»£ç ï¼ˆæˆ–å…¶è‡ªèº«ï¼‰ã€‚</p><p>åå°„åœ¨ç»„åˆ/ä¾èµ–æ³¨å…¥ã€è¿è¡Œæ—¶ç±»å‹æ–­è¨€ã€æµ‹è¯•ç­‰ä½¿ç”¨åœºæ™¯ä¸‹å¾ˆæœ‰ç”¨ã€‚</p><pre>import"reflect-metadata";// å‚æ•°è£…é¥°å™¨ä½¿ç”¨åå°„ api å­˜å‚¨è¢«è£…é¥°å‚æ•°çš„ç´¢å¼•exportfunction logParameter(target: Object, propertyName: string, index: number) {// è·å–ç›®æ ‡å¯¹è±¡çš„å…ƒä¿¡æ¯const indices = Reflect.getMetadata(`log_${propertyName}_parameters`, target, propertyName) || []; indices.push(index);// å®šä¹‰ç›®æ ‡å¯¹è±¡çš„å…ƒä¿¡æ¯Reflect.defineMetadata(`log_${propertyName}_parameters`, indices, target, propertyName);}// å±æ€§è£…é¥°å™¨ä½¿ç”¨åå°„ api è·å–å±æ€§çš„è¿è¡Œæ—¶ç±»å‹exportfunction logProperty(target: Object, propertyName: string): void {// è·å–å¯¹è±¡å±æ€§çš„è®¾è®¡ç±»å‹var t = Reflect.getMetadata("design:type", target, propertyName); console.log(`${propertyName} type: ${t.name}`); // name type: String}classEmployee {@logPropertyprivate name: string; constructor(name: string) {this.name = name; } greet(@logParameter message: string): string {return`${this.name} says: ${message}`; }}</pre><p>ä¸Šé¢çš„ä»£ç ç”¨åˆ°äº† reflect-metadata è¿™ä¸ªåº“ã€‚å…¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†åå°„å…ƒä¿¡æ¯çš„è®¾è®¡é”®ï¼ˆä¾‹å¦‚ï¼šdesign:typeï¼‰ã€‚ç›®å‰åªæœ‰ä¸‰ä¸ªï¼š</p><ul class=list-paddingleft-2><li><strong>ç±»å‹å…ƒä¿¡æ¯</strong>ç”¨äº†å…ƒä¿¡æ¯é”® design:typeã€‚</li><li><strong>å‚æ•°ç±»å‹å…ƒä¿¡æ¯</strong>ç”¨äº†å…ƒä¿¡æ¯é”® design:paramtypesã€‚</li><li><strong>è¿”å›ç±»å‹å…ƒä¿¡æ¯</strong>ç”¨äº†å…ƒä¿¡æ¯é”® design:returntypeã€‚</li></ul><p>æœ‰äº†åå°„ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶å¾—åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ul class=list-paddingleft-2><li>å®ä½“<strong>å</strong>ã€‚</li><li>å®ä½“<strong>ç±»å‹</strong>ã€‚</li><li>å®ä½“å®ç°çš„<strong>æ¥å£</strong>ã€‚</li><li>å®ä½“<strong>æ„é€ å™¨å‚æ•°</strong>çš„åç§°å’Œç±»å‹ã€‚</li></ul><p>ç»“è¯­</p><ul class=list-paddingleft-2><li><strong>è£…é¥°å™¨</strong> ä¸è¿‡æ˜¯åœ¨<strong>è®¾è®¡æ—¶ï¼ˆdesign timeï¼‰</strong>å¸®åŠ©<strong>å†…çœ</strong>ä»£ç ï¼Œ<strong>æ³¨è§£</strong>åŠä¿®æ”¹ç±»å’Œå±æ€§çš„å‡½æ•°ã€‚</li><li>Yehuda Katz æè®®åœ¨ ECMAScript 2016 æ ‡å‡†ä¸­åŠ å…¥è£…é¥°å™¨ç‰¹æ€§ï¼štc39/proposal-decorators</li><li>æˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>è£…é¥°å™¨å·¥å‚</strong>å°†ç”¨æˆ·æä¾›çš„å‚æ•°ä¼ ç»™è£…é¥°å™¨ã€‚</li><li>æœ‰ 4 ç§è£…é¥°å™¨ï¼š<strong>ç±»</strong>è£…é¥°å™¨ã€<strong>æ–¹æ³•</strong>è£…é¥°å™¨ã€<strong>å±æ€§/è®¿é—®å™¨</strong>è£…é¥°å™¨ã€<strong>å‚æ•°</strong>è£…é¥°å™¨ã€‚</li><li><strong>å…ƒä¿¡æ¯åå°„ API</strong> æœ‰åŠ©äºä»¥æ ‡å‡†æ–¹å¼åœ¨å¯¹è±¡ä¸­åŠ å…¥å…ƒä¿¡æ¯ï¼Œä»¥åŠåœ¨<strong>è¿è¡Œæ—¶</strong>è·å–<strong>è®¾è®¡ç±»å‹ä¿¡æ¯</strong>ã€‚</li></ul><p>æˆ‘æŠŠæ–‡ä¸­æ‰€æœ‰ä»£ç ç¤ºä¾‹éƒ½æ”¾åˆ°äº† mohanramphp/typescript-decorators è¿™ä¸ª Git ä»“åº“ä¸­ã€‚è°¢è°¢é˜…è¯»ï¼</p><div class=pgc-img><img alt="ä»£ç è§„èŒƒâ€”ä½¿ç”¨ TypeScript è£…é¥°å™¨" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/dfic-imagehandler/4b5097e2-c4fd-4d37-9c54-707760739775><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'ä»£ç ','è§„èŒƒ','TypeScript'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>