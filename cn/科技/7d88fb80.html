<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>详解MYSQL数据库的存储过程和函数语法总结 | 极客快訊</title><meta property="og:title" content="详解MYSQL数据库的存储过程和函数语法总结 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/dd9b4bb507e84ad78bf1ed764e5fd570"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7d88fb80.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7d88fb80.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7d88fb80.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7d88fb80.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7d88fb80.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7d88fb80.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7d88fb80.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7d88fb80.html><meta property="article:published_time" content="2020-11-14T21:02:06+08:00"><meta property="article:modified_time" content="2020-11-14T21:02:06+08:00"><meta name=Keywords content><meta name=description content="详解MYSQL数据库的存储过程和函数语法总结"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/7d88fb80.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>详解MYSQL数据库的存储过程和函数语法总结</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1><strong>什么是存储过程</strong></h1><p>简单的说，就是<strong>一组SQL语句集，功能强大，可以实现一些比较复杂的逻辑功能，</strong>类似于JAVA语言中的方法；</p><p>ps:存储过程跟触发器有点类似，都是一组SQL集，但是存储过程是主动调用的，且功能比触发器更加强大，触发器是某件事触发后自动调用；</p><hr><h1><strong>存储过程特性</strong></h1><ol><li>有输入输出参数，可以声明变量，有if/else, case,while等控制语句，通过编写存储过程，可以实现复杂的逻辑功能；</li><li>函数的普遍特性：模块化，封装，代码复用；</li><li>速度快，只有首次执行需经过编译和优化步骤，后续被调用可以直接执行，省去以上步骤；</li></ol><hr><h1><strong>MySQL存储过程的创建</strong></h1><p><strong>1、语法</strong></p><p>CREATE PROCEDURE sp_name ([proc_parameter[,...]]) [characteristic ...] routine_body</p><p>CREATE PROCEDURE 过程名([[IN|OUT|INOUT] 参数名 数据类型[,[IN|OUT|INOUT] 参数名 数据类型…]]) [特性 ...] 过程体</p><pre>DELIMITER // CREATE PROCEDURE myproc(OUT s int) BEGIN SELECT COUNT(*) INTO s FROM students; END //DELIMITER ;</pre><p>MySQL默认以";"为分隔符，如果没有声明<span>分割符</span>，则编译器会把存储过程当成SQL语句进行处理，因此编译过程会报错，所以要事先用“DELIMITER //”声明当前段分隔符，让编译器把两个"//"之间的内容当做存储过程的代码，不会执行这些代码；“DELIMITER ;”的意为把分隔符还原。</p><p><strong>2、参数</strong></p><p>存储过程根据需要可能会有输入、输出、输入输出参数，如果有多个参数用","分割开。MySQL存储过程的参数用在存储过程的定义，共有三种参数类型,IN,OUT,INOUT:</p><ul><li>IN参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值</li><li>OUT:该值可在存储过程内部被改变，并可返回</li><li>INOUT:调用时指定，并且可被改变和返回</li></ul><p>其中，sp_name参数是存储过程的名称；proc_parameter表示存储过程的参数列表； characteristic参数指定存储过程的特性；routine_body参数是SQL代码的内容，可以用BEGIN…END来标志SQL代码的开始和结束。</p><p>技巧：创建存储过程时，系统默认指定CONTAINS SQL，表示存储过程中使用了SQL语句。但是，如果存储过程中没有使用SQL语句，最好设置为NO SQL。而且，存储过程中最好在COMMENT部分对存储过程进行简单的注释，以便以后在阅读存储过程的代码时更加方便。</p><hr><h1>存储过程实例</h1><p>下面创建一个名为num_from_employee的存储过程。</p><div class=pgc-img><img alt=详解MYSQL数据库的存储过程和函数语法总结 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/dd9b4bb507e84ad78bf1ed764e5fd570><p class=pgc-img-caption></p></div><p>上述存储过程名称为num_from_employee；输入变量为emp_id；输出变量为count_num。SELECT语句从employee表查询d_id值等于emp_id的记录，并用COUNT(*)计算d_id值相同的记录的条数，最后将计算结果存入count_num中。执行结果如下：</p><div class=pgc-img><img alt=详解MYSQL数据库的存储过程和函数语法总结 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/449b0d3d4a9a4bf5a750fe0094059946><p class=pgc-img-caption></p></div><p>执行完毕后，没有报出任何出错信息就表示存储函数已经创建成功。以后就可以调用这个存储过程，数据库中会执行存储过程中的SQL语句。</p><p>说明：MySQL中默认的语句结束符为分号（;）。存储过程中的SQL语句需要分号来 结束。为了避免冲突，首先用"DELIMITER &&"将MySQL的结束符设置为&&。最后再用"DELIMITER ;"来将结束符恢复成分号。这与创建触发器时是一样的。</p><hr><h1><strong>函数</strong></h1><p>在MySQL中，创建存储函数的基本形式如下：</p><pre>CREATE FUNCTION sp_name ([func_parameter[,...]]) RETURNS type [characteristic ...] routine_body</pre><p>其中，sp_name参数是存储函数的名称；func_parameter表示存储函数的参数列表；RETURNS type指定返回值的类型；characteristic参数指定存储函数的特性，该参数的取值与存储过程中的取值是一样的；routine_body参数是SQL代码的内容，可以用BEGIN…END来标志SQL代码的开始和结束。</p><p>func_parameter可以由多个参数组成，其中每个参数由参数名称和参数类型组成，其形式如下：param_name type</p><p>其中，param_name参数是存储函数的参数名称；type参数指定存储函数的参数类型，该类型可以是MySQL数据库的任意数据类型。</p><hr><h1>函数实例</h1><p>下面创建一个名为name_from_employee的存储函数。</p><div class=pgc-img><img alt=详解MYSQL数据库的存储过程和函数语法总结 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d07e445e6f224849b418ce31efb29e94><p class=pgc-img-caption></p></div><p>上述存储函数的名称为name_from_employee；该函数的参数为emp_id；返回值是VARCHAR类型。SELECT语句从employee表查询num值等于emp_id的记录，并将该记录的name字段的值返回。执行结果如下：</p><div class=pgc-img><img alt=详解MYSQL数据库的存储过程和函数语法总结 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d99bac306a91418c949baa19da6625b0><p class=pgc-img-caption></p></div><p>结果显示，存储函数已经创建成功。该函数的使用和MySQL内部函数的使用方法一样。</p><hr><h1><strong>变量的使用</strong></h1><p>在存储过程和函数中，可以定义和使用变量。用户可以使用DECLARE关键字来定义变量。然后可以为变量赋值。这些变量的作用范围是BEGIN…END程序段中。</p><p><strong>1、定义变量</strong></p><p>MySQL中可以使用DECLARE关键字来定义变量。定义变量的基本语法如下：</p><pre>DECLARE var_name[,...] type [DEFAULT value]</pre><p>其中， DECLARE关键字是用来声明变量的；var_name参数是变量的名称，这里可以同时定义多个变量；type参数用来指定变量的类型；DEFAULT value子句将变量默认值设置为value，没有使用DEFAULT子句时，默认值为NULL。</p><p>下面定义变量my_sql，数据类型为INT型，默认值为10。</p><pre>DECLARE my_sql INT DEFAULT 10 ;</pre><p><strong>2、为变量赋值</strong></p><p>MySQL中可以使用SET关键字来为变量赋值。SET语句的基本语法如下：</p><pre>SET var_name = expr [, var_name = expr] ...</pre><p>其中，SET关键字是用来为变量赋值的；var_name参数是变量的名称；expr参数是赋值表达式。一个SET语句可以同时为多个变量赋值，各个变量的赋值语句之间用逗号隔开。</p><p>下面为变量my_sql赋值为30。</p><pre>SET my_sql = 30 ;</pre><p>MySQL中还可以使用SELECT…INTO语句为变量赋值。其基本语法如下：</p><pre>SELECT col_name[,…] INTO var_name[,…] FROM table_name WEHRE condition</pre><p>其中，col_name参数表示查询的字段名称；var_name参数是变量的名称；table_name参数指表的名称；condition参数指查询条件。</p><p>下面从employee表中查询id为2的记录，将该记录的d_id值赋给变量my_sql。</p><pre>SELECT d_id INTO my_sql FROM employee WEHRE id=2 ;</pre><hr><h1><strong>MySQL存储过程写法总结</strong></h1><p><strong>1、创建无参存储过程。</strong></p><pre>create procedure product()begin select * from user;end;</pre><p>一条简单的存储过程创建语句，此时调用的语句为：</p><pre>call procedure();</pre><p><strong>2、创建有参存储过程</strong></p><p>有参的存储包括两种参数，</p><p>一个是传入参数;</p><p>一个是传出参数;</p><p>例如一个存储过程：</p><pre>create procedure procedure2(out p1 decimal(8,2),out p2 decimal(8,2),in p3 int)beginselect sum(uid) into p1 from user where order_name = p3;select avg(uid) into p2 from user ;end ;</pre><p>从上面sql语句可以看出，p1和p2是用来检索并且传出去的值，而p3则是必须有调用这传入的具体值。</p><p>具体调用过程：</p><blockquote><p>call product(); //无参</p><p>call procedure2(@userSum,@userAvg,201708); //有参</p></blockquote><p>当用完后，可以直接查询userSum和userAvg的值：</p><blockquote><p>select @userSum, @userAvg;</p></blockquote><p>结果如下：</p><div class=pgc-img><img alt=详解MYSQL数据库的存储过程和函数语法总结 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8b964d733102411e94abea56f00e0106><p class=pgc-img-caption></p></div><p><strong>3、删除存储过程</strong></p><p>语法：drop procedure procedure_name;</p><hr><p>后面会分享更多devops和DBA方面的内容，感兴趣的朋友可以关注一下~</p><div class=pgc-img><img alt=详解MYSQL数据库的存储过程和函数语法总结 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/162b4bed6b444c1d9e90d8435a46b673><p class=pgc-img-caption></p></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'详解','MYSQL','数据库'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>