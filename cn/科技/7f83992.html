<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹ä¼ æˆç»™ä½ é«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€ | æå®¢å¿«è¨Š</title><meta property="og:title" content="ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹ä¼ æˆç»™ä½ é«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/a7dcdb95c4b747339ad1c7a02b1dee51"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7f83992.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7f83992.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7f83992.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7f83992.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7f83992.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7f83992.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7f83992.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7f83992.html><meta property="article:published_time" content="2020-10-29T21:08:06+08:00"><meta property="article:modified_time" content="2020-10-29T21:08:06+08:00"><meta name=Keywords content><meta name=description content="ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹ä¼ æˆç»™ä½ é«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/7f83992.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹ä¼ æˆç»™ä½ é«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><blockquote>å…¨æ–‡å…±<strong>10788</strong>å­—ï¼Œé¢„è®¡å­¦ä¹ æ—¶é•¿<strong>20</strong>åˆ†é’Ÿæˆ–æ›´é•¿</blockquote><div class=pgc-img><img alt=ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹ä¼ æˆç»™ä½ é«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a7dcdb95c4b747339ad1c7a02b1dee51><p class=pgc-img-caption>å›¾ç‰‡æ¥æºï¼šunsplash.com/@lucassankey</p></div><p class=ql-align-justify>äººä¸ä¸–ç•Œä¸‡ç‰©çš„äº’åŠ¨ä¼šäº§ç”Ÿå¤§é‡çš„æ—¶ç©ºæ•°æ®ã€‚é‚£ä¹ˆï¼Œå½“æˆ‘ä»¬éœ€è¦éšæ—¶è°ƒç”¨è¿‡å»çš„æ•°æ®æ—¶ï¼Œæ”¹æ€ä¹ˆåŠï¼Ÿå°¤å…¶æ˜¯é¢å¯¹å„ç§æµ·é‡ã€å¤šç»´åº¦çš„æ•°æ®åº“ï¼Œå¦‚æœæ²¡æœ‰é«˜æ•ˆçš„æœç´¢æ–¹æ³•ï¼Œæˆ‘ä»¬åªèƒ½æœ›æ´‹å…´å¹ã€æŸæ‰‹æ— ç­–ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>åˆ«æ‹…å¿ƒï¼Œæœ¬æ–‡å°†ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹æ¥ä¼ æˆé«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€ï¼</p><p class=ql-align-justify><br></p><div class=pgc-img><img alt=ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹ä¼ æˆç»™ä½ é«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12eec69480594db79a5c2452d716e5ea><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>å¯¹è±¡æ•°æ®åˆ†ç±»</strong></p><p class=ql-align-justify><br></p><p class=ql-align-justify>å¯¹è±¡æ•°æ®å¯åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šé™æ€æ•°æ®ï¼ˆç›¸å¯¹é™æ€ï¼Œä¾‹å¦‚å»ºç­‘ï¼‰å’ŒåŠ¨æ€æ•°æ®ï¼ˆä¾‹å¦‚äººçš„æ´»åŠ¨å’Œç‰©è”ç½‘ä¼ æ„Ÿå™¨çš„æ´»åŠ¨ï¼‰ã€‚</p><p class=ql-align-justify><br></p><div class=pgc-img><img alt=ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹ä¼ æˆç»™ä½ é«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12eec69480594db79a5c2452d716e5ea><p class=pgc-img-caption></p></div><p><strong>æŒ‰ç ”ç©¶éœ€æ±‚åˆ†ç±»çš„ç´¢å¼•</strong></p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ—¶ç©ºå¿«ç…§æœç´¢</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æœ‰äº›å¯¹è±¡ä»¥ç›¸å¯¹è¾ƒä½çš„é¢‘ç‡ç”Ÿæˆæ•°æ®ã€‚ä¾‹å¦‚ï¼Œå»ºç­‘ç‰©å’Œé“è·¯ç­‰æƒ°æ€§ç‰©ä½“å¯èƒ½åœ¨æ•°å¹´å†…ä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–ã€‚å¦‚æœå°†ä¸ºè¿™äº›å¯¹è±¡ç”Ÿæˆçš„æ•°æ®å†™å…¥æ•°æ®åº“ï¼Œå¹¶æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢æ•°æ®ï¼ˆä¾‹å¦‚ï¼ŒæŸ¥è¯¢æ—¥æœŸä¸º2017-07-01è‡³2017-07-02ï¼‰ï¼Œåˆ™å¯èƒ½æ‰¾ä¸åˆ°ä¸è¿™äº›å¯¹è±¡ç›¸å…³çš„ä»»ä½•æ•°æ®ã€‚åŸå› å¾ˆç®€å•ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…æ•°æ®åº“æ ¹æœ¬æ²¡æœ‰ç›¸å…³æ•°æ®è¾“å…¥ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ—¶ç©ºè¡Œä¸ºæ•°æ®æœç´¢</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ—¶ç©ºè¡Œä¸ºæ•°æ®æ˜¯æŒ‡ä»äººçš„æ´»åŠ¨ç­‰åŠ¨æ€å¯¹è±¡ä¸­è·å–æ•°æ®ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä¾‹å¦‚ï¼Œåˆ†æç‰¹å®šåœ°åŒºç‰¹å®šæ—¶é—´æ®µå†…æŸä¸€äººç¾¤çš„ç‰¹å¾ï¼Œæˆ–è€…åˆ†æå¤§å­¦å‘¨è¾¹äººç¾¤åœ¨å·¥ä½œæ—¥å’Œå‘¨æœ«æ„æˆçš„å·®å¼‚ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ—¶ç©ºå¿«ç…§ä¸å±äºæœ¬æ–‡çš„è®¨è®ºèŒƒå›´ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æœç´¢æ—¶ç©ºè¡Œä¸ºæ•°æ®ã€‚</p><p class=ql-align-justify><br></p><div class=pgc-img><img alt=ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹ä¼ æˆç»™ä½ é«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12eec69480594db79a5c2452d716e5ea><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>æ•°æ®ç»“æ„</strong></p><div class=pgc-img><img alt=ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹ä¼ æˆç»™ä½ é«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e9aafdcbf51f428a8ca1c8f3bfb86ec5><p class=pgc-img-caption>å›¾ç‰‡æ¥æºï¼šunsplash.com/@dekubaum</p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>æ—¶ç©ºè¡Œä¸ºæ•°æ®åŒ…å«ä¸‰ä¸ªå±æ€§ï¼šæ—¶é—´ã€ç©ºé—´å’Œå¯¹è±¡ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>éç»“æ„åŒ–ç´¢å¼•ï¼š</p><pre>create table test(  id int8,  crt_time timestamp, -- Time  pos geometry, -- Location  obj jsonb -- Object description );</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>é™¤äº†åº”ç”¨äºJSONï¼Œç»“æ„åŒ–æ•°æ®è¿˜å¯ä»¥ç”¨äºå¯¹è±¡æè¿°ã€‚ä¾‹å¦‚ï¼š</p><pre>create table test(  id int8,  crt_time timestamp, -- Time  pos geometry, -- Location  c1 int, -- Some property examples  c2 int,  c3 text,  c4 float8,  c5 int,  c6 date,  c7 text,  c8 int,  c9 int,  c10 int );</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>æ—¶ç©ºè¡Œä¸ºæ•°æ®çš„SQLæŸ¥è¯¢å®ä¾‹</p><pre>select * from test  where  pos &lt;-&gt; ? &lt; ?  and crt_time between ? and ?  and ( (c1 = ? and c2 between ? and ?) or c10=?)  ...  ;</pre><p class=ql-align-justify><br></p><p class=ql-align-center><br></p><div class=pgc-img><img alt=ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹ä¼ æˆç»™ä½ é«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12eec69480594db79a5c2452d716e5ea><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>ä¼˜åŒ–æ–¹æ³•</strong></p><p class=ql-align-justify><br></p><p class=ql-align-justify>è€ƒè™‘è¿ç”¨ä»¥ä¸‹çŸ¥è¯†ï¼š</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ—¶é—´åºåˆ—BRINç´¢å¼•</p><p class=ql-align-justify><br></p><p class=ql-align-justify>crt_timeå­—æ®µæ˜¯ä¸€ä¸ªæ—¶é—´åºåˆ—å­—æ®µï¼Œè¡¨ç¤ºç”Ÿæˆæ•°æ®çš„æ—¶é—´ã€‚åœ¨PostgreSQLå †å­˜å‚¨ä¸­ï¼Œå­˜å‚¨å’Œè¯¥å­—æ®µçš„å€¼å…·æœ‰å¾ˆå¼ºçš„çº¿æ€§ç›¸å…³æ€§ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>å› æ­¤ï¼ŒBRINç´¢å¼•å¾ˆåˆé€‚ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä½¿ç”¨BRINç´¢å¼•æ¥ä»£æ›¿åˆ†åŒºè¡¨è¿›è¡ŒTPC-Hæµ‹è¯•ã€‚å¤§èŒƒå›´æœç´¢çš„æ€§èƒ½ç”šè‡³ä¼˜äºä½¿ç”¨åˆ†åŒºè¡¨æ—¶çš„åŠŸèƒ½ã€‚</p><pre>create index idx_test_1 on test using brin(crt_time);</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>ç©ºé—´ç´¢å¼•</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ˜¾ç„¶ï¼Œç©ºé—´æ£€ç´¢éœ€è¦ç©ºé—´ç´¢å¼•ã€‚PostgreSQLä¸­å¯ä»¥ä½¿ç”¨ä¸‰ç§æ–¹æ³•å®ç°ç©ºé—´æ£€ç´¢ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>1. å‡ ä½•ç±»å‹çš„GISTç´¢å¼•</strong></p><pre>create index idx_test_2 on test using gist(pos);</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>è¯¥ç´¢å¼•æ”¯æŒç©ºé—´KNNæœç´¢å’Œç©ºé—´ä½ç½®ç¡®å®šç­‰åŠŸèƒ½ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>2. å‡ ä½•ç±»å‹çš„ä¸»ç´¢å¼•</strong></p><pre>create index idx_test_2 on test using spgist(pos);</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>è¯¥ç´¢å¼•æ”¯æŒç©ºé—´KNNæœç´¢å’Œç©ºé—´ä½ç½®ç¡®å®šç­‰åŠŸèƒ½ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>3. Geohashå’ŒB-treeç´¢å¼•</strong>ï¼ˆå°†ç»åº¦å’Œçº¬åº¦è½¬æ¢ä¸ºGeohashå¹¶ä¸ºhashå€¼åˆ›å»ºB-treeç´¢å¼•ï¼‰ã€‚åªéœ€ä½¿ç”¨è¡¨è¾¾å¼ç´¢å¼•ã€‚</p><pre>create index idx_test_3 on test using btree( ST_GeoHash(pos,15) );</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>æ­¤ç´¢å¼•æ”¯æŒå‰ç¼€æœç´¢ï¼ˆå…¶èƒ½è½å®ç¼–ç åœ°ç†ä¿¡æ¯ç½‘æ ¼ä¸­åŒ…å«çš„å…³ç³»ï¼‰ã€‚å®ƒå±äºæœ‰æŸç´¢å¼•ï¼Œéœ€è¦äºŒæ¬¡è¿‡æ»¤ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>GiSTå’ŒSPGiSTç©ºé—´ç´¢å¼•èƒ½å¤Ÿæ‰¾åˆ°å‡†ç¡®çš„åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œä¼˜äºGEOHASHç´¢å¼•ã€‚ä½†æ˜¯ï¼ŒæŸ¥è¯¢ä¿¡æ¯æ—¶éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>GIN ç´¢å¼•</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ­¤ç´¢å¼•ç±»å‹çš„ç›®æ ‡æ˜¯å¯¹è±¡å±æ€§å­—æ®µJSONBæˆ–å¤šä¸ªç»“æ„åŒ–å¯¹è±¡å±æ€§å­—æ®µã€‚åªéœ€ä½¿ç”¨GINç´¢å¼•ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä¾‹å¦‚ï¼š</p><pre>create extension btree_gin;</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>éç»“æ„åŒ–ç´¢å¼•ï¼š</p><pre>create index idx_test_4 on test using gin( obj );</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>ç»“æ„åŒ–ç´¢å¼•ï¼š</p><pre>create index idx_test_4 on test using gin( c1,c2,c3,c4,c5,c6,c7,c8,c9 );</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>BitmapAndå’ŒBitmapOr</p><p class=ql-align-justify><br></p><p class=ql-align-justify>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæ ¹æ®æ•°æ®ç±»å‹å’ŒæŸ¥è¯¢éœ€æ±‚å¯ä»¥ä¸ºä¸åŒçš„æŸ¥è¯¢ç»´åº¦é€‰æ‹©ç›¸åº”çš„ç´¢å¼•ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä½†æ˜¯ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨è¿™äº›ç´¢å¼•å—? PostgreSQLä¸ºå¤šä¸ªç´¢å¼•æä¾›bitmapAndåŠbitmapOræ¥å£ã€‚å®ƒä»¬å¯ä»¥ç»„åˆå¤šä¸ªç´¢å¼•ï¼Œå‡å°‘éœ€è¦æ‰«æçš„æ•°æ®åº“æ•°é‡ã€‚</p><pre>Heap, one square = one page: +---------------------------------------------+ |c____u_____X___u___X_________u___cXcc______u_| +---------------------------------------------+ Rows marked c match customers pkey condition. Rows marked u match username condition. Rows marked X match both conditions. Bitmap scan from customers_pkey: +---------------------------------------------+ |100000000001000000010000000000000111100000000| bitmap 1 +---------------------------------------------+ One bit per heap page, in the same order as the heap Bits 1 when condition matches, 0 if not Bitmap scan from ix_cust_username: +---------------------------------------------+ |000001000001000100010000000001000010000000010| bitmap 2 +---------------------------------------------+ Once the bitmaps are created a bitwise AND is performed on them: +---------------------------------------------+ |100000000001000000010000000000000111100000000| bitmap 1 |000001000001000100010000000001000010000000010| bitmap 2  &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; |000000000001000000010000000000000010000000000| Combined bitmap +-----------+-------+--------------+----------+  | | |  v v v Used to scan the heap only for matching pages: +---------------------------------------------+ |___________X_______X______________X__________| +---------------------------------------------+ The bitmap heap scan then seeks to the start of each page and reads the page: +---------------------------------------------+ |___________X_______X______________X__________| +---------------------------------------------+ seek-------&gt;^seek--&gt;^seek---------&gt;^  | | |  ------------------------  only these pages read</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>ä¾‹å¦‚ï¼š</p><pre>select * from test where  c1 ...  and crt_time between ? and ?  and test-&gt;&gt; c1 in (?, ? ...);</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>æ ¹æ®ç»Ÿè®¡æ•°æ®è‡ªåŠ¨ä½¿ç”¨é€‚å½“çš„ç´¢å¼•ã€‚å¦‚æœéœ€è¦ï¼ŒbitmapAndå’ŒbitmapOrå°†åœ¨å¤šä¸ªç´¢å¼•ä¸Šè‡ªåŠ¨æ‰§è¡Œåˆå¹¶æ‰«æã€‚è·³è¿‡ä¸éœ€è¦æ‰«æçš„é¡µé¢ï¼Œé‡æ–°æ£€æŸ¥å‘½ä¸­çš„é¡µé¢ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>å †è¡¨å­˜å‚¨åˆ†çº§å’Œåˆ†åŒº</p><p class=ql-align-justify><br></p><p class=ql-align-justify>å­˜å‚¨å¯ä»¥åˆ†ä¸ºä¸€çº§åˆ†åŒºæˆ–å¤šçº§åˆ†åŒºï¼š</p><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>1. å•ä¸€åˆ†åŒº</strong></p><p class=ql-align-justify>ä¾‹å¦‚ï¼ŒæŒ‰æ—¶é—´åˆ’åˆ†ã€‚</p><pre>create table test(  id int8,  crt_time timestamp, -- Time  pos geometry, -- Location  obj jsonb -- Object description ) PARTITION BY range (crt_time) ; create table test_201701 PARTITION OF test for values FROM ( 2017-01-01 ) TO ( 2017-02-01 ); ......</pre><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>2. å¤šå±‚åˆ†åŒº</strong></p><p class=ql-align-justify>ä¾‹å¦‚ï¼Œå…ˆæŒ‰æ—¶é—´åˆ†åŒºï¼Œç„¶åæŒ‰Geohashåˆ’åˆ†ã€‚</p><pre>create table test_201701 PARTITION OF test for values FROM ( 2017-01-01 ) TO ( 2017-02-01 ) partition by range(st_geohash(pos,15)); ... create table test_201701_prefix1 PARTITION OF test for values FROM ( xxxx1 ) TO ( xxxx2 ); -- Generate BOX (GRID) on a map, find corresponding boundaries and use -- boundaries as partitioning conditions</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>ä½¿ç”¨åˆ†åŒºæ—¶ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶åŒ…æ‹¬åˆ†åŒºé”®ï¼ˆå¦‚æ—¶é—´å’Œç©ºé—´èŒƒå›´ï¼‰ï¼Œç›¸åº”çš„åˆ†åŒºå°†è‡ªåŠ¨å®šä½ï¼Œè¿™å³ä¸ºéœ€è¦æ‰«æçš„æ•°æ®é‡ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>åˆ›å»ºé¢å‘å¯¹è±¡å±æ€§çš„GINç´¢å¼•ï¼Œä»¥å®ç°é«˜æ•ˆæŸ¥è¯¢ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ç´¢å¼•åˆ†çº§ä¸åˆ†åŒº</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä¸æ•°æ®ä¸€æ ·ï¼Œç´¢å¼•åœ¨ä¸ä½¿ç”¨åˆ†åŒºè¡¨çš„æƒ…å†µä¸‹ä¹Ÿæ”¯æŒåˆ†åŒºé€»è¾‘ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ç©ºé—´ç´¢å¼•+æ—¶é—´åˆ†åŒº</p><pre>create index idx_20170101 on tbl using gist (pos) where crt_time between 2017-01-01 and 2017-01-02 ; ... create index idx_20170102 on tbl using gist (pos) where crt_time between 2017-01-02 and 2017-01-03 ; ...</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>é€šè¿‡ä½¿ç”¨å‰è¿°åˆ†åŒºç´¢å¼•ï¼Œå¯ä»¥åœ¨è¾“å…¥æ—¶é—´èŒƒå›´åå¿«é€Ÿå®šä½ç›®æ ‡æ•°æ®ï¼Œæ‰§è¡Œç©ºé—´æœç´¢ã€‚</p><pre>select * from tbl  where crt_time between 2017-01-01 and 2017-01-02 -- Time  and (pos &lt;-&gt; ?) &lt; ? -- Distance to a point to be searched for  and ? -- Other conditions  order by pos &lt;-&gt; ? -- Sort by distance  limit ?; -- Number of results to be returned</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>å¯ä»¥ä½¿ç”¨æ›´å¤šçš„ç´¢å¼•åˆ†åŒºï¼Œæ¯”å¦‚ç”¨ä½œæœç´¢æ¡ä»¶å’Œå•†åº—ç±»å‹çš„ç»´åº¦ï¼ˆå¯¹è±¡å±æ€§ï¼‰ï¼ˆå‡è®¾å®ƒæ˜¯å¯æšä¸¾çš„æˆ–åœ¨èŒƒå›´ç›¸å¯¹è¾ƒå°çš„æƒ…å†µä¸‹ï¼‰ã€‚</p><pre>create index idx_20170101_mod0 on tbl using gist (pos) where crt_time between 2017-01-01 and 2017-01-02 and dtype=0; ... create index idx_20170101_mod1 on tbl using gist (pos) where crt_time between 2017-01-01 and 2017-01-02 and dtype=1; ...</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>é€šè¿‡ä½¿ç”¨å‰é¢çš„åˆ†åŒºç´¢å¼•ï¼Œåœ¨è¾“å…¥æ—¶é—´èŒƒå›´æˆ–ç‰¹å®šæ¡ä»¶ä»¥æ‰§è¡Œç©ºé—´æœç´¢åï¼Œå¯ä»¥å¿«é€Ÿå®šä½ç›®æ ‡æ•°æ®ã€‚</p><pre>select * from tbl  where crt_time between 2017-01-01 and 2017-01-02 -- Time  and (pos &lt;-&gt; ?) &lt; ? -- Distance to a point to be searched for  and dtype=0 -- Object condition  and ? -- Other conditions  order by pos &lt;-&gt; ? -- Sort by distance  limit ?; -- Number of results to be returned</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>è¯·æ³¨æ„ï¼Œå‰é¢çš„SQLæŸ¥è¯¢å¯ä»¥å®ç°æœ€ä½³æ€§èƒ½ä¼˜åŒ–ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ç´¢å¼•ç»„ç»‡å½¢å¼ï¼ˆæˆ–ç´¢å¼•ç»“æ„ï¼‰å¯ä»¥ç”±é€»è¾‘åˆ†åŒºé‡æ–°æ„é€ ï¼Œå¯ä»¥ç”¨ä¸Šè¿°ç±»ä¼¼çš„ç´¢å¼•åˆ›å»ºæ–¹æ³•è¦†ç›–æ‰€æœ‰æ¡ä»¶ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>CTIDç›¸äº¤é˜µåˆ—è¿æ¥æ‰«æ</p><p class=ql-align-justify><br></p><p class=ql-align-justify>å¦‚å‰æ‰€è¿°ï¼ŒBitmapAndå’ŒBitmapOråˆå¹¶æ‰«ææ˜¯åœ¨å¤šä¸ªç´¢å¼•æˆ–GINç´¢å¼•ä¸­è‡ªåŠ¨æ‰§è¡Œçš„ã€‚äº‹å®ä¸Šï¼Œè¿™ç§æ‰«æä¹Ÿå¯ä»¥åœ¨SQLä¸­æ˜¾å¼æ‰§è¡Œã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ¯ä¸ªæ¡ä»¶æ¸—é€å¯¹åº”çš„CTIDã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä½¿ç”¨Intersectæˆ–Unionç”Ÿæˆæ»¡è¶³æ€»ä½“éœ€æ±‚çš„CTIDã€‚ï¼ˆIntersectå¯¹åº”äºâ€œandâ€æ¡ä»¶ï¼›unionå¯¹åº”äºâ€œorâ€æ¡ä»¶ã€‚ï¼‰</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ç”Ÿæˆä¸€ä¸ªctidæ•°ç»„ã€‚</p><p class=ql-align-justify><br></p><div class=pgc-img><img alt=ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹ä¼ æˆç»™ä½ é«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12eec69480594db79a5c2452d716e5ea><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>ç¤ºä¾‹</strong></p><div class=pgc-img><img alt=ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹ä¼ æˆç»™ä½ é«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e465a19e0be74ec5a830bb3d44552fcb><p class=pgc-img-caption>å›¾ç‰‡æ¥æºï¼šunsplash.com/@markusspiske</p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>1. åˆ›å»ºå¯¹è±¡æè¦æ•°æ®è¡¨</p><pre>postgres=# create table tbl (id int, info text, crt_time timestamp, pos point, c1 int , c2 int, c3 int ); CREATE TABLE</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>2. å°†5000ä¸‡æ¡æµ‹è¯•æ•°æ®å†™å…¥è¡¨ä¸­</p><pre>postgres=# insert into tbl select generate_series(1,50000000), md5(random()::text), clock_timestamp(), point(180-random()*180, 90-random()*90), random()*10000, random()*5000, random()*1000; INSERT 0 50000000</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>3. åˆ›å»ºå¯¹è±¡ç´¢å¼•</p><pre>postgres=# create index idx_tbl_1 on tbl using gin (info, c1, c2, c3); CREATE INDEX</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>4. åˆ›å»ºæ—¶é—´ç´¢å¼•</p><pre>postgres=# create index idx_tbl_2 on tbl using btree (crt_time); CREATE INDEX</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>5. åˆ›å»ºç©ºé—´ç´¢å¼•</p><pre>postgres=# create index idx_tbl_3 on tbl using gist (pos); CREATE INDEX</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>6. ç”Ÿæˆæ•°æ®å¸ƒå±€ä»¥æ–¹ä¾¿åç»­æŸ¥è¯¢</p><pre>postgres=# select min(crt_time),max(crt_time),count(*) from tbl;  min | max | count ----------------------------+----------------------------+----------  2017-07-22 17:59:34.136497 | 2017-07-22 18:01:27.233688 | 50000000 (1 row)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>7. åˆ›å»ºä¸€ä¸ªæé™KNNæŸ¥è¯¢å‡½æ•°</p><pre>create or replace function ff(point, float8, int) returns setof tid as $declare  v_rec record;  v_limit int := $3; begin  set local enable_seqscan=off; -- Force index that exits when scanned rows reach a specific number  for v_rec in  select *,  (pos &lt;-&gt; $1) as dist,  ctid  from tbl  order by pos &lt;-&gt; $1  loop  if v_limit &lt;=0 then  -- raise notice "Sufficient data obtained"  return;  end if;  if v_rec.dist &gt; $2 then  -- raise notice "All matching points returned"  return;  else  return next v_rec.ctid;  end if;  v_limit := v_limit -1;  end loop; end; $ language plpgsql strict volatile; postgres=# select * from ff(point (100,100) ,100,100) ;  ff -------------  (407383,11)  (640740,9)  (26073,51)  (642750,34) ... (100 rows) Time: 1.061 ms</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>8. CTIDåˆå¹¶æ£€ç´¢</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ˜¾ç¤ºç¬¦åˆä»¥ä¸‹æ¡ä»¶çš„è®°å½•</p><pre>( c1 in (1,2,3,4,100,200,99,88,77,66,55)  or c2 &lt; 10 )  and pos &lt;-&gt; point (0,0) &lt; 5  and crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40 ;</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>é¦–å…ˆï¼Œåˆ†åˆ«æŸ¥çœ‹æ¯ä¸ªæ¡ä»¶ï¼Œæ‰¾åŒ¹é…ä¸€ä¸ªæ¡ä»¶çš„è®°å½•æ•°é‡ï¼Œä»¥åŠåœ¨ç´¢å¼•æ‰«æä¸Šæ‰€èŠ±æ—¶é•¿ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>1. 54,907æ¡è®°å½•</strong></p><pre>postgres=# explain (analyze,verbose,timing,costs,buffers) select * from tbl where c1 in (1,2,3,4,100,200,99,88,77,66,55);  QUERY PLAN -------------------------------------------------------------------------------------------------------------------------------  Bitmap Heap Scan on postgres.tbl (cost=820.07..65393.94 rows=54151 width=73) (actual time=23.842..91.911 rows=54907 loops=1)  Output: id, info, crt_time, pos, c1, c2, c3  Recheck Cond: (tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[]))  Heap Blocks: exact=52778  Buffers: shared hit=52866  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..806.54 rows=54151 width=0) (actual time=14.264..14.264 rows=54907 loops=1)  Index Cond: (tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[]))  Buffers: shared hit=88  Planning time: 0.105 ms  Execution time: 94.606 ms (10 rows)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>2. 95,147æ¡è®°å½•</strong></p><pre>postgres=# explain (analyze,verbose,timing,costs,buffers) select * from tbl where c2&lt;10;  QUERY PLAN ---------------------------------------------------------------------------------------------------------------------------------  Bitmap Heap Scan on postgres.tbl (cost=835.73..112379.10 rows=99785 width=73) (actual time=69.243..179.388 rows=95147 loops=1)  Output: id, info, crt_time, pos, c1, c2, c3  Recheck Cond: (tbl.c2 &lt; 10)  Heap Blocks: exact=88681  Buffers: shared hit=88734  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..810.79 rows=99785 width=0) (actual time=53.612..53.612 rows=95147 loops=1)  Index Cond: (tbl.c2 &lt; 10)  Buffers: shared hit=53  Planning time: 0.094 ms  Execution time: 186.201 ms (10 rows)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>3. 149930æ¡è®°å½•</strong>ï¼ˆä¸ºå¿«é€Ÿè·å¾—ç»“æœï¼ŒPostgreSQLä½¿ç”¨ä½å›¾è¿›è¡Œåˆå¹¶æ‰«æï¼‰</p><pre>postgres=# explain (analyze,verbose,timing,costs,buffers) select * from tbl where c1 in (1,2,3,4,100,200,99,88,77,66,55) or c2 &lt;10;  QUERY PLAN ------------------------------------------------------------------------------------------------------------------------------------  Bitmap Heap Scan on postgres.tbl (cost=1694.23..166303.58 rows=153828 width=73) (actual time=98.988..266.852 rows=149930 loops=1)  Output: id, info, crt_time, pos, c1, c2, c3  Recheck Cond: ((tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[])) OR (tbl.c2 &lt; 10))  Heap Blocks: exact=134424  Buffers: shared hit=134565  -&gt; BitmapOr (cost=1694.23..1694.23 rows=153936 width=0) (actual time=73.763..73.763 rows=0 loops=1)  Buffers: shared hit=141  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..806.54 rows=54151 width=0) (actual time=16.733..16.733 rows=54907 loops=1)  Index Cond: (tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[]))  Buffers: shared hit=88  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..810.79 rows=99785 width=0) (actual time=57.029..57.029 rows=95147 loops=1)  Index Cond: (tbl.c2 &lt; 10)  Buffers: shared hit=53  Planning time: 0.149 ms  Execution time: 274.548 ms (15 rows)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>4. 60,687æ¡è®°å½•</strong>ï¼ˆå³ä½¿è¿ç”¨å‡ºè‰²çš„KNNæ€§èƒ½ä¼˜åŒ–ï¼Œä»ç„¶éœ€è¦è€—è´¹195æ¯«ç§’ï¼‰ã€‚</p><pre>postgres=# explain (analyze,verbose,timing,costs,buffers) select * from ff(point (0,0) ,5,1000000);  QUERY PLAN ----------------------------------------------------------------------------------------------------------------------  Function Scan on postgres.ff (cost=0.25..10.25 rows=1000 width=6) (actual time=188.563..192.114 rows=60687 loops=1)  Output: ff  Function Call: ff( (0,0) ::point, 5 ::double precision, 1000000)  Buffers: shared hit=61296  Planning time: 0.029 ms  Execution time: 195.097 ms (6 rows)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>è®©æˆ‘ä»¬çœ‹çœ‹ä¸ä½¿ç”¨KNNä¼˜åŒ–éœ€è¦å¤šé•¿æ—¶é—´ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ç»“æœéå¸¸ä»¤äººæƒŠè®¶â€”â€”æé™ä¼˜åŒ–æ€§èƒ½æé«˜äº†ä¸€ä¸ªæ•°é‡çº§ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>5. 2,640,751æ¡è®°å½•</strong></p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä½¿ç”¨æ‰€æœ‰ç´¢å¼•é€ä¸ªæ‰«ææ•°æ®æ¡ä»¶ï¼Œå¾—åˆ°ctidå¹¶æ‰§è¡Œctidæ‰«æã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥åˆ†è§£è¿™ä¸ªè¿‡ç¨‹ï¼š</p><p class=ql-align-justify><br></p><p class=ql-align-justify>é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ—¶é—´å’Œå¯¹è±¡å±æ€§çš„åˆå¹¶æŸ¥è¯¢ï¼Œæˆæœéå¸¸æƒŠäººã€‚ä½¿ç”¨ä½å›¾BitmapOræ—¶ï¼ŒæŸ¥è¯¢å¯ä»¥è·³è¿‡å¤§å¤šæ•°æ•°æ®å—ï¼Œå¹¶ä¸”æ‰«ææ—¶é—´æ¯”å•ç´¢å¼•æ‰«æè¦çŸ­ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ³¨æ„ï¼Œåœ¨æ­¤æ­¥éª¤ä¸­è®°å½•çš„æ•°é‡å‡å°‘åˆ°7,847æ¡ã€‚</p><p class=ql-align-justify><br></p><pre>postgres=# explain (analyze,verbose,timing,costs,buffers) select ctid from tbl  where crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40  and (  c1 in (1,2,3,4,100,200,99,88,77,66,55)  or  c2 &lt; 10  );  QUERY PLAN -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------  Bitmap Heap Scan on postgres.tbl (cost=35025.85..44822.94 rows=7576 width=6) (actual time=205.577..214.821 rows=7847 loops=1)  Output: ctid  Recheck Cond: (((tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[])) OR (tbl.c2 &lt; 10)) AND (tbl.crt_time &gt;= 2017-07-22 17:59:34 ::timestamp without time zone) AND (tbl.crt_time &lt;= 2017-07-22 17:59:40 ::timestamp without time zone))  Heap Blocks: exact=6983  Buffers: shared hit=14343  -&gt; BitmapAnd (cost=35025.85..35025.85 rows=7581 width=0) (actual time=204.048..204.048 rows=0 loops=1)  Buffers: shared hit=7360  -&gt; BitmapOr (cost=1621.11..1621.11 rows=153936 width=0) (actual time=70.279..70.279 rows=0 loops=1)  Buffers: shared hit=141  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..806.54 rows=54151 width=0) (actual time=15.860..15.860 rows=54907 loops=1)  Index Cond: (tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[]))  Buffers: shared hit=88  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..810.79 rows=99785 width=0) (actual time=54.418..54.418 rows=95147 loops=1)  Index Cond: (tbl.c2 &lt; 10)  Buffers: shared hit=53  -&gt; Bitmap Index Scan on idx_tbl_2 (cost=0.00..33402.60 rows=2462443 width=0) (actual time=127.101..127.101 rows=2640751 loops=1)  Index Cond: ((tbl.crt_time &gt;= 2017-07-22 17:59:34 ::timestamp without time zone) AND (tbl.crt_time &lt;= 2017-07-22 17:59:40 ::timestamp without time zone))  Buffers: shared hit=7219  Planning time: 0.203 ms  Execution time: 216.697 ms (20 rows)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>ç„¶åï¼Œçœ‹KNNçš„æ‰«ææ—¶é—´ï¼š</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ³¨æ„ï¼Œ60,687æ¡è®°å½•æ»¡è¶³KNNè·ç¦»æ¡ä»¶ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°†è§£é‡ŠCTIDåˆå¹¶æ‰«æä¸åŸå§‹æ‰«æä¹‹é—´çš„æ€§èƒ½æ¯”è¾ƒã€‚</p><p class=ql-align-justify><br></p><pre>postgres=# explain (analyze,verbose,timing,costs,buffers) select * from ff(point (0,0) ,5,1000000);  QUERY PLAN ----------------------------------------------------------------------------------------------------------------------  Function Scan on postgres.ff (cost=0.25..10.25 rows=1000 width=6) (actual time=188.563..192.114 rows=60687 loops=1)  Output: ff  Function Call: ff( (0,0) ::point, 5 ::double precision, 1000000)  Buffers: shared hit=61296  Planning time: 0.029 ms  Execution time: 195.097 ms (6 rows)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>æœ€åï¼Œå°†è¿™äº›ç‰‡æ®µåˆå¹¶åˆ°ctidä¸­ã€‚</p><p class=ql-align-justify><br></p><pre>select * from ff(point (0,0) ,5,1000000)  intersect select ctid from tbl  where crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40  and (  c1 in (1,2,3,4,100,200,99,88,77,66,55)  or  c2 &lt; 10  );  ff ------------  (1394,8)  (3892,50)  (6124,45)  (7235,8)  (7607,45)  (11540,8)  (13397,31)  (14266,36)  (18149,7)  (19256,44)  (24671,62)  (26525,64)  (30235,48) (13 rows) Time: 463.012 ms</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>å–å¾—æœ€ç»ˆçºªå½•ã€‚</p><p class=ql-align-justify><br></p><pre>select * from tbl where ctid = any ( array( -- array start select * from ff(point (0,0) ,5,1000000) intersect select ctid from tbl  where crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40  and (  c1 in (1,2,3,4,100,200,99,88,77,66,55)  or  c2 &lt; 10  ) ) -- array end );  id | info | crt_time | pos | c1 | c2 | c3 ---------+----------------------------------+----------------------------+----------------------------------------+------+------+-----  104558 | c4699c933d4e2d2a10d828c4ff0b3362 | 2017-07-22 17:59:34.362508 | (4.20534582808614,2.43749532848597) | 99 | 4858 | 543  291950 | 1c2901689ab1eb7653d8ad972f7aa376 | 2017-07-22 17:59:34.776808 | (2.5384977646172,1.09820357523859) | 3 | 2131 | 360  459345 | 9e46548f29d914019ce53a589be8ebac | 2017-07-22 17:59:35.148699 | (0.715781506150961,3.1486327573657) | 1 | 1276 | 8  542633 | c422d6137f9111d5c2dc723b40c7023f | 2017-07-22 17:59:35.334278 | (0.0631888210773468,2.2334903664887) | 4968 | 3 | 245  570570 | fc57bfc6b7781d89b17c90417bd306f7 | 2017-07-22 17:59:35.39653 | (3.14926156774163,1.04107855819166) | 88 | 2560 | 561  865508 | 34509c7f7640afaf288a5e1d38199701 | 2017-07-22 17:59:36.052573 | (3.12869547866285,2.34822122845799) | 2 | 65 | 875  1004806 | afe9f88cbebf615a7ae5f41180c4b33f | 2017-07-22 17:59:36.362027 | (1.13972157239914,3.28763140831143) | 3 | 1639 | 208  1069986 | 6b9f27bfde993fb0bae3336ac010af7a | 2017-07-22 17:59:36.507775 | (4.51995821669698,2.08761331625283) | 2 | 200 | 355  1361182 | 7c4c1c208c2b2b21f00772c43955d238 | 2017-07-22 17:59:37.155127 | (1.7334086727351,2.18367457855493) | 9742 | 0 | 232  1444244 | 41bf6f8e4b89458c13fb408a7db05284 | 2017-07-22 17:59:37.339594 | (0.52773853763938,2.16670122463256) | 1 | 2470 | 820  1850387 | 6e0011c6db76075edd2aa7f81ec94129 | 2017-07-22 17:59:38.243091 | (0.0168232340365648,0.420973123982549) | 100 | 4395 | 321  1989439 | 6211907ac254a4a3ca54f90822a2095e | 2017-07-22 17:59:38.551637 | (0.0274275150150061,0.490507003851235) | 1850 | 5 | 74  2267673 | 898fdd54dcc5b14c27cf1c8b9afe2471 | 2017-07-22 17:59:39.170035 | (0.394239127635956,2.86229319870472) | 2892 | 6 | 917 (13 rows) Time: 462.715 ms</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>è¿‡ç¨‹èŠ±è´¹462æ¯«ç§’ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>9. æµ‹è¯•åŸå§‹SQLæŸ¥è¯¢çš„æ€§èƒ½: PostgreSQL Multi-Index BitmapAnd and BitmapOrè·³è¿‡æ‰«æ</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ç›´æ¥ç¼–å†™SQLæŸ¥è¯¢ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¤šCTIDæ‰«æã€‚</p><pre>postgres=# explain (analyze,verbose,timing,costs,buffers) select * from tbl  where  crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40  and (  c1 in (1,2,3,4,100,200,99,88,77,66,55)  or  c2 &lt; 10  )  and  pos &lt;-&gt; point (0,0) &lt; 5;  Bitmap Heap Scan on postgres.tbl (cost=35022.06..44857.06 rows=2525 width=73) (actual time=205.542..214.547 rows=13 loops=1)  Output: id, info, crt_time, pos, c1, c2, c3  Recheck Cond: (((tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[])) OR (tbl.c2 &lt; 10)) AND (tbl.crt_time &gt;= 2017-07-22 17:59:34 ::timestamp without time zone) AND (tbl.crt_time &lt;= 2017-07-22 17:59:40 ::timestamp without time zone))  Filter: ((tbl.pos &lt;-&gt; (0,0) ::point) &lt; 5 ::double precision)  Rows Removed by Filter: 7834  Heap Blocks: exact=6983  Buffers: shared hit=14343  -&gt; BitmapAnd (cost=35022.06..35022.06 rows=7581 width=0) (actual time=203.620..203.620 rows=0 loops=1)  Buffers: shared hit=7360  -&gt; BitmapOr (cost=1618.58..1618.58 rows=153936 width=0) (actual time=71.660..71.660 rows=0 loops=1)  Buffers: shared hit=141  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..806.54 rows=54151 width=0) (actual time=14.861..14.861 rows=54907 loops=1)  Index Cond: (tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[]))  Buffers: shared hit=88  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..810.79 rows=99785 width=0) (actual time=56.797..56.797 rows=95147 loops=1)  Index Cond: (tbl.c2 &lt; 10)  Buffers: shared hit=53  -&gt; Bitmap Index Scan on idx_tbl_2 (cost=0.00..33402.60 rows=2462443 width=0) (actual time=125.255..125.255 rows=2640751 loops=1)  Index Cond: ((tbl.crt_time &gt;= 2017-07-22 17:59:34 ::timestamp without time zone) AND (tbl.crt_time &lt;= 2017-07-22 17:59:40 ::timestamp without time zone))  Buffers: shared hit=7219  Planning time: 0.160 ms  Execution time: 216.797 ms (22 rows)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>æ€§èƒ½å¦‚é¢„æœŸçš„é‚£æ ·å¥½ï¼Œä¹‹å‰è§£é‡Šè¿‡åŸå› ã€‚KNNæ¡ä»¶ä»¥å¤–çš„æ¡ä»¶å·²ç»å°†ç»“æœæ”¶æ•›åˆ°7,000æ¡è®°å½•ï¼Œå› æ­¤æ²¡æœ‰å¿…è¦ä½¿ç”¨åŒ…å«KNNæ¡ä»¶çš„ç´¢å¼•ã€‚ï¼ˆå³ä½¿ä½¿ç”¨KNNç´¢å¼•ä¹Ÿéœ€è¦195æ¯«ç§’ï¼Œå› ä¸ºæœ‰60,687æ¡è®°å½•æ»¡è¶³KNNæ¡ä»¶ã€‚ï¼‰</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ ¡éªŒç»“æœï¼š</p><pre>select * from tbl  where  crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40  and (  c1 in (1,2,3,4,100,200,99,88,77,66,55)  or  c2 &lt; 10  )  and  pos &lt;-&gt; point (0,0) &lt; 5;  id | info | crt_time | pos | c1 | c2 | c3 ---------+----------------------------------+----------------------------+----------------------------------------+------+------+-----  104558 | c4699c933d4e2d2a10d828c4ff0b3362 | 2017-07-22 17:59:34.362508 | (4.20534582808614,2.43749532848597) | 99 | 4858 | 543  291950 | 1c2901689ab1eb7653d8ad972f7aa376 | 2017-07-22 17:59:34.776808 | (2.5384977646172,1.09820357523859) | 3 | 2131 | 360  459345 | 9e46548f29d914019ce53a589be8ebac | 2017-07-22 17:59:35.148699 | (0.715781506150961,3.1486327573657) | 1 | 1276 | 8  542633 | c422d6137f9111d5c2dc723b40c7023f | 2017-07-22 17:59:35.334278 | (0.0631888210773468,2.2334903664887) | 4968 | 3 | 245  570570 | fc57bfc6b7781d89b17c90417bd306f7 | 2017-07-22 17:59:35.39653 | (3.14926156774163,1.04107855819166) | 88 | 2560 | 561  865508 | 34509c7f7640afaf288a5e1d38199701 | 2017-07-22 17:59:36.052573 | (3.12869547866285,2.34822122845799) | 2 | 65 | 875  1004806 | afe9f88cbebf615a7ae5f41180c4b33f | 2017-07-22 17:59:36.362027 | (1.13972157239914,3.28763140831143) | 3 | 1639 | 208  1069986 | 6b9f27bfde993fb0bae3336ac010af7a | 2017-07-22 17:59:36.507775 | (4.51995821669698,2.08761331625283) | 2 | 200 | 355  1361182 | 7c4c1c208c2b2b21f00772c43955d238 | 2017-07-22 17:59:37.155127 | (1.7334086727351,2.18367457855493) | 9742 | 0 | 232  1444244 | 41bf6f8e4b89458c13fb408a7db05284 | 2017-07-22 17:59:37.339594 | (0.52773853763938,2.16670122463256) | 1 | 2470 | 820  1850387 | 6e0011c6db76075edd2aa7f81ec94129 | 2017-07-22 17:59:38.243091 | (0.0168232340365648,0.420973123982549) | 100 | 4395 | 321  1989439 | 6211907ac254a4a3ca54f90822a2095e | 2017-07-22 17:59:38.551637 | (0.0274275150150061,0.490507003851235) | 1850 | 5 | 74  2267673 | 898fdd54dcc5b14c27cf1c8b9afe2471 | 2017-07-22 17:59:39.170035 | (0.394239127635956,2.86229319870472) | 2892 | 6 | 917 (13 rows)</pre><p class=ql-align-justify><br></p><div class=pgc-img><img alt=ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹ä¼ æˆç»™ä½ é«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12eec69480594db79a5c2452d716e5ea><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>åˆ†åŒºç´¢å¼•ç¤ºä¾‹</strong></p><p class=ql-align-justify><br></p><p class=ql-align-justify>å‡è®¾å‰é¢çš„æŸ¥è¯¢æ¡ä»¶ä¿æŒä¸å˜ï¼Œä½¿ç”¨åˆ†åŒºç´¢å¼•æ¥æµ‹è¯•æ€§èƒ½ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>è¿™æ˜¯ä¸ºäº†æ¼”ç¤ºåˆ†åŒºç´¢å¼•çš„æç«¯æ•ˆæœã€‚åœ¨å®é™…åœºæ™¯ä¸­ï¼Œé›†åˆçº§åˆ«å¯èƒ½æ²¡æœ‰é‚£ä¹ˆé«˜ï¼ˆä¾‹å¦‚æŒ‰å¤©é›†åˆæˆ–æŒ‰IDæ•£åˆ—é›†åˆï¼‰ã€‚åªè¦é›†åˆæ˜¯å¯èƒ½çš„ï¼Œå°±å¯ä»¥å±•ç°å‡ºè‰²çš„æ€§èƒ½ã€‚</p><pre>postgres=# create index idx_tbl_4 on tbl using gist (pos) where crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40  and (  c1 in (1,2,3,4,100,200,99,88,77,66,55)  or  c2 &lt; 10  ) ; CREATE INDEX Time: 8359.330 ms (00:08.359)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>é‡æ„æå€¼KNNä¼˜åŒ–å‡½æ•°</p><pre>create or replace function ff(point, float8, int) returns setof record as $declare  v_rec record;  v_limit int := $3; begin  set local enable_seqscan=off; -- Force index that exits when scanned rows reach a specific number  for v_rec in  select *,  (pos &lt;-&gt; $1) as dist  from tbl  where  crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40  and (  c1 in (1,2,3,4,100,200,99,88,77,66,55)  or  c2 &lt; 10  )  order by pos &lt;-&gt; $1  loop  if v_limit &lt;=0 then  -- raise notice "Sufficient data obtained"  return;  end if;  if v_rec.dist &gt; $2 then  -- raise notice "All matching points returned"  return;  else  return next v_rec;  end if;  v_limit := v_limit -1;  end loop; end; $ language plpgsql strict volatile;</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>æŸ¥è¯¢æ€§èƒ½ï¼š</p><pre>postgres=# select * from ff(point (0,0) , 5, 10000000) as t(id int, info text, crt_time timestamp, pos point, c1 int, c2 int, c3 int, dist float8);  id | info | crt_time | pos | c1 | c2 | c3 | dist ---------+----------------------------------+----------------------------+----------------------------------------+------+------+-----+-------------------  1850387 | 6e0011c6db76075edd2aa7f81ec94129 | 2017-07-22 17:59:38.243091 | (0.0168232340365648,0.420973123982549) | 100 | 4395 | 321 | 0.421309141034319  1989439 | 6211907ac254a4a3ca54f90822a2095e | 2017-07-22 17:59:38.551637 | (0.0274275150150061,0.490507003851235) | 1850 | 5 | 74 | 0.49127323294376  1444244 | 41bf6f8e4b89458c13fb408a7db05284 | 2017-07-22 17:59:37.339594 | (0.52773853763938,2.16670122463256) | 1 | 2470 | 820 | 2.23004532710301  542633 | c422d6137f9111d5c2dc723b40c7023f | 2017-07-22 17:59:35.334278 | (0.0631888210773468,2.2334903664887) | 4968 | 3 | 245 | 2.23438404136508  291950 | 1c2901689ab1eb7653d8ad972f7aa376 | 2017-07-22 17:59:34.776808 | (2.5384977646172,1.09820357523859) | 3 | 2131 | 360 | 2.76586731309247  1361182 | 7c4c1c208c2b2b21f00772c43955d238 | 2017-07-22 17:59:37.155127 | (1.7334086727351,2.18367457855493) | 9742 | 0 | 232 | 2.78803520274409  2267673 | 898fdd54dcc5b14c27cf1c8b9afe2471 | 2017-07-22 17:59:39.170035 | (0.394239127635956,2.86229319870472) | 2892 | 6 | 917 | 2.88931598221975  459345 | 9e46548f29d914019ce53a589be8ebac | 2017-07-22 17:59:35.148699 | (0.715781506150961,3.1486327573657) | 1 | 1276 | 8 | 3.22896754478952  570570 | fc57bfc6b7781d89b17c90417bd306f7 | 2017-07-22 17:59:35.39653 | (3.14926156774163,1.04107855819166) | 88 | 2560 | 561 | 3.31688000783581  1004806 | afe9f88cbebf615a7ae5f41180c4b33f | 2017-07-22 17:59:36.362027 | (1.13972157239914,3.28763140831143) | 3 | 1639 | 208 | 3.47958123047986  865508 | 34509c7f7640afaf288a5e1d38199701 | 2017-07-22 17:59:36.052573 | (3.12869547866285,2.34822122845799) | 2 | 65 | 875 | 3.91188935630676  104558 | c4699c933d4e2d2a10d828c4ff0b3362 | 2017-07-22 17:59:34.362508 | (4.20534582808614,2.43749532848597) | 99 | 4858 | 543 | 4.86069100130757  1069986 | 6b9f27bfde993fb0bae3336ac010af7a | 2017-07-22 17:59:36.507775 | (4.51995821669698,2.08761331625283) | 2 | 200 | 355 | 4.97877009299311 (13 rows) Time: 0.592 ms</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>å¤ªæ£’äº†ï¼æŸ¥è¯¢æ—¶é—´ä»200æ¯«ç§’å‡å°‘åˆ°1æ¯«ç§’ä»¥å†…ã€‚</p><p class=ql-align-justify><br></p><div class=pgc-img><img alt=ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹ä¼ æˆç»™ä½ é«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12eec69480594db79a5c2452d716e5ea><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>ä¼˜åŒ–æ–¹æ³•ç»¼è¿°</strong></p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä¼˜åŒ–æ–¹æ³•å›é¡¾ï¼š</p><p class=ql-align-justify><br></p><p class=ql-align-justify>1. ä¸ºä¸åŒçš„æ•°æ®ç±»å‹æ„å»ºä¸åŒçš„ç´¢å¼•ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä¾‹å¦‚ï¼Œå¯¹ç©ºé—´ä½¿ç”¨GiSTæˆ–SP-GiSTç´¢å¼•ï¼Œå¯¹æ—¶é—´ä½¿ç”¨Bæ ‘æˆ–BRINç´¢å¼•ï¼Œå¯¹å¤šä¸ªå¯¹è±¡å±æ€§ä½¿ç”¨GINç´¢å¼•ã€‚ç´¢å¼•çš„ç›®çš„æ˜¯ç¼©å°æ•°æ®æ‰«æçš„èŒƒå›´ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>2. æ–¹æ³•äº”æåˆ°æ•°æ®åˆ†åŒºã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ•°æ®åˆ†åŒºçš„ç›®çš„æ˜¯æœ‰æ„åœ°ç»„ç»‡æ•°æ®ï¼Œè¿™æ„å‘³ç€æœ‰æ„åœ°ç»„ç»‡æ•°æ®ä»¥æ»¡è¶³æœç´¢éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ—¶é—´æ˜¯å¿…éœ€çš„æŸ¥è¯¢æ¡ä»¶æˆ–å…¬å…±æŸ¥è¯¢æ¡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥æŒ‰æ—¶é—´ï¼ˆåˆ†åŒºï¼‰åˆ†å‰²æ•°æ®ï¼Œä»¥å‡å°‘éœ€è¦æ‰«æçš„æ•°æ®é‡ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>3. æ–¹æ³•å…­æè¿°äº†ç´¢å¼•åˆ†åŒºã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ç›®çš„ç±»ä¼¼äºæ–¹æ³•äº”ã€‚æ–¹æ³•äº”å’Œæ–¹æ³•å…­çš„åŒºåˆ«åœ¨äºåˆ†åŒºåœ¨ç´¢å¼•çº§åˆ«ä½¿ç”¨ï¼Œå› æ­¤å½“æ‰§è¡Œç´¢å¼•æ‰«ææ—¶ï¼Œæ•°æ®å‘½ä¸­ç‡ä¼šç›´æ¥æé«˜ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>4.æ–¹æ³•ä¸ƒä¸­çš„ctidåˆå¹¶æ‰«æç±»ä¼¼äºPostgreSQLä¸­çš„å¤šç´¢å¼•bitmapAndæˆ–bitmapOræ‰«æã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>bitmapAnd/bitmapOrè·³è¿‡ä¸éœ€è¦æ‰«æçš„å—ï¼Œæ–¹æ³•ä¸ƒä¸­çš„ctidåˆå¹¶æ‰«æè·³è¿‡ä¸éœ€è¦æ‰«æçš„è¡Œã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>åˆå¹¶ä»å¤šä¸ªç´¢å¼•æ‰«æè·å¾—çš„ctidã€‚è·³è¿‡ä¸éœ€è¦æ‰«æçš„è¡Œæ•°ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>å¦‚æœå½“å…¶ä»–æ¡ä»¶ä¸ºâ€œANDâ€æ—¶ï¼Œè¿‡æ»¤æ¡ä»¶å¯ä»¥æ˜¾è‘—å‡å°‘ctidï¼ˆè®°å½•ï¼‰ï¼Œåˆ™æ²¡æœ‰å¿…è¦ä½¿ç”¨ctidåˆå¹¶æ‰«æã€‚ç›¸åï¼Œä½¿ç”¨FILTERä½œä¸ºå¦ä¸€ä¸ªæ¡ä»¶ã€‚ï¼ˆè¿™å°†ç•¥å¾®å¢åŠ CPUå¼€é”€ã€‚ï¼‰</p><p class=ql-align-justify><br></p><p class=ql-align-justify>5. æœ€å¥½çš„åŠŸå¤«æ€»æ˜¯ä»¥æœ€å¤§çš„çµæ´»æ€§ã€è‡ªç”±å’Œå¯¹æ¯ä¸€ä¸ªåŠ¨ä½œçš„æ— é™æƒ³è±¡ä¸ºç‰¹å¾ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>PostgreSQLå®ç°å¤šç´¢å¼•BitmapAndæˆ–BitmapOræ‰«æï¼Œæ˜¾è‘—æé«˜äº†å¤šç§æ¡ä»¶ï¼ˆç´¢å¼•ï¼‰ä¸‹çš„æ•°æ®å‘½ä¸­ç‡ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ­¤å¤–ï¼ŒPostgreSQLå…·æœ‰å‡ºè‰²çš„CBOä¼°è®¡æœºåˆ¶ï¼Œå®ƒå…è®¸PostgreSQLä¸æ€»æ˜¯ä½¿ç”¨ä½å›¾åˆå¹¶æ‰«æçš„æ‰€æœ‰ç´¢å¼•ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨â€œæµ‹è¯•åŸå§‹SQLæŸ¥è¯¢çš„æ€§èƒ½â€”â€”PostgreSQLå¤šç´¢å¼•BitmapAndä½å›¾æˆ–è·³è¿‡æ‰«æâ€ä¸€èŠ‚ä¸­æè¿°çš„æ€§èƒ½æ›´å¥½ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>6. å¦‚ä½•å®ç°æç«¯ä¼˜åŒ–</p><p class=ql-align-justify><br></p><p class=ql-align-justify>é‡‡ç”¨æ–¹æ³•äº”æˆ–å…­ï¼Œå¹¶ä½¿ç”¨å¯ä¿®å¤çš„æ¡ä»¶ä½œä¸ºåˆ†åŒºé”®æ¥åˆ†åŒºæ•°æ®æˆ–ç´¢å¼•ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>å¯¹äºå…¶ä»–æ¡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨PostgreSQLä¸­çš„å¤šç´¢å¼•BitmapAndæˆ–BitmapOræ‰«ææ¥æé«˜å¤šæ¡ä»¶ï¼ˆç´¢å¼•ï¼‰çš„æ•°æ®å‘½ä¸­ç‡ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒæŒ‰ç…§æ—¶é—´ã€ç©ºé—´å’Œå¯¹è±¡å±æ€§ä»5,000ä¸‡æ•°æ®å—ä¸­è¿›è¡Œå¤šç»´æ£€ç´¢æ‰€éœ€çš„æ—¶é—´å‡å°‘åˆ°äº†0.592æ¯«ç§’ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>7. å¯¹äºç©ºé—´æ•°æ®ï¼Œé™¤äº†ä½¿ç”¨GiSTç´¢å¼•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨BRINç´¢å¼•ï¼Œè¿™é™ä½äº†æˆæœ¬ã€‚æœ‰æ¡ç†åœ°ç»„ç»‡æ•°æ®åï¼Œä¼šä½¿æ»¤æ³¢æ€§èƒ½è‰¯å¥½ã€‚</p><p class=ql-align-justify><br></p><div class=pgc-img><img alt=ç”¨è¯¦ç»†çš„ä»£ç ï¼Œæ‰‹æŠŠæ‰‹ä¼ æˆç»™ä½ é«˜æ•ˆæœç´¢æ³•çš„ç»æŠ€ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fb8e52a4a8b948939d158b49ce53b8a2><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>ç•™è¨€ ç‚¹èµ å…³æ³¨</strong></p><p class=ql-align-center><strong>æˆ‘ä»¬ä¸€èµ·åˆ†äº«AIå­¦ä¹ ä¸å‘å±•çš„å¹²è´§</strong></p><p>ç¼–è¯‘ç»„ï¼šæç¾å°¼ã€ä½™ä¹¦æ•</p><p>ç›¸å…³é“¾æ¥ï¼š</p><p>https://dzone.com/articles/efficient-search-on-massive-data-with-multidimensi</p><p>å¦‚éœ€è½¬è½½ï¼Œè¯·åå°ç•™è¨€ï¼Œéµå®ˆè½¬è½½è§„èŒƒ</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'è¯¦ç»†','ä»£ç ','ä¼ æˆç»™'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>