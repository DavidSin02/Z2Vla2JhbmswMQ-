<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ä»JVMå±‚é¢å¸¦ä½ åˆ†æJavaçš„Objectç±»æºç ç¬¬ä¸€éƒ¨åˆ† | æå®¢å¿«è¨Š</title><meta property="og:title" content="ä»JVMå±‚é¢å¸¦ä½ åˆ†æJavaçš„Objectç±»æºç ç¬¬ä¸€éƒ¨åˆ† - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/816b04b7.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/816b04b7.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/816b04b7.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/816b04b7.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/816b04b7.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/816b04b7.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/816b04b7.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/816b04b7.html><meta property="article:published_time" content="2020-11-14T21:08:08+08:00"><meta property="article:modified_time" content="2020-11-14T21:08:08+08:00"><meta name=Keywords content><meta name=description content="ä»JVMå±‚é¢å¸¦ä½ åˆ†æJavaçš„Objectç±»æºç ç¬¬ä¸€éƒ¨åˆ†"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/816b04b7.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ä»JVMå±‚é¢å¸¦ä½ åˆ†æJavaçš„Objectç±»æºç ç¬¬ä¸€éƒ¨åˆ†</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p><strong>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°å›¾çµè§†ç•Œï¼Œæœ€è¿‘åœ¨åˆ†æJava8æºç ï¼Œä½¿ç”¨çš„JDKæ˜¯OpenJDK8,æ‰“ç®—å°†åˆ†ææºç çš„ç¬”è®°éƒ½ä¼šåˆ†äº«å‡ºæ¥ï¼Œåœ¨å¤´æ¡ä¸Šä»£ç æ’ç‰ˆæ¯”è¾ƒéš¾çœ‹ï¼Œæƒ³è¦ç¬”è®°çš„å¯ä»¥å…³æ³¨å¹¶ç§ä¿¡æˆ‘ã€‚</strong></p><p><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6814477971127009803/?group_id=6814477971127009803" rel="noopener noreferrer" target=_blank>ä»JVMå±‚é¢å¸¦ä½ åˆ†æJavaçš„Objectç±»æºç ç¬¬äºŒéƒ¨åˆ†</a></p><h1 class=pgc-h-arrow-right>Object æºç </h1><p><strong>ä½ç½®ï¼šjava.langåŒ…</strong></p><p><strong>Objectç±»æ˜¯Javaä¸­æœ€åŸºæœ¬çš„ç±»ï¼Œæ˜¯æ‰€æœ‰ç±»çš„æ ¹ã€‚ä¹Ÿå°±è¯´ï¼Œæ‰€æœ‰çš„ç±»é»˜è®¤éƒ½ä¼šç»§æ‰¿å®ƒï¼ŒåŒ…æ‹¬æ•°ç»„ç­‰ï¼Œéƒ½è¦ç»§æ‰¿Objectä¸­çš„æ‰€æœ‰æ–¹æ³•</strong>ã€‚Objectç±»ä¸­å¤§å¤šæ•°éƒ½æ˜¯nativeæ–¹æ³•ï¼Œnativeå°±æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œç”±å…³é”®nativeå­—ä¿®é¥°ï¼Œè¿™äº›æ–¹æ³•ä¸åœ¨javaè¯­è¨€ä¸­å®ç°ï¼Œ<strong>åº•å±‚å®ç°æ˜¯çš„c/c++ä»£ç </strong>ã€‚ä¸»è¦çš„nativeæ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code>//åŠ è½½æœ¬åœ°æ–¹æ³•private static native void registerNatives();//è·å–å¯¹è±¡çš„ç±»å‹ Classpublic final native Class&lt;?&gt; getClass();//è·å–hashç  public native int hashCode();//å¯¹è±¡æ‹·è´protected native Object clone() throws CloneNotSupportedException;//è·Ÿçº¿ç¨‹æœ‰å…³çš„æ–¹æ³•//å”¤é†’çº¿ç¨‹public final native void notify();//å”¤é†’æ‰€æœ‰çš„çº¿ç¨‹public final native void notifyAll();//çº¿ç¨‹ç­‰å¾…public final native void wait(long timeout) throws InterruptedException;</code></pre><h1 class=pgc-h-arrow-right>private static native void registerNatives()</h1><p>åœ¨Objectç±»ä¸­ï¼Œæœ‰staticä»£ç å—ï¼Œè¿™ä¸ªé™æ€ä»£ç å—è°ƒç”¨äº†registerNatives()æ–¹æ³•ï¼š</p><pre><code>private static native void registerNatives();static {    registerNatives();}</code></pre><p><strong>registerNativesæ–¹æ³•çš„ä½œç”¨æ˜¯åŠ è½½å’Œæ³¨å†Œæœ¬åœ°Cã€C++è¯­è¨€å‡½æ•°ï¼Œå°†Javaçš„æœ¬åœ°æ–¹æ³•ä¸JVMåº•å±‚çš„Cã€C++è¯­è¨€å‡½æ•°å¯¹åº”èµ·æ¥ï¼Œæ˜¯è¿æ¥javaè¯­è¨€ä¸åº•å±‚è¯­è¨€çš„æ¡¥æ¢ï¼ŒregisterNativesæ–¹æ³•åœ¨å…¶ä»–ç±»ä¸­ä¹Ÿå¯èƒ½å­˜åœ¨ï¼Œå¦‚Classç±»</strong>ã€‚Javaç±»çš„æœ¬åœ°æ–¹æ³•å¯¹åº”Cã€C++å‡½æ•°çš„è§„åˆ™æ˜¯Java_åŒ…å_æ–¹æ³•å,åŒ…åä»¥ä¸‹åˆ’çº¿åˆ†éš”ï¼ŒObjectç±»çš„registerNativeså¯¹åº”ç€Cè¯­è¨€å‡½æ•°æ˜¯Java_java_lang_Object_registerNativesï¼Œjava_lang_Objectæ˜¯javaå…¨ç±»åä»¥ä¸‹åˆ’çº¿è¿æ¥ï¼ŒregisterNativesæ˜¯Javaä¸­çš„æ–¹æ³•ï¼Œå…¶ä¸­Java_java_lang_Object_registerNativesè¿™ä¸ªCè¯­è¨€å‡½æ•°å¦‚ä¸‹ï¼š</p><pre><code>static JNINativeMethod methods[] = {    {&#34;hashCode&#34;,    &#34;()I&#34;,                    (void *)&JVM_IHashCode},    {&#34;wait&#34;,        &#34;(J)V&#34;,                   (void *)&JVM_MonitorWait},    {&#34;notify&#34;,      &#34;()V&#34;,                    (void *)&JVM_MonitorNotify},    {&#34;notifyAll&#34;,   &#34;()V&#34;,                    (void *)&JVM_MonitorNotifyAll},    {&#34;clone&#34;,       &#34;()Ljava/lang/Object;&#34;,   (void *)&JVM_Clone},};JNIEXPORT void JNICALLJava_java_lang_Object_registerNatives(JNIEnv *env, jclass cls){    (*env)-&gt;RegisterNatives(env, cls,                            methods, sizeof(methods)/sizeof(methods[0]));}</code></pre><p>Java_java_lang_Object_registerNativesä¸»è¦æ˜¯æ³¨å†ŒObjectç±»çš„hashCodeã€waitã€notifyã€notifyAllã€cloneç­‰æ–¹æ³•ï¼Œè€ŒgetClassæ–¹æ³•å´ä¸åœ¨è¿™é‡ŒåŠ è½½ã€‚åœ¨Objectç±»ä¸­ï¼Œè¿™äº›æœ¬åœ°æ–¹æ³•ä¸æ˜¯åœ¨Javaå±‚é¢å®ç°çš„ï¼Œæ‰€æœ‰åœ¨è°ƒç”¨è¿™äº›æ–¹æ³•çš„æ—¶å€™ï¼Œæ˜¯è°ƒç”¨äº†åº•å±‚è¯­è¨€çš„å…·ä½“å®ç°ã€‚</p><p>åœ¨methods[]æ•°ç»„ä¸­ï¼Œæœ‰å¤šä¸ªJavaæœ¬åœ°æ–¹æ³•å¯¹åº”JVMå±‚é¢çš„å‡½æ•°ï¼Œå¦‚Objectä¸­hashCodeæ–¹æ³•å¯¹åº”JVMä¸­çš„JVM_IHashCodeå‡½æ•°ï¼Œè¿”å›çš„ç±»å‹æ˜¯()Iï¼Œå³è¿”å›çš„æ˜¯æ•´æ•°ç±»å‹ã€‚</p><h1 class=pgc-h-arrow-right>public final native Class&lt;?> getClass()</h1><p>getClass()æ–¹æ³•çš„ä½œç”¨æ˜¯è¿”å›å¯¹è±¡è¿è¡Œæ—¶çš„Classç±»å‹ï¼Œjavaç¼–è¯‘ä¼šå°†javaç±»ç¼–è¯‘æˆä»¥.classç»“å°¾çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ç¼–è¯‘ç”Ÿæˆçš„äºŒè¿›åˆ¶å­—èŠ‚ç æ–‡ä»¶ï¼Œç”¨äºJVMåŠ è½½ï¼ŒJavaè·¨å¹³å°æ˜¯å› ä¸ºä½¿ç”¨ä¸å¹³å°æ— å…³çš„classäºŒè¿›åˆ¶å­—èŠ‚ç æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡Jjavaä¸­çš„Classç±»è·å–å¯¹è±¡çš„æ„é€ å™¨ã€æ–¹æ³•ã€å±æ€§ã€æ³¨è§£ç­‰ç›¸å…³ä¿¡æ¯ï¼š</p><pre><code>Object object=new Object();System.out.println(object.getClass());Class&lt;?&gt; objectClass=object.getClass();//æ„é€ å™¨Constructor&lt;?&gt;[] constructors=objectClass.getConstructors();System.out.println(&#34;Object ç±»çš„æ„é€ å™¨ï¼š&#34;);for (Constructor constructor:constructors){        System.out.print(constructor); }//æ–¹æ³•Method[] methods=objectClass.getMethods();System.out.println(&#34;Object ç±»çš„æ–¹æ³•ï¼š&#34;);for (Method method:methods){      System.out.println(method);}//å±æ€§Field[] fields=objectClass.getFields();System.out.println(&#34;Object ç±»çš„å±æ€§ï¼š&#34;);for (Field field:fields){       System.out.println(field);}</code></pre><p>getClassæ–¹æ³•å¯¹åº”çš„åº•å±‚Cè¯­è¨€å‡½æ•°ä¸ºJava_java_lang_Object_getClassï¼Œå…·ä½“å®ç°ä¸ºï¼š</p><pre><code>JNIEXPORT jclass JNICALLJava_java_lang_Object_getClass(JNIEnv *env, jobject this){    if (this == NULL) {        JNU_ThrowNullPointerException(env, NULL);        return 0;    } else {        return (*env)-&gt;GetObjectClass(env, this);    }}</code></pre><p>å½“ä¼ å…¥çš„å¯¹è±¡thisä¸ºnullï¼Œç›´æ¥æŠ›å‡ºNullPointerExceptionå¼‚å¸¸ï¼Œå¦åˆ™è°ƒç”¨GetObjectClasså‡½æ•°,GetObjectClasså‡½æ•°å¦‚ä¸‹ï¼š</p><pre><code>JNI_ENTRY(jclass, jni_GetObjectClass(JNIEnv *env, jobject obj))  JNIWrapper(&#34;GetObjectClass&#34;);#ifndef USDT2  DTRACE_PROBE2(hotspot_jni, GetObjectClass__entry, env, obj);#else /* USDT2 */  HOTSPOT_JNI_GETOBJECTCLASS_ENTRY(env, obj);#endif /* USDT2 *///ä¸»è¦ä½œç”¨æ˜¯æ ¹æ®javaå¯¹è±¡å¼•ç”¨æ‰¾åˆ°JVMä¸­å¼•ç”¨å¯¹è±¡ï¼Œå°†Javaå¯¹è±¡è½¬æ¢ä¸ºJVMä¸­çš„å¼•ç”¨å¯¹è±¡ï¼Œç„¶åè°ƒç”¨klass()æ–¹æ³•æ‰¾åˆ°å…ƒæ•°æ®  Klass* k = JNIHandles::resolve_non_null(obj)-&gt;klass();  jclass ret =(jclass) JNIHandles::make_local(env, k-&gt;java_mirror());#ifndef USDT2  DTRACE_PROBE1(hotspot_jni, GetObjectClass__return, ret);#else /* USDT2 */  HOTSPOT_JNI_GETOBJECTCLASS_RETURN(                                    ret);#endif /* USDT2 */  return ret;JNI_END</code></pre><p>ä¸Šè¿°çš„æ ¸å¿ƒä»£ç ä¸º:</p><pre><code>Klass* k = JNIHandles::resolve_non_null(obj)-&gt;klass();</code></pre><p>resolve_non_nullæ–¹æ³•ä¸»è¦ä½œç”¨æ˜¯æ ¹æ®javaå¯¹è±¡å¼•ç”¨æ‰¾åˆ°JVMä¸­å¼•ç”¨å¯¹è±¡oopï¼Œå°†Javaå¯¹è±¡è½¬æ¢ä¸ºJVMä¸­çš„å¼•ç”¨å¯¹è±¡ï¼Œç„¶åè°ƒç”¨klass()æ–¹æ³•æ‰¾åˆ°å…ƒæ•°æ®ï¼Œresolve_non_nullçš„æ–¹æ³•ä¸ºï¼š</p><pre><code>inline oop JNIHandles::resolve_non_null(jobject handle) {  assert(handle != NULL, &#34;JNI handle should not be null&#34;);  oop result = *(oop*)handle;  assert(result != NULL, &#34;Invalid value read from jni handle&#34;);  assert(result != badJNIHandle, &#34;Pointing to zapped jni handle area&#34;);  // Don&#39;t let that private _deleted_handle object escape into the wild.  assert(result != deleted_handle(), &#34;Used a deleted global handle.&#34;);  return result;};</code></pre><p>resolve_non_nullæ–¹æ³•çš„æ ¸å¿ƒä»£ç æ˜¯oop result = (oop)handle;è¿™å¥ä»£ç çš„æ„æ€æ˜¯å…ˆå°†ä¼ å…¥çš„Javaå¯¹è±¡è½¬ä¸ºoopå®ä¾‹ï¼Œï¼ˆ(oop*)handleï¼‰ï¼Œç„¶åå†è·å–oopçš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆå°±æ˜¯å¼•ç”¨å¯¹è±¡å®ä¾‹çš„åœ°å€ï¼ˆ*(oop*)handleï¼‰ã€‚ç„¶åè°ƒç”¨klass()è·å–å¯¹è±¡å®ä¾‹æ‰€å±çš„å…ƒæ•°æ®Klassï¼ŒKlassæ˜¯æŒ‡å‘Classç±»å‹çš„æŒ‡é’ˆã€‚</p><pre><code>inline Klass* oopDesc::klass() const {  if (UseCompressedClassPointers) {    return Klass::decode_klass_not_null(_metadata._compressed_klass);  } else {  //è¿”å›å…ƒæ•°æ®    return _metadata._klass;  }}</code></pre><p>jclass ret =(jclass) JNIHandles::make_local(env, k->java_mirror())åˆ†ä¸ºä¸¤æ­¥ï¼Œå…ˆè°ƒç”¨Klassçš„java_mirror()æ–¹æ³•ï¼Œjava_mirroræ–¹æ³•çš„ä½œç”¨æ˜¯è¿”å›Klasså…ƒæ•°æ®çš„é•œåƒï¼ˆoopï¼‰ï¼Œå¯¹åº”ç€jjava/lang/Classç±»çš„å®ä¾‹ï¼Œava_mirroræ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code> // java/lang/Class instance mirroring this classoop       _java_mirror;oop java_mirror() const              { return _java_mirror; }</code></pre><p>æœ€åé€šè¿‡ JNIHandles::make_localå¤„ç†oopï¼Œç„¶åè¿”å›å¤„ç†è¿‡åçš„oop,make_localçš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>jobject JNIHandles::make_local(oop obj) {  if (obj == NULL) {      //è¿”å›null    return NULL;                // ignore null handles  } else {     //è·å–å½“å‰çº¿ç¨‹    Thread* thread = Thread::current();    assert(Universe::heap()-&gt;is_in_reserved(obj), &#34;sanity check&#34;);     //åˆ©ç”¨å½“å‰çº¿ç¨‹æ´»è·ƒçš„handleså¯¹oopè¿›è¡Œå¤„ç†ã€‚    return thread-&gt;active_handles()-&gt;allocate_handle(obj);  }}</code></pre><p>åœ¨JNIHandles::make_localå‡½æ•°ä¸­ï¼Œå½“ä¼ å…¥çš„oopå®ä¾‹objä¸ºç©ºæ—¶ï¼Œç›´æ¥è¿”å›ç©ºï¼Œå¦åˆ™å°†å¤„ç†è¿‡çš„ç»“æœã€‚</p><h1 class=pgc-h-arrow-right>public native int hashCode()</h1><p>hashCodeæ–¹æ³•è¿”å›å¯¹è±¡çš„å“ˆå¸Œç ï¼Œä»¥æ•´æ•°å½¢å¼è¿”å›ã€‚å“ˆå¸Œè¡¨åœ¨javaé›†åˆä¸­å¦‚HashMapã€HashSetä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œä¸»è¦ä½œç”¨æ˜¯ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚hashCodeæ–¹æ³•ä¸€äº›è§„å®š/çº¦å®šå¦‚ä¸‹ï¼š</p><li>åœ¨ä¸ä¿®æ”¹å¯¹è±¡çš„equals()æ–¹æ³•æ—¶ï¼ŒåŒä¸€ä¸ªå¯¹è±¡æ— è®ºä½•æ—¶è°ƒç”¨hashCodeæ–¹æ³•ï¼Œæ¯æ¬¡è°ƒç”¨hashCodeæ–¹æ³•å¿…é¡»è¿”å›ç›¸åŒçš„æ•´æ•°ï¼ˆå“ˆå¸Œç ï¼‰ã€‚æ­¤æ•´æ•°ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œä¸åŒä¸€åº”ç”¨ç¨‹åºçš„å¦ä¸€æ¬¡æ‰§è¡Œä¹‹é—´ä¿æŒä¸€è‡´ã€‚</li><li>å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼ˆä½¿ç”¨equals()æ–¹æ³•åˆ¤æ–­ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡è°ƒç”¨hashCodeæ–¹æ³•å¿…é¡»è¿”å›ç›¸åŒçš„æ•´æ•°ç»“æœï¼ˆå“ˆå¸Œç ï¼‰ã€‚</li><li>å¦‚æœä¸¤ä¸ªå¯¹è±¡ä¸ç›¸ç­‰ï¼ˆä½¿ç”¨equals()æ–¹æ³•åˆ¤æ–­ï¼‰ï¼Œä¸¤ä¸ªå¯¹è±¡è°ƒç”¨hashCodeæ–¹æ³•è¿”å›çš„ç»“æœä¸ä¸€å®šä¸åŒï¼Œä¹Ÿå°±æ˜¯ä¸åŒçš„ä¸¤ä¸ªå¯¹è±¡çš„hashCodeæ–¹æ³•è¿”å›çš„ç»“æœå¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸ç›¸åŒã€‚ä½†æ˜¯ä¸åŒå¯¹è±¡è¿”å›çš„å“ˆå¸Œç æœ€å¥½ä¸åŒï¼Œè¿™æ ·åœ¨å“ˆå¸Œè¡¨æŸ¥è¯¢æ—¶æ•ˆç‡ä¼šæ›´é«˜ã€‚</li><p>hashCodeæ–¹æ³•çš„ä½¿ç”¨ï¼š</p><pre><code>Object o1=new Object();Object o2=new Object();Object o3=o1;System.out.println(&#34;o1çš„hashçš„å“ˆå¸Œç ï¼š&#34;+ o1.hashCode());System.out.println(&#34;o2çš„hashçš„å“ˆå¸Œç ï¼š&#34;+ o2.hashCode());System.out.println(&#34;o3çš„hashçš„å“ˆå¸Œç ï¼š&#34;+ o3.hashCode());//æˆ‘æœºå™¨ä¸Šçš„ç»“æœï¼Œä¸åŒæœºå™¨ç»“æœä¸åŒo1çš„hashçš„å“ˆå¸Œç ï¼š399573350o2çš„hashçš„å“ˆå¸Œç ï¼š463345942o3çš„hashçš„å“ˆå¸Œç ï¼š399573350</code></pre><p>o1å’Œo2æ˜¯ä¸åŒçš„å¯¹è±¡ï¼ŒhashCodeæ–¹æ³•äº§ç”Ÿä¸åŒçš„å“ˆå¸Œç ï¼Œ o1ä¸o3æ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œå®ƒä»¬çš„å“ˆå¸Œç ä¸ä¸€æ ·ã€‚hashCodeçš„åº•å±‚C++å®ç°</p><pre><code>static inline intptr_t get_next_hash(Thread * Self, oop obj) {  intptr_t value = 0 ;  if (hashCode == 0) {      //OpenJdk 6 &7çš„é»˜è®¤å®ç°,æ­¤ç±»æ–¹æ¡ˆè¿”å›ä¸€ä¸ªPark-Millerä¼ªéšæœºæ•°ç”Ÿæˆå™¨ç”Ÿæˆçš„éšæœºæ•°     value = os::random() ;  } else  if (hashCode == 1) {      //æ­¤ç±»æ–¹æ¡ˆå°†å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œåšç§»ä½è¿ç®—åä¸ä¸€ä¸ªéšæœºæ•°è¿›è¡Œå¼‚æˆ–å¾—åˆ°ç»“æœ     intptr_t addrBits = cast_from_oop&lt;intptr_t&gt;(obj) &gt;&gt; 3 ;     value = addrBits ^ (addrBits &gt;&gt; 5) ^ GVars.stwRandom ;  } else  if (hashCode == 2) {      //æ­¤ç±»æ–¹æ¡ˆå°†å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œåšç§»ä½è¿ç®—åä¸ä¸€ä¸ªéšæœºæ•°è¿›è¡Œå¼‚æˆ–å¾—åˆ°ç»“æœ     value = 1 ;            // for sensitivity testing  } else  if (hashCode == 3) {      //æ­¤ç±»æ–¹æ¡ˆè¿”å›ä¸€ä¸ªè‡ªå¢åºåˆ—çš„å½“å‰å€¼     value = ++GVars.hcSequence ;  } else  if (hashCode == 4) {      //æ­¤ç±»æ–¹æ¡ˆè¿”å›å½“å‰å¯¹è±¡çš„å†…å­˜åœ°å€     value = cast_from_oop&lt;intptr_t&gt;(obj) ;  } else {     //OpenJdk 8 é»˜è®¤hashCodeçš„è®¡ç®—æ–¹æ³•     //é€šè¿‡å’Œå½“å‰çº¿ç¨‹æœ‰å…³çš„ä¸€ä¸ªéšæœºæ•°+ä¸‰ä¸ªç¡®å®šå€¼      //è¿ç”¨Marsaglia&#39;s xorshift schemeéšæœºæ•°ç®—æ³•å¾—åˆ°çš„ä¸€ä¸ªéšæœºæ•°     unsigned t = Self-&gt;_hashStateX ;     t ^= (t &lt;&lt; 11) ;     Self-&gt;_hashStateX = Self-&gt;_hashStateY ;     Self-&gt;_hashStateY = Self-&gt;_hashStateZ ;     Self-&gt;_hashStateZ = Self-&gt;_hashStateW ;     unsigned v = Self-&gt;_hashStateW ;     v = (v ^ (v &gt;&gt; 19)) ^ (t ^ (t &gt;&gt; 8)) ;     Self-&gt;_hashStateW = v ;     value = v ;  }  value &= markOopDesc::hash_mask;  if (value == 0) value = 0xBAD ;  assert (value != markOopDesc::no_hash, &#34;invariant&#34;) ;  TEVENT (hashCode: GENERATE) ;  return value;}</code></pre><p>get_next_hashå‡½æ•°æ ¹æ®hashCodeçš„å€¼ï¼Œæ¥é‡‡ç”¨ä¸åŒçš„hashCodeè®¡ç®—æ–¹æ³•ï¼Œå½“hashCode=0æ—¶ï¼Œæ˜¯OpenJDK6ã€7çš„é»˜è®¤å®ç°æ–¹æ³•ï¼Œæ­¤ç±»æ–¹æ¡ˆè¿”å›ä¸€ä¸ªPark-Millerä¼ªéšæœºæ•°ç”Ÿæˆå™¨ç”Ÿæˆçš„éšæœºæ•°ï¼›å½“hashCode=1æ—¶ï¼Œé€šè¿‡å°†å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œåšç§»ä½è¿ç®—åä¸ä¸€ä¸ªéšæœºæ•°è¿›è¡Œå¼‚æˆ–å¾—åˆ°ç»“æœï¼›å½“hashCode == 3ï¼Œè¿”å›ä¸€ä¸ªè‡ªå¢åºåˆ—çš„å½“å‰å€¼ï¼›å½“hashCode == 4æ—¶ï¼Œè¿”å›å½“å‰å¯¹è±¡çš„å†…å­˜åœ°å€ï¼›å½“hashCode ä¸ºå…¶ä»–å€¼æ—¶ï¼Œæ˜¯openJDK8 çš„hashCode æ–¹æ³•çš„é»˜è®¤å®ç°ã€‚</p><p>openJDK8 çš„é»˜è®¤hashCodeçš„è®¡ç®—æ–¹æ³•æ˜¯é€šè¿‡å’Œå½“å‰çº¿ç¨‹æœ‰å…³çš„ä¸€ä¸ªéšæœºæ•°+ä¸‰ä¸ªç¡®å®šå€¼ï¼Œè¿ç”¨Marsaglia's xorshift schemeéšæœºæ•°ç®—æ³•å¾—åˆ°çš„ä¸€ä¸ªéšæœºæ•°ã€‚xorshiftç®—æ³•æ˜¯é€šè¿‡ç§»ä½å’Œä¸æˆ–è®¡ç®—ï¼Œèƒ½å¤Ÿåœ¨è®¡ç®—æœºä¸Šä»¥æå¿«çš„é€Ÿåº¦ç”Ÿæˆä¼ªéšæœºæ•°åºåˆ—ã€‚ç®—æ³•å¦‚ä¸‹ï¼š</p><pre><code>unsigned long xor128(){	static unsigned long x=123456789,y=362436069,z=521288629,w=88675123;	unsigned long t;	t=(xË†(x&lt;&lt;11));x=y;y=z;z=w;     return( w=(wË†(w&gt;&gt;19))Ë†(tË†(t&gt;&gt;8)) );}</code></pre><p>Self->hashStateX æ˜¯éšæœºæ•°ã€Self->hashStateY ã€Self->hashStateZã€Self->hashStateW æ˜¯ä¸‰ä¸ªç¡®è®¤çš„æ•°ï¼Œåˆ†åˆ«å¯¹åº”xorshift ç®—æ³•çš„xã€yã€zã€wã€‚</p><p>åœ¨å¯åŠ¨JVMæ—¶ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®<strong>-XX:hashCode</strong>å‚æ•°ï¼Œæ”¹å˜é»˜è®¤çš„hashCodeçš„è®¡ç®—æ–¹å¼ã€‚</p><h1 class=pgc-h-arrow-right>public boolean equals(Object obj)</h1><pre><code>public boolean equals(Object obj) {        return (this == obj);}</code></pre><p>equalsæ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œç›´æ¥ç”¨this==objè¿›è¡Œæ¯”è¾ƒï¼Œè¿”å›thiså’Œobjæ¯”è¾ƒçš„ç»“æœï¼Œâ€œ==â€œç¬¦å·æ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå¯¹è±¡å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ã€‚å­ç±»åœ¨ç»§æ‰¿Objectç±»çš„æ—¶å€™ï¼Œä¸€èˆ¬éœ€è¦é‡å†™equalsæ–¹æ³•ï¼Œå¦‚æœä¸é‡å†™ï¼Œé‚£ä¹ˆå°±é»˜è®¤çˆ¶ç±»Objectçš„æ–¹æ³•ï¼Œåœ¨JDKæºç ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡éƒ½é‡å†™equalsæ–¹æ³•ï¼Œæ¯”å¦‚Stringç±»ã€‚</p><p>å¯¹äºéç©ºçš„å¯¹è±¡å¼•ç”¨ï¼Œequalsæ–¹æ³•æœ‰å‡ ä¸ªæ€§è´¨ï¼š</p><li>è‡ªåæ€§ï¼šå¯¹äºä»»ä½•éç©ºå¯¹è±¡xå’Œyï¼Œå¦‚æœx.equals(y) çš„ç»“æœä¸ºtrueï¼Œé‚£ä¹ˆy.equals(x) çš„ç»“æœä¹Ÿä¸ºtrueã€‚</li><li>ä¼ é€’æ€§ï¼šå¯¹äºä»»ä½•éç©ºå¯¹è±¡xã€yå’Œzï¼Œå¦‚æœx.equals(y)å’Œy.equals(z)çš„ç»“æœéƒ½ä¸ºtrueï¼Œé‚£ä¹ˆx.equals(z)çš„ç»“æœä¹Ÿä¸ºtrueã€‚</li><li>ä¸€è‡´æ€§ï¼šå¯¹äºä»»ä½•éç©ºå¯¹è±¡xå’Œyï¼Œå¦‚æœæœªä¿®æ”¹equalsæ–¹æ³•ï¼Œå¤šæ¬¡è°ƒç”¨equalsæ–¹æ³•ç»“æœå§‹ç»ˆä¸ºtrueæˆ–è€…falseï¼Œä¸èƒ½è¿™æ¬¡è¿”å›trueï¼Œä¸‹æ¬¡è¿”å›falseã€‚</li><li>å¯¹äºä»»ä½•éç©ºå¯¹è±¡xï¼Œx.equals(null)çš„ç»“æœæ˜¯falseã€‚</li><p>å­ç±»åœ¨ç»§æ‰¿Objectï¼Œé‡å†™equalsæ–¹æ³•æ—¶ï¼Œå¿…é¡»é‡å†™hashCodeæ–¹æ³•ï¼Œåœ¨hashCodeçº¦å®šä¸­ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼ŒhashCodeå¿…é¡»è¿”å›ç›¸åŒçš„å“ˆå¸Œç ã€‚å¾ˆå¤šæ—¶å€™ï¼Œå­ç±»åœ¨é‡å†™çˆ¶ç±»Objectçš„equalsæ–¹æ³•æ—¶ï¼Œå¾€å¾€ä¼šå¿˜äº†é‡å†™hashCodeï¼Œå½“é‡å†™äº†equalsä½†æ²¡æœ‰é‡å†™hashCodeæ–¹æ³•æ—¶ï¼Œé‚£ä¹ˆè¯¥å­ç±»æ— æ³•ç»“åˆjavaé›†åˆæ­£å¸¸è¿è¡Œï¼Œå› ä¸ºjavaé›†åˆå¦‚HashMapã€HashSetç­‰éƒ½æ˜¯åŸºäºå“ˆå¸Œç è¿›è¡Œå­˜å‚¨çš„ã€‚</p><h1 class=pgc-h-arrow-right>protected native Object clone() throws CloneNotSupportedException;</h1><p>clone()æœ¬åœ°æ–¹æ³•ï¼Œåˆ›å»ºå¹¶è¿”å›æ­¤å¯¹è±¡çš„å‰¯æœ¬ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨protected ä¿®é¥°ï¼ŒObjectä¸èƒ½ç›´æ¥è°ƒç”¨clone()æ–¹æ³•ï¼Œä¼šç¼–è¯‘é”™è¯¯ï¼š</p><pre><code> Object o=new Object(); //ç¼–è¯‘é”™è¯¯ Object o1=  o.clone();</code></pre><p>å¦‚æœæƒ³è¦ä½¿ç”¨clone()æ–¹æ³•ï¼Œå­ç±»å¿…é¡»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ç”¨publicä¿®é¥°ã€‚å¦‚æœå­ç±»æ²¡æœ‰å®ç°clone(),å­ç±»é»˜è®¤è°ƒç”¨çˆ¶ç±»çš„cloneæ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><pre><code>public class ObjectCloneTest {    public static void main(String [] args) throws CloneNotSupportedException {        ObjectCloneTest o=new ObjectCloneTest();        ObjectCloneTest cloneTest= (ObjectCloneTest) o.clone();        System.out.println(cloneTest);    }}</code></pre><p>ä½†æ˜¯è¿è¡Œæ—¶å‘ç”Ÿå¼‚å¸¸ï¼š</p><pre><code>Exception in thread &#34;main&#34; java.lang.CloneNotSupportedException: com.lingheng.java.source.ObjectCloneTest	at java.lang.Object.clone(Native Method)	at com.lingheng.java.source.ObjectCloneTest.main(ObjectCloneTest.java:12)</code></pre><p>å¦‚æœå­æ²¡æœ‰å®ç°Cloneableæ¥å£ï¼Œå½“å­ç±»è°ƒç”¨clone()æ–¹æ³•æ—¶ï¼Œä¼šæŠ›å‡ºCloneNotSupportedExceptionå¼‚å¸¸ã€‚å½“å­ç±»å®ç°Cloneableæ¥å£ï¼Œç¨‹åºè¿è¡Œä¼šæˆåŠŸï¼š</p><pre><code>//å®ç°Cloneableæ¥å£public class ObjectCloneTest implements Cloneable{    public static void main(String [] args) throws CloneNotSupportedException {        ObjectCloneTest o=new ObjectCloneTest();        ObjectCloneTest cloneTest= (ObjectCloneTest) o.clone();        System.out.println(&#34;æ‰“å°cloneTestï¼š&#34;+cloneTest);    }}//ç»“æœæ‰“å°cloneTestï¼šcom.lingheng.java.source.ObjectCloneTest@6d6f6e28</code></pre><p>æ‰€ä»¥ï¼Œ<strong>æƒ³è¦ä½¿ç”¨clone()æ–¹æ³•ï¼Œé™¤äº†ç»§æ‰¿Objectå¤–ï¼ˆé»˜è®¤ç»§æ‰¿ï¼‰ï¼Œè¿˜éœ€è¦å®ç°Cloneableæ¥å£ã€‚æ‰€æœ‰çš„æ•°ç»„é»˜è®¤æ˜¯å®ç°äº†Cloneableæ¥å£çš„ï¼Œæ•°ç»„çš„clone()è¿”å›æ•°ç»„ç±»å‹:</strong></p><pre><code>public void arrayClone(){    //å­—ç¬¦ä¸²æ•°ç»„    String[] s=new String[]{&#34;hello&#34;,&#34;world&#34;};    System.out.println(s);    System.out.println(s.clone());     //æ•´æ•°æ•°ç»„     int[] num=new int[]{1,3};     System.out.println(num);     System.out.println(num.clone());}//ç»“æœ[Ljava.lang.String;@17d10166[Ljava.lang.String;@1b9e1916[I@ba8a1dc[I@4f8e5cde</code></pre><p>å¯¹äºä»»ä½•å¯¹è±¡xï¼Œå…·æœ‰ä»¥ä¸‹å‡ ä¸ªçº¦å®šï¼š</p><ol start=1><li>x.clone() != x ä¸ºtrue</li><li>x.clone().getClass() == x.getClass() ä¸ºtrueï¼Œä½†è¿™ä¸æ˜¯å¿…é¡»æ»¡è¶³çš„è¦æ±‚ï¼Œä¹Ÿå°±æ˜¯è¯´å¯èƒ½æ˜¯falseã€‚æŒ‰ç…§çº¦å®šï¼Œè¿”å›çš„å¯¹è±¡åº”è¯¥é€šè¿‡è°ƒç”¨super.cloneæ¥è·å¾—ã€‚å¦‚æœä¸€ä¸ªç±»å’Œå®ƒæ‰€æœ‰çš„è¶…ç±»ï¼ˆé™¤äº†Objectï¼‰ éµå¾ªè¿™ä¸ªçº¦å®šï¼Œé‚£å°±ä¼šx.clone().getClass() == x.getClass()ã€‚</li><li>x.clone().equals(x)é€šå¸¸æƒ…å†µä¸‹ä¸ºtrueï¼Œè¿™ä¸æ˜¯å¿…é¡»æ»¡è¶³çš„è¦æ±‚ã€‚</li></ol><p>å¯¹äºçº¦å®š1ï¼Œå› ä¸ºæ‹·è´æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ‰€ä»¥æ‹·è´çš„å¯¹è±¡å’ŒåŸå¯¹è±¡æ˜¯ä¸ç›¸ç­‰çš„ã€‚</p><p>å¯¹äºçº¦å®š2ï¼Œè¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œä¸€ä¸ªç±»å’Œå®ƒæ‰€æœ‰çš„è¶…ç±»çš„cloneæ–¹æ³•éƒ½è°ƒç”¨super.clone()è·å–è¿”å›å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªç±»çš„Classä¸ªåŸå¯¹è±¡çš„Claasæ˜¯ä¸€æ ·çš„ã€‚cloneè¿”å›çš„ç±»å‹æ˜¯Objectç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨cloneä¸­å¯ä»¥è¿”å›åªè¦æ˜¯Objectçš„å­ç±»å°±å¯ä»¥äº†ï¼Œè¿™æ ·çš„è¯ï¼Œx.clone().getClass() == x.getClass()çš„ç»“æœä¸ºfalseï¼›</p><p>å¯¹äºçº¦å®š3ï¼Œè¿™ä¸æ˜¯å¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼Œå½“åœ¨cloneä¸­æ”¹å˜äº†å¯¹è±¡çš„å±æ€§å€¼ï¼Œé‚£ä¹ˆx.clone().equals(x)çš„ç»“æœå°±å¯èƒ½ä¸æ˜¯trueäº†ã€‚</p><p>åˆ†æäº†Javaå±‚é¢çš„cloneçš„çº¦å®šï¼Œæˆ‘ä»¬ä»JVMå±‚é¢çœ‹çœ‹cloneåº•å±‚çš„å®ç°ï¼Œåœ¨registerNativeså‡½æ•°ä¸­ä¼šåŠ è½½cloneçš„JVMå®ç°JVM_Cloneï¼ŒJVM_Cloneçš„å®ç°å¦‚ä¸‹ï¼š</p><pre><code>//JVM_Clone çš„å®ç°JVM_ENTRY(jobject, JVM_Clone(JNIEnv* env, jobject handle))  JVMWrapper(&#34;JVM_Clone&#34;);  Handle obj(THREAD, JNIHandles::resolve_non_null(handle));  const KlassHandle klass (THREAD, obj-&gt;klass());  JvmtiVMObjectAllocEventCollector oam;#ifdef ASSERT  // Just checking that the cloneable flag is set correct//å¦‚æœæ˜¯ä¼ å…¥çš„æ˜¯æ•°ç»„  if (obj-&gt;is_array()) {      //æ‰€æœ‰çš„æ•°ç»„éƒ½é»˜è®¤å®ç°äº†Cloneableæ¥å£    guarantee(klass-&gt;is_cloneable(), &#34;all arrays are cloneable&#34;);  } else {      //æ˜¯å¦æ˜¯å®ä¾‹    guarantee(obj-&gt;is_instance(), &#34;should be instanceOop&#34;);    bool cloneable = klass-&gt;is_subtype_of(SystemDictionary::Cloneable_klass());      //åˆ¤æ–­æ˜¯å¦æ˜¯åˆæ³•çš„cloneable    guarantee(cloneable == klass-&gt;is_cloneable(), &#34;incorrect cloneable flag&#34;);  }#endif----------------------------------åˆ†å‰²çº¿1-------------------------------------------------// Check if class of obj supports the Cloneable interface. // All arrays are considered to be cloneable (See JLS 20.1.5)    //å¦‚æœæ²¡æœ‰å®ç°Cloneableæ¥å£ï¼ŒæŠ›å‡ºCloneNotSupportedExceptionå¼‚å¸¸  if (!klass-&gt;is_cloneable()) {    ResourceMark rm(THREAD);    THROW_MSG_0(vmSymbols::java_lang_CloneNotSupportedException(), klass-&gt;external_name());  }  // Make shallow object copy 	//æµ…æ‹·è´  const int size = obj-&gt;size();  oop new_obj = NULL;  if (obj-&gt;is_array()) {//æ•°ç»„      //æ•°ç»„çš„é•¿åº¦    const int length = ((arrayOop)obj())-&gt;length();     //ç”³è¯·å†…å­˜ï¼Œåˆ›å»ºæ–°çš„æ•°ç»„    new_obj = CollectedHeap::array_allocate(klass, size, length, CHECK_NULL);  } else {    //ç”³è¯·å†…å­˜ï¼Œåˆ›å»ºæ–°çš„å¯¹è±¡    new_obj = CollectedHeap::obj_allocate(klass, size, CHECK_NULL);  }----------------------------------åˆ†å‰²çº¿2------------------------------------------------- // 4839641 (4840070): We must do an oop-atomic copy, because if another thread  // is modifying a reference field in the clonee, a non-oop-atomic copy might  // be suspended in the middle of copying the pointer and end up with parts  // of two different pointers in the field.  Subsequent dereferences will crash.  // 4846409: an oop-copy of objects with long or double fields or arrays of same  // won&#39;t copy the longs/doubles atomically in 32-bit vm&#39;s, so we copy jlongs instead  // of oops.  We know objects are aligned on a minimum of an jlong boundary.  // The same is true of StubRoutines::object_copy and the various oop_copy  // variants, and of the code generated by the inline_native_clone intrinsic.  assert(MinObjAlignmentInBytes &gt;= BytesPerLong, &#34;objects misaligned&#34;);  //åŸå­æ€§æ‹·è´ï¼Œå¯èƒ½å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¼šä¿®æ”¹cloneå¼•ç”¨çš„å­—æ®µ  Copy::conjoint_jlongs_atomic((jlong*)obj(), (jlong*)new_obj,                               (size_t)align_object_size(size) / HeapWordsPerLong);  // Clear the header  new_obj-&gt;init_mark();  // Store check (mark entire object and let gc sort it out)  BarrierSet* bs = Universe::heap()-&gt;barrier_set();  assert(bs-&gt;has_write_region_opt(), &#34;Barrier set does not have write_region&#34;);  bs-&gt;write_region(MemRegion((HeapWord*)new_obj, size));  // Caution: this involves a java upcall, so the clone should be  // &#34;gc-robust&#34; by this stage.  //å½“javaå­ç±»å®ç°äº†finalizeæ–¹æ³•ï¼Œå·²ç»è°ƒç”¨finalizeï¼Œæ³¨å†Œfinalizeræ–¹æ³•  if (klass-&gt;has_finalizer()) {    assert(obj-&gt;is_instance(), &#34;should be instanceOop&#34;);    new_obj = InstanceKlass::register_finalizer(instanceOop(new_obj), CHECK_NULL);  }	//åˆ›å»ºæ‹·è´çš„å¯¹è±¡è¿”å›  return JNIHandles::make_local(env, oop(new_obj));JVM_END</code></pre><p>JVM_Cloneçš„å®ç°è¿‡ç¨‹æ¯”è¾ƒé•¿ï¼Œæˆ‘å°†åˆ†å‰²æˆä¸‰éƒ¨åˆ†ï¼Œåˆ†å‰²çº¿1ä¸Šéƒ¨åˆ†ä¸»è¦æ˜¯æ£€æŸ¥æ‹·è´çš„ä¸€äº›æ ‡å¿—æ˜¯å¦æ­£ç¡®ï¼Œåˆ¤æ–­ä¼ å…¥çš„æ˜¯æ•°ç»„è¿˜æ˜¯å¯¹è±¡ï¼Œåœ¨ä¸Šé¢æˆ‘è®²è¿‡æ‰€æœ‰çš„æ•°ç»„éƒ½é»˜è®¤å®ç°äº†Cloneableæ¥å£ï¼Œåœ¨è¿™é‡Œå°±å¯ä»¥è¯æ˜äº†ã€‚ç„¶åè¿˜åˆ¤æ–­äº†ä¼ å…¥çš„å¯¹è±¡æ˜¯å¦ç»§æ‰¿Cloneableæ¥å£ï¼Œæ²¡æœ‰ç»§æ‰¿çš„è¯ï¼Œå°±æ˜¯éæ³•çš„ï¼Œè¿™æ˜¯ç¬¬ä¸€æ®µé€»è¾‘ã€‚</p><p>åˆ†å‰²çº¿ä¸­é—´éƒ¨åˆ†çš„é€»è¾‘ï¼Œä¸»è¦æ˜¯ç”³è¯·å†…å­˜ï¼Œä¾›æ‹·è´çš„æ—¶å€™ä½¿ç”¨ã€‚é¦–å…ˆå…ˆåˆ¤æ–­æ˜¯å¦å®ç°Cloneableæ¥å£ï¼Œå¦‚æœæ²¡æœ‰æŠ›å‡ºCloneNotSupportedExceptionå¼‚å¸¸ï¼Œç„¶åæ ¹æ®ä¼ å…¥çš„æ˜¯æ•°ç»„è¿˜æ˜¯å¯¹è±¡ï¼Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•è¿›è¡Œç”³è¯·ä¸åŒå¤§å°çš„å†…å­˜ã€‚ä»£ç çš„æœ‰æ®µæ³¨é‡Šæ˜¯â€Make shallow object copy â€œï¼Œå°±æ˜¯è¯´è¿™é‡Œçš„æ‹·è´æ˜¯æµ…æ‹·è´ã€‚</p><p>æœ€åçš„é€»è¾‘æ˜¯ï¼Œåšä¸€äº›æ£€æŸ¥ï¼Œæœ€åè¿”å›æ–°åˆ›å»ºçš„æ‹·è´å¯¹è±¡ã€‚å› ä¸ºå¯¹è±¡çš„å±æ€§å¯èƒ½è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ”¹å˜ï¼Œæ‰€ä»¥è¿›è¡Œçš„æ˜¯åŸå­æ€§çš„æ‹·è´ï¼Œæœ€ååˆ›å»ºæ‹·è´çš„å¯¹è±¡è¿›è¡Œè¿”å›ã€‚è¿™äº›æºç çš„æ³¨é‡Šå¾ˆè¯¦ç»†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å…·ä½“çœ‹çœ‹å…¶ä»–çš„ä¸€äº›é€»è¾‘ã€‚</p><h1 class=pgc-h-arrow-right>public String toString()</h1><p>oString()è¿”å›å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼Œæœ€å¥½æ‰€æœ‰Objectçš„å­ç±»éƒ½é‡å†™è¿™ä¸ªæ–¹æ³•ï¼ŒObjectç±»çš„toStringæ–¹æ³•è¿”å›çš„æ˜¯"ç±»å@å“ˆå¸Œç çš„åå…­è¿›åˆ¶ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š</p><pre><code>public String toString() {        return getClass().getName() + &#34;@&#34; + Integer.toHexString(hashCode());}</code></pre><p>å½“æˆ‘ä»¬åœ¨ä»£ç è¾“å…¥ä½¿ç”¨System.out.printlnè¾“å…¥å¯¹è±¡çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„toStringæ–¹æ³•ï¼Œè¿”å›çš„æ˜¯toStringçš„å­—ç¬¦ä¸²ã€‚ä¸€èˆ¬åœ¨é‡å†™çš„toStringçš„è¿‡ç¨‹ï¼Œè¿”å›çš„å­—ç¬¦ä¸²è¦æ˜“è¯»çš„ã€‚</p><p>Objectç±»çš„æºç å…ˆåˆ†æåˆ°è¿™é‡Œï¼Œå› ä¸ºåˆ†æçš„ç¬”è®°ä¼šæ¯”è¾ƒé•¿ï¼Œæˆ‘å°†ç”¨ä¸¤ç¯‡æ–‡ç« æ¥å‘è¡¨ã€‚<strong>æƒ³è¦ç¬”è®°çš„å¯ä»¥å…³æ³¨å¹¶ç§ä¿¡æˆ‘ã€‚</strong></p><p></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'JVM','å±‚é¢','Java'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>