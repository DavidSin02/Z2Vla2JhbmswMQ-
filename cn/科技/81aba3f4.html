<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>æ·±å…¥ä»‹ç»å’Œä½¿ç”¨ Java 8 çš„ Collector æ¥å£å’Œ Collectors å·¥å…·ç±» | æå®¢å¿«è¨Š</title><meta property="og:title" content="æ·±å…¥ä»‹ç»å’Œä½¿ç”¨ Java 8 çš„ Collector æ¥å£å’Œ Collectors å·¥å…·ç±» - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/6697a1bda5a747fc89be172989891078"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/81aba3f4.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/81aba3f4.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/81aba3f4.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/81aba3f4.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/81aba3f4.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/81aba3f4.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/81aba3f4.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/81aba3f4.html><meta property="article:published_time" content="2020-11-14T21:05:53+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:53+08:00"><meta name=Keywords content><meta name=description content="æ·±å…¥ä»‹ç»å’Œä½¿ç”¨ Java 8 çš„ Collector æ¥å£å’Œ Collectors å·¥å…·ç±»"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/81aba3f4.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>æ·±å…¥ä»‹ç»å’Œä½¿ç”¨ Java 8 çš„ Collector æ¥å£å’Œ Collectors å·¥å…·ç±»</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>1 æ¦‚è¿°</h1><ul><li>java.util.stream.Collector: Collector æ¥å£ç”¨äºå°† Stream æµä¸­çš„æ•°æ®åŠ å·¥ï¼Œè½¬æ¢ï¼Œå¤„ç†ï¼Œæœ€åè¿”å›ç»“æœã€‚</li><li>java.util.stream.Collectors: Collectors å·¥å…·ç±»å†…ç½®äº†ä¸€äº› Collector æ¥å£çš„å®ç°ã€‚</li></ul><p style=text-align:start>æœ¬æ–‡è¯¦è§£ Java 8 çš„ Collector æ¥å£æ–¹æ³•ä»¥åŠ Collectors å·¥å…·ç±»çš„ä½¿ç”¨ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹</p><ol start=1><li>Stream api ä¸­çš„ collect æ–¹æ³•ä»‹ç»ä»¥åŠä½¿ç”¨</li><li>Collector æ¥å£çš„å®ç°</li><li>Collectors å·¥å…·ç±»ä»‹ç»ä»¥åŠä½¿ç”¨</li></ol><h1 class=pgc-h-arrow-right>2 Stream æ¥å£ä¸­çš„ collect æ–¹æ³•</h1><p style=text-align:start>collect æ–¹æ³•çš„åŠŸèƒ½æ˜¯å°† Stream ä¸­æ•°æ®è½¬æ¢ä¸ºæœ€ç»ˆçš„ç»“æœï¼Œå…·ä½“å¦‚ä¸‹</p><ol start=1><li>&lt;R, A> R collect(Collector&lt;? super T, A, R> collector)ï¼šå‚æ•°ç±»å‹ä¸º Collector æ¥å£</li><li>&lt;R> R collect(Supplier&lt;R> supplier, BiConsumer&lt;R, ? super T> accumulator, BiConsumer&lt;R, R> combiner)ï¼šå‚æ•°ç±»å‹ä¸º Supplierï¼Œ BiConsumerï¼ŒBiConsumer ä¸‰ä¸ªå¯¹è±¡ã€‚</li></ol><h1 class=pgc-h-arrow-right>2.1 collect æ–¹æ³•ä½¿ç”¨ä¸¾ä¾‹</h1><p style=text-align:start>éœ€æ±‚ï¼šå°†é›†åˆä¸­çš„è‹±æ–‡å­—ç¬¦ä¸²é¦–å­—æ¯å¤§å†™ï¼Œä¸‹é¢æä¾›ä¸¤ç§å®ç°çš„æ–¹æ³•ï¼š</p><ol start=1><li>collect æ–¹æ³•æ¥å£å‚æ•°ä¸º Collector å¯¹è±¡å®ç°</li><li>collect æ–¹æ³•æ¥å£å‚æ•°ä¸º Supplierï¼Œ BiConsumerï¼Œ BiConsumer ä¸‰ä¸ªå¯¹è±¡å®ç°</li></ol><p style=text-align:start>å…·ä½“å®ç°å¦‚ä¸‹</p><pre><code>@Testpublic void test_1() {    List&lt;String&gt; dataList = new ArrayList&lt;&gt;();    dataList.add("john");    dataList.add("kain");    dataList.add("mike");    dataList.add("milk");    dataList.add("kav");    // 1. æ¥å£å‚æ•°ä¸º Collector å¯¹è±¡å®ç°    // 1.1 Supplier å¯¹è±¡è´Ÿè´£åˆ›å»ºå®¹å™¨å¯¹è±¡ï¼Œä»¥ä¾¿å®¹çº³ stream ä¸­åˆ†éš”åçš„æ•°æ®ï¼Œè¿™é‡Œä½¿ç”¨ List&lt;Integer&gt; ä½œä¸ºæ•°æ®çš„å®¹å™¨å¯¹è±¡    // 1.2 accumulator å¯¹è±¡è´Ÿè´£å°† stream ä¸­åˆ†éš”åçš„æ•°æ®æ”¾å…¥ä¸Šä¸€æ­¥åˆ›å»ºçš„å®¹å™¨ä¸­    // 1.3 combiner å¯¹è±¡è´Ÿè´£å°†åˆ†éš”çš„å®¹å™¨ä¸­çš„æ•°æ®åˆå¹¶èµ·æ¥    // 1.4 finisher å¯¹è±¡è´Ÿè´£å°†æœ€ç»ˆè¿”å›çš„ç»“æœè¿›è¡Œæœ€ç»ˆçš„å¤„ç†    // 1.5 characteristics è´Ÿè´£ Collector æ‰§è¡Œæ•ˆç‡çš„ä¼˜åŒ–ï¼Œå…·ä½“è¦æ ¹æ®æ˜¯å¦ä½¿ç”¨äº† parallelStream ä»¥åŠ æ•°æ®æ˜¯å¦æœ‰é¡ºåºï¼Œä¸ä¼šå½±å“æœ€ç»ˆçš„æ‰§è¡Œç»“æœï¼š    List&lt;String&gt; resultList = dataList.parallelStream().collect(new Collector&lt;String, List&lt;String&gt;, List&lt;String&gt;&gt;() {        @Override        public Supplier&lt;List&lt;String&gt;&gt; supplier() {            return () -&gt; new ArrayList&lt;&gt;();        }        @Override        public BiConsumer&lt;List&lt;String&gt;, String&gt; accumulator() {            return (list, data) -&gt; list.add(data.substring(0,1).toUpperCase().concat(data.substring(1)));        }        @Override        public BinaryOperator&lt;List&lt;String&gt;&gt; combiner() {            return (list1,list2) -&gt; {                list1.addAll(list2);                return list1;            };        }        @Override        public Function&lt;List&lt;String&gt;, List&lt;String&gt;&gt; finisher() {            return list -&gt; list;        }        @Override        public Set&lt;Characteristics&gt; characteristics() {            Set&lt;Characteristics&gt; characteristicsSet = new HashSet&lt;&gt;();            characteristicsSet.add(Characteristics.CONCURRENT);            return characteristicsSet;        }    });    resultList.forEach(System.out::println);    // 2. æ¥å£å‚æ•°ä¸º Supplierï¼Œ BiConsumerï¼Œ BiConsumer ä¸‰ä¸ªå¯¹è±¡    // 2.1 Supplier å¯¹è±¡è´Ÿè´£åˆ›å»ºå®¹å™¨å¯¹è±¡ï¼Œä»¥ä¾¿å®¹çº³ stream ä¸­åˆ†éš”åçš„æ•°æ®ï¼Œè¿™é‡Œä½¿ç”¨ List&lt;Integer&gt; ä½œä¸ºæ•°æ®çš„å®¹å™¨å¯¹è±¡    // 2.2 BiConsumer å¯¹è±¡è´Ÿè´£å°† stream ä¸­åˆ†éš”åçš„æ•°æ®æ”¾å…¥ä¸Šä¸€æ­¥åˆ›å»ºçš„å®¹å™¨ä¸­    // 2.3 BiConsumer å¯¹è±¡è´Ÿè´£å°†åˆ†éš”çš„å®¹å™¨ä¸­çš„æ•°æ®åˆå¹¶èµ·æ¥    List&lt;String&gt; resultList2 = dataList.parallelStream().collect(            ArrayList::new,            (list, data) -&gt; list.add(data.substring(0,1).toUpperCase().concat(data.substring(1))),            (list1,list2) -&gt; list1.addAll(list2));    resultList2.forEach(System.out::println);}</code></pre><pre><code>new supplierJohnKainMikeMilkKavJohnKainMikeMilkKav</code></pre><h1 class=pgc-h-arrow-right>2.2 collect æ–¹æ³•æ¥å£å‚æ•°ä¸º Collector å¯¹è±¡å®ç°</h1><p style=text-align:start>åœ¨ Collector å¯¹è±¡å®ç°ä¸­ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹ 5 ä¸ªæ¥å£å¯¹è±¡</p><ol start=1><li>Supplier å¯¹è±¡è´Ÿè´£åˆ›å»ºå®¹å™¨å¯¹è±¡ï¼Œä»¥ä¾¿å®¹çº³ stream ä¸­åˆ†éš”åçš„æ•°æ®ï¼Œè¿™é‡Œä½¿ç”¨ List&lt;Integer> ä½œä¸ºæ•°æ®çš„å®¹å™¨å¯¹è±¡</li><li>accumulator å¯¹è±¡è´Ÿè´£å°† stream ä¸­åˆ†éš”åçš„æ•°æ®æ”¾å…¥ä¸Šä¸€æ­¥åˆ›å»ºçš„å®¹å™¨ä¸­</li><li>combiner å¯¹è±¡è´Ÿè´£å°†åˆ†éš”çš„å®¹å™¨ä¸­çš„æ•°æ®åˆå¹¶èµ·æ¥</li><li>finisher å¯¹è±¡è´Ÿè´£å°†æœ€ç»ˆè¿”å›çš„ç»“æœè¿›è¡Œæœ€ç»ˆçš„å¤„ç†</li><li>characteristics è´Ÿè´£ Collector æ‰§è¡Œæ•ˆç‡çš„ä¼˜åŒ–ï¼Œå…·ä½“è¦æ ¹æ®æ˜¯å¦ä½¿ç”¨äº† parallelStream ä»¥åŠ æ•°æ®æ˜¯å¦æœ‰é¡ºåºï¼Œä¸ä¼šå½±å“æœ€ç»ˆçš„æ‰§è¡Œç»“æœ</li></ol><h1 class=pgc-h-arrow-right>2.3 collect æ–¹æ³•æ¥å£å‚æ•°ä¸º Supplierï¼Œ BiConsumerï¼Œ BiConsumer ä¸‰ä¸ªå¯¹è±¡å®ç°</h1><p style=text-align:start>Supplierï¼Œ BiConsumerï¼Œ BiConsumer ä¸‰ä¸ªå¯¹è±¡çš„åŠŸèƒ½å¦‚ä¸‹</p><ol start=1><li>Supplier å¯¹è±¡è´Ÿè´£åˆ›å»ºå®¹å™¨å¯¹è±¡ï¼Œä»¥ä¾¿å®¹çº³ stream ä¸­åˆ†éš”åçš„æ•°æ®ï¼Œè¿™é‡Œä½¿ç”¨ List&lt;Integer> ä½œä¸ºæ•°æ®çš„å®¹å™¨å¯¹è±¡</li><li>BiConsumer å¯¹è±¡è´Ÿè´£å°† stream ä¸­åˆ†éš”åçš„æ•°æ®æ”¾å…¥ä¸Šä¸€æ­¥åˆ›å»ºçš„å®¹å™¨ä¸­</li><li>BiConsumer å¯¹è±¡è´Ÿè´£å°†åˆ†éš”çš„å®¹å™¨ä¸­çš„æ•°æ®åˆå¹¶èµ·æ¥</li></ol><h1 class=pgc-h-arrow-right>2.4 Characteristics æšä¸¾</h1><p style=text-align:start>åœ¨æ¥å£å‚æ•°ä¸º Collector å¯¹è±¡å®ç°ä¸­æœ‰ä¸€ä¸ª characteristics æ–¹æ³•ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª Set é›†åˆï¼Œè´Ÿè´£ Collector æ‰§è¡Œæ•ˆç‡çš„ä¼˜åŒ–ï¼Œå…·ä½“è¦æ ¹æ®æ˜¯å¦ä½¿ç”¨äº† parallelStream ä»¥åŠæ•°æ®æ˜¯å¦æœ‰é¡ºåºï¼Œæœ€ç»ˆä¸ä¼šå½±å“æ‰§è¡Œç»“æœã€‚</p><p style=text-align:start>å…·ä½“å†…å®¹ä¸º Collector æ¥å£ä¸­å®šä¹‰çš„ Characteristics æ³›å‹ï¼Œå…·ä½“å¦‚ä¸‹</p><pre><code>enum Characteristics {    // å¦‚æœä½¿ç”¨ parallelStreamï¼Œcharacteristics æ–¹æ³•è¿”å›çš„ set é›†åˆä¸­å¯ä»¥åŠ ä¸Šè¿™ä¸ªæšä¸¾    CONCURRENT,    // å¦‚æœæµä¸­çš„æ•°æ®æ˜¯æ²¡æœ‰é¡ºåºçš„ï¼Œä¹Ÿå¯ä»¥åŠ ä¸Šè¿™ä¸ªæšä¸¾    UNORDERED,    // åŠ ä¸Šè¿™ä¸ªè¡¨ç¤º finisher æ–¹æ³•ä¸­çš„å‚æ•°å’Œè¿”å›å€¼å®Œå…¨ä¸€è‡´ï¼Œfinisher æ–¹æ³•ä¸ä¼šæ‰§è¡Œäº†    IDENTITY_FINISH}</code></pre><h1 class=pgc-h-arrow-right>2.5 parallelStream çº¿ç¨‹å®‰å…¨é—®é¢˜</h1><ul><li>å…¶ä¸­ä¸Šé¢çš„ä¸¤ä¸ªä¾‹å­ä¸­éƒ½ä½¿ç”¨äº† parallelStreamï¼Œå¹¶ä¸”ä½¿ç”¨äº† collect æ–¹æ³•</li><li>parallelStream å¯ä»¥æé«˜æ•°æ®å¤„ç†æ•ˆç‡ï¼Œå…·ä½“æ˜¯é€šè¿‡å°†æµä¸­çš„æ•°æ®åˆ†éš”æˆè‹¥å¹²ç«¯åå†å¹¶è¡Œå¤„ç†æœ€åå°†ç»“æœåˆå¹¶</li><li>å¦‚æœä¸ä½¿ç”¨ collect æ–¹æ³•ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Œä¼šä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ</li></ul><p style=text-align:start>å…ˆçœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­</p><pre><code>private static Lock lock = new ReentrantLock();@Testpublic void test_unsafe() {    List&lt;Integer&gt; list1 = new ArrayList&lt;&gt;();    List&lt;Integer&gt; list2 = new ArrayList&lt;&gt;();    List&lt;Integer&gt; list3 = new ArrayList&lt;&gt;();    // ä¸²è¡Œ    IntStream.range(0, 10000).forEach(list1::add);    // å¹¶è¡Œ    IntStream.range(0, 10000).parallel().forEach(list2::add);    // å¹¶è¡ŒåŠ é”    IntStream.range(0, 10000).parallel().forEach(i -&gt; {        lock.lock();        try {            list3.add(i);        } finally {            lock.unlock();        }    });    System.out.println(String.format("ä¸²è¡Œæ‰§è¡Œçš„å¤§å°ï¼š%s", list1.size()));    System.out.println(String.format("æœ‰çº¿ç¨‹å®‰å…¨çš„å¹¶è¡Œé—®é¢˜å¤§å°ï¼š%s", list2.size()));    System.out.println(String.format("å¹¶è¡ŒåŠ é”ï¼š%s", list1.size()));}</code></pre><p style=text-align:start>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼Œå¯è§åœ¨ parallelStream ä¸­ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œè™½ç„¶é€šè¿‡é”å¯ä»¥é¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯ä¼šé™ä½ç¨‹åºå¤„ç†æ•ˆç‡ï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„ååç‡ã€‚</p><pre><code>ä¸²è¡Œæ‰§è¡Œçš„å¤§å°ï¼š10000æœ‰çº¿ç¨‹å®‰å…¨çš„å¹¶è¡Œé—®é¢˜å¤§å°ï¼š7351å¹¶è¡ŒåŠ é”ï¼š10000</code></pre><p style=text-align:start>æ­£ç¡®çš„è§£å†³çš„æ–¹æ³•å°±æ˜¯é€šè¿‡ collect æ–¹æ³•å’Œ Collector æ¥å£ï¼Œå…·ä½“å¦‚ä¸‹</p><pre><code>@Testpublic void test_safe() {    List&lt;Integer&gt; list1 = new ArrayList&lt;&gt;();    // ä¸²è¡Œ    IntStream.range(0, 10000).forEach(list1::add);    // é€šè¿‡ collect æ¥å£è§£å†³å¹¶å‘é—®é¢˜    // 1. Supplier å¯¹è±¡è´Ÿè´£åˆ›å»ºå®¹å™¨å¯¹è±¡ï¼Œä»¥ä¾¿å®¹çº³ stream ä¸­åˆ†éš”åçš„æ•°æ®ï¼Œè¿™é‡Œä½¿ç”¨ List&lt;Integer&gt; ä½œä¸ºæ•°æ®çš„å®¹å™¨å¯¹è±¡    // 2. ObjIntConsumer å¯¹è±¡è´Ÿè´£å°† stream ä¸­åˆ†éš”åçš„æ•°æ®æ”¾å…¥ä¸Šä¸€æ­¥åˆ›å»ºçš„å®¹å™¨ä¸­    // 3. BiConsumer å¯¹è±¡è´Ÿè´£å°†åˆ†éš”çš„å®¹å™¨ä¸­çš„æ•°æ®åˆå¹¶èµ·æ¥    List&lt;Integer&gt; dataList = IntStream.range(0, 10000).parallel().collect(new Supplier&lt;List&lt;Integer&gt;&gt;() {        @Override        public List&lt;Integer&gt; get() {            System.out.println("new Supplier");            return new ArrayList&lt;&gt;();        }    }, new ObjIntConsumer&lt;List&lt;Integer&gt;&gt;() {        @Override        public void accept(List&lt;Integer&gt; dataList, int value) {            dataList.add(value);        }    }, new BiConsumer&lt;List&lt;Integer&gt;, List&lt;Integer&gt;&gt;() {        @Override        public void accept(List&lt;Integer&gt; dataList1, List&lt;Integer&gt; dataList2) {            System.out.println("merge result");            dataList1.addAll(dataList2);        }    });    List&lt;Integer&gt; dataList1 = IntStream.range(0, 10000).collect(ArrayList::new, (list, i) -&gt; list.add(i), (lista, listb) -&gt; lista.addAll(listb));    List&lt;Integer&gt; dataList2 = IntStream.range(0, 10000).parallel().collect(ArrayList::new, (list, i) -&gt; list.add(i), (lista, listb) -&gt; lista.addAll(listb));    System.out.println(String.format("ä¸²è¡Œæ‰§è¡Œçš„å¤§å°ï¼š%s", list1.size()));    System.out.println(String.format("çº¿ç¨‹å®‰å…¨çš„å¹¶è¡Œå¤§å°ï¼š%s", dataList.size()));    System.out.println(String.format("çº¿ç¨‹å®‰å…¨çš„å¹¶è¡Œå¤§å°ï¼š%s", dataList1.size()));    System.out.println(String.format("çº¿ç¨‹å®‰å…¨çš„å¹¶è¡Œå¤§å°ï¼š%s", dataList2.size()));}</code></pre><ul><li>é€šè¿‡ collect æ–¹æ³•è§£å†³å¹¶å‘é—®é¢˜</li></ul><ol start=1><li>Supplier å¯¹è±¡è´Ÿè´£åˆ›å»ºå®¹å™¨å¯¹è±¡ï¼Œä»¥ä¾¿å®¹çº³ stream ä¸­åˆ†éš”åçš„æ•°æ®ï¼Œè¿™é‡Œä½¿ç”¨ List&lt;Integer> ä½œä¸ºæ•°æ®çš„å®¹å™¨å¯¹è±¡</li><li>ObjIntConsumer å¯¹è±¡è´Ÿè´£å°† stream ä¸­åˆ†éš”åçš„æ•°æ®æ”¾å…¥ä¸Šä¸€æ­¥åˆ›å»ºçš„å®¹å™¨ä¸­</li><li>BiConsumer å¯¹è±¡è´Ÿè´£å°†åˆ†éš”çš„å®¹å™¨ä¸­çš„æ•°æ®åˆå¹¶èµ·æ¥</li></ol><h1 class=pgc-h-arrow-right>3 Collectors å·¥å…·ç±»ä»‹ç»ä»¥åŠä½¿ç”¨</h1><p style=text-align:start>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­éƒ½ä½¿ç”¨äº† collect æ–¹æ³•ä»¥åŠè‡ªè¡Œå®ç°äº† Collector æ¥å£ã€‚æœ‰æ²¡æœ‰ jdk å·²ç»å®ç°å¥½çš„ Collector æ¥å£å‘¢ï¼Ÿ</p><h1 class=pgc-h-arrow-right>3.1 Collectors å·¥å…·ç±»æ–¹æ³•ä»‹ç»</h1><p style=text-align:start>ç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œå°±æ˜¯è¿™é‡Œå°†è¦ä»‹ç»çš„ Collectors å·¥å…·ç±»ï¼šjava.util.stream.Collectorsï¼Œå®Œæ•´çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class=pgc-img><img alt="æ·±å…¥ä»‹ç»å’Œä½¿ç”¨ Java 8 çš„ Collector æ¥å£å’Œ Collectors å·¥å…·ç±»" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6697a1bda5a747fc89be172989891078><p class=pgc-img-caption></p></div><p style=text-align:start>ä¸‹é¢æ¥ç®€è¦ä»‹ç»ä¸€ä¸‹ï¼Œä¸è°ˆå…·ä½“çš„å‚æ•°ï¼Œè¿”å›ç±»å‹éƒ½æ˜¯ Collector æ¥å£å¯¹è±¡ï¼Œå…·ä½“å¦‚ä¸‹</p><ol start=1><li>toCollectionï¼ŒtoListï¼ŒtoSetï¼šå¤„ç†å¹¶å°†ç»“æœè¿”å›æˆé›†åˆå¯¹è±¡</li><li>joiningï¼šå¤„ç†å¹¶å°†ç»“æœè¿”å›æˆå­—ç¬¦ä¸²</li><li>mappingï¼šé¦–å…ˆå°†æµä¸­çš„å…ƒç´ ä» T è½¬æˆ Uï¼Œç„¶åå†å°†å«æœ‰ U çš„æµè½¬ç»™ downstream ç»§ç»­å¤„ç†</li><li>collectingAndThenï¼šé¦–å…ˆå°†æµä¼ ç»™ downstream å¤„ç†ï¼Œç„¶åå°† downstream ä¸­çš„ R è½¬æˆ RRï¼Œæœ€åçš„ç»“æœä¸º RR</li><li>countingï¼šæ±‚æµä¸­å…ƒç´ çš„æ€»æ•°ï¼Œç±»å‹ä¸º Long</li><li>minBy: æ±‚æµä¸­æœ€å°çš„å…ƒç´ </li><li>maxByï¼šæ±‚æµä¸­æœ€å¤§çš„å…ƒç´ </li><li>summingIntï¼ŒsummingLongï¼ŒsummingDoubleï¼šæ±‚æµä¸­å…ƒç´ ä¹‹å’Œï¼Œå’Œçš„ç±»å‹åˆ†åˆ«æ˜¯ int, long, double ç±»å‹</li><li>averagingIntï¼ŒaveragingLongï¼ŒaveragingDoubleï¼šæ±‚æµä¸­å…ƒç´ çš„å¹³å‡æ•°ï¼Œå¹³å‡æ•°çš„ç±»å‹åˆ†åˆ«æ˜¯ int, long, double ç±»å‹</li><li>reducingï¼šå‡å°‘æµä¸­çš„å…ƒç´ </li><li>groupingByï¼šå°†æµä¸­çš„å…ƒç´ åˆ†ç»„å¤„ç†</li><li>groupingByConcurrentï¼šä»¥å¹¶è¡Œçš„æ–¹å¼å°†æµä¸­çš„å…ƒç´ åˆ†ç»„å¤„ç†</li><li>partitioningByï¼šå°†æµä¸­çš„å…ƒç´ åˆ†åŒºå¤„ç†</li><li>toMap, toConcurrentMapï¼šå¤„ç†å¹¶å°†ç»“æœè¿”å›æˆ Map å¯¹è±¡</li><li>summarizingIntï¼ŒsummarizingLongï¼ŒsummarizingDoubleï¼šæ±‡æ€»æµä¸­çš„å…ƒç´ ï¼Œæ±‡æ€»åçš„ç±»å‹åˆ†åˆ«æ˜¯ IntSummaryStatistics, LongSummaryStatistics, DoubleSummaryStatistics</li></ol><h1 class=pgc-h-arrow-right>3.2 Collectors å·¥å…·ç±»ä½¿ç”¨</h1><p style=text-align:start>ä¸‹é¢æ¥ä»‹ç»ä¸Šé¢çš„ 15 ä¸­æ–¹æ³•å…·ä½“ä½¿ç”¨</p><ul><li>å¢åŠ  Student å®ä½“å¦‚ä¸‹</li></ul><pre><code>import org.apache.commons.lang3.builder.ToStringBuilder;public class Student {    private int age;//å¹´é¾„    private String name;//å§“å    private String enName;// è‹±æ–‡ å§“å    private char gender;//æ€§åˆ«ï¼Œ0æœªçŸ¥ï¼Œ1ç”·ï¼Œ2å¥³    private double credit; // å­¦åˆ†    public int getAge() {        return age;    }    public void setAge(int age) {        this.age = age;    }    public String getName() {        return name;    }    public void setName(String name) {        this.name = name;    }    public String getEnName() {        return enName;    }    public void setEnName(String enName) {        this.enName = enName;    }    public char getGender() {        return gender;    }    public void setGender(char gender) {        this.gender = gender;    }    public double getCredit() {        return credit;    }    public void setCredit(double credit) {        this.credit = credit;    }    public Student(int age, String name, String enName, char gender, double credit) {        this.age = age;        this.name = name;        this.enName = enName;        this.gender = gender;        this.credit = credit;    }    @Override    public String toString() {        return new ToStringBuilder(this)                .append("age", age)                .append("name", name)                .append("enName", enName)                .append("gender", gender)                .append("credit", credit)                .toString();    }    public Student() {    }}</code></pre><ul><li>å…·ä½“çš„æµ‹è¯•å¦‚ä¸‹</li></ul><pre><code>import org.junit.After;import org.junit.Before;import org.junit.Test;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import java.math.BigDecimal;import java.util.*;import java.util.stream.Collectors;public class TestCollectorsApi {    private static final Logger logger = LoggerFactory.getLogger(TestCollectorsApi.class);    private static List&lt;Student&gt; userList = new ArrayList&lt;&gt;();    /**     * åˆå§‹åŒ– Student é›†åˆ     */    @Before    public void initEveryTestBefore() {        userList.add(new Student(22, "ç‹æ—­", "wang.xu", '1', 4));        userList.add(new Student(21, "å­™è", "sun.ping", '2', 3.6));        userList.add(new Student(23, "æ­¥ä¼ å®‡", "bu.zhuan.yu", '0', 4.1));        userList.add(new Student(18, "è”¡æ˜æµ©", "cai.ming.hao", '1', 3.5));        userList.add(new Student(17, "éƒ­æ—æ°", "guo.lin.jie", '1', 3.4));        userList.add(new Student(29, "éŸ©å‡¯", "han.kai", '0', 4));        userList.add(new Student(22, "éŸ©å¤©çª", "han.tian.qi", '1', 4));        userList.add(new Student(21, "éƒç®", "hao.wei", '2', 3.9));        userList.add(new Student(19, "èƒ¡äºšå¼º", "hu.ya.qing", '1', 3.5));        userList.add(new Student(14, "å­£æº", "ji.kai", '2', 4.2));        userList.add(new Student(17, "è†å¸…", "jing.shuai", '1', 4.1));        userList.add(new Student(16, "å§œæœ‰çª", "jiang.you.qi", '1', 2.5));        logger.info("initEveryTestBefore, size {}", userList.size());    }    /**     * æµ‹è¯•ç»“æŸï¼Œæ¸…ç†æ•°æ®     */    @After    public void destroyEveryTestAfter() {        logger.info("destroyEveryTestAfter, size {}", userList.size());        userList.clear();    }    @Test    public void toList() {        // æŒ‰ç…§å­¦åˆ†æ’åº        userList = userList                .stream()                .sorted(Comparator.comparing(Student::getCredit))                .collect(Collectors.toList());        // æ‰“å°æ•°æ®        userList.forEach(t -&gt; logger.info(t.toString()));    }    @Test    public void joining() {        // å°†å­¦ç”Ÿå§“ååˆå¹¶æˆä»¥,åˆ†éš”çš„å­—ç¬¦ä¸²        String names = userList                .stream()                .map(Student::getName)                .collect(Collectors.joining(","));        // æ‰“å°æ•°æ®        System.out.println(names);    }    @Test    public void mapping() {        // å°†å­¦ç”Ÿå§“ååˆå¹¶æˆä»¥,åˆ†éš”çš„å­—ç¬¦ä¸²        String names = userList                .stream()                .collect(Collectors.mapping(Student::getName, Collectors.joining(",")));        // æ‰“å°æ•°æ®        System.out.println(names);    }    @Test    public void collectingAndThen() {        // å°†å­¦ç”Ÿå§“ååˆå¹¶æˆä»¥,åˆ†éš”çš„å­—ç¬¦ä¸², å†é€šè¿‡ Function å¯¹è±¡å°†å­—ç¬¦ä¸²è½¬æˆ String[] å¯¹è±¡        String[] nameArr = userList                .stream()                .map(Student::getName)                .collect(Collectors.collectingAndThen(Collectors.joining(","), data -&gt; data.split(",")));        // æ‰“å°æ•°æ®        for (int i = 0; i &lt; nameArr.length; i++) {            System.out.println(nameArr[i]);        }    }    @Test    public void counting() {        // å°†å­¦ç”Ÿå§“ååˆå¹¶æˆä»¥,åˆ†éš”çš„å­—ç¬¦ä¸², å†é€šè¿‡ Function å¯¹è±¡å°†å­—ç¬¦ä¸²è½¬æˆ String[] å¯¹è±¡        Long count = userList                .stream()                .filter(student -&gt; student.getCredit() &gt; 4)                .collect(Collectors.counting());        // æ‰“å°æ•°æ®        System.out.println(String.format("å­¦åˆ†å¤§äº 4 çš„å­¦ç”Ÿäººæ•°ä¸º:%s", count));    }    @Test    public void minBy() {        // å…ˆå»é‡ï¼Œç„¶åè·å–å­¦åˆ†æœ€å°çš„å­¦ç”Ÿ        Optional&lt;Student&gt; student = userList                            .stream()                            .distinct()                            .collect(Collectors.minBy((stu1, stu2) -&gt; BigDecimal.valueOf(stu1.getCredit()).compareTo(BigDecimal.valueOf(stu2.getCredit()))));        // æ‰“å°æ•°æ®        System.out.println(String.format("å­¦åˆ†æœ€å°çš„å­¦ç”Ÿ:%s", student.get().toString()));    }    @Test    public void maxBy() {        // å…ˆå»é‡ï¼Œç„¶åè·å–å­¦åˆ†æœ€å¤§çš„å­¦ç”Ÿ        // ä½¿ç”¨ Comparator.comparing        Optional&lt;Student&gt; student = userList                .stream()                .distinct()                .collect(Collectors.maxBy(Comparator.comparing(Student::getCredit)));        // æ‰“å°æ•°æ®        System.out.println(String.format("å­¦åˆ†æœ€å¤§çš„å­¦ç”Ÿ:%s", student.get().toString()));    }    @Test    public void summingDouble() {        double total = userList                .stream()                .distinct()                .collect(Collectors.summingDouble(Student::getCredit));        // æ‰“å°æ•°æ®        System.out.println(String.format("å­¦åˆ†æ€»è®¡:%s", total));    }    @Test    public void averagingDouble() {        double average = userList                .stream()                .distinct()                .collect(Collectors.averagingDouble(Student::getCredit));        // æ‰“å°æ•°æ®        System.out.println(String.format("å­¦åˆ†å¹³å‡:%s", average));    }    @Test    public void reducing() {        // 1 è¿”å›å­¦åˆ†æœ€å¤§çš„å­¦ç”Ÿ        // reducing ç¬¬ä¸€ä¸ªå‚æ•° T identity è¡¨ç¤ºæœ€ç»ˆçš„è¿”å›ç±»å‹æˆ–è€…ç»“æœçš„å®¹å™¨        Student studentMax = userList                .stream()                .collect(Collectors.reducing(new Student(), (stu1, stu2) -&gt; stu1.getCredit() &gt; stu2.getCredit() ? stu1 : stu2));        // æ‰“å°æ•°æ®        System.out.println(String.format("è¿”å›å­¦åˆ†æœ€å¤§çš„å­¦ç”Ÿ:%s", studentMax));        // 2 è¿”å›å­¦åˆ†æœ€å¤§çš„å­¦ç”Ÿï¼Œä¸éœ€è¦æŒ‡å®š è¿”å›ç±»å‹æˆ–è€…ç»“æœçš„å®¹å™¨        Optional&lt;Student&gt; studentMin = userList                .stream()                .collect(Collectors.reducing((stu1, stu2) -&gt; stu1.getCredit() &gt; stu2.getCredit() ? stu1 : stu2));        // æ‰“å°æ•°æ®        System.out.println(String.format("è¿”å›å­¦åˆ†æœ€å¤§çš„å­¦ç”Ÿ:%s", studentMin.get().toString()));        // 3 æ‰€æœ‰å­¦ç”Ÿçš„å­¦åˆ†ä¹‹å’Œ        BigDecimal total = BigDecimal.ZERO;        BigDecimal totalCredit = userList                .stream()                .collect(Collectors.reducing(total, stu -&gt; total.add(BigDecimal.valueOf(stu.getCredit())), (data1, data2) -&gt; data1.add(data2)));        // æ‰“å°æ•°æ®        System.out.println(String.format("æ‰€æœ‰å­¦ç”Ÿçš„å­¦åˆ†ä¹‹å’Œ:%s", totalCredit));    }    @Test    public void groupingBy() {        // æŒ‰ç…§æ€§åˆ«åˆ†ç»„        Map&lt;Character, List&lt;Student&gt;&gt; dataMap = userList                .stream()                .collect(Collectors.groupingBy(Student::getGender));        // æ‰“å°æ•°æ®        dataMap.forEach((k,v) -&gt; {            System.out.println(String.format("æ€§åˆ«ï¼š%s", k));            v.forEach(System.out::println);            System.out.println("---------------------------");        });    }    @Test    public void groupingByConcurrent() {        // æŒ‰ç…§æ€§åˆ«åˆ†ç»„        Map&lt;Character, List&lt;Student&gt;&gt; dataMap = userList                .stream()                .collect(Collectors.groupingByConcurrent(Student::getGender));        // æ‰“å°æ•°æ®        dataMap.forEach((k,v) -&gt; {            System.out.println(String.format("æ€§åˆ«ï¼š%s", k));            v.forEach(System.out::println);            System.out.println("---------------------------");        });    }    @Test    public void partitioningBy() {        // æŒ‰ç…§å­¦åˆ†æ˜¯å¦å¤§äº 4 åˆ†ç»„        Map&lt;Boolean, List&lt;Student&gt;&gt; dataMap = userList                .stream()                .collect(Collectors.partitioningBy(stu -&gt; stu.getCredit() &gt; 4));        // æ‰“å°æ•°æ®        dataMap.forEach((k,v) -&gt; {            System.out.println(k ? "å­¦åˆ†å¤§äº4ï¼š" : "å­¦åˆ†å°äº4ï¼š");            v.forEach(System.out::println);            System.out.println("---------------------------");        });    }    @Test    public void toMap() {        // å°†æ•°æ®è½¬æˆ Map        Map&lt;String, Double&gt; dataMap = userList                .stream()                .collect(Collectors.toMap(stu -&gt; stu.getName(), stu -&gt; stu.getCredit()));        // æ‰“å°æ•°æ®        dataMap.forEach((k,v) -&gt; {            System.out.println(String.format("å§“åï¼š%sï¼Œ å­¦åˆ†ï¼š%s:", k, v));        });    }    @Test    public void summarizingDouble() {        // æ•°æ®ç»Ÿè®¡        DoubleSummaryStatistics doubleSummaryStatistics = userList                .stream()                .distinct()                .collect(Collectors.summarizingDouble(Student::getCredit));        System.out.println(String.format("å­¦ç”Ÿæ€»æ•°ï¼š%s", doubleSummaryStatistics.getCount()));        System.out.println(String.format("æ‰€æœ‰å­¦ç”Ÿçš„å¹³å‡å­¦åˆ†ï¼š%s", doubleSummaryStatistics.getAverage()));        System.out.println(String.format("æœ€é«˜å­¦åˆ†ï¼š%s", doubleSummaryStatistics.getMax()));        System.out.println(String.format("æœ€ä½å­¦åˆ†ï¼š%s", doubleSummaryStatistics.getMin()));        System.out.println(String.format("å­¦åˆ†æ€»å’Œï¼š%s", doubleSummaryStatistics.getSum()));    }}</code></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'ä»‹ç»','Java','Collector'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>