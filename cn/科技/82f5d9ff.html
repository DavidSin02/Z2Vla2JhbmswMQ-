<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Scalaå¾ªç¯æ€§èƒ½é—®é¢˜ï¼Œä¸ºäº†æ€§èƒ½ï¼Œä½ æ„¿æ„ç‰ºç‰²ä»£ç çš„å¯ç»´æŠ¤æ€§ä¹ˆï¼Ÿ | æå®¢å¿«è¨Š</title><meta property="og:title" content="Scalaå¾ªç¯æ€§èƒ½é—®é¢˜ï¼Œä¸ºäº†æ€§èƒ½ï¼Œä½ æ„¿æ„ç‰ºç‰²ä»£ç çš„å¯ç»´æŠ¤æ€§ä¹ˆï¼Ÿ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/314c9a3074774fb48305ca5173282bb5"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/82f5d9ff.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/82f5d9ff.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/82f5d9ff.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/82f5d9ff.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/82f5d9ff.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/82f5d9ff.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/82f5d9ff.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/82f5d9ff.html><meta property="article:published_time" content="2020-11-14T21:05:49+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:49+08:00"><meta name=Keywords content><meta name=description content="Scalaå¾ªç¯æ€§èƒ½é—®é¢˜ï¼Œä¸ºäº†æ€§èƒ½ï¼Œä½ æ„¿æ„ç‰ºç‰²ä»£ç çš„å¯ç»´æŠ¤æ€§ä¹ˆï¼Ÿ"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/82f5d9ff.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Scalaå¾ªç¯æ€§èƒ½é—®é¢˜ï¼Œä¸ºäº†æ€§èƒ½ï¼Œä½ æ„¿æ„ç‰ºç‰²ä»£ç çš„å¯ç»´æŠ¤æ€§ä¹ˆï¼Ÿ</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div class=pgc-img><img alt=Scalaå¾ªç¯æ€§èƒ½é—®é¢˜ï¼Œä¸ºäº†æ€§èƒ½ï¼Œä½ æ„¿æ„ç‰ºç‰²ä»£ç çš„å¯ç»´æŠ¤æ€§ä¹ˆï¼Ÿ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/314c9a3074774fb48305ca5173282bb5><p class=pgc-img-caption></p></div><p>æœ€è¿‘æˆ‘åœ¨å­¦ä¹ æˆ‘ä»¬äº§å“çš„ä»£ç ï¼Œçœ‹åˆ°äº†ç±»ä¼¼ä»¥ä¸‹çš„ä¸€æ®µä»£ç ï¼š</p><pre><code>x.set(1) x.set(2) x.set(3)x.set(4)x.set(5)</code></pre><p>æˆ‘å½“æ—¶å¾ˆæ˜¯ç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆä¸ç”¨å¾ªç¯å‘¢ï¼Ÿäºæ˜¯å°±æŠ¥äº†ä¸€ä¸ªIssueï¼Œå¿ƒæƒ³è¿™æ ·å†™å¯èƒ½æœ‰å®ƒçš„é“ç†ï¼Œä½†æ˜¯éœ€è¦æ¾„æ¸…ä¸€ä¸‹ã€‚</p><p>å¦ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘å‘ç°ä»£ç é‡Œå¯¹å¾ªç¯çš„ä½¿ç”¨ï¼Œå„æœ‰ä¸åŒçš„æ–¹å¼ï¼Œæœ‰äººå†™array.foreach(f=>_),æœ‰äººç”¨ä½¿ç”¨indexçš„for loopï¼Œä¸ªäººè§‰å¾—ä½¿ç”¨foreachçš„ä»£ç æ¯”è¾ƒç®€æ´ï¼Œäºæ˜¯æˆ‘ä¹ŸæŠ¥äº†Issueï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯åº”è¯¥ä½¿ç”¨ç®€æ´çš„æ–¹å¼æ¥å†™å¾ªç¯ã€‚ä¸¾ä¾‹ï¼š</p><p>for loop</p><pre><code>var index = 0var arr = Array[String]var length = arr.length for ( index &lt;- 0 to length ) {    do()}</code></pre><p>for each</p><pre><code>var index = 0var arr = Array[String]var length = arr.length for ( index &lt;- 0 to length ) {    do()}</code></pre><p>æ˜æ˜¾foreachçš„ç‰ˆæœ¬è¦çœä¸å°‘ä»£ç ã€‚</p><p>åæ¥å’Œæˆ‘ä»¬çš„å·¥ç¨‹å¸ˆæ²Ÿé€šäº†ä¸€ä¸‹ï¼ŒåŸæ¥æˆ‘ä»¬æ˜¯ä¸ºäº†æ€§èƒ½ä¼˜åŒ–äº†ä»£ç ï¼Œå› ä¸ºfor loopæ¯”foreachçš„æ€§èƒ½å¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨ç¨å¾®ç¹ççš„for loopã€‚è‡³äºæŸäº›ä»£ç ä¸­çš„foreachæ˜¯å› ä¸ºé—ç•™çš„è¿˜æ²¡æœ‰æ¥å¾—åŠæ”¹åŠ¨ã€‚</p><p>Scalaçš„å¾ªç¯å°±è¡Œæ€§èƒ½å¦‚ä½•å‘¢ï¼Ÿæˆ‘è¿˜æ˜¯æµ‹è¯•ä¸€ä¸‹å†è¯´å§ã€‚</p><p>å…ˆçœ‹çœ‹ä¸åŒçš„å¾ªç¯ç”¨æ³•ï¼Œæˆ‘è¿™é‡Œæµ‹è¯•äº†å››ç§ï¼Œåˆ†åˆ«æ˜¯ while loopï¼Œfor loopï¼Œä½¿ç”¨rangeçš„foreachï¼Œ å’Œä½¿ç”¨å‡½æ•°çš„foreach</p><p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><p>-</p><pre><code>package profilingobject Loop {  def whileLoop(arr:Array[Int]): Unit = {    var idx = 0    var n = arr.length    val tStart = System.currentTimeMillis()    while (idx &lt; n) {      arr(idx) = 1      idx += 1    }    val tEnd = System.currentTimeMillis()    println("while loop took " + (tEnd - tStart) + "ms")  }  def forLoop(arr:Array[Int]): Unit = {    var idx = 0    var n = arr.length    val tStart = System.currentTimeMillis()    for(idx &lt;- 0 until n) {      arr(idx) = 1    }    val tEnd = System.currentTimeMillis()    println("for loop took " + (tEnd - tStart) + "ms")  }  def foreachLoop(arr:Array[Int]): Unit = {    var n = arr.length    val tStart = System.currentTimeMillis()    (0 until n).foreach{idx =&gt; arr(idx) = 1}    val tEnd = System.currentTimeMillis()    println("foreach range took " + (tEnd - tStart) + "ms")  }  def foreachFuncLoop(arr:Array[Int]): Unit = {    val tStart = System.currentTimeMillis()    arr.foreach{ idx =&gt; arr(idx) = 1}    val tEnd = System.currentTimeMillis()    println("foreach function took " + (tEnd - tStart) + "ms")  }  def profileRun(n: Int) {    val arr = new Array[Int](n)    whileLoop(arr)    foreachLoop(arr)    forLoop(arr)    foreachFuncLoop(arr)  }  def main(args:Array[String]) {    profileRun(args(0).toInt)  }}</code></pre><p>æˆ‘çš„ç¯å¢ƒæ˜¯scala 2.13.1 , è°ƒç”¨500000000æ¬¡çš„ç»“æœæ˜¯ï¼š</p><p>-</p><p>Bash ä»£ç </p><pre><code>while loop took 344msforeach range took 484msfor loop took 422msforeach function took 719ms</code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œwhile loopæ˜¯æœ€å¿«çš„ï¼Œä¸€èˆ¬å½¢å¼çš„foreachæœ€æ…¢ï¼Œå·®ä¸å¤šæ˜¯while loopçš„ä¸€å€ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨rangeçš„è¯ï¼Œforeachå¾ªç¯ä¹Ÿä¸ç®—å¤ªæ…¢ã€‚</p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆforeachä¼šæ…¢å‘¢ï¼Ÿ ä¸»è¦æ˜¯foreachçš„å‡½æ•°è°ƒç”¨å¸¦æ¥äº†é¢å¤–çš„å¼€é”€ã€‚æˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„æ•°æ®å…¶å®æ˜¯ç¼–è¯‘å™¨å·²ç»ä¼˜åŒ–åçš„æ•°å­—ï¼Œå¦‚æœæˆ‘ä»¬æŠŠjavaçš„hotspotç¼–è¯‘é€‰é¡¹å…³é—­ï¼Œï¼ˆ-Xintï¼‰å†çœ‹çœ‹æ€§èƒ½ã€‚</p><pre><code>while loop took 8548msforeach range took 39392msfor loop took 40799msforeach function took 103489ms</code></pre><p>å¦‚æœå…³é—­JITï¼Œforeachçš„æ€§èƒ½è¦è¿œè¿œå·®äºå…¶ä»–å‡ ä¸ªé€‰é¡¹ã€‚</p><p><br></p><p>å¯¹äºå¾ªç¯çš„æ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºè¿™æ ·çš„ç»“è®ºï¼š</p><p><br></p><ul><li>åœ¨æ­£å¸¸æ‰“å¼€JITçš„æƒ…å†µä¸‹ï¼Œforeachçš„æ€§èƒ½å¤§æ¦‚æ¯”å…¶ä»–å‡ ä¸ªé€‰é¡¹æ…¢ä¸€å€ï¼Œå…¶ä»–å‡ ä¸ªé€‰é¡¹æ€§èƒ½æ¥è¿‘</li><li>åœ¨å…³é—­JITä¼˜åŒ–çš„æƒ…å†µä¸‹ã€‚foreachçš„æ€§èƒ½è¦è¿œä½äºå…¶ä»–é€‰é¡¹ ï¼ˆç”Ÿäº§ç¯å¢ƒä¸€èˆ¬ä¸è€ƒè™‘ï¼‰</li></ul><p><br></p><p>é‚£ä¹ˆå¯¹äºå¼€å¤´è®²çš„ä¸ç”¨å¾ªç¯ï¼Œç›´æ¥é‡å¤ä»£ç å‘¢ï¼Ÿæˆ‘ä»¬ä¹Ÿæµ‹è¯•äº†ä¸€ä¸‹ï¼š</p><pre><code>package profilingobject Loop2Repeat {  def whileLoop(): Unit = {    var idx = 0    var n = 5    var x = 0    while (idx &lt; n) {      x = idx      idx += 1    }  }  def repeatLoop(): Unit = {    var x = 0    x = 1    x = 2    x = 3    x = 4    x = 5  }  def test( f:()=&gt;Unit, num: Int, name: String): Unit = {    val tStart = System.currentTimeMillis()    ( 0 until num).foreach{ _ =&gt; f}    val tEnd = System.currentTimeMillis()    println(name + " took " + (tEnd - tStart) + "ms")  }  def main(args:Array[String]) {    test(whileLoop, 50000000, "whileLoop")    test(repeatLoop, 50000000, "repeatLoop")  }}</code></pre><p><br></p><p>ç»è¿‡50000000æ¬¡å¾ªç¯ï¼Œæ•°æ®å¦‚ä¸‹ï¼š</p><pre><code>whileLoop took 281msrepeatLoop took 47ms</code></pre><p>ç¡®å®ï¼Œå› ä¸ºå¾ªç¯æ§åˆ¶çš„é€»è¾‘å¸¦æ¥çš„é¢å¤–å¼€é”€ï¼Œæ¯”ç®€å•çš„é‡å¤ä»£ç æ€§èƒ½ä¸‹é™äº†ä¸å°‘ã€‚</p><p></p><p><br></p><p>å¥½äº†ï¼Œæ•°æ®æˆ‘ä»¬éƒ½æœ‰äº†ï¼Œé—®é¢˜æ¥äº†ï¼Œä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼Œä½ æ„¿æ„ç‰ºç‰²å¤šå°‘ä»£ç çš„ç®€æ´æ€§å’Œå¯è¯»æ€§å‘¢ï¼Ÿæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥å‚åŠ æœ¬æ–‡ä¸­çš„æŠ•ç¥¨ï¼Œç»™å‡ºä½ çš„æ„è§ã€‚</p><p>æˆ‘çš„è§‚ç‚¹ï¼š</p><p><br></p><ul><li>æ€§èƒ½å¾ˆé‡è¦ï¼Œä½†æ˜¯ä¸ºäº†æ€§èƒ½è€Œç‰ºç‰²ä»£ç çš„å¯è¯»æ€§ï¼Œå¯ç»´æŠ¤æ€§ï¼Œæˆ‘è§‰å¾—æ˜¯å€¼å¾—è€ƒè™‘çš„ï¼Œé™¤éæ˜¯é¡¹ç›®éå¸¸å…³é”®çš„éƒ¨ä»¶ï¼Œæˆ‘ä¼šå€¾å‘ä¿ç•™ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚</li><li>æˆ‘ä»¬çš„é¡¹ç›®æ˜¯Java/Scalaæ··ç¼–ï¼Œæœ¬æ¥ç”¨Scalaå°±æ˜¯ä¸ºäº†å®ƒçš„ä¸€äº›å…ˆè¿›çš„è¯­æ³•ç‰¹æ€§ï¼Œä¸»è¦æ˜¯ä»£ç çš„æ˜“è¯»æ˜“å†™ã€‚ä¸ºäº†æ€§èƒ½ä¼˜åŒ–ï¼Œæˆ‘ä»¬æŠŠScalaçš„ä»£ç å†™çš„å’ŒJavaä¸€æ ·æˆ–è€…è¿˜ä¸å¦‚Javaæ˜“è¯»ï¼Œæ˜¯å¦æœ‰æ‚–æˆ‘ä»¬é‡‡ç”¨Scalaçš„åˆè¡·å‘¢ï¼Ÿ</li></ul></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'æ€§èƒ½','Scala','å¾ªç¯'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>