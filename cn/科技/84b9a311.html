<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>有关中断程序分类情况的讨论 | 极客快訊</title><meta property="og:title" content="有关中断程序分类情况的讨论 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/d5a4f5c6eb754f4fac7c574dd3393d82"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/84b9a311.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/84b9a311.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/84b9a311.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/84b9a311.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/84b9a311.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/84b9a311.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/84b9a311.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/84b9a311.html><meta property="article:published_time" content="2020-10-29T21:09:37+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:37+08:00"><meta name=Keywords content><meta name=description content="有关中断程序分类情况的讨论"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/84b9a311.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>有关中断程序分类情况的讨论</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><strong>计算机科学里面的中断，是指一个程序。</strong></p><p>中断的意思是指，CPU不再接着（刚执行完的指令）向下执行，而是转去处理这个特殊信息。</p><p>CPU的设计者必须在中断信息和其处理程序的入口地址之间建立某种联系，使得CPU根据中断信息可以找到要执行的处理程序。</p><p>我们知道，中断信息INT n中包含有标识中断源的类型码n。根据CPU的设计，中断类型码的作用就是用来定位中断处理程序。</p><div class=pgc-img><img alt=有关中断程序分类情况的讨论 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d5a4f5c6eb754f4fac7c574dd3393d82><p class=pgc-img-caption>图一</p></div><p>中断向量表在内存中存放，对于8086PC机，中断向量表指定放在内存地址0处。</p><p>从内存0000:0000到0000:03FF的1024个单元中存放着中断向量表。</p><p><strong>CPU进入中断程序的步骤：</strong></p><p>用中断类型码找到中断向量，并用它设置CS和IP，这个工作是由CPU的硬件自动完成的。</p><p>CPU 硬件完成这个工作的过程被称为中断过程。</p><p>在使用 call 指令调用子程序时有同样的问题（不包含中断类型码），子程序执行后还要返回到原来的执行点继续执行，所以，call 指令先保存当前 CS 的 IP值，然后再设置CS和IP。</p><p><strong>Call指令导致的中断属于内中断</strong>，因为中断信息由指令提供。8086CPU的内中断过程：</p><p>（1）（从中断信息中）取得中断类型码；</p><p>（2）标志寄存器的值入栈（ 因为在中断过程中要改变标志寄存器的值，所以先将其保存在栈中。）；</p><p>（3）设置标志寄存器的第8位TF 和第9位IF的值为0；</p><p>（4）CS的内容入栈；</p><p>（5）IP的内容入栈；</p><p>（6）从内存地址为中断类型码*4 和中断类型码 *4+2 的两个字单元中读取中断处理程序的入口地址设置IP和CS。</p><div class=pgc-img><img alt=有关中断程序分类情况的讨论 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4292f6eee72b4f38a3db750d373e0445><p class=pgc-img-caption>图二</p></div><p>在中断过程中还要做的一个工作就是设置标志寄存器的TF、IF位。</p><p>由于CPU随时都可能检测到中断信息，也就是说，CPU 随时都可能执行中断处理程序，所以中断处理程序必须一直存储在内存某段空间之中。</p><p>而中断处理程序的入口地址，即中断向量，必须存储在对应的中断向量表表项中。</p><p>Debug 下面又一个单步执行T命令。在使用 T 命令执行指令时，Debug 将TF设置为 1，使得CPU在工作於单步中断方式下，则在CPU执行完这条指令后就引发单步中断，执行单步中断的中断处理程序，所有寄存器中的内容被显示在屏幕上，并且等待输入命令。<strong>单步执行属于内中断。</strong></p><p><strong>计算机通过BIOS和DOS向用户提供中断例程以供调用。</strong></p><p>BIOS和DOS提供的中断例程是如何安装到内存中的呢？</p><p>（1） 开机后，CPU 一加电，初始化(CS)=0FFFFH，(IP)=0，自动从FFFF:0单元开始执行程序。FFFF:0处有一条转跳指令，CPU执行该指令后，转去执行BIOS中的硬件系统检测和初始化程序。</p><p>（2）初始化程序将建立BIOS 所支持的中断向量，即将BIOS提供的中断例程的入口地址登记在中断向量表中。</p><p>（3） 硬件系统检测和初始化完成后，调用int 19h进行操作系统的引导。从此将计算机交由操作系统控制。</p><p>（4）DOS 启动后，除完成其它工作外，还将它所提供的中断例程装入内存，并建立相应的中断向量。</p><p>任何程序的运行均离不开一定的硬件环境和软件环境。 基本硬件环境包括CPU、存储器、I/O设备(键盘、磁盘、打印机、显示卡等)。从原理上讲，使用IN/OUT指令可以控制任何I/O设备。以打印机为例，使用IN指令可以读入打印机的状态(有/无纸、能否接收新的数据等)、使用OUT指令把数据送给打印机、给打印机发控制命令(移动打印头、某些打印针击打)。一个简单的I/O设备使用要求，需要一系列IN/OUT等控制指令，可以把一些基本使用要求编写为子程序，供调用。事实上，BIOS中，以中断处理程序的形式提供了微机中基本I/O设备的控制程序，称为"BIOS中断"，应用程序可以用"INT n"指令调用这些程序。</p><p>　　程序运行的主要软件环境是操作系统。操作系统为程序运行提供基本的服务，如，程序的装入、结束，内存的分配，文件管理等。以DOS操作系统为例，它也以中断处理程序的形式提供这些服务，称为"DOS中断"， 应用程序也用"INT 21H"指令调用这些服务。 MS_DOS的DOS中断是由IO.SYS、MSDOS.SYS两个文件提供的中断处理程序。(PC_DOS：IBMBIO.COM、IBMDOS.COM)。</p><p>　　PC系列机有256种中断类型，8086CPU使用其中5个(0号除数为0中断、1号单步中断、2号NMI中断、3号断点中断、4号溢出中断)，80286及以上系统中，通过中断控制器8259使用的硬件中断为16个。其余中断类型为BIOS中断和DOS中断，它们称为"软件中断"。</p><div class=pgc-img><img alt=有关中断程序分类情况的讨论 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/0c1a2a814f3341b3b56bc64db02902c8><p class=pgc-img-caption>IBM PC/XT 机中的256级中断安排</p></div><p><strong>BIOS提供的中断基本和输入输出设备有关。</strong></p><p>比如，显示器I/O中断功能调用：</p><div class=pgc-img><img alt=有关中断程序分类情况的讨论 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/da8ea6bc72d941489208d6f9f2b32e71><p class=pgc-img-caption>图三</p></div><p>　DOS的绝大部分功能均以INT 21H中断处理程序提供。不同DOS版本一般均有几十个INT 21H功能。这些功能有文件和磁盘管理、字符设备管理、时钟管理、内存管理、网络管理等。</p><div class=pgc-img><img alt=有关中断程序分类情况的讨论 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/283fc825e2c143cca0e327be9fdbe2bd><p class=pgc-img-caption>DOS功能表</p></div><p><strong>DOS提供的中断举例。</strong></p><div class=pgc-img><img alt=有关中断程序分类情况的讨论 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4179de286c0d44c5a3fd9eec11f05dd1><p class=pgc-img-caption>图四</p></div><p><strong>在PC 系统中，按照是否响应中断源一共有两类：</strong></p><p><strong>1、可屏蔽中断</strong></p><p><strong>2、不可屏蔽中断</strong></p><p>可屏蔽中断是CPU 可以不响应的外中断。CPU 是否响应可屏蔽中断，要看标志寄存器的IF 位的设置。</p><p>当CPU 检测到可屏蔽中断信息时：</p><p>如果IF=1，则CPU 在执行完当前指令后响应中断，引发中断过程；</p><p>如果IF=0，则不响应可屏蔽中断。</p><p>不可屏蔽中断是CPU 必须响应的外中断。当CPU 检测到不可屏蔽中断信息时，则在执行完当前指令后，立即响应，引发中断过程。</p><p>对于8086CPU 不可屏蔽中断的中断类型码固定为2。所以中断过程中，不需要取中断类型码。</p><p>可屏蔽中断所引发的中断过程 ，除在第1步的实现上有所不同外，基本上和内中断的中断过程相同。</p><p><strong>几乎所有由外设引发的外中断，都是可屏蔽中断。</strong>当外设有需要处理的事件（比如说键盘输入）发生时，相关芯片向CPU 发出可屏蔽中断信息。</p><p>不可屏蔽中断是在系统中有必须处理的紧急情况发生时用来通知CPU 的中断信息。不可屏蔽中断请求经由专门的CPU针脚NMI，通知CPU发生了灾难性事件，如电源掉电、总线奇偶位出错等。内部不可屏蔽中断请求是CPU内部自发产生的，如存储器读写出错、溢出中断、除法出错中断等，除此之外的内中断基本都是可屏蔽中断。</p><p><br></p><p><strong>中断按照中断类型码的来源分为内中断和外中断。</strong></p><p><strong>外中断信息来自于CPU外部，中断类型码是通过数据总线送入CPU 的；</strong></p><p><strong>而内中断的中断类型码是在CPU内部产生的。</strong></p><p>图三属于外中断，图四的DOS功能调用属于内中断。外中断更为容易理解的例子：</p><div class=pgc-img><img alt=有关中断程序分类情况的讨论 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/07d3b90f17d742e289c826cf801b435f><p class=pgc-img-caption>图五</p></div><p>键盘输入的处理过程：</p><p>（1）键盘产生扫描码；</p><p>（2）扫描码送入60h 端口；in al,60h</p><p>（3）引发9 号中断；int 9 中断直接由指令in al,60h触发，不需要在程序中出现。int 9 中断例程除了接收扫描码外，还要产生和扫描码对应的字符码，以便在屏幕显示。</p><p>注意，int 9 中断例程属于BIOS中断，与DOS的9号功能调用不是一回事：</p><p>MOV AH,9</p><p>MOV DX,OFFSET MESG ;取MESG的偏移地址</p><p>INT 21H (这是显示一个字符串）</p><p>（4）CPU执行int 9中断例程处理键盘输入。</p><p>从上面分析可以看到，外中断是由于CPU外部有按键的动作发生，才触发了9号中断。</p><div class=pgc-img><img alt=有关中断程序分类情况的讨论 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/cc2a2c5d8e9b4826921dde7b324572ae><p class=pgc-img-caption>图六</p></div><p><strong>本文总结如下：</strong></p><p><strong>1：CPU处理中断程序，必须先保护原地址再进入中断程序。</strong></p><p><strong>2：按中断提供方分类，分为BIOS中断和DOS中断。</strong></p><p><strong>3：中断按是否允许执行分为可屏蔽与不可屏蔽中断。</strong></p><p><strong>4：中断按中断信息的来源分为内中断与外中断。</strong></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'有关','中断','分类'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>