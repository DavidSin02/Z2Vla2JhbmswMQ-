<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 | 极客快訊</title><meta property="og:title" content="创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/dfic-imagehandler/3b8cb777-6c9f-4d02-9412-9d4e26488710"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/866b06ba.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/866b06ba.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/866b06ba.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/866b06ba.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/866b06ba.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/866b06ba.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/866b06ba.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/866b06ba.html><meta property="article:published_time" content="2020-11-14T21:03:07+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:07+08:00"><meta name=Keywords content><meta name=description content="创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/866b06ba.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><strong>什么是文件？</strong></p><p>在计算机没有被发明出来之前，它通常以纸质的形式存在，通过文字和笔墨将人们口述或者大脑里的想法记录下来的实体。</p><p><br></p><div class=pgc-img><img alt=创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/3b8cb777-6c9f-4d02-9412-9d4e26488710><p class=pgc-img-caption>在记事本中编写的手</p></div><p><br></p><p>文件可以是竹简、纸张、牛羊皮等等，它记录了人类的智慧结晶和一切生产行为，如果没有文件存在并进行传承，那整个人类的文明就无从谈起了。</p><p>计算机和编程语言本质上就是人类的智慧结晶，高度抽象化的产物。</p><p>那么在计算机中，文件是如何产生并存在的呢？</p><p>我们都知道计算机中有两个东西必不可少，内存和硬盘。</p><p>简单的说我们在计算机中产生文件其实就是将内存中的数据存储到硬盘里，</p><p>大家肯定在编写文档的时候随时选择保存防止数据丢失吧。</p><p>那你现在大概已经知道了当你敲击键盘每次产生的数据都临时放在内存中，直到你点击菜单选择保存时计算机会将内存中的数据存储到硬盘中。</p><p><br></p><div class=pgc-img><img alt=创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f491a7cbfacb4dffa1126d6c4d16cc6b><p class=pgc-img-caption></p></div><p>今天我们就来讲讲Python的文件管理、对象序列化相关的内容。</p><p>通过本章的学习我们将掌握如何读写文件，自定义文件内容相关知识。</p><h1 class=pgc-h-arrow-right>知识点:</h1><ul class=ul-list><li>Python文件读取、写入、删除</li><li>Python的对象序列化和反序列化</li><li>自定义nb文件格式</li></ul><h1 class=pgc-h-arrow-right>Python文件读取</h1><p>让我们先来准备一个文本文件并且写一段代码来读取它。</p><p><br></p><div class=pgc-img><img alt=创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/254ab3fff24741eb84df1853be761eae><p class=pgc-img-caption></p></div><p>首先我在电脑上写了一个叫hello.txt的文本文件并保存了下来，其中有两行内容。</p><pre><code>f = open('hello.txt', 'r')print(f.read())</code></pre><p>现在我们来看看程序运行的结果。</p><p><br></p><div class=pgc-img><img alt=创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ceb7f19fb306420f9bf90dd14059700c><p class=pgc-img-caption></p></div><p>结果跟你想的一样吗？</p><p>通过这两行行代码和输出结果我们会学到几个知识点。</p><ol start=1><li>Python里通过<strong>open()</strong>内置函数打开一个文件，其中open()函数接收的第二个参数表示打开文件的模式，例如我只想读取文件，就传一个 <strong>"r"</strong> 字符就行了，它是英文 read 的意思。</li><li>open()函数 打开文件后会得到一个 文件对象，我们定义了一个变量f来接收它。</li><li>通过文件对象的<strong>read()</strong>函数会获取全部内容，由print() 函数打印出来。</li></ol><p><strong>关于文件打开模式这里有一个表格，希望大家保存记住，便于随时查阅。</strong></p><p><br></p><div class=pgc-img><img alt=创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/8e3c1f54b8034acf82494dc1f1ee4cc7><p class=pgc-img-caption></p></div><p>现在我们再想想刚才的代码，其实有个缺陷，那就是我们能不能根据自己的需求一行一行的读取文件内容，而不是一下就把它打印了出来。</p><p>我们来看看如何读取文件的每一行内容吧。</p><pre><code>f = open('hello.txt', 'r')for i in f.readlines():    print(f"文件内容:{i}")</code></pre><p><br></p><div class=pgc-img><img alt=创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2f27d91cc9a74bf9b71c662439430026><p class=pgc-img-caption></p></div><p>我们通过文件对象的 <strong>readlines() </strong>函数对文件按行读取内容，实际上readlines()函数会得到一个列表，列表里的每个元素就是每一行的实际内容。</p><p><br></p><div class=pgc-img><img alt=创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6446b749f42141ef9a7cc77161133492><p class=pgc-img-caption></p></div><p>通过以上例子我们可以发现readlines() 函数其实会获得一个列表对象。</p><p><br></p><p>不过唯一有一点疑惑的就是为什么“第一行”后面会多一个<strong> "\n"</strong>，而且它叫换行符，表示遇到它时就该换行了。</p><p>因为Python的print()函数在输出内容时本来就会进行自动换行，所以我们会发现在之前的输出结中。</p><pre><code>文件内容：第一行文件内容：第二行</code></pre><p>这个输出文件内容之间多了一个换行，其实就是这个 "\n" 换行符起了作用。</p><p><br></p><h1 class=pgc-h-arrow-right>Python文件写入</h1><p>了解了读取文件信息，现在我们来看看怎么用Python写入文件信息的。</p><pre><code>f = open('hello.txt', 'r+')for x in range(1, 10):    line_txt = f"第{x}行内容\n"    f.write(line_txt)f.close()</code></pre><p>现在来解读一下代码。</p><ol start=1><li>我们用 <strong>"r+"</strong> 模式进行读写文件</li><li>生成一个可迭代对象，从1循环到10</li><li>通过文件对象的<strong>write()</strong>函数写入文件内容</li><li>写入文件完成后，通过文件对象的close()函数关闭文件，它的作用是关闭文件对象，不再接受新的输入信息，这个时候如果再写入文件内容，程序就会报错了，需要重新用open函数打开文件才能继续写入。</li></ol><p>以下是hello.txt的内容，一共写入了9行文字内容和最后一个空行"\n"。</p><div class=pgc-img><img alt=创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/bd4e57a38e0040ac958cccd5ebfaaa69><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>Python文件删除</h1><p>关于如何删除文件，在Python里有很多种方式，在这里我们只介绍一种。</p><pre><code>import osos.remove(文件名)</code></pre><p>通过引入 <strong class=highlight-text>os</strong> 这个Pyhton自带的库，我们可以完成很多跟文件相关的操作，其中的<strong>remove()</strong>函数就是用来删除文件的，当我们remove()一个不存在的文件或者文件夹时，程序就会会报错。</p><p><br></p><h1 class=pgc-h-arrow-right>Python的对象序列化</h1><p>在讲序列化之前先想想，我们的计算机里除了刚才的 hello.txt 这类的txt文本文件之外是不是还有 xls、png、avi、mp3等等各种类型的文件格式？</p><p>它们是如何产生的？它们存储的格式是怎么样的呢？</p><p>这些文件的存储格式不再是文本格式，而是字节流信息，换句话说就是二进制信息。</p><p>我们知道程序在运行时向内存申请资源，然后开始计算，将计算结果暂存在内存里的各种对象里。对象包括图片信息、视频信息、电子表格信息等等。</p><p><strong>程序将对象通过二进制的方式从内存存储到硬盘文件的过程就叫做序列化</strong>。</p><p>本章的前言里说到人类通过纸张将大脑里的信息用笔通过文字录下来，变成了文件。</p><p>那么在计算机里把对象序列化的这个过程其实就是人类用文字和笔记录下来的过程。</p><p><br></p><div class=pgc-img><img alt=创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/2029b6ea-2ded-4b95-b0c3-de3b48dd5284><p class=pgc-img-caption></p></div><p><br></p><p>现在我们来试试Python怎么进行对象序列化的。</p><pre><code>import picklef = open('object_file', 'wb')list1 = [1,2,3,4,5,6]pickle.dump(list1, f)</code></pre><p>以上代码我们引用到了Python自带的库<strong class=highlight-text>pickle。</strong></p><p><strong>pickle是Python中专门用来做对象序列化操作的库</strong>。</p><p>通过它我们可以把对象进行序列化或者反序列化，简单的说就是把对象存储到文件里，或者从文件里直接读取出对象信息到程序里。</p><p>而pickle的<strong>dump()</strong>函数的作用就是 将一个对象直接输出到硬盘文件里。</p><p>现在回到代码里来理解一下执行过程。</p><ol start=1><li>程序先是用 <strong>"wb"</strong> 的方式新建一个文件，叫做 object_file。"wb" 模式表示写入一个二进制文件。</li><li>创建了一个1-6的列表内容</li><li>通过dump()函数把对象直接写入到文件里，dump()第一个参数是需要存储的对象，第二个参数是需要存储的文件。</li></ol><p>现在来看看我们写入的文件内容。</p><p><br></p><div class=pgc-img><img alt=创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/dba6dedf67694b008b9a5957aec79d0a><p class=pgc-img-caption></p></div><p>两个字，<strong>看不懂！</strong></p><p>因为我们用文本编辑器打开的一个二进制文件，它无法识别这些二进制文件的内容。</p><p>对于初学者来说这就是一堆莫名其妙的符号。</p><p>那么如何正确的解析这些数据呢？这个时候就需要用到<strong>反序列化了</strong>。</p><p><br></p><h1 class=pgc-h-arrow-right>Python的对象反序列化</h1><p><br></p><div class=pgc-img><img alt=创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/5b6b98a2dae04a73991921865f1c53f9><p class=pgc-img-caption></p></div><p>通过以上代码，我们利用pickle的<strong>load()</strong> 函数进行反序列化，把刚才保存在文件里的二进制信息又变成了列表对象了。</p><p>反序列化本身其实没什么好讲的，它就是将文件里的信息读取出来并转换为程序里可用的对象，反序列化顾名思义就是它所做的事情和序列化的过程完全相反。</p><p><br></p><h1 class=pgc-h-arrow-right>自定义nb文件格式</h1><p>现在我们了解了对象序列化的方法后，是不是可以发散思维。我们是不是可以自定义一种文件格式，就叫它 <strong>nb </strong>格式吧。</p><p>文件名看起来像这样 111.nb、222.nb，然后这种文件格式可以在屏幕上展示图像内容，当然这些图像内容如何展现都取决于我们自己。</p><p>具体流程如下（细节不用深究）：</p><ul class=ul-list><li>创建一种文件扩展名为nb的格式</li><li>通过Python现成的matplotlib库来进行画图</li><li>定义图片格式内容，简单期间，我们就在屏幕上画一条曲线</li><li>准备两个列表，作为曲线的x和y座标数据，分别命名为x,y</li></ul><p>现在我们来写代码吧。</p><p><br></p><div class=pgc-img><img alt=创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/cb9f77bda4c24429a9c533bcaef68a92><p class=pgc-img-caption></p></div><p>通过以上10行代码，我们创建了一种新的文件格式出来。</p><p>需要注意的是pickle.dump()可以多次写入数据，每次写入一个对象信息。</p><p>现在我们看看写入的111.nb文件内容是什么样的。</p><p><br></p><div class=pgc-img><img alt=创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8454a81992684e78b417154678eda98b><p class=pgc-img-caption></p></div><p>不出所料，111.nb是一堆二进制的数据，现在我们需要写程序来进行反序列化，解析它的内容了。</p><p><br></p><div class=pgc-img><img alt=创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/58c31438410b4bbebb293f71a72a11f7><p class=pgc-img-caption></p></div><p>来解读一下上面的代码。</p><ol start=1><li>我们多引入了一个叫<strong>matplotlib</strong>的库，利用到了它的<strong>pyplot</strong>模块来进行绘图。</li><li>然后通过<strong>"rb"</strong>模式（二进制文件读取）打开111.nb文件。</li><li>通过pickle的<strong>load() </strong>函数加载文件里的内容，并将其还原成Python里的对象，用 x、y这两个变量保存起来。</li><li>这个还原的过程load()函数会自动帮我们完成，我们在现阶段不需要关心它的原理，以后高级课程会讲到。</li><li>load()函数同样可以多次加载数据，直到文件里的所有对象全部读出为止。</li></ol><p>最后，我们通过pyplot模块绘制图形。</p><p><strong>pyplot.plot(x, y)</strong> 这行代码用于加载x、y的信息，通过pyplot.show()将图片显示出来。</p><p><br></p><div class=pgc-img><img alt=创建一个扩展名为nb的图片，浅谈Python的文件管理和序列化操作 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6f83131cc22f414a9eacd078654e3091><p class=pgc-img-caption></p></div><p>至此我们基本完成了一种名为nb文件格式的设计，可能有人会问，那我直接把这个文件传给我的朋友，他打开后会显示图片吗？</p><p>当然不会！甚至在你的电脑上都不能够直接显示，你需要借助刚才编写的代码对其进行解析后才能够显示出来。</p><p>你想想如果你的电脑上不装Excel或者Word，那么xls表格文件和doc文档可以打开吗？</p><p>像jpg、png、gif之类的文件之所以能直接被打开并显示，原因是因为操作系统本身对其做了支持。</p><p>现在我们已经搞懂了如何利用Python的pickle生成自己想要的二进制信息并对其进行解析了，在以后可以利用它创建更多的自定义格式文件出来。</p><p><strong>在大多数情况下我们只会用到pickle的dump和load函数来做序列化相关的事情</strong>。</p><h1 class=pgc-h-arrow-right>使用pickle的注意事项</h1><p>在使用pickle库进行序列化的时候要注意最好不要用它来存储大容量的对象信息（例如1亿个字符串），如果有大容量数据的需求，可以选择用别的库来实现，pickle库只是应对于常见情况。</p><p>同时也要注意在load时确保来源数据文件是可信的，因为在load时Python会自动加载模块构造对象，如果攻击者恶意制造一个破坏系统信息的对象文件，我们去load时就会有麻烦了。</p><p><br></p><h1 class=pgc-h-arrow-right>总结</h1><p>关于Pyhton文件管理相关的基础知识就讲到这，通过本章的知识我们可以创建一些自定义内容的数据将其保存起来，在网络上进行传输。</p><p>掌握好文件管理相关的技能，才能更好的编写实用性的Python代码，并帮助我们更好的工作。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'序列化','创建','一个'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>