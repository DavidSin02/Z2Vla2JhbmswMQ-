<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>还在用 if else？试试策略模式吧 | 极客快訊</title><meta property="og:title" content="还在用 if else？试试策略模式吧 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/RcOtMMX2P9Kha3"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8881266c.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8881266c.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8881266c.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8881266c.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8881266c.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8881266c.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8881266c.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8881266c.html><meta property="article:published_time" content="2020-11-14T21:05:50+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:50+08:00"><meta name=Keywords content><meta name=description content="还在用 if else？试试策略模式吧"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/8881266c.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>还在用 if else？试试策略模式吧</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><img alt="还在用 if else？试试策略模式吧" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RcOtMMX2P9Kha3><p>作者 | LA</p><p>来源 | 程序员小灰（ID：chengxuyuanxiaohui）</p><p>我们使用的App大多都有分享的功能，我们可以选择不同的地方，比如微博、微信、QQ等等，虽然是同一个内容，但是不同的平台就会有不同的处理方式，比如要跳转到不同的App或者直接复制链接等等。如果让你来实现这个功能，你会如何实现呢？</p><img alt="还在用 if else？试试策略模式吧" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RxcX7ZC6whLkrB><p>如果你对设计模式不熟悉，那么第一反应就是有if...else或者switch语句来进行条件判断，根据用户的不同选择而使用不同的处理方法。我们用代码简化地处理一下：</p><pre>public void Share{<br>public void shareOptions(String option){<br>if(option.equals("微博")){<br>//function1;<br>//...<br>}else if(option.equals("微信")){<br>//function2;<br>//...<br>}else if(option.equals("朋友圈")){<br>//function3;<br>//...<br>}else if(option.equals("QQ")){<br>//function4;<br>//...<br>}<br>//...<br>}<br></pre><p>如果只是写一个这么简单的功能，那么这样的代码也未尝不可，因为这样的代码量不多，后续也不需要怎么拓展和修改，维护起来也不算麻烦。但是，我们工作中遇到的都是一些比较复杂的项目，要保证项目的可读性、可维护性和可拓展性，就必须在代码上下功夫了。</p><p>这里我们就要提到一个概念，那就是设计模式了。设计模式是指针对软件开发过程中重复发生的问题的解决办法。其中以被称为Gang of Four（GoF）的4人整理出的23种设计模式最为有名。</p><p>当然，我不可能在这里把23种设计模式全部介绍完，就算全部介绍一遍，而且你还能全部记住，也不一定奏效。首先，你没有必要全部记下来，因为这23种设计模式并非都是经常使用到的设计模式。其次，死记硬背下这些设计模式没有任何意义，重要的是在自己脑海中理解设计模式是怎样解决问题的。</p><p>今天我们就谈谈可以优化以上问题的设计模式，策略模式（Strategy Design Pattern）。</p><p></p><h1 toutiao-origin=h2>策略模式</h1><p>策略指的是计策、谋略，而模式一般指人为整理而成的，在某种场景下重复发生的问题的解决办法。在编程中，我们可以把策略看做是“算法”，而策略模式，按照GoF的定义，就是我们设计一些算法，把它们封装起来，让它们可以相互替换，这样就可以轻松地切换不同的算法来解决同一个问题。</p><p>我们看一下策略模式中有哪些角色。</p><ul><li><p>Strategy（策略）Strategy角色负责决定实现策略所必需的接口（API）。在示例程序中，由strategy接口扮演此角色。</p></li><li><p>ConcreteStrategy（具体的策略）ConcreteStrategy角色负责实现Strategy角色的接口（API），即负责实现具体的策略（战略、方向、方法和算法）。</p></li><li><p>Context（上下文）负责使用Strategy角色。Context角色保存了ConcreteStrategy角色的实例，并使用ConcreteStrategy角色去实现需求（总之，还是要调用Strategy角色的接口（API））。</p></li></ul><p>再看看策略模式的类图：</p><img alt="还在用 if else？试试策略模式吧" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RxcX7ZsGzla6d4><p>介绍到这里，相信你对策略模式有了初步的认识，那我们就用策略模式来重构前面的代码，让你加深对策略模式的理解。</p><pre><pre>//定义策略接口<br>public interface DealStrategy{<br>void dealMythod(String option);<br>}<br><br>//定义具体的策略1<br>public class DealSina implements DealStrategy{<br>@override<br>public void dealMythod(String option){<br>//...<br>}<br>}<br><br>//定义具体的策略2<br>public class DealWeChat implements DealStrategy{<br>@override<br>public void dealMythod(String option){<br>//...<br>}<br>}<br><br>//定义上下文，负责使用DealStrategy角色<br>public static class DealContext{<br>private String type;<br>private DealStrategy deal;<br>public DealContext(String type,DealStrategy deal){<br>this.type = type;<br>this.deal = deal;<br>}<br>public DealStrategy getDeal{<br>return deal;<br>}<br>public boolean options(String type){<br>return this.type.equals(type);<br>}<br>}<br><br>public void Share{<br>private static List&lt;DealContext&gt; algs = new ArrayList;<br>//静态代码块,先加载所有的策略<br>static {<br>algs.add(new DealContext("Sina",new DealSina));<br>algs.add(new DealContext("WeChat",new DealWeChat));<br>}<br>public void shareOptions(String type){<br>DealStrategy dealStrategy = ;<br>for (DealContext deal : algs) {<br>if (deal.options(type)) {<br>dealStrategy = deal.getDeal;<br>break;<br>}<br>}<br>dealStrategy.dealMythod(type);<br>}<br>}</pre></pre><p>再回忆一下策略模式中的各个角色，代码中的DealStrategy接口就是策略，DealSina和DealWeChat是具体的策略，DealContext就是使用策略的上下文。</p><p>所以这样的代码已经符合策略模式的代码结构了。我们通过策略模式将策略的定义、创建、使用解耦，让每一部分都不至于太复杂，也去除了if...else这样的条件判断语句，代码的可维护性和可拓展性都提高了。</p><p>我们把可变的部分放到 了Share 类中的静态代码段中。如果有新的需求，要添加一个分享的方式时，只需要定义好具体的策略，然后修改 Share 类中的静态代码段，其他代码都不需要修改。</p><p>策略模式还是比较常用的一种设计模式，比如java中给我定义好的Comparator 接口就是策略模式的一个实践。</p><p>如果需要对某个类的排序，而该类没有实现Comparable接口，那么可以建立一个实现Comparator接口的比较器即可。通过实现Comparator类来新建一个比较器，然后通过该比较器来对类进行排序。</p><pre><pre>//策略接口<br>public interface Comparator&lt;T&gt; {<br>int compare(T o1, T o2);<br>}<br><br>//需要我们来定义具体的策略<br>public class sorter implements Comparator{<br>public int compare(String s1, String s2) {<br>return Integer.compare(s1.length, s2.length);<br>}<br>}<br>//一般我们会用更简洁的Lambda表达式来实现</pre></pre><p>如果你使用的是Java ，想更符合开闭原则，并对反射有一定了解，那还可以通过反射来避免对类的修改。</p><p>你可以通过一个配置文件或者定义一个注解来标注定义的策略类；通过读取配置文件或者搜索被标注的策略类，通过反射动态地加载这些策略类、创建策略对象；当我们新添加一个策略的时候，只需要将这个新添加的策略类添加到配置文件或者用定义的注解标注即可。</p><p>Strategy模式特意将算法与其他部分分离开来，只是定义了与算法相关的接口（APl），然后在程序中以委托的方式来使用算法。</p><p>这样看起来程序好像变复杂了，其实不然。例如，当我们想要通过改善算法来提高算法的处理速度时，如果使用了Strategy模式，就不必修改Strategy角色的接口（API）了，仅仅修改ConcreteStrategy角色即可。</p><p>而且，使用委托这种弱关联关系可以很方便地整体替换算法。例如，使用Strategy模式编写棋类程序时，可以方便地根据棋手的选择切换AI电脑的水平。</p><p>至此，我们可以小结出策略模式的使用场景：</p><ul><li><p>一个项目中有许多类，它们之间的区别仅在于它们的行为，希望动态地让一个对象在许多行为中选择一种行为时；</p></li><li><p>一个项目需要动态地在几种算法中选择一种时；</p></li><li><p>一个对象有很多的行为，不想使用多重的条件选择语句来选择使用哪个行为时。</p></li></ul><p>策略模式不仅仅可以优化if else代码，其主要的作用还是解耦策略的定义、创建和使用，控制代码的复杂度，让每个部分都不至于过于复杂、代码量过多。除此之外，对于复杂代码来说，策略模式还能让其满足开闭原则，添加新策略的时候，最小化、集中化代码改动，减少引入 Bug 的风险。</p><p><strong>可能有人会问：状态模式也可以优化if else，那么策略模式和状态模式又有什么不同呢？</strong></p><p>让我们来简单回顾一下状态模式的类图：</p><img alt="还在用 if else？试试策略模式吧" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RxcX7aZIKcP3JJ><p>使用策略模式和状态模式都可以替换被委托对象，而且它们的类之间的关系也很相似。但是两种模式的目的不同。</p><p>在策略模式中，ConcreteStrategy角色是表示算法的类。在Strategy模式中，可以替换被委托对象的类。当然如果没有必要，也可以不替换。</p><p>而在状态模式中，ConcreteState角色是表示“状态”的类。在State模式中，每次状态变化时，被委托对象的类都必定会被替换。</p><p>好了，关于策略模式我们就是介绍到这里。你在做项目时用过策略模式吗？是在什么场景中使用呢？欢迎留言说说。</p><pre><div><img alt="还在用 if else？试试策略模式吧" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/R69FpRH4d90a7d></div><p>☞八年，腾讯优图攒了多厚的技术“家底”？</p><p>☞程序员不好好写代码，就只能回去当总理了！</p><p>☞华为海思超越高通，一季度国内占有率第一；苹果 iOS 13.5 优化 Face ID；Ruby 2.4 结束支持 | 极客头条</p><p>☞AI图像智能修复老照片，效果惊艳到我了</p><p>☞程序员内功修炼系列：10 张图解谈 Linux 物理内存和虚拟内存</p><p>☞当 DeFi 遇上 Rollup，将擦出怎样的火花？</p></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'还在','else','试试'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>