<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>关于static和const的解释 | 极客快訊</title><meta property="og:title" content="关于static和const的解释 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/dfic-imagehandler/ccda3473-d99c-47b5-8199-6c5b471a81e6"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/88b29f13.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/88b29f13.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/88b29f13.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/88b29f13.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/88b29f13.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/88b29f13.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/88b29f13.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/88b29f13.html><meta property="article:published_time" content="2020-11-14T20:59:56+08:00"><meta property="article:modified_time" content="2020-11-14T20:59:56+08:00"><meta name=Keywords content><meta name=description content="关于static和const的解释"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/88b29f13.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>关于static和const的解释</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>static 是c++中很常用的修饰符，它被用来控制变量的存储方式和可见性，下面我将从 static 修饰符的产生原因、作用谈起，全面分析static 修饰符的实质。</p><p><strong>static 的两大作用:</strong></p><p><strong>一、控制存储方式：</strong></p><p>　　static被引入以告知编译器，将变量存储在程序的静态存储区而非栈上空间。</p><p>　　1、引出原因：函数内部定义的变量，在程序执行到它的定义处时，编译器为它在栈上分配空间，大家知道，函数在栈上分配的空间在此函数执行结束时会释放掉，这样就产生了一个问题: 如果想将函数中此变量的值保存至下一次调用时，如何实现？</p><p>最容易想到的方法是定义一个全局的变量，但定义为一个全局变量有许多缺点，最明显的缺点是破坏了此变量的访问范围（使得在此函数中定义的变量，不仅仅受此函数控制）。</p><p>　　2、 解决方案：因此c++ 中引入了static，用它来修饰变量，它能够指示编译器将此变量在程序的静态存储区分配空间保存，这样即实现了目的，又使得此变量的存取范围不变。</p><p><strong>二、控制可见性与连接类型 :</strong></p><p>　　static还有一个作用，它会把变量的可见范围限制在编译单元中，使它成为一个内部连接，这时，它的反义词为”extern”.</p><p>　　static作用分析总结：static总是使得变量或对象的存储形式变成静态存储，连接方式变成内部连接，对于局部变量（已经是内部连接了），它仅改变其存储方式；对于全局变量（已经是静态存储了），它仅改变其连接类型。</p><p><br></p><p><strong>类中的static成员：</strong></p><p><strong>一、出现原因及作用：</strong></p><p>　　1、需要在一个类的各个对象间交互，即需要一个数据对象为整个类而非某个对象服务。</p><p>　　2、同时又力求不破坏类的封装性,即要求此成员隐藏在类的内部，对外不可见。</p><p>　　类的static成员满足了上述的要求，因为它具有如下特征：有独立的存储区，属于整个类。</p><p><strong>二、注意：</strong></p><p>　　1、对于静态的数据成员，连接器会保证它拥有一个单一的外部定义。静态数据成员按定义出现的先后顺序依次初始化，注意静态成员嵌套时，要保证所嵌套的成员已经初始化了。消除时的顺序是初始化的反顺序。</p><p>　　2、类的静态成员函数是属于整个类而非类的对象，所以它没有this指针，这就导致了它仅能访问类的静态数据和静态成员函数。</p><p>const 是c++中常用的类型修饰符，但我在工作中发现，许多人使用它仅仅是想当然尔，这样,有时也会用对，但在某些微妙的场合，可就没那么幸运了，究其实质原由，大多因为没有搞清本源。故在本篇中我将对const进行辨析。溯其本源，究其实质，希望能对大家理解const有所帮助，根据思维的承接关系，分为如下几个部分进行阐述。</p><p><br></p><p><strong>c++中为什么会引入const</strong></p><p>　　c++的提出者当初是基于什么样的目的引入（或者说保留）const关键字呢？，这是一个有趣又有益的话题，对<strong>理解const</strong>很有帮助。</p><p>1． 大家知道，c++有一个类型严格的编译系统，这使得c++程序的错误在编译阶段即可发现许多，从而使得出错率大为减少，因此，也成为了c++与c相比，有着突出优点的一个方面。</p><p>2． c中很常见的预处理指令 #define variablename variablevalue 可以很方便地进行值替代，这种值替代至少在<strong>三个方面优点突出</strong>：</p><p>　　一是避免了意义模糊的数字出现，使得程序语义流畅清晰，如下例：</p><p>　　#define user_num_max 107 这样就避免了直接使用107带来的困惑。</p><p>　　二是可以很方便地进行参数的调整与修改，如上例，当人数由107变为201时，进改动此处即可，</p><p>　　三是提高了程序的执行效率，由于使用了预编译器进行值替代，并不需要为这些常量分配存储空间，所以执行的效率较高。</p><p>　　鉴于以上的优点，这种预定义指令的使用在程序中随处可见。</p><p>3． 说到这里，大家可能会迷惑上述的1点、2点与const<strong>有什么关系呢</strong>？好，请接着向下看：</p><p>　　预处理语句虽然有以上的许多优点，但它有个比较致命的缺点，即，预处理语句仅仅只是简单值替代，缺乏类型的检测机制。这样预处理语句就不能享受c++严格类型检查的好处，从而可能成为引发一系列错误的隐患。</p><p>4．好了，第一阶段结论出来了：</p><p>结论： const 推出的初始目的，正是为了取代预编译指令，消除它的缺点，同时继承它的优点。</p><p>现在它的形式变成了：</p><p>const datatype variablename = variablevalue ;</p><p><br></p><p><strong>为什么const能很好地取代预定义语句？</strong></p><p><strong>const 到底有什么大神通，使它可以振臂一挥取代预定义语句呢？</strong></p><p><strong>1． 首先</strong>，以const 修饰的常量值，具有不可变性，这是它能取代预定义语句的基础。</p><p><strong>2． 第二</strong>，很明显，它也同样可以避免意义模糊的数字出现，同样可以很方便地进行参数的调整和修改。</p><p><strong>3． 第三</strong>，c++的编译器通常不为普通const常量分配存储空间，而是将它们保存在符号表中，这使得它成为一个编译期间的常量，没有了存储与读内存的操作，使得它的效率也很高，同时，这也是它取代预定义语句的重要基础。这里，我要提一下，为什么说这一点是也是它能取代预定义语句的基础，这是因为，编译器不会去读存储的内容，如果编译器为const分配了存储空间，它就不能够成为一个编译期间的常量了。</p><p><strong>4． 最后</strong>，const定义也像一个普通的变量定义一样，它会由编译器对它进行类型的检测，消除了预定义语句的隐患。</p><div class=pgc-img><img alt=关于static和const的解释 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/ccda3473-d99c-47b5-8199-6c5b471a81e6><p class=pgc-img-caption></p></div><p><br></p><p><strong>const 使用情况分类详析</strong></p><p><br></p><p>1.const 用于指针的两种情况分析：</p><pre>　int const *a; 　file://a可变，*a不可变　int *const a; 　file://a不可变，*a可变 </pre><p>　　分析：const 是一个左结合的类型修饰符，它与其左侧的类型修饰符和为一个类型修饰符，所以，int const 限定 *a,不限定a。int *const 限定a,不限定*a。</p><p><br></p><p>2.const 限定函数的传递值参数：</p><pre>　void fun(const int var);</pre><p>　　分析：上述写法限定参数在函数体中不可被改变。由值传递的特点可知，var在函数体中的改变不会影响到函数外部。所以，此限定与函数的使用者无关，仅与函数的编写者有关。</p><p>结论：最好在函数的内部进行限定，对外部调用者屏蔽，以免引起困惑。如可改写如下：</p><pre>void fun(int var){const int &amp; varalias = var;varalias .........} </pre><p>3.const 限定函数的值型返回值：</p><pre>const int fun1(); const myclass fun2();</pre><p>　分析:上述写法限定函数的返回值不可被更新，当函数返回内部的类型时（如fun1），已经是一个数值，当然不可被赋值更新，所以，此时const无意义，最好去掉，以免困惑。当函数返回自定义的类型时（如fun2），这个类型仍然包含可以被赋值的变量成员，所以，此时有意义。</p><p>4. 传递与返回地址： 此种情况最为常见，由地址变量的特点可知，适当使用const，意义昭然。</p><p>5.　const 限定类的成员函数：</p><pre>class classname {　public:　　int fun() const;　.....}</pre><p>　　注意：采用此种const 后置的形式是一种规定，亦为了不引起混淆。在此函数的声明中和定义中均要使用const,因为const已经成为类型信息的一部分。</p><p>获得能力：可以操作常量对象。</p><p>失去能力：不能修改类的数据成员，不能在函数中调用其他不是const的函数。</p><p>　　在本篇中，const方面的知识我讲的不多，因为我不想把它变成一本c++的教科书。我只是想详细地阐述它的实质和用处. 我会尽量说的很详细，因为我希望在一种很轻松随意的气氛中说出自己的某些想法，毕竟，编程也是轻松，快乐人生的一部分。有时候，你会惊叹这其中的世界原来是如此的精美。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'关于','static','const'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>