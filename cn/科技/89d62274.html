<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>FastDFS 分布式文件系统详解 | 极客快訊</title><meta property="og:title" content="FastDFS 分布式文件系统详解 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/f75efb8752b74ea384109115f7d8c4f6"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/89d62274.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/89d62274.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/89d62274.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/89d62274.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/89d62274.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/89d62274.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/89d62274.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/89d62274.html><meta property="article:published_time" content="2020-11-14T21:03:23+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:23+08:00"><meta name=Keywords content><meta name=description content="FastDFS 分布式文件系统详解"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/89d62274.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>FastDFS 分布式文件系统详解</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">什么是文件系统</span></strong></h1><div class=pgc-img><img alt="FastDFS 分布式文件系统详解" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f75efb8752b74ea384109115f7d8c4f6><p class=pgc-img-caption></p></div><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　文件系统是操作系统用于在磁盘或分区上组织文件的方法和数据结构。磁盘空间是什么样的我们并不清楚，但文件系统可</span><span style="color:#34495e;--tt-darkmode-color: #809CB9">以</span><span style="color:#34495e;--tt-darkmode-color: #809CB9">给我们呈现一个非常清晰的表象，我们可以创建、删除、修改和复制这些文件，而实现这些功能的软件就是文件系统。操作系统中负责</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">管理和存储文件信息的软件被称为文件管理系统</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">，简称文件系统。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　文件系统是操作系统的一个重要组成部分，通过对操作系统所管理的存储空间的抽象，向用户提供统一的、对象化的访问接口，屏蔽对物理设备的直接操作和资源管理。也就是说，</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">文件系统解决了普通用户使用磁盘存储数据的问题</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">文件系统的发展史</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　根据计算环境和所提供功能的不同，文件系统可划分为以下几种。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">单机文件系统</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">特点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：用于操作系统和应用程序的本地存储。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">缺点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：数据无法在多台机器之间共享。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">代表</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：EXT2、EXT3、EXT4、NTFS、FAT、FAT32、XFS、JFS 等等。</span></p><div class=pgc-img><img alt="FastDFS 分布式文件系统详解" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/6eb80185e6c4465f9131bcc765a6e257><p class=pgc-img-caption></p></div><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">网络文件系统</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">特点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：基于现有以太网架构，实现不同服务器之间传统文件系统的数据共享。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">缺点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：两台服务器不能同时访问修改，性能有限。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">代表</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：NFS、CIFS 等等，比如下图 Windows 主机之间进行网络文件共享就是通过微软公司自己的 CIFS 服务实现的。</span></p><div class=pgc-img><img alt="FastDFS 分布式文件系统详解" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/49b898fb4940416299501d65a880c204><p class=pgc-img-caption></p></div><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">分布式文件系统</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　数据量越来越多，在一个操作系统管辖的范围存不下了，那么就分配到更多的操作系统管理的磁盘中，但是不方便管理和维护，因此迫切需要一种系统来管理多台机器上的文件，</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">这就是分布式文件管理系统</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　分布式文件系统（Distributed File System）是一种允许文件通过网络在多台主机上共享的文件系统，可以让多机器上的多用户进行文件分享和存储。在这样的文件系统中，客户端并非直接访问底层的数据存储区块，而是通过网络，以特定的通信协议和服务器沟通。DFS 为分布在网络上任意位置的资源提供一个逻辑上的树形文件系统结构，让用户访问分布在网络上的共享文件更加简便。所有高层次的文件系统都是以低层次的传统文件系统为基础，实现了更高级的功能。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">特点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：在传统文件系统上，通过额外模块实现数据跨服务器分布，并且自身集成 RAID 保护功能，可以保证多台服务器同时访问、修改同一个文件系统。性能优越，扩展性强，可靠性高。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">缺点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：部分类型存在单点故障风险。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">代表</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：HDFS（ASF）、MogileFS（LiveJournal）、FastDFS（余庆）、Lustre（Oracle）、GlusterFS（RedHat）等等。</span></p><div class=pgc-img><img alt="FastDFS 分布式文件系统详解" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e2899d90712349a8ba6e13fc9cac18f3><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">通用型</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　通用分布式文件系统和传统的本地文件系统（如 EXT4、NTFS 等）相对应。典型代表：Lustre、MooseFS。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">优点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：传统文件系统的操作方式，对开发者门槛较低。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">缺点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：系统复杂性较高，需要支持若干标准的文件操作，如：目录结构、文件读写权限、文件锁等。系统整体性能有所降低，因为要支持 POSIX 标准（可移植操作系统接口 Portable Operating System Interface of UNIX）。</span></p><blockquote><p><span style="color:#777;--tt-darkmode-color: #777777">POSIX 全称：可移植操作系统接口。当 Unix 诞生之后，各个厂商都实现了自己的 Unix 系统，导致接口不统一，基于不同的操作系统开发变得极其混乱，为了解决这一问题，便有了 POSIX 标准。</span></p><p><span style="color:#777;--tt-darkmode-color: #777777">总结：POSIX 标准的诞生就是为了统一操作系统的接口，方便开发者开发应用程序，写出可移植的代码程序。基于 POSIX 标准的库函数都是可以在此标准的操作系统平台上移植。</span></p></blockquote><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">专用型</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　专用分布式文件系统基于谷歌文件系统论文（Google File System）的设计思想而来，文件上传后不能修改。使用专有 API 对文件进行访问，也可称为分布式文件存储服务。典型代表：HDFS、MogileFS、FastDFS。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">优点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：系统复杂性较低，不需要支持若干标准的文件操作，如：目录结构、文件读写权限、文件锁等。系统整体性能较高，因为无需支持 POSIX 标准，系统更加高效。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">缺点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：采用专有 API 对文件进行访问，对开发者门槛较高，一般都是</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">直接封装成工具类</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">进行使用。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">文件服务器的发展史</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　随着互联网图片、视频时代的到来，对文件的处理成为各个业务系统面临的巨大挑战，亟需搭建特有的文件服务器解决文件共享的问题。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">本地文件服务器</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">特点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：本地文件服务器是指</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">文件数据直接存储在本地节点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">中。比如直接在项目目录下建立文件夹存放项目文件资源，如果按不同类型再细分，可以在项目目录下继续创建不同的子目录用于区分。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">优点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：简单便捷，项目可以直接引用，访问方便。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">缺点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：文件与代码混合存储不便于管理，随着文件的增多影响项目发布上线周期。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">独立文件服务器</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">特点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：搭建一台独立的服务器用于文件存储使用，项目上传文件时，先通过 ftp 或者 ssh 将文件上传至服务器某个目录下，再通过 Ngnix 或者 Apache Http Server 反向代理此目录，返回一个独立域名的文件 URL 地址，前端通过这个 URL 地址即可直接访问文件。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">优点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：独立存储，可以方便扩容、容灾和数据迁移。方便做图片访问请求的负载均衡，方便应用各种缓存策略（HTTP Header、Proxy Cache 等），也更加方便迁移到 CDN。而且图片访问是很消耗服务器资源的（因为会涉及到操作系统的上下文切换和磁盘 I/O 操作），分离出来以后，Web/App 服务器可以更专注发挥动态处理的能力。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">缺点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：单机存在性能瓶颈，容灾、垂直扩展性差。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">分布式文件服务器</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">特点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：分布式文件系统一般包括</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">访问的仲裁</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">，</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">文件的存储</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">，</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">文件的容灾</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">三大块。仲裁模块相当于文件服务器的大脑，根据一定的算法来决定文件存储的位置。文件存储模块负责保存文件。容灾模块负责文件数据的相互备份。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">优点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：弹性伸缩，性能优越，扩展性强，可靠性高。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">缺点</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">：系统复杂度稍高，需要更多服务器。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">FastDFS 简介</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　FastDFS 就是我们上述所说的</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">专用分布式文件系统</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">，接下来我们就详细了解它的核心概念，架构体系及环境的搭建与使用。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　FastDFS 是基于 C 语言开发的，是一个轻量级开源的高性能分布式文件系统。主要功能有：文件存储、文件同步、文件访问(文件上传/下载)，解决了大容量的文件存储和高并发访问的问题，文件存取时实现了负载均衡。FastDFS 特别适合中大型网站以文件为载体的在线服务，适合存储 </span><span style="color:#e96900;--tt-darkmode-color: #E96900"><span style="background-color:#f8f8f8;--tt-darkmode-bgcolor: #191919">4KB ~ 500MB</span></span> 之间的小文件，如照片共享网站、视频共享网站（图片、文档、音频、视频等等）。</p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　FastDFS 是一款国产开源软件，作者余庆，项目开源地址 Github：https://github.com/happyfish100/fastdfs 官方论坛：http://bbs.chinaunix.net/forum-240-1.html</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">FastDFS 架构</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><div class=pgc-img><img alt="FastDFS 分布式文件系统详解" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9d29d9bf52ef405dbd7f5f19a2ace99f><p class=pgc-img-caption></p></div><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">Client</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">客户端</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">，实现文件上传下载的服务器，就是我们自己的项目所部署在的服务器。通过专有接口，使用 TCP/IP 协议与跟踪服务器或存储服务器进行数据交互。FastDFS 向使用者提供基本文件访问接口，比如 upload、download、append、delete 等，以客户端库的方式提供给用户使用。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">Tracker Server</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">跟踪服务器</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">，负责文件访问的调度和负载均衡，负责管理所有的 Storage Server 和 group 组/卷。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">Storage Server</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">存储服务器</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">，负责文件存储，文件同步/备份，提供文件访问接口，文件元数据管理。以 group 为单位，每个 group 内可以有多台 Storage Server，数据互为备份，达到容灾的目的。每个 Storage 在启动以后会主动连接 Tracker，告知自己所属 group 等存储相关信息，并保持周期性心跳。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">Group</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">组</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">， 也可称为 Volume 卷。同组内服务器上的文件是完全相同的，同一组内的 Storage Server 之间是对等的，文件上传、删除等操作可以在任意一台 Storage Server 上进行。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">Metadata</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　文件系统中存储的数据分为</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">数据</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">和</span><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">元数据</span></strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">两部分，数据是指文件中的实际数据，即文件的实际内容；而元数据是用来描述一个文件特征的系统数据，诸如访问权限、文件拥有者以及文件数据块的分布信息等等。如果文件是一张图片，元数据就是图片的宽，高等等。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><h1 class=pgc-h-arrow-right><strong><span style="color:#34495e;--tt-darkmode-color: #809CB9">FastDFS 存储策略</span></strong></h1><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　为了支持大容量存储，Storage 存储服务器采用了分组（或分卷）的方式。存储系统由一个或多个组组成，组与组之间的文件是相互独立的，所有组的文件容量累加就是整个存储系统中的文件容量。一个组可以由一台或多台存储服务器组成，一个组下的存储服务器中的文件都是相同的，组中的多台存储服务器起到了冗余备份和负载均衡的作用。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　当组中增加了新的服务器时，系统会自动同步已有的文件，同步完成后，系统自动将新增的服务器切换至线上提供服务。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　当存储空间不足时，可以动态添加组，只需要增加一台或多台服务器，并将它们配置为一个新的组，即可扩大存储系统的容量。当你的某个应用或者模块（对应的 group）的并发过高的时候，可以直接在 group 中增加若干个 Storage 来实现负载均衡。</span></p><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　为了避免单个目录下的文件数太多，当 Storage 第一次启动时，会在每个数据存储目录中创建 2 级子目录，每级 256 个，总共 65536 个目录，上传的文件会以 hash 的方式被路由到其中某个子目录下，然后将文件数据直接作为一个本地文件存储到该目录。</span></p><div class=pgc-img><img alt="FastDFS 分布式文件系统详解" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/13c0184adf13439ab98352e435d605f1><p class=pgc-img-caption></p></div><p style=text-align:start><span style="color:#34495e;--tt-darkmode-color: #809CB9">　　由于头条号篇幅限制的原因，至此 FastDFS 的核心概念，架构体系就到这里。下一篇我们带大家从零开始搭建 FastDFS 的环境，讲解 Client 操作 FastDFS 实现文件上传下载删除等操作。</span></p><div class=pgc-img><img alt="FastDFS 分布式文件系统详解" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/df3e1b8c22234943b845633fcb38e11d><p class=pgc-img-caption></p></div><p>您的 <strong><span style="color:#a82e2e;--tt-darkmode-color: #A92E2E">点赞</span></strong> 和 <strong><span style="color:#a82e2e;--tt-darkmode-color: #A92E2E">转发</span></strong> 是对我最大的支持。</p><p style=text-align:start>关注 <strong><span style="color:#a82e2e;--tt-darkmode-color: #A92E2E">哈喽沃德先生</span></strong>「文档 + 视频」每篇文章都配有专门视频讲解，学习更轻松噢 ~</p><div class=pgc-img><img alt="FastDFS 分布式文件系统详解" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ec94d573f8c84c89afb33906240c5aab><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'FastDFS','系统','详解'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>