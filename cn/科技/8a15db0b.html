<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ç½‘ç»œä¸Šå…±äº«è·¨å¹³å°çš„ç‚¹å¯¹ç‚¹æ–‡ä»¶ | æå®¢å¿«è¨Š</title><meta property="og:title" content="ç½‘ç»œä¸Šå…±äº«è·¨å¹³å°çš„ç‚¹å¯¹ç‚¹æ–‡ä»¶ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/666bf87a9e16425ea1c9adc4f2c10acd"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8a15db0b.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8a15db0b.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8a15db0b.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8a15db0b.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8a15db0b.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8a15db0b.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8a15db0b.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8a15db0b.html><meta property="article:published_time" content="2020-11-14T21:08:02+08:00"><meta property="article:modified_time" content="2020-11-14T21:08:02+08:00"><meta name=Keywords content><meta name=description content="ç½‘ç»œä¸Šå…±äº«è·¨å¹³å°çš„ç‚¹å¯¹ç‚¹æ–‡ä»¶"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/8a15db0b.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ç½‘ç»œä¸Šå…±äº«è·¨å¹³å°çš„ç‚¹å¯¹ç‚¹æ–‡ä»¶</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>åŸæ–‡é“¾æ¥ï¼šhttps://medium.com/@dev2919/cross-platform-peer-to-peer-file-sharing-over-the-web-using-webrtc-and-react-js-525aa7cc342c</p><p><br></p><p><strong>æˆ‘çš„åŠ¨æœº</strong></p><p><br></p><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ¶ä½œä¸€ä¸ªç²¾ç®€æ˜“ç”¨çš„ç‚¹å¯¹ç‚¹æ–‡ä»¶å…±äº«ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œå°†æ›´å¤šçš„ç²¾åŠ›æŠ•å…¥åˆ°ç”¨æˆ·ä½“éªŒä¸ç®€å•åœ°åŠäº‹ä¸Šã€‚è¿™ä¸ªç½‘ç»œåº”ç”¨ç¨‹åºä¸åªæ˜¯é’ˆå¯¹ç‰¹å®šçš„ä¸ªäººç¾¤ä½“æœåŠ¡çš„ï¼Œè€Œæ˜¯é’ˆå¯¹æ•´ä¸ªç¤¾åŒºæœåŠ¡ã€‚</p><p><br></p><p>æ—¢ç„¶æœ‰è¿™ä¹ˆå¤šæ–‡ä»¶å…±äº«ç½‘ç«™ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜è¦åšè¿™äº›å‘¢ï¼Ÿ</p><p><br></p><p>å½“ç„¶ï¼Œæˆ‘ä¹Ÿæ€è€ƒè¿‡è¿™ä¸ªé—®é¢˜ï¼Œä½†æ‰€æœ‰çš„è¿™äº›ç½‘ç«™éƒ½æ²¡æœ‰çœŸæ­£åœ°è¯´æ˜è¿‡è¿™äº›æ–‡ä»¶åœ¨å“ªé‡Œå…±äº«æˆ–å­˜å‚¨ã€‚è¿™å¯èƒ½æ˜¯ä¸€ç§éšç§å¨èƒï¼Œå› ä¸ºåœ¨å½“å‰ç–«æƒ…çš„æƒ…å†µä¸‹ï¼Œè®¸å¤šäººæˆ–è®¸ç»å¸¸ä½¿ç”¨è¿™äº›æœåŠ¡æ¥å…±äº«æ–‡ä»¶ç”šè‡³æœºå¯†æ–‡ä»¶ã€‚ä½¿ç”¨å®‰å…¨çš„ç‚¹å¯¹ç‚¹è¿æ¥å’Œå®ƒçš„æ•°æ®é€šé“å¯ä»¥ä¼ è¾“å¤§é‡çš„æ–‡ä»¶ï¼Œå´ä¸éœ€è¦å­˜å‚¨åœ¨ä»»ä½•æœåŠ¡å™¨ä¸Šï¼Œè¿™ä½¿å¾—å®ƒçœŸæ­£åœ°ç»“å®ä¸ç§æœ‰ï¼Œå› ä¸ºåªæœ‰è¿æ¥çš„å®¢æˆ·ç«¯/å¯¹ç­‰ç«¯ç›´æ¥ä¸ä¸­é—´æœåŠ¡å™¨é€šä¿¡ï¼Œä¸éœ€è¦ä¸­é—´æœåŠ¡å™¨è¿›è¡Œä¼ è¾“ã€‚</p><p><br></p><p>WebRTCä½¿å¯¹ç­‰è¿æ¥å’Œæ•°æ®é€šé“æˆä¸ºå¯èƒ½ã€‚WebRTCåŸºæœ¬ä¸Šæ˜¯ä¸€ç§ç›¸äº’é€šä¿¡ä¸ä¼ é€æ•°æ®çš„å…¨çƒç½‘ç»œæ–¹å¼ï¼Œç±»ä¼¼äºè“ç‰™ã€NFCå’ŒWIFIæ•°æ®å…±äº«ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨WebRTCå®ç°è·¨å¹³å°æ”¯æŒï¼Œå› ä¸ºå®ƒæ˜¯åŸºäºç½‘ç»œçš„ã€‚</p><p><br></p><p>è®©æˆ‘ä»¬æ›´æ·±å…¥åœ°ç ”ç©¶WebRTCã€‚</p><p><br></p><p><strong>WebRTC</strong></p><p><br></p><blockquote><p>â€œWebRTCæ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æ”¾é¡¹ç›®ï¼Œé€šè¿‡ç®€å•çš„APIsä¸ºæµè§ˆå™¨ä¸ç§»åŠ¨åº”ç”¨ç¨‹åºæä¾›å®æ—¶é€šä¿¡ï¼ˆRTCï¼‰åŠŸèƒ½ã€‚WebRTCç»„ä»¶å·²ç»è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä»¥æ›´å¥½åœ°æ»¡è¶³è¿™ä¸€ç›®çš„ã€‚â€</p><p>webrtc.org</p></blockquote><p style=text-align:justify><br></p><p>å¥½å§ï¼Œå‡è®¾ï¼Œä¸€ä¸ªâ€œç‚¹å¯¹ç‚¹â€å…³è”è€ƒè™‘ä¸¤éƒ¨è®¾å¤‡ä¹‹é—´å‘é€çš„ç›´æ¥ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦æœåŠ¡å™¨ä¿å­˜è¿™äº›ä¿¡æ¯ã€‚å¬èµ·æ¥è¿™å¯¹æˆ‘ä»¬çš„æƒ…å†µå¾ˆç†æƒ³å¯¹å§ï¼Ÿä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸æ˜¯WebRTCå·¥ä½œçš„æ–¹å¼ï¼</p><p><br></p><div class=pgc-img><img alt=ç½‘ç»œä¸Šå…±äº«è·¨å¹³å°çš„ç‚¹å¯¹ç‚¹æ–‡ä»¶ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/666bf87a9e16425ea1c9adc4f2c10acd><p class=pgc-img-caption></p></div><p>å›¾ä¸ºä½¿ç”¨WebRTCè¿›è¡Œæ•°æ®ä¼ è¾“</p><p><br></p><p>å°½ç®¡WebRTCå®ç°äº†ç‚¹å¯¹ç‚¹è¿æ¥ï¼Œä½†å®ƒç¡®å®éœ€è¦ä¸€ä¸ªç§°ä¸ºä¿¡ä»¤æœåŠ¡å™¨çš„æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ç”¨äºå…±äº«æœ‰å…³é¢„æœŸå°†å…¶ç›¸äº’è¿æ¥çš„è®¾å¤‡çš„æ•°æ®ã€‚è¿™äº›å¾®å¦™ä¹‹å¤„å¯ä»¥é€šè¿‡ä»»ä½•ä¼ ç»Ÿçš„ä¿¡æ¯å…±äº«æŠ€æœ¯æ¥å…±äº«ã€‚WebSocketsåœ¨è¿™é‡Œå—åˆ°é’çï¼Œå› ä¸ºå®ƒå‡å°‘äº†åœ¨ä¸€ä¸ªåºå¤§çš„å»ºç«‹å…³è”çš„ç³»ç»Ÿä¸­å…±äº«è¿™äº›é¢å¤–æ•°æ®çš„æƒ°æ€§ã€‚</p><p><br></p><p>ç®€è€Œè¨€ä¹‹ï¼Œä¿¡ä»¤æœåŠ¡å™¨å¸®åŠ©å»ºç«‹è¿æ¥ï¼Œç„¶è€Œï¼Œå½“è¿æ¥å»ºç«‹åï¼ŒæœåŠ¡å™¨å°†ä¸å†æ¶‰åŠç›¸å…³è®¾å¤‡ä¹‹é—´å…±äº«çš„ä¿¡æ¯ã€‚</p><p></p><p>ä¸€å¹´å‰ï¼Œå½“æˆ‘å¼€å§‹æˆ‘çš„ç¬¬ä¸€ä¸ªWebRTCé¡¹ç›®æ—¶ï¼Œå¾ˆéš¾æ‰¾åˆ°ä¸€ä¸ªåœ¨â€œproductionâ€çº§åˆ«ä¸‹å·¥ä½œå¾—åƒæ ·çš„æ¨¡å‹ã€‚åæ¥æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†è¿™ä¸ªYoutubeé¢‘é“ç¼–ç ã€‚å¼€å‘äººå‘˜ç»™å‡ºäº†å…³äºå¯ç”¨äºç”Ÿäº§çš„WebRTCåº”ç”¨ç¨‹åºçš„ä¸€äº›å¾ˆå¥½çš„ä¾‹å­ã€‚</p><p><br></p><p><strong>WebRTCå¦‚ä½•åˆ›å»ºä¸€ä¸ªè¿æ¥ï¼ˆæŠ€æœ¯ï¼‰</strong></p><p><br></p><p>å¥½å§ï¼Œæ²¡æœ‰ç®€å•çš„æ–¹æ³•æ¥è§£é‡Šè¿™ä¸€ç‚¹ï¼Œä½†æˆ‘çš„çœ‹æ³•æ˜¯ï¼Œåœ¨ç½‘ç»œä¸Šæ‰€æœ‰æ•°é‡å¯è§‚çš„è®¾å¤‡ä¸­ï¼Œæ— è®ºå¦‚ä½•éƒ½å¿…é¡»æœ‰ä¸€ä¸ªè®¾å¤‡é€šè¿‡äº§ç”Ÿä¿¡å·æ¥å¯åŠ¨è¿æ¥ï¼Œå¹¶å°†å…¶å‘é€åˆ°ä¿¡ä»¤æœåŠ¡å™¨ä¸Šã€‚è¿™ä¸ªå¯¹ç­‰ç‚¹è¢«ç§°ä¸ºå¯åŠ¨å™¨ï¼Œåœ¨simple-peerï¼ˆæ­¤é¡¹ç›®ä¸­ä½¿ç”¨çš„æ¨¡å—ï¼‰ä¸­ï¼Œå½“åˆ›å»ºä¸€ä¸ªå¯åŠ¨å™¨å¯¹ç­‰ç‚¹æ—¶ï¼Œ{initiatorï¼štrue}ä¼šè¢«ä¼ é€’ç»™åˆ¶ä½œè€…/æ„é€ å‡½æ•°ã€‚</p><p><br></p><div class=pgc-img><img alt=ç½‘ç»œä¸Šå…±äº«è·¨å¹³å°çš„ç‚¹å¯¹ç‚¹æ–‡ä»¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/97f4b238a561451cb20db8e3450b60a3><p class=pgc-img-caption></p></div><p>å¦‚å›¾ï¼šä¿¡å·æœåŠ¡å™¨åœ¨è¿è¡Œ</p><p><br></p><p>å½“æˆ‘ä»¬å¾—åˆ°å¯¹ç­‰ç‚¹çš„ä¿¡å·ä¿¡æ¯æ—¶ï¼Œè¿™äº›ä¿¡æ¯åº”è¯¥é€šè¿‡æŸç§æ–¹å¼é€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨å‘é€åˆ°ä¸åŒçš„é›†çº¿å™¨ã€‚ä¸åŒçš„é›†çº¿å™¨è·å–æ­¤ä¿¡æ¯å¹¶å°è¯•ä¸å‘èµ·ç¨‹åºå»ºç«‹å…³è”ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿™äº›å¯¹ç­‰ä½“åŒæ ·äº§ç”Ÿå®ƒä»¬çš„ä¿¡å·ä¿¡æ¯å¹¶è¢«å‘é€ç»™å‘èµ·æ–¹ã€‚å‘èµ·æ–¹è·å–æ­¤ä¿¡æ¯å¹¶å°è¯•ä¸å…¶ä½™å¯¹ç­‰æ–¹å»ºç«‹è¿æ¥ã€‚</p><p><br></p><p>ç§ï¼è¿™äº›è®¾å¤‡ç°åœ¨å·²ç»è¿æ¥èµ·æ¥ï¼Œç°åœ¨æœ‰ä¸€ä¸ªæ•°æ®é€šé“ï¼Œå¯ä»¥åœ¨æ²¡æœ‰ä¸­é—´æœåŠ¡å™¨çš„æƒ…å†µä¸‹å…±äº«ä¿¡æ¯ã€‚</p><p><br></p><p>å°½é‡ä¸è¦è¿‡åˆ†å¼ºè°ƒä½ æ— æ³•ç†è§£WebRTCçš„ä¸Šè¿°å·¥ä½œæ–¹å¼ä»¥åŠç®€å•å¯¹ç­‰ç‚¹å¦‚ä½•æŠŠå®ƒæŠ½è±¡åŒ–ã€‚å½“æˆ‘ä¸€å¼€å§‹æ‘†å¼„WebRTCæ—¶ï¼Œå®ƒå“äº†æˆ‘ä¸€å¤§è·³ã€‚æ¥ä¸‹æ¥çš„éƒ¨åˆ†å°†å¯¹è¿™ä¸€ç‚¹è¿›è¡Œæ›´ç®€å•å’Œç»†è‡´çš„è§£é‡Šã€‚</p><p><br></p><p><strong>ä¸WebRTCå…±äº«æ–‡ä»¶(ä½¿ç”¨simple-peer)</strong></p><pre><code>const express = require("express");  const http = require("http");  const app = express();  const server = http.createServer(app);  const socket = require("socket.io");  const io = socket(server);  const users = {};  const socketToRoom = {};    io.on('connection', socket =&gt; {      socket.on("join room", roomID =&gt; {          if (users[roomID]) {              const length = users[roomID].length;              if (length === 2) {                  socket.emit("room full");                  return;              }              users[roomID].push(socket.id);          } else {              users[roomID] = [socket.id];          }          socketToRoom[socket.id] = roomID;          const usersInThisRoom = users[roomID].filter(id =&gt; id !== socket.id);            socket.emit("all users", usersInThisRoom);      });        socket.on("sending signal", payload =&gt; {          io.to(payload.userToSignal).emit('user joined', { signal: payload.signal, callerID: payload.callerID });      });        socket.on("returning signal", payload =&gt; {          io.to(payload.callerID).emit('receiving returned signal', { signal: payload.signal, id: socket.id });      });        socket.on('disconnect', () =&gt; {          const roomID = socketToRoom[socket.id];          let room = users[roomID];          if (room) {              room = room.filter(id =&gt; id !== socket.id);              users[roomID] = room;              socket.broadcast.emit('user left', socket.id);          }      });  });    server.listen(process.env.PORT || 8000, () =&gt; console.log('server is running on port 8000'));</code></pre><p><strong>WebsocketæœåŠ¡å™¨JscodeReactå‰ç«¯ç¼–ç å™¨</strong></p><pre><code>import React, { useEffect, useRef, useState } from "react";import io from "socket.io-client";import Peer from "simple-peer";import styled from "styled-components";import streamSaver from "streamsaver";const Container = styled.div`    padding: 20px;    display: flex;    height: 100vh;    width: 90%;    margin: auto;    flex-wrap: wrap;`;const worker = new Worker("../worker.js");const Room = (props) =&gt; {    const [connectionEstablished, setConnection] = useState(false);    const [file, setFile] = useState();    const [gotFile, setGotFile] = useState(false);    const chunksRef = useRef([]);    const socketRef = useRef();    const peersRef = useRef([]);    const peerRef = useRef();    const fileNameRef = useRef("");    const roomID = props.match.params.roomID;    useEffect(() =&gt; {        socketRef.current = io.connect("/");        socketRef.current.emit("join room", roomID);        socketRef.current.on("all users", users =&gt; {            peerRef.current = createPeer(users[0], socketRef.current.id);        });        socketRef.current.on("user joined", payload =&gt; {            peerRef.current = addPeer(payload.signal, payload.callerID);        });        socketRef.current.on("receiving returned signal", payload =&gt; {            peerRef.current.signal(payload.signal);            setConnection(true);        });        socketRef.current.on("room full", () =&gt; {            alert("room is full");        })    }, []);    function createPeer(userToSignal, callerID) {        const peer = new Peer({            initiator: true,            trickle: false,        });        peer.on("signal", signal =&gt; {            socketRef.current.emit("sending signal", { userToSignal, callerID, signal });        });        peer.on("data", handleReceivingData);        return peer;    }    function addPeer(incomingSignal, callerID) {        const peer = new Peer({            initiator: false,            trickle: false,        });        peer.on("signal", signal =&gt; {            socketRef.current.emit("returning signal", { signal, callerID });        });        peer.on("data", handleReceivingData);        peer.signal(incomingSignal);        setConnection(true);        return peer;    }    function handleReceivingData(data) {        if (data.toString().includes("done")) {            setGotFile(true);            const parsed = JSON.parse(data);            fileNameRef.current = parsed.fileName;        } else {            worker.postMessage(data);        }    }    function download() {        setGotFile(false);        worker.postMessage("download");        worker.addEventListener("message", event =&gt; {            const stream = event.data.stream();            const fileStream = streamSaver.createWriteStream(fileNameRef.current);            stream.pipeTo(fileStream);        })    }    function selectFile(e) {        setFile(e.target.files[0]);    }    function sendFile() {        const peer = peerRef.current;        const stream = file.stream();        const reader = stream.getReader();        reader.read().then(obj =&gt; {            handlereading(obj.done, obj.value);        });        function handlereading(done, value) {            if (done) {                peer.write(JSON.stringify({ done: true, fileName: file.name }));                return;            }            peer.write(value);            reader.read().then(obj =&gt; {                handlereading(obj.done, obj.value);            })        }    }    let body;    if (connectionEstablished) {        body = (            &lt;div&gt;                &lt;input onChange={selectFile} type="file" /&gt;                &lt;button onClick={sendFile}&gt;Send file&lt;/button&gt;            &lt;/div&gt;        );    } else {        body = (            &lt;h1&gt;Once you have a peer connection, you will be able to share files&lt;/h1&gt;        );    }    let downloadPrompt;    if (gotFile) {        downloadPrompt = (            &lt;div&gt;                &lt;span&gt;You have received a file. Would you like to download the file?&lt;/span&gt;                &lt;button onClick={download}&gt;Yes&lt;/button&gt;            &lt;/div&gt;        );    }    return (        &lt;Container&gt;            {body}            {downloadPrompt}        &lt;/Container&gt;    );};export default Room;</code></pre><p>åœ¨æ­¤Repoä¸Šæ‰¾åˆ°æ•´ä¸ªä»£ç ã€‚å¦‚æœä½ åœ¨æµè§ˆå™¨ä¸­å°è¯•åº”ç”¨ä¸Šè¿°ä»£ç å¹¶é€‰æ‹©ä¸€äº›å›¾ç‰‡æ–‡ä»¶ï¼ˆæœ€å¥½å°äº100KBï¼‰ï¼Œå®ƒä¼šç«‹å³ä¸‹è½½è¿™äº›å›¾ç‰‡æ–‡ä»¶ã€‚è¿™æ˜¯å› ä¸ºè¿™ä¸ªå¯¹ç­‰ç‚¹ä½äºä¸€ä¸ªç±»ä¼¼çš„æµè§ˆå™¨ä¸­ï¼Œè€Œå‘é€æ–¹å¤„äºæç¤ºçŠ¶æ€ã€‚</p><p><br></p><p>ä¼ é€å’Œè·å–çš„ä¿¡æ¯çš„å¤§å°æ˜¯ç›¸ç­‰çš„ã€‚è¿™è¡¨æ˜æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€æ¬¡æ€§ç§»åŠ¨æ•´ä¸ªè®°å½•ï¼</p><p><br></p><p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨æ•°æ®ç¼“å†²åŒºè€Œä¸æ˜¯blobï¼Ÿ</strong></p><p></p><p>åœ¨æˆ‘ä»¬è¿‡å»çš„ä»£ç ä¸­ï¼Œå¦‚æœæˆ‘ä»¬é€‰æ‹©äº†ä¸€ä¸ªå·¨å¤§çš„æ–‡ä»¶ï¼ˆå¤§äº100KBï¼‰ï¼Œé‚£ä¹ˆæ–‡æ¡£å¾ˆå¯èƒ½ä¸ä¼šè¢«å‘é€ï¼Œè¿™æ˜¯WebRTCé€šé“çš„æŸäº›çº¦æŸçš„ç›´æ¥ç»“æœã€‚</p><p><br></p><div class=pgc-img><img alt=ç½‘ç»œä¸Šå…±äº«è·¨å¹³å°çš„ç‚¹å¯¹ç‚¹æ–‡ä»¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8a952251cab24b48b033ee3239cbfdf5><p class=pgc-img-caption></p></div><p>å¦‚å›¾ï¼šæ•°ç»„ç¼“å†²åŒºæ¼«ç”»æ’å›¾(mozilla.org)</p><p><br></p><p>æ¯ä¸ªæ•°ç»„ç¼“å†²åŒºä¸€æ¬¡åªèƒ½æœ‰16KBçš„é™åˆ¶ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»å°†æ–‡æ¡£åˆ’åˆ†æˆå°æ•°ç»„ç¼“å†²åŒºã€‚</p><p><br></p><p>å°æ–‡ä»¶å¯ä»¥é€šè¿‡WebRTCä¸€æ¬¡æ€§å‘å¤„ï¼Œç„¶è€Œï¼Œå¯¹äºå¤§æ–‡æ¡£ï¼Œæ˜æ™ºçš„åšæ³•æ˜¯å°†æ–‡ä»¶éš”ç¦»åˆ°è¾ƒå°çš„æ•°ç»„ç¼“å†²åŒºä¸­ï¼Œå¹¶åŒæ ·å‘é€æ¯ä¸ªéƒ¨åˆ†ã€‚ArrayBufferå’ŒBlobå¯¹è±¡éƒ½æœ‰å‰Šå‡å®¹é‡ï¼Œè¿™ä½¿å¾—æ­¤è¿‡ç¨‹æ›´åŠ ç®€å•ã€‚ä¸ºæ­¤ï¼Œå¦‚æœä½ ä»”ç»†æŸ¥çœ‹ä»£ç ï¼Œä½ ä¼šå‘ç°æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªåä¸ºstream saverçš„æ¨¡å—ï¼Œå®ƒå¯ä»¥å°†æ•°ç»„ç¼“å†²åŒºè½¬æ¢å›blobã€‚</p><p><br></p><p><strong>ç¬”è®°</strong></p><pre><code>let array = [];self.addEventListener("message", event =&gt; {    if (event.data === "download") {        const blob = new Blob(array);        self.postMessage(blob);        array = [];    } else if (event.data === "abort") {        array = [];    } else {        array.push(event.data);    }})</code></pre><p>å› ä¸ºjavascriptæ˜¯å•çº¿ç¨‹çš„ã€‚å¤„ç†å¤§é‡æ•°ç»„ç¼“å†²åŒºå¯èƒ½å¯¼è‡´æ¼‚äº®çš„UIæ— æ³•å“åº”ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æœåŠ¡å·¥ä½œäººå‘˜ã€‚ä¸€ä¸ªæœåŠ¡å·¥ä½œäººå‘˜æ˜¯æµè§ˆå™¨åœ¨åå°è¿è¡Œçš„è„šæœ¬ï¼Œæ˜¯ä¸Webé¡µé¢åˆ†ç¦»çš„ï¼Œè¿™ä¸ºä¸éœ€è¦Webé¡µé¢æˆ–ç”¨æˆ·äº¤äº’çš„ç‰¹æ€§æ‰“å¼€å¤§é—¨ã€‚</p><p><br></p><p>åœ¨æœåŠ¡å·¥ä½œç¨‹åºä¸­å¤„ç†æ•°ç»„ç¼“å†²åŒº</p><p><br></p><p><strong>å°†æ–‡ä»¶åˆ’åˆ†ä¸ºæ•°ç»„ç¼“å†²åŒºçš„ä¼˜ç‚¹</strong></p><p><br></p><p>è™½ç„¶å®ƒå¯èƒ½ä¼šæ„Ÿè§‰åˆ†éš”æ–‡ä»¶åªæ˜¯ä¸€äº›é¢å¤–çš„ä»£ç ï¼Œå¹¶ä¸”ä¼šè®©ä¸œè¥¿ç›¸äº’çº ç¼ ï¼Œä½†æˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹å¥½å¤„ï¼Œå¹¶ä¸”å¯ä»¥å¸®åŠ©æ”¹è¿›æˆ‘ä»¬çš„æ–‡æ¡£å…±äº«åº”ç”¨ç¨‹åºã€‚</p><p><br></p><div class=pgc-img><img alt=ç½‘ç»œä¸Šå…±äº«è·¨å¹³å°çš„ç‚¹å¯¹ç‚¹æ–‡ä»¶ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/084c2b8ba8644e6a80ae508cb69a0ca9><p class=pgc-img-caption></p></div><p>è·¨å¹³å°æ”¯æŒï¼ˆç”±mozilla.orgæä¾›è¯´æ˜ï¼‰</p><p><br></p><ul><li>æ”¯æŒå‡ ä¹æ‰€æœ‰çš„æµè§ˆå™¨</li><li>æ”¯æŒåºå¤§çš„æ–‡æ¡£å¤§å°â€”â€”æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å®ç°å®ƒçš„åŸºæœ¬è§£é‡Šã€‚</li><li>ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•æ¥ç ´è¯‘æ‰€å‘é€ä¿¡æ¯çš„åº¦é‡â€”â€”é€šè¿‡åœ¨ç¼“å†²åŒºä¸­å‘é€ä¸€ä¸ªè®°å½•ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ˜¾ç¤ºä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œå‘é€çš„æ–‡æ¡£çš„çº§åˆ«ï¼Œå‘é€è®°å½•çš„é€Ÿåº¦ç­‰ç­‰ã€‚</li><li>è¯†åˆ«æœªå®Œæˆå‘é€çš„æ–‡ä»¶â€”â€”åœ¨æ— æ³•å®Œå…¨å‘é€æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œç°åœ¨èƒ½å¤Ÿä»¥ä¸åŒçš„æ–¹å¼è·å–å’Œå¤„ç†æ–‡ä»¶ã€‚</li></ul><p><br></p><p><strong>ç»“è®º</strong></p><p><br></p><p>ç”±äºæˆ‘ä»¬æœ‰ä¸€ä¸ªä½¿ç”¨WebRTCçš„æ–‡æ¡£ç›´æ¥å…±äº«ç¨‹åºï¼Œè€Œä¸”å®ƒè¿˜åˆ©ç”¨äº†ArrayBufferï¼Œæˆ‘ä»¬ç°åœ¨åº”è¯¥å¼€å§‹è€ƒè™‘ä¸ºåº”ç”¨ç¨‹åºçš„ç”Ÿäº§åšå‡†å¤‡çš„ä¸œè¥¿äº†ã€‚è¿™äº›ç»†èŠ‚éœ€è¦æ›´å¤šçš„æ¢ç´¢ï¼Œè€Œä¸ä»…ä»…æ˜¯éµå¾ªä¸€ä¸ªç›´æ¥çš„æ•™ç¨‹ã€‚</p><p><br></p><p>å¯ä»¥è¡¥å……çš„æ›´å¤šå†…å®¹ï¼š</p><p><br></p><ul><li>ä¿¡ä»¤æœåŠ¡å™¨ï¼ˆSTUNå’ŒTURNæœåŠ¡å™¨ï¼‰ã€‚</li><li>ä½¿å¤šä¸ªå¯¹ç­‰è¿æ¥å¯æ‹“å±•ã€‚</li><li>å½“WebRTCä¸èƒ½å·¥ä½œæ—¶æ‰ç”¨çš„ä¸€ç§æ··åˆå…±äº«æ–¹å¼ã€‚</li><li>æé«˜ä¼ è¾“æ•ˆç‡å’Œé€Ÿåº¦ã€‚</li></ul><p><br></p><p>æˆ‘å¸Œæœ›æˆ‘å·²ç»æä¾›äº†è¶³å¤Ÿçš„ä¿¡æ¯è®©ä½ ä»¬å¼€å§‹ä½¿ç”¨WebRTCåº”ç”¨ç¨‹åºã€‚</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'ç½‘ç»œ','è·¨å¹³','ç‚¹å¯¹ç‚¹'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>