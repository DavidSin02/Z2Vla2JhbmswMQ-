<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>MySQL——事务(Transaction)详解 | 极客快訊</title><meta property="og:title" content="MySQL——事务(Transaction)详解 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/29d4c92c9c2344838eb72ef948cf08fa"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8a538d3c.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8a538d3c.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8a538d3c.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8a538d3c.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8a538d3c.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8a538d3c.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8a538d3c.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8a538d3c.html><meta property="article:published_time" content="2020-11-14T21:08:12+08:00"><meta property="article:modified_time" content="2020-11-14T21:08:12+08:00"><meta name=Keywords content><meta name=description content="MySQL——事务(Transaction)详解"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/8a538d3c.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>MySQL——事务(Transaction)详解</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>一、事务定义</h1><ul><li><strong>Transaction</strong></li><li>事务：一个最小的不可再分的工作单元；通常一个事务对应一个完整的业务(例如银行账户转账业务，该业务就是一个最小的工作单元)</li><li>一个完整的业务需要批量的DML(insert、update、delete)语句共同联合完成</li><li>事务只和DML语句有关，或者说DML语句才有事务。这个和业务逻辑有关，业务逻辑不同，DML语句的个数不同</li></ul><p><strong>二、转账操作理解事务</strong></p><p>关于银行账户转账操作，账户转账是一个完整的业务，最小的单元，不可再分————————也就是说银行账户转账是一个事务</p><p>以下是银行账户表t_act(账号、余额)，进行转账操作</p><pre>actno balance1 5002 100</pre><p><strong>转账操作</strong></p><pre>update t_act set balance=400 where actno=1;update t_act set balance=200 where actno=2;</pre><h1>以上两台DML语句必须同时成功或者同时失败。最小单元不可再分，当第一条DML语句执行成功后，并不能将底层数据库中的第一个账户的数据修改，只是将操作记录了一下；这个记录是在内存中完成的；当第二条DML语句执行成功后，和底层数据库文件中的数据完成同步。若第二条DML语句执行失败，则清空所有的历史操作记录，要完成以上的功能必须借助事务</h1><h1>三、事务四大特征(ACID)</h1><ul><li>原子性(A)：事务是最小单位，不可再分</li><li>一致性(C)：事务要求所有的DML语句操作的时候，必须保证同时成功或者同时失败</li><li>隔离性(I)：事务A和事务B之间具有隔离性</li><li>持久性(D)：是事务的保证，事务终结的标志(内存的数据持久到硬盘文件中)</li></ul><h1>四、关于事务的一些术语</h1><ul><li>开启事务：Start Transaction</li><li>事务结束：End Transaction</li><li>提交事务：Commit Transaction</li><li>回滚事务：Rollback Transaction</li></ul><h1>五、和事务相关的两条重要的SQL语句(TCL)</h1><ul><li>commit:提交</li><li>rollback：回滚</li></ul><h1>六、事务开启的标志？事务结束的标志？</h1><p>开启标志：</p><ul><li>任何一条DML语句(insert、update、delete)执行，标志事务的开启</li></ul><p>结束标志(提交或者回滚)：</p><ul><li>提交：成功的结束，将所有的DML语句操作历史记录和底层硬盘数据来一次同步</li><li>回滚：失败的结束，将所有的DML语句操作历史记录全部清空</li></ul><h1><strong>七、事物与数据库底层数据</strong></h1><h1>在事物进行过程中，未结束之前，DML语句是不会更改底层数据，只是将历史操作记录一下，在内存中完成记录。只有在事物结束的时候，而且是成功的结束的时候，才会修改底层硬盘文件中的数据</h1><h1><strong>八、在MySQL中，事务提交与回滚</strong></h1><h1>在MySQL中，默认情况下，事务是自动提交的，也就是说，只要执行一条DML语句就开启了事物，并且提交了事务</h1><p><strong>以上的自动提交机制是可以关闭的</strong></p><p><strong>对t_user进行提交和回滚操作</strong></p><p><strong>提交操作(事务成功)</strong></p><ul><li>start transaction</li><li>DML语句</li><li>commit</li></ul><pre>mysql&gt; start transaction;#手动开启事务mysql&gt; insert into t_user(name) values('pp');mysql&gt; commit;#commit之后即可改变底层数据库数据mysql&gt; select * from t_user;+----+------+| id | name |+----+------+| 1 | jay || 2 | man || 3 | pp |+----+------+3 rows in set (0.00 sec)</pre><p><strong>回滚操作(事务失败)</strong></p><ul><li>start transaction</li><li>DML语句</li><li>rollback</li></ul><pre>mysql&gt; start transaction;mysql&gt; insert into t_user(name) values('yy');mysql&gt; rollback;mysql&gt; select * from t_user;+----+------+| id | name |+----+------+| 1 | jay || 2 | man || 3 | pp |+----+------+3 rows in set (0.00 sec)</pre><h1>九、事务四大特性之一————隔离性(isolation)</h1><p>1.事物A和事物B之间具有一定的隔离性</p><p>2.隔离性有隔离级别(4个)</p><ol><li>读未提交：read uncommitted</li><li>读已提交：read committed</li><li>可重复读：repeatable read</li><li>串行化：serializable</li></ol><p><strong>1、 read uncommitted</strong></p><h1>事物A和事物B，事物A未提交的数据，事物B可以读取到</h1><h1>这里读取到的数据叫做“脏数据”</h1><h1>这种隔离级别最低，这种级别一般是在理论上存在，数据库隔离级别一般都高于该级别</h1><p><strong>2、read committed</strong></p><h1>事物A和事物B，事物A提交的数据，事物B才能读取到</h1><h1>这种隔离级别高于读未提交</h1><h1>换句话说，对方事物提交之后的数据，我当前事物才能读取到</h1><h1>这种级别可以避免“脏数据”</h1><h1>这种隔离级别会导致“不可重复读取”</h1><h1>Oracle默认隔离级别</h1><p><strong>3、repeatable read</strong></p><h1>事务A和事务B，事务A提交之后的数据，事务B读取不到</h1><h1>事务B是可重复读取数据</h1><h1>这种隔离级别高于读已提交</h1><h1>换句话说，对方提交之后的数据，我还是读取不到</h1><h1>这种隔离级别可以避免“不可重复读取”，达到可重复读取</h1><h1>比如1点和2点读到数据是同一个</h1><h1>MySQL默认级别</h1><h1>虽然可以达到可重复读取，但是会导致“幻像读”</h1><p><strong>4、serializable</strong></p><h1>事务A和事务B，事务A在操作数据库时，事务B只能排队等待</h1><h1>这种隔离级别很少使用，吞吐量太低，用户体验差</h1><h1>这种级别可以避免“幻像读”，每一次读取的都是数据库中真实存在数据，事务A与事务B串行，而不并发</h1><h1><strong>十、隔离级别与一致性关系</strong></h1><div class=pgc-img><img alt=MySQL——事务(Transaction)详解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/29d4c92c9c2344838eb72ef948cf08fa><p class=pgc-img-caption></p></div><h1><strong>十一、设置事务隔离级别</strong></h1><p><strong>方式一</strong></p><ul><li>可以在my.ini文件中使用transaction-isolation选项来设置服务器的缺省事务隔离级别。</li><li class=ql-indent-1>该选项值可以是：</li></ul><pre>– READ-UNCOMMITTED– READ-COMMITTED– REPEATABLE-READ– SERIALIZABLE• 例如：[mysqld]transaction-isolation = READ-COMMITTED</pre><p><strong>方式二</strong></p><ul><li>通过命令动态设置隔离级别</li><li>• 隔离级别也可以在运行的服务器中动态设置，应使用SET TRANSACTION ISOLATION LEVEL语句。</li><li>• 其语法模式为：</li></ul><pre> SET [GLOBAL | SESSION] TRANSACTION ISOLATION LEVEL &lt;isolation-level&gt; 其中的&lt;isolation-level&gt;可以是： – READ UNCOMMITTED – READ COMMITTED – REPEATABLE READ – SERIALIZABLE • 例如： SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;</pre><h1><strong>十二、隔离级别的作用范围</strong></h1><pre>• 事务隔离级别的作用范围分为两种： – 全局级：对所有的会话有效 – 会话级：只对当前的会话有效 • 例如，设置会话级隔离级别为READ COMMITTED ：mysql&gt; SET TRANSACTION ISOLATION LEVEL READ COMMITTED；或：mysql&gt; SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED；• 设置全局级隔离级别为READ COMMITTED ： mysql&gt; SET GLOBAL TRANSACTION ISOLATION LEVEL READ COMMITTED；</pre><h1><strong>十三、查看隔离级别</strong></h1><pre>• 事务隔离级别的作用范围分为两种： – 全局级：对所有的会话有效 – 会话级：只对当前的会话有效 • 例如，设置会话级隔离级别为READ COMMITTED ：mysql&gt; SET TRANSACTION ISOLATION LEVEL READ COMMITTED；或：mysql&gt; SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED；• 设置全局级隔离级别为READ COMMITTED ： mysql&gt; SET GLOBAL TRANSACTION ISOLATION LEVEL READ COMMITTED；</pre></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'MySQL','事务','Transaction'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>