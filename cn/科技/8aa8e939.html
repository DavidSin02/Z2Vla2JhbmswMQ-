<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>MySQL ä¼ ç»Ÿå¤åˆ¶ä¸­å¸¸è§æ•…éšœå¤„ç†å’Œç»“æ„ä¼˜åŒ–æ¡ˆä¾‹åˆ†æ | æå®¢å¿«è¨Š</title><meta property="og:title" content="MySQL ä¼ ç»Ÿå¤åˆ¶ä¸­å¸¸è§æ•…éšœå¤„ç†å’Œç»“æ„ä¼˜åŒ–æ¡ˆä¾‹åˆ†æ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/c993e94407a64d11a011fbe9f2793025"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8aa8e939.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8aa8e939.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8aa8e939.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8aa8e939.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8aa8e939.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8aa8e939.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8aa8e939.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8aa8e939.html><meta property="article:published_time" content="2020-11-14T21:04:04+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:04+08:00"><meta name=Keywords content><meta name=description content="MySQL ä¼ ç»Ÿå¤åˆ¶ä¸­å¸¸è§æ•…éšœå¤„ç†å’Œç»“æ„ä¼˜åŒ–æ¡ˆä¾‹åˆ†æ"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/8aa8e939.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>MySQL ä¼ ç»Ÿå¤åˆ¶ä¸­å¸¸è§æ•…éšœå¤„ç†å’Œç»“æ„ä¼˜åŒ–æ¡ˆä¾‹åˆ†æ</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>è™½ç„¶MySQL5.7 çš„ä¸»ä»å¤åˆ¶å·²ç»å¾ˆç¨³å®šäº†ï¼Œä½†åœ¨å¤‡åº“å¯è¯»å†™çš„æƒ…å†µä¸‹ï¼Œæ€»æ˜¯ä¼šå‡ºç°éƒ¨åˆ†æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä¾‹å¦‚å¸¸è§çš„1062ã€1032å’Œ1050é”™è¯¯ã€‚ä¸‹é¢å°±ä»‹ç»ä¸‹è¿™ç±»æŠ¥é”™çš„å¸¸è§å¤„ç†æ–¹æ³•å’Œå¸¸è§ä¸»ä»å¤åˆ¶ç»“æ„çš„è°ƒæ•´ã€‚</p><p>ç¯å¢ƒæè¿°</p><p>ä¸€</p><ul class=ul-level-0><li>1ã€mysql 5.7 ä»¥ä¸Šï¼Œ</li><li>2ã€binlog format æ˜¯rowæ ¼å¼ï¼ˆ5.7é»˜è®¤ï¼‰</li><li>3ã€ä¼ ç»Ÿå¤åˆ¶ï¼ˆç”Ÿäº§å¼ºçƒˆæ¨èä½¿ç”¨gtidï¼‰</li><li>4ã€log-bin , log_slave_updates å¼€å¯</li><li>5ã€å¤åˆ¶ç»“æ„ï¼š101ï¼š3306> 103:3306 > 104:3306</li></ul><p>å¸¸è§ä¸»ä»å¤åˆ¶æŠ¥é”™</p><p>äºŒ</p><p>1ã€è¡¨é‡å¤é”™è¯¯ï¼š 1050</p><p>ä»åº“å·²ç»æœ‰T2è¡¨ï¼Œå†åœ¨ä¸»åº“ä¸Šåˆ›å»ºT2. å¤„ç†åŸåˆ™ï¼šä»¥ä¸»åº“ä¸ºå‡†ï¼Œåœ¨ä»åº“ä¸Šdrop t2ã€‚ ç„¶åé‡å¯slaveã€‚</p><p>æ³¨æ„ï¼š åœ¨dbé‡Œçš„æ“ä½œéƒ½ä¼šè®°å½•åˆ°binlogä¸­ï¼Œå¦‚æœä¸æƒ³è¢«è®°å½•åˆ°binlogä¸­ï¼Œå¯ä»¥å…ˆset sql_log_bin=0.dropå®Œæˆåï¼Œå† set sql_log_bin=1å³å¯ã€‚</p><p>ä»5.7 å¼€å§‹ï¼Œæœ‰super read onlyã€‚</p><div class=pgc-img><img alt="MySQL ä¼ ç»Ÿå¤åˆ¶ä¸­å¸¸è§æ•…éšœå¤„ç†å’Œç»“æ„ä¼˜åŒ–æ¡ˆä¾‹åˆ†æ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c993e94407a64d11a011fbe9f2793025><p class=pgc-img-caption></p></div><p>å¤„ç†æ–¹æ³•ï¼š</p><p>ä»åº“æ“ä½œï¼š</p><p>set sql_log_bin=0ï¼›</p><p>drop table t2;</p><p>set sql_log_bin=1;</p><p>start slave;</p><p>show slave status;</p><p>2ã€ä¸»é”®å†²çªï¼š 1062</p><div class=pgc-img><img alt="MySQL ä¼ ç»Ÿå¤åˆ¶ä¸­å¸¸è§æ•…éšœå¤„ç†å’Œç»“æ„ä¼˜åŒ–æ¡ˆä¾‹åˆ†æ" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/513e7061090a46a98a515bdf74b0e0ff><p class=pgc-img-caption></p></div><p>å¤„ç†æ–¹æ³•ï¼š</p><p>ä»åº“æ“ä½œï¼š</p><blockquote><p>set sql_log_bin=0ï¼›</p><p>delete from t2 where id =2;</p><p>set sql_log_bin=1;</p><p>start slave;</p><p>show slave status;</p></blockquote><p>3ã€ä¸»åº“ä¸Šæ›´æ–°åï¼Œä»åº“æ‰¾ä¸åˆ°è®°å½• ï¼š1032</p><div class=pgc-img><img alt="MySQL ä¼ ç»Ÿå¤åˆ¶ä¸­å¸¸è§æ•…éšœå¤„ç†å’Œç»“æ„ä¼˜åŒ–æ¡ˆä¾‹åˆ†æ" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/31b512eb8d1b4a3fb0097b4573a73b3c><p class=pgc-img-caption></p></div><p>è¿™æ—¶éœ€è¦è§£æä¸»åº“çš„binlogï¼ŒæŠŠä»åº“çš„æ•°æ®è¡¥å›æ¥ã€‚</p><div class=pgc-img><img alt="MySQL ä¼ ç»Ÿå¤åˆ¶ä¸­å¸¸è§æ•…éšœå¤„ç†å’Œç»“æ„ä¼˜åŒ–æ¡ˆä¾‹åˆ†æ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d7e27ff6c3fa401ea06357b007a17aa2><p class=pgc-img-caption></p></div><p>è¿™é‡Œå°±èƒ½çœ‹åˆ°ä»åº“ä¸¢å¤±çš„é‚£æ¡è®°å½•ã€‚ç„¶ååœ¨ä»åº“è¡¥å……è¿™æ¡è®°å½•å³å¯ã€‚</p><p>å¤„ç†æ–¹æ³•ï¼š</p><p>ä»åº“æ“ä½œï¼š</p><blockquote><p>set sql_log_bin=0ï¼›</p><p>insert into t2 (id) values (2);</p><p>set sql_log_bin=1;</p><p>start slave;</p><p>show slave status;</p></blockquote><p>4ã€ä¸»åº“ä¸Šdeleteåï¼Œä»åº“æ‰¾ä¸åˆ°è®°å½•ï¼š 1032</p><div class=pgc-img><img alt="MySQL ä¼ ç»Ÿå¤åˆ¶ä¸­å¸¸è§æ•…éšœå¤„ç†å’Œç»“æ„ä¼˜åŒ–æ¡ˆä¾‹åˆ†æ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6e28635e00ee49ba9586ad484d4f7abc><p class=pgc-img-caption></p></div><p>æƒ³çœ‹æŸæ®µposå†…æ‰§è¡Œè¿‡çš„sqlï¼š ä¸»åº“æ‰§è¡Œï¼š</p><blockquote><p><br></p></blockquote><pre><code>mysqlbinlog --base64-output=decode-rows -v --start-position=2465 --stop-position=2748 mysql-bin.000050 &gt; 50.sql</code></pre><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><blockquote><p><br></p></blockquote><pre><code>### DELETE FROM `wubx`.`wubx`### WHERE###   @1=2###   @2='wubx'ROLLBACK /* added by mysqlbinlog */ /*!*/; </code></pre><p>æ³¨æ„è¿™é‡Œçš„rollbackã€‚å¦‚æœä»¥ååŸºäºbinlogå’Œæ—¶é—´ç‚¹çš„æ¢å¤ã€‚è¿™æ¡æ•°æ®ä¼šè¢«rollbackæ‰ï¼Œé€ æˆä¸€æ¡æ•°æ®çš„ä¸¢å¤±ã€‚æ‰€ä»¥å¦‚æœæƒ³ä¿ç•™è¿™æ¡æ•°æ®ï¼Œéœ€è¦æ‰¾åˆ°commitçš„ä½ç½®ï¼Œæˆ–è€…ä¸‹ä¸ªposçš„ä½ç½®ã€‚</p><p>å¤„ç†æ–¹æ³•ï¼š</p><p>ä»åº“æ“ä½œï¼š</p><blockquote><p>slave stop;</p><p>SET GLOBAL SQL_SLAVE_SKIP_COUNTER = 1 #è·³è¿‡ä¸€ä¸ªäº‹åŠ¡</p><p>slave start</p></blockquote><p>å¸¸è§å¤åˆ¶ç»“æ„è°ƒæ•´</p><p>ä¸‰</p><p>1ã€ä¸€ä¸»ä¸€ä»ï¼Œæ·»åŠ ä»åº“</p><blockquote><p><br></p></blockquote><pre><code>st=&gt;operation: M 101:3306e=&gt;endop=&gt;operation: S1 103:3306 st-&gt;op-&gt;op1</code></pre><p>è°ƒæ•´ä¸ºï¼Œçº§è”æˆ–æ˜Ÿå‹ç»“æ„</p><blockquote><p><br></p></blockquote><pre><code>st=&gt;operation: M 101:3306e=&gt;endop=&gt;operation: S1 103:3306op1=&gt;operation: S11 104:3306 st-&gt;op-&gt;op1</code></pre><p>2ã€çº§è”å¤åˆ¶è°ƒæ•´</p><p><strong>ä»103.3306 dumpæ•°æ®</strong></p><blockquote><p><br></p></blockquote><pre><code>mysqldump --single-transaction --master-data=2 -uroot -p123456  -A -S /tmp/mysql3306.sock</code></pre><p><strong>104 å¯¼å…¥æ•°æ®</strong></p><blockquote><p><br></p></blockquote><pre><code>mysql -S /tmp/mysql3306.sock -uroot -p123456 &lt; /tmp/1203.sql</code></pre><p><strong>change 104 åˆ°103</strong></p><blockquote><p><br></p></blockquote><pre><code>change master to master_host='192.168.56.103', master_user='repl', master_password='repl4slave', master_port=3306, MASTER_LOG_FILE='mysql-bin.000001', MASTER_LOG_POS=4138, master_connect_retry=10;</code></pre><p><strong>101 æ’å…¥æµ‹è¯•æ•°æ®</strong></p><blockquote><p><br></p></blockquote><pre><code>insert into t2 values (200);</code></pre><p><strong>101 æŒç»­insert</strong></p><blockquote><p><br></p></blockquote><pre><code>for ((i=1;i&lt;=1000000;i++))domysql -S /tmp/mysql3306.sock -uroot -p123456 -e "insert into enmo.t2 values($i)"done</code></pre><p><strong>å…³é—­103 ä¸»æœºï¼Œå¹¶æ£€æŸ¥104 slave çŠ¶æ€</strong></p><div class=pgc-img><img alt="MySQL ä¼ ç»Ÿå¤åˆ¶ä¸­å¸¸è§æ•…éšœå¤„ç†å’Œç»“æ„ä¼˜åŒ–æ¡ˆä¾‹åˆ†æ" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3514db9272cd4991a8fa7ee8f8a8489e><p class=pgc-img-caption></p></div><p><strong>ä¸»ä»çš„binlog éƒ½ä¼šè®°å½•ä¸»åº“çš„server id å’Œtimestampä¿¡æ¯ã€‚å¯ä»¥æ ¹æ®è¿™2ä¸ªä¿¡æ¯å»å®šä½ç›¸åº”çš„posä¿¡æ¯ã€‚</strong></p><p>101:3306</p><div class=pgc-img><img alt="MySQL ä¼ ç»Ÿå¤åˆ¶ä¸­å¸¸è§æ•…éšœå¤„ç†å’Œç»“æ„ä¼˜åŒ–æ¡ˆä¾‹åˆ†æ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5f30419856304f4594264aea3afe40db><p class=pgc-img-caption></p></div><p>104:3306</p><div class=pgc-img><img alt="MySQL ä¼ ç»Ÿå¤åˆ¶ä¸­å¸¸è§æ•…éšœå¤„ç†å’Œç»“æ„ä¼˜åŒ–æ¡ˆä¾‹åˆ†æ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fba122e6b2644ababfa4b6b215145ded><p class=pgc-img-caption></p></div><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°101 ç»“æŸ insert 1419åï¼Œå¹¶commitçš„ pos æ˜¯387204ï¼Œæ‰€ä»¥104 change çš„pos å¯ä»¥é€‰æ‹©åˆ°387204è¿™é‡Œã€‚ä½†æ˜¯å¦‚æœ104æ²¡æœ‰æŠŠ1419 è¿™æ¡è®°å½•commitçš„è¯ï¼Œå°±è¦é€‰æ‹©101 å¼€å§‹ insert 1419 è¿™ä¸ªäº‹åŠ¡ä¹‹é—´çš„posï¼š387020.</p><p><strong>104 change åˆ°101</strong></p><blockquote><p><br></p></blockquote><pre><code>change master to master_host='192.168.56.103', master_user='repl', master_password='repl4slave', master_port=3306,  MASTER_LOG_FILE='mysql-bin.000093', MASTER_LOG_POS=387204, master_connect_retry=10;</code></pre><p>ä½œè€…ä»‹ç»</p><p>å¼ ç¿ äº‘å’Œæ©å¢¨æŠ€æœ¯é¡¾é—®</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'MySQL','ä¼ ç»Ÿ','å¤„ç†'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>