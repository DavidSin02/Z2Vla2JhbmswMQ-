<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ | æå®¢å¿«è¨Š</title><meta property="og:title" content="Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/c75cdad38aac4ed1b4e854b3ae6104ec"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8c48771.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8c48771.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8c48771.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8c48771.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8c48771.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8c48771.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8c48771.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8c48771.html><meta property="article:published_time" content="2020-10-29T20:59:31+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:31+08:00"><meta name=Keywords content><meta name=description content="Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/8c48771.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>â€‹Scrapyæ˜¯ä¸€ä¸ªä¸ºäº†çˆ¬å–ç½‘ç«™æ•°æ®ï¼Œæå–ç»“æ„æ€§æ•°æ®è€Œç¼–å†™çš„åº”ç”¨æ¡†æ¶ã€‚å¯ä»¥åº”ç”¨åœ¨åŒ…æ‹¬æ•°æ®æŒ–æ˜ï¼Œä¿¡æ¯å¤„ç†æˆ–å­˜å‚¨å†å²æ•°æ®ç­‰ä¸€ç³»åˆ—çš„ç¨‹åºä¸­ã€‚</p><hr><p><br></p><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c75cdad38aac4ed1b4e854b3ae6104ec><p class=pgc-img-caption></p></div><p><br></p><p><strong>ç›®å½•</strong></p><p>å®‰è£…</p><p>æµ‹è¯•</p><p>æ–°å»ºå·¥ç¨‹</p><p>åˆ›å»ºspideræ–‡ä»¶ï¼ˆä»¥è±†ç“£ç”µå½±ä¸ºä¾‹ï¼‰</p><p>æ¶æ„(ç»¿çº¿æ˜¯æ•°æ®æµå‘)</p><p>è¿ä½œæµç¨‹ï¼ˆä¸ªäººç†è§£ï¼‰</p><p>åˆ¶ä½œæ­¥éª¤</p><p>åœ¨itemä¸­æŒ‡æ˜çˆ¬å–å­—æ®µ</p><p>ç¼–å†™spider/movie.py</p><p>æ•°æ®å­˜è‡³æ•°æ®åº“</p><p>å…¶ä»–</p><p>æœ€å</p><hr><h1 class=pgc-h-arrow-right>å®‰è£…</h1><p>pipå®‰è£…ï¼Œå¯èƒ½ä¼šæŠ¥é”™ï¼š</p><pre><code>pip install Scrapy</code></pre><p>anacondaå®‰è£…ï¼Œæ¨èï¼š</p><pre><code>conda install -c conda-forge scrapy</code></pre><h1 class=pgc-h-arrow-right>æµ‹è¯•</h1><pre><code>scrapy</code></pre><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b5920e05b8574135b7044f4b5fbca52e><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>æ–°å»ºå·¥ç¨‹</h1><pre><code>scrapy startproject &lt;å·¥ç¨‹å&gt;</code></pre><p>å¦‚</p><pre><code>scrapy startproject douban</code></pre><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/b9071a00f59e45bf9c8d62169df9bd41><p class=pgc-img-caption></p></div><p>åˆ›å»ºçš„ç›®å½•ç»“æ„</p><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/efe20c6cc0514f958379e888daf0b107><p class=pgc-img-caption></p></div><ul><li><strong>scrapy.cfg: </strong>é¡¹ç›®é…ç½®æ–‡ä»¶</li><li><strong>douban/: </strong>é¡¹ç›®pythonæ¨¡å—, ä»£ç å°†ä»è¿™é‡Œå¯¼å…¥</li><li><strong>douban/items.py: </strong>é¡¹ç›®itemsæ–‡ä»¶ï¼Œå­˜è¦çˆ¬å–çš„å­—æ®µä¿¡æ¯ï¼Œå¯ä»¥æ’å…¥æ•°æ®åº“ã€å†™å…¥txtç­‰</li><li><strong>douban/pipelines.py: </strong>é¡¹ç›®ç®¡é“æ–‡ä»¶ï¼Œå°†çˆ¬å–çš„æ•°æ®è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨</li><li><strong>douban/settings.py: </strong>é¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é…ç½®æ•°æ®åº“ç­‰</li><li><strong>douban/spiders/: </strong>æ”¾ç½®spiderçš„ç›®å½•ï¼Œä¹Ÿå°±æ˜¯ä½ è¦å†™é€»è¾‘ä»£ç çš„åœ°æ–¹</li><li><strong>douban/middlewaresï¼š</strong>ä¸­é—´ä»¶ï¼Œè¯·æ±‚å’Œå“åº”éƒ½å°†ç»è¿‡ä»–ï¼Œå¯ä»¥é…ç½®è¯·æ±‚å¤´ã€ä»£ç†ã€cookieã€ä¼šè¯ç»´æŒç­‰</li></ul><p><br></p><h1 class=pgc-h-arrow-right>åˆ›å»ºspideræ–‡ä»¶ï¼ˆä»¥è±†ç“£ç”µå½±ä¸ºä¾‹ï¼‰</h1><pre><code>scrapy genspider &lt;é¡¹ç›®å&gt; &lt;çˆ¬å–åŸŸ&gt;</code></pre><p>å¦‚</p><pre><code>cd doubanscrapy genspider movie movie.douban.com</code></pre><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f35e37b30fd149218ab9fdebae5cfec4><p class=pgc-img-caption></p></div><p>å°†åœ¨spidersæ–‡ä»¶å¤¹ä¸‹è‡ªåŠ¨åˆ›å»ºmovie.pyï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆå†…å®¹ï¼š</p><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b469298e97654ab496a0b929bf8b023e><p class=pgc-img-caption></p></div><p>å¯ä»¥çœ‹å‡ºï¼Œè¦å»ºç«‹ä¸€ä¸ªSpiderï¼Œ ä½ å¿…é¡»ç”¨scrapy.Spiderç±»åˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œå¹¶ç¡®å®šäº†<strong>ä¸‰ä¸ªå¼ºåˆ¶çš„å±æ€§ å’Œ ä¸€ä¸ªæ–¹æ³•</strong>ã€‚</p><ul><li><strong>name = "" ï¼š</strong>çˆ¬è™«çš„è¯†åˆ«åç§°ï¼Œå¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œåœ¨ä¸åŒçš„çˆ¬è™«å¿…é¡»å®šä¹‰ä¸åŒçš„åå­—ã€‚</li><li><strong>allow_domains = [] ï¼š</strong>æ˜¯æœç´¢çš„åŸŸåèŒƒå›´ï¼Œä¹Ÿå°±æ˜¯çˆ¬è™«çš„çº¦æŸåŒºåŸŸï¼Œè§„å®šçˆ¬è™«åªçˆ¬å–è¿™ä¸ªåŸŸåä¸‹çš„ç½‘é¡µï¼Œä¸å­˜åœ¨çš„URLä¼šè¢«å¿½ç•¥ã€‚</li><li><strong>start_urls = () ï¼š</strong>çˆ¬å–çš„URLå…ƒç¥–/åˆ—è¡¨ã€‚çˆ¬è™«ä»è¿™é‡Œå¼€å§‹æŠ“å–æ•°æ®ï¼Œæ‰€ä»¥ï¼Œç¬¬ä¸€æ¬¡ä¸‹è½½çš„æ•°æ®å°†ä¼šä»è¿™äº›urlså¼€å§‹ã€‚å…¶ä»–å­URLå°†ä¼šä»è¿™äº›èµ·å§‹URLä¸­ç»§æ‰¿æ€§ç”Ÿæˆã€‚</li><li><strong>parse(self, response) ï¼š</strong>è§£æçš„æ–¹æ³•ï¼Œæ¯ä¸ªåˆå§‹URLå®Œæˆä¸‹è½½åå°†è¢«è°ƒç”¨ï¼Œè°ƒç”¨çš„æ—¶å€™ä¼ å…¥ä»æ¯ä¸€ä¸ªURLä¼ å›çš„Responseå¯¹è±¡æ¥ä½œä¸ºå”¯ä¸€å‚æ•°ï¼Œä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼šè´Ÿè´£è§£æè¿”å›çš„ç½‘é¡µæ•°æ®(response.body)ï¼Œæå–ç»“æ„åŒ–æ•°æ®(ç”Ÿæˆitem)ï¼›ç”Ÿæˆéœ€è¦ä¸‹ä¸€é¡µçš„URLè¯·æ±‚ã€‚</li></ul><h1 class=pgc-h-arrow-right>æ¶æ„(ç»¿çº¿æ˜¯æ•°æ®æµå‘)</h1><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f718301285ea49f092e274e89191abcc><p class=pgc-img-caption></p></div><p><br></p><ul><li><strong>Scrapy Engine(å¼•æ“)</strong>: è´Ÿè´£Spiderã€ItemPipelineã€Downloaderã€Schedulerä¸­é—´çš„é€šè®¯ï¼Œä¿¡å·ã€æ•°æ®ä¼ é€’ç­‰ã€‚</li><li><strong>Scheduler(è°ƒåº¦å™¨)</strong>: å®ƒè´Ÿè´£æ¥å—å¼•æ“å‘é€è¿‡æ¥çš„Requestè¯·æ±‚ï¼Œå¹¶æŒ‰ç…§ä¸€å®šçš„æ–¹å¼è¿›è¡Œæ•´ç†æ’åˆ—ï¼Œå…¥é˜Ÿï¼Œå½“å¼•æ“éœ€è¦æ—¶ï¼Œäº¤è¿˜ç»™å¼•æ“ã€‚</li><li><strong>Downloaderï¼ˆä¸‹è½½å™¨ï¼‰</strong>ï¼šè´Ÿè´£ä¸‹è½½Scrapy Engine(å¼•æ“)å‘é€çš„æ‰€æœ‰Requestsè¯·æ±‚ï¼Œå¹¶å°†å…¶è·å–åˆ°çš„Responsesäº¤è¿˜ç»™Scrapy Engine(å¼•æ“)ï¼Œç”±å¼•æ“äº¤ç»™Spideræ¥å¤„ç†ï¼Œ</li><li><strong>Spiderï¼ˆçˆ¬è™«ï¼‰</strong>ï¼šå®ƒè´Ÿè´£å¤„ç†æ‰€æœ‰Responses,ä»ä¸­åˆ†ææå–æ•°æ®ï¼Œè·å–Itemå­—æ®µéœ€è¦çš„æ•°æ®ï¼Œå¹¶å°†éœ€è¦è·Ÿè¿›çš„URLæäº¤ç»™å¼•æ“ï¼Œå†æ¬¡è¿›å…¥Scheduler(è°ƒåº¦å™¨).</li><li><strong>Item Pipeline(ç®¡é“)</strong>ï¼šå®ƒè´Ÿè´£å¤„ç†Spiderä¸­è·å–åˆ°çš„Itemï¼Œå¹¶è¿›è¡Œè¿›è¡ŒåæœŸå¤„ç†ï¼ˆè¯¦ç»†åˆ†æã€è¿‡æ»¤ã€å­˜å‚¨ç­‰ï¼‰çš„åœ°æ–¹ã€‚</li><li><strong>Downloader Middlewaresï¼ˆä¸‹è½½ä¸­é—´ä»¶ï¼‰</strong>ï¼šä½ å¯ä»¥å½“ä½œæ˜¯ä¸€ä¸ªå¯ä»¥è‡ªå®šä¹‰æ‰©å±•ä¸‹è½½åŠŸèƒ½çš„ç»„ä»¶ã€‚</li><li><strong>Spider Middlewaresï¼ˆSpiderä¸­é—´ä»¶ï¼‰</strong>ï¼šä½ å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå¯ä»¥è‡ªå®šæ‰©å±•å’Œæ“ä½œå¼•æ“å’ŒSpiderä¸­é—´é€šä¿¡çš„åŠŸèƒ½ç»„ä»¶ï¼ˆæ¯”å¦‚è¿›å…¥Spiderçš„Responses;å’Œä»Spiderå‡ºå»çš„Requestsï¼‰</li></ul><h1 class=pgc-h-arrow-right>è¿ä½œæµç¨‹ï¼ˆä¸ªäººç†è§£ï¼‰</h1><ul><li>ç”¨æˆ·ç¼–å†™spiderå¹¶è¿è¡Œ</li><li>å°†ç¬¬ä¸€ä¸ªURLä¼ ç»™å¼•æ“</li><li>å¼•æ“å°†URLå¯¹åº”çš„requestä¼ ç»™è°ƒåº¦å™¨</li><li>è°ƒåº¦å™¨å°†requestæ’åºå…¥é˜Ÿ</li><li>è°ƒåº¦å™¨å°†å¤„ç†å¥½çš„requestè¿”å›åˆ°å¼•æ“</li><li>å¼•æ“å°†requestæŒ‰ç…§ä¸‹è½½ä¸­é—´ä»¶çš„è®¾ç½®ä¼ ç»™ä¸‹è½½å™¨</li><li>ä¸‹è½½å™¨æ‰§è¡Œrequestå¹¶è·å¾—responseï¼ˆå¦‚æœä¸‹è½½å¤±è´¥ï¼Œç„¶åå¼•æ“å‘Šè¯‰è°ƒåº¦å™¨ï¼Œè¿™ä¸ªrequestä¸‹è½½å¤±è´¥äº†ï¼Œä½ è®°å½•ä¸€ä¸‹ï¼Œå¾…ä¼šå„¿å†ä¸‹è½½ï¼‰</li><li>ä¸‹è½½å™¨å°†responseè¿”å›åˆ°å¼•æ“</li><li>å¼•æ“å°†requestè¿”å›åˆ°spiderç”¨æˆ·è¿™ï¼ˆé»˜è®¤äº¤åˆ°def parse()è¿™ä¸ªå‡½æ•°å¤„ç†ï¼‰</li><li>spiderå¤„ç†å®Œæ•°æ®åï¼Œå°†éœ€è¦è·Ÿè¿›çš„URLå’Œè¦ä¿å­˜çš„itemä¼ ç»™å¼•æ“</li><li>å¼•æ“å°†itemä¼ ç»™ç®¡é“è¿›è¡Œå¤„ç†ä¿å­˜ï¼Œå¹¶å°†URLè¿›å…¥ä¸‹ä¸€è½®å¾ªç¯</li><li>åªæœ‰å½“è°ƒåº¦å™¨ä¸­ä¸å­˜åœ¨ä»»ä½•requestäº†ï¼Œæ•´ä¸ªç¨‹åºæ‰ä¼šåœæ­¢ï¼Œï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä¸‹è½½å¤±è´¥çš„URLï¼ŒScrapyä¹Ÿä¼šé‡æ–°ä¸‹è½½ã€‚ï¼‰</li></ul><h1 class=pgc-h-arrow-right>åˆ¶ä½œæ­¥éª¤</h1><ol start=1><li>æ–°å»ºé¡¹ç›® (scrapy startproject xxx)ï¼šæ–°å»ºä¸€ä¸ªæ–°çš„çˆ¬è™«é¡¹ç›®</li><li>æ˜ç¡®ç›®æ ‡ ï¼ˆç¼–å†™items.pyï¼‰ï¼šæ˜ç¡®ä½ æƒ³è¦æŠ“å–çš„ç›®æ ‡</li><li>åˆ¶ä½œçˆ¬è™« ï¼ˆspiders/xxspider.pyï¼‰ï¼šåˆ¶ä½œçˆ¬è™«å¼€å§‹çˆ¬å–ç½‘é¡µ</li><li>å­˜å‚¨å†…å®¹ ï¼ˆpipelines.pyï¼‰ï¼šè®¾è®¡ç®¡é“å­˜å‚¨çˆ¬å–å†…å®¹</li></ol><h1 class=pgc-h-arrow-right>åœ¨itemä¸­æŒ‡æ˜çˆ¬å–å­—æ®µ</h1><p>å¦‚â€œåç§°â€ã€â€œè¯„åˆ†â€ã€â€œç®€ä»‹â€</p><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/946bd1a27ff1403d8cf5d0ecd9db9925><p class=pgc-img-caption></p></div><ul><li>Item å®šä¹‰ç»“æ„åŒ–æ•°æ®å­—æ®µï¼Œç”¨æ¥ä¿å­˜çˆ¬å–åˆ°çš„æ•°æ®ï¼Œæœ‰ç‚¹åƒ Python ä¸­çš„ dictï¼Œä½†æ˜¯æä¾›äº†ä¸€äº›é¢å¤–çš„ä¿æŠ¤å‡å°‘é”™è¯¯ã€‚</li><li>å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ª scrapy.Item ç±»ï¼Œ å¹¶ä¸”å®šä¹‰ç±»å‹ä¸º scrapy.Field çš„ç±»å±æ€§æ¥å®šä¹‰ä¸€ä¸ª Itemï¼ˆå¯ä»¥ç†è§£æˆç±»ä¼¼äº ORM çš„æ˜ å°„å…³ç³»ï¼‰ã€‚</li></ul><p>åœ¨item.pyä¸­ä¿®æ”¹ä¸ºï¼š</p><pre><code>class DoubanItem(scrapy.Item):    name = scrapy.Field()    rating_num = scrapy.Field()    quote = scrapy.Field()</code></pre><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ba8952f814be45ec9ef85ef9ba7106d1><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>ç¼–å†™spider/movie.py</h1><p>1ã€é€‰æ‹©ç›®æ ‡çš„xpathï¼ˆä¹Ÿå¯ä»¥cssç­‰å…¶ä»–é€‰æ‹©å™¨ï¼‰</p><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/48bfd07533b34b5e8a41e60d6e4b9d86><p class=pgc-img-caption></p></div><p>2ã€æå–å‡ºå…¬å…±éƒ¨åˆ†</p><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/73c0f9f64e364d37a3da1210519ffbbf><p class=pgc-img-caption></p></div><p><br></p><p>3ã€ç”±äºè±†ç“£æœ‰åçˆ¬éªŒè¯ï¼Œå› æ­¤éœ€è¦åŠ ä¸Šheader</p><pre><code>def start_requests(self):    url = 'http://movie.douban.com/top250/'    yield scrapy.Request(url, headers=self.headers)</code></pre><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/08d08902857f47e3a95a59f7dc18af1c><p class=pgc-img-caption></p></div><p>é€šè¿‡start_requestså‡½æ•°ï¼Œå¯¹äºè¿è¡Œåç¬¬ä¸€æ¬¡è®¿é—®è¯·æ±‚ï¼Œå°±åŠ ä¸Šäº†è¯·æ±‚å¤´ã€‚å› æ­¤ï¼Œstart_urlså…¶å®ä¹Ÿå¯ä»¥ä¸åŠ ã€‚</p><p><br></p><p>4ã€ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œæ–°å»ºspider/main.pyï¼Œå¹¶å†™å…¥</p><pre><code>from scrapy.cmdline import executeexecute(["scrapy", "crawl", "movie", "-o", "item.json"])</code></pre><p><br></p><p>5ã€æµ‹è¯•ä¸€ä¸‹æ•ˆæœ</p><pre><code>class MovieSpider(scrapy.Spider):    name = 'movie'    allowed_domains = ['movie.douban.com/top250']    start_urls = ['http://movie.douban.com/top250/']    headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36'}    def start_requests(self):        url = 'http://movie.douban.com/top250/'        yield scrapy.Request(url, headers=self.headers)    def parse(self, response):        for each in response.xpath('//*[@id="content"]/div/div[1]/ol/li'):            print(each.xpath('./div/div[2]/div[1]/a/span[1]').extract())</code></pre><p>è¿è¡Œmain.py</p><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/abd8cb828e584c878d0147524d14c8c8><p class=pgc-img-caption></p></div><p>è¦æå–ä¸­é—´çš„æ–‡å­—ï¼Œåˆ™åœ¨xpathåé¢å†æ·»åŠ <strong>â€œ/text()â€</strong></p><p><br></p><p>6ã€ç±»ä¼¼åœ°ï¼Œå®Œå–„parse()å‡½æ•°</p><pre><code>from ..items import DoubanItem</code></pre><pre><code>def parse(self, response):    # å°†å¾—åˆ°çš„æ•°æ®å°è£…åˆ°ä¸€ä¸ªDoubanItemå¯¹è±¡ï¼Œå°±æ˜¯åœ¨items.pyé‡Œçš„    item = DoubanItem()    for each in response.xpath('//*[@id="content"]/div/div[1]/ol/li'):        name = each.xpath('./div/div[2]/div[1]/a/span[1]/text()').extract_first()        rating_num = each.xpath('./div/div[2]/div[2]/div/span[2]/text()').extract_first()        quote = each.xpath('./div/div[2]/div[2]/p[2]/span/text()').extract_first()        item['name'] = name        item['rating_num'] = rating_num        item['quote'] = quote        yield item</code></pre><p><br></p><p>7ã€è¿è¡Œmain.pyåï¼Œåœ¨spider/item.jsoné‡Œå°†çœ‹åˆ°çˆ¬å–çš„æ•°æ®ï¼Œä»¥Unicodeå­—ç¬¦å½¢å¼ã€‚</p><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/03d8a192ab7d4e96a9bdcdf350d113e7><p class=pgc-img-caption></p></div><p><br></p><p>8ã€è¿˜å¯ä»¥ä¿å­˜ä¸ºå…¶ä»–å½¢å¼ï¼Œå¦‚csvã€xmlï¼Œåªéœ€å°†item.jsonæ”¹ä¸ºitem.csvç­‰ã€‚</p><p><br></p><p><strong>æ•°æ®å­˜è‡³æ•°æ®åº“</strong></p><p>1ã€å»ºåº“å»ºè¡¨</p><pre><code>mysql -uroot -p Enter password:create database scrapy;use scrapy;create table movie(id int auto_increment primary key, name varchar(255),rating varchar(10), quote varchar(255))default charset=utf8;</code></pre><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ad9ca9c36f6a4472b167874a171c920a><p class=pgc-img-caption></p></div><p><br></p><p>2ã€åœ¨setting.pyä¸­é…ç½®æ•°æ®åº“è¿æ¥</p><pre><code>mysql_movie = {    'host': "127.0.0.1",    "port": 3306,    "user": "root",    "password": "pwd",    "db": "scrapy"}</code></pre><p><br></p><p>3ã€åœ¨setting.pyä¸­å°†ä»¥ä¸‹å†…å®¹å–æ¶ˆæ³¨é‡Š</p><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5296fb80e3c34e8cba818c3ddf648b57><p class=pgc-img-caption></p></div><p><br></p><p>4ã€åœ¨pipelines.pyä¸­è¿æ¥æ•°æ®åº“å­˜å‚¨æ•°æ®</p><pre><code>pip install pymysql</code></pre><pre><code># -*- coding: utf-8 -*-# Define your item pipelines here## Don't forget to add your pipeline to the ITEM_PIPELINES setting# See: https://docs.scrapy.org/en/latest/topics/item-pipeline.htmlfrom .settings import mysql_movieimport pymysqlclass DoubanPipeline:    def __init__(self):        self.host = mysql_movie["host"]        self.port = mysql_movie["port"]        self.user = mysql_movie["user"]        self.password = mysql_movie["password"]        self.db = mysql_movie["db"]        self.conn = pymysql.connect(host=self.host, port=self.port, user=self.user, password=self.password, db=self.db, charset='utf8')        self.cursor = self.conn.cursor()    def process_item(self, item, spider):        sql ='''insert into movie(name, rating, quote)values('%s','%s','%s')''' % (item["name"], item["rating_num"], item["quote"])        try:            self.cursor.execute(sql)            self.conn.commit()        except:            self.conn.rollback()        return item</code></pre><p><br></p><p>5ã€è¿è¡Œmain.pyåï¼ŒæŸ¥è¯¢æ•°æ®åº“</p><pre><code>select * from movie;</code></pre><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3f412e60b99b439ab4ff555f68c92dfc><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right>å…¶ä»–</h1><p>URLè·Ÿè¿›ï¼ˆç¿»é¡µï¼‰ï¼›åœ¨parseå‡½æ•°æœ€åï¼Œè·Ÿæ–°ä»¥ä¸‹URLï¼Œscrapyæ¡†æ¶ä¼šè‡ªåŠ¨å‘èµ·ä¸‹ä¸€æ¬¡è¯·æ±‚</p><pre><code>def parse(self, response):    # å°†å¾—åˆ°çš„æ•°æ®å°è£…åˆ°ä¸€ä¸ªDoubanItemå¯¹è±¡    item = DoubanItem()    for each in response.xpath('//*[@id="content"]/div/div[1]/ol/li'):        name = each.xpath('./div/div[2]/div[1]/a/span[1]/text()').extract_first()        rating_num = each.xpath('./div/div[2]/div[2]/div/span[2]/text()').extract_first()        quote = each.xpath('./div/div[2]/div[2]/p[2]/span/text()').extract_first()        item['name'] = name        item['rating_num'] = rating_num        item['quote'] = quote        yield item    next_url = response.xpath('//*[@id="content"]/div/div[1]/div[2]/span[3]/link/@href').extract()   if next_url:       next_url = 'https://movie.douban.com/top250' + next_url[0]       print(next_url)       yield scrapy.Request(next_url, headers=self.headers)</code></pre><p>ä¸ºäº†åšä¸€ä¸ªä¹–çˆ¬è™«ï¼Œä¸”é¿å…é¢å‘ç›‘ç‹±ç¼–ç¨‹ï¼Œå»ºè®®åœ¨setting.pyè‡³å°‘å¼€å¯ä»¥ä¸‹ä¸¤é¡¹ï¼š</p><div class=pgc-img><img alt=Scrapyçˆ¬è™«æ¡†æ¶æ–°æ‰‹å…¥é—¨æ•™ç¨‹ onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/75952e69dd7b4a5c900de4d0a0761d6c><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>æœ€å</h1><p>ç›¸ä¿¡ä½ è·Ÿæˆ‘ä¸€æ ·ï¼Œè¿‡å®Œæœ¬æ–‡ï¼Œå¯¹scrapyå·²ç»æœ‰äº†ä¸€ä¸ªå¤§è‡´çš„äº†è§£ã€‚</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Scrapy','çˆ¬è™«','å…¥é—¨'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>