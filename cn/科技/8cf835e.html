<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>系统设计中必要知道的一些缓存知识 | 极客快訊</title><meta property="og:title" content="系统设计中必要知道的一些缓存知识 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/fffb90b9203c41b1b385fd201716659f"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8cf835e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8cf835e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8cf835e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8cf835e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8cf835e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8cf835e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8cf835e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8cf835e.html><meta property="article:published_time" content="2020-10-29T20:59:28+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:28+08:00"><meta name=Keywords content><meta name=description content="系统设计中必要知道的一些缓存知识"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/8cf835e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>系统设计中必要知道的一些缓存知识</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>本文主要是关于cache的介绍、用例、策略</p><p><br></p><div class=pgc-img><img alt=系统设计中必要知道的一些缓存知识 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fffb90b9203c41b1b385fd201716659f><p class=pgc-img-caption>Data Centre</p></div><p><br></p><h1 class=pgc-h-arrow-right>前言</h1><p>你有没有注意到，如果你在缓慢的互联网中连接和浏览一个网站，文本加载之前，任何高质量的图像都不会加载。然而，在您随后访问同一网站时，您会发现页面呈现很快。当你访问一个全新的网站，它需要更多的时间来加载比经常访问的网站，如微信或阿里巴巴。你知道为什么会这样吗?答案是缓存。</p><div class=pgc-img><img alt=系统设计中必要知道的一些缓存知识 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/548b8c2cb6054cbfbb9f625255b6b6ad><p class=pgc-img-caption>Instagram page on a slow internet connection</p></div><p>上面的图片是我的微博页面在慢速互联网连接时的样子。如您所见，文本数据显示，而您无法看到图像，因为页面仍在呈现。</p><p>为用户提供最佳体验对于提高用户留存率和参与度非常重要。在当今竞争激烈的世界中，企业会因为糟糕的用户体验而受到影响。想象一下，你正在任何一个视频流媒体网站上看你最喜欢的电视剧，但是视频一直在缓冲。你会在这样的网站上继续订阅吗?</p><p>缓存的工作原理是“引用的局部性”。缓存充当数据的本地存储，以加速查找或检索。缓存的主要目标是减少读取延迟并放大任何应用程序的吞吐量。在下一节中，我们来看一个真实的类比。</p><h1 class=pgc-h-arrow-right>现实世界中缓存的类比</h1><p>假设你每天都做饭。你需要不同的配料、蔬菜、香料等来准备食物。但是你每天都去超市买这个吗?这太麻烦，太耗时了。所以，你要先检查你的厨房或冰箱，以防你的杂货堆得太满。这样就不用去逛超市了。</p><p><br></p><div class=pgc-img><img alt=系统设计中必要知道的一些缓存知识 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e95fd48d8a1e4733bdf2d55312d15311><p class=pgc-img-caption>Refrigerator behaves as a Cache for vegetables</p></div><p>在这里，你的冰箱就像是你储存蔬菜的地方。使用缓存的最大好处是节省了时间，可以快速准备食物。</p><h1 class=pgc-h-arrow-right>缓存如何工作</h1><p>后端应用程序通常将数据存储在数据库中。当客户端获取任何数据时，应用程序查询数据库，获取数据并将其返回给用户。数据库服务器作为一个单独的进程运行，可以在与应用服务器不同的计算机上运行。</p><div class=pgc-img><img alt=系统设计中必要知道的一些缓存知识 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/ce0623ffdd094f94b9ce309fd77d60ce><p class=pgc-img-caption>Application Server fetching data from DB</p></div><p>从数据库读取数据非常耗时，因为需要网络调用和IO操作才能从文件系统获取数据。如果数据存储在缓存中，读取操作将非常快。当用户重复请求相同的数据时，从缓存中获取数据比从数据库中获取数据更有意义。</p><p>例如:如果一条微博病毒式传播，所有的客户端都会尝试获取同一条微博的数据。由于微博拥有数百万用户，使用缓存将为数据库节省数百万次调用。</p><p>此外，缓存还减少了数据库的负载。如果在缓存中找到数据，就会保存数据库调用，从而减少数据库的压力。简单地说，可以将缓存看作存储键-值对的哈希表。</p><p>下图说明了从缓存中读取数据的过程:</p><p><br></p><div class=pgc-img><img alt=系统设计中必要知道的一些缓存知识 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/cf89e15403d74d9ea6a8f0ef92de5a13><p class=pgc-img-caption>Process of reading from Cache</p></div><h1 class=pgc-h-arrow-right>缓存的核心概念</h1><p><strong>TTL (Time to Live)</strong></p><p>可以存储在缓存中的数据量是有限制的。有必要删除应用服务器不再需要的缓存中的条目。</p><p>在Netflix(网飞)，服务器将缓存最频繁观看或最热门的节目。它不需要存储那些收视率随着时间而下降的节目。</p><p>例如:在我写这篇文章的时候，收藏像《王牌对王牌》这样的电视节目比收藏像《流浪地球》这样的电影更有意义。</p><p><strong>缓存算法</strong></p><p>根据应用程序访问数据的方式，缓存可能在某个时间点被填满。因此，我们需要想出一个策略来从缓存中删除数据，并将其替换为将来更有可能被访问的数据。</p><p>有多个缓存清除策略，如LRU(最近最少使用)、LFU(最不经常使用)、MRU(最近使用)。这些策略使用预定义的逻辑从缓存中删除数据。我们将在下一节中讨论上述每一项。</p><p><strong>LRU(最近最少使用)</strong></p><p>此策略从缓存中删除最近最少使用的项。一旦缓存满了，最近最少使用的条目就会被从缓存中移除，而最近使用的条目则会被添加到缓存中。</p><p>你可以想象微信把名人的照片储存在缓存里。关注者的数据访问模式是这样的，他们对最近的照片很感兴趣。当缓存被填满时，它将踢出最近添加的照片。</p><p></p><p>LFU(最少使用)</p><p>LFU跟踪数据项被访问的频率或次数。当缓存大小超过给定的阈值时，它将以最低的频率驱逐该条目。</p><p>当你在发短信的时候输入任何一个单词，你的手机就会开始提示你可以选择多个单词，而不是输入整个单词。在内部，你的手机软件会对你输入的所有单词及其频率进行缓存。</p><p><br></p><div class=pgc-img><img alt=系统设计中必要知道的一些缓存知识 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3a610b261ace4995a85007253f2fb95e><p class=pgc-img-caption>Phone’s software recommending words to complete</p></div><p>缓存稍后将以最低的频率清除该单词。如果多个单词之间存在关联，那么最近最少使用的单词将被清除。在上面的手机例子中，如果你开始使用“功能”，“功能”，“羽毛”等词，它将停止向你提示“壮举”这个词(因为这将被从缓存中删除)。</p><p></p><p>MRU(最近使用)</p><p>在MRU中，删除最近使用的条目，并优先将旧的条目保留在缓存中。如果数据访问模式使用户不太可能查看最近的条目，则此策略用于清除。让我们看一个例子。</p><p><br></p><div class=pgc-img><img alt=系统设计中必要知道的一些缓存知识 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d144f72e395341479b83f26d5e739b09><p class=pgc-img-caption>Tinder Left/Right Swipe uses the MRU policy</p></div><p>像陌陌这样的约会应用通常会缓存用户的所有潜在匹配对象。当用户向左或向右滑动个人资料时，应用程序不应该再次向用户推荐相同的个人资料。如果发生这种情况，将会导致糟糕的用户体验。</p><p>有必要对最近观察到的条目进行剔除。应用程序必须删除向右或向左滑动的配置文件的缓存项。</p><h1 class=pgc-h-arrow-right>缓存类型</h1><p><strong>Write Through Cache</strong></p><p>顾名思义，数据首先写入缓存，然后写入数据库。这确保了缓存中的数据与数据库中的数据之间的一致性。在缓存上执行的每次读操作都是在最近的写操作之后进行的。<br></p><div class=pgc-img><img alt=系统设计中必要知道的一些缓存知识 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a5a24b027fdb4a569e801df0856b961f><p class=pgc-img-caption>Write Through Cache</p></div><p>但是，这种方法的缺点是应用程序写延迟增加。这种方法不适合写得很多的系统。对于那些一旦数据被持久化到数据库中就频繁地重新读取数据的应用程序来说，这是非常有用的。写延迟可能会受到影响，但它可以通过较低的读延迟和一致性得到补偿</p><p><strong>Write Back Cache</strong></p><p>从上面可以看出，通过缓存进行写操作并不适用于写操作较多的系统，因为延迟可能会增加。另一种方法是先将数据写入缓存，并将数据标记为已修改(稍后在DB中更新)。</p><p><br></p><div class=pgc-img><img alt=系统设计中必要知道的一些缓存知识 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/a11b1af97ed14101ac34d5689404e671><p class=pgc-img-caption>Write Back Cache</p></div><p>异步作业可以定期读取缓存中的所有修改项，并更新它们在数据库中的相应值。这种方法既不会影响读延迟，也不会影响写延迟。唯一的缺点是缓存和数据库之间的数据同步会有延迟。由于数据库是事实的来源，从数据库中读取的任何应用程序都将读取陈旧的条目。</p><p>像腾讯视频这样的网站使用回写缓存来存储任何视频的浏览次数。为病毒视频的每一个单独的视图更新数据库将是昂贵的。将数据写入缓存，然后将其同步到数据库是更好的解决方案。使用回写缓存可以确保较低的读/写延迟。</p><p><strong>Write Around Cache</strong></p><p>很少有后端应用程序不经常重新读取最近的数据。在这种情况下，使用了写入缓存。</p><p><br></p><div class=pgc-img><img alt=系统设计中必要知道的一些缓存知识 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/c31c4a5c1a7345409aa06e6a7c7b1676><p class=pgc-img-caption>Write Around Cache</p></div><p>在此策略中，数据库在不写入缓存的情况下更新。这不会加载缓存的数据不会被重新读取。如果应用程序开始查询最近的数据，就会导致缓存丢失。</p><p>以下是内存中缓存产品的开源列表</p><ul><li>Redis</li><li>Memcached</li><li>VoltDB</li><li>Aerospike DBS</li><li>Apache Ignite</li><li>haproxy for cache</li></ul><p>引用自</p><ul><li>List of In-memory databases [https://en.wikipedia.org/wiki/List_of_in-memory_databases]</li><li>What is Caching? [https://www.cloudflare.com/learning/cdn/what-is-caching/]</li><li>Distributed Caching [https://en.wikipedia.org/wiki/Distributed_cache]</li><li>Types of Caches [https://www.geeksforgeeks.org/write-through-and-write-back-in-cache/]</li></ul><p></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'系统','设计','缓存'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>