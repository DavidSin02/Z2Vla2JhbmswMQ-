<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>SpringBoot整合MyBatisPlus配置动态数据源（文末有惊喜） | 极客快訊</title><meta property="og:title" content="SpringBoot整合MyBatisPlus配置动态数据源（文末有惊喜） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/ebfc1edc673a4121ab43dae6314cb425"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8dc0a13.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8dc0a13.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8dc0a13.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8dc0a13.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8dc0a13.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8dc0a13.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8dc0a13.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8dc0a13.html><meta property="article:published_time" content="2020-10-29T20:58:17+08:00"><meta property="article:modified_time" content="2020-10-29T20:58:17+08:00"><meta name=Keywords content><meta name=description content="SpringBoot整合MyBatisPlus配置动态数据源（文末有惊喜）"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/8dc0a13.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>SpringBoot整合MyBatisPlus配置动态数据源（文末有惊喜）</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p><strong>MybatisPlus特性</strong></p><div class=pgc-img><img alt=SpringBoot整合MyBatisPlus配置动态数据源（文末有惊喜） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ebfc1edc673a4121ab43dae6314cb425></div><ul><li><strong>无侵入</strong>：只做增强不做改变，引入它不会对现有工程产生影响，如丝般顺滑</li><li><strong>损耗小</strong>：启动即会自动注入基本 CURD，性能基本无损耗，直接面向对象操作</li><li><strong>强大的 CRUD 操作</strong>：内置通用 Mapper、通用 Service，仅仅通过少量配置即可实现单表大部分 CRUD 操作，更有强大的条件构造器，满足各类使用需求</li><li><strong>支持 Lambda 形式调用</strong>：通过 Lambda 表达式，方便的编写各类查询条件，无需再担心字段写错</li><li><strong>支持多种数据库</strong>：支持 MySQL、MariaDB、Oracle、DB2、H2、HSQL、SQLite、Postgre、SQLServer2005、SQLServer 等多种数据库</li><li><strong>支持主键自动生成</strong>：支持多达 4 种主键策略（内含分布式唯一 ID 生成器 - Sequence），可自由配置，完美解决主键问题</li><li><strong>支持 XML 热加载</strong>：Mapper 对应的 XML 支持热加载，对于简单的 CRUD 操作，甚至可以无 XML 启动</li><li><strong>支持 ActiveRecord 模式</strong>：支持 ActiveRecord 形式调用，实体类只需继承 Model 类即可进行强大的 CRUD 操作</li><li><strong>支持自定义全局通用操作</strong>：支持全局通用方法注入（ Write once, use anywhere ）</li><li><strong>支持关键词自动转义</strong>：支持数据库关键词（order、key......）自动转义，还可自定义关键词</li><li><strong>内置代码生成器</strong>：采用代码或者 Maven 插件可快速生成 Mapper 、 Model 、 Service 、 Controller 层代码，支持模板引擎，更有超多自定义配置等您来使用</li><li><strong>内置分页插件</strong>：基于 MyBatis 物理分页，开发者无需关心具体操作，配置好插件之后，写分页等同于普通 List 查询</li><li><strong>内置性能分析插件</strong>：可输出 Sql 语句以及其执行时间，建议开发测试时启用该功能，能快速揪出慢查询</li><li><strong>内置全局拦截插件</strong>：提供全表 delete 、 update 操作智能分析阻断，也可自定义拦截规则，预防误操作</li><li><strong>内置 Sql 注入剥离器</strong>：支持 Sql 注入剥离，有效预防 Sql 注入攻击</li></ul><p><strong>快速开始</strong></p><p>初始化测试数据表：</p><p>DROP TABLE IF EXISTS user;</p><p>CREATE TABLE user</p><p>(</p><p>id BIGINT(20) NOT NULL COMMENT '主键ID',</p><p>name VARCHAR(30) NULL DEFAULT NULL COMMENT '姓名',</p><p>age INT(11) NULL DEFAULT NULL COMMENT '年龄',</p><p>email VARCHAR(50) NULL DEFAULT NULL COMMENT '邮箱',</p><p>PRIMARY KEY (id)</p><p>);</p><p>DELETE FROM user;</p><p>INSERT INTO user (id, name, age, email) VALUES</p><p>(1, 'Jone', 18, 'test1@baomidou.com'),</p><p>(2, 'Jack', 20, 'test2@baomidou.com'),</p><p>(3, 'Tom', 28, 'test3@baomidou.com'),</p><p>(4, 'Sandy', 21, 'test4@baomidou.com'),</p><p>(5, 'Billie', 24, 'test5@baomidou.com');</p><p><strong>父工程依赖</strong></p><p>该工程用于依赖管理，pom如下：</p><p>&lt;properties></p><p>&lt;project.build.sourceEncoding>UTF-8&lt;/project.build.sourceEncoding></p><p>&lt;project.reporting.outputEncoding>UTF-8&lt;/project.reporting.outputEncoding></p><p>&lt;java.version>1.8&lt;/java.version></p><p>&lt;spring-cloud.version>Finchley.RELEASE&lt;/spring-cloud.version></p><p>&lt;mybatis-plus-version>3.1.1&lt;/mybatis-plus-version></p><p>&lt;mysql-driver-version>5.1.47&lt;/mysql-driver-version></p><p>&lt;druid-version>1.1.10&lt;/druid-version></p><p>&lt;/properties></p><p>&lt;dependencyManagement></p><p>&lt;dependencies></p><p>&lt;dependency></p><p>&lt;groupId>org.springframework.boot&lt;/groupId></p><p>&lt;artifactId>spring-boot-dependencies&lt;/artifactId></p><p>&lt;version>2.1.5.RELEASE&lt;/version></p><p>&lt;type>pom&lt;/type></p><p>&lt;scope>import&lt;/scope></p><p>&lt;/dependency></p><p>&lt;/dependencies></p><p>&lt;/dependencyManagement></p><p><strong>创建MyBaitsPlus工程</strong></p><p>依赖如下：</p><p>&lt;dependencies></p><p>&lt;dependency></p><p>&lt;groupId>org.springframework.boot&lt;/groupId></p><p>&lt;artifactId>spring-boot-starter&lt;/artifactId></p><p>&lt;/dependency></p><p>&lt;dependency></p><p>&lt;groupId>org.springframework.boot&lt;/groupId></p><p>&lt;artifactId>spring-boot-starter-web&lt;/artifactId></p><p>&lt;/dependency></p><p>&lt;dependency></p><p>&lt;groupId>org.springframework.boot&lt;/groupId></p><p>&lt;artifactId>spring-boot-starter-test&lt;/artifactId></p><p>&lt;scope>test&lt;/scope></p><p>&lt;/dependency></p><p>&lt;!-- mybatis plus --></p><p>&lt;dependency></p><p>&lt;groupId>com.baomidou&lt;/groupId></p><p>&lt;artifactId>mybatis-plus-boot-starter&lt;/artifactId></p><p>&lt;version>${mybatis-plus-version}&lt;/version></p><p>&lt;/dependency></p><p>&lt;!-- mysql --></p><p>&lt;dependency></p><p>&lt;groupId>mysql&lt;/groupId></p><p>&lt;artifactId>mysql-connector-java&lt;/artifactId></p><p>&lt;version>${mysql-driver-version}&lt;/version></p><p>&lt;/dependency></p><p>&lt;!-- druid数据连接池 --></p><p>&lt;dependency></p><p>&lt;groupId>com.alibaba&lt;/groupId></p><p>&lt;artifactId>druid-spring-boot-starter&lt;/artifactId></p><p>&lt;version>${druid-version}&lt;/version></p><p>&lt;/dependency></p><p>&lt;dependency></p><p>&lt;groupId>org.projectlombok&lt;/groupId></p><p>&lt;artifactId>lombok&lt;/artifactId></p><p>&lt;optional>true&lt;/optional></p><p>&lt;/dependency></p><p>&lt;dependency></p><p>&lt;groupId>log4j&lt;/groupId></p><p>&lt;artifactId>log4j&lt;/artifactId></p><p>&lt;version>1.2.17&lt;/version></p><p>&lt;/dependency></p><p>&lt;/dependencies></p><p><strong>properties配置</strong></p><p>在这里配置数据库连接，以及数据连接池与mybatisplus的配置等</p><p>server.port=8080</p><p>spring.application.name=mybatis</p><p>spring.datasource.type=com.alibaba.druid.pool.DruidDataSource</p><p>spring.datasource.driver-class-name=com.mysql.jdbc.Driver</p><p>spring.datasource.url=jdbc:mysql://localhost:3306/mybatis?useSSL=false&characterEncoding=utf8</p><p>spring.datasource.username=root</p><p>spring.datasource.password=root</p><p>spring.datasource.druid.initial-size=5</p><p>spring.datasource.druid.min-idle=5</p><p>spring.datasource.druid.maxActive=20</p><p>spring.datasource.druid.maxWait=60000</p><p>spring.datasource.druid.timeBetweenEvictionRunsMillis=60000</p><p>spring.datasource.druid.minEvictableIdleTimeMillis=300000</p><p>spring.datasource.druid.validationQuery=SELECT 1 FROM DUAL</p><p>spring.datasource.druid.testWhileIdle=true</p><p>spring.datasource.druid.testOnBorrow=false</p><p>spring.datasource.druid.testOnReturn=false</p><p>spring.datasource.druid.poolPreparedStatements=true</p><p>spring.datasource.druid.maxPoolPreparedStatementPerConnectionSize=20</p><p>spring.datasource.druid.filters=stat,slf4j</p><p>spring.datasource.druid.connectionProperties=druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000</p><p>spring.datasource.druid.web-stat-filter.enabled=true</p><p>spring.datasource.druid.web-stat-filter.url-pattern=/*</p><p>spring.datasource.druid.web-stat-filter.exclusions=*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*</p><p>spring.datasource.druid.stat-view-servlet.url-pattern=/druid/*</p><p>spring.datasource.druid.stat-view-servlet.allow=127.0.0.1,192.168.163.1</p><p>spring.datasource.druid.stat-view-servlet.deny=192.168.1.73</p><p>spring.datasource.druid.stat-view-servlet.reset-enable=false</p><p>#Druid 管理账号</p><p>spring.datasource.druid.stat-view-servlet.login-username=admin</p><p>#Druid 管理密码</p><p>spring.datasource.druid.stat-view-servlet.login-password=123456</p><p>#com.simple.spring.boot.mapper 该包打印DEBUG级别日志</p><p>logging.level.com.simple.spring.boot.mapper=debug</p><p>#mybatis plus mapper文件路径</p><p>mybatis-plus.mapperLocations=classpath:/mybatis/mapper/*.xml</p><p>#mybaits plus 实体类路径</p><p>mybatis-plus.typeAliasesPackage=com.simple.spring.**.entities</p><p>mybatis-plus.typeEnumsPackage=</p><p>#数据库相关配置</p><p>#主键类型 AUTO:"数据库ID自增", INPUT:"用户输入ID",ID_WORKER:"全局唯一ID (数字类型唯一ID)", UUID:"全局唯一ID UUID";</p><p>mybatis-plus.global-config.db-config.id-type=UUID</p><p>#字段策略 IGNORED:"忽略判断",NOT_NULL:"非 NULL 判断"),NOT_EMPTY:"非空判断"</p><p>mybatis-plus.global-config.db-config.field-strategy=not_empty</p><p>#驼峰下划线转换</p><p>mybatis-plus.global-config.db-config.column-underline=true</p><p>#数据库大写下划线转换</p><p>#capital-mode: true</p><p>#逻辑删除配置</p><p>mybatis-plus.global-config.db-config.logic-delete-value=0</p><p>mybatis-plus.global-config.db-config.logic-not-delete-value= 1</p><p>#mybatis-plus.global-config.db-config.db-type= sqlserver</p><p>#刷新mapper 调试神器</p><p>mybatis-plus.global-config.refresh=true</p><p># 原生配置</p><p>mybatis-plus.configuration.map-underscore-to-camel-case=true</p><p>mybatis-plus.configuration.cache-enabled=false</p><p>mybatis-plus.configuration.call-setters-on-nulls =true</p><p><strong>常规增删改查实现</strong></p><p>创建实体类：</p><p>**</p><p>* 实体类</p><p>* @author: SimpleWu</p><p>* @date: 2019/5/25</p><p>*/</p><p>@Data</p><p>public class User {</p><p>private Long id;</p><p>private String name;</p><p>private Integer age;</p><p>private String email;</p><p>}</p><p>该lombok插件省去getset方法。</p><p>创建UserMapper接口，并且实现BaseMapper&lt;User>这里我们指定实体类为user可直接使用接口中的方法。</p><ul><li>查询所有数据</li></ul><p>public List&lt;User> getList(){</p><p>return userMapper.selectList(null);</p><p>}</p><ul><li>查询数据带查询条件</li></ul><p>public List&lt;User> getListQuery(){</p><p>User user = new User();</p><p>user.setName("SimpleWu");</p><p>Wrapper&lt;User> wrapper = new QueryWrapper&lt;>(user);</p><p>return userMapper.selectList(wrapper);</p><p>}</p><ul><li>查询带分页</li></ul><p>public IPage&lt;User> page(){</p><p>int currentPage = 1 ; //当前页</p><p>int pageSize = 2 ;//每页大小</p><p>IPage&lt;User> page = new Page(currentPage,pageSize);</p><p>page = userMapper.selectPage(page,null);</p><p>return page;</p><p>}</p><ul><li>根据实体类新增数据</li></ul><p>@Transactional//本地事务开启</p><p>public int insert(){</p><p>User user = new User();</p><p>user.setId(6l);</p><p>user.setName("SimpleWu");</p><p>user.setAge(100);</p><p>user.setEmail("SimpleWu@gmail.com");</p><p>return userMapper.insert(user);</p><p>}</p><ul><li>根据主键删除数据</li></ul><p>@Transactional//本地事务开启</p><p>public int deleteById(){</p><p>int userId = 6;</p><p>return userMapper.deleteById(userId);</p><p>}</p><ul><li>根据ID更新数据</li></ul><p>@Transactional//本地事务开启</p><p>public int updateById(){</p><p>User user = new User();</p><p>user.setId(5l);</p><p>user.setName("update");</p><p>user.setAge(100);</p><p>user.setEmail("update@email.com");</p><p>return userMapper.updateById(user);</p><p>}</p><ul><li>条件构造器</li><li>UpdateWrapper 用于增删改构造条件</li><li>QueryWrapper 用于查询构造条件</li></ul><p>Transactional//本地事务开启</p><p>public int updateWrapperUser(){</p><p>User user = new User();</p><p>user.setId(5l);</p><p>user.setName("update");</p><p>user.setAge(100);</p><p>user.setEmail("update@email.com");</p><p>User updateWrapperUser = new User();</p><p>updateWrapperUser.setId(1l);</p><p>/**</p><p>* 修改 UpdateWrapper</p><p>* 查询 QueryWrapper</p><p>*/</p><p>Wrapper&lt;User> wrapper = new UpdateWrapper&lt;>(updateWrapperUser);</p><p>return userMapper.update(user,wrapper);</p><p>}</p><ul><li>Mapper接口绑定Mapper文件</li><li>properites中配置既可</li></ul><p>#扫描mybatis/mapper下面的所有xml</p><p>mybatis-plus.mapperLocations=classpath:/mybatis/mapper/*.xml</p><ul><li>UserMapper接口测试</li></ul><p>public interface UserMapper extends BaseMapper&lt;User> {</p><p>Map&lt;String,Object> queryUser(@Param("USER_ID") String userId);</p><p>}</p><p>UserMapper.xml，如下：</p><p>&lt;select id="queryUser" resultType="java.util.HashMap" parameterType="java.lang.String"></p><p>SELECT</p><p>ID,</p><p>NAME</p><p>FROM</p><p>USER</p><p>WHERE ID = #{USER_ID}</p><p>&lt;/select></p><p>执行SQL：</p><p>public Map&lt;String,Object> myMapper(){</p><p>return userMapper.queryUser("2");</p><p>}</p><p>在SpringBoot中使用MybatisPlus分页需要注入Bean，并且在启动类上使用@MapperScan("com.simple.spring.boot.mapper")扫描mapper文件路径如下：</p><p>@SpringBootApplication</p><p>@MapperScan("com.simple.spring.boot.mapper")</p><p>public class MybatisPlusApplication {</p><p>/**</p><p>* 分页插件注册</p><p>* @return</p><p>*/</p><p>@Bean</p><p>public PaginationInterceptor paginationInterceptor() {</p><p>return new PaginationInterceptor();</p><p>}</p><p>public static void main(String[] args) {</p><p>SpringApplication.run(MybatisPlusApplication.class, args);</p><p>}</p><p>}</p><p>使用MyBatisPlus可以为我们减少很多很多的代码，不过需要编写实体类，有失必有得。</p><p><strong>配置动态数据源</strong></p><p>dynamic-datasource-spring-boot-starter 是一个基于springboot的快速集成多数据源的启动器。</p><p><strong>优势</strong></p><p>网上关于动态数据源的切换的文档有很多，核心只有两种。</p><ol><li>构建多套环境，优势是方便控制也容易集成一些简单的分布式事务，缺点是非动态同时代码量较多,配置难度大。</li><li>基于spring提供原生的 AbstractRoutingDataSource ，参考一些文档自己实现切换。</li></ol><p>如果你的数据源较少，场景不复杂，选择以上任意一种都可以。如果你需要更多特性，请尝试本动态数据源。</p><ol><li>数据源分组，适用于多种场景 纯粹多库 读写分离 一主多从 混合模式。</li><li>简单集成Druid数据源监控多数据源，简单集成Mybatis-Plus简化单表，简单集成P6sy格式化sql，简单集成Jndi数据源。</li><li>简化Druid和HikariCp配置，提供全局参数配置。</li><li>提供自定义数据源来源(默认使用yml或properties配置)。</li><li>项目启动后能动态增减数据源。</li><li>使用spel动态参数解析数据源，如从session，header和参数中获取数据源。（多租户架构神器）</li><li>多层数据源嵌套切换。（一个业务ServiceA调用ServiceB，ServiceB调用ServiceC，每个Service都是不同的数据源）</li><li>使用正则匹配或spel表达式来切换数据源（实验性功能）。</li></ol><p><strong>劣势</strong></p><p>不能使用多数据源事务（同一个数据源下能使用事务），网上其他方案也都不能提供。</p><p>如果你需要使用到分布式事务，那么你的架构应该到了微服务化的时候了。</p><p>如果呼声强烈，项目达到800 star，作者考虑集成分布式事务。</p><p>PS: 如果您只是几个数据库但是有强烈的需求分布式事务，建议还是使用传统方式自己构建多套环境集成atomic这类，网上百度很多。</p><p><strong>约定</strong></p><ol><li>本框架只做 <strong>切换数据源</strong> 这件核心的事情，并<strong>不限制你的具体操作</strong>，切换了数据源可以做任何CRUD。</li><li>配置文件所有以下划线 _ 分割的数据源 <strong>首部</strong> 即为组的名称，相同组名称的数据源会放在一个组下。</li><li>切换数据源即可是组名，也可是具体数据源名称，切换时默认采用负载均衡机制切换。</li><li>默认的数据源名称为 <strong>master</strong> ，你可以通过spring.datasource.dynamic.primary修改。</li><li>方法上的注解优先于类上注解。</li></ol><p><strong>建议</strong></p><p>强烈建议在 <strong>主从模式</strong> 下遵循普遍的规则，以便他人能更轻易理解你的代码。</p><p>主数据库 <strong>建议</strong> 只执行 INSERT UPDATE DELETE 操作。</p><p>从数据库 <strong>建议</strong> 只执行 SELECT 操作。</p><p><strong>快速开始</strong></p><p>加入依赖：</p><p>&lt;!-- 动态数据源 --></p><p>&lt;dependency></p><p>&lt;groupId>com.baomidou&lt;/groupId></p><p>&lt;artifactId>dynamic-datasource-spring-boot-starter&lt;/artifactId></p><p>&lt;version>2.5.4&lt;/version></p><p>&lt;/dependency></p><p>注释掉原来的数据库配置，加入：</p><p>#设置默认的数据源或者数据源组,默认值即为master</p><p>spring.datasource.dynamic.primary=master</p><p>#主库配置</p><p>spring.datasource.dynamic.datasource.master.username=root</p><p>spring.datasource.dynamic.datasource.master.password=root</p><p>spring.datasource.dynamic.datasource.master.driver-class-name=com.mysql.jdbc.Driver</p><p>spring.datasource.dynamic.datasource.master.url=jdbc:mysql://localhost:3306/mybatis?useSSL=false&characterEncoding=utf8</p><p>#从库配置</p><p>spring.datasource.dynamic.datasource.slave_1.username=root</p><p>spring.datasource.dynamic.datasource.slave_1.password=root</p><p>spring.datasource.dynamic.datasource.slave_1.driver-class-name=com.mysql.jdbc.Driver</p><p>spring.datasource.dynamic.datasource.slave_1.url=jdbc:mysql://localhost:3307/mybatis?useSSL=false&characterEncoding=utf8</p><p>使用 <strong>@DS</strong> 切换数据源。</p><p>@DS("master")</p><p>public List&lt;User> getListQuery(){</p><p>User user = new User();</p><p>user.setName("SimpleWu");</p><p>Wrapper&lt;User> wrapper = new QueryWrapper&lt;>(user);</p><p>return userMapper.selectList(wrapper);</p><p>}</p><p>@DS("slave_1")</p><p>public IPage&lt;User> page(){</p><p>int currentPage = 1 ; //当前页</p><p>int pageSize = 2 ;//每页大小</p><p>IPage&lt;User> page = new Page(currentPage,pageSize);</p><p>page = userMapper.selectPage(page,null);</p><p>return page;</p><p>}</p><p><strong>@DS</strong> 可以注解在方法上和类上，<strong>同时存在方法注解优先于类上注解</strong>。</p><p>注解在service实现或mapper接口方法上，但强烈不建议同时在service和mapper注解。 (可能会有问题)</p><p>如果不加入主键则使用默认数据源。</p><p>DruidDataSourceAutoConfigure会注入一个DataSourceWrapper，其会在原生的spring.datasource下找url,username,password等。而我们动态数据源的配置路径是变化的,所以需要排除：</p><p>spring:</p><p>autoconfigure:</p><p>exclude: com.alibaba.druid.spring.boot.autoconfigure.DruidDataSourceAutoConfigure</p><p>或者在类上排除：</p><p>@SpringBootApplication(exclude = DruidDataSourceAutoConfigure.class)</p><p>然后更换properties配置信息：</p><p>#公共配置 Druid登录账号 密码</p><p>spring.datasource.druid.stat-view-servlet.login-username=admin</p><p>spring.datasource.druid.stat-view-servlet.login-password=123456</p><p>spring.datasource.dynamic.druid.initial-size=5</p><p>spring.datasource.dynamic.druid.min-idle=5</p><p>spring.datasource.dynamic.druid.maxActive=20</p><p>spring.datasource.dynamic.druid.maxWait=60000</p><p>spring.datasource.dynamic.druid.timeBetweenEvictionRunsMillis=60000</p><p>spring.datasource.dynamic.druid.minEvictableIdleTimeMillis=300000</p><p>spring.datasource.dynamic.druid.validationQuery=SELECT 1 FROM DUAL</p><p>spring.datasource.dynamic.druid.testWhileIdle=true</p><p>spring.datasource.dynamic.druid.testOnBorrow=false</p><p>spring.datasource.dynamic.druid.testOnReturn=false</p><p>spring.datasource.dynamic.druid.poolPreparedStatements=true</p><p>spring.datasource.dynamic.druid.maxPoolPreparedStatementPerConnectionSize=20</p><p>spring.datasource.dynamic.druid.filters=stat,slf4j</p><p>spring.datasource.dynamic.druid.connectionProperties=druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000</p><p>spring.datasource.dynamic.druid.web-stat-filter.enabled=true</p><p>spring.datasource.dynamic.druid.web-stat-filter.url-pattern=/*</p><p>spring.datasource.dynamic.druid.web-stat-filter.exclusions=*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*</p><p>spring.datasource.dynamic.druid.stat-view-servlet.url-pattern=/druid/*</p><p>spring.datasource.dynamic.druid.stat-view-servlet.allow=127.0.0.1,192.168.163.1</p><p>spring.datasource.dynamic.druid.stat-view-servlet.deny=192.168.1.73</p><p>spring.datasource.dynamic.druid.stat-view-servlet.reset-enable=false</p><p>本篇代码案例地址：</p><p>https://github.com/450255266/open-doubi</p><p>作者：SimpleWu</p><p>出处：https://www.cnblogs.com/SimpleWu/p/10930388.html</p><h1><strong>最后，小编给大家分享一份Java学习从入门到精通的全套学习资料</strong></h1><h1><strong>转发此文，关注并私信小编“学习”马上免费领取</strong></h1><div class=pgc-img><img alt=SpringBoot整合MyBatisPlus配置动态数据源（文末有惊喜） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6e80367ad0b94f70b707c9208e8e3c57></div><h1><strong>当然还有一些其他的资料：</strong></h1><div class=pgc-img><img alt=SpringBoot整合MyBatisPlus配置动态数据源（文末有惊喜） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/038e479916b144c0a920e736b2351d14></div><div class=pgc-img><img alt=SpringBoot整合MyBatisPlus配置动态数据源（文末有惊喜） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/574575c14a5544ad8c395b63e790ec62></div><div class=pgc-img><img alt=SpringBoot整合MyBatisPlus配置动态数据源（文末有惊喜） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8130aa61c5ed451d8a8a375770e130b9></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'文末','SpringBoot','MyBatisPlus'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>