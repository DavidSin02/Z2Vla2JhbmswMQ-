<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Android数据存储 | 极客快訊</title><meta property="og:title" content="Android数据存储 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8ee17a8.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8ee17a8.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8ee17a8.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8ee17a8.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8ee17a8.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8ee17a8.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8ee17a8.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8ee17a8.html><meta property="article:published_time" content="2020-10-29T20:53:03+08:00"><meta property="article:modified_time" content="2020-10-29T20:53:03+08:00"><meta name=Keywords content><meta name=description content="Android数据存储"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/8ee17a8.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Android数据存储</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>上文学习和了解了Android中的网络获取数据的方式，基于性能和程序运行效率等各方面的需要，应用本地也需要存储数据，供引用功能使用。比如离线数据，模板包数据，样式文件，历史浏览数据等各种类型的数据，均需要存储起来。</p><p style=text-align:start>本文我们来看看Android应用开发中的数据存储都包含哪些内容。</p><h1 class=pgc-h-arrow-right><strong>一、常见数据存储方式</strong></h1><p style=text-align:start>在android中，通用的数据存储归纳方式可以总结为一下几类：</p><ul><li><strong>文件存储：</strong>将数据存储在文件中。文件存储根据位置不同，可以存储在应用的包下，也可以存储在公共的sd上，称之为外部存储。</li><li><strong>SharedPreference存储：</strong>将数据以键值对的形式进行存储，该种存储方式一般会存一些引用的设置信息，属于一种轻量级的存储机制。xml</li><li><strong>SQLite数据库存储：</strong>Android系统中的轻量级关系型数据，允许用户进行创建表结构，存储应用数据等操作。</li><li><strong>使用ContentProvider存储数据：</strong>在应用程序之间，共享或者传递相关信息时，往往可以使用Content Provider和ContentResolver实现，在前文已经做过叙述，此处不再赘述。</li><li><strong>网络获取：</strong>通过接口数据从服务器后台获取，需要网络访问</li></ul><h1 class=pgc-h-arrow-right><strong>SharedPreference存储</strong></h1><p style=text-align:start>SharedPreference是Android提供的用来存储一些简单配置信息的一种机制，核心原理是：保存基于XML文件存储的key-value键值对数据。通常使用该种方式用来存储一些简单信息，例如：应用版本信息，应用主题类型等等。其采用了Map数据结构来存储数据，以键值对的方式存储，可以简单的读取与写入。</p><p style=text-align:start>主要的特点和用法总结如下所示：</p><ul><li>SharedPreferences本身是一个接口，无法直接创建SharedPreferences实例。可以通过Context提供的getSharedPreferences(String name, int mode)方法来获取SharedPreferences实例，第一个参数表示要操作的xml文件名，第二个参数表示操作模式：MODE_PRIVATE、MODE_WORLD_READABLE、MODE_WORLD_WRITEABLE，推荐使用MODE_PRIVATE。</li><li>Editor：SharedPreferences只能获取数据，不能存储和修改。存储修改是通过SharedPreferences.edit()获取的内部接口Editor对象实现。</li><li>SharedPreferences对应的xml文件位置：/data/data/package name/shared_prefs/</li></ul><h1 class=pgc-h-arrow-right><strong>文件存储</strong></h1><h1 class=pgc-h-arrow-right><strong>内部存储</strong></h1><p style=text-align:start>核心原理：上下文Context提供了很多方法来打开数据文件里的文件，常用的API如下：</p><ul><li>getDir(String name,int mode)：内部存储根目录下的文件夹，如果不存在则会新建。该目录的位置是<strong>data/data/&lt;</strong><strong>包名</strong><strong>>/</strong>。</li><li>getFilesDir()：返回报名目录下的文件夹，对应的目录依然是<strong>data/data/&lt;包名>/files/</strong></li><li>fileList()：列举文件和文件夹，对应的目录是<strong>data/data/&lt;包名>/files/</strong></li><li>openFileInput(String name)：打开文件输入流(不存在则抛出FileNotFoundException)</li><li>openFileOut(String name,int mode)：打开文件输出流(文件不存在则新建)</li><li>deleteFile(String name)：删除文件或文件夹</li></ul><p style=text-align:start>总结，以上这些Context提供的关于目录和文件的操作，均是在data/dat/包名及其目录下进行操作的。</p><h1 class=pgc-h-arrow-right><strong>缓存</strong></h1><ul><li>getCacheDir：获取应用的缓存文件夹，缓存文件夹的目录位置是：data/data/包名/cache/</li><li>getCodeCacheDir：存放优化过的代码，比如JIT优化</li></ul><h1 class=pgc-h-arrow-right><strong>文件访问模式</strong></h1><ul><li><strong>MODE_PRIVATE：</strong>只对在应用内可见，使用最多的就是这种模式。</li><li><strong>MODE_APPEND：</strong>如果文件存在，则在文件末尾追加；文件不存在，则与 MODE_PRIVATE 相同。</li><li>MODE_WORLD_READABLE和MODE_WORLD_WRITEABLE：允许其他应用访问，但是在API17版本已经被弃用，不在推荐使用，从API版本24开始，禁止使用这两种常量模式。</li></ul><h1 class=pgc-h-arrow-right><strong>外部存储</strong></h1><p style=text-align:start>除了内部存储空间可以存储内容外，在移动设备商，均带有外部存储介质，即外部存储（如SD卡）。但是随着设备内置存储空间增大，很多设备已经足以将内置存储空间一分为二，一块为内部存储，一块为外部存储。使用外部存储有两个点需要注意：</p><ul><li>需要检测外部存储介质是否已经挂载</li><li>外部存储的空间，所有的应用都可以访问并执行读写操作。</li><li>声明读写权限：WRITE_EXTERNAL_STORAGE、READ_EXTERNAL_STORAGE，从API19开始，已经不再需要声明读写权限。</li></ul><p style=text-align:start>外部存储空间可以分为两个部分，私有目录和公共目录</p><h1 class=pgc-h-arrow-right><strong>私有目录（private）</strong></h1><p style=text-align:start>私有目录（private）对应的存储路径是storage/emulated/0/Android/，私有目录的特点是：</p><ul><li>每个应用独占以包名命名的私有文件夹</li><li>这些私有文件夹在应用卸载时被删除</li><li>适合使用的场景是：非私密数据，需要随应用卸载而删除的一些数据</li></ul><p style=text-align:start>私有目录的路径是<strong>storage/emulated/0/Android/data/&lt;包名>/</strong>，系统提供的主要API包括：</p><ul><li>getExternalCacheDir：cache文件夹</li><li>getExternalCacheDirs：多部分cache文件夹</li><li>getExternalFilesDir：files文件夹</li><li>getExternalFIlesDirs：多部分files文件夹</li><li>getExternalMediaDirs：多媒体文件夹</li></ul><h1 class=pgc-h-arrow-right><strong>公共目录（public）</strong></h1><p style=text-align:start>在外部存储介质中，除了私有目录外，还有一些公共的目录。这些公共目录：</p><ul><li>所有应用共享</li><li>在应用卸载时不会被删除</li><li>适用于非私密的数据，不需要随应用卸载删除</li></ul><p style=text-align:start>公共目录的存储路径是<strong>storage/emulated/0/</strong>，系统提供的主要的API包括：</p><ul><li>getExternalStorageDirectory：外部存储根目录</li><li>getExternalStoragePublicDirectory：外部存储根目录下的文件夹</li><li>getExternalStorageState：外部存储状态</li></ul><h1 class=pgc-h-arrow-right><strong>SQLite数据库</strong></h1><p style=text-align:start>SQLite 一个非常流行的嵌入式数据库，它支持 SQL 语言，并且只利用很少的内存就有很好的性能。此外它还是开源的，任何人都可以使用它。许多开源项目（(Mozilla, PHP, Python）都使用了 SQLite。</p><p style=text-align:start>Android 在运行时（run-time）集成了 SQLite，所以每个 Android 应用程序都可以使用 SQLite 数据库。对于熟悉 SQL 的开发人员来时，在 Android 开发中使用 SQLite非常简单。</p><h1 class=pgc-h-arrow-right><strong>存储路径</strong></h1><p style=text-align:start>数据库存储在 data/包名/databases/ 下。</p><h1 class=pgc-h-arrow-right><strong>创建数据库</strong></h1><p style=text-align:start>Android 不自动提供数据库。在 Android 应用程序中使用 SQLite，必须自己创建数据库，数据表、索引等内容。</p><h1 class=pgc-h-arrow-right><strong>SQLiteOpenHelper</strong></h1><p style=text-align:start>Android 提供了 SQLiteOpenHelper 帮助开发者创建一个数据库，只要继承 SQLiteOpenHelper 类即可。SQLiteOpenHelper 类根据需要，封装了创建和更新数据库使用的逻辑。SQLiteOpenHelper 的子类，至少需要实现三个方法：</p><ul><li>构造函数：调用父类 SQLiteOpenHelper 的构造函数。这个方法需要四个参数：上下文环境（例如，一个 Activity），数据库名字，一个可选的游标工厂（通常是 Null），一个代表你正在使用的数据库模型版本的整数。</li><li>onCreate方法：该方法需要一个 SQLiteDatabase 对象作为参数，根据需要对这个对象填充表和初始化数据。</li><li>onUpgrage方法：该方法需要三个参数，一个 SQLiteDatabase 对象，一个旧的版本号和一个新的版本号，这样你就可以清楚如何把一个数据库从旧的模型转变到新的模型。</li></ul></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Android','数据','存储'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>