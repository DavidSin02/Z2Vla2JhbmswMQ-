<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 | 极客快訊</title><meta property="og:title" content="电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/8d304ea806844def81454ee6df8f69d6"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90614ae7.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90614ae7.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/90614ae7.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90614ae7.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90614ae7.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/90614ae7.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/90614ae7.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90614ae7.html><meta property="article:published_time" content="2020-10-29T21:10:19+08:00"><meta property="article:modified_time" content="2020-10-29T21:10:19+08:00"><meta name=Keywords content><meta name=description content="电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/90614ae7.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>一、计算机网络的4大发展阶段</p><p>1.面向终端的计算机网络</p><p>以单个计算机为中心的远程联机系统，构成面向终端的计算机网络。这种系统用一台中央主机连接大量的地理上处于分散位置的终端，其中终端都不具备自主处理的能力。例如，20世纪50年代初美国的半自动地面防空SAGE系统，该系统将远距离的雷达和其他设备的信息，通过通信线路汇集到一台旋风计算机，第一次实现了利用计算机远距离的集中控制和人—机对话。SAGE系统的诞生被誉为计算机通信发展史上的里程碑。从此，计算机网络开始逐步形成和发展。</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8d304ea806844def81454ee6df8f69d6><p class=pgc-img-caption></p></div><p>2.计算机－计算机网络</p><p>在主机－终端系统中，随着终端设备的增加，主机负荷不断加重，处理数据效率明显下降，数据传输率较低，线路的利用率也低，因此，采用主机－终端系统的计算机网络已不能满足人们对日益增加的信息处理的需求，另外，由于计算机的性价比提高，在20世纪60年代末，出现了计算机与计算机互连的系统，它将多台自主计算机通过通信线路互联起来为用户提供服务，它的产生标志着计算机网络的兴起，并为Internet的形成奠定了基础。</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4eb2e0ed966848ed9081f6bacf31f8aa><p class=pgc-img-caption></p></div><p>最早的计算机－计算机网络是美国国防部高级研究局（Defense Advanced Research Projects Agency，DARPA）于20世纪60年代末联合计算机公司和大学共同研制而组建的ARPA网（Advanced Research Projects Agency Network，ARPANET），ARPANET中采用的许多网络技术，如分组交换、路由选择等，至今仍在使用。它是Internet 的前身，标志着计算机网络的兴起。</p><p>3.开放式标准化网络</p><p>随着大量厂商、公司都各自研制自己的计算机网络系统并提供服务，虽然计算机网络得到一定的应用，但相应的弊病也就曝露出来，他们各自研制的网络系统没有一个统一的标准，不能实现互连。为了解决这一问题，20世纪70年代末，国际标准化组织（International Standards Organization，ISO）成立了专门的工作组来研究计算机网络的标准。ISO制订了计算机网络体系结构的标准及国际标准化协议，于1984年ISO正式颁布了"开放系统互连参考模型（Open System Interconnection　B.sic Reference Model，OSI/RM）"，简称为OSI参考模型或OSI/RM。OSI参考模型将网络划分为七层，因此，也称为OSI七层模型。</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2be52fb9fc584ed1aae6852c44cfb7f8><p class=pgc-img-caption></p></div><p>标准化的最大好处是开放性，虽然开放，但各厂商必须按该标准来生产计算机的相关设备。用户在组装一台计算机时，不必局限于只购买一个公司的产品，而是可以自由地选购兼容产品。这样，标准化的制定与实施，不仅促进了企业的竞争，同时也大大加速了计算机网络的发展，计算机网络在各个领域的应用也越来越广泛，并为这些领域带来了巨大的工作效率和经济效益。</p><p>4.网络互连与高速网络时代</p><p>20世纪90年代以来，随着信息高速公路计划的提出与实施，Internet在地域、用户、功能和应用等方面不断拓展，极大地促进了计算机网络技术的迅猛发展。这个阶段的计算机网络，其主要特点是综合化和高速化。</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e2e301503b214a4bafcf2c7b6f7c510d><p class=pgc-img-caption></p></div><p>综合化是指采用交换的数据传送方式将多种业务综合到一个网络中完成，例如，它不但可以传输数据，还可以传输图像、声音、影像等多媒体信息，三网（电话网、有线电视网和数据网）融合甚至多网融合已成为一个重要的发展方向。</p><p>高速化是指传输数据的速率得到极大提高，早期的以太网其数据速率只有10Mbps。而目前，速度达100Mbps的以太网已相当普及，速度再提高十倍、达Gbps的产品也已面世。</p><p>二、计算机网络基础知识</p><p>"黑客"的目的是寻找目标漏洞，然后去发起攻击或者提出解决方案修补漏洞，而寻找漏洞的过程，你就需要掌握很多知识，例如计算机原理、计算机网络、操作系统、计算机软件、编程语言、数据结构、数据库技术、前沿技术等等，在这么多要学习的内容里，首先需要先学习"网络通信原理"，为什么？因为网络通信原理十分重要，根据他的原理可以判断出许多貌似正确的理论其实是有很多漏洞的通信过程，而很多黑客攻击就是利用了这些漏洞，很多网络安全解决方案也是用来解决这些漏洞问题的。</p><p>（一）、网络的由来？</p><p>互联网的本质就是一系列的网络协议。</p><p>一台硬设有了操作系统，然后装上软件你就可以正常使用了，每个人都拥有一台自己的机器，然而彼此孤立。</p><p>如何能让大家一起玩耍，就有了初步的网络，其实两台计算机之间通信与两个人打电话之间通信的原理是一样的，普通话属于中国国内人与人之间通信的标准，那如果是两个国家的人交流呢？问题是，你不可能要求一个人／计算机掌握全世界的语言／标准，于是有了世界统一的通信标准：英语</p><p>结论：英语成为世界上所有人通信的统一标准，如果把计算机看成分布于世界各地的人，那么连接两台计算机之间的internet实际上就是一系列统一的标准，这些标准称之为互联网协议，互联网的本质就是一系列的协议，总称为'互联网协议'（Internet Protocol Suite).</p><p>互联网协议的功能：定义计算机如何接入internet，以及接入internet的计算机通信的标准。</p><p>（二）、网络协议介绍</p><p>为了使不同计算机厂家生产的计算机能够相互通信，以便在更大的范围内建立计算机网络，国际标准化组织（ISO）在1978年提出了"开放系统互联参考模型"，即著名的OSI/RM模型（Open System Interconnection/Reference Model）。它将计算机网络体系结构的通信协议划分为七层，自下而上依次为：物理层（Physics Layer）、数据链路层（Data Link Layer）、网络层（Network Layer）、传输层（Transport Layer）、会话层（Session Layer）、表示层（Presentation Layer）、应用层（Application Layer）。其中第四层完成数据传送服务，上面三层面向用户。</p><p>互联网协议按照功能不同分为osi七层或tcp/ip五层</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/357ce57eddf94bfe8649a162963b62b2><p class=pgc-img-caption></p></div><p>每层运行常见物理设备</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2dd6c17f3159495883e1c0bc064b8d41><p class=pgc-img-caption></p></div><p>五层模型讲解</p><p>我们将应用层，表示层，会话层并作应用层，从tcp／ip五层协议的角度来阐述每层的由来与功能，搞清楚了每层的主要协议，就理解了整个互联网通信的原理。</p><p>首先，用户感知到的只是最上面一层应用层，自上而下每层都依赖于下一层，所以我们从最下一层开始切入，比较好理解每层都运行特定的协议，越往上越靠近用户，越往下越靠近硬件</p><p>1、物理层：上面提到，孤立的计算机之间要想一起玩，就必须接入internet，言外之意就是计算机之间必须完成组网</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5fd64d1b12e34568a9bf710b051b2e1f><p class=pgc-img-caption></p></div><p>物理层功能：主要是基于电器特性发送高低电压(电信号)，高电压对应数字1，低电压对应数字0</p><p>2、数据链路层：单纯的电信号0和1没有任何意义，必须规定电信号多少位一组，每组什么意思</p><p>数据链路层的功能：定义了电信号的分组方式</p><p><strong>以太网协议：</strong></p><p>早期的时候各个公司都有自己的分组方式，后来形成了统一的标准，即以太网协议ethernet</p><p>ethernet规定</p><p>一组电信号构成一个数据包，叫做'帧'</p><p>每一数据帧分成：报头head和数据data两部分</p><p>head包含：(固定18个字节)</p><p>发送者／源地址，6个字节</p><p>接收者／目标地址，6个字节</p><p>数据类型，6个字节</p><p>data包含：(最短46字节，最长1500字节)</p><p>数据包的具体内容</p><p>head长度＋data长度＝最短64字节，最长1518字节，超过最大限制就分片发送</p><p><strong>mac地址：</strong></p><p>head中包含的源和目标地址由来：ethernet规定接入internet的设备都必须具备网卡，发送端和接收端的地址便是指网卡的地址，即mac地址。</p><p>mac地址：每块网卡出厂时都被烧制上一个世界唯一的mac地址，长度为48位2进制，通常由12位16进制数表示（前六位是厂商编号，后六位是流水线号）</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/44a3c0c8e7244c0eb1d81f71c647dcd1><p class=pgc-img-caption></p></div><p>广播：</p><p>有了mac地址，同一网络内的两台主机就可以通信了（一台主机通过arp协议获取另外一台主机的mac地址）ethernet采用最原始的方式，广播的方式进行通信，即计算机通信基本靠吼</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/aef52cc03e1a418f92e63678b8df3eef><p class=pgc-img-caption></p></div><p>3、网络层：有了ethernet、mac地址、广播的发送方式，世界上的计算机就可以彼此通信了，问题是世界范围的互联网是由一个个彼此隔离的小的局域网组成的，那么如果所有的通信都采用以太网的广播方式，那么一台机器发送的包全世界都会收到，这就不仅仅是效率低的问题了，这会是一种灾难</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/554ef2beb217471c9f1162f96ba5047c><p class=pgc-img-caption></p></div><p>上图结论：必须找出一种方法来区分哪些计算机属于同一广播域，哪些不是，如果是就采用广播的方式发送，如果不是，就采用路由的方式（向不同广播域／子网分发数据包），mac地址是无法区分的，它只跟厂商有关。</p><p>网络层功能：引入一套新的地址用来区分不同的广播域／子网，这套地址即网络地址</p><p><strong>IP协议：</strong></p><p>规定网络地址的协议叫ip协议，它定义的地址称之为ip地址，广泛采用的v4版本即ipv4，它规定网络地址由32位2进制表示</p><p>范围0.0.0.0-255.255.255.255</p><p>一个ip地址通常写成四段十进制数，例：172.16.10.1</p><p>ip地址分成两部分</p><p>网络部分：标识子网</p><p>主机部分：标识主机</p><p>注意：单纯的ip地址段只是标识了ip地址的种类，从网络部分或主机部分都无法辨识一个ip所处的子网</p><p>例：172.16.10.1与172.16.10.2并不能确定二者处于同一子网</p><p><strong>子网掩码</strong></p><p>所谓"子网掩码"，就是表示子网络特征的一个参数。它在形式上等同于IP地址，也是一个32位二进制数字，它的网络部分全部为1，主机部分全部为0。比如，IP地址172.16.10.1，如果已知网络部分是前24位，主机部分是后8位，那么子网络掩码就是11111111.11111111.11111111.00000000，写成十进制就是255.255.255.0。</p><p>知道"子网掩码"，我们就能判断，任意两个IP地址是否处在同一个子网络。方法是将两个IP地址与子网掩码分别进行AND运算（两个数位都为1，运算结果为1，否则为0），然后比较结果是否相同，如果是的话，就表明它们在同一个子网络中，否则就不是。</p><p>比如，已知IP地址172.16.10.1和172.16.10.2的子网掩码都是255.255.255.0，请问它们是否在同一个子网络？两者与子网掩码分别进行AND运算，</p><p>172.16.10.1：10101100.00010000.00001010.000000001</p><p>255255.255.255.0:11111111.11111111.11111111.00000000</p><p>AND运算得网络地址结果：10101100.00010000.00001010.000000001->172.16.10.0</p><p>172.16.10.2：10101100.00010000.00001010.000000010</p><p>255255.255.255.0:11111111.11111111.11111111.00000000</p><p>AND运算得网络地址结果：10101100.00010000.00001010.000000001->172.16.10.0</p><p>结果都是172.16.10.0，因此它们在同一个子网络。</p><p>总结一下，IP协议的作用主要有两个，一个是为每一台计算机分配IP地址，另一个是确定哪些地址在同一个子网络。</p><p><strong>ip数据包</strong></p><p>ip数据包也分为head和data部分，无须为ip包定义单独的栏位，直接放入以太网包的data部分</p><p>head：长度为20到60字节</p><p>data：最长为65,515字节。</p><p>而以太网数据包的"数据"部分，最长只有1500字节。因此，如果IP数据包超过了1500字节，它就需要分割成几个以太网数据包，分开发送了。</p><p><strong>ARP协议</strong></p><p>arp协议由来：计算机通信基本靠吼，即广播的方式，所有上层的包到最后都要封装上以太网头，然后通过以太网协议发送，在谈及以太网协议时候，我门了解到通信是基于mac的广播方式实现，计算机在发包时，获取自身的mac是容易的，如何获取目标主机的mac，就需要通过arp协议</p><p>arp协议功能：广播的方式发送数据包，获取目标主机的mac地址</p><p>协议工作方式：每台主机ip都是已知的</p><p>例如：主机172.16.10.10/24访问172.16.10.11/24</p><p>3.1首先通过ip地址和子网掩码区分出自己所处的子网</p><p>3.2分析172.16.10.10/24与172.16.10.11/24处于同一网络(如果不是同一网络，那么下表中目标ip为172.16.10.1,通过arp获取的是网关的mac)</p><p>3.3这个包会以广播的方式在发送端所处的自网内传输，所有主机接收后拆开包，发现目标ip为自己的，就响应，返回自己的mac</p><p>4、传输层：网络层的ip帮我们区分子网，以太网层的mac帮我们找到主机，然后大家使用的都是应用程序，你的电脑上可能同时开启qq，暴风影音，等多个应用程序，那么我们通过ip和mac找到了一台特定的主机，如何标识这台主机上的应用程序，答案就是端口，端口即应用程序与网卡关联的编号。</p><p>传输层功能：建立端口到端口的通信</p><p>补充：端口范围0-65535，0-1023为系统占用端口</p><p>tcp协议：可靠传输，TCP数据包没有长度限制，理论上可以无限长，但是为了保证网络的效率，通常TCP数据包的长度不会超过IP数据包的长度，以确保单个TCP数据包不必再分割。</p><p>udp协议：</p><p>不可靠传输，"报头"部分一共只有8个字节，总长度不超过65,535字节，正好放进一个IP数据包。</p><p>tcp报文</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/26c0b94f2b3d4072ac6b776f150fefcc><p class=pgc-img-caption></p></div><p>tcp三次握手和四次挥手</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/698d9fedf0a5449d8e30aac2ac042f15><p class=pgc-img-caption></p></div><p>5、应用层：用户使用的都是应用程序，均工作于应用层，互联网是开发的，大家都可以开发自己的应用程序，数据多种多样，必须规定好数据的组织形式</p><p>应用层功能：规定应用程序的数据格式。</p><p>例：TCP协议可以为各种各样的程序传递数据，比如Email、WWW、FTP等等。那么，必须有不同协议规定电子邮件、网页、FTP数据的格式，这些应用程序协议就构成了"应用层"。</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8ba6ee22ca064554a6e76c2ee8027846><p class=pgc-img-caption></p></div><p>6、Socket：我们知道两个进程如果需要进行通讯最基本的一个前提能能够唯一的标示一个进程，在本地进程通讯中我们可以使用PID来唯一标示一个进程，但PID只在本地唯一，网络中的两个进程PID冲突机率很大，这时候我们需要另辟它径了，我们知道IP层的ip地址可以唯一标示主机，而TCP层协议和端口号可以唯一标示主机的一个进程，这样我们可以利用ip地址＋协议＋端口号唯一标示网络中的一个进程。</p><p>能够唯一标示网络中的进程后，它们就可以利用socket进行通信了，什么是socket呢？我们经常把socket翻译为套接字，socket是在应用层和传输层之间的一个抽象层，它把TCP/IP层复杂的操作抽象为几个简单的接口供应用层调用已实现进程在网络中通信。</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/a9cb1fc9ce714b74a12f2ceab0fe98d4><p class=pgc-img-caption></p></div><p>socket起源于UNIX，在Unix一切皆文件哲学的思想下，socket是一种"打开—读/写—关闭"模式的实现，服务器和客户端各自维护一个"文件"，在建立连接打开后，可以向自己文件写入内容供对方读取或者读取对方内容，通讯结束时关闭文件。</p><p>（三）、网络通信实现</p><p>每台主机实现网络通信的基本四要素：</p><p>本机的IP地址</p><p>子网掩码</p><p>网关的IP地址</p><p>DNS的IP地址</p><p>获取这四要素分两种方式：</p><p>1.静态获取</p><p>即手动配置</p><p>2.动态获取</p><p>通过dhcp获取</p><p>（1）最前面的"以太网标头"，设置发出方（本机）的MAC地址和接收方（DHCP服务器）的MAC地址。前者就是本机网卡的MAC地址，后者这时不知道，就填入一个广播地址：FF-FF-FF-FF-FF-FF。</p><p>（2）后面的"IP标头"，设置发出方的IP地址和接收方的IP地址。这时，对于这两者，本机都不知道。于是，发出方的IP地址就设为0.0.0.0，接收方的IP地址设为255.255.255.255。</p><p>（3）最后的"UDP标头"，设置发出方的端口和接收方的端口。这一部分是DHCP协议规定好的，发出方是68端口，接收方是67端口。</p><p>这个数据包构造完成后，就可以发出了。以太网是广播发送，同一个子网络的每台计算机都收到了这个包。因为接收方的MAC地址是FF-FF-FF-FF-FF-FF，看不出是发给谁的，所以每台收到这个包的计算机，还必须分析这个包的IP地址，才能确定是不是发给自己的。当看到发出方IP地址是0.0.0.0，接收方是255.255.255.255，于是DHCP服务器知道"这个包是发给我的"，而其他计算机就可以丢弃这个包。</p><p>接下来，DHCP服务器读出这个包的数据内容，分配好IP地址，发送回去一个"DHCP响应"数据包。这个响应包的结构也是类似的，以太网标头的MAC地址是双方的网卡地址，IP标头的IP地址是DHCP服务器的IP地址（发出方）和255.255.255.255（接收方），UDP标头的端口是67（发出方）和68（接收方），分配给请求端的IP地址和本网络的具体参数则包含在Data部分。</p><p>新加入的计算机收到这个响应包，于是就知道了自己的IP地址、子网掩码、网关地址、DNS服务器等等参数。</p><p>（四）、例举主机访问网站的网络通信过程</p><p>首先打开浏览器，在地址栏输入URL，回车，出现网站内容。这是我们几乎每天都在做的事，那这个过程中到底是什么原理呢？HTTP、TCP、DNS、IP这些耳熟能详的名词都在什么时候起着什么作用呢？在这里整体梳理一遍。</p><p>4.1整个过程基本分做下面几个部分：</p><p>1、域名解析成IP地址；</p><p>2、与目的主机进行TCP连接（三次握手）；</p><p>3、发送与收取数据；</p><p>4、与目的主机断开TCP连接（四次挥手）；</p><p>4.2下面分别进行详细说明。</p><p>4.2.1域名解析成IP地址</p><p>首先说什么是域名解析？</p><p>我们在浏览器地址栏中输入的都是类似"www.baidu.com"、"www.qq.com"等等容易记忆的英文域名，但这些字母你直接交给整个网络线路去寻找目的主机找得到吗？找不到，因为每个主机在网络中的位置都是以IP标识的，IP才是主机在网络中的位置，域名只是为了方便用户记忆而已，这就要求浏览器能够识别域名并且将其转化为对应的IP地址。</p><p>所以浏览器会有一个DNS缓存，其中记录了一些域名与IP的对应关系，供浏览器快速查找需要的IP。但是这个DNS缓存不可能存下所有的域名-IP地址，何况IP地址有时候还会变化，因此当在DNS缓存中没有找到的时候，就要先向DNS服务器请求域名解析，我们常听到的DNS服务器很大的作用就是进行域名解析。</p><p>值得一提的是，DNS域名解析时用的是UDP协议。</p><p>整个域名解析的过程如下：</p><p>1、浏览器向本机DNS模块发出DNS请求，DNS模块生成相关的DNS报文；</p><p>2、DNS模块将生成的DNS报文传递给传输层的UDP协议单元；</p><p>3、UDP协议单元将该数据封装成UDP数据报，传递给网络层的IP协议单元；</p><p>4、IP协议单元将该数据封装成IP数据包，其目的IP地址为DNS服务器的IP地址；</p><p>5、封装好的IP数据包将传递给数据链路层的协议单元进行发送；</p><p>6、发送时在ARP缓存中查询相关数据，如果没有，就发送ARP广播（包含待查询的IP地址，收到广播的主机检查自己的IP，符合条件的主机将含有自己MAC地址的ARP包发送给ARP广播的主机）请求，等待ARP回应；</p><p>7、得到ARP回应后，将IP地址与路由的下一跳MAC地址对应的信息写入ARP缓存表；</p><p>8、写入缓存后，以路由下一跳的地址填充目的MAC地址，以数据帧形式转发；</p><p>9、转发可能进行多次；</p><p>10、DNS请求到达DNS服务器的数据链路层协议单元；</p><p>11、DNS服务器的数据链路层协议单元解析数据帧，将内部的IP数据包传递给网络层IP协议单元；</p><p>12、DNS服务器的IP协议单元解析IP数据包，将内部的UDP数据报传递给传输层UDP协议单元；</p><p>13、DNS服务器的UDP协议单元解析收到的UDP数据报，将内部的DNS报文传递给DNS服务单元；</p><p>14、DNS服务单元将域名解析成对应IP地址，产生DNS回应报文；</p><p>15、DNS回应报文->UDP->IP->MAC->我的主机；</p><p>16、我的主机收到数据帧，将数据帧->IP->UDP->浏览器；</p><p>17、将域名解析结果以域名和IP地址对应的形式写入DNS缓存表。</p><p>其中提到了一个ARP的概念，类似于DNS将域名翻译成IP，ARP则是将IP翻译成MAC地址，我们知道了IP后，需要通过主机的MAC地址来更具体的找到主机。同样的也有一个ARP缓存，其中存储了一些IP与MAC地址的对应关系，如果缓存中找不到，就会进行广播来查找MAC地址，收到广播的主机会检查自己的IP是否是待查找的IP，是的话就返回自己的MAC地址。</p><p>如果做开发，往往还会接触到端口这个概念，那端口是什么呢？这里是指TCP/IP协议中的端口，端口号的范围从0到65535，比如用于浏览网页服务的80端口，用于FTP服务的21端口等等，都有一些固定的端口号，被占用后就不能被别的服务拿来传输数据了。</p><p>4.2.2与目的主机进行TCP连接（三次握手）</p><p>得到域名对应的IP地址后，也就表示可以将数据送达目的主机了，这时候才开始我们常说的三次握手建立连接。</p><p>HTTP的请求时使用TCP进行传输的，可以保证可靠传输，并且有序，而TCP是有连接的传输，也就是在传输数据之前，会建立我的主机与目的主机之间的连接，然后才能传输数据，传输完成后，还有断开连接。这也就是TCP的三次握手和四次挥手，大致过程如下图所示：</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a6cd5c06525949c68cf1591f3a2c3076><p class=pgc-img-caption></p></div><p>具体的三次握手建立连接的过程如下表述，其中数据包的传输过程类似上文请求DNS服务器时的过程，就简单的表示一下：</p><p>1、向目的主机发送TCP连接请求报文；</p><p>2、该TCP报文中SYN标志位设为1，表示连接请求；</p><p>3、该TCP报文通过IP（DNS）->MAC（ARP）->网关->目的主机；</p><p>4、目的主机收到数据帧，通过IP->TCP，TCP协议单元回应请求应答报文；</p><p>5、该报文中SYN和ACK标志设为1，表示连接请求应答；</p><p>6、该TCP报文通过IP（DNS）->MAC（ARP）->网关->我的主机；</p><p>7、我的主机收到数据帧，通过IP->TCP，TCP协议单元回应请求确认报文；</p><p>8、该TCP报文通过IP（DNS）->MAC（ARP）->网关->目的主机；</p><p>9、目的主机收到数据帧，通过IP->TCP，连接建立完成。</p><p>三次握手的过程就是一去一回一去，互相确认一下，就建立连接啦。这个过程中任何一个报文出错或者超时，都要进行重传。</p><p>4.2.3发送与收取数据</p><p>如上所说，只有建立连接后才能开始传输数据，数据其实有多种传输方式，比如分段啊分组啊分时啊等等。而一个数据包的传输过程如下所示，以HTTP的GET方法请求为例：</p><p>1、浏览器向域名发出GET方法报文；</p><p>2、该GET方法报文通过TCP->IP（DNS）->MAC（ARP）->网关->目的主机；</p><p>3、目的主机收到数据帧，通过IP->TCP->HTTP，HTTP协议单元会回应HTTP协议格式封装好的HTML形式数据；</p><p>4、该HTML数据通过TCP->IP（DNS）->MAC（ARP）->网关->我的主机；</p><p>5、我的主机收到数据帧，通过IP->TCP->HTTP->浏览器，浏览器以网页形式显示HTML内容。</p><p>其他的HTTP方法在传输数据时方法都类似，只是所携带的内容不同。</p><p>4.2.4与目的主机断开TCP连接（四次挥手）</p><p>数据传输完成后需要断开连接，与建立时不同，断开连接需要多一次，有四次挥手，至于为什么，看完过程我们再讲。</p><p>看图理解过程：</p><div class=pgc-img><img alt=电脑网络知识：三分钟了解计算机网络通信原理，成为黑客的必须课 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0e8e9e8f774a4c5c88ed33957668dda1><p class=pgc-img-caption></p></div><p>过程如下：</p><p>1、浏览器向目的主机发出TCP连接结束请求报文，此时进入FIN WAIT状态；</p><p>2、该报文FIN标志位设为1，表示结束请求；</p><p>3、TCP结束请求报文通过IP（DNS）->MAC（ARP）->网关->目的主机；</p><p>4、目的主机收到数据帧，通过IP->TCP，TCP协议单元回应结束应答报文；</p><p>5、当前只是进行回应，因为目的主机可能还有数据要传，并不急着断开连接；</p><p>6、该报文中ACK标志位设为1，表示收到结束请求；</p><p>7、目的数据发送完所有数据后，向我的主机发出TCP连接结束请求报文；</p><p>8、该报文FIN标志位设为1，表示结束请求；</p><p>9、TCP结束请求报文通过IP（DNS）->MAC（ARP）->网关->我的主机；</p><p>10、我的主机收到数据帧，通过IP->TCP，TCP协议单元回应结束应答报文，此时进入TIME WAIT状态，因为不相信网络是可靠的，如果目的主机没收到还可以重发；</p><p>11、该报文中的FIN标志位均设为1，表示结束应答；</p><p>12、该TCP回应报文通过IP（DNS）->MAC（ARP）->网关->目的主机；</p><p>13、目的主机关闭连接；</p><p>14、TIME WAIT等待结束后，没有收到回复，说明目的正常关闭了，我的主机也关闭连接。</p><p>这里的过程是以我的主机主动发起结束请求开始的，实际上也可以由目的主机主动发起，那么过程就会跟上面相反，但细节差不多。</p><p>FIN_WAIT状态是主动发起请求时等待确认信息，而TIME_WAIT状态是收到结束请求后发送确认信息后等待看是否需要重发。</p><p>现在来说说为什么断开连接时需要四次挥手呢？因为建立连接时目的主机可以直接发送SYN（同步）+ACK（应答）报文。而当断开时，目的主机收到FIN后可能还有数据要发，并不一定直接断开，所以先发送一次应答，告知我的主机收到了请求，等确认所有数据都发完了，再发送FIN，同时等待我的主机应答，这里的FIN和ACK就不能一起发送，所以需要四次。</p><p>4.2.5总结一下：</p><p>以上就是主机访问网站时的网络通信全过程，归纳起来就是：</p><p>首先要通过域名找到IP，如果缓存里没有就要请求DNS服务器；得到IP后开始于目的主机进行三次握手来建立TCP连接；连接建立后进行HTTP访问，传输并获取网页内容；传输完后与目的主机四次挥手来断开TCP连接。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'网络','电脑','知识'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>