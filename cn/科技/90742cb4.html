<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>IPv6学习笔记 | 极客快訊</title><meta property="og:title" content="IPv6学习笔记 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/5417460f423d4a179eb873b41760e881"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90742cb4.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90742cb4.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/90742cb4.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90742cb4.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90742cb4.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/90742cb4.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/90742cb4.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90742cb4.html><meta property="article:published_time" content="2020-10-29T21:09:08+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:08+08:00"><meta name=Keywords content><meta name=description content="IPv6学习笔记"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/90742cb4.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>IPv6学习笔记</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><div class=pgc-img><img alt=IPv6学习笔记 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5417460f423d4a179eb873b41760e881><p class=pgc-img-caption></p></div><h1><strong>IPv6协议</strong></h1><div class=pgc-img><img alt=IPv6学习笔记 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/85502fad168549a9849c5700b7455f4b><p class=pgc-img-caption></p></div><p>整体来看，IPv6协议相比IPv4, 格式上简洁很多：</p><ul><li>IPv6报文头部是定长（固定为40字节），IPv4报文头部是变长的。这个意味着，写代码处理IPv6数据报文的效率会提高很多：）；</li><li>IPv6中Hop Limit字段含义类似IPv4的TTL；</li><li>IPv6中的Traffic Class字段含义类似IPv4中的TOS（Type Of Service）；</li><li>IPv6的报文头部取消了校验和字段：取消这个字段也是对IPv4协议的一个改进。当IPv4报文在网路间传输，每经过一个路由器转发就是修改TTL字段，就需要重新计算校验和，而由于数据链路层L2和传输层L4的校验已经足够强壮，因此IPv6取消这个字段会提高路由器的转发效率。值得一提的是，在IPv6协议下，传输层L4协议UDP、TCP是强制需要进行校验和的（IPv4是可选的）；</li><li>IPv6报文头部中的Next Header字段表示“承载上一层的协议类型”或者“扩展头部类型”。</li></ul><h1><strong>IPv6的地址语法</strong></h1><div class=pgc-img><img alt=IPv6学习笔记 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/11553aa566aa4a528ff8d61b8da72a85><p class=pgc-img-caption></p></div><p>一个IPv6的地址使用冒号十六进制表示方法：128位的地址每16位分成一段，每个16位的段用十六进制表示并用冒号分隔开，例如一个普通公网IPv6地址：</p><p><em>2001:0D12:0000:0000:02AA:0987:FE29:9871</em></p><p>IPv6地址支持压缩前导零的表示方法，例如上面的地址可以压缩表示为：</p><p>2001:12:0:0:2AA:987:FE29:9871</p><p>为了进一步精简IPv6地址，当冒号十六进制格式中出现连续几段数值0的位段时，这些段可以压缩为双冒号的表示，例如上面的地址还可以进一步精简表示为：</p><p>2001:12::2AA:987:FE29:9871</p><p>又例如IPv6的地址FF80:0:0:0:FF:3BA:891:67C2可以进一步精简表示为：</p><p>FE80::FF:3BA:891:67C2</p><p>这里值得注意的是：双冒号只能出现一次。</p><h1>IPv6地址前缀表示法</h1><p>IPv6支持子网前缀标识方法，类似于IPv4的无分类域间路由CIDR机制（注意：IPv6没有子网掩码mask的概念）。</p><p>使用IPv6地址/前缀长度表示方法，例如：</p><p>2001:C3:0:2C6A::/64表示一个子网；</p><p>而2001:C3:0:2C6A:C9B4:FF12:48BC:1A22/64表示该子网下的一个节点地址。</p><h1><strong>IPv6寻址模式</strong></h1><ul><li><strong>单播</strong> : 跟ipv4单播一致，在单播寻址模式下，IPv6接口(host)在网段中唯一标识。 IPv6数据包包含源IP地址和目标IP地址。 主机接口配备有在该网络段中唯一的IP地址。</li><li><strong>多播</strong> : IPv6组播模式与IPv4相同。 目的地为多个主机的数据包在特殊的多播地址上发送。 所有对该组播信息感兴趣的主机需要首先加入该组播组。 加入组的所有接口接收组播数据包并对其进行处理，而对组播数据不感兴趣的其他主机则忽略组播信息。</li><li><strong>任播</strong> : IPv6引入了一种新型的寻址，称为Anycast寻址。 在此寻址模式下，多个接口(host)被分配相同的任播IP地址。 当主机希望与配备有任播IP地址的主机通信时，它发送单播消息。 在复杂的路由机制的帮助下，在路由成本方面，该单播消息被递送到最接近发送方的主机。</li></ul><p>IPv6没有广播地址，用组播地址实现广播的功能。</p><h1><strong>IPv6单播地址</strong></h1><ul><li><strong>全球单播地址：</strong>前缀2000::/3，相当于IPv4的公网地址。这种地址在全球的路由器间可以路由。</li><li><strong>链路本地地址：</strong>前缀FE80::/10Windows和Linux支持或开启IPv6后，默认会给网卡接口自动配置一个链路本地地址。也就是说，一个接口一定有一个链路本地地址。</li><li><strong>唯一本地地址前缀：</strong>FC00::/7前缀FC00::和 FD00::的IPV6地址，相当于IPv4的私网地址10.0.0.0、172.16.0.0、192.168.0.0。</li><li><strong>回环地址：</strong>::1等同于IPv4的127.0.0.1。</li></ul><h1><strong>面向IPv6的应用开发</strong></h1><p>Golang服务端</p><pre>package mainimport (	"fmt"	"net"	"net/http")func main() {	var err error	http.Handle("/", &amp;helloHandler{})	// 监听本地IPv4地址的8083端口	// err = http.ListenAndServe(":8083", nil)	// 监听指定IPv6地址的8083端口	// err = http.ListenAndServe("[2604:180:3:dd3::276e]:8083", nil)	// 同时监听本地IPv4和IPv6地址的8083端口	err = ListenAndServe(":8083", nil)	if err != nil { 		 fmt.Println(err)	}}</pre><p>Curl客户端</p><pre>curl "http://[2604:180:3:dd3::276e]:8083"curl -g -6 'http://[2604:180:3:dd3::276e]:8083/'</pre><p>Python UDP服务端:</p><pre>import socketUDP_IP = "::" # = IPv4 0.0.0.0UDP_PORT = 5005sock = socket.socket(socket.AF_INET6, # Internet						socket.SOCK_DGRAM) # UDPsock.bind((UDP_IP, UDP_PORT))while True:	data, addr = sock.recvfrom(1024) # buffer size is 1024 bytes	print "received message:", data</pre><p>Python UDP客户端:</p><pre>import socketUDP_IP = "::1" # localhostUDP_PORT = 5005MESSAGE = "Hello, World!"print "UDP target IP:", UDP_IPprint "UDP target port:", UDP_PORTprint "message:", MESSAGEsock = socket.socket(socket.AF_INET6, # Internet					socket.SOCK_DGRAM) # UDPsock.sendto(MESSAGE, (UDP_IP, UDP_PORT))</pre></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'IPv6','学习','笔记'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>