<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>æœåŠ¡ç½‘å…³ Spring Cloud GateWay å…¥é—¨ | æå®¢å¿«è¨Š</title><meta property="og:title" content="æœåŠ¡ç½‘å…³ Spring Cloud GateWay å…¥é—¨ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/6455cfdd4a584f14873f7de1bb2c0f13"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90f56cad.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90f56cad.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/90f56cad.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90f56cad.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90f56cad.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/90f56cad.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/90f56cad.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90f56cad.html><meta property="article:published_time" content="2020-11-14T21:03:15+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:15+08:00"><meta name=Keywords content><meta name=description content="æœåŠ¡ç½‘å…³ Spring Cloud GateWay å…¥é—¨"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/90f56cad.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>æœåŠ¡ç½‘å…³ Spring Cloud GateWay å…¥é—¨</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>Spring å®˜æ–¹æœ€ç»ˆè¿˜æ˜¯æŒ‰æºä¸ä½æ¨å‡ºäº†è‡ªå·±çš„ç½‘å…³ç»„ä»¶ï¼šSpring Cloud Gateway ï¼Œç›¸æ¯”ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨çš„ Zuulï¼ˆ1.xï¼‰ å®ƒæœ‰å“ªäº›ä¼˜åŠ¿å‘¢ï¼ŸZuulï¼ˆ1.xï¼‰ åŸºäº Servletï¼Œä½¿ç”¨é˜»å¡ APIï¼Œå®ƒä¸æ”¯æŒä»»ä½•é•¿è¿æ¥ï¼Œå¦‚ WebSocketsï¼ŒSpring Cloud Gateway ä½¿ç”¨éé˜»å¡ APIï¼Œæ”¯æŒ WebSocketsï¼Œæ”¯æŒé™æµç­‰æ–°ç‰¹æ€§ã€‚</p><h2 class=pgc-h-arrow-right>Spring Cloud Gateway</h2><p>Spring Cloud Gateway æ˜¯ Spring Cloud çš„ä¸€ä¸ªå…¨æ–°é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ˜¯åŸºäº Spring 5.0ï¼ŒSpring Boot 2.0 å’Œ Project Reactor ç­‰æŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼Œå®ƒæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€çš„ API è·¯ç”±ç®¡ç†æ–¹å¼ã€‚</p><p>Spring Cloud Gateway ä½œä¸º Spring Cloud ç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£ Netflix Zuulï¼Œå…¶ä¸ä»…æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ï¼Œå¹¶ä¸”åŸºäº Filter é“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå®‰å…¨ï¼Œç›‘æ§/æŒ‡æ ‡ï¼Œå’Œé™æµã€‚</p><p><strong>ç›¸å…³æ¦‚å¿µ:</strong></p><ul><li>Routeï¼ˆè·¯ç”±ï¼‰ï¼šè¿™æ˜¯ç½‘å…³çš„åŸºæœ¬æ„å»ºå—ã€‚å®ƒç”±ä¸€ä¸ª IDï¼Œä¸€ä¸ªç›®æ ‡ URIï¼Œä¸€ç»„æ–­è¨€å’Œä¸€ç»„è¿‡æ»¤å™¨å®šä¹‰ã€‚å¦‚æœæ–­è¨€ä¸ºçœŸï¼Œåˆ™è·¯ç”±åŒ¹é…ã€‚</li><li>Predicateï¼ˆæ–­è¨€ï¼‰ï¼šè¿™æ˜¯ä¸€ä¸ª Java 8 çš„ Predicateã€‚è¾“å…¥ç±»å‹æ˜¯ä¸€ä¸ª ServerWebExchangeã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥åŒ¹é…æ¥è‡ª HTTP è¯·æ±‚çš„ä»»ä½•å†…å®¹ï¼Œä¾‹å¦‚ headers æˆ–å‚æ•°ã€‚</li><li>Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ï¼šè¿™æ˜¯org.springframework.cloud.gateway.filter.GatewayFilterçš„å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä¿®æ”¹è¯·æ±‚å’Œå“åº”ã€‚</li></ul><p><strong>å·¥ä½œæµç¨‹ï¼š</strong></p><div class=pgc-img><img alt="æœåŠ¡ç½‘å…³ Spring Cloud GateWay å…¥é—¨" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6455cfdd4a584f14873f7de1bb2c0f13><p class=pgc-img-caption></p></div><p>å®¢æˆ·ç«¯å‘ Spring Cloud Gateway å‘å‡ºè¯·æ±‚ã€‚å¦‚æœ Gateway Handler Mapping ä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ° Gateway Web Handlerã€‚Handler å†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚ è¿‡æ»¤å™¨ä¹‹é—´ç”¨è™šçº¿åˆ†å¼€æ˜¯å› ä¸ºè¿‡æ»¤å™¨å¯èƒ½ä¼šåœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰ï¼ˆâ€œpreâ€ï¼‰æˆ–ä¹‹åï¼ˆâ€œpostâ€ï¼‰æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚</p><p>Spring Cloud Gateway çš„ç‰¹å¾ï¼š</p><ul><li>åŸºäº Spring Framework 5ï¼ŒProject Reactor å’Œ Spring Boot 2.0</li><li>åŠ¨æ€è·¯ç”±</li><li>Predicates å’Œ Filters ä½œç”¨äºç‰¹å®šè·¯ç”±</li><li>é›†æˆ Hystrix æ–­è·¯å™¨</li><li>é›†æˆ Spring Cloud DiscoveryClient</li><li>æ˜“äºç¼–å†™çš„ Predicates å’Œ Filters</li><li>é™æµ</li><li>è·¯å¾„é‡å†™</li></ul><h2 class=pgc-h-arrow-right>å¿«é€Ÿä¸Šæ‰‹</h2><p>Spring Cloud Gateway ç½‘å…³è·¯ç”±æœ‰ä¸¤ç§é…ç½®æ–¹å¼ï¼š</p><ul><li>åœ¨é…ç½®æ–‡ä»¶ yml ä¸­é…ç½®</li><li>é€šè¿‡@Beanè‡ªå®šä¹‰ RouteLocatorï¼Œåœ¨å¯åŠ¨ä¸»ç±» Application ä¸­é…ç½®</li></ul><p>è¿™ä¸¤ç§æ–¹å¼æ˜¯ç­‰ä»·çš„ï¼Œå»ºè®®ä½¿ç”¨ yml æ–¹å¼è¿›é…ç½®ã€‚</p><p>ä½¿ç”¨ Spring Cloud Finchley ç‰ˆæœ¬ï¼ŒFinchley ç‰ˆæœ¬ä¾èµ–äº Spring Boot 2.0.6.RELEASEã€‚</p><pre>&lt;parent&gt;	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;	&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;	&lt;version&gt;2.0.6.RELEASE&lt;/version&gt;	&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;&lt;/parent&gt;&lt;dependencyManagement&gt;	&lt;dependencies&gt;		&lt;dependency&gt;			&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;			&lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;			&lt;version&gt;Finchley.SR2&lt;/version&gt;			&lt;type&gt;pom&lt;/type&gt;			&lt;scope&gt;import&lt;/scope&gt;		&lt;/dependency&gt;	&lt;/dependencies&gt;&lt;/dependencyManagement&gt;</pre><blockquote><p>ç»æµ‹è¯• Finchley.RELEASE æœ‰ bug å¤šæ¬¡è¯·æ±‚ä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ŒSR2 æ˜¯ Spring Cloud çš„æœ€æ–°ç‰ˆæœ¬ã€‚</p></blockquote><p>æ·»åŠ é¡¹ç›®éœ€è¦ä½¿ç”¨çš„ä¾èµ–åŒ…</p><pre>&lt;dependency&gt;	&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;	&lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;&lt;/dependency&gt;</pre><p>Spring Cloud Gateway æ˜¯ä½¿ç”¨ netty+webflux å®ç°å› æ­¤ä¸éœ€è¦å†å¼•å…¥ web æ¨¡å—ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥æµ‹è¯•ä¸€ä¸ªæœ€ç®€å•çš„è¯·æ±‚è½¬å‘ã€‚</p><pre>server:  port: 8080spring:  cloud:    gateway:      routes:      - id: neo_route        uri: http://www.ityouknow.com        predicates:        - Path=/spring-cloud</pre><p>å„å­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li>idï¼šæˆ‘ä»¬è‡ªå®šä¹‰çš„è·¯ç”± IDï¼Œä¿æŒå”¯ä¸€</li><li>uriï¼šç›®æ ‡æœåŠ¡åœ°å€</li><li>predicatesï¼šè·¯ç”±æ¡ä»¶ï¼ŒPredicate æ¥å—ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ç»“æœã€‚è¯¥æ¥å£åŒ…å«å¤šç§é»˜è®¤æ–¹æ³•æ¥å°† Predicate ç»„åˆæˆå…¶ä»–å¤æ‚çš„é€»è¾‘ï¼ˆæ¯”å¦‚ï¼šä¸ï¼Œæˆ–ï¼Œéï¼‰ã€‚</li><li>filtersï¼šè¿‡æ»¤è§„åˆ™ï¼Œæœ¬ç¤ºä¾‹æš‚æ—¶æ²¡ç”¨ã€‚</li></ul><p>ä¸Šé¢è¿™æ®µé…ç½®çš„æ„æ€æ˜¯ï¼Œé…ç½®äº†ä¸€ä¸ª id ä¸º neo_route çš„è·¯ç”±è§„åˆ™ï¼Œå½“è®¿é—®åœ°å€ http://localhost:8080/spring-cloudæ—¶ä¼šè‡ªåŠ¨è½¬å‘åˆ°åœ°å€ï¼šhttp://www.ityouknow.com/spring-cloudã€‚é…ç½®å®Œæˆå¯åŠ¨é¡¹ç›®å³å¯åœ¨æµè§ˆå™¨è®¿é—®è¿›è¡Œæµ‹è¯•ï¼Œå½“æˆ‘ä»¬è®¿é—®åœ°å€http://localhost:8080/spring-cloud æ—¶ä¼šå±•ç¤ºé¡µé¢å±•ç¤ºå¦‚ä¸‹ï¼š</p><div class=pgc-img><img alt="æœåŠ¡ç½‘å…³ Spring Cloud GateWay å…¥é—¨" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5490aa11595d426f847c63d62efa3f5b><p class=pgc-img-caption></p></div><p>è¯æ˜é¡µé¢è½¬å‘æˆåŠŸã€‚</p><p>è½¬å‘åŠŸèƒ½åŒæ ·å¯ä»¥é€šè¿‡ä»£ç æ¥å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨ç±» GateWayApplication ä¸­æ·»åŠ æ–¹æ³• customRouteLocator() æ¥å®šåˆ¶è½¬å‘è§„åˆ™ã€‚</p><pre>@SpringBootApplicationpublic class GateWayApplication {	public static void main(String[] args) {		SpringApplication.run(GateWayApplication.class, args);	}	@Bean	public RouteLocator customRouteLocator(RouteLocatorBuilder builder) {		return builder.routes()				.route("path_route", r -&gt; r.path("/about")						.uri("http://ityouknow.com"))				.build();	}}</pre><p>ä¸Šé¢é…ç½®äº†ä¸€ä¸ª id ä¸º path_route çš„è·¯ç”±ï¼Œå½“è®¿é—®åœ°å€http://localhost:8080/aboutæ—¶ä¼šè‡ªåŠ¨è½¬å‘åˆ°åœ°å€ï¼šhttp://www.ityouknow.com/aboutå’Œä¸Šé¢çš„è½¬å‘æ•ˆæœä¸€æ ·ï¼Œåªæ˜¯è¿™é‡Œè½¬å‘çš„æ˜¯ä»¥é¡¹ç›®åœ°å€/aboutæ ¼å¼çš„è¯·æ±‚åœ°å€ã€‚</p><p>ä¸Šé¢ä¸¤ä¸ªç¤ºä¾‹ä¸­ uri éƒ½æ˜¯æŒ‡å‘äº†æˆ‘çš„ä¸ªäººç½‘ç«™ï¼Œåœ¨å®é™…é¡¹ç›®ä½¿ç”¨ä¸­å¯ä»¥å°† uri æŒ‡å‘å¯¹å¤–æä¾›æœåŠ¡çš„é¡¹ç›®åœ°å€ï¼Œç»Ÿä¸€å¯¹å¤–è¾“å‡ºæ¥å£ã€‚</p><p>ä»¥ä¸Šä¾¿æ˜¯ Spring Cloud Gateway æœ€ç®€å•çš„ä¸¤ä¸ªè¯·æ±‚ç¤ºä¾‹ï¼ŒSpring Cloud Gateway è¿˜æœ‰æ›´å¤šå®ç”¨çš„åŠŸèƒ½æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€ä¸€ä»‹ç»ã€‚</p><h2 class=pgc-h-arrow-right>è·¯ç”±è§„åˆ™</h2><p>Spring Cloud Gateway çš„åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œæˆ‘ä»¬ä»…ä»…é€šè¿‡ Predicates çš„è®¾è®¡å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œå‰é¢æˆ‘ä»¬åªæ˜¯ä½¿ç”¨äº† predicates è¿›è¡Œäº†ç®€å•çš„æ¡ä»¶åŒ¹é…ï¼Œå…¶å® Spring Cloud Gataway å¸®æˆ‘ä»¬å†…ç½®äº†å¾ˆå¤š Predicates åŠŸèƒ½ã€‚</p><p>Spring Cloud Gateway æ˜¯é€šè¿‡ Spring WebFlux çš„ HandlerMapping åšä¸ºåº•å±‚æ”¯æŒæ¥åŒ¹é…åˆ°è½¬å‘è·¯ç”±ï¼ŒSpring Cloud Gateway å†…ç½®äº†å¾ˆå¤š Predicates å·¥å‚ï¼Œè¿™äº› Predicates å·¥å‚é€šè¿‡ä¸åŒçš„ HTTP è¯·æ±‚å‚æ•°æ¥åŒ¹é…ï¼Œå¤šä¸ª Predicates å·¥å‚å¯ä»¥ç»„åˆä½¿ç”¨ã€‚</p><h3 class=pgc-h-arrow-right>Predicate ä»‹ç»</h3><p>Predicate æ¥æºäº Java 8ï¼Œæ˜¯ Java 8 ä¸­å¼•å…¥çš„ä¸€ä¸ªå‡½æ•°ï¼ŒPredicate æ¥å—ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ç»“æœã€‚è¯¥æ¥å£åŒ…å«å¤šç§é»˜è®¤æ–¹æ³•æ¥å°† Predicate ç»„åˆæˆå…¶ä»–å¤æ‚çš„é€»è¾‘ï¼ˆæ¯”å¦‚ï¼šä¸ï¼Œæˆ–ï¼Œéï¼‰ã€‚å¯ä»¥ç”¨äºæ¥å£è¯·æ±‚å‚æ•°æ ¡éªŒã€åˆ¤æ–­æ–°è€æ•°æ®æ˜¯å¦æœ‰å˜åŒ–éœ€è¦è¿›è¡Œæ›´æ–°æ“ä½œã€‚</p><p>åœ¨ Spring Cloud Gateway ä¸­ Spring åˆ©ç”¨ Predicate çš„ç‰¹æ€§å®ç°äº†å„ç§è·¯ç”±åŒ¹é…è§„åˆ™ï¼Œæœ‰é€šè¿‡ Headerã€è¯·æ±‚å‚æ•°ç­‰ä¸åŒçš„æ¡ä»¶æ¥è¿›è¡Œä½œä¸ºæ¡ä»¶åŒ¹é…åˆ°å¯¹åº”çš„è·¯ç”±ã€‚ç½‘ä¸Šæœ‰ä¸€å¼ å›¾æ€»ç»“äº† Spring Cloud å†…ç½®çš„å‡ ç§ Predicate çš„å®ç°ã€‚</p><div class=pgc-img><img alt="æœåŠ¡ç½‘å…³ Spring Cloud GateWay å…¥é—¨" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3f4c2a2beb5e4e3388c6e66f1a5a089e><p class=pgc-img-caption></p></div><p>è¯´ç™½äº† Predicate å°±æ˜¯ä¸ºäº†å®ç°ä¸€ç»„åŒ¹é…è§„åˆ™ï¼Œæ–¹ä¾¿è®©è¯·æ±‚è¿‡æ¥æ‰¾åˆ°å¯¹åº”çš„ Route è¿›è¡Œå¤„ç†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä¸‹ Spring Cloud GateWay å†…ç½®å‡ ç§ Predicate çš„ä½¿ç”¨ã€‚</p><h3 class=pgc-h-arrow-right>é€šè¿‡æ—¶é—´åŒ¹é…</h3><p>Predicate æ”¯æŒè®¾ç½®ä¸€ä¸ªæ—¶é—´ï¼Œåœ¨è¯·æ±‚è¿›è¡Œè½¬å‘çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡åˆ¤æ–­åœ¨è¿™ä¸ªæ—¶é—´ä¹‹å‰æˆ–è€…ä¹‹åè¿›è¡Œè½¬å‘ã€‚æ¯”å¦‚æˆ‘ä»¬ç°åœ¨è®¾ç½®åªæœ‰åœ¨2019å¹´1æœˆ1æ—¥æ‰ä¼šè½¬å‘åˆ°æˆ‘çš„ç½‘ç«™ï¼Œåœ¨è¿™ä¹‹å‰ä¸è¿›è¡Œè½¬å‘ï¼Œæˆ‘å°±å¯ä»¥è¿™æ ·é…ç½®ï¼š</p><pre>spring:  cloud:    gateway:      routes:       - id: time_route        uri: http://ityouknow.com        predicates:         - After=2018-01-20T06:06:06+08:00[Asia/Shanghai]</pre><p>Spring æ˜¯é€šè¿‡ ZonedDateTime æ¥å¯¹æ—¶é—´è¿›è¡Œçš„å¯¹æ¯”ï¼ŒZonedDateTime æ˜¯ Java 8 ä¸­æ—¥æœŸæ—¶é—´åŠŸèƒ½é‡Œï¼Œç”¨äºè¡¨ç¤ºå¸¦æ—¶åŒºçš„æ—¥æœŸä¸æ—¶é—´ä¿¡æ¯çš„ç±»ï¼ŒZonedDateTime æ”¯æŒé€šè¿‡æ—¶åŒºæ¥è®¾ç½®æ—¶é—´ï¼Œä¸­å›½çš„æ—¶åŒºæ˜¯ï¼šAsia/Shanghaiã€‚</p><p>After Route Predicate æ˜¯æŒ‡åœ¨è¿™ä¸ªæ—¶é—´ä¹‹åçš„è¯·æ±‚éƒ½è½¬å‘åˆ°ç›®æ ‡åœ°å€ã€‚ä¸Šé¢çš„ç¤ºä¾‹æ˜¯æŒ‡ï¼Œè¯·æ±‚æ—¶é—´åœ¨ 2018å¹´1æœˆ20æ—¥6ç‚¹6åˆ†6ç§’ä¹‹åçš„æ‰€æœ‰è¯·æ±‚éƒ½è½¬å‘åˆ°åœ°å€http://ityouknow.comã€‚+08:00æ˜¯æŒ‡æ—¶é—´å’ŒUTCæ—¶é—´ç›¸å·®å…«ä¸ªå°æ—¶ï¼Œæ—¶é—´åœ°åŒºä¸ºAsia/Shanghaiã€‚</p><p>æ·»åŠ å®Œè·¯ç”±è§„åˆ™ä¹‹åï¼Œè®¿é—®åœ°å€http://localhost:8080ä¼šè‡ªåŠ¨è½¬å‘åˆ°http://ityouknow.comã€‚</p><p>Before Route Predicate åˆšå¥½ç›¸åï¼Œåœ¨æŸä¸ªæ—¶é—´ä¹‹å‰çš„è¯·æ±‚çš„è¯·æ±‚éƒ½è¿›è¡Œè½¬å‘ã€‚æˆ‘ä»¬æŠŠä¸Šé¢è·¯ç”±è§„åˆ™ä¸­çš„ After æ”¹ä¸º Beforeï¼Œå¦‚ä¸‹ï¼š</p><pre>spring:  cloud:    gateway:      routes:       - id: after_route        uri: http://ityouknow.com        predicates:         - Before=2018-01-20T06:06:06+08:00[Asia/Shanghai]</pre><p>å°±è¡¨ç¤ºåœ¨è¿™ä¸ªæ—¶é—´ä¹‹å‰å¯ä»¥è¿›è¡Œè·¯ç”±ï¼Œåœ¨è¿™æ—¶é—´ä¹‹ååœæ­¢è·¯ç”±ï¼Œä¿®æ”¹å®Œä¹‹åé‡å¯é¡¹ç›®å†æ¬¡è®¿é—®åœ°å€http://localhost:8080ï¼Œé¡µé¢ä¼šæŠ¥ 404 æ²¡æœ‰æ‰¾åˆ°åœ°å€ã€‚</p><p>é™¤è¿‡åœ¨æ—¶é—´ä¹‹å‰æˆ–è€…ä¹‹åå¤–ï¼ŒGateway è¿˜æ”¯æŒé™åˆ¶è·¯ç”±è¯·æ±‚åœ¨æŸä¸€ä¸ªæ—¶é—´æ®µèŒƒå›´å†…ï¼Œå¯ä»¥ä½¿ç”¨ Between Route Predicate æ¥å®ç°ã€‚</p><pre>spring:  cloud:    gateway:      routes:       - id: after_route        uri: http://ityouknow.com        predicates:         - Between=2018-01-20T06:06:06+08:00[Asia/Shanghai], 2019-01-20T06:06:06+08:00[Asia/Shanghai]</pre><p>è¿™æ ·è®¾ç½®å°±æ„å‘³ç€åœ¨è¿™ä¸ªæ—¶é—´æ®µå†…å¯ä»¥åŒ¹é…åˆ°æ­¤è·¯ç”±ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´æ®µèŒƒå›´åˆ™ä¸ä¼šè¿›è¡ŒåŒ¹é…ã€‚é€šè¿‡æ—¶é—´åŒ¹é…è·¯ç”±çš„åŠŸèƒ½å¾ˆé…·ï¼Œå¯ä»¥ç”¨åœ¨é™æ—¶æŠ¢è´­çš„ä¸€äº›åœºæ™¯ä¸­ã€‚</p><h3 class=pgc-h-arrow-right>é€šè¿‡ Cookie åŒ¹é…</h3><p>Cookie Route Predicate å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ Cookie name ,ä¸€ä¸ªæ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œè·¯ç”±è§„åˆ™ä¼šé€šè¿‡è·å–å¯¹åº”çš„ Cookie name å€¼å’Œæ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ä¸Šå°±ä¼šæ‰§è¡Œè·¯ç”±ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ä¸Šåˆ™ä¸æ‰§è¡Œã€‚</p><pre>spring:  cloud:    gateway:      routes:       - id: cookie_route         uri: http://ityouknow.com         predicates:         - Cookie=ityouknow, kee.e</pre><p>ä½¿ç”¨ curl æµ‹è¯•ï¼Œå‘½ä»¤è¡Œè¾“å…¥:</p><pre>curl http://localhost:8080 --cookie "ityouknow=kee.e"</pre><p>åˆ™ä¼šè¿”å›é¡µé¢ä»£ç ï¼Œå¦‚æœå»æ‰--cookie "ityouknow=kee.e"ï¼Œåå°æ±‡æŠ¥ 404 é”™è¯¯ã€‚</p><h3 class=pgc-h-arrow-right>é€šè¿‡ Header å±æ€§åŒ¹é…</h3><p>Header Route Predicate å’Œ Cookie Route Predicate ä¸€æ ·ï¼Œä¹Ÿæ˜¯æ¥æ”¶ 2 ä¸ªå‚æ•°ï¼Œä¸€ä¸ª header ä¸­å±æ€§åç§°å’Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿™ä¸ªå±æ€§å€¼å’Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ™æ‰§è¡Œã€‚</p><pre>spring:  cloud:    gateway:      routes:      - id: header_route        uri: http://ityouknow.com        predicates:        - Header=X-Request-Id, \d+</pre><p>ä½¿ç”¨ curl æµ‹è¯•ï¼Œå‘½ä»¤è¡Œè¾“å…¥:</p><pre>curl http://localhost:8080  -H "X-Request-Id:666666" </pre><p>åˆ™è¿”å›é¡µé¢ä»£ç è¯æ˜åŒ¹é…æˆåŠŸã€‚å°†å‚æ•°-H "X-Request-Id:666666"æ”¹ä¸º-H "X-Request-Id:neo"å†æ¬¡æ‰§è¡Œæ—¶è¿”å›404è¯æ˜æ²¡æœ‰åŒ¹é…ã€‚</p><h3 class=pgc-h-arrow-right>é€šè¿‡ Host åŒ¹é…</h3><p>Host Route Predicate æ¥æ”¶ä¸€ç»„å‚æ•°ï¼Œä¸€ç»„åŒ¹é…çš„åŸŸååˆ—è¡¨ï¼Œè¿™ä¸ªæ¨¡æ¿æ˜¯ä¸€ä¸ª ant åˆ†éš”çš„æ¨¡æ¿ï¼Œç”¨.å·ä½œä¸ºåˆ†éš”ç¬¦ã€‚å®ƒé€šè¿‡å‚æ•°ä¸­çš„ä¸»æœºåœ°å€ä½œä¸ºåŒ¹é…è§„åˆ™ã€‚</p><pre>spring:  cloud:    gateway:      routes:      - id: host_route        uri: http://ityouknow.com        predicates:        - Host=**.ityouknow.com</pre><p>ä½¿ç”¨ curl æµ‹è¯•ï¼Œå‘½ä»¤è¡Œè¾“å…¥:</p><pre>curl http://localhost:8080  -H "Host: www.ityouknow.com" curl http://localhost:8080  -H "Host: md.ityouknow.com" </pre><p>ç»æµ‹è¯•ä»¥ä¸Šä¸¤ç§ host å‡å¯åŒ¹é…åˆ° host_route è·¯ç”±ï¼Œå»æ‰ host å‚æ•°åˆ™ä¼šæŠ¥ 404 é”™è¯¯ã€‚</p><h3 class=pgc-h-arrow-right>é€šè¿‡è¯·æ±‚æ–¹å¼åŒ¹é…</h3><p>å¯ä»¥é€šè¿‡æ˜¯ POSTã€GETã€PUTã€DELETE ç­‰ä¸åŒçš„è¯·æ±‚æ–¹å¼æ¥è¿›è¡Œè·¯ç”±ã€‚</p><pre>spring:  cloud:    gateway:      routes:      - id: method_route        uri: http://ityouknow.com        predicates:        - Method=GET</pre><p>ä½¿ç”¨ curl æµ‹è¯•ï¼Œå‘½ä»¤è¡Œè¾“å…¥:</p><pre># curl é»˜è®¤æ˜¯ä»¥ GET çš„æ–¹å¼å»è¯·æ±‚curl http://localhost:8080</pre><p>æµ‹è¯•è¿”å›é¡µé¢ä»£ç ï¼Œè¯æ˜åŒ¹é…åˆ°è·¯ç”±ï¼Œæˆ‘ä»¬å†ä»¥ POST çš„æ–¹å¼è¯·æ±‚æµ‹è¯•ã€‚</p><pre># curl é»˜è®¤æ˜¯ä»¥ GET çš„æ–¹å¼å»è¯·æ±‚curl -X POST http://localhost:8080</pre><p>è¿”å› 404 æ²¡æœ‰æ‰¾åˆ°ï¼Œè¯æ˜æ²¡æœ‰åŒ¹é…ä¸Šè·¯ç”±</p><h3 class=pgc-h-arrow-right>é€šè¿‡è¯·æ±‚è·¯å¾„åŒ¹é…</h3><p>Path Route Predicate æ¥æ”¶ä¸€ä¸ªåŒ¹é…è·¯å¾„çš„å‚æ•°æ¥åˆ¤æ–­æ˜¯å¦èµ°è·¯ç”±ã€‚</p><pre>spring:  cloud:    gateway:      routes:      - id: host_route        uri: http://ityouknow.com        predicates:        - Path=/foo/{segment}</pre><p>å¦‚æœè¯·æ±‚è·¯å¾„ç¬¦åˆè¦æ±‚ï¼Œåˆ™æ­¤è·¯ç”±å°†åŒ¹é…ï¼Œä¾‹å¦‚ï¼š/foo/1 æˆ–è€… /foo/barã€‚</p><p>ä½¿ç”¨ curl æµ‹è¯•ï¼Œå‘½ä»¤è¡Œè¾“å…¥:</p><pre>curl http://localhost:8080/foo/1curl http://localhost:8080/foo/xxcurl http://localhost:8080/boo/xx</pre><p>ç»è¿‡æµ‹è¯•ç¬¬ä¸€å’Œç¬¬äºŒæ¡å‘½ä»¤å¯ä»¥æ­£å¸¸è·å–åˆ°é¡µé¢è¿”å›å€¼ï¼Œæœ€åä¸€ä¸ªå‘½ä»¤æŠ¥404ï¼Œè¯æ˜è·¯ç”±æ˜¯é€šè¿‡æŒ‡å®šè·¯ç”±æ¥åŒ¹é…ã€‚</p><h3 class=pgc-h-arrow-right>é€šè¿‡è¯·æ±‚å‚æ•°åŒ¹é…</h3><p>Query Route Predicate æ”¯æŒä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å±æ€§åä¸€ä¸ªä¸ºå±æ€§å€¼ï¼Œå±æ€§å€¼å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><pre>spring:  cloud:    gateway:      routes:      - id: query_route        uri: http://ityouknow.com        predicates:        - Query=smile</pre><p>è¿™æ ·é…ç½®ï¼Œåªè¦è¯·æ±‚ä¸­åŒ…å« smile å±æ€§çš„å‚æ•°å³å¯åŒ¹é…è·¯ç”±ã€‚</p><p>ä½¿ç”¨ curl æµ‹è¯•ï¼Œå‘½ä»¤è¡Œè¾“å…¥:</p><pre>curl localhost:8080?smile=x&amp;id=2</pre><p>ç»è¿‡æµ‹è¯•å‘ç°åªè¦è¯·æ±‚æ±‡æ€»å¸¦æœ‰ smile å‚æ•°å³ä¼šåŒ¹é…è·¯ç”±ï¼Œä¸å¸¦ smile å‚æ•°åˆ™ä¸ä¼šåŒ¹é…ã€‚</p><p>è¿˜å¯ä»¥å°† Query çš„å€¼ä»¥é”®å€¼å¯¹çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œè¿™æ ·åœ¨è¯·æ±‚è¿‡æ¥æ—¶ä¼šå¯¹å±æ€§å€¼å’Œæ­£åˆ™è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…ä¸Šæ‰ä¼šèµ°è·¯ç”±ã€‚</p><pre>spring:  cloud:    gateway:      routes:      - id: query_route        uri: http://ityouknow.com        predicates:        - Query=keep, pu.</pre><p>è¿™æ ·åªè¦å½“è¯·æ±‚ä¸­åŒ…å« keep å±æ€§å¹¶ä¸”å‚æ•°å€¼æ˜¯ä»¥ pu å¼€å¤´çš„é•¿åº¦ä¸ºä¸‰ä½çš„å­—ç¬¦ä¸²æ‰ä¼šè¿›è¡ŒåŒ¹é…å’Œè·¯ç”±ã€‚</p><p>ä½¿ç”¨ curl æµ‹è¯•ï¼Œå‘½ä»¤è¡Œè¾“å…¥:</p><pre>curl localhost:8080?keep=pub</pre><p>æµ‹è¯•å¯ä»¥è¿”å›é¡µé¢ä»£ç ï¼Œå°† keep çš„å±æ€§å€¼æ”¹ä¸º pubx å†æ¬¡è®¿é—®å°±ä¼šæŠ¥ 404,è¯æ˜è·¯ç”±éœ€è¦åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼æ‰ä¼šè¿›è¡Œè·¯ç”±ã€‚</p><h3 class=pgc-h-arrow-right>é€šè¿‡è¯·æ±‚ ip åœ°å€è¿›è¡ŒåŒ¹é…</h3><p>Predicate ä¹Ÿæ”¯æŒé€šè¿‡è®¾ç½®æŸä¸ª ip åŒºé—´å·æ®µçš„è¯·æ±‚æ‰ä¼šè·¯ç”±ï¼ŒRemoteAddr Route Predicate æ¥å— cidr ç¬¦å·(IPv4 æˆ– IPv6 )å­—ç¬¦ä¸²çš„åˆ—è¡¨(æœ€å°å¤§å°ä¸º1)ï¼Œä¾‹å¦‚ 192.168.0.1/16 (å…¶ä¸­ 192.168.0.1 æ˜¯ IP åœ°å€ï¼Œ16 æ˜¯å­ç½‘æ©ç )ã€‚</p><pre>spring:  cloud:    gateway:      routes:      - id: remoteaddr_route        uri: http://ityouknow.com        predicates:        - RemoteAddr=192.168.1.1/24</pre><p>å¯ä»¥å°†æ­¤åœ°å€è®¾ç½®ä¸ºæœ¬æœºçš„ ip åœ°å€è¿›è¡Œæµ‹è¯•ã€‚</p><pre>curl localhost:8080</pre><p>æœè¯·æ±‚çš„è¿œç¨‹åœ°å€æ˜¯ 192.168.1.10ï¼Œåˆ™æ­¤è·¯ç”±å°†åŒ¹é…ã€‚</p><h3 class=pgc-h-arrow-right>ç»„åˆä½¿ç”¨</h3><p>ä¸Šé¢ä¸ºäº†æ¼”ç¤ºå„ä¸ª Predicate çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬æ˜¯å•ä¸ªå•ä¸ªè¿›è¡Œé…ç½®æµ‹è¯•ï¼Œå…¶å®å¯ä»¥å°†å„ç§ Predicate ç»„åˆèµ·æ¥ä¸€èµ·ä½¿ç”¨ã€‚</p><p>ä¾‹å¦‚ï¼š</p><pre>spring:  cloud:    gateway:      routes:       - id: host_foo_path_headers_to_httpbin        uri: http://ityouknow.com        predicates:        - Host=**.foo.org        - Path=/headers        - Method=GET        - Header=X-Request-Id, \d+        - Query=foo, ba.        - Query=baz        - Cookie=chocolate, ch.p        - After=2018-01-20T06:06:06+08:00[Asia/Shanghai]</pre><p>å„ç§ Predicates åŒæ—¶å­˜åœ¨äºåŒä¸€ä¸ªè·¯ç”±æ—¶ï¼Œè¯·æ±‚å¿…é¡»åŒæ—¶æ»¡è¶³æ‰€æœ‰çš„æ¡ä»¶æ‰è¢«è¿™ä¸ªè·¯ç”±åŒ¹é…ã€‚</p><blockquote><p>ä¸€ä¸ªè¯·æ±‚æ»¡è¶³å¤šä¸ªè·¯ç”±çš„è°“è¯æ¡ä»¶æ—¶ï¼Œè¯·æ±‚åªä¼šè¢«é¦–ä¸ªæˆåŠŸåŒ¹é…çš„è·¯ç”±è½¬å‘</p></blockquote><h2 class=pgc-h-arrow-right>æ€»ç»“</h2><p>é€šè¿‡ä»Šå¤©çš„å­¦ä¹ å‘ç° Spring Cloud Gateway ä½¿ç”¨éå¸¸çš„çµæ´»ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„æƒ…å†µæ¥è¿›è¡Œè·¯ç”±åˆ†å‘ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­å¯ä»¥è‡ªç”±ç»„åˆä½¿ç”¨ã€‚åŒæ—¶ Spring Cloud Gateway è¿˜æœ‰æ›´å¤šå¾ˆé…·çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ Filter ã€ç†”æ–­å’Œé™æµç­‰ï¼Œä¸‹æ¬¡æˆ‘ä»¬ç»§ç»­å­¦ä¹  Spring Cloud Gateway çš„é«˜çº§åŠŸèƒ½ã€‚</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'æœåŠ¡','ç½‘å…³','Spring'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>