<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ç»¼åˆå…¸è—ï¼šå…¨é¢å¿«é€Ÿå…¥é—¨Redisæ•°æ®åº“(æ–‡æœ«æœ‰æ›´å¤šèµ„æ–™ï¼‰ | æå®¢å¿«è¨Š</title><meta property="og:title" content="ç»¼åˆå…¸è—ï¼šå…¨é¢å¿«é€Ÿå…¥é—¨Redisæ•°æ®åº“(æ–‡æœ«æœ‰æ›´å¤šèµ„æ–™ï¼‰ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/94a1c0a72fcf432bb4711317aadcc8c5"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91277652.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91277652.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/91277652.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91277652.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91277652.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/91277652.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/91277652.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91277652.html><meta property="article:published_time" content="2020-10-29T21:09:57+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:57+08:00"><meta name=Keywords content><meta name=description content="ç»¼åˆå…¸è—ï¼šå…¨é¢å¿«é€Ÿå…¥é—¨Redisæ•°æ®åº“(æ–‡æœ«æœ‰æ›´å¤šèµ„æ–™ï¼‰"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/91277652.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ç»¼åˆå…¸è—ï¼šå…¨é¢å¿«é€Ÿå…¥é—¨Redisæ•°æ®åº“(æ–‡æœ«æœ‰æ›´å¤šèµ„æ–™ï¼‰</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><blockquote><p>ä½œè€…ï¼šå°å¼Ÿè°ƒè°ƒ</p><p>é“¾æ¥ï¼šhttps://segmentfault.com/a/1190000010241956</p></blockquote><p><br></p><div class=pgc-img><img alt=ç»¼åˆå…¸è—ï¼šå…¨é¢å¿«é€Ÿå…¥é—¨Redisæ•°æ®åº“(æ–‡æœ«æœ‰æ›´å¤šèµ„æ–™ï¼‰ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/94a1c0a72fcf432bb4711317aadcc8c5><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-android"><section></section></div><div class="pgc-img-button setImageCover fix-android"><section></section></div><div class="pgc-img-button deleteImage fix-android"><section></section></div></div><div class=pgc-img-border></div></div><p>Rediså®‰è£…</p><p>å®˜æ–¹ç¼–è¯‘å®‰è£…</p><p>$ wget http://download.redis.io/releases/redis-4.0.0.tar.gz</p><p>$ tar xzvf redis-4.0.0.tar.gz -C /usr/local/</p><p>$ cd /usr/local/redis-4.0.0</p><p>$ make</p><p>$ make test</p><p>$ make install</p><p># ç¨‹åºä¼šè‡ªåŠ¨æ‰§è¡Œ:</p><p># mkdir -p /usr/local/bin</p><p># cp -pf redis-server /usr/local/bin</p><p># cp -pf redis-benchmark /usr/local/bin</p><p># cp -pf redis-cli /usr/local/bin</p><p># cp -pf redis-check-dump /usr/local/bin</p><p># cp -pf redis-check-aof /usr/local/bin</p><p>æµ‹è¯•make testæŠ¥é”™</p><p>$ make test</p><p>You need tcl 8.5 or newer in order to run the Redis test</p><p>make: *** [test] Error 1</p><p>è¿™ä¸ªæ˜¯éœ€è¦å®‰è£…tcl</p><p>wget http://downloads.sourceforge.net/tcl/tcl8.6.1-src.tar.gz</p><p>sudo tar xzvf tcl8.6.1-src.tar.gz -C /usr/local/</p><p>cd /usr/local/tcl8.6.1/unix/</p><p>sudo ./configure</p><p>sudo make</p><p>sudo make install</p><p>é€šè¿‡EPELæºå®‰è£…</p><p>æºå®‰è£…é—®é¢˜åœ¨äºä¸èƒ½å®‰è£…æœ€æ–°ï¼Œæˆ–è€…æŒ‡å®šRedisç‰ˆæœ¬ã€‚</p><p>yum --enablerepo=epel -y install redis</p><p>å¦‚æœæ²¡æœ‰å®‰è£…æºï¼Œé€šè¿‡ä¸‹é¢æ–¹å¼å®‰è£…æºã€‚</p><p>cd /etc/yum.repos.d/</p><p>rpm -Uvh http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</p><p>Rediså‡çº§</p><p>é¦–å…ˆï¼Œç¡®ä¿å®‰è£…äº†ä»¥ä¸‹reposï¼ŒEPELå’ŒREMIï¼š</p><p>sudo rpm -Uvh http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</p><p>sudo rpm -Uvh http://rpms.remirepo.net/enterprise/remi-release-6.rpm</p><p>é€šè¿‡--enablerepo=epelå‚æ•°æŸ¥çœ‹æŒ‡å®šæºRedisç‰ˆæœ¬ï¼Œæ£€æŸ¥REMI repoä¸­çš„Redisç‰ˆæœ¬ï¼š</p><p>yum --enablerepo=epel info redis</p><p># Loaded plugins: fastestmirror</p><p># Loading mirror speeds from cached hostfile</p><p># * base: centos.ustc.edu.cn</p><p># * epel: mirrors.tuna.tsinghua.edu.cn</p><p># * extras: centos.ustc.edu.cn</p><p># * updates: mirrors.zju.edu.cn</p><p># Available Packages</p><p># Name : redis</p><p># Arch : x86_64</p><p># Version : 2.4.10</p><p># Release : 1.el6</p><p># Size : 213 k</p><p># Repo : epel/x86_64</p><p># Summary : A persistent key-value database</p><p># URL : http://redis.io</p><p># License : BSD</p><p># Description : Redis is an advanced key-value store. It is similar to memcached but the data</p><p># : set is not volatile, and values can be strings, exactly like in memcached, but</p><p># : also lists, sets, and ordered sets. All this data types can be manipulated with</p><p># : atomic operations to push/pop elements, add/remove elements, perform server</p><p># : side union, intersection, difference between sets, and so forth. Redis supports</p><p># : different kind of sorting abilities.</p><p>ç„¶åä»EPEL repoå®‰è£…ç›¸å…³çš„ä¾èµ–å…³ç³»ï¼ˆjemallocï¼‰ï¼š</p><p>yum --enablerepo=epel install jemalloc</p><p>åœ¨å®‰è£…ä¹‹å‰ï¼Œæ‚¨åº”è¯¥åœæ­¢æ—§çš„Rediså®ˆæŠ¤è¿›ç¨‹ï¼š</p><p>service redis stop</p><p>ç„¶åå®‰è£…æ›´æ–°ç‰ˆæœ¬çš„Redisï¼š</p><p>sudo yum --enablerepo=remi install redis</p><p>æœåŠ¡ç®¡ç†</p><p>é‡æ–°å¯åŠ¨Rediså®ˆæŠ¤ç¨‹åºï¼Œå¹¶ä½¿å…¶é‡æ–°å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ï¼š</p><p>sudo service redis start</p><p>sudo chkconfig redis on</p><p>åŸºæœ¬æœåŠ¡æ“ä½œ</p><p>## å¯åŠ¨å¹¶åå°è¿è¡Œ</p><p>$ redis-server & nohup</p><p>## æŸ¥æ˜¯å¦å¯åŠ¨</p><p>$ redis-cli ping</p><p>## å…³é—­å‘½ä»¤</p><p>$ redis-cli shutdown</p><p># å‘½ä»¤è¡Œå®¢æˆ·ç«¯å¯åŠ¨</p><p>$ redis-cli start</p><p># å¯åŠ¨</p><p>$ service redis start</p><p># åœæ­¢</p><p>$ service redis stop</p><p># å‘½ä»¤è¡Œå®¢æˆ·ç«¯å¯åŠ¨</p><p>$ redis-cli -p 6380</p><p># æŒ‡å®šç«¯å£åå°å¯åŠ¨</p><p>$ redis-server --port 6380 &</p><p>æŸ¥çœ‹ç‰ˆæœ¬</p><p>æ£€æŸ¥å½“å‰å®‰è£…çš„Redisç‰ˆæœ¬ï¼š</p><p># æŸ¥çœ‹ Redis ç‰ˆæœ¬</p><p>$ redis-cli info | grep redis_version</p><p># æŸ¥çœ‹ç«¯å£å·</p><p>$ redis-cli info | grep tcp_port</p><p>å¼€æœºå¯åŠ¨</p><p>æˆ‘ä»¬å°†åœ¨ Redis å®‰è£…ç›®å½•æ‰¾åˆ°/usr/local/redis-4.0.0/utilsè¿™ä¸ªç›®å½•ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸­æœ‰ä¸ªæœ‰ä¸ªè„šæœ¬ redis_init_scriptï¼Œå°†æ­¤è„šæœ¬æ‹·è´åˆ°/etc/init.dç›®å½•ä¸‹ï¼Œå‘½åä¸ºredis:</p><p>cp /usr/local/redis-4.0.0/utils/redis_init_script /etc/init.d/redis</p><p>æ‹·è´ä¸€ä¸‹redis.conf æ–‡ä»¶åˆ°/etc/redisç›®å½•ä¸‹</p><p>cp /usr/local/redis-4.0.0/redis.conf /etc/redis/6380.conf</p><p>é…ç½®æ–‡ä»¶6380.conféœ€è¦æ›´æ”¹å‡ ä¸ªåœ°æ–¹</p><p># æ˜¯å¦åœ¨åå°æ‰§è¡Œï¼Œyesï¼šåå°è¿è¡Œï¼›noï¼šä¸æ˜¯åå°è¿è¡Œï¼ˆè€ç‰ˆæœ¬é»˜è®¤ï¼‰</p><p>daemonize yes</p><p>æ›´æ”¹æƒé™ï¼Œé€šè¿‡ chkconfig å‘½ä»¤æ£€æŸ¥ã€è®¾ç½®ç³»ç»ŸredisæœåŠ¡å¼€å¯</p><p>chmod +x /etc/init.d/redis</p><p>chkconfig redis on</p><p>å¿…é¡»æŠŠä¸‹é¢ä¸¤è¡Œæ³¨é‡Šæ”¾åœ¨ /etc/init.d/redis æ–‡ä»¶å¤´éƒ¨ï¼Œä¸è®¾ç½®ä¼šæŠ¥ä¸æ”¯æŒçš„æç¤º service redis does not support chkconfig</p><p># chkconfig: 2345 90 10</p><p># description: redis is a persistent key-value database</p><p>ä¸Šé¢çš„æ³¨é‡Šçš„æ„æ€æ˜¯ï¼ŒredisæœåŠ¡å¿…é¡»åœ¨è¿è¡Œçº§2ï¼Œ3ï¼Œ4ï¼Œ5ä¸‹è¢«å¯åŠ¨æˆ–å…³é—­ï¼Œå¯åŠ¨çš„ä¼˜å…ˆçº§æ˜¯90ï¼Œå…³é—­çš„ä¼˜å…ˆçº§æ˜¯10ã€‚</p><p><strong>Redis å¯åŠ¨è­¦å‘Šé”™è¯¯è§£å†³</strong></p><ol><li>WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.</li></ol><p>echo "vm.overcommit_memory=1" > /etc/sysctl.conf # æˆ– vi /etcsysctl.conf , ç„¶årebooté‡å¯æœºå™¨</p><p>echo 1 > /proc/sys/vm/overcommit_memory # ä¸éœ€è¦å¯æœºå™¨å°±ç”Ÿæ•ˆ</p><ol><li>WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</li></ol><p>echo 511 > /proc/sys/net/core/somaxconn</p><p>æ›´æ”¹é…ç½®</p><p>Redis çš„é…ç½®æ–‡ä»¶ä½äº Redis å®‰è£…ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åä¸º redis.confã€‚é»˜è®¤ Redis é…ç½®æ–‡ä»¶åœ¨ sudo vi /etc/redis.conf è¿™é‡Œå¯ä»¥ç¼–è¾‘</p><p>sudo vi /etc/redis.conf</p><p>ä½ å¯ä»¥é€šè¿‡ CONFIG å‘½ä»¤æŸ¥çœ‹æˆ–è®¾ç½®é…ç½®é¡¹ã€‚é…ç½®è®¾ç½®å‘½ä»¤</p><p>## è¿›å…¥redisè·å–</p><p>127.0.0.1:6379> CONFIG GET CONFIG_SETTING_NAME</p><p>## è¿›å…¥redisè®¾ç½®</p><p>127.0.0.1:6379> CONFIG SET CONFIG_SETTING_NAME NEW_CONFIG_VALUE</p><p>## è·å–æ‰€æœ‰é…ç½®</p><p>127.0.0.1:6379> CONFIG GET *</p><p>## è®¾ç½®é…ç½®å¼€å¯é€šçŸ¥åŠŸèƒ½</p><p>$ redis-cli config set notify-keyspace-events KEA</p><p>åŸºæœ¬æ“ä½œ</p><p>## å‘½ä»¤è¡Œå®¢æˆ·ç«¯å¯åŠ¨</p><p>$ redis-cli</p><p># æµ‹è¯•å¿ƒè·³</p><p>127.0.0.1:6379> ping</p><p>PONG</p><p># è®¾ç½® mykey é”®çš„å€¼</p><p>127.0.0.1:6379> set mykey hello</p><p>OK</p><p># è·å– mykey é”®çš„å€¼</p><p>127.0.0.1:6379> get mykey</p><p>"hello"</p><p>## è®¾ç½® mykey å¤±æ•ˆäº‹ä»¶</p><p>127.0.0.1:6379> expire mykey 2</p><p># æŸ¥çœ‹å½“å‰redisçš„é…ç½®ä¿¡æ¯</p><p>127.0.0.1:6379> config get *</p><p># è·å–æ‰€æœ‰çš„key</p><p>127.0.0.1:6379> keys *</p><p># åˆ é™¤rediså½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰Key</p><p>127.0.0.1:6379> flushdb</p><p>127.0.0.1:6379> config get dir</p><p># é¦‹å“­å½“å‰åº“ key çš„æ•°é‡</p><p>127.0.0.1:6379> dbsize</p><p># åˆ é™¤æ‰€æœ‰æ•°æ®åº“ä¸­çš„key</p><p>127.0.0.1:6379> flushall</p><p># é€€å‡º</p><p>127.0.0.1:6379> exit</p><p># æ‰¾å‡ºæ‹–æ…¢ Redis çš„ç½ªé­ç¥¸é¦–</p><p># é€šè¿‡è¿™ä¸ªå·¥å…·å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤ç»Ÿè®¡çš„å¿«ç…§ï¼Œ</p><p># æ¯”å¦‚å‘½ä»¤æ‰§è¡Œäº†å¤šå°‘æ¬¡ï¼Œ</p><p># æ‰§è¡Œå‘½ä»¤æ‰€è€—è´¹çš„æ¯«ç§’æ•°(æ¯ä¸ªå‘½ä»¤çš„æ€»æ—¶é—´å’Œå¹³å‡æ—¶é—´)</p><p># åªéœ€è¦ç®€å•åœ°æ‰§è¡Œ CONFIG RESETSTAT å‘½ä»¤å°±å¯ä»¥é‡ç½®ï¼Œè¿™æ ·ä½ å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå…¨æ–°çš„ç»Ÿè®¡ç»“æœã€‚</p><p>127.0.0.1:6379> commandstats</p><p>cmdstat_get:calls=78,usec=608,usec_per_call=7.79</p><p>cmdstat_setex:calls=5,usec=71,usec_per_call=14.20</p><p>cmdstat_keys:calls=2,usec=42,usec_per_call=21.00</p><p>cmdstat_info:calls=10,usec=1931,usec_per_call=193.10</p><p>æ”¯æŒçš„æ•°æ®ç±»å‹</p><p>å­—ç¬¦ä¸²</p><p># å¯åŠ¨å®¢æˆ·ç«¯ ,å­˜å‚¨å­—ç¬¦ä¸²åˆ°redis.</p><p>redis> SET name forezp</p><p>OK</p><p># å–å­—ç¬¦ä¸²:</p><p>redis> get name</p><p>"forezp"</p><p>Hashes - å“ˆå¸Œå€¼</p><p>redis > HMSET king username forezp password xxdxx age 22</p><p>redis > HGETALL king</p><p>1) "username"</p><p>2) "forezp "</p><p>3) "password "</p><p>4) "xxdxx "</p><p>5) "age "</p><p>6) "22"</p><p>Lists - åˆ—è¡¨</p><p>redis> lpush pricess kenny</p><p>(integer) 1</p><p>redis 127.0.0.1:6379> lpush pricess jolin</p><p>(integer) 2</p><p>redis 127.0.0.1:6379> lpush pricess mayun</p><p>(integer) 3</p><p>redis 127.0.0.1:6379> lrange pricess 0 10</p><p>1) "kenny"</p><p>2) "jolin"</p><p>3) "mayun"</p><p>æœ‰åºé›†åˆ</p><p>redis > ZADD kindom 1 redis</p><p>(integer) 1</p><p>redis> ZADD kindom 2 mongodb</p><p>(integer) 1</p><p>redis > ZADD kindom 3 mysql</p><p>(integer) 1</p><p>redis > ZADD kindom 3 mysql</p><p>(integer) 0</p><p>redis > ZADD kindom 4 mysql</p><p>(integer) 0</p><p>redis > ZRANGE kindom 0 10 WITHSCORES</p><p>1) "redis"</p><p>2) "1"</p><p>3) "mongodb"</p><p>4) "2"</p><p>5) "mysql"</p><p>6) "4"</p><p>å¼€å¯é€šçŸ¥</p><p>é”®ç©ºé—´äº‹ä»¶é€šçŸ¥é»˜è®¤è¢«ç¦ç”¨ï¼Œå› ä¸ºè¿™ä¸ªç‰¹æ€§æ¶ˆè€—CPUç”µé‡ä¸æ˜¯å¾ˆæ˜æ™ºã€‚ä½¿ç”¨redis.confçš„notify-keyspace-eventsï¼Œæˆ–è€…é€šè¿‡CONFIG SETæ¥å¼€å¯é€šçŸ¥ã€‚</p><p>## è®¾ç½®é…ç½®å¼€å¯é€šçŸ¥åŠŸèƒ½</p><p>$ redis-cli config set notify-keyspace-events KEA</p><p>## å‘½ä»¤è¡Œç›‘æ§æ‰€æœ‰é€šçŸ¥</p><p>$ redis-cli --csv psubscribe '__key*__:*'</p><p>Reading messages... (press Ctrl-C to quit)</p><p>"psubscribe","__key*__:*",1</p><p>é”®å€¼è¯´æ˜</p><p>K Keyspace events, published with __keyspace@&lt;db>__ prefix.</p><p>E Keyevent events, published with __keyevent@&lt;db>__ prefix.</p><p>g Generic commands (non-type specific) like DEL, EXPIRE, RENAME, ...</p><p>$ String commands</p><p>l List commands</p><p>s Set commands</p><p>h Hash commands</p><p>z Sorted set commands</p><p>x Expired events (events generated every time a key expires)</p><p>e Evicted events (events generated when a key is evicted for maxmemory)</p><p>A Alias for g$lshzxe, so that the "AKE" string means all the events.</p><p>ä¸åŒå‘½ä»¤äº§ç”Ÿçš„äº‹ä»¶(Events generated by different commands)</p><p>æŒ‰ç…§ä¸‹é¢çš„æ¸…å•ï¼Œä¸åŒçš„å‘½ä»¤äº§ç”Ÿä¸åŒç±»å‹çš„äº‹ä»¶ã€‚ Redis Keyspace Notifications</p><ul><li>DEL ä¸ºæ¯ä¸€ä¸ªè¢«åˆ é™¤çš„é”®äº§ç”Ÿä¸€ä¸ªdeläº‹ä»¶ã€‚</li><li>RENAME äº§ç”Ÿä¸¤ä¸ªäº‹ä»¶ï¼Œä¸ºæºé”®äº§ç”Ÿä¸€ä¸ªrename_fromäº‹ä»¶ï¼Œä¸ºç›®æ ‡é”®äº§ç”Ÿä¸€ä¸ªrename_toäº‹ä»¶ã€‚</li><li>EXPIRE å½“ä¸ºé”®è®¾ç½®è¿‡æœŸæ—¶äº§ç”Ÿä¸€ä¸ªexpireäº‹ä»¶ï¼Œæˆ–è€…æ¯å½“è®¾ç½®äº†è¿‡æœŸçš„é”®è¢«åˆ é™¤æ—¶äº§ç”Ÿä¸€ä¸ªexpiredäº‹ä»¶(æŸ¥çœ‹EXPIREæ–‡æ¡£è·å–æ›´å¤šä¿¡æ¯)ã€‚</li><li>SORT å½“STOREç”¨äºè®¾ç½®ä¸€ä¸ªæ–°é”®æ—¶äº§ç”Ÿä¸€ä¸ªsortstoreäº‹ä»¶ã€‚å½“ç»“æœåˆ—è¡¨ä¸ºç©ºï¼Œå¹¶ä¸”ä½¿ç”¨äº†STOREé€‰é¡¹ï¼Œå¹¶ä¸”å·²ç»æœ‰ä¸€ä¸ªè¯¥åå­—çš„é”®å­˜åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªä»¶é”®è¢«åˆ é™¤ï¼Œæ‰€ä»¥è¿™ç§æ¡ä»¶ä¸‹æˆ–äº§ç”Ÿä¸€ä¸ªdeläº‹ä»¶ã€‚</li><li>SETåŠå…¶æ‰€æœ‰å˜ç§(SETEX, SETNX,GETSET) äº§ç”Ÿsetäº‹ä»¶ã€‚ä½†æ˜¯SETEXè¿˜ä¼šäº§ç”Ÿä¸€ä¸ªexpireäº‹ä»¶ã€‚</li><li>MSET ä¸ºæ¯ä¸ªé”®äº§ç”Ÿä¸€ä¸ªå•ç‹¬çš„setäº‹ä»¶ã€‚</li><li>SETRANGE äº§ç”Ÿä¸€ä¸ªsetrangeäº‹ä»¶ã€‚</li><li>INCR, DECR, INCRBY, DECRBY éƒ½äº§ç”Ÿincrbyäº‹ä»¶ã€‚</li><li>INCRBYFLOAT äº§ç”Ÿä¸€ä¸ªincrbyfloatäº‹ä»¶ã€‚</li><li>APPEND äº§ç”Ÿä¸€ä¸ªappendäº‹ä»¶ã€‚</li><li>LPUSHå’ŒLPUSHX äº§ç”Ÿå•ä¸ªlpushäº‹ä»¶ï¼Œå³ä½¿åœ¨å¯å˜æƒ…å†µä¸‹(even in the variadic case)ã€‚</li><li>RPUSHå’ŒRPUSHX äº§ç”Ÿå•ä¸ªrpushäº‹ä»¶ï¼Œå³ä½¿åœ¨å¯å˜æƒ…å†µä¸‹(even in the variadic case)ã€‚</li><li>RPOP äº§ç”Ÿä¸€ä¸ªrpopäº‹ä»¶ã€‚å¦‚æœé”®ç”±äºæœ€åä¸€ä¸ªå…ƒç´ è¢«ä»åˆ—è¡¨ä¸­å¼¹å‡ºè€Œå¯¼è‡´åˆ é™¤ï¼Œä¼šåˆäº§ç”Ÿä¸€ä¸ªdeläº‹ä»¶ã€‚</li><li>LPOP äº§ç”Ÿä¸€ä¸ªlpopäº‹ä»¶ã€‚å¦‚æœé”®ç”±äºæœ€åä¸€ä¸ªå…ƒç´ è¢«ä»åˆ—è¡¨ä¸­å¼¹å‡ºè€Œå¯¼è‡´åˆ é™¤ï¼Œä¼šåˆäº§ç”Ÿä¸€ä¸ªdeläº‹ä»¶ã€‚</li><li>LINSERT äº§ç”Ÿä¸€ä¸ªlinsertäº‹ä»¶ã€‚</li><li>LSET äº§ç”Ÿä¸€ä¸ªlsetäº‹ä»¶ã€‚</li><li>LREM äº§ç”Ÿä¸€ä¸ªlremäº‹ä»¶ã€‚å¦‚æœç»“æœåˆ—è¡¨ä¸ºç©ºå¹¶ä¸”é”®è¢«åˆ é™¤ï¼Œä¼šåˆäº§ç”Ÿä¸€ä¸ªdeläº‹ä»¶ã€‚</li><li>LTRIM äº§ç”Ÿä¸€ä¸ªltrimäº‹ä»¶ã€‚å¦‚æœç»“æœåˆ—è¡¨ä¸ºç©ºå¹¶ä¸”é”®è¢«åˆ é™¤ï¼Œä¼šåˆäº§ç”Ÿä¸€ä¸ªdeläº‹ä»¶ã€‚</li><li>RPOPLPUSHå’ŒBRPOPLPUSH äº§ç”Ÿä¸€ä¸ªrpopäº‹ä»¶å’Œä¸€ä¸ªlpushäº‹ä»¶ã€‚ä¸¤ç§æƒ…å†µä¸‹é¡ºåºéƒ½èƒ½ä¿è¯ (lpushäº‹ä»¶æ€»æ˜¯åœ¨rpopäº‹ä»¶ä¹‹åè¢«ä¼ é€’) å¦‚æœç»“æœåˆ—è¡¨é•¿åº¦ä¸ºé›¶å¹¶ä¸”é”®è¢«åˆ é™¤ï¼Œä¼šåˆäº§ç”Ÿä¸€ä¸ªdeläº‹ä»¶ã€‚</li><li>HSET, HSETNXå’ŒHMSET éƒ½äº§ç”Ÿå•ä¸ªhsetäº‹ä»¶ã€‚</li><li>HINCRBY äº§ç”Ÿä¸€ä¸ªhincrbyäº‹ä»¶ã€‚</li><li>HINCRBYFLOAT äº§ç”Ÿä¸€ä¸ªhincrbyfloatäº‹ä»¶ã€‚</li><li>HDEL äº§ç”Ÿå•ä¸ªhdeläº‹ä»¶ã€‚å¦‚æœç»“æœå“ˆå¸Œä¸ºç©ºå¹¶ä¸”é”®è¢«åˆ é™¤ï¼Œä¼šåˆäº§ç”Ÿä¸€ä¸ªdeläº‹ä»¶ã€‚</li><li>SADD äº§ç”Ÿå•ä¸ªsaddäº‹ä»¶ï¼Œå³ä½¿åœ¨å¯å˜æƒ…å†µä¸‹(even in the variadic case)ã€‚</li><li>SREM äº§ç”Ÿå•ä¸ªsremäº‹ä»¶ã€‚å¦‚æœç»“æœé›†åˆä¸ºç©ºå¹¶ä¸”é”®è¢«åˆ é™¤ï¼Œä¼šåˆäº§ç”Ÿä¸€ä¸ªdeläº‹ä»¶ã€‚</li><li>SMOVE ä¸ºæºé”®äº§ç”Ÿä¸€ä¸ªsremäº‹ä»¶ä¸ºç›®æ ‡é”®äº§ç”Ÿä¸€ä¸ªsaddäº‹ä»¶ã€‚</li><li>SPOP äº§ç”Ÿä¸€ä¸ªspopäº‹ä»¶ã€‚å¦‚æœç»“æœé›†åˆä¸ºç©ºå¹¶ä¸”é”®è¢«åˆ é™¤ï¼Œä¼šåˆäº§ç”Ÿä¸€ä¸ªdeläº‹ä»¶ã€‚</li><li>SINTERSTORE, SUNIONSTORE, SDIFFSTORE åˆ†åˆ«äº§ç”Ÿsinterstoreï¼Œsunionostoreï¼Œsdiffstoreäº‹ä»¶ã€‚åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œé›†åˆä¸ºç©ºï¼Œä¸”å­˜å‚¨ç»“æœçš„é”®å·²ç»å­˜åœ¨ï¼Œç”±äºé”®è¢«åˆ é™¤ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªdeläº‹ä»¶ã€‚</li><li>ZINCR äº§ç”Ÿä¸€ä¸ªzincräº‹ä»¶ã€‚</li><li>ZADDäº§ç”Ÿå•ä¸ªzaddäº‹ä»¶ï¼Œå³ä½¿æ·»åŠ äº†å¤šä¸ªå…ƒç´ ã€‚.</li><li>ZREM äº§ç”Ÿå•ä¸ªzremäº‹ä»¶ï¼Œå³ä½¿åˆ é™¤äº†å¤šä¸ªå…ƒç´ ã€‚å½“ç»“æœæœ‰åºé›†åˆä¸ºç©ºï¼Œå¹¶ä¸”é”®è¢«ç”Ÿæˆæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªé¢å¤–çš„deläº‹ä»¶ã€‚</li><li>ZREMBYSCORE äº§ç”Ÿå•ä¸ªzrembyscoreäº‹ä»¶ã€‚å½“ç»“æœæœ‰åºé›†åˆä¸ºç©ºï¼Œå¹¶ä¸”é”®è¢«ç”Ÿæˆæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªé¢å¤–çš„deläº‹ä»¶ã€‚</li><li>ZREMBYRANK äº§ç”Ÿå•ä¸ªzrembyrankäº‹ä»¶ã€‚å½“ç»“æœæœ‰åºé›†åˆä¸ºç©ºï¼Œå¹¶ä¸”é”®è¢«ç”Ÿæˆæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªé¢å¤–çš„deläº‹ä»¶ã€‚</li><li>ZINTERSTOREå’ŒZUNIONSTORE åˆ†åˆ«äº§ç”Ÿzinterstoreå’Œzunionstoreäº‹ä»¶ã€‚åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œé›†åˆä¸ºç©ºï¼Œä¸”å­˜å‚¨ç»“æœçš„é”®å·²ç»å­˜åœ¨ï¼Œç”±äºé”®è¢«åˆ é™¤ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªdeläº‹ä»¶ã€‚</li><li>æ¯å½“ä¸€ä¸ªå…³è”æœ‰ç”Ÿå­˜äº‹ä»¶çš„é”®ç”±äºè¿‡æœŸè€Œè¢«ä»æ•°æ®é›†ä¸­åˆ é™¤æ—¶ä¼šäº§ç”Ÿä¸€ä¸ªexpiredäº‹ä»¶ã€‚</li><li>æ¯å½“ä¸€ä¸ªé”®ç”±äºmaxmemoryç­–ç•¥è€Œä»æ•°æ®é›†ä¸­è¢«æ·˜æ±°ä»¥èŠ‚çœå†…å­˜æ—¶ä¼šäº§ç”Ÿä¸€ä¸ªevictedäº‹ä»¶ã€‚</li></ul><p>å¼€å¯è¿œç¨‹ç™»å½•è¿æ¥</p><p>ä½¿ç”¨ netstat æ¥æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µï¼Œ6379ä¸ºé»˜è®¤Redisç«¯å£ã€‚</p><p>netstat -nlt|grep 6379</p><ul><li>-tï¼šæŒ‡æ˜æ˜¾ç¤º TCP ç«¯å£</li><li>-uï¼šæŒ‡æ˜æ˜¾ç¤º UDP ç«¯å£</li><li>-lï¼šä»…æ˜¾ç¤ºç›‘å¬å¥—æ¥å­—</li><li>-pï¼šæ˜¾ç¤ºè¿›ç¨‹æ ‡è¯†ç¬¦å’Œç¨‹åºåç§°ï¼Œæ¯ä¸€ä¸ªå¥—æ¥å­—/ç«¯å£éƒ½å±äºä¸€ä¸ªç¨‹åºã€‚</li><li>-nï¼šä¸è¿›è¡Œ DNS è½®è¯¢ï¼Œæ˜¾ç¤º IP ï¼ˆå¯ä»¥åŠ é€Ÿæ“ä½œï¼‰</li></ul><p>ä¿®æ”¹é˜²ç«å¢™é…ç½®</p><p>ä¿®æ”¹é˜²ç«å¢™é…ç½® sudo vi /etc/sysconfig/iptables</p><p>-A INPUT -m state --state NEW -m tcp -p tcp --dport 6379 -j ACCEPT</p><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><p>Redis protected-mode æ˜¯3.2 ä¹‹ååŠ å…¥çš„æ–°ç‰¹æ€§ï¼Œåœ¨Redis.confçš„æ³¨é‡Šä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼Œä»–çš„å…·ä½“ä½œç”¨å’Œå¯ç”¨æ¡ä»¶ã€‚å¯ä»¥åœ¨ sudo vi /etc/redis.conf ä¸­ç¼–è¾‘ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚</p><p># Protected mode is a layer of security protection, in order to avoid that</p><p># Redis instances left open on the internet are accessed and exploited.</p><p>#</p><p># When protected mode is on and if:</p><p>#</p><p># 1) The server is not binding explicitly to a set of addresses using the</p><p># "bind" directive.</p><p># 2) No password is configured.</p><p>#</p><p># The server only accepts connections from clients connecting from the</p><p># IPv4 and IPv6 loopback addresses 127.0.0.1 and ::1, and from Unix domain</p><p># sockets.</p><p>#</p><p># By default protected mode is enabled. You should disable it only if</p><p># you are sure you want clients from other hosts to connect to Redis</p><p># even if no authentication is configured, nor a specific set of interfaces</p><p># are explicitly listed using the "bind" directive.</p><p>protected-mode yes</p><p>å®ƒå¯ç”¨çš„æ¡ä»¶ï¼Œæœ‰ä¸¤ä¸ªï¼š</p><ol><li>æ²¡æœ‰bind IP</li><li>æ²¡æœ‰è®¾ç½®è®¿é—®å¯†ç </li></ol><p>å¦‚æœå¯ç”¨äº†ï¼Œåˆ™åªèƒ½å¤Ÿé€šè¿‡lookback ipï¼ˆ127.0.0.1ï¼‰è®¿é—®Redis cacheï¼Œå¦‚æœä»å¤–ç½‘è®¿é—®ï¼Œåˆ™ä¼šè¿”å›ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ï¼š</p><p>(error) DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the lookback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: 1) Just disable protected mode sending the command 'CONFIG SET protected-mode no' from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent. 2) Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to 'no', and then restarting the server. 3) If you started the server manually just for testing, restart it with the --portected-mode no option. 4) Setup a bind address or an authentication password. NOTE: You only need to do one of the above things in order for the server to start accepting connections from the outside.</p><p>æä¾›çš„åŸç”Ÿç›‘æ§</p><p>å½“å‰é“¾æ¥çš„å®¢æˆ·ç«¯æ•°å’Œè¿æ¥æ•°</p><p>redis-cli --statæŸ¥çœ‹å½“å‰è¿æ¥çš„å®¢æˆ·ç«¯æ•°ï¼Œè¿æ¥æ•°ç­‰</p><p>------- data ------ --------------------- load -------------------- - child -</p><p>keys mem clients blocked requests connections</p><p>4 1.27M 6 0 17340 (+0) 111</p><p>4 1.27M 6 0 17341 (+1) 111</p><p>4 1.27M 6 0 17342 (+1) 111</p><p>4 1.27M 6 0 17343 (+1) 111</p><p>å†…å­˜æœ€å¤§çš„é”®å€¼å’Œå¹³å‡çš„é”®å€¼æ•°æ®</p><p>redis-cli --bigkeys å¯¹å½“å‰å ç”¨å†…å­˜æœ€å¤§çš„é”®å€¼å’Œå¹³å‡çš„é”®å€¼æ•°æ®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®š-iå‚æ•°å®šæ—¶æŸ¥çœ‹å½“å‰çš„è§†å›¾æƒ…å†µã€‚</p><p># Scanning the entire keyspace to find biggest keys as well as</p><p># average sizes per key type. You can use -i 0.1 to sleep 0.1 sec</p><p># per 100 SCAN commands (not usually needed).</p><p>[00.00%] Biggest string found so far 'asdf.js' with 3 bytes</p><p>[00.00%] Biggest string found so far 'wabg-tokeneyJhbGciOiJIUzI1NiJ9.NA.UGGRiB2I42rP-33cIMrcoPub7AzHgDlqHacAKFw1pfE' with 328 bytes</p><p>[00.00%] Biggest string found so far 'wabg-token-province' with 231042 bytes</p><p>-------- summary -------</p><p>Sampled 4 keys in the keyspace!</p><p>Total key length in bytes is 180 (avg len 45.00)</p><p>Biggest string found 'wabg-token-province' has 231042 bytes</p><p>4 strings with 231819 bytes (100.00% of keys, avg size 57954.75)</p><p>0 lists with 0 items (00.00% of keys, avg size 0.00)</p><p>0 sets with 0 members (00.00% of keys, avg size 0.00)</p><p>0 hashs with 0 fields (00.00% of keys, avg size 0.00)</p><p>0 zsets with 0 members (00.00% of keys, avg size 0.00)</p><p>æŸ¥çœ‹å½“å‰çš„é”®å€¼æƒ…å†µ</p><p>redis-cli --scanæä¾›å’Œkeys *ç›¸ä¼¼çš„åŠŸèƒ½ï¼ŒæŸ¥çœ‹å½“å‰çš„é”®å€¼æƒ…å†µï¼Œå¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾</p><p>$ redis-cli --scan</p><p>sess:K4xh-bxOBrcXpy9kEW87oiy-u7I2sAA5</p><p>asdf.js</p><p>sess:1tGNZSXW8GyoEQsbtpqkA5tMmSFp_ZIn</p><p>wabg-tokeneyJhbGciOiJIUzI1NiJ9.NA.UGGRiB2I42rP-33cIMrcoPub7AzHgDlqHacAKFw1pfE</p><p>sess:3e4NGIJd0wf1-RONeTt-FsXQj4EaVNjk</p><p>wabg-token-province</p><p>sess:UuCLAX2sWZ50fiIO1qvDgulf0XIZRd98</p><p>wabg-tokeneyJhbGciOiJIUzI1NiJ9.MQ.6z44GClzAsUED1M_UyxqdREdDKcYFnL9tSqd5ZhLhsY</p><p>sess:2HEchaRLYUoaa44IF1bB6mpik7lZjBb4</p><p>åŸç”Ÿçš„Monitorç›‘æ§</p><p>redis-cli monitoræ‰“å°å‡ºæ‰€æœ‰severæ¥æ”¶åˆ°çš„å‘½ä»¤ä»¥åŠå…¶å¯¹åº”çš„å®¢æˆ·ç«¯åœ°å€</p><p>$ redis-cli monitor</p><p>OK</p><p>1472626566.218175 [0 127.0.0.1:62862] "info"</p><p>1472626571.220948 [0 127.0.0.1:62862] "exists" "aaa"</p><p>1472626571.223174 [0 127.0.0.1:62862] "set" "aaa" ""</p><p>1472626571.232126 [0 127.0.0.1:62862] "type" "aaa"</p><p>1472626571.243697 [0 127.0.0.1:62862] "pttl" "aaa"</p><p>1472626571.243717 [0 127.0.0.1:62862] "object" "ENCODING" "aaa"</p><p>1472626571.243726 [0 127.0.0.1:62862] "strlen" "aaa"</p><p>é…ç½®è¯´æ˜</p><p>#redis.conf</p><p># Redis configuration file example.</p><p># ./redis-server /path/to/redis.conf</p><p>################################## INCLUDES ###################################</p><p>#è¿™åœ¨ä½ æœ‰æ ‡å‡†é…ç½®æ¨¡æ¿ä½†æ˜¯æ¯ä¸ªredisæœåŠ¡å™¨åˆéœ€è¦ä¸ªæ€§è®¾ç½®çš„æ—¶å€™å¾ˆæœ‰ç”¨ã€‚</p><p># include /path/to/local.conf</p><p># include /path/to/other.conf</p><p>################################ GENERAL #####################################</p><p># æ˜¯å¦åœ¨åå°æ‰§è¡Œï¼Œyesï¼šåå°è¿è¡Œï¼›noï¼šä¸æ˜¯åå°è¿è¡Œï¼ˆè€ç‰ˆæœ¬é»˜è®¤ï¼‰</p><p>daemonize yes</p><p># 3.2é‡Œçš„å‚æ•°ï¼Œæ˜¯å¦å¼€å¯ä¿æŠ¤æ¨¡å¼ï¼Œé»˜è®¤å¼€å¯ã€‚è¦æ˜¯é…ç½®é‡Œæ²¡æœ‰æŒ‡å®šbindå’Œå¯†ç ã€‚</p><p># å¼€å¯è¯¥å‚æ•°åï¼Œredisåªä¼šæœ¬åœ°è¿›è¡Œè®¿é—®ï¼Œæ‹’ç»å¤–éƒ¨è®¿é—®ã€‚</p><p># è¦æ˜¯å¼€å¯äº†å¯†ç  å’Œbindï¼Œå¯ä»¥å¼€å¯ã€‚å¦ åˆ™æœ€å¥½å…³é—­ï¼Œè®¾ç½®ä¸ºnoã€‚</p><p>protected-mode yes</p><p># redisçš„è¿›ç¨‹æ–‡ä»¶</p><p>pidfile /var/run/redis/redis-server.pid</p><p># redisç›‘å¬çš„ç«¯å£å·ã€‚</p><p>port 6379</p><p># æ­¤å‚æ•°ç¡®å®šäº†TCPè¿æ¥ä¸­å·²å®Œæˆé˜Ÿåˆ—(å®Œæˆä¸‰æ¬¡æ¡æ‰‹ä¹‹å)çš„é•¿åº¦ï¼Œ</p><p># å½“ç„¶æ­¤å€¼å¿…é¡»ä¸å¤§äºLinuxç³»ç»Ÿå®šä¹‰çš„/proc/sys/net/core/somaxconnå€¼ï¼Œé»˜è®¤æ˜¯511ï¼Œ</p><p># è€ŒLinuxçš„é»˜è®¤å‚æ•°å€¼æ˜¯128ã€‚å½“ç³»ç»Ÿå¹¶å‘é‡å¤§å¹¶ä¸”å®¢æˆ·ç«¯é€Ÿåº¦ç¼“æ…¢çš„æ—¶å€™ï¼Œ</p><p># å¯ä»¥å°†è¿™äºŒä¸ªå‚æ•°ä¸€èµ·å‚è€ƒè®¾å®šã€‚è¯¥å†…æ ¸å‚æ•°é»˜è®¤å€¼ä¸€èˆ¬æ˜¯128ï¼Œå¯¹äºè´Ÿè½½å¾ˆå¤§çš„æœåŠ¡ç¨‹åºæ¥è¯´å¤§å¤§çš„ä¸å¤Ÿã€‚</p><p># ä¸€èˆ¬ä¼šå°†å®ƒä¿®æ”¹ä¸º2048æˆ–è€…æ›´å¤§ã€‚åœ¨/etc/sysctl.confä¸­æ·»åŠ :net.core.somaxconn = 2048ï¼Œç„¶ååœ¨ç»ˆç«¯ä¸­æ‰§è¡Œsysctl -pã€‚</p><p>tcp-backlog 511</p><p>#æŒ‡å®š redis åªæ¥æ”¶æ¥è‡ªäºè¯¥ IP åœ°å€çš„è¯·æ±‚ï¼Œå¦‚æœä¸è¿›è¡Œè®¾ç½®ï¼Œé‚£ä¹ˆå°†å¤„ç†æ‰€æœ‰è¯·æ±‚</p><p>bind 127.0.0.1</p><p># é…ç½®unix socketæ¥è®©redisæ”¯æŒç›‘å¬æœ¬åœ°è¿æ¥ã€‚</p><p># unixsocket /var/run/redis/redis.sock</p><p># é…ç½®unix socketä½¿ç”¨æ–‡ä»¶çš„æƒé™</p><p># unixsocketperm 700</p><p># æ­¤å‚æ•°ä¸ºè®¾ç½®å®¢æˆ·ç«¯ç©ºé—²è¶…è¿‡timeoutï¼ŒæœåŠ¡ç«¯ä¼šæ–­å¼€è¿æ¥ï¼Œä¸º0åˆ™æœåŠ¡ç«¯ä¸ä¼šä¸»åŠ¨æ–­å¼€è¿æ¥ï¼Œä¸èƒ½å°äº0ã€‚</p><p>timeout 0</p><p># tcp keepaliveå‚æ•°ã€‚å¦‚æœè®¾ç½®ä¸ä¸º0ï¼Œå°±ä½¿ç”¨é…ç½®tcpçš„SO_KEEPALIVEå€¼ï¼Œ</p><p># ä½¿ç”¨keepaliveæœ‰ä¸¤ä¸ªå¥½å¤„:æ£€æµ‹æŒ‚æ‰çš„å¯¹ç«¯ã€‚é™ä½ä¸­é—´è®¾å¤‡å‡ºé—®é¢˜è€Œå¯¼è‡´ç½‘ç»œçœ‹ä¼¼è¿æ¥å´å·²ç»ä¸å¯¹ç«¯ç«¯å£çš„é—®é¢˜ã€‚</p><p># åœ¨Linuxå†…æ ¸ä¸­ï¼Œè®¾ç½®äº†keepaliveï¼Œredisä¼šå®šæ—¶ç»™å¯¹ç«¯å‘é€ackã€‚æ£€æµ‹åˆ°å¯¹ç«¯å…³é—­éœ€è¦ä¸¤å€çš„è®¾ç½®å€¼ã€‚</p><p>tcp-keepalive 0</p><p># æŒ‡å®šäº†æœåŠ¡ç«¯æ—¥å¿—çš„çº§åˆ«ã€‚çº§åˆ«åŒ…æ‹¬ï¼šdebugï¼ˆå¾ˆå¤šä¿¡æ¯ï¼Œæ–¹ä¾¿å¼€å‘ã€æµ‹è¯•ï¼‰ï¼Œ</p><p># verboseï¼ˆè®¸å¤šæœ‰ç”¨çš„ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æœ‰debugçº§åˆ«ä¿¡æ¯å¤šï¼‰ï¼Œnoticeï¼ˆé€‚å½“çš„æ—¥å¿—çº§åˆ«ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒï¼‰ï¼Œwarnï¼ˆåªæœ‰éå¸¸é‡è¦çš„ä¿¡æ¯ï¼‰</p><p>loglevel notice</p><p>#æŒ‡å®šäº†è®°å½•æ—¥å¿—çš„æ–‡ä»¶ã€‚ç©ºå­—ç¬¦ä¸²çš„è¯ï¼Œæ—¥å¿—ä¼šæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ã€‚åå°è¿è¡Œçš„redisæ ‡å‡†è¾“å‡ºæ˜¯/dev/nullã€‚</p><p>logfile /var/log/redis/redis-server.log</p><p># æ˜¯å¦æ‰“å¼€è®°å½•syslogåŠŸèƒ½</p><p># syslog-enabled no</p><p># syslogçš„æ ‡è¯†ç¬¦ã€‚</p><p># syslog-ident redis</p><p># æ—¥å¿—çš„æ¥æºã€è®¾å¤‡</p><p># syslog-facility local0</p><p># æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤ä½¿ç”¨çš„æ•°æ®åº“æ˜¯DB 0ã€‚å¯ä»¥é€šè¿‡â€SELECT â€œå‘½ä»¤é€‰æ‹©ä¸€ä¸ªdb</p><p>databases 16</p><p>################################ SNAPSHOTTING ################################</p><p># å¿«ç…§é…ç½®</p><p># æ³¨é‡Šæ‰â€œsaveâ€è¿™ä¸€è¡Œé…ç½®é¡¹å°±å¯ä»¥è®©ä¿å­˜æ•°æ®åº“åŠŸèƒ½å¤±æ•ˆ</p><p># è®¾ç½®sedisè¿›è¡Œæ•°æ®åº“é•œåƒçš„é¢‘ç‡ã€‚</p><p># 900ç§’ï¼ˆ15åˆ†é’Ÿï¼‰å†…è‡³å°‘1ä¸ªkeyå€¼æ”¹å˜ï¼ˆåˆ™è¿›è¡Œæ•°æ®åº“ä¿å­˜--æŒä¹…åŒ–ï¼‰</p><p># 300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰å†…è‡³å°‘10ä¸ªkeyå€¼æ”¹å˜ï¼ˆåˆ™è¿›è¡Œæ•°æ®åº“ä¿å­˜--æŒä¹…åŒ–ï¼‰</p><p># 60ç§’ï¼ˆ1åˆ†é’Ÿï¼‰å†…è‡³å°‘10000ä¸ªkeyå€¼æ”¹å˜ï¼ˆåˆ™è¿›è¡Œæ•°æ®åº“ä¿å­˜--æŒä¹…åŒ–ï¼‰</p><p>save 900 1</p><p>save 300 10</p><p>save 60 10000</p><p># å½“RDBæŒä¹…åŒ–å‡ºç°é”™è¯¯åï¼Œæ˜¯å¦ä¾ç„¶è¿›è¡Œç»§ç»­è¿›è¡Œå·¥ä½œï¼Œyesï¼šä¸èƒ½è¿›è¡Œå·¥ä½œï¼Œnoï¼šå¯ä»¥ç»§ç»­è¿›è¡Œå·¥ä½œï¼Œ</p><p># å¯ä»¥é€šè¿‡infoä¸­çš„rdb_last_bgsave_statusäº†è§£RDBæŒä¹…åŒ–æ˜¯å¦æœ‰é”™è¯¯</p><p>stop-writes-on-bgsave-error yes</p><p># ä½¿ç”¨å‹ç¼©rdbæ–‡ä»¶ï¼Œrdbæ–‡ä»¶å‹ç¼©ä½¿ç”¨LZFå‹ç¼©ç®—æ³•ï¼Œyesï¼šå‹ç¼©ï¼Œä½†æ˜¯éœ€è¦ä¸€äº›cpuçš„æ¶ˆè€—ã€‚noï¼šä¸å‹ç¼©ï¼Œéœ€è¦æ›´å¤šçš„ç£ç›˜ç©ºé—´</p><p>rdbcompression yes</p><p># æ˜¯å¦æ ¡éªŒrdbæ–‡ä»¶ã€‚ä»rdbæ ¼å¼çš„ç¬¬äº”ä¸ªç‰ˆæœ¬å¼€å§‹ï¼Œåœ¨rdbæ–‡ä»¶çš„æœ«å°¾ä¼šå¸¦ä¸ŠCRC64çš„æ ¡éªŒå’Œã€‚</p><p># è¿™è·Ÿæœ‰åˆ©äºæ–‡ä»¶çš„å®¹é”™æ€§ï¼Œä½†æ˜¯åœ¨ä¿å­˜rdbæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šæœ‰å¤§æ¦‚10%çš„æ€§èƒ½æŸè€—ï¼Œæ‰€ä»¥å¦‚æœä½ è¿½æ±‚é«˜æ€§èƒ½ï¼Œå¯ä»¥å…³é—­è¯¥é…ç½®ã€‚</p><p>rdbchecksum yes</p><p># rdbæ–‡ä»¶çš„åç§°</p><p>dbfilename dump.rdb</p><p># æ•°æ®ç›®å½•ï¼Œæ•°æ®åº“çš„å†™å…¥ä¼šåœ¨è¿™ä¸ªç›®å½•ã€‚rdbã€aofæ–‡ä»¶ä¹Ÿä¼šå†™åœ¨è¿™ä¸ªç›®å½•</p><p>dir /var/lib/redis</p><p>################################# REPLICATION #################################</p><p># å¤åˆ¶é€‰é¡¹ï¼Œslaveå¤åˆ¶å¯¹åº”çš„masterã€‚</p><p># slaveof &lt;masterip> &lt;masterport></p><p>#å¦‚æœmasterè®¾ç½®äº†requirepassï¼Œé‚£ä¹ˆslaveè¦è¿ä¸Šmasterï¼Œéœ€è¦æœ‰masterçš„å¯†ç æ‰è¡Œã€‚masterauthå°±æ˜¯ç”¨æ¥é…ç½®masterçš„å¯†ç ï¼Œè¿™æ ·å¯ä»¥åœ¨è¿ä¸Šmasteråè¿›è¡Œè®¤è¯ã€‚</p><p># masterauth &lt;master-password></p><p>#å½“ä»åº“åŒä¸»æœºå¤±å»è¿æ¥æˆ–è€…å¤åˆ¶æ­£åœ¨è¿›è¡Œï¼Œä»æœºåº“æœ‰ä¸¤ç§è¿è¡Œæ–¹å¼ï¼š1) å¦‚æœslave-serve-stale-dataè®¾ç½®ä¸ºyes(é»˜è®¤è®¾ç½®)ï¼Œä»åº“ä¼šç»§ç»­å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚2) å¦‚æœslave-serve-stale-dataè®¾ç½®ä¸ºnoï¼Œé™¤å»INFOå’ŒSLAVOFå‘½ä»¤ä¹‹å¤–çš„ä»»ä½•è¯·æ±‚éƒ½ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯â€SYNC with master in progressâ€ã€‚</p><p>slave-serve-stale-data yes</p><p>#ä½œä¸ºä»æœåŠ¡å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯åªè¯»çš„ï¼ˆyesï¼‰ï¼Œå¯ä»¥ä¿®æ”¹æˆNOï¼Œç”¨äºå†™ï¼ˆä¸å»ºè®®ï¼‰ã€‚</p><p>slave-read-only yes</p><p>#æ˜¯å¦ä½¿ç”¨socketæ–¹å¼å¤åˆ¶æ•°æ®ã€‚ç›®å‰rediså¤åˆ¶æä¾›ä¸¤ç§æ–¹å¼ï¼Œdiskå’Œsocketã€‚å¦‚æœæ–°çš„slaveè¿ä¸Šæ¥æˆ–è€…é‡è¿çš„slaveæ— æ³•éƒ¨åˆ†åŒæ­¥ï¼Œå°±ä¼šæ‰§è¡Œå…¨é‡åŒæ­¥ï¼Œmasterä¼šç”Ÿæˆrdbæ–‡ä»¶ã€‚æœ‰2ç§æ–¹å¼ï¼šdiskæ–¹å¼æ˜¯masteråˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹æŠŠrdbæ–‡ä»¶ä¿å­˜åˆ°ç£ç›˜ï¼Œå†æŠŠç£ç›˜ä¸Šçš„rdbæ–‡ä»¶ä¼ é€’ç»™slaveã€‚socketæ˜¯masteråˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œç›´æ¥æŠŠrdbæ–‡ä»¶ä»¥socketçš„æ–¹å¼å‘ç»™slaveã€‚diskæ–¹å¼çš„æ—¶å€™ï¼Œå½“ä¸€ä¸ªrdbä¿å­˜çš„è¿‡ç¨‹ä¸­ï¼Œå¤šä¸ªslaveéƒ½èƒ½å…±äº«è¿™ä¸ªrdbæ–‡ä»¶ã€‚socketçš„æ–¹å¼å°±çš„ä¸€ä¸ªä¸ªslaveé¡ºåºå¤åˆ¶ã€‚åœ¨ç£ç›˜é€Ÿåº¦ç¼“æ…¢ï¼Œç½‘é€Ÿå¿«çš„æƒ…å†µä¸‹æ¨èç”¨socketæ–¹å¼ã€‚</p><p>repl-diskless-sync no</p><p>#disklesså¤åˆ¶çš„å»¶è¿Ÿæ—¶é—´ï¼Œé˜²æ­¢è®¾ç½®ä¸º0ã€‚ä¸€æ—¦å¤åˆ¶å¼€å§‹ï¼ŒèŠ‚ç‚¹ä¸ä¼šå†æ¥æ”¶æ–°slaveçš„å¤åˆ¶è¯·æ±‚ç›´åˆ°ä¸‹ä¸€ä¸ªrdbä¼ è¾“ã€‚æ‰€ä»¥æœ€å¥½ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç­‰æ›´å¤šçš„slaveè¿ä¸Šæ¥ã€‚</p><p>repl-diskless-sync-delay 5</p><p>#slaveæ ¹æ®æŒ‡å®šçš„æ—¶é—´é—´éš”å‘æœåŠ¡å™¨å‘é€pingè¯·æ±‚ã€‚æ—¶é—´é—´éš”å¯ä»¥é€šè¿‡ repl_ping_slave_period æ¥è®¾ç½®ï¼Œé»˜è®¤10ç§’ã€‚</p><p># repl-ping-slave-period 10</p><p>#å¤åˆ¶è¿æ¥è¶…æ—¶æ—¶é—´ã€‚masterå’Œslaveéƒ½æœ‰è¶…æ—¶æ—¶é—´çš„è®¾ç½®ã€‚masteræ£€æµ‹åˆ°slaveä¸Šæ¬¡å‘é€çš„æ—¶é—´è¶…è¿‡repl-timeoutï¼Œå³è®¤ä¸ºslaveç¦»çº¿ï¼Œæ¸…é™¤è¯¥slaveä¿¡æ¯ã€‚slaveæ£€æµ‹åˆ°ä¸Šæ¬¡å’Œmasteräº¤äº’çš„æ—¶é—´è¶…è¿‡repl-timeoutï¼Œåˆ™è®¤ä¸ºmasterç¦»çº¿ã€‚éœ€è¦æ³¨æ„çš„æ˜¯repl-timeoutéœ€è¦è®¾ç½®ä¸€ä¸ªæ¯”repl-ping-slave-periodæ›´å¤§çš„å€¼ï¼Œä¸ç„¶ä¼šç»å¸¸æ£€æµ‹åˆ°è¶…æ—¶ã€‚</p><p># repl-timeout 60</p><p>#æ˜¯å¦ç¦æ­¢å¤åˆ¶tcpé“¾æ¥çš„tcp nodelayå‚æ•°ï¼Œå¯ä¼ é€’yesæˆ–è€…noã€‚é»˜è®¤æ˜¯noï¼Œå³ä½¿ç”¨tcp nodelayã€‚å¦‚æœmasterè®¾ç½®äº†yesæ¥ç¦æ­¢tcp nodelayè®¾ç½®ï¼Œåœ¨æŠŠæ•°æ®å¤åˆ¶ç»™slaveçš„æ—¶å€™ï¼Œä¼šå‡å°‘åŒ…çš„æ•°é‡å’Œæ›´å°çš„ç½‘ç»œå¸¦å®½ã€‚ä½†æ˜¯è¿™ä¹Ÿå¯èƒ½å¸¦æ¥æ•°æ®çš„å»¶è¿Ÿã€‚é»˜è®¤æˆ‘ä»¬æ¨èæ›´å°çš„å»¶è¿Ÿï¼Œä½†æ˜¯åœ¨æ•°æ®é‡ä¼ è¾“å¾ˆå¤§çš„åœºæ™¯ä¸‹ï¼Œå»ºè®®é€‰æ‹©yesã€‚</p><p>repl-disable-tcp-nodelay no</p><p>#å¤åˆ¶ç¼“å†²åŒºå¤§å°ï¼Œè¿™æ˜¯ä¸€ä¸ªç¯å½¢å¤åˆ¶ç¼“å†²åŒºï¼Œç”¨æ¥ä¿å­˜æœ€æ–°å¤åˆ¶çš„å‘½ä»¤ã€‚è¿™æ ·åœ¨slaveç¦»çº¿çš„æ—¶å€™ï¼Œä¸éœ€è¦å®Œå…¨å¤åˆ¶masterçš„æ•°æ®ï¼Œå¦‚æœå¯ä»¥æ‰§è¡Œéƒ¨åˆ†åŒæ­¥ï¼Œåªéœ€è¦æŠŠç¼“å†²åŒºçš„éƒ¨åˆ†æ•°æ®å¤åˆ¶ç»™slaveï¼Œå°±èƒ½æ¢å¤æ­£å¸¸å¤åˆ¶çŠ¶æ€ã€‚ç¼“å†²åŒºçš„å¤§å°è¶Šå¤§ï¼Œslaveç¦»çº¿çš„æ—¶é—´å¯ä»¥æ›´é•¿ï¼Œå¤åˆ¶ç¼“å†²åŒºåªæœ‰åœ¨æœ‰slaveè¿æ¥çš„æ—¶å€™æ‰åˆ†é…å†…å­˜ã€‚æ²¡æœ‰slaveçš„ä¸€æ®µæ—¶é—´ï¼Œå†…å­˜ä¼šè¢«é‡Šæ”¾å‡ºæ¥ï¼Œé»˜è®¤1mã€‚</p><p># repl-backlog-size 5mb</p><p>#masteræ²¡æœ‰slaveä¸€æ®µæ—¶é—´ä¼šé‡Šæ”¾å¤åˆ¶ç¼“å†²åŒºçš„å†…å­˜ï¼Œrepl-backlog-ttlç”¨æ¥è®¾ç½®è¯¥æ—¶é—´é•¿åº¦ã€‚å•ä½ä¸ºç§’ã€‚</p><p># repl-backlog-ttl 3600</p><p>#å½“masterä¸å¯ç”¨ï¼ŒSentinelä¼šæ ¹æ®slaveçš„ä¼˜å…ˆçº§é€‰ä¸¾ä¸€ä¸ªmasterã€‚æœ€ä½çš„ä¼˜å…ˆçº§çš„slaveï¼Œå½“é€‰masterã€‚è€Œé…ç½®æˆ0ï¼Œæ°¸è¿œä¸ä¼šè¢«é€‰ä¸¾ã€‚</p><p>slave-priority 100</p><p>#redisæä¾›äº†å¯ä»¥è®©masteråœæ­¢å†™å…¥çš„æ–¹å¼ï¼Œå¦‚æœé…ç½®äº†min-slaves-to-writeï¼Œå¥åº·çš„slaveçš„ä¸ªæ•°å°äºNï¼Œmaterå°±ç¦æ­¢å†™å…¥ã€‚masteræœ€å°‘å¾—æœ‰å¤šå°‘ä¸ªå¥åº·çš„slaveå­˜æ´»æ‰èƒ½æ‰§è¡Œå†™å‘½ä»¤ã€‚è¿™ä¸ªé…ç½®è™½ç„¶ä¸èƒ½ä¿è¯Nä¸ªslaveéƒ½ä¸€å®šèƒ½æ¥æ”¶åˆ°masterçš„å†™æ“ä½œï¼Œä½†æ˜¯èƒ½é¿å…æ²¡æœ‰è¶³å¤Ÿå¥åº·çš„slaveçš„æ—¶å€™ï¼Œmasterä¸èƒ½å†™å…¥æ¥é¿å…æ•°æ®ä¸¢å¤±ã€‚è®¾ç½®ä¸º0æ˜¯å…³é—­è¯¥åŠŸèƒ½ã€‚</p><p># min-slaves-to-write 3</p><p>#å»¶è¿Ÿå°äºmin-slaves-max-lagç§’çš„slaveæ‰è®¤ä¸ºæ˜¯å¥åº·çš„slaveã€‚</p><p># min-slaves-max-lag 10</p><p># è®¾ç½®1æˆ–å¦ä¸€ä¸ªè®¾ç½®ä¸º0ç¦ç”¨è¿™ä¸ªç‰¹æ€§ã€‚</p><p># Setting one or the other to 0 disables the feature.</p><p># By default min-slaves-to-write is set to 0 (feature disabled) and</p><p># min-slaves-max-lag is set to 10.</p><p>################################## SECURITY ###################################</p><p>#requirepassé…ç½®å¯ä»¥è®©ç”¨æˆ·ä½¿ç”¨AUTHå‘½ä»¤æ¥è®¤è¯å¯†ç ï¼Œæ‰èƒ½ä½¿ç”¨å…¶ä»–å‘½ä»¤ã€‚è¿™è®©rediså¯ä»¥ä½¿ç”¨åœ¨ä¸å—ä¿¡ä»»çš„ç½‘ç»œä¸­ã€‚ä¸ºäº†ä¿æŒå‘åçš„å…¼å®¹æ€§ï¼Œå¯ä»¥æ³¨é‡Šè¯¥å‘½ä»¤ï¼Œå› ä¸ºå¤§éƒ¨åˆ†ç”¨æˆ·ä¹Ÿä¸éœ€è¦è®¤è¯ã€‚ä½¿ç”¨requirepassçš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œå› ä¸ºrediså¤ªå¿«äº†ï¼Œæ¯ç§’å¯ä»¥è®¤è¯15wæ¬¡å¯†ç ï¼Œç®€å•çš„å¯†ç å¾ˆå®¹æ˜“è¢«æ”»ç ´ï¼Œæ‰€ä»¥æœ€å¥½ä½¿ç”¨ä¸€ä¸ªæ›´å¤æ‚çš„å¯†ç ã€‚</p><p># requirepass foobared</p><p>#æŠŠå±é™©çš„å‘½ä»¤ç»™ä¿®æ”¹æˆå…¶ä»–åç§°ã€‚æ¯”å¦‚CONFIGå‘½ä»¤å¯ä»¥é‡å‘½åä¸ºä¸€ä¸ªå¾ˆéš¾è¢«çŒœåˆ°çš„å‘½ä»¤ï¼Œè¿™æ ·ç”¨æˆ·ä¸èƒ½ä½¿ç”¨ï¼Œè€Œå†…éƒ¨å·¥å…·è¿˜èƒ½æ¥ç€ä½¿ç”¨ã€‚</p><p># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</p><p>#è®¾ç½®æˆä¸€ä¸ªç©ºçš„å€¼ï¼Œå¯ä»¥ç¦æ­¢ä¸€ä¸ªå‘½ä»¤</p><p># rename-command CONFIG ""</p><p>################################### LIMITS ####################################</p><p># è®¾ç½®èƒ½è¿ä¸Šredisçš„æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°é‡ã€‚é»˜è®¤æ˜¯10000ä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚</p><p># ç”±äºredisä¸åŒºåˆ†è¿æ¥æ˜¯å®¢æˆ·ç«¯è¿æ¥è¿˜æ˜¯å†…éƒ¨æ‰“å¼€æ–‡ä»¶æˆ–è€…å’Œslaveè¿æ¥ç­‰ï¼Œæ‰€ä»¥maxclientsæœ€å°å»ºè®®è®¾ç½®åˆ°32ã€‚</p><p># å¦‚æœè¶…è¿‡äº†maxclientsï¼Œredisä¼šç»™æ–°çš„è¿æ¥å‘é€â€™max number of clients reachedâ€™ï¼Œå¹¶å…³é—­è¿æ¥ã€‚</p><p># maxclients 10000</p><p># redisé…ç½®çš„æœ€å¤§å†…å­˜å®¹é‡ã€‚å½“å†…å­˜æ»¡äº†ï¼Œéœ€è¦é…åˆmaxmemory-policyç­–ç•¥è¿›è¡Œå¤„ç†ã€‚</p><p># æ³¨æ„slaveçš„è¾“å‡ºç¼“å†²åŒºæ˜¯ä¸è®¡ç®—åœ¨maxmemoryå†…çš„ã€‚æ‰€ä»¥ä¸ºäº†é˜²æ­¢ä¸»æœºå†…å­˜ä½¿ç”¨å®Œï¼Œå»ºè®®è®¾ç½®çš„maxmemoryéœ€è¦æ›´å°ä¸€äº›ã€‚</p><p># maxmemory &lt;bytes></p><p># å†…å­˜å®¹é‡è¶…è¿‡maxmemoryåçš„å¤„ç†ç­–ç•¥ã€‚</p><p># volatile-lruï¼šåˆ©ç”¨LRUç®—æ³•ç§»é™¤è®¾ç½®è¿‡è¿‡æœŸæ—¶é—´çš„keyã€‚</p><p># volatile-randomï¼šéšæœºç§»é™¤è®¾ç½®è¿‡è¿‡æœŸæ—¶é—´çš„keyã€‚</p><p># volatile-ttlï¼šç§»é™¤å³å°†è¿‡æœŸçš„keyï¼Œæ ¹æ®æœ€è¿‘è¿‡æœŸæ—¶é—´æ¥åˆ é™¤ï¼ˆè¾…ä»¥TTLï¼‰</p><p># allkeys-lruï¼šåˆ©ç”¨LRUç®—æ³•ç§»é™¤ä»»ä½•keyã€‚</p><p># allkeys-randomï¼šéšæœºç§»é™¤ä»»ä½•keyã€‚</p><p># noevictionï¼šä¸ç§»é™¤ä»»ä½•keyï¼Œåªæ˜¯è¿”å›ä¸€ä¸ªå†™é”™è¯¯ã€‚</p><p># ä¸Šé¢çš„è¿™äº›é©±é€ç­–ç•¥ï¼Œå¦‚æœredisæ²¡æœ‰åˆé€‚çš„keyé©±é€ï¼Œå¯¹äºå†™å‘½ä»¤ï¼Œè¿˜æ˜¯ä¼šè¿”å›é”™è¯¯ã€‚</p><p># rediså°†ä¸å†æ¥æ”¶å†™è¯·æ±‚ï¼Œåªæ¥æ”¶getè¯·æ±‚ã€‚</p><p># å†™å‘½ä»¤åŒ…æ‹¬ï¼šset setnx setex append incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby getset mset msetnx exec sortã€‚</p><p># maxmemory-policy noeviction</p><p>#lruæ£€æµ‹çš„æ ·æœ¬æ•°ã€‚ä½¿ç”¨lruæˆ–è€…ttlæ·˜æ±°ç®—æ³•ï¼Œä»éœ€è¦æ·˜æ±°çš„åˆ—è¡¨ä¸­éšæœºé€‰æ‹©sampleä¸ªkeyï¼Œé€‰å‡ºé—²ç½®æ—¶é—´æœ€é•¿çš„keyç§»é™¤ã€‚</p><p># maxmemory-samples 5</p><p>############################## APPEND ONLY MODE ###############################</p><p>#é»˜è®¤redisä½¿ç”¨çš„æ˜¯rdbæ–¹å¼æŒä¹…åŒ–ï¼Œè¿™ç§æ–¹å¼åœ¨è®¸å¤šåº”ç”¨ä¸­å·²ç»è¶³å¤Ÿç”¨äº†ã€‚ä½†æ˜¯rediså¦‚æœä¸­é€”å®•æœºï¼Œä¼šå¯¼è‡´å¯èƒ½æœ‰å‡ åˆ†é’Ÿçš„æ•°æ®ä¸¢å¤±ï¼Œæ ¹æ®saveæ¥ç­–ç•¥è¿›è¡ŒæŒä¹…åŒ–ï¼ŒAppend Only Fileæ˜¯å¦ä¸€ç§æŒä¹…åŒ–æ–¹å¼ï¼Œå¯ä»¥æä¾›æ›´å¥½çš„æŒä¹…åŒ–ç‰¹æ€§ã€‚Redisä¼šæŠŠæ¯æ¬¡å†™å…¥çš„æ•°æ®åœ¨æ¥æ”¶åéƒ½å†™å…¥ appendonly.aof æ–‡ä»¶ï¼Œæ¯æ¬¡å¯åŠ¨æ—¶Rediséƒ½ä¼šå…ˆæŠŠè¿™ä¸ªæ–‡ä»¶çš„æ•°æ®è¯»å…¥å†…å­˜é‡Œï¼Œå…ˆå¿½ç•¥RDBæ–‡ä»¶ã€‚</p><p>appendonly no</p><p>#aofæ–‡ä»¶å</p><p>appendfilename "appendonly.aof"</p><p># aofæŒä¹…åŒ–ç­–ç•¥çš„é…ç½®</p><p># noè¡¨ç¤ºä¸æ‰§è¡Œfsyncï¼Œç”±æ“ä½œç³»ç»Ÿä¿è¯æ•°æ®åŒæ­¥åˆ°ç£ç›˜ï¼Œé€Ÿåº¦æœ€å¿«ã€‚</p><p># alwaysè¡¨ç¤ºæ¯æ¬¡å†™å…¥éƒ½æ‰§è¡Œfsyncï¼Œä»¥ä¿è¯æ•°æ®åŒæ­¥åˆ°ç£ç›˜ã€‚</p><p># everysecè¡¨ç¤ºæ¯ç§’æ‰§è¡Œä¸€æ¬¡fsyncï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸¢å¤±è¿™1sæ•°æ®ã€‚</p><p>appendfsync everysec</p><p># åœ¨aofé‡å†™æˆ–è€…å†™å…¥rdbæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œå¤§é‡IOï¼Œ</p><p># æ­¤æ—¶å¯¹äºeverysecå’Œalwaysçš„aofæ¨¡å¼æ¥è¯´ï¼Œæ‰§è¡Œfsyncä¼šé€ æˆé˜»å¡è¿‡é•¿æ—¶é—´ï¼Œ</p><p># no-appendfsync-on-rewriteå­—æ®µè®¾ç½®ä¸ºé»˜è®¤è®¾ç½®ä¸ºnoã€‚</p><p># å¦‚æœå¯¹å»¶è¿Ÿè¦æ±‚å¾ˆé«˜çš„åº”ç”¨ï¼Œè¿™ä¸ªå­—æ®µå¯ä»¥è®¾ç½®ä¸ºyesï¼Œå¦åˆ™è¿˜æ˜¯è®¾ç½®ä¸ºnoï¼Œ</p><p># è¿™æ ·å¯¹æŒä¹…åŒ–ç‰¹æ€§æ¥è¯´è¿™æ˜¯æ›´å®‰å…¨çš„é€‰æ‹©ã€‚è®¾ç½®ä¸ºyesè¡¨ç¤ºrewriteæœŸé—´å¯¹æ–°å†™æ“ä½œä¸fsync,</p><p># æš‚æ—¶å­˜åœ¨å†…å­˜ä¸­,ç­‰rewriteå®Œæˆåå†å†™å…¥ï¼Œé»˜è®¤ä¸ºnoï¼Œå»ºè®®yesã€‚Linuxçš„é»˜è®¤fsyncç­–ç•¥æ˜¯30ç§’ã€‚å¯èƒ½ä¸¢å¤±30ç§’æ•°æ®ã€‚</p><p>no-appendfsync-on-rewrite no</p><p># aofè‡ªåŠ¨é‡å†™é…ç½®ã€‚å½“ç›®å‰aofæ–‡ä»¶å¤§å°è¶…è¿‡ä¸Šä¸€æ¬¡é‡å†™çš„aofæ–‡ä»¶å¤§å°çš„ç™¾åˆ†ä¹‹å¤šå°‘è¿›è¡Œé‡å†™ï¼Œ</p><p># å³å½“aofæ–‡ä»¶å¢é•¿åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™Redisèƒ½å¤Ÿè°ƒç”¨bgrewriteaofå¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œé‡å†™ã€‚</p><p># å½“å‰AOFæ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡æ—¥å¿—é‡å†™å¾—åˆ°AOFæ–‡ä»¶å¤§å°çš„äºŒå€ï¼ˆè®¾ç½®ä¸º100ï¼‰æ—¶ï¼Œè‡ªåŠ¨å¯åŠ¨æ–°çš„æ—¥å¿—é‡å†™è¿‡ç¨‹ã€‚</p><p>auto-aof-rewrite-percentage 100</p><p>#è®¾ç½®å…è®¸é‡å†™çš„æœ€å°aofæ–‡ä»¶å¤§å°ï¼Œé¿å…äº†è¾¾åˆ°çº¦å®šç™¾åˆ†æ¯”ä½†å°ºå¯¸ä»ç„¶å¾ˆå°çš„æƒ…å†µè¿˜è¦é‡å†™</p><p>auto-aof-rewrite-min-size 64mb</p><p># aofæ–‡ä»¶å¯èƒ½åœ¨å°¾éƒ¨æ˜¯ä¸å®Œæ•´çš„ï¼Œå½“rediså¯åŠ¨çš„æ—¶å€™ï¼Œaofæ–‡ä»¶çš„æ•°æ®è¢«è½½å…¥å†…å­˜ã€‚</p><p># é‡å¯å¯èƒ½å‘ç”Ÿåœ¨redisæ‰€åœ¨çš„ä¸»æœºæ“ä½œç³»ç»Ÿå®•æœºåï¼Œ</p><p># å°¤å…¶åœ¨ext4æ–‡ä»¶ç³»ç»Ÿæ²¡æœ‰åŠ ä¸Šdata=orderedé€‰é¡¹ï¼ˆrediså®•æœºæˆ–è€…å¼‚å¸¸ç»ˆæ­¢ä¸ä¼šé€ æˆå°¾éƒ¨ä¸å®Œæ•´ç°è±¡ã€‚ï¼‰</p><p># å‡ºç°è¿™ç§ç°è±¡ï¼Œå¯ä»¥é€‰æ‹©è®©redisé€€å‡ºï¼Œæˆ–è€…å¯¼å…¥å°½å¯èƒ½å¤šçš„æ•°æ®ã€‚å¦‚æœé€‰æ‹©çš„æ˜¯yesï¼Œ</p><p># å½“æˆªæ–­çš„aofæ–‡ä»¶è¢«å¯¼å…¥çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å‘å¸ƒä¸€ä¸ªlogç»™å®¢æˆ·ç«¯ç„¶åloadã€‚å¦‚æœæ˜¯noï¼Œç”¨æˆ·å¿…é¡»æ‰‹åŠ¨redis-check-aofä¿®å¤AOFæ–‡ä»¶æ‰å¯ä»¥ã€‚</p><p>aof-load-truncated yes</p><p>################################ LUA SCRIPTING ###############################</p><p># å¦‚æœè¾¾åˆ°æœ€å¤§æ—¶é—´é™åˆ¶ï¼ˆæ¯«ç§’ï¼‰ï¼Œredisä¼šè®°ä¸ªlogï¼Œç„¶åè¿”å›errorã€‚</p><p># å½“ä¸€ä¸ªè„šæœ¬è¶…è¿‡äº†æœ€å¤§æ—¶é™ã€‚</p><p># åªæœ‰SCRIPT KILLå’ŒSHUTDOWN NOSAVEå¯ä»¥ç”¨ã€‚</p><p># ç¬¬ä¸€ä¸ªå¯ä»¥æ€æ²¡æœ‰è°ƒwriteå‘½ä»¤çš„ä¸œè¥¿ã€‚è¦æ˜¯å·²ç»è°ƒç”¨äº†writeï¼Œåªèƒ½ç”¨ç¬¬äºŒä¸ªå‘½ä»¤æ€ã€‚</p><p>lua-time-limit 5000</p><p>################################ REDIS CLUSTER ###############################</p><p># é›†ç¾¤å¼€å…³ï¼Œé»˜è®¤æ˜¯ä¸å¼€å¯é›†ç¾¤æ¨¡å¼ã€‚</p><p># cluster-enabled yes</p><p># é›†ç¾¤é…ç½®æ–‡ä»¶çš„åç§°ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªé›†ç¾¤ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼ŒæŒä¹…åŒ–ä¿å­˜é›†ç¾¤çš„ä¿¡æ¯ã€‚</p><p># è¿™ä¸ªæ–‡ä»¶å¹¶ä¸éœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶æœ‰Redisç”Ÿæˆå¹¶æ›´æ–°ï¼Œæ¯ä¸ªRedisé›†ç¾¤èŠ‚ç‚¹éœ€è¦ä¸€ä¸ªå•ç‹¬çš„é…ç½®æ–‡ä»¶ï¼Œ</p><p># è¯·ç¡®ä¿ä¸å®ä¾‹è¿è¡Œçš„ç³»ç»Ÿä¸­é…ç½®æ–‡ä»¶åç§°ä¸å†²çª</p><p># cluster-config-file nodes-6379.conf</p><p># èŠ‚ç‚¹äº’è¿è¶…æ—¶çš„é˜€å€¼ã€‚é›†ç¾¤èŠ‚ç‚¹è¶…æ—¶æ¯«ç§’æ•°</p><p># cluster-node-timeout 15000</p><p># åœ¨è¿›è¡Œæ•…éšœè½¬ç§»çš„æ—¶å€™ï¼Œå…¨éƒ¨slaveéƒ½ä¼šè¯·æ±‚ç”³è¯·ä¸ºmasterï¼Œä½†æ˜¯æœ‰äº›slaveå¯èƒ½ä¸masteræ–­å¼€è¿æ¥ä¸€æ®µæ—¶é—´äº†ï¼Œ</p><p># å¯¼è‡´æ•°æ®è¿‡äºé™ˆæ—§ï¼Œè¿™æ ·çš„slaveä¸åº”è¯¥è¢«æå‡ä¸ºmasterã€‚è¯¥å‚æ•°å°±æ˜¯ç”¨æ¥åˆ¤æ–­slaveèŠ‚ç‚¹ä¸masteræ–­çº¿çš„æ—¶é—´æ˜¯å¦è¿‡é•¿ã€‚åˆ¤æ–­æ–¹æ³•æ˜¯ï¼š</p><p># æ¯”è¾ƒslaveæ–­å¼€è¿æ¥çš„æ—¶é—´å’Œ(node-timeout * slave-validity-factor) + repl-ping-slave-period</p><p># å¦‚æœèŠ‚ç‚¹è¶…æ—¶æ—¶é—´ä¸ºä¸‰åç§’, å¹¶ä¸”slave-validity-factorä¸º10,å‡è®¾é»˜è®¤çš„repl-ping-slave-periodæ˜¯10ç§’ï¼Œ</p><p># å³å¦‚æœè¶…è¿‡310ç§’slaveå°†ä¸ä¼šå°è¯•è¿›è¡Œæ•…éšœè½¬ç§»</p><p># cluster-slave-validity-factor 10</p><p># masterçš„slaveæ•°é‡å¤§äºè¯¥å€¼ï¼Œslaveæ‰èƒ½è¿ç§»åˆ°å…¶ä»–å­¤ç«‹masterä¸Šï¼Œ</p><p># å¦‚è¿™ä¸ªå‚æ•°è‹¥è¢«è®¾ä¸º2ï¼Œé‚£ä¹ˆåªæœ‰å½“ä¸€ä¸ªä¸»èŠ‚ç‚¹æ‹¥æœ‰2 ä¸ªå¯å·¥ä½œçš„ä»èŠ‚ç‚¹æ—¶ï¼Œå®ƒçš„ä¸€ä¸ªä»èŠ‚ç‚¹ä¼šå°è¯•è¿ç§»ã€‚</p><p># cluster-migration-barrier 1</p><p># é»˜è®¤æƒ…å†µä¸‹ï¼Œé›†ç¾¤å…¨éƒ¨çš„slotæœ‰èŠ‚ç‚¹è´Ÿè´£ï¼Œé›†ç¾¤çŠ¶æ€æ‰ä¸ºokï¼Œæ‰èƒ½æä¾›æœåŠ¡ã€‚</p><p># è®¾ç½®ä¸ºnoï¼Œå¯ä»¥åœ¨slotæ²¡æœ‰å…¨éƒ¨åˆ†é…çš„æ—¶å€™æä¾›æœåŠ¡ã€‚</p><p># ä¸å»ºè®®æ‰“å¼€è¯¥é…ç½®ï¼Œè¿™æ ·ä¼šé€ æˆåˆ†åŒºçš„æ—¶å€™ï¼Œå°åˆ†åŒºçš„masterä¸€ç›´åœ¨æ¥å—å†™è¯·æ±‚ï¼Œè€Œé€ æˆå¾ˆé•¿æ—¶é—´æ•°æ®ä¸ä¸€è‡´ã€‚</p><p># cluster-require-full-coverage yes</p><p>################################## SLOW LOG ###################################</p><p>###slog logæ˜¯ç”¨æ¥è®°å½•redisè¿è¡Œä¸­æ‰§è¡Œæ¯”è¾ƒæ…¢çš„å‘½ä»¤è€—æ—¶ã€‚å½“å‘½ä»¤çš„æ‰§è¡Œè¶…è¿‡äº†æŒ‡å®šæ—¶é—´ï¼Œå°±è®°å½•åœ¨slow logä¸­ï¼Œslog logä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥æ²¡æœ‰IOæ“ä½œã€‚</p><p>#æ‰§è¡Œæ—¶é—´æ¯”slowlog-log-slower-thanå¤§çš„è¯·æ±‚è®°å½•åˆ°slowlogé‡Œé¢ï¼Œå•ä½æ˜¯å¾®ç§’ï¼Œæ‰€ä»¥1000000å°±æ˜¯1ç§’ã€‚æ³¨æ„ï¼Œè´Ÿæ•°æ—¶é—´ä¼šç¦ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè€Œ0åˆ™ä¼šå¼ºåˆ¶è®°å½•æ‰€æœ‰å‘½ä»¤ã€‚</p><p>slowlog-log-slower-than 10000</p><p>#æ…¢æŸ¥è¯¢æ—¥å¿—é•¿åº¦ã€‚å½“ä¸€ä¸ªæ–°çš„å‘½ä»¤è¢«å†™è¿›æ—¥å¿—çš„æ—¶å€™ï¼Œæœ€è€çš„é‚£ä¸ªè®°å½•ä¼šè¢«åˆ æ‰ã€‚è¿™ä¸ªé•¿åº¦æ²¡æœ‰é™åˆ¶ã€‚åªè¦æœ‰è¶³å¤Ÿçš„å†…å­˜å°±è¡Œã€‚ä½ å¯ä»¥é€šè¿‡ SLOWLOG RESET æ¥é‡Šæ”¾å†…å­˜ã€‚</p><p>slowlog-max-len 128</p><p>################################ LATENCY MONITOR ##############################</p><p>#å»¶è¿Ÿç›‘æ§åŠŸèƒ½æ˜¯ç”¨æ¥ç›‘æ§redisä¸­æ‰§è¡Œæ¯”è¾ƒç¼“æ…¢çš„ä¸€äº›æ“ä½œï¼Œç”¨LATENCYæ‰“å°rediså®ä¾‹åœ¨è·‘å‘½ä»¤æ—¶çš„è€—æ—¶å›¾è¡¨ã€‚åªè®°å½•å¤§äºç­‰äºä¸‹è¾¹è®¾ç½®çš„å€¼çš„æ“ä½œã€‚0çš„è¯ï¼Œå°±æ˜¯å…³é—­ç›‘è§†ã€‚é»˜è®¤å»¶è¿Ÿç›‘æ§åŠŸèƒ½æ˜¯å…³é—­çš„ï¼Œå¦‚æœä½ éœ€è¦æ‰“å¼€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡CONFIG SETå‘½ä»¤åŠ¨æ€è®¾ç½®ã€‚</p><p>latency-monitor-threshold 0</p><p>############################# EVENT NOTIFICATION ##############################</p><p>#é”®ç©ºé—´é€šçŸ¥ä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è®¢é˜…é¢‘é“æˆ–æ¨¡å¼ï¼Œæ¥æ¥æ”¶é‚£äº›ä»¥æŸç§æ–¹å¼æ”¹åŠ¨äº† Redis æ•°æ®é›†çš„äº‹ä»¶ã€‚å› ä¸ºå¼€å¯é”®ç©ºé—´é€šçŸ¥åŠŸèƒ½éœ€è¦æ¶ˆè€—ä¸€äº› CPU ï¼Œæ‰€ä»¥åœ¨é»˜è®¤é…ç½®ä¸‹ï¼Œè¯¥åŠŸèƒ½å¤„äºå…³é—­çŠ¶æ€ã€‚</p><p>#notify-keyspace-events çš„å‚æ•°å¯ä»¥æ˜¯ä»¥ä¸‹å­—ç¬¦çš„ä»»æ„ç»„åˆï¼Œå®ƒæŒ‡å®šäº†æœåŠ¡å™¨è¯¥å‘é€å“ªäº›ç±»å‹çš„é€šçŸ¥ï¼š</p><p>##K é”®ç©ºé—´é€šçŸ¥ï¼Œæ‰€æœ‰é€šçŸ¥ä»¥ __keyspace@__ ä¸ºå‰ç¼€</p><p>##E é”®äº‹ä»¶é€šçŸ¥ï¼Œæ‰€æœ‰é€šçŸ¥ä»¥ __keyevent@__ ä¸ºå‰ç¼€</p><p>##g DEL ã€ EXPIRE ã€ RENAME ç­‰ç±»å‹æ— å…³çš„é€šç”¨å‘½ä»¤çš„é€šçŸ¥</p><p>##$ å­—ç¬¦ä¸²å‘½ä»¤çš„é€šçŸ¥</p><p>##l åˆ—è¡¨å‘½ä»¤çš„é€šçŸ¥</p><p>##s é›†åˆå‘½ä»¤çš„é€šçŸ¥</p><p>##h å“ˆå¸Œå‘½ä»¤çš„é€šçŸ¥</p><p>##z æœ‰åºé›†åˆå‘½ä»¤çš„é€šçŸ¥</p><p>##x è¿‡æœŸäº‹ä»¶ï¼šæ¯å½“æœ‰è¿‡æœŸé”®è¢«åˆ é™¤æ—¶å‘é€</p><p>##e é©±é€(evict)äº‹ä»¶ï¼šæ¯å½“æœ‰é”®å› ä¸º maxmemory æ”¿ç­–è€Œè¢«åˆ é™¤æ—¶å‘é€</p><p>##A å‚æ•° g$lshzxe çš„åˆ«å</p><p>#è¾“å…¥çš„å‚æ•°ä¸­è‡³å°‘è¦æœ‰ä¸€ä¸ª K æˆ–è€… Eï¼Œå¦åˆ™çš„è¯ï¼Œä¸ç®¡å…¶ä½™çš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸ä¼šæœ‰ä»»ä½• é€šçŸ¥è¢«åˆ†å‘ã€‚è¯¦ç»†ä½¿ç”¨å¯ä»¥å‚è€ƒhttp://redis.io/topics/notifications</p><p>notify-keyspace-events "KEA"</p><p>############################### ADVANCED CONFIG ###############################</p><p># æ•°æ®é‡å°äºç­‰äºhash-max-ziplist-entriesçš„ç”¨ziplistï¼Œå¤§äºhash-max-ziplist-entriesç”¨hash</p><p>hash-max-ziplist-entries 512</p><p># valueå¤§å°å°äºç­‰äºhash-max-ziplist-valueçš„ç”¨ziplistï¼Œå¤§äºhash-max-ziplist-valueç”¨hashã€‚</p><p>hash-max-ziplist-value 64</p><p># æ•°æ®é‡å°äºç­‰äºlist-max-ziplist-entriesç”¨ziplistï¼Œå¤§äºlist-max-ziplist-entriesç”¨listã€‚</p><p>list-max-ziplist-entries 512</p><p># valueå¤§å°å°äºç­‰äºlist-max-ziplist-valueçš„ç”¨ziplistï¼Œå¤§äºlist-max-ziplist-valueç”¨listã€‚</p><p>list-max-ziplist-value 64</p><p># æ•°æ®é‡å°äºç­‰äºset-max-intset-entriesç”¨inisetï¼Œå¤§äºset-max-intset-entriesç”¨setã€‚</p><p>set-max-intset-entries 512</p><p># æ•°æ®é‡å°äºç­‰äºzset-max-ziplist-entriesç”¨ziplistï¼Œå¤§äºzset-max-ziplist-entriesç”¨zsetã€‚</p><p>zset-max-ziplist-entries 128</p><p># valueå¤§å°å°äºç­‰äºzset-max-ziplist-valueç”¨ziplistï¼Œå¤§äºzset-max-ziplist-valueç”¨zsetã€‚</p><p>zset-max-ziplist-value 64</p><p># valueå¤§å°å°äºç­‰äºhll-sparse-max-bytesä½¿ç”¨ç¨€ç–æ•°æ®ç»“æ„ï¼ˆsparseï¼‰ï¼Œ</p><p># å¤§äºhll-sparse-max-bytesä½¿ç”¨ç¨ å¯†çš„æ•°æ®ç»“æ„ï¼ˆdenseï¼‰ã€‚</p><p># ä¸€ä¸ªæ¯”16000å¤§çš„valueæ˜¯å‡ ä¹æ²¡ç”¨çš„ï¼Œå»ºè®®çš„valueå¤§æ¦‚ä¸º3000ã€‚</p><p># å¦‚æœå¯¹CPUè¦æ±‚ä¸é«˜ï¼Œå¯¹ç©ºé—´è¦æ±‚è¾ƒé«˜çš„ï¼Œå»ºè®®è®¾ç½®åˆ°10000å·¦å³ã€‚</p><p>hll-sparse-max-bytes 3000</p><p># Rediså°†åœ¨æ¯100æ¯«ç§’æ—¶ä½¿ç”¨1æ¯«ç§’çš„CPUæ—¶é—´æ¥å¯¹redisçš„hashè¡¨è¿›è¡Œé‡æ–°hashï¼Œå¯ä»¥é™ä½å†…å­˜çš„ä½¿ç”¨ã€‚</p><p># å½“ä½ çš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œæœ‰éå¸¸ä¸¥æ ¼çš„å®æ—¶æ€§éœ€è¦ï¼Œä¸èƒ½å¤Ÿæ¥å—Redisæ—¶ä¸æ—¶çš„å¯¹è¯·æ±‚æœ‰2æ¯«ç§’çš„å»¶è¿Ÿçš„è¯ï¼ŒæŠŠè¿™é¡¹é…ç½®ä¸ºnoã€‚</p><p># å¦‚æœæ²¡æœ‰è¿™ä¹ˆä¸¥æ ¼çš„å®æ—¶æ€§è¦æ±‚ï¼Œå¯ä»¥è®¾ç½®ä¸ºyesï¼Œä»¥ä¾¿èƒ½å¤Ÿå°½å¯èƒ½å¿«çš„é‡Šæ”¾å†…å­˜ã€‚</p><p>activerehashing yes</p><p># å¯¹å®¢æˆ·ç«¯è¾“å‡ºç¼“å†²è¿›è¡Œé™åˆ¶å¯ä»¥å¼ºè¿«é‚£äº›ä¸ä»æœåŠ¡å™¨è¯»å–æ•°æ®çš„å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ï¼Œç”¨æ¥å¼ºåˆ¶å…³é—­ä¼ è¾“ç¼“æ…¢çš„å®¢æˆ·ç«¯ã€‚</p><p># å¯¹äºnormal clientï¼Œç¬¬ä¸€ä¸ª0è¡¨ç¤ºå–æ¶ˆhard limitï¼Œç¬¬äºŒä¸ª0å’Œç¬¬ä¸‰ä¸ª0è¡¨ç¤ºå–æ¶ˆsoft limitï¼Œnormal clienté»˜è®¤å–æ¶ˆé™åˆ¶ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰å¯»é—®ï¼Œä»–ä»¬æ˜¯ä¸ä¼šæ¥æ”¶æ•°æ®çš„ã€‚</p><p>client-output-buffer-limit normal 0 0 0</p><p># å¯¹äºslave clientå’ŒMONITER clientï¼Œå¦‚æœclient-output-bufferä¸€æ—¦è¶…è¿‡256mbï¼Œåˆæˆ–è€…è¶…è¿‡64mbæŒç»­60ç§’ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šç«‹å³æ–­å¼€å®¢æˆ·ç«¯è¿æ¥ã€‚</p><p>client-output-buffer-limit slave 256mb 64mb 60</p><p># å¯¹äºpubsub clientï¼Œå¦‚æœclient-output-bufferä¸€æ—¦è¶…è¿‡32mbï¼Œåˆæˆ–è€…è¶…è¿‡8mbæŒç»­60ç§’ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šç«‹å³æ–­å¼€å®¢æˆ·ç«¯è¿æ¥ã€‚</p><p>client-output-buffer-limit pubsub 32mb 8mb 60</p><p># redisæ‰§è¡Œä»»åŠ¡çš„é¢‘ç‡ä¸º1sé™¤ä»¥hzã€‚</p><p>hz 10</p><p># åœ¨aofé‡å†™çš„æ—¶å€™ï¼Œå¦‚æœæ‰“å¼€äº†aof-rewrite-incremental-fsyncå¼€å…³ï¼Œç³»ç»Ÿä¼šæ¯32MBæ‰§è¡Œä¸€æ¬¡fsyncã€‚è¿™å¯¹äºæŠŠæ–‡ä»¶å†™å…¥ç£ç›˜æ˜¯æœ‰å¸®åŠ©çš„ï¼Œå¯ä»¥é¿å…è¿‡å¤§çš„å»¶è¿Ÿå³°å€¼ã€‚</p><p>aof-rewrite-incremental-fsync yes</p><p>10åˆ†é’Ÿåè¿›é˜¶å‚è€ƒï¼š</p><p><a class=pgc-link href="https://www.toutiao.com/i6607303031492968973/?group_id=6607303031492968973" target=_blank>RedisåŸºç¡€å¼€å‘ç¯å¢ƒæ­å»º</a>ï¼›</p><p><a class=pgc-link href="https://www.toutiao.com/i6675301040037822983/?group_id=6675301040037822983" target=_blank>å¿«é€Ÿè®¤è¯†Redisæ•°æ®åº“</a>ï¼›</p><p><a class=pgc-link href="https://www.toutiao.com/i6673093598772199948/?group_id=6673093598772199948" target=_blank>åŸºæœ¬æå®šRedisæ•°æ®åº“</a>ï¼›</p><p><a class=pgc-link href="https://www.toutiao.com/i6691590455001350664/?group_id=6691590455001350664" target=_blank>Redisé«˜å¯ç”¨åŸç†å›¾è§£</a>ï¼›</p><p><a class=pgc-link href="https://www.toutiao.com/i6653672634510737934/?group_id=6653672634510737934" target=_blank>ç†è§£Redisä¸»ä»åŒæ­¥</a>ï¼›</p><p><a class=pgc-link href="https://www.toutiao.com/i6606571678430396936/?group_id=6606571678430396936" target=_blank>é«˜å¯ç”¨Redisè§£å†³æ–¹æ¡ˆ</a>ï¼›</p><p><a class=pgc-link href="https://www.toutiao.com/i6769566504800223748/?group_id=6769566504800223748" target=_blank>Redisä»å…¥é—¨åˆ°ç²¾é€š</a>ï¼›</p><p><a class=pgc-link href="https://www.toutiao.com/i6771709610605675012/?group_id=6771709610605675012" target=_blank>Redis å¸¸è§è¯•é¢˜</a>ï¼›ä»¥åŠ <a class=pgc-link href="https://www.toutiao.com/i6609636411266040324/?group_id=6609636411266040324" target=_blank>50é“åŠ©å­¦é¢˜ </a>ï¼›</p><p><a class=pgc-link href="https://www.toutiao.com/i6701593489529897480/?group_id=6701593489529897480" target=_blank>Memcacheä¸RedisåŸç†å¯¹æ¯”</a>ã€‚</p><p><a class=pgc-link href="https://www.toutiao.com/i6607997901614350851/?group_id=6607997901614350851" target=_blank>Redisä¸Javaæ•´åˆæ¡ˆä¾‹å®æˆ˜</a>ã€‚</p><p>åŸºæœ¬ä¸Šä½ éœ€è¦çš„NoSQLæ•°æ®åº“Redisè¿™é‡ŒåŸºæœ¬éƒ½æœ‰äº†ï¼ŒèŠ±ç‚¹æ—¶é—´æŒæ¡ä¸€ä¸‹å§ã€‚</p><p>æœ€åï¼Œä½ <strong>å°±æ”¶ä¸ªè—ã€ç‚¹ç‚¹èµã€è½¬å‘åˆ†äº«</strong>é¡ºæ‰‹æå®šå§ ^_^</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'æ–‡æœ«','ç»¼åˆ','å…¥é—¨'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>