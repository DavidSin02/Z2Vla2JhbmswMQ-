<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线 | 极客快訊</title><meta property="og:title" content="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/30802044436747b99233181a03ed93c8"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/915196f6.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/915196f6.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/915196f6.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/915196f6.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/915196f6.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/915196f6.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/915196f6.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/915196f6.html><meta property="article:published_time" content="2020-10-29T21:11:50+08:00"><meta property="article:modified_time" content="2020-10-29T21:11:50+08:00"><meta name=Keywords content><meta name=description content="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/915196f6.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p class=ql-align-center><br></p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/30802044436747b99233181a03ed93c8><p class=pgc-img-caption></p></div><blockquote><p>天线一直是业余无线电活动中最热门的话题，也是无线电爱好者最常自制的器材之一。天线的好坏直接影响无线电通讯系统的收发效果和通讯距离。业余无线电台具有发射功率小、收发共用同一天线和天线架设条件简陋等特点，更加要求合理地选用适当的天线以达到更好的通讯效果。</p><p>天线总输入功率的比值，称该天线的最大增益系数。它是比天线方向性系数更全面的反映天线对总的射频功率的有效利用程度。并用分贝数表示。可以用数学推证，天线最大增益系数等于天线方向性系数和天线效率的乘积。</p><p>对于任何一类天线，下一步是决定极化方向。通常是水平极化和垂直极化的某一种。水平极化意味着天线辐射单元平行于地面被安装，而垂直极化的天线振子垂直于地面。</p><p><strong>构建磁环天线:</strong>天线具有多种形状和尺寸，具有多种特性，这样可以与各种应用场合相匹配。火腿们可能熟悉跟踪天线，八木和偶极子，但是有更多的负载。 本文作者Eric正在走一条适合自己的路，他打造的这款自调谐磁环天线值得一看。</p></blockquote><h1 class=ql-align-justify><strong>Eric打造的一款业余无线电环形天线</strong></h1><p class=ql-align-justify>我一直在试验我家周围用于业余无线电台的各种天线装置。由于我们处于太阳黑子传播周期的底部，因此现在传播极差，因此如果您想要听到对方的通联，拥有一款有效且高效的天线是很重要的。</p><p class=ql-align-justify>我遇到的一种天线似乎既有趣又独特，这就是磁环天线。这类天线的构造通常是由导电材料环构成，环的两端封闭。在两端之间的空间中，放置调谐可变电容器以在特定频率下谐振。</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1b5ec3c2e7c6484b85b2408fbf1811ec><p class=pgc-img-caption></p></div><p class=ql-align-justify>磁环通常是极高Q设备，可在非常窄的范围内进行调谐。这种狭窄的工作范围意味着天线自然会提供一定程度的选择性，但它需要经常重新调谐。将频率改变甚至2-3kHz可以使您脱离天线的工作频段。</p><p class=ql-align-justify>我希望环形天线在20米处工作良好，而且为了方便，我想用铜管（0.75“外径，10英尺长）组装它。我还希望能够工作到100W。</p><h1 class=ql-align-justify><strong>把这些参数进入计算器，得到以下结果：</strong></h1><blockquote><p>天线效率：60％（低于100％时为-2.2 dB）天线带宽：18.9 kHz调谐电容：62 pF电容器电压：3,687伏特RMS谐振循环电流：20.1A抗辐射：0.074欧姆耐损耗：0.050欧姆电感：2.08 微亨感应电抗：183欧姆品质因数（Q）：742分布式容量：8 pF</p></blockquote><p class=ql-align-justify>看电容电压接近4kV？使用<span>空芯</span>电容器时，高电压可能会引起电容器鳍片的电弧放电。有一些方法可以避免这种情况（增加间距，浸入油中），但常见的方法是使用真空可变电容器。</p><p class=ql-align-justify><strong>我从ebay得到了以下型号：Comet CVBA-500BC：</strong></p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/846a88cee0004d0d9fe42127c70663b3><p class=pgc-img-caption></p></div><p class=ql-align-justify>该电容的调谐范围为5-500pf，最大电压为5kV，峰值工作电流为57A。</p><p class=ql-align-justify>我设计并3D打印了一个用于可变电容器的塑料支架。我还打印了一个齿轮式步进电机，铜管的安装点和塑料件，将环安装到木销上。</p><p class=ql-align-justify><strong>3D打印件看起来像这样：</strong></p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f9d53016cf574f97b4c0428894c1e7a3><p class=pgc-img-caption></p></div><p class=ql-align-justify>组装好的天线看起来应该是Fusion360的渲染：</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b351d498bdc14c66bd0a51f7a9c9aef6><p class=pgc-img-caption></p></div><p class=ql-align-justify>如果您想对设计进行任何更改或自行打印，我将在此处分享Fusion 360项目：https://a360.co/2TtVUop。</p><p class=ql-align-justify>许多人使用铜管和45度角连接器组装环形天线以形成八角形。这足够接近一个圆圈，但会给环路带来一些电阻。我想将一块铜弯成一个连续的环，以减少环路的电阻。</p><p class=ql-align-justify>我从Home Depot购买10英尺长的铜管并试图让当地一家消声器商店看看是否能把它弯曲成一个环，但谈过的两家商店都表示他们不能或不愿意弯曲铜环。</p><p class=ql-align-justify>迫不得已，我买了一个像这样的导管弯管机（电台小叔表示：土豪啊，一言不合就买设备啊！）。通过沿着环的长度标记相等的空间并且一次弯曲一点，我能够将铜弯曲成环。不幸的是，当我弯曲时，铜变得非常脆并且倾向于弯曲。 （它看起来更像是一个20边的多边形而不是一个圆形）。</p><p class=ql-align-justify>众所周知，铜会变硬。这意味着当铜弯曲并形成不同的形状时，铜变得更脆并且更不具有延展性。退火是将铜加热到内部应力消除并且铜准备好再次形成的过程。退火铜很简单，我买了一个喷灯，加热了整个铜的长度，直到它发出红光。对于10英尺长的管道，我能够在几分钟内加热整个管道长度。</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/04923c88fac4437eac6778bc74af1049><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5188427167ec46fdbe816abe296151df><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/95bcb66505674ebb9fd64103849822e9><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8c979797a1204d15bed33cb3f30c4c64><p class=pgc-img-caption></p></div><p class=ql-align-justify>在退火过程之后，铜会改变颜色并变得更容易弯曲。</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6c4ba06747fe4274aaddba048be9776a><p class=pgc-img-caption></p></div><p class=ql-align-justify>顶部图像退火，底部图像直接来自Home Depot。</p><p class=ql-align-justify>退火后，我可以轻松地用手将铜折叠成一个环。令人瞩目的是它与众不同之处。</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0ae022f3d2e24b729c28ceff6b09d60f><p class=pgc-img-caption></p></div><p class=ql-align-justify>稍微小心一点，我想我可以得到一个近乎完美的天线圈。</p><p class=ql-align-justify>如果您正在制作自己的环形天线，我建议在弯曲之前使用喷灯来加热铜管。在弯曲过程中，铜将更容易弯曲并且弯曲度更小。</p><p class=ql-align-justify>下一步，我想制作（可能是3D打印）一系列三个滚轮，这将让我将铜管弯曲到特定的半径。</p><p class=ql-align-justify>我完成了环形天线的组装并首次对它进行了一些测试。到目前为止，结果看起来很棒。</p><p class=ql-align-justify>接下来继续组装，首先，我将塑料夹块拧到铜环的两端：</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8bd1274ee865441484b6b9995fd906a3><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f2c6f9e18a654d25827ec1970951e972><p class=pgc-img-caption></p></div><p class=ql-align-justify>我在汽车商店买了6个awg铜卷。我将约10个awg线的末端折成两半，然后将夹子敲到线上以形成牢固的连接。在铜管上钻一个足以容纳M5螺钉的孔，夹子牢固地连接在一起。</p><p class=ql-align-justify>10awg铜线夹在电容器的金属板和塑料盖件之间。三个m3x12螺钉用于牢固地夹紧电线并保持牢固的连接。</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c97adc9bddc44d5fa55a3cad300c6f88><p class=pgc-img-caption></p></div><p class=ql-align-justify>天线设计安装在一个1.25英寸的木钉上。我从港口货运中购买了两个48英寸的木钉，用3D打印塑料对接接头来连接两者。当天线在外面时，我仍然需要决定用作基座的东西。</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2dced5e00b9c40e0970a291be7be8942><p class=pgc-img-caption></p></div><p class=ql-align-justify>驱动环由大约2英尺的10awg电线组成，绝缘完好无损。</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/df88c148e13f4b5abb290aaddc163cbe><p class=pgc-img-caption></p></div><p class=ql-align-justify>在没有调整电容的情况下（它介于调谐范围的两个极端之间），我连接了FA-VA5天线分析仪进行了一些SWR扫描测量。第一次扫描看起来很令人鼓舞，在SWR降至1.5以下的特定频率下，显然存在强烈的窄谐振。</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0754d4f031fc4a05aa684603006ca384><p class=pgc-img-caption></p></div><p class=ql-align-justify>在对电容器进行了一些调整之后，我能够将天线“调谐”到14MHz。调整非常敏感！电容器的四分之一圈可对调谐频率产生显著的影响。我认为步进电机的齿轮减速可能最终会有所帮助。我真的很高兴看到SWR下降到1.0 ，希望这意味着我会从天线上获得一些好的结果。</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d6f09568c42549b090430a748198c75e><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ec4ff8e67d734516855e0be7f91aef95><p class=pgc-img-caption></p></div><p class=ql-align-justify><strong>接下来的步骤是尝试测试天线，然后开始使用自动调谐器电路。</strong></p><p class=ql-align-justify>我开始研究磁环天线的自动调谐器。我将按以下顺序实现各种功能块：</p><blockquote><p>1.电机控制和归位2. SWR测量3.寻求存储历史和快速调整的算法</p></blockquote><h1 class=ql-align-justify><strong>组件选择：</strong></h1><p class=ql-align-justify>我计划在这个项目中使用STM32F401 mcu。我之所以选择这个，是因为我知道它具有足够的处理能力，我已经有一些NUCLEO评估板，我熟悉工具链。</p><p class=ql-align-justify>我正在为该项目使用“SilentStepStick”步进电机驱动器。这与基于Allegro A4XXX芯片的Pololu步进驱动器类似（并且可以引脚分隔）。</p><p class=ql-align-justify>SilentStepStick基于TMC2130芯片，并且通过串行接口暴露了一些额外的功能，我认为这些功能非常有用。</p><p class=ql-align-justify>特别是，存在称为“失速检测”的特征，其检测电动机上的负载何时突然改变。这可用于在不使用机械限位器的情况下“回家”系统（这是在Prusa i3 MK3打印机上完成的）。我打算在启动时使用失速检测“归位”可变电容。可变电容器是一个多圈电容器，在旋转的一端有一个硬停止。没有Stepstick就很难回家，因为很难确定多圈调整的哪一圈是最后一圈。通过失速检测功能，我可以向一个方向转动电机，直到调节螺丝达到最低点并检测失速发生的点。这一点将成为允许在动力循环之间比较位置数据的原始位置。我需要对此进行描述才能看出它是多么可重复，但根据我对Prusa i3打印机的经验，我认为它将足够一致。</p><p class=ql-align-justify>SilentStepSticks可在Digikey定期购买和库存。顺便提一下，它们为您的3D打印机做了很好的升级，正如其名称所暗示的那样，它们使步进电机更加安静。</p><h1 class=ql-align-justify><strong>初始电机驱动器原型：</strong></h1><p class=ql-align-justify>作为第一步，我想将步进驱动器连接到NUCLEO-F401RE评估板并获得一些基本的电机操作。我正在使用STM32CubeMx为项目创建初始配置。该软件为各种NUCLEO板提供了一些预先配置的选项，因此可以非常快速地启动项目。</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8006a186e65e4c748093f887e5bbc8ba><p class=pgc-img-caption></p></div><p class=ql-align-justify><strong>我在STM32CubeMX中使用以下配置选项：</strong></p><p class=ql-align-justify>SPI1配置为全双工主机，时钟极性高。使用引脚PA5（SCK），PA6（MISO），PA7（MOSI）我必须移除PA5的GPIO输出功能，因为它似乎连接到电路板上的绿色LED。</p><p class=ql-align-justify>PB9设置为GPIO开漏输出，启用上拉。我正在命名这个“MOTOR_CS”。我将它用作软件控制的CS引脚。</p><p class=ql-align-justify>启用FreeRTOS</p><p class=ql-align-justify>将PA4设置为GPIO输出并将其命名为“MOTOR_EN”</p><p class=ql-align-justify>将PA8,9设置为GPIO输出，并分别将它们命名为“MOTOR_STEP”和“MOTOR_DIR”。</p><p class=ql-align-justify>将PA0和PA1设置为模拟输入（其中一个或两个将用于测量前往天线的前向和反射功率）。</p><p class=ql-align-justify><strong>这就是CubeMx中GPIO分配的样子：</strong></p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c6383dfb8b0445a8a2bd439a9d58611a><p class=pgc-img-caption></p></div><p class=ql-align-justify>我选择Acronis TrueStudio作为目标，并使用STM32CubeMX生成源代码。像往常一样，我必须从Truestudio IDE中删除“Drivers”和“Middlewares”文件夹，让它们自动重新填充（在此之前我会收到一堆带来各种库的错误）。之后，项目构建并且STLink调试器开箱即用。</p><p class=ql-align-justify>我需要能够一次延迟处理器几uS来控制步进电机的定时脉冲。我正在使用本文中的一些代码来执行此操作：https：//www.carminenoviello.com/2015/09/04/precisely-measure-microseconds-stm32/</p><p class=ql-align-justify>在构建之后，我设置了motor_dir和motor_step引脚，以便在循环中来回驱动电机1000步。我在面包板上连接了SilentStepStick并连接了步进电机。我正在使用我的工作台13.8v电源供电。 SilentStepStick上有一个焊接跳线，当连接时，它会禁用SPI接口并允许SPI引脚用作配置引脚。我现在正在使用它，以便在不编写SPI代码的情况下测试电机接线和功能。引脚可以检测三种状态：开路，GND和VIO：</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/0beb7a56ca0f4ef3824bb4c589ef6ead><p class=pgc-img-caption></p></div><p class=ql-align-justify>我将CFG1设置为GND，将CFG2设置为Open。这应该提供16 uSteps插值和“spreadCycle”。</p><p class=ql-align-justify>我打开电源并启动程序。起初，电机开始按预期来回移动。但是，我很快就遇到了热问题。电动机每隔一秒左右停止一次。 50％的工作周期。我尝试使用电位器调节驱动电流，并将VREF电平从1.1V降低到500mV（驱动电流为0.71 * VREF），但问题仍然存在。在此之后不久，我几乎失去了SilentStepStick的所有功能。我能看到的唯一一项活动是在安装或拆下“En”销后进行一些短暂的动作，然后是一些不稳定，然后没有移动。看起来驱动器暂时运行然后遇到某种故障状态并禁用输出。</p><p class=ql-align-justify>在查看数据表后，我发现了这个问题。当SPI模式禁用时，步进驱动器上的“CS”引脚变为“CFG3”引脚。以下是CFG3的选项：</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/8ac53bad584f4f91876a249ff3d38579><p class=pgc-img-caption></p></div><p class=ql-align-justify>我将CFG3连接到地，忽略电位计并根据内部参考设置电流。拆下CS引脚上的导线后，步进驱动器使用与电位器电压成比例的电流，电机运行平稳连续。</p><p class=ql-align-justify>最后，通过将SPI焊接跳线连接到地，然后使用下面的接线连接，我能够毫无问题地使用SilentStepStick。大多数引脚可以保持打开状态。这将配置步进驱动器以进行16uStep操作（内插最多256个），启用“spreadCycle”操作，并通过电位计进行电流调整。如果你想在面包板上使用一个愚蠢的，安静的步进驱动器，这将很有效：</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/7c191180a2504ab8a4a1c9beeebecb96><p class=pgc-img-caption></p></div><p class=ql-align-justify>现在我已经确认硬件已正确连接且电机平稳旋转，下一步将启用SPI进行配置和失速检测。</p><p class=ql-align-justify>现在我已经确认步进驱动器工作正常，我想建立SPI通信以进行配置和状态回读。 这对于启用我用于归位的失速检测功能尤为重要。</p><p class=ql-align-justify>首先，我编写了一个函数，使用SPI在TMC2130上读写寄存器。 这是一个读/写功能 - 唯一的区别是在'写'操作中，寄存器的地址与0x80进行“或”运算。</p><p class=ql-align-justify>tmc_readwrite_register（）：</p><p class=ql-align-justify>读命令连续发送两次。 这是因为TMC2130通过一次SPI事务延迟响应。 数据表的这一部分解释了它：</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fe07dd0b915740b7924c6cf6c8d4e102><p class=pgc-img-caption></p></div><p class=ql-align-justify>可以通过创建连接来连接一行中的多个命令来优化一些读取操作。 它也可以利用来自同一寄存器的多个后续读取。 我不认为其中任何一个都是必要的，现在我接受我偶尔发送冗余命令。</p><p class=ql-align-justify>在主循环中，在初始化SPI和GPIO块之后，我将以下代码放入重复循环中：</p><p class=ql-align-justify>data = tmc_readwrite_register（TMC_REG_IOIN，0,0）;</p><p class=ql-align-justify>TMC_REG_IOIN定义为IOIN寄存器的8位地址。 该寄存器包含TMC2130上所有IO引脚的逻辑电平。 它还有一些总是读回'1'的位，这对测试SPI接口很有用。</p><p class=ql-align-justify>我附上了我的Saleae逻辑分析仪，看起来通信工作正常。</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/cde716a00bc04c08bb17846fb2f01288><p class=pgc-img-caption></p></div><p class=ql-align-justify>这是两笔交易中的第二笔。</p><p class=ql-align-justify>如果我将命令更改为：</p><p class=ql-align-justify>data = tmc_readwrite_register（TMC_REG_IOIN，0xAAAAAAAA，1）;</p><p class=ql-align-justify>MOSI信号相应变化：</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8458b78bbc2d4e38a577f9a145c07e7a><p class=pgc-img-caption></p></div><p class=ql-align-justify>虽然MOSI看起来不错，但MISO线看起来不正确。我读到的值与IOIN寄存器的数据表描述不一致。 将TMC2130数据表中的时序图与逻辑分析仪波形进行比较，可以看出使用了错误的时钟边沿。 我更改了更改spi.c中的行以选择第二个时钟边缘：</p><p class=ql-align-justify>hspi1.Init.CLKPhase = SPI_PHASE_2EDGE;</p><p class=ql-align-justify>在此之后，SPI接口在两个方向上都运行良好。</p><p class=ql-align-justify>以下是将“DIR”引脚设置为3v3读取IOIN寄存器的示例：</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4337993521ac4fa3af720f72f869ec08><p class=pgc-img-caption></p></div><p class=ql-align-justify>以下是“DIR”引脚连接到GND的相同走线：</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/4a22b92ff01542619dc69f3e8b7823c4><p class=pgc-img-caption></p></div><p class=ql-align-justify>正如预期的那样，位1从1切换到零，其余输入数据保持不变：</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a57c34c1ad3b408ea89b4fc1a7eca191><p class=pgc-img-caption></p></div><p class=ql-align-justify>另请注意，位24-31为0x11，如数据表中所示。</p><p class=ql-align-justify>我在检查调试器中的值时也看到了正确的数据返回：</p><div class=pgc-img><img alt="有趣、独特 | 打造一款业余无线电爱好者专属的自调谐磁环天线" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/24a23ca390c946d998f71a16f00c3227><p class=pgc-img-caption></p></div><p class=ql-align-justify>现在我需要为TMC2130步进器找到正确的初始化值并编写初始化函数。</p><p class=ql-align-justify>更多内容请访问http://www.esorensen.com</p><h1 class=ql-align-justify><strong>天线作品点评：</strong></h1><p class=ql-align-justify>Eric的构建设计在20米波段上以100W工作，这会影响天线的规格。在磁环设计中特别关键的是调谐电容器两端的电压；在这个设计中，它出现在大约4千伏。这需要仔细选择能够处理这些电压的部件。在这种情况下，使用真空可变电容器，额定峰值电流为57安培，峰值电压为5千伏。</p><p class=ql-align-justify>磁环设计导致天线调谐到非常窄的频率范围，提供良好的选择性。但是，为了保持带宽，它还需要经常重新调整。 Eric正在实施一个自整定系统来解决这个问题，控制器使用电机驱动调谐电容器，以将天线保持在适当的工作点。</p><p class=ql-align-justify>如果您不熟悉磁环构建，Eric的项目可以很好地介绍这种设计中固有的电气和机械因素。我们已经看到了更加模糊的设计，就像这些天线应用了先进的喷涂技术一样。</p><p>source：</p><p>http://www.esorensen.com</p><p>https://hackaday.com</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'独特','业余无线','电爱好者'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>