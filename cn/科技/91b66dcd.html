<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>å¤§é“è‡³ç®€ï¼šJava ä»£ç 11ä¸ªæ–¹é¢çš„ç²¾ç®€ä¹‹é“ï¼ˆç¤ºä¾‹å“é‰´ï¼‰ | æå®¢å¿«è¨Š</title><meta property="og:title" content="å¤§é“è‡³ç®€ï¼šJava ä»£ç 11ä¸ªæ–¹é¢çš„ç²¾ç®€ä¹‹é“ï¼ˆç¤ºä¾‹å“é‰´ï¼‰ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/30747658a7ff4b3a8fc8989c80252571"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91b66dcd.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91b66dcd.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/91b66dcd.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91b66dcd.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91b66dcd.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/91b66dcd.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/91b66dcd.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91b66dcd.html><meta property="article:published_time" content="2020-11-14T21:00:09+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:09+08:00"><meta name=Keywords content><meta name=description content="å¤§é“è‡³ç®€ï¼šJava ä»£ç 11ä¸ªæ–¹é¢çš„ç²¾ç®€ä¹‹é“ï¼ˆç¤ºä¾‹å“é‰´ï¼‰"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/91b66dcd.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>å¤§é“è‡³ç®€ï¼šJava ä»£ç 11ä¸ªæ–¹é¢çš„ç²¾ç®€ä¹‹é“ï¼ˆç¤ºä¾‹å“é‰´ï¼‰</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><blockquote><p>ä½œè€…ï¼š å¸¸æ„(åŸåé™ˆæ˜Œæ¯…ï¼Œåœ°å›¾æŠ€æœ¯ä¸“å®¶)</p><p>é“¾æ¥ï¼šhttps://mp.weixin.qq.com/s/A1Z8YZyqQsFqK1TA1dTl2Q</p></blockquote><h2 class=pgc-h-arrow-right><strong>å‰è¨€</strong></h2><hr><p>å¤è¯­æœ‰äº‘ï¼š</p><blockquote><p>é“ä¸ºæœ¯ä¹‹çµï¼Œæœ¯ä¸ºé“ä¹‹ä½“ï¼›ä»¥é“ç»Ÿæœ¯ï¼Œä»¥æœ¯å¾—é“ã€‚</p></blockquote><p>å…¶ä¸­ï¼šâ€œé“â€æŒ‡â€œè§„å¾‹ã€é“ç†ã€ç†è®ºâ€ï¼Œâ€œæœ¯â€æŒ‡â€œæ–¹æ³•ã€æŠ€å·§ã€æŠ€æœ¯â€ã€‚æ„æ€æ˜¯ï¼šâ€œé“â€æ˜¯â€œæœ¯â€çš„çµé­‚ï¼Œâ€œæœ¯â€æ˜¯â€œé“â€çš„è‚‰ä½“ï¼›å¯ä»¥ç”¨â€œé“â€æ¥ç»Ÿç®¡â€œæœ¯â€ï¼Œä¹Ÿå¯ä»¥ä»â€œæœ¯â€ä¸­è·å¾—â€œé“â€ã€‚</p><p><br></p><p>åœ¨æ‹œè¯»å¤§ä½¬â€œå­¤å°½â€çš„æ–‡ç« ã€ŠCode Reviewæ˜¯è‹¦æ¶©ä½†æœ‰æ„æ€çš„ä¿®è¡Œã€‹æ—¶ï¼Œæ„Ÿå—æœ€æ·±çš„ä¸€å¥è¯å°±æ˜¯ï¼šâ€œä¼˜è´¨çš„ä»£ç ä¸€å®šæ˜¯å°‘å³æ˜¯å¤šçš„ç²¾å…µåŸåˆ™â€ï¼Œè¿™å°±æ˜¯å¤§ä½¬çš„ä»£ç ç²¾ç®€ä¹‹â€œé“â€ã€‚</p><p><br></p><p>å·¥åŒ è¿½æ±‚â€œæœ¯â€åˆ°æè‡´ï¼Œå…¶å®å°±æ˜¯åœ¨å¯»â€œé“â€ï¼Œä¸”ç¦»æ‚Ÿâ€œé“â€ä¹Ÿå°±ä¸è¿œäº†ï¼Œäº¦æˆ–æ˜¯å·²ç»å¾—é“ï¼Œè¿™å°±æ˜¯â€œå·¥åŒ ç²¾ç¥â€â€”â€”ä¸€ç§è¿½æ±‚â€œä»¥æœ¯å¾—é“â€çš„ç²¾ç¥ã€‚å¦‚æœä¸€ä¸ªå·¥åŒ åªæ»¡è¶³äºâ€œæœ¯â€ï¼Œä¸èƒ½è¿½æ±‚â€œæœ¯â€åˆ°æè‡´å»æ‚Ÿâ€œé“â€ï¼Œé‚£åªæ˜¯ä¸€ä¸ªé â€œæœ¯â€å…»å®¶ç³Šå£çš„å·¥åŒ è€Œå·²ã€‚ä½œè€…æ ¹æ®å¤šå¹´æ¥çš„å®è·µæ¢ç´¢ï¼Œæ€»ç»“äº†å¤§é‡çš„ Java ä»£ç ç²¾ç®€ä¹‹â€œæœ¯â€ï¼Œè¯•å›¾é˜è¿°å‡ºå¿ƒä¸­çš„ Java ä»£ç ç²¾ç®€ä¹‹â€œé“â€ã€‚</p><p><br></p><div class=pgc-img><img alt="å¤§é“è‡³ç®€ï¼šJava ä»£ç 11ä¸ªæ–¹é¢çš„ç²¾ç®€ä¹‹é“ï¼ˆç¤ºä¾‹å“é‰´ï¼‰" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/30747658a7ff4b3a8fc8989c80252571><p class=pgc-img-caption></p></div><p><br></p><h2 class=pgc-h-arrow-right><strong>1.åˆ©ç”¨è¯­æ³•</strong></h2><hr><h3 class=pgc-h-arrow-right><strong>1.1.åˆ©ç”¨ä¸‰å…ƒè¡¨è¾¾å¼</strong></h3><p><strong>æ™®é€šï¼š</strong></p><pre><code>String title;if (isMember(phone)) {  title = "ä¼šå‘˜";} else {   title = "æ¸¸å®¢";}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>String title = isMember(phone) ? "ä¼šå‘˜" : "æ¸¸å®¢";</code></pre><p>æ³¨æ„ï¼šå¯¹äºåŒ…è£…ç±»å‹çš„ç®—æœ¯è®¡ç®—ï¼Œéœ€è¦æ³¨æ„é¿å…æ‹†åŒ…æ—¶çš„ç©ºæŒ‡é’ˆé—®é¢˜ã€‚</p><h3 class=pgc-h-arrow-right><strong>1.2.åˆ©ç”¨ for-each è¯­å¥</strong></h3><p>ä» Java 5 èµ·ï¼Œæä¾›äº† for-each å¾ªç¯ï¼Œç®€åŒ–äº†æ•°ç»„å’Œé›†åˆçš„å¾ªç¯éå†ã€‚ for-each å¾ªç¯å…è®¸ä½ æ— éœ€ä¿æŒä¼ ç»Ÿ for å¾ªç¯ä¸­çš„ç´¢å¼•å°±å¯ä»¥éå†æ•°ç»„ï¼Œæˆ–åœ¨ä½¿ç”¨è¿­ä»£å™¨æ—¶æ— éœ€åœ¨ while å¾ªç¯ä¸­è°ƒç”¨ hasNext æ–¹æ³•å’Œ next æ–¹æ³•å°±å¯ä»¥éå†é›†åˆã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>double[] values = ...;for(int i = 0; i &lt; values.length; i++) {  double value = values[i];  // TODO: å¤„ç†value}List&lt;Double&gt; valueList = ...;Iterator&lt;Double&gt; iterator = valueList.iterator();while (iterator.hasNext()) {  Double value = iterator.next();   // TODO: å¤„ç†value}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>double[] values = ...;for(double value : values) {  // TODO: å¤„ç†value}List&lt;Double&gt; valueList = ...;for(Double value : valueList) {  // TODO: å¤„ç†value}</code></pre><h3 class=pgc-h-arrow-right><strong>1.3.åˆ©ç”¨ try-with-resource è¯­å¥</strong></h3><p>æ‰€æœ‰å®ç° Closeable æ¥å£çš„â€œèµ„æºâ€ï¼Œå‡å¯é‡‡ç”¨ try-with-resource è¿›è¡Œç®€åŒ–ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>BufferedReader reader = null;try {  reader = new BufferedReader(new FileReader("cities.csv"));   String line;  while ((line = reader.readLine()) != null) {    // TODO: å¤„ç†line   }} catch (IOException e) {  log.error("è¯»å–æ–‡ä»¶å¼‚å¸¸", e);} finally {   if (reader != null) {     try {      reader.close();    } catch (IOException e) {      log.error("å…³é—­æ–‡ä»¶å¼‚å¸¸", e);    }  }}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>try (BufferedReader reader = new BufferedReader(new FileReader("test.txt"))) {  String line;  while ((line = reader.readLine()) != null) {    // TODO: å¤„ç†line  }} catch (IOException e) {  log.error("è¯»å–æ–‡ä»¶å¼‚å¸¸", e);}</code></pre><h3 class=pgc-h-arrow-right><strong>1.4.åˆ©ç”¨ return å…³é”®å­—</strong></h3><p>åˆ©ç”¨ return å…³é”®å­—ï¼Œå¯ä»¥æå‰å‡½æ•°è¿”å›ï¼Œé¿å…å®šä¹‰ä¸­é—´å˜é‡ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>public static boolean hasSuper(@NonNull List&lt;UserDO&gt; userList) {  boolean hasSuper = false;   for (UserDO user : userList) {    if (Boolean.TRUE.equals(user.getIsSuper())) {      hasSuper = true;       break;    }  }   return hasSuper;}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>public static boolean hasSuper(@NonNull List&lt;UserDO&gt; userList) {  for (UserDO user : userList) {    if (Boolean.TRUE.equals(user.getIsSuper())) {      return true;     }    }    return false;}</code></pre><h3 class=pgc-h-arrow-right><strong>1.5.åˆ©ç”¨ static å…³é”®å­—</strong></h3><p>åˆ©ç”¨ static å…³é”®å­—ï¼Œå¯ä»¥æŠŠå­—æ®µå˜æˆé™æ€å­—æ®µï¼Œä¹Ÿå¯ä»¥æŠŠå‡½æ•°å˜ä¸ºé™æ€å‡½æ•°ï¼Œè°ƒç”¨æ—¶å°±æ— éœ€åˆå§‹åŒ–ç±»å¯¹è±¡ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>public final class GisHelper {   public double distance(double lng1, double lat1, double lng2, double lat2) {    // æ–¹æ³•å®ç°ä»£ç    }}GisHelper gisHelper = new GisHelper();double distance = gisHelper.distance(116.178692D, 39.967115D, 116.410778D, 39.899721D);</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>public final class GisHelper {  public static double distance(double lng1, double lat1, double lng2, double lat2) {    // æ–¹æ³•å®ç°ä»£ç   }}double distance = GisHelper.distance(116.178692D, 39.967115D, 116.410778D, 39.899721D);</code></pre><h3 class=pgc-h-arrow-right><br></h3><h3 class=pgc-h-arrow-right><strong>1.6.åˆ©ç”¨ lambda è¡¨è¾¾å¼</strong></h3><p>Java 8 å‘å¸ƒä»¥åï¼Œlambda è¡¨è¾¾å¼å¤§é‡æ›¿ä»£åŒ¿åå†…éƒ¨ç±»çš„ä½¿ç”¨ï¼Œåœ¨ç®€åŒ–äº†ä»£ç çš„åŒæ—¶ï¼Œæ›´çªå‡ºäº†åŸæœ‰åŒ¿åå†…éƒ¨ç±»ä¸­çœŸæ­£æœ‰ç”¨çš„é‚£éƒ¨åˆ†ä»£ç ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>new Thread(new Runnable() {            public void run() {  // çº¿ç¨‹å¤„ç†ä»£ç }}).start();</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>new Thread(() -&gt; {   // çº¿ç¨‹å¤„ç†ä»£ç }).start();</code></pre><h3 class=pgc-h-arrow-right><strong>1.7.åˆ©ç”¨æ–¹æ³•å¼•ç”¨</strong></h3><p>æ–¹æ³•å¼•ç”¨ï¼ˆ::ï¼‰ï¼Œå¯ä»¥ç®€åŒ– lambda è¡¨è¾¾å¼ï¼Œçœç•¥å˜é‡å£°æ˜å’Œå‡½æ•°è°ƒç”¨ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>Arrays.sort(nameArray, (a, b) -&gt; a.compareToIgnoreCase(b));List&lt;Long&gt; userIdList = userList.stream()  .map(user -&gt; user.getId())   .collect(Collectors.toList());</code></pre><p><br><strong>ç²¾ç®€ï¼š</strong></p><pre><code>Arrays.sort(nameArray, String::compareToIgnoreCase);List&lt;Long&gt; userIdList = userList.stream()  .map(UserDO::getId)  .collect(Collectors.toList());</code></pre><p><br></p><h3 class=pgc-h-arrow-right><strong>1.8.åˆ©ç”¨é™æ€å¯¼å…¥</strong></h3><p>é™æ€å¯¼å…¥ï¼ˆimport staticï¼‰ï¼Œå½“ç¨‹åºä¸­å¤§é‡ä½¿ç”¨åŒä¸€é™æ€å¸¸é‡å’Œå‡½æ•°æ—¶ï¼Œå¯ä»¥ç®€åŒ–é™æ€å¸¸é‡å’Œå‡½æ•°çš„å¼•ç”¨ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>List&lt;Double&gt; areaList = radiusList.stream().map(r -&gt; Math.PI * Math.pow(r, 2)).collect(Collectors.toList());...</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>import static java.lang.Math.PI;import static java.lang.Math.pow;import static java.util.stream.Collectors.toList;List&lt;Double&gt; areaList = radiusList.stream().map(r -&gt; PI * pow(r, 2)).collect(toList());...</code></pre><p>æ³¨æ„ï¼šé™æ€å¼•å…¥å®¹æ˜“é€ æˆä»£ç é˜…è¯»å›°éš¾ï¼Œæ‰€ä»¥åœ¨å®é™…é¡¹ç›®ä¸­åº”è¯¥è­¦æ…ä½¿ç”¨ã€‚</p><p><br></p><h3 class=pgc-h-arrow-right><strong>1.9.åˆ©ç”¨ unchecked å¼‚å¸¸</strong></h3><p>Java çš„å¼‚å¸¸åˆ†ä¸ºä¸¤ç±»ï¼šChecked å¼‚å¸¸å’Œ Unchecked å¼‚å¸¸ã€‚Unchecked å¼‚å¸¸ç»§æ‰¿äº†RuntimeException ï¼Œç‰¹ç‚¹æ˜¯ä»£ç ä¸éœ€è¦å¤„ç†å®ƒä»¬ä¹Ÿèƒ½é€šè¿‡ç¼–è¯‘ï¼Œæ‰€ä»¥å®ƒä»¬ç§°ä½œ Unchecked å¼‚å¸¸ã€‚åˆ©ç”¨ Unchecked å¼‚å¸¸ï¼Œå¯ä»¥é¿å…ä¸å¿…è¦çš„ try-catch å’Œ throws å¼‚å¸¸å¤„ç†ã€‚</p><p><br></p><p><strong>æ™®é€šï¼š</strong></p><pre><code>@Servicepublic class UserService {  public void createUser(UserCreateVO create, OpUserVO user) throws BusinessException {    checkOperatorUser(user);     ...  }    private void checkOperatorUser(OpUserVO user) throws BusinessException {      if (!hasPermission(user)) {         throw new BusinessException("ç”¨æˆ·æ— æ“ä½œæƒé™");       }       ...      }      ...    }           @RestController      @RequestMapping("/user")      public class UserController {         @Autowired    private UserService userService;                @PostMapping("/createUser")         public Result&lt;Void&gt; createUser(@RequestBody @Valid UserCreateVO create, OpUserVO user) throws BusinessException {          userService.createUser(create, user);          return Result.success();        }       ...    }</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>@Servicepublic class UserService {   public void createUser(UserCreateVO create, OpUserVO user) {    checkOperatorUser(user);     ...  }    private void checkOperatorUser(OpUserVO user) {      if (!hasPermission(user)) {        throw new BusinessRuntimeException("ç”¨æˆ·æ— æ“ä½œæƒé™");      }       ...     }         ... }              @RestController@RequestMapping("/user")      public class UserController {         @Autowired        private UserService userService;         @PostMapping("/createUser")         public Result&lt;Void&gt; createUser(@RequestBody @Valid UserCreateVO create, OpUserVO user) {          userService.createUser(create, user);          return Result.success();        }      ...    }</code></pre><p><br></p><h2 class=pgc-h-arrow-right><strong>2.åˆ©ç”¨æ³¨è§£</strong></h2><hr><p><strong>2.1.åˆ©ç”¨ Lombok æ³¨è§£</strong></p><p>Lombok æä¾›äº†ä¸€ç»„æœ‰ç”¨çš„æ³¨è§£ï¼Œå¯ä»¥ç”¨æ¥æ¶ˆé™¤Javaç±»ä¸­çš„å¤§é‡æ ·æ¿ä»£ç ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>public class UserVO {  private Long id;  private String name;  public Long getId() {     return this.id;   }  public void setId(Long id) {    this.id = id;  }   public String getName() {     return this.name;   }  public void setName(String name) {     this.name = name;   }   ...}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>@Getter@Setter@ToStringpublic class UserVO {  private Long id;  private String name;   ...}</code></pre><h3 class=pgc-h-arrow-right><strong>2.2.åˆ©ç”¨ Validation æ³¨è§£</strong></h3><p><strong>æ™®é€šï¼š</strong></p><pre><code>  @Getter@Setter@ToStringpublic class UserCreateVO {  @NotBlank(message = "ç”¨æˆ·åç§°ä¸èƒ½ä¸ºç©º")  private String name;   @NotNull(message = "å…¬å¸æ ‡è¯†ä¸èƒ½ä¸ºç©º")  private Long companyId;   ...}@Service@Validatedpublicclass UserService {  public Long createUser(@Valid UserCreateVO create) {    // TODO: åˆ›å»ºç”¨æˆ·    return null;  }}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>@Getter@Setter@ToStringpublic class UserCreateVO {  @NotBlank(message = "ç”¨æˆ·åç§°ä¸èƒ½ä¸ºç©º")  private String name;   @NotNull(message = "å…¬å¸æ ‡è¯†ä¸èƒ½ä¸ºç©º")  private Long companyId;   ...}@Service@Validatedpublic class UserService {    public Long createUser(@Valid UserCreateVO create) {        // TODO: åˆ›å»ºç”¨æˆ·        return null;    }}</code></pre><h3 class=pgc-h-arrow-right><br></h3><h3 class=pgc-h-arrow-right><strong>2.3.åˆ©ç”¨ @NonNull æ³¨è§£</strong></h3><p><br></p><p>Spring çš„ @NonNull æ³¨è§£ï¼Œç”¨äºæ ‡æ³¨å‚æ•°æˆ–è¿”å›å€¼éç©ºï¼Œé€‚ç”¨äºé¡¹ç›®å†…éƒ¨å›¢é˜Ÿåä½œã€‚åªè¦å®ç°æ–¹å’Œè°ƒç”¨æ–¹éµå¾ªè§„èŒƒï¼Œå¯ä»¥é¿å…ä¸å¿…è¦çš„ç©ºå€¼åˆ¤æ–­ï¼Œè¿™å……åˆ†ä½“ç°äº†é˜¿é‡Œçš„â€œæ–°å…­è„‰ç¥å‰‘â€æå€¡çš„â€œå› ä¸ºä¿¡ä»»ï¼Œæ‰€ä»¥ç®€å•â€ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>public List&lt;UserVO&gt; queryCompanyUser(Long companyId) {  // æ£€æŸ¥å…¬å¸æ ‡è¯†  if (companyId == null) {    return null;  }   // æŸ¥è¯¢è¿”å›ç”¨æˆ·  List&lt;UserDO&gt; userList = userDAO.queryByCompanyId(companyId);   return userList.stream().map(this::transUser).collect(Collectors.toList());}Long companyId = 1L;List&lt;UserVO&gt; userList = queryCompanyUser(companyId);if (CollectionUtils.isNotEmpty(userList)) {  for (UserVO user : userList) {    // TODO: å¤„ç†å…¬å¸ç”¨æˆ·  }}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>public @NonNull List&lt;UserVO&gt; queryCompanyUser(@NonNull Long companyId) {  List&lt;UserDO&gt; userList = userDAO.queryByCompanyId(companyId);  return userList.stream().map(this::transUser).collect(Collectors.toList());}Long companyId = 1L;List&lt;UserVO&gt; userList = queryCompanyUser(companyId);for (UserVO user : userList) {  // TODO: å¤„ç†å…¬å¸ç”¨æˆ·}</code></pre><h3 class=pgc-h-arrow-right><br></h3><h3 class=pgc-h-arrow-right><strong>2.4.åˆ©ç”¨æ³¨è§£ç‰¹æ€§</strong></h3><p>æ³¨è§£æœ‰ä»¥ä¸‹ç‰¹æ€§å¯ç”¨äºç²¾ç®€æ³¨è§£å£°æ˜ï¼š</p><p>1ã€å½“æ³¨è§£å±æ€§å€¼è·Ÿé»˜è®¤å€¼ä¸€è‡´æ—¶ï¼Œå¯ä»¥åˆ é™¤è¯¥å±æ€§èµ‹å€¼ï¼›</p><p>2ã€å½“æ³¨è§£åªæœ‰valueå±æ€§æ—¶ï¼Œå¯ä»¥å»æ‰valueè¿›è¡Œç®€å†™ï¼›</p><p>3ã€å½“æ³¨è§£å±æ€§ç»„åˆç­‰äºå¦ä¸€ä¸ªç‰¹å®šæ³¨è§£æ—¶ï¼Œç›´æ¥é‡‡ç”¨è¯¥ç‰¹å®šæ³¨è§£ã€‚</p><p><br></p><p><strong>æ™®é€šï¼š</strong></p><pre><code>@Lazy(true);@Service(value = "userService")@RequestMapping(path = "/getUser", method = RequestMethod.GET)</code></pre><pre><code></code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>@Lazy@Service("userService")@GetMapping("/getUser")</code></pre><h2 class=pgc-h-arrow-right><strong>3.åˆ©ç”¨æ³›å‹</strong></h2><hr><p><strong>3.1.æ³›å‹æ¥å£</strong></p><p>åœ¨ Java æ²¡æœ‰å¼•å…¥æ³›å‹å‰ï¼Œéƒ½æ˜¯é‡‡ç”¨ Object è¡¨ç¤ºé€šç”¨å¯¹è±¡ï¼Œæœ€å¤§çš„é—®é¢˜å°±æ˜¯ç±»å‹æ— æ³•å¼ºæ ¡éªŒå¹¶ä¸”éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>public interface Comparable {  public int compareTo(Object other);}@Getter@Setter@ToStringpublic class UserVO implements Comparable {  private Long id;   @Override    public int compareTo(Object other) {    UserVO user = (UserVO)other;    return Long.compare(this.id, user.id);  }}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>public interface Comparable&lt;T&gt; {  public int compareTo(T other);}@Getter@Setter@ToStringpublic class UserVO implements Comparable&lt;UserVO&gt; {  private Long id;  @Override  public int compareTo(UserVO other) {    return Long.compare(this.id, other.id);  }}</code></pre><p><br></p><h3 class=pgc-h-arrow-right><strong>3.2.æ³›å‹ç±»</strong></h3><p><strong>æ™®é€šï¼š</strong></p><pre><code>@Getter@Setter@ToStringpublic class IntPoint {  private Integer x;  private Integer y;}@Getter@Setter@ToStringpublic class DoublePoint {  private Double x;  private Double y;}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>@Getter@Setter@ToStringpublic class Point&lt;T extends Number&gt; {  private T x;  private T y;}</code></pre><h3 class=pgc-h-arrow-right><br></h3><h3 class=pgc-h-arrow-right><strong>3.3.æ³›å‹æ–¹æ³•</strong></h3><p><strong>æ™®é€šï¼š</strong></p><pre><code>public static Map&lt;String, Integer&gt; newHashMap(String[] keys, Integer[] values) {  // æ£€æŸ¥å‚æ•°éç©º   if (ArrayUtils.isEmpty(keys) || ArrayUtils.isEmpty(values)) {    return Collections.emptyMap();   }     // è½¬åŒ–å“ˆå¸Œæ˜ å°„   Map&lt;String, Integer&gt; map = new HashMap&lt;&gt;();   int length = Math.min(keys.length, values.length);   for (int i = 0; i &lt; length; i++) {     map.put(keys[i], values[i]);  }  return map;}...</code></pre><p><br></p><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>public static &lt;K, V&gt; Map&lt;K, V&gt; newHashMap(K[] keys, V[] values) {   // æ£€æŸ¥å‚æ•°éç©º   if (ArrayUtils.isEmpty(keys) || ArrayUtils.isEmpty(values)) {    return Collections.emptyMap();  }     // è½¬åŒ–å“ˆå¸Œæ˜ å°„  Map&lt;K, V&gt; map = new HashMap&lt;&gt;();  int length = Math.min(keys.length, values.length);   for (int i = 0; i &lt; length; i++) {    map.put(keys[i], values[i]);  }   return map;}</code></pre><h2 class=pgc-h-arrow-right><strong>4.åˆ©ç”¨è‡ªèº«æ–¹æ³•</strong></h2><hr><p><strong>4.1.åˆ©ç”¨æ„é€ æ–¹æ³•</strong></p><p>æ„é€ æ–¹æ³•ï¼Œå¯ä»¥ç®€åŒ–å¯¹è±¡çš„åˆå§‹åŒ–å’Œè®¾ç½®å±æ€§æ“ä½œã€‚å¯¹äºå±æ€§å­—æ®µè¾ƒå°‘çš„ç±»ï¼Œå¯ä»¥è‡ªå®šä¹‰æ„é€ æ–¹æ³•ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>@Getter@Setter@ToStringpublic class PageDataVO&lt;T&gt; {  private Long totalCount;  private List&lt;T&gt; dataList;}PageDataVO&lt;UserVO&gt; pageData = new PageDataVO&lt;&gt;();pageData.setTotalCount(totalCount);pageData.setDataList(userList);return pageData;</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>@Getter@Setter@ToString@NoArgsConstructor@AllArgsConstructorpublic class PageDataVO&lt;T&gt; {  private Long totalCount;  private List&lt;T&gt; dataList;}return new PageDataVO&lt;&gt;(totalCount, userList);</code></pre><p>æ³¨æ„ï¼šå¦‚æœå±æ€§å­—æ®µè¢«æ›¿æ¢æ—¶ï¼Œå­˜åœ¨æ„é€ å‡½æ•°åˆå§‹åŒ–èµ‹å€¼é—®é¢˜ã€‚æ¯”å¦‚æŠŠå±æ€§å­—æ®µtitleæ›¿æ¢ä¸º nickname ï¼Œç”±äºæ„é€ å‡½æ•°çš„å‚æ•°ä¸ªæ•°å’Œç±»å‹ä¸å˜ï¼ŒåŸæœ‰æ„é€ å‡½æ•°åˆå§‹åŒ–è¯­å¥ä¸ä¼šæŠ¥é”™ï¼Œå¯¼è‡´æŠŠåŸtitleå€¼èµ‹å€¼ç»™ nickname ã€‚å¦‚æœé‡‡ç”¨ Setter æ–¹æ³•èµ‹å€¼ï¼Œç¼–è¯‘å™¨ä¼šæç¤ºé”™è¯¯å¹¶è¦æ±‚ä¿®å¤ã€‚</p><p><br></p><h3 class=pgc-h-arrow-right><strong>4.2.åˆ©ç”¨ Set çš„ add æ–¹æ³•</strong></h3><p>åˆ©ç”¨ Set çš„ add æ–¹æ³•çš„è¿”å›å€¼ï¼Œå¯ä»¥ç›´æ¥çŸ¥é“è¯¥å€¼æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¯ä»¥é¿å…è°ƒç”¨ contains æ–¹æ³•åˆ¤æ–­å­˜åœ¨ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><p>ä»¥ä¸‹æ¡ˆä¾‹æ˜¯è¿›è¡Œç”¨æˆ·å»é‡è½¬åŒ–æ“ä½œï¼Œéœ€è¦å…ˆè°ƒç”¨ contains æ–¹æ³•åˆ¤æ–­å­˜åœ¨ï¼Œåè°ƒç”¨addæ–¹æ³•è¿›è¡Œæ·»åŠ ã€‚</p><pre><code>Set&lt;Long&gt; userIdSet = new HashSet&lt;&gt;();List&lt;UserVO&gt; userVOList = new ArrayList&lt;&gt;();for (UserDO userDO : userDOList) {   if (!userIdSet.contains(userDO.getId())) {    userIdSet.add(userDO.getId());    userVOList.add(transUser(userDO));  }}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>SSet&lt;Long&gt; userIdSet = new HashSet&lt;&gt;();List&lt;UserVO&gt; userVOList = new ArrayList&lt;&gt;();for (UserDO userDO : userDOList) {  if (userIdSet.add(userDO.getId())) {    userVOList.add(transUser(userDO));  }}</code></pre><h3 class=pgc-h-arrow-right><strong>4.3.åˆ©ç”¨ Map çš„ computeIfAbsent æ–¹æ³•</strong></h3><p>åˆ©ç”¨ Map çš„ computeIfAbsent æ–¹æ³•ï¼Œå¯ä»¥ä¿è¯è·å–åˆ°çš„å¯¹è±¡éç©ºï¼Œä»è€Œé¿å…äº†ä¸å¿…è¦çš„ç©ºåˆ¤æ–­å’Œé‡æ–°è®¾ç½®å€¼ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>Map&lt;Long, List&lt;UserDO&gt;&gt; roleUserMap = new HashMap&lt;&gt;();for (UserDO userDO : userDOList) {  Long roleId = userDO.getRoleId();  List&lt;UserDO&gt; userList = roleUserMap.get(roleId);  if (Objects.isNull(userList)) {     userList = new ArrayList&lt;&gt;();    roleUserMap.put(roleId, userList);  }   userList.add(userDO);}</code></pre><p><br></p><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>Map&lt;Long, List&lt;UserDO&gt;&gt; roleUserMap = new HashMap&lt;&gt;();for (UserDO userDO : userDOList) {   roleUserMap.computeIfAbsent(userDO.getRoleId(), key -&gt; new ArrayList&lt;&gt;())    .add(userDO);}</code></pre><h3 class=pgc-h-arrow-right><br></h3><h3 class=pgc-h-arrow-right><strong>4.4.åˆ©ç”¨é“¾å¼ç¼–ç¨‹</strong></h3><p>é“¾å¼ç¼–ç¨‹ï¼Œä¹Ÿå«çº§è”å¼ç¼–ç¨‹ï¼Œè°ƒç”¨å¯¹è±¡çš„å‡½æ•°æ—¶è¿”å›ä¸€ä¸ªthiså¯¹è±¡æŒ‡å‘å¯¹è±¡æœ¬èº«ï¼Œè¾¾åˆ°é“¾å¼æ•ˆæœï¼Œå¯ä»¥çº§è”è°ƒç”¨ã€‚é“¾å¼ç¼–ç¨‹çš„ä¼˜ç‚¹æ˜¯ï¼šç¼–ç¨‹æ€§å¼ºã€å¯è¯»æ€§å¼ºã€ä»£ç ç®€æ´ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>StringBuilder builder = new StringBuilder(96);builder.append("select id, name from ");builder.append(T_USER);builder.append(" where id = ");builder.append(userId);builder.append(";");</code></pre><p><br></p><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>StringBuilder builder = new StringBuilder(96);builder.append("select id, name from ")  .append(T_USER)  .append(" where id = ")  .append(userId)  .append(";");</code></pre><h2 class=pgc-h-arrow-right><strong>5.åˆ©ç”¨å·¥å…·æ–¹æ³•</strong></h2><hr><p><strong>5.1.é¿å…ç©ºå€¼åˆ¤æ–­</strong></p><p><br></p><p><strong>æ™®é€šï¼š</strong></p><pre><code>if (userList != null &amp;&amp; !userList.isEmpty()) {  // TODO: å¤„ç†ä»£ç }</code></pre><p><br></p><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>if (CollectionUtils.isNotEmpty(userList)) {    // TODO: å¤„ç†ä»£ç }</code></pre><h3 class=pgc-h-arrow-right><br></h3><h3 class=pgc-h-arrow-right><strong>5.2.é¿å…æ¡ä»¶åˆ¤æ–­</strong></h3><p><strong>æ™®é€šï¼š</strong></p><pre><code>double result;if (value &lt;= MIN_LIMIT) {  result = MIN_LIMIT;} else {  result = value;}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>double result = Math.max(MIN_LIMIT, value);</code></pre><h3 class=pgc-h-arrow-right><br></h3><h3 class=pgc-h-arrow-right><strong>5.3.ç®€åŒ–èµ‹å€¼è¯­å¥</strong></h3><p><strong>æ™®é€šï¼š</strong></p><pre><code>public static final List&lt;String&gt; ANIMAL_LIST;static {  List&lt;String&gt; animalList = new ArrayList&lt;&gt;();  animalList.add("dog");  animalList.add("cat");  animalList.add("tiger");  ANIMAL_LIST = Collections.unmodifiableList(animalList);}</code></pre><p><br></p><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>// JDKæµæ´¾public static final List&lt;String&gt; ANIMAL_LIST = Arrays.asList("dog", "cat", "tiger");// Guavaæµæ´¾public static final List&lt;String&gt; ANIMAL_LIST = ImmutableList.of("dog", "cat", "tiger");</code></pre><p>æ³¨æ„ï¼šArrays.asList è¿”å›çš„ List å¹¶ä¸æ˜¯ ArrayList ï¼Œä¸æ”¯æŒ add ç­‰å˜æ›´æ“ä½œã€‚</p><h3 class=pgc-h-arrow-right><strong>5.4.ç®€åŒ–æ•°æ®æ‹·è´</strong></h3><p><strong>æ™®é€šï¼š</strong></p><pre><code>UserVO userVO = new UserVO();userVO.setId(userDO.getId());userVO.setName(userDO.getName());...userVO.setDescription(userDO.getDescription());userVOList.add(userVO);</code></pre><p><br></p><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>UserVO userVO = new UserVO();BeanUtils.copyProperties(userDO, userVO);userVOList.add(userVO);</code></pre><p><br></p><p><strong>åä¾‹ï¼š</strong></p><pre><code>List&lt;UserVO&gt; userVOList = JSON.parseArray(JSON.toJSONString(userDOList), UserVO.class);</code></pre><p>ç²¾ç®€ä»£ç ï¼Œä½†ä¸èƒ½ä»¥è¿‡å¤§çš„æ€§èƒ½æŸå¤±ä¸ºä»£ä»·ã€‚ä¾‹å­æ˜¯æµ…å±‚æ‹·è´ï¼Œç”¨ä¸ç€ JSON è¿™æ ·é‡é‡çº§çš„æ­¦å™¨ã€‚</p><p><br></p><h2 class=pgc-h-arrow-right>5.5.ç®€åŒ–å¼‚å¸¸æ–­è¨€</h2><p><br></p><p><strong>æ™®é€šï¼š</strong></p><pre><code>if (Objects.isNull(userId)) {    throw new IllegalArgumentException("ç”¨æˆ·æ ‡è¯†ä¸èƒ½ä¸ºç©º");}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>Assert.notNull(userId, "ç”¨æˆ·æ ‡è¯†ä¸èƒ½ä¸ºç©º");</code></pre><p>æ³¨æ„ï¼šå¯èƒ½æœ‰äº›æ’ä»¶ä¸è®¤åŒè¿™ç§åˆ¤æ–­ï¼Œå¯¼è‡´ä½¿ç”¨è¯¥å¯¹è±¡æ—¶ä¼šæœ‰ç©ºæŒ‡é’ˆè­¦å‘Šã€‚</p><h3 class=pgc-h-arrow-right><strong>5.6.ç®€åŒ–æµ‹è¯•ç”¨ä¾‹</strong></h3><p>æŠŠæµ‹è¯•ç”¨ä¾‹æ•°æ®ä»¥ JSON æ ¼å¼å­˜å…¥æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ JSON çš„ parseObject å’Œ parseArray æ–¹æ³•è§£ææˆå¯¹è±¡ã€‚è™½ç„¶æ‰§è¡Œæ•ˆç‡ä¸Šæœ‰æ‰€ä¸‹é™ï¼Œä½†å¯ä»¥å‡å°‘å¤§é‡çš„èµ‹å€¼è¯­å¥ï¼Œä»è€Œç²¾ç®€äº†æµ‹è¯•ä»£ç ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>@Testpublic void testCreateUser() {  UserCreateVO userCreate = new UserCreateVO();   userCreate.setName("Changyi");  userCreate.setTitle("Developer");  userCreate.setCompany("AMAP");   ...      Long userId  = userService.createUser(OPERATOR, userCreate);   Assert.assertNotNull(userId, "åˆ›å»ºç”¨æˆ·å¤±è´¥");}</code></pre><p><br><strong>ç²¾ç®€ï¼š</strong></p><pre><code>@Testpublic void testCreateUser() {  String jsonText = ResourceHelper.getResourceAsString(getClass(), "createUser.json");   UserCreateVO userCreate = JSON.parseObject(jsonText, UserCreateVO.class);   Long userId  = userService.createUser(OPERATOR, userCreate);  Assert.assertNotNull(userId, "åˆ›å»ºç”¨æˆ·å¤±è´¥");}</code></pre><p>å»ºè®®ï¼šJSON æ–‡ä»¶åæœ€å¥½ä»¥è¢«æµ‹è¯•çš„æ–¹æ³•å‘½åï¼Œå¦‚æœæœ‰å¤šä¸ªç‰ˆæœ¬å¯ä»¥ç”¨æ•°å­—åç¼€è¡¨ç¤ºã€‚</p><p><br></p><h3 class=pgc-h-arrow-right><strong>5.7.ç®€åŒ–ç®—æ³•å®ç°</strong></h3><p>ä¸€äº›å¸¸è§„ç®—æ³•ï¼Œå·²æœ‰ç°æˆçš„å·¥å…·æ–¹æ³•ï¼Œæˆ‘ä»¬å°±æ²¡æœ‰å¿…è¦è‡ªå·±å®ç°äº†ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>int totalSize = valueList.size();List&lt;List&lt;Integer&gt;&gt; partitionList = new ArrayList&lt;&gt;();for (int i = 0; i &lt; totalSize; i += PARTITION_SIZE) {  partitionList.add(valueList.subList(i, Math.min(i + PARTITION_SIZE, totalSize)));}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>List&lt;List&lt;Integer&gt;&gt; partitionList = ListUtils.partition(valueList, PARTITION_SIZE);</code></pre><p><br></p><h2 class=pgc-h-arrow-right>5.8.å°è£…å·¥å…·æ–¹æ³•</h2><p><br></p><p>ä¸€äº›ç‰¹æ®Šç®—æ³•ï¼Œæ²¡æœ‰ç°æˆçš„å·¥å…·æ–¹æ³•ï¼Œæˆ‘ä»¬å°±åªå¥½è‡ªå·±äº²è‡ªå®ç°äº†ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><p>æ¯”å¦‚ï¼ŒSQL è®¾ç½®å‚æ•°å€¼çš„æ–¹æ³•å°±æ¯”è¾ƒéš¾ç”¨ï¼ŒsetLong æ–¹æ³•ä¸èƒ½è®¾ç½®å‚æ•°å€¼ä¸º null ã€‚</p><pre><code> // è®¾ç½®å‚æ•°å€¼if (Objects.nonNull(user.getId())) {  statement.setLong(1, user.getId());} else {  statement.setNull(1, Types.BIGINT);}...</code></pre><p><br></p><p><strong>ç²¾ç®€ï¼š</strong></p><p>æˆ‘ä»¬å¯ä»¥å°è£…ä¸ºä¸€ä¸ªå·¥å…·ç±» SqlHelper ï¼Œç®€åŒ–è®¾ç½®å‚æ•°å€¼çš„ä»£ç ã€‚</p><pre><code>/** SQLè¾…åŠ©ç±» */public final class SqlHelper {    /** è®¾ç½®é•¿æ•´æ•°å€¼ */    public static void setLong(PreparedStatement statement, int index, Long value) throws SQLException {        if (Objects.nonNull(value)) {            statement.setLong(index, value.longValue());        } else {            statement.setNull(index, Types.BIGINT);        }    }    ...} // è®¾ç½®å‚æ•°å€¼SqlHelper.setLong(statement, 1, user.getId());</code></pre><p><br></p><h2 class=pgc-h-arrow-right><strong>6.åˆ©ç”¨æ•°æ®ç»“æ„</strong></h2><hr><p><strong>6.1.åˆ©ç”¨æ•°ç»„ç®€åŒ–</strong></p><p>å¯¹äºå›ºå®šä¸Šä¸‹é™èŒƒå›´çš„ if-else è¯­å¥ï¼Œå¯ä»¥ç”¨æ•°ç»„+å¾ªç¯æ¥ç®€åŒ–ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>public static int getGrade(double score) {  if (score &gt;= 90.0D) {    return 1;  }  if (score &gt;= 80.0D) {    return 2;  }   if (score &gt;= 60.0D) {    return 3;   }  if (score &gt;= 30.0D) {    return 4;  }  return 5;}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>private static final double[] SCORE_RANGES = new double[] {90.0D, 80.0D, 60.0D, 30.0D};public static int getGrade(double score) {  for (int i = 0; i &lt; SCORE_RANGES.length; i++) {    if (score &gt;= SCORE_RANGES[i]) {      return i + 1;     }   }  return SCORE_RANGES.length + 1;}</code></pre><p><br></p><p>æ€è€ƒï¼šä¸Šé¢çš„æ¡ˆä¾‹è¿”å›å€¼æ˜¯é€’å¢çš„ï¼Œæ‰€ä»¥ç”¨æ•°ç»„ç®€åŒ–æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿”å›å€¼ä¸æ˜¯é€’å¢çš„ï¼Œèƒ½å¦ç”¨æ•°ç»„è¿›è¡Œç®€åŒ–å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œè¯·è‡ªè¡Œæ€è€ƒè§£å†³ã€‚</p><p><br></p><h3 class=pgc-h-arrow-right><strong>6.2.åˆ©ç”¨ Map ç®€åŒ–</strong></h3><p>å¯¹äºæ˜ å°„å…³ç³»çš„ if-else è¯­å¥ï¼Œå¯ä»¥ç”¨Mapæ¥ç®€åŒ–ã€‚æ­¤å¤–ï¼Œæ­¤è§„åˆ™åŒæ ·é€‚ç”¨äºç®€åŒ–æ˜ å°„å…³ç³»çš„ switch è¯­å¥ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>public static String getBiologyClass(String name) {  switch (name) {    case "dog" :       return "animal";     case "cat" :        return "animal";      case "lavender" :       return "plant";       ...       default :       return null;  }}</code></pre><p><br><strong>ç²¾ç®€ï¼š</strong></p><pre><code>private static final Map&lt;String, String&gt; BIOLOGY_CLASS_MAP  = ImmutableMap.&lt;String, String&gt;builder()   .put("dog", "animal")  .put("cat", "animal")  .put("lavender", "plant")   ...     .build();public static String getBiologyClass(String name) {  return BIOLOGY_CLASS_MAP.get(name);}</code></pre><p>å·²ç»æŠŠæ–¹æ³•ç®€åŒ–ä¸ºä¸€è¡Œä»£ç ï¼Œå…¶å®éƒ½æ²¡æœ‰å°è£…æ–¹æ³•çš„å¿…è¦äº†ã€‚</p><p><br></p><h3 class=pgc-h-arrow-right><strong>6.3.åˆ©ç”¨å®¹å™¨ç±»ç®€åŒ–</strong></h3><p>Java ä¸åƒ Python å’Œ Go ï¼Œæ–¹æ³•ä¸æ”¯æŒè¿”å›å¤šä¸ªå¯¹è±¡ã€‚å¦‚æœéœ€è¦è¿”å›å¤šä¸ªå¯¹è±¡ï¼Œå°±å¿…é¡»è‡ªå®šä¹‰ç±»ï¼Œæˆ–è€…åˆ©ç”¨å®¹å™¨ç±»ã€‚å¸¸è§çš„å®¹å™¨ç±»æœ‰ Apache çš„ Pair ç±»å’Œ Triple ç±»ï¼Œ Pair ç±»æ”¯æŒè¿”å› 2 ä¸ªå¯¹è±¡ï¼Œ Triple ç±»æ”¯æŒè¿”å› 3 ä¸ªå¯¹è±¡ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>@Setter@Getter@ToString@AllArgsConstructorpublic static class PointAndDistance {  private Point point;  private Double distance;}public static PointAndDistance getNearest(Point point, Point[] points) {  // è®¡ç®—æœ€è¿‘ç‚¹å’Œè·ç¦»  ...    // è¿”å›æœ€è¿‘ç‚¹å’Œè·ç¦»  return new PointAndDistance(nearestPoint, nearestDistance);}</code></pre><p><br></p><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>public static Pair&lt;Point, Double&gt; getNearest(Point point, Point[] points) {  // è®¡ç®—æœ€è¿‘ç‚¹å’Œè·ç¦»  ...   // è¿”å›æœ€è¿‘ç‚¹å’Œè·ç¦»  return ImmutablePair.of(nearestPoint, nearestDistance);}</code></pre><h3 class=pgc-h-arrow-right><br></h3><h3 class=pgc-h-arrow-right><strong>6.4.åˆ©ç”¨ ThreadLocal ç®€åŒ–</strong></h3><p>ThreadLocal æä¾›äº†çº¿ç¨‹ä¸“æœ‰å¯¹è±¡ï¼Œå¯ä»¥åœ¨æ•´ä¸ªçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸä¸­éšæ—¶å–ç”¨ï¼Œæå¤§åœ°æ–¹ä¾¿äº†ä¸€äº›é€»è¾‘çš„å®ç°ã€‚ç”¨ ThreadLocal ä¿å­˜çº¿ç¨‹ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¯ä»¥é¿å…ä¸å¿…è¦çš„å‚æ•°ä¼ é€’ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><p>ç”±äº DateFormat çš„ format æ–¹æ³•çº¿ç¨‹éå®‰å…¨ï¼ˆå»ºè®®ä½¿ç”¨æ›¿ä»£æ–¹æ³•ï¼‰ï¼Œåœ¨çº¿ç¨‹ä¸­é¢‘ç¹åˆå§‹åŒ– DateFormat æ€§èƒ½å¤ªä½ï¼Œå¦‚æœè€ƒè™‘é‡ç”¨åªèƒ½ç”¨å‚æ•°ä¼ å…¥ DateFormat ã€‚ä¾‹å­å¦‚ä¸‹ï¼š</p><pre><code>public static String formatDate(Date date, DateFormat format) {  return format.format(date);}public static List&lt;String&gt; getDateList(Date minDate, Date maxDate, DateFormat format) {  List&lt;String&gt; dateList = new ArrayList&lt;&gt;();  Calendar calendar = Calendar.getInstance();  calendar.setTime(minDate);  String currDate = formatDate(calendar.getTime(), format);  String maxsDate = formatDate(maxDate, format);  while (currDate.compareTo(maxsDate) &lt;= 0) {    dateList.add(currDate);    calendar.add(Calendar.DATE, 1);    currDate = formatDate(calendar.getTime(), format);   }  return dateList;}</code></pre><p><br><strong>ç²¾ç®€ï¼š</strong></p><p>å¯èƒ½ä½ ä¼šè§‰å¾—ä»¥ä¸‹çš„ä»£ç é‡åè€Œå¤šäº†ï¼Œå¦‚æœè°ƒç”¨å·¥å…·æ–¹æ³•çš„åœ°æ–¹æ¯”è¾ƒå¤šï¼Œå°±å¯ä»¥çœä¸‹ä¸€å¤§å † DateFormat åˆå§‹åŒ–å’Œä¼ å…¥å‚æ•°çš„ä»£ç ã€‚</p><pre><code>private static final ThreadLocal&lt;DateFormat&gt; LOCAL_DATE_FORMAT = new ThreadLocal&lt;DateFormat&gt;() {  @Override  protected DateFormat initialValue() {     return new SimpleDateFormat("yyyyMMdd");  }};public static String formatDate(Date date) {    return LOCAL_DATE_FORMAT.get().format(date);}public static List&lt;String&gt; getDateList(Date minDate, Date maxDate) {    List&lt;String&gt; dateList = new ArrayList&lt;&gt;();    Calendar calendar = Calendar.getInstance();    calendar.setTime(minDate);    String currDate = formatDate(calendar.getTime());    String maxsDate = formatDate(maxDate);    while (currDate.compareTo(maxsDate) &lt;= 0) {        dateList.add(currDate);        calendar.add(Calendar.DATE, 1);        currDate = formatDate(calendar.getTime());    }    return dateList;}</code></pre><p>æ³¨æ„ï¼šThreadLocal æœ‰ä¸€å®šçš„å†…å­˜æ³„éœ²çš„é£é™©ï¼Œå°½é‡åœ¨ä¸šåŠ¡ä»£ç ç»“æŸå‰è°ƒç”¨ remove æ–¹æ³•è¿›è¡Œæ•°æ®æ¸…é™¤ã€‚</p><p><br></p><h2 class=pgc-h-arrow-right><strong>7.åˆ©ç”¨ Optional</strong></h2><hr><p>åœ¨ Java 8 é‡Œï¼Œå¼•å…¥äº†ä¸€ä¸ª Optional ç±»ï¼Œè¯¥ç±»æ˜¯ä¸€ä¸ªå¯ä»¥ä¸º null çš„å®¹å™¨å¯¹è±¡ã€‚</p><h3 class=pgc-h-arrow-right><strong>7.1.ä¿è¯å€¼å­˜åœ¨</strong></h3><p><br></p><p><strong>æ™®é€šï¼š</strong></p><pre><code>Integer thisValue;if (Objects.nonNull(value)) {  thisValue = value;} else {  thisValue = DEFAULT_VALUE;}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>Integer thisValue = Optional.ofNullable(value).orElse(DEFAULT_VALUE);</code></pre><p><br></p><h3 class=pgc-h-arrow-right><strong>7.2.ä¿è¯å€¼åˆæ³•</strong></h3><p><strong>æ™®é€šï¼š</strong></p><pre><code>Integer thisValue;if (Objects.nonNull(value) &amp;&amp; value.compareTo(MAX_VALUE) &lt;= 0) {  thisValue = value;} else {  thisValue = MAX_VALUE;}</code></pre><p><br><strong>ç²¾ç®€ï¼š</strong></p><pre><code>Integer thisValue = Optional.ofNullable(value)  .filter(tempValue -&gt; tempValue.compareTo(MAX_VALUE) &lt;= 0).orElse(MAX_VALUE);</code></pre><p>7.3.é¿å…ç©ºåˆ¤æ–­</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>String zipcode = null;if (Objects.nonNull(user)) {  Address address = user.getAddress();  if (Objects.nonNull(address)) {    Country country = address.getCountry();    if (Objects.nonNull(country)) {      zipcode = country.getZipcode();     }  }}</code></pre><p><br><strong>ç²¾ç®€ï¼š</strong></p><pre><code>tring zipcode = Optional.ofNullable(user).map(User::getAddress)  .map(Address::getCountry).map(Country::getZipcode).orElse(null);</code></pre><h2 class=pgc-h-arrow-right><strong>8.åˆ©ç”¨ Stream</strong></h2><hr><p>æµï¼ˆStreamï¼‰æ˜¯Java 8çš„æ–°æˆå‘˜ï¼Œå…è®¸ä½ ä»¥å£°æ˜å¼å¤„ç†æ•°æ®é›†åˆï¼Œå¯ä»¥çœ‹æˆä¸ºä¸€ä¸ªéå†æ•°æ®é›†çš„é«˜çº§è¿­ä»£å™¨ã€‚æµä¸»è¦æœ‰ä¸‰éƒ¨åˆ†æ„æˆï¼šè·å–ä¸€ä¸ªæ•°æ®æºâ†’æ•°æ®è½¬æ¢â†’æ‰§è¡Œæ“ä½œè·å–æƒ³è¦çš„ç»“æœã€‚æ¯æ¬¡è½¬æ¢åŸæœ‰ Stream å¯¹è±¡ä¸æ”¹å˜ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Stream å¯¹è±¡ï¼Œè¿™å°±å…è®¸å¯¹å…¶æ“ä½œå¯ä»¥åƒé“¾æ¡ä¸€æ ·æ’åˆ—ï¼Œå½¢æˆäº†ä¸€ä¸ªç®¡é“ã€‚æµï¼ˆStreamï¼‰æä¾›çš„åŠŸèƒ½éå¸¸æœ‰ç”¨ï¼Œä¸»è¦åŒ…æ‹¬åŒ¹é…ã€è¿‡æ»¤ã€æ±‡æ€»ã€è½¬åŒ–ã€åˆ†ç»„ã€åˆ†ç»„æ±‡æ€»ç­‰åŠŸèƒ½ã€‚</p><h3 class=pgc-h-arrow-right><strong>8.1.åŒ¹é…é›†åˆæ•°æ®</strong></h3><p><strong>æ™®é€šï¼š</strong></p><pre><code>boolean isFound = false;for (UserDO user : userList) {   if (Objects.equals(user.getId(), userId)) {    isFound = true;    break;  }}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>boolean isFound = userList.stream()  .anyMatch(user -&gt; Objects.equals(user.getId(), userId));</code></pre><h2 class=pgc-h-arrow-right><br>8.2.è¿‡æ»¤é›†åˆæ•°æ®</h2><p><strong>æ™®é€šï¼š</strong></p><pre><code>List&lt;UserDO&gt; resultList = new ArrayList&lt;&gt;();for (UserDO user : userList) {  if (Boolean.TRUE.equals(user.getIsSuper())) {    resultList.add(user);  }}</code></pre><p><br><strong>ç²¾ç®€ï¼š</strong></p><pre><code>List&lt;UserDO&gt; resultList = userList.stream()   .filter(user -&gt; Boolean.TRUE.equals(user.getIsSuper()))  .collect(Collectors.toList());</code></pre><h2 class=pgc-h-arrow-right><br>8.3.æ±‡æ€»é›†åˆæ•°æ®</h2><p><strong>æ™®é€šï¼š</strong></p><pre><code>double total = 0.0D;for (Account account : accountList) {  total += account.getBalance();}</code></pre><p><br><strong>ç²¾ç®€ï¼š</strong></p><pre><code>double total = accountList.stream().mapToDouble(Account::getBalance).sum();</code></pre><p><br></p><h2 class=pgc-h-arrow-right>8.4.è½¬åŒ–é›†åˆæ•°æ®</h2><p><br></p><p><strong>æ™®é€šï¼š</strong></p><pre><code>List&lt;UserVO&gt; userVOList = new ArrayList&lt;&gt;();for (UserDO userDO : userDOList) {  userVOList.add(transUser(userDO));}</code></pre><p><br><strong>ç²¾ç®€ï¼š</strong></p><pre><code>List&lt;UserVO&gt; userVOList = userDOList.stream()  .map(this::transUser).collect(Collectors.toList());</code></pre><h3 class=pgc-h-arrow-right><strong>8.5.åˆ†ç»„é›†åˆæ•°æ®</strong></h3><p><strong>æ™®é€šï¼š</strong></p><pre><code>Map&lt;Long, List&lt;UserDO&gt;&gt; roleUserMap = new HashMap&lt;&gt;();for (UserDO userDO : userDOList) {  roleUserMap.computeIfAbsent(userDO.getRoleId(), key -&gt; new ArrayList&lt;&gt;())    .add(userDO);}</code></pre><p><br><strong>ç²¾ç®€ï¼š</strong></p><p>Map&lt;Long, List&lt;UserDO>> roleUserMap = userDOList.stream()<br>.collect(Collectors.groupingBy(UserDO::getRoleId));</p><h2 class=pgc-h-arrow-right><br>8.6.åˆ†ç»„æ±‡æ€»é›†åˆ</h2><p><strong>æ™®é€šï¼š</strong></p><pre><code>Map&lt;Long, Double&gt; roleTotalMap = new HashMap&lt;&gt;();for (Account account : accountList) {  Long roleId = account.getRoleId();   Double total = Optional.ofNullable(roleTotalMap.get(roleId)).orElse(0.0D);  roleTotalMap.put(roleId, total + account.getBalance());}</code></pre><p><br><strong>ç²¾ç®€ï¼š</strong></p><pre><code>roleTotalMap = accountList.stream()  .collect(Collectors.groupingBy(Account::getRoleId, Collectors.summingDouble(Account::getBalance)));</code></pre><p><br></p><h2 class=pgc-h-arrow-right>8.7.ç”ŸæˆèŒƒå›´é›†åˆ</h2><p><br></p><p>Python çš„ range éå¸¸æ–¹ä¾¿ï¼ŒStream ä¹Ÿæä¾›äº†ç±»ä¼¼çš„æ–¹æ³•ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>int[] array1 = new int[N];for (int i = 0; i &lt; N; i++) {  array1[i] = i + 1;}int[] array2 = new int[N];array2[0] = 1;for (int i = 1; i &lt; N; i++) {  array2[i] = array2[i - 1] * 2;}</code></pre><p><br><strong>ç²¾ç®€ï¼š</strong></p><pre><code>int[] array1 = IntStream.rangeClosed(1, N).toArray();int[] array2 = IntStream.iterate(1, n -&gt; n * 2).limit(N).toArray();</code></pre><h2 class=pgc-h-arrow-right><strong>9.åˆ©ç”¨ç¨‹åºç»“æ„</strong></h2><hr><h3 class=pgc-h-arrow-right><strong>9.1.è¿”å›æ¡ä»¶è¡¨è¾¾å¼</strong></h3><p>æ¡ä»¶è¡¨è¾¾å¼åˆ¤æ–­è¿”å›å¸ƒå°”å€¼ï¼Œæ¡ä»¶è¡¨è¾¾å¼æœ¬èº«å°±æ˜¯ç»“æœã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>public boolean isSuper(Long userId)    UserDO user = userDAO.get(userId);if (Objects.nonNull(user) &amp;&amp; Boolean.TRUE.equals(user.getIsSuper())) {  return true; } return false;}</code></pre><p><br><strong>ç²¾ç®€ï¼š</strong></p><pre><code>public boolean isSuper(Long userId){  UserDO user = userDAO.get(userId);   return Objects.nonNull(user) &amp;&amp; Boolean.TRUE.equals(user.getIsSuper());}</code></pre><h2 class=pgc-h-arrow-right><br>9.2.æœ€å°åŒ–æ¡ä»¶ä½œç”¨åŸŸ</h2><p>æœ€å°åŒ–æ¡ä»¶ä½œç”¨åŸŸï¼Œå°½é‡æå‡ºå…¬å…±å¤„ç†ä»£ç ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>Result result = summaryService.reportWorkDaily(workDaily);if (result.isSuccess()) {  String message = "ä¸ŠæŠ¥å·¥ä½œæ—¥æŠ¥æˆåŠŸ";   dingtalkService.sendMessage(user.getPhone(), message);} else {  String message = "ä¸ŠæŠ¥å·¥ä½œæ—¥æŠ¥å¤±è´¥:" + result.getMessage();  log.warn(message);  dingtalkService.sendMessage(user.getPhone(), message);}</code></pre><p><br><strong>ç²¾ç®€ï¼š</strong></p><pre><code>String message;Result result = summaryService.reportWorkDaily(workDaily);if (result.isSuccess()) {  message = "ä¸ŠæŠ¥å·¥ä½œæ—¥æŠ¥æˆåŠŸ";} else {  message = "ä¸ŠæŠ¥å·¥ä½œæ—¥æŠ¥å¤±è´¥:" + result.getMessage();  log.warn(message);}dingtalkService.sendMessage(user.getPhone(), message);}</code></pre><h3 class=pgc-h-arrow-right><strong>9.3.è°ƒæ•´è¡¨è¾¾å¼ä½ç½®</strong></h3><p>è°ƒæ•´è¡¨è¾¾å¼ä½ç½®ï¼Œåœ¨é€»è¾‘ä¸å˜çš„å‰æä¸‹ï¼Œè®©ä»£ç å˜å¾—æ›´ç®€æ´ã€‚</p><p><strong>æ™®é€š1ï¼š</strong></p><pre><code>String line = readLine();while (Objects.nonNull(line)) {    ... // å¤„ç†é€»è¾‘ä»£ç     line = readLine();}</code></pre><p><strong>æ™®é€š2ï¼š</strong></p><pre><code>for (String line = readLine(); Objects.nonNull(line); line = readLine()) {    ... // å¤„ç†é€»è¾‘ä»£ç }</code></pre><p><br></p><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>String line;while (Objects.nonNull(line = readLine())) {    ... // å¤„ç†é€»è¾‘ä»£ç }</code></pre><p>æ³¨æ„ï¼šæœ‰äº›è§„èŒƒå¯èƒ½ä¸å»ºè®®è¿™ç§ç²¾ç®€å†™æ³•ã€‚</p><h3 class=pgc-h-arrow-right><strong>9.4.åˆ©ç”¨éç©ºå¯¹è±¡</strong></h3><p>åœ¨æ¯”è¾ƒå¯¹è±¡æ—¶ï¼Œäº¤æ¢å¯¹è±¡ä½ç½®ï¼Œåˆ©ç”¨éç©ºå¯¹è±¡ï¼Œå¯ä»¥é¿å…ç©ºæŒ‡é’ˆåˆ¤æ–­ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>private static final int MAX_VALUE = 1000;boolean isMax = (value != null &amp;&amp; value.equals(MAX_VALUE));boolean isTrue = (result != null &amp;&amp; result.equals(Boolean.TRUE));</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>private static final Integer MAX_VALUE = 1000;boolean isMax = MAX_VALUE.equals(value);boolean isTrue = Boolean.TRUE.equals(result);</code></pre><h2 class=pgc-h-arrow-right><strong>10.åˆ©ç”¨è®¾è®¡æ¨¡å¼</strong></h2><hr><p><strong>10.1.æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong></p><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Method Patternï¼‰å®šä¹‰ä¸€ä¸ªå›ºå®šçš„ç®—æ³•æ¡†æ¶ï¼Œè€Œå°†ç®—æ³•çš„ä¸€äº›æ­¥éª¤æ”¾åˆ°å­ç±»ä¸­å®ç°ï¼Œä½¿å¾—å­ç±»å¯ä»¥åœ¨ä¸æ”¹å˜ç®—æ³•æ¡†æ¶çš„æƒ…å†µä¸‹é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›æ­¥éª¤ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>@Repositorypublic class UserValue {  /** å€¼æ“ä½œ */  @Resource(name = "stringRedisTemplate")   private ValueOperations&lt;String, String&gt; valueOperations;/** å€¼æ¨¡å¼ */private static final String KEY_FORMAT = "Value:User:%s";/** è®¾ç½®å€¼ */public void set(Long id, UserDO value) {  String key = String.format(KEY_FORMAT, id);  valueOperations.set(key, JSON.toJSONString(value));} /** è·å–å€¼ */ public UserDO get(Long id) {   String key = String.format(KEY_FORMAT, id);  String value = valueOperations.get(key);  return JSON.parseObject(value, UserDO.class); } ...}@Repositorypublic class RoleValue {  /** å€¼æ“ä½œ */  @Resource(name = "stringRedisTemplate")  private ValueOperations&lt;String, String&gt; valueOperations;/** å€¼æ¨¡å¼ */private static final String KEY_FORMAT = "Value:Role:%s";/** è®¾ç½®å€¼ */ public void set(Long id, RoleDO value) {  String key = String.format(KEY_FORMAT, id);  valueOperations.set(key, JSON.toJSONString(value));} /** è·å–å€¼ */ public RoleDO get(Long id) {  String key = String.format(KEY_FORMAT, id);   String value = valueOperations.get(key);  return JSON.parseObject(value, RoleDO.class);}...}</code></pre><p><br><strong>ç²¾ç®€ï¼š</strong></p><pre><code>public abstract class AbstractDynamicValue&lt;I, V&gt; {  /** å€¼æ“ä½œ */  @Resource(name = "stringRedisTemplate")  private ValueOperations&lt;String, String&gt; valueOperations; /** è®¾ç½®å€¼ */ public void set(I id, V value) {  valueOperations.set(getKey(id), JSON.toJSONString(value));}/** è·å–å€¼ */public V get(I id) {  return JSON.parseObject(valueOperations.get(getKey(id)), getValueClass());}... /** è·å–ä¸»é”® */ protected abstract String getKey(I id);/** è·å–å€¼ç±» */protected abstract Class&lt;V&gt; getValueClass();}@Repositorypublic class UserValue extends AbstractValue&lt;Long, UserDO&gt; {    /** è·å–ä¸»é”® */    @Override    protected String getKey(Long id) {        return String.format("Value:User:%s", id);    }    /** è·å–å€¼ç±» */    @Override    protected Class&lt;UserDO&gt; getValueClass() {        return UserDO.class;    }}@Repositorypublic class RoleValue extends AbstractValue&lt;Long, RoleDO&gt; {    /** è·å–ä¸»é”® */    @Override    protected String getKey(Long id) {        return String.format("Value:Role:%s", id);    }    /** è·å–å€¼ç±» */    @Override    protected Class&lt;RoleDO&gt; getValueClass() {        return RoleDO.class;    }}</code></pre><h3 class=pgc-h-arrow-right><strong>10.2.å»ºé€ è€…æ¨¡å¼</strong></h3><p>å»ºé€ è€…æ¨¡å¼ï¼ˆBuilder Patternï¼‰å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„é€ ä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºï¼Œè¿™æ ·çš„è®¾è®¡æ¨¡å¼è¢«ç§°ä¸ºå»ºé€ è€…æ¨¡å¼ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>public interface DataHandler&lt;T&gt; {   /** è§£ææ•°æ® */  public T parseData(Record record); /** å­˜å‚¨æ•°æ® */public boolean storeData(List&lt;T&gt; dataList);}public &lt;T&gt; long executeFetch(String tableName, int batchSize, DataHandler&lt;T&gt; dataHandler) throws Exception {  // æ„å»ºä¸‹è½½ä¼šè¯  DownloadSession session = buildSession(tableName);  // è·å–æ•°æ®æ•°é‡  long recordCount = session.getRecordCount();  if (recordCount == 0) {    return 0;  }  // è¿›è¡Œæ•°æ®è¯»å–  long fetchCount = 0L;   try (RecordReader reader = session.openRecordReader(0L, recordCount, true)) {    // ä¾æ¬¡è¯»å–æ•°æ®    Record record;     List&lt;T&gt; dataList = new ArrayList&lt;&gt;(batchSize);     while ((record = reader.read()) != null) {      // è§£ææ·»åŠ æ•°æ®      T data = dataHandler.parseData(record);      if (Objects.nonNull(data)) {         dataList.add(data);        }       // æ‰¹é‡å­˜å‚¨æ•°æ®        if (dataList.size() == batchSize) {        boolean isContinue = dataHandler.storeData(dataList);         fetchCount += batchSize;         dataList.clear();          if (!isContinue) {          break;         }        }     }     // å­˜å‚¨å‰©ä½™æ•°æ®    if (CollectionUtils.isNotEmpty(dataList)) {      dataHandler.storeData(dataList);      fetchCount += dataList.size();       dataList.clear();    }  }   // è¿”å›è·å–æ•°é‡  return fetchCount;}// ä½¿ç”¨æ¡ˆä¾‹long fetchCount = odpsService.executeFetch("user", 5000, new DataHandler() {                                           /** è§£ææ•°æ® */                    @Override                   public T parseData(Record record) {                      UserDO user = new UserDO();                      user.setId(record.getBigint("id"));                      user.setName(record.getString("name"));                      return user;                    }                    /** å­˜å‚¨æ•°æ® */                    @Override                    public boolean storeData(List&lt;T&gt; dataList) {                        userDAO.batchInsert(dataList);                        return true;                    }});</code></pre><p><br></p><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>public &lt;T&gt; long executeFetch(String tableName, int batchSize, Function&lt;Record, T&gt; dataParser, Function&lt;List&lt;T&gt;, Boolean&gt; dataStorage) throws Exception {    // æ„å»ºä¸‹è½½ä¼šè¯    DownloadSession session = buildSession(tableName);    // è·å–æ•°æ®æ•°é‡    long recordCount = session.getRecordCount();    if (recordCount == 0) {        return 0;    }    // è¿›è¡Œæ•°æ®è¯»å–    long fetchCount = 0L;    try (RecordReader reader = session.openRecordReader(0L, recordCount, true)) {        // ä¾æ¬¡è¯»å–æ•°æ®        Record record;        List&lt;T&gt; dataList = new ArrayList&lt;&gt;(batchSize);        while ((record = reader.read()) != null) {            // è§£ææ·»åŠ æ•°æ®            T data = dataParser.apply(record);            if (Objects.nonNull(data)) {                dataList.add(data);            }            // æ‰¹é‡å­˜å‚¨æ•°æ®            if (dataList.size() == batchSize) {                Boolean isContinue = dataStorage.apply(dataList);                fetchCount += batchSize;                dataList.clear();                if (!Boolean.TRUE.equals(isContinue)) {                    break;                }            }        }        // å­˜å‚¨å‰©ä½™æ•°æ®        if (CollectionUtils.isNotEmpty(dataList)) {            dataStorage.apply(dataList);            fetchCount += dataList.size();            dataList.clear();        }    }    // è¿”å›è·å–æ•°é‡    return fetchCount;} // ä½¿ç”¨æ¡ˆä¾‹long fetchCount = odpsService.executeFetch("user", 5000, record -&gt; {        UserDO user = new UserDO();        user.setId(record.getBigint("id"));        user.setName(record.getString("name"));        return user;    }, dataList -&gt; {        userDAO.batchInsert(dataList);        return true;    });</code></pre><p><br></p><p>æ™®é€šçš„å»ºé€ è€…æ¨¡å¼ï¼Œå®ç°æ—¶éœ€è¦å®šä¹‰ DataHandler æ¥å£ï¼Œè°ƒç”¨æ—¶éœ€è¦å®ç° DataHandler åŒ¿åå†…éƒ¨ç±»ï¼Œä»£ç è¾ƒå¤šè¾ƒç¹çã€‚è€Œç²¾ç®€åçš„å»ºé€ è€…æ¨¡å¼ï¼Œå……åˆ†åˆ©ç”¨äº†å‡½æ•°å¼ç¼–ç¨‹ï¼Œå®ç°æ—¶æ— éœ€å®šä¹‰æ¥å£ï¼Œç›´æ¥ä½¿ç”¨ Function æ¥å£ï¼›è°ƒç”¨æ—¶æ— éœ€å®ç°åŒ¿åå†…éƒ¨ç±»ï¼Œç›´æ¥é‡‡ç”¨ lambda è¡¨è¾¾å¼ï¼Œä»£ç è¾ƒå°‘è¾ƒç®€æ´ã€‚</p><h3 class=pgc-h-arrow-right><strong>10.3.ä»£ç†æ¨¡å¼</strong></h3><p>Spring ä¸­æœ€é‡è¦çš„ä»£ç†æ¨¡å¼å°±æ˜¯ AOP (Aspect-Oriented Programmingï¼Œé¢å‘åˆ‡é¢çš„ç¼–ç¨‹)ï¼Œæ˜¯ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŠ¨æ€ä»£ç†æŠ€æœ¯æ¥å®ç°çš„ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>@Slf4j@RestController@RequestMapping("/user")public class UserController {    /** ç”¨æˆ·æœåŠ¡ */    @Autowired    private UserService userService;    /** æŸ¥è¯¢ç”¨æˆ· */    @PostMapping("/queryUser")    public Result&lt;?&gt; queryUser(@RequestBody @Valid UserQueryVO query) {        try {            PageDataVO&lt;UserVO&gt; pageData = userService.queryUser(query);            return Result.success(pageData);        } catch (Exception e) {            log.error(e.getMessage(), e);            return Result.failure(e.getMessage());        }    }    ...}</code></pre><p><br></p><p><strong>ç²¾ç®€1ï¼š</strong></p><p><br></p><p>åŸºäº @ControllerAdvice çš„å¼‚å¸¸å¤„ç†ï¼š</p><pre><code>@RestController@RequestMapping("/user")public class UserController {    /** ç”¨æˆ·æœåŠ¡ */    @Autowired    private UserService userService;    /** æŸ¥è¯¢ç”¨æˆ· */    @PostMapping("/queryUser")    public Result&lt;PageDataVO&lt;UserVO&gt;&gt; queryUser(@RequestBody @Valid UserQueryVO query) {        PageDataVO&lt;UserVO&gt; pageData = userService.queryUser(query);        return Result.success(pageData);    }    ...}@Slf4j@ControllerAdvicepublic class GlobalControllerAdvice {    /** å¤„ç†å¼‚å¸¸ */    @ResponseBody    @ExceptionHandler(Exception.class)    public Result&lt;Void&gt; handleException(Exception e) {        log.error(e.getMessage(), e);        return Result.failure(e.getMessage());    }}</code></pre><p><br></p><p><strong>ç²¾ç®€2ï¼š</strong></p><p><br></p><p>åŸºäº AOP çš„å¼‚å¸¸å¤„ç†ï¼š</p><pre><code>// UserControllerä»£ç åŒ"ç²¾ç®€1"@Slf4j@Aspectpublic class WebExceptionAspect {    /** ç‚¹åˆ‡é¢ */    @Pointcut("@annotation(org.springframework.web.bind.annotation.RequestMapping)")    private void webPointcut() {}    /** å¤„ç†å¼‚å¸¸ */    @AfterThrowing(pointcut = "webPointcut()", throwing = "e")    public void handleException(Exception e) {        Result&lt;Void&gt; result = Result.failure(e.getMessage());        writeContent(JSON.toJSONString(result));    }    ...}</code></pre><p><br></p><h2 class=pgc-h-arrow-right><strong>11.åˆ©ç”¨åˆ é™¤ä»£ç </strong></h2><hr><p>â€œå°‘å³æ˜¯å¤šâ€ï¼Œâ€œå°‘â€ä¸æ˜¯ç©ºç™½è€Œæ˜¯ç²¾ç®€ï¼Œâ€œå¤šâ€ä¸æ˜¯æ‹¥æŒ¤è€Œæ˜¯å®Œç¾ã€‚åˆ é™¤å¤šä½™çš„ä»£ç ï¼Œæ‰èƒ½ä½¿ä»£ç æ›´ç²¾ç®€æ›´å®Œç¾ã€‚</p><h3 class=pgc-h-arrow-right><strong>11.1.åˆ é™¤å·²åºŸå¼ƒçš„ä»£ç </strong></h3><p>åˆ é™¤é¡¹ç›®ä¸­çš„å·²åºŸå¼ƒçš„åŒ…ã€ç±»ã€å­—æ®µã€æ–¹æ³•ã€å˜é‡ã€å¸¸é‡ã€å¯¼å…¥ã€æ³¨è§£ã€æ³¨é‡Šã€å·²æ³¨é‡Šä»£ç ã€MavenåŒ…å¯¼å…¥ã€MyBatisçš„SQLè¯­å¥ã€å±æ€§é…ç½®å­—æ®µç­‰ï¼Œå¯ä»¥ç²¾ç®€é¡¹ç›®ä»£ç ä¾¿äºç»´æŠ¤ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>import lombok.extern.slf4j.Slf4j;@Slf4j@Servicepublic class ProductService {    @Value("discardRate")    private double discardRate;    ...    private ProductVO transProductDO(ProductDO productDO) {        ProductVO productVO = new ProductVO();        BeanUtils.copyProperties(productDO, productVO);        // productVO.setPrice(getDiscardPrice(productDO.getPrice()));        return productVO;    }    private BigDecimal getDiscardPrice(BigDecimal originalPrice) {        ...    }}</code></pre><p><br></p><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>@Servicepublic class ProductService {    ...    private ProductVO transProductDO(ProductDO productDO) {        ProductVO productVO = new ProductVO();        BeanUtils.copyProperties(productDO, productVO);        return productVO;    }}11.2.åˆ é™¤æ¥å£æ–¹æ³•çš„publicå¯¹äºæ¥å£(interface)ï¼Œæ‰€æœ‰çš„å­—æ®µå’Œæ–¹æ³•éƒ½æ˜¯publicçš„ï¼Œå¯ä»¥ä¸ç”¨æ˜¾å¼å£°æ˜ä¸ºpublicã€‚æ™®é€šï¼špublic interface UserDAO {    public Long countUser(@Param("query") UserQuery query);    public List&lt;UserDO&gt; queryUser(@Param("query") UserQuery query);}</code></pre><pre><code></code></pre><h3 class=pgc-h-arrow-right><strong>11.2.åˆ é™¤æ¥å£æ–¹æ³•çš„public</strong></h3><p>å¯¹äºæ¥å£(interface)ï¼Œæ‰€æœ‰çš„å­—æ®µå’Œæ–¹æ³•éƒ½æ˜¯ public çš„ï¼Œå¯ä»¥ä¸ç”¨æ˜¾å¼å£°æ˜ä¸º public ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>public interface UserDAO {    public Long countUser(@Param("query") UserQuery query);    public List&lt;UserDO&gt; queryUser(@Param("query") UserQuery query);}</code></pre><p><br></p><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>public interface UserDAO {    Long countUser(@Param("query") UserQuery query);    List&lt;UserDO&gt; queryUser(@Param("query") UserQuery query);}</code></pre><h3 class=pgc-h-arrow-right><br></h3><h3 class=pgc-h-arrow-right><strong>11.3.åˆ é™¤æšä¸¾æ„é€ æ–¹æ³•çš„ private</strong></h3><p>å¯¹äºæšä¸¾(menu)ï¼Œæ„é€ æ–¹æ³•éƒ½æ˜¯ private çš„ï¼Œå¯ä»¥ä¸ç”¨æ˜¾å¼å£°æ˜ä¸º private ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>public enum UserStatus {    DISABLED(0, "ç¦ç”¨"),    ENABLED(1, "å¯ç”¨");  private final Integer value;    private final String desc;    private UserStatus(Integer value, String desc) {        this.value = value;        this.desc = desc;    }    ...}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>public enum UserStatus {    DISABLED(0, "ç¦ç”¨"),    ENABLED(1, "å¯ç”¨");    private final Integer value;    private final String desc;    UserStatus(Integer value, String desc) {        this.value = value;        this.desc = desc;    }    ...}</code></pre><h3 class=pgc-h-arrow-right><br></h3><h3 class=pgc-h-arrow-right><strong>11.4.åˆ é™¤ final ç±»æ–¹æ³•çš„ final</strong></h3><p>å¯¹äº final ç±»ï¼Œä¸èƒ½è¢«å­ç±»ç»§æ‰¿ï¼Œæ‰€ä»¥å…¶æ–¹æ³•ä¸ä¼šè¢«è¦†ç›–ï¼Œæ²¡æœ‰å¿…è¦æ·»åŠ  final ä¿®é¥°ã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>public final Rectangle implements Shape {    ...    @Override    public final double getArea() {        return width * height;    }}</code></pre><p><br></p><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>public final Rectangle implements Shape {    ...    @Override    public double getArea() {        return width * height;    }}</code></pre><h3 class=pgc-h-arrow-right><br></h3><h3 class=pgc-h-arrow-right><strong>11.5.åˆ é™¤åŸºç±» implements çš„æ¥å£</strong></h3><p>å¦‚æœåŸºç±»å·² implements æŸæ¥å£ï¼Œå­ç±»æ²¡æœ‰å¿…è¦å† implements è¯¥æ¥å£ï¼Œåªéœ€è¦ç›´æ¥å®ç°æ¥å£æ–¹æ³•å³å¯ã€‚</p><p><br></p><p><strong>æ™®é€šï¼š</strong></p><pre><code>public interface Shape {    ...    double getArea();}public abstract AbstractShape implements Shape {    ...}public final Rectangle extends AbstractShape implements Shape {    ...    @Override    public double getArea() {        return width * height;    }}</code></pre><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>...public final Rectangle extends AbstractShape {    ...    @Override    public double getArea() {        return width * height;    }}</code></pre><h3 class=pgc-h-arrow-right><br></h3><h3 class=pgc-h-arrow-right><strong>11.6.åˆ é™¤ä¸å¿…è¦çš„å˜é‡</strong></h3><p>ä¸å¿…è¦çš„å˜é‡ï¼Œåªä¼šè®©ä»£ç çœ‹èµ·æ¥æ›´ç¹çã€‚</p><p><strong>æ™®é€šï¼š</strong></p><pre><code>public Boolean existsUser(Long userId) {    Boolean exists = userDAO.exists(userId);    return exists;}</code></pre><p><br></p><p><strong>ç²¾ç®€ï¼š</strong></p><pre><code>public Boolean existsUser(Long userId) {    return userDAO.exists(userId);}</code></pre><h2 class=pgc-h-arrow-right><strong>åè®°</strong></h2><hr><p><br></p><p>å¤è¯­åˆäº‘ï¼š</p><blockquote><p>æœ‰é“æ— æœ¯ï¼Œæœ¯å°šå¯æ±‚ä¹Ÿï¼›æœ‰æœ¯æ— é“ï¼Œæ­¢äºæœ¯ã€‚</p></blockquote><p>æ„æ€æ˜¯ï¼šæœ‰â€œé“â€è€Œæ— â€œæœ¯â€ï¼Œâ€œæœ¯â€è¿˜å¯ä»¥é€æ¸è·å¾—ï¼›æœ‰â€œæœ¯â€è€Œæ— â€œé“â€ï¼Œå°±å¯èƒ½æ­¢æ­¥äºâ€œæœ¯â€äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸è¦ä»…æ»¡è¶³äºä»å®è·µä¸­æ€»ç»“â€œæœ¯â€ï¼Œå› ä¸ºâ€œé“â€çš„è¡¨ç°å½¢å¼æ˜¯å¤šå˜çš„ï¼›è€Œåº”è¯¥ä¸Šå‡åˆ°â€œé“â€çš„é«˜åº¦ï¼Œå› ä¸ºâ€œæœ¯â€èƒŒåçš„é“ç†æ˜¯ç›¸é€šçš„ã€‚å½“é‡åˆ°æ–°çš„äº‹ç‰©æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»ç†è®ºä¸­æ‰¾åˆ°â€œé“â€ã€ä»å®è·µä¸­æ‰¾å‡ºâ€œæœ¯â€ï¼Œå°è¯•ç€å»è®¤çŸ¥æ–°çš„äº‹ç‰©ã€‚</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'ç¤ºä¾‹','è‡³ç®€','Java'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>