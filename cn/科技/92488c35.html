<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Springå­¦ä¹ ï¼ˆ4ï¼‰ï¼šSpring AOP | æå®¢å¿«è¨Š</title><meta property="og:title" content="Springå­¦ä¹ ï¼ˆ4ï¼‰ï¼šSpring AOP - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/be8a179a4a8040648c1fb5a0532cc84b"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/92488c35.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/92488c35.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/92488c35.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/92488c35.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/92488c35.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/92488c35.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/92488c35.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/92488c35.html><meta property="article:published_time" content="2020-11-14T21:04:29+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:29+08:00"><meta name=Keywords content><meta name=description content="Springå­¦ä¹ ï¼ˆ4ï¼‰ï¼šSpring AOP"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/92488c35.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Springå­¦ä¹ ï¼ˆ4ï¼‰ï¼šSpring AOP</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h3 class=line>Spring AOPè¯´æ˜</h3><p>AOPï¼ˆAspect Oriented Pragramingï¼‰é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ŒAOPé‡‡ç”¨æ¨ªå‘æŠ½å–æœºåˆ¶ï¼Œå–ä»£äº†ä¼ ç»Ÿçºµå‘ç»§æ‰¿ä½“ç³»çš„é‡å¤æ€§ä»£ç ï¼ˆæ€§èƒ½ç›‘è§†ã€äº‹åŠ¡ç®¡ç†ã€å®‰å…¨æ£€æŸ¥ã€ç¼“å­˜ï¼‰ã€‚</p><p>æ‰€è°“çš„ä¼ ç»Ÿçºµå‘ç»§æ‰¿ä½“ç³»æ˜¯æŒ‡å½“ä½ éœ€è¦å®ç°æŸä¸ªåŠŸèƒ½çš„æ—¶å€™éœ€è¦å»ç»§æ‰¿æŸä¸ªç±»ï¼Œè€Œæ¨ªå‘æŠ½å–æœºåˆ¶åˆ™æ˜¯é€šè¿‡ä½¿ç”¨åŠ¨æ€ä»£ç†æœºåˆ¶äº§ç”Ÿä¸€ä¸ªä¸ä¹‹åŒçº§çš„å¯¹è±¡ï¼Œç„¶ååœ¨ä»£ç†å¯¹è±¡ä¸­è¿›è¡ŒåŠŸèƒ½å¢å¼ºã€‚</p><p>Spring AOPä½¿ç”¨çº¯Javaå®ç°ï¼Œä¸éœ€è¦ä¸“é—¨çš„ç¼–è¯‘è¿‡ç¨‹å’Œç±»åŠ è½½å™¨ï¼Œåœ¨è¿è¡ŒæœŸé€šè¿‡ä»£ç†æ–¹å¼å‘ç›®æ ‡ç±»ç»‡å…¥å¢å¼ºä»£ç ã€‚</p><h3 class=line>Springçš„AOPä»£ç†</h3><p>JDKåŠ¨æ€ä»£ç†:å¯¹å®ç°äº†æ¥å£çš„ç±»ç”Ÿæˆä»£ç†CGLibä»£ç†æœºåˆ¶:å¯¹ç±»ç”Ÿæˆä»£ç†</p><h3 class=line>AOPç›¸å…³æœ¯è¯­</h3><p><strong>Joinpoint(è¿æ¥ç‚¹):</strong>æ‰€è°“è¿æ¥ç‚¹æ˜¯æŒ‡é‚£äº›è¢«æ‹¦æˆªåˆ°çš„ç‚¹ã€‚åœ¨springä¸­,è¿™äº›ç‚¹æŒ‡çš„æ˜¯æ–¹æ³•,å› ä¸ºspringåªæ”¯æŒæ–¹æ³•ç±»å‹çš„è¿æ¥ç‚¹ï¼›<strong>Pointcut(åˆ‡å…¥ç‚¹):</strong>æ‰€è°“åˆ‡å…¥ç‚¹æ˜¯æŒ‡æˆ‘ä»¬è¦å¯¹å“ªäº›Joinpointè¿›è¡Œæ‹¦æˆªçš„å®šä¹‰ï¼›<strong>Advice(é€šçŸ¥/å¢å¼º):</strong>æ‰€è°“é€šçŸ¥æ˜¯æŒ‡æ‹¦æˆªåˆ°Joinpointä¹‹åæ‰€è¦åšçš„äº‹æƒ…å°±æ˜¯é€šçŸ¥ã€‚é€šçŸ¥åˆ†ä¸ºå‰ç½®é€šçŸ¥ï¼Œåç½®é€šçŸ¥ï¼Œå¼‚å¸¸é€šçŸ¥ï¼Œæœ€ç»ˆé€šçŸ¥ï¼Œç¯ç»•é€šçŸ¥(åˆ‡é¢è¦å®Œæˆçš„åŠŸèƒ½)ï¼›<strong>Introduction(å¼•ä»‹):</strong>å¼•ä»‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„é€šçŸ¥åœ¨ä¸ä¿®æ”¹ç±»ä»£ç çš„å‰æä¸‹, Introductionå¯ä»¥åœ¨è¿è¡ŒæœŸä¸ºç±»åŠ¨æ€åœ°æ·»åŠ ä¸€äº›æ–¹æ³•æˆ–Fieldï¼›<strong>Target(ç›®æ ‡å¯¹è±¡):</strong>ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼›<strong>Weaving(ç»‡å…¥):</strong>æ˜¯æŒ‡æŠŠå¢å¼ºåº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡æ¥åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚springé‡‡ç”¨åŠ¨æ€ä»£ç†ç»‡å…¥ï¼Œè€ŒAspectJé‡‡ç”¨ç¼–è¯‘æœŸç»‡å…¥å’Œç±»è£…è½½æœŸç»‡å…¥ï¼›<strong>Proxyï¼ˆä»£ç†ï¼‰:</strong>ä¸€ä¸ªç±»è¢«AOPç»‡å…¥å¢å¼ºåï¼Œå°±äº§ç”Ÿä¸€ä¸ªç»“æœä»£ç†ç±»ï¼›<strong>Aspect(åˆ‡é¢) :</strong>æ˜¯åˆ‡å…¥ç‚¹å’Œé€šçŸ¥ï¼ˆå¼•ä»‹ï¼‰çš„ç»“åˆã€‚</p><div class=pgc-img><img alt="Springå­¦ä¹ ï¼ˆ4ï¼‰ï¼šSpring AOP" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/be8a179a4a8040648c1fb5a0532cc84b><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="Springå­¦ä¹ ï¼ˆ4ï¼‰ï¼šSpring AOP" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/229735938bf44e95a4216e2374199024><p class=pgc-img-caption></p></div><h1 class=line>AOPçš„åº•å±‚å®ç°</h1><p>å‰é¢è¯´è¿‡AOPä»£ç†æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯JDKåŠ¨æ€ä»£ç†ï¼Œç”¨äºå¯¹å®ç°äº†æ¥å£çš„ç±»ç”Ÿæˆä»£ç†ï¼›å¦ä¸€ç§æ˜¯CGLibä»£ç†æœºåˆ¶ï¼Œç”¨äºå¯¹ç±»ç”Ÿæˆä»£ç†ã€‚</p><h3 class=line>JDKåŠ¨æ€ä»£ç†</h3><p>æ–°å»ºä¸€ä¸ªMavené¡¹ç›®ï¼Œåç§°ä¸ºSpringAOPï¼Œå¯¼å…¥Junitä¾èµ–ã€‚æ–°å»ºcom/envy/aop/demoæ–‡ä»¶å¤¹ï¼Œæ–°å»ºæ¥å£æ–‡ä»¶UserDao.javaï¼Œé‡Œé¢çš„ä»£ç ä¸ºï¼š</p><pre><code>public interface UserDao {    public void add();    public void update();}</code></pre><p>ä»¥åŠå®ç°ç±»UserDaoImpl.javaæ–‡ä»¶ï¼š</p><pre><code>public class UserDaoImpl implements UserDao {    public void add() {        System.out.println("this is add method");    }    public void update() {        System.out.println("this is update method");    }}</code></pre><p>æ¥ç€æ–°å»ºcom/envy/aop/testæ–‡ä»¶å¤¹ï¼Œæ–°å»ºæµ‹è¯•æ–‡ä»¶AopTest.javaï¼Œé‡Œé¢çš„ä»£ç ä¸ºï¼š</p><pre><code>public class AopTest {    @Test    public void testOne(){        UserDao userDao = new UserDaoImpl();        userDao.add();        userDao.update();    }}</code></pre><p>è¿è¡Œç»“æœï¼š</p><pre><code>this is add methodthis is update method</code></pre><p>ä¸Šè¿°æ˜¯ä¼ ç»Ÿçš„ç¼–ç¨‹æ–¹å¼ï¼Œæ¥ä¸‹æ¥æ˜¯ä½¿ç”¨JDKåŠ¨æ€ä»£ç†æ¨¡å¼çš„ç›¸å…³æ­¥éª¤ï¼ŒJDKåŠ¨æ€ä»£ç†æ¨¡å¼ç”¨äºå¯¹å®ç°äº†æ¥å£çš„ç±»ç”Ÿæˆä»£ç†ï¼Œè€Œæ­¤å¤„çš„UserDaoæœ¬èº«å°±æ˜¯ä¸€ä¸ªæ¥å£ã€‚</p><p>æ–°å»ºMyJDKProxy.javaæ–‡ä»¶ï¼Œé‡Œé¢ä»£ç ä¸ºï¼š</p><pre><code>public class MyJDKProxy implements InvocationHandler {    private UserDao userDao;    public MyJDKProxy(UserDao userDao){        this.userDao=userDao;    }    public Object createProxy(){        Object proxy= Proxy.newProxyInstance(userDao.getClass().getClassLoader(),userDao.getClass().getInterfaces(),this);        return proxy;    }    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {        if("add".equals(method.getName())){            //ä¸€äº›å¢å¼ºåŠŸèƒ½ï¼Œå¦‚æƒé™æ ¡éªŒ            System.out.println("å¼€å§‹æƒé™æ ¡éªŒæ“ä½œ");            return method.invoke(proxy,args);        }        return method.invoke(userDao,args);    }}</code></pre><p>æ¥ç€æ–°å»ºtestTwoæ–¹æ³•ï¼Œé‡Œé¢ä»£ç ä¸ºï¼š</p><pre><code>    @Test    public void testTwo(){        UserDao userDao = new UserDaoImpl();        UserDao proxy = (UserDao) new MyJDKProxy(userDao).createProxy();        proxy.add();        proxy.update();    }</code></pre><p>è¿è¡Œç»“æœï¼š</p><pre><code>Start permission verificationthis is add methodthis is update method</code></pre><h3 class=line>CGLIBåŠ¨æ€ä»£ç†</h3><p>CGLIB(Code Generation Library)æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ï¼Œé«˜æ€§èƒ½ï¼Œé«˜è´¨é‡çš„Codeç”Ÿæˆç±»åº“ï¼Œå®ƒå¯ä»¥åœ¨è¿è¡ŒæœŸæ‰©å±•Javaç±»ä¸å®ç°Javaæ¥å£ã€‚ Hibernateæ”¯æŒå®ƒæ¥å®ç°PO(Persistent Object æŒä¹…åŒ–å¯¹è±¡)å­—èŠ‚ç çš„åŠ¨æ€ç”Ÿæˆ(Hibernateå®é™…ä½¿ç”¨Javassistç”Ÿæˆä»£ç†ï¼Œè¯¥ä»£ç†å¯¹è±¡å°±æ˜¯æŒä¹…åŒ–ç±»çš„å­ç±»çš„å®ä¾‹)ï¼Œç°åœ¨åšcglibçš„å¼€å‘ï¼Œå¯ä»¥ä¸ç”¨ç›´æ¥å¼•å…¥cglibçš„åŒ…ï¼Œå› ä¸ºspringæ ¸å¿ƒä¸­å·²ç»é›†æˆäº†cglibã€‚</p><p>CGLIBç”Ÿæˆä»£ç†æœºåˆ¶ï¼šå…¶å®ç”Ÿæˆäº†ä¸€ä¸ªçœŸå®å¯¹è±¡çš„å­ç±»ã€‚</p><p>æ–°å»ºProductDao.javaæ–‡ä»¶ï¼Œé‡Œé¢çš„ä»£ç ä¸ºï¼š</p><pre><code>public class ProductDao {    public void add(){        System.out.println("add product");    }    public void update(){        System.out.println("update product");    }}</code></pre><p>æ¥ç€æ–°å»ºæµ‹è¯•æ–¹æ³•testThreeï¼Œé‡Œé¢çš„ä»£ç ä¸ºï¼š</p><pre><code>    @Test    public void testThree(){        ProductDao productDao = new ProductDao();        productDao.add();        productDao.update();    }</code></pre><p>è¿è¡Œç»“æœï¼š</p><pre><code>add productupdate product</code></pre><p>ä¸Šè¿°æ˜¯ä¼ ç»Ÿçš„ç¼–ç¨‹æ–¹å¼ï¼Œæ¥ä¸‹æ¥æ˜¯ä½¿ç”¨CGLIBåŠ¨æ€ä»£ç†æ¨¡å¼çš„ç›¸å…³æ­¥éª¤ï¼ŒCGLIBåŠ¨æ€ä»£ç†æ¨¡å¼ç”¨äºå¯¹ç±»ç”Ÿæˆä»£ç†ï¼Œè€Œæ­¤å¤„çš„ProductDaoæœ¬èº«å°±æ˜¯ä¸€ä¸ªç±»ã€‚</p><p>æ–°å»ºMyCGLibProxy.javaæ–‡ä»¶ï¼Œé‡Œé¢ä»£ç ä¸ºï¼š</p><pre><code>public class MyCGLibProxy implements MethodInterceptor {    private ProductDao productDao;    public MyCGLibProxy(ProductDao productDao){        this.productDao=productDao;    }    public Object createProxy(){        //1ã€è®¾ç½®æ ¸å¿ƒç±»        Enhancer enhancer = new Enhancer();        //2ã€è®¾ç½®çˆ¶ç±»        enhancer.setSuperclass(productDao.getClass());        //3ã€è®¾ç½®å›è°ƒ        enhancer.setCallback(this);        //4ã€ç”Ÿæˆä»£ç†        Object proxy = enhancer.create();        return proxy;    }    public Object intercept(Object proxy, Method method, Object[] args, MethodProxy methodProxy) throws Throwable {        if("add".equals(method.getName())){            //ä¸€äº›å¢å¼ºåŠŸèƒ½ï¼Œå¦‚æƒé™æ ¡éªŒ            System.out.println("Start permission verification");            return methodProxy.invokeSuper(proxy,args);        }        return methodProxy.invokeSuper(proxy,args);    }}</code></pre><p>æ¥ç€æ–°å»ºtestFouræ–¹æ³•ï¼Œé‡Œé¢ä»£ç ä¸ºï¼š</p><pre><code>    @Test    public void testFour(){        ProductDao productDao = new ProductDao();        ProductDao proxy = (ProductDao) new MyCGLibProxy(productDao).createProxy();        proxy.add();        proxy.update();    }</code></pre><p>è¿è¡Œç»“æœï¼š</p><pre><code>Start permission verificationadd productupdate product</code></pre><p>ä»£ç†çŸ¥è¯†æ€»ç»“ï¼š1ã€Springåœ¨è¿è¡ŒæœŸç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œä¸éœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„ç¼–è¯‘å™¨ï¼›2ã€SpringAOPçš„åº•å±‚å°±æ˜¯é€šè¿‡JDKåŠ¨æ€ä»£ç†æˆ–CGLibåŠ¨æ€ä»£ç†æŠ€æœ¯ä¸ºç›®æ ‡Beanæ‰§è¡Œæ¨ªå‘ç»‡å…¥ã€‚</p><p>è‹¥ç›®æ ‡å¯¹è±¡å®ç°äº†è‹¥å¹²æ¥å£ï¼ŒSpringä½¿ç”¨JDKçš„java.lang.reflect.Proxyç±»ä»£ç†ï¼›è‹¥ç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼ŒSpringä½¿ç”¨CGLIBåº“ç”Ÿæˆç›®æ ‡å¯¹è±¡çš„å­ç±»ã€‚åœ¨ç¨‹åºä¸­åº”ä¼˜å…ˆå¯¹æ¥å£åˆ›å»ºä»£ç†ï¼Œä¾¿äºç¨‹åºè§£è€¦ç»´æŠ¤ã€‚æ ‡è®°ä¸ºfinalçš„æ–¹æ³•ä¸èƒ½è¢«ä»£ç†ï¼Œå› ä¸ºè¯¥æ–¹æ³•ä¸èƒ½è¢«é‡å†™ã€‚å› æ­¤JDKåŠ¨æ€ä»£ç†æ˜¯é’ˆå¯¹æ¥å£ç”Ÿæˆå­ç±»ï¼Œæ¥å£ä¸­çš„æ–¹æ³•ä¸èƒ½ä½¿ç”¨finalæ¥ä¿®é¥°ï¼›CGLIbæ˜¯é’ˆå¯¹ç›®æ ‡ç±»ç”Ÿæˆå­ç±»ï¼Œç±»æˆ–è€…æ–¹æ³•ä¸èƒ½ä½¿ç”¨finalæ¥ä¿®é¥°ã€‚</p><p><strong>Springåªæ”¯æŒæ–¹æ³•è¿æ¥ç‚¹ï¼Œä¸æ”¯æŒå±æ€§è¿æ¥ç‚¹ã€‚</strong></p><h1 class=line>Springä¸­çš„AOP</h1><h3 class=line>SpringAOPå¢å¼ºç±»å‹</h3><p>AOPä¸æ˜¯ç”±Springå®šä¹‰ï¼Œè€Œæ˜¯AOPè”ç›Ÿç»„ç»‡æ¥å®šä¹‰çš„ã€‚SpringæŒ‰ç…§é€šçŸ¥Adviceåœ¨ç›®æ ‡ç±»æ–¹æ³•çš„è¿æ¥ç‚¹ä½ç½®ï¼Œå¯ä»¥åˆ†ä¸º5ä¸ªä½ç½®ï¼šå‰ç½®é€šçŸ¥ï¼šorg.springframework.aop.MethodBeforeAdvice:åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰å®æ–½å¢å¼ºï¼›åç½®é€šçŸ¥ï¼šorg.springframework.aop.AfterReturningAdvice:åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œåå®æ–½å¢å¼ºï¼›ç¯ç»•é€šçŸ¥ï¼šorg.aopalliance.intercept.MethodInterceptor:åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åå®æ–½å¢å¼ºï¼›å¼‚å¸¸æŠ›å‡ºé€šçŸ¥ï¼šorg.springframework.aop.ThrowsAdvice:åœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åå®æ–½å¢å¼ºï¼›å¼•ä»‹é€šçŸ¥ï¼šorg.springframework.aop.IntroductionInterceptor(ä¸ç ”ç©¶):åœ¨ç›®æ ‡ç±»ä¸­æ·»åŠ ä¸€äº›æ–°çš„æ–¹æ³•å’Œå±æ€§ã€‚</p><h3 class=line>SpringAOPåˆ‡é¢ç±»å‹</h3><p>Advisorï¼ˆSpringä¸­ä¼ ç»Ÿåˆ‡é¢ï¼‰å°±æ˜¯å¯¹PointCutåº”ç”¨Adviceã€‚ï¼ˆé€šå¸¸æ‰€è¯´çš„Advisoræ˜¯æŒ‡åªæœ‰ä¸€ä¸ªPointå’Œä¸€ä¸ªAdviceï¼Œè€ŒAspectæ˜¯å…·æœ‰å¤šä¸ªåˆ‡ç‚¹å’Œå¤šä¸ªé€šçŸ¥çš„ç»„åˆï¼‰ï¼›Advisor :ä»£è¡¨ä¸€èˆ¬åˆ‡é¢ï¼ŒAdviceæœ¬èº«å°±æ˜¯ä¸€ä¸ªåˆ‡é¢ï¼Œå¯¹ç›®æ ‡ç±»æ‰€æœ‰æ–¹æ³•è¿›è¡Œæ‹¦æˆª ï¼ˆæ²¡æœ‰åˆ‡ç‚¹ï¼‰ï¼›PointcutAdvisor :ä»£è¡¨å…·æœ‰åˆ‡ç‚¹çš„åˆ‡é¢ï¼Œå¯ä»¥æŒ‡å®šæ‹¦æˆªç›®æ ‡ç±»å“ªäº›æ–¹æ³•ï¼›IntroductionAdvisor : ä»£è¡¨å¼•ä»‹åˆ‡é¢ï¼Œé’ˆå¯¹å¼•ä»‹é€šçŸ¥è€Œä½¿ç”¨åˆ‡é¢ï¼ˆä¸è¦æ±‚æŒæ¡ï¼‰ã€‚</p><h1 class=line>SpringAOPçš„å¼€å‘</h1><h3 class=line>é’ˆå¯¹æ‰€æœ‰æ–¹æ³•çš„å¢å¼º(ä¸å¸¦åˆ‡ç‚¹çš„åˆ‡é¢)</h3><p>æ­¤å¤„æ¼”ç¤ºé’ˆå¯¹æ‰€æœ‰æ–¹æ³•çš„å¢å¼ºä¹Ÿå°±æ˜¯ä¸å¸¦åˆ‡ç‚¹çš„åˆ‡é¢ï¼Œç›¸åº”çš„æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p><p>ç¬¬ä¸€æ­¥ï¼šå¯¼å…¥ç›¸åº”çš„åŒ…ã€‚é¦–å…ˆåœ¨pom.xmlæ–‡ä»¶ä¸­å¼•å…¥spring-aopï¼Œspring-testå’Œcom.springsource.org.aopallianceï¼š</p><pre><code>&lt;dependency&gt;            &lt;groupId&gt;org.springframework&lt;/groupId&gt;            &lt;artifactId&gt;spring-aop&lt;/artifactId&gt;            &lt;version&gt;4.2.4.RELEASE&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;aopalliance&lt;/groupId&gt;            &lt;artifactId&gt;aopalliance&lt;/artifactId&gt;            &lt;version&gt;1.0&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework&lt;/groupId&gt;            &lt;artifactId&gt;spring-test&lt;/artifactId&gt;            &lt;version&gt;4.2.4.RELEASE&lt;/version&gt;&lt;/dependency&gt;</code></pre><p>ç¬¬äºŒæ­¥ï¼šç¼–å†™è¢«ä»£ç†å¯¹è±¡ã€‚æ–°å»ºcom.envy.aop.studentåŒ…ï¼Œæ¥ç€åœ¨é‡Œé¢æ–°å»ºæ¥å£StudentDao.javaæ–‡ä»¶ï¼Œé‡Œé¢ä»£ç ä¸ºï¼š</p><pre><code>public interface StudentDao {    public void add();    public void update();}</code></pre><p>ä»¥åŠå®ƒçš„å®ç°ç±»StudentDaoImpl.javaï¼š</p><pre><code>public class StudentDaoImpl implements StudentDao {    public void add() {        System.out.println("this is add method");    }    public void update() {        System.out.println("this is update method");    }}</code></pre><p>ç¬¬ä¸‰æ­¥ï¼Œç¼–å†™å¢å¼ºçš„ä»£ç ã€‚æ­¤å¤„ä»…ä»…ä»¥å‰ç½®é€šçŸ¥ä¸ºä¾‹æ¼”ç¤ºå¦‚ä½•ç¼–å†™å¢å¼ºä»£ç ï¼ˆå‰ç½®é€šçŸ¥ï¼šorg.springframework.aop.MethodBeforeAdvice:åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰å®æ–½å¢å¼ºï¼‰ã€‚æ–°å»ºMyBeforeAdvice.javaæ–‡ä»¶ï¼š</p><pre><code>public class MyBeforeAdvice implements MethodBeforeAdvice {    public void before(Method method, Object[] objects, Object o) throws Throwable {        System.out.println("å‰ç½®å¢å¼ºçš„æ–¹æ³•");    }}</code></pre><p>ç¬¬å››æ­¥ï¼Œç”Ÿæˆä»£ç†(é…ç½®ç”Ÿæˆä»£ç†)ã€‚æ–°å»ºapplicationContext.xmlæ–‡ä»¶ï¼Œé‡Œé¢çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>  &lt;!-- ä¸å¸¦æœ‰åˆ‡ç‚¹çš„åˆ‡é¢ --&gt;    &lt;!--  é…ç½®ç›®æ ‡ç±»(ç›®æ ‡å¯¹è±¡ï¼Œå³éœ€è¦ç»™å“ªä¸ªç±»è¿›è¡Œå¢å¼º) --&gt;    &lt;bean id="studentDao" class="com.envy.aop.student.StudentDaoImpl"/&gt;    &lt;!-- å‰ç½®é€šçŸ¥ç±»å‹ --&gt;    &lt;bean id="myBeforeAdvice" class="com.envy.aop.student.MyBeforeAdvice"/&gt;    &lt;!-- SpringAOPäº§ç”Ÿä»£ç†å¯¹è±¡ --&gt;    &lt;bean id="studentDaoProxy" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;        &lt;!-- é…ç½®ç›®æ ‡ç±»(ç›®æ ‡å¯¹è±¡ï¼Œå³éœ€è¦ç»™å“ªä¸ªç±»è¿›è¡Œå¢å¼º) --&gt;        &lt;property name="target" ref="studentDao"/&gt;        &lt;!-- å®ç°çš„æ¥å£ --&gt;        &lt;property name="proxyInterfaces" value="com.envy.aop.student.StudentDao"/&gt;        &lt;!-- é‡‡ç”¨æ‹¦æˆªçš„åç§° --&gt;        &lt;property name="interceptorNames" value="myBeforeAdvice"/&gt;        &lt;!-- æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨CGLibï¼Œtrueæ˜¯ï¼Œfalseåˆ™æ˜¯JDK --&gt;        &lt;property name="optimize" value="true"/&gt;    &lt;/bean&gt;</code></pre><p>ç¬¬äº”æ­¥ï¼Œæ³¨å…¥æµ‹è¯•ã€‚æ–°å»ºSpringAOPAdvisor.javaæµ‹è¯•æ–‡ä»¶ï¼Œé‡Œé¢çš„ä»£ç ä¸ºï¼š</p><pre><code>@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration("classpath:applicationContext.xml")public class SpringAOPAdvisor {//    @Resource(name="studentDao")  //è¿™æ˜¯ä¸ä½¿ç”¨AOPä»£ç†å¯¹è±¡    @Resource(name="studentDaoProxy")    private StudentDao studentDao;    @Test    public void testOne(){        studentDao.add();        studentDao.update();    }}</code></pre><p>è¿è¡Œç»“æœï¼š</p><pre><code>å‰ç½®å¢å¼ºçš„æ–¹æ³•this is add methodå‰ç½®å¢å¼ºçš„æ–¹æ³•this is update method</code></pre><p>åœ¨ç¬¬å››æ­¥ï¼Œç”Ÿæˆä»£ç†å¯¹è±¡æ—¶æˆ‘ä»¬åœ¨applicationContext.xmlæ–‡ä»¶ä¸­é…ç½®äº†ä¸€äº›å±æ€§ã€‚å…¶å®å°±æ˜¯ç”Ÿæˆä»£ç†SpringåŸºäºProxyFactoryBeanç±»ï¼Œåº•å±‚è‡ªåŠ¨é€‰æ‹©ä½¿ç”¨JDKçš„åŠ¨æ€ä»£ç†è¿˜æ˜¯CGLIBçš„ä»£ç†ã€‚ä¸‹é¢æ˜¯å…¶ä¸­çš„å‡ ä¸ªå±æ€§ä»‹ç»:target :ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼›proxyInterfaces :ä»£ç†è¦å®ç°çš„æ¥å£ï¼Œå¦‚æœå¤šä¸ªæ¥å£å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ ¼å¼èµ‹å€¼:</p><pre><code>&lt;list&gt;ã€€ã€€&lt;value&gt;&lt;/value&gt;ã€€ã€€ã€€ã€€....&lt;/list&gt;</code></pre><p>proxyTargetClass :æ˜¯å¦å¯¹ç±»ä»£ç†è€Œä¸æ˜¯æ¥å£ï¼Œè®¾ç½®ä¸ºtrueæ—¶ï¼Œä½¿ç”¨CGLibä»£ç†ï¼›interceptorNames :éœ€è¦ç»‡å…¥ç›®æ ‡çš„Adviceï¼›singleton :è¿”å›ä»£ç†æ˜¯å¦ä¸ºå•å®ä¾‹ï¼Œé»˜è®¤ä¸ºå•ä¾‹ã€‚optimize :å½“è®¾ç½®ä¸ºtrueæ—¶ï¼Œå¼ºåˆ¶ä½¿ç”¨CGLibã€‚</p><p><br></p><div class=pgc-img><img alt="Springå­¦ä¹ ï¼ˆ4ï¼‰ï¼šSpring AOP" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4d11fe2dabf84b89a74231a746dfe34d><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Spring','å­¦ä¹ ','AOP'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>