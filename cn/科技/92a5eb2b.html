<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç  | æå®¢å¿«è¨Š</title><meta property="og:title" content="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç  - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/02d9481e13424aa88f6ca7b8b06bc29a"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/92a5eb2b.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/92a5eb2b.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/92a5eb2b.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/92a5eb2b.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/92a5eb2b.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/92a5eb2b.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/92a5eb2b.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/92a5eb2b.html><meta property="article:published_time" content="2020-11-14T20:59:18+08:00"><meta property="article:modified_time" content="2020-11-14T20:59:18+08:00"><meta name=Keywords content><meta name=description content="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç "><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/92a5eb2b.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç </h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>1ï¼Œæ¦‚è¿°</h1><p>è¦æƒ³ç†è§£springçš„äº‹ä»¶æœºåˆ¶ï¼Œæˆ‘è§‰å¾—é¦–å…ˆè‡ªå·±åŠ¨æ‰‹å»æ’¸ä¸€å¥—ç®€å•çš„è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹demoè¿˜æ˜¯éå¸¸æœ‰å¿…è¦æ»´ï¼Œå› ä¸ºè¿™æ ·æœ‰åŠ©äºç†è§£springäº‹ä»¶æœºåˆ¶ã€‚å½“ç„¶ï¼Œè¿™é‡Œä¹Ÿæ˜¯æ¨¡ä»¿springçš„äº‹ä»¶æœºåˆ¶çš„ä»£ç ï¼Œä¸è¿‡ä¸‹é¢çœ‹ä»£ç å®ç°æ—¶å¯ä»¥å…ˆæŠ›å¼€springçš„äº‹ä»¶æœºåˆ¶ç›¸å…³ä»£ç ï¼Œå°†æ³¨æ„åŠ›é›†ä¸­åˆ°è¿™ä¸ªç®€å•demoä¸Šå³å¯ã€‚</p><p>åœ¨çœ‹è¿™ä¸ªè‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹æ—¶ï¼Œé¦–å…ˆè¦ç†Ÿæ‚‰è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼ï¼Œå› ä¸ºäº‹ä»¶é©±åŠ¨ç¼–ç¨‹å¯ä»¥è¯´æ˜¯è§‚å¯Ÿè€…ï¼ˆå‘å¸ƒè®¢é˜…ï¼‰æ¨¡å¼çš„å…·ä½“å®ç°ã€‚</p><h1 class=pgc-h-arrow-right>2ï¼Œè‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹</h1><p>å› ä¸ºè¿™ç¯‡æ–‡ç« æ˜¯springäº‹ä»¶æœºåˆ¶çš„å‰ç½®æ–‡ç« ï¼Œå› æ­¤è¿™é‡Œè‡ªå®šä¹‰å®ç°ä¸€ä¸ªæ¨¡æ‹Ÿå®¹å™¨ï¼ˆå¯ä»¥ç†è§£ä¸ºspringå®¹å™¨ï¼Œservltetå®¹å™¨ç­‰ï¼‰çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶çš„ç®€å•demoã€‚</p><h2 class=pgc-h-arrow-right>2.1 äº‹ä»¶</h2><p>å…ˆæ¥çœ‹ä¸€ä¸‹äº‹ä»¶çš„æ•´ä½“æ¶æ„å›¾ï¼Œè®©å¤§å®¶å…ˆæœ‰å¯¹äº‹ä»¶æœ‰ä¸€ä¸ªæ•´ä½“çš„è®¤è¯†ï¼Œå¦‚ä¸‹å›¾ï¼š</p><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/02d9481e13424aa88f6ca7b8b06bc29a><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/008d494effab450898b3befbbb0968ae><p class=pgc-img-caption></p></div><p><strong>1ï¼ŒEventæ¥å£</strong></p><p>é¢å‘æ¥å£ç¼–ç¨‹ï¼Œé¦–å…ˆå…ˆå®šä¹‰ä¸€ä¸ªEventæ¥å£ï¼Œè¯¥æ¥å£æ²¡æœ‰ä»»ä½•æ–¹æ³•ï¼Œå¯ä»¥è¯´æ˜¯äº‹ä»¶çš„æ ‡å¿—æ¥å£ã€‚</p><pre><code>public interface Event extends Serializable {}å¤åˆ¶ä»£ç </code></pre><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/008d494effab450898b3befbbb0968ae><p class=pgc-img-caption></p></div><p><strong>2ï¼ŒAbstractContextEvent</strong></p><p>AbstractContextEventæ˜¯å®¹å™¨äº‹ä»¶çš„åŸºæœ¬æŠ½è±¡ç±»ï¼Œå› ä¸ºäº‹ä»¶ä¹Ÿå¯ä»¥æºå¸¦æ•°æ®ï¼Œå› æ­¤è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªtimestampå±æ€§ï¼Œç”¨æ¥è®°å½•äº‹ä»¶çš„å‘ç”Ÿæ—¶é—´ã€‚</p><pre><code>public class AbstractContextEvent implements Event {    private static final long serialVersionUID = -6159391039546783871L;    private final long timestamp = System.currentTimeMillis();    public final long getTimestamp() {        return this.timestamp;    }}å¤åˆ¶ä»£ç </code></pre><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/008d494effab450898b3befbbb0968ae><p class=pgc-img-caption></p></div><p><strong>3ï¼ŒContextStartEvent</strong></p><p>ContextStartEventäº‹ä»¶æ˜¯AbstractContextEventå…·ä½“å®ç°ç±»ï¼Œå®¹å™¨å¼€å§‹å¯åŠ¨æ—¶è§¦å‘ï¼Œè¿™é‡Œä¸ºäº†demoç®€å•ï¼Œè¿™é‡Œä¸å†å®šä¹‰ä»»ä½•äº‹ä»¶é€»è¾‘ï¼Œåªæ˜¯ä»£è¡¨å®¹å™¨å¯åŠ¨æ—¶çš„ä¸€ä¸ªæ ‡å¿—äº‹ä»¶ç±»ã€‚</p><pre><code>public class ContextStartEvent extends AbstractContextEvent {}å¤åˆ¶ä»£ç </code></pre><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/008d494effab450898b3befbbb0968ae><p class=pgc-img-caption></p></div><p><strong>4ï¼ŒContextRunningEvent</strong></p><p>ContextRunningEventäº‹ä»¶æ˜¯AbstractContextEventå…·ä½“å®ç°ç±»ï¼Œå®¹å™¨å¯åŠ¨åæ—¶è§¦å‘ï¼Œè¿™é‡Œä¸ºäº†demoç®€å•ï¼Œè¿™é‡Œä¸å†å®šä¹‰ä»»ä½•äº‹ä»¶é€»è¾‘ï¼Œåªæ˜¯ä»£è¡¨å®¹å™¨å¯åŠ¨è¿è¡Œæ—¶æ—¶çš„ä¸€ä¸ªæ ‡å¿—äº‹ä»¶ç±»ã€‚</p><pre><code>public class ContextRunningEvent extends AbstractContextEvent {}å¤åˆ¶ä»£ç </code></pre><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/008d494effab450898b3befbbb0968ae><p class=pgc-img-caption></p></div><p><strong>5ï¼ŒContextDestroyEvent</strong></p><p>ContextDestroyEventäº‹ä»¶æ˜¯AbstractContextEventå…·ä½“å®ç°ç±»ï¼Œå®¹å™¨é”€æ¯æ—¶è§¦å‘ï¼Œè¿™é‡Œä¸ºäº†demoç®€å•ï¼Œè¿™é‡Œä¸å†å®šä¹‰ä»»ä½•äº‹ä»¶é€»è¾‘ï¼Œåªæ˜¯ä»£è¡¨å®¹å™¨é”€æ¯æ—¶çš„ä¸€ä¸ªæ ‡å¿—äº‹ä»¶ç±»ã€‚</p><pre><code>public class ContextDestroyEvent extends AbstractContextEvent {}å¤åˆ¶ä»£ç </code></pre><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/008d494effab450898b3befbbb0968ae><p class=pgc-img-caption></p></div><h2 class=pgc-h-arrow-right>2.2 äº‹ä»¶ç›‘å¬å™¨</h2><p>å…ˆæ¥çœ‹ä¸€ä¸‹äº‹ä»¶ç›‘å¬å™¨çš„æ•´ä½“æ¶æ„å›¾ï¼Œè®©å¤§å®¶å…ˆæœ‰å¯¹äº‹ä»¶ç›‘å¬å™¨æœ‰ä¸€ä¸ªæ•´ä½“çš„è®¤è¯†ï¼Œå¦‚ä¸‹å›¾ï¼š</p><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ed47b080cfb64f6cb38e001571597f85><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/008d494effab450898b3befbbb0968ae><p class=pgc-img-caption></p></div><p>â€‹</p><p>å…¶ä¸­EventListeneræ˜¯æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨çš„åŸºç±»æ¥å£ï¼Œï¼Œæ˜¯äº‹ä»¶ç›‘å¬å™¨çš„æ ‡å¿—ç±»æ¥å£ï¼Œè¢«æ‰€æœ‰å…·ä½“çš„äº‹ä»¶ç›‘å¬å™¨å®ç°ã€‚ç„¶åContextListeneræ¥å£æ˜¯å®¹å™¨äº‹ä»¶ç›‘å¬å™¨æ¥å£ï¼Œç»§æ‰¿äº†EventListenerï¼Œä¸»è¦å®šä¹‰äº†å¦‚ä¸‹äº‹ä»¶ç›‘å¬æ–¹æ³•ï¼š</p><pre><code> void onApplicationEvent(T event);å¤åˆ¶ä»£ç </code></pre><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/008d494effab450898b3befbbb0968ae><p class=pgc-img-caption></p></div><p>ç„¶åContextListeneræ¥å£è¢«ä¸‰ä¸ªå…·ä½“çš„å®¹å™¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ç›‘å¬å™¨å®ç°ï¼Œåˆ†åˆ«æ˜¯ContextStartEventListenerï¼ˆç›‘å¬å®¹å™¨å¯åŠ¨æ—¶çš„ContextStartEventï¼‰ï¼ŒContextRunningEventListenerï¼ˆç›‘å¬å®¹å™¨å¯åŠ¨åè¿è¡Œæ—¶çš„ContextRunningEventï¼‰å’ŒContextDestroyEventListenerï¼ˆç›‘å¬å®¹å™¨é”€æ¯æ—¶çš„ContextDestroyEventï¼‰ã€‚</p><p>ä¸‹é¢çœ‹å…·ä½“çš„ä»£ç å®ç°ï¼š</p><pre><code>public interface EventListener {}public interface ContextListener&lt;T extends AbstractContextEvent&gt; extends EventListener {    /**     * Handle an application event.     * @param event the event to respond to     */    void onApplicationEvent(T event);}public class ContextStartEventListener implements ContextListener&lt;AbstractContextEvent&gt; {    /**     * Handle an application event.     *     * @param event the event to respond to     */    public void onApplicationEvent(AbstractContextEvent event) {        if (event instanceof ContextStartEvent) {            System.out.println("å®¹å™¨å¯åŠ¨ã€‚ã€‚ã€‚ï¼Œå¯åŠ¨æ—¶é—´ä¸ºï¼š" + event.getTimestamp());        }    }}public class ContextRunningEventListener implements ContextListener&lt;AbstractContextEvent&gt; {    /**     * Handle an application event.     *     * @param event the event to respond to     */    public void onApplicationEvent(AbstractContextEvent event) {        if (event instanceof ContextRunningEvent) {            System.out.println("å®¹å™¨å¼€å§‹è¿è¡Œã€‚ã€‚ã€‚");            try {                Thread.sleep(3000);                System.out.println("å®¹å™¨è¿è¡Œç»“æŸã€‚ã€‚ã€‚");            } catch (InterruptedException e) {                e.printStackTrace();            }        }    }}public class ContextDestroyEventListener implements ContextListener&lt;AbstractContextEvent&gt; {    /**     * Handle an application event.     *     * @param event the event to respond to     */    public void onApplicationEvent(AbstractContextEvent event) {        if (event instanceof ContextDestroyEvent) {            System.out.println("å®¹å™¨é”€æ¯ã€‚ã€‚ã€‚ï¼Œé”€æ¯æ—¶é—´ä¸ºï¼š" + event.getTimestamp());        }    }}å¤åˆ¶ä»£ç </code></pre><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/008d494effab450898b3befbbb0968ae><p class=pgc-img-caption></p></div><h2 class=pgc-h-arrow-right>2.3 äº‹ä»¶å‘å¸ƒå™¨</h2><p>å…ˆçœ‹ä¸‹ç±»å›¾ï¼š</p><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/88bf4e5830ff419bbdf2a92566abdbef><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/008d494effab450898b3befbbb0968ae><p class=pgc-img-caption></p></div><p>â€‹</p><p>ApplicationEventMulticasteræ˜¯å‘å¸ƒäº‹ä»¶çš„çˆ¶ç±»æ¥å£ï¼Œä¸»è¦å®šä¹‰äº†å¢åŠ ï¼Œåˆ é™¤ï¼Œè·å–ç­‰æ“ä½œäº‹ä»¶ç›‘å¬å™¨çš„çš„æ–¹æ³•æ¥å£ï¼Œæ­¤å¤–ï¼Œè¿˜å®šä¹‰äº†ä¸€ä¸ªå‘å¸ƒäº‹ä»¶çš„æ–¹æ³•ã€‚</p><p>SimpleApplicationEventMulticasteræ˜¯ApplicationEventMulticasteräº‹ä»¶å‘å¸ƒå™¨æ¥å£çš„é»˜è®¤å®ç°ç±»ï¼Œä¸»è¦æ‰¿æ‹…å‘å¸ƒäº‹ä»¶çš„åŠŸèƒ½ã€‚å…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨åˆ—è¡¨contextListenersï¼Œå½“å‘å¸ƒäº‹ä»¶æ—¶ä¼šéå†è¿™äº›åˆ—è¡¨ï¼Œç„¶åå†å‘æ¯ä¸ªç›‘å¬å™¨å‘å¸ƒäº‹ä»¶ï¼Œé€šè¿‡è®¾ç½®asyncå±æ€§æ¥å†³å®šåŒæ­¥å¹¿æ’­äº‹ä»¶è¿˜æ˜¯å¼‚æ­¥å¹¿æ’­äº‹ä»¶ã€‚</p><p>ä¸‹é¢çœ‹çœ‹å®ç°ä»£ç ï¼š</p><pre><code>public interface ApplicationEventMulticaster {    void addContextListener(ContextListener&lt;?&gt; listener);    void removeContextListener(ContextListener&lt;?&gt; listener);    void removeAllListeners();    void multicastEvent(AbstractContextEvent event);}public class SimpleApplicationEventMulticaster implements ApplicationEventMulticaster {    // æ˜¯å¦å¼‚æ­¥å‘å¸ƒäº‹ä»¶    private boolean async = false;    // çº¿ç¨‹æ±     private Executor taskExecutor = new ThreadPoolExecutor(5, 5, 0, TimeUnit.SECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());    // äº‹ä»¶ç›‘å¬å™¨åˆ—è¡¨    private List&lt;ContextListener&lt;?&gt;&gt; contextListeners = new ArrayList&lt;ContextListener&lt;?&gt;&gt;();        public void addContextListener(ContextListener&lt;?&gt; listener) {        contextListeners.add(listener);    }    public void removeContextListener(ContextListener&lt;?&gt; listener) {        contextListeners.remove(listener);    }    public void removeAllListeners() {        contextListeners.clear();    }    public void multicastEvent(AbstractContextEvent event) {        doMulticastEvent(contextListeners, event);    }    private void doMulticastEvent(List&lt;ContextListener&lt;?&gt;&gt; contextListeners, AbstractContextEvent event) {        for (ContextListener contextListener : contextListeners) {            // å¼‚æ­¥å¹¿æ’­äº‹ä»¶            if (async) {                taskExecutor.execute(() -&gt; invokeListener(contextListener, event));                // new Thread(() -&gt; invokeListener(contextListener, event)).start();            // åŒæ­¥å‘å¸ƒäº‹ä»¶ï¼Œé˜»å¡çš„æ–¹å¼            } else {                invokeListener(contextListener, event);            }        }    }    private void invokeListener(ContextListener contextListener, AbstractContextEvent event) {        contextListener.onApplicationEvent(event);    }    public void setAsync(boolean async) {        this.async = async;    }}å¤åˆ¶ä»£ç </code></pre><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/008d494effab450898b3befbbb0968ae><p class=pgc-img-caption></p></div><h2 class=pgc-h-arrow-right>2.4 æµ‹è¯•è‡ªå®šä¹‰çš„å®¹å™¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶</h2><p>é‚£ä¹ˆç›´æ¥ä¸Šæµ‹è¯•ä»£ç ï¼Œä¸‹é¢åªæ¼”ç¤ºåŒæ­¥å‘å¸ƒäº‹ä»¶çš„åŠŸèƒ½ï¼š</p><pre><code>public class MockSpringEventTest {    @Test    public void testContextLifecycleEventInSync() {        // æ–°å»ºSimpleApplicationEventMulticasterå¯¹è±¡ï¼Œå¹¶æ·»åŠ å®¹å™¨ç”Ÿå‘½å‘¨æœŸç›‘å¬å™¨        ApplicationEventMulticaster eventMulticaster = new SimpleApplicationEventMulticaster();        eventMulticaster.addContextListener(new ContextStartEventListener());        eventMulticaster.addContextListener(new ContextRunningEventListener());        eventMulticaster.addContextListener(new ContextDestroyEventListener());        // å‘å°„å®¹å™¨å¯åŠ¨äº‹ä»¶ContextStartEvent        eventMulticaster.multicastEvent(new ContextStartEvent());        // å‘å°„å®¹å™¨æ­£åœ¨è¿è¡Œäº‹ä»¶ContextRunningEvent        eventMulticaster.multicastEvent(new ContextRunningEvent());        // å‘å°„å®¹å™¨æ­£åœ¨è¿è¡Œäº‹ä»¶ContextDestroyEvent        eventMulticaster.multicastEvent(new ContextDestroyEvent());    }    @Test    public void testContextLifecycleEventInAsync() throws InterruptedException {        // æ–°å»ºSimpleApplicationEventMulticasterå¯¹è±¡ï¼Œå¹¶æ·»åŠ å®¹å™¨ç”Ÿå‘½å‘¨æœŸç›‘å¬å™¨        ApplicationEventMulticaster eventMulticaster = new SimpleApplicationEventMulticaster();        eventMulticaster.addContextListener(new ContextStartEventListener());        eventMulticaster.addContextListener(new ContextRunningEventListener());        eventMulticaster.addContextListener(new ContextDestroyEventListener());        ((SimpleApplicationEventMulticaster) eventMulticaster).setAsync(true);        // å‘å°„å®¹å™¨å¯åŠ¨äº‹ä»¶ContextStartEvent        eventMulticaster.multicastEvent(new ContextStartEvent());        // å‘å°„å®¹å™¨æ­£åœ¨è¿è¡Œäº‹ä»¶ContextRunningEvent        eventMulticaster.multicastEvent(new ContextRunningEvent());        // å‘å°„å®¹å™¨æ­£åœ¨è¿è¡Œäº‹ä»¶ContextDestroyEvent        eventMulticaster.multicastEvent(new ContextDestroyEvent());        // è¿™é‡Œæ²¡æ˜ç™½åœ¨æ²¡æœ‰ç”¨CountDownLatchçš„æƒ…å†µä¸‹ä¸ºä½•ä¸»çº¿ç¨‹é€€å‡ºï¼Œéåå°çº¿ç¨‹çš„å­çº¿ç¨‹ä¹Ÿä¼šé€€å‡ºï¼Ÿï¼Ÿï¼Ÿä¸ºäº†æµ‹è¯•ï¼Œæ‰€æœ‰å…ˆç”¨CountDownLatché”ä½mainçº¿ç¨‹å…ˆ        // ç»è¿‡æµ‹è¯•ï¼ŒåŸæ¥æ˜¯å› ä¸ºç”¨äº†junitçš„æ–¹æ³•ï¼Œtestæ–¹æ³•çº¿ç¨‹é€€å‡ºåï¼Œtestæ–¹æ³•çº¿ç¨‹äº§ç”Ÿçš„éåå°çº¿ç¨‹ä¹Ÿéšä¹‹é€€å‡ºï¼Œè€Œä¸‹é¢çš„mainæ–¹æ³•å¯åŠ¨çš„éåå°çº¿ç¨‹åˆ™ä¸ä¼š        // TODO è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿï¼Ÿï¼Ÿéš¾é“æ˜¯Aå­çº¿ç¨‹ï¼ˆémainçº¿ç¨‹ï¼‰å¯åŠ¨çš„Bå­çº¿ç¨‹ä¼šéšç€Aå­çº¿ç¨‹é€€å‡ºè€Œé€€å‡ºï¼Ÿè¿˜æ²¡éªŒè¯        CountDownLatch countDownLatch = new CountDownLatch(1);        countDownLatch.await();    }    public static void main(String[] args) throws InterruptedException {        // æ–°å»ºSimpleApplicationEventMulticasterå¯¹è±¡ï¼Œå¹¶æ·»åŠ å®¹å™¨ç”Ÿå‘½å‘¨æœŸç›‘å¬å™¨        ApplicationEventMulticaster eventMulticaster = new SimpleApplicationEventMulticaster();        eventMulticaster.addContextListener(new ContextStartEventListener());        eventMulticaster.addContextListener(new ContextRunningEventListener());        eventMulticaster.addContextListener(new ContextDestroyEventListener());        ((SimpleApplicationEventMulticaster) eventMulticaster).setAsync(true);        // å‘å°„å®¹å™¨å¯åŠ¨äº‹ä»¶ContextStartEvent        eventMulticaster.multicastEvent(new ContextStartEvent());        // å‘å°„å®¹å™¨æ­£åœ¨è¿è¡Œäº‹ä»¶ContextRunningEvent        eventMulticaster.multicastEvent(new ContextRunningEvent());        // å‘å°„å®¹å™¨æ­£åœ¨è¿è¡Œäº‹ä»¶ContextDestroyEvent        eventMulticaster.multicastEvent(new ContextDestroyEvent());    }}å¤åˆ¶ä»£ç </code></pre><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/008d494effab450898b3befbbb0968ae><p class=pgc-img-caption></p></div><p>é€šè¿‡è¿è¡Œæµ‹è¯•æ–¹æ³•testContextLifecycleEventInSync()ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹æˆªå›¾ï¼š</p><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e0534434b2284016b2e9aecce621c524><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="æ¨¡ä»¿Springäº‹ä»¶æœºåˆ¶å®ç°è‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ Springæºç " onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/008d494effab450898b3befbbb0968ae><p class=pgc-img-caption></p></div><p>â€‹</p><h1 class=pgc-h-arrow-right>3ï¼Œç»“è¯­</h1><p>å¥½äº†ï¼Œè‡ªå®šä¹‰äº‹ä»¶é©±åŠ¨ç¼–ç¨‹çš„ç®€å•demoå°±å·²ç»å®ç°äº†ã€‚</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Spring','æœºåˆ¶','å®ç°'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>