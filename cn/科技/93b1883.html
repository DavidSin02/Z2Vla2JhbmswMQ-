<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Hive SQL常用命令总结，大数据开发学习者请按需收藏 | 极客快訊</title><meta property="og:title" content="Hive SQL常用命令总结，大数据开发学习者请按需收藏 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/8164e94731124aa9a1fb5cfa4c791431"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/93b1883.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/93b1883.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/93b1883.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/93b1883.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/93b1883.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/93b1883.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/93b1883.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/93b1883.html><meta property="article:published_time" content="2020-10-29T20:59:31+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:31+08:00"><meta name=Keywords content><meta name=description content="Hive SQL常用命令总结，大数据开发学习者请按需收藏"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/93b1883.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Hive SQL常用命令总结，大数据开发学习者请按需收藏</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>Hive是基于Hadoop生态的一个重要组件，是对数据仓库进行管理和分析数据的工具。她提供了SQL查询方式来分析存储在HDFS分布式文件系统中的数据，可以将结构化的数据文件映射为一张数据库表，并提供完整的SQL查询功能。</p><p>这种SQL就是Hive SQL，她可以将SQL语句转换为Map Reduce任务运行，通过特殊的SQL去查询分析需要的内容，使不熟悉map reduce的用户很方便的利用SQL 语言查询，汇总，分析数据。</p><div class=pgc-img><img alt="Hive SQL常用命令总结，大数据开发学习者请按需收藏" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8164e94731124aa9a1fb5cfa4c791431><p class=pgc-img-caption></p></div><h4 class=pgc-h-arrow-right>一、基础命令</h4><h4 class=pgc-h-arrow-right>1、数据库操作</h4><ul><li>show databases; # 查看某个数据库</li><li>use 数据库; # 进入某个数据库</li><li>show tables; # 展示所有表</li><li>desc 表名; # 显示表结构</li><li>show partitions 表名; # 显示表名分区</li><li>show create table_name; # 显示创建表的结构</li></ul><h4 class=pgc-h-arrow-right>2、表结构修改</h4><ul><li>use xxdb; create table xxx; # 内部表</li><li>create table xxx like xxx; # 创建一个表，结构与其他一样</li><li>use xxdb; create external table xxx; # 外部表</li><li>use xxdb; create external table xxx (l int) partitoned by (d string); # 分区表</li><li>alter table table_name set TBLPROPROTIES ('EXTERNAL'='TRUE'); # 内部表转外部表</li><li>alter table table_name set TBLPROPROTIES ('EXTERNAL'='FALSE');# 外部表转内部表</li></ul><h4 class=pgc-h-arrow-right>3、字段类型</h4><ul><li>基本类型： tinyint, smallint, int, bigint, float, decimal, boolean, string</li><li>复合类型：struct, array, map</li></ul><h4 class=pgc-h-arrow-right>二、常用函数</h4><ul><li>length() # 返回字符串长度</li><li>trim() # 去除两边空格</li><li>lower(), upper() # 大小写转换</li><li>reverse() # 反转字符串</li><li>cast(expr as type) # 类型转换</li><li>substring(string A, int start, int len) # 字符串截取</li><li>split(string str, string pat) # 按照pat字符串分割str，返回分割后的字符串数组</li><li>coalesce(v1, v2, v3, ...) # 返回列表中第一个非空元素,如果所有值都为空，则返回null</li><li>from_unixtime(unix_timestamp(), 'yyyy-MM-dd HH:mm:ss') # 返回当前时间</li><li>instr(string str, string search_str) # 返回第二个参数在待查找字符串中的位置(找不到返回0)</li><li>concat(string A, string B, string C, ...) # 字符串连接</li><li>concat_ws(string sep, string A, string B, string C, ...) # 自定义分隔符sep的字符串连接</li><li>str_to_map(string A, string item_pat, string dict_pat) # 将字符串转为map</li><li>map_keys(map m) # 提取出map的key, 返回key的array</li><li>datediff(date1, date2) # 日期比较函数，返回相差天数，datediff('${cur_date},d)</li><li>explode(colname) # explode就是将hive一行中复杂的array或者map结构拆分成多行</li></ul><h4 class=pgc-h-arrow-right>三、相关概念</h4><h4 class=pgc-h-arrow-right>1、hive</h4><p>hive是基于hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库库表，并提供类SQL查询功能。</p><h4 class=pgc-h-arrow-right>2、基本组成</h4><p>用户接口：CLI，shell命令行;JDBC/ODBC是hive的java实现;webGUI是通过浏览器访问hive;元数据存储：通常是存储在关系数据库如mysql, derby中;hive的元数据包括表的名字，表的列和分区及其属性，表的属性(是否为外部表)，表的数据所在目录等。</p><p>解释器，编译器，优化器完成HQL查询语句从词法分析，语法分析，编译，优化以及查询计划的生成。生成的查询存储在HDFS中，并随后有mapreduce调用执行。因此，hive与Hadoop的关系可以理解为用户发出SQL查询语句，hive将查询存储在HDFS中，然后由mapreduce调用执行。</p><h4 class=pgc-h-arrow-right>3、table</h4><p>Hive 中的 Table 和数据库中的 Table 在概念上是类似的，每一个 Table 在 Hive 中都有一个相应的目录存储数据。例如，一个表 pvs，它在 HDFS 中的路径为：/wh/pvs，其中，wh 是在 hive-site.xml 中由 ${hive.metastore.warehouse.dir} 指定的数据仓库的目录，所有的 Table 数据(不包括 External Table)都保存在这个目录中。</p><h4 class=pgc-h-arrow-right>4、partition</h4><p>Partition 对应于数据库中的 Partition 列的密集索引，但是 Hive 中 Partition 的组织方式和数据库中的很不相同。在 Hive 中，表中的一个 Partition 对应于表下的一个目录，所有的 Partition 的数据都存储在对应的目录中。</p><h4 class=pgc-h-arrow-right>5、buckets</h4><p>Buckets 对指定列计算 hash，根据 hash 值切分数据，目的是为了并行，每一个 Bucket 对应一个文件。将 user 列分散至 32 个 bucket，首先对 user 列的值计算 hash，对应 hash 值为 0 的 HDFS 目录为：/wh/pvs/ds=20090801/ctry=US/part-00000;hash 值为 20 的 HDFS 目录为：/wh/pvs/ds=20090801/ctry=US/part-00020</p><h4 class=pgc-h-arrow-right>6、external table</h4><p>External Table 指向已经在 HDFS 中存在的数据，可以创建 Partition。它和 Table 在元数据的组织上是相同的，而实际数据的存储则有较大的差异。</p><p>Table 的创建过程和数据加载过程(这两个过程可以在同一个语句中完成)，在加载数据的过程中，实际数据会被移动到数据仓库目录中;之后对数据对访问将会直接在数据仓库目录中完成。删除表时，表中的数据和元数据将会被同时删除。</p><p>External Table 只有一个过程，加载数据和创建表同时完成(CREATE EXTERNAL TABLE ……LOCATION)，实际数据是存储在 LOCATION 后面指定的 HDFS 路径中，并不会移动到数据仓库目录中。当删除一个 External Table 时，仅删除元数据，表中的数据不会真正被删除。</p><h4 class=pgc-h-arrow-right>7、全量数据和增量数据</h4><p>查看分区信息：如果分区的大小随时间增加而增加，则最新的分区为全量数据。如果分区的大小随时间增加而大小上下变化，则每个分区都是增量数据。</p><h4 class=pgc-h-arrow-right>四、HQL和SQL的异同</h4><h4 class=pgc-h-arrow-right>1、HQL和SQL常见不同，</h4><ul><li>select distinct 后必须指定字段名</li><li>join 条件仅支持等值关联且不支持or条件</li><li>子查询不能在select中使用;</li><li>HQL中没有UNION，可使用distinct+ union all 实现 UNION;</li><li>HQL以分号分隔，必须在每个语句结尾写上分号;</li><li>HQL中字符串的比较比较严格，区分大小写及空格，因此在比较时建议upper(trim(a))=upper(trim(b))</li><li>日期判断，建议使用to_date(),如：to_date(orderdate)=‘2016-07-18’</li><li>关键字必须在字段名上加``符号，如select `exchange` from xxdb.xxtb;</li><li>数据库和表/视图之间仅有1个点，如xx_db.xx_tb。</li></ul><h4 class=pgc-h-arrow-right>2、HQL不支持update，采用union all + left join (is null)变相实现update。</h4><ul><li>取出增量数据;</li><li>使用昨日分区的全量数据通过主键左连接增量数据，并且只取增量表中主键为空的数据(即，取未发生变化的全量数据);</li><li>合并1、2的数据覆盖至最新的分区，即实现了update。</li></ul><h4 class=pgc-h-arrow-right>3、HQL不支持delete，采用not exists/left join(is null)的方法变相实现。</h4><ul><li>取出已删除的主键数据(表B);</li><li>使用上一个分区的全量数据(表A)通过主键左连接A，并且只取A中主键为空的数据，然后直接insert overwrite至新的分区。</li></ul><p>对于会SQL的人员，转入Hive SQL还是比较容易的，语法大部分是想通的，少部分函数不太一致。</p><p>码字不易，如果您觉得文章写得不错，</p><p><strong>请您 1.关注作者~ </strong>您的关注是我写作的最大动力</p><p><strong>2.私信我“大数据”</strong></p><p>我将与您分享一套最新的大数据学习资源和全套开发工具</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Hive','SQL','常用命令'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>