<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>黑客命令第13集:IPC$空连接！ | 极客快訊</title><meta property="og:title" content="黑客命令第13集:IPC$空连接！ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/13f9f3cb0493468c861d389d4fc498e1"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/957de8a3.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/957de8a3.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/957de8a3.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/957de8a3.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/957de8a3.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/957de8a3.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/957de8a3.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/957de8a3.html><meta property="article:published_time" content="2020-11-14T21:00:29+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:29+08:00"><meta name=Keywords content><meta name=description content="黑客命令第13集:IPC$空连接！"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/957de8a3.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>黑客命令第13集:IPC$空连接！</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>利用135网吧抓鸡工具，抓不到的网吧，都有同一个缺点IPC$空连接漏洞，试途用这个IPC$空连接能否**网吧主机。如果成功的话那100/90的网吧服务器都能进去，只有想不到的，没有做不到的，总有一天会成功的~ 一 摘要<br>二 什么是ipc$<br>三 什么是空会话<br>四 空会话可以做什么<br>五 ipc$所使用的端口<br>六 ipc管道在hack攻击中的意义<br>七 ipc$连接失败的常见原因<br>八 复制文件失败的原因<br>九 关于at命令和xp对ipc$的限制<br>十 如何打开目标的IPC$共享以及其他共享<br>十一 一些需要shell才能完成的命令<br>十二 **中可能会用到的命令<br>十三 对比过去和现今的ipc$**<br>十四 如何防范ipc$**<br>十五 ipc$**问答精选<br>一 摘要<br>注意：本文所讨论的各种情况均默认发生在win NT/2000环境下，win98将不在此次讨论之列。<br>二 什么是ipc$<br>IPC$(Internet Process Connection)是共享"命名管道"的资源，它是为了让进程间通信而开放的命名管道，通过提供可信任的用户名和口令，连接双方可以建立安全的通道并以此通道进行加密数据的交换，从而实现对远程计算机的访问。IPC$是NT/2000的一项新功能，它有一个特点，即在同一时间内，两个IP之间只允许建立一个连接。NT/2000在提供了ipc$功能的同时，在初次安装系统时还打开了默认共享，即所有的逻辑共享(c$,d$,e$……)和系统目录winnt或windows(admin$)共享。所有的这些，微软的初衷都是为了方便管理员的管理，但在有意无意中，导致了系统安全性的降低。<br>平时我们总能听到有人在说ipc$漏洞，ipc$漏洞，其实ipc$并不是一个真正意义上的漏洞,我想之所以有人这么说，一定是指微软自己安置的那个‘后门’：空会话（Null session）。那么什么是空会话呢？<br>三 什么是空会话<br>在介绍空会话之前，我们有必要了解一下一个安全会话是如何建立的。<br>在Windows NT 4.0中是使用挑战响应协议与远程机器建立一个会话的，建立成功的会话将成为一个安全隧道，建立双方通过它互通信息，这个过程的大致顺序如下：<br>1）会话请求者（客户）向会话接收者（服务器）传送一个数据包，请求安全隧道的建<br>立；<br>2）服务器产生一个随机的64位数（实现挑战）传送回客户；<br>3）客户取得这个由服务器产生的64位数，用试图建立会话的帐号的口令打乱它，将结<br>果返回到服务器（实现响应）；<br>4）服务器接受响应后发送给本地安全验证（LSA），LSA通过使用该用户正确的口令来核实响应以便确认请求者身份。如果请求者的帐号是服务器的本地帐号，核实本地发生；如果请求的帐号是一个域的帐号，响应传送到域控制器去核实。当对挑战的响应核实为正确后，一个访问令牌产生，然后传送给客户。客户使用这个访问令牌连接到服务器上的资源直到建议的会话被终止。<br>以上是一个安全会话建立的大致过程，那么空会话又如何呢？<br>空会话是在没有信任的情况下与服务器建立的会话（即未提供用户名与密码），但根据WIN2000的访问控制模型，空会话的建立同样需要提供一个令牌，可是空会话在建立过程中并没有经过用户信息的认证，所以这个令牌中不包含用户信息，因此，这个会话不能让系统间发送加密信息，但这并不表示空会话的令牌中不包含安全标识符SID（它标识了用户和所属组），对于一个空会话，LSA提供的令牌的SID是S-1-5-7，这就是空会话的SID，用户名是：ANONYMOUS LOGON（这个用户名是可以在用户列表中看到的，但是是不能在SAM数据库中找到，属于系统内置的帐号），这个访问令牌包含下面伪装的组：<br>Everyone<br>Network<br>在安全策略的限制下，这个空会话将被授权访问到上面两个组有权访问到的一切信息。那么建立空会话到底可以作什么呢？<br>四 空会话可以做什么<br>对于NT，在默认安全设置下，借助空连接可以列举目标主机上的用户和共享，访问everyone权限的共享，访问小部分注册表等，并没有什么太大的利用价值；对2000作用更小，因为在Windows 2000 和以后版本中默认只有管理员和备份操作员有权从网络访问到注册表，而且实现起来也不方便，需借助工具。<br>从这些我们可以看到，这种非信任会话并没有多大的用处，但从一次完整的ipc$**来看，空会话是一个不可缺少的跳板，因为我们从它那里可以得到户列表，而大多数弱口令扫描工具就是利用这个用户列表来进行口令猜解的，成功的导出用户列表大大增加了猜解的成功率，仅从这一点，足以说明空会话所带来的安全隐患，因此说空会话毫无用处的说法是不正确的。以下是空会话中能够使用的一些具体命令：<br>1 首先，我们先建立一个空连接（当然，这需要目标开放ipc$）<br>命令：net use \\ip\ipc$ "" /user:""<br>注意：上面的命令包括四个空格，net与use中间有一个空格，use后面一个，密码左右各一个空格。<br>2 查看远程主机的共享资源<br>命令：net view \\ip<br>解释：前提是建立了空连接后，用此命令可以查看远程主机的共享资源，如果它开了共享，可以得到如下面的结果，但此命令不能显示默认共享。<br>在 \\*.*.*.*的共享资源<br>资源共享名 类型 用途 注释<br>-----------------------------------------------------------<br>NETLOGON Disk Logon server share<br>SYSVOL Disk Logon server share<br>命令成功完成。<br>3 查看远程主机的当前时间<br>命令： net time \\ip<br>解释：用此命令可以得到一个远程主机的当前时间。<br>4 得到远程主机的NetBIOS用户名列表（需要打开自己的NBT）<br>命令：nbtstat -A ip<br>用此命令可以得到一个远程主机的NetBIOS用户名列表，返回如下结果：<br>Node IpAddress: [*.*.*.*] Scope Id: []<br>NetBIOS Remote Machine Name Table<br>Name Type Status<br>---------------------------------------------<br>SERVER &lt;00> UNIQUE Registered<br>OYAMANISHI-H &lt;00> GROUP Registered<br>OYAMANISHI-H &lt;1C> GROUP Registered<br>SERVER &lt;20> UNIQUE Registered<br>OYAMANISHI-H &lt;1B> UNIQUE Registered<br>OYAMANISHI-H &lt;1E> GROUP Registered<br>SERVER &lt;03> UNIQUE Registered<br>OYAMANISHI-H &lt;1D> UNIQUE Registered<br>..__MSBROWSE__.&lt;01> GROUP Registered<br>INet~Services &lt;1C> GROUP Registered<br>IS~SERVER......&lt;00> UNIQUE Registered<br>MAC Address = 00-50-8B-9A-2D-37<br>以上就是我们经常使用空会话做的事情，好像也能获得不少东西哟，不过要注意一点：建立IPC$连接的操作会在Event Log中留下记录，不管你是否登录成功。 好了，那么下面我们就来看看ipc$所使用的端口是什么？<br>五 ipc$所使用的端口<br>首先我们来了解一些基础知识：<br>1 SMB</p><div class=pgc-img><img alt=黑客命令第13集:IPC$空连接！ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/13f9f3cb0493468c861d389d4fc498e1><p class=pgc-img-caption></p></div><p>Server Message Block) Windows协议族，用于文件打印共享的服务；<br>2 NBT</p><div class=pgc-img><img alt=黑客命令第13集:IPC$空连接！ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/13f9f3cb0493468c861d389d4fc498e1><p class=pgc-img-caption></p></div><p>NETBios Over TCP/IP)使用137（UDP）138（UDP）139（TCP）端口实现基于TCP/IP协议的NETBIOS网络互联。<br>3 在WindowsNT中SMB基于NBT实现，即使用139（TCP）端口；而在Windows2000中，SMB除了基于NBT实现，还可以直接通过445端口实现。<br>有了这些基础知识，我们就可以进一步来讨论访问网络共享对端口的选择了：<br>对于win2000客户端（发起端）来说：<br>1 如果在允许NBT的情况下连接服务器时，客户端会同时尝试访问139和445端口，如果445端口有响应，那么就发送RST包给139端口断开连接，用455端口进行会话，当445端口无响应时，才使用139端口，如果两个端口都没有响应，则会话失败；<br>2 如果在禁止NBT的情况下连接服务器时，那么客户端只会尝试访问445端口，如果445端口无响应，那么会话失败。<br>对于win2000服务器端来说：<br>1 如果允许NBT, 那么UDP端口137, 138, TCP 端口 139, 445将开放（LISTENING）；<br>2 如果禁止NBT，那么只有445端口开放。<br>我们建立的ipc$会话对端口的选择同样遵守以上原则。显而易见，如果远程服务器没有监听139或445端口，ipc$会话是无法建立的。<br>六 ipc管道在hack攻击中的意义<br>ipc管道本来是微软为了方便管理员进行远程管理而设计的，但在**者看来，开放ipc管道的主机似乎更容易得手。通过ipc管道，我们可以远程调用一些系统函数（大多通过工具实现，但需要相应的权限），这往往是**成败的关键。如果不考虑这些，仅从传送文件这一方面，ipc管道已经给了**者莫大的支持，甚至已经成为了最重要的传输手段，因此你总能在各大论坛上看到一些朋友因为打不开目标机器的ipc管道而一筹莫展大呼救命。当然，我们也不能忽视权限在ipc管道中扮演的重要角色，想必你一定品尝过空会话的尴尬，没有权限，开启管道我们也无可奈何。但**者一旦获得了管理员的权限，那么ipc管道这把双刃剑将显示出它狰狞的一面。<br>七 ipc$连接失败的常见原因<br>以下是一些常见的导致ipc$连接失败的原因：<br>1 IPC连接是Windows NT及以上系统中特有的功能，由于其需要用到Windows NT中很多DLL函数，所以不能在Windows 9.x/Me系统中运行，也就是说只有nt/2000/xp才可以相互建立ipc$连接，98/me是不能建立ipc$连接的；<br>2 如果想成功的建立一个ipc$连接，就需要响应方开启ipc$共享，即使是空连接也是这样，如果响应方关闭了ipc$共享，将不能建立连接；<br>3 连接发起方未启动Lanmanworkstation服务（显示名为：Workstation）：它提供网络链结和通讯，没有它发起方无法发起连接请求；<br>4 响应方未启动Lanmanserver服务（显示名为：Server）：它提供了 RPC 支持、文件、打印以及命名管道共享，ipc$依赖于此服务，没有它主机将无法响应发起方的连接请求，不过没有它仍可发起ipc$连接；<br>5 响应方未启动NetLogon，它支持网络上计算机 pass-through 帐户登录身份（不过这种情况好像不多）；<br>6 响应方的139，445端口未处于监听状态或被防火墙屏蔽；<br>7 连接发起方未打开139，445端口；<br>8 用户名或者密码错误：如果发生这样的错误，系统将给你类似于'无法更新密码'这样的错误提示（显然空会话排除这种错误）；<br>9 命令输入错误：可能多了或少了空格，当用户名和密码中不包含空格时两边的双引号可以省略，如果密码为空，可以直接输入两个引号""即可；<br>10 如果在已经建立好连接的情况下对方重启计算机，那么ipc$连接将会自动断开，需要重新建立连接。<br>另外,你也可以根据返回的错误号分析原因：<br>错误号5，拒绝访问：很可能你使用的用户不是管理员权限的；<br>错误号51，Windows无法找到网络路径：网络有问题；<br>错误号53，找不到网络路径：ip地址错误；目标未开机；目标lanmanserver服务未启动；目标有防火墙（端口过滤）；<br>错误号67，找不到网络名：你的lanmanworkstation服务未启动或者目标删除了ipc$；<br>错误号1219，提供的凭据与已存在的凭据集冲突：你已经和对方建立了一个ipc$，请删除再连；<br>错误号1326，未知的用户名或错误密码：原因很明显了；<br>错误号1792，试图登录，但是网络登录服务没有启动：目标NetLogon服务未启动；<br>错误号2242，此用户的密码已经过期：目标有帐号策略，强制定期要求更改密码<br></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'13','IPC','空连接'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>