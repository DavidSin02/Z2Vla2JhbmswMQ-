<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ï¼ˆæ¢è®¨æ»¤æ³¢å™¨ï¼‰2. æ‰‹æŠŠæ‰‹ç”¨Verilogå®ç°FIRæ»¤æ³¢å™¨ï¼ŒéIPæ ¸ | æå®¢å¿«è¨Š</title><meta property="og:title" content="ï¼ˆæ¢è®¨æ»¤æ³¢å™¨ï¼‰2. æ‰‹æŠŠæ‰‹ç”¨Verilogå®ç°FIRæ»¤æ³¢å™¨ï¼ŒéIPæ ¸ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/108e64968ca9453c9f0b9ea5b2818a66"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/9749d92.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/9749d92.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/9749d92.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/9749d92.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/9749d92.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/9749d92.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/9749d92.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/9749d92.html><meta property="article:published_time" content="2020-10-29T21:04:04+08:00"><meta property="article:modified_time" content="2020-10-29T21:04:04+08:00"><meta name=Keywords content><meta name=description content="ï¼ˆæ¢è®¨æ»¤æ³¢å™¨ï¼‰2. æ‰‹æŠŠæ‰‹ç”¨Verilogå®ç°FIRæ»¤æ³¢å™¨ï¼ŒéIPæ ¸"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/9749d92.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ï¼ˆæ¢è®¨æ»¤æ³¢å™¨ï¼‰2. æ‰‹æŠŠæ‰‹ç”¨Verilogå®ç°FIRæ»¤æ³¢å™¨ï¼ŒéIPæ ¸</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>ä¸Šä¸€æ–‡ è®¨è®ºäº†FIRæ»¤æ³¢å™¨çš„ç»“æ„ä»¥åŠä½¿ç”¨Pythonä»ä¸¤ä¸ªæ–¹é¢ï¼ˆå¾ªç¯è¿ç®—å’ŒçŸ©é˜µè¿ç®—ï¼‰å®ç°FIRï¼Œè€Œæ–‡ä¸­æåˆ°çš„å•ç‰‡æœºï¼Œåªéœ€è¦æŒ‰ç…§å¾ªç¯è¿ç®—çš„æ–¹æ³•å°±å¯ä»¥å®ç°FIRæ»¤æ³¢å™¨ã€‚</p><p>æ‰€ä»¥ï¼Œå•ç‰‡æœºå®ç°FIRæ»¤æ³¢å™¨å¹¶ä¸å¤æ‚ï¼›å¥ˆä½•æˆ‘æ‰‹ç—’äº†ï¼Œæƒ³èˆå¼ƒæ‰FIR IPæ ¸ï¼Œç”¨Verilogè‡ªå·±å†™ä¸€ä¸ªFIRã€‚ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰è¿™æ ·æ‰‹ç—’çš„æ„Ÿè§‰ï¼Œå¦‚æœæœ‰ï¼Œè·Ÿéšè¿™ç¯‡æ–‡ç« ä¸€èµ·æ¥ï¼Œçœ‹å®Œè®°å¾—ç‚¹èµã€‚</p><p>æœ¬æ–‡å†…å®¹æ¶‰åŠVerilogçš„è¯­æ³•ï¼šfunctionï¼Œgenerate forï¼Œgenerate ifï¼Œ readmemb,readmemhï¼›éƒ¨åˆ†Pythonè¯­æ³•ä»¥åŠå­¦ä¹ Verilogï¼‰åŠè®¡ç®—æœºæ•°å€¼è¡¨ç¤ºè§„åˆ™ã€‚</p><hr><h3 class=pgc-h-arrow-right>è®¾è®¡æ€æƒ³</h3><p>é¦–å…ˆéœ€è¦æŠŠFIRæœ€åŸºæœ¬çš„ç»“æ„å®ç°ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªFIRæŠ½å¤´çš„æ•°æ®ä¸å…¶æŠ½å¤´ç³»æ•°ç›¸ä¹˜è¿™ä¸ªæ“ä½œã€‚ç”±é¡¶å±‚æ–‡ä»¶å¯¹è¿™ä¸ªåŸºæœ¬æ¨¡å—è¿›è¡Œå¤šæ¬¡è°ƒç”¨ã€‚</p><div class=pgc-img><img alt="ï¼ˆæ¢è®¨æ»¤æ³¢å™¨ï¼‰2. æ‰‹æŠŠæ‰‹ç”¨Verilogå®ç°FIRæ»¤æ³¢å™¨ï¼ŒéIPæ ¸" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/108e64968ca9453c9f0b9ea5b2818a66><p class=pgc-img-caption></p></div><p>ç”±äºFIRæŠ½å¤´ç³»æ•°æ˜¯ä¸­å¿ƒå¯¹ç§°çš„ï¼Œä¸ºäº†å‡å°‘ä¹˜æ³•åœ¨FPGAå†…çš„å‡ºç°ï¼Œæ¯ä¸ªåŸºæœ¬ç»“æ„åŒæ—¶ä¼šè¾“å…¥ä¸¤ä¸ªä¿¡å·ï¼Œä¹Ÿæ˜¯å…³äºä¸­å¿ƒå¯¹ç§°çš„ã€‚</p><div class=pgc-img><img alt="ï¼ˆæ¢è®¨æ»¤æ³¢å™¨ï¼‰2. æ‰‹æŠŠæ‰‹ç”¨Verilogå®ç°FIRæ»¤æ³¢å™¨ï¼ŒéIPæ ¸" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/63eb6b78c1284068853043555eec08d7><p class=pgc-img-caption></p></div><p><br></p><p>æ­¤å¤–ï¼Œä¸ºäº†é˜²æ­¢åç»­ç›¸åŠ çš„è¿‡ç¨‹å¼•èµ·ç¬¦å·ä½æº¢å‡ºï¼ŒFIRåŸºæœ¬æ¨¡å—éœ€è¦å¯¹ä¹˜æ³•ç»“æœè¿›è¡Œç¬¦å·ä½æ‰©å±•ã€‚</p><p>æ‰©å±•å®Œæˆåï¼Œå¦‚æœåŒæ—¶å¯¹è¿™äº›ï¼ˆ71ä¸ªï¼‰åŠ æƒç»“æœç›¸åŠ ï¼Œè‚¯å®šä¼šä½¿å¾—ç³»ç»Ÿè¿è¡Œé€Ÿç‡ä¸Šä¸å»ï¼Œè€Œä¸”è®¾è®¡çš„æ¯”è¾ƒæ­»æ¿ã€‚è¿™é‡Œéœ€è¦å¼•å…¥æµæ°´çº¿æ“ä½œï¼›ä½•ä¸ºæµæ°´çº¿æ“ä½œï¼Œç®€å•åœ°è¯´ï¼Œæœ¬æ¥ä½ ä¸€ä¸ªäººæ‰¿æ‹…ä¸€æ¡Œèœï¼Œä½ éœ€è¦æ´—èœï¼Œåˆ‡èœï¼Œç‚’èœï¼Œè£…ç›˜ï¼Œä¸Šæ¡Œï¼Œä¸ä»…ååˆ†éº»çƒ¦è€Œä¸”å¾ˆè€½è¯¯æ—¶é—´ï¼›è¿™ä¸ªæ—¶å€™æœ‰äººè¿‡æ¥å¸®ä½ ï¼Œä¸€ä¸ªäººæ´—èœï¼Œä¸€ä¸ªäººåˆ‡èœï¼Œä¸€ä¸ªäººç‚’èœï¼Œä¸€ä¸ªäººè£…ç›˜ï¼Œä½ è´Ÿè´£ä¸Šæ¡Œï¼Œè™½ç„¶è´¹äº†äº›äººï¼Œä½†æ˜¯æ¯ä¸ªäººçš„ä»»åŠ¡éƒ½æ¯”è¾ƒè½»æ¾æ‰€ä»¥åšäº‹é€Ÿåº¦ä¹Ÿå¾ˆå¿«ï¼Œè¿™å°±æ˜¯æµæ°´çº¿æ“ä½œï¼ŒæŠŠä¸€ä»¶å¾ˆå¤æ‚çš„äº‹æƒ…åˆ’åˆ†æˆNä¸ªå°äº‹ï¼Œè™½ç„¶ç‰ºç‰²äº†é¢ç§¯ä½†æ¢å–äº†ç³»ç»Ÿè¿è¡Œæ—¶é’Ÿçš„æå‡ã€‚</p><h3 class=pgc-h-arrow-right>å‰æœŸå‡†å¤‡</h3><p>é™¤äº†Verilogæ¨¡å—ï¼Œæˆ‘ä»¬è¿˜æœ‰å‡ æ ·ä¸œè¥¿éœ€è¦å‡†å¤‡ã€‚é¦–å…ˆï¼Œéœ€è¦å°†FIRæŠ½å¤´ç³»æ•°å®šç‚¹åŒ–ï¼Œä¸Šä¸€æ–‡ä½¿ç”¨çš„FIRæŠ½å¤´ç³»æ•°éƒ½æ˜¯å¾ˆå°çš„æµ®ç‚¹æ•°ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬ç›´æ¥å¯¹æ¯ä¸ªç³»æ•°ä¹˜ä»¥2çš„15æ¬¡å¹‚ï¼Œç„¶åå–æ•´æ•°ï¼Œèˆå»å°æ•°ä½ï¼Œè®¾å®šFIRæŠ½å¤´ç³»æ•°ä½å®½ä¸º16bitï¼›å› ä¸ºç³»æ•°æœ¬èº«æ¯”è¾ƒå°ï¼Œä¸æ‹…å¿ƒä¼šæº¢å‡ºã€‚æ³¨æ„ï¼Œè¿™é‡ŒæŠ½å¤´ç³»æ•°çš„ä½å®½å°½é‡ä¸è¶…è¿‡ä¿¡å·ä½å®½ï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿å¤šä¸ªæ¨¡å—åŒæ—¶è°ƒç”¨FIRç³»æ•°ï¼Œè¿™é‡Œä½¿ç”¨Pythonç›´æ¥å°†å®šç‚¹åŒ–çš„ç³»æ•°ç”Ÿæˆä¸ºfunctionï¼Œè¾“å…¥ä¸ºindexï¼Œéœ€è¦ç¬¬Né˜¶çš„FIRç³»æ•°ï¼Œå°±è°ƒç”¨functionï¼Œè¾“å…¥å‚æ•°ä¸ºNï¼Œè¾“å‡ºä¸ºå®šç‚¹åŒ–çš„ç³»æ•°ã€‚</p><p><strong>æ‰€è°“å®šç‚¹åŒ–ï¼Œè¿™é‡Œä½¿ç”¨çš„æ–¹æ³•ååˆ†ç²—æš´ï¼Œç›´æ¥å¯¹æ‰€æœ‰æµ®ç‚¹æ•°ï¼Œä¹˜ä»¥ä¸€ä¸ª2çš„næ¬¡å¹‚ã€‚ç„¶åå¯¹å‚æ•°å‘ä¸‹å–æ•´ï¼Œèˆå¼ƒå°æ•°ä½ã€‚</strong></p><p>FIRæµ®ç‚¹ç³»æ•°è½¬åŒ–ä¸ºå®šç‚¹æ•°å¹¶ç”Ÿæˆfunctionçš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>def coef2function(filename, exp, gain):    # :param filename: FIRæŠ½å¤´ç³»æ•°æ–‡ä»¶å    # :param exp:      æµ®ç‚¹æ•°è½¬å®šç‚¹æ•°çš„ä½å®½    # :param gain:     æµ®ç‚¹æ•°æ•´ä½“çš„å¢ç›Šï¼Œå¢ç›Šä¸ºpower(2, gain)    # :return:    	coef = set_coef(filename)    	with open('fir_coef.v', 'w') as f:		f.write('function [{}:0] get_coef;\n'.format(exp-1))        		f.write('input [7:0] index;\n')        		f.write('case (index)\n')        		for i in range(len(coef)):                	f.write('{}: get_coef = {};\n'.format(i,int(np.floor(coef[i] * np.power(2,gain)))))        		f.write('default: get_coef = 0;\n')        		f.write('endcase\nendfunction')</code></pre><p>è½¬æ¢ç”Ÿæˆçš„functionç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>function [15:0] get_coef;input [7:0] index;case (index)0: get_coef = 0;1: get_coef = 0;2: get_coef = 2;3: get_coef = 10;...69: get_coef = 10;70: get_coef = 2;71: get_coef = 0;72: get_coef = 0;default: get_coef = 0;endcaseendfunction</code></pre><p>è¿™æ ·ï¼Œå½“å¤šä¸ªåŸºæœ¬æ¨¡å—å¹¶è¡Œè¿è¡Œæ—¶ï¼Œæ¯ä¸ªæ¨¡å—çš„ç³»æ•°å¯ä»¥é€šè¿‡è°ƒç”¨functionè·å–å¯¹åº”çš„å‚æ•°ã€‚</p><p><br></p><p>ä»¿çœŸéœ€è¦æœ‰ä¿¡å·æºä¾›FIRæ»¤æ³¢ï¼Œæ‰€ä»¥ç›´æ¥å°†ä»¿çœŸç”¨çš„ä¿¡å·æºå®šç‚¹åŒ–ï¼›<strong>å› ä¸ºTestbenchä¸­ä½¿ç”¨readmemhæˆ–è€…readmembè¯»å–txtæ–‡æ¡£æ•°æ®ï¼Œåªèƒ½è¯»å–äºŒè¿›åˆ¶æˆ–16è¿›åˆ¶æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦å¯¹æ•°æ®è¿›è¡ŒäºŒè¿›åˆ¶æˆ–16è¿›åˆ¶è½¬æ¢ã€‚</strong></p><p>ä¿¡å·æºé€‰å–ä¸Šä¸€æ–‡çš„ä¿¡å·æºï¼Œç”±äºè¯¥ä¿¡å·æºæœ€å¤§å€¼ä¸º3ï¼Œè®¾å®šä¿¡å·æºçš„ä½å®½ä¸º16ä½ï¼Œä¸ºé˜²æ­¢æ•°æ®æº¢å‡ºï¼Œä¿¡å·æºæ•´ä½“ä¹˜ä»¥2çš„12æ¬¡å¹‚ï¼Œç„¶åå–æ•´èˆå»å°æ•°ä½ã€‚ä¸ºäº†æ–¹ä¾¿åç»­è½¬äºŒè¿›åˆ¶ï¼Œè¿™é‡Œéœ€è¦å°†æ•°æ®ç”±16bitæœ‰ç¬¦å·è½¬ä¸º16bitæ— ç¬¦å·ï¼›è½¬æ¢çš„è¿‡ç¨‹ä¸ºï¼Œå¦‚æœdata[i]å°äº0ï¼Œç›´æ¥è®¾å®šdata[i] = 2^16 + data[i]ã€‚ç„¶åä½¿ç”¨â€œ{{:0>16b}}â€.format(data[i])è½¬æ¢ä¸º16bitäºŒè¿›åˆ¶ï¼Œå­˜å…¥cos.txtã€‚</p><p>æµ®ç‚¹æ•°è½¬æ¢å®šç‚¹æ•°å¹¶è½¬æ¢äºŒè¿›åˆ¶æ•°æ®å­˜å…¥txtè½¬æ¢ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>def float2fix_point(data, exp, gain, size):    # '''    # :param data: ä¿¡å·æºæ•°æ®    # :param exp:  æµ®ç‚¹æ•°è½¬å®šç‚¹æ•°çš„ä½å®½    # :param gain: æµ®ç‚¹æ•°æ•´ä½“ä¹˜ä»¥å¢ç›Šï¼Œå¢ç›Šä¸ºpower(2,15)    # :param size: è½¬æ¢å¤šå°‘ç‚¹æ•°    # :return:    # '''    	if size &gt; len(data):          	print("error, size &gt; len(data)")        		return    	data = [int(np.floor(data[i] * np.power(2, gain) )) for i in range(size)]      fmt = '{{:0&gt;{}b}}'.format(exp)    	n = np.power(2, exp)    	for i in range(size):          	if data[i] &gt; (n //2 - 1):                	print("error")        		if data[i] &lt; 0:                	d = n + data[i]        		else:                	d = data[i]        		data[i] = fmt.format(d)    	np.savetxt('cos.txt', data, fmt='%s')</code></pre><p><br></p><h3 class=pgc-h-arrow-right>å®ç°æ–¹æ³•</h3><p>ä¸ºäº†æ–¹ä¾¿çœ‹ç¤ºä¾‹ä»£ç ï¼Œè¿™é‡Œå‡å®šä¿¡å·ä½å®½DATA_BITSä¸º16ï¼Œç³»æ•°ä½å®½ä¸ºCOEF_BITSä¸º16ï¼Œæ‰©å±•ç¬¦å·ä½å®½EXTEND_BITSä¸º5ï¼Œ é˜¶æ•°FIR_ORDERä¸º72ã€‚</p><p>è®¾è®¡æ€è·¯è¿˜æ˜¯ä»åº•å±‚å¼€å§‹è®¾è®¡ï¼Œé¦–å…ˆéœ€è¦å®ç°FIRçš„åŸºæœ¬æ¨¡å—ã€‚å‰é¢æåˆ°ï¼Œä¸ºäº†èŠ‚çœä¹˜æ³•å™¨ï¼Œæ¯ä¸ªæ¨¡å—è¾“å…¥ä¸¤ä¸ªä¿¡å·å’Œä¸€ä¸ªFIRæŠ½å¤´ç³»æ•°ï¼Œä¸¤ä¸ªå‚æ•°ç›¸åŠ ï¼Œç›¸åŠ ç»“æœç›´æ¥ä¹˜ä»¥ç³»æ•°ï¼Œæœ€ååšç¬¦å·ä½æ‰©å±•ï¼Œé˜²æ­¢åç»­æ“ä½œå¯¼è‡´ç¬¦å·ä½æº¢å‡ºã€‚</p><p>fir_base.v ä¸»è¦ä»£ç ï¼š</p><pre><code>reg signed [DATA_BITS + COEF_BITS - 1:0]  data_mult;// å› ä¸ºFIRç³»æ•°æ˜¯ä¸­å¿ƒå¯¹ç§°çš„ï¼Œæ‰€ä»¥ç›´æ¥æŠŠä¸­å¿ƒå¯¹ç§°çš„æ•°æ®ç›¸åŠ ä¹˜ä»¥ç³»æ•°// ç›¸åŠ ç¬¦å·ä½æ‰©å±•ä¸€ä½wire signed [DATA_BITS:0]  data_in ;assign data_in = {data_in_A[DATA_BITS-1], data_in_A} + {data_in_B[DATA_BITS-1], data_in_B};// ä¸ºäº†é˜²æ­¢åç»­æ“ä½œå¯¼è‡´ç¬¦å·ä½æº¢å‡ºï¼Œè¿™é‡Œæ‰©å±•ç¬¦å·ä½ï¼Œè®¾è®¡ä½æ“ä½œçŸ¥è¯†assign data_out = {{EXTEND_BITS{data_mult[DATA_BITS + COEF_BITS - 1]}},data_mult };always @(posedge clk or posedge rst) begin  	if (rst) begin      	// reset      	fir_busy  &lt;=  1'b0;    		data_mult  &lt;=   0 ;    		output_vld  &lt;=  1'b0;  	end    else if (en) begin          //å¦‚æœcoefä¸º0ï¼Œä¸éœ€è¦è®¡ç®—ç›´æ¥å¾—0      	data_mult  &lt;=  coef != 0 ? data_in * coef : 0;    		output_vld  &lt;=  1'b1;  	end    else begin      	data_mult  &lt;=  'd0;    		output_vld  &lt;=  1'b0;  	endend</code></pre><p><br></p><p>å®Œæˆäº†åŸºæœ¬æ¨¡å—åï¼Œé¡¶å±‚æ¨¡å—å°±æ˜¯è°ƒç”¨åŸºæœ¬æ¨¡å—ï¼Œç„¶åå¯¹è¿ç®—ç»“æœè¿›è¡Œç›¸åŠ æ“ä½œã€‚ä½†è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œé¡¶å±‚é¦–å…ˆéœ€è¦73ä¸ª16bitçš„å¯„å­˜å™¨ï¼Œç”¨æ¥ä¿å­˜ä¼ å…¥çš„ä¿¡å·å¹¶å®ç°æ¯æ—¶é’Ÿå‘¨æœŸä¸Šå‡æ²¿ï¼Œ73ä¸ªæ•°æ®æ•´ä½“å‰ç§»ï¼›å­¦è¿‡æ•°æ®ç»“æ„çš„åŒå­¦å¯ä»¥æŠŠè¿™ä¸ªæƒ³è±¡æˆé˜Ÿåˆ—ç»“æ„ï¼Œæ¯æ¬¡ä¿¡å·ä¸Šå‡æ²¿æ—¶ï¼Œé˜Ÿé¦–ä¿¡å·å‡ºé˜Ÿï¼Œé˜Ÿå°¾è¡¥è¿›æ–°çš„ä¿¡å·ã€‚</p><div class=pgc-img><img alt="ï¼ˆæ¢è®¨æ»¤æ³¢å™¨ï¼‰2. æ‰‹æŠŠæ‰‹ç”¨Verilogå®ç°FIRæ»¤æ³¢å™¨ï¼ŒéIPæ ¸" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8624f085473f4f98af066bf031f48ba2><p class=pgc-img-caption></p></div><p><br></p><p>å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code>// FIRè¾“å…¥æ•°æ®æš‚å­˜å¯„å­˜å™¨ç»„reg signed 	[DATA_BITS-1:0]	data_tmp [FIR_ORDER:0] ;always @(posedge clk or posedge rst) begin	if (rst) begin		// reset		data_tmp[0] &lt;=	0;	end	else if (data_in_vld) begin		data_tmp[0] &lt;=	data_in;	endendgenerate	genvar j;    for (j = 1; j &lt;= FIR_ORDER; j = j + 1)	begin: fir_base	//è¿™é‡Œæ— æ³•å…¼é¡¾0ï¼ŒFIR_HALF_ORDER    always @(posedge clk or posedge rst) begin    if (rst) begin        // reset        data_tmp[j] &lt;=	0;    end    else if (data_in_vld) begin        data_tmp[j] &lt;=	data_tmp[j-1];    end	endendgenerate</code></pre><p><br></p><p>è¿™é‡Œå®ç°äº†ä»0-72å…±73ä¸ªå¯„å­˜å™¨ï¼Œä½¿ç”¨äº†Verilogçš„ç±»ä¼¼äºŒç»´æ•°ç»„çš„å¯„å­˜å™¨å®šä¹‰ç”¨æ³•ã€‚å¯ä»¥ä»ä»£ç çœ‹åˆ°ï¼Œ0å·data_tmpè¿‡äºç‰¹æ®Šï¼Œéœ€è¦ä¿å­˜è¾“å…¥çš„ä¿¡å·ï¼Œè€Œå…¶ä»–data_tmpç›´æ¥ä½¿ç”¨generate forè¯­æ³•å®ç°å‰é¢æåˆ°çš„â€œé˜Ÿåˆ—â€åŠŸèƒ½ã€‚generate forè¯­æ³•æ˜¯å¯ä»¥ç»¼åˆçš„ï¼Œ<strong>å…¶ä¸­forå¾ªç¯çš„å‚æ•°å¿…é¡»æ˜¯å¸¸æ•°</strong>ï¼Œå…¶ä½œç”¨å°±æ˜¯ç›´æ¥åœ¨ç”µè·¯ä¸Šè¦†åˆ¶å¾ªç¯ä½“çš„å†…å®¹ã€‚å¯¹äºåƒè¿™æ ·éœ€è¦è§„å¾‹æ€§åœ°èµ‹å€¼æ“ä½œå¾ˆæ–¹ä¾¿ï¼Œä¸‹é¢è¿˜ä¼šå‡ºç°generate forè¯­æ³•ã€‚</p><p><br></p><p>å¯„å­˜å™¨ç»„çš„é—®é¢˜è§£å†³åï¼Œéœ€è¦ä¸FIRå‚æ•°è¿›è¡Œä¹˜åŠ ï¼Œè¿™é‡ŒåŒæ ·é€‚ç”¨generate forè¯­å¥ç®€åŒ–è®¾è®¡ï¼š</p><pre><code>localparam FIR_HALF_ORDER = FIR_ORDER / 2;  //36wire signed [OUT_BITS-1:0]	data_out_tmp [FIR_HALF_ORDER:0] ;// FIRè¾“å‡ºæ•°æ®åæµæ°´çº¿ç›¸åŠ çš„ä¸­é—´å˜é‡ï¼Œå¤šå‡ºéƒ¨åˆ†å˜é‡ï¼Œé˜²æ­¢ä¸‹ä¸€çº§ç›¸åŠ è¿‡ç¨‹ä¸­indexè¶Šç•Œreg signed 	[OUT_BITS-1:0]	dat_out_reg  [FIR_HALF_ORDER+4:0] ; 	//40-0always @(posedge clk or posedge rst) begin	if (rst) begin		// reset		dat_out_reg[FIR_HALF_ORDER] &lt;= 0;	end	else if (output_vld_tmp[FIR_HALF_ORDER]) begin		dat_out_reg[FIR_HALF_ORDER] &lt;= data_out_tmp[FIR_HALF_ORDER];	endendfir_base #(	.DATA_BITS(DATA_BITS),	.COEF_BITS(COEF_BITS),	.EXTEND_BITS(EXTEND_BITS)	)fir_inst_FIR_HALF_ORDER(	.clk		(clk),	.rst		(rst),    .en			(data_in_vld),    .data_in_A	(data_tmp[FIR_HALF_ORDER]),    .data_in_B	(12'd0),    .coef		(get_coef(FIR_HALF_ORDER)),    .fir_busy	(),    .data_out	(data_out_tmp[FIR_HALF_ORDER]),    .output_vld	(output_vld_tmp[FIR_HALF_ORDER])    );    generate	genvar j;	for (j = 1; j &lt; FIR_HALF_ORDER; j = j + 1)	begin: fir_base	fir_base	#(	.DATA_BITS(DATA_BITS),	.COEF_BITS(COEF_BITS),	.EXTEND_BITS(EXTEND_BITS)	)	fir_inst_NORMAL	(		.clk		(clk),		.rst		(rst),				.en			(data_in_vld),		.data_in_A	(data_tmp[j]),		.data_in_B	(data_tmp[FIR_ORDER-j]),		.coef		(get_coef(j)),				.fir_busy	(),		.data_out	(data_out_tmp[j]),		.output_vld	(output_vld_tmp[j])	);	always @(posedge clk or posedge rst) begin		if (rst) begin			// reset			dat_out_reg[j] &lt;= 0;		end		else if (output_vld_tmp[j]) begin			dat_out_reg[j] &lt;= data_out_tmp[j];		end	endendgenerate</code></pre><p>é¦–å…ˆç”±äºä¸­å¿ƒç‚¹ï¼ˆç¬¬36é˜¶ï¼‰çš„ç³»æ•°æ˜¯åªä¹˜ä¸­å¿ƒç‚¹ï¼Œå¹¶ä¸åƒå…¶ä»–ç³»æ•°å¯ä»¥ä¼ å…¥å…³äºä¸­å¿ƒå¯¹ç§°çš„ä¸¤ä¸ªä¿¡å·ã€‚æ‰€ä»¥FIR_HALF_ORDERéœ€è¦å•ç‹¬ä¾‹åŒ–ã€‚åŒæ ·ï¼Œdat_out_regä¹Ÿéœ€è¦å•ç‹¬å¤åˆ¶ï¼›å…¶ä»–çš„ä¿¡å·åœ¨generate forå¾ªç¯ä½“å®Œæˆæ“ä½œï¼Œç”±äº0å·ç³»æ•°åœ¨é˜¶æ•°ä¸ºå¶æ•°çš„æƒ…å†µä¸‹ä¸º0ï¼Œè¿™é‡Œè·³è¿‡0å·ç³»æ•°ç›´æ¥ä»1å·ç³»æ•°å¼€å§‹ï¼Œæ‰€ä»¥forå¾ªç¯æ˜¯ä»1 - FIR_HALF_ORDERã€‚</p><p><br></p><p>åŠ æƒç»“æœå‡ºæ¥åï¼Œéœ€è¦å¯¹ç»“æœç›¸åŠ ï¼Œä¸ºäº†æå‡ç³»ç»Ÿè¿è¡Œé€Ÿç‡ï¼Œè¿™é‡Œé‡‡ç”¨ä¸‰çº§æµæ°´çº¿æ“ä½œã€‚æ¯æ¬¡è¿›è¡Œ4ä½æ•°æ®ç›¸åŠ ä¼ é€’ç»™ä¸‹ä¸€çº§æµæ°´çº¿ï¼Œæ‰€ä»¥ç¤ºä¾‹ä»£ç é‡ŒFIRæœ€é«˜é˜¶æ•°ä¸º4 * 4 * 4 * 2 = 128ã€‚</p><p>æµæ°´çº¿æ“ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><pre><code>// æµæ°´çº¿ç¬¬ä¸€çº§ç›¸åŠ ï¼Œè®¡ç®—å…¬å¼ceil(N/4)localparam FIR_ADD_ORDER_ONE = (FIR_HALF_ORDER + 3) / 4; //// æµæ°´çº¿ç¬¬äºŒçº§ç›¸åŠ ï¼Œè®¡ç®—å…¬å¼ceil(N/4)localparam FIR_ADD_ORDER_TWO = (FIR_ADD_ORDER_ONE + 3) / 4; //3reg signed [OUT_BITS-1:0]	dat_out_A [FIR_ADD_ORDER_ONE+3:0] ;	//12-0reg signed [OUT_BITS-1:0]	dat_out_B [FIR_ADD_ORDER_TWO+3:0] ;	//6-0// è¿™äº›å¤šä½™çš„regç›´æ¥è®¾ä¸º0å°±å¯ä»¥äº†always @ (posedge clk) begin	dat_out_reg[FIR_HALF_ORDER+1] = 0;	dat_out_reg[FIR_HALF_ORDER+2] = 0;	dat_out_reg[FIR_HALF_ORDER+3] = 0;	dat_out_reg[FIR_HALF_ORDER+4] = 0;	dat_out_A[FIR_ADD_ORDER_ONE] = 0;	dat_out_A[FIR_ADD_ORDER_ONE+1] = 0;	dat_out_A[FIR_ADD_ORDER_ONE+2] = 0;	dat_out_A[FIR_ADD_ORDER_ONE+3] = 0;	dat_out_B[FIR_ADD_ORDER_TWO] = 0;	dat_out_B[FIR_ADD_ORDER_TWO + 1] = 0;	dat_out_B[FIR_ADD_ORDER_TWO + 2] = 0;	dat_out_B[FIR_ADD_ORDER_TWO + 3] = 0;end// åˆ¤å®šæ‰€æœ‰FIR_BASEæ¨¡å—å®Œæˆè½¬æ¢assign data_out_vld = (&amp;output_vld_tmp[FIR_HALF_ORDER:1] == 1'b1) ? 1'b1 : 1'b0;//æœ€åä¸€çº§æµæ°´çº¿always @(posedge clk or posedge rst) begin	if (rst) begin		// reset		data_out 	&lt;=	0;	end	else if (data_out_vld) begin		data_out 	&lt;= dat_out_B[0] + dat_out_B[1] + dat_out_B[2] + dat_out_B[3];	endendgenerate	genvar j;	for (j = 1; j &lt; FIR_HALF_ORDER; j = j + 1)        	if (j &lt;= FIR_ADD_ORDER_ONE)	begin	//æµæ°´çº¿ç›¸åŠ  ç¬¬ä¸€çº§	//æ³¨æ„j çš„èŒƒå›´æ˜¯[1,FIR_HALF_ORDER]	//æ‰€ä»¥dat_out_A[j-1]		always @(posedge clk or posedge rst) begin			if (rst) begin				// reset				dat_out_A[j-1] &lt;= 0;			end			else begin				dat_out_A[j-1] &lt;= dat_out_reg[4*j-3] + dat_out_reg[4*j-2] + dat_out_reg[4*j-1] + dat_out_reg[4*j];			end		end	end        if (j &lt;= FIR_ADD_ORDER_TWO)	begin	// æµæ°´çº¿ç›¸åŠ  ç¬¬äºŒçº§		always @(posedge clk or posedge rst) begin			if (rst) begin				// reset				dat_out_B[j-1] &lt;= 0;			end			else begin				dat_out_B[j-1] &lt;= dat_out_A[4*j - 4] + dat_out_A[4*j- 3] + dat_out_A[4*j - 2] + dat_out_A[4*j - 1];			end		end	endend	endgenerate</code></pre><p>è¿™é‡Œç¬¬ä¸€çº§ï¼Œç¬¬äºŒçº§æµæ°´çº¿çš„å¾ªç¯æ¬¡æ•°é‡‡ç”¨ceil(N/4)çš„è®¡ç®—æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å–æ¯”N/4å¤§çš„æœ€å°æ•´æ•°ã€‚æ¯”å¦‚5/4 = 1.25,åˆ™ceil(1.25) = 2ï¼Œ è€Œceil(1) = 1;</p><p>å®šä¹‰æ¯çº§å¯„å­˜å™¨ç»„æ—¶ï¼Œä¼šå¤šå®šä¹‰4ä¸ªå¯„å­˜å™¨ç»„ã€‚å¹¶ä¸”è¿™äº›å¯„å­˜å™¨æ°¸è¿œä¸º0ï¼Œè¿™æ ·åšçš„åŸå› ä»¥ç¬¬ä¸€çº§æµæ°´çº¿ç›¸åŠ ä¸¾ä¾‹ï¼š</p><p>çœ‹ç¬¬ä¸€çº§æµæ°´çº¿ï¼Œå‡å®šFIR_ORDERä¸º70ï¼ŒFIR_HALF_ORDERä¸º35ï¼ŒFIR_ADD_ORDER_ONEä¸º9ï¼Œå½“jä¸º9æ—¶ï¼Œdat_out_A[8] &lt;= dat_out_reg[33] + dat_out_reg[34] + dat_out_reg[35] + dat_out_reg[36];</p><p>è€Œæˆ‘ä»¬åœ¨å‰é¢è®¾è®¡ä¸­æ­£å¥½å®šä¹‰äº†dat_out_reg[36]ï¼Œå¹¶ä¸”å®ƒæ°¸è¿œä¸º0ï¼Œä¸å½±å“æœ€ç»ˆç»“æœã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€çº§ï¼Œç¬¬äºŒçº§æµæ°´çº¿ä½¿ç”¨generate for, ifè¯­å¥ã€‚å¦‚æœifæ¡ä»¶æˆç«‹ï¼Œifå†…éƒ¨çš„ç”µè·¯ä¼šè¢«æè¿°ã€‚æœ€å71ä¸ªæ•°æ®ç»è¿‡ä¸‰çº§æµæ°´çº¿ç›¸åŠ ï¼Œç»“æœè¾“å‡ºã€‚</p><p>å¦‚æœæƒ³è¦æå‡FIRçš„æœ€é«˜è¿è¡Œé¢‘ç‡ï¼Œå¯ä»¥æŠŠæµæ°´çº¿çº§æ•°å¢åŠ ï¼Œæ¯çº§æµæ°´çº¿ç›¸åŠ æ”¹ä¸º2ä¸ªæˆ–è€…3ä¸ªã€‚</p><p><strong>è¿™ä¸ªç»“æ„åªé€‚åˆFIRé˜¶æ•°ä¸ºå¶æ•°çš„æƒ…å†µï¼Œç”±äºæœ€è¿‘æ¯”è¾ƒå¿™ï¼Œæ²¡æœ‰åšæ›´å¤§çš„å…¼å®¹æ€§ã€‚</strong></p><h3 class=pgc-h-arrow-right>ä»¿çœŸç»“æœä¸èµ„æºå ç”¨å¯¹æ¯”</h3><div class=pgc-img><img alt="ï¼ˆæ¢è®¨æ»¤æ³¢å™¨ï¼‰2. æ‰‹æŠŠæ‰‹ç”¨Verilogå®ç°FIRæ»¤æ³¢å™¨ï¼ŒéIPæ ¸" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/939bcfc5e8874f8ba18ac00fb5a68756><p class=pgc-img-caption></p></div><p><br></p><p>VCSä»¿çœŸç»“æœ</p><p><br></p><div class=pgc-img><img alt="ï¼ˆæ¢è®¨æ»¤æ³¢å™¨ï¼‰2. æ‰‹æŠŠæ‰‹ç”¨Verilogå®ç°FIRæ»¤æ³¢å™¨ï¼ŒéIPæ ¸" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b180352ee9f9454d98a23c9192e31687><p class=pgc-img-caption></p></div><p><br></p><p>FIRæ»¤æ³¢æ•ˆæœï¼ŒPython</p><p><br></p><div class=pgc-img><img alt="ï¼ˆæ¢è®¨æ»¤æ³¢å™¨ï¼‰2. æ‰‹æŠŠæ‰‹ç”¨Verilogå®ç°FIRæ»¤æ³¢å™¨ï¼ŒéIPæ ¸" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/11bf493f374a46a4a050c8b3f7b0ee2d><p class=pgc-img-caption></p></div><p><br></p><p>FIRæ»¤æ³¢æ•ˆæœï¼ŒVerilog</p><p><br></p><div class=pgc-img><img alt="ï¼ˆæ¢è®¨æ»¤æ³¢å™¨ï¼‰2. æ‰‹æŠŠæ‰‹ç”¨Verilogå®ç°FIRæ»¤æ³¢å™¨ï¼ŒéIPæ ¸" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6c42b12e17da40a1be905685f9582d53><p class=pgc-img-caption></p></div><p><br></p><p>FIR_IMPLEçš„èµ„æºå ç”¨ Quartus II 13.1</p><p><br></p><div class=pgc-img><img alt="ï¼ˆæ¢è®¨æ»¤æ³¢å™¨ï¼‰2. æ‰‹æŠŠæ‰‹ç”¨Verilogå®ç°FIRæ»¤æ³¢å™¨ï¼ŒéIPæ ¸" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0fe0cf61f9484b9191d67b9663f7898b><p class=pgc-img-caption></p></div><p><br></p><p>FIR IPæ ¸èµ„æºå ç”¨ï¼Œå‚æ•°ç›¸åŒæƒ…å†µä¸‹ï¼ŒQuartus II 13.1</p><p><br></p><div class=pgc-img><img alt="ï¼ˆæ¢è®¨æ»¤æ³¢å™¨ï¼‰2. æ‰‹æŠŠæ‰‹ç”¨Verilogå®ç°FIRæ»¤æ³¢å™¨ï¼ŒéIPæ ¸" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/75661ddeb5c345ee80c499c245cfb907><p class=pgc-img-caption></p></div><p><br></p><p>FIR_IMPLEçš„Fmax Quartus II 13.1</p><p><br></p><div class=pgc-img><img alt="ï¼ˆæ¢è®¨æ»¤æ³¢å™¨ï¼‰2. æ‰‹æŠŠæ‰‹ç”¨Verilogå®ç°FIRæ»¤æ³¢å™¨ï¼ŒéIPæ ¸" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b8fd958f5dea43fd87d8d84b427e8f59><p class=pgc-img-caption></p></div><p><br></p><p>FIR IPæ ¸ï¼ŒFmaxï¼Œ Quartus II 13.1</p><p><br></p><h3 class=pgc-h-arrow-right>æå‡å»ºè®®ï¼š</h3><p><strong>1. æå‡æœ€é«˜è¿è¡Œé€Ÿç‡ï¼Œå¯ä»¥å¢å¤šæµæ°´çº¿æ“ä½œ</strong></p><p><strong>2. å¯ä»¥ä¿®æ”¹éƒ¨åˆ†ä»£ç é€‚é…é˜¶æ•°ä¸ºå¥‡æ•°çš„æƒ…å†µ</strong></p><p>æ¬¢è¿å…³æ³¨ç•™è¨€ç‚¹èµæ”¶è—æˆ‘ï¼Œä¸€åŒæ¢è®¨FPGA/ç”µå­/ç¡¬ä»¶/è½¯ä»¶ã€‚å…³äºæœ¬æ–‡æ‰€ç”¨çš„èµ„æºä¼šåœ¨è¯„è®ºåŒºç»™å‡º</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'æ¢è®¨æ»¤','æ³¢å™¨','Verilog'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>