<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Jenkinsæ‰©å±•å…±äº«åº“è¿›é˜¶ | æå®¢å¿«è¨Š</title><meta property="og:title" content="Jenkinsæ‰©å±•å…±äº«åº“è¿›é˜¶ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/dfic-imagehandler/33443a51-98a8-4ff5-878c-7fd0a579d929"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/98cb8bb.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/98cb8bb.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/98cb8bb.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/98cb8bb.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/98cb8bb.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/98cb8bb.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/98cb8bb.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/98cb8bb.html><meta property="article:published_time" content="2020-10-29T21:06:50+08:00"><meta property="article:modified_time" content="2020-10-29T21:06:50+08:00"><meta name=Keywords content><meta name=description content="Jenkinsæ‰©å±•å…±äº«åº“è¿›é˜¶"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/98cb8bb.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Jenkinsæ‰©å±•å…±äº«åº“è¿›é˜¶</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p><br></p><div class=pgc-img><img alt=Jenkinsæ‰©å±•å…±äº«åº“è¿›é˜¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/33443a51-98a8-4ff5-878c-7fd0a579d929><p class=pgc-img-caption></p></div><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†<a class=pgc-link data-content=mp href="https://www.toutiao.com/i6832815180884214276/?group_id=6832815180884214276" rel="noopener noreferrer" target=_blank>Jenkinså¤šåˆ†æ”¯æµæ°´çº¿</a>ã€<a class=pgc-link data-content=mp href="https://www.toutiao.com/i6826988883767460365/?group_id=6826988883767460365" rel="noopener noreferrer" target=_blank>Jenkinsæµæ°´çº¿å³ä»£ç ä¹‹æ‰©å±•å…±äº«åº“åˆä½“éªŒ</a>ï¼Œå…¶å®éƒ½æ˜¯â€œæµæ°´çº¿å³ä»£ç â€çš„ä½“ç°ã€‚æˆ‘ä»¬å°†Jenkinsfileçº³å…¥é¡¹ç›®ç‰ˆæœ¬åº“ä¸­ç»Ÿä¸€ç®¡ç†ï¼Œå®ç°äº†â€œè°æ„å»ºã€è°è¿è¡Œâ€çš„ç†å¿µã€‚</p><p><strong>ä½†æ˜¯åœ¨å®é™…é¡¹ç›®ä¸­ï¼ŒCI/CDå…¶å®æ˜¯ç”±è¿ç»´æ¥ç®¡ç†çš„ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´è¿ç»´ã€å¼€å‘éƒ½è¦é€šè¿‡ç‰ˆæœ¬åº“å»ä¿®æ”¹Jenkinsfileã€é¡¹ç›®ä»£ç ã€‚</strong></p><p>è¯•æƒ³ä¸‹è¿ç»´åœ¨è°ƒè¯•æµæ°´çº¿é¢‘ç¹æäº¤ç‰ˆæœ¬ï¼Œå¯¼è‡´è¿œç¨‹åˆ†æ”¯ä¸æ–­æ›´æ–°ï¼Œå¦‚æœæœ‰é’©å­è§¦å‘è‡ªåŠ¨å‘ç‰ˆï¼ŒåŠ¿å¿…ä¼šå¼•èµ·å¼€å‘çš„çƒ¦æ„Ÿã€‚</p><p>ä¸ºäº†é¿å…è¿™ä¸ªæƒ…å†µçš„å‘ç”Ÿï¼Œ<strong>æˆ‘ä»¬å¼•å…¥äº†Jenkinsæ‰©å±•å…±äº«åº“ï¼Œå³å°†æµæ°´çº¿æ“ä½œæ‹†åˆ†ä¸ºä¸¤å—</strong>ï¼š</p><ol start=1><li>Jenkinsfileå®šä¹‰æµæ°´çº¿æ­¥éª¤ã€ç¯å¢ƒå˜é‡ã€å‚æ•°ç­‰ä¸é¡¹ç›®ç›¸å…³çš„ä¸€åˆ‡å˜é‡ï¼›</li><li>æ‰©å±•å…±äº«åº“å®šä¹‰æµæ°´çº¿è°ƒç”¨çš„æ–¹æ³•ã€å‡½æ•°ã€ç±»åº“ç­‰ä¸æ„å»ºç›¸å…³çš„å…·ä½“æ“ä½œï¼›</li></ol><p>ç”±äºä¸€æ—¦æµæ°´çº¿æ­¥éª¤åŠå˜é‡ç¡®å®šä¸€èˆ¬å°±ä¸ä¼šæ”¹åŠ¨äº†ï¼Œè€Œæ‰©å±•å…±äº«åº“çš„æ–¹æ³•ç­‰å…·ä½“æ“ä½œå®ç°æˆ‘ä»¬å¯ä»¥ä»¥ä»£ç çš„æ–¹å¼æ”¾å…¥è¿œç¨‹ç‰ˆæœ¬ä¸­ï¼Œä¿®æ”¹æäº¤å<strong>Jenkinsfileæ„å»ºè‡ªåŠ¨åŠ è½½å…±äº«åº“ï¼Œè·å–æœ€æ–°çš„æ„å»ºä¿®æ”¹</strong>ã€‚</p><p>å¦ï¼Œé€šè¿‡æ‰©å±•å…±äº«åº“æˆ‘ä»¬å¯ä»¥<strong>æé«˜æ„å»ºæ“ä½œçš„è´¹ç”¨ï¼Œæœ‰æ•ˆå‡å°‘æ„å»ºä»£ç é‡</strong>ï¼›Jenkinsfileã€æ‰©å±•åº“è¿˜å¯ä»¥ä½œ<strong>ä¸ºå¤‡ä»½æ‰˜ç®¡åœ¨ç‰ˆæœ¬åº“ä¸­ï¼Œå¯è°“æ˜¯ä¸¤å…¨å…¶ç¾å•Š</strong>ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å¯¹å¤šåˆ†æ”¯æµæ°´çº¿ã€æ‰©å±•å…±äº«åº“ç»“åˆå®ç°Vueé¡¹ç›®çš„å‘ç‰ˆã€å›æ»šæ¥å…·ä½“è®²è§£ä¸‹æ‰©å±•å…±äº«åº“çš„ä½¿ç”¨ã€‚</p><p><strong>æ³¨ï¼šå¤šåˆ†æ”¯æµæ°´çº¿å¯ä»¥æœ‰æ•ˆå°†å¤šä¸ªåˆ†æ”¯æ”¾åˆ°ä¸€ä¸ªé¡¹ç›®ä¸‹ç»Ÿä¸€ç®¡ç†ï¼Œé¿å…å› åˆ†æ”¯å¯¼è‡´çš„é¡¹ç›®åˆ†æ•£ã€‚</strong></p><h1 class=pgc-h-arrow-right><strong>Vueåœºæ™¯</strong></h1><p>Jenkins+è¿œç¨‹webæœåŠ¡å™¨</p><p>åŠŸèƒ½å®ç°ï¼š</p><ul><li>å‚æ•°åŒ–æ„å»ºï¼šdeploy-å‘ç‰ˆï¼Œrollback-å›æ»šã€‚</li><li>å‘ç‰ˆï¼šåˆ¤æ–­gitç‰ˆæœ¬æ˜¯å¦æ›´æ–°ï¼Œè‹¥æ›´æ–°åˆ™åœ¨Jenkinsä¸Šæ‰“åŒ…ï¼Œå¹¶å°†diståŒ…åˆ†å‘åˆ°è¿œç¨‹webæœåŠ¡å™¨ä¸Šï¼›è‹¥æœªæ›´æ–°ï¼Œåˆ™åœæ­¢æ„å»ºã€‚</li><li>å›æ»šï¼šå›æ»šarchiveArtifactsçš„ç‰ˆæœ¬åŒ…ï¼Œåˆ†å‘åˆ°è¿œç¨‹webæœåŠ¡å™¨ä¸Šã€‚</li></ul><p>æ³¨æ„ï¼šæˆ‘ä»¬ä½¿ç”¨archiveArtifactsæ¥å½’æ¡£ç‰ˆæœ¬åŒ…ï¼Œå›æ»šæ—¶å¯ä»å½’æ¡£è·¯å¾„ä¸­è·å–ã€‚</p><h1 class=pgc-h-arrow-right><strong>æ‰©å±•å…±äº«åº“</strong></h1><p><strong>ä¸€ã€æ·»åŠ æ‰©å±•å…±äº«åº“</strong></p><p>Manage Jenkins--Configure System--Global Pipeline Librariesä¸­æ·»åŠ </p><div class=pgc-img><img alt=Jenkinsæ‰©å±•å…±äº«åº“è¿›é˜¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6af4777e0486497bbf034dc4284c0fa6><p class=pgc-img-caption></p></div><p><strong>äºŒã€ä»£ç åº“ç»“æ„</strong></p><pre><code>pipeline-shared-library/â”œâ”€â”€ resources  #ç©ºâ”œâ”€â”€ src  #ç©ºâ””â”€â”€ vars    â””â”€â”€ vueUpdate.groovy</code></pre><p>vueUpdate.groovy æ˜¯æ‰€æœ‰vueé¡¹ç›®çš„æ„å»ºå…·ä½“æ“ä½œã€‚</p><p><strong>æ³¨æ„ï¼šç”±äºæ‰€æœ‰çš„vueé¡¹ç›®æ„å»ºç”±å…±äº«åº“ä¸­çš„ç»Ÿä¸€çš„æ–¹æ³•å®ç°ï¼Œå› æ­¤ä¸åŒåˆ†æ”¯å¯¹åº”çš„ç¯å¢ƒè¦é«˜åº¦ä¸€è‡´ï¼Œè¿™æ ·æ‰èƒ½æœ€å¤§é™åº¦çš„å®ç°ä»£ç å¤ç”¨ã€‚</strong></p><p><strong>ä¸‰ã€å…·ä½“å®ç°</strong></p><p>æˆ‘ä»¬å°†ä»£ç åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œå³deployã€rollbackã€updateã€‚</p><p><strong>1.deploy-å‘ç‰ˆ</strong></p><p>ï¼ˆ1ï¼‰åˆ¤æ–­ç‰ˆæœ¬æ˜¯å¦æ›´æ–°</p><p>æˆ‘ä»¬é€šè¿‡å°†æœ¬æ¬¡gitçš„ç‰ˆæœ¬idå­˜å…¥æ–‡ä»¶ï¼Œä»¥ä¾¿ä¸‹æ¬¡æ„å»ºæ—¶å°†å…¶ä¸GIT_COMMITè¿›è¡Œæ¯”è¾ƒï¼Œå®ç°ç‰ˆæœ¬æ˜¯å¦æ›´æ–°ã€‚</p><p><strong>æ³¨æ„ï¼šç”±äºç¬¬ä¸€æ¬¡æ„å»ºæ—¶ï¼Œæµæ°´çº¿æŠ¥é”™â€œ</strong></p><pre><code>No such property: GIT_PREVIOUS_SUCCESSFUL_COMMIT for class: groovy.lang.Binding</code></pre><p><strong>â€ã€‚æ­¤æ—¶æ˜¯æ— æ³•é€šè¿‡GIT_PREVIOUS_SUCCESSFUL_COMMITå˜é‡æ¥è·å–ä¸Šä¸€æ¬¡ç‰ˆæœ¬çš„ï¼Œå› æ­¤åªèƒ½å°†å…¶å†™å…¥æ–‡ä»¶å­˜æ”¾ã€‚</strong></p><p>ï¼ˆ2ï¼‰æ‰“åŒ…</p><p>é€šè¿‡npm æ‰“åŒ…vueé¡¹ç›®ç”Ÿæˆdistã€‚</p><p><strong>æ³¨æ„ï¼šæˆ‘ä»¬å°†distå‹ç¼©å¹¶æ”¹åä¸ºdist_temp.zip ä½œä¸ºæˆ‘ä»¬åˆ†å‘åˆ°é¡¹ç›®çš„ç‰ˆæœ¬åŒ…ã€‚å…¶ç›®çš„æ˜¯ä½œä¸ºä¸­é—´ä¸´æ—¶æ–‡ä»¶ï¼Œç”¨äºå’Œé¡¹ç›®çš„å®é™…distç›®å½•è¿›è¡Œæ›¿æ¢ï¼Œæ›´æ–°åé”€æ¯å³å¯ã€‚</strong></p><p><strong>å¦æœ€ç»ˆå½’æ¡£çš„ç‰ˆæœ¬åŒ…ä¹Ÿä¸ºdist_temp.zipã€‚</strong></p><p><strong>2.å›æ»š-rollback</strong></p><p>å›æ»šçš„ç‰ˆæœ¬å­˜åœ¨äºarchiveArtifactså½’æ¡£åçš„æ„å»ºç›®å½•ä¸­ï¼Œåœ¨æ­¤ç›®å½•ä¸­</p><pre><code>${JENKINS_HOME}/jobs/`echo ${JOB_NAME}|awk -F'/' '{print \$1}'`/branches/${BRANCH_NAME}/builds/${version}/archive/</code></pre><p>å¤šåˆ†æ”¯æµæ°´çº¿çš„ç›®å½•ä»¥åˆ†æ”¯ååŒºåˆ†å­ç›®å½•ã€‚</p><p><strong>3.åˆ†å‘æ›´æ–°</strong></p><p>Jenkinsé€šè¿‡sshpublisherå°†ç‰ˆæœ¬åŒ…dist_temp.zip åˆ†å‘åˆ°è¿œç¨‹webæœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡rsyncå¯¹é¡¹ç›®ç›®å½•distè¿›è¡Œæ›´æ–°ï¼Œæœ€åé”€æ¯dist_temp.zipã€‚</p><p><strong>æ³¨æ„ï¼šå½’æ¡£dist_temp.zip åŠ é‚®ä»¶é€šçŸ¥ç”±Jenkinsfileå®šä¹‰ï¼Œä¸æ”¾åœ¨å…±äº«åº“ä¸­ã€‚</strong></p><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><p><strong>æ‰€æœ‰çš„å˜é‡ç”±è·Ÿéšé¡¹ç›®çš„Jenkinsfileæä¾›ã€‚</strong></p><pre><code>def deploy() {    sh """        #æ–°å»ºcommitidæ–‡ä»¶ï¼Œåˆæ¬¡å†™å…¥0        if [ ! -f commitid ];then             echo 0 &gt; commitid         fi        #ä»commitidè·å–ä¸Šæ¬¡ç‰ˆæœ¬id        previous_id=`cat commitid`        if [ \$previous_id != $GIT_COMMIT ];then            #å†™å…¥æœ¬æ¬¡git commitï¼Œç”¨äºä¸‹æ¬¡åˆ¤æ–­            echo $GIT_COMMIT &gt; commitid            echo "start npm install&amp;build"            /usr/local/nodejs/bin/npm install            /usr/local/nodejs/bin/npm run build            [ -f ${ZIP_NAME}.zip ] &amp;&amp; rm -rfv ${ZIP_NAME}.zip            [ -d ${ZIP_NAME} ] &amp;&amp; rm -rfv ${ZIP_NAME}            echo -e "\\033[34må°†distæ”¹åä¸º${ZIP_NAME}ï¼š\\033[0m"            mv -v dist ${ZIP_NAME} &amp;&amp; echo -e "\\033[32mdistæ”¹åä¸º${ZIP_NAME}æˆåŠŸã€‚\\033[0m" || {                echo -e "\\033[32mdistæ”¹åä¸º${ZIP_NAME}å¤±è´¥ã€‚\\033[0m"                exit 1            }            zip -r ${ZIP_NAME}.zip ${ZIP_NAME} &amp;&amp; echo -e "\\033[32m${ZIP_NAME}å‹ç¼©æˆåŠŸã€‚\\033[0m" || {                echo -e "\\033[32m${ZIP_NAME}å‹ç¼©å¤±è´¥ã€‚\\033[0m"                exit 1            }        else            echo -e "\\033[31mRepositories not update, stop deploy\\033[0m"            exit 1        fi    """}def rollback() {    sh """    [ ${version} -eq 0 ] &amp;&amp; {        echo -e "\\033[31mç‰ˆæœ¬å·é0ã€‚\\033[0m"        exit 1    } || echo -e "\\033[34mActionï¼š${deploy_env}\\033[0m"    echo -e "\\033[34mRollback versionï¼š${version}\\033[0m"    rm -rfv ${ZIP_NAME}.zip    cp -Rv ${JENKINS_HOME}/jobs/`echo ${JOB_NAME}|awk -F'/' '{print \$1}'`/branches/${BRANCH_NAME}/builds/${version}/archive/${ZIP_NAME}.zip .    [ \$? -eq 0 ] &amp;&amp; echo -e "\\033[32mæŒ‡å®šç‰ˆæœ¬å·${version}çš„${ZIP_NAME}.zipå¤åˆ¶åˆ°å½“å‰éƒ¨ç½²ç›®å½•æˆåŠŸã€‚\\033[0m" || {        echo -e "\\033[31mæŒ‡å®šç‰ˆæœ¬å·${version}çš„${ZIP_NAME}.zipå¤åˆ¶åˆ°å½“å‰éƒ¨ç½²ç›®å½•å¤±è´¥ã€‚\\033[0m"        exit 1    }    """}def update(host) {    for(i in host){        sshPublisher(            publishers: [sshPublisherDesc(configName: "$i", transfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: """            IN_Face=`/sbin/route -n |awk '{if(\$4~/UG/){print \$8}}'|head -n 1`            Local_IP=`/sbin/ip addr show "\${IN_Face}" | grep -w 'inet' | awk '{print \$2}'`            cd /App/htdocs/${APP_NAME}                            echo -e "\\033[34m\${Local_IP}èŠ‚ç‚¹è§£å‹æ–°ç‰ˆå‹ç¼©åŒ…${ZIP_NAME}.zipï¼š\\033[0m"            unzip -o ${ZIP_NAME}.zip &amp;&amp; echo -e "\\033[32m\${Local_IP}èŠ‚ç‚¹${ZIP_NAME}.zipè§£å‹æˆåŠŸã€‚\\033[0m" || {            echo -e "\\033[31m\${Local_IP}èŠ‚ç‚¹${ZIP_NAME}.zipè§£å‹å¤±è´¥ã€‚\\033[0m"            exit 1            }            public_dir=`echo ${ZIP_NAME} | awk -F'_' '{print \$1}'`            echo -e "\\033[34m\${Local_IP}èŠ‚ç‚¹å°†${ZIP_NAME}ç›®å½•ä¸‹æ•°æ®åŒæ­¥åˆ°ç”Ÿäº§ç›®å½•\${public_dir}å†…ï¼š\\033[0m"            [ -d ${ZIP_NAME} ] &amp;&amp; rsync -vrl --delete ${ZIP_NAME}/ \${public_dir:-/tmp/aaa}/            [ \$? -eq 0 ] &amp;&amp; echo -e "\\033[32m\${Local_IP}èŠ‚ç‚¹æ•°æ®åŒæ­¥æˆåŠŸã€‚\\033[0m" || {            echo -e "\\033[31m\${Local_IP}èŠ‚ç‚¹æ•°æ®åŒæ­¥å¤±è´¥ã€‚\\033[0m"            exit 1            }            echo -e "\\033[34m\${Local_IP}èŠ‚ç‚¹å°†${ZIP_NAME}.zipåˆ é™¤ï¼š\\033[0m"            rm -rfv ${ZIP_NAME}.zip ${ZIP_NAME}            echo -e "\\033[32m${JOB_NAME}å‘å¸ƒæˆåŠŸã€‚\\033[0m"            """, execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: '[, ]+', remoteDirectory: "htdocs/${APP_NAME}", remoteDirectorySDF: false, removePrefix: '', sourceFiles: "${ZIP_NAME}.zip")], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)]        )    }}</code></pre><h1 class=pgc-h-arrow-right><strong>Jenkinsfile</strong></h1><p><strong>1.å‚æ•°åŒ–æ„å»º</strong></p><p>é€šè¿‡parameters å®šä¹‰æ„å»ºçš„å‚æ•°ï¼šdeployã€rollback</p><p>å›æ»šé€šè¿‡BUILD_NUMBERä¼ è¾“å†å²ç‰ˆæœ¬çš„å½’æ¡£ã€‚</p><p><strong>2.ç¯å¢ƒå˜é‡</strong></p><p>æˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼š</p><p>APP_NAME é¡¹ç›®æ‰€åœ¨ç›®å½•ï¼Œå¦‚/App/${APP_NAME}/dist</p><p>ZIP_NAME ç‰ˆæœ¬åŒ…</p><p><strong>3.æµæ°´çº¿æ­¥éª¤</strong></p><p>å‘ç‰ˆï¼šè°ƒç”¨å…±äº«åº“deployæ–¹æ³•ï¼›</p><p>å›æ»šï¼šè°ƒç”¨å…±äº«åº“rollbackæ–¹æ³•ï¼›</p><p>æµ‹è¯•éƒ¨ç½²ï¼šè°ƒç”¨å…±äº«åº“updateæ–¹æ³•ï¼Œä¼ å…¥æµ‹è¯•ç¯å¢ƒæœåŠ¡å™¨åˆ—è¡¨ï¼›</p><p>ç”Ÿäº§éƒ¨ç½²ï¼šè°ƒç”¨å…±äº«åº“updateæ–¹æ³•ï¼Œä¼ å…¥ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨åˆ—è¡¨ï¼›</p><p>å½’æ¡£ï¼šä¸ç®¡æ„å»ºçŠ¶æ€ï¼Œæ€»æ˜¯å½’æ¡£ç‰ˆæœ¬åŒ…dist_temp.zipï¼›</p><p>é‚®ä»¶é€šçŸ¥ï¼šæ„å»ºä¸ç¨³å®šã€æˆåŠŸã€å¤±è´¥å‘é€é‚®ä»¶é€šçŸ¥ï¼›</p><p><br></p><p><strong>æ³¨æ„ï¼šæµæ°´çº¿ä¸­æˆ‘ä»¬ä½¿ç”¨whenæ¥åŒ¹é…å‚æ•°åŒ–æ„å»ºï¼Œè¿™æ ·å¯ä»¥é¿é¿å…åœ¨shä¸­ä½¿ç”¨caseæˆ–if åˆ¤æ–­ï¼Œå‡å°‘ä»£ç é‡ã€‚</strong></p><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>//å¼•å…¥jenkinsæ‰©å±•å…±äº«åº“@Library('shared-library') _pipeline {    agent any    options {        ansiColor('xterm')        timestamps()    }    parameters {        choice choices: ['deploy', 'rollback'], description: '''deployï¼šå‘å¸ƒ            rollbackï¼šå›æ»š''', name: 'deploy_env'        string defaultValue: '0', description: '''å›æ»šç‰ˆæœ¬å·ï¼Œå‘å¸ƒæ—¶å¿½ç•¥è¯¥å‚æ•°            ç‰ˆæœ¬å·ä¸ºjenkins job BUILD_NUMBER''', name: 'version', trim: false    }    environment {        APP_NAME="www.test.cn"        ZIP_NAME="dist_temp"    }    stages {        stage('å‘ç‰ˆ') {            //åŒ¹é…å‘ç‰ˆå‚æ•°            when {                expression { params.deploy_env ==~ 'deploy' }            }      steps {                script {                    vueUpdate.deploy()                }            }        }        stage('å›æ»š') {            //åŒ¹é…å›æ»šå‚æ•°            when {                expression { params.deploy_env ==~ 'rollback' }            }            steps {                script {                    vueUpdate.rollback()                }            }        }        stage('æµ‹è¯•éƒ¨ç½²') {            //åŒ¹é…developåˆ†æ”¯            when {                branch 'develop'            }            steps {                script {                    def host = ["test-10.13", "test-10.14"]                    vueUpdate.update(host)            }        }        stage('ç”Ÿäº§éƒ¨ç½²') {            //åŒ¹é…masteråˆ†æ”¯            when {                branch 'master'            }            steps {                script {                    def host = ["prod-10.11", "prod-10.12"]                    vueUpdate.update(host)                }            }        }  }    post {        always {            archiveArtifacts "${ZIP_NAME}.zip"        }        unstable {            emailext (                body: """é¡¹ç›®åç§°ï¼š${JOB_NAME}\næ„å»ºç¼–å·ï¼š${BUILD_NUMBER}\næ„å»ºæ—¥å¿—ï¼š${BUILD_URL}console""",                subject: 'ã€Jenkinsæ„å»ºé€šçŸ¥ã€‘:$JOB_NAME - Build # $BUILD_NUMBER - Unstable!',                to: 'xx@test.cn',                from: 'test@test.cn'            )        }        success {            emailext (                body: """é¡¹ç›®åç§°ï¼š${JOB_NAME}\næ„å»ºç¼–å·ï¼š${BUILD_NUMBER}\næ„å»ºæ—¥å¿—ï¼š${BUILD_URL}console""",                subject: 'ã€Jenkinsæ„å»ºé€šçŸ¥ã€‘:$JOB_NAME - Build # $BUILD_NUMBER - Successful!',                to: 'xx@test.cn',                from: 'test@test.cn'            )        }        failure {            emailext (                body: """é¡¹ç›®åç§°ï¼š${JOB_NAME}\næ„å»ºç¼–å·ï¼š${BUILD_NUMBER}\næ„å»ºæ—¥å¿—ï¼š${BUILD_URL}console""",                subject: 'ã€Jenkinsæ„å»ºé€šçŸ¥ã€‘:$JOB_NAME - Build # $BUILD_NUMBER - Failure!',                to: 'xx@test.cn',                from: 'test@test.cn'            )        }    }}</code></pre><p>æœ€ç»ˆç»“æœå¦‚ä¸‹ï¼š</p><p><br></p><div class=pgc-img><img alt=Jenkinsæ‰©å±•å…±äº«åº“è¿›é˜¶ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/39e1e758c4d64ffb9c04a84b135569bc><p class=pgc-img-caption></p></div><p><br></p><div class=pgc-img><img alt=Jenkinsæ‰©å±•å…±äº«åº“è¿›é˜¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/44a50dd47e20488ca9ba2aa552f880e9><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>æ€»ç»“</strong></h1><p>Jenkinsæ‰©å±•å…±äº«åº“+å¤šåˆ†æ”¯æµæ°´çº¿ä¸€æ–¹é¢å¯ä»¥ç®€åŒ–CI/CDè¿‡ç¨‹ä¸­çš„é¡¹ç›®ç®¡ç†ï¼Œä¸€æ–¹é¢å¯ä»¥é©±åŠ¨æˆ‘ä»¬å„ä¸ªç¯å¢ƒçš„æ ‡å‡†åŒ–ï¼Œä¸ºå®ç°è‡ªåŠ¨åŒ–åšå¥½é“ºå«ã€‚</p><p>åè¿‡æ¥ç¯å¢ƒæ ‡å‡†åŒ–æ˜¯æˆ‘ä»¬çµæ´»åº”ç”¨Jenkinsæ‰©å±•å…±äº«åº“çš„å‰æï¼Œæ²¡æœ‰è¶³å¤Ÿçš„æ ‡å‡†åŒ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å¢åŠ ä»£ç é‡å»é€‚é…å„ä¸ªç¯å¢ƒã€‚</p><p>æ€»ä¹‹ï¼Œåœ¨è¿ç»´çš„è¿‡ç¨‹ä¸­ï¼Œä½ ä¼šå‘ç°æ ‡å‡†åŒ–å’Œè§„èŒƒåŒ–è¶Šæ¥è¶Šé‡è¦ã€‚</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Jenkins','æ‰©å±•','è¿›é˜¶'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>