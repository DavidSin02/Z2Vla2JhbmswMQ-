<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>一个真实问题，搞定三个冷门pandas函数 | 极客快訊</title><meta property="og:title" content="一个真实问题，搞定三个冷门pandas函数 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/b21422d9f27e4fe3962d0ca036e65494"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/9c6332b.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/9c6332b.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/9c6332b.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/9c6332b.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/9c6332b.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/9c6332b.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/9c6332b.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/9c6332b.html><meta property="article:published_time" content="2020-10-29T20:58:30+08:00"><meta property="article:modified_time" content="2020-10-29T20:58:30+08:00"><meta name=Keywords content><meta name=description content="一个真实问题，搞定三个冷门pandas函数"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/9c6332b.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一个真实问题，搞定三个冷门pandas函数</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div class=pgc-img><img alt=一个真实问题，搞定三个冷门pandas函数 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b21422d9f27e4fe3962d0ca036e65494><p class=pgc-img-caption></p></div><p>作者：刘早起</p><p>来源：早起Python</p><p>最近有一个粉丝问过我一个问题，觉得挺有意思，分享给大家。经过简化后大概就是有一个长这样的时间序列数据</p><div class=pgc-img><img alt=一个真实问题，搞定三个冷门pandas函数 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8ed218a7eb5d45a1ac84f36b065f497e><p class=pgc-img-caption></p></div><p>可以看到，一共有15行数据，其中有一些行的<span style="color:#ff6441;--tt-darkmode-color: #FF6441">value</span>是空值， 现在想在<strong>不改变原数据的情况下</strong>取出<strong>从第一个不是空值的行之后的全部数据</strong></p><div class=pgc-img><img alt=一个真实问题，搞定三个冷门pandas函数 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5e28934a5a354130bedc5cd537029a58><p class=pgc-img-caption></p></div><p>嗯，看上去不是很难，但如果添加一个额外要求:<strong>「使用纯pandas函数完成」</strong> 这就涉及到了一些不常用的函数，一起来看看。</p><p>首先需要构造这样的数据，在Python中我们可以先按照规则生成字符串，然后使用<span style="color:#ff6441;--tt-darkmode-color: #FF6441">time</span>或<span style="color:#ff6441;--tt-darkmode-color: #FF6441">datatime</span>模块进行转换，方法很多，但是<strong>pandas中如何直接生成呢？这就涉及到第一个函数</strong><span style="color:#ff6441;--tt-darkmode-color: #FF6441">date_range</span>。</p><p><strong><span style="color:#f96e57;--tt-darkmode-color: #F96E57">pd.date_range</span></strong></p><p>其实在pandas中生成时间序列数据比其他方法要方便很多，使用<span style="color:#ff6441;--tt-darkmode-color: #FF6441">.date_range</span><strong>一行代码</strong>即可，该函数使用方法为</p><pre><code>pandas.date_range(start=None, end=None, periods=None, freq=None,                   tz=None, normalize=False, name=None, closed=None, **kwargs)</code></pre><p>可以通过<strong>起止日期</strong>来生成</p><div class=pgc-img><img alt=一个真实问题，搞定三个冷门pandas函数 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fa554d55eddf4ae8afa6e39502765b18><p class=pgc-img-caption></p></div><p>也可以通过<strong>开始日期与长度</strong>生成</p><div class=pgc-img><img alt=一个真实问题，搞定三个冷门pandas函数 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bf589adbde9d4130a4c90f277eec09da><p class=pgc-img-caption></p></div><p>上面的默认间隔是1天，当然是可以自定义，比如修改为5天</p><div class=pgc-img><img alt=一个真实问题，搞定三个冷门pandas函数 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0248b9b2ada944de8f3d043fc0b1418a><p class=pgc-img-caption></p></div><p>该方法还<strong>支持生成更多的指定形式的时间序列数据</strong>，感兴趣的读者可以自行查阅官方文档，现在我们就可以生成示例数据</p><pre><code>df = pd.DataFrame(    {   'date': [i for i in pd.date_range('20200701','20200715')],        'value': ['','','','','',1,6,1,2,'',2,1,6,0,1]}) </code></pre><div class=pgc-img><img alt=一个真实问题，搞定三个冷门pandas函数 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8ed218a7eb5d45a1ac84f36b065f497e><p class=pgc-img-caption></p></div><p>接下来我的思路是</p><ul><li>判断value列的每个值是否为空值，返回<span style="color:#ff6441;--tt-darkmode-color: #FF6441">Ture/False</span></li><li><strong>找到第一个为False的索引</strong>，取后面全部的数据</li></ul><p>为了只用pandas实现这个思路，用到了两个不常见的函数，让我们慢慢说。</p><p><strong><span style="color:#f96e57;--tt-darkmode-color: #F96E57">pandas.Series.ne</span></strong></p><p>ne函数<strong>可以比较两个Series</strong>，常用于缺失值填充，下面是一个例子</p><div class=pgc-img><img alt=一个真实问题，搞定三个冷门pandas函数 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/190ccd8b778e477eb633fbcb805d9647><p class=pgc-img-caption></p></div><p>除了可以比较两个Series之外，对于我们的问题，它可以比较元素：<strong>返回True如果这个值不是你指定的值</strong>，听上去很绕，我们看代码</p><div class=pgc-img><img alt=一个真实问题，搞定三个冷门pandas函数 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7b07d53b089e4009bac2f32ab0d73d91><p class=pgc-img-caption></p></div><p>可以看到，所有空值都被标记为False，接下来要做的就是<strong>找到第一个True元素的索引，并取出之后的全部数据。</strong></p><p><strong><span style="color:#f96e57;--tt-darkmode-color: #F96E57">pandas.DataFrame.idxmax</span></strong></p><p>如何在pandas中<strong>直接定位一组数据中最大/最小值的位置</strong>？可以使用<span style="color:#ff6441;--tt-darkmode-color: #FF6441">idxmax/idxmin</span>，这个函数不难，直接看一个简单的例子</p><div class=pgc-img><img alt=一个真实问题，搞定三个冷门pandas函数 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/55afe2098ad142c69f8cc8258c7ac57f><p class=pgc-img-caption></p></div><p>它可以<strong>返回最大值/最小值第一次出现的位置索引</strong>！刚好可以满足我们的要求，现在就可以将<span style="color:#ff6441;--tt-darkmode-color: #FF6441">idxmax</span>与之前的<span style="color:#ff6441;--tt-darkmode-color: #FF6441">ne</span>函数结合起来实现我们需求</p><pre><code>df['value'].ne('').idxmax()# 5</code></pre><p>返回的索引值是5，最后就可以使用<span style="color:#ff6441;--tt-darkmode-color: #FF6441">loc</span>函数<strong>一行代码实现我们的需求</strong></p><div class=pgc-img><img alt=一个真实问题，搞定三个冷门pandas函数 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/863133247c324b919ae93936b1cae1c7><p class=pgc-img-caption></p></div><p>其实这个问题<strong>还有很多其他的办法</strong>，比如可以先筛选出所有True的索引，然后使用<span style="color:#ff6441;--tt-darkmode-color: #FF6441">.first_valid_index()</span>找到第一个True，最后也可以不用loc直接<span style="color:#ff6441;--tt-darkmode-color: #FF6441">df[df['value'].ne('')]</span>实现。</p><p>但我还希望你能掌握上面三个函数并灵活运用，如果有更好的思路可以在评论区留言。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'一个','真实','问题'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>