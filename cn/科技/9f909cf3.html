<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>CAN总线错误检测机制 | 极客快訊</title><meta property="og:title" content="CAN总线错误检测机制 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/153016949864906bebe91d2"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/9f909cf3.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/9f909cf3.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/9f909cf3.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/9f909cf3.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/9f909cf3.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/9f909cf3.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/9f909cf3.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/9f909cf3.html><meta property="article:published_time" content="2020-10-29T21:09:30+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:30+08:00"><meta name=Keywords content><meta name=description content="CAN总线错误检测机制"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/9f909cf3.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>CAN总线错误检测机制</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p><strong>【</strong>电动汽车<strong>资源网EV江湖 ZLG致远电子】</strong>CAN总线是ISO国际标准化的串行通信协议。在汽车产业中,出于对安全性、舒适性、方便性、低公害、低成本的要求,各种各样的电子控制系统被开发了出来。由于这些系统之间通信所用的数据类型及对可靠性的要求不尽相同,由多条总线构成的情况很多,线束的数量也随之增加。为适应“减少线束的数量”、“通过多个LAN,进行大量数据的高速通信”的需要,CAN总线应运而生,图1为CAN总线在汽车中的应用图。</p><div class=pgc-img><img alt=CAN总线错误检测机制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/153016949864906bebe91d2><p class=pgc-img-caption></p></div><p>图1 汽车中CAN总线的应用</p><p>CAN的高性能和可靠性已被认同,并被广泛地应用于工业自动化、船舶、医疗设备、工业设备等方面。现场总线是当今自动化领域技术发展的热点之一,被誉为自动化领域的计算机局域网。图2为CAN总线网路图,它的出现为分布式控制系统实现各节点之间实时、可靠的数据通信提供了强而有力的技术支持。</p><div class=pgc-img><img alt=CAN总线错误检测机制 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/153016949894291e3df40c9><p class=pgc-img-caption></p></div><p>图2 CAN总线网路图</p><p>CAN总线作为可靠性非常高的总线,出错概率非常小,这也是它被广泛应用的原因之一。在CAN总线的实际研发中,相较于CAN总线的正确帧,工程师更关注CAN总线的错误帧,下面将为大家展现CANscope波形常见的几类错误,图3为干扰导致的CAN通讯错误。</p><div class=pgc-img><img alt=CAN总线错误检测机制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/153016949872766d7741ec6><p class=pgc-img-caption></p></div><p>图3 错误波形图</p><p>图4为终端电阻并联过多,差分电平幅值太小导致接收节点识别失败的错误。</p><div class=pgc-img><img alt=CAN总线错误检测机制 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/153016949866404dead1783><p class=pgc-img-caption></p></div><p>图4 错误波形图</p><p>图5为总线支线过长,电平下降沿台阶过高,导致位宽度失调的错误。</p><div class=pgc-img><img alt=CAN总线错误检测机制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1530169498676b1c2b0c278><p class=pgc-img-caption></p></div><p>图5 错误波形图</p><p>图6为卡车打开/关闭大灯时,耦合到CAN总线上的干扰,导致的错误。</p><div class=pgc-img><img alt=CAN总线错误检测机制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15301694987529a423a8ead><p class=pgc-img-caption></p></div><p>图6 错误波形图</p><p>图7为波特率异常(位宽度从2us突然变成1.6us),导致位错误。</p><div class=pgc-img><img alt=CAN总线错误检测机制 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/15301694994872a3df9f701><p class=pgc-img-caption></p></div><p>图7 错误波形图</p><p>CAN总线的错误都有哪些形式,相互之间有什么样的关系,以及总线的检测与校验的原理是什么?</p><p>CAN总线的错误帧可分为位错误、位填充错误、CRC错误、格式错误、应答错误五大类,每类错误的具体解释如图8所示,此图简洁明了的展现了各种错误。</p><div class=pgc-img><img alt=CAN总线错误检测机制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1530169499396c00ffd5031><p class=pgc-img-caption></p></div><p>图8 CAN总线错误类型</p><p>CAN报文传输过程中出现通讯错误,会发送错误帧,以上所述的错误帧类型中根据其错误标识符不同,可分为“主动错误”和“被动错误”。</p><p>主动错误:检测错误主动报错,发出错误标识符(连续6个显性位)和错误界定符(连续8个隐形位);目的在于“主动”通知错误,即使别的节点没有发现此错误;</p><p>被动错误:检测错误,被动等待其他节点报错后发送错误标识符(连续6个隐形位)和错误标识符(连续8个隐形位);目的在于识别错误,回应主动错误;</p><p>总线关闭:节点不参与总线通讯;</p><p>为了避免某个设备因为自身原因(例如硬件损坏)导致无法正常收发数据而不断地破坏数据帧,从而影响其他正常节点通讯,CAN-bus规范中规定每个CAN控制器都有一个发送错误计数器和一个接收错误计数器。根据计数值不同CAN节点会处于不同的设备状态,状态之间的转换关系如图9所示:</p><div class=pgc-img><img alt=CAN总线错误检测机制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/153016949955687cd507fbe><p class=pgc-img-caption></p></div><p>图9 错误转换图</p><p>接收、发送错误计数器对应的变动条件及数值变动情况:</p><p>● 接收单元检测出错误时,检测到错误标识符或过载标志的“位错误”除外,此时REC+1、TEC不变;</p><p>● 接收单元在发送完错误标志后检测到第一位为显性电平,此时REC+8、TEC不变;</p><p>●发送单元输出错误标志,此时REC不变、TEC+8;</p><p>●发送单元发送主动错误标志或过载标志,检测出位错误,REC不变、TEC+8;</p><p>●接收单元发送主动错误标志或过载标志,检测出位错误,REC+8、TEC不变;</p><p>●各单元从主动错误标志、过载标志的开始检测出连续14个显性位,之后每检测出连续8个显性位,发送时REC+8、接收时TEC+8;</p><p>●检测出被动错误标志后追加连续8个位的显性位,发送时REC+8、接收时TEC+8;</p><p>●发送单元正常接收数据结束时(返回ACK且到帧结束位检测到错误),REC不变、TEC-1;</p><p>●接收单元正常接收数据结束时(到CRC未检测出错误且正常返回ACK),REC&lt;127时,REC-1,REC>127时,REC=127;TEC不变;</p><p>●处于总线关闭的单元,检测到128次连续11个位的隐形位,错误计数器归零,REC、TEC=0;</p><p>CAN总线错误处理功能属于是链路层功能,此功能由CAN控制器决定,如图10所示CAN控制介绍图,其中详细介绍与错误处理有关的部分:位流处理器、位逻辑控制、错误管理逻辑。</p><p>●位流处理器(BSP)是一个控制发送缓冲器、接收FIFO和CAN总线之间数据流的程序装置,它还执行总线上的错误检测、仲载、总线填充和错误处理。</p><p>●位时序逻辑(BTL)监视串行的CAN总线和位时序,它在信息开头“弱势支配”的总线传输时,同步 CAN总线位流(硬同步),接收报文时再次同步下一次传送(软同步)。</p><p>●错误管理逻辑(EML)负责限制传输层模块的错误,它接收来自位流处理器的出错报告,然后把有关错误统计告诉位流处理器和接口管理逻辑(IML)。</p><div class=pgc-img><img alt=CAN总线错误检测机制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15301694998270d26c38ffa><p class=pgc-img-caption></p></div><p>图10 CAN控制器</p><p>CAN控制器的信号从CAN收发器的TXD发送到总线,同时被RXD收回进行检测,以此达到实时的接收错误检测、发送错误检测与ID仲裁功能。CAN总线是如何保证数据传输可靠性的,以下介绍CAN总线独有的检测机制:位流检测和CRC校验;</p><p>位流检测:即位检测,如图11所示节点在发送过程中,同时会监测自身发送的位数值,假如检测到位与自身送出的位数值不同,则会提示位错误;</p><div class=pgc-img><img alt=CAN总线错误检测机制 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15301694998435c4fa9b896><p class=pgc-img-caption></p></div><p>图11 位检测</p><p>CRC校验:即循环冗余校验码是数据通讯领域中最常用的一种差错校验码,其信息字段和校验字段的长度可任意选定;CRC校验过程是通过循环计算冗余校验码的方式实现的,CAN控制器内部CRC的实现是基于多项式发生器和一个15位寄存器;其意义在于保证传输数据的正确性,未经CRC校验检测出的错误低于10负九次方。</p><p>CANscope总线分析仪是一款综合性的CAN总线开发与测试的专业工具,集海量存储示波器、网络分析仪、误码率分析仪、协议分析仪及可靠性测试工具于一身,并把各种仪器有机的整合和关联,如图12所示CANscope的软件界面图;重新定义CAN总线的开发测试方法,可对CAN网络通讯正确性、可靠性、合理性进行多角度全方位的评估;帮助用户快速定位故障节点,解决CAN总线应用的各种问题,是CAN总线开发测试的终极工具。</p><div class=pgc-img><img alt=CAN总线错误检测机制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15301694993697cb5e52ff9><p class=pgc-img-caption></p></div><p>图12 CANscope软件界面</p><p><strong>(来源:电动汽车资源网EV江湖 ZLG致远电子)</strong></p><p>本文由电动汽车资源网【EV江湖】作者撰写,观点仅代表个人,不代表电动汽车资源网。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'总线','错误','检测'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>