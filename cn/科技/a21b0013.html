<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>SpringBoot切面Aop的demo简单讲解 | 极客快訊</title><meta property="og:title" content="SpringBoot切面Aop的demo简单讲解 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/ec7dea99ced1417b940a9ffe67dc81aa"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a21b0013.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a21b0013.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a21b0013.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a21b0013.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a21b0013.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a21b0013.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a21b0013.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a21b0013.html><meta property="article:published_time" content="2020-11-14T21:04:30+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:30+08:00"><meta name=Keywords content><meta name=description content="SpringBoot切面Aop的demo简单讲解"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/a21b0013.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>SpringBoot切面Aop的demo简单讲解</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>前言</p><p>本篇文章主要介绍的是SpringBoot切面Aop的demo简单讲解。</p><h2 class=pgc-h-arrow-right>SpringBoot Aop</h2><p><strong>说明：如果想直接获取工程那么可以直接跳到底部，通过链接下载工程代码。</strong></p><h3 class=pgc-h-arrow-right>切面(Aop)</h3><p><strong>一、概念</strong></p><blockquote><p>AOP（Aspect OrientedProgramming）：面向切面编程，面向切面编程（也叫面向方面编程），是目前软件开发中的一个热点，也是Spring框架中的一个重要内容。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</p></blockquote><p><strong>二、用途</strong></p><blockquote><p>日志记录，性能统计，安全控制，权限管理，事务处理，异常处理，资源池管理。</p></blockquote><p><strong>三、详解</strong></p><p>1.切面（Aspect）:官方的抽象定义为“一个关注点的模块化，这个关注点可能会横切多个对象”，在本例中，“切面”就是类TestAspect所关注的具体行为，例如：AServiceImpl.barA()的调用就是切面TestAspect所关注的行为之一。“切面”在ApplicationContext中aop:aspect来配置。</p><p>2.连接点（Joinpoint）:程序执行过程中的某一行为，例如，AServiceImpl.barA()的调用或者BServiceImpl.barB(String _msg, int _type)抛出异常等行为。</p><p>3.通知（Advice）:“切面”对于某个“连接点”所产生的动作，例如，TestAspect中对com.spring.service包下所有类的方法进行日志记录的动作就是一个Advice。其中，一个“切面”可以包含多个“Advice”，例如TestAspect。Advice共有如下5种类型：</p><ul><li>A 前置通知（Before advice） ：在某连接点（JoinPoint）之前执行的通知，但这个通知不能阻止连接点前的执行。xml中在aop:aspect里面使用aop:before元素进行声明；例如，TestAspect中的doBefore方法。注解中使用@Before声明；例如，TestAnnotationAspect中的doBefore方法。</li><li>B 后通知（After advice）：当某连接点退出的时候执行的通知（不论是正常返回还是异常退出）。xml中在aop:aspect里面使用aop:after元素进行声明。例如，TestAspect中的doAfter方法，所以AOPTest中调用BServiceImpl.barB抛出异常时，doAfter方法仍然执行。注解中使用@After声明。</li><li>C 返回后通知（After return advice）：在某连接点正常完成后执行的通知，不包括抛出异常的情况。xml中在aop:aspect里面使用元素进行声明。注解中使用@AfterReturning声明；</li><li>D 环绕通知（Around advice） ：包围一个连接点的通知，类似Web中Servlet规范中的Filter的doFilter方法。可以在方法的调用前后完成自定义的行为，也可以选择不执行。xml中在aop:aspect里面使用aop:around元素进行声明。例如，TestAspect中的doAround方法。注解中使用@Around声明。</li><li>E 抛出异常后通知（After throwing advice） ： 在方法抛出异常退出时执行的通知。xml中在aop:aspect里面使用aop:after-throwing元素进行声明。例如，TestAspect中的doThrowing方法。注解中使用@AfterThrowing声明。</li><li>通知执行顺序：前置通知→环绕通知连接点之前→连接点执行→环绕通知连接点之后→返回通知→后通知 →(如果发生异常)异常通知→后通知。</li></ul><p>4.切入点（Pointcut）匹配连接点的断言，在AOP中通知和一个切入点表达式关联。例如，TestAspect中的所有通知所关注的连接点，都由切入点表达式execution(* com.spring.service..(..))来决定。</p><p><strong>注:以上的理论知识参考:https://www.cnblogs.com/yepei/p/4735298.html</strong></p><h3 class=pgc-h-arrow-right>开发准备</h3><p><strong>环境要求</strong></p><p><strong>JDK</strong>：1.8</p><p><strong>SpringBoot</strong>：2.2.6.RELEASE</p><p>首先还是Maven的相关依赖，基本和普通springboot项目一样，就是多了spring-boot-starter-aop这jar的依赖。</p><p><strong>pom.xml</strong>文件如下:</p><pre><code>&lt;properties&gt;	&lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;	&lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;	&lt;java.version&gt;1.8&lt;/java.version&gt;	&lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;	&lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;&lt;/properties&gt;&lt;parent&gt;	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;	&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;	&lt;version&gt;2.2.6.RELEASE&lt;/version&gt;	&lt;relativePath/&gt;&lt;/parent&gt;&lt;dependencies&gt;	&lt;dependency&gt;		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;		&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;	&lt;/dependency&gt;	&lt;dependency&gt;		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;		&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;		&lt;scope&gt;test&lt;/scope&gt;	&lt;/dependency&gt;	&lt;dependency&gt;		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;		&lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;	&lt;/dependency&gt;	&lt;dependency&gt;		&lt;groupId&gt;com.alibaba&lt;/groupId&gt;		&lt;artifactId&gt;fastjson&lt;/artifactId&gt;		&lt;version&gt;1.2.68&lt;/version&gt;	&lt;/dependency&gt;     &lt;dependency&gt;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;        &lt;optional&gt;true&lt;/optional&gt;        &lt;scope&gt;test&lt;/scope&gt;	&lt;/dependency&gt;&lt;/dependencies&gt;</code></pre><p>application.properties的文件的配置:</p><pre><code>banner.charset=UTF-8server.tomcat.uri-encoding=UTF-8spring.http.encoding.charset=UTF-8spring.http.encoding.enabled=truespring.http.encoding.force=truespring.messages.encoding=UTF-8spring.application.name=springboot-aspectserver.port=8180</code></pre><h3 class=pgc-h-arrow-right>代码编写</h3><p>SpringBoot在使用切面的时候，只需要在自定义的一个切面类中加上 @Aspect 注解进行声明，然后在自定义切面的类方法中加上对应的注解即可。比如这里的示例我们想做一个请求响应的加解密切面处理，业务层只需关心代码逻辑实现，而不用关心请求参数和响应参数的加解密实现。那么首先我们需要自定义一个加解密的切面类，在该类添加@Aspect注解，然后在定义一个公共的切入点（Pointcut），指向需要处理的包，然后在定义一个前置通知(添加@Before注解)和后置通知(添加@AfterReturning)方法实现即可。</p><p>这里我们就将切入点设置为控制层包里所有的请求。</p><p><strong>切入点代码示例:</strong></p><pre><code>	 	 @Pointcut("execution(public * com.pancm.web.*.*(..))")  			  public void doOperation() {   		 }</code></pre><p>然后在定义一个前置通知，实现对请求参数的数据解密，这里我们就用User这个实体类的名称，对该数据进行解密。实际在运用是可以根据自身的情况来编写。</p><p><strong>前置通知代码示例:</strong></p><pre><code>	@Before("doOperation()")    public void before(JoinPoint joinPoint) throws Throwable{        Object[] objs = joinPoint.getArgs();        for (Object obj : objs) {            User user =(User) obj;            System.out.println("前置通知接受的参数:"+user);            String name =base64DeStr(user.getName());            user.setName(name);        }    }</code></pre><p>在编写完前置通知的方法之后，我们在编写后置通知的代码，这块基本和前置通知的一样，就是把返回的数据进行加密而已。</p><p><strong>后置通知代码示例:</strong></p><pre><code>    @AfterReturning(returning = "object", pointcut = "doOperation()")    public void doAfterReturning(Object object) {        ResultBody resultBody = (ResultBody) object;        String str =null;        try {             str=base64EnStr(resultBody.getResult());        } catch (UnsupportedEncodingException e) {            e.printStackTrace();        }        resultBody.setResult(str);        System.out.println("后通知响应的参数:"+resultBody);    }</code></pre><p><strong>完整代码示例:</strong></p><pre><code>@Aspect@Componentpublic class ParamAspect {    @Pointcut("execution(public * com.pancm.web.*.*(..))")    public void doOperation() {    }    @Before("doOperation()")    public void before(JoinPoint joinPoint) throws Throwable{        Object[] objs = joinPoint.getArgs();        for (Object obj : objs) {            User user =(User) obj;            System.out.println("前置通知接受的参数:"+user);            String name =base64DeStr(user.getName());            user.setName(name);        }    }    @AfterReturning(returning = "object", pointcut = "doOperation()")    public void doAfterReturning(Object object) {        ResultBody resultBody = (ResultBody) object;        String str =null;        try {             str=base64EnStr(resultBody.getResult());        } catch (UnsupportedEncodingException e) {            e.printStackTrace();        }        resultBody.setResult(str);        System.out.println("前置通知响应的参数:"+resultBody);    }    public  String base64EnStr(String str) throws UnsupportedEncodingException {        return Base64.getEncoder().encodeToString(str.getBytes("UTF-8"));    }    public static String base64DeStr(String encodeStr) throws UnsupportedEncodingException {        byte[] decodeStr = Base64.getDecoder().decode(encodeStr);        return new String(decodeStr, "UTF-8");    }</code></pre><p><strong>实体类代码</strong></p><pre><code>	public class User {				 private Long id;			 private String name;		 		 private Integer age;		 		//getter 和 setter 略			}</code></pre><p>控制层z这块的代码和普通的一样，我们这里只需简单的做下处理即可，这里为了方便理解，没有编写service层和dao的代码。:</p><p>** 控制层代码**</p><pre><code>@RestController@RequestMapping(value = "/api")public class UserRestController {    @GetMapping("/user")    public ResultBody findByUser(User  user) {        System.out.println("用户查询接口请求的参数:"+user);        ResultBody resultBody = new ResultBody();        List&lt;User&gt; userList =new ArrayList&lt;&gt;();        User user2=new User();        user2.setId(1L);        user2.setName("xuwujing");        user2.setAge(18);        userList.add(user2);        resultBody.setCode("0");        resultBody.setResult(userList.toString());        System.out.println("用户查询接口响应的参数:"+resultBody);        return resultBody;    }}</code></pre><p><strong>App 入口</strong></p><p>和普通的SpringBoot项目基本一样！</p><p><strong>代码如下:</strong></p><pre><code>	@SpringBootApplication	public class AspectApp	{	    public static void main( String[] args )	    {			SpringApplication.run(AspectApp.class, args);			System.out.println("Aspect启动成功！");	    }	}</code></pre><h3 class=pgc-h-arrow-right>功能测试</h3><p>编写完代码之后，我们启动程序，因为是Get请求，在浏览器或者使用Postman输入地址都可以进行测试，需要注意的是这里我们需要对name的值进行base64加密请求。</p><p>输入:</p><blockquote><p>http://localhost:8180/api/user?name=eHV3dWppbmc=</p></blockquote><p>控制台打印:</p><blockquote><p>前置通知接受的参数:{"name":"eHV3dWppbmc="}用户查询接口请求的参数:{"name":"xuwujing"}用户查询接口响应的参数:{"code":"0","result":"[{"age":18,"id":1,"name":"xuwujing"}]"}后通知响应的参数:{"code":"0","result":"W3siYWdlIjoxOCwiaWQiOjEsIm5hbWUiOiJ4dXd1amluZyJ9XQ=="}</p></blockquote><p>请求响应参数:</p><blockquote><p>{"code": "0","message": null,"result": "W3siYWdlIjoxOCwiaWQiOjEsIm5hbWUiOiJ4dXd1amluZyJ9XQ=="}</p></blockquote><p>示例图:</p><div class=pgc-img><img alt=SpringBoot切面Aop的demo简单讲解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ec7dea99ced1417b940a9ffe67dc81aa><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=SpringBoot切面Aop的demo简单讲解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e4d35229e4b84e94b349da1b586b82e2><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'SpringBoot','Aop','demo'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>