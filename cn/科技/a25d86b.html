<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>「asp.net core 系列」 属性路由的设置 | 极客快訊</title><meta property="og:title" content="「asp.net core 系列」 属性路由的设置 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/00a605c45f9d4b0a811158b81b2318b5"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a25d86b.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a25d86b.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a25d86b.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a25d86b.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a25d86b.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a25d86b.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a25d86b.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a25d86b.html><meta property="article:published_time" content="2020-10-29T20:50:18+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:18+08:00"><meta name=Keywords content><meta name=description content="「asp.net core 系列」 属性路由的设置"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/a25d86b.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>「asp.net core 系列」 属性路由的设置</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>0. 前言</h1><p>在之前我们介绍了请求通过路由寻找到控制器，以及控制器与视图的数据流转。那么，我们回过头来，再看看路由的一些其他用法。</p><h1 class=pgc-h-arrow-right>1. 路由属性（Route Attribute）</h1><p>按照英文的直接翻译，Routing Attribute 的意思是路由属性，但实际上 Attribute在微软的官方称呼是特性。嗯，所以个人觉得Route Attribute应该是特性路由，路由特性。</p><p>嗯，暂且甩开称呼的问题，小伙伴们知道这是一种使用Attribute标记的路由配置方案就行。我们之前了解的路由设置都是通过路由表设置的，而Route Attribute则是另外一种方案。</p><h2 class=pgc-h-arrow-right>1.1 如何设置</h2><p>这种方案主要是通过RouteAttribute类来设置的，我们先来看一下这个类是个什么样的吧：</p><pre><code>[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, AllowMultiple = true, Inherited = true)]public class RouteAttribute : Attribute, IRouteTemplateProvider{    public RouteAttribute(string template);    public string Name { get; set; }    public int Order { get; set; }    public string Template { get; }}</code></pre><p>AttributeUsage 这个特性是用来标注特性的适用范围的，其中AttributeTargets.Class | AttributeTargets.Method 表示这个特性是可以设置在类或者方法上的。AllMultiple表示是否允许设置多个，Inherited 表示被该特性标注的类其子类是否也自动继承了这个特性。</p><p>那么，我们了解了RouteAttribute的适用范围，继续看这个类，一共有三个属性：</p><ul><li>Name 表示这个路由特性的名称</li><li>Order 表示启用顺序，值越小，越先被匹配。默认情况下是0</li><li>Template 路由解析模板，也就是在《【asp.net core 系列】2 控制器与路由的恩怨情仇》中介绍的路由表的格式串</li></ul><p>介绍了这么多，我们先来试试看，先拿出来之前文章创建的MvcWeb项目，新建一个控制器：</p><pre><code>using Microsoft.AspNetCore.Mvc;namespace MvcWeb.Controllers{    public class RouteTestController: Controller    {        public IActionResult Index()        {            return View();        }    }}</code></pre><p>创建对应视图：</p><blockquote><p>Views > RouteTest > Index.cshtml</p></blockquote><p>在Index.cshtml中随便写点内容，然后保存。</p><p>然后，在RouteTestController 添加一个Route特性标记：</p><pre><code>[Route("/Route")]public IActionResult Index(){    return View();}</code></pre><p>启动项目，访问 http://localhost:5006/Route 后，如果不出意外可以看到跟下图类似的界面：</p><div class=pgc-img><img alt="「asp.net core 系列」 属性路由的设置" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/00a605c45f9d4b0a811158b81b2318b5><p class=pgc-img-caption></p></div><p>那么我们试一试通过路由表设置的路径是否可以访问：</p><pre><code>http://localhost:5006/RouteTest</code></pre><div class=pgc-img><img alt="「asp.net core 系列」 属性路由的设置" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/31c0e4e22e824c73bd808c210776541f><p class=pgc-img-caption></p></div><p>可以看到提示404，也就是说这个Action无法通过路由表的形式查找到了。</p><h2 class=pgc-h-arrow-right>1.2 设置参数</h2><p>我们知道所谓的Action其实也是一个方法，而我们通常请求一个网址的时候，网址中也带有一些查询参数。所以，这一节我们就介绍一下路由特性（属性路由）如何设置参数的解析吧。</p><h3 class=pgc-h-arrow-right>1.2.1 不做任何操作</h3><p>在RouteTestController里添加方法：</p><pre><code>[Route("/route/norest")]public IActionResult NoRest(string name){    ViewBag.Name = name;    return View();}</code></pre><p>创建对应的View：</p><pre><code>&lt;h1&gt;@ViewBag.Name&lt;/h1&gt;</code></pre><p>启动程序，并访问：http://localhost:5006/route/norest</p><div class=pgc-img><img alt="「asp.net core 系列」 属性路由的设置" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/438022bab9e448b0bdfa40ecaf2ec7f1><p class=pgc-img-caption></p></div><p>添加 ?name=test 在上一个请求的后面：</p><div class=pgc-img><img alt="「asp.net core 系列」 属性路由的设置" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6d3f4a1a59774cf6bf492f7460971104><p class=pgc-img-caption></p></div><p>尝试变更name的值，可以发现网页中的值也发生了变化，证明我们可以获取到这个值。</p><h3 class=pgc-h-arrow-right>1.2.2 当做请求目录的一部分</h3><p>在上一小节中，没有对参数做任何操作，以查询参数的形式传递。在这一篇，我们可以把参数设置为请求的一部分，像目录那样，修改上一节示例代码为：</p><pre><code>[Route("/route/norest/{name}/")]public IActionResult NoRest(string name){    ViewBag.Name = name;    return View();}</code></pre><p>请求方式：</p><pre><code>http://localhost:5006/route/norest/1232</code></pre><div class=pgc-img><img alt="「asp.net core 系列」 属性路由的设置" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8868dd9f1cd549f487a703100de716c5><p class=pgc-img-caption></p></div><p>修改连接中的1232 内容，然后刷新页面，就能发现页面中的值也发生了变化</p><h3 class=pgc-h-arrow-right>1.2.3 给参数一个默认值</h3><p>之前的设置里我们都默认参数由请求URL获取，那么在这里我们介绍一下给参数一个值：</p><pre><code>[Route("/route/norest/{name=demo}/")]public IActionResult NoRest(string name){    ViewBag.Name = name;    return View();}</code></pre><p>访问连接：</p><pre><code>http://localhost:5006/route/norest/</code></pre><p>可以看见：</p><div class=pgc-img><img alt="「asp.net core 系列」 属性路由的设置" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/e10778476eb44872bbce235a249f10fc><p class=pgc-img-caption></p></div><p>设置为可空，也就是参数可以不传：</p><pre><code>[Route("/route/norest/{name?}/")]public IActionResult NoRest(string name){    ViewBag.Name = name;    return View();}</code></pre><p>访问连接：</p><pre><code>http://localhost:5006/route/norest/</code></pre><p>可以看到页面没有任何显示：</p><div class=pgc-img><img alt="「asp.net core 系列」 属性路由的设置" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a62674610df14626be4f3bb2bf102ca8><p class=pgc-img-caption></p></div><p>正常情况下，如果不对参数设置可空而且参数被我们当做目录的一部分时，不给值是会提示404。</p><h2 class=pgc-h-arrow-right>1.3 路由约束</h2><p><br></p><div class=pgc-img><img alt="「asp.net core 系列」 属性路由的设置" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15fa45703b15471b8876640097e400e8><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right>2. 路由统一前缀</h1><p>在第一节中，我们介绍了如何使用RouteAttribute为控制器里的方法标记路由信息。有时候会出现这样的一个问题，一个控制器方法里可能会出现多个方法（Action）。通常情况下，我们要求一个控制器处理的请求应当有一个统一的前缀（或者称之为URL目录）。</p><p>那么，这种情况我们仍然继续使用 RouteAttribute，不过与之前不同的是，这次直接在控制器类上标记：</p><pre><code>[Route("/Route")]public class RouteCtrTestController: Controller{}</code></pre><p>这时候，在方法上如果添加了RouteAttribute，设置的路由信息如果不是以/ 开始，则会将该Action的路由配置加到Controller后面。如果是以/ 开始，则表示该路由是根路由。</p><p>如果没有设置RouteAttribute，则表示当前方法是处理控制器配置的路由的方法。</p><p>如果一个控制器里出现多个未设置RouteAttribute，则会出错。</p><p>示例代码如下：</p><pre><code>[Route("/Route")]public class RouteCtrTestController: Controller{    public int temp{get;set;}    public IActionResult Index(int temp)    {        return Content($"你好{temp}");    }    [Route("Demo")]    public IActionResult Demo()    {        return Content($"你好 Demo");    }}</code></pre><h1 class=pgc-h-arrow-right>2. 总结</h1><p>今天的内容比较短，这里介绍了一些路由的另一种用法，小伙伴们对此有个了解就可以了。下一篇将会到视图，开始准备带领大家做一个小项目啦。</p><blockquote><p>求关注，求点赞，求转发~~有啥可以评论哟</p></blockquote></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'asp','net','core'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>