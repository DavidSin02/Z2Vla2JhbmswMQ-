<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>为深度学习模型加载自定义图像数据集 | 极客快訊</title><meta property="og:title" content="为深度学习模型加载自定义图像数据集 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/2688ec63f94347f59c16e136741e70df"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a677c055.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a677c055.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a677c055.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a677c055.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a677c055.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a677c055.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a677c055.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a677c055.html><meta property="article:published_time" content="2020-11-14T21:02:25+08:00"><meta property="article:modified_time" content="2020-11-14T21:02:25+08:00"><meta name=Keywords content><meta name=description content="为深度学习模型加载自定义图像数据集"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/a677c055.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>为深度学习模型加载自定义图像数据集</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>在本文中，你将学习如何加载自定义数据和创建图像序列和测试数据集，作为深度学习模型的输入。</p><ul><li><strong>Open CV2</strong></li><li><strong>PIL</strong></li></ul><p>这里使用的数据集是来自Kaggle的Intel图像分类。</p><p>数据集链接：https://www.kaggle.com/puneet6060/intel-image-classification/version/2</p><p>“Intel图像分类”数据集已分为train、test和Val，我们将仅使用训练数据集学习如何使用不同的库加载数据集。</p><p><strong>为深度学习模型加载自定义数据集的典型步骤</strong></p><ol start=1><li>打开图像文件。文件的格式可以是JPEG、PNG、BMP等。</li><li>调整图像大小以匹配深度学习模型的输入层的输入大小。</li><li>将图像像素转换为浮点数据类型。</li><li>将图像标准化，使像素值在0到1之间。</li><li>深度学习模型的图像数据应该是一个numpy数组或一个张量对象。</li></ol><p><strong>自定义图像数据的文件夹结构</strong></p><div class=pgc-img><img alt=为深度学习模型加载自定义图像数据集 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2688ec63f94347f59c16e136741e70df><p class=pgc-img-caption></p></div><p>每个类都是一个文件夹，其中包含该特定类的图像。</p><p><strong>使用CV2加载图像数据</strong></p><p>导入所需的库</p><pre><code>import pandas as pdimport numpy as npimport osimport tensorflow as tfimport cv2from tensorflow import kerasfrom tensorflow.keras import layers, Dense, Input, InputLayer, Flattenfrom tensorflow.keras.models import Sequential, Modelfrom  matplotlib import pyplot as pltimport matplotlib.image as mpimg%matplotlib inline</code></pre><p>从其中一个文件夹中随机输出五张图像</p><pre><code>plt.figure(figsize=(20,20))test_folder=r'CV\Intel_Images\seg_train\seg_train\forest'for i in range(5):    file = random.choice(os.listdir(img_folder))    image_path= os.path.join(img_folder, file)    img=mpimg.imread(image_path)    ax=plt.subplot(1,5,i+1)    ax.title.set_text(file)    plt.imshow(img)</code></pre><div class=pgc-img><img alt=为深度学习模型加载自定义图像数据集 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/51ad21736fcc48d6986bf0801e22296b><p class=pgc-img-caption></p></div><p><strong>设置用于加载数据集的图像维度和源文件夹</strong></p><pre><code>IMG_WIDTH=200IMG_HEIGHT=200img_folder=r'CV\Intel_Images\seg_train\seg_train\'</code></pre><p><strong>从文件夹中的图像创建图像数据和标签</strong></p><p>在下面的函数中</p><ul><li>source文件夹是包含不同类的图像的输入参数。</li><li>从文件夹中读取图像文件并将其转换为正确的颜色格式。</li><li>根据模型所需的输入尺寸调整图像大小</li><li>将图像转换为数据类型为float32的Numpy数组</li><li>将图像数组标准化，使值在0和1之间，这有助于更快地收敛。</li></ul><pre><code>def create_dataset(img_folder):    img_data_array=[]    class_name=[]    for dir1 in os.listdir(img_folder):        for file in os.listdir(os.path.join(img_folder, dir1)):            image_path= os.path.join(img_folder, dir1,  file)            image= cv2.imread( image_path, cv2.COLOR_BGR2RGB)            image=cv2.resize(image, (IMG_HEIGHT, IMG_WIDTH),interpolation = cv2.INTER_AREA)            image=np.array(image)            image = image.astype('float32')            image /= 255             img_data_array.append(image)            class_name.append(dir1)    return img_data_array, class_name# extract the image array and class nameimg_data, class_name =create_dataset(r'CV\Intel_Images\seg_train\seg_train')</code></pre><p><strong>将文本标签转换为数字编码</strong></p><p>为类的所有唯一值创建字典</p><pre><code>target_dict={k: v for v, k in enumerate(np.unique(class_name))}target_dict</code></pre><div class=pgc-img><img alt=为深度学习模型加载自定义图像数据集 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c54974e6b37a460b97cc1bfd25c91db8><p class=pgc-img-caption></p></div><p>根据字典将类名称转换为各自的数值</p><pre><code>target_val=  [target_dict[class_name[i]] for i in range(len(class_name))]</code></pre><p>创建一个简单的深度学习模型并编译它</p><pre><code>model=tf.keras.Sequential(        [            tf.keras.layers.InputLayer(input_shape=(IMG_HEIGHT,IMG_WIDTH, 3)),            tf.keras.layers.Conv2D(filters=32, kernel_size=3, strides=(2, 2), activation='relu'),            tf.keras.layers.Conv2D(filters=64, kernel_size=3, strides=(2, 2), activation='relu'),            tf.keras.layers.Flatten(),            tf.keras.layers.Dense(6)        ])encoder.compile(optimizer='rmsprop', loss='sparse_categorical_crossentropy', metrics=['accuracy'])</code></pre><p>我们最终调整数据集来训练模型。我们可以使用Numpy数组作为输入</p><pre><code>history = model.fit(x=np.array(img_data, np.float32), y=np.array(list(map(int,target_val)), np.float32), epochs=5)</code></pre><p>我们还可以使用tf.cast()将输入数据转换为张量来训练模型。</p><pre><code>history = model.fit(x=tf.cast(np.array(img_data), tf.float64), y=tf.cast(list(map(int,target_val)),tf.int32), epochs=5)</code></pre><p>我们使用不同的库加载图像数据集但是我们使用相同的模型来进行进一步的训练</p><h1 class=pgc-h-arrow-right>用PIL加载图像数据</h1><p>添加附加库以使用PIL加载图像数据集</p><pre><code>from PIL import Image</code></pre><p>使用PIL从文件夹中的图像创建图像数据和标签</p><p>在下面的函数中</p><ul><li>source文件夹是包含不同类的图像的输入参数。</li><li>使用PIL从文件夹中打开图像文件。</li><li>根据模型所需的输入尺寸调整图像大小</li><li>将图像转换为数据类型为float32的Numpy数组</li><li>标准化图像数组以加快收敛。</li></ul><pre><code>def create_dataset_PIL(img_folder):    img_data_array=[]    class_name=[]    for dir1 in os.listdir(img_folder):        for file in os.listdir(os.path.join(img_folder, dir1)):            image_path= os.path.join(img_folder, dir1,  file)            image= np.array(Image.open(image_path))            image= np.resize(image,(IMG_HEIGHT,IMG_WIDTH,3))            image = image.astype('float32')            image /= 255              img_data_array.append(image)            class_name.append(dir1)    return img_data_array , class_namePIL_img_data, class_name=create_dataset_PIL(img_folder)</code></pre><p><strong>将文本标签转换为数字编码</strong></p><p>下面是我们在CV2中使用的代码</p><pre><code>target_dict={k: v for v, k in enumerate(np.unique(class_name))}target_val=  [target_dict[class_name[i]] for i in range(len(class_name))]</code></pre><p>创建和编译一个简单的深度学习模型</p><pre><code>model=tf.keras.Sequential(        [            tf.keras.layers.InputLayer(input_shape=(IMG_HEIGHT,IMG_WIDTH, 3)),            tf.keras.layers.Conv2D(filters=32, kernel_size=3, strides=(2, 2), activation='relu'),            tf.keras.layers.Conv2D(filters=64, kernel_size=3, strides=(2, 2), activation='relu'),            tf.keras.layers.Flatten(),            tf.keras.layers.Dense(6)        ])encoder.compile(optimizer='rmsprop', loss='sparse_categorical_crossentropy', metrics=['accuracy'])</code></pre><p>我们最终调整数据集来训练模型。我们可以使用Numpy数组作为输入</p><pre><code>history = model.fit(x=np.array(PIL_img_data, np.float32), y=np.array(list(map(int,target_val)), np.float32), epochs=5)</code></pre><p>我们还可以使用tf.cast()将输入数据转换为张量来训练模型。</p><pre><code>history = model.fit(x=tf.cast(np.array(PIL_img_data), tf.float64), y=tf.cast(list(map(int,target_val)),tf.int32), epochs=5)</code></pre><p>除了几个步骤外，使用CV2和PIL加载数据集的过程是相同的。</p><p>现在这将帮助你使用CV2和PIL库加载数据集。</p><p>这里提供了使用CV2和PIL加载数据集的代码：https://github.com/arshren/Load_Dataset</p><p>在下一篇文章中，我们将使用以下的库来加载数据集。</p><ul><li><strong>Keras</strong></li><li><strong>tf.data</strong></li></ul></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'学习','加载','义图'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>