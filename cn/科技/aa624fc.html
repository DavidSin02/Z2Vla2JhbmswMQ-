<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>实战PyQt5: 083-图形视图框架中的座标系 | 极客快訊</title><meta property="og:title" content="实战PyQt5: 083-图形视图框架中的座标系 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/dfic-imagehandler/7bc25041-b0ce-4386-8420-22b162e122af"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/aa624fc.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/aa624fc.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/aa624fc.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/aa624fc.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/aa624fc.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/aa624fc.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/aa624fc.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/aa624fc.html><meta property="article:published_time" content="2020-10-29T20:58:37+08:00"><meta property="article:modified_time" content="2020-10-29T20:58:37+08:00"><meta name=Keywords content><meta name=description content="实战PyQt5: 083-图形视图框架中的座标系"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/aa624fc.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>实战PyQt5: 083-图形视图框架中的座标系</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div class=pgc-img><img alt="实战PyQt5: 083-图形视图框架中的座标系" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/7bc25041-b0ce-4386-8420-22b162e122af><p class=pgc-img-caption></p></div><p>图形视图基于笛卡尔座标系，图元在场景中的位置和几何形状由x座标和y座标两个数字表示。使用未做变换的视图观察场景时，场景中的一个单位等于屏幕上的一个像素。</p><p>注意：“图形视图”使用Qt的座标系，因此不支持反转的Y轴座标系（向上增长）。</p><p>图形视图中有三个有效的座标系在起作用：图元座标，场景座标和视图座标。为了简化实现，“图形视图”提供了方便的函数，允许在三个座标系之间进行映射。渲染时，图形视图的场景座标对应于QPainter的逻辑座标，视图座标与设备座标相同。</p><div class=pgc-img><img alt="实战PyQt5: 083-图形视图框架中的座标系" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/b30c5aeffe474c4da9e0df8e85b85ab1><p class=pgc-img-caption>图片来源(doc.qt.io)</p></div><h1 class=pgc-h-arrow-right>图元(Item)座标</h1><p>图元位于它们自己的座标系中。它的座标都以点(0,0)为中心点，这也是所有变换的中心点。在图元座标系中的几何图元，经常被称为图元点，图元线，图元矩形。</p><p>当创建一个自定义的图元时,必须考虑图元的座标。QGraphicsScene与QGraphicsView可以执行所有转换，这使得实现自定义的图元变得容易。例如，假如收到鼠标按下或是拖动输入事件，事件的位置以图元座标的形式给出。当某个点的位置在指定的图元内时，QGraphicsItem.contain()返回True,否则返回False。这个点参数使用图元座标，相似地，图元的边界矩形与形状也使用图元座标。</p><p>图元位置指的是图元的中心点在其父亲的座标系中的座标，有时称其为父座标。从这个意义上说，场景被视为所有无父亲图元的‘父图元’，因此顶层的图元位置就是在在场景座标中的位置。</p><p>子座标是相对于父座标的，假如子图元未经变换，则子座标与父座标之间的差值等于在父座标系下，父图元与子图元之间的距离。例如，假如一个未经变换的子图元位置与其父图元的中心重合，那么这两个图元的座标系统完全相同。如果子图元的位置是（10，0），那么子图元座标系中的(0,10)点，对应于父座标系中的（10，10）点。</p><p>因为图元的位置与变换是相对于父图元的，子图元的座标不会被父亲的变换影响，尽管父图元的变换隐含地对子图元做了变换。在上面的例子中，即使父图元旋转，缩放，子图元的(0,10)点依然对应于父图元的(10,10)点。然而，相对于场景来讲，子图元会遵循父图元的变换。假如父图元被缩放(2X,2X),子图元 的位置在场景中的座标是（20，0），它的（10，0）点则与场景中的（40，0）对应 。</p><p>除QGraphicsItem.pos()函数以外，QGraphicsItem的函数在图元座标中操作，例如一个图元的边界矩形总是以图元座标的形式给出。</p><h1 class=pgc-h-arrow-right>场景(Scene)座标</h1><p>场景代表所有图元的基本座标系,场景座标系统描述了每个最顶级图元的位置，也是从视图向场景传递所有场景事件的基础。场景中的每个图元有场景位置与边界矩形（QGraphicsItem::scenePos(),QGraphicsItem::sceneBoundingRect()), 另外，它有自己本地图元位置与边界矩形。场景位置描述了图元在场景座标下的位置，它的场景边界矩形则用于QGraphicsScene决定场景中哪块区域发生了变化。场景中的变化通过QGraphicsScene.changed()信号来通知，它的参数是场景矩形列表。</p><h1 class=pgc-h-arrow-right>视图(View)座标</h1><p>视图座标是部件的座标，视图座标中每个单位对应一个像素。这种座标的特殊之处在于它是相对于部件或是视口的，不会被所观察的场景所影响。QGraphicsView的视口的左上角总是（0，0），右下角总是(视口宽，视口高）。所有鼠标事件和拖放事件最初都是作为视图座标接收的，因此需要将这些座标映射到场景座标以便与图元进行交互。</p><h1 class=pgc-h-arrow-right>座标映射</h1><p>通常在处理场景中的图元时，要在场景与图元之间，图元与图元之间，视图与场景之间进行座标映射。举例来讲，当在QGraphicsView的视口中点击鼠标时，应该通过调用QGraphicsView.mapToScence()与QGraphicsScene.itemAt()来获知光标下是场景中的哪个图元。假如想获知一个图元位于视口中的什么位置，应该先在图元上调用QGraphicsItem.mapToScene(), 然后调用QGraphicsView.mapFromScene()。最后，假如想知道在一个椭圆中有哪些图元,则可以将QPainterPath传递到mapToScene(),然后再把映射后的路径传递给QGraphicsScene.items()。</p><h1 class=pgc-h-arrow-right>演示代码</h1><p>使用多种颜色绘制螺旋线，操作下方的滑动条，可旋转这个彩色的螺旋线。完整代码如下:</p><pre><code>import sys,mathfrom PyQt5 import QtCore, QtGui, QtWidgetsfrom PyQt5.QtCore import Qt, QPointFfrom PyQt5.QtGui import QPen, QBrush, QFont, QTransformfrom PyQt5.QtWidgets import (QApplication, QWidget, QGraphicsScene, QGraphicsView,                             QVBoxLayout, QSlider, QGraphicsLineItem) class DemoGvCoordinate(QWidget):    def __init__(self, parent=None):        super(DemoGvCoordinate, self).__init__(parent)                   # 设置窗口标题        self.setWindowTitle('实战PyQt5: Graphics View 框架座标系统演示')              # 设置窗口大小        self.resize(480, 480)              self.initUi()            def initUi(self):        #场景部分        scene = QGraphicsScene()                        scene.setBackgroundBrush(QBrush(Qt.black))                #绘制螺旋线        colors=[Qt.red, Qt.darkMagenta, Qt.blue, Qt.green, Qt.yellow, Qt.darkCyan]        x0 = 0        y0 = 0        ratio = 0.35        deg = 59 * math.pi / 180        for i in range (360):            line = QGraphicsLineItem()            line.setPen(QPen(colors[i%6]))            x1 = x0 + i * ratio * math.cos(i * deg)            y1 = y0 + i * ratio * math.sin(i * deg)            line.setLine(x0, y0, x1, y1)            scene.addItem(line)            x0 = x1            y0 = y1                      self.view = QGraphicsView()        self.view.setScene(scene)                #滑动条        slider = QSlider(Qt.Horizontal, self)        slider.setRange(-360, 360)        slider.setPageStep(10)        slider.setValue(0)        slider.valueChanged.connect(self.onRotateValueChanged)                layout = QVBoxLayout()        layout.addWidget(self.view)        layout.addWidget(slider)                self.setLayout(layout)        def onRotateValueChanged(self, value):        #是个累积效应，先对变化矩阵进行复位操作        self.view.setTransform(QTransform())        self.view.rotate(value)    if __name__ == '__main__':    app = QApplication(sys.argv)    window = DemoGvCoordinate()    window.show()    sys.exit(app.exec()) </code></pre><p>运行结果如下图：</p><div class=pgc-img><img alt="实战PyQt5: 083-图形视图框架中的座标系" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/22f453cac16748519f0ffb95352abd9f><p class=pgc-img-caption>测试Graphics View框架中的座标系</p></div><h1 class=pgc-h-arrow-right>本文知识点</h1><ul><li>图形视图基于笛卡尔座标系；</li><li>场景座标，视图座标和图元座标；</li><li>场景座标，视图座标，图元座标之间的映射关系；</li><li>螺旋线的绘制方法。</li></ul><hr><p><strong>喜欢本文内容就关注, 收藏，点赞，评论和转发。</strong></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'实战','PyQt5','083'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>