<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>物联网平台开发浅析和实战（二） | 极客快訊</title><meta property="og:title" content="物联网平台开发浅析和实战（二） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/3e8b4b8b8ebd498b81b2057ac76ddd1b"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/aa8360e3.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/aa8360e3.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/aa8360e3.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/aa8360e3.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/aa8360e3.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/aa8360e3.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/aa8360e3.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/aa8360e3.html><meta property="article:published_time" content="2020-11-14T21:00:22+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:22+08:00"><meta name=Keywords content><meta name=description content="物联网平台开发浅析和实战（二）"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/aa8360e3.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>物联网平台开发浅析和实战（二）</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><strong><span style="color:#73777a;--tt-darkmode-color: #73777A"><span style="background-color:#f9f9f9;--tt-darkmode-bgcolor: #181818">简介：</span></span></strong><span style="color:#73777a;--tt-darkmode-color: #73777A"><span style="background-color:#f9f9f9;--tt-darkmode-bgcolor: #181818"> 物联网平台使用教程，包括云产品流转和服务端订阅。</span></span></p><h1 class=pgc-h-arrow-right>1、前言</h1><p>内容：物联网平台消息流转，包括云产品流转和服务端订阅 官网地址<br>时长：建议学习时长整体50分钟，理论40分钟，实战10分钟<br>代码：设备端demo、服务端demo<br>约定：${productKey}、${deviceName}是占位符，意思是设备自己的 productKey 和 deviceName<br>导航：上一课 下一课待续</p><p><strong>上节课程遗留了一些问题</strong><br>• 设备通过物联网平台上报了消息，那么消息如何展示到我的网页上呢？<br>• 设备只能往自己的topic发送消息，那么设备A如何发送消息给设备B呢？<br>以上场景可以使用我们的规则引擎来解决。</p><h1 class=pgc-h-arrow-right>2、规则引擎是什么、能干什么</h1><p>规则引擎是物联网平台的一个重要功能组件，包含云产品流转和服务端订阅两个主要功能。云产品流转是物联网平台把收到的消息流转到阿里云的云产品，包括把消息流转回物联网平台（消息从一个Topic流转到另一个Topic）。服务端订阅是物联网平台把设备上报的消息直接推送到用户的业务服务器。如果说物联网平台是设备数据上云的重要门户，那么规则引擎就是数据进门后云游世界的摆渡车。</p><div class=pgc-img><img alt=物联网平台开发浅析和实战（二） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3e8b4b8b8ebd498b81b2057ac76ddd1b><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>3、云产品流转</h1><h1 class=pgc-h-arrow-right>3.1、消息展示到网页</h1><p>正常情况下用户有自己的业务系统，业务系统从数据库获取到数据然后展示到网页。这个过程是大家都熟悉的。那么设备上报的数据如何展示到已有的业务系统网页呢？可以通过规则引擎把设备上报的数据流转到阿里云数据库RDS，然后业务系统从数据库获取数据展示到网页。这个就是规则引擎云产品流转的能力。对业务系统而言，基本没有改变任何逻辑，就是换了个数据源。</p><p>本例将完成如下步骤，涉及的demo代码包通过课程【前言】提供的链接下载即可。开发环境的搭建不再赘述，是普通 maven 工程。<br>设备端代码：com.aliyun.alink.demo.devicesdk.chapter02.DeviceA<br>• 创建一个规则，名为：一个Hello规则<br>• 创建一个动作，流转到RDS<br>• 启动规则<br>• 使用设备端SDK让设备 device_0 上线并发送消息给物联网平台<br>• 规则引擎将消息流转到阿里云RDS存储</p><h1 class=pgc-h-arrow-right>2.1.1、创建规则</h1><div class=pgc-img><img alt=物联网平台开发浅析和实战（二） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/473d3ff1bad84bdf94b24090fad009eb><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>2.1.2、创建动作</h1><p>本例数据库表为 tbl_rule_to_rds，已经创建好，表结构如下</p><div class=pgc-img><img alt=物联网平台开发浅析和实战（二） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1973c55e351b43278674a9ee1a407c86><p class=pgc-img-caption></p></div><p><br>创建动作，官网文档：https://help.aliyun.com/document_detail/42736.html</p><div class=pgc-img><img alt=物联网平台开发浅析和实战（二） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/11b224c94e4f441b8f6fd13715a9a140><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>2.1.3、启动规则</h1><div class=pgc-img><img alt=物联网平台开发浅析和实战（二） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9fcf257d32034a21b0c8993a386655a8><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>2.1.4、设备上报</h1><p>还记得上一节课设备消息上报的demo么，类似的，启动：com.aliyun.alink.demo.devicesdk.chapter02.DeviceA，填写设备device_0的三元组信息后直接启动。设备端调用publish接口上报消息，本例发送的topic=/${productKey}/${deviceName}/user/update，消息内容为 {"content":"hello iot"}。<br>几个关键的对应关系：<br>• 设备上报的消息格式为json，<strong>创建规则</strong>时“数据格式”选择为JSON。<br>• 设备上报的topic=/${productKey}/${deviceName}/user/update，<strong>创建规则</strong>时 sql 配置的 topic=/${productKey}/+/user/update。<br>• 数据库表格字段为messgeContent，<strong>创建动作</strong>时“键”填写为messgeContent。<br>• 设备上报的消息内容为{"<strong>content</strong>":"hello iot"}，创建动作时“键”对应的“值”填写为${content}。</p><h1 class=pgc-h-arrow-right>2.1.5、结果展示</h1><p>日志服务能够看到数据从设备到云，再通过规则引擎到rds。<br>traceId=0a3027ec15993912862926564d098c</p><div class=pgc-img><img alt=物联网平台开发浅析和实战（二） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/22f5ff6fcd934780afa9f426042e97ca><p class=pgc-img-caption></p></div><p><br>数据库查询可以看到上面发送的消息，hello iot 已经插入到数据库表中。</p><div class=pgc-img><img alt=物联网平台开发浅析和实战（二） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/31ea158fa1c9478f9dfee037758b7632><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>3.2、设备A发送消息给设备B</h1><p>设备只能订阅自己的topic，也只能给自己的topic发送消息。那么设备A的消息想要发送给设备B，该怎么办？可以通过规则引擎把设备A上报的数据流转到设备B。这个也是规则引擎云产品流转的能力，只是这个流转是物联网平台流转到物联网平台，消息从一个Topic流转到另一个Topic。<br>本例将完成如下步骤，涉及的demo代码包通过课程【前言】提供的链接下载即可。开发环境的搭建不再赘述，是普通 maven 工程。<br>设备端代码：com.aliyun.alink.demo.devicesdk.chapter02.DeviceA 和 com.aliyun.alink.demo.devicesdk.chapter02.DeviceB<br>• 创建一个设备，名为：device_1<br>• 在同样的规则下，再创建一个动作，流转到另一个Topic<br>• 使用设备端SDK让设备 device_1 上线<br>• 使用设备端SDK让设备 device_0 上线并发送消息给物联网平台</p><h1 class=pgc-h-arrow-right>3.2.1、创建动作</h1><p>沿用上面的规则，我们增加一个动作。规则不用重新启动。</p><div class=pgc-img><img alt=物联网平台开发浅析和实战（二） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2330fc31acc945ce95f340f76db07de4><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>3.2.2、设备B准备</h1><p>启动：com.aliyun.alink.demo.devicesdk.chapter02.DeviceB，填写设备 device_1 的三元组信息后直接启动。<br>设备需要订阅/${productKey}/${deviceName}/user/get。</p><h1 class=pgc-h-arrow-right>3.2.3、设备A上报</h1><p>启动：com.aliyun.alink.demo.devicesdk.chapter02.DeviceA，填写设备 device_0 的三元组信息后直接启动。设备上报的topic是 /${productKey}/${deviceName}/user/update，设备上报的消息是 {"content":"hello iot"}。<br>几个关键的对应关系：<br>• 设备上报的消息格式为json，<strong>创建规则</strong>时“数据格式”选择为JSON。<br>• 设备上报的topic=/${productKey}/${deviceName}/user/update，<strong>创建规则</strong>时 sql 配置的 topic=/${productKey}/+/user/update。<br>• 流转到另一个topic=/${productKey}/${deviceName}/user/get，设备B需要提前订阅好这个topic。</p><h1 class=pgc-h-arrow-right>3.2.4、结果展示</h1><p>日志服务能够看到消息从设备device_0到物联网平台，再通过规则引擎republish，从物联网平台到了另一个设备device_1。<br>traceId=0a3032ac15993925119167862d3bc9</p><div class=pgc-img><img alt=物联网平台开发浅析和实战（二） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/328423f8a42845db92bca5225c66af86><p class=pgc-img-caption></p></div><p><br>同时，device_1 是可以收到物联网平台转发的消息的。</p><div class=pgc-img><img alt=物联网平台开发浅析和实战（二） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5b4713e49f084cab8dde11e038b4f4df><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>3.3、云产品流转高阶能力</h1><p>云产品流转还有许多高阶能力，这里就不一一讲述了。<br>• 函数，官网文档：https://help.aliyun.com/document_detail/30555.html<br>• 容灾，官网文档：https://help.aliyun.com/document_detail/42733.html</p><h1 class=pgc-h-arrow-right>4、服务端订阅</h1><p>服务端可以直接订阅产品下所有类型的消息：设备上报消息、设备状态变化通知、设备生命周期变更、物模型历史数据上报、固件升级状态通知。配置服务端订阅后，物联网平台会将产品下所有设备的已订阅类型的消息转发至您的服务器。</p><div class=pgc-img><img alt=物联网平台开发浅析和实战（二） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/60471e940c394178b75519fe0e390441><p class=pgc-img-caption></p></div><p><br>本例将完成如下步骤，涉及的demo代码包通过课程【前言】提供的链接下载即可。开发环境的搭建不再赘述，是普通 maven 工程。<br>设备端代码：com.aliyun.alink.demo.devicesdk.chapter02.DeviceA<br>服务端代码：com.aliyun.alink.demo.openapi.chapter02.AmqpJavaClientDemo<br>• 创建一个服务端订阅<br>• 启动服务端订阅客户端<br>• 使用设备端SDK让设备 device_0 上线并发送消息给物联网平台<br>• 服务端订阅客户端可以接收到消息</p><h1 class=pgc-h-arrow-right>4.1、创建服务端订阅</h1><p>官网文档：https://help.aliyun.com/document_detail/142376.html</p><div class=pgc-img><img alt=物联网平台开发浅析和实战（二） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e8f014769c8c4f94b98e0cf3cc908b61><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>4.2、启动服务端订阅客户端</h1><p>启动：com.aliyun.alink.demo.openapi.chapter02.AmqpJavaClientDemo，填写必要信息。</p><h1 class=pgc-h-arrow-right>4.3、设备上报消息</h1><p>启动：com.aliyun.alink.demo.devicesdk.chapter02.DeviceA，填写设备 device_0 的三元组信息后直接启动。<br>设备上报的topic是 /${productKey}/${deviceName}/user/update<br>设备上报的消息是 {"content":"hello iot"}</p><h1 class=pgc-h-arrow-right>4.4、结果展示</h1><p>服务端订阅客户端可以接收到设备上线、设备上报、设备离线三条消息。</p><div class=pgc-img><img alt=物联网平台开发浅析和实战（二） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/abd5372d00b142efae545d65832f7db2><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>5、云产品流转 vs 服务端订阅</h1><div class=pgc-img><img alt=物联网平台开发浅析和实战（二） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7ba54ed16b1c44c8b4a636b1c89d20bb><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>6、总结</h1><p>上节课讲解了设备消息的上报（绿色线路），本节课讲解了用户业务系统如何获取到设备上报的消息（蓝色线路云产品流转、黄色线路服务端订阅），业务系统获取到设备消息后就可以进行数据的处理和展示。</p><div class=pgc-img><img alt=物联网平台开发浅析和实战（二） onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/10ebff319e814a16bc4c07b2d52335f7><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>7、后续</h1><p>目前为止，对用户设备和业务系统来说，物联网平台就是一个消息的中转站，但事实上物联网平台远不止消息中转站的功能，下节课将讲解物联网平台的高阶能力 -- 设备管理。</p><h1 class=pgc-h-arrow-right>8、思考题</h1><p>规则引擎是否可以流转 Open API 下发的消息？服务端订阅呢？</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'物联','网平','开发'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../cn/%E7%A7%91%E6%8A%80/4229d006.html alt=物联网平台开发难学吗？掌握ESP32帮你1分钟入门 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/S1wjiRNGzTjXG9 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/4229d006.html title=物联网平台开发难学吗？掌握ESP32帮你1分钟入门>物联网平台开发难学吗？掌握ESP32帮你1分钟入门</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/aef64093.html alt=物联网平台开发浅析和实战（一） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5164eced74e949afa8e4e3b705315e33 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/aef64093.html title=物联网平台开发浅析和实战（一）>物联网平台开发浅析和实战（一）</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>