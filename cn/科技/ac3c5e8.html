<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>详解单片机中的串行口 | 极客快訊</title><meta property="og:title" content="详解单片机中的串行口 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/a09e76ad9f61422b818f546c70863531"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ac3c5e8.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ac3c5e8.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ac3c5e8.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ac3c5e8.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ac3c5e8.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ac3c5e8.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ac3c5e8.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ac3c5e8.html><meta property="article:published_time" content="2020-10-29T21:05:51+08:00"><meta property="article:modified_time" content="2020-10-29T21:05:51+08:00"><meta name=Keywords content><meta name=description content="详解单片机中的串行口"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/ac3c5e8.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>详解单片机中的串行口</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><div class=tt-community-card data-content='{"media_id":"6932555721","square_cover":"fe2b0000de54951d0cd6","member_count":"4","title":"单片机资料分享","share_price":"0","media_name":"电子工程师小李","price":"6.66","community_id":"6677702848135823886","renew_price":"5"}'><div class=community-placeholder>（此处已添加圈子卡片，请到今日头条客户端查看）</div></div><p>单片机内部有一个功能强大的全双工串行口，该串行口有四种工作方式，以供不同场合使用。波特率可由软件设置，由片内的定时器/计数器产生。串行口接收、发送均可工作在查询方式或中断方式，使用十分灵活。</p><p>单片机的串行口除了用于数据通信之外，还可以用来驱动单片机应用系统中的键盘和显示器，这是其他微机系统所不能比拟的。</p><h1>串行口的结构与控制</h1><p>为了进行串行数据通信，单片机同样也需要相应的串行接口电路。不过这个接口电路不是单独的芯片，而是集成在单片机芯片的内部，成为单片机芯片的一个组成部分。</p><p>80C51单片机内部的串行口，由发送缓冲寄存器 SBUF、接收缓冲寄存器 SBUF、发送控制寄存器、接收控制寄存器、输入移位寄存器和输出控制门组成。控制单片机串行口的控制寄存器共有两个：特殊功能寄存器 SCON 和 PCON，可以用软件改变两者的内容来控制串行口的工作方式和波特率。</p><p><strong>缓冲寄存器SBUF</strong></p><p>80C51单片机内部有一个全双工的串行通信口，即串行接收和发送缓冲器SBUF，这两个在物理上是独立的接收发送器，既可以接收数据，也可以发送数据。但接收缓冲器只能读出不能写入，而发送缓冲器则只能写入不能读出，两个缓冲器共用同一个地址(99H)。</p><p>这个通信口既可用于网络通信，也可实现串行异步通信，还可以当成同步移位寄存器使用。如果在通信口的输入输出引脚上加上电平转换器，还可方便地构成标准的RS-232和RS-485接口。</p><p>在逻辑上，SBUF只有一个，既表示发送寄存器，又表示接收寄存器，具有同一个地址(99H)。在物理上，SBUF有两个，一个是发送寄存器，另一个是接收寄存器。</p><p><strong>串行口控制寄存器SCON</strong></p><p>该寄存器的字节地址为98H，有位寻址功能。</p><p>SCON格式如下：</p><div class=pgc-img><img alt=详解单片机中的串行口 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a09e76ad9f61422b818f546c70863531><p class=pgc-img-caption></p></div><p>SM0(SCON.7)、SM1(SCON.6)：控制串行口的工作方式。</p><p>SM2(SCON.5)：允许方式2和方式3进行多机通信控制位。在方式2或方式3中，如SM2=1，则接收到的第9位数据(RB8)为0时不激活RI。在方式1时，如SM2=1，则只有收到有效停止位时才会激活RI。若没有接收到有效停止位，则RI清0。在方式0中，SM2必须置为0。</p><p>REN(SCON.4)：允许串行接收控制位。REN=1允许串行接收，REN=0则禁止串行接收。该标志由软件来置1或清0。</p><p>TB8(SCON.3)：是工作在方式2和方式3时，该位是要发送的第9位数据。在一些通信协议中该第9位用于奇偶校验(补奇或补偶);而在MCS-51多处理机通信中，这一位是区别地址帧还是数据帧的标志，需要时由软件置位或复位。</p><p>RB8(SCON.2)：是工作在方式2和方式3时，该位是已接收到的第9位数据，它是奇偶校验位。在MCS-51多处理机通信中是区别地址帧/数据帧的标志。在模式1中，若SM2=0，RB8存放的是已接收数据的停止位。在模式0中，RB8未用，需要时由软件来置1或清0。</p><p>TI(SCON.1)：发送中断标志位。在模式0中，发送完第8位数据时由硬件置位;在其他模式中发送停止位开始时刻由硬件置位。置位时TI=1，申请中断，CPU响应中断后，由软件来清除TI再发送下一帧数据。</p><p>RI(SCON.0)：接收中断标志位。在模式0中，接收完第8位数据时由硬件自动置位;在模式 1 中，SM2=1，只有接收到有效的停止位，才能对 RI 置位。在其他模式中，在接收停止位的半中间由硬件对RI置位。置位时申请中断，CPU响应中断后取走数据，清除RI标志，必须由软件清零。</p><p>SCON的所有位复位时被清零。</p><p><strong>特殊功能寄存器PCON</strong></p><p>其字节地址为87H，没有位寻址功能。PCON的格式如下：</p><div class=pgc-img><img alt=详解单片机中的串行口 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/128ee97558e54ae4a6c90581075db07c><p class=pgc-img-caption></p></div><p>其中与串行接口有关的只有D7位。</p><p>SMOD：波特率选择位。</p><h1>串行口的工作方式</h1><p>串行口有四种工作方式，它们是由串行口控制寄存器 SCON 的 SM0、SM1的状态来定义的，编码及功能如表2-3所示。在这四种工作方式中，串行通信只使用方式1、2、3。方式0主要用于扩展并行输入/输出口。</p><div class=pgc-img><img alt=详解单片机中的串行口 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1801ee99fc064d1187bdd46452e38a2e><p class=pgc-img-caption>表2-3 串行口工作方式</p></div><p>表中：fosc为晶振频率，UART为通用异步接收和发生器。</p><p><strong>方式0</strong></p><p>在方式 0 状态下，串行口为同步移位寄存器输入/输出方式，其波特率是固定不变的，数据由RxD(P3.0)端输入，同步移位脉冲由TxD(P3.1)端输出。方式0主要用于扩展并行输入输出口(如串行LED数码管显示系统等)。</p><p>(1)方式0发送</p><p>当一个数据写入串行口发送缓冲器SBUF时，串行口即将8位数据以fosc/12的波特率从RxD引脚输出(从低位到高位)，发送完8位数据时，将发送中断标志TI置1。TxD引脚输出同步脉冲，波形如图2-22所示。</p><p>(2)方式0接收</p><p>在满足REN=1和RI=0的条件下，就会启动一次接收过程，此时RxD为串行输入端，TxD为同步脉冲输出端。串行接收的波特率为fosc/12，其时序如图2-23所示。当接收完一帧数据(8位)后，控制信号复位，中断标志 RI 被置 1，呈中断申请状态。当再次接收时，必须通过软件将RI清零。</p><div class=pgc-img><img alt=详解单片机中的串行口 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/eee8f734364440b2b25794a71b9263c4><p class=pgc-img-caption>▲图2-22 串行口“方式0”发送时序</p></div><div class=pgc-img><img alt=详解单片机中的串行口 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e06a5ce4269f47468d3caf1c329a2869><p class=pgc-img-caption>▲图2-23 串行口“方式0”接收时序</p></div><p>在方式0中，SCON中的TB8、RB8位没用，多机通信控制位SM2位必须为0。在方式0下发送或接收完8位数据时，由硬件置1并发送中断标志TI或RI，向CPU申请中断，CPU响应TI或RI中断后，标志TI或RI必须由用户程序清0。</p><p><strong>方式1</strong></p><p>串行口以方式1工作时，SCON中的SM0、SM1两位分别为0、1，则串行口被控制为波特率可变的8位异步通信接口。发送的每帧信息为10位：1位起始位，8位数据位(先低位后高位)和1位停止位。</p><p>(1)方式1发送</p><p>串行口以方式1发送时，数据由TxD端输出，CPU执行一条数据写入发送数据缓冲器SBUF的指令，数据字节写入SBUF后，就启动串行口发送器发送。发送完一帧信息的数据位后，发送中断标志置1，其时序如图2-24所示。</p><div class=pgc-img><img alt=详解单片机中的串行口 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/89593860d0f442f39e8605f051947ede><p class=pgc-img-caption>▲图2-24 串行口“方式1”发送时序</p></div><p>(2)方式1接收</p><p>当REN=1时，允许接收器接收，数据从RxD端输入。接收器以所选波特率的16倍速率采样RxD端的电平，当检测到RxD端从1到0的跳变时，启动接收器接收，并复位内部的16分频计数器，以便实现同步。</p><p>在起始位，如果接收到的值不为0，则起始位无效，复位接收电路，当再次接收到一个由1到0的跳变时，重新启动接收器。如果接收值为0，则起始位有效，接收器开始接收本帧的其余信息(一帧信息为10位)。在方式1接收中，若同时满足以下两个条件：RI=0、SM2=0和接收到的停止位=1时，则接收数据有效，实现装载SBUF、停止位进入PB8、接收中断标志RI置1。接收控制器再次采样RxD的负跳变，以便接收下一帧数据。</p><p>若这两个条件不能同时满足，信息将丢失。中断标志RI必须由用户的软件清零，通常情况下，串行口以方式1工作时，SM2置为0。方式1的接收时序如图2-25所示。</p><div class=pgc-img><img alt=详解单片机中的串行口 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c42425447bbb432786b6cee31801b71e><p class=pgc-img-caption>▲图2-25 串行口“方式1”接收时序</p></div><p><strong>方式2</strong></p><p>当SM0、SMl两位分别为1、0时，串行口工作在方式2，此时串行口被定义为9位异步通信接口。发送时可编程位(TB8)根据需要设置为0或1，接收时，可编程位被送入SCON中的RB8。</p><p>(1)方式2发送</p><p>在方式2发送时，数据由TxD端输出，发送一帧信息由11位组成：1位起始位、8位数据位(低位在先、高位在后)、1位可编程位(第9位数据位)和1位停止位，附加的第9位数据为 SCON中的 TB8。TB8由软件置 1 或清 0，可作为多机通信中的数据标志位，也可作为数据的奇偶校验位。</p><p>CPU在执行一条写SBUF的指令后，便立即启动发送器发送，送完一帧信息后，TI被置1，其时序如图2-26所示。在发送下一帧信息之前，TI必须由中断服务程序(或查询程序)清0。</p><div class=pgc-img><img alt=详解单片机中的串行口 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/41218ed35ed240f09687cedeba2fe572><p class=pgc-img-caption>▲图2-26 串行口“方式2”发送时序</p></div><p>(2)方式2接收</p><p>当 SM0、SMl两位分别为1、0，且 REN=1 时，允许串行口以方式 2 接收数据。数据由 RxD端输入，接收11位信息：1位起始位、8位数据位、1位可编程位(第9位数据)和1位停止位。当接收器采样到RxD端从1到0的跳变，并判断起始位有效后，便开始接收一帧信息。当接收器接收到第9位数据后，如果RI=0且SM2=0或接收到的第9位数据为1时，接收到的数据送入SBUF，第9位数据送入RB8，并置RI=1，其时序如图2-27所示。若不能同时满足这两个条件，接收的信息将丢失。</p><div class=pgc-img><img alt=详解单片机中的串行口 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/55799fc489cc40c0970328709a112785><p class=pgc-img-caption>▲图2-27 串行口“方式2”接收时序</p></div><p>方式3</p><p>当SM0、SM1两位为11时，串行口工作在方式3，方式3为波特率可变的9位异步通信方式，除了波特率外，方式3和方式2的发送时序和接收时序相同。</p><h1>波特率的计算与串行口初始化</h1><p><strong>波特率的计算</strong></p><p>在串行通信中，收发双方的波特率必须保持一致。通过软件可设定串行口的4种工作方式，并确定每种方式的波特率。</p><p>(1)方式0的波特率是固定的，为单片机晶振频率fosc的1/12，即BR=fosc/12。</p><p>如fosc=6MHz，则波特率500kbit/s;如fosc=12MHz，则波特率为1Mbit/s。</p><p>(2)方式 2 的波特率也是固定的，且有两种。一种是晶振频率的 1/32，另一种是晶振频率的1/64，即fosc/32和fosc/64。如用公式表示为：</p><div class=pgc-img><img alt=详解单片机中的串行口 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f5f58a4012c240dbb210098ee1846ff3><p class=pgc-img-caption></p></div><p>式中，SMOD为特殊功能寄存器PCON串行口波特率系数的控制位，SMOD=1表示波特率加倍。注意，PCON不能使用位寻址，只能对其进行字节操作。</p><p>如12M晶振系统中，若SMOD=0，则波特率=187.5kbit/s;SMOD=1，则波特率375kbit/s。</p><p>(3)方式1和方式3的波特率是可变的，其波特率由定时器1的计数溢出(对80C52来说，也可使用定时器2的计数溢出)决定，公式为：</p><div class=pgc-img><img alt=详解单片机中的串行口 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/00d9c1006e8e44da992e19ac11c900c6><p class=pgc-img-caption></p></div><p>式中定时器1溢出率计算公式为：</p><div class=pgc-img><img alt=详解单片机中的串行口 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7e9ed50cfb37436190c4341e547f1329><p class=pgc-img-caption></p></div><p>各种方式波特率的计算如表2-4所示。</p><div class=pgc-img><img alt=详解单片机中的串行口 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/01fac565540f493d8a6d66ad7f06e266><p class=pgc-img-caption>表2-4 波特率的计算公式</p></div><p>表中，若SMOD=0，则K=1;若SMOD=1，则K=2。</p><p>通常使用单片机的串行口时，选用的晶振频率 fosc比较固定(一般为 6MHz ， 12MHz 或11.0592MHz)。单片机和微机通信时，选用的波特率也相对固定。</p><p>实际使用中，经常根据已知波特率和时钟频率来计算定时器T1的初值。为方便使用，将常用的波特率和初值X间的关系列成表2-5。</p><div class=pgc-img><img alt=详解单片机中的串行口 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/df94fc47bd0d4bc7a3d56e8dec389635><p class=pgc-img-caption>表2-5 常用通信方式及其波特率</p></div><p>其中有以下三点需要注意。</p><p>(1)表2-5中仅为一些特定系统串口通信时的典型数据，对于其他一些未列出的波特率，应通过前述公式进行计算获取。并可进行相关参数调整，以获得需求的波特率。</p><p>(2)在使用的时钟振荡频率为12MHz或6MHz时，表中初值X和相应的波特率之间有一定误差。例如，FDH的对应的理论值是10416波特(时钟振荡频率为6MHz时)，与9600波特相差816波特，消除误差可以通过调整时钟振荡频率 fosc来实现。例如，如果采用的时钟振荡频率为11.0592MHz，在要求串行通信的系统中，为保证串行通信准确，一般使用11.0592Hz的晶振。</p><p>(3)如果串行通信选用很低的波特率，可将定时器T1设置为方式1定时。但T1溢出时，需要在中断服务程序中重新装入初值。中断响应时间和执行指令时间也会使波特率产生一定的误差，可用改变初值的方法进行适当调整。</p><p><strong>串行通信的校验</strong></p><p>异步通信时可能会出现帧格式错、超时错等传输错误。在具有串行口的单片机的开发中，应考虑在通信过程中对数据差错进行校验，因为差错校验是保证准确无误通信的关键。常用差错校验方法有奇偶校验(80C51系列单片机编程采用此法)、和校验及循环冗余码校验等。</p><p>(1)奇偶校验</p><p>在发送数据时，数据位尾随的一位数据为奇偶校验位(1或0)。当设置为奇校验时，数据中1的个数与校验位1的个数之和应为奇数;当设置为偶校验时，数据中1的个数与校验位中1的个数之和应为偶数。接收时，接收方应具有与发送方一致的差错检验设置，当接收一个字符时，对 1的个数进行校验，若二者不一致，则说明数据传送出现了差错。</p><p>奇偶校验是按字符校验，数据传输速度将受到影响。这种特点使得它一般只用于异步串行通信中。</p><p>(2)和校验</p><p>所谓和校验，是指发送方将所发送的数据块求和(字节数求和)，并产生一个字节的校验字符(校验和)附加到数据块末尾。接收方接收数据时也是先对数据块求和，将所得结果与发送方的校验和进行比较，相符则无差错，否则即出现了差错。这种和校验的缺点是无法检验出字节位序的错误。</p><p>(3)循环冗余码校验</p><p>这种校验是对一个数据块校验一次。例如对磁盘信息的访问、ROM或RAM存储区的完整性等的检验。这种方法广泛应用于串行通信方式。</p><p><strong>串行口初始化</strong></p><p>在使用单片机串行口之前，应对其进行编程初始化，主要是设置产生波特率的定时器1、串行口控制和中断控制，具体步骤如下。</p><p>(1)确定定时器l的工作方式——编程TMOD寄存器。</p><p>(2)计算定时器l的初值——装载THl、TLl。</p><p>(3)启动定时器1——编程TCON中的TRl位。</p><p>(4)确定串行口的控制——编程SCON。</p><div class=tt-community-card data-content='{"media_id":"6932555721","square_cover":"fe2b0000de54951d0cd6","member_count":"4","title":"单片机资料分享","share_price":"0","media_name":"电子工程师小李","price":"6.66","community_id":"6677702848135823886","renew_price":"5"}'><div class=community-placeholder>（此处已添加圈子卡片，请到今日头条客户端查看）</div></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'详解','单片','机中'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>