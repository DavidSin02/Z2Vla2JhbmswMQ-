<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Linux操作系统：中断处理过程 | 极客快訊</title><meta property="og:title" content="Linux操作系统：中断处理过程 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/17704512f67548ca96fd8fd620faef19"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ac9fd9af.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ac9fd9af.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ac9fd9af.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ac9fd9af.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ac9fd9af.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ac9fd9af.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ac9fd9af.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ac9fd9af.html><meta property="article:published_time" content="2020-10-29T21:09:37+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:37+08:00"><meta name=Keywords content><meta name=description content="Linux操作系统：中断处理过程"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/ac9fd9af.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Linux操作系统：中断处理过程</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>中断的硬件结构</h1><p><strong>当I/O设备完成给定的工作之后，由相应的设备控制器产生中断信号（设操作系统已经开启中断系统），并把该信号放到总线上。</strong>当CPU检测到控制器把一个信号插到中断请求线上时，就保存少量的状态信息，如程序计数器的值，然后转到中断处理程序。</p><p><br></p><div class=pgc-img><img alt=Linux操作系统：中断处理过程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/17704512f67548ca96fd8fd620faef19><p class=pgc-img-caption>硬件级的中断结构与过程</p></div><p><br></p><h1 class=pgc-h-arrow-right>中断响应</h1><p>对中断请求的整个处理过程是由硬件和软件结合起来而形成的一套中断机构实施的。发生中断时，CPU暂停执行当前的程序，而转去处理中断。这个由硬件对中断请求做出反应的过程，称为中断响应。一般说来，中断响应顺序执行下述三步动作：</p><p><strong>（1）</strong><strong>中止</strong><strong>当前程序的执行；</strong></p><p><strong>（2）保存原程序的断点信息（主要是程序计数器PC和程序状态寄存器PS的内容）；</strong></p><p><strong>（3）转到相应的处理程序。</strong></p><p>通常CPU在执行完一条指令后，立即检查有无中断请求。如有，而且“中断允许”触发器为1（表示CPU可以响应中断请求），则立即做出响应。</p><p>在进行中断处理过程之前，<strong>硬件总要保存某些信息。至于保存哪些信息、保存在什么地方，这些随CPU而变。</strong>至少要把<strong>程序计数器的内容（即程序断点）自动压入堆栈，以便中断返回时，把程序计数器的值从堆栈中弹出，继续主程序的执行。</strong></p><p>然后，形成中断处理程序的入口地址，把它送入<strong>PC寄存器中</strong>，并转<strong>入中断程序入口</strong>。通常，不同的中断有不同的入口。CPU接到中断后，就从中断控制器那里得到一个称做中断号的地址，它是检索<strong>中断向量表</strong>的位移。中断向量表的表项是<strong>中断向量</strong>。中断向量因机器而异，通常包括相应中断处理程序入口地址和中断处理时处理机状态字PSW。例如，对于终端发出的中断，核心从硬件那里得到的中断号是2。利用它去查找中断向量表，得到终端中断处理程序ttyintr的地址。</p><p><br></p><div class=pgc-img><img alt=Linux操作系统：中断处理过程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/bd18423981bd412cb32d61cef4abaa8c><p class=pgc-img-caption>示意性中断向量</p></div><p><strong>采用向量中断机制的目的是为了提高检索相应处理程序的效率</strong>。</p><p><br></p><div class=pgc-img><img alt=Linux操作系统：中断处理过程 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6983adfefa4546f3a16bd5b0b214a860><p class=pgc-img-caption></p></div><p>上图是Intel Pentium处理器中断向量表的设计情况。0～31号事件是不可屏蔽的，用于对各种错误情况发出中断信号。32～255号事件是可屏蔽的，用于表示设备产生的中断。</p><h1 class=pgc-h-arrow-right>中断处理</h1><p>中断响应后，就由软件（中断处理程序）进行相应处理。中断处理过程大致分为4个阶段：保存被中断程序的现场，分析中断原因，转入相应处理程序进行处理，恢复被中断程序现场（即中断返回）。中断处理的一般过程如图。</p><p><br></p><div class=pgc-img><img alt=Linux操作系统：中断处理过程 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/69e625864d0a4c29994b80d6915f9977><p class=pgc-img-caption></p></div><p><strong>下面对软件执行的</strong><strong>中断</strong><strong>处理过程作进一步介绍。</strong></p><p><strong>（1）保存现场</strong></p><p>保存被中断程序现场的目的是为了在中断处理完之后，可以返回到原来被中断的地方，在原有的运行环境下继续正确地执行下去。通常，中断响应时硬件已经保存了PC和PS的内容，但是还有一些状态环境信息需要保存起来。例如，被中断程序使用的各通用寄存器的内容等。因为通用寄存器是公用的，中断处理程序也使用它们。如果不作保存处理，那么即使以后能按断点地址返回到被中断程序，但由于环境被破坏（如中间运行结果丢失），原程序也无法正确运行。中断响应时硬件处理时间很短（通常是一个指令周期），所以保存现场工作可由软件来协助硬件完成，并且在进入中断处理程序时就立即去做。当然，在不同机器上两者的分工形式是不统一的。</p><p>对现场信息的保存方式是多样化的，常用方式有两种：① 集中式保存：在内存的系统区中设置一个中断现场保存栈，所有中断的现场信息都统一保存在这个栈中。进栈和退栈操作由系统严格按照后进先出原则实施。② 分散式保存：在每个进程的PCB中设置一个核心栈，一旦其程序被中断，它的中断现场信息就保存在自己的核心栈中。如在UNIX系统中每个进程都有一个核心栈。</p><p><strong>（2）分析原因</strong></p><p>中断处理的主要工作是根据中断源确定中断原因，然后转入相应处理程序去执行，即确定“中断源”或查证中断发生，识别中断类型（确定是时钟中断还是盘中断）和中断设备号（哪个磁盘引起的中断）。对中断源的保存有几种不同方式。在有的系统中，硬件在自动转入中断处理程序之前已把中断源信息记录在程序状态字（PSW）和相关的专用区中。如在IBM 360系统中，发生程序中断时，中断源存放在PSW的中断字段中。在I/O中断时，中断字段仅反映通道号或设备号，具体中断原因放在通道状态字（CSW）中。而在另外一些系统中，在进入中断处理程序后用指令把中断寄存器的值作为中断字取到某个寄存器或专用内存单元中保存（如NOVA机）。相应地，查找中断源一般也有两种方法：一种是顺序查询中断源状态标志；另一种是用专用指令直接获得中断源。有些计算机系统（如PDP-11机）却是由硬件根据不同的中断请求直接转入不同的中断处理程序入口的。</p><p><strong>（3）处理中断</strong></p><p>核心调用中断处理程序，对中断进行处理。例如，调用终端中断处理程序ttyintr，判断终端输入/输出工作是否正常完成。如果正常完成，则驱动程序便可做结束处理；如果还有数据要传送，则继续进行传送；如果是异常结束，则根据发生异常的原因做相应处理。</p><p><strong>（4）中断返回</strong></p><p>相应中断处理程序执行以后，要退出中断。通常要做下面两件事情：第一、选取可以立即执行的进程。通常，退出中断后，应恢复到原来被中断程序的断点，继续执行下去。如果原来被中断的进程是在核心态下工作，则不进行进程切换。如果原来被中断的进程是用户态进程，并且此时系统中存在比它的优先级更高的进程，则退出中断时要执行进程调度程序，选择最合适的进程去运行。第二、恢复工作现场。把先前保存在中断现场区中的信息取出复原。从时间顺序上讲，先恢复环境信息（各通用寄存器内容），再恢复控制信息（PS与PC）。通常，使用一条不可中断的特权指令来复原控制信息，如IBM 360的LPSW（装入PSW），PDP—11的rtt（装入PS和PC）。当然，随之也就恢复了处理机状态（用户态或管理态）。这些信息一旦“各就各位”，该进程就立即启动运行了。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Linux','系统','中断'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>