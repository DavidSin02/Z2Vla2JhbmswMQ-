<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>003 IP网络技术基础，一文了解清楚 | 极客快訊</title><meta property="og:title" content="003 IP网络技术基础，一文了解清楚 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/afc8df19.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/afc8df19.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/afc8df19.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/afc8df19.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/afc8df19.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/afc8df19.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/afc8df19.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/afc8df19.html><meta property="article:published_time" content="2020-10-29T21:11:47+08:00"><meta property="article:modified_time" content="2020-10-29T21:11:47+08:00"><meta name=Keywords content><meta name=description content="003 IP网络技术基础，一文了解清楚"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/afc8df19.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>003 IP网络技术基础，一文了解清楚</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>文章目录</p><p>一、以太网（Ethernet）</p><p>以太网概述</p><p>以太网帧格式</p><p>DIX Ethernet V2帧格式</p><p>802.3 帧格式</p><p>以太网分类</p><p>标准以太网</p><p>快速以太网</p><p>千兆以太网</p><p>万兆以太网</p><p>二、常用网络通信设备</p><p>互联网（Internet）概述</p><p>交换机</p><p>集线器（HUB）</p><p>中继器（Repeater）</p><p>路由器（Router）</p><p>典型IP城域网拓扑</p><p>宽带接入服务器（BAS）</p><p>数字用户线路接入复用器（DSLAM）</p><p>光通信网络组网结构</p><p>光线路终端（OLT）</p><p>光网络单元（ONU）</p><p>家庭网关（HomeGate）</p><p>三、关键网络技术</p><p>接入网技术 － ADSL</p><p>接入网技术 －无源光网络（PON）</p><p>接入网技术 － EPON/GPON</p><p>虚拟局域网（VLAN）</p><p>四、IP网络体系结构</p><p>网络体系结构的概述</p><p>OSI参考模型</p><p>TCP/IP协议</p><p>五、IP网络通信过程及网络协议</p><p>HTTP协议</p><p>DNS协议</p><p>传输层协议：TCP</p><p>UDP协议</p><p>TCP和UDP协议之间的比较</p><p>IP协议</p><p>DHCP协议</p><p>ICMP协议</p><p>ARP和RARP</p><div class=tt-column-card data-content='{"new_thumb_url": "http://sf1-ttcdn-tos.pstatp.com/img/pgc-image/1560586841545084195efb3", "title": "\u5f31\u7535\u9ad8\u7aef\u65b9\u6848\u62a5\u4ef7\u53ca\u8d44\u6599\u6574\u7406", "distribution_user_id": 5452532311, "price": 59, "column_id": "6702670369758642439", "author_description": "\u5f31\u7535", "share_price": 4.72, "thumb_url": "http://p6.pstatp.com/large/pgc-image/1560586841545084195efb3", "sold": 204}'><p class=column-placeholder></p></div><p>一、以太网（Ethernet）</p><p>以太网概述</p><p>以太网（Ethernet）是由Xerox（施乐）公司开发的一种基带局域网技术，是当今现有局域网采用的最通用的通信协议标准。</p><p>共享式以太网（即用HUB连接的局域网）采用带冲突检测的载波帧听多路访问（CSMA/CD）机制。</p><p>以太网中节点都可以看到在网络中发送的所有信息，因此，我们说以太网是一种广播网络。</p><p>在新近的网络设计时一般采用物理上是星型结构，逻辑上是总线结构。</p><p>以太网帧格式</p><p>以太网出现两种MAC帧结构：</p><p>一种是以太网DIX V2标准定义的帧结构；</p><p>一种是IEEE802.3标准定义的MAC帧结构。</p><p>DIX V2 标准与 IEEE 的 802.3 标准只有很小的差别，通常可以将 802.3 局域网简称为“以太网”。</p><p>DIX Ethernet V2帧格式</p><p>引导码为 1 和 0 交替的64比特，其最后两位是 “11”，可以通知目标站作好接收准备。</p><p>类型字段说( 正如端口号 )用于指定接收数据的高层协议。</p><p>数据字段 至少 46 字节，但不超过 1500 字节。</p><p>如果数据大于 1500 字节, 该帧有错，被视为超长帧 ( Jabber)。</p><p>如果数据小于 46 字节，则必须加填充字节( pad )，或被视为超短帧 (runt )。</p><p>FSC是指帧校验序列。</p><p>802.3 帧格式</p><p>IEEE 802.3帧的前导码占用7个字节，紧随其后的是长度为1个字节的帧首定界符，表示一帧实际开始。</p><p>源地址，目的地址，FCS字段与 Ethernet 的定义相同。</p><p>类型字段则由长度字段替代，在该字段后是数据的字节数。</p><p>需要额外的字段来规定上一层的协议。此字段定义为目的地服务访问点 (DSAP)、 源服务访问点 (SSAP)。</p><p>控制字段 (CTRL) 对LAN 并不附任何功能。</p><p>以太网分类</p><p>IEEE802.3规定了包括物理层的连线、电信号和介质访问层协议的内容，以太网是当前应用最普遍的局域网技术，它很大程度上取代了其他局域网标准。如令牌环、FDDI和ARCNET。</p><p>以太网包括：</p><p>标准以太网（10Mbit/s)</p><p>快速以太网（100Mbit/s）</p><p>千兆以太网（1000Mbit/s）</p><p>10G（10Gbit/s）以太网</p><p>标准以太网</p><p>快速、可靠、低廉、易于安装维护</p><p>使用粗同轴电缆、细同轴电缆、非屏蔽双绞线、屏蔽双绞线和光纤等多种传输介质进行连接</p><p>传输速率是10Mbps，不同传输介质支持的最大网段长度不一样</p><p>快速以太网</p><p>快速、可靠、低廉、易于安装维护</p><p>支持3、4、5类双绞线以及光纤的连接，支持全/半双工工作方式</p><p>传输速率是100Mpbs，在使用单模光纤为传输介质时，最大通信距离能达到3000米</p><p>千兆以太网</p><p>快速、可靠、低廉、易于安装维护</p><p>采用了与10M以太网相同的帧格式、帧结构、网络协议、全/半双工工作方式、流控模式以及布线系统</p><p>千兆以太网技术有两个标准：IEEE802.3z和IEEE802.3ab。IEEE802.3z制定了光纤和短程铜线连接方案的标准。IEEE802.3ab制定了五类双绞线上较长距离连接方案的标准。</p><p>传输速率是1000Mpbs</p><p>万兆以太网</p><p>以全双工方式连接到网络交换器等网络设备，并不支持半双工模式与CSMA/CD</p><p>只能在光纤上传输，传输速率是10GMbps</p><p>二、常用网络通信设备</p><p>互联网（Internet）概述</p><p>随着微型计算机的广泛应用，大量的微型计算机是通过局域网连入广域网，而局域网与广域网、广域网与广域网的互连是通过路由器实现的；</p><p>在Internet中，用户计算机需要通过校园网、企业网或ISP联入地区主干网，地区主干网通过国家主干网联入国家间的高速主干网，这样就形成一种由路由器互联的大型、层次结构的互联网络。</p><p>交换机</p><p>交换机(英文：Switch，意为“开关”)是一种用于电（光）信号转发的网络设备。它工作在数据链路层，可以为接入交换机的任意两个网络节点提供独享的电信号通路。</p><p>交换机在同一时刻可进行多个端口对之间的数据传输。每一端口都可视为独立的物理网段（注：非IP网段），连接在其上的网络设备独自享有全部的带宽，无须同其他设备竞争使用</p><p>交换机的三个主要功能：</p><p>学习：以太网交换机了解每一端口相连设备的MAC地址，并将地址同相应的端口映射起来存放在交换机缓存中的MAC地址表中。</p><p>转发/过滤：当一个数据帧的目的地址在MAC地址表中有映射时，它被转发到连接目的节点的端口而不是所有端口（如该数据帧为广播/组播帧则转发至所有端口）。</p><p>消除回路：当交换机包括一个冗余回路时，以太网交换机通过生成树协议避免回路的产生，同时允许存在后备路径。</p><p>集线器（HUB）</p><p>集线器，英文称为“Hub”。</p><p>HUB是一个多端口的转发器，当以HUB为中心设备时，网络中某条线路产生了故障，并不影响其它线路的工作。所以HUB在局域网中得到了广泛的应用。</p><p>集线器的主要功能是对接收到的信号进行再生整形放大，以扩大网络的传输距离，同时把所有节点集中在以它为中心的节点上。</p><p>Hub属于纯硬件网络底层设备，基本上不具有类似于交换机的"智能记忆"能力和"学习"能力。它也不具备交换机所具有的MAC地址表，所以它发送数据时都是没有针对性的，而是采用广播方式发送。</p><p>中继器（Repeater）</p><p>中继器（Repeater）工作于OSI的物理层，是局域网上所有节点的中心，它的作用是放大信号，补偿信号衰减，支持远距离的通信。</p><p>实际上，通过中继器连接起来的网络相当于同一条电线组成的更大的网络。</p><p>中继器也能把不同传输介质的网络连在一起，多用在数据链路层以上相同的局域网的互连中。</p><p>路由器（Router）</p><p>路由器（Router），是互联网络的重要设备之一，工作在网络层，路由器最基本的功能是转发数据包。</p><p>在同个路由器实现的互联网络中，路由器要对数据包进行检测，判断其中所含的目的地址，若数据包不是发向本地网络的某个节点，路由器就要转发该数据包，并决定转发到哪一个目的地址（可能是路由器，也可能是最终目的节点）以及从哪个网络接口转发出去。</p><p>路由器的功能：</p><p>隔绝广播，划分广播域</p><p>通过路由选择算法决定最优路径</p><p>转发基于三层目的地址的数据包</p><p>典型IP城域网拓扑</p><p>宽带接入服务器（BAS）</p><p>BAS 全称：Broadband Access Server/ Broadband Remote Access Server)</p><p>BAS是一种设置在网络汇聚层的用户接入服务设备，可以智能化地实现用户的汇聚、认证、计费等服务</p><p>BAS还可以根据用户的需要，方便地提供多种IP增值业</p><p>BRAS</p><p>数字用户线路接入复用器（DSLAM）</p><p>DSLAM是Digital Subscriber Line Access Multiplexer的简称，即数字用户线路接入复用器。</p><p>DSLAM是各种DSL系统的局端设备，属于最后一公里接入设备（the last mile）</p><p>其功能是接纳所有的DSL线路，汇聚流量，相当于一个二层交换机。</p><p>光通信网络组网结构</p><p>光线路终端（OLT）</p><p>OLT: optical line terminal(光线路终端），用于连接光纤干线的终端设备</p><p>向ONU(光网络单元）以广播方式发送以太网数据；</p><p>发起并控制测距过程，并记录测距信息；</p><p>OLT除了提供业务汇聚的功能外，还是集中网络管理平台。</p><p>在OLT上可以实现基于设备的网元管理和基于业务的安全管理和配置管理。</p><p>不仅可以监测、管理设备及端口，还可以进行业务开通和用户状态监测，而且还能够针对不同用户的QoS/SLA要求进行带宽分配。</p><p>光网络单元（ONU）</p><p>ONU (Optical Network Unit) 光网络单元，ONU分为有源光网络单元和无源光网元单元</p><p>选择接收OLT发送的广播数据；</p><p>响应OLT发出的测距及功率控制命令；并作相应的调整；</p><p>对用户的以太网数据进行缓存，并在OLT分配的发送窗口中向上行方向发送；</p><p>家庭网关（HomeGate）</p><p>一个在家庭内的网络化信息设备与智能宽带接入网之间的智能化网关，将家庭外部的接入网络和家庭内部网络联系起来。</p><p>作为所有外部接入网连接到家庭内部，同时将家庭内部网络连接到外部的一种物理接口；</p><p>使住宅用户可以获得各种家庭服务（包括现有的服务和未来可能出现的服务）的平台。</p><p>三、关键网络技术</p><p>接入网技术 － ADSL</p><p>ADSL属于DSL技术的一种，全称Asymmetric Digital Subscriber Line（ 非对称数字用户线路），亦可称作非对称数字用户环路,提供的上行和下行带宽不对称.</p><p>ADSL技术采用频分复用技术把普通的电话线分成了电话、上行和下行三个相对独立的信道，从而避免了相互之间的干扰。用户可以边打电话边上网，不用担心上网速率和通话质量下降的情况。</p><p>接入网技术 －无源光网络（PON）</p><p>Passive Optical Network无源光网络。目前PON是实现FTTB/FTTH的主要技术。</p><p>PON是一种采用点到多点（P2MP）结构的单纤双向光接入网络。PON系统由局端的光线路终端（OLT）、光分配网络（ODN）和用户侧的光网络单元（ONU）组成，为单纤双向系统。在下行方向（OLT到ONU），OLT发送的信号通过ODN到达各个ONU。在上行方向（ONU到OLT），ONU发送的信号只会到达OLT，而不会到达其他ONU。为了避免数据冲突并提高网络效率，上行方向采用TDMA多址接入方式，并对各ONU的数据发送进行管理。ODN在OLT和ONU间提供光通道。</p><p>接入网技术 － EPON/GPON</p><p>Ethernet Passive Optical Network，以太网无源光网络，EPON是基于以太网技术的宽带接入系统，它利用PON的拓扑结构实现以太网的接入。它采用点到多点结构、无源光纤传输，在以太网之上提供多种业务。EPON不仅能综合现有的有线电视、数据和语音业务，还能兼容未来业务如数字电视、VoIP、电视会议和VOD等，实现综合业务接入。</p><p>GPON(Gigabit-Capable PON) 技术是基于ITU-TG.984.x标准的最新一代宽带无源光综合接入标准，具有高带宽，高效率，大覆盖范围，用户接口丰富等众多优点，被大多数运营商视为实现接入网业务宽带化，综合化改造的理想技术。</p><p>虚拟局域网（VLAN）</p><p>在计算机网络中，一个二层网络可以被划分为多个不同的广播域，一个广播域对应了一个特定的用户组，默认情况下这些不同的广播域是相互隔离的。不同的广播域之间想要通信，需要通过一个或多个路由器。这样的一个广播域就称为VLAN。</p><p>虚拟局域网（VLAN）中设备和用户并不受物理位置的限制，可以根据功能、部门及应用等因素将它们组织起来，相互之间的通信就好像它们在同一个网段中一样</p><p>与传统的局域网技术相比较，VLAN技术更加灵活，它具有以下优点： 网络设备的移动、添加和修改的管理开销减少；可以控制广播活动；可提高网络的安全性。</p><p>四、IP网络体系结构</p><p>网络体系结构的概述</p><p>网络协议的概念</p><p>计算机网络中为进行数据传输而建立的一系列规则、标准或约定称为网络协议（Protocol）。</p><p>网络层次的概念</p><p>不同系统中的实体的通信任务十分复杂，相互间不可能作为一个整体来处理，否则任何一方的改变，就要修改整个软件包。</p><p>层次结构使用结构化的设计和实现技术，即把协议按功能分为若干层次，每层完成一定的功能（同层协议），并对其上层提供支持（接口）。</p><p>由于通信功能是分层实现的，因而进行通信的两个系统就必须具有相同的层次结构，两个不同系统上的相同层称为同等层或对等层。</p><p>计算机网络采用层次化结构的优越性</p><p>各层之间相互独立。</p><p>灵活性好。</p><p>易于实现和维护。</p><p>有利于网络标准化。</p><p>OSI参考模型</p><p>国际标准化组织 (ISO，international standards organization）和一些科研机构、大的网络公司做了大量的工作，在1983年提出了开放式系统互连参考模型（ISO/OSI RM，international standards organization/open system interconnect reference model）。</p><p>OSI参考模型将整个网络通信的功能划分为7个层次，由底层到高层分别是物理层、链路层、网络层、传输层、会话层、表示层和应用层。</p><p>每层完成一定的功能，都直接为其上层提供服务，并且所有层次都互相支持。</p><p>第4层到第7层主要负责互操作性，而1～3层则用于创造两个网络设备间的物理连接。</p><p>OSI七层参考模型层次划分</p><p>物理层:规定了通信连接端口与传输媒体的物理和电气特性，比特数据的同步和传输方式。</p><p>数据链路层：负责建立和管理节点间的链路，通过各种控制协议，将有差错的物理信道变为无差错的、能可靠传输数据帧的数据链路。。</p><p>网络层：控制数据链路层与传输层之间的信息转发，建立、维持和终止网络的连接。</p><p>传输层：向用户提供可靠的端到端的差错和流量控制，保证报文的正确传输。</p><p>会话层：负责建立、管理和终止表示层实体之间的通信会话。该层的通信由不同设备中的应用程序之间的服务请求和响应组成。</p><p>表示层：提供各种用于应用层数据的编码和转换功能，确保一个系统的应用层发送的数据能被另一个系统的应用层识别。</p><p>应用层：OSI参考模型中最靠近用户的一层，为应用程序提供网络服务。</p><p>计算机网络从逻辑上可以划分为通信子网和资源子网。</p><p>从功能的角度看，OSI参考模型的下四层（物理层、数据链路层、网络层、传输层）主要提供电信传输功能，以节点到节点之间的通信为主；</p><p>上三层（会话层、表示层、应用层）则以提供使用者与应用程序之间的处理功能为主。</p><p>即下四层属于通信功能（通信子网），上三层属于处理功能（资源子网）。</p><p>TCP/IP协议</p><p>TCP/IP协议是目前最流行的商业化网络协议，尽管它不是某一标准化组织提出的正式标准，但它已经被公认为目前的工业标准或“事实标准”。因特网之所以能迅速发展，就是因为TCP/IP协议能够适应和满足世界范围内数据通信的需要。</p><p>TCP/IP协议具有以下几个特点。</p><p>（1）开放的协议标准，可以免费使用，并且独立于特定的计算机硬件与操作系统。</p><p>（2）独立于特定的网络硬件，可以运行在局域网、广域网，以及互联网中。</p><p>（3）统一的网络地址分配方案，使得整个TCP/IP设备在网中都有惟一的地址。</p><p>（4）标准化的高层协议，可以提供多种可靠的用户服务。</p><p>TCP/IP参考模型</p><p>与ISO/OSI参考模型不同，TCP/IP体系结构将网络划分为应用层、传输层、互联层、和网络接口层4层。</p><p>TCP/IP的分层体系结构与ISO/OSI参考模型有一定的对应关系</p><p>TCP/IP体系结构中各层的功能</p><p>网络接口层：网络接入层与OSI参考模型中的物理层和数据链路层相对应。它负责监视数据在主机和网络之间的交换。事实上，TCP/IP本身并未定义该层的协议，而由参与互连的各网络使用自己的物理层和数据链路层协议，然后与TCP/IP的网络接入层进行连接。地址解析协议（ARP）工作在此层，即OSI参考模型的数据链路层。</p><p>互联层：网际互联层对应于OSI参考模型的网络层，主要解决主机到主机的通信问题。它所包含的协议设计数据包在整个网络上的逻辑传输。注重重新赋予主机一个IP地址来完成对主机的寻址，它还负责数据包在多种网络中的路由。该层有三个主要协议：网际协议（IP）、互联网组管理协议（IGMP）和互联网控制报文协议（ICMP）。</p><p>传输层:传输层对应于OSI参考模型的传输层，为应用层实体提供端到端的通信功能，保证了数据包的顺序传送及数据的完整性。该层定义了两个主要的协议：传输控制协议（TCP）和用户数据报协议（UDP)。</p><p>应用层：应用层对应于OSI参考模型的高层，为用户提供所需要的各种服务，例如：HTTP、FTP、Telnet、DNS、SMTP等</p><p>五、IP网络通信过程及网络协议</p><p>在网络中，数据都是从源端发出，经过网络传达到目的端。若主机A要与主机B的交换数据，交换过程如图所示。</p><p>网络中两台主机的网络协议流程</p><p>1.主机A在应用层的操作</p><p>主机A启用一个网络应用时，A自动打开本机上的一个大于1024的端口（动态端口），做为访问网络服务的源端口。目的端口根据主机A申请的网络服务而定，为保留端口。</p><p>主机A的应用程序将发送的数据表示为网络上通用的格式。（OSI表示层功能）</p><p>TCP/IP的应用层为每一个具有源端口与目的端口的数据流建立一个单一的会话。即使访问同一网络服务，源端口是不同的。如同时访问HTTP（不同网页）。</p><p>HTTP协议</p><p>超文本传输协议（ HyperText Transfer Protocol）</p><p>传输互连网Web数据的协议</p><p>运行在TCP之上——HTTP 的知名端口是 80</p><p>HTTP 是传送页面内容的协议</p><p>页面的格式是由HTML代码组成的</p><p>HTTP协议流程</p><p>DNS协议</p><p>DNS（Domain Name System），计算机域名系统</p><p>将主机名和IP地址对应起来的一种机制</p><p>通常情况下 DNS 运行在 UDP 之上——DNS 的知名端口是 53</p><p>DNS 使用 TCP 来进行域名传送</p><p>DNS 查询示例</p><p>2.主机A在传输层的操作</p><p>传输层在传输数据前将数据分段，每个分段称为Segment。</p><p>主机A在传输层为数据分段添加控制信息，TCP或UDP头。主要是源端口、目的端口和顺序号。源端口和目的端口表示数据是由哪个协议或应用程序发出的，送到哪个应用程序及协议。顺序号是该数据段在整个数据流中的位置。</p><p>传输层协议：TCP</p><p>Transmission Control Protocol，传输控制协议，是第 4 层面向连接的协议。</p><p>TCP 提供下列可靠流的功能：</p><p>— 在网络端点间的数据可靠，透明传送。</p><p>— 端到端差错检测和恢复以及数据流控制。</p><p>— 用户数据和高层协议的分段和重组。</p><p>TCP三次握手（Three -Way Handshake）</p><p>为建立连接,TCP使用三次握手 。</p><p>确保双方准备好传送数据。</p><p>也使双方明确其初始序列号。</p><p>三次握手为的是双方准确的同步。</p><p>“握手”期间能发数据，但必须保持该数据，直到握手完毕。</p><p>TCP协议封装过程</p><p>TCP包头结构</p><p>每个 TCP 段可分为标题 ( 首部、或头标 ) 和后随的数据两部分</p><p>源端口和宿端口 (Source and Destination ports)识别连接的每一端的应用。</p><p>序列号 (Sequence Number) 可识别数据字段中的字节流位置。</p><p>应答号 (Ack Number )可视为源端已收到最高字节的位置。</p><p>偏移量 ( Offset )是该段的数据位置 (任选字段为可变长 )</p><p>UDP协议</p><p>User Datagram Protocol，用户数据报协议</p><p>UDP 是无连接、不可靠的第 4 层协议。</p><p>UDP 消息也许会丢失、重复 或无序到达。</p><p>由于无流量控制，消息到达对方比有流控的来得快。</p><p>就象 IP那样， 从一个设备到另一个设备运载 UDP 消息 。</p><p>正如TCP为上层协议那样，UDP 使用相同的端口号机制 。</p><p>UDP协议的数据包头格式</p><p>–宿端口(Destination port)指明该数据报直接对应的上层协议。</p><p>–源端口(Source port ) 是任选的 (若不用，则为 0 ) ，并记为数据报的源端口。</p><p>–长度 (Length )是以包括首部在内的八位组( octets )计。</p><p>–校验和 (Checksum)是任选的 (若不用，则为 0 ) ，并且端口号不用。</p><p>----带有UDP的IP数据报获取 IP 地址，则需计算。</p><p>----如果校验和是正确的，则无错到达的消息和端口也是正确的。</p><p>TCP和UDP协议之间的比较</p><p>UDP和TCP协议的主要区别是两者在如何实现信息的可靠传递方面不同。</p><p>TCP协议中包含了专门的传递保证机制，当数据接收方收到发送方传来的信息时，会自动向发送方发出确认消息；发送方只有在接收到该确认消息之后才继续传送其他信息，否则将一直等待直到收到确认信息为止与TCP不同；</p><p>UDP协议与TCP协议相比，具有明显的速度优势，因此在有些情况下，UDP协议可能会变得非常有用。因为虽然TCP协议中植入了各种安全保障功能，但是在实际执行的过程中会占用大量的系统开销，无疑使速度受到严重的影响。而UDP由于排除了信息可靠传递机制，将安全和排序等功能移交给上层应用来完成，极大地降低了执行时间，使速度得到了保证。</p><p>3.主机A在网络层的操作</p><p>在每个数据分段的前面封装IP头，网络层把数据分段封装为数据包（Packet）。包头中，主要是源IP和目的IP地址。</p><p>源IP地址是主机A的，目的IP地址是主机B的。</p><p>IP协议</p><p>Internet Protocol，网际协议</p><p>IP 显然是现代网间互联 (internetworking )的出色协议。</p><p>它也是一个不可靠的、无连接的投递机制 。</p><p>任何 IP 数据报也许会丢失、重复 或被投错，并不会予以通。</p><p>IP 规定了数据格式、分组处理 和出错处理。</p><p>IP报头格式</p><p>–Version 是 IP 规范所发布的版本号 4 （IPv4)或 快要使用的IP版本 6(IPv6)。</p><p>–服务类型(Type of Service)字段可分为 优先级 ( Precedence ), D 比特, T 比特和 R比特：</p><p>–生存期 (Time to Live：TTL), 度量单位为秒, 表明数据报的寿命。当路由表指明为一循环，该消息将被移去。 它采用一种简单的时间估价，由每个路由器扣去 1 秒 ( 一个TTL单位)。</p><p>–上层协议(Next Protocol) 说明了“数据”直接投到哪个高层协议，如UDP或TCP。该字段的值应取自标准表。</p><p>DHCP协议</p><p>DHCP（Dynamic Host Configuration Protocol，动态主机配置协议）是一个局域网的网络协议，使用UDP协议工作， 主要有两个用途：给内部网络或网络服务供应商自动分配IP地址，给用户或者内部网络管理员作为对所有计算机作中央管理的手段。</p><p>DHCP协议采用客户端/服务器模型，主机地址的动态分配任务由网络主机驱动。当DHCP服务器接收到来自网络主机申请地址的信息时，才会向网络主机发送相关的地址配置等信息，以实现网络主机地址信息的动态配置。</p><p>DHCP请求IP地址过程</p><p>–主机发送DHCPDISCOVER广播包在网络上寻找DHCP服务器</p><p>–DHCP服务器向本网络发送DHCPOFFER单播数据包（回复主机的DHCP报文、目的地址为主机地址所以单播），包含IP地址及地址租期等；</p><p>–主机发送DHCPREQUEST广播包，正式向服务器请求分配已提供的IP地址；</p><p>–DHCP服务器向主机发送DHCPACK单播包，确认主机的请求</p><p>ICMP协议</p><p>Internet Control Message Protocol,互联网控制消息协议，工作在网络层。</p><p>ICMP 承载差错报告消息，封装在 IP 数据报的数据字段部分。</p><p>当装载在IP中(象一个第 4 层协议) ，ICMP 是认为IP扩展的最佳选择。</p><p>该ICMP消息是 由 IP 数据报上一层协议字段来标注 。</p><p>ICMP 报头是编了码的，呈现的差错映射到对应的编号。</p><p>为了采集和解释ICMP 消息，分析仪是必不可少的仪器。</p><p>ICMP报头格式</p><p>–ICMP消息类型的扩展表，归纳如下：</p><p>----信宿不可达 Destination Unreachable (3): 网络，主机，协议或端口不可达。</p><p>----请求分片但不允许，源路由失效。</p><p>----超时 (11)： 数据报在转送或重装时失效。</p><p>----参数问题 (12): 发送IP报头 + 8字节的 出错报文。</p><p>–这些消息形成了基本的差错报告功能。</p><p>4.主机A在数据链路层的操作</p><p>数据链路层在数据包前面封装数据帧头，主要是源MAC地址和目的MAC地址；在数据包后面封装校验位，从而把数据包封装成数据帧(Frame)。根据网络传输介质的不同，数据帧的格式也不同。</p><p>同一网段内，源MAC为主机A的，目的MAC为服务器B的。如果主机A不知道B的MAC地址，可以向交换网络上发送ARP广播，解析到B的MAC地址。</p><p>不同网段时，源MAC为主机A的，目的MAC为路由器AE0接口的MAC地址。因为ARP广播不能通过路由器。</p><p>ARP和RARP</p><p>地址解析协议ARP (Address Resolution Protocol)和反向地址解析协议RARP</p><p>计算机网络中各主机之间要进行通信时，必须要知道彼此的物理地址（OSI模型中数据链路层的地址）。因此，在TCP/IP的网际层有ARP协议和RARP协议，它们的作用是将源主机和目的主机的IP地址与它们的物理地址相匹配。</p><p>地址解析协议ARP</p><p>5.主机A在物理层的操作</p><p>物理层负责把数据帧转化成在网络介质上传递的电子信号。通过接口发送出去。</p><p>6.交换机A上的工作</p><p>不能对数据进行任何的改动，只是根据数据帧的目的MAC地址将数据帧转发给路由器A。</p><p>7.路由器A上的工作</p><p>拆帧头，根据目的IP地址,在自己的路由表里查找路径，知道必须经过路由器B.</p><p>源IP地址和目的IP地址是不变的。如果有使用NAT主机(网络地址转换)，则源私有IP地址，转换为公有IP地址，路由器A的S0口的IP。</p><p>封装帧头,源MAC地址是路由器A的S0口的，目的MAC地址是路由器B的S0口的。</p><p>将封装的数据，转发给路由器B。</p><p>8.路由器B上的工作</p><p>拆帧头；</p><p>根据目的IP查找自己的路由表，看自己是否有到达该目的地的路径。发现目的IP在自己的E0口直连的网段，路由器B向该网段发出一个ARP解析广播，查找服务器B的MAC地址。</p><p>在收到回应后，路由器B以自己的E0口的MAC为源MAC,以服务器B的MAC为目的MAC,封装数据帧。</p><p>转发给交换机B.</p><p>注:IP地址没有改动。</p><p>9.交换机B上的工作</p><p>不做改动，转发给服务器B。</p><p>10.FTP服务器B上的工作</p><p>逐层拆封。在传输层将数据段组和，传给应用层的端口。</p><p>如果FTP服务器B向主机A发送数据，目的地址时218.68.45.2,然后，路由器A再转换为其目的IP192.168.1.2。</p><p>远程主机之间的数据传输是依靠IP地址标明目的地，而通过不断变换源MAC地址与目的MAC地址传输数据。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'003','IP','网络'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>