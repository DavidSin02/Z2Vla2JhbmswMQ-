<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>一文看懂码灵半导体CFW32C7UL系列产品应用（二）： 国密算法 | 极客快訊</title><meta property="og:title" content="一文看懂码灵半导体CFW32C7UL系列产品应用（二）： 国密算法 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/2498b96b8dff4cb1a7b236e152c2b78c"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b0bfa835.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b0bfa835.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b0bfa835.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b0bfa835.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b0bfa835.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b0bfa835.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b0bfa835.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b0bfa835.html><meta property="article:published_time" content="2020-10-29T21:12:22+08:00"><meta property="article:modified_time" content="2020-10-29T21:12:22+08:00"><meta name=Keywords content><meta name=description content="一文看懂码灵半导体CFW32C7UL系列产品应用（二）： 国密算法"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/b0bfa835.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一文看懂码灵半导体CFW32C7UL系列产品应用（二）： 国密算法</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>欢迎再次来到“码灵半导体CFW32C7UL系列产品应用介绍”连载专题。通过上期对CFW32C7UL系列支持的国密算法种类的介绍，相信您对CFW327UL系列的国密硬件模块有了初步了解，那么这些国密模块如何使用？应用是否便捷？加解密的速度如何？带着这些疑问，我们今天从真随机数发生器TRNG和SM3算法模块的调用开始谈起。</p><p><br></p><div class=pgc-img><img alt="一文看懂码灵半导体CFW32C7UL系列产品应用（二）： 国密算法" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/2498b96b8dff4cb1a7b236e152c2b78c></div><p><br></p><p><strong>一、真随机数发生器TRNG模块</strong></p><p>说到随机，有两个必须要搞清楚的概念即“真随机数生成器”（TRNG）和伪随机数生成器（PRNG）。大部分计算机程序和语言中的随机函数，都是伪随机数生成器，它们都是由确定的算法，通过一个“种子”（如“时间”）来产生“看起来随机”的结果值。毫无疑问，只要知道算法和种子，或者是之前已经产生了的随机数，那么就有可能获得接下来随机数序列的信息，因此它们带有可预测性。这种可预测性在密码学上并不安全，所以我们称其为“伪随机”。</p><p>与“伪随机”相对应的是“真随机”，真正的随机数仅存在于量子力学中，而我们需要的是一种不可预测的、统计意义上的、高安全性的随机数。<strong>在码灵半导体CFW32C7UL系列产品中我们提供了四组这种真随机数源，用以产生真随机数，同时该功能模块是采用硬件方式实现的，并且通过了NIST统计检测程序的随机性测试。</strong></p><p>下面我们具体介绍下CFW32C7UL系列产品的真随机数发生器TRNG模块是如何通过码灵半导体官方提供的SDK函数来进行调用的。目前码灵半导体官方提供了两种SDK，即裸机SDK和Linux SDK。</p><p><strong>开发模式一：裸机SDK</strong></p><p>裸机SDK与提供的freeRTOS和uCOS SDK中相同。</p><p>① 产生一个真随机数</p><p>调用HAL_TRNG_GetValue()</p><p>uint32_t HAL_TRNG_GetValue() 函数返回值为一个真随机数</p><p>② 使用范例</p><p>uint32_t random = HAL_TRNG_GetValue();</p><p>单个函数看不出硬件实现和软件实现有什么不同，那下面展现一下函数源码：</p><p>uint32_t HAL_HRNG_GetValue()</p><p>{</p><p>uint32_t ret;</p><p>HRNG->CMPRES = 0x02;</p><p>HRNG->CTRL |= (HRNG_CTRL_RNG_EN0 | HRNG_CTRL_RNG_EN1 | HRNG_CTRL_RNG_EN2 | HRNG_CTRL_RNG_EN3 | HRNG_CTRL_SCLK_SEL);</p><p>while((HRNG->STATUS& HRNG_STATUS_FIFO_NOT_EMPTY) ==0);</p><p>ret= HRNG->LFSR;</p><p>return ret;</p><p>}</p><p>上面所述的就是对寄存器HRNG->CMPRE、HRNG->CTRL进行一个配置后，等待HRNG->STATUS，之后HRNG->LFSR寄存器中取出随机数。</p><p><strong>开发模式二：Linux SDK</strong></p><p>通过操作linux系统中/dev/wokoo_trng，就可以进行产生真随机数。</p><p>① TRNG算法底层接口</p><p>• open：打开设备节点</p><p>• read：读取随机数的数据</p><p>② 接口描述</p><p>• open</p><p>函数原型：static int uac_open(struct inode *inode, struct file * file)</p><p>参数：file:文件名</p><p>返回值：成功0，其它失败</p><p>• read</p><p>函数原型：static ssize_t uac_read(struct file * file, char __user *buffer, size_t size , loff_t *p)</p><p>参数：file:文件名，buffer：读出数据缓存,size:读出数据长度</p><p>返回值：成功0，其它失败</p><p>③ 使用示例</p><p>trng_fd = open("/dev/wokoo_trng", O_RDWR); //打开trng的节点</p><p>read(trng_fd, (unsigned char *)&trng_data, 1); //读取真随机数</p><p><strong>CFW32C7UL系列的TRNG效率</strong></p><p>目前码灵半导体CFW32C7UL系列产品产生随机数的速率是75kb/s，即每秒可以产生75kb的真随机数。</p><p><strong>二、SM3杂凑硬件算法模块</strong></p><p>SM3算法为国密杂凑算法，数据分组长度为512bit，杂凑值长度为256bit。基本运算流程为：对输入数据流做填充，构成整数个512bit长度的数据流；再对数据做分组；然后对每个分组做扩展和替换压缩操作，得到中间的临时杂凑值，反复进行直到所有分组处理完毕，最后一个计算得到的杂凑值作为整个数据流的最终杂凑值输出。</p><p><strong>开发模式一：裸机SDK</strong></p><p>调用SM3_Hash产生SM3最终Hash值。</p><p>void SM3_Hash(uint32_t *pDataIn,uint32_t DataLen,uint32_t *pDigest)</p><p>① 函数参数说明</p><p>pDataIn: 输入的数据指针( big endian)</p><p>DataLen: 数据的bit 长度</p><p>pDigest: 输出的最终hash值</p><p>② 使用范例</p><p>SM3_Hash (message,32,tempbuf);</p><p>//message 是原始数据，数据长度为32，tempbuf是产生的256位Hash值</p><p><strong>开发模式二：Linux SDK</strong></p><p>通过操作linux系统中/dev/wokoo_sm3，就可以进行SM3杂凑算法的运算。</p><p>① SM3算法底层接口</p><p>• open：打开设备节点</p><p>• read：读取加密后的数据</p><p>• write：写入加密的数据</p><p>② 接口描述</p><p>• Open</p><p>函数原型：static int uac_open(struct inode *inode, struct file * file)</p><p>参数：file:文件名</p><p>返回值：成功0，其它失败</p><p>• Read</p><p>函数原型：static ssize_t uac_read(struct file * file, char __user *buffer, size_t size , loff_t *p)</p><p>参数：file:文件名，buffer：读出数据缓存,size:读出数据长度</p><p>返回值：成功0，其它失败</p><p>• Write</p><p>函数原型： static ssize_t uac_write(struct file *file, const char __user *buf, size_t count, loff_t *ppos)</p><p>参数：file:文件名，buf：写入数据缓存,count:写入数据长度</p><p>返回值：成功0，其它失败</p><p>③ 使用示例</p><p>sm3_fd = open("/dev/wokoo_sm3", O_RDWR); //打开sm3节点</p><p>write(sm3_fd, &sm3_data.datain, sm3_data.datalen); //写入需杂凑的数据</p><p>read(sm3_fd, &sm3_data.dataout, NULL); //读出杂凑完的结果</p><p><strong>CFW32C7UL系列SM3算法的效率</strong></p><p>通过输入128KB数据，完成杂凑运算后输出运算结果，统计时间如下图：</p><p><br></p><div class=pgc-img><img alt="一文看懂码灵半导体CFW32C7UL系列产品应用（二）： 国密算法" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/48f6d8b4d3be466b975f84040c6ee018></div><p><br></p><p>目前码灵半导体CFW32C7UL系列产品可以实现45Mbps的杂凑速率。</p><p>通过以上对CFW32C7UL系列产品的真随机数发生器TRNG和SM3算法模块的介绍，相信大家对国密模块的如何使用有了初步了解，那么SM2和SM4算法在CFW32C7UL系列产品中如何具体使用呢？让我们带着这些问题，在下期中继续探寻吧。</p><p>今天的专题就到这儿，更多关于码灵半导体CFW32C7UL系列产品的介绍，我们下期见！</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'懂码','灵半导体','CFW32C7UL'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>