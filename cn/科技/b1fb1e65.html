<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>基于NB-IoT的LWM2M协议浅析 | 极客快訊</title><meta property="og:title" content="基于NB-IoT的LWM2M协议浅析 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/704fa7d3036f4e02a02a589a132c1156"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b1fb1e65.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b1fb1e65.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b1fb1e65.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b1fb1e65.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b1fb1e65.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b1fb1e65.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b1fb1e65.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b1fb1e65.html><meta property="article:published_time" content="2020-11-14T21:04:16+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:16+08:00"><meta name=Keywords content><meta name=description content="基于NB-IoT的LWM2M协议浅析"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/b1fb1e65.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>基于NB-IoT的LWM2M协议浅析</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>LWM2M 协议是 OMA 组织制定的轻量化的 M2M 协议，主要面向基于蜂窝的窄带物联网（Narrow Band Internet of Things, NB-IoT）场景下物联网应用，聚焦于低功耗广覆盖（LPWA）物联网（IoT）市场，是一种可在全球范围内广泛应用的新兴技术。具有覆盖广、连接多、速率低、成本低、功耗低、架构优等特点。</p><p>移动 OneNET 平台采用的是基于 NB-IOT 的 LWM2M 协议和 CoAP 协议实现 UE 与平台的通信，其中 LWM2M 协议为应用层协议，CoAP 协议为传输层协议。</p><p><strong>1、LWM2M 协议逻辑实体与逻辑接口</strong></p><p>(1)LwM2M 定义了三个逻辑实体：</p><p>LWM2M Server ：接入机，平台服务器接口；</p><p>LWM2M client ： 客户端，负责执行服务器 的命令和上报执行结果；</p><p>Bootstrap server ：引导机，负责 配置 LWM2M 客户端。</p><p>(2)这三个逻辑实体之间有4个逻辑接口：</p><p>Bootstrap：Bootstrap Server 通过这个接口来配置 Clinet - 比如说 LWM2M server 的 URL 地址；</p><p>Device Discovery and Registration：客户端注册到服务器并通知服务器客户端所支持的能力；</p><p>Device Management and Service Enablement： LWM2M Server 发送指令给 Client 并受到回应.；</p><p>Information Reporting：LWM2M Client 来上报其资源信息的，比如传感器温度。</p><p>这三个逻辑实体与四个逻辑接口之间的关系如下图：</p><p></p><div class=pgc-img><img alt=基于NB-IoT的LWM2M协议浅析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/704fa7d3036f4e02a02a589a132c1156><p class=pgc-img-caption></p></div><p><br></p><p><strong>2、LWM2M 协议栈</strong></p><p>Lightweight M2M 协议栈结构如下图所示：</p><p></p><div class=pgc-img><img alt=基于NB-IoT的LWM2M协议浅析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8e370b16c8ba445098786220025e6c0a><p class=pgc-img-caption></p></div><p><br></p><p>2.1 LWM2M Objects</p><p>每个 object（对象）对应客户端的某个特定功能实体。 LWM2M 规范定义了一些标准 Objects，比如：</p><p>urn:oma:lwm2m:oma:2; (LWM2M Server Object，其中‘2’为object ID)。</p><p>urn:oma:lwm2m:oma:3; (LWM2M Access Control Object，其中‘3’为object ID)。</p><p>除了 LWM2M 定义的 object，IPSO 组织也定义了一些常用传感器的 object，比如：</p><p>urn:oma:lwm2m:ext:3311；（IPSO Light Control，，其中‘3311’为 object ID）。</p><p>每个 object 可以有多个 resource，每个 resource 代表一项 object 属性或者功能。比如 object ID 为 3311 的传感器的部分resource描述如下表：</p><p></p><div class=pgc-img><img alt=基于NB-IoT的LWM2M协议浅析 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/2fc664dcc55e4fae961fbec6957ebc8b><p class=pgc-img-caption></p></div><p><br></p><p>2.2 LWM2M Protocol</p><p>LWM2M Protocol 定义了一些逻辑操作，比如 Read, Write, Execute, Create 和 Delete 等操作。通过这些逻辑操作，实现云平台与终端设备的数据交互。</p><p><strong>3、基于LWM2M协议接入移动OneNet实例</strong></p><p>在此我们使用北京奇迹物联的 AM20E 模块接入 OneNET 平台。接入之前，需要完成 OneNET 平台侧的用户注册和产品创建。</p><p>3.1 产品创建</p><p>1. 完成用户注册并登录后，进入开发者中心进行产品创建。</p><p></p><div class=pgc-img><img alt=基于NB-IoT的LWM2M协议浅析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3b6cd8c38b5a490db54f800b5c992321><p class=pgc-img-caption></p></div><p><br></p><p>2. 产品创建时，根据页面内容，填写您的产品信息。</p><p></p><div class=pgc-img><img alt=基于NB-IoT的LWM2M协议浅析 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/421e4708aac646ad9d88a6c28561aee4><p class=pgc-img-caption></p></div><p><br></p><p>3. 产品创建完成之后，添加设备，其中，AM20E 模块的 IMEI 号和 SIM 卡的 IMSI 号，可使用串口调试工具，分别通过 AT+ CGSN指令和 AT+CIMI 指令获取，并填入。</p><p></p><div class=pgc-img><img alt=基于NB-IoT的LWM2M协议浅析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/809338b6f748440ba7f25438228bc641><p class=pgc-img-caption></p></div><p><br></p><p>4. 产品创建并添加设备完成之后，可在设备管理界面看到所添加的设备，设备栏灰色表示离线状态。</p><p></p><div class=pgc-img><img alt=基于NB-IoT的LWM2M协议浅析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/74aa8b69c77a44768f0ecda32a1f044f><p class=pgc-img-caption></p></div><p><br></p><p>5. 在模块侧接入流程中，当模块收到平台侧返回的注册结果+MIPLEVENT:0,6，完成注册。设备栏将显示绿色，表示上线状态。</p><p></p><div class=pgc-img><img alt=基于NB-IoT的LWM2M协议浅析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b7b2b8e1bbd24983b298a8b4e3790cb5><p class=pgc-img-caption></p></div><p><br></p><p>3.2模块接入 OneNET 平台流程</p><p>模块完成初始化流程并成功注册网络后，接入 OneNET 平台，流程图如下所示。</p><p></p><div class=pgc-img><img alt=基于NB-IoT的LWM2M协议浅析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/81a1f59bcb2f4844b0dd0c80cfa7155e><p class=pgc-img-caption></p></div><p><br></p><p>上述模块接入 OneNET 平台流程图中，需要说明的是：</p><p>数据交互过程中，平台 READ/WRITE/EXECUTE/PARAMETER 操作请求、模块资源值上报、以及模块更新注册信息，这 3 个步骤不分先后顺序，所以未对其按顺序进行编号。</p><p>图中虚线箭头表示 OneNET 平台将返回响应结果+MIPLEVENT 给模块侧。+MIPLEVENT 返回值请参考 AT 指令集的说明。</p><p>3.3参考示例</p><p>1. 模块初始化</p><p>AT</p><p>+PBREADY</p><p></p><p>AT //AT 响应正常</p><p>OK</p><p>AT+CSQ</p><p>+CSQ: 20,99 OK//检测CSQ 正常</p><p><br></p><p>AT+CEREG?</p><p>+CEREG: 0,1 OK//模块注册网络正常</p><p></p><p>2. 模块接入 OneNET 平台，完成注册</p><p>AT+XIIC=1 OK//获取IP 地址</p><p></p><p>AT+XIIC?</p><p>+XIIC: 1,100.103.238.182 //查询IP 地址已成功获取</p><p>OK</p><p></p><p>AT+MIPLVER? //查询基础通信套件版本2.2.0</p><p>OK</p><p></p><p>AT+MIPLCREATE</p><p>+MIPLCREATE:0 //创建基础通信套件成功，返回&lt;ref>为 0，0 是基础通信套件标识，后续 AT 指令都需要使用到它</p><p>OK</p><p></p><p>AT+MIPLADDOBJ=0,3303,2,"11",6,1</p><p>//添加对象 3303，2 个实例，6 个属性。其中对象 Objectid3303 需遵守命名规范，请参考链接：</p><p>http://www.openmobilealliance.org/wp/OMNA/LwM2M/LwM2MRegistry.html，</p><p>OK</p><p></p><p>AT+MIPLOPEN=0,3600 OK</p><p>//模块请求注册</p><p>+MIPLEVENT:0,1 //OneNET 平台返回结果 BOOTSTRAP_START</p><p>+MIPLEVENT:0,2 //OneNET 平台返回结果 BOOTSTRAP_SUCCESS</p><p>+MIPLEVENT:0,4 //OneNET 平台返回结果 CONNECT_SUCCESS</p><p>+MIPLEVENT:0,6 //OneNET 平台返回结果 REG_SUCCESS</p><p>//模块侧收到上述返回值表示请求注册成功，此时，刷新OneNET 平台可看到设备显示绿色在线状态。</p><p></p><div class=pgc-img><img alt=基于NB-IoT的LWM2M协议浅析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/54803afe00fd4967bf69658120c28593><p class=pgc-img-caption></p></div><p><br></p><p>3. 模块响应 OneNET 平台 Observer 请求和 Discover 请求，完成订阅。</p><p></p><div class=pgc-img><img alt=基于NB-IoT的LWM2M协议浅析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bc5b25f55be14677b34983fdef8cd82b><p class=pgc-img-caption></p></div><p><br></p><p>+MIPLOBSERVE:0,87667,1,3303,0,-1 //OneNET 平台对象/实例Observe 请求</p><p>AT+MIPLOBSERVERSP=0,87667,1 //模块响应 Observe 请求，其中 msgid=87667 必须对应 OneNET 平台 Observe 请求消息中下发的 msgid</p><p>OK</p><p>+MIPLEVENT:0,21 //模块响应Observe 请求成功</p><p>+MIPLDISCOVER:0,153204,3303 //OneNET 平台对象 Discover 请求</p><p>+MIPLDISCOVER:0,153204,3303</p><p>AT+MIPLDISCOVERRSP=0,153204,1,34,"5700;5701;5601;5602;5603;5604;5605" OK</p><p>//模块响应Discover 请求，其中msgid=153204 必须对应 OneNET 平台 Discover 请求消息中下发的msgid。模块响应</p><p>Discover 请求时创建7 个资源，每个资源用分号“；”隔开，其中资源Resourceid 5700;5701;5601;5602;5603;5604;5605</p><p>需遵守 IPSO 规范定义，请参考链接：</p><p>http://www.openmobilealliance.org/wp/OMNA/LwM2M/LwM2MRegistry.html，</p><p>+MIPLEVENT:0,21</p><p>//平台返回 Discover 请求结果给模块，完成订阅。此时OneNET 平台上可查看到对象 3303 对应的资源列表信息。</p><p></p><div class=pgc-img><img alt=基于NB-IoT的LWM2M协议浅析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e6eee151d2d8453f8bdc0db1f670f955><p class=pgc-img-caption></p></div><p><br></p><p>4. 模块与 OneNET 平台数据交互</p><p></p><div class=pgc-img><img alt=基于NB-IoT的LWM2M协议浅析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a0a6e11f12494d5ba7f13ba102f0a3f3><p class=pgc-img-caption></p></div><p><br></p><p>+MIPLREAD:0,21459,3303,0,5700</p><p>//平台请求指定资源（此处指Resourceid 5700）的READ 请求</p><p>AT+MIPLREADRSP=0,21459,1,3303,0,5700,4,5,20.22,0,0</p><p>//模块响应平台 READ 请求，其中msgid=21459 必须对应 OneNET 平台 READ 请求消息中下发的 msgid，4 表示 float 数据类型。模块将资源值 20.22 返回给OneNET 平台侧。</p><p>OK</p><p>+MIPLEVENT:0,21</p><p>//平台请求指定资源（此处指Resourceid 5605）的 EXECUTE</p><p>+MIPLEXECUTE:0,11671,3303,0,5605,5,"reset</p><p>AT+MIPLEXECUTERSP=0,11671,2/模块执行 EXECUTE 请求</p><p>OK</p><p>+MIPLEVENT:0,21 //模块收到平台返回的响应结果</p><p>AT+MIPLNOTIFY=0,77861,3303,0,5700,4,4,23.5,0,0 OK</p><p>//模块向平台侧上报指定资源值，此处上报 float 类型的值 810.56 给Resourceid 5700，其中 msgid=129584 必须对应</p><p>前面 OneNET 平台 Observer 请求消息中下发的 msgid。</p><p>+MIPLEVENT:0,26</p><p>//模块收到平台返回的响应结果，上报资源值成功，点击“操作”的详情按钮，可看到上报资源值的数据流。</p><p>//模块收到平台返回的响应结果，刷新OneNET 平台，可看到实例 0，资源 5700 的属性值更新为 20.2199999。</p><p></p><div class=pgc-img><img alt=基于NB-IoT的LWM2M协议浅析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/94b9271e5e764e03ae22544cd1b172fd><p class=pgc-img-caption></p></div><p><br></p><p>AT+MIPLUPDATE=0,3600,1//模块更新注册信息</p><p>+MIPLEVENT:0,11//模块收到平台返回的响应结果，更新注册信息成功</p><p></p><div class=pgc-img><img alt=基于NB-IoT的LWM2M协议浅析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7cd8a7ed35904df0b556c4b93db4e153><p class=pgc-img-caption></p></div><p><br></p><p>5. 模块删除对象</p><p></p><p>AT+MIPLDELOBJ=0,3303 OK</p><p></p><p>6. 模块请求注销</p><p></p><p>AT+MIPLCLOSE=0 OK</p><p>+MIPLEVENT:0,15</p><p></p><p>7. 删除基础通信套件</p><p></p><p>AT+MIPLDELETE=0 OK</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'NB','IoT','LWM2M'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>