<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>无需If-Else语句，状态模式即可编写干净可维护的代码 | 极客快訊</title><meta property="og:title" content="无需If-Else语句，状态模式即可编写干净可维护的代码 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/d31e7c970ad64665a37b825d6d87979f"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b428f2f6.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b428f2f6.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b428f2f6.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b428f2f6.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b428f2f6.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b428f2f6.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b428f2f6.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b428f2f6.html><meta property="article:published_time" content="2020-11-14T21:05:50+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:50+08:00"><meta name=Keywords content><meta name=description content="无需If-Else语句，状态模式即可编写干净可维护的代码"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/b428f2f6.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>无需If-Else语句，状态模式即可编写干净可维护的代码</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><blockquote class=pgc-blockquote-abstract><p>全文共1316字，预计学习时长5分钟</p></blockquote><p><br></p><div class=pgc-img><img alt=无需If-Else语句，状态模式即可编写干净可维护的代码 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d31e7c970ad64665a37b825d6d87979f><p class=pgc-img-caption>图源：unsplash</p></div><p><br></p><p>If-Else语句我们再熟悉不过了，你可能看过无数的相关教程，读过很多编程书籍，来提升将If-Else用作de facto分支技术的方法，甚至可能你的默认模式就是使用If-Else。</p><p><br></p><p>可以结束这一切了。在任何新的条件要求下，使用If-Else都会增加复杂性。用状态对象来代替If-Else吧。应用状态模式，你只需使用专用状态对象而无需使用If-Else语句来更改对象行为。</p><p><br></p><p>像下面这样的代码时代已经一去不复返了：</p><p><br></p><div class=pgc-img><img alt=无需If-Else语句，状态模式即可编写干净可维护的代码 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d683e61333df4734be550a04970eb491><p class=pgc-img-caption>触发PTSD警告</p></div><p><br></p><p>你肯定曾经写过更复杂的分支，我也曾是这么做的。上面的分支逻辑甚至还不是很复杂，但如果尝试添加新条件，事情肯定会越弄越糟。</p><p><br></p><p>另外，如果你认为创建新类而非简单地使用分支语句听起来很烦人，那么请一定等到实际使用的时候，你会发现这种方法简洁而优雅。除了“ D”部分之外，它还将使你的代码库更加扎实。</p><p><br></p><div class=pgc-img><img alt=无需If-Else语句，状态模式即可编写干净可维护的代码 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c64b9d605d90435392d8a61972973a28><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>那么如何避免混乱的分支代码呢？</h3><p><br></p><p>我们将研究如何在生产就绪代码中替换If-Else分支。这是一个虚构的例子，但是方法与我在大型客户的代码库中使用的方法相同。</p><p><br></p><p>创建一个非常简单的Booking类，其中包含一些状态。它还有两个公共方法：Accept()and Cancel().。我尽力绘制了一个图表，显示了预订可能处于的不同状态。</p><p><br></p><div class=pgc-img><img alt=无需If-Else语句，状态模式即可编写干净可维护的代码 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/43383ad5057d4c69b03bc219da784241><p class=pgc-img-caption></p></div><p>代码中重构分支逻辑的过程一共有三步：</p><p><br></p><p>· 创建一个抽象基类</p><p>· 将每个状态实现为继承自基本状态的单独类</p><p>· 让Booking`类具有私有或内部方法，该方法以状态基类为参数</p><p><br></p><div class=pgc-img><img alt=无需If-Else语句，状态模式即可编写干净可维护的代码 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c64b9d605d90435392d8a61972973a28><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>演示时间到！</h3><p><br></p><p>首先，需要一个将继承所有状态的基类。</p><p><br></p><div class=pgc-img><img alt=无需If-Else语句，状态模式即可编写干净可维护的代码 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ad78e17d3303451eaaa8f32f34679af2><p class=pgc-img-caption></p></div><p>请注意，该基类还具有两种方法，Accept和Cancel——尽管此处将它们标记为内部。此外，基态具有“特殊” EnterState(Booking booking)方法。每当将新状态分配给预订对象时，就会调用此方法。</p><p><br></p><p>其次，为要代表的每个状态创建单独的类。</p><p><br></p><div class=pgc-img><img alt=无需If-Else语句，状态模式即可编写干净可维护的代码 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d0f10c76bf9244f0a7a0cae612b21709><p class=pgc-img-caption></p></div><p>注意，如上图所示，每个类如何表示一个状态。此外，ExpiredState和CancelledState不会将预订转换为新状态。这两类在本质上与Null Object Pattern非常相似。</p><p><br></p><p>最后，预订类型本身。</p><p><br></p><div class=pgc-img><img alt=无需If-Else语句，状态模式即可编写干净可维护的代码 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d7a4af1a1db3430db4d04b2d9c617f4c><p class=pgc-img-caption></p></div><p>看到预订类型如何简单地将Accept和Cancel的实现委派给其状态对象了吗？这样做可以使我们删除许多条件逻辑，并使每个状态仅关注对自己重要的事情，当前状态也有机会将预订过渡到新状态。</p><p><br></p><div class=pgc-img><img alt=无需If-Else语句，状态模式即可编写干净可维护的代码 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c64b9d605d90435392d8a61972973a28><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>Q&A</h3><p><br></p><p><strong>如何处理新的条件功能？</strong></p><p><br></p><p>如果说通常需要使用某些条件检查来实现新功能，那么现在只需创建一个新的状态类即可，你将不再需要费力地处理if-else语句了。</p><p><br></p><p><strong>如何将状态对象保留在数据库中？</strong></p><p><br></p><p>不，你不想。</p><p><br></p><p>当将对象保存到例如SQL或NoSQL数据库时，状态对象并不重要，这时只有了解对象的状态及其应如何映射到列是重要的。你可以将状态映射到友好类型名称，枚举或整数。只要你愿意，总有某种方法可以将保存的值转换回状态对象。</p><p><br></p><p><strong>但是你还在使用If’s吗？</strong></p><p><br></p><p>它们是必不可少的，特别是当用作保护子句时。但If-Else组合是造成可维护性难题的根本原因。</p><p><br></p><div class=pgc-img><img alt=无需If-Else语句，状态模式即可编写干净可维护的代码 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5caf80d046f44e9a97ddbbe435971cc1><p class=pgc-img-caption>图源：unsplash</p></div><p><br></p><p>复杂性不是源于你拥有的类的数量，而是源于这些类承担的功能。拥有许多专门的类将使你的代码库更具可读性与可维护性，并且从总体上来说，也更易于使用。</p><p><br></p><p>适时地和If-Else语句说再见吧！</p><div class=pgc-img><img alt=无需If-Else语句，状态模式即可编写干净可维护的代码 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/662ffc631f6d4f48b1700bc33e890eca><p class=pgc-img-caption></p></div><p><strong>留言点赞关注</strong></p><p><strong>我们一起分享AI学习与发展的干货</strong></p><p>如转载，请后台留言，遵守转载规范</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'无需','Else','语句'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>