<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道 | 极客快訊</title><meta property="og:title" content="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/6f9358ff1e3442f6892b4a52cf4c818b"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b45161d.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b45161d.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b45161d.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b45161d.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b45161d.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b45161d.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b45161d.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b45161d.html><meta property="article:published_time" content="2020-10-29T21:06:37+08:00"><meta property="article:modified_time" content="2020-10-29T21:06:37+08:00"><meta name=Keywords content><meta name=description content="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/b45161d.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><blockquote><p>全文共<strong>3944</strong>字，预计学习时长<strong>12</strong>分钟</p></blockquote><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6f9358ff1e3442f6892b4a52cf4c818b><p class=pgc-img-caption>图源：Unsplash</p></div><p>今天，小芯给大家带来的是如何使用一个名为pdpipe的小库，通过Pandas 数据帧创建直观且有用的管道。</p><p>这是一个很有意思的项目。</p><p>事不宜迟，我们开始吧~<br></p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/7fbce56143b540cead89aba7b8a87ebb><p class=pgc-img-caption></p></div><p><strong>基础知识介绍：</strong></p><p>Pandas是Python生态系统中一个十分强大的库，它用于数据分析和机器学习领域。它们在Excel/CSV文件和SQL表所在的数据世界，和Sciki-learn或TensorFlow发挥其魔力的建模世界之间搭建起完美的桥梁。</p><p><br></p><p>数据科学流通常由一系列步骤构成——数据集必经过清理、缩放和验证，以备强大的机器学习算法使用。</p><p><br></p><p>当然，这些任务可以通过Pandas等软件包提供的许多单步函数/方法来完成，但更好的方法是使用管道。几乎所有情况下，管道通过自动执行重复的任务，不仅减少了出错的概率，还节省了时间。</p><p><br></p><p>在数据科学领域，R语言中的-dplyr和Python生态系统中的Scikit learn是两个典型实例，用以说明具有管道特征的软件包。</p><p><br></p><h3 class=pgc-h-arrow-right>数据科学流通常由一系列步骤构成——必须对数据集进行清理、缩放和验证，以备使用。</h3><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e23edff74b3c43029413e6b7e3ec5967><p class=pgc-img-caption>图源：Unsplash</p></div><p>此外，Pandas还提供了一个.pipe方法，可用于用户定义函数的类似用途。不过，本文将讨论另一个名为pdpipe的小库，它利用Pandas 数据帧专门解决管道问题。</p><p><br></p><h3 class=pgc-h-arrow-right>几乎所有情况下，管道通过自动执行重复的任务，既减少了出错的概率，还节省了时间。</h3><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/7fbce56143b540cead89aba7b8a87ebb><p class=pgc-img-caption></p></div><p><strong>用Pandas创建管道</strong></p><p><br></p><p>Jupyter notebook的例子可在笔者的Github repo中找到（Jupyternotebook can be found here in my Github repo）。来看看如何用这个库创建有用的管道。</p><p><br></p><h3 class=pgc-h-arrow-right>数据集</h3><p><br></p><p>出于演示目的，将使用美国房价数据集（从Kaggle下载）。可以在Pandas中加载数据集，其汇总的统计信息显示如下：</p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4573d3a2fa504778a0712347f3048db4><p class=pgc-img-caption></p></div><p>但是，数据集还有一个包含文本数据的“Address”字段。</p><p><br></p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/12104f7471254c0abf654da271b72783><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>添加大小限定符列</h3><p><br></p><p>为了方便演示，在数据集中添加一个列来限定房子的大小，代码如下：</p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4aad85dfd061460ca0c3948e7cf79001><p class=pgc-img-caption></p></div><p>之后数据集如下所示，</p><p><br></p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3715e84c120048f7ba29af1bb5d9e57a><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>最简单的管道——一次操作</h3><p><br></p><p>从最简单的管道开始，由一个操作组成（不要担心，很快就会增加难度）。</p><p><br></p><p>假设机器学习团队和该领域专家认为大可忽略掉用于建模的Avg. Area HouseAge数据。那么，就可以从数据集中删除此列。</p><p><br></p><p>对于此任务，使用pdpipe中的ColDrop方法创建一个管道对象drop-age，并将数据帧传递至此管道。</p><p><br></p><p>import pdpipe as pdp</p><p>drop_age = pdp.ColDrop(‘Avg. Area House Age’)</p><p>df2 = drop_age(df)</p><p>果不其然，生成的数据帧如下所示，</p><p><br></p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b075111e88c0486daa73ab4d296a80b1><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>只需添加多个管道链阶</h3><p><br></p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f808eaa8217f4780a7489108a484923a><p class=pgc-img-caption>图源：Unsplash</p></div><p>只有能够进入到多个阶段时，管道才有用、实用。有多种方法可以在 pdpipe中执行此操作。不过，最简单且最直观的方法是使用运算符“+”。这就像用手连接管道一样！</p><p><br></p><p>比方说，除了删除age列之外，我们还想对House_size列进行独热编码 (one-hot-encode)，以便可以在数据集上轻松运行分类算法或回归算法。</p><p><br></p><p>pipeline = pdp.ColDrop(‘Avg. Area House Age’)</p><p>pipeline+= pdp.OneHotEncode(‘House_size’)</p><p>df3 = pipeline(df)</p><p>因此，首先使用ColDrop方法创建一个管道对象，用以删除Avg.Area House Age列。此后，只需通过常用的Python+=语法将OneHotEncode方法添加到此管道对象即可。</p><p><br></p><p>生成的数据帧如下所示。请注意，附加指示符列House_size_Medium和House_size_Small是在独热编码过程中创建而来。</p><p><br></p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/66efc783661f4722aa2a0dcfc12a14fc><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>根据行值删除一些行</h3><p><br></p><p>接下来，可能希望根据行值移除数据行。</p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8a052ced580542a8b2b85a339d22d0d0><p class=pgc-img-caption>图源：Unsplash</p></div><p>具体来说，如果有些地区房价低于25万，可能要全部删除该地区的数据。使用applybycol方法将任一用户定义的函数应用于数据帧，再使用ValDrop方法根据特定值删除行。可以很容易地将这些方法链接到管道中，便能有所选择地删除行（仍添加至现有的管道对象，它已经完成了列删除和独热编码的工作）。</p><p><br></p><p>def price_tag(x):</p><p>if x>250000:</p><p>return 'keep'</p><p>else:</p><p>return'drop'pipeline+=pdp.ApplyByCols('Price',price_tag,'Price_tag',drop=False)</p><p>pipeline+=pdp.ValDrop(['drop'],'Price_tag')</p><p>pipeline+= pdp.ColDrop('Price_tag')</p><p>第一种方法是通过应用用户定义的函数Price_tag（），根据Price列中的值标记行，</p><p><br></p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c958e102a6e2400fbfe0a991df9e674a><p class=pgc-img-caption></p></div><p>第二种方法是在Price_tag列中查找字符串drop并删除匹配的行。</p><p><br></p><p>最后，第三种方法是删除Price_tag列，清理数据帧。毕竟，这个Price_tag列只是临时用于标记特定的行，应该在用完后删除。</p><p><br></p><p>所有这些只需把多个操作阶段链接到同一管道上即可！</p><p><br></p><p>现在，可以回顾一下管道一开始对数据帧做了些什么，</p><p><br></p><p>•删除特定列</p><p>•对一个用于建模的分类数据列进行编码</p><p>•基于用户定义函数的标签数据</p><p>•根据标签删除行</p><p>•删除临时标记栏</p><p><br></p><p>这些都使用以下五行代码，</p><p><br></p><p>pipeline = pdp.ColDrop('Avg. Area House Age')</p><p>pipeline+= pdp.OneHotEncode('House_size')</p><p>pipeline+=pdp.ApplyByCols('Price',price_tag,'Price_tag',drop=False)</p><p>pipeline+=pdp.ValDrop(['drop'],'Price_tag')</p><p>pipeline+= pdp.ColDrop('Price_tag')df5 = pipeline(df)</p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/7fbce56143b540cead89aba7b8a87ebb><p class=pgc-img-caption></p></div><p><strong>Scikit-learn和NLTK阶段</strong></p><p>有许多更有用且更加直观的方法可用于数据帧操作。不过，本文只需证明，连Scikit learn和NLTK软件包中的一些操作也包含在 pdpipe 中，可用于生成非常棒的管道。</p><h3 class=pgc-h-arrow-right>Scikit-learn中的缩放估计器<br></h3><p>创建机器学习模型最常见的任务之一就是数据的缩放。Scikit-learn提供了几种不同的缩放类型，如最值缩放或标准化缩放（减去数据集的平均值，然后除以标准差）。</p><p><br></p><p>可以在管道中直接链接此种缩放操作。下面的代码演示了它的用法，</p><p><br></p><p>pipeline_scale=</p><p>pdp.Scale('StandardScaler',exclude_columns=['House_size_Medium','House_size_Small'])df6= pipeline_scale(df5)</p><p>在此，应用Scikit-learn包中的标准缩放尺度估计器将数据转换为聚类或神经网络拟合。可以有选择地排除不需要此种缩放的列，就像对指示列House_size_Medium和House_size_Small所做的那样。</p><p><br></p><p>瞧！得到缩放后的数据帧，</p><p><br></p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b8adff4621644e56a9159b153175b649><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>NLTK中的标记解析器 (Tokenizer)</h3><p><br></p><p>可以注意到，数据帧中的地址字段现在毫无用处。但是，如果可以从这些字符串中提取压缩码或状态，这些字段可能对某种可视化或机器学习任务有用。</p><p><br></p><p>为此，可以使用单词标记解析器 Word Tokenizer。</p><p><br></p><p>NLTK是用于文本挖掘和自然语言处理（NLP）的常用且强大的Python库，它提供了一系列的标记解析器方法。此处，可以使用一个这样的标记解析器来分割地址字段中的文本，并从中提取状态的名称。可以看到，状态的名称是地址字符串中倒数第二个单词。因此，以下链式管道做这项工作，</p><p><br></p><p>def extract_state(token):</p><p>returnstr(token[-2])pipeline_tokenize=pdp.TokenizeWords('Address')pipeline_state =pdp.ApplyByCols('Address',extract_state,</p><p>result_columns='State')pipeline_state_extract = pipeline_tokenize +pipeline_statedf7 = pipeline_state_extract(df6)</p><p>生成的数据帧如下所示，</p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5d8de80243d5498daf2e070add92881b><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/7fbce56143b540cead89aba7b8a87ebb><p class=pgc-img-caption></p></div><p><strong>小结</strong></p><p><br></p><p>总结一下这个演示中显示的所有操作，如下所示，</p><p><br></p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/80ae3822bcf44eaf8088dbb4dd367f4d><p class=pgc-img-caption></p></div><p>所有这些操作都可以在类似的数据集上频繁使用，在数据集准备好进行下一级建模之前，有一组简单的顺序代码块作为预处理操作执行将是非常棒的。</p><p><br></p><p>创建管道是实现序列码块统一集合的关键。Pandas是机器学习/数据科学团队在此类数据预处理任务中最广泛使用的Python库，pdpipe提供了一种简单而又强大的方法，可以使用Pandas类型的操作创建管道，这些操作可以直接应用于Pandas数据帧对象。</p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/82d399d4e75743b2b58e8ef147177553><p class=pgc-img-caption>图源：Unsplash</p></div><p>快来试试吧，为特定数据科学任务创建更强大的管道~</p><div class=pgc-img><img alt="一文教你使用pdpipe，通过Pandas 数据帧创建直观且有用的管道" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c981872190624b98baa43e8d8f18f626><p class=pgc-img-caption></p></div><p><strong>留言点赞关注</strong></p><p><strong>我们一起分享AI学习与发展的干货</strong></p><p>如转载，请后台留言，遵守转载规范</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'pdpipe','通过','Pandas'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>