<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ä½¿ç”¨Spring Bootçš„äº‹ä»¶å’Œäº‹åŠ¡ï¼Œå®¹æ˜“è¢«å¿½è§†çš„ç‚¹ï¼Œä½ æœ‰è¸©è¿‡å—ï¼Ÿ | æå®¢å¿«è¨Š</title><meta property="og:title" content="ä½¿ç”¨Spring Bootçš„äº‹ä»¶å’Œäº‹åŠ¡ï¼Œå®¹æ˜“è¢«å¿½è§†çš„ç‚¹ï¼Œä½ æœ‰è¸©è¿‡å—ï¼Ÿ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/ae11deaa7ce44232a1fa67b224125bb2"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b748ad6.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b748ad6.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b748ad6.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b748ad6.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b748ad6.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b748ad6.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b748ad6.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b748ad6.html><meta property="article:published_time" content="2020-10-29T20:50:42+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:42+08:00"><meta name=Keywords content><meta name=description content="ä½¿ç”¨Spring Bootçš„äº‹ä»¶å’Œäº‹åŠ¡ï¼Œå®¹æ˜“è¢«å¿½è§†çš„ç‚¹ï¼Œä½ æœ‰è¸©è¿‡å—ï¼Ÿ"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/b748ad6.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ä½¿ç”¨Spring Bootçš„äº‹ä»¶å’Œäº‹åŠ¡ï¼Œå®¹æ˜“è¢«å¿½è§†çš„ç‚¹ï¼Œä½ æœ‰è¸©è¿‡å—ï¼Ÿ</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><p>å¦‚æœæ‚¨è¦ä½¿ç”¨spring transactionå’Œevent publishersç¼–å†™ä»£ç ï¼Œåˆ™éœ€è¦è®°ä½ä¸€äº›è§„åˆ™ï¼š</p><ul><li>äº‹åŠ¡ç»‘å®šåˆ°ä¸€ä¸ªçº¿ç¨‹</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ‚¨è·³å‡ºæ ‡è®°ä¸º@Transactionalçš„æ–¹æ³•æ—¶ï¼Œå°†æäº¤äº‹åŠ¡</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹åŠ¡å†…éƒ¨è°ƒç”¨çš„æ‰€æœ‰æ–¹æ³•éƒ½ä½¿ç”¨å®ƒ</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹ä»¶ä¾¦å¬å™¨åœ¨è°ƒç”¨ç¨‹åºçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä½¿ç”¨ä¸è°ƒç”¨è€…ç›¸åŒçš„äº‹åŠ¡</li><li>ä¸ºäº†ç¡®ä¿åœ¨æäº¤è°ƒç”¨è€…çš„äº‹åŠ¡ä¹‹åè°ƒç”¨æ‚¨çš„æ–¹æ³•ï¼Œæ‚¨éœ€è¦ä½¿ç”¨@TransactionalEventListener</li><li>å¦‚æœæ‚¨ä½¿ç”¨@TransactionalEventListener ç„¶å è®°ä½æ‚¨éœ€è¦å¯åŠ¨ä¸€ä¸ªæ–°äº‹åŠ¡æ¥æäº¤ç›‘å¬å™¨é‡Œé¢å‘ç”Ÿçš„ä»»ä½•å†™æ“ä½œã€‚</li></ul><p>ç°åœ¨åç«¯åº”ç”¨ç¨‹åºä¸­å­˜åœ¨ä¸€ç§è¶‹åŠ¿ï¼Œå³å°†æœåŠ¡è°ƒç”¨æµæ›´æ”¹ä¸ºåŸºäºäº‹ä»¶çš„è°ƒç”¨ã€‚æˆ‘è®¤ä¸ºè¿™æ˜¯ç”±äºé¢†åŸŸé©±åŠ¨è®¾è®¡DDDæ¦‚å¿µçš„å½±å“è¶Šæ¥è¶Šå¤§ã€‚æŒ‘é€‰è¿™ç§æ–¹æ³•æœ‰æ—¶æ˜¯åˆç†çš„ï¼Œæœ‰æ—¶å®ƒåªæ˜¯â€œç‚’ä½œâ€ã€‚æˆ‘æƒ³é›†ä¸­è®¨è®ºåœ¨æ•°æ®åº“äº‹åŠ¡ä¸­å¯èƒ½é‡åˆ°çš„åŸºäºspringçš„åº”ç”¨ç¨‹åºä¸­å¼•å…¥äº‹ä»¶çš„åæœã€‚</p><div class=pgc-img><img alt="ä½¿ç”¨Spring Bootçš„äº‹ä»¶å’Œäº‹åŠ¡ï¼Œå®¹æ˜“è¢«å¿½è§†çš„ç‚¹ï¼Œä½ æœ‰è¸©è¿‡å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ae11deaa7ce44232a1fa67b224125bb2><p class=pgc-img-caption></p></div><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°çš„ä¸€ä¸ªç®€å•çš„spring bootåº”ç”¨ç¨‹åºã€‚å®ƒåŒ…å«ä¸€ä¸ªæ³¨å†Œç”¨æˆ·çš„å…¶ä½™APIç«¯ç‚¹ã€‚æ³¨å†ŒåŒ…å«ä¸¤ä¸ªæ“ä½œï¼š</p><ul><li>ä½¿ç”¨UserRepositoryæ¥å£å°†ç”¨æˆ·ä¿å­˜åˆ°æ•°æ®åº“ä¸­</li><li>åœ¨åº”ç”¨ç¨‹åºä¸­å‘å¸ƒäº‹ä»¶UserCreated</li></ul><p>æ­¤æ“ä½œå‘ç”Ÿåœ¨UserServiceä¸­çš„ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ä¸­ï¼Œè¯¥æ–¹æ³•ä»UserResourceï¼ˆspring controllerï¼‰è°ƒç”¨ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚</p><pre>@Transactional@Servicepublic class UserService { public User createUser(User user) { User savedUser = userRepository.save(user); eventPublisher.publishEvent(new UserCreated(savedUser.id)); return savedUser; }}</pre><p>è®©æˆ‘ä»¬æ‰©å±•æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ¥å¤„ç†UserCreatedäº‹ä»¶ã€‚</p><p>æˆ‘å†™äº†ä¸€ä¸ªç›‘å¬å™¨ï¼ˆUserQueueNotifierï¼‰ï¼Œå…¶èŒè´£éå¸¸ç®€å•ï¼š</p><ul><li>è®¢é˜…æ´»åŠ¨</li><li>æ ¹æ®äº‹ä»¶ä¸­çš„æ•°æ®ï¼ˆuserIdï¼‰ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·</li><li>å°†ç”µå­é‚®ä»¶å’Œç”Ÿæˆçš„æ³¨å†Œä»¤ç‰Œæ”¾å…¥jmsé˜Ÿåˆ—ï¼Œä»¥æ¨¡æ‹Ÿä¸è´Ÿè´£å‘é€æ³¨å†Œç¡®è®¤ç”µå­é‚®ä»¶çš„å¤–éƒ¨ç³»ç»Ÿçš„é€šä¿¡</li></ul><p>æ³¨æ„ç‚¹ï¼šæœ‰äº›äººä¸€çœ¼å°±è®¤è¯†åˆ°æˆ‘çš„äº‹ä»¶ä¸­åªæœ‰éƒ¨åˆ†æ•°æ®ï¼ˆuserIdï¼‰è¿åDDDè§„åˆ™ã€‚åœ¨çº¯DDDä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬åº”è¯¥å°†ç”¨æˆ·åŒ…å«åœ¨UserCreatedäº‹ä»¶ä¸­ã€‚æˆ‘æ•…æ„è¿™æ ·åšæœ‰ä¸¤ä¸ªåŸå›  - ä¸€ä¸ªæ˜¯å®ƒç®€åŒ–äº†ç¤ºä¾‹;ç¬¬äºŒä¸ªï¼Œä¹Ÿè®¸æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘åœ¨ä¸€ä¸ªä¸éµå¾ªæ‰€æœ‰DDDè§„åˆ™çš„å®é™…é¡¹ç›®ä¸­é‡åˆ°äº†è¿™æ ·çš„è§£å†³æ–¹æ¡ˆã€‚</p><pre>@Componentpublic class UserQueueNotifier { @EventListener(UserCreated.class) public void onUserCreate(UserCreated userCreated) { User user = userRepository.find(userCreated.id); user.generateToken(); userRepository.save(user); jmsTemplate.convertAndSend("emails", new EmailWithToken(user.email, user.token()).asJmsMessage()); }}</pre><p>è¦è®¢é˜…springäº‹ä»¶ï¼Œæ‚¨åªéœ€è¦ç¼–å†™ä¸€ä¸ªvoidæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†äº‹ä»¶ä½œä¸ºå‚æ•°å¹¶å°†å…¶æ ‡è®°ä¸º@EventListenerã€‚ä¸ºäº†è¯æ˜ä¸€åˆ‡éƒ½åœ¨ä¸€èµ·å·¥ä½œï¼Œä½ å¯ä»¥ä»ç±»UserResourceHbTestè¿è¡Œæµ‹è¯• ï¼ˆæµ‹è¯•åº”è¯¥æ˜¯ä¸è¨€è‡ªæ˜çš„ï¼‰ã€‚å…¶ä¸­ä¸€ä¸ªæ£€æŸ¥æ˜¯å¦åœ¨æ³¨å†Œåï¼Œé˜Ÿåˆ—ä¸­å­˜åœ¨æ­£ç¡®çš„æ¶ˆæ¯ã€‚</p><pre>@Testpublic void registerPutsEmailAndTokenOnQueue() throws Exception { JSONObject createUserJson = new JSONObject() .put("login", "dev-user2") .put("email", "dev-user2@pragmatists.pl"); api.post("users", createUserJson.toString()); String message = (String) jmsTemplate.receiveAndConvert("emails"); List&lt;String&gt; emailAndToken = newArrayList(Splitter.on(";").split(message)); assertThat(emailAndToken.get(0)).isEqualTo("dev-user2@pragmatists.pl"); assertThat(emailAndToken.get(1)).isNotEmpty();}</pre><p>Listenerï¼ˆUserQueueNotifierï¼‰é™„å¸¦äº†UserRepository æ¥å£çš„ç‰¹æ®Šå®ç°ï¼Œå®ƒåœ¨ä¸‹é¢ä½¿ç”¨äº†springæ•°æ®æ¡†æ¶ã€‚æˆ‘è°ƒç”¨äº†è¿™ä¸ªå®ç°HbUserRepositoryã€‚</p><pre>public interface UserRepository { User find(UserId userId); User save(User user);}public class HbUserRepository implements UserRepository { private final JpaUserRepository jpaUserRepository; public HbUserRepository(JpaUserRepository jpaUserRepository) { this.jpaUserRepository = jpaUserRepository; } @Override public User find(UserId userId) { return jpaUserRepository.findById(userId).orElse(null); } @Override public User save(User user) { return jpaUserRepository.save(user); }}</pre><p>è®©æˆ‘ä»¬å‡è®¾ç”±äºæŸç§åŸå› ï¼Œæ‚¨å†³å®šåˆ‡æ¢UserRepositoryæ¥å£çš„å®ç°å¹¶ä½¿ç”¨æœ¬æœºsqlã€‚æˆ‘ç§°ä¹‹ä¸ºJdbcTemplateUserRepository - å®ƒä½¿ç”¨JdbcTemplateè¿›è¡ŒæŸ¥è¯¢ã€‚</p><pre>public class JdbcTemplateUserRepository implements UserRepository {  @Override public User find(UserId userId) { return jdbcTemplate.queryForObject("SELECT * FROM USER WHERE ID = ?", new Object[]{userId.asString()}, new UserRowMapper()); } }</pre><p>åœ¨è¿™ä¸ªâ€œåŸºç¡€è®¾æ–½â€æ”¹å˜ä¹‹åï¼Œæˆ‘é‡æ–°è¿è¡Œäº†æµ‹è¯•ï¼ˆUserResourceJdbcTemplateTestï¼‰ï¼š</p><p><strong>æµ‹è¯•ç»“æœæ˜¯çº¢è‰²çš„ï¼æµ‹è¯•æ— æ³•é€šè¿‡ï¼</strong></p><p>æˆ‘å¸Œæœ›ä½ ä¹Ÿä¼šæ„Ÿåˆ°æƒŠè®¶ã€‚ä¸€åˆ‡éƒ½å½’åŠŸäºSpringçš„äº‹åŠ¡ä¼ æ’­ã€‚</p><p><strong>äº‹åŠ¡è¾¹ç•Œæ˜¯ä¸€ä¸ªçº¿ç´¢</strong></p><p>æˆ‘ä»¬éœ€è¦ä»çº¿ç´¢çš„é¡¶éƒ¨å¼€å§‹è§£é‡Šå¹¶æŸ¥çœ‹äº‹åŠ¡å¼€å§‹çš„ä½ç½®ã€‚UserServiceè¢«æ ‡è®°ä¸º@Transactionalï¼Œå› æ­¤æ–¹æ³•createUserä¸­çš„æ‰€æœ‰å†…å®¹ï¼ˆå¦‚æœåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œï¼‰éƒ½åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚é€šè¿‡å­˜å‚¨åº“ä¿å­˜ç”¨æˆ·åï¼Œæˆ‘ä»¬å‘å¸ƒäº†ä¸€ä¸ªäº‹ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘å¸ƒäº‹ä»¶æ˜¯åŒæ­¥çš„ï¼Œå› æ­¤æ‚¨å¯ä»¥æƒ³è±¡å°†æ ‡è®°ä¸º@EventListenerçš„æ‰€æœ‰æ–¹æ³•ä½“å†…è”åˆ°createUseræ–¹æ³•ä¸­ã€‚åœ¨publishEventæ–¹æ³•ä¸‹é¢ï¼Œspringåªæ˜¯å¾ªç¯éå†æ‰€æœ‰ä¾¦å¬å™¨çš„æ–¹æ³•å¹¶ç®€å•åœ°è°ƒç”¨å®ƒä»¬ã€‚æ²¡æœ‰é­”æ³•ï¼Œæ²¡æœ‰éšè—çš„å¼‚æ­¥è°ƒç”¨ã€‚</p><p>å¦‚æœäº‹ä»¶ä¾¦å¬å™¨çš„ä»£ç ä¸å®ƒçš„è°ƒç”¨è€…åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹å®ƒä¼šä¼ æ’­ç›¸åŒçš„äº‹åŠ¡ã€‚è¿™æ„å‘³ç€å½“æˆ‘ä»¬åœ¨UserQueueNotifierä¾¦å¬å™¨ä¸­è°ƒç”¨UserRepositoryä¸Šçš„findæ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ä»å¤„äºæœªæäº¤çš„äº‹åŠ¡ä¸­ã€‚åœ¨è·³å‡ºæ ‡è®°ä¸º@Transactionalçš„æ–¹æ³•åï¼Œæäº¤å°†åœ¨ç¦»å¼€ç›‘å¬å™¨ä¹‹åæ‰ä¼šå‘ç”Ÿã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•ä»æˆ‘ä»¬çš„æ•°æ®åº“ä¸­è¯»å–ç”¨æˆ·å‘¢ï¼Ÿ</p><p>è¿™æ˜¯æ£˜æ‰‹çš„éƒ¨åˆ† - å¦‚æœUserRepositoryä½¿ç”¨springæ•°æ®æä¾›çš„åº•å±‚å®ç°ï¼Œé‚£ä¹ˆå¯ä»¥æ‰¾åˆ°ç”¨æˆ·ï¼Œå› ä¸ºå®ƒå­˜å‚¨åœ¨hibernateä¼šè¯ä¸­ã€‚æˆ‘ä»¬æ ¹æœ¬ä¸è§¦åŠæ•°æ®åº“ï¼Œæˆ‘ä»¬åªæ˜¯ä»ä¼šè¯ä¸­æ£€ç´¢ç”¨æˆ·ã€‚</p><p>å¦‚æœæˆ‘ä»¬é€šè¿‡JdbcTemplateå°†å®ç°æ›´æ”¹ä¸ºç›´æ¥å¯¹æ•°æ®åº“æœ¬æœºsqlè¿›è¡ŒæŸ¥è¯¢ï¼Œé‚£ä¹ˆå½“ç„¶ä¸ä¼šåœ¨æ•°æ®åº“ä¸­æ‰¾åˆ°ç”¨æˆ·ï¼Œå› ä¸ºäº‹åŠ¡å°šæœªæäº¤ï¼è¿™å°±æ˜¯æˆ‘ä»¬è¿›è¡Œçº¢è‰²æµ‹è¯•çš„åŸå› ã€‚</p><p><strong>è¿›å…¥äº‹ä»¶ä¾¦å¬å™¨æ—¶æäº¤äº‹åŠ¡</strong></p><p>æˆ‘ä»¬èƒ½ç”¨Springæœºåˆ¶å¤„ç†è¿™ç§å¸¸è§æƒ…å†µå—ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯è‚¯å®šçš„ã€‚</p><p>éœ€è¦åœ¨æ–¹æ³•æ ‡è®°ä¸Šå¢åŠ @TransactionalEventListeneræ³¨é‡Šã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå·²å°†å±æ€§é˜¶æ®µè®¾ç½®ä¸ºTransactionPhaseã€‚AFTER_COMMITè¡¨ç¤ºå°†åœ¨æäº¤è°ƒç”¨äº‹åŠ¡æ—¶æ‰§è¡Œä¾¦å¬å™¨ä»£ç ã€‚</p><pre>@Componentpublic class UserQueueNotifier { @EventListener(UserCreated.class) @TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT) public void onUserCreate(UserCreated userCreated) { User user = userRepository.find(userCreated.id); user.generateToken(); userRepository.save(user); jmsTemplate.convertAndSend("emails", new EmailWithToken(user.email, user.token()).asJmsMessage()); }}</pre><p><strong>æäº¤åæ˜¯å¦ä¼ æ’­äº†äº‹åŠ¡ï¼Ÿ</strong></p><p>é—®é¢˜æ˜¯ï¼šå½“æˆ‘ä»¬çš„ä¾¦å¬å™¨ä»£ç åœ¨æäº¤åæ‰§è¡Œæˆ–æˆ‘ä»¬æ˜¯å¦éœ€è¦æ‰“å¼€ä¸€ä¸ªæ–°ä»£ç æ—¶ï¼Œæˆ‘ä»¬ä»å¤„äºäº‹åŠ¡ä¸­å—ï¼Ÿå¦‚æœæˆ‘ä»¬åœ¨ä¾¦å¬å™¨ä¸­ç¼–å†™ä¸€äº›å†™æ“ä½œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p>å…³äºSpringæ–‡æ¡£äº‹åŠ¡åŒæ­¥,æˆ‘ä»¬éœ€è¦é˜…è¯»çš„æ–‡æ¡£ã€‚æ–‡æ¡£è¯´â€œåœ¨äº‹åŠ¡æäº¤åè°ƒç”¨ã€‚å¯ä»¥åœ¨ä¸»è¦äº‹åŠ¡æˆåŠŸæäº¤åç«‹å³æ‰§è¡Œè¿›ä¸€æ­¥çš„æ“ä½œã€‚â€œä½†æœ€é‡è¦çš„éƒ¨åˆ†æ¥è‡ªäºæ­¤ã€‚â€œäº‹åŠ¡å°†å·²ç»æäº¤ï¼Œä½†äº‹åŠ¡èµ„æºå¯èƒ½ä»ç„¶æ˜¯æ´»åŠ¨çš„å’Œå¯è®¿é—®çš„ã€‚å› æ­¤ï¼Œæ­¤æ—¶è§¦å‘çš„ä»»ä½•æ•°æ®è®¿é—®ä»£ç ä»å°†â€œå‚ä¸â€åŸå§‹äº‹åŠ¡ï¼Œå…è®¸å®ƒæ‰§è¡Œä¸€äº›æ¸…ç†ï¼ˆæ¯”å¦‚ä¸å†æ‰§è¡Œä»»ä½•æäº¤ï¼ï¼‰ï¼Œé™¤éå®ƒæ˜ç¡®å£°æ˜å®ƒéœ€è¦åœ¨å•ç‹¬çš„äº‹åŠ¡ä¸­è¿è¡Œâ€ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬çš„æƒ…å†µæ˜¯åœ¨ä¸€ä¸ªäº¤æ˜“ä¸­ï¼Œä½†æäº¤å°†ä¸ä¼šå®Œæˆï¼ï¼Ÿè¿™å¾ˆå¥‡æ€ªï¼Œä½†æ–‡æ¡£é™„å¸¦äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬éœ€è¦å£°æ˜è¿™éƒ¨åˆ†ä»£ç å°†åœ¨æ–°äº‹åŠ¡ä¸­è¿è¡Œã€‚å®ƒå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°ï¼š</p><ul><li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Transactionalï¼ˆpropagation = Propagation.REQUIRES_NEWï¼‰å¯åŠ¨æ–°äº‹åŠ¡</li><li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„@Transactionalï¼Œä½†ç”±äºäº‹åŠ¡æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ä¼ æ’­çš„ï¼Œæˆ‘ä»¬éœ€è¦è¿è¡Œä¸€ä¸ªæ–°çš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ–¹æ³•ä¸Šä½¿ç”¨@Asyncæ³¨é‡Š</li></ul><p>åœ¨æˆ‘çš„ç®€å•ç¤ºä¾‹ä¸­ï¼Œæˆ‘å†³å®šä½¿ç”¨ç›¸åŒçš„çº¿ç¨‹å¹¶åœ¨é‚£é‡Œå¼€å§‹æ–°çš„äº‹åŠ¡ã€‚é€‰æ‹©ç¬¬äºŒç§æ–¹æ³•éœ€è¦é‡å†™æµ‹è¯•ï¼Œå¿…é¡»èƒ½å¤Ÿç­‰å¾…è¿™ä¸ªæ–°çº¿ç¨‹å®Œæˆã€‚</p><p>è¦åœ¨ä¾¦å¬å™¨ä¸­æäº¤äº‹åŠ¡ï¼Œè¯·åœ¨UserResourceTestä¸­çš„registeredUserHasTokenGeneratedæ–¹æ³•ä¸­åˆ é™¤@Ignoreã€‚é™¤éåœ¨ä¾¦å¬å™¨æ–¹æ³•ä¸Šæ·»åŠ @Transactionalï¼ˆpropagation = Propagation.REQUIRES_NEWï¼‰ï¼Œå¦åˆ™æµ‹è¯•åº”è¯¥æ˜¯å¤±è´¥çš„ï¼Œå› ä¸ºæœªæäº¤å†™å…¥æ•°æ®åº“ï¼ˆuserRepository.saveï¼‰ã€‚</p><p><strong>æ„Ÿè°¢æ‚¨çš„è§‚çœ‹ï¼Œå–œæ¬¢çš„å°ä¼™ä¼´å¯ä»¥ç‚¹ä¸ªèµï¼ï¼ï¼ä¸“æ³¨Javaã€å¤§æ•°æ®çŸ¥è¯†å¹²è´§åŠç›¸å…³é¢†åŸŸåŠ¨æ€åˆ†äº«ï¼Œè¯·å¤šå¤šå…³æ³¨å“¦ï¼</strong></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Spring','Boot','äº‹åŠ¡'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>