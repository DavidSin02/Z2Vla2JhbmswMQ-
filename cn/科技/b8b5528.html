<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>文本搜索神器Grep | 极客快訊</title><meta property="og:title" content="文本搜索神器Grep - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/06f967c17abb43d592698a2a4a48a267"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b8b5528.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b8b5528.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b8b5528.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b8b5528.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b8b5528.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b8b5528.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b8b5528.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b8b5528.html><meta property="article:published_time" content="2020-10-29T20:50:14+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:14+08:00"><meta name=Keywords content><meta name=description content="文本搜索神器Grep"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/b8b5528.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>文本搜索神器Grep</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><br></p><p>假设有一个文件（或一堆文件），并且想要在这些文件中搜索特定的字符串或配置关键字。Windows下，你可能会打开这些文件用搜索框（CTRL+F）输入关键字点搜索，这很麻烦而且还不能随心所欲的搜。在Linux就不同了，我们可以用Grep，可以用正则表达式随心所欲的搜，不仅可以搜一个文件，还可以搜一堆文件。搜索的入口和出口可以对接上管道，搜索别的工具的结构或者把搜索结果传递给其他工具用。</p><div class=pgc-img><img alt=文本搜索神器Grep onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/06f967c17abb43d592698a2a4a48a267><p class=pgc-img-caption></p></div><p>今天我们就来讲Linux Shell下的文本处理三剑客之Grep。为了了解其用法最简便方法是使用系统帮助和man:</p><div class=pgc-img><img alt=文本搜索神器Grep onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/9e522d092a5840669af888eea1b496f1><p class=pgc-img-caption></p></div><p><br></p><div class=pgc-img><img alt=文本搜索神器Grep onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7d27b38ac565436fa56826199709ce5e><p class=pgc-img-caption></p></div><p>其中man的比较详细，来自于其帮助手册,在linux（centos为例）下查询内置命令帮助手册的方法是用<strong>rpm -qd grep</strong></p><p>-q表示查询；-d表示列出其文档（document）:</p><p><strong>rpm -qd grep</strong></p><div class=pgc-img><img alt=文本搜索神器Grep onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/26a35bf62be84b719ff359fe8f690b93><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>grep基础</h1><p>在开始之前，我们以centos自带的字典文件为范例，该文件位于/usr/share/dict/words</p><p>wc /usr/share/dict/words</p><p>479829 479829 4953699 /usr/share/dict/words</p><p>文件包含48万个单词，一行一个单词，由centos的word包提供。grep 也有一个-c(--count)选项对搜索匹配的行进行统计，我们先来用他来统计下它的单词树</p><p>grep --count '.' /usr/share/dict/words</p><p>479829</p><p>这和wc的结果一样。</p><p>搜索中我们制定了模式为".",表示搜索包含至少一个字符，空格，空格，制表符等的行。</p><h1 class=pgc-h-arrow-right>grep正则表达式基础</h1><p>grep最重要两个优点：一个是搜索相当快，一个是支持正则表达式（RE,regexes）。正则表达式让grep变得更强大。所以我们首先要介绍下正则表达式基础。</p><h1 class=pgc-h-arrow-right>开头</h1><p>假设我们想搜以C开头单词，我们需要要使用正则模式的开头模式:(^)加一个开头字符。比如：</p><div class=pgc-img><img alt=文本搜索神器Grep onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/54f5887959294b20b83d38f5b23750d8><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>结尾</h1><p>要搜索以特定字符结尾的模式，使用符号($)表示字符串的结尾。比如要搜索以sth结尾的单词</p><p>grep 'sth$' /usr/share/dict/words</p><div class=pgc-img><img alt=文本搜索神器Grep onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/69a4f3d43dda4e2fb43cd02de23d3a70><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>其他RE模式</h1><p>正则表达式语法很复杂，而且各个系统可能略有差异，具体需要参考对应文档，grep中常用的语法还有：</p><p><strong>.</strong> 表示单个字符</p><p><strong>* </strong>表示其之前字符出现0次或者多次，比如.*表示任意字符。</p><p><strong>+ </strong>表示其之前字符出现1个或者多个。注意这个只在强化的egrep或者grep -E下可用。基本grep下要用\+</p><p><strong>?</strong> 表示其之前字符出现0个或者一个。基本grep下要用\?</p><p><strong>{}</strong>表示之前字符出现的次数限定，比如：{n} n次，{n，m}n到m次，{n,}至少n次，{0，m}最多m次。grep下要用\{n\}</p><p><strong>[a-z] [0-9]</strong> 表示a~z,0~9的范围。</p><p><strong>[^] </strong>取反，表示匹配除了范围之外的模式。</p><p><strong>\&lt;, \b</strong>: 词首，<strong>\>, \b</strong>：词尾。</p><p><strong>() </strong>表示分组。基本grep下要用\(\)。</p><p><strong>| </strong>表示逻辑或，匹配多个表达式的任何一个。基本grep下要用\|</p><h1 class=pgc-h-arrow-right>清除注释（-v）</h1><p>前面初窥grep的门道，我们接着以一些实例来说明写grep的具体应用。我们知道在linux下很多配置文件都包含了大量的注释（#开头的行），解释很详尽，但是一般我们不愿去仔细了解，所以希望浏览时候去除掉。我们以ntp.conf为例：</p><p>cat /etc/ntp.conf</p><div class=pgc-img><img alt=文本搜索神器Grep onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6fb1dfba6b6f4da2b41215dde0a08a2b><p class=pgc-img-caption></p></div><p>grep 的-v选项表示排除模式，表示显示所有不匹配的内容，比如要去除ntp.conf中的注释我们使用：</p><p>grep -v '^#' /etc/ntp.conf</p><div class=pgc-img><img alt=文本搜索神器Grep onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/80a265cff42945e482919895d71049a7><p class=pgc-img-caption></p></div><p>上面所有注释行都用空行了，显示清晰了一点，但是看着也有点别扭，不是吗？</p><p>那我们就想办法去掉空行，方法也简单就是用管道对接到另一个grep，再去除掉空行($)</p><p>grep -v '^#' /etc/ntp.conf |grep -v '^$'</p><div class=pgc-img><img alt=文本搜索神器Grep onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b9b7d5212848410987d77ee3c11ffc7f><p class=pgc-img-caption></p></div><p>OK，这下清爽多了。</p><h1 class=pgc-h-arrow-right>仅输出/et /passwd用户名（-o）</h1><p>为了演示grep的功能和正则表达式的用法，我们需要解析/etc/passwd文件并仅打印用户名。</p><p>cat /etc/passwd</p><div class=pgc-img><img alt=文本搜索神器Grep onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/91a84cd1bef84ab6bb023f005f8a67f0><p class=pgc-img-caption></p></div><p>文件中各行的字段具体含义：</p><p>&lt;name用户名>:&lt;明码密码，现在都为x表示在shadow加密保存>:&lt;UID>:&lt;GID>:&lt;GECOS用户备注信息>:&lt;用户目录>:&lt;shell></p><p>为了仅输出用户名，可以使用如下查询</p><p>grep -o '^[a-zA-Z_-]\+' /etc/passwd</p><div class=pgc-img><img alt=文本搜索神器Grep onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3259ad079cfd4f3693f7fcf111c94f9d><p class=pgc-img-caption></p></div><p>在上面的grep命令中，我们使用了grep -o（--only-matching）选项，表示仅显示匹配&lt;PATTERN>的行那部分。</p><h1 class=pgc-h-arrow-right>显示临近行（-C,-A,-B）</h1><p>我们在查看日志时候，有时不能只看匹配的行，而需要上下文信息。grep也提供了这样的功能，显示匹配行之前或者之后的行。这在故障排查过程中非常有用，你再也不需要打开文章，定位，然后再看上下文了。</p><p><strong>-C n</strong> 表示打印匹配行及前后n行的信息。此处-C可以省略,用-n</p><p><strong>-A n</strong>表示打印匹配行及之后n行的信息。</p><p><strong>-B n</strong>表示打印匹配行及之前n行的信息。</p><p>比如我们搜索tomcat catalina.out日志中的严重错误，可以用：</p><p>grep 'SEVERE: Error' catalina.out</p><div class=pgc-img><img alt=文本搜索神器Grep onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c90078f0d95d4022b3c17c8722b5573d><p class=pgc-img-caption></p></div><p>由于缺乏上下文，具体信息无法获取。这时候就可以使用-C</p><p>grep -20 'SEVERE: Error' catalina.out</p><p>这样可以获取完成错误信息进行错误定位：</p><div class=pgc-img><img alt=文本搜索神器Grep onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1db4985fba3d465fad5bc5c94499e6d0><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>搜索二进制文件（-a）</h1><p>grep 是一个文本三剑客之一，但是文本剑客并不意味着他就只能处理文本文件了。实际上对二进制文件也是可以的。这就是grep的-a(--binary-files=text)选项，可以对二进制的文本进行搜索和显示。这在安全领域很有用，比如有时候需要对某些文件判断是否有害，是否有木马，可以简单用grep搜索其特征即可。我们举个例子比如，对一个java class文件x.class，我们用javap解析这个类文件</p><p>javap x.class</p><div class=pgc-img><img alt=文本搜索神器Grep onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/07bbd52b896044b5ba1151e4822c9d80><p class=pgc-img-caption></p></div><p>我们用grep –a查看：</p><p>grep -a '.' x.class</p><div class=pgc-img><img alt=文本搜索神器Grep onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a59e7a01fc6f40e9881d7ea131c7296f><p class=pgc-img-caption></p></div><p>有World，我们用他做关键字搜索</p><p>grep -ia 'world' x.class</p><p>就能搜到结果：</p><p>ello World,..</p><p>java/lang/Objectjava/lang/SystemoutLjava/io/PrintStream;java/io/PrintStreamprintln(Ljava/lang/String;)</p><p>注意上面用了-i选项，表示忽略大小写，也是常用的grep选项之一。</p><h1 class=pgc-h-arrow-right>总结</h1><p>本文我们介绍了Linux下的shell三剑客之一，文本搜索神器grep，希望能对大家有所帮助。其他两个剑客是流式文本处理工具sed 和awk语言，以后有机会我们再做介绍。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Grep','神器','文本'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>