<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Linux技巧：在代码中设置终端字符显示颜色和移动光标位置 | 极客快訊</title><meta property="og:title" content="Linux技巧：在代码中设置终端字符显示颜色和移动光标位置 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/9bde2c83315847498e4b848f524e429c"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b95dde80.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b95dde80.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b95dde80.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b95dde80.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b95dde80.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b95dde80.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b95dde80.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b95dde80.html><meta property="article:published_time" content="2020-11-14T21:05:00+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:00+08:00"><meta name=Keywords content><meta name=description content="Linux技巧：在代码中设置终端字符显示颜色和移动光标位置"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/b95dde80.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Linux技巧：在代码中设置终端字符显示颜色和移动光标位置</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>本篇文章介绍如何在代码中使用 ANSI 转义码来设置终端的字符显示颜色、移动光标位置等，并实现一个进度条百分比跳变的效果。</p><h1 class=pgc-h-arrow-right>ANSI 转义码</h1><p>在 Linux 中，可以使用 <strong class=highlight-text>ANSI 转义码（ANSI escape codes）</strong>设置终端的字符显示颜色、移动光标位置、清除字符显示等。</p><p>ANSI 转义码是由终端自身支持，独立于编程语言之外，可以在 C 语言、Java、Python、或者 Shell 中使用。</p><p>下面以 bash shell 为例来说明如何使用 ANSI 转义码。</p><h1 class=pgc-h-arrow-right>ANSI 转义码格式</h1><p>ANSI 转义码由一串 ASCII 编码的字符串组成，要求以 ASCII 编码的 Escape 字符和 [ 字符开头，后面跟着具体的转义码，指定相应的操作。基本格式如下：</p><pre><code>Esc[escape code</code></pre><p>Escape 字符也就是 Esc 键对应的字符。</p><p>由于按 Esc 键，不会得到一个可显示的字符，需要用具体的编码值来表示这个字符。</p><p>在不同编程语言中，表示字符编码值的写法可能不一样。一般常用 \e 转义字符来表示 Esc 字符。</p><h1 class=pgc-h-arrow-right>使用 echo 命令测试 ANSI 转义码</h1><p>在 bash shell 中，可以使用 echo 命令的 -e 选项来测试 ANSI 转义码。</p><p>查看 man echo 对 -e 选项说明如下：</p><blockquote class=code-line><p><strong>-e</strong></p><p>enable interpretation of backslash escapes.</p><p>If -e is in effect, the following sequences are recognized:</p><p><strong>\e</strong></p><p>escape</p><p><strong>\0NNN</strong></p><p>byte with octal value NNN (1 to 3 digits).</p></blockquote><p>即，在 echo 命令中，-e 选项可以指定处理转义字符。</p><p>\e 转义字符表示 escape 字符。</p><p>\0NNN 转义字符使用八进制来获取 NNN 编码值对应的字符。</p><p>在 ASCII 编码中，Escape 字符对应的八进制值是 033。</p><p>则在 echo 命令中，\033 表示 escape 字符。</p><p>使用 echo 命令测试 ANSI 转义码时，可以写为 echo -e "\033[31m"。</p><p>这里的 31m 转义码表示要把终端字符的前景色设成红色。</p><p>Linux 的 printf 命令也可以输出 ANSI 转义码，而且不需要加 -e 选项，例如写为 `printf "\e[31m"。</p><p><strong>注意</strong>：这里需要用双引号、或者单引号把 \033[31m 括起来，避免 bash 自身对 \ 进行转义，会去掉 \ 字符，导致 echo 命令收不到 \ 字符，无法处理转义字符。</p><p>也可以写为 echo -e "\e[31m"，\e 也表示 escape 字符。</p><p>后面测试的时候，统一使用 \e 的形式，少输入一些字符。</p><p>具体测试如下：</p><div class=pgc-img><img alt=Linux技巧：在代码中设置终端字符显示颜色和移动光标位置 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9bde2c83315847498e4b848f524e429c><p class=pgc-img-caption>使用ANSI转义码设置终端的字符显示颜色</p></div><p><strong>执行 echo -e "\e[31m" 命令后，终端的提示字符会变成红色，之后输入的字符也都会变成红色。</strong></p><p><strong>即，终端的默认字符颜色变成了红色。</strong></p><p>执行 echo -e "\e[0m" 命令重置终端属性，让终端的字符颜色变成原来的默认颜色。</p><p>这里的 0m 转义码表示重置字符显示属性。</p><p><strong>一般来说，为了不影响终端自身的显示，使用 ANSI 转义码设置某个字符串的显示颜色后，建议随后使用 0m 转义码来重置为原来的颜色。</strong></p><p>举例说明如下：</p><div class=pgc-img><img alt=Linux技巧：在代码中设置终端字符显示颜色和移动光标位置 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/11c141f02e0c4dec9c2746ffc4c2b774><p class=pgc-img-caption>只修改指定字符串的显示颜色</p></div><p>在上面命令中，\e[31m 是一个 ANSI 转义码，表示设置终端字符颜色为红色。</p><p>\e[0m 也是一个 ANSI 转义码，表示重置终端的颜色属性，会恢复成原来的颜色。</p><p>在这两个转义码中间的字符串会显示在终端上。</p><p>执行该命令后，终端的提示符会显示为原来的颜色。</p><h1 class=pgc-h-arrow-right>设置终端字符颜色的 ANSI 转义码</h1><p>下面详细说明设置终端字符颜色的 ANSI 转义码，其基本格式如下：</p><pre><code>Esc[Value;...;Valuem</code></pre><p>这里的 Value 可以提供多个值，不同值之间用分号 ‘;’ 隔开。</p><p>这些值可以分别指定字符的前景色、背景色、字符属性（粗体、下划线、反转）。它们之间的顺序不限。</p><p><strong>转义码最后以 m 字符结尾。</strong></p><p>设置字符前景色的值如下：</p><div class=pgc-img><img alt=Linux技巧：在代码中设置终端字符显示颜色和移动光标位置 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/01338ac17d1a4d498832a7204b35c284><p class=pgc-img-caption>ANSI转义码设置字符前景色</p></div><p>设置字符背景色的值如下：</p><div class=pgc-img><img alt=Linux技巧：在代码中设置终端字符显示颜色和移动光标位置 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/faa0d03720a346d49296921bbfe6343a><p class=pgc-img-caption>ANSI转义码设置字符背景色</p></div><p>设置字符属性的值如下：</p><div class=pgc-img><img alt=Linux技巧：在代码中设置终端字符显示颜色和移动光标位置 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/dc75f193787d4ab2b07be32085df87d8><p class=pgc-img-caption>ANSI转义码设置字符显示属性</p></div><p>具体举例如下：</p><div class=pgc-img><img alt=Linux技巧：在代码中设置终端字符显示颜色和移动光标位置 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/a8e7870a088c4757bd76a7ee4c000b66><p class=pgc-img-caption>设置字符串显示的前景色和背景色</p></div><p>可以看到，\e[31;44m、\e[44;31m 这两个转义码设置的字符颜色效果是一样的。所给的前景色、背景色没有要求先后顺序。</p><p>目前的大部分终端都支持 256 色，可以使用 Esc[38;5;Valuem 来设置终端字符为 256 色。这里的 Value 取值是 0-255。</p><p>例如，echo -e "\e[38;5;111mAAAAAA\e[0m" 命令设置为 111 对应的颜色。</p><p>具体的颜色取值可以查看 256 色的颜色表。网上的很多文章都有说明。这里不再列举。</p><h1 class=pgc-h-arrow-right>使用 ANSI 转义码移动终端光标</h1><p>ANSI 转义码可以用来移动终端的光标位置，从而改变字符的输出位置。</p><p>具体举例如下：</p><pre><code>$ echo -e "123456789\e[4Dabc"12345abc9</code></pre><p>在这个命令中，<strong>\e[4D 转义码表示把光标往左移动 4 列。</strong></p><p>可以看到，光标移动 4 列后，位于字符 6 所在的位置，重新输出 abc，覆盖了原来的 678 三个字符。</p><p>移动光标的具体转义码说明如下：</p><div class=pgc-img><img alt=Linux技巧：在代码中设置终端字符显示颜色和移动光标位置 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c39bb3c7c3fd4ae6a60ece6439a1e9e0><p class=pgc-img-caption>移动终端光标位置的ANSI转义码</p></div><p>上面所说的终端位置指的是终端可见的窗口位置，不包括缓冲区位置。</p><p>即，窗口显示不会发生滚动，只在当前可见的窗口区域跳转光标。</p><p><strong>注意</strong>：由于 echo 命令默认会输出换行符，导致移动光标后再次换行，会对光标移动效果造成干扰。</p><p>在测试移动光标的转义码时，建议用 printf 命令测试。该命令默认不会输出换行符。</p><p>由于 bash 里面需要按下回车才执行命令，会影响光标的左右移动效果，建议在 printf 自身输出的内容中左右移动光标。</p><p>实际测试发现，光标右移 n 列，光标会位于第 n 列的后面，之后输出的字符串会从 n+1 列开始。</p><p>Esc[C、Esc[0C、和 Esc[1C 的效果相同，都是光标右移 1 列。</p><p>类似的，Esc[D、Esc[0D、和 Esc[1D 的效果相同，都是光标左移 1 列。</p><p>使用 printf 命令测试如下：</p><pre><code>$ printf "123456789\e[1Da\n"12345678a$ printf "123456789\e[0Da\n"12345678a$ printf "123456789\e[Da\n"12345678a</code></pre><p>可以看到，使用 \e[D、\e[0D、\e[1D 往左移动光标，然后输出字符 a，都是覆盖同一个字符 9。</p><p>这三个转义码的光标移动效果相同。</p><pre><code>$ printf "123456789\e[4Da\n"12345a789$ printf "123456789\e[4D\e[Ca\n"123456a89$ printf "123456789\e[4D\e[0Ca\n"123456a89$ printf "123456789\e[4D\e[1Ca\n"123456a89</code></pre><p>\e[4D 把光标左移 4 列，移动到字符 6 的位置。</p><p>\e[C、\e[0C、\e[1C 都是往右移动光标到下一列，到字符 7 的位置，输出字符 a，覆盖了字符 7。</p><h1 class=pgc-h-arrow-right>通过移动光标实现进度百分比的效果</h1><p>我们可以通过移动光标实现进度百分比的效果。假设有一个 progress.sh 脚本，内容如下：</p><pre><code>#!/bin/bashfor ((i = 0; i &lt;= 100; ++i)); do    printf "\e[5D%3d%%" $i    sleep 0.1sdoneecho</code></pre><p>这里使用 printf 命令进行输出，以便格式化字符串。printf 命令也是使用 \e 来表示 escape 字符。</p><p>\e[5D 转义码表示把光标左移 5 列。</p><p>由于所输出的字符不超过 5 个字符，每次光标左移 5 列，都会移动到最左边，从第一列开始输出。</p><p>那么后面输出的内容会覆盖前面输出的内容，达到在同一行重复输出的效果。</p><p>sleep 0.1s 命令表示暂停 0.1 秒。添加这个语句，以便清楚地看到进度百分比跳变。否则执行过快，百分比很快就跳到 100%。</p><p>执行 progress.sh 脚本的结果如下：</p><pre><code>$ ./progress.sh100%</code></pre><p>这里不是动图，看不到进度百分比跳变。实际执行就能看到。</p><p>从结果来看，在 for 循环中多次打印信息，这些信息都打印在同一行，并覆盖前面的输出。而不是换行打印。</p><h1 class=pgc-h-arrow-right>通过移动光标实现进度条的效果</h1><p>下面通过移动光标实现进度条的效果。假设有一个 progressbar.sh 脚本，内容如下：</p><pre><code>#!/bin/bashfunction print_chars(){    # 传入的第一个参数指定要打印的字符串    local char="$1"    # 传入的第二个参数指定要打印多少次指定的字符串    local number="$2"    local c    for ((c = 0; c &lt; number; ++c)); do        printf "$char"    done}declare -i end=50for ((i = 1; i &lt;= end; ++i)); do    printf "\e[80D["    print_chars "#" $i    print_chars " " $((end - i))    printf "] %3d%%" $((i * 2))    sleep 0.1sdoneecho</code></pre><p>这个脚本定义了一个 print_chars 函数，可以多次打印同一个字符。</p><p>printf "\e[80D[" 语句把光标左移 80 列。由于这个进度条的字符总长度小于 80，会移动最左边，总是从第一列开始输出。</p><p>在 ‘80D’ 后面的 ‘[’ 字符是进度条的开头第一个字符。</p><p>print_chars "#" $i 语句递增打印多个 # 字符，形成进度条往前移动的效果。</p><p>print_chars " " $((end - i)) 语句打印多个空格，填充到指定的最后一列，让进度条的结束字符总是打印在同一列。</p><p>printf "] %3d%%" $((i * 2)) 语句打印进度条的结束字符 ]、以及进度条百分比。</p><p>sleep 0.1s 语句暂停 0.1 秒，避免执行过快，看不到进度条的移动效果。</p><p>执行 progressbar.sh 脚本的结果如下：</p><pre><code>$ ./progressbar.sh[##################################################] 100%</code></pre><p>这里不是动图，看不到进度百分比跳变。实际执行就能看到。</p><h1 class=pgc-h-arrow-right>使用 ANSI 转义码清屏、清除字符</h1><p>下面的 ANSI 转义码可以用于清屏、清除光标往后的字符。</p><div class=pgc-img><img alt=Linux技巧：在代码中设置终端字符显示颜色和移动光标位置 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/526ae2eb7f474cfdadea9abd521e7bae><p class=pgc-img-caption>ANSI转义码清除终端字符</p></div><p><strong>注意</strong>：上面的 J、K 都是大写字母。</p><p>具体举例说明如下：</p><pre><code>$ printf "123456789\e[5D\e[K\n"1234$ printf "123456789\e[5D\e[1K\n"     6789$ printf "123456789\e[5D\e[2K\n"</code></pre><p>printf "123456789\e[5D\e[K\n" 命令先光标左移 5 列，停在字符 5 的位置，然后用 \e[K 转义码从光标位置往后清除所有字符，只保留了前面的 1234 字符串。</p><p>printf "123456789\e[5D\e[1K\n" 命令使用 \e[1K 转义码从光标位置往前清除所有字符，只保留了后面的 6789 字符串。</p><p>printf "123456789\e[5D\e[2K\n" 命令使用 \e[2K 转义码清除光标所在的整行内容，输出内容为空。</p><div class=pgc-img><img alt=Linux技巧：在代码中设置终端字符显示颜色和移动光标位置 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/552c99bc-732e-4194-8f69-65ccd0707925><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Linux','代码','设置'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>