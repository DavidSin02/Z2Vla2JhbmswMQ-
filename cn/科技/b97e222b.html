<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>进程、线程、并行与并发 | 极客快訊</title><meta property="og:title" content="进程、线程、并行与并发 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/5e04293de8fb49f19388e78a9812cce4"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b97e222b.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b97e222b.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b97e222b.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b97e222b.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b97e222b.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b97e222b.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b97e222b.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b97e222b.html><meta property="article:published_time" content="2020-11-14T21:06:36+08:00"><meta property="article:modified_time" content="2020-11-14T21:06:36+08:00"><meta name=Keywords content><meta name=description content="进程、线程、并行与并发"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/b97e222b.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>进程、线程、并行与并发</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right><strong>关于Java并发</strong></h1><p>一谈到Java并发编程，我们一般就会联想起进程、线程、并行、并发等等概念。那么这些概念都代表什么呢？进程与线程有什么关系？并发与并行又是什么关系呢？</p><h1 class=pgc-h-arrow-right><strong>进程与线程</strong></h1><p>进程是指程序的一次动态执行过程，通常我们说计算机中正在执行的程序就是进程，每个程序都会对应着一个进程。一个进程包含了从代码加载到执行完成的一个完整过程，它是操作系统资源分配最小单元。</p><p>而线程则是比进程更小的执行单位，是CPU调度和分派的基本单位。每个进程至少有一个线程，反过来一个线程只能属于一个进程，线程可以对进程所有的资源进行调度和运算。线程既可以由操作系统内核来控制调度，也可以由用户程序进行控制调度。</p><p>根据下图可以看到，多个CPU会去执行这三个进程。其中每个进程都包含着至少一个线程，比如进程1包含了四个线程，进程2和进程3包含一个线程。此外，每个进程都有自己的资源，而进程内的所有线程都共享进程包含的资源。</p><div class=pgc-img><img alt=进程、线程、并行与并发 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5e04293de8fb49f19388e78a9812cce4><p class=pgc-img-caption>进程与线程</p></div><p><br></p><h1 class=pgc-h-arrow-right><strong>并发与并行</strong></h1><p>并发和并行都可以是相对于进程或是线程来说。并发是指一个或若干个CPU对多个进程或线程之间进行多路复用，用简单的语言来说就是CPU轮着执行多个任务，每个任务都执行一小段时间，从宏观上看起来就像是全部任务都在同时执行一样。并行则是指多个进程或线程同一时刻被执行，这是真正意义上的同时执行，它必须要有多个CPU的支持。如下图是并发和并行的执行时间图。对于并发来说，线程一线执行一段时间，然后线程二再执行一段时间，接着线程三再执行一段时间。每个线程都轮流得到CPU的执行时间，这种情况下只需要一个CPU即能够实现。对于并行来说，线程一、线程二和线程三是同时执行的，这种情况下需要三个CPU才能实现。并发和并行都提升了CPU的资源利用率。</p><div class=pgc-img><img alt=进程、线程、并行与并发 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/27df0d2d449247ec9bfa1e0e88d66a6e><p class=pgc-img-caption>并发与并行</p></div><p><br></p><p>而对于Java并发，就是在Java平台上实现来实现并发机制，Java平台上提供了线程以及线程并发</p><h1 class=pgc-h-arrow-right><strong>多线程能提升执行效率</strong></h1><p>前面我们了解到多线程可以实现并发和并行执行，所以多线程能提升总体的效率。如果不支持多线程的话，那么当某个执行任务进入等待阻塞状态时，则可能因为阻塞而导致运行效率低下。如下图一中，一个请求任务发起请求后则开始等待响应，此时该线程占着CPU又不干活，从整个运行线上可以看到真正运行（绿色方块）的时间很少，这就是运行效率低下。但在如果支持多线程并发的情况下，则可以在等待阻塞时去干其它的活。此外，多CPU环境下，如果一个任务能够分解成多个小任务，那么就能够用多个CPU同时执行它，这样就能以更加快的速度完成任务，毕竟单个CPU运行能力有限。如下图二中，一旦将任务分解成三个小任务后，在多CPU环境下则能够并行执行，大大减少了整体执行时间。</p><div class=pgc-img><img alt=进程、线程、并行与并发 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e0ec61eb97d44abdacd768f7abd2f973><p class=pgc-img-caption>单线程阻塞状态</p></div><p><br></p><div class=pgc-img><img alt=进程、线程、并行与并发 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ac5c3e730e8049918e5c22a39a055605><p class=pgc-img-caption>多线程并行</p></div><p><br></p><h1 class=pgc-h-arrow-right><strong>多线程能提升用户体验</strong></h1><p>多线程也能提升用户体验，如果一个线程的任务既包含耗时的任务又包含用户交互的任务，那么则可能会导致用户体验很糟糕。如下图，假如大家看到这些窗口一直在打转又无法对其进行操作，是不是很难受？一个线程发起请求后开始等待请求结果，用户界面则一直卡着没响应。我们可以通过多线程将任务分为请求任务和界面操作两部分，这样就能在请求后保持对界面操作的响应，以便提供更好的用户体验。</p><div class=pgc-img><img alt=进程、线程、并行与并发 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d76d72b65637416e92dbdb93fbe69c09><p class=pgc-img-caption>界面卡住</p></div><p><br></p><h1 class=pgc-h-arrow-right><strong>多线程让编码更难</strong></h1><p>天下没有免费的午餐，多线程也是需要付出代价的。从编写代码的角度来看，多线程使得编码变得更加复杂，本质上这是因为多线程机制与现代计算机结构所带来的。纵使在编程语言设计专家的努力下，现在有很多简化多线程编程的语言和模型，但相比於单线程来说多线程的编写仍然复杂很多。数据从主存储到CPU中间有若干层缓存和寄存器，而且多个线程可能访问共享内存，这就涉及到数据同步问题，从而增加了多线程编程的复杂性。此外，线程与线程之间的通信也比较麻烦，这也增加了多线程编码的复杂性。总之，尽管很多编程语言尝试为我们提供更便捷的多线程编程，但在语言层面仍然无法完全屏蔽掉多线程与计算机结构的复杂性，所以不管我们使用什么语言都需要为多线程的编码考虑得更多。</p><div class=pgc-img><img alt=进程、线程、并行与并发 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a8858ff33249484ea74bcba75fea2111><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>上下文切换与资源开销</strong></h1><p>多线程除了增加编码难度外，它还在执行过程中带来实际的损耗，包括资源开销和上下文切换开销。资源开销主要包括其本身占用的内存资源、执行时线程本地栈开销以及对这些线程进行管理的开销。而上下文切换开销则是因为CPU由一个线程切换到另外一个线程是需要做现场保护和现场恢复工作，包括线程标识、寄存器内存、线程状态、线程优先级、线程资源清单等等。如下图所示，假设线程一和线程二由某个CPU执行。线程一执行一段时间后将相关信息保存到现场数据结构中，而线程数据结构存放在主存储中，然后从线程二对应的现场数据结构中恢复线程二相关信息，完成现场恢复后线程二开始执行。接下去的过程反过来，由线程二切换到线程一。其中可以看到由虚线分割的两部分被标为切换开销，从完整的时序来看，这两部分并非执行线程的任务，而是消耗在了现场的保护和恢复上了，这便是上下文切换的开销。</p><div class=pgc-img><img alt=进程、线程、并行与并发 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/4c62cd169e864f4f9cbed995b1c4db2b><p class=pgc-img-caption>上下文切换</p></div><p><br></p><p>在实践中我们要综合考虑多线程的优缺点，不能一味的去追求多线程，在使用多线程之前我们必须去衡量多线程带来的好处与代价。</p><p>更多Java并发原理可关注作者下面的专栏：</p><div class=tt-column-card data-content='{"url":"","content":"","thumb_url":"http://p0.pstatp.com/large/pgc-image/6105f675e9a14c84aa68e3f754675d8b","title":"74节课彻底搞懂Java并发原理","author_description":"远洋号","price":69.9,"share_price":11.18,"sold":253,"column_id":"6729380527507243278","new_thumb_url":"http://sf1-ttcdn-tos.pstatp.com/img/pgc-image/6105f675e9a14c84aa68e3f754675d8b"}'><p class=column-placeholder></p></div><p>作者简介：笔名seaboat，擅长人工智能、计算机科学、数学原理、基础算法。出版书籍：图解数据结构与算法、Tomcat内核设计剖析、图解Java并发原理、人工智能原理科普。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'进程','线程','并行'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../cn/%E7%A7%91%E6%8A%80/79e23cb7.html alt=如何理解：程序、进程、线程、并发、并行、高并发？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/b101e22357854a56abf29c0745b5d9c9 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/79e23cb7.html title=如何理解：程序、进程、线程、并发、并行、高并发？>如何理解：程序、进程、线程、并发、并行、高并发？</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/9911d0f.html alt=程序，进程，线程与并发和并行设计实现 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/165d54ca-9361-4365-9d4b-12a56bebfc33 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/9911d0f.html title=程序，进程，线程与并发和并行设计实现>程序，进程，线程与并发和并行设计实现</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>