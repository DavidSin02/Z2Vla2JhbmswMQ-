<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>细数这些年项目中用过的配置文件（ini 篇） | 极客快訊</title><meta property="og:title" content="细数这些年项目中用过的配置文件（ini 篇） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/c8eb892214c9452aa6c3c0348522bab6"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bb28606.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bb28606.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bb28606.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bb28606.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bb28606.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bb28606.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bb28606.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bb28606.html><meta property="article:published_time" content="2020-10-29T20:59:54+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:54+08:00"><meta name=Keywords content><meta name=description content="细数这些年项目中用过的配置文件（ini 篇）"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/bb28606.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>细数这些年项目中用过的配置文件（ini 篇）</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>Java 菜鸟，会把可变的配置信息写死在代码里；Java 老鸟，会把可变的配置信息提取到配置文件中。坊间流传这么一句非科学的衡量标准，来评判程序员的级别。</p><p><br></p><p>那么，项目中的配置信息，你平时都是怎样来实现的呢？你项目中用过哪些配置文件呢？</p><p><br></p><p>近期将结合实际项目或源码，说说这些年用过的那些有关配置的奇技淫巧，看看能否帮你提高研发能力，那怕是提高一丢丢，就算成功。</p><p><br></p><h1 class=pgc-h-decimal data-index=01><strong>后缀为 .ini 的文件，你用过没？</strong></h1><p><br></p><p>后缀为 .ini 的文件，是 Initialization File 的缩写，主要用于程序的初始化的一些配置参数，后缀当然也可以是 .conf、.cfg，只是项目中习惯上用后缀 .ini 罢了。</p><p><br></p><p>简单介绍一下，一个 ini 配置文件主要由节（section）、键值对组成。</p><p><br></p><div class=pgc-img><img alt="细数这些年项目中用过的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c8eb892214c9452aa6c3c0348522bab6><p class=pgc-img-caption></p></div><p><br></p><p>如上图所示，ini 文件中，配置参数都是以节（section）为单位组合在一起的，每个节名字都被方括号包围着，像 owner、database 都被方括号括着。而每个节声明后的键值对都属于该 section，而且一个 section 没有结束标识符，一个节的开始就是上一个节的结束。</p><p><br></p><h1 class=pgc-h-decimal data-index=02>后缀为 .ini 的文件，怎么用啊？</h1><p><br></p><p>在自研框架或者业务项目开发中，往往会配置一些项目启动时要初始化的一些参数信息，例如端口、域名等等。从老项目中截取一段，其实就配置键值对而已，很简单，有没有？</p><p><br></p><div class=pgc-img><img alt="细数这些年项目中用过的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b4ebcb9951d4452498d3cd4a3a16cf0f><p class=pgc-img-caption></p></div><p><br></p><p>另外，项目研发中在面对身份验证、授权、密码和会话管理等需求时，经常会集成 Java 安全框架 Shiro，而 Shiro 就提供了使用 ini 文件，进行配置参数的能力（INI is easy to read, simple to use, and requires very fewdependencies）。</p><p><br></p><div class=pgc-img><img alt="细数这些年项目中用过的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/57be18e900004eee9b9f3d06bc73370b><p class=pgc-img-caption></p></div><p><br></p><p><strong>后缀为 .ini 的文件，怎么解析啊？</strong></p><p><br></p><p><strong>老土方法：</strong>用脚指头想出来的简单方法，往文件上插一根管子，直接采用 Properties 的 load 方法完成数据的读取，势必能达到解析的目的（脑补代码，懒得写代码啦）。</p><p><br></p><p><strong>老土方法：</strong>用手指头想出来的简单方法，往文件上插一根管子，一行一行去读，再按照等号拆分键值对，最后把键值对向 Map 放一下，必然也能达到解析的目的（脑补代码，代码懒得写啦）。</p><p><br></p><p><strong>优雅方法：</strong>看看 Shiro 咋搞的？项庄舞剑意在沛公。尝试告诉你：为什么 Java 轮子会多呢？这可能就是造轮子的其中一条路径，熟读源码，到处抄，哈哈。</p><p><br></p><h1 class=pgc-h-decimal data-index=03>看看 Shiro，人家到底怎么解析的？</h1><p><br></p><div class=pgc-img><img alt="细数这些年项目中用过的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/429a4fb233b8437f8c05518aa85c7cfe><p class=pgc-img-caption></p></div><p><br></p><p>首先，Shiro 加载配置文件支持好几种方式，我们就挑如何加载类路径下的 shiro.ini 配置文件进行剖析，掌握这一条路径，其它方式殊途同归。</p><p><br></p><div class=pgc-img><img alt="细数这些年项目中用过的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/38ace7896cc3499fbaf43c6801b4468d><p class=pgc-img-caption></p></div><p><br></p><p>如上图源码所示，在加载 shiro.ini 配置文件前，首先会判断文件是否存在，存在则从类路径下进行加载，而且会发现 Shiro 把 ini 配置封装成了 Ini 对象（<strong>这不就是面向对象吗？Java 的核心思想：Every thing is object！</strong>）。</p><p><br></p><div class=pgc-img><img alt="细数这些年项目中用过的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/a5ee4846c94048bfa8414f3f501d44f7><p class=pgc-img-caption></p></div><p><br></p><p>如上图源码所示，很显然会发现，具体读取 shiro.ini 配置的事情，就交给了 ResourceUtils 去办了（<strong>术业有专攻，分工明确，各司其职</strong>），不过和咱们能想到的土方法也差不多，就是往文件上插一根管子，然后调用 load 方法进行读取。</p><p><br></p><div class=pgc-img><img alt="细数这些年项目中用过的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2a61edf76a604423bac44545ace2b876><p class=pgc-img-caption></p></div><p><br></p><p>通过上面源码截图，发现 load 方法只是稍微装饰了一下，把 InputStream 变成了 Reader（<strong>设计模式：装饰器模式；面向对象的核心：多态</strong>）。</p><p><br></p><div class=pgc-img><img alt="细数这些年项目中用过的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/781e303b75ca43e294b7738031ed5411><p class=pgc-img-caption></p></div><p><br></p><p>看到上面的代码，会发现依然没有真正的读取，而是继续包装 Reader，变成 Scanner 来获取文件输入（敢问，有必要这么绕来绕去吗？不过，无所谓，继续往下看！）</p><p><br></p><div class=pgc-img><img alt="细数这些年项目中用过的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/eba70366260547d79050bdd1f8e4bd11><p class=pgc-img-caption></p></div><p><br></p><p>到这儿，如上面截图所示，看到了庐山真面目，终于见到了一行一行进行读取内容，并进行截取其中的 section（节），也就是 shiro.ini 中配置的 [main]、[urls] 等等，接着把每个 section 下面的内容直接拼接在一起形成字符串，而此时，并没有拆分键值对。</p><p><br></p><div class=pgc-img><img alt="细数这些年项目中用过的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/be3995ba597a4bfe941edc56a12e09f2><p class=pgc-img-caption></p></div><p><br></p><p>如上面源码所示，很显然 Shiro 把 ini 配置的组件又封装成了 Section 对象（<strong>再一次体会Java 的核心思想：Every thing is object！</strong>）。</p><p><br></p><p>不过，还记得配置文件咋配置的吗？把 shiro.ini 配置图再贴一次。</p><p><br></p><div class=pgc-img><img alt="细数这些年项目中用过的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b8bd522f54f943c8936c2f62568b5f41><p class=pgc-img-caption></p></div><p><br></p><p>我们结合下面的源码，再去看上面这个段配置，顺道看看 Section 对象里面都有啥？</p><p><br></p><div class=pgc-img><img alt="细数这些年项目中用过的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/00a8fbb4e5e44a54a65cc86bb1b202e5><p class=pgc-img-caption></p></div><p><br></p><p>如上图源码标注 1，定义了一个 Map 用于保存配置的键值对信息；代码标注 2，是把上一步的字符串转换成 Map，具体转换如下图所示，按照等号进行拆分键值对，并放到 Map中。</p><p><br></p><div class=pgc-img><img alt="细数这些年项目中用过的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/051c9f5da6d54b6d930e22decc8c1505><p class=pgc-img-caption></p></div><p><br></p><p>仔细去看源码，会发现拆分键值对时，不仅仅是按照等号，但是 who care 呢？只因为到这儿，梗概已经了解个八九不离十啦。</p><p><br></p><div class=pgc-img><img alt="细数这些年项目中用过的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f554d78e2e4b46619b9e1e7ef71e33ca><p class=pgc-img-caption></p></div><p><br></p><p>好了，剖析的差多了，从源码去看反而感觉复杂了不少，其实际使用超级之简单，和咱们用手指头想的老土方法差不多，只是 Shiro 封装的稍微好一些。</p><p><br></p><p>但是，你有没有发现，有好多代码是可以简单抽一抽，你就可以直接应用到项目中的呢？</p><p><br></p><h1 class=pgc-h-decimal data-index=04>它山之石可以攻玉</h1><p><br></p><p>它山之石可以攻玉，相信会对你有帮助！</p><p><br></p><p>行文至此，你肯定会有疑问，为什么不用 properties 啊？为什么不用 ymal 啊？其实说实话，黑猫白猫抓住老鼠都是好猫。</p><p><br></p><p>另外，为了能够帮你提高研发能力（那怕是提高一丢丢呢），后续将继续结合实际项目，看看用到的其它形式的配置文件，敬请期待。</p><p>欢迎关注「<strong class=highlight-text>一猿小讲</strong>」，了解更多精彩。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'配置文件','细数','这些'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>