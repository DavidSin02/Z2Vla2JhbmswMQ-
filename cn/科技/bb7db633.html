<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇） | 极客快訊</title><meta property="og:title" content="PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/RzxxF1A1CuI2xT"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bb7db633.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bb7db633.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bb7db633.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bb7db633.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bb7db633.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bb7db633.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bb7db633.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bb7db633.html><meta property="article:published_time" content="2020-11-14T21:05:04+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:04+08:00"><meta name=Keywords content><meta name=description content="PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇）"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/bb7db633.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇）</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>聚焦于PCIe 3.0和4.0中的动态均衡技术，本文介绍其原理、实现及其相关的一致性测试，这种动态均衡技术被称作“Link Equalization”（链路均衡，简称为LEQ）。本系列文章分上下两篇，本文是下篇实践篇，重点介绍Rx链路均衡的测试和调试，泰克公司的自动化软件为此提供了业界最优的解决方案。</p><p>另外，泰克PCI Express专家David Bouse将在4月10日（周五）13:00-16:00直播课堂【PCIExpress 5.0规范更新解读和测试揭秘】讲解如何解决PCIe 5.0的新测试挑战https://info.tek.com/cn-pcie-mofu.html。</p><p><strong>接收端链路均衡测试（Rx LEQ）</strong></p><p>在PCIe 2.0的时代，通常只要保证了发送端的信号质量，那么整个系统也就能够正常工作；因此接收端测试并不是必测项。但在PCIe 3.0/4.0中，由于速率成倍的增加；并且又经过长走线的传输，因此在接收端采用了复杂的均衡技术；因此在PCIe 3.0/4.0中接收端测试属于必测项。</p><p>泰克公司的BSX系列的误码仪是业界高性能的串行误码仪，能够实现高达32Gbps的码型发生和误码分析功能，同时其内部集成有预加重模块、噪声注入、抖动注入等，支持基于协议的握手功能。因此非常适合PCIe 3.0和4.0的接收端测试。由于BSX系列最高支持到32Gbps，因此它也可以充分地满足未来的PCIe 5.0的接收端测试的要求。图1是使用BSX系列的误码仪进行PCIe 3.0d的接收端测试的示意图。</p><img alt="PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzxxF1A1CuI2xT><p>图1 PCIe 3.0的接收端测试的示意图</p><p>在PCIe 3.0 & 4.0的接收端内部集成了复杂的单元，例如：均衡电路、时钟恢复电路、以及判决电路等；它们都是不能直接探测到的。因此，接收端对于测试人员来说，是一个黑盒子。PCI-SIG协会的规范开发人员，在面临此种困难时，开发了一套被称作“压力眼图（StressedEye）”的方法论来完成对接收端的评估。这种方法论的核心思想就是：通过向接收端施加一个严重劣化的信号（即压力眼图），来检测在此种情况下，接收端是否仍能够正确地接收信号。因此，无论是PCIe 3.0 & 4.0 Rx LEQ的测试，基本上都可以分解成三个步骤：压力眼图的校准、进入环回模式、进行误码率测试。</p><ul><li><p>压力眼图的校准就是：定量地规定这个劣化信号劣化到何种程度、以及测量该劣化信号的方法；</p></li><li><p>进入环回模式：为了检测接收端是否正确接收该信号；需要将已经接收到的信号原封不动地环回到待测的发送端；然后误码仪对这个环回的信号进行判断。因此需要让待测进入环回模式；</p></li><li><p>进行误码率测试：使用规定好的码型进行误码率测试。</p></li></ul><p>在压力眼图的校准时，涉及到信号的特性分析以及调整迭代，这些都需要反复进行，人工手动操作非常地耗时，并且吃力不讨好。为此，泰克公司提供了业界最优的PCIe Rx自动化测试软件（BSXPCI4CEM），如图2所示。通过泰克公司的PCIe Rx自动化测试软件，可以大大缩短开发人员的研发时间，提供产品的可靠性。</p><img alt="PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇）" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RzxxF2yFrpG9EH><p>图2 泰克PCIe Rx自动化软件GUI界面</p><p>对于这个压力眼图恶劣到何种程度，必须要进行精确地定量地描述，因此在PCIe的规范中，给出了这个压力眼图的要求。无论是PCIe 3.0还是PCIe 4.0，校准过程都分为两个阶段：</p><ul><li><p>TP1校准：TP1指的是整个参考信道的近端，在该处校准幅度、随机抖动Rj、正弦抖动Sj、以及Tx EQ。</p></li><li><p>TP2校准：TP2指的是整个参考信道的远端，在该处校准DMSI、CMSI、以及最终的眼高/眼宽。</p></li></ul><p>无论是PCIe 3.0，还是PCIe 4.0，TP1的校准过程都是一样的，而且较为简单；不区分待测对象是插卡还是系统板，整个拓扑连接如图3所示。</p><img alt="PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzxxF3cB3lNAnt><p>图3 PCIe 3.0 & 4.0的TP1校准拓扑连接</p><p>TP2校准则连接较为复杂，耗时较长；并且对于插卡和系统板来说，拓扑连接是不同的。而且在PCIe 3.0和PCIe 4.0中，TP2校准的策略有所不同。在PCIe 3.0中，是通过调整DMSI和Rj来达到最终的眼高/眼宽。而在PCIe 4.0中，则主要通过调整ISI来使得眼图接近最终的眼高/眼宽，这一过程为粗调；然后再通过调整Sj、DMSI、或幅度来获得最终的眼图，这一过程为细调。</p><p>PCIe 3.0的TP2校准的拓扑连接如图4所示。对于插卡的校准来说，在其拓扑连接中采用的是两连接头的拓扑结构，这是为了模拟真实的服务器背板的恶劣信道情况。整个参考信道是由图4（a）中的物理参考信道和SigTest通过软件嵌入的信道两部分组成。</p><img alt="PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzxxF4C7ox45X7><p>（a） （b）</p><p>图4 PCIe 3.0 TP2校准拓扑连接：（a） 插卡的校准 （b） 系统板的校准</p><p>完成了拓扑连接之后，就可以进行PCIe 3.0的TP2的校准了。在最终眼高/眼宽的校准过程，通过调整Rj和DMSI，来达到最终的眼高/眼宽要求。这里存在的风险是：有时候协会提供的治具一致性较差；需要很大的Rj或DMSI才能够达到最终的眼高/眼宽要求。而这并不符合在真实的情况下的Rj和DMSI的情况。</p><p>因此在PCIe 4.0中TP2的校准修改了相应的校准策略，引入了一个ISI板，优先来调节参考信道的ISI值，来对眼图进行调整。当眼图接近到最终的眼高/眼宽附近时，再通过调整DMSI，Sj和幅度来达到最终的眼高/眼宽，并且DMSI，Sj和幅度的调整范围做了限制，从而能够比较真实地模拟现实中的情况。</p><p>PCIe 4.0的TP2校准的拓扑连接如图5所示。与PCIe 3.0相比，除了参考信道的末端嵌入了一个封装损耗之外，其他的信道都是由真实的物理信道组成的。并且由于速率翻倍，在拓扑连接中，链路损耗的估算时必须要将连接线缆等的损耗计入在内。值得注意的是：封装损耗是在示波器之中嵌入的，而不是在SigTest中。这个参考封装损耗是为了模拟真实情况下的芯片封装损耗，由于RC芯片（Root Complex）的封装一般比EP芯片（Endpoint）的封装要大，因此针对RC的参考封装损耗为5dB；而针对EP的参考封装损耗为3dB。</p><img alt="PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzxxF4xHg3jJAa><p>（a） （b）</p><p>图5 PCIe 4.0 TP2校准拓扑连接：（a） 插卡的校准 （b） 系统板的校准</p><p>如前所述，在PCIe 4.0的校准过程中，需要参考信道的ISI值，这就涉及到一个ISI pair的迭代过程，整个迭代过程的起点是-28 dB的端到端的损耗，依据计算出来的眼高/眼宽来确定下一个ISIpair；端到端的损耗调整范围为-27 dB ~ 30dB。泰克公司的PCIe Rx自动化软件能够提供链路端到端损耗的估算，用户可以自行决定是否继续进行ISI迭代。</p><p><strong>进入环回模式</strong></p><p>LEQ的测试对测试仪器提出了很高的要求。它要求测试仪器能够完成协议级别的动态应答和训练。在工业界中，一般称这样的仪器为“协议感知”型仪器（Protocol-aware Instrument）。</p><p>泰克公司的BSX系列误码仪就是这样的一种协议感知型仪器，支持的速率最高可到32Gbps；可以支持多种标准协议，例如PCIe 3.0 & 4.0 & 5.0、USB 3.1 & 3.2等。另外，用户还可以通过自带的Pattern Sequencer功能完成各种自主开发的标准的测试。</p><img alt="PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇）" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RzxxFliA9ESSPn><p>图6 泰克公司的协议感知型误码仪：BSX系列</p><p>对于PCIe 3.0 & 4.0来说，从状态机的角度，有两种方式进入环回模式，如图7所示：</p><img alt="PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇）" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RzxxFmX850Fqdp><p>（a） （b）</p><p>图 7 PCIe 3.0&4.0进入环回模式：（a）从ConfiguraTIon进入 （b）从Recovery进入</p><p><strong>进行误码率测试</strong></p><p>若成功了进入了Loopback，那么后续的误码率测试就很简单。误码仪发送ModifiedCompliance Pattern，检查1012个比特数据；若不超过1个误码；那么就算通过；否则就未通过。</p><p><strong>诊断和调试</strong></p><p>在实际的Rx LEQ的测试中，经常由于种种原因，无法进入到环回模式；或者就算进入到了环回模式，也存在较多的误码。这个时候，我们就需要超出一致性测试；而进行一系列的调试工作，来找出根因（Root Cause）。</p><img alt="PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzxxFnM7hER9w9><p>图8 使用误码仪的眼图功能观测待测对象的环回数据输出的信号质量</p><p>泰克公司PCIe Rx自动化测试软件，除了提供协会所要求的一致性测试之外，还提供了丰富的调试功能。再配合上BSX系列的误码仪的通用调试功能，能够为用户提供全方位的灵活性。</p><p>在进行Rx LEQ环回测试时，有两条数据通路：接收数据通路和环回数据通路。由于Rx LEQ是针对接收数据通路的测试，因此用户必须保证不会由于环回数据通路的原因而导致误码仪的DET进行了误判。泰克的BSX系列的误码仪具有丰富的眼图测试功能，如图8所示。这样用户再不进行任何拓扑连接改变的情况下，就能够进行误码的调试。</p><p>用户可以使用泰克公司提供的“Empty A – Modified Compliance B.ram”文件，就能够使得被测对象稳定地进入Compliance模式，然后通过这个ran文件进行码型切换，将被测对象的输出端切换到8Gbps或16Gbps，观察哪个预设定值能够给出最好的眼图。然后在图9中设置“Preset/Hint”成刚才的预设置，就能够保证环回数据通路不会引入误判的误码。</p><p>倘若排除了环回数据通路所引入的误判的误码；Rx LEQ仍然存在误码。这个时候，用户需要进一步分析误码的来源，比如说是否是DUT的均衡算法没有达到最优，从而没有像链路对端请求最优的Tx EQ值。此时，用户可以使用泰克公司提供的“BER Test”来对整个系数空间进行扫描，若测得的结果表明：在系数空间中存在一些系数组合能够达到没有误码，那么说明DUT的均衡算法未达到最优。</p><img alt="PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇）" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RzxxFpU6EhPxIm><p>图9 对Tx EQ的系数空间进行扫描的误码率测试</p><p>在此基础上还可以进行裕度测试。泰克的自动化软件提供对Sj和DMSI的裕度测试，如图10、11所示。</p><img alt="PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇）" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RzxxFq4AkNwzlM><p>图 10 正弦抖动的裕度测试：（a） 设定界面 （b） 扫描测试界面</p><img alt="PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇）" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RzxxGLd5Cx9JQi><p>图 11 差模噪声的裕度测试：（a） 设定界面 （b） 扫描测试界面</p><p>泰克公司提供了业界领先的关于PCIe 3.0 & 4.0的一致性解决方案，通过使用泰克公司的高性能的示波器、高性能的误码仪、以及灵活的自动化软件，能够大大缩短用户的开发时间，使得用户的产品在市场上更具竞争力。</p><p>来源：泰克科技</p><p>作者：李煜</p><img alt="PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇）" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/Rz1T5C22k6D11I><img alt="PCIe Gen3/Gen4接收端链路均衡测试（下篇：实践篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/R693gZV7RzkjoS><p><strong>免责声明：</strong>本文由作者原创，文章内容系作者个人观点，电子发烧友网转载仅作为传达一种不同的观点，不代表电子发烧友网对该观点的赞同或支持，如有异议，欢迎联系电子发烧友网。</p><ul><li><p>TDDI芯片血战，未来的王牌可能掌握在中国公司手中？！</p></li><li><p>华为轮值CEO郭平：强烈反对美国出口新管制规则 华为永不言弃</p></li><li><p>存储冰火两重天，国产芯片加速布局！</p></li><li><p>避过IoT设备那些“坑”，超低功耗Wi-Fi有多重要？</p></li><li><p>彪悍的国产电源芯片！资本入局，技术攻坚！</p></li></ul></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'接收端','PCIe','Gen3'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../cn/%E7%A7%91%E6%8A%80/8063d86e.html alt="PCIe Gen3/Gen4接收端链路均衡测试—实践篇" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e5732dbbfafc4fbda49be57da81e07d8 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/8063d86e.html title="PCIe Gen3/Gen4接收端链路均衡测试—实践篇">PCIe Gen3/Gen4接收端链路均衡测试—实践篇</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/244e73df.html alt="PCIe Gen3/Gen4接收端链路均衡测试—理论篇" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/deea7ea0ffcd4a4e9985f2106a9f6cf5 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/244e73df.html title="PCIe Gen3/Gen4接收端链路均衡测试—理论篇">PCIe Gen3/Gen4接收端链路均衡测试—理论篇</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/18500f33.html alt="PCIe Gen3/Gen4接收端链路均衡测试（上篇：理论篇）" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/Rzs72cR34YYB3t style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/18500f33.html title="PCIe Gen3/Gen4接收端链路均衡测试（上篇：理论篇）">PCIe Gen3/Gen4接收端链路均衡测试（上篇：理论篇）</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>