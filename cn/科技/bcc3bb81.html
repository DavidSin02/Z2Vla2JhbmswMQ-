<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>SpringAOP-ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Ÿ | æå®¢å¿«è¨Š</title><meta property="og:title" content="SpringAOP-ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Ÿ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/93af441322d4418ebbb68664166fb2ec"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bcc3bb81.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bcc3bb81.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bcc3bb81.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bcc3bb81.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bcc3bb81.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bcc3bb81.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bcc3bb81.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bcc3bb81.html><meta property="article:published_time" content="2020-11-14T21:04:29+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:29+08:00"><meta name=Keywords content><meta name=description content="SpringAOP-ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Ÿ"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/bcc3bb81.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>SpringAOP-ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Ÿ</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>å‰è¨€ï¼šç›¸ä¿¡ä½ çŸ¥é“ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹(OOP)ï¼Œä½†æ˜¯ä½ äº†è§£é¢å‘åˆ‡é¢ç¼–ç¨‹(AOP)æ€æƒ³å—ï¼ŸAOPä½œä¸ºSpringæ¡†æ¶ä¸­çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥æ‰“å¼€AOPä¹‹é—¨å§ï¼</p><h2 class=heading>ä¸€.ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹</h2><ul><li>AOPç®€ä»‹AOPä¸ºAspect Oriented Programmingçš„ç¼©å†™ï¼Œæ„ä¸ºï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œé€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸé—´åŠ¨æ€ä»£ç†å®ç°ç¨‹åºåŠŸèƒ½çš„ç»Ÿä¸€ç»´æŠ¤çš„ä¸€ç§æŠ€æœ¯ã€‚</li><li>ä¸ºä»€ä¹ˆä½¿ç”¨AOPç¼–ç¨‹èŒƒå¼ï¼Ÿåˆ†ç¦»åŠŸèƒ½æ€§éœ€æ±‚å’ŒéåŠŸèƒ½æ€§éœ€æ±‚é›†ä¸­å¤„ç†æŸä¸€å…³æ³¨ç‚¹ä¾µå…¥æ€§å°‘ï¼Œå¢å¼ºä»£ç å¯è¯»æ€§åŠå¯ç»´æŠ¤æ€§</li><li>AOPåº”ç”¨åœºæ™¯æƒé™æ§åˆ¶ã€ç¼“å­˜æ§åˆ¶ã€äº‹åŠ¡æ§åˆ¶ã€åˆ†å¸ƒå¼è¿½è¸ªã€å¼‚å¸¸å¤„ç†ç­‰</li><li>ä¸¾ä¸ªæ —å­å¦‚æœä½ è¦åœ¨Serviceå±‚çš„æŸäº›ç‰¹å®šæ–¹æ³•éœ€åŠ ä¸Šæƒé™éªŒè¯ï¼Œä½¿ç”¨OOPæ€æƒ³çš„è¯åªèƒ½åœ¨æ–¹æ³•å†…éƒ¨æ·»åŠ éªŒè¯èº«ä»½çš„ä»£ç ï¼Œä¾‹å¦‚public void insert() { checkUserAdmin.check(); //åŠ å…¥æƒé™éªŒè¯æ–¹æ³• repository.insert(); //è°ƒç”¨daoå±‚æ’å…¥æ•°æ®åº“ä¸€æ¡è®°å½• } å¤åˆ¶ä»£ç è¿™æ ·çœ‹èµ·æ¥åŠŸèƒ½æ˜¯å®ç°äº†ï¼Œä½†å¦‚æœserviceå±‚æœ‰å¾ˆå¤šinsertå’Œdeleteæ–¹æ³•å‘¢ï¼Ÿè¿™æ ·æ’å…¥ä»£ç çš„æ–¹å¼ä¸æ˜“äºæˆ‘ä»¬å»ç»Ÿä¸€ç®¡ç†ï¼Œä¸”ä¿®æ”¹äº†åŸä»£ç ï¼Œå…·æœ‰ä¾µå…¥æ€§ã€‚é‚£ä¹ˆä½¿ç”¨äº†AOPä¹‹åå‘¢ï¼Ÿä½ å¯ä»¥å»ºä¸€ä¸ªåˆ‡é¢ç±»ï¼Œå¯¹è¦è¿›è¡Œæƒé™éªŒè¯çš„æ–¹æ³•è¿›è¡Œåˆ‡å…¥ã€‚<strong>å³åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼ŒåŠ¨æ€åœ°å°†ä»£ç åˆ‡å…¥åˆ°ç±»çš„æŒ‡å®šæ–¹æ³•æˆ–ä½ç½®ä¸Šçš„æ€æƒ³ï¼Œå°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</strong></li></ul><h2 class=heading>äºŒ.AOPå¸¸ç”¨æœ¯è¯­</h2><ul><li>è¦æƒ³ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ€æƒ³ï¼Œé¦–å…ˆè¦äº†è§£å‡ ä¸ªä¸“æœ‰åè¯â€¢ Targetï¼šç›®æ ‡ç±»ï¼Œå³éœ€è¦è¢«ä»£ç†çš„ç±»ã€‚ä¾‹å¦‚ï¼šUserServiceâ€¢ Joinpoint(è¿æ¥ç‚¹):æ‰€è°“è¿æ¥ç‚¹æ˜¯æŒ‡é‚£äº›å¯èƒ½è¢«æ‹¦æˆªåˆ°çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼šæ‰€æœ‰çš„æ–¹æ³•â€¢ PointCut åˆ‡å…¥ç‚¹ï¼šå·²ç»è¢«å¢å¼ºçš„è¿æ¥ç‚¹ã€‚ä¾‹å¦‚ï¼šaddUser()â€¢ Advice é€šçŸ¥/å¢å¼ºï¼Œå¢å¼ºä»£ç ã€‚ä¾‹å¦‚ï¼šafterã€beforeâ€¢ Weaving(ç»‡å…¥):æ˜¯æŒ‡æŠŠå¢å¼ºadviceåº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡targetæ¥åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡proxyçš„è¿‡ç¨‹.â€¢ Proxy ä»£ç†ç±»â€¢ Aspect(åˆ‡é¢): æ˜¯åˆ‡å…¥ç‚¹pointcutå’Œé€šçŸ¥adviceçš„ç»“åˆ</li></ul><h2 class=heading>ä¸‰.Advice-äº”ç§å¢å¼ºæ–¹å¼</h2><ul><li>ä¾‹å¦‚åœ¨æ‰§è¡ŒæŸä¸ªç‰¹å®šæ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸åŒçš„å¢å¼ºæ–¹å¼ï¼ˆå¦‚å‰ç½®é€šçŸ¥/å¢å¼ºï¼Œåœ¨æ–¹æ³•è¿è¡Œå‰æ‰§è¡Œï¼‰ï¼Œè¾¾åˆ°æˆ‘ä»¬ç»‡å…¥åçš„ä¸åŒæ•ˆæœã€‚å‰ç½®é€šçŸ¥:åœ¨æˆ‘ä»¬æ‰§è¡Œç›®æ ‡æ–¹æ³•ä¹‹å‰è¿è¡Œ(@Before)@Pointcut("within(com.example.demo.Service.*)") public void matchType(){} @Before("matchType()") //å¯åœ¨æ­¤åŠ å…¥JoinPointæ‰“å°åˆ‡ç‚¹ä¿¡æ¯ public void before(JoinPoint joinPoint){ System.out.println("------ã€å‰ç½®é€šçŸ¥ã€‘------" + joinPoint); } å¤åˆ¶ä»£ç åç½®é€šçŸ¥:åœ¨æˆ‘ä»¬ç›®æ ‡æ–¹æ³•è¿è¡Œç»“æŸä¹‹å ,ä¸ç®¡æœ‰æ²¡æœ‰å¼‚å¸¸(@After)@After(value="execution(* com.example.aspectJ.demo1.ProductDao.findAll(..))") public void after(){ System.out.println("æœ€ç»ˆé€šçŸ¥=================="); å¤åˆ¶ä»£ç è¿”å›é€šçŸ¥:åœ¨æˆ‘ä»¬çš„ç›®æ ‡æ–¹æ³•æ­£å¸¸è¿”å›å€¼åè¿è¡Œ(@AfterReturning)@AfterReturning(value="execution(* com.example.aspectJ.demo1.ProductDao.update(..))" ,returning = "result") public void afterReturning(Object result){ //é€šè¿‡returningå±æ€§ï¼Œå®šä¹‰æ–¹æ³•è¿”å›å€¼ä½œä¸ºå‚æ•° System.out.println("åç½®é€šçŸ¥========="+result); } å¤åˆ¶ä»£ç å¼‚å¸¸é€šçŸ¥:åœ¨æˆ‘ä»¬çš„ç›®æ ‡æ–¹æ³•å‡ºç°å¼‚å¸¸åè¿è¡Œ(@AfterThrowing)//é€šè¿‡è®¾ç½®throwingå±æ€§ï¼Œå¯ä»¥è®¾ç½®å‘ç”Ÿå¼‚å¸¸å¯¹è±¡å‚æ•° @AfterThrowing(value = "execution(* com.example.aspectJ.demo1.ProductDao.findOne(..))",throwing = "e") public void afterThrowing(Throwable e){ System.out.println("æŠ›å‡ºå¼‚å¸¸é€šçŸ¥"+e.getMessage()); } å¤åˆ¶ä»£ç ç¯ç»•é€šçŸ¥:åŠ¨æ€ä»£ç†, éœ€è¦æ‰‹åŠ¨æ‰§è¡ŒjoinPoint.procced()(å…¶å®å°±æ˜¯æ‰§è¡Œæˆ‘ä»¬çš„ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰ç›¸å½“äºå‰ç½®é€šçŸ¥, æ‰§è¡Œä¹‹åå°±ç›¸å½“äºæˆ‘ä»¬åç½®é€šçŸ¥(@Around)@Around(value = "execution(* com.example.aspectJ.demo1.ProductDao.delete(..))") public Object around(ProceedingJoinPoint joinPoint) throws Throwable { System.out.println("ç¯ç»•å‰é€šçŸ¥"); Object obj = joinPoint.proceed(); //æ‰§è¡Œç›®æ ‡æ–¹æ³• System.out.println("ç¯ç»•åé€šçŸ¥"); return obj; } å¤åˆ¶ä»£ç </li></ul><h2 class=heading>å››.SpringAOPä½¿ç”¨è¯¦è§£</h2><h3 class=heading>åˆ‡é¢è¡¨è¾¾å¼</h3><ul><li>ä¸‹é¢æ˜¯ä¸€å¼ æ€ç»´å¯¼å›¾æ€»ç»“</li></ul><h3 class=heading>excutionè¡¨è¾¾å¼</h3><ul><li>execution(ä¿®é¥°ç¬¦pattern<strong>è¿”å›å€¼pattern</strong>æè¿°åŒ…å<strong>æ–¹æ³•å(å‚æ•°)</strong>æ–¹æ³•æŠ›å‡ºå¼‚å¸¸pattern)</li><li>ä»£ç ç¤ºä¾‹@Pointcut("execution(public * com.example.controller.*Controller.*(..))") public void match(){} @Before("match()") public void before(){ //å‰ç½®é€šçŸ¥... } å¤åˆ¶ä»£ç </li></ul><h3 class=heading>withinè¡¨è¾¾å¼</h3><ul><li>ä»£ç ç¤ºä¾‹//åŒ¹é…StudentServiceç±»é‡Œæ‰€æœ‰æ–¹æ³• @Pointcut("within(com.example.service.StudentService)") public void matchType(){} //åŒ¹é…com.exampleåŒ…åŠå­åŒ…ä¸‹æ‰€æœ‰ç±»æ–¹æ³• @Pointcut("within(com.example..*)") public void matchPackage(){} å¤åˆ¶ä»£ç </li></ul><h3 class=heading>å¯¹è±¡åŒ¹é…</h3><ul><li>ä»£ç ç¤ºä¾‹/*public class serviceImpl implements service*/ //åŒ¹é…AOPå¯¹è±¡çš„ç›®æ ‡å¯¹è±¡ä¸ºæŒ‡å®šç±»å‹æ–¹æ³•ï¼Œå³serviceImplçš„aopä»£ç†å¯¹è±¡æ–¹æ³• @Pointcut("this(com.example.serviceImpl)") public void thisDemo(){} //åŒ¹é…å®ç°serviceæ¥å£çš„ç›®æ ‡å¯¹è±¡ï¼ˆéaopä»£ç†åçš„å¯¹è±¡ï¼‰æ–¹æ³•ï¼Œè¿™é‡ŒæŒ‡çš„å°±æ˜¯serviceImplçš„æ–¹æ³• @Pointcut("target(com.example.service)") public void targetDemo(){} //åŒ¹é…æ‰€æœ‰ä»¥Serviceç»“å°¾çš„beanä¸­æ–¹æ³• @Pointcut("bean(*Service)") public void beanDemo(){} å¤åˆ¶ä»£ç </li></ul><h3 class=heading>å‚æ•°åŒ¹é…</h3><ul><li>ä»£ç ç¤ºä¾‹//åŒ¹é…ä»»ä½•ä»¥findå¼€å¤´ä¸”åªæœ‰ä¸€ä¸ªLongå‚æ•°çš„æ–¹æ³• @Pointcut("execution(* *..find*(Long))") public void argsDemo1(){} //åŒ¹é…ä»»ä½•åªæœ‰ä¸€ä¸ªLongå‚æ•°çš„æ–¹æ³• @Pointcut("args(Long)") public void argsDemo2(){} //åŒ¹é…ä»»ä½•ä»¥findå¼€å¤´ä¸”ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºLongçš„æ–¹æ³• @Pointcut("execution(* *..find*(Long,..))") public void argsDemo3(){} //åŒ¹é…ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºLongçš„æ–¹æ³• @Pointcut("args(Long,..)") public void argsDemo4(){} å¤åˆ¶ä»£ç </li></ul><h3 class=heading>æ³¨è§£åŒ¹é…</h3><ul><li>ä»£ç ç¤ºä¾‹//åŒ¹é…æ–¹æ³•æ³¨è§£æœ‰@AdminOnlyçš„æ–¹æ³• @Pointcut("@annotation(com.example.security.AdminOnly)") public void annoDemo(){} //åŒ¹é…æ³¨è§£æœ‰@Test1çš„ç±»ä¸‹æ‰€æœ‰æ–¹æ³•ï¼Œè¦æ±‚æ³¨è§£çš„RetentionPolicyçº§åˆ«ä¸ºCLASS @Pointcut("@within(com.example.annotation.Test1)") public void annoWithinDemo(){} //åŒ¹é…æ³¨è§£æœ‰@Test2ç±»ä¸‹æ‰€æœ‰æ–¹æ³•ï¼Œè¦æ±‚æ³¨è§£çš„RetentionPolicyçº§åˆ«ä¸ºRUNTIME @Pointcut("@target(com.example.repository.Test2)") public void annoTargetDemo(){} //åŒ¹é…ä¼ å…¥å‚æ•°ç±»å…·æœ‰@Test3çš„æ³¨è§£çš„æ–¹æ³•ï¼ˆä¾‹å¦‚studentå®ä½“ç±»æœ‰æ³¨è§£@Test3ï¼Œåªè¦æ–¹æ³•ä¼ å…¥studentç±»å°±ä¼šè¢«æ‹¦æˆªï¼‰ @Pointcut("@args(org.example.repository.Test3)") public void annoArgsDemo(){} å¤åˆ¶ä»£ç </li></ul><p>â€‹ è‡³äºAOPçš„å®ç°åŸç†ï¼Œè¿™é‡Œæš‚æ—¶ä¸è®²ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»äº†è§£ä¸‹jdkçš„åŠ¨æ€ä»£ç†ï¼ŒAOPå°±æ˜¯åŸºäºæ­¤å®ç°çš„ã€‚</p><p>æ›´å¤šå†…å®¹ï¼Œæ¬¢è¿è®¿é—®æˆ‘çš„ï¼š</p><p>bilibiliè§†é¢‘ï¼šspace.bilibili.com/54183978</p><p>æ˜é‡‘ï¼šjuejin.im/user/5eb7a6â€¦</p><p>è…¾è®¯äº‘ç¤¾åŒºï¼šcloud.tencent.com/developer/uâ€¦</p><p>Githubï¼šgithub.com/BA-NANA</p><div class=pgc-img><img alt=SpringAOP-ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Ÿ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/93af441322d4418ebbb68664166fb2ec><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'SpringAOP','ä»€ä¹ˆ','ç¼–ç¨‹'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>