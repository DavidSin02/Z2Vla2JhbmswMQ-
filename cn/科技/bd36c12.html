<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Android BroadcastReceiver的基本使用，拨号，短信，SD卡，开机 | 极客快訊</title><meta property="og:title" content="Android BroadcastReceiver的基本使用，拨号，短信，SD卡，开机 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/f82b07ea2c934d218d1c1af44d9cc2ed"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bd36c12.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bd36c12.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bd36c12.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bd36c12.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bd36c12.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bd36c12.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bd36c12.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bd36c12.html><meta property="article:published_time" content="2020-10-29T20:50:29+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:29+08:00"><meta name=Keywords content><meta name=description content="Android BroadcastReceiver的基本使用，拨号，短信，SD卡，开机"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/bd36c12.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Android BroadcastReceiver的基本使用，拨号，短信，SD卡，开机</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>Android中四大组件的使用时重中之重，我这个阶段也不奢望能把他所有的原理搞懂，但是最起码的，我要把他的各种使用方法了如指掌才行</p><p>BroadcastReceiver</p><p>接收系统的广播，比如电话，短信之类的</p><h1>IP拨号器</h1><p>我们在拨打电话的时候，我们系统也会事先发送一个广播，所以我们可以用广播接收者来接收到这个广播拨打电话的时候在电话号码前面加上一些优惠的长途短号，其逻辑就是入门使用广播的一个小案例，那我们新建一个IPCall项目</p><div class=pgc-img><img alt="Android BroadcastReceiver的基本使用，拨号，短信，SD卡，开机" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f82b07ea2c934d218d1c1af44d9cc2ed><p class=pgc-img-caption></p></div><p>我们拨打电话的时候系统发一个广播，我们接受到这个广播拿到号码修改之后再放回去，就达到了我们IP拨号的目的，我们需要新建一个Receiver</p><p><strong>CallReceiver</strong></p><p>package com.lgl.ipcall;</p><p>import android.content.BroadcastReceiver;</p><p>import android.content.Context;</p><p>import android.content.Intent;</p><p>import android.util.Log;</p><p>/**</p><p>* 电话广播</p><p>* Created by lgl on 16/4/10.</p><p>*/</p><p>public class CallReceiver extends BroadcastReceiver {</p><p>//接收到广播时调用</p><p>@Override</p><p>public void onReceive(Context context, Intent intent) {</p><p>Log.i("CallReceiver", "打电话");</p><p>}</p><p>}</p><p>这个类暂时不需要做什么。最重要的还是注册，作为四大组建，他是需要在清单文件里注册的</p><p>&lt;!--注册广播--></p><p>&lt;receiver android:name=".CallReceiver"></p><p>&lt;intent-filter></p><p>&lt;!--定义接收的广播--></p><p>&lt;action android:name="android.intent.action.NEW_OUTGOING_CALL" /></p><p>&lt;/intent-filter></p><p>&lt;/receiver></p><p>别忘了，你监听了用户的隐私，是需要权限的</p><p>```</p><p>&lt;uses-permission android:name="android.permission.PROCESS_OUTGOING_CALLS" /></p><p>我们先运行一下，打个电话</p><div class=pgc-img><img alt="Android BroadcastReceiver的基本使用，拨号，短信，SD卡，开机" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/bf2ece73df034cefb3bc113a3e2f5eed><p class=pgc-img-caption></p></div><p>好的，广播我们已经抓住了，那我们可以首先获取打出去的号码</p><p>String iphone = getResultData();</p><p>Log.i("CallReceiver", "电话号码："+iphone);</p><p>这样我们就可以拿到String类型的电话号码了</p><div class=pgc-img><img alt="Android BroadcastReceiver的基本使用，拨号，短信，SD卡，开机" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/650a5faa792046e0af5df7757bd7aebb><p class=pgc-img-caption></p></div><p>我们现在可以修改号码重新设置IP段了</p><p>//添加IP段</p><p>String newPhone = "+86" + iphone;</p><p>//把修改后的号码放回去</p><p>setResultData(newPhone);</p><p>这样我们每次打电话他都会自动帮我们添加一个字段了</p><div class=pgc-img><img alt="Android BroadcastReceiver的基本使用，拨号，短信，SD卡，开机" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7b2bc8a8f88c409e9ff01ddd3ea30ce7><p class=pgc-img-caption></p></div><p>完整代码</p><p>package com.lgl.ipcall;</p><p>import android.content.BroadcastReceiver;</p><p>import android.content.Context;</p><p>import android.content.Intent;</p><p>import android.util.Log;</p><p>/**</p><p>* 电话广播</p><p>* Created by lgl on 16/4/10.</p><p>*/</p><p>public class CallReceiver extends BroadcastReceiver {</p><p>//接收到广播时调用</p><p>@Override</p><p>public void onReceive(Context context, Intent intent) {</p><p>Log.i("CallReceiver", "打电话");</p><p>String iphone = getResultData();</p><p>Log.i("CallReceiver", "电话号码：" + iphone);</p><p>//添加IP段</p><p>String newPhone = "+86" + iphone;</p><p>//把修改后的号码放回去</p><p>setResultData(newPhone);</p><p>}</p><p>}</p><h1>2.短信拦截器</h1><p>系统受到了一条短信后，也是会发一条广播的，所有我们可以在中间写一个广播接受者去进行我们的操作，这里，我们继续在IP拨号器这个项目中写吧，就不新建项目了，不然等下上传也麻烦</p><p>我们新建一个Class——SMSReceiver，重写他的onReceive方法，然后我们先注册</p><p>&lt;!--注册广播--></p><p>&lt;receiver android:name=".SMSReceiver"></p><p>&lt;intent-filter></p><p>&lt;!--定义接收的广播,被Google隐藏的权限操作--></p><p>&lt;action android:name="android.provider.Telephony.SMS_RECEIVED" /></p><p>&lt;/intent-filter></p><p>&lt;/receiver></p><p>切记,权限</p><p>&lt;uses-permission android:name="android.permission.RECEIVE_SMS" /></p><p><strong>SMSReceiver</strong></p><p>package com.lgl.ipcall;</p><p>import android.content.BroadcastReceiver;</p><p>import android.content.Context;</p><p>import android.content.Intent;</p><p>import android.os.Bundle;</p><p>import android.telephony.SmsMessage;</p><p>import android.util.Log;</p><p>/**</p><p>* 短信拦截器</p><p>* Created by lgl on 16/4/10.</p><p>*/</p><p>public class SMSReceiver extends BroadcastReceiver {</p><p>@Override</p><p>public void onReceive(Context context, Intent intent) {</p><p>System.out.println("收到短信");</p><p>//获取短信内容</p><p>Bundle bundle = intent.getExtras();</p><p>//返回的是一个Object数组</p><p>Object[] objects = (Object[]) bundle.get("pdus");</p><p>//遍历数组得到短信内容</p><p>for (Object object : objects) {</p><p>//把数组元素转换成短信对象</p><p>SmsMessage sms = SmsMessage.createFromPdu((byte[]) object);</p><p>//获取发件人号码</p><p>String toPhone = sms.getOriginatingAddress();</p><p>//获取短信内容</p><p>String smsContent = sms.getMessageBody();</p><p>Log.i("SMSReceiver", "发件人号码:" + toPhone + "短信内容" + smsContent);</p><p>//判断是否是拦截的号码</p><p>if (toPhone.equals("12345678910")) {</p><p>//拦截广播</p><p>abortBroadcast();</p><p>}</p><p>}</p><p>}</p><p>}</p><p>这样我们运行之下，你会发现，虽然走到拦截这一步，但是并没有阻止显示在短信收件箱里，这里，我们要注意一个优势，就是广播接收者是有优先级定义的，我们只需要在清单注册根节点的intent-filter标签里定义一个</p><p>android:priority="1000"</p><p>官方文档是说数值在-1000到1000之间，但是最高支持int的最大值的权限，int最大值是多少？自己去看API</p><h1>3.监听SD卡</h1><p>>我们在对SD卡进行读写的时候会用到，其实也就是巩固一下对广播的使用，做那种语音助手之类的辅助软件，广播和服务还是很有用的，我们还是定义一个SDReceiver并且在清单文件注册</p><p>&lt;!--注册广播--></p><p>&lt;receiver android:name=".SDReceiver"></p><p>&lt;intent-filter></p><p>&lt;!--SD卡就绪广播--></p><p>&lt;action android:name="android.intent.action.MEDIA_MOUNTED" /></p><p>&lt;!--SD卡拔出广播--></p><p>&lt;action android:name="android.intent.action.MEDIA_REMOVED" /></p><p>&lt;!--SD卡卸载广播--></p><p>&lt;action android:name="android.intent.action.MEDIA_UNMOUNTABLE" /></p><p>&lt;data android:scheme="file"/></p><p>&lt;/intent-filter></p><p>&lt;/receiver></p><p>我们现在可以监听了</p><p><strong>SDReceiver</strong></p><p>package com.lgl.ipcall;</p><p>import android.content.BroadcastReceiver;</p><p>import android.content.Context;</p><p>import android.content.Intent;</p><p>import android.util.Log;</p><p>/**</p><p>* 监听SD卡</p><p>* Created by lgl on 16/4/10.</p><p>*/</p><p>public class SDReceiver extends BroadcastReceiver {</p><p>@Override</p><p>public void onReceive(Context context, Intent intent) {</p><p>//判断广播</p><p>String action = intent.getAction();</p><p>if (action.equals(Intent.ACTION_MEDIA_MOUNTED)) {</p><p>Log.i("SDReceiver", "SD卡就绪");</p><p>} else if (action.equals(Intent.ACTION_MEDIA_REMOVED)) {</p><p>Log.i("SDReceiver", "SD卡拔出");</p><p>} else if (action.equals(Intent.ACTION_MEDIA_UNMOUNTABLE)) {</p><p>Log.i("SDReceiver", "SD卡卸载");</p><p>}</p><p>}</p><p>}</p><p><strong>4.流氓软件</strong></p><p>我们监听到开机就启动这个软件，而且不让其退出，达到流氓的效果</p><div class=pgc-img><img alt="Android BroadcastReceiver的基本使用，拨号，短信，SD卡，开机" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/9fce07e7f798481baaa1da53a1a1b7a7><p class=pgc-img-caption></p></div><p>先不让他退出，我们在MainActivity中</p><p>@Override</p><p>public void onBackPressed() {</p><p>//禁止返回键</p><p>// super.onBackPressed();</p><p>}</p><p>只要你一安装，就退出不了了，我们再设置一下开机启动，写一个监听器动的广播罢了，我们新建一个RebootReceiver,先注册吧</p><p>&lt;!--注册广播--></p><p>&lt;receiver android:name=".RebootReceiver"></p><p>&lt;intent-filter></p><p>&lt;!--定义接收的广播--></p><p>&lt;action android:name="android.intent.action.BOOT_COMPLETED" /></p><p>&lt;/intent-filter></p><p>&lt;/receiver></p><p>这个也是需要权限的</p><p>&lt;uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED"/></p><p><strong>RebootReceiver</strong></p><p>package com.lgl.ipcall;</p><p>import android.content.BroadcastReceiver;</p><p>import android.content.Context;</p><p>import android.content.Intent;</p><p>import android.util.Log;</p><p>/**</p><p>* 开机启动</p><p>* Created by lgl on 16/4/10.</p><p>*/</p><p>public class RebootReceiver extends BroadcastReceiver {</p><p>@Override</p><p>public void onReceive(Context context, Intent intent) {</p><p>Log.i("RebootReceiver", "开机");</p><p>//启动</p><p>Intent i = new Intent(context, MainActivity.class);</p><p>//在Activity之外启动需要设置Flags</p><p>i.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</p><p>context.startActivity(i);</p><p>}</p><p>}</p><h1>5.应用安装卸载监听</h1><p>我们如果做手机助手或者应用的时候或许可以用得上这玩意，新建一个APPReceiver，然后去注册</p><p>&lt;!--注册广播--></p><p>&lt;receiver android:name=".APPReceiver"></p><p>&lt;intent-filter></p><p>&lt;!--安装应用--></p><p>&lt;action android:name="android.intent.action.PACKAGE_ADDED" /></p><p>&lt;!--更新应用--></p><p>&lt;action android:name="android.intent.action.PACKAGE_REPLACED" /></p><p>&lt;!--卸载应用--></p><p>&lt;action android:name="android.intent.action.PACKAGE_REMOVED" /></p><p>&lt;!--携带包名--></p><p>&lt;data android:scheme="package"/></p><p>&lt;/intent-filter></p><p>&lt;/receiver></p><p>然后我们来判断</p><p>package com.lgl.ipcall;</p><p>import android.content.BroadcastReceiver;</p><p>import android.content.Context;</p><p>import android.content.Intent;</p><p>import android.net.Uri;</p><p>import android.util.Log;</p><p>/**</p><p>* Created by lgl on 16/4/10.</p><p>*/</p><p>public class APPReceiver extends BroadcastReceiver {</p><p>@Override</p><p>public void onReceive(Context context, Intent intent) {</p><p>//判断广播类型</p><p>String action = intent.getAction();</p><p>//获取包名</p><p>Uri appName = intent.getData();</p><p>if (Intent.ACTION_PACKAGE_ADDED.equals(action)) {</p><p>Log.i("APPReceiver", "安装" + appName);</p><p>} else if (Intent.ACTION_PACKAGE_REPLACED.equals(action)) {</p><p>Log.i("APPReceiver", "更新" + appName);</p><p>} else if (Intent.ACTION_PACKAGE_REMOVED.equals(action)) {</p><p>Log.i("APPReceiver", "卸载" + appName);</p><p>}</p><p>}</p><p>}</p><p>这样我们完全就可以监听状态了，我们以下载一个豌豆荚为例</p><div class=pgc-img><img alt="Android BroadcastReceiver的基本使用，拨号，短信，SD卡，开机" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d03c5e3fa04c4803a99db2dcbab2d423><p class=pgc-img-caption></p></div><h1>6.自定义广播</h1><p>这里，我们有特定需求的时候会用，我们先定义一个Button</p><p>&lt;Button</p><p>android:id="@+id/btn_myreceiver"</p><p>android:layout_width="wrap_content"</p><p>android:layout_height="wrap_content"</p><p>android:text="发送自定义广播" /></p><p>他的点击事件就是发送一个广播，我这里自定义一个广播名字liuguilin</p><p>case R.id.btn_myreceiver:</p><p>Intent i = new Intent();</p><p>i.setAction("liuguilin");</p><p>sendBroadcast(i);</p><p>break;</p><p>然后我们新建一个MyReceiver,注册</p><p>&lt;receiver android:name=".MyReceiver"></p><p>&lt;intent-filter></p><p>&lt;!--自定义广播--></p><p>&lt;action android:name="liuguilin" /></p><p>&lt;/intent-filter></p><p>&lt;/receiver></p><p>我们写个打印语句</p><div class=pgc-img><img alt="Android BroadcastReceiver的基本使用，拨号，短信，SD卡，开机" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/2aae9314daf947b7a2fae463af8cb01f><p class=pgc-img-caption></p></div><h1>7.有序广播和无序广播</h1><p>这两种广播的区别</p><p>- 有序广播：接收这条广播是按优先级来的</p><p>- 无序广播：无条件直接接收</p><p>-1.发送有序广播</p><p>>我们定义一个Button</p><p>&lt;Button</p><p>android:id="@+id/btn_haveorder"</p><p>android:layout_width="wrap_content"</p><p>android:layout_height="wrap_content"</p><p>android:text="发送有序广播" /></p><p>然后发送一个广播</p><p>case R.id.btn_haveorder:</p><p>Intent intent = new Intent();</p><p>intent.setAction("com.lgl.good");</p><p>//有序广播并且携带数据</p><p>sendOrderedBroadcast(intent, null, null, null, 0, "自定义广播内容", null);</p><p>break;</p><p>这里我定义了三个广播，然后他们的优先级分辨是1000，600，300</p><p>&lt;!--有序广播--></p><p>&lt;receiver android:name=".OrderReceiver"></p><p>&lt;intent-filter android:priority="1000"></p><p>&lt;action android:name="com.lgl.good"/></p><p>&lt;/intent-filter></p><p>&lt;/receiver></p><p>&lt;!--有序广播--></p><p>&lt;receiver android:name=".OrderReceiverTwo"></p><p>&lt;intent-filter android:priority="600"></p><p>&lt;action android:name="com.lgl.good"/></p><p>&lt;/intent-filter></p><p>&lt;/receiver></p><p>&lt;!--有序广播--></p><p>&lt;receiver android:name=".OrderReceiverThree"></p><p>&lt;intent-filter android:priority="300"></p><p>&lt;action android:name="com.lgl.good"/></p><p>&lt;/intent-filter></p><p>&lt;/receiver></p><p>最后运行的结果</p><div class=pgc-img><img alt="Android BroadcastReceiver的基本使用，拨号，短信，SD卡，开机" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f28fb221fe0848af8d05075df6eebfba><p class=pgc-img-caption></p></div><p>Demo下载：http://download.csdn.net/detail/qq_26787115/9486705</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Android','BroadcastReceiver','拨号'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>