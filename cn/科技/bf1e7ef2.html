<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>关于scanf函数的几个问题 | 极客快訊</title><meta property="og:title" content="关于scanf函数的几个问题 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bf1e7ef2.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bf1e7ef2.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bf1e7ef2.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bf1e7ef2.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bf1e7ef2.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bf1e7ef2.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bf1e7ef2.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bf1e7ef2.html><meta property="article:published_time" content="2020-11-14T21:05:10+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:10+08:00"><meta name=Keywords content><meta name=description content="关于scanf函数的几个问题"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/bf1e7ef2.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>关于scanf函数的几个问题</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>曾经错的几个地方：（xpsp2，vc6.0环境下）</p><p>1.空白符问题</p><p>#include&lt;stdio.h></p><p>main()</p><p>{</p><p>int a;</p><p>printf("input thedata\n");</p><p>scanf("%d\n",&a);//这里多了一个回车符\n</p><p>printf("%d",a);</p><p>return 0;</p><p>}</p><p>结果要输入两个数程序才结束，而不是预期的一个。why？</p><p>原因：用空白符结尾时，scanf会跳过空白符去读下一个字符，所以你必须再输入一个数。这里的空白符包括空格，制表符，换行符，回车符等。所以如果你用scanf("%d ",&a)也会出现同样的问题。</p><p>解决方法：这种错误大多是输入的时候不小心，多注意一点就好了。这种问题也不好检查，编译没有问题，一个空格也不容易看出来。当你的程序出现上面的问题时，自己对照检查一下就可以了。</p><p>2.缓冲区问题（“垃圾”字符）</p><p>这是一个非常容易错的地方，我就错过多次。</p><p>#include &lt;stdio.h></p><p>main()</p><p>{</p><p>int n = 5;</p><p>char c[n];</p><p>for(int i = 0; i &lt; n; i++)</p><p>c =scanf("%c",&c);</p><p>printf(c);</p><p>return 0;</p><p>}</p><p>如果输入:</p><p>a</p><p>b</p><p>c</p><p>那么循环就会“提前”结束了.</p><p>原因：输入a和第一个回车后，a和这个回车符都留在缓冲区中。第一个scanf读取了a，但是输入缓冲区里面还留有一个\n，第二个scanf读取这个\n。然后输入b和第二个回车，同样的，第三个scanf读取了b，第四个scanf读取了第二个回车符。第五个读取了c。所以五个scanf都执行了，并没有提前结束。只不过有的scanf读取到了回车符而已。</p><p>解决方法：把程序改成这样就可以了：</p><p>for( i = 0; i &lt; n; i++){</p><p>scanf("%c",&c);</p><p>fflush(stdin);//刷新缓冲区</p><p>}</p><p>或者不用scanf，而用gets（）函数，如：</p><p>#include&lt;stdio.h></p><p>main()</p><p>{</p><p>char c[5];</p><p>gets(c);</p><p>printf(c);</p><p>return 0;</p><p>}</p><p>但要注意：这个函数自动把你最后敲的回车转换为字符'\0'。如果你的输入超过了数组的大小，那么就会产生错误。</p><p>3.scanf()函数的参数输入类型不匹配问题</p><p>这是我在csdn论坛上见到的问题，这个错误有时候会让人莫名其妙。</p><p>#include&lt;stdio.h></p><p>main()</p><p>{</p><p>int a=123;</p><p>char c='t';</p><p>printf("input\n");</p><p>scanf("%d%c",&a,&c);</p><p>scanf("%d%c",&a,&c);</p><p>scanf("%d%c",&a,&c);</p><p>printf("%d\n%c\n",a,c);</p><p>return 0;</p><p>}</p><p>当输入a 回车 后，会直接跳过下面２个scanf语句，直接输出为</p><p>123</p><p>t</p><p>原因：对于scanf("%d%c",&a,&c)，scanf语句执行时，首先试图从缓冲区中读入一个%d类型的数据，如果和第一个参数匹配，则继续从缓冲区中读取数据和第二个参数进行匹配，依次进行下去，直到匹配完所有的参数；</p><p>如果其中有一个参数不匹配，那就从这个地方跳出，忽略这个scanf后面所有的参数，而去执行下一条语句。</p><p>可以用下面的程序验证一下：</p><p>#include &lt;stdio.h></p><p>int main()</p><p>{</p><p>int a=123,b=1;</p><p>char c='t';</p><p>scanf("%d%d",&a,&b);</p><p>scanf("%c",&c);</p><p>printf("%d\n%d\n%c\n",a,b,c);</p><p>return 0;</p><p>}输入：2 回车a 回车</p><p>结果是：</p><p>2</p><p>1</p><p>a</p><p>解决方法：scanf()函数执行成功时的返回值是成功读取的变量数,也就是说，你这个scanf()函数有几个变量，如果scanf()函数全部正常读取，它就返回几。但这里还要注意另一个问题，如果输入了非法数据，键盘缓冲区就可能还个有残余信息问题。</p><p>比如：</p><p>#include &lt;stdio.h></p><p>main()</p><p>{</p><p>int a=123,b;</p><p>while(scanf("%d%d",&a,&b)!=2)</p><p>fflush(stdin);</p><p>printf("%d\n%d\n",a,b);</p><p>return 0;</p><p>}</p><p>你可以试一下，如果输入不是数字时，会有什么反应。</p><p>补充：scanf中一种很少见但很有用的转换字符：[...]和[ ^...]。</p><p>#include&lt;stdio.h></p><p>main()</p><p>{</p><p>char strings[100];</p><p>scanf("%[1234567890]",strings);</p><p>printf("%s",strings);</p><p>return 0;</p><p>}</p><p>运行，输入：1234werew后，结果是：1234。</p><p>通过运行可以发现它的作用是：如果输入的字符属于方括号内字符串中某个字符，那么就提取该字符；如果一经发现不属于就结束提取。该方法会自动加上一个字符串结束符到已经提取的字符后面。</p><p>scanf("%[^1234567890]",strings);它的作用是：如果一经发现输入的字符属于方括号内字符串中某个字符，那么就结束提取；如果不属于就提取该字符。该方法会自动加上一个字符串结束符到已经提取的字符后面。</p><p>注意：方括号两边不能空格，如：scanf("%[ 1234567890 ]",strings);scanf("%[ ^1234567890 ]",strings); 不让空格也会算在里面的。</p><p>用这种方法还可以解决scanf的输入中不能有空格的问题。只要用scanf("%[^\n]",strings);就可以了。很神奇吧。</p><p>scanf原型:参见《C语言大全》和K&C</p><p># include &lt;stdio.h>;</p><p>int scanf( const char*format, ... );</p><p>函数 scanf() 是从标准输入流stdin 中读内容的通用子程序，可以读入全部固有类型的数据并自动转换成机内形式。</p><p>在 C99 中，format 用 restrict 修饰。</p><p>format 指向的控制串由以下三类字符组成：</p><p>● 格式说明符</p><p>● 空白符</p><p>● 非空白符</p><p>转换字符(就是%后跟的部分）</p><p>a 读浮点值(仅适用于 C99)</p><p>A 读浮点值(仅适用于 C99)</p><p>c 读单字符</p><p>d 读十进制整数</p><p>i 读十进制、八进制、十六进制整数</p><p>e 读浮点数</p><p>E 读浮点数</p><p>f 读浮点数</p><p>F 读浮点数(仅适用于 C99)</p><p>g 读浮点数</p><p>G 读浮点数</p><p>o 读八进制数</p><p>s 读字符串</p><p>x 读十六进制数</p><p>X 读十六进制数</p><p>p 读指针值</p><p>n 至此已读入值的等价字符数</p><p>u 读无符号十进制整数</p><p>[ ] 扫描字符集合</p><p>% 读 % 符号(百分号)</p><p>例如： %s 表示读串而 %d 表示读整数。格式串的处理顺序为从左到右，格式说明符逐一与变元表中的变元匹配。为了读取长整数，可以将 l(ell) 放在格式说明符的前面；为了读取短整数，可以将 h 放在格式说明符的前面。这些修饰符可以与 d、i、o、u 和 x 格式代码一起使用。</p><p>默认情况下，a、f、e 和 g 告诉 scanf() 为 float 分配数据。 如果将 l(ell) 放在这些修饰符的前面，则scanf() 为 double 分配数据。使用 L 就是告诉 scanf()，接收数据的变量是long double 型变量。</p><p>如果使用的现代编译器程序支持 1995 年增加的宽字符特性， 则可以与 c 格式代码一起，用 l 修饰符说明类型wchar_t 的宽字符指针；也可以与 s 格式代码一起，用 l 修饰符说明宽字符串的指针。l 修饰符也可以用于修饰扫描集，以说明宽字符。</p><p>控制串中的空白符使 scanf() 在输入流中跳过一个或多个空白行。空白符可以是空格(space)、制表符(tab)和新行符(newline)。 本质上，控制串中的空白符使 scanf() 在输入流中读，但不保存结果，直到发现非空白字符为止。</p><p>非空白符使 scanf() 在流中读一个匹配的字符并忽略之。例如，"%d,%d" 使 scanf() 先读入一个整数，读入中放弃逗号，然后读另一个整数。如未发现匹配，scanf() 返回。</p><p>scanf() 中用于保存读入值的变元必须都是变量指针，即相应变量的地址。</p><p>在输入流中，数据项必须由空格、制表符和新行符分割。逗号和分号等不是分隔符，比如以下代码：</p><p>scanf( "%d %d",&r, &c );</p><p>将接受输入 10 20，但遇到 10,20 则失败。</p><p>百分号(%)与格式符之间的星号(*)表示读指定类型的数据但不保存。因此，</p><p>scanf( "%d %*c %d",&x, &y );</p><p>对 10/20 的读入操作中，10 放入变量 x，20 放入 y。</p><p>格式命令可以说明最大域宽。 在百分号(%)与格式码之间的整数用于限制从对应域读入的最大字符数。例如，希望向 address 读入不多于 20 个字符时，可以书写成如下形式：</p><p>scanf( "%20s",address );</p><p>如果输入流的内容多于 20 个字符，则下次scanf() 从此次停止处开始读入。 若达到最大域宽前已遇到空白符，则对该域的读立即停止；此时，scanf() 跳到下一个域。</p><p>虽然空格、制表符和新行符都用做域分割符号，但读单字符操作中却按一般字符处理。例如，对输入流 "x y" 调用：</p><p>scanf( "%c%c%c",&a, &b, &c );</p><p>返回后，x 在变量 a 中，空格在变量 b 中，y 在变量 c 中。</p><p>注意，控制串中的其它字符，包括空格、制表符和新行符，都用于从输入流中匹配并放弃字符，被匹配的字符都放弃。例如，给定输入流 "10t20"，调用：</p><p>scanf( "%dt%d",&x, &y );</p><p>将把 10 和 20 分别放到 x 和 y 中，t 被放弃，因为 t 在控制串中。</p><p>ANSI C 标准向 scanf() 增加了一种新特性，称为扫描集(scanset)。扫描集定义一个字符集合，可由 scanf() 读入其中允许的字符并赋给对应字符数组。 扫描集合由一对方括号中的一串字符定义，左方括号前必须缀以百分号。 例如，以下的扫描集使 scanf() 读入字符 A、B 和 C：</p><p>%[ABC]</p><p>使用扫描集时，scanf() 连续吃进集合中的字符并放入对应的字符数组，直到发现不在集合中的字符为止(即扫描集仅读匹配的字符)。返回时，数组中放置以null 结尾、由读入字符组成的字符串。</p><p>用字符 ^ 可以说明补集。把 ^ 字符放为扫描集的第一字符时，构成其它字符组成的命令的补集合，指示 scanf() 只接受未说明的其它字符。</p><p>对于许多实现来说，用连字符可以说明一个范围。 例如，以下扫描集使 scanf() 接受字母 A 到 Z：</p><p>%[A-Z]</p><p>重要的是要注意扫描集是区分大小写的。因此，希望扫描大、小写字符时，应该分别说明大、小写字母。</p><p>scanf() 返回等于成功赋值的域数的值，但由于星号修饰符而读入未赋值的域不计算在内。给第一个域赋值前已出错时，返回 EOF。</p><p>C99 为 scanf() 增加了几个格式修饰符：hh、ll、j、z 和 t。hh 修饰符可用于 d、i、o、u、x、X 或 n。它说明相应的变元是 signed 或 unsignedchar 值，或用于 n 时， 相应的变元是指向 long char 型变量的指针。ll 修饰符也可用于 d、i、o、u、x、X 或 n。它说明相应的变元是 signed 或者 unsignedlong long int 值。</p><p>j 格式修饰符应用于 d、i、o、u、x、X 或 n，说明匹配的变元是类型 intmax_t 或 uintmax_t。这些类型在 &lt;stdint.h>; 中声明，并说明最大宽度的整数。</p><p>z 格式修饰符应用于 d、i、o、u、x、X 或 n，说明匹配的变元是指向 size_t 类型对象的指针。该类型在&lt;stddef.h>; 中声明，并说明 sizeof 的结构。</p><p>t 格式修饰符应用于 d、i、o、u、x、X 或 n，说明匹配的变元是指向 ptrdiff_t 类型对象的指针。该类型在 &lt;stddef.h>; 中声明，并说明两个指针之间的差别。</p><p>例子：</p><p># include &lt;stdio.h>;</p><p>int main( void )</p><p>{</p><p>char str[80], str2[80];</p><p>int i;</p><p>/* read a string and ainteger */</p><p>scanf( "%s%d", str,&i );</p><p>/* read up to 79 chars intostr */</p><p>scanf( "%79s", str);</p><p>/* skip the integer betweenthe two strings */</p><p>scanf( "%s%*d%s",str, str2 );</p><p>return 0;</p><p>}</p><p>-------------------------------------------------------------</p><p>关注微信 华清创客在线，与10万个程序员做朋友。</p><p>每天下午17：30干货分享，我们不见不散~</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'关于','scanf','函数'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>