<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ååˆ†é’Ÿå­¦ä¼šæœ‰é™çŠ¶æ€æœºçš„å®ç°åŸç† | æå®¢å¿«è¨Š</title><meta property="og:title" content="ååˆ†é’Ÿå­¦ä¼šæœ‰é™çŠ¶æ€æœºçš„å®ç°åŸç† - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/67db0a1f58fe43878523eb9e1b738b2c"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c0b4132.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c0b4132.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c0b4132.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c0b4132.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c0b4132.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c0b4132.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c0b4132.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c0b4132.html><meta property="article:published_time" content="2020-10-29T20:59:15+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:15+08:00"><meta name=Keywords content><meta name=description content="ååˆ†é’Ÿå­¦ä¼šæœ‰é™çŠ¶æ€æœºçš„å®ç°åŸç†"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/c0b4132.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ååˆ†é’Ÿå­¦ä¼šæœ‰é™çŠ¶æ€æœºçš„å®ç°åŸç†</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div class=pgc-img><img alt=ååˆ†é’Ÿå­¦ä¼šæœ‰é™çŠ¶æ€æœºçš„å®ç°åŸç† onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/67db0a1f58fe43878523eb9e1b738b2c><p class=pgc-img-caption></p></div><p>åœ¨å­¦ä¹ çŠ¶æ€æœºå®ç°åŸç†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£çŠ¶æ€æœºçš„äº”ä¸ªå®šä¹‰å¦‚ä¸‹ï¼š</p><ul><li>å®šä¹‰ä¸€ï¼šæœ‰é™çš„çŠ¶æ€</li><li>å®šä¹‰äºŒï¼šæœ‰é™çš„äº‹ä»¶</li><li>å®šä¹‰ä¸‰ï¼šä¸€ä¸ªåˆå§‹çŠ¶æ€</li><li>å®šä¹‰å››ï¼šå˜æ¢å™¨ï¼ˆç»™å®šå½“å‰çŠ¶æ€ + äº‹ä»¶ï¼Œå¯ä»¥å¾—å‡ºä¸‹ä¸ªçŠ¶æ€ï¼‰</li><li>å®šä¹‰äº”ï¼šè‹¥å¹²ä¸ªï¼ˆæˆ–æ— ï¼‰çš„æœ€ç»ˆçŠ¶æ€</li></ul><p>ç„¶åæˆ‘ä»¬ä¾æ®çŠ¶æ€æœºçš„å®šä¹‰è¿›è¡Œé€ä¸ªåˆ†æã€‚</p><h2 class=pgc-h-arrow-right>å®šä¹‰è§£è¯»</h2><h3 class=pgc-h-arrow-right>å®šä¹‰ä¸€ï¼šæœ‰é™çš„çŠ¶æ€</h3><p>çŠ¶æ€æœºä¹‹æ‰€ä»¥è¿™æ ·å‘½åï¼Œå¤§ç•¥éƒ½å¯ä»¥ç†è§£ä¸ºç®¡ç†â€œçŠ¶æ€â€çš„æœºå™¨ã€‚ä»å·¥ä¸šç”Ÿäº§å¯ç”¨æ€§çš„è§’åº¦æ¥çœ‹ï¼Œä»»ä½•äº‹ç‰©éƒ½æ˜¯å¯ä»¥ <strong>è¿‘ä¼¼</strong> çœ‹åšæœ‰é™çš„çŠ¶æ€çš„ã€‚</p><p>æ€ä¹ˆç†è§£å‘¢ï¼Ÿæ¯”å¦‚ä¸€æ¯æ°´çš„æ¸©åº¦å¯ä»¥ç®—ä½œå®ƒçš„çŠ¶æ€ï¼Œç†è®ºä¸Šæ¸©åº¦çš„å€¼æ˜¯æ— é™çš„ï¼Œæ¯”å¦‚æˆ‘å¯ä»¥è¯´æ°´çš„æ¸©åº¦ä» 30Â° å‡åˆ°äº† 30.0001Â° ä¹Ÿç®—æ˜¯çŠ¶æ€å˜åŒ–ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨æ™®éåœºæ™¯ä¸‹ï¼Œå¯¹æ°´çš„æ¸©åº¦ç²¾åº¦å¹¶ä¸ä¼šè¦æ±‚å¾ˆé«˜ã€‚</p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸ºæ°´çš„æ¯ 1Â° å°±æ˜¯ä¸€ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸”æˆ‘ä»¬åªå…³æ³¨ 0Â° ~ 100Â°ã€‚å› æ­¤æ°´çš„æ¸©åº¦çŠ¶æ€å°±åªæœ‰ 100 ä¸ªï¼Œä»è€Œè¡¨è¾¾äº† <strong>æœ‰é™</strong> çš„æ¦‚å¿µã€‚</p><p>å¯¹äºè®¾è®¡å®ç°æ¥è¯´ï¼Œæˆ‘ä»¬æ‹¿ç¯æ³¡ä¸¾ä¾‹å­ï¼Œå‡è®¾ç¯æ³¡æœ‰äº®ã€ä¸äº®ã€åæ‰ä¸‰ä¸ªçŠ¶æ€ï¼Œæˆ‘ä»¬ä»…ä»…ç”¨ä¸€ä¸ªæ•°ç»„å°±å¯ä»¥è¡¨è¾¾å®Œè¿™ä¸ªäº‹æƒ…ã€‚</p><pre><code>const lightBulbStates = ['LIT', 'UNLIT', 'BROKEN'];</code></pre><p>å½“ç„¶ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å“ˆå¸Œè¡¨æˆ–è€… enum æšä¸¾æ‰€æœ‰çŠ¶æ€ã€‚</p><pre><code>const lightBulbStates = {  lit: 'LIT',  unlit: 'UNLIT',  broken: 'BROKEN',};</code></pre><h3 class=pgc-h-arrow-right>å®šä¹‰äºŒï¼šæœ‰é™çš„äº‹ä»¶</h3><p>ä»€ä¹ˆæ˜¯äº‹ä»¶ï¼Ÿ</p><p>ä¸¾ä¸ªä¾‹å­ï¼šæ¯”å¦‚è¯´å°æ˜å¿ƒå¦‚æ­¢æ°´åœ°åœ¨å·¥ä½œï¼Œçªç„¶éš”å£åŒäº‹ç»™äº†ä»–ä¸€å·´æŒï¼Œå°æ˜æ°”ç‚¸äº†ï¼Œå‡†å¤‡æ’¸èµ·è¢–å­å»æ‰“æ¶ã€‚</p><p>è¿™é‡Œå°æ˜å°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œä»–ä» <strong>å¿ƒå¦‚æ­¢æ°´</strong> çš„çŠ¶æ€ï¼Œè½¬æ¢åˆ°äº† <strong>æ°”ç‚¸äº†</strong> çš„çŠ¶æ€ï¼Œå…¨å› å‘ç”Ÿäº† <strong>è¢«åŒäº‹æ‰‡äº†ä¸€å·´æŒ</strong> çš„äº‹ä»¶ï¼Œå¹¶ä¸”äº§ç”Ÿäº† <strong>å‡†å¤‡å»å¹²æ¶</strong> çš„è¡Œä¸ºå‰¯ä½œç”¨ã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><p>å¿ƒå¦‚æ­¢æ°´ï¼ˆçŠ¶æ€ï¼‰ + è¢«æ‰‡ä¸€å·´æŒï¼ˆäº‹ä»¶ï¼‰ = æ°”ç‚¸äº†ï¼ˆæ–°çš„çŠ¶æ€ï¼‰+ å‡†å¤‡å¹²æ¶ï¼ˆå‰¯ä½œç”¨ï¼‰ã€‚</p><p>å½“ç„¶åŒäº‹ä¹‹é—´è¿˜æ˜¯è¦å›¢ç»“å‹çˆ±å•¦ï¼Œå›å­åŠ¨å£ä¸åŠ¨æ‰‹ï¼Œæˆ‘ä»¬è¦ä»¥ç†æœäººï¼Œæ˜¯å§ã€‚</p><p>åŸºäºä¸Šè¿°çš„ä¾‹å­ï¼Œæˆ‘ä»¬è¿›è¡ŒæŠ½è±¡ï¼Œæ€»ç»“å¾—å‡ºå…¬å¼å¦‚ä¸‹ï¼š</p><pre><code>state + event = newState + effect</code></pre><p>å› æ­¤ï¼Œå› ä¸ºçŠ¶æ€æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥å½“ç„¶äº‹ä»¶ä¹Ÿæ˜¯æœ‰é™çš„ã€‚å°±æ¯”å¦‚å›¾æœ‰ä¸‰ä¸ªé¡¶ç‚¹ï¼Œç‚¹ä¹‹é—´çš„è¿çº¿å¦‚æœæœ‰å‘ï¼Œé‚£ä¹Ÿåªæœ‰å…­æ¡çº¿ï¼ˆ2 ^ 3 = 6ï¼‰ï¼Œè¿™å¾ˆå¥½ç†è§£ã€‚</p><p>å†ç»“åˆåˆ°æˆ‘ä»¬çš„ç¯æ³¡çŠ¶æ€æœºæ¥çœ‹ï¼Œå®ƒçš„äº‹ä»¶æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><pre><code>unlit + TOGGLE = lit + effectlit + TOGGLE = unlit + effectunlit + BREAK = broken + effectlit + BREAK = broken + effect</code></pre><p>æˆ‘ä»¬æ•´ç†ä¸€ä¸‹ï¼Œç”¨ JavaScript å¯¹è±¡æ¥è¡¨è¿°è¿™ä¸ªäº‹æƒ…ï¼š</p><pre><code>const lightBulbEventMap = {  unlit: {    on: {      TOGGLE: 'lit',      BREAK: 'broken',    },  },  lit: {    on: {      TOGGLE: 'unlit',      BREAK: 'broken',    },  },  broken: {},};</code></pre><p>è¿™æ ·çŠ¶æ€ä¸äº‹ä»¶ä¹‹é—´çš„å…³ç³»å°±ä¸€ç›®äº†ç„¶äº†ã€‚</p><h3 class=pgc-h-arrow-right>å®šä¹‰ä¸‰ï¼šä¸€ä¸ªåˆå§‹çŠ¶æ€</h3><p>ç›˜å¤å¼€å¤©ã€å¥³å¨²é€ äººã€ä¼Šç”¸å›­é‡Œçš„äºšå½“å¤å¨ƒï¼Œä¸‡äº‹ä¸‡ç‰©éƒ½æœ‰ä¸€ä¸ªåˆå§‹çŠ¶æ€ã€‚å°±åƒäººçš„ä¸€ç”Ÿä¹Ÿä¼šä»å‘±å‘±è½åœ°å¼€å§‹ï¼Œåˆ°åŒ–ä½œä¸€æŠ”é»„åœŸç»“æŸï¼Œæ•´ä¸ªè¿‡ç¨‹æ˜¯éšæ—¶é—´æµé€è€Œä¸æ–­å˜æ¢çš„ï¼Œæˆ‘ä»¬ä¸å¯èƒ½ç›´æ¥ç»•è¿‡å¼€å§‹ï¼Œç›´æ¥åˆ°ä¸­é—´æŸä¸ªèŠ‚ç‚¹ã€‚</p><p>å¯¹äºçŠ¶æ€æœºæ¥è¯´ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ç¯æ³¡ä¹°å›æ¥ä¸€èˆ¬å¤„äºæœªç‚¹äº®çš„çŠ¶æ€ï¼ˆæ­£å¸¸æ¥è¯´ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç”¨ JavaScript å¯¹è±¡æ¥è¡¨è¿°è¿™ä¸ªäº‹æƒ…ï¼š</p><pre><code>const lightBulbMachine = {  initial: 'unlit',  states: {    unlit: {      on: {        TOGGLE: 'lit',        BREAK: 'broken',      },    },    lit: {      on: {        TOGGLE: 'unlit',        BREAK: 'broken',      },    },    broken: {},  },};</code></pre><h3 class=pgc-h-arrow-right>å®šä¹‰å››ï¼šå˜æ¢å™¨ï¼ˆç»™å®šå½“å‰çŠ¶æ€ + äº‹ä»¶ï¼Œå¯ä»¥å¾—å‡ºä¸‹ä¸ªçŠ¶æ€ï¼‰</h3><p>å…¶å®åˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»æŠŠç¯æ³¡çš„çŠ¶æ€ã€äº‹ä»¶éƒ½å®šä¹‰å®Œäº†ã€‚ä½†æˆ‘ä»¬ä»ç„¶éœ€è¦ç»™å‡ºå˜æ¢å™¨çš„å®ç°ï¼Œç”¨ä»¥å®ç°çŠ¶æ€ä¸çŠ¶æ€ä¹‹å‰çš„è¿‡æ¸¡ã€‚</p><p>å˜æ¢å™¨å®ç°å¤æ‚ä¹ˆï¼Ÿä¸ï¼Œä¸€ç‚¹ä¹Ÿä¸ã€‚è¯·çœ‹ï¼š</p><pre><code>function transition(state, event) {  return machine.states[state].on[event];}</code></pre><p>ç„¶åæˆ‘ä»¬å¯ä»¥ç”¨å˜æ¢å™¨å‡½æ•°å¯¹ç¯æ³¡çš„çŠ¶æ€è¿›è¡Œè¿ç®—</p><pre><code>const newState = transition('unlit', 'TOGGLE'); // lit</code></pre><p>æˆ–è€…~</p><pre><code>const newState = transition('lit', 'BREAK'); // broken</code></pre><p>å‡å¦‚ç¯æ³¡åäº†ï¼Œæˆ‘ä»¬è¿˜æ˜¯æƒ³ç‚¹äº®å®ƒï¼Œæ€ä¹ˆåŠï¼Ÿ</p><pre><code>const newState = transition('broken', 'TOGGLE'); // Throw error</code></pre><p>çŠ¶æ€æœºå‘Šè¯‰ä½ ï¼Œç—´å¿ƒå¦„æƒ³ï¼</p><h3 class=pgc-h-arrow-right>å®šä¹‰äº”ï¼šè‹¥å¹²ä¸ªï¼ˆæˆ–æ— ï¼‰çš„æœ€ç»ˆçŠ¶æ€</h3><p>å‰é¢è¯´åˆ°ä¸‡äº‹ä¸‡ç‰©éƒ½æœ‰èµ·ç‚¹ï¼Œæ‰€ä»¥æŒ‰é“ç†æ¥è¯´ï¼Œåº”è¯¥ä¹Ÿå¿…ç„¶æœ‰ç»ˆç‚¹ã€‚ä½†æ˜¯è€ƒè™‘åˆ°å®é™…åº”ç”¨ä¸­ï¼Œå…¶å®æŠ½è±¡æ¥è¯´æœªå¿…éœ€è¦ä¸€ä¸ªç»ˆç‚¹ã€‚å°±æ¯”å¦‚ç½‘ç«™ç”¨æˆ·å¯ä»¥ç™»å½•ã€æ¼«æ¸¸ã€é€€å‡ºã€å†ç™»å½•ã€å†æ¼«æ¸¸ç­‰ç­‰ï¼Œå®ƒå¹¶æ²¡æœ‰ä¸€ä¸ªå®é™…çš„ç»ˆç‚¹ã€‚</p><p>ä½†æ˜¯ä¹Ÿå¯ä»¥æœ‰ç»ˆç‚¹ã€‚æ¯”å¦‚ Promise è¯·æ±‚ï¼Œä» init åˆ° pendingï¼Œå†è¿”å› resolve ä»£è¡¨æˆåŠŸï¼Œæˆ–è€… reject ä»£è¡¨å¤±è´¥ã€‚å®ƒæœ‰ä¸¤ä¸ªç»ˆç‚¹ã€‚</p><p>æ¯”å¦‚äººä»å‡ºç”Ÿåˆ°é€å»ï¼Œå®è§‚ä¸Šæ¥è¯´ï¼Œåˆ†åˆ«å¯¹åº”ç€åˆå§‹çŠ¶æ€ã€æœ€ç»ˆçŠ¶æ€ã€‚</p><p>æˆ‘ä»¬è¿˜æ˜¯å›åˆ°æˆ‘ä»¬çš„ç¯æ³¡çŠ¶æ€æœºï¼Œbroken å°±æ˜¯å®ƒçš„æœ€ç»ˆçŠ¶æ€ã€‚çŠ¶æ€æœºä¸€æ—¦æŠµè¾¾åˆ°æœ€ç»ˆçš„çŠ¶æ€ï¼Œå°±ç›¸å½“äºç»“æŸäº†ã€‚</p><pre><code>const lightBulbMachine = {  initial: 'unlit',  states: {    // ...    broken: {      type: 'final',    },  },};</code></pre><h2 class=pgc-h-arrow-right>çŠ¶æ€æœºæœ€ç®€å•å®ç°</h2><p>æ¥ï¼Œè®©æˆ‘ä»¬å®ç°ä¸€ä¸ªçŠ¶æ€æœºå§ï¼</p><pre><code>function createMachine({ initial, states }) {  const machine = {    initialState: initial,    transition: (state, event) =&gt; states[state].on[event]  };  return machine;}</code></pre><p>åŒå­¦ä»¬è‚¯å®šä¼šè§‰å¾—ï¼Œå°±è¿™ä¹ˆç®€å•ä¹ˆï¼Ÿå…¶å®æœ¬è´¨ä¸Šå°±è¿™æ ·ã€‚è™½ç„¶å¦‚æ­¤ç®€å•çš„å®ç°ï¼Œæ˜¯ç»å¯¹ä¸èƒ½æ”¯æ’‘èµ·æˆ‘ä»¬å¤æ‚çš„ä¸šåŠ¡åœºæ™¯éœ€æ±‚çš„ã€‚ä½†æ˜¯ä¸€æ—¦åªè¦æ˜ç™½äº†æœ¬è´¨ï¼Œæ‰©å±•çš„å®ç°ç†è§£èµ·æ¥ä¹Ÿä¸ä¼šå¾ˆå›°éš¾ã€‚</p><h2 class=pgc-h-arrow-right>å‰¯ä½œç”¨</h2><p>ä¸Šæ–‡çš„çŠ¶æ€æœºå®ç°å…¶å®æœ¬è´¨ä¸Šæ˜¯ä¸ªçº¯å‡½æ•°ï¼Œä½†æˆ‘ä»¬ä»”ç»†è§‚å¯Ÿä¸Šæ–‡æåˆ°è¿‡çš„å…¬å¼ã€‚</p><pre><code>state + event = newState + effect</code></pre><p>å…³äºå‰¯ä½œç”¨æˆ‘ä»¬å´åªå­—æœªæã€‚åœ¨å¤§å‹çš„åº”ç”¨ä¸­ï¼Œå‰¯ä½œç”¨æ˜¯åˆ°å¤„å­˜åœ¨çš„ï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ã€æœ¬åœ°æ—¥å¿—å­˜å‚¨ã€é”™è¯¯è¾“å‡ºã€DOM æ“ä½œã€æ•°æ®åº“å†™å…¥ã€äº‹ä»¶æ³¨å†Œç›‘å¬ã€‚</p><p>çº¯å‡½æ•°å¯ä»¥æé«˜æˆ‘ä»¬ä»£ç çš„è´¨é‡ï¼Œä½†æ˜¯å´ä¸èƒ½è¡¨è¾¾å¤æ‚çš„ä¸šåŠ¡ã€‚</p><p>çŠ¶æ€æœºä¹Ÿæ˜¯å¦‚æ­¤ã€‚çŠ¶æ€æœºå¯ä»¥é€šè¿‡æ³¨å†Œæ´»åŠ¨ï¼ˆActivitiesï¼‰ã€ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ã€è®¢é˜…çŠ¶æ€æœºæœåŠ¡ï¼ˆService.subscribeï¼‰ç­‰æ–¹å¼è¿›è¡Œè¡¨è¾¾å‰¯ä½œç”¨ã€‚</p><p>è¿™äº›éƒ½å¯ä»¥å» <strong>XState Docs</strong> XState å®˜ç½‘è¿›è¡Œå­¦ä¹ äº†è§£ã€‚</p><h2 class=pgc-h-arrow-right>æºç è§£è¯»</h2><p>è¿™é‡Œè´´ä¸Šäº†æœ€ç®€å•çš„çŠ¶æ€æœºå®ç°ï¼ˆ@xstate/fsmï¼‰çš„æ³¨é‡Šã€‚é™¤äº†åŒ…å«äº†ä¸Šè¿°æœ€åŸºæœ¬çš„äº”ä¸ªå®šä¹‰ã€è¿˜æœ‰æ‰©å±•ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ã€æ¡ä»¶å®ˆæŠ¤ï¼ˆcondï¼‰ã€çŠ¶æ€æœºè§£é‡ŠæœåŠ¡ï¼ˆserviceï¼‰ç­‰ã€‚</p><p>å¯¹çŠ¶æ€æœºæ›´è¿›ä¸€æ­¥å®ç°æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥é˜…è¯»ã€‚</p><pre><code>// xstate.jsimport {  toTransitionObject, toActionObject, toEventObject, toArray, isString, isFunction} from './util';const INIT_EVENT = { type: 'xstate.init' };const ASSIGN_ACTION = 'xstate.assign';function createMatcher(value) {  return stateValue =&gt; value === stateValue;}function createUnchangedState(value, context) {  return {    value,    context,    actions: [],    changed: false,    matches: createMatcher(value)  };}export function assign(assignment) {  return {    type: ASSIGN_ACTION,    assignment  }}export function execActions(state, event) {  state.actions.forEach(({ exec }) =&gt; {    exec &amp;&amp; exec(state.context, event);  });}// é€šè¿‡çº¦å®šçš„çŠ¶æ€æœºé…ç½®ï¼Œç”Ÿäº§ä¸€ä¸ªæœ‰é™çŠ¶æ€æœº// çŠ¶æ€æœºå®šä¹‰å¦‚ä¸‹ï¼š// - å®šä¹‰ä¸€ï¼šæœ‰é™çš„çŠ¶æ€// - å®šä¹‰äºŒï¼šæœ‰é™çš„äº‹ä»¶// - å®šä¹‰ä¸‰ï¼šä¸€ä¸ªåˆå§‹çŠ¶æ€// - å®šä¹‰å››ï¼šå˜æ¢å™¨ï¼ˆç»™å®šå½“å‰çŠ¶æ€ + äº‹ä»¶ï¼Œå¯ä»¥å¾—å‡ºä¸‹ä¸ªçŠ¶æ€ï¼‰// - å®šä¹‰äº”ï¼šè‹¥å¹²ä¸ªï¼ˆæˆ–æ— ï¼‰çš„æœ€ç»ˆçŠ¶æ€export function createMachine(fsmConfig, options = {}) {  function getCombinedActions({ states, initial }) {    const entryAction = states[initial].entry;    return toArray(      entryAction    ).map(action =&gt; toActionObject(action, options.actions));  }  function getContext() {    return fsmConfig.context || {};  }  const machine = {    _options: options,    config: fsmConfig,    // å®ç°å®šä¹‰ä¸‰ - ä¸€ä¸ªåˆå§‹çŠ¶æ€èŠ‚ç‚¹    initialState: {      // çŠ¶æ€å€¼      value: fsmConfig.initial,      // äº‹ä»¶      actions: getCombinedActions(fsmConfig),      // ä¸Šä¸‹æ–‡      context: getContext(),      // çŠ¶æ€åŒ¹é…åˆ¤æ–­æ–¹æ³•      matches: createMatcher(fsmConfig.initial)    },    // å®ç°å®šä¹‰å›› - å˜æ¢å™¨    transition: (state, event) =&gt; {      const { value, context } = isString(state) ?        { value: state, context: getContext() } : state;      const eventObject = toEventObject(event);      const stateConfig = fsmConfig.states[value];      if (stateConfig.on) {        // æ ¹æ®äº‹ä»¶ç±»å‹å–å¾—å¯¹åº”çš„å˜æ¢å™¨        const transitions = toArray(stateConfig.on[eventObject.type]);        for (const transtion of transitions) {          // å®é™…ä¸Šæ²¡æœ‰ä»»ä½•å˜æ¢å™¨ã€æˆ–ä½¿ç”¨ undefined ä¸­æ–­äº†å˜æ¢å™¨          if (transtion === undefined) {            return createUnchangedState(value, context);          }          const { target = value, actions = [], cond = () =&gt; true } = toTransitionObject(transtion);          let nextContext = context;          // æ¡ä»¶å®ˆæŠ¤ï¼Œåªè¦æ»¡è¶³ä¸€ä¸ªå˜æ¢å™¨ï¼Œç›´æ¥é€€å‡º          if (cond(context, eventObject)) {            // åˆ¤æ–­ä¸Šä¸‹æ–‡æ˜¯å¦è¢«ä¿®æ”¹            let assigned = false;            // è·å–ä¸‹ä¸ªçŠ¶æ€å¯¹è±¡èŠ‚ç‚¹            const nextStateConfig = fsmConfig.states[target];            const allActions = []              // ä¾æ¬¡è¿›è¡Œå½“å‰çŠ¶æ€çš„ Exit Actionã€å½“å‰çŠ¶æ€çš„ Action é›†åˆã€ä¸‹ä¸ªçŠ¶æ€çš„ Entry Action              .concat(                stateConfig.exit, actions, nextStateConfig.entry              )              // è¿‡æ»¤å‡å€¼              .filter(a =&gt; a)              // å¯»æ‰¾ Action é…ç½®ï¼Œè¿”å›ç»Ÿä¸€æ ¼å¼çš„ Action å¯¹è±¡              .map(action =&gt; toActionObject(action, machine._options.actions))              // å†…éƒ¨äº‹ä»¶ï¼Œæ”¯æŒ assign å‡½æ•°ä¿®æ”¹ä¸Šä¸‹æ–‡              .filter(action =&gt; {                if (action.type === ASSIGN_ACTION) {                  assigned = true;                  let tmpContext = Object.assign({}, nextContext);                  if (isFunction(action.assignment)) {                    tmpContext = action.assignment(nextContext, eventObject);                  } else {                    Object.keys(action.assignment).forEach(key =&gt; {                      const assignment = action.assignment[key];                      tmpContext[key] = isFunction(assignment) ? assignment(nextContext, eventObject) : assignment                    });                  }                  nextContext = tmpContext;                  return false;                }                return true;              });            return {              value: target,              context: nextContext,              actions: allActions,              changed: target !== value || allActions.length &gt; 0 || assigned,              matches: createMatcher(target)            };          }        }      }      // çŠ¶æ€èŠ‚ç‚¹æœªæ³¨å†Œä»»ä½•å˜æ¢å™¨ã€æ¡ä»¶å®ˆæŠ¤æœªæ»¡è¶³ï¼Œå¯¼è‡´åœç•™åœ¨åŸæœ¬çš„çŠ¶æ€èŠ‚ç‚¹      return createUnchangedState(value, context);    }  };  return machine;}// çŠ¶æ€æœºæœåŠ¡çš„çŠ¶æ€export const INTERPRETER_STATUS = {  NotStarted: 0,  Running: 1,  Stopped: 2};// å°† Machine è§£é‡Šä¸ºä¸€ä¸ªçŠ¶æ€æœºæœåŠ¡ï¼Œåº”ç”¨äºå®é™…ç”Ÿäº§ç¯å¢ƒexport function interpret(machine) {  let state = machine.initialState;  let status = INTERPRETER_STATUS.NotStarted;  // ç”¨ä»¥è®¢é˜…çŠ¶æ€æœºæœåŠ¡  const listeners = new Set();  const service = {    _machine: machine,    send(event) {      // çŠ¶æ€æœºæœåŠ¡æœªå¯åŠ¨æ—¶ï¼Œä¸å…è®¸å‘é€äº‹ä»¶      if (status !== INTERPRETER_STATUS.Running) {        return;      }      // é€šè¿‡å˜æ¢å™¨æ›´æ–°çŠ¶æ€      state = machine.transition(state, event);      // æ‰§è¡Œå½“å‰çŠ¶æ€çš„æ‰€æœ‰ Actionï¼ˆAction é›†åˆåœ¨ Machine ä¸­å·²è¿›è¡Œè®¡ç®—ï¼‰      execActions(state, toEventObject(event));      listeners.forEach((listener) =&gt; listener(state));      return service;    },    subscribe: (listener) =&gt; {      listeners.add(listener);      listener(state);      return {        unsubscribe: () =&gt; listeners.delete(listener)      };    },    // çŠ¶æ€æœºæœåŠ¡å¯åŠ¨    start: () =&gt; {      status = INTERPRETER_STATUS.Running;      execActions(state, INIT_EVENT);      return service;    },    // çŠ¶æ€æœºæœåŠ¡æš‚åœ    stop: () =&gt; {      status = INTERPRETER_STATUS.Stopped;      listeners.clear();      return service;    },    get state() {      return state;    },    get status() {      return status;    }  };  return service;}export const Machine = createMachine;</code></pre><pre><code>// util.jsexport function toArray(item) {  return item === undefined ? [] : [].concat(item);}export function isString(o) {  return typeof o === 'string';}export function isFunction(o) {  return typeof o === 'function';}export function toActionObject(action, actionMap = {}) {  action = isString(action) &amp;&amp; actionMap[action] ?    actionMap[action] : action;  if (isString(action)) {    return {      type: action    };  } else if (isFunction(action)) {    return {      type: action.name,      exec: action    }  } else {    return action;  }}export function toEventObject(event) {  return isString(event) ? { type: event } : event;}export function toTransitionObject(transition) {  return isString(transition) ? { target: transition } : transition;}</code></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'é’Ÿå­¦ä¼š','çŠ¶æ€æœº','å®ç°'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>