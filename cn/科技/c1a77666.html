<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>「Tensorflow」手把手CNN入门：手写数字识别 | 极客快訊</title><meta property="og:title" content="「Tensorflow」手把手CNN入门：手写数字识别 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/f59d64c855274cc0ab6891b2a473ffdd"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c1a77666.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c1a77666.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c1a77666.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c1a77666.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c1a77666.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c1a77666.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c1a77666.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c1a77666.html><meta property="article:published_time" content="2020-10-29T21:12:41+08:00"><meta property="article:modified_time" content="2020-10-29T21:12:41+08:00"><meta name=Keywords content><meta name=description content="「Tensorflow」手把手CNN入门：手写数字识别"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/c1a77666.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>「Tensorflow」手把手CNN入门：手写数字识别</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p><em>摘要：</em> 手把手带你实战——《CNN入门：手写数字识别》！</p><p>深度学习最令人兴奋的领域之一就是计算机视觉。通过卷积神经网络，我们已经能够创建自动驾驶汽车系统、面部检测系统和自动医学图像分析等等。在本文中，我将向你展示卷积神经网络的基本原理以及如何自己创建一个对手写数字进行分类的系统。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f59d64c855274cc0ab6891b2a473ffdd><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>卷积神经网络的功能似乎是人类大脑中生物功能的复制，早在1959年，David Hubel和Torsten Wiesel对猫和猴进行了研究，这些研究揭示了动物视觉皮层的功能。他们发现的是，许多神经元具有小的局部接受性，即仅对整个视野的一小块有限区域起反应。他们发现某些神经元会对某些特定模式做出反应，例如水平线、垂直线和其他圆形。他们还发现其他神经元具有更大的感受野并且被更复杂的模式刺激，这些模式是由较低水平神经元收集的信息组合。这些发现奠定了我们现在称之为卷积神经网络的基础。接下来，我们逐一介绍卷积神经网络的组成。</p><p>1、卷积层</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/90fb127c389647428439a33528c34d62><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>卷积神经网络中每层卷积层由若干卷积单元组成，每个卷积单元的参数都是通过反向传播算法最佳化得到的。卷积运算的目的是提取输入的不同特征，第一层卷积层可能只能提取一些低级的特征如边缘、线条和角等层级，更多层的网路能从低级特征中迭代提取更复杂的特征。你可以将每个过滤器描绘成一个窗口，该窗口在图像的尺寸上滑动并检测属性。滤镜在图像上滑动的像素数量称为步幅。步幅为1意味着滤波器一次移动一个像素，其中2的步幅将向前跳过2个像素。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d2f163ee68654c2d9a384e8116870c6d><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>在上面的例子中，我们可以看到一个垂直线检测器。原始图像为6x6，它使用3x3滤镜进行扫描，步长为1，从而产生4x4尺寸输出。而过滤器仅对其视野左右列中的部分感兴趣。通过对图像的输入求和并乘以3×3滤波器的配置，我们得到3+1+2-1-7-5=-7。然后滤波器向右移动一步，然后计算1+0+3-2-3-1=-2。-2然后进入-7右侧的位置。此过程将持续到4x4网格完成为止。之后，下一个特征图将使用它自己的唯一过滤器/内核矩阵计算自己的值。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12de662490994a91bc9ad35dd0a1ed86><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>2.池化层</p><p>池化层的目标是通过聚合卷积层收集的值或所谓的子采样来进一步降低维度。除了为模型提供一些正则化的方案以避免过度拟合之外，这还将减少计算量。它们遵循与卷积层相同的滑动窗口思想，但不是计算所有值，而是选择其输入的最大值或平均值。这分别称为最大池化和平均池化。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/cd1030e8284c42118e6f6a9723548b82><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>这两个组件是卷积层的关键构建块。然后，你通常会重复此方法，进一步减少特征图的尺寸，但会增加其深度。每个特征图将专门识别它自己独特的形状。在卷积结束时，会放置一个完全连接的图层，其具有激活功能，例如Relu或Selu，用于将尺寸重新整形为适合的尺寸送入分类器。例如，如果你的最终转换层为3x3x128矩阵，但你只预测10个不同的类，则需要将其重新整形为1x1152向量，并在输入分类器之前逐渐减小其大小。完全连接的层也将学习它们自己的特征，如在典型的深度神经网络中。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/35faba6fa77d4fe4ac67830fe833ca65><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>现在让我们看看在MNIST手写数字数据集上的Tensorflow中的实现。首先，我们将加载我们的库。使用sklearn中的fetch_mldata，我们加载mnist数据集并将图像和标签分配给x和y变量。然后我们将创建我们的训练/测试装置。最后，我们将举几个例子来了解任务。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1a0afdd0b879496a8fdc999a2fa89b9a><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3eb2504cab124d6b877d3502b336bd10><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>接下来，我们将进行一些数据增强，这是提高模型性能的可靠方法。通过创建训练图像的轻微变化，可以为模型创建正则化。我们将使用Scipy的ndimage模块将图像向右、向左、向上和向下移动1个像素。这不仅提供了更多种类的例子，而且还会大大增加我们训练集的大小。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/238b5b91e3c640d0850c6cb47fbd366c><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5ca96efcd4454df79781b5edad8f8908><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8c96aff5a2354f79a7f1171e5e7657f0><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>我将向你展示的最后一种数据增强的方式：使用cv2库创建图像的水平翻转。我们还需要为这些翻转图像创建新标签，这与复制原始标签一样简单。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/8ae9cca549a24cc0a266da0677dc8a38><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>设置“flipCode = 0”将产生垂直翻转</p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/14699b04ffa44ffbbe42d0fff563c6da><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>接下来，我们将创建一个辅助函数，用于将随机微型批次提供给我们的神经网络输入。由于卷积层的性质，它们在前向和后向传播步骤期间需要大量的存储器。考虑具有4x4滤镜的图层，输出128步幅为1的特征图和具有尺寸299x299的RGB图像输入的SAME填充。参数的数量将相等（4x4x3+1）x128 = 6272.现在考虑这128个特征图中的每一个都计算299x299个神经元，并且这些神经元中的每一个都计算4x4x3输入的加权和。这意味着我们需要4x4x3x299x299x150=643,687,200次计算，这只是一个训练的例子。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/91bc72adcd304cbeb0a6d55c012f5a0c><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>现在我们开始创建我们的网络架构。首先，我们为我们的培训数据/特征创建占位符。我们需要将它们重新整形为（-1,28,28,1）矩阵，因为tensorflow conv2d层需要4维输入。我们将第一个维度设置为“null”，以允许将任意批量大小提供给占位符。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/43813778fcb143f18f55fe4047c89bb6><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>接着我们设计我们的卷积层，我是从Le-NET5（由Yann LeCun开创）网络架构中获取灵感，该架构因其在手写数字分类方面成功而闻名。我建议你研究Le-NET5以及其他经过验证的模型，这样就可以了解哪种卷积网络适用于不同的任务。链接：http://yann.lecun.com/exdb/publis/pdf/lecun-01a.pdf。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/96bcffbbdba74a779beb3f4d13627806><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>我们模型卷积层的第一层由12个特征图组成，使用3x3过滤器，步幅为1。我们选择了SAME填充，通过在输入周围添加一个零填充来保持图像的尺寸。然后，我们设置最大池化层使用3x3过滤器，步幅为1，这将输出13x13x12矩阵。所以我们从一个28x28x1的图像开始，然后我们将这个矩阵传递给第二个转换层，第二个转换层具有3x3过滤器的深度，stride=1和SAME填充。这将输出一个6*6*16维矩阵。你可以看到我们正在缩小特征图的维度空间，但要更深入。接下来，我们使用Selu函数激活两个密集层来减少每层输入的数量大约一半，直到最终将它们输入我们的logits。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5b5610c4f10d49028253d775f1a2a2ea><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>接着我们创建我们的损失函数，在这种情况下，它将是softmax交叉熵，它将输出多类概率。你可以将交叉熵视为各种数据点之间距离的度量。我们选择AdamOptimizer（自适应矩估计），当梯度下降时自动调整它的学习率。最后，我们创建了一种评估结果的方法。Tensorflow的in_top_k函数将计算我们的logits并选择最高分。然后我们使用我们的准确度变量输出0-1％之间的百分比。</p><p>现在我们已经为训练阶段做好了准备，让我们看看我们的模型表现得如何。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cef16d2022da4484b5af0fce0cc30301><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>在第19epoch，我们的正确率在0.9907。这已经比任何机器学习算法的结果更好，因此卷积已经取得了领先。现在让我们尝试使用我们的移位功能/翻转功能，并为我们的网络添加两个新元素：dropout和批量标准化。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6ccf0135aa954882b179d70c61807583><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>我们使用placeholder_with_default节点修改现有占位符，这些节点将保存批量标准化和dropout层生成的值。在训练期间，我们将这些值设置为True，在测试期间，我们将通过设置为False将其关闭。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9ceec8550f7e4f7e8a0402387e19a046><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>批量标准化只是简单地对每批次的数据进行标准化。我们指定了0.9的动量。而dropout和正则化指定动量为1才能在训练期间完全随机地关闭节点。这导致其余节点必须松弛，从而提高其有效性。想象一下，一家公司决定每周随机选择50名员工留在家里。其余的工作人员将不得不有效地处理额外的工作，提高他们在其他领域的技能。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0151d437b24b4563a0741ecda8f60be1><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>接着我们创建我们的损失函数，训练步骤和评估步骤，然后对我们的执行阶段进行一些修改。通过批量标准化执行的计算在每次迭代期间保存为更新操作。为了访问这些，我们分配一个变量extra_update_ops = tf.get_collection（tf.GraphKeys.UPDATE_OPS）。在我们的训练操作期间，我们将其作为列表项与training_op一起提供给sess.run。最后，在执行验证/测试预测时，我们通过feed_dict为占位符分配False值。我们不希望在预测阶段有任何随机化。为了获得输出，我们使用我们的测试集运行logits操作。让我们看看这个模型添加正则化/标准化并且正在使用增强数据的方法后表现得如何。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/639fbd65ddeb46cd9685238dc265b790><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>在29epoch，我们在10,000个数字的测试集上达到了99.5％的准确率。正如你所看到的那样，第二个epoch时模型精确度达到了99％，而之前的模型只有16%。虽然0.05％可能不是很多，但在处理大量数据时这是一个重大改进。最后，我将向你展示如何在logits输出上使用np.argmax产生的预测。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=「Tensorflow」手把手CNN入门：手写数字识别 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ebad324352304267b48ba56db750b36d><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>本文由阿里云云栖社区组织翻译。</p><p>文章原标题《convolutional-neural-net-in-tensorflow》</p><p>作者：Stephen Barter 译者：虎说八道，审校：。</p><p>文章为简译，更为详细的内容，请查看<strong>原文。</strong></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Tensorflow','CNN','入门'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>