<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>é¢è¯•å¿…å¤‡ï¼šHashMapæºç è§£æ | æå®¢å¿«è¨Š</title><meta property="og:title" content="é¢è¯•å¿…å¤‡ï¼šHashMapæºç è§£æ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/03f9864cd43d4878900fc2a9784d702e"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c538446f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c538446f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c538446f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c538446f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c538446f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c538446f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c538446f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c538446f.html><meta property="article:published_time" content="2020-10-29T21:09:20+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:20+08:00"><meta name=Keywords content><meta name=description content="é¢è¯•å¿…å¤‡ï¼šHashMapæºç è§£æ"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/c538446f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>é¢è¯•å¿…å¤‡ï¼šHashMapæºç è§£æ</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><pre><code>è®¤çœŸå†™æ–‡ç« ï¼Œç”¨å¿ƒåšåˆ†äº«ã€‚å…¬ä¼—å·ï¼šJavaè€•è€˜è€…</code></pre><p>æ•´ä¸ªHashMapç¤ºæ„å›¾ï¼š</p><div class=pgc-img><img alt=é¢è¯•å¿…å¤‡ï¼šHashMapæºç è§£æ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/03f9864cd43d4878900fc2a9784d702e><p class=pgc-img-caption></p></div><p>HashMapçš„æºç ä¸­ï¼Œå……æ–¥ä¸ªå„ç§ä½è¿ç®—ä»£æ›¿å¸¸è§„è¿ç®—çš„åœ°æ–¹ï¼Œä»¥æå‡æ•ˆç‡ï¼š</p><ul><li>ä¸è¿ç®—æ›¿ä»£æ¨¡è¿ç®—ã€‚ç”¨ hash & (table.length-1) æ›¿ä»£ hash % (table.length)</li><li>ç”¨if ((e.hash & oldCap) == 0)åˆ¤æ–­æ‰©å®¹åï¼ŒèŠ‚ç‚¹eå¤„äºä½åŒºè¿˜æ˜¯é«˜åŒºã€‚</li></ul><h2 class=pgc-h-arrow-right>3 é“¾è¡¨èŠ‚ç‚¹Node</h2><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æŒ‚è½½åœ¨å“ˆå¸Œè¡¨ä¸Šçš„å…ƒç´ ï¼Œé“¾è¡¨çš„ç»“æ„ï¼š</p><pre><code>    static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; {        final int hash;//å“ˆå¸Œå€¼        final K key;//key        V value;//value        Node&lt;K,V&gt; next;//é“¾è¡¨åç½®èŠ‚ç‚¹        Node(int hash, K key, V value, Node&lt;K,V&gt; next) {            this.hash = hash;            this.key = key;            this.value = value;            this.next = next;        }        public final K getKey()        { return key; }        public final V getValue()      { return value; }        public final String toString() { return key + "=" + value; }        //æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„hashå€¼ï¼Œæ˜¯å°†keyçš„hashCode å’Œ valueçš„hashCode äº¦æˆ–å¾—åˆ°çš„ã€‚        public final int hashCode() {            return Objects.hashCode(key) ^ Objects.hashCode(value);        }        //è®¾ç½®æ–°çš„value åŒæ—¶è¿”å›æ—§value        public final V setValue(V newValue) {            V oldValue = value;            value = newValue;            return oldValue;        }        public final boolean equals(Object o) {            if (o == this)                return true;            if (o instanceof Map.Entry) {                Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;                if (Objects.equals(key, e.getKey()) &amp;&amp;                    Objects.equals(value, e.getValue()))                    return true;            }            return false;        }    }</code></pre><p><strong>ç”±æ­¤å¯çŸ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªå•é“¾è¡¨~ã€‚<br>æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„hashå€¼ï¼Œæ˜¯å°†keyçš„hashCode å’Œ valueçš„hashCode äº¦æˆ–å¾—åˆ°çš„ã€‚</strong></p><h2 class=pgc-h-arrow-right>4 æ„é€ å‡½æ•°</h2><pre><code>    //æœ€å¤§å®¹é‡ 2çš„30æ¬¡æ–¹    static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;    //é»˜è®¤çš„åŠ è½½å› å­    static final float DEFAULT_LOAD_FACTOR = 0.75f;    //å“ˆå¸Œæ¡¶ï¼Œå­˜æ”¾é“¾è¡¨ã€‚ é•¿åº¦æ˜¯2çš„Næ¬¡æ–¹ï¼Œæˆ–è€…åˆå§‹åŒ–æ—¶ä¸º0.    transient Node&lt;K,V&gt;[] table;    //åŠ è½½å› å­ï¼Œç”¨äºè®¡ç®—å“ˆå¸Œè¡¨å…ƒç´ æ•°é‡çš„é˜ˆå€¼ã€‚  threshold = å“ˆå¸Œæ¡¶.length * loadFactor;    final float loadFactor;    //å“ˆå¸Œè¡¨å†…å…ƒç´ æ•°é‡çš„é˜ˆå€¼ï¼Œå½“å“ˆå¸Œè¡¨å†…å…ƒç´ æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¼šå‘ç”Ÿæ‰©å®¹resize()ã€‚    int threshold;    public HashMap() {        //é»˜è®¤æ„é€ å‡½æ•°ï¼Œèµ‹å€¼åŠ è½½å› å­ä¸ºé»˜è®¤çš„0.75f        this.loadFactor = DEFAULT_LOAD_FACTOR; // all other fields defaulted    }    public HashMap(int initialCapacity) {        //æŒ‡å®šåˆå§‹åŒ–å®¹é‡çš„æ„é€ å‡½æ•°        this(initialCapacity, DEFAULT_LOAD_FACTOR);    }    //åŒæ—¶æŒ‡å®šåˆå§‹åŒ–å®¹é‡ ä»¥åŠ åŠ è½½å› å­ï¼Œ ç”¨çš„å¾ˆå°‘ï¼Œä¸€èˆ¬ä¸ä¼šä¿®æ”¹loadFactor    public HashMap(int initialCapacity, float loadFactor) {        //è¾¹ç•Œå¤„ç†        if (initialCapacity &lt; 0)            throw new IllegalArgumentException("Illegal initial capacity: " +                                               initialCapacity);        //åˆå§‹å®¹é‡æœ€å¤§ä¸èƒ½è¶…è¿‡2çš„30æ¬¡æ–¹        if (initialCapacity &gt; MAXIMUM_CAPACITY)            initialCapacity = MAXIMUM_CAPACITY;        //æ˜¾ç„¶åŠ è½½å› å­ä¸èƒ½ä¸ºè´Ÿæ•°        if (loadFactor &lt;= 0 || Float.isNaN(loadFactor))            throw new IllegalArgumentException("Illegal load factor: " +                                               loadFactor);        this.loadFactor = loadFactor;        //è®¾ç½®é˜ˆå€¼ä¸º  ã€‹=åˆå§‹åŒ–å®¹é‡çš„ 2çš„næ¬¡æ–¹çš„å€¼        this.threshold = tableSizeFor(initialCapacity);    }    //æ–°å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ï¼ŒåŒæ—¶å°†å¦ä¸€ä¸ªmap m é‡Œçš„æ‰€æœ‰å…ƒç´ åŠ å…¥è¡¨ä¸­    public HashMap(Map&lt;? extends K, ? extends V&gt; m) {        this.loadFactor = DEFAULT_LOAD_FACTOR;        putMapEntries(m, false);    }</code></pre><pre><code>    //æ ¹æ®æœŸæœ›å®¹é‡capï¼Œè¿”å›2çš„næ¬¡æ–¹å½¢å¼çš„ å“ˆå¸Œæ¡¶çš„å®é™…å®¹é‡ lengthã€‚ è¿”å›å€¼ä¸€èˆ¬ä¼š&gt;=cap     static final int tableSizeFor(int cap) {    //ç»è¿‡ä¸‹é¢çš„ æˆ– å’Œä½ç§» è¿ç®—ï¼Œ næœ€ç»ˆå„ä½éƒ½æ˜¯1ã€‚        int n = cap - 1;        n |= n &gt;&gt;&gt; 1;        n |= n &gt;&gt;&gt; 2;        n |= n &gt;&gt;&gt; 4;        n |= n &gt;&gt;&gt; 8;        n |= n &gt;&gt;&gt; 16;        //åˆ¤æ–­næ˜¯å¦è¶Šç•Œï¼Œè¿”å› 2çš„næ¬¡æ–¹ä½œä¸º tableï¼ˆå“ˆå¸Œæ¡¶ï¼‰çš„é˜ˆå€¼        return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;    }</code></pre><pre><code>    //å°†å¦ä¸€ä¸ªMapçš„æ‰€æœ‰å…ƒç´ åŠ å…¥è¡¨ä¸­ï¼Œå‚æ•°evictåˆå§‹åŒ–æ—¶ä¸ºfalseï¼Œå…¶ä»–æƒ…å†µä¸ºtrue    final void putMapEntries(Map&lt;? extends K, ? extends V&gt; m, boolean evict) {        //æ‹¿åˆ°mçš„å…ƒç´ æ•°é‡        int s = m.size();        //å¦‚æœæ•°é‡å¤§äº0        if (s &gt; 0) {            //å¦‚æœå½“å‰è¡¨æ˜¯ç©ºçš„            if (table == null) { // pre-size                //æ ¹æ®mçš„å…ƒç´ æ•°é‡å’Œå½“å‰è¡¨çš„åŠ è½½å› å­ï¼Œè®¡ç®—å‡ºé˜ˆå€¼                float ft = ((float)s / loadFactor) + 1.0F;                //ä¿®æ­£é˜ˆå€¼çš„è¾¹ç•Œ ä¸èƒ½è¶…è¿‡MAXIMUM_CAPACITY                int t = ((ft &lt; (float)MAXIMUM_CAPACITY) ?                         (int)ft : MAXIMUM_CAPACITY);                //å¦‚æœæ–°çš„é˜ˆå€¼å¤§äºå½“å‰é˜ˆå€¼                if (t &gt; threshold)                    //è¿”å›ä¸€ä¸ª ã€‹=æ–°çš„é˜ˆå€¼çš„ æ»¡è¶³2çš„næ¬¡æ–¹çš„é˜ˆå€¼                    threshold = tableSizeFor(t);            }            //å¦‚æœå½“å‰å…ƒç´ è¡¨ä¸æ˜¯ç©ºçš„ï¼Œä½†æ˜¯ mçš„å…ƒç´ æ•°é‡å¤§äºé˜ˆå€¼ï¼Œè¯´æ˜ä¸€å®šè¦æ‰©å®¹ã€‚            else if (s &gt; threshold)                resize();            //éå† m ä¾æ¬¡å°†å…ƒç´ åŠ å…¥å½“å‰è¡¨ä¸­ã€‚            for (Map.Entry&lt;? extends K, ? extends V&gt; e : m.entrySet()) {                K key = e.getKey();                V value = e.getValue();                putVal(hash(key), key, value, false, evict);            }        }    }</code></pre><div class=pgc-img><img alt=é¢è¯•å¿…å¤‡ï¼šHashMapæºç è§£æ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/071243af-fdce-413e-bf2e-c572a9263352><p class=pgc-img-caption></p></div><pre><code>    //å°†å¦ä¸€ä¸ªMapçš„æ‰€æœ‰å…ƒç´ åŠ å…¥è¡¨ä¸­ï¼Œå‚æ•°evictåˆå§‹åŒ–æ—¶ä¸ºfalseï¼Œå…¶ä»–æƒ…å†µä¸ºtrue    final void putMapEntries(Map&lt;? extends K, ? extends V&gt; m, boolean evict) {        //æ‹¿åˆ°mçš„å…ƒç´ æ•°é‡        int s = m.size();        //å¦‚æœæ•°é‡å¤§äº0        if (s &gt; 0) {            //å¦‚æœå½“å‰è¡¨æ˜¯ç©ºçš„            if (table == null) { // pre-size                //æ ¹æ®mçš„å…ƒç´ æ•°é‡å’Œå½“å‰è¡¨çš„åŠ è½½å› å­ï¼Œè®¡ç®—å‡ºé˜ˆå€¼                float ft = ((float)s / loadFactor) + 1.0F;                //ä¿®æ­£é˜ˆå€¼çš„è¾¹ç•Œ ä¸èƒ½è¶…è¿‡MAXIMUM_CAPACITY                int t = ((ft &lt; (float)MAXIMUM_CAPACITY) ?                         (int)ft : MAXIMUM_CAPACITY);                //å¦‚æœæ–°çš„é˜ˆå€¼å¤§äºå½“å‰é˜ˆå€¼                if (t &gt; threshold)                    //è¿”å›ä¸€ä¸ª ã€‹=æ–°çš„é˜ˆå€¼çš„ æ»¡è¶³2çš„næ¬¡æ–¹çš„é˜ˆå€¼                    threshold = tableSizeFor(t);            }            //å¦‚æœå½“å‰å…ƒç´ è¡¨ä¸æ˜¯ç©ºçš„ï¼Œä½†æ˜¯ mçš„å…ƒç´ æ•°é‡å¤§äºé˜ˆå€¼ï¼Œè¯´æ˜ä¸€å®šè¦æ‰©å®¹ã€‚            else if (s &gt; threshold)                resize();            //éå† m ä¾æ¬¡å°†å…ƒç´ åŠ å…¥å½“å‰è¡¨ä¸­ã€‚            for (Map.Entry&lt;? extends K, ? extends V&gt; e : m.entrySet()) {                K key = e.getKey();                V value = e.getValue();                putVal(hash(key), key, value, false, evict);            }        }    }</code></pre><p>å…ˆçœ‹ä¸€ä¸‹æ‰©å®¹å‡½æ•°ï¼š è¿™æ˜¯ä¸€ä¸ªé‡ç‚¹ï¼é‡ç‚¹ï¼é‡ç‚¹ï¼<br><strong>åˆå§‹åŒ–æˆ–åŠ å€å“ˆå¸Œæ¡¶å¤§å°ã€‚å¦‚æœæ˜¯å½“å‰å“ˆå¸Œæ¡¶æ˜¯null,åˆ†é…ç¬¦åˆå½“å‰é˜ˆå€¼çš„åˆå§‹å®¹é‡ç›®æ ‡ã€‚<br>å¦åˆ™ï¼Œå› ä¸ºæˆ‘ä»¬æ‰©å®¹æˆä»¥å‰çš„ä¸¤å€ã€‚<br>åœ¨æ‰©å®¹æ—¶ï¼Œè¦æ³¨æ„åŒºåˆ†ä»¥å‰åœ¨å“ˆå¸Œæ¡¶ç›¸åŒindexçš„èŠ‚ç‚¹ï¼Œç°åœ¨æ˜¯åœ¨ä»¥å‰çš„indexé‡Œï¼Œè¿˜æ˜¯index+oldlength é‡Œ</strong></p><pre><code>final Node&lt;K,V&gt;[] resize() {        //oldTab ä¸ºå½“å‰è¡¨çš„å“ˆå¸Œæ¡¶        Node&lt;K,V&gt;[] oldTab = table;        //å½“å‰å“ˆå¸Œæ¡¶çš„å®¹é‡ length        int oldCap = (oldTab == null) ? 0 : oldTab.length;        //å½“å‰çš„é˜ˆå€¼        int oldThr = threshold;        //åˆå§‹åŒ–æ–°çš„å®¹é‡å’Œé˜ˆå€¼ä¸º0        int newCap, newThr = 0;        //å¦‚æœå½“å‰å®¹é‡å¤§äº0        if (oldCap &gt; 0) {            //å¦‚æœå½“å‰å®¹é‡å·²ç»åˆ°è¾¾ä¸Šé™            if (oldCap &gt;= MAXIMUM_CAPACITY) {                //åˆ™è®¾ç½®é˜ˆå€¼æ˜¯2çš„31æ¬¡æ–¹-1                threshold = Integer.MAX_VALUE;                //åŒæ—¶è¿”å›å½“å‰çš„å“ˆå¸Œæ¡¶ï¼Œä¸å†æ‰©å®¹                return oldTab;            }//å¦åˆ™æ–°çš„å®¹é‡ä¸ºæ—§çš„å®¹é‡çš„ä¸¤å€ã€‚             else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp;                     oldCap &gt;= DEFAULT_INITIAL_CAPACITY)//å¦‚æœæ—§çš„å®¹é‡å¤§äºç­‰äºé»˜è®¤åˆå§‹å®¹é‡16                //é‚£ä¹ˆæ–°çš„é˜ˆå€¼ä¹Ÿç­‰äºæ—§çš„é˜ˆå€¼çš„ä¸¤å€                newThr = oldThr &lt;&lt; 1; // double threshold        }//å¦‚æœå½“å‰è¡¨æ˜¯ç©ºçš„ï¼Œä½†æ˜¯æœ‰é˜ˆå€¼ã€‚ä»£è¡¨æ˜¯åˆå§‹åŒ–æ—¶æŒ‡å®šäº†å®¹é‡ã€é˜ˆå€¼çš„æƒ…å†µ        else if (oldThr &gt; 0) // initial capacity was placed in threshold            newCap = oldThr;//é‚£ä¹ˆæ–°è¡¨çš„å®¹é‡å°±ç­‰äºæ—§çš„é˜ˆå€¼        else {}//å¦‚æœå½“å‰è¡¨æ˜¯ç©ºçš„ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰é˜ˆå€¼ã€‚ä»£è¡¨æ˜¯åˆå§‹åŒ–æ—¶æ²¡æœ‰ä»»ä½•å®¹é‡/é˜ˆå€¼å‚æ•°çš„æƒ…å†µ               // zero initial threshold signifies using defaults            newCap = DEFAULT_INITIAL_CAPACITY;//æ­¤æ—¶æ–°è¡¨çš„å®¹é‡ä¸ºé»˜è®¤çš„å®¹é‡ 16            newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);//æ–°çš„é˜ˆå€¼ä¸ºé»˜è®¤å®¹é‡16 * é»˜è®¤åŠ è½½å› å­0.75f = 12        }        if (newThr == 0) {//å¦‚æœæ–°çš„é˜ˆå€¼æ˜¯0ï¼Œå¯¹åº”çš„æ˜¯  å½“å‰è¡¨æ˜¯ç©ºçš„ï¼Œä½†æ˜¯æœ‰é˜ˆå€¼çš„æƒ…å†µ            float ft = (float)newCap * loadFactor;//æ ¹æ®æ–°è¡¨å®¹é‡ å’Œ åŠ è½½å› å­ æ±‚å‡ºæ–°çš„é˜ˆå€¼            //è¿›è¡Œè¶Šç•Œä¿®å¤            newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ?                      (int)ft : Integer.MAX_VALUE);        }        //æ›´æ–°é˜ˆå€¼         threshold = newThr;        @SuppressWarnings({"rawtypes","unchecked"})        //æ ¹æ®æ–°çš„å®¹é‡ æ„å»ºæ–°çš„å“ˆå¸Œæ¡¶            Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap];        //æ›´æ–°å“ˆå¸Œæ¡¶å¼•ç”¨        table = newTab;        //å¦‚æœä»¥å‰çš„å“ˆå¸Œæ¡¶ä¸­æœ‰å…ƒç´         //ä¸‹é¢å¼€å§‹å°†å½“å‰å“ˆå¸Œæ¡¶ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹è½¬ç§»åˆ°æ–°çš„å“ˆå¸Œæ¡¶ä¸­        if (oldTab != null) {            //éå†è€çš„å“ˆå¸Œæ¡¶            for (int j = 0; j &lt; oldCap; ++j) {                //å–å‡ºå½“å‰çš„èŠ‚ç‚¹ e                Node&lt;K,V&gt; e;                //å¦‚æœå½“å‰æ¡¶ä¸­æœ‰å…ƒç´ ,åˆ™å°†é“¾è¡¨èµ‹å€¼ç»™e                if ((e = oldTab[j]) != null) {                    //å°†åŸå“ˆå¸Œæ¡¶ç½®ç©ºä»¥ä¾¿GC                    oldTab[j] = null;                    //å¦‚æœå½“å‰é“¾è¡¨ä¸­å°±ä¸€ä¸ªå…ƒç´ ï¼Œï¼ˆæ²¡æœ‰å‘ç”Ÿå“ˆå¸Œç¢°æ’ï¼‰                    if (e.next == null)                        //ç›´æ¥å°†è¿™ä¸ªå…ƒç´ æ”¾ç½®åœ¨æ–°çš„å“ˆå¸Œæ¡¶é‡Œã€‚                        //æ³¨æ„è¿™é‡Œå–ä¸‹æ ‡ æ˜¯ç”¨ å“ˆå¸Œå€¼ ä¸ æ¡¶çš„é•¿åº¦-1 ã€‚ ç”±äºæ¡¶çš„é•¿åº¦æ˜¯2çš„næ¬¡æ–¹ï¼Œè¿™ä¹ˆåšå…¶å®æ˜¯ç­‰äº ä¸€ä¸ªæ¨¡è¿ç®—ã€‚ä½†æ˜¯æ•ˆç‡æ›´é«˜                        newTab[e.hash &amp; (newCap - 1)] = e;                        //å¦‚æœå‘ç”Ÿè¿‡å“ˆå¸Œç¢°æ’ ,è€Œä¸”æ˜¯èŠ‚ç‚¹æ•°è¶…è¿‡8ä¸ªï¼Œè½¬åŒ–æˆäº†çº¢é»‘æ ‘ï¼ˆæš‚ä¸”ä¸è°ˆ é¿å…è¿‡äºå¤æ‚ï¼Œ åç»­ä¸“é—¨ç ”ç©¶ä¸€ä¸‹çº¢é»‘æ ‘ï¼‰                    else if (e instanceof TreeNode)                        ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap);                    //å¦‚æœå‘ç”Ÿè¿‡å“ˆå¸Œç¢°æ’ï¼ŒèŠ‚ç‚¹æ•°å°äº8ä¸ªã€‚åˆ™è¦æ ¹æ®é“¾è¡¨ä¸Šæ¯ä¸ªèŠ‚ç‚¹çš„å“ˆå¸Œå€¼ï¼Œä¾æ¬¡æ”¾å…¥æ–°å“ˆå¸Œæ¡¶å¯¹åº”ä¸‹æ ‡ä½ç½®ã€‚                    else { // preserve order                        //å› ä¸ºæ‰©å®¹æ˜¯å®¹é‡ç¿»å€ï¼Œæ‰€ä»¥åŸé“¾è¡¨ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œç°åœ¨å¯èƒ½å­˜æ”¾åœ¨åŸæ¥çš„ä¸‹æ ‡ï¼Œå³lowä½ï¼Œ æˆ–è€…æ‰©å®¹åçš„ä¸‹æ ‡ï¼Œå³highä½ã€‚ highä½=  lowä½+åŸå“ˆå¸Œæ¡¶å®¹é‡                        //ä½ä½é“¾è¡¨çš„å¤´ç»“ç‚¹ã€å°¾èŠ‚ç‚¹                        Node&lt;K,V&gt; loHead = null, loTail = null;                        //é«˜ä½é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€å°¾èŠ‚ç‚¹                        Node&lt;K,V&gt; hiHead = null, hiTail = null;                        Node&lt;K,V&gt; next;//ä¸´æ—¶èŠ‚ç‚¹ å­˜æ”¾eçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹                        do {                            next = e.next;                            //è¿™é‡Œåˆæ˜¯ä¸€ä¸ªåˆ©ç”¨ä½è¿ç®— ä»£æ›¿å¸¸è§„è¿ç®—çš„é«˜æ•ˆç‚¹ï¼š åˆ©ç”¨å“ˆå¸Œå€¼ ä¸ æ—§çš„å®¹é‡ï¼Œå¯ä»¥å¾—åˆ°å“ˆå¸Œå€¼å»æ¨¡åï¼Œæ˜¯å¤§äºç­‰äºoldCapè¿˜æ˜¯å°äºoldCapï¼Œç­‰äº0ä»£è¡¨å°äºoldCapï¼Œåº”è¯¥å­˜æ”¾åœ¨ä½ä½ï¼Œå¦åˆ™å­˜æ”¾åœ¨é«˜ä½                            if ((e.hash &amp; oldCap) == 0) {                                //ç»™å¤´å°¾èŠ‚ç‚¹æŒ‡é’ˆèµ‹å€¼                                if (loTail == null)                                    loHead = e;                                else                                    loTail.next = e;                                loTail = e;                            }//é«˜ä½ä¹Ÿæ˜¯ç›¸åŒçš„é€»è¾‘                            else {                                if (hiTail == null)                                    hiHead = e;                                else                                    hiTail.next = e;                                hiTail = e;                            }//å¾ªç¯ç›´åˆ°é“¾è¡¨ç»“æŸ                        } while ((e = next) != null);                        //å°†ä½ä½é“¾è¡¨å­˜æ”¾åœ¨åŸindexå¤„ï¼Œ                        if (loTail != null) {                            loTail.next = null;                            newTab[j] = loHead;                        }                        //å°†é«˜ä½é“¾è¡¨å­˜æ”¾åœ¨æ–°indexå¤„                        if (hiTail != null) {                            hiTail.next = null;                            newTab[j + oldCap] = hiHead;                        }                    }                }            }        }        return newTab;    }</code></pre><p>å†çœ‹ä¸€ä¸‹ å¾€å“ˆå¸Œè¡¨é‡Œæ’å…¥ä¸€ä¸ªèŠ‚ç‚¹çš„putValå‡½æ•°,å¦‚æœå‚æ•°onlyIfAbsentæ˜¯trueï¼Œé‚£ä¹ˆä¸ä¼šè¦†ç›–ç›¸åŒkeyçš„å€¼valueã€‚å¦‚æœevictæ˜¯falseã€‚é‚£ä¹ˆè¡¨ç¤ºæ˜¯åœ¨åˆå§‹åŒ–æ—¶è°ƒç”¨çš„</p><pre><code>    final V putVal(int hash, K key, V value, boolean onlyIfAbsent,                   boolean evict) {        //tabå­˜æ”¾ å½“å‰çš„å“ˆå¸Œæ¡¶ï¼Œ pç”¨ä½œä¸´æ—¶é“¾è¡¨èŠ‚ç‚¹          Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i;        //å¦‚æœå½“å‰å“ˆå¸Œè¡¨æ˜¯ç©ºçš„ï¼Œä»£è¡¨æ˜¯åˆå§‹åŒ–        if ((tab = table) == null || (n = tab.length) == 0)            //é‚£ä¹ˆç›´æ¥å»æ‰©å®¹å“ˆå¸Œè¡¨ï¼Œå¹¶ä¸”å°†æ‰©å®¹åçš„å“ˆå¸Œæ¡¶é•¿åº¦èµ‹å€¼ç»™n            n = (tab = resize()).length;        //å¦‚æœå½“å‰indexçš„èŠ‚ç‚¹æ˜¯ç©ºçš„ï¼Œè¡¨ç¤ºæ²¡æœ‰å‘ç”Ÿå“ˆå¸Œç¢°æ’ã€‚ ç›´æ¥æ„å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹Nodeï¼ŒæŒ‚è½½åœ¨indexå¤„å³å¯ã€‚        //è¿™é‡Œå†å•°å—¦ä¸€ä¸‹ï¼Œindex æ˜¯åˆ©ç”¨ å“ˆå¸Œå€¼ &amp; å“ˆå¸Œæ¡¶çš„é•¿åº¦-1ï¼Œæ›¿ä»£æ¨¡è¿ç®—        if ((p = tab[i = (n - 1) &amp; hash]) == null)            tab[i] = newNode(hash, key, value, null);        else {//å¦åˆ™ å‘ç”Ÿäº†å“ˆå¸Œå†²çªã€‚            //e            Node&lt;K,V&gt; e; K k;            //å¦‚æœå“ˆå¸Œå€¼ç›¸ç­‰ï¼Œkeyä¹Ÿç›¸ç­‰ï¼Œåˆ™æ˜¯è¦†ç›–valueæ“ä½œ            if (p.hash == hash &amp;&amp;                ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))                e = p;//å°†å½“å‰èŠ‚ç‚¹å¼•ç”¨èµ‹å€¼ç»™e            else if (p instanceof TreeNode)//çº¢é»‘æ ‘æš‚ä¸”ä¸è°ˆ                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value);            else {//ä¸æ˜¯è¦†ç›–æ“ä½œï¼Œåˆ™æ’å…¥ä¸€ä¸ªæ™®é€šé“¾è¡¨èŠ‚ç‚¹                //éå†é“¾è¡¨                for (int binCount = 0; ; ++binCount) {                    if ((e = p.next) == null) {//éå†åˆ°å°¾éƒ¨ï¼Œè¿½åŠ æ–°èŠ‚ç‚¹åˆ°å°¾éƒ¨                        p.next = newNode(hash, key, value, null);                        //å¦‚æœè¿½åŠ èŠ‚ç‚¹åï¼Œé“¾è¡¨æ•°é‡ã€‹=8ï¼Œåˆ™è½¬åŒ–ä¸ºçº¢é»‘æ ‘                        if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st                            treeifyBin(tab, hash);                        break;                    }                    //å¦‚æœæ‰¾åˆ°äº†è¦è¦†ç›–çš„èŠ‚ç‚¹                    if (e.hash == hash &amp;&amp;                        ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))                        break;                    p = e;                }            }            //å¦‚æœeä¸æ˜¯nullï¼Œè¯´æ˜æœ‰éœ€è¦è¦†ç›–çš„èŠ‚ç‚¹ï¼Œ            if (e != null) { // existing mapping for key                //åˆ™è¦†ç›–èŠ‚ç‚¹å€¼ï¼Œå¹¶è¿”å›åŸoldValue                V oldValue = e.value;                if (!onlyIfAbsent || oldValue == null)                    e.value = value;                //è¿™æ˜¯ä¸€ä¸ªç©ºå®ç°çš„å‡½æ•°ï¼Œç”¨ä½œLinkedHashMapé‡å†™ä½¿ç”¨ã€‚                afterNodeAccess(e);                return oldValue;            }        }        //å¦‚æœæ‰§è¡Œåˆ°äº†è¿™é‡Œï¼Œè¯´æ˜æ’å…¥äº†ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¼šä¿®æ”¹modCountï¼Œä»¥åŠè¿”å›nullã€‚        //ä¿®æ”¹modCount        ++modCount;        //æ›´æ–°sizeï¼Œå¹¶åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚        if (++size &gt; threshold)            resize();        //è¿™æ˜¯ä¸€ä¸ªç©ºå®ç°çš„å‡½æ•°ï¼Œç”¨ä½œLinkedHashMapé‡å†™ä½¿ç”¨ã€‚        afterNodeInsertion(evict);        return null;    }</code></pre><p>newNodeå¦‚ä¸‹ï¼šæ„å»ºä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹</p><pre><code>    // Create a regular (non-tree) node    Node&lt;K,V&gt; newNode(int hash, K key, V value, Node&lt;K,V&gt; next) {        return new Node&lt;&gt;(hash, key, value, next);    }</code></pre><pre><code>    // Callbacks to allow LinkedHashMap post-actions    void afterNodeAccess(Node&lt;K,V&gt; p) { }    void afterNodeInsertion(boolean evict) { }</code></pre><p>å°ç»“ï¼š</p><ul><li>è¿ç®—å°½é‡éƒ½ç”¨<strong>ä½è¿ç®—</strong>ä»£æ›¿<strong>ï¼Œæ›´é«˜æ•ˆ</strong>ã€‚</li><li>å¯¹äº<strong>æ‰©å®¹</strong>å¯¼è‡´éœ€è¦æ–°å»ºæ•°ç»„å­˜æ”¾æ›´å¤šå…ƒç´ æ—¶ï¼Œé™¤äº†è¦å°†è€æ•°ç»„ä¸­çš„å…ƒç´ è¿ç§»è¿‡æ¥ï¼Œä¹Ÿè®°å¾—å°†<strong>è€æ•°ç»„ä¸­çš„å¼•ç”¨ç½®null</strong>ï¼Œä»¥ä¾¿<strong>GC</strong></li><li>å–ä¸‹æ ‡ æ˜¯ç”¨ <strong>å“ˆå¸Œå€¼ ä¸è¿ç®— ï¼ˆæ¡¶çš„é•¿åº¦-1ï¼‰</strong> i = (n - 1) & hashã€‚ ç”±äºæ¡¶çš„é•¿åº¦æ˜¯2çš„næ¬¡æ–¹ï¼Œè¿™ä¹ˆåšå…¶å®æ˜¯ç­‰äº ä¸€ä¸ª<strong>æ¨¡è¿ç®—</strong>ã€‚ä½†æ˜¯<strong>æ•ˆç‡æ›´é«˜</strong></li><li>æ‰©å®¹æ—¶ï¼Œå¦‚æœå‘ç”Ÿè¿‡å“ˆå¸Œç¢°æ’ï¼ŒèŠ‚ç‚¹æ•°å°äº8ä¸ªã€‚åˆ™è¦æ ¹æ®é“¾è¡¨ä¸Šæ¯ä¸ªèŠ‚ç‚¹çš„å“ˆå¸Œå€¼ï¼Œä¾æ¬¡æ”¾å…¥æ–°å“ˆå¸Œæ¡¶å¯¹åº”ä¸‹æ ‡ä½ç½®ã€‚</li><li>å› ä¸ºæ‰©å®¹æ˜¯å®¹é‡ç¿»å€ï¼Œæ‰€ä»¥åŸé“¾è¡¨ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œç°åœ¨å¯èƒ½å­˜æ”¾åœ¨åŸæ¥çš„ä¸‹æ ‡ï¼Œå³lowä½ï¼Œ æˆ–è€…æ‰©å®¹åçš„ä¸‹æ ‡ï¼Œå³highä½ã€‚ highä½= lowä½+åŸå“ˆå¸Œæ¡¶å®¹é‡</li><li>åˆ©ç”¨<strong>å“ˆå¸Œå€¼ ä¸è¿ç®— æ—§çš„å®¹é‡</strong> ï¼Œif ((e.hash & oldCap) == 0),å¯ä»¥å¾—åˆ°å“ˆå¸Œå€¼å»æ¨¡åï¼Œæ˜¯å¤§äºç­‰äºoldCapè¿˜æ˜¯å°äºoldCapï¼Œç­‰äº0ä»£è¡¨å°äºoldCapï¼Œ<strong>åº”è¯¥å­˜æ”¾åœ¨ä½ä½ï¼Œå¦åˆ™å­˜æ”¾åœ¨é«˜ä½</strong>ã€‚è¿™é‡Œåˆæ˜¯ä¸€ä¸ªåˆ©ç”¨ä½è¿ç®— ä»£æ›¿å¸¸è§„è¿ç®—çš„é«˜æ•ˆç‚¹</li><li>å¦‚æœè¿½åŠ èŠ‚ç‚¹åï¼Œé“¾è¡¨æ•°é‡ã€‹=8ï¼Œåˆ™è½¬åŒ–ä¸ºçº¢é»‘æ ‘</li><li>æ’å…¥èŠ‚ç‚¹æ“ä½œæ—¶ï¼Œæœ‰ä¸€äº›ç©ºå®ç°çš„å‡½æ•°ï¼Œç”¨ä½œLinkedHashMapé‡å†™ä½¿ç”¨ã€‚</li></ul><div class=pgc-img><img alt=é¢è¯•å¿…å¤‡ï¼šHashMapæºç è§£æ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/e4da6289-875b-4f33-92d6-c5449e91eadb><p class=pgc-img-caption></p></div><h2 class=pgc-h-arrow-right>5 å¢ã€æ”¹</h2><h3 class=pgc-h-arrow-right>1å¾€è¡¨ä¸­æ’å…¥æˆ–è¦†ç›–ä¸€ä¸ªkey-value</h3><pre><code>    public V put(K key, V value) {        //å…ˆæ ¹æ®keyï¼Œå–å¾—hashå€¼ã€‚ å†è°ƒç”¨ä¸Šä¸€èŠ‚çš„æ–¹æ³•æ’å…¥èŠ‚ç‚¹        return putVal(hash(key), key, value, false, true);    }</code></pre><p>è¿™ä¸ªæ ¹æ®keyå–hashå€¼çš„å‡½æ•°ä¹Ÿè¦å…³æ³¨ä¸€ä¸‹ï¼Œå®ƒç§°ä¹‹ä¸ºâ€œæ‰°åŠ¨å‡½æ•°â€ï¼Œå…³äºè¿™ä¸ªå‡½æ•°çš„ç”¨å¤„ å¼€å¤´å·²ç»æ€»ç»“è¿‡äº†ï¼š</p><pre><code>    static final int hash(Object key) {        int h;        return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);    }</code></pre><p>è€Œkeyçš„hashå€¼ï¼Œå¹¶ä¸ä»…ä»…åªæ˜¯keyå¯¹è±¡çš„hashCode()æ–¹æ³•çš„è¿”å›å€¼ï¼Œè¿˜ä¼šç»è¿‡<strong>æ‰°åŠ¨å‡½æ•°</strong>çš„æ‰°åŠ¨ï¼Œä»¥ä½¿hashå€¼æ›´åŠ å‡è¡¡ã€‚<br>å› ä¸ºhashCode()æ˜¯intç±»å‹ï¼Œå–å€¼èŒƒå›´æ˜¯40å¤šäº¿ï¼Œåªè¦å“ˆå¸Œå‡½æ•°æ˜ å°„çš„æ¯”è¾ƒå‡åŒ€æ¾æ•£ï¼Œç¢°æ’æœºç‡æ˜¯å¾ˆå°çš„ã€‚<br>ä½†å°±ç®—åŸæœ¬çš„hashCode()å–å¾—å¾ˆå¥½ï¼Œæ¯ä¸ªkeyçš„hashCode()ä¸åŒï¼Œä½†æ˜¯ç”±äºHashMapçš„å“ˆå¸Œæ¡¶çš„é•¿åº¦è¿œæ¯”hashå–å€¼èŒƒå›´å°ï¼Œé»˜è®¤æ˜¯16ï¼Œæ‰€ä»¥å½“å¯¹hashå€¼ä»¥æ¡¶çš„é•¿åº¦å–ä½™ï¼Œä»¥æ‰¾åˆ°å­˜æ”¾è¯¥keyçš„æ¡¶çš„ä¸‹æ ‡æ—¶ï¼Œç”±äºå–ä½™æ˜¯é€šè¿‡ä¸æ“ä½œå®Œæˆçš„ï¼Œä¼šå¿½ç•¥hashå€¼çš„é«˜ä½ã€‚å› æ­¤åªæœ‰hashCode()çš„ä½ä½å‚åŠ è¿ç®—ï¼Œå‘ç”Ÿä¸åŒçš„hashå€¼ï¼Œä½†æ˜¯å¾—åˆ°çš„indexç›¸åŒçš„æƒ…å†µçš„æœºç‡ä¼šå¤§å¤§å¢åŠ ï¼Œè¿™ç§æƒ…å†µç§°ä¹‹ä¸º<strong>hashç¢°æ’ã€‚</strong> å³ï¼Œç¢°æ’ç‡ä¼šå¢å¤§ã€‚</p><p><strong>æ‰°åŠ¨å‡½æ•°</strong>å°±æ˜¯ä¸ºäº†è§£å†³hashç¢°æ’çš„ã€‚å®ƒä¼šç»¼åˆhashå€¼é«˜ä½å’Œä½ä½çš„ç‰¹å¾ï¼Œå¹¶å­˜æ”¾åœ¨ä½ä½ï¼Œå› æ­¤åœ¨ä¸è¿ç®—æ—¶ï¼Œç›¸å½“äºé«˜ä½ä½ä¸€èµ·å‚ä¸äº†è¿ç®—ï¼Œä»¥å‡å°‘hashç¢°æ’çš„æ¦‚ç‡ã€‚ï¼ˆåœ¨JDK8ä¹‹å‰ï¼Œæ‰°åŠ¨å‡½æ•°ä¼šæ‰°åŠ¨å››æ¬¡ï¼ŒJDK8ç®€åŒ–äº†è¿™ä¸ªæ“ä½œï¼‰</p><h3 class=pgc-h-arrow-right>2å¾€è¡¨ä¸­æ‰¹é‡å¢åŠ æ•°æ®</h3><pre><code>    public void putAll(Map&lt;? extends K, ? extends V&gt; m) {        //è¿™ä¸ªå‡½æ•°ä¸Šä¸€èŠ‚ä¹Ÿå·²ç»åˆ†æè¿‡ã€‚//å°†å¦ä¸€ä¸ªMapçš„æ‰€æœ‰å…ƒç´ åŠ å…¥è¡¨ä¸­ï¼Œå‚æ•°evictåˆå§‹åŒ–æ—¶ä¸ºfalseï¼Œå…¶ä»–æƒ…å†µä¸ºtrue        putMapEntries(m, true);    }</code></pre><h3 class=pgc-h-arrow-right>3 åªä¼šå¾€è¡¨ä¸­æ’å…¥ key-value, è‹¥keyå¯¹åº”çš„valueä¹‹å‰å­˜åœ¨ï¼Œä¸ä¼šè¦†ç›–ã€‚ï¼ˆjdk8å¢åŠ çš„æ–¹æ³•ï¼‰</h3><pre><code>    @Override    public V putIfAbsent(K key, V value) {        return putVal(hash(key), key, value, true, true);    }</code></pre><h2 class=pgc-h-arrow-right>6 åˆ </h2><h3 class=pgc-h-arrow-right>ä»¥keyä¸ºæ¡ä»¶åˆ é™¤</h3><p>å¦‚æœkeyå¯¹åº”çš„valueå­˜åœ¨ï¼Œåˆ™åˆ é™¤è¿™ä¸ªé”®å€¼å¯¹ã€‚ å¹¶è¿”å›valueã€‚å¦‚æœä¸å­˜åœ¨ è¿”å›nullã€‚</p><pre><code>    public V remove(Object key) {        Node&lt;K,V&gt; e;        return (e = removeNode(hash(key), key, null, false, true)) == null ?            null : e.value;    }</code></pre><p>//ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤æŸä¸ªèŠ‚ç‚¹ï¼Œ å¦‚æœå‚æ•°matchValueæ˜¯trueï¼Œåˆ™å¿…é¡»key ã€valueéƒ½ç›¸ç­‰æ‰åˆ é™¤ã€‚<br>//å¦‚æœmovableå‚æ•°æ˜¯falseï¼Œåœ¨åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œä¸ç§»åŠ¨å…¶ä»–èŠ‚ç‚¹</p><pre><code>    final Node&lt;K,V&gt; removeNode(int hash, Object key, Object value,                               boolean matchValue, boolean movable) {        // p æ˜¯å¾…åˆ é™¤èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, index;        //å¦‚æœå“ˆå¸Œè¡¨ä¸ä¸ºç©ºï¼Œåˆ™æ ¹æ®hashå€¼ç®—å‡ºçš„indexä¸‹ æœ‰èŠ‚ç‚¹çš„è¯ã€‚        if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;            (p = tab[index = (n - 1) &amp; hash]) != null) {            //nodeæ˜¯å¾…åˆ é™¤èŠ‚ç‚¹            Node&lt;K,V&gt; node = null, e; K k; V v;            //å¦‚æœé“¾è¡¨å¤´çš„å°±æ˜¯éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹            if (p.hash == hash &amp;&amp;                ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))                node = p;//å°†å¾…åˆ é™¤èŠ‚ç‚¹å¼•ç”¨èµ‹ç»™node            else if ((e = p.next) != null) {//å¦åˆ™å¾ªç¯éå† æ‰¾åˆ°å¾…åˆ é™¤èŠ‚ç‚¹ï¼Œèµ‹å€¼ç»™node                if (p instanceof TreeNode)                    node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);                else {                    do {                        if (e.hash == hash &amp;&amp;                            ((k = e.key) == key ||                             (key != null &amp;&amp; key.equals(k)))) {                            node = e;                            break;                        }                        p = e;                    } while ((e = e.next) != null);                }            }            //å¦‚æœæœ‰å¾…åˆ é™¤èŠ‚ç‚¹nodeï¼Œ  ä¸” matchValueä¸ºfalseï¼Œæˆ–è€…å€¼ä¹Ÿç›¸ç­‰            if (node != null &amp;&amp; (!matchValue || (v = node.value) == value ||                                 (value != null &amp;&amp; value.equals(v)))) {                if (node instanceof TreeNode)                    ((TreeNode&lt;K,V&gt;)node).removeTreeNode(this, tab, movable);                else if (node == p)//å¦‚æœnode ==  pï¼Œè¯´æ˜æ˜¯é“¾è¡¨å¤´æ˜¯å¾…åˆ é™¤èŠ‚ç‚¹                    tab[index] = node.next;                else//å¦åˆ™å¾…åˆ é™¤èŠ‚ç‚¹åœ¨è¡¨ä¸­é—´                    p.next = node.next;                ++modCount;//ä¿®æ”¹modCount                --size;//ä¿®æ”¹size                afterNodeRemoval(node);//LinkedHashMapå›è°ƒå‡½æ•°                return node;            }        }        return null;    }</code></pre><pre><code>    void afterNodeRemoval(Node&lt;K,V&gt; p) { }å¤åˆ¶ä»£ç </code></pre><h3 class=pgc-h-arrow-right>ä»¥key value ä¸ºæ¡ä»¶åˆ é™¤</h3><pre><code>    @Override    public boolean remove(Object key, Object value) {        //è¿™é‡Œä¼ å…¥äº†value åŒæ—¶matchValueä¸ºtrue        return removeNode(hash(key), key, value, true, true) != null;    }</code></pre><h2 class=pgc-h-arrow-right>7 æŸ¥</h2><h3 class=pgc-h-arrow-right>ä»¥keyä¸ºæ¡ä»¶ï¼Œæ‰¾åˆ°è¿”å›valueã€‚æ²¡æ‰¾åˆ°è¿”å›null</h3><pre><code>    public V get(Object key) {        Node&lt;K,V&gt; e;        //ä¼ å…¥æ‰°åŠ¨åçš„å“ˆå¸Œå€¼ å’Œ key æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹Node        return (e = getNode(hash(key), key)) == null ? null : e.value;    }</code></pre><pre><code>    //ä¼ å…¥æ‰°åŠ¨åçš„å“ˆå¸Œå€¼ å’Œ key æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹Node    final Node&lt;K,V&gt; getNode(int hash, Object key) {        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k;        //æŸ¥æ‰¾è¿‡ç¨‹å’Œåˆ é™¤åŸºæœ¬å·®ä¸å¤šï¼Œ æ‰¾åˆ°è¿”å›èŠ‚ç‚¹ï¼Œå¦åˆ™è¿”å›null        if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;            (first = tab[(n - 1) &amp; hash]) != null) {            if (first.hash == hash &amp;&amp; // always check first node                ((k = first.key) == key || (key != null &amp;&amp; key.equals(k))))                return first;            if ((e = first.next) != null) {                if (first instanceof TreeNode)                    return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);                do {                    if (e.hash == hash &amp;&amp;                        ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))                        return e;                } while ((e = e.next) != null);            }        }        return null;    }</code></pre><h3 class=pgc-h-arrow-right>åˆ¤æ–­æ˜¯å¦åŒ…å«è¯¥key</h3><pre><code>    public boolean containsKey(Object key) {        return getNode(hash(key), key) != null;    }</code></pre><h3 class=pgc-h-arrow-right>åˆ¤æ–­æ˜¯å¦åŒ…å«value</h3><pre><code>    public boolean containsValue(Object value) {        Node&lt;K,V&gt;[] tab; V v;        //éå†å“ˆå¸Œæ¡¶ä¸Šçš„æ¯ä¸€ä¸ªé“¾è¡¨        if ((tab = table) != null &amp;&amp; size &gt; 0) {            for (int i = 0; i &lt; tab.length; ++i) {                for (Node&lt;K,V&gt; e = tab[i]; e != null; e = e.next) {                    //å¦‚æœæ‰¾åˆ°valueä¸€è‡´çš„è¿”å›true                    if ((v = e.value) == value ||                        (value != null &amp;&amp; value.equals(v)))                        return true;                }            }        }        return false;    }</code></pre><h3 class=pgc-h-arrow-right>java8æ–°å¢ï¼Œå¸¦é»˜è®¤å€¼çš„getæ–¹æ³•</h3><p>ä»¥keyä¸ºæ¡ä»¶ï¼Œæ‰¾åˆ°äº†è¿”å›valueã€‚å¦åˆ™è¿”å›defaultValue</p><pre><code>    @Override    public V getOrDefault(Object key, V defaultValue) {        Node&lt;K,V&gt; e;        return (e = getNode(hash(key), key)) == null ? defaultValue : e.value;    }</code></pre><h3 class=pgc-h-arrow-right>éå†</h3><pre><code>    //ç¼“å­˜ entrySet    transient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;     */    public Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() {        Set&lt;Map.Entry&lt;K,V&gt;&gt; es;        return (es = entrySet) == null ? (entrySet = new EntrySet()) : es;    }</code></pre><pre><code>    final class EntrySet extends AbstractSet&lt;Map.Entry&lt;K,V&gt;&gt; {        public final int size()                 { return size; }        public final void clear()               { HashMap.this.clear(); }        //ä¸€èˆ¬æˆ‘ä»¬ç”¨åˆ°EntrySetï¼Œéƒ½æ˜¯ä¸ºäº†è·å–iterator        public final Iterator&lt;Map.Entry&lt;K,V&gt;&gt; iterator() {            return new EntryIterator();        }        //æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨getNodeæ–¹æ³•        public final boolean contains(Object o) {            if (!(o instanceof Map.Entry))                return false;            Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;) o;            Object key = e.getKey();            Node&lt;K,V&gt; candidate = getNode(hash(key), key);            return candidate != null &amp;&amp; candidate.equals(e);        }        //æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨removeNodeæ–¹æ³•        public final boolean remove(Object o) {            if (o instanceof Map.Entry) {                Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;) o;                Object key = e.getKey();                Object value = e.getValue();                return removeNode(hash(key), key, value, true, true) != null;            }            return false;        }        //ã€‚ã€‚ã€‚    }</code></pre><p>//EntryIteratorçš„å®ç°ï¼š</p><pre><code>    final class EntryIterator extends HashIterator        implements Iterator&lt;Map.Entry&lt;K,V&gt;&gt; {        public final Map.Entry&lt;K,V&gt; next() { return nextNode(); }    }</code></pre><pre><code>    abstract class HashIterator {        Node&lt;K,V&gt; next;        // next entry to return        Node&lt;K,V&gt; current;     // current entry        int expectedModCount;  // for fast-fail        int index;             // current slot        HashIterator() {            //å› ä¸ºhashmapä¹Ÿæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥è¦ä¿å­˜modCountã€‚ç”¨äºfail-fastç­–ç•¥            expectedModCount = modCount;            Node&lt;K,V&gt;[] t = table;            current = next = null;            index = 0;            //next åˆå§‹æ—¶ï¼ŒæŒ‡å‘ å“ˆå¸Œæ¡¶ä¸Šç¬¬ä¸€ä¸ªä¸ä¸ºnullçš„é“¾è¡¨å¤´            if (t != null &amp;&amp; size &gt; 0) { // advance to first entry                do {} while (index &lt; t.length &amp;&amp; (next = t[index++]) == null);            }        }        public final boolean hasNext() {            return next != null;        }        //ç”±è¿™ä¸ªæ–¹æ³•å¯ä»¥çœ‹å‡ºï¼Œéå†HashMapæ—¶ï¼Œé¡ºåºæ˜¯æŒ‰ç…§å“ˆå¸Œæ¡¶ä»ä½åˆ°é«˜ï¼Œé“¾è¡¨ä»å‰å¾€åï¼Œä¾æ¬¡éå†çš„ã€‚å±äºæ— åºé›†åˆã€‚        final Node&lt;K,V&gt; nextNode() {            Node&lt;K,V&gt;[] t;            Node&lt;K,V&gt; e = next;            //fail-fastç­–ç•¥            if (modCount != expectedModCount)                throw new ConcurrentModificationException();            if (e == null)                throw new NoSuchElementException();            //ä¾æ¬¡å–é“¾è¡¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ            if ((next = (current = e).next) == null &amp;&amp; (t = table) != null) {                //å¦‚æœå½“å‰é“¾è¡¨èŠ‚ç‚¹éå†å®Œäº†ï¼Œåˆ™å–å“ˆå¸Œæ¡¶ä¸‹ä¸€ä¸ªä¸ä¸ºnullçš„é“¾è¡¨å¤´                do {} while (index &lt; t.length &amp;&amp; (next = t[index++]) == null);            }            return e;        }        public final void remove() {            Node&lt;K,V&gt; p = current;            if (p == null)                throw new IllegalStateException();            ////fail-fastç­–ç•¥            if (modCount != expectedModCount)                throw new ConcurrentModificationException();            current = null;            K key = p.key;            //æœ€ç»ˆè¿˜æ˜¯åˆ©ç”¨removeNode åˆ é™¤èŠ‚ç‚¹            removeNode(hash(key), key, null, false, false);            expectedModCount = modCount;        }    }</code></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'é¢è¯•','å¿…å¤‡','HashMap'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>