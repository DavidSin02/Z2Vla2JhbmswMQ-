<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Python接口测试实践，一份值得收藏的用例封装及测试报告生成指南 | 极客快訊</title><meta property="og:title" content="Python接口测试实践，一份值得收藏的用例封装及测试报告生成指南 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/195b22509d1b4a7b85d96fa32b962292"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c79afc07.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c79afc07.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c79afc07.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c79afc07.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c79afc07.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c79afc07.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c79afc07.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c79afc07.html><meta property="article:published_time" content="2020-11-14T21:01:26+08:00"><meta property="article:modified_time" content="2020-11-14T21:01:26+08:00"><meta name=Keywords content><meta name=description content="Python接口测试实践，一份值得收藏的用例封装及测试报告生成指南"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/c79afc07.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Python接口测试实践，一份值得收藏的用例封装及测试报告生成指南</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><strong>一、首先，我们想，什么是 API 测试？</strong></p><p>API 测试其实是一种用程序或工具来发送数据，同时验收系统的返回值的方法。这种测试更偏向于业务实现逻辑。常见的网络协议有 TCP、Http、webservice、socket 等，http?和 webservice 都是基于 TCP/IP 协议的应用层协议，webservice 是基于 http 的 soap 协议传输数据。</p><div class=pgc-img><img alt=Python接口测试实践，一份值得收藏的用例封装及测试报告生成指南 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/195b22509d1b4a7b85d96fa32b962292><p class=pgc-img-caption></p></div><p><strong>二、接口自动化测试的基本流程有（如图）：</strong></p><p>1、在测试工具中登记待测交易的接口报文格式；</p><p>2、编写测试案例，向案例中添加交易接口并进行配置关联；</p><p>3、准备测试数据并对测试数据进行参数化；</p><p>4、测试工具自动执行自动化测试案例；</p><p>5、测试工具比对预期结果和返回结果，验证案例是否执行成功。</p><div class=pgc-img><img alt=Python接口测试实践，一份值得收藏的用例封装及测试报告生成指南 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/df4745d36674448d875a72577f96d914><p class=pgc-img-caption></p></div><p><strong>三、接口测试发现的典型问题</strong></p><p>接口测试经常遇到的bug和问题，如下：</p><p>（1）传入参数处理不当，导致程序crash；</p><p>（2）类型溢出，导致数据读出和写入不一致；</p><p>（3）因对象权限未进行校验，可以访问其他用户敏感信息；</p><p>（4）状态处理不当，导致逻辑出现错乱；</p><p>（5）逻辑校验不完善，可利用漏洞获取非正当利益等。</p><p><strong>四、举例天气API接口实战</strong></p><p>我们今天就主要以天气API接口为例，使用python语言实现用例编写、封装及报告生成功能。</p><p><strong>API信息：</strong></p><p>天气API：http://www.51testing.com/html/88/n-4465288.html</p><p>URL:http://t.weather.sojson.com/api/weather/city/101030100</p><p>请求方式：get</p><p>参数：city 城市名称</p><p><strong>①代码实现查询北京的天气信息</strong></p><p>步骤：</p><p>1、新建 weather_api_test.py文件</p><p>代码实现</p><p>#-*-coding:GBK -*-</p><p>import requests</p><p>from pip._vendor.requests.models import Response</p><p>url='http://t.weather.sojson.com/api/weather/city/101030100'</p><p>r=requests.get(url)</p><p>response_data=r.json()</p><p>print(r.text)</p><p>返回结果：</p><div class=pgc-img><img alt=Python接口测试实践，一份值得收藏的用例封装及测试报告生成指南 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3af20fe1711e458684549610863466ad><p class=pgc-img-caption></p></div><p><strong>②用例集成到Unittest</strong></p><p>1、针对不同的参数场景进行测试</p><p>2、设置断言判断执行结果是否符合预期</p><p>实现原理：</p><p>首先导入requests 库、unitest 、时间库</p><p>其次，创建天气class类</p><p>然后，分别创建4个函数，分别实现存放路径、正常传参、异常传参、缺省参数功能</p><p>3、用例设计</p><div class=pgc-img><img alt=Python接口测试实践，一份值得收藏的用例封装及测试报告生成指南 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a34e2d6081464e02b71eae475373127f><p class=pgc-img-caption></p></div><p>代码实现：</p><p>新建 weather_api_unitest.py文件</p><p>#-*-coding:GBK -*-</p><p>import unittest</p><p>import requests</p><p>from time import sleep</p><p>class weathertest(unittest.TestCase):</p><p>def setUp(self):</p><p>self.url='http://t.weather.sojson.com/api/weather/city/101030100'</p><p>self.url_error='http://t.weather.sojson.com/api/weather/city/101030101'</p><p>self.url_no='http://t.weather.sojson.com/api/weather/city'</p><p>#参数正常</p><p>def test_weather_tianjing(self):</p><p>r=requests.get(self.url)</p><p>result=r.json()</p><p>self.assertEqual(result['status'],200)</p><p>self.assertEqual(result['message'],'success感谢又拍云(upyun.com)提供CDN赞助')</p><p>sleep(3)</p><p>#参数异常</p><p>def test_weather_param_error(self):</p><p>r=requests.get(self.url_error)</p><p>result=r.json()</p><p>self.assertEqual(result['status'],400)</p><p>self.assertEqual(result['message'],'获取失败')</p><p>sleep(3)</p><p>#参数缺省</p><p>def test_weather_no_param(self):</p><p>r=requests.get(self.url_no)</p><p>result=r.json()</p><p>self.assertEqual(result['status'],404)</p><p>self.assertEqual(result['message'],'Request resource not found.')</p><p>sleep(3)</p><p>if __name__=='_main_':</p><p>unittest.main()</p><p><strong>③测试报告生成</strong></p><p>1、创建文件夹如图，把测试用例放到test_case目录下</p><div class=pgc-img><img alt=Python接口测试实践，一份值得收藏的用例封装及测试报告生成指南 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6fd0877778fc4c198cd325463163e844><p class=pgc-img-caption></p></div><p>2、下载BSTestRunner模块并放置到python Lib文件夹下</p><p>如路径 C:\Python34\Lib</p><p>3、创建run.py 文件</p><p>代码：</p><p>import unittest</p><p>from BSTestRunner import BSTestRunner</p><p>import time</p><p>#指定测试用例和报告路径</p><p>test_dir='./test_case'</p><p>report_dir='./reports'</p><p>#加载测试用例</p><p>discover=unittest.defaultTestLoader.discover(test_dir, pattern='weather_api_unittest.py')</p><p>#定义报告格式</p><p>now=time.strftime('%Y-%m-%d %H_%M_%S')</p><p>report_name=report_dir+'/'+now+'test_report.html'</p><p>#运行用例并生成测试报告</p><p>with open(report_name,'wb') as f:</p><p>runner=BSTestRunner(stream=f,title="weather api test report",description="china city weather test report")</p><p>runner.run(discover)</p><p>4、运行run.py，在reports文件夹下查看生成的报告</p><div class=pgc-img><img alt=Python接口测试实践，一份值得收藏的用例封装及测试报告生成指南 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/b853837191c4415bb8f073df87b1af4e><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=Python接口测试实践，一份值得收藏的用例封装及测试报告生成指南 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/925efafc116f48eab183eb0286a5ec91><p class=pgc-img-caption></p></div><p><strong>五、总结</strong></p><p>最后我们再来总结一下接口测试的常用知识点和你需要掌握的。</p><p>1、requests发送get请求和post请求的方法</p><p>get(url, params=None, **kwargs)</p><p>post(url, data=None, json=None, **kwargs)</p><p>2、parmas参数和data参数的区别</p><p>由于get请求无请求体，post请求有请求体。</p><p>使用params参数时，默认会把参数附加到url后面，所以发送get请求时应使用params参数。</p><p>使用data参数时，参数会存放到请求体中，所以发送post请求时不能使用params，应使用data，除非接口及支持get又支持post，同样get请求也不能使用data参数。</p><p>3、如何使用Seesion解决接口保持状态的问题</p><p>初始化Session实例，通过这个实例调用request()方法发送请求。</p><p>4、最重要的一个封装方法，并掌握这个封装该如何使用</p><p>主要针对get和post请求的接口。</p><p>总之，API 测试上手很简单，但做得好，做成工程化还真需要费一点力气，一些技术细节的把控和提升，会无形中提升整体的测试水准；而如何让 API 测试真正在我们的日常工作中发挥出最大作用，也需慢慢研究和调整的。</p><p><strong>请关注+私信回复：“测试”就可以免费拿到软件测试学习资料。</strong></p><div class=pgc-img><img alt=Python接口测试实践，一份值得收藏的用例封装及测试报告生成指南 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/6a8aceadda87417cb7fc23b33e78c89f><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'测试','Python','实践'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>