<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>详解java中一个面试常问的知识点-阻塞队列 | 极客快訊</title><meta property="og:title" content="详解java中一个面试常问的知识点-阻塞队列 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/5fd66a8866494ee3afb7c743acddf760"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c88fe435.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c88fe435.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c88fe435.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c88fe435.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c88fe435.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c88fe435.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c88fe435.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c88fe435.html><meta property="article:published_time" content="2020-11-14T21:05:53+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:53+08:00"><meta name=Keywords content><meta name=description content="详解java中一个面试常问的知识点-阻塞队列"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/c88fe435.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>详解java中一个面试常问的知识点-阻塞队列</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>学习数据结构的时候介绍过队列，今天介绍一种队列的其中一种，叫做阻塞队列。这个知识点属于多线程中的一个模块，对于我们理解消息中间件有份非常大的用处，希望对你有帮助。</p><p><strong>一、什么是阻塞队列</strong></p><p><strong>1、概念理解</strong></p><p>队列比较好理解，数据结构中我们都接触过，先进先出的一种数据结构，那什么是阻塞队列呢？从名字可以看出阻塞队列其实也就是队列的一种特殊情况。举个例子来说明一下吧，我们去餐馆吃饭，一个接一个的下单，这时候就是一个普通的队列，万一这家店生意好，餐馆挤满了人，这时候肯定不能把顾客赶出去，于是餐馆就在旁边设置了一个休息等待区。这就是一个阻塞队列了。我们使用一张图来演示一下：</p><p><br></p><div class=pgc-img><img alt=详解java中一个面试常问的知识点-阻塞队列 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5fd66a8866494ee3afb7c743acddf760><p class=pgc-img-caption></p></div><p><br></p><p><strong>2、特点</strong></p><p>从上面这张图我们会发现这样的规律：</p><p>（1）当阻塞队列为空时，从队列中获取元素的操作将会被阻塞，就好比餐馆休息区没人了，此时不能接纳新的顾客了。换句话，肚子为空的时候也没东西吃。</p><p>（2）当阻塞队列满了，往队列添加元素的操作将会被阻塞，好比餐馆的休息区也挤满了，后来的顾客只能走了。</p><p>从上面的概念我们类比到线程中去，我们会发现，在某些时候线程可能不能不阻塞，因为CPU内核就那么几个，阻塞现状更加说明了资源的利用率高，换句话来说，阻塞其实是一个好事。</p><p>阻塞队列应用最广泛的是生产者和消费者模式，待会也会给出一个实际案例演示一下。</p><p>还有一点，就是我们看这个阻塞队列有点线程池的感觉，其实基本上可以这样理解，阻塞队列在线程池中确实有着很大的应用。我们可以给出俩例子：</p><p><br></p><div class=pgc-img><img alt=详解java中一个面试常问的知识点-阻塞队列 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/b1045410215b4fa8bd03874412f732aa><p class=pgc-img-caption></p></div><p><br></p><p>前面说了这么久，来个标准点的定义吧：</p><blockquote><p><strong>在多线程中，阻塞的意思是，在某些情况下会挂起线程，一旦条件成熟，被阻塞的线程就会被自动唤醒。</strong></p></blockquote><p>也就是说，之前线程的wait和notify我们程序员需要自己控制，但有了这个阻塞队列之后我们程序员就不用担心了，阻塞队列会自动管理。</p><p>欧了，我们对概念先认识到这，我们从代码中看看，毕竟面试中X疼的就是代码。</p><p><strong>二、常见的BlockQueue方法</strong></p><p>BlockQueue接口继承自collection接口。他的主要实现方法比较多。我们分类来看一下：</p><p><br></p><div class=pgc-img><img alt=详解java中一个面试常问的知识点-阻塞队列 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9024bb507a07434c82725a9725af94cf><p class=pgc-img-caption></p></div><p><br></p><p>方法就这些，这些方法一个一个看和演示的话我觉得有点傻，参照网络上别人的一些博客也对其进行了分类：</p><p>根据插入和取出两种类型的操作，具体分为下面几些类型：</p><p><br></p><div class=pgc-img><img alt=详解java中一个面试常问的知识点-阻塞队列 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7b1893d3eaa2458d9bdc8893b16d9ada><p class=pgc-img-caption></p></div><p><br></p><ul class=ul-list><li>抛出异常：这时候插入和取出在不能立即被执行的时候就会抛出异常。</li><li>特殊值：插入和取出在不能被立即执行的情况下会返回一个特殊的值（true 或者 false）</li><li>阻塞：插入和取出操作在不能被立即执行时会阻塞线程，直到条件成熟，被其他线程唤醒</li><li>超时：插入和取出操作在不能立即执行的时候会被阻塞一定的时候，如果在指定的时间内没有被执行，那么会返回一个特殊值。</li></ul><p>单单从操作的维度来看的话，还是会有点错，因为有些方法是阻塞方法，有些方法不是，我们从阻塞和不阻塞的维度再来一次划分：</p><p><br></p><div class=pgc-img><img alt=详解java中一个面试常问的知识点-阻塞队列 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/473bc397ef2947519c762cfb245cdee8><p class=pgc-img-caption></p></div><p><br></p><p>现在我们再来看，相信会比较清楚一点，不过需要注意一些特殊的情况，比如offer和poll，以是否包含超时时间来区分是否阻塞。</p><p><strong>三、常见的阻塞队列</strong></p><p>实现了BlockQueue接口的队列有很多，常见的没有几种，我们使用表格的形式给列出来，对比着分析一下：</p><p><br></p><div class=pgc-img><img alt=详解java中一个面试常问的知识点-阻塞队列 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b1a637de9c064d2ba16c4955222262d4><p class=pgc-img-caption></p></div><p><br></p><p>常见的几种已经加粗了。</p><p>ArrayBlockingQueue和LinkedBlockingQueue是最为常用的阻塞队列，前者使用一个有边界的数组来作为存储介质，而后者使用了一个没有边界的链表来存储数据。</p><p>PriorityBlockingQueue是一个优先阻塞队列。所谓优先队列，就是每次从队队列里面获取到的都是队列中优先级最高的，对于优先级，PriorityBlockingQueue需要你为插入其中的元素类型提供一个Comparator，PriorityBlockingQueue使用这个Comparator来确定元素之间的优先级关系。底层的数据结构是堆，也就是我们数据结构中的那个堆。</p><p>DelayQueue是一个延时队列，所谓延时队列就是消费线程将会延时一段时间来消费元素。</p><p>SynchronousQueue是最为复杂的阻塞队列。SynchronousQueue和前面分析的阻塞队列都不同，因为SynchronousQueue不存在容量的说法，任何插入操作都需要等待其他线程来消费，否则就会阻塞等待，看到这种队列心里面估计就立马能联想到生产者消费者的这种模式了，没错，就可以使用这个队列来实现。</p><p>现在，我们已经把阻塞队列的一些基本知识点介绍了，完全带细节的介绍费时又费力，下面我们针对某个阻塞队列来看一下原理，其实就是看看源码是如何实现的。</p><p><strong>四、原理</strong></p><p>我们以ArrayBlockingQueue为例，以下源码均来自jdk1.8。还是以变量、构造函数、普通函数的顺序来看：</p><p><strong>1、变量</strong></p><p><br></p><div class=pgc-img><img alt=详解java中一个面试常问的知识点-阻塞队列 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/81c9beaf92924733b0aac49e07712179><p class=pgc-img-caption></p></div><p><br></p><p>变量的作用基本上就是这样，我们再来接着看构造函数</p><p><strong>2、构造函数</strong></p><p><br></p><div class=pgc-img><img alt=详解java中一个面试常问的知识点-阻塞队列 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b59d836005804025b55f5f82469e16af><p class=pgc-img-caption></p></div><p><br></p><p>上面的这些其实都是为了给其他操作做铺垫。</p><p><strong>3、put函数</strong></p><p><br></p><div class=pgc-img><img alt=详解java中一个面试常问的知识点-阻塞队列 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/efa039b838f849589cf6db47a400c41f><p class=pgc-img-caption></p></div><p><br></p><p>首先检查是否为空，从这个方法中我们可以看到，首先检查队列是否为空，然后获取锁，判断当前元素个数是否等于数组的长度，如果相等，则调用notFull.await()进行等待，如果捕获到中断异常，则唤醒线程并抛出异常。当被其他线程唤醒时，通过enqueue(e)方法插入元素，最后解锁。</p><p>我们按照这个源码来看，真正实现插入操作的是enqueue，我们跟进去看看：</p><p><br></p><div class=pgc-img><img alt=详解java中一个面试常问的知识点-阻塞队列 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9fbd4fdecca0400f88d57cf6962bc5aa><p class=pgc-img-caption></p></div><p><br></p><p>就几行代码，就是一个正常的移动数组插入的过程，不过最后还要再通知一下队列，插入了元素，此时的队列就不为空了。</p><p><strong>4、take元素</strong></p><p>还是看源码</p><p><br></p><div class=pgc-img><img alt=详解java中一个面试常问的知识点-阻塞队列 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7e3b124abe924e6f90543fa2d7baad10><p class=pgc-img-caption></p></div><p><br></p><p>take的这个操作根据put反过来看就可以，真正实现的是dequeue，跟进去看看：</p><p><br></p><div class=pgc-img><img alt=详解java中一个面试常问的知识点-阻塞队列 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2c4ff18c725946c081751da769f563c5><p class=pgc-img-caption></p></div><p><br></p><p>取出的时候也是一样，数组少一个元素，数量少一，最后通过队列不为空。其他的就不详述了。</p><p>最后我们看看使用。我们举一个生产者消费者的例子，毕竟这个是一个面试考点：</p><p><strong>五、应用</strong></p><p>生产者消费者模式的实现方式超级多，比如volatile、CAS、AtomicInteger等等，这次我们就使用阻塞队列来实现一下：</p><p><br></p><div class=pgc-img><img alt=详解java中一个面试常问的知识点-阻塞队列 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4168119c0c32402fbc6e0d8703b5d2f3><p class=pgc-img-caption></p></div><p><br></p><p>验证就比较简单，我们新建几个生产线程和几个消费线程即可。在这里就不贴代码了。</p><p>OK，阻塞队列基本的一些知识就是这些，如有问题还请批评指正。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'详解','java','中一个'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>