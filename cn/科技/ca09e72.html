<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>é˜²ç«å¢™æ—è·¯éƒ¨ç½²å‚è€ƒé…ç½® | æå®¢å¿«è¨Š</title><meta property="og:title" content="é˜²ç«å¢™æ—è·¯éƒ¨ç½²å‚è€ƒé…ç½® - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/d5795d92dd0c440888c24bc670d6b289"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ca09e72.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ca09e72.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ca09e72.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ca09e72.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ca09e72.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ca09e72.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ca09e72.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ca09e72.html><meta property="article:published_time" content="2020-10-29T21:08:24+08:00"><meta property="article:modified_time" content="2020-10-29T21:08:24+08:00"><meta name=Keywords content><meta name=description content="é˜²ç«å¢™æ—è·¯éƒ¨ç½²å‚è€ƒé…ç½®"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/ca09e72.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>é˜²ç«å¢™æ—è·¯éƒ¨ç½²å‚è€ƒé…ç½®</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>é˜²ç«å¢™æ—è·¯éƒ¨ç½²æ‹“æ‰‘ï¼š</p><p><br></p><div class=pgc-img><img alt=é˜²ç«å¢™æ—è·¯éƒ¨ç½²å‚è€ƒé…ç½® onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d5795d92dd0c440888c24bc670d6b289><p class=pgc-img-caption></p></div><p>æ‹“æ‰‘æè¿°ï¼š</p><p>é˜²ç«å¢™ä½¿ç”¨ä¸‡å…†å£xgbe21æ¥åšä¸šåŠ¡å£ï¼Œæ—è·¯éƒ¨ç½²åˆ°æ ¸å¿ƒè·¯ç”±å™¨ï¼Œä¸¤ç«¯å»ºç«‹EBGPæˆ–è€…IBGPçš„é‚»å±…å…³ç³»ã€‚é˜²ç«å¢™é€šè¿‡å®£å‘Š32ä½ä¸»æœºè·¯ç”±ï¼ŒæŠŠæœ¬åœ°æœåŠ¡å™¨çš„æµé‡å¼•å…¥åˆ°é˜²ç«å¢™ä¸­ã€‚é˜²ç«å¢™å¯¹ä¸šåŠ¡æµæ¸…æ´—è¿‡åï¼Œç»§ç»­ä½¿ç”¨xgbe21å›æ³¨ç»™æ ¸å¿ƒè·¯ç”±å™¨ã€‚ä¸ºé˜²æ­¢å‘ç”Ÿè·¯ç”±ç¯è·¯ï¼Œéœ€è¦é…ç½®å›æ³¨ç­–ç•¥ï¼Œåº”ç”¨åœ¨æ ¸å¿ƒè·¯ç”±å™¨çš„XG0/0/1æ¥å£çš„å…¥æ–¹å‘ä¸‹ï¼Œå°†å›æ³¨æµé‡è½¬å‘è‡³æ±‡èš/ç½‘å…³è·¯ç”±å™¨ã€‚</p><p>æ ¸å¿ƒè·¯ç”±å™¨ä¸é˜²ç«å¢™å»ºç«‹BGPçš„äº’è”åœ°å€ä¸º172.16.10.0/30ï¼Œé˜²ç«å¢™åœ°å€ä¸º172.16.10.2ï¼Œæ ¸å¿ƒè·¯ç”±å™¨åœ°å€ä¸º172.16.10.1.æ ¸å¿ƒè·¯ç”±å™¨å’Œé˜²ç«å¢™ASå·æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚å¯ä»¥ä¸ä¸€è‡´æˆ–è€…ä¿æŒä¸€è‡´ä»¥ä¸‹é…ç½®å‡å®šç»Ÿä¸€ä½¿ç”¨ASå·ä¸º65530.</p><p>æ ¸å¿ƒè·¯ç”±å™¨é…ç½®ï¼š</p><p>1ã€é…ç½®ä¸KFW-12000äº’è”ç«¯å£çš„åœ°å€ï¼ŒåŠBGPåè®®ã€‚</p><p>åä¸ºè·¯ç”±å™¨é…ç½®å‚è€ƒï¼š</p><p>æç¤ºç¬¦å‘½ä»¤ä¸æè¿°</p><p>&lt;quidway>system//è¿›å…¥ç³»ç»Ÿè§†å›¾</p><p>[quidway]vlan 100</p><p>[quidway-vlan100]interface vlan 100</p><p>[quidway-Vlanif100]ip address 172.16.10.1 255.255.255.252</p><p>[quidway-Vlanif100]quit</p><p>[quidway]interface XG0/0/1 //è¿›å…¥æ¥å£è§†å›¾</p><p>[quidway- XG0/0/1]port link-type access</p><p>[quidway- XG0/0/1]port default vlan 100</p><p>[quidway- XG0/0/1]quit</p><p>[quidway]bgp 65530</p><p>[quidway-bgp]peer 172.16.10.2 as-number 65530</p><p>[quidway-bgp]ipv4-family unicast</p><p>[quidway-bgp-af-ipv4]peer 172.16.10.2 enable</p><p></p><p>åä¸‰è·¯ç”±å™¨BGPé…ç½®å‚è€ƒ:</p><p>æç¤ºç¬¦å‘½ä»¤ä¸æè¿°</p><p>&lt;H3C>syssystem//è¿›å…¥ç³»ç»Ÿè§†å›¾</p><p>[H3C]vlan 100</p><p>[H3C-vlan100]interface vlan 100</p><p>[H3C-Vlan-interface100]ip address 172.16.10.1 255.255.255.252</p><p>[H3C-Vlan-interface100]quit</p><p>[H3C]interface XG0/0/1 //è¿›å…¥æ¥å£è§†å›¾</p><p>[H3C-XG0/0/1]port link-type access</p><p>[H3C-XG0/0/1]port default vlan 100</p><p>[H3C-XG0/0/1]quit</p><p>[H3C]</p><p>bgp 65530//è¿›å…¥bgpè§†å›¾</p><p>[H3C-bgp]peer 172.16.10.2 as-number 65530</p><p>[H3C-bgp]address-familyipv4 unicast</p><p>[H3C-bgp-default-ipv4]peer 172.16.10.2 enable //æ¿€æ´»BGPé‚»å±…</p><p></p><p>æ€ç§‘BGPé…ç½®æŒ‡å¯¼:</p><p>æç¤ºç¬¦å‘½ä»¤ä¸æè¿°</p><p>&lt;Cisco>en//è¿›å…¥ç³»ç»Ÿè§†å›¾</p><p>Cisco#conf t</p><p>Cisco(config)#vlan 100</p><p>Cisco(config-vlan)#interface vlan 100</p><p>Cisco(config-vlan)#ip address 172.16.10.1 255.255.255.252</p><p>Cisco(config-vlan)#exit</p><p>Cisco(config-if)#interface XG0/0/1 //è¿›å…¥æ¥å£è§†å›¾</p><p>Cisco(config-if)#switchport mode access</p><p>Cisco(config-if)#switchportaccessvlan 100</p><p>Cisco(config-if)#exit</p><p>Cisco(config)#router bgp 65530 //è¿›å…¥BGPè§†å›¾</p><p>Cisco(config-router)#neighbor 172.16.10.2 remote-as 65530</p><p></p><p>2ã€é…ç½®PBRç­–ç•¥ï¼š</p><p>é˜²ç«å¢™åœ¨å¯¹æµé‡è¿›è¡Œè¿‡æ»¤åï¼Œå°†æµé‡å›æ³¨ç»™æ ¸å¿ƒè·¯ç”±å™¨ã€‚åœ¨é‡‡ç”¨æºå£å›æ³¨æ—¶ï¼Œéœ€è¦åœ¨æ ¸å¿ƒè·¯ç”±å™¨è¿æ¥é˜²ç«å¢™æ¥å£çš„å…¥æ–¹å‘åº”ç”¨PBRç­–ç•¥è·¯ç”±ï¼ŒåŒ¹é…åˆ°é˜²ç«å¢™å›æ³¨çš„æµé‡ç›´æ¥è½¬å‘è‡³æ±‡èš/ç½‘å…³è·¯ç”±å™¨ã€‚å¦‚æœä¸æ·»åŠ PBRç­–ç•¥ï¼Œå›æ³¨çš„æµé‡ä¼šå†æ¬¡è¢«ç‰µå¼•åˆ°é˜²ç«å¢™ä¸­ï¼Œå½¢æˆç¯è·¯ã€‚</p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPBRçš„ACLä¸­ä¸å»ºè®®ä½¿ç”¨permit anyé€‰é¡¹æ¥åŒ¹é…æ‰€æœ‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´éªŒè¯æ•°æ®åŒ…æ— æ³•åˆ°è¾¾å®¢æˆ·ç«¯ã€‚</strong></p><p>åä¸ºè·¯ç”±å™¨PBRé…ç½®å‚è€ƒï¼š</p><p>æç¤ºç¬¦å‘½ä»¤ä¸æè¿°</p><p>&lt;Huawei>system-view</p><p>[Huawei]acl number 3000</p><p>[Huawei-acl-adv-3000]rule permit ip destination 172.16.1.0 0.0.0.255</p><p>rule permit ipdestination 172.16.2.0 0.0.0.255</p><p>â€¦...</p><p>//åˆ›å»ºaclï¼ŒåŒ¹é…æ‰€æœ‰ç›®åœ°IPä¸ºæœ¬åœ°æœåŠ¡å™¨çš„æµé‡ï¼Œæ‰€æœ‰æœåŠ¡å™¨åœ°å€æ®µéƒ½éœ€è¦é…ç½®ï¼Œå¦‚æœ‰é—æ¼åœ¨å¯¹é—æ¼çš„åœ°å€è¿›è¡Œæ¸…æ´—æ—¶ä¼šå‘ç”Ÿç¯è·¯ã€‚</p><p>[Huawei-acl-adv-3000]quit</p><p>[Huawei]traffic classifier Huizhu //åˆ›å»ºæµåˆ†ç±»</p><p>[Huawei-classifier-Huizhu]if-match acl 3000</p><p>[Huawei-classifier-Huizhu]quit</p><p>&lt;Huawei>traffic behavior Huizhu //åˆ›å»ºæµè¡Œä¸º</p><p>[Huawei-behavior-Huizhu]redirect ip-nexthop x.x.x.x//è®¾ç½®ä¸‹ä¸€è·³</p><p>[Huawei-classifier-Huizhu]quit</p><p>&lt;Huawei>traffic policyHuizhu //åˆ›å»ºç­–ç•¥</p><p>[Huawei-trafficpolicy-Huizhu]classifier Huizhu behavior Huizhu</p><p>[Huawei-classifier-Huizhu]quit</p><p>[Huawei]interface XGigabitEthernet 0/0/0 //åœ¨æ¥å£å…¥æ–¹å‘ä¸‹åº”ç”¨ç­–ç•¥</p><p>[Huawei-GigabitEthernet0/0/0]traffic-policy Huizhu inbound</p><p></p><p>åä¸‰è·¯ç”±å™¨PBRç­–ç•¥è·¯ç”±å‚è€ƒï¼š</p><p>æç¤ºç¬¦å‘½ä»¤ä¸æè¿°</p><p>&lt;H3C>system</p><p>[H3C]acl number 3000</p><p>[H3C-acl-ipv4-adv-3000]rule 5 permit ip destination 172.16.1.0 0.0.0.255</p><p>rule 10 permit ip destination 172.16.2.0 0.0.0.255</p><p>â€¦â€¦</p><p>//åˆ›å»ºaclï¼ŒåŒ¹é…æ‰€æœ‰ç›®åœ°IPä¸ºæœ¬åœ°æœåŠ¡å™¨çš„æµé‡ï¼Œæ‰€æœ‰æœåŠ¡å™¨åœ°</p><p>å€æ®µéƒ½éœ€è¦é…ç½®ï¼Œå¦‚æœ‰é—æ¼åœ¨å¯¹é—æ¼çš„åœ°å€è¿›è¡Œæ¸…æ´—æ—¶ä¼šå‘ç”Ÿç¯è·¯ã€‚</p><p>[H3C-acl-ipv4-adv-3000]quit</p><p>[H3C]policy-based-route Huizhu permit node 5 //åˆ›å»ºç­–ç•¥è·¯ç”±Huizhu</p><p>[H3C-pbr-huizhu-5]if-match acl 3000</p><p>[H3C-pbr-huizhu-5]apply ip-address next-hop x.x.x.x //ä¸‹ä¸€è·³ipåœ°å€</p><p>[H3C]interface XGigabitEthernet 1/0/1 //åœ¨æ¥å£ä¸‹åº”ç”¨PBR</p><p>[H3C-GigabitEthernet1/0/1]ip policy-based-route Huizhu</p><p></p><p>æ€ç§‘ç­–ç•¥è·¯ç”±å‚è€ƒå¦‚ä¸‹ï¼š</p><p>æç¤ºç¬¦å‘½ä»¤ä¸æè¿°</p><p>Router>enable</p><p>Router#configure terminal</p><p>Router(config)#</p><p>access-list 100 permit ip 0.0.0.0 0.0.0.0 172.16.1.0 0.0.0.255</p><p>access-list 100 permit ip 0.0.0.0 0.0.0.0 172.16.2.0 0.0.0.255</p><p>â€¦â€¦</p><p>//åˆ›å»ºaclï¼ŒåŒ¹é…æ‰€æœ‰ç›®åœ°IPä¸ºæœ¬åœ°æœåŠ¡å™¨çš„æµé‡ï¼Œæ‰€æœ‰æœåŠ¡å™¨åœ°å€æ®µéƒ½éœ€è¦é…ç½®ï¼Œå¦‚æœ‰é—æ¼åœ¨å¯¹é—æ¼çš„åœ°å€è¿›è¡Œæ¸…æ´—æ—¶ä¼šå‘ç”Ÿç¯è·¯ã€‚</p><p>Router(config)#route-map Huizhu permit 10 //åˆ›å»ºroute-map</p><p>Router(config-route-map)#match ip address 100</p><p>Router(config-route-map)#set ip next-hop x.x.x.x//è®¾ç½®ä¸‹ä¸€è·³</p><p>Router(config)#interface XGigabitEthernet0/0/1 //åœ¨æ¥å£ä¸‹è°ƒç”¨ç­–ç•¥è·¯ç”±</p><p>Router(config-if)#ip policy route-map Huizhu</p><p></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'å‚è€ƒ','æ—è·¯','é˜²ç«'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>