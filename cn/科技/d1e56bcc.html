<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Java正则表达式详细解析 | 极客快訊</title><meta property="og:title" content="Java正则表达式详细解析 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/78591e5cc20e4b2197c16978c08ea890"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d1e56bcc.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d1e56bcc.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d1e56bcc.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d1e56bcc.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d1e56bcc.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d1e56bcc.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d1e56bcc.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d1e56bcc.html><meta property="article:published_time" content="2020-11-14T21:07:13+08:00"><meta property="article:modified_time" content="2020-11-14T21:07:13+08:00"><meta name=Keywords content><meta name=description content="Java正则表达式详细解析"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/d1e56bcc.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Java正则表达式详细解析</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1><strong>元字符</strong></h1><div class=pgc-img><img alt=Java正则表达式详细解析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/78591e5cc20e4b2197c16978c08ea890><p class=pgc-img-caption></p></div><ol><li>正则表达式使用一些<strong>特定的元字符</strong>来检索、匹配和替换符合规则的字符串</li><li>元字符：<strong>普通字符</strong>、<strong>标准字符</strong>、<strong>限定字符</strong>（量词）、<strong>定位字符</strong>（边界字符）</li></ol><h1><strong>正则表达式引擎</strong></h1><ol><li>正则表达式是一个用<strong>正则符号</strong>写出来的公式</li></ol><ul><li class=ql-indent-1>程序对正则表达式进行<strong>语法分析</strong>，建立<strong>语法分析树</strong></li><li>再根据<strong>语法分析树</strong>结合<strong>正则表达式引擎</strong>生成执行程序（<strong>状态机</strong>），用于字符匹配</li><li class=ql-indent-1>正则表达式引擎是一套核心算法，用于<strong>建立状态机</strong></li><li>小结</li><li class=ql-indent-2>正则表达式 => 语法分析树</li><li class=ql-indent-1>语法分析树 + 正则表达引擎 => 状态机 => 用于字符匹配</li></ul><ol><li>目前实现正则表达式引擎的方式有两种</li></ol><ul><li class=ql-indent-1><strong>DFA自动机</strong>（Deterministic Finite Automaton，确定有限状态自动机）</li><li class=ql-indent-1><strong>NFA自动机</strong>（Nondeterministic Finite Automaton，非确定有限状态自动机）</li></ul><ol><li>DFA自动机的<strong>构造代价</strong>远大于NFA自动机，但DFA自动机的<strong>执行效率</strong>高于NFA自动机</li></ol><ul><li class=ql-indent-1>假设一个字符串的长度为n，如果采用DFA自动机作为正则表达式引擎，则匹配的时间复杂度为O(n)</li><li>如果采用NFA自动机作为正则表达式引擎，NFA自动机在<strong>匹配过程</strong>中存在大量的<strong>分支</strong>和<strong>回溯</strong>，假设NFA的状态数为s，</li><li class=ql-indent-1>则匹配的时间复杂度为<strong>O(ns)</strong></li></ul><ol><li>NFA自动机的优势是<strong>支持更多高级功能</strong>，但都是基于<strong><em>子表达式独立进行匹配</em></strong></li></ol><ul><li class=ql-indent-1>因此在<strong>编程语言</strong>里，使用的正则表达式库都是基于<strong>NFA自动机</strong>实现的</li></ul><h1><strong>NFA自动机</strong></h1><p><strong>匹配过程</strong></p><ol><li>NFA自动机会读取正则表达式的每一个字符，拿去和目标字符串匹配</li><li>匹配成功则换正则表达式的下一个字符，反之就继续就和目标字符串的下一个字符进行匹配</li></ol><pre>text="aabcab"regex="bc"</pre><div class=pgc-img><img alt=Java正则表达式详细解析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2c2b31d7d6c04898b47896e6c33d541e><p class=pgc-img-caption></p></div><p><strong>回溯</strong></p><ol><li>用NFA自动机实现的比较复杂的正则表达式，在匹配过程中经常会引起回溯问题</li><li>大量的回溯会<strong>长时间占用CPU</strong>，从而带来系统性能开销</li></ol><pre>text="abbc"regex="ab{1,3}c"</pre><p>读取正则表达式第一个匹配符a和字符串第一个字符a进行比较，a对a，匹配</p><div class=pgc-img><img alt=Java正则表达式详细解析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1bcdc0eb99a54ad2b94910f799fe96ed><p class=pgc-img-caption></p></div><p>读取正则表达式第二个匹配符b{1,3}和字符串的第二个字符b进行比较，匹配，但b{1,3}表示1~3个字符，而NFA自动机具有<strong>贪婪</strong>特性，所以不会读取正则表达式的下一个匹配符c</p><div class=pgc-img><img alt=Java正则表达式详细解析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a878455d97da4e4ea867cd7b9e1951fa><p class=pgc-img-caption></p></div><p>使用b{1,3}和字符串的第四个字符c进行比较，发现不匹配，此时就会发生<strong>回溯</strong>，已经读取的字符串第四个字符c将被吐出去，指针回到第三个字符b的位置</p><div class=pgc-img><img alt=Java正则表达式详细解析 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/d6446397cd6443f3920bebf9300987ff><p class=pgc-img-caption></p></div><p>发生回溯后，读取正则表达式的下一个匹配符c，和字符串的第四个字符c进行比较，结果匹配</p><div class=pgc-img><img alt=Java正则表达式详细解析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8c69a747706d475998c914bc5790b8de><p class=pgc-img-caption></p></div><p><strong>避免回溯</strong></p><p>避免回溯的方法：使用<strong>懒惰</strong>模式和<strong>独占</strong>模式</p><p><strong>贪婪模式（Greedy）</strong></p><ol><li>在数量匹配中，如果单独使用+、？、*、{min,max}等量词，正则表达式会匹配<strong>尽可能多</strong>的内容</li><li>text="abbc" , regex="ab{1,3}c"，发生了一次匹配失败，就会引起一次回溯</li><li>text="abbbc" , regex="ab{1,3}c"，匹配成功</li></ol><p><strong>懒惰模式（Reluctant）</strong></p><ol><li>在懒惰模式下，正则表达式会<strong>尽可能少</strong>地重复匹配字符，如果匹配成功，会继续匹配剩余的字符串</li><li>使用?开启懒惰模式，text="abc" , regex="ab{1,3}?c"</li></ol><ul><li class=ql-indent-1>匹配结果是"abc"，在该模式下NFA自动机首先选择<strong>最小</strong>的匹配范围，即匹配1个b字符，<strong>避免了回溯问题</strong></li></ul><p><strong>独占模式（Possessive）</strong></p><ol><li>和贪婪模式一样，独占模式一样会<strong>最大限度</strong>地匹配更多内容，但在匹配失败时会<strong>结束匹配</strong>，<strong>不会发生回溯问题</strong></li><li>使用+开启懒惰模式，text="abbc" , regex="ab{1,3}+bc"</li></ol><ul><li class=ql-indent-1>结果是不匹配，结束匹配，不会发生回溯问题</li></ul><p><strong>代码</strong></p><pre>match("ab{1,3}c", "abbc"); // abbc，贪婪模式，产生回溯match("ab{1,3}c", "abbbc"); // abbbc，贪婪模式，不产生回溯match("ab{1,3}?", "abbbb"); // ab，懒惰模式，不产生回溯match("ab{1,3}+bc", "abbc"); // null，独占模式，不产生回溯</pre><h1><strong>正则表达式的优化</strong></h1><ol><li>少用贪婪模式，<strong>多用独占模式</strong>（避免回溯）</li><li><strong>减少分支选择</strong>，分支选择类型"(X|Y|Z)"的正则表达式会<strong>降低性能</strong>，尽量减少使用，如果一定要使用</li></ol><ul><li class=ql-indent-1>考虑选择的顺序，将比较常用的选择放在前面，使它们可以较快地被匹配</li><li class=ql-indent-1>提取共用模式，(abcd|abef) => ab(cd|ef)</li><li class=ql-indent-1>如果是简单的分支选择类型，可以用三次index代替(X|Y|Z)</li></ul><ol><li><strong>减少捕获嵌套</strong></li></ol><ul><li>捕获组：把正则表达式中，子表达式匹配的内容保存到以数字编号或显式命名的数组中，一般一个()就是一个捕获组</li><li class=ql-indent-1>每个捕获组都有一个编号，编号0代表整个匹配到的内容</li><li class=ql-indent-1>非捕获组：参与匹配却<strong>不进行分组编号</strong>的捕获组，其表达式一般由(?:exp)组成</li><li class=ql-indent-1>减少不需要获取的分组，可以提高正则表达式的性能</li></ul><h1><strong>捕获组</strong></h1><pre>String text = "&lt;input high=\"20\" weight=\"70\"&gt;test&lt;/input&gt;";String reg = "(&lt;input.*?&gt;)(.*?)(&lt;/input&gt;)";Pattern p = Pattern.compile(reg);Matcher m = p.matcher(text);while (m.find()) { System.out.println(m.group(0));// 整个匹配到的内容 System.out.println(m.group(1));//(&lt;input.*?&gt;) System.out.println(m.group(2));//(.*?) System.out.println(m.group(3));//(&lt;/input&gt;) // 输出： // &lt;input high="20" weight="70"&gt;test&lt;/input&gt; // &lt;input high="20" weight="70"&gt; // test // &lt;/input&gt;}</pre><h1><strong>非捕获组</strong></h1><pre>String text = "&lt;input high=\"20\" weight=\"70\"&gt;test&lt;/input&gt;";String reg = "(?:&lt;input.*?&gt;)(.*?)(?:&lt;/input&gt;)";Pattern p = Pattern.compile(reg);Matcher m = p.matcher(text);while (m.find()) { System.out.println(m.group(0));// 整个匹配到的内容 System.out.println(m.group(1));//(.*?) // 输出 // &lt;input high="20" weight="70"&gt;test&lt;/input&gt; // test}</pre><h1><strong>小结</strong></h1><p>在做好性能测试的前提下，可以使用正则表达式，否则<strong>能不用就不用</strong>，避免造成更多的性能问题.</p><p>文章的话到这里就结束了，希望大家在性能测试中，对正则表达式有自己的认识。今日的性能篇到此结束！</p><p>需要更多源码视频，面试题，Java技术书籍等学习资料的</p><p>可以关注我获取哦！私信我“学习”；即可领取！</p><p>我是小架，我们下篇文章见！</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Java','正则','表达式'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../cn/%E7%A7%91%E6%8A%80/d2dd7ebf.html alt="Java 正则表达式" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/d2dd7ebf.html title="Java 正则表达式">Java 正则表达式</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/22c24c31.html alt="Java 正则表达式 StackOverflowError 问题及其优化" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/28110ae7b0fc46f1a5ad2e6bcf0e40c1 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/22c24c31.html title="Java 正则表达式 StackOverflowError 问题及其优化">Java 正则表达式 StackOverflowError 问题及其优化</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/53f942fa.html alt=Java正则表达式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1531051821759d2705acacc style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/53f942fa.html title=Java正则表达式>Java正则表达式</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/e0c20e1e.html alt=Java正则表达式介绍 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/e0c20e1e.html title=Java正则表达式介绍>Java正则表达式介绍</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/5c2f2cd7.html alt=Java正则表达式模式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6d9eaa59ae704773aef9e0851d9625fd style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/5c2f2cd7.html title=Java正则表达式模式>Java正则表达式模式</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/38a1ca5a.html alt=Java正则表达式组 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/cb895437221f4629a7a4f697a8ac9f7a style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/38a1ca5a.html title=Java正则表达式组>Java正则表达式组</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/3836e27c.html alt=Java正则表达式Pattern和Matcher类详解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1535620668920d4515bfc5b style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/3836e27c.html title=Java正则表达式Pattern和Matcher类详解>Java正则表达式Pattern和Matcher类详解</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/6a6bedf3.html alt=Java正则表达式中的贪婪型、勉强型和占有性 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/a3606c2e85b340e0bfa6b63a26ededff style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/6a6bedf3.html title=Java正则表达式中的贪婪型、勉强型和占有性>Java正则表达式中的贪婪型、勉强型和占有性</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/b27edec9.html alt=Java正则表达式大全详解「收藏起来以后你一定会用的到的」 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1537156478131e5dd12e2a4 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/b27edec9.html title=Java正则表达式大全详解「收藏起来以后你一定会用的到的」>Java正则表达式大全详解「收藏起来以后你一定会用的到的」</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/2405cdf4.html alt=Java正则表达式详解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bd26939e3f8248709b624e7cd38ac594 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/2405cdf4.html title=Java正则表达式详解>Java正则表达式详解</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/9c005517.html alt=Java程序员：一刻钟精通正则表达式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/9c005517.html title=Java程序员：一刻钟精通正则表达式>Java程序员：一刻钟精通正则表达式</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>