<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>测试开发专题：spring-boot统一异常捕获 | 极客快訊</title><meta property="og:title" content="测试开发专题：spring-boot统一异常捕获 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/135918e30e2f4a2ea248b539eb383688"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d260a748.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d260a748.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d260a748.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d260a748.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d260a748.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d260a748.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d260a748.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d260a748.html><meta property="article:published_time" content="2020-11-14T21:06:59+08:00"><meta property="article:modified_time" content="2020-11-14T21:06:59+08:00"><meta name=Keywords content><meta name=description content="测试开发专题：spring-boot统一异常捕获"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/d260a748.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>测试开发专题：spring-boot统一异常捕获</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>java异常介绍</h1><p>异常时相对于return的一种退出机制，可以由系统触发，也可由程序通过throw语句触发，异常可以通过try/catch语句进行捕获并处理，如果没有捕获，则会导致程序退出并输出异常栈信息，异常有不同的类型，所有异常类都有一个共同的父类Throwable，下面我们先从Throwable开始介绍。</p><h2 class=pgc-h-arrow-right>Throwable</h2><p>Throwable是所有异常类的父类，有四个构造方法</p><pre><code>public Throwable(Throwable cause)public Throwable(String message, Throwable cause) public Throwable(String message)public Throwable()</code></pre><p>主要有两个类，一个是message，表示异常的消息，一个是cause，表示触发该异常的其他异常，异常可以形成一个异常链，上层的异常由底层到的异常触发，cause表示底层异常。</p><h2 class=pgc-h-arrow-right>异常体系</h2><p>java定义了非常多的异常类，来表示各种类型的异常，下面的图示是部分的异常类：</p><div class=pgc-img><img alt=测试开发专题：spring-boot统一异常捕获 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/135918e30e2f4a2ea248b539eb383688><p class=pgc-img-caption></p></div><p>Throwable是所有异常类的基类，它有两个子类：Error和Exception。</p><ul><li>Error错误</li></ul><p>操作系统或者虚拟机发生的错误，这个时候程序是跑不起来的，代码是无法处理的，一般表示系统错误或者资源耗尽，由java系统自己处理，比如图示中给出的：虚拟机错误、栈溢出、内存溢出等错误</p><ul><li>Exception</li></ul><p>表示应用程序错误，是可以通过代码处理的，有两大类：一类是受检异常(checked exception)，一类是非受检异常(uncheck exception)，也就是runtime异常，他两的区别就在于java是如何对待他们的，受检异常，java会要求强制进行处理，不然编译时不通过的，对于非受检异常则没有这个强制性的要求。</p><p><strong>解释</strong></p><p>该怎么理解受检异常和非受检异常呢，我的理解就是做某件事的时候我们能够顺利的按照我们预期的做完，但是实际上呢可能会出现各种各样的情况，这种可能出现的情况就把他称之为异常，这种异常有的我们能处理，有的我们不能处理，能处理的就把它称作为受检异常，不能处理的称作为非受检异常。</p><p>比如说，客户端发送一个请求，要查询数据库，那有可能找到有可能没找到，没找到的话，就应该抛出runtime异常，再比如要去读取文件，文件可能是不存在的，那就应该抛出checked exception，这其实就是bug，我们应该去处理的。</p><p>怎么理解呢，比如读取文件，当文件不存在，发生异常，能处理么，当然可以处理啊，怎么处理，把文件路径改成正确的不就行了。从某种意义上来说，checked异常是真正的bug</p><p>没有办法处理的情况，比如说用户输入ID为2，查询记录能找到，但是如果输入2000就找不到了，这里的找不到就是一种异常情况，就需要产生一个运行时异常也就是非受检异常。</p><h1 class=pgc-h-arrow-right>已知异常和未知异常</h1><p>上面我们提到的受检异常 unchecked exception和运行时异常 RuntimeException都是从java语法层面来说的，那从程序开发者的角度来说，分为两类：已知异常和未知异常。</p><p>已知异常和未知异常，其实就在于我们程序员是否主动的去处理异常。</p><ul><li>未知异常：当代码中未对一些情况做出处理而引发的异常，这就是未知异常，一般这种异常都是因为服务端的代码写的有问题的，对于前段开发或者用户，都是无意义的，记录日志供自己查看就行了。</li><li>已知异常：更多的时候表示的是一种消息，用来提示用户的输入是否有问题，只不过这里我们用异常的形式来处理，当然也可以通过其他方式处理，比如当做结果去返回，也是可以的，但是这种方式不如全部都看做异常，通过全局的异常处理器直接处理来的简单。</li></ul><h1 class=pgc-h-arrow-right>Spring-Boot全局异常处理器</h1><p>在使用spring-boot进行开发到的时候，有时我们需要对程序中抛出的异常进行统一的处理，spring-boot预留了相应的扩展点，我们只需要按照要求的方式去自定义自己的实现即可。</p><pre><code>@ControllerAdvicepublic class GlobalExceptionAdvice {    @ExceptionHandler(value = Exception.class)    public void handleHttpException(HttpServletRequest req, Exception ex){    }}</code></pre><p>@ControllerAdvice表明GlobalExceptionAdvice是一个异常的处理类，具体的处理方法通过 @ExceptionHandler进行标记，通过value来指定能够处理的异常类型。异常的处理方法需要传入两个参数，一个是HttpServletRequest请求对象，可以从这里获取请求相关的一些信息，比如请求的url或者参数等，另一个是Exception就是抛出的异常。</p><h2 class=pgc-h-arrow-right>模拟异常发生</h2><p>我们在异常的处理方法中打印一条语句</p><pre><code>@ControllerAdvicepublic class GlobalExceptionAdvice {    @ExceptionHandler(value = Exception.class)    public void handleHttpException(HttpServletRequest req, Exception ex){        System.out.println("发生异常了");    }}</code></pre><p>然后在Controller里抛出一个异常</p><pre><code>@RestControllerpublic class BannerController {    @RequestMapping(value = "/v2/banner", method = {RequestMethod.GET})    public String test() throws Exception {        throw new Exception("我抛出来的");    }}</code></pre><p>启动程序后在浏览器中访问路由，可以看到在控制台中打印出了预期的信息</p><div class=pgc-img><img alt=测试开发专题：spring-boot统一异常捕获 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/634fdbcdf5584ef49213f4ab8551fc11><p class=pgc-img-caption></p></div><p>当然在实际开发中，我们可能要多异常进行区分，该抛出什么类型的异常，异常处理函数可也不只一个，还要对返回的异常信息进行自定义。</p><h1 class=pgc-h-arrow-right>自定义异常类</h1><p>当我们需要自定义异常类的时候，是该继承自exception呢，还是继承RuntimeException?下面我们就来讨论一下。</p><p>当用户访问一个不存在的资源的时候，很明显这种情况我们是处理不了的，而且这种情况我们是可以判断出来的，所以这里应该使用Runtime异常。</p><div class=pgc-img><img alt=测试开发专题：spring-boot统一异常捕获 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d10a2bd4f4814be2a6c85099fd8b9038><p class=pgc-img-caption></p></div><p>HttpException是所有自定义运行时异常类的基类，这里定义两个状态码，一个code是我们业务层面的定义，一个httpStatusCode是http请求的，资源不存在的异常定义为 NotFoundException</p><div class=pgc-img><img alt=测试开发专题：spring-boot统一异常捕获 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8ce87147ea3c4fad8cc6a05333ad05e0><p class=pgc-img-caption></p></div><p>在controller里面抛出这个异常，</p><div class=pgc-img><img alt=测试开发专题：spring-boot统一异常捕获 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8a7d7fb49bc848ef95156a078121144f><p class=pgc-img-caption></p></div><p>那之前定义的 GlobalExceptionAdvice能够监听到这个异常呢？</p><p>当然能，NotFoundException是 HttpException的子类，HttpException是 RuntimeException的子类，RuntimeException又是 Exception的子类，@ExceptionHandler(value = Exception.class)全局异常处理器里指定的能够处理的异常类是 Exception自然也能处理 NotFoundException。</p><p>但是这里也有不同的地方，我们自定义的 HttpException是多了两个扩展字段的，code和 httpStatusCode，所以在全局异常处理器里需要对异常的类型进行判断，如果是自定义的就需要添加这两个字段。</p><p>这里呢有两种方式进行处理：一种是在之前的异常处理方法里面，进行类型判断，另一种呢是可以再添加一个异常处理方法，专门处理自定义异常类</p><div class=pgc-img><img alt=测试开发专题：spring-boot统一异常捕获 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d734232c1b744690b19627bfad3c7e78><p class=pgc-img-caption></p></div><p>这里我们可以考虑一下，当我们抛出 NotFoundException异常的时候，是会进入哪一个异常处理方法里？还是说两个都进呢？</p><p>我们可以来试验一下，启动程序后，看看在控制台打印的是什么</p><div class=pgc-img><img alt=测试开发专题：spring-boot统一异常捕获 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/aad626a7d7134dbab89d582a5217bee6><p class=pgc-img-caption></p></div><p>在浏览器里访问路由以后，控制台显示了handleHttpException异常处理方法里到的打印语句输出的内容。</p><p>可以看到多个异常处理方法是可以同时存在的，各自处理自己所能处理的异常类。</p><p>下篇文章，我们来探讨一下，如何自定义异常的返回信息，敬请关注.</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'测试','开发','专题'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>