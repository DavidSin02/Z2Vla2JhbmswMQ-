<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>实现单点登录过程中，如何平衡Token安全性和用户体验？ | 极客快訊</title><meta property="og:title" content="实现单点登录过程中，如何平衡Token安全性和用户体验？ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/e03aad72c4ed4bcea5802aa83f4e7560"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d2d74835.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d2d74835.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d2d74835.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d2d74835.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d2d74835.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d2d74835.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d2d74835.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d2d74835.html><meta property="article:published_time" content="2020-11-14T21:00:28+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:28+08:00"><meta name=Keywords content><meta name=description content="实现单点登录过程中，如何平衡Token安全性和用户体验？"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/d2d74835.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>实现单点登录过程中，如何平衡Token安全性和用户体验？</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>在 <a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6868146830304084484/?group_id=6868146830304084484" rel="noopener noreferrer" target=_blank>《IDaaS 技术解析系列（一）》</a>中，我们介绍了在单点登录中Token认证相对于传统基于Session认证的优势，本文继续介绍一组相关概念：Access Token & Refresh Token。</p><p>众所周知，Token作为用户获取受保护资源的凭证，必须设置一个过期时间，否则一次登录便可永久使用，认证功能就失去了意义。但是<strong>矛盾</strong>在于：过期时间设置得太长，用户数据的安全性将大打折扣；过期时间设置得太短，用户就必须每隔一段时间重新登录，以获取新的凭证，这会极大挫伤用户的积极性。针对这一问题，我们可以利用Access / Refresh Token这一概念来平衡Token安全性和用户体验。</p><h1 class=pgc-h-arrow-right><strong>Access / Refresh Token是什么？</strong></h1><p><br></p><div class=pgc-img><img alt=实现单点登录过程中，如何平衡Token安全性和用户体验？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e03aad72c4ed4bcea5802aa83f4e7560><p class=pgc-img-caption>图 1</p></div><p>上图表示Access/Refresh Token在客户端、认证服务器、资源服务器三者之间的传递关系，简单来说：</p><ul><li><strong>Access Token即“访问令牌”，是客户端向资源服务器换取资源的凭证；</strong></li><li><strong>Refresh Token即“刷新令牌”，是客户端向认证服务器换取Access Token的凭证。</strong></li></ul><h1 class=pgc-h-arrow-right><strong>Access / Refresh Token如何使用？</strong></h1><p><br></p><div class=pgc-img><img alt=实现单点登录过程中，如何平衡Token安全性和用户体验？ onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/9a9c1452d11541ea818cbd9454a69549><p class=pgc-img-caption>图 2</p></div><p>上图表示客户端请求资源的过程中，Access Token 和 Refresh Token 是如何配合使用的：1. 用户提供身份信息（一般是用户名密码），利用客户端向认证服务器换取 Refresh Token和Access Token；2. 客户端携带Access Token访问资源服务器，资源服务器识别Access Token并返回资源；3. 当Access Token过期或失效，客户端再一次访问资源服务器，资源服务器返回“无效token”报错；4. 客户端通过Refresh Token向认证服务器换取Access Token，认证服务器返回<strong>新的</strong>Access Token。</p><p><strong>用一个现实生活中的比喻来解释 Access/Refresh Token 的使用过程：</strong></p><p>假设我在网上预定了一家酒店。如果要入住这家酒店，我必须出示身份相关信息和订单。酒店前台会登记相关信息和订单信息，确认无误后会给我一张票据和一张房卡（票据记录我需要入住多少天，而房卡则让我有当天的入住权）。以上场景中，“身份相关信息和订单”是我的用户名密码，“票据/房卡”是Refresh/Access Token，“前台”是认证服务器，“房间”是资源服务器。</p><p><strong>在整个入住过程中，“身份相关信息和订单”只在前台使用一次；实际能进入房间的是“房卡”，但是房卡只有一天的有效期；如果房卡过期，我需要凭“票据”去前台刷新“房卡”，获取第二天的入住权。</strong></p><p><strong>将Token拆分成两个，就是为了解决安全性和用户体验方面的矛盾——</strong></p><ul><li>Access Token使用频繁，且与用户数据直接关联，安全性方面比较敏感，<strong>因此有效期设置得较短</strong>，即使Access Token泄漏也将很快失效。<strong>利用过期时间较短这个特性，也可以及时更新用户的访问权限</strong>（比如管理员缩小了的某员工访问公司数据的权限，当Token过期后换取的新Access Token将立马缩小其访问数据的权限）<strong>。</strong></li><li>而 Refresh Token仅用于获取新的Access Token，使用频率较低，不与用户数据直接关联，<strong>过期时间允许设置得长一些</strong>。<strong>这样就解决了用户反复登录的问题。</strong></li></ul><h1 class=pgc-h-arrow-right><strong>实现对用户会话的管理</strong></h1><p>站在系统管理员的角度，我们很容易想到去管理用户的会话行为。一般来说，可以通过设置Token过期时间、设置结束会话的行为、手动结束用户会话这三种方式来管理用户会话。目前玉符IDaaS在Token标准应用的基础上，为管理员开放了自定义会话管理的功能，在提升系统管理员的运维体验上更进一步——<strong>让管理员真正“有能力管理”系统发放出去的Token，</strong>比如：会话过期时间设置（如图3）：</p><div class=pgc-img><img alt=实现单点登录过程中，如何平衡Token安全性和用户体验？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a97ae0836d7e42b49d6d471b5abfe500><p class=pgc-img-caption>图 3</p></div><p>结束会话行为设置（如图4）：</p><div class=pgc-img><img alt=实现单点登录过程中，如何平衡Token安全性和用户体验？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/14f37853bc52403dbe13962a55b9cda0><p class=pgc-img-caption>图 4</p></div><p>手动结束用户会话（如图 5）：</p><div class=pgc-img><img alt=实现单点登录过程中，如何平衡Token安全性和用户体验？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e2e4316f111e447593dab9683574f00f><p class=pgc-img-caption>图 5</p></div><p><br></p><h1 class=pgc-h-arrow-right>小结</h1><p>综上所述，通过 Access Token 和 Refresh Token 配套使用，我们得以很好的平衡 Token 时效性（安全性）与用户体验二者之间的关系，并利用 Refresh Token 的特点让 IT 系统管理员真正有能力管理系统发放出去的Token，并实现“点对点”的结束会话操作。</p><blockquote><p><span style="background-color:#f8f8f8;--tt-darkmode-bgcolor: #191919">IDaaS（Identity as a Service）即身份认证管理云平台，它能提供多种标准化功能帮助用户实现高效、安全的身份认证管理服务，如单点登录、智能多因素认证、账号生命周期管理等等。由于 IDaaS 在国内尚属于新兴产品形态，很多人对它只有模糊的印象，所以我们计划用一系列文章，深入浅出介绍 IDaaS 相关的技术原理和细节。</span></p><p><span style="background-color:#f8f8f8;--tt-darkmode-bgcolor: #191919">本文是「IDaaS 技术解析系列」文章的第 2 篇。后续我们将继续分享更多技术思考，欢迎关注我们并留言交流。</span></p></blockquote><p>点击下方【了解更多】探索 IDaaS 技术</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'实现','单点','登录'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>