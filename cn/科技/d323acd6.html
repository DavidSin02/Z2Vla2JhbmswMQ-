<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>一文搞定 REST Assured 实践(二)：断言实现 | 极客快訊</title><meta property="og:title" content="一文搞定 REST Assured 实践(二)：断言实现 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/2d017d59689b467b93d6e1a4bcb3a13c"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d323acd6.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d323acd6.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d323acd6.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d323acd6.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d323acd6.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d323acd6.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d323acd6.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d323acd6.html><meta property="article:published_time" content="2020-11-14T21:03:15+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:15+08:00"><meta name=Keywords content><meta name=description content="一文搞定 REST Assured 实践(二)：断言实现"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/d323acd6.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一文搞定 REST Assured 实践(二)：断言实现</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><blockquote><p>文章来源于霍格沃兹测试学院</p></blockquote><p>在上一篇文章中，我们初步探讨了 REST Assured 的应用实践，还有很多丰富的用法需要慢慢探索研究。而 REST Assured 提供的完整断言手段，是测试工程师最常用最重要的功能之一。断言该如何使用呢？</p><p><strong>1. Json 断言</strong></p><p>1.1 环境准备</p><p>这里以 rest-assured 官方给的一个示例做演示学习</p><pre><code>{"lotto":{ "lottoId":5, "winning-numbers":[2,45,34,23,7,5,3], "winners":[{   "winnerId":23,   "numbers":[2,45,34,23,3,5] },{   "winnerId":54,   "numbers":[52,3,12,11,18,22] }]}}</code></pre><p>在本地使用 python -m CGIHTTPServer 临时搭建起一个服务：</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2d017d59689b467b93d6e1a4bcb3a13c><p class=pgc-img-caption></p></div><p>1.2 JsonPath(Groovy's GPath)</p><p><br></p><blockquote><p>在 Groovy 的官网，虽然并未提及它在 json 中的使用，但实际上只要是树形的层级关系，无论是 json、xml 或者其他格式，就可以使用这种简单的语法帮我们去找到其中的值，rest-assured 也已经帮我们实现支持了 GPath 的断言方式</p></blockquote><p><br></p><p>根节点.子节点1）我们可以使用根节点.(点)子节点的方式一层层的找下去，例如我们需要对lottoId等于 5 进行断言：</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4af2d53e70664d608be2c466c3167492><p class=pgc-img-caption></p></div><pre><code>@Testvoid testGPath(){     given().     when().             log().all().get("http://127.0.0.1:8000/restAssured.json").     then().             log().all().body("lotto.lottoId",equalTo(5)); }</code></pre><p>2）如果我们想要断言winners数组下面的winnerId，检查23和54是否包含其中，可以如下lotto.winners.winnerId写法</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7e065dee273e45989ed107283c3f5ca9><p class=pgc-img-caption></p></div><pre><code>@Testvoid testGPath(){    given().    when().            log().all().get("http://127.0.0.1:8000/restAssured.json").    then().            log().all()            .body("lotto.winners.winnerId",hasItems(54,23));}</code></pre><p><strong>索引取值</strong>1）如果我们想要取某些相同字段中的某一个，可以使用类似索引的方式获取，例如想要断言 winners 数组下面的 winnerId 的第一个值是否为23，可以使用 lotto.winners.winnerId[0]，写法如下：</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3d78d5f56578479a8e536a6186840d5a><p class=pgc-img-caption></p></div><pre><code>@Testvoid testGPath(){    given().    when().            log().all().get("http://127.0.0.1:8000/restAssured.json").    then().            log().all()            .body("lotto.winners.winnerId[0]",equalTo(23));}</code></pre><p>2）如果我们想要取某些相同字段中的最后一个，可以使用 -1 作为索引，例如断言断言 winners 数组下面的 winnerId 的最后一个的值是否为 54</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0c3e3251558b4053a54be8437f11e6da><p class=pgc-img-caption></p></div><pre><code>@Testvoid testGPath(){    given().    when().            log().all().get("http://127.0.0.1:8000/restAssured.json").    then().            log().all()            .body("lotto.winners.winnerId[-1]",equalTo(54));}</code></pre><p><strong>findAll</strong></p><p>有时候我们需要获取符合某些条件的结果来进行断言，这里 findAll 可以帮助我们实现，我们可以在 findAll 方法中写筛选条件，例如我们想取 winnerId 的值在大于或等于 30 小于 60 之间的结果进行断言，具体写法如下：</p><pre><code>@Testvoid testGPath(){    given().    when().            log().all().get("http://127.0.0.1:8000/restAssured.json").    then().            log().all()            .body("lotto.winners.findAll{ winners -&gt; winners.winnerId &gt;= 30 &amp;&amp; winners.winnerId &lt; 60}.winnerId[0]",equalTo(54));}</code></pre><p><strong>find</strong></p><p>find 的用法与 findAll 基本一致，只是 find 默认取匹配到的第一个：</p><pre><code>@Testvoid testGPath(){    given().    when().            log().all().get("http://127.0.0.1:8000/restAssured.json").    then().            log().all()            .body("lotto.winners.find{ winners -&gt; winners.winnerId &gt;= 30 &amp;&amp; winners.winnerId &lt; 60}.winnerId",equalTo(54));    }</code></pre><p>1.3 实操演示</p><p>将上述各个断言语法写在一起，实际运行校验结果：</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/910b2f9a1ce04725ae075ce5de25453a><p class=pgc-img-caption></p></div><p><strong>2. XML断言</strong></p><p>2.1 环境准备</p><p>上面介绍了，GPath 也支持 XML 格式的断言，这里再以 rest-assured 官方给的一个实例做演示</p><pre><code>&lt;shopping&gt; &lt;category type="groceries"&gt; &lt;item&gt; &lt;name&gt;Chocolate&lt;/name&gt; &lt;price&gt;10&lt;/price&gt; &lt;/item&gt; &lt;item&gt; &lt;name&gt;Coffee&lt;/name&gt; &lt;price&gt;20&lt;/price&gt; &lt;/item&gt; &lt;/category&gt; &lt;category type="supplies"&gt; &lt;item&gt; &lt;name&gt;Paper&lt;/name&gt; &lt;price&gt;5&lt;/price&gt; &lt;/item&gt; &lt;item quantity="4"&gt; &lt;name&gt;Pens&lt;/name&gt; &lt;price&gt;15&lt;/price&gt; &lt;/item&gt; &lt;/category&gt; &lt;category type="present"&gt; &lt;item when="Aug 10"&gt; &lt;name&gt;Kathryn's Birthday&lt;/name&gt; &lt;price&gt;200&lt;/price&gt; &lt;/item&gt; &lt;/category&gt; &lt;/shopping&gt;</code></pre><p>再次在本地搭起一个临时服务：</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a958ce8f5bd44aec9728ba035b8a9cb4><p class=pgc-img-caption></p></div><p>2.2 XmlPath断言语法</p><p>若我们要对第二个 name 的值 Coffee 进行断言，写法如下：</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4cdb191ea8b44f86b89f05206fbea029><p class=pgc-img-caption></p></div><p><br></p><pre><code>@Testvoid testXML(){    when().            get("http://127.0.0.1:8000/restAssured.xml").    then().            log().all().            body("shopping.category[0].item[1].name",equalTo("Coffee"));}</code></pre><p><strong>size()</strong></p><p>可以利用 size() 方法来获取对应节点的数量，例如这里要断言 category 的数量：</p><pre><code>@Testvoid testXML(){    when().            get("http://127.0.0.1:8000/restAssured.xml").    then().            log().all()            .body("shopping.category.size()",equalTo(3));}</code></pre><p><strong>it.@type、it.price</strong></p><p>在 xml中 断言中，可以利用 it. 属性或节点的值来作为筛选条件；例如这里要获取 type 为 supplies 的 category 下的第一个 item 的 name，以及获取 price 为 10 的商品名 name。</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5bcc0d08d6834ffa92101930e47effaf><p class=pgc-img-caption></p></div><pre><code>@Testvoid testXML(){     when().             get("http://127.0.0.1:8000/restAssured.xml").     then().             log().all()             .body("shopping.category.findAll{ it.@type == 'supplies' }.item[0].name",equalTo("Paper"))             .body("shopping.category.item.findAll{ it.price == 10 }.name",equalTo("Chocolate")); }</code></pre><p><strong>**.findAll</strong></p><p>对于xml中有一个特别的语法，**.findAll，可以直接忽略前面的节点，直接对筛选条件进行匹配，依然获取price为10的商品名name，写法如下：</p><pre><code>@Testvoid testXML(){    when().            get("http://127.0.0.1:8000/restAssured.xml").    then().            log().all()            .body("**.findAll{ it.price == 10 }.name",equalTo("Chocolate"));}</code></pre><p>2.3 实操演示</p><p>将上述各个断言语法写在一起，实际运行校验结果：</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/edf28b29874742b88518784226023663><p class=pgc-img-caption></p></div><p><strong>3. JsonSchema断言</strong></p><p>3.1 需求背景</p><p>在实际工作中，对接口返回值进行断言校验，除了常用字段的断言检测以外，还要对其他字段的类型进行检测，原因在于：</p><p><br></p><ul><li>返回字段较多，无法保证每个字段都写断言</li><li>防止客户端未做 null 值的校验判断，如果因为版本变更或网络等原因造成某个不能接收 null 值的返回字段为 null，就很有可能造成软件的崩溃</li><li>某些数值是不能为负的</li><li>小数点保留位数，对于股票的交易、医疗数据的分析，小数点的精确度都是有其实际价值的</li></ul><p>对返回的字段一个个写断言显然是非常耗时的，这个时候就需要一个模板，可以定义好数据类型和匹配条件，除了关键参数外，其余可直接通过此模板来断言，这个就要请出JsonSchema了</p><p>3.2 使用方法</p><p>先对上述的 json 例子做少许修改，增加一个 String 类型的 winnername 字段，这里可以先你不用疑惑为什么加，后续自有其演示作用</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/bfc172d47ab048c9b3154c83b071a74c><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right><strong>JsonSchema模板生成</strong></h3><p>1）首先要借助于Json schema tool的网站https://www.jsonschema.net/，将返回json字符串复制到页面左边，然后点击INFER SHCEMA,就会自动转换为schema json文件类型,会将每个地段的返回值类型都设置一个默认类型; 在pattern中也可以写正则进行匹配</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1b22199dced440c59585fc3b82ff8c63><p class=pgc-img-caption></p></div><p>2）点击“设置”按钮会出现各个类型返回值更详细的断言设置，这个就是schema最常用也是最实用的功能，也可以对每种类型的字段最更细化的区间值校验或者断言，例如长度，取值范围等，具体感兴趣的话可以从官网学习深入学习；平常对重要字段的校验我通常会选用其他断言，比如hamcrest断言</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/430fd400c0874687946f6c8ff09199ae><p class=pgc-img-caption></p></div><p>3）选择复制功能，可以将生成的schema模板保存下来</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c0ce119485314267befa96bc45608353><p class=pgc-img-caption></p></div><p><strong>rest-assured结合使用</strong></p><p>4）添加maven依赖，在rest-assured完成支持</p><pre><code>&lt;dependency&gt;    &lt;groupId&gt;io.rest-assured&lt;/groupId&gt;    &lt;artifactId&gt;json-schema-validator&lt;/artifactId&gt;    &lt;version&gt;4.0.0&lt;/version&gt;&lt;/dependency&gt;</code></pre><p>5）使用matchesJsonSchemaInClasspath方法对响应结果进行schema断言</p><pre><code>@Testvoid jsonSchemaTest(){    get("http://127.0.0.1:8000/restAssured.json").    then().log().all()            .body(matchesJsonSchemaInClasspath("jsonSchema.json"));}</code></pre><p>运行结果：</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ec8ead810ddc47af852dbb427db86842><p class=pgc-img-caption></p></div><p><strong>多类型校验-Combining schemas</strong></p><ul><li>String类型的默认值为null，后端很有可能在某个字段无值时返回null，例如我们将之前添加的winnername字段返回null:</li></ul><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/686b4aef739d4fc4a0806b384c003c5d><p class=pgc-img-caption></p></div><p>运行查看断言结果：</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9a07e78ff05c4b14974611267dc6f9ea><p class=pgc-img-caption></p></div><p>很明显用例执行失败，当我们定义了winnername为String类型后，返回null就会断言失败，这显然不符合我们的需求，会造成用例执行结果的误判，这个时候我们需要使winnername即可以为String类型，又可以为null；</p><p>这就要用到jsonSchema提供的Combining schemas方法了 Combining schemas提供了如下几种方式：</p><ul><li>allOf</li><li>anyOf</li><li>oneOf</li><li>not</li></ul><p>这里我们选取anyOf(任何一项满足即可)来完成上述的举例，将原来的type换成String和null任何一个都支持的类型：</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/cbde85bc6f8c407ba7e2d415c058db66><p class=pgc-img-caption></p></div><p>再次运行用例，查看断言结果：</p><div class=pgc-img><img alt="一文搞定 REST Assured 实践(二)：断言实现" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2db882205d424fc68806d0ede2b92ce1><p class=pgc-img-caption></p></div><p>用例完美通过，到此结束~</p><p>（文章来源于霍格沃兹测试学院）</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'REST','Assured','实践'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>