<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>【上篇】GSM手机校准终测原理 | 极客快訊</title><meta property="og:title" content="【上篇】GSM手机校准终测原理 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/66c70005a8873efbaf40"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/da81dc78.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/da81dc78.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/da81dc78.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/da81dc78.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/da81dc78.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/da81dc78.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/da81dc78.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/da81dc78.html><meta property="article:published_time" content="2020-11-14T21:06:51+08:00"><meta property="article:modified_time" content="2020-11-14T21:06:51+08:00"><meta name=Keywords content><meta name=description content="【上篇】GSM手机校准终测原理"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/da81dc78.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>【上篇】GSM手机校准终测原理</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>1 校准终测的基本原理</p><p>1.1校准 、终测的目的</p><p>现在生产的相同型号手机虽然使用都是相同器件,但这相同器件还是有的一定的偏差,由此组合的手机就必然存在着差异,但这差异是在一定的范围,超出了就视为手机不良。因此校准的目的就是将手机的这种差异调整在符合国标的范围，而终测是对于校准的检查，因为校准无法对手机的每个信道，每个功率级都进行调整，只能选择有代表性的（试验经验点）进行，所以校准通过的手机并不能肯定它是良品，只有通过终测检验合格的才算是，我们现在生产线上的校准终测测试程序都是将这两个部分合并（除了DA8和EMP平台）。</p><p>1.2手机的基本校准、测试项的介绍</p><p>1、<strong>Battcal（电池校准）</strong>：是对手机的电池模拟使用的调整，分两种情况（4.2V和3.5V）。</p><p>恒9系列和Florence平台的校准相似，先调整手机电池处在4.2V时的偏置值，使其冲手机读取的电压表示值在4.2±0.1v的范围，然后将电池的电压调至3.5v，看电压是否还处于3.5±0.1v的范围，是就将这偏置值存入手机。</p><p>2、<strong>TxCal（发射机校准）：</strong>不同的平台有不同的校准方法，但其大致的原理是一样的。就是通过一定的方法调整在一个或者几个试验经验点（全部功率级）的功率值的表示值，使其符合国标的要求。这表示值可以是一个单一的数字，也可以是一组，像A6/A8系列的就是多个经验点（GSM900有10,60,105,1000这4个信道，DCS1800有570,700,800这3个信道）全功率级（即GSM900有5-19，DCS1800有0-15）单一的数值，而恒9系列和Florence平台则是单个经验点（GSM900有62，DCS1800有698）的全功率级代表该功率级的一组功率曲线的表示值。</p><p>在这就目前使用的两种PA将校准做个详细的介绍</p><p><strong>一）RFMD</strong></p><p><strong>a)、发射机及其校准原理</strong></p><p><img alt=【上篇】GSM手机校准终测原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/66c70005a8873efbaf40></p><p>在发射机中，从CSP产生的已调信号，经过HD155148的混频、射频放大，再经功率放大器（PA）放大、滤波后从天线发送出去。发送信号的功率和形状（burst shape）由PA决定，这里采取功率控制环来控制发送信号的功率和形状。Tx校准原理就是通过测量计算得到一系列TXP值，去控制PA的增益，使得不同PCL的发射信号满足规范的要求（绝对功率大小、相连PCL的功率、切换频谱、Burst Shape等）。如图Figure 1 所示。</p><p>校准时，我们先根据写入手机的TXP值和测量得到的功率值PM，计算得到TXP和PM的关系曲线L，再根据L对每个PCL所要求的功率值Prequired计算出相应的TXP值存到NVM即可。校准的关键是找到TXP和PM的关系曲线L，根据实验得到TXP和PM相应的电平V存在线性关系，因此我们只需要两个PCL的对值（TXP，V）即可得到L。</p><p><strong>b)、校准方法及公式</strong></p><p><img alt=【上篇】GSM手机校准终测原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/66c60006069ff15fd3fd></p><p>发射信号的形状如图Figure 2 所示，它包括三部分：Ramp Up、Mid-Burst、Ramp Down。其中Mid-Burst 为平坦部分，决定着信号的功率。校准过程中，Mid-burst 可由TXP和PM的关系得到Mid-TXP，而Ramp Up和Ramp Down用正弦曲线来逼近，见图Figure 3。</p><p>校准时，待发射信号直接通过cable耦合到测试仪器，负载为50Ohm，因此输出信号电平V（v）和输出信号功率P（mW）满足Formula_1。</p><p>Ramp UP和Ramp Down（Burst Shape除去Mid-Burst后的形状）用0到Pi的三次正弦函数模拟。如图Figure 3，我们在该曲线上按时间均匀取32个点（element），element1到element5的值为0，element6到element15的值按正弦函数给出。其他element的值对称得到。Formula_2给出了element5到element15的值，其中Te=（e-15）*（48/13/2）us （每个element占半个bit，每个bit为48/13us），t=T-Te 。</p><p>线性曲线L的斜率m和常数c由Formula_4计算得到，TXPH和TXPL由推荐值m0和c0计算得到（plH→Prequired→Vrequired→TXPH），VH和VL由Formula_1得到（PMH→VH）。</p><p><img alt=【上篇】GSM手机校准终测原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/66c80004ce6ddc316149></p><p><img alt=【上篇】GSM手机校准终测原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/66c500061cfb4f3dc3e3></p><p><strong>c)、校准步骤</strong></p><p>1. 确定TXP vs V曲线中的m和c：</p><p>先根据推荐值m0和c0, 由给定plH(pl 6 at EGSM; pl 1 at DCS)得到Prequired，计算Vrequired，从而TXPH=m0*Vrequired+c0 ，同时从仪器读出手机的输出功率PM，计算VH 。同样方法得到TXPL和VL 。</p><p>再根据（TXPH，VH）和（TXPL，VL），计算m和c 。</p><p>2. 对每个频带每个功率级进行校准：</p><p>根据上一步得到的m和c，算出每个功率级的Ramp Data并存入RAM。最后存入NVM。</p><p>3. 验证校准结果：</p><p>其实RFMD的校准方式就是计算出实际发射功率的电压值与手机RAM存储的功率表示值的关系直线。而SKY校准与这不同，下面将详细介绍。</p><p><strong>二）SKY</strong></p><p>这种校准方式比较花时间，但可以将各个功率级的功率校的很精确。</p><p><strong>a）、</strong>将手机仪器都设置在TestMode；</p><p><strong>b）、</strong>设置仪器一个合适的信道，发送PTE指令控制手机处于连续发射状态，信道与仪器对应；</p><p><strong>c）、</strong>写入该功率级的默认值，调整默认值（或加或减）使手机的发射功率达到期望值，将此数据换算的Ramp值存入手机，对该信道的各个功率级都进行这样计算、存值。</p><p><strong>3、RxCal（接收机校准）：</strong></p><p>由于恒9系列和Florence平台的Rx射频接收模块不一样，因此校准也不一样。我们分开介绍，</p><p><strong>Agere平台的机型有：</strong></p><p><strong>A）、</strong><strong>Seville</strong><strong>平台</strong></p><p><img alt=【上篇】GSM手机校准终测原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/66c80004cf37f9e4b489></p><p><strong>上图</strong>说明了Rx信号的处理的全过程。信号通过50欧姆阻抗的馈线连接通过手机的天线开关和FEM，FEM包含了Tx/Rx切换开关、带通滤波器，如图2，RF信号必须通过HD155148TF芯片中的3个低噪放大EGSM/GSM1800/GSM1900各一个），进行必要的放大或者衰减（这些低噪放大器可由软件来实现开关），这些低噪放大器的大约是21.5dBm，EGSM频段的在放大器关闭的状态下最小增益是-28dBm,GSM1800/1900是-26dBm.，在校准过程中这些增益都很相似，并可以精确计算。由这些低噪放大器输出的RF信号通过直接变频器下变频后，通过两组的BB singnal path分离为I和Q信号。这些点的大半增益都可以实现控制，由-28dBm到62dBm步长为2dBm。</p><p><strong>下</strong><strong>表</strong><strong>为Rx接收的各部分控制词，具体分布如下：</strong></p><p><strong>RB0-5为BB部分的增益设置，RG0-1为前置低噪放大器的增益控制（00-正常放大增益约21.5dBm；11-为关闭前置放大，增益为-26dBm或-28dBm）</strong></p><p><img alt=【上篇】GSM手机校准终测原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/6c2c0000e50fd422915f></p><p><img alt=【上篇】GSM手机校准终测原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/66c90003d5af50c4065b></p><p><img alt=【上篇】GSM手机校准终测原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/6c2c0000e6b9982aa9aa></p><p><strong>下表为</strong><strong>RxGain</strong><strong>A（CSP部分）的放大增益控制词：</strong></p><p><img alt=【上篇】GSM手机校准终测原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/66c50006201ae8495354></p><p>下图为接收放大器的接收特性，在不同的信道有不同的放大增益，为了获得更准确地增益，应该把他们考虑进去，在下面关键的校准步骤中会介绍。</p><p><img alt=【上篇】GSM手机校准终测原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/66c70005ad967e0bebf6></p><p>关键的校准步骤：</p><p><strong>1</strong><strong>）</strong><strong>、设置工作点（Setworkingpoint</strong>）</p><p>Setworkingpoint主要的目的是寻找CSP.ADC处信号电平在-20dBfs时且通道增益已定义的情况下的Cellpower。这样，通道增益就包含有前置低噪放大器的增益，直接变频器的增益和22dB的HD155141TF内部的基带增益，但不包括CSP的基带增益，其手机接受的控制词（RxGainA = 0，RxGainB = 202）。选一个任意的测试信道，例如：A9/A90的就选择975信道，这是由于低信道的决定了频率边带的补偿。</p><p>1/发送PTE指令ReadRSS,</p><p>975,0,0,202,975,0,0,202,975,0,0,202,975,0,0,202</p><p>2/读取结果算出平均值并转换成dBfs单位，公式：10 log ((Reading1 + Reading2 + Reading3 + Reading4) / (4 * 32767))</p><p>3/如果计算出的结果偏离-20dBfs的0.2dB，就得调整信号发生器的信号电平，然后重复测试。</p><p>4/记录下信号发生器的信号电平</p><p><strong>2</strong><strong>）</strong><strong>、</strong><strong>测试边带信道</strong>（Measure band ripple for EGSM band）</p><p>目的是计算在相同的通道增益和相同的信号强度条件下，其通道放大器对不同频段的响应的补偿，即将偏差范围较大的响应曲线纠正在一定的范围如上图</p><p>1/发送PTE指令ReadRSS,Chan No,0,0,202,Chan No,0,0,202,Chan No 0,0,202,Chan No,0,0,202</p><p>2/读取结果并将其转换为dBfs单位（取平均值）</p><p>3/测试每个边缘信道，根据公式：Sub–Band Average = (Average Lower Channel + Average Upper Channel) / 2算出这个频段的平均值，再根据公式：Overall Band Mean = Sum of Sub–Band Mean Column / 8计算出这8组频段的平均值。</p><p>4/计算频段补偿，根据公式：（每个频段的平均值-8组频段的平均值）*16,并记录下参数</p><p><strong>3</strong><strong>）</strong><strong>、</strong><strong>测试</strong><strong>Rx</strong><strong>基本通道增益</strong><strong>(LNA</strong><strong>开启</strong><strong>)(Calculate the EGSM Basic Rx Path Gain for LNA on case)</strong></p><p>已知：Channel=62 ；取基本通道增益BB_Gain =12 ，因此基本通道开关增益为12-（-28）=40（因为通道增益关闭时增益为-28dBm）</p><p>1/根据已知的-54.5dBm 对应的BB_Gain数值202 ，换算成BB_Gain数值162时，信号发生器的信号电平</p><p>公式：-54.5 + ((202-2)/8) - ((162-2)/8)</p><p>2/发送PTE指令，ReadRSS,62,0,0,162,62,0,0,162,62,0,0,162,62,0,0,162</p><p>3/读取结果并将其转换成dBfs单位，（Mean）</p><p>4/取出原先计算的现在测试信道所对应的频段补偿</p><p>5/计算基本通道增益，Basic Rx Path Gain= Mean-换算出来的信号发生器的信号电平-基带部分的开关增益-频段补偿</p><p>6/将其结果乘以16，保存下来。</p><p><strong>4</strong><strong>）</strong><strong>、测试基本通道的补偿值</strong>（<strong>Calculate the BB_Gain compensation values</strong>）</p><p>已知：Channel=62，BB_Gain=-16 dB (RxGainA = 0, RxGainB = 50)，LNA = on</p><p>设置信号发生器的信号电平能保证CSP的ADC处的信号强度在-20dBfs，通过SetWorkingPoint部分完成</p><p>例如：现在的信号发生器的信号电平为：Signal level at antenna = – 24.375dBm</p><p>1/发送PTE指令：ReadRSS, 62,0,0,50,62,0,0,50,62,0,0,50,62,0,0,50</p><p>2/读取结果并计算其CSP处的信号强度Mean=10 Log ((327 + 326 + 326 + 326) / 4) / 7FFF) = – 20.0188 dBfs</p><p>那么，Rx基带通道增益=Mean-信号发生器的信号电平-基带开关增益-频带补偿</p><p>重复以上的操作，将BB_Gain设为-2，26，40，54dB，得到以下结果：</p><p>Basic Rx Path Gain for – 16dB Base–Band gain = – 8.7688</p><p>Basic Rx Path Gain for – 2dB Base–Band gain = – 8.8134</p><p>Basic Rx Path Gain for + 12dB Base–Band gain = – 8.7678</p><p>Basic Rx Path Gain for + 26dB Base–Band gain = – 8.851</p><p>Basic Rx Path Gain for + 40dB Base–Band gain = – 9.2095</p><p>Basic Rx Path Gain for + 54dB Base–Band gain = – 9.5656</p><p>3/分别计算各个测试的BB_Gain值与-8.7678的差值，并取整</p><p>4/通过PTE指令将值存入手机，SetGainCalBBIF %d,%d,,%d,%d,%d,%d</p><p>BB_Gain[0] = 16 * (– 8.7678 + 8.7688) = 0.256 which is rounded to 0</p><p>BB_Gain[1] = 16 * (– 8.7678 + 8.8134) = 0.7296 which is rounded to 1</p><p>BB_Gain[2] = 16 * (– 8.7678 + 8.7678) = 0</p><p>BB_Gain[3] = 16 * (– 8.7678 + 8.851 ) = 1.3312 which is rounded to 1</p><p>BB_Gain[4] = 16 * (– 8.7678 + 9.2095) = 7.0672 which is rounded to 7</p><p>BB_Gain[5] = 16 * (– 8.7678 + 9.5656) = 12.7648 which is rounded to 13</p><p><strong>5</strong><strong>）</strong><strong>、计算</strong><strong>Rx</strong><strong>基带通道增益（</strong><strong>LNA</strong><strong>关闭）（</strong><strong>Calculate the EGSM Basic Rx Path Gain for LNA off case</strong><strong>）</strong></p><p>已知：Channel 62，BB_Gain = 52dB (RxGainA = 0, RxGainB = 1536 + 322=1858 , RG0 and RG1 位设置为1，使LNA完全关闭)，LNA = off</p><p>设置信号发生器的信号电平能使CSP处的信号强度保持在-20dBfs</p><p>例如：</p><p>此时信号发生器的信号电平，Signal level at antenna = – 39.86dBm</p><p>1/ 发送PTE指令：ReadRSS, 62,0,0,1858,62,0,0,1858,62,0,0,1858,62,0,0,1858</p><p>2/读取结果并将其转换为dBfs单位，Mean = 10 Log ((323 + 323 + 325 + 323) / 4) / 7FFF) = – 20.0556 dBfs</p><p>3/其频带增益：Sub–Band Compensation = 1.125dB</p><p>4/当前的BB_Gain=52dB，那么其通道开关增益 BB switched gain = 52 + 28 = 80dB</p><p>5/由于BB_Gain=52dB，在46dB和62dB之间，其基带补偿：BB_Gain compensation = 13/16 = 0.8125dB，即使用BB_Gain[5]的补偿</p><p>6/现在我们可以计算出在LNA关闭的情况下的Rx基带通道增益：Basic Rx Path Gain =– 20.0556 – (Sub–Band Compensation) – (BB_Gain compensation) – (Level at antenna) – (BB switched gain)= – 20.0556 – 1.125 – 0.8125 + 39.86 – 80 = – 62.1331dB</p><p>7/将其乘以16转换回去，并分成两部分存储：Round(– 62.1331 * 16)=-994 或者0xFC1E(MSB=252,LSB=30)</p><p><strong>6</strong><strong>）</strong><strong>、将校准的值存入手机</strong></p><p>&lt;1>通过PTE指令SetGainCalGSM和SetGainCalDCS来存值</p><p>&lt;2>指令的参数说明：</p><p>例如：<strong>SetGainCalGSM</strong><strong>, Param1, Param2,..,Param36</strong><strong> </strong>其36个参数见下表</p><p><img alt=【上篇】GSM手机校准终测原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/66c90003d97c6508e6ef></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'GSM','手机','校准'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>