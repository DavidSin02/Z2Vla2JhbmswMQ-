<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>利用IBERT IP核实现GTX收发器硬件眼图测试实例 | 极客快訊</title><meta property="og:title" content="利用IBERT IP核实现GTX收发器硬件眼图测试实例 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/06d4e7a7f50f4880a53d3d09a4365487"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dbcb0693.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dbcb0693.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/dbcb0693.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dbcb0693.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dbcb0693.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/dbcb0693.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/dbcb0693.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dbcb0693.html><meta property="article:published_time" content="2020-11-14T21:05:01+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:01+08:00"><meta name=Keywords content><meta name=description content="利用IBERT IP核实现GTX收发器硬件眼图测试实例"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/dbcb0693.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>利用IBERT IP核实现GTX收发器硬件眼图测试实例</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><strong>引言：</strong>Xilinx公司的Vivado开发软件提供了IBERT IP核，可以实现GTX收发器硬件测试。通过该IP核我们可以对FPGA高速收发器硬件接口进行误码率测试、调整收发器参数配置、验证硬件PCB信号完整性以及硬件数据传输的可靠性。本文我们基于Xilinx公司xc7z035ffg676-2芯片进行测试。通过本文可以了解到：</p><ul><li>GTX收发器IBERT眼图测试原理</li><li>GTX收发器IBERT眼图测试方法</li></ul><h1 class=pgc-h-arrow-right>1.IBERT测试原理</h1><p>Bit Error Ratio Tester简称IBERT，即误码率测试，其测试原理框图如图1所示。我们使用光纤将收发器的TX和RX进行短接，实现Loopback。图1中可以看到在近端回环测试中，可以实现PCS回环（图中①所示）和PMA回环测试（图中②所示）。</p><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/06d4e7a7f50f4880a53d3d09a4365487><p class=pgc-img-caption>图1、IBERT回环测试原理图（点击看大图）</p></div><h1 class=pgc-h-arrow-right>2.工程建立</h1><h1 class=pgc-h-arrow-right>2.1新建IP核工程</h1><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7c407ad3ff9848119569a1384a5f49b1><p class=pgc-img-caption>图2、电路板芯片选择</p></div><h1 class=pgc-h-arrow-right>2.2 IBERT IP核配置</h1><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/191fc6c850e94e5ea9acf6a149bac8bb><p class=pgc-img-caption>图3、IBERT IP核查找</p></div><p>图4为IBERT协议配置定义界面，IP核有一些预置的协议，我们选择用户自定义Custom1，收发器线速率选择1.25Gbps，位宽32bit，收发器参考时钟为原理图MGT112REFCLK0输入时钟125MHz。</p><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/f11ef84f0408447aa8d3980ceb06c44e><p class=pgc-img-caption>图4、IP核协议配置界面</p></div><p>图5为要测试的GTX收发器位置定义及参考时钟来源选择。本设计两路SFP+均来自Quad112，参考时钟来自MGTREFCLK1_112。</p><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/9510d616239c4a1c99c86c72b91fb3ab><p class=pgc-img-caption>图5、GTX收发器位置及参考时钟来源</p></div><p>图6为IBERT IP核工作时钟，本设计将GTX收发器参考输入时钟作为其系统时钟。</p><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ae3ef2f04ea040de8729f9f15a079353><p class=pgc-img-caption>图6、IBERT IP核系统工作时钟选择</p></div><p>配置完成后，点击“OK”，然后生成IP核，如图7所示。</p><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f022dd1f306c464abfd398c61c8e2c39><p class=pgc-img-caption>图7、IBERT IP核生成</p></div><h1 class=pgc-h-arrow-right>2.3建立GTX收发器测试工程</h1><p>生成IBERT IP核后，我们在工程名上右键，选择生成example design，如图8所示。</p><p><br></p><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4ec6002f0d0c4da9943bdd525056d36d><p class=pgc-img-caption>图8、生成IBERT example design</p></div><p>如图9所示，打开顶层文件，为了使能电路板上的SFP+模块，需要添加部分代码。同时，修改.xdc约束文件，如图10所示。</p><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/da15074769dd465d922bc25509a24110><p class=pgc-img-caption>图9、测试文件代码</p></div><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6058622b1d9b44c19b685e98f729a79c><p class=pgc-img-caption>图10、添加用户I/O约束</p></div><p>上述操作完成后，生成bit流文件，完成FPGA配置文件生成。</p><h1 class=pgc-h-arrow-right>3.实物测试</h1><h1 class=pgc-h-arrow-right>3.1误码率测试</h1><p>按照测试原理，我们将两路SFP+的光纤模块各自将其TX和RX短接。如图11所示。连接好硬件，将bit文件下载到硬件电路板，下载完成后，如图12所示。</p><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/80c72ae33f5f47c99b12852b1c84e045><p class=pgc-img-caption>图11、测试实物图</p></div><p>从图12中，可以看到，逻辑分析仪已经发现链接的两路收发器链路。</p><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0de9bc7375dc40a08ec7fceff415a3bf><p class=pgc-img-caption>图12、下载完成后发现两路收发器链路</p></div><p>如图13、我们点击“Serial I/O Links”，如果未出现如图所示链路，右键“Refresh Serial I/O objects”。在图13中，可以看到出现很多Errors，此时，我们需要将IBERT进行复位，重新测试。复位之后，如图14所示，我们可以看到收发器串行链路稳定，未出现误码。</p><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/59be5e40b1714e38b9c175927019ad81><p class=pgc-img-caption>图13</p></div><p>图14中只显示了有链接的串行接口，未链接的MGT_X0Y12和MGT_X0Y13收发器未显示。</p><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/46e0d93215264cf9b201b5691b97419a><p class=pgc-img-caption>图14、复位IBERT之后的测试结果</p></div><h1 class=pgc-h-arrow-right>3.2眼图测试</h1><p>按照图15，选择需要查看眼图的链路，眼图参数可以使用默认参数，第一路收发器眼图测试结果如图16所示。第二路眼图扫描结果如图17所示。</p><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8405af9da76a462a8232ccd99d266c9b><p class=pgc-img-caption>图15、收发器眼图设置</p></div><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8dc370252e8a4e6eb2444efa2dfad59f><p class=pgc-img-caption>图16、第一路收发器眼图测试结果</p></div><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0c803d58882c478f8fa9a1c1ad8840f9><p class=pgc-img-caption>图17、第二路收发器眼图测试结果</p></div><p>如图18所示，我们可以通过修改收发器串行I/O参数，优化连接链路信号质量（眼图张开大小）。可以选择Loopback模式，进行所需要的回环测试。</p><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/37487616b8164b7f84d9a724439b11fe><p class=pgc-img-caption>图18、收发器参数配置及测试模式选择（点击看大图）</p></div><p>图19为将Loopback模式选择为近端PMA测试结果，对比图16，可以看到图19比图16眼图更好，之所以更好，这是因为数据流只在FPGA内部进行回环，未经过外部光纤。从信号完整性角度来看，眼图中间蓝色区域越大，表明PCB板信号完整性越好。</p><div class=pgc-img><img alt="利用IBERT IP核实现GTX收发器硬件眼图测试实例" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/89bc2bd771f249a7af3af59a0e4f9b08><p class=pgc-img-caption>图19、收发器近端PMA回环测试</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'IBERT','IP','核实现'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>