<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>一文总结Java中原子类相关实现 | 极客快訊</title><meta property="og:title" content="一文总结Java中原子类相关实现 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/2dfc593b3b104a499d6d736518072928"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dc35e6bd.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dc35e6bd.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/dc35e6bd.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dc35e6bd.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dc35e6bd.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/dc35e6bd.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/dc35e6bd.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dc35e6bd.html><meta property="article:published_time" content="2020-10-29T21:09:15+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:15+08:00"><meta name=Keywords content><meta name=description content="一文总结Java中原子类相关实现"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/dc35e6bd.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一文总结Java中原子类相关实现</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>开发中涉及到公共资源如果都可以用锁去控制并发，但是对于简单比如一个变量都要实现一个并发控制难免太复杂了，所以Java提供了一些简单的原子类以供使用。</p><h1 class=pgc-h-arrow-right>基础原子类</h1><p>最基础的原子类主要有三个AtomicInteger、AtomicBoolean、AtomicLong，这三个类作为一些简单的公关资源或者开关等已经能够满足需求了，他们的实现都比较简单，。首先是AtomicBoolean他维护一个volatile修饰的int型变量value，（volatile作用关键字不清楚可以去了解下，简单说下就是能够保证内存可见性，也就是一个线程修改了其他线程能够马上看到）<strong>value等于1表示true等于0表示false</strong>，AtomicBoolean提供compareAndSet、getAndSet、get等方法，get方法返回value是否等于1的判断结果，compareAndSet利用Unsafe（<strong>这个类是Java并发很关键的类各种原子操作都靠它</strong>）来修改value的值，修改成功返回true，修改失败返回false，getAndSet通过循环get与compareAndSet操作，当compareAndSet成功是返回get的值，也就能保证获取到这次修改前的值。</p><p>AtomicInteger也维护一个一样的value，提供了addAndGet、getAndAdd、getAndDecrement等系列方法，addAndGet返回的是修改后的值，getAndAdd返回的是修改前的值。AtomicInteger只提供了简单的加减法，不过也提供了accumulate类方法，可以自己定义一些计算，比如除法，平方之类的。</p><p>AtomicLong与AtomicInteger提供的差不多，区别在于AtomicLong维护的value是long类型，主要的是Unsafe的long相关修改方法。</p><p>这三个类原子都是在内部保存一个变量value，并且通过volatile关键字修饰保证数据的可见性。然后依赖Unsafe的CAS方法保证并发修改的正确性，<strong>再综合利用volatile与Unsafe的CAS方法返回结果组合使用利用循环保证更新线程安全和一定成功。</strong></p><h1 class=pgc-h-arrow-right>数组类型原子类</h1><p>数组类型原子类也有三个AtomicIntegerArray、AtomicLongArray、AtomicReferenceArray，AtomicIntegerArray与AtomicLongArray实际上和AtomicInteger与AtomicLong提供的功能差不多，只不过他们是提供一个数组的原子性，也就是他们提供的是一系列变量的原子性，而AtomicInteger与AtomicLong维护的是一个变量的原子性。</p><p>而AtomicReferenceArray与AtomicReference就和AtomicIntegerArray与AtomicInteger对比一样。</p><p>他们与单个原子类的区别是，再初始化的时候会初始化一个数组，每次修改都是修改指定数组索引的一个数据。<strong>逆向思维一下就相当于他们是在维护一个数组的原子性，而基础原子类是在维护单个变量的原子性。</strong></p><h1 class=pgc-h-arrow-right>引用类型原子类</h1><p>引用类型的原子类也有三个AtomicReference、AtomicStampedReference、AtomicMarkableReference，主要是AtomicReference介绍下，另外两个原子类都是对AtomicReference的扩展，但是实际上AtomicReference和基础原子类一样，甚至我觉得可以归为基础类，因为它和基础类一样是维护一个变量value只不过类型是泛型，也就是说可以保存任意的类型，然后每次修改的时候比较value的引用是否一致。<strong>所以AtomicReference相当于是基础类型的扩展，它是维护所有对象，每次修改的时候都需要验证value的引用而基础类型是验证具体的值</strong>。</p><p>AtomicStampedReference是对 AtomicReference 的升级，它的实现是维护一个volatile 修饰的Pair&lt;V>类型变量，Pair保存有需要维护的对象和一个int类型的标记（就好像版本号），每次更新都是创建一个新的Pair对象，<strong>所有每次修改都要对象和标记同时满足才能成功，</strong>解决 CAS 的 ABA 问题。</p><p>AtomicMarkableReference与AtomicStampedReference类似，只不过Pair类中维护的表示是boolean类型，<strong>可以用于表示该对象已删除等场景</strong>。</p><h1 class=pgc-h-arrow-right>字段更新器</h1><p>有一些对象已经发布出去了无法修改，但是可能一开始的设计并没有考虑线程安全问题，现在再做修改要保证它其中一些属性的线程安全就可以利用字段更新器，主要有三个类AtomicIntegerFieldUpdater、AtomicLongFieldUpdater、AtomicReferenceFieldUpdater，提供的主要功能和AtomicInteger、AtomicLong、AtomicReference一样，<strong>只不过AtomicIntegerFieldUpdater是维护指定对象的指定属性的线程安全，AtomicInteger是维护它自己的value的线程安全的区别</strong>。</p><h1 class=pgc-h-arrow-right>总结</h1><p>原子类提供的功能还是比较简单的，源码也是比较简单的，都是利用Unsafe对一个对象的属性进行线程安全的修改，FieldUpdater系列原子类维护的是指定对象的指定属性，而其他系列原子类维护的是自己的一个属性的线程安全。简单对比如下图：</p><div class=pgc-img><img alt=一文总结Java中原子类相关实现 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2dfc593b3b104a499d6d736518072928><p class=pgc-img-caption></p></div><p><br></p><p>Java程序员日常学习笔记，如理解有误欢迎各位交流讨论！</p><div class=pgc-img><img alt=一文总结Java中原子类相关实现 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/97a42de78ed84c9aafcf3607eee76408><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'总结','Java','类相关'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>