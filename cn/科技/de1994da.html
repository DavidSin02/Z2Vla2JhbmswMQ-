<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>用树莓派构建一台服务器，永久运行网站 | 极客快訊</title><meta property="og:title" content="用树莓派构建一台服务器，永久运行网站 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/58213c92f40941f481e699f3b2420245"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/de1994da.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/de1994da.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/de1994da.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/de1994da.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/de1994da.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/de1994da.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/de1994da.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/de1994da.html><meta property="article:published_time" content="2020-11-14T21:08:28+08:00"><meta property="article:modified_time" content="2020-11-14T21:08:28+08:00"><meta name=Keywords content><meta name=description content="用树莓派构建一台服务器，永久运行网站"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/de1994da.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>用树莓派构建一台服务器，永久运行网站</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><span>本文原载于 SegmentFault 社区</span><br><span>作者：彭小呆</span><span><br></span><hr><p><span><strong>No.1</strong></span></p><p><span><strong>前言</strong></span></p><span><br></span><span>由于本人在这段时候，看到了一个叫做树莓派的东东，初步了解之后觉得很有意思，于是想把整个过程记录下来。</span><span><br></span><p><span><strong>No.2</strong></span></p><p><span><strong>树莓派是什么？</strong></span></p><span>Raspberry Pi</span><span>(中文名为树莓派,简写为 RPi，(或者 RasPi / RPI) 是为学习计算机编程教育而设计)</span><span>，只有信用卡大小的微型电脑，其系统基于 Linux。随着 Windows 10 IoT 的发布，我们也将可以用上运行 Windows 的树莓派。</span><span><br>自问世以来，受众多计算机发烧友和创客的追捧，曾经一“派”难求。别看其外表“娇小”，内“心”却很强大，视频、音频等功能通通皆有，可谓是麻雀虽小，五脏俱全。</span><span><br></span><h2><span><strong><span>1. 用我的话理解</span></strong></span></h2><span><strong><span><br></span></strong></span><span>用我的话理解就是树莓派就是一台主机，你可以外接显示器，键盘鼠标，u盘等等外设，因为它体积很小，而且又有很多串口和外接的口，可以直接调用很多底层硬件。</span><span><br></span><h2><span><strong><span>2. 市面上的型号</span></strong></span></h2><span><strong><span><br></span></strong></span><span>市面上大多是 3 代 B+ 型，淘宝一搜树莓派一大堆都是，价钱纯主板</span><span>（不要任何外设）</span><span>在 230+ 左右，有点小贵，超过我的预算，所以我继续寻找廉价的，终于让我发现了一款 100+ 的树莓派。</span><span><br></span><h2><span><strong><span>3. 树莓派 zero w</span></strong></span></h2><span><strong><span><br></span></strong></span><span>树莓派 zero w 是一款 mini 的树莓派，体质只有 3b+ 的 1/3。实际到手后，你会发现它真的超级小，超级可爱。以下是我的实物图，你可以看看大小到底有多 mini。</span><span><br></span><img alt=用树莓派构建一台服务器，永久运行网站 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/58213c92f40941f481e699f3b2420245><span>你可以看到，最上面是一根普通的黑色签字笔，接下来是一个即插即用型的外接 wifi 网卡，然后是一个 USB 读卡器，最底下的就是我们今天的主角 zero w。它真的超级小，有木有。真的是完美的诠释了那句“麻雀虽小，五脏俱全”的话。</span><span><br></span><span>zero w </span><span>这款树莓派的主要参数如下：</span><span><br></span><span>• BCM2835 处理器，1GHz 主频，512MB RAM</span><span><span>• </span>BCM43438 WiFi / BT 芯片</span><span><span>• </span>micro-USB 电源接口</span><span><span>• </span>micro-USB OTG 接口</span><span><span>• </span>miniHDMI 端口</span><span><span>• </span>复合视频和重置扩展接口</span><span><span>• </span>脆弱的 CSI 摄像头接口</span><span><span>• </span>micro-SD 卡座，存放操作系统</span><span><span>• </span>40-pin GPIO 扩展接口</span><span><span>• </span>尺寸：65mm*30mm</span><span>你别看它的 cpu 只有 1 核，内存只有 512MB，就觉得它可能什么都做不了，但是实际上它的性能还是很好的，用于跑一个网站真的是小 case。</span><h2><br></h2><h2><span><strong><span>4. 更多树莓派</span></strong></span></h2><span><br></span><span>关于更多树莓派型号或者使用教程你可以去树莓派实验室这个网站，上面有丰富的资源。</span><span><br></span><p><span><strong>No.3</strong></span></p><p><span><strong>树莓派zero w安装系统</strong></span></p><h1><span><br></span></h1><h2><span><strong><span>1. 准备</span></strong></span></h2><span><strong><span><br></span></strong></span><span>你可能提前需要准备的东西如下:</span><span><br></span><span><span>• </span>16GB or 32GB 的 SanDisk 内存卡</span><span>（注意是以前那种放在手机上，很小的哦）</span><span><span>• </span>一根最普通不过的 usb 安卓数据线</span><span>（not type-c）</span><span><span>• </span>u 盘格式化工具</span><span>（推荐使用 SDFormatter）</span><span><span>• </span>系统烧写工具</span><span>（Win32DiskImager）</span><span><span>• </span>树莓派系统</span><span>（可以去官网下载）</span><span><br></span><span>我使用的是 Raspbian Stretch Lite 这个系统镜像，这个系统是官方制作的，lite 是无桌面版的，只有黑漆漆的控制台，优点是体积小，省性能和内存。</span><span><br></span><span>名字带有 desktop 的是有桌面 ui 的，对不熟悉 liunx 系统的朋友可能更友好，但是体积很大，占用的性能也会更高。</span><span><br></span><img alt=用树莓派构建一台服务器，永久运行网站 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/65e7205568db49c9894bfe0b2af33142><h2><span><strong><span><br></span></strong></span></h2><h2><span><strong><span>2. 第一步下载系统镜像</span></strong></span></h2><span><br></span><span>下载好你需要的系统镜像后，如下图</span><span><br></span><img alt=用树莓派构建一台服务器，永久运行网站 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/53affe14f6a54dc2a352b685cb392690><span>一开始只有一个 zip 的压缩包，大小大概 360MB 左右，你需要把它解压，得到上图的文件夹。</span><img alt=用树莓派构建一台服务器，永久运行网站 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3941bf6178cd4b089f1b8800bd86f5ec><span><br></span><span>然后进入文件夹可以看到一个 img 的镜像，大小为 1.7GB 左右。</span><span><br></span><span>ps：这个官方的 Raspbian 镜像，如果是其他第三方的镜像，可能下载后的压缩包解压后不是 img 镜像，这种情况请另行百度解决。</span><span><br></span><h2><span><strong><span>3. 使用 Win32DiskImager 往内存卡中写入镜像</span></strong></span></h2><span><strong><span><br></span></strong></span><img alt=用树莓派构建一台服务器，永久运行网站 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/adb1b31ec91141c88f59b6f2dccecb02><span><br></span><span>把内存卡插入读卡器后，插入电脑。<br><br></span><span>打开 Win32DiskImager 软件后，选择 img 镜像，设备选择你的 U 盘，然后点击写入就可以了，写入完成后会弹出成功的提示框。</span><span><br></span><span>ps: 我上图没有选择设备，因为的没插入读卡器，仅仅是示范而已</span><h2><span><br></span></h2><h2><span><strong><span>4. 修改 boot 分区的文件</span></strong></span></h2><span><strong><span><br></span></strong></span><span>先别急着拔出读卡器，此时，我们电脑可以看到 u 盘中只有一个名为 boot 的分区，大小可能只有 40MB 左右，不要着急，因为 window 不识别内存卡中 liunx 系统的其他分区。 </span><span><br></span><h3><span><strong><span>4.1 新建 ssh 文件</span></strong></span></h3><span><br></span><span>因为我们的 zero w 有一个 mini hdmi 的接口，但是我不需要屏幕，所以需要使用 ssh 连接到 zero w 中的系统，所以需要在第一次开机就能</span><span>开启 ssh 功能。</span><span><br></span><span>我们进入 boot 分区内，然后新建一个名为 ssh 的文件，注意不要后缀名！！！！也不要往里面写任何东西！！</span><span><br></span><h3><span><strong><span>4.2 新建 wpa_supplicant.conf 文件</span></strong></span></h3><span><br></span><span>因为 ssh 连接是需要 ip 地址的，所以我们需要将 zero w 在第一次开机自动连接 wifi，使其和我们的电脑处于一个局域网，这样我们才可以通过 ssh 连接到 zero w 的系统。</span><span><br>同样的在 boot 分区内，新建一个名为 wpa_supplicant.conf 的文件，然后往里面写入如下内容后保存：</span><pre class="hljs nix"><code class=conf>country=CN<br>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev<br>update_config=1<br><br>network={<br>ssid="你的wifi名字"<br>psk="你的wifi密码"<br></code><p><code class=conf>}</code></p></pre><h2><br></h2><h2><span><strong><span>5. 组装我们的最小主机并连接</span></strong></span></h2><span><strong><span><br></span></strong></span><span>取出读卡器中的内存卡，然后插入到 zero w 中，使用一根 usb 安卓数据线连接电源</span><span>（5V1A）</span><span>即可。</span><span><br></span><span><br>等待几分钟，期间我们的 zero w 的指示灯会一直闪烁，很正常，等待指示灯常亮的时候，我们去路由器上，查看一下树莓派的 ip 地址。</span><span><br></span><img alt=用树莓派构建一台服务器，永久运行网站 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3312f6330c4043d9bb7ba4ea92e4f6fd><span><br></span><span><br></span><span>可以看到我们 zero w 的 ip 为 192.168.0.104，然后使用 ssh 连接工具</span><span>（推荐使用 putty）</span><span>连接树莓派，初始账户为 pi，密码是 raspberry。</span><span><br></span><img alt=用树莓派构建一台服务器，永久运行网站 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/85185ffa82bb4e3e9f86ac5de10f7811><span><br></span><span>连接成功，如上图所示。这样我们的系统就正确无误的安装好了。</span><span><br></span><span>ps: 如果是手机开启热点当做一个路由器的话，咱们手机下载一个名叫 android terminal 的 app，然后输入 ip neigh 指令，就可以查到连接到手机的设备的 ip 信息了。</span><span><br></span><h2><span><strong><span>6. 优化咱们树莓派的系统</span></strong></span></h2><h3><span><br></span></h3><h3><span><strong><span>6.1 修改源</span></strong></span></h3><strong><span><br></span></strong><span>因为国外的源，咱们在国内的连接过去网速很慢，所以我们需要修改为国内的源，我修改的是中科大的源。</span><span><br></span><h4><strong><span>6.1.1 修改 sources.list 文件</span></strong></h4><strong><span><br></span></strong><pre class="javascript hljs"><code class=javascript>sudo nano /etc/apt/sources.list<br>--注释其他内容，添加以下:<br>deb http:<span class=hljs-comment>//mirrors.ustc.edu.cn/raspbian/raspbian/raspbian stretch main contrib non-free rpi</span></code></pre><h4><strong><span>6.1.2 修改 raspi.list 文件</span></strong></h4><strong><span><br></span></strong><pre class="javascript hljs"><pre class="javascript hljs"><code class=javascript>sudo nano /etc/apt/sources.list.d/raspi.list<br>--注释其他内容，添加以下:<br>deb http:<span class=hljs-comment>//mirrors.ustc.edu.cn/archive.raspberrypi.org/debian stretch main ui</span></code></pre><strong><span>6.1.3 执行更新</span></strong><strong><span><br></span></strong><pre class="javascript hljs"><code class=javascript>sudo apt-get update<br>sudo apt-get upgrade</code></pre></pre><h3><span><strong><span>6.2 修改时区</span></strong></span></h3><span><strong><span><br></span></strong></span><pre class="javascript hljs"><pre class="javascript hljs"><code class=javascript>sudo dpkg-reconfigure tzdata</code></pre></pre><span>找到亚洲 Asia，然后选择 shanghai 就可以了。</span><span><br></span><h3><span><strong><span>6.3 开机自启 ssh</span></strong></span></h3><span><br></span><span>第一种：</span><span><br></span><pre class="javascript hljs"><pre class="javascript hljs"><code class=javascript>sudo raspi-config</code></pre></pre><span>进入选择找到 interfacing option 选择，然后找到 ssh，按回车使能 enable 就可以了。</span><span><br></span><span>第二种：</span><span><br>在终端命令行中启动 SSH 服务后，如果系统重启或关机后启动，SSH 服务默认是关闭的，依然需要手动启动，为了方便可以设置 SSH 服务开机自动启动，打开 /etc/rc.local 文件，在语句 exit 0 之前加入：</span><strong><span>/etc/init.d/ssh start</span></strong><span>建议都试试，反之我的是可以了。</span><h2><span><br></span></h2><h2><span><strong><span>7. 安装 nginx</span></strong></span></h2><pre class="shell hljs vala"><span><br></span><pre class="shell hljs vala"><code class=shell><span class=hljs-meta>#安装</span><br>sudo apt-<span class=hljs-keyword>get</span> install nginx<br><span class=hljs-meta>#启动</span><br>sudo /etc/init.d/nginx start<br><span class=hljs-meta>#重启</span><br>sudo /etc/init.d/nginx restart<br><span class=hljs-meta>#停止</span><br>sudo /etc/init.d/nginx stop</code></pre></pre><span>打开浏览器访问 192.168.0.104</span><span>（你的树莓派 ip 地址）</span><span>，可以看到 nginx 的页面，说明安装好了。</span><span><br>我这边上传了我的博客，如下图</span><span><br></span><img alt=用树莓派构建一台服务器，永久运行网站 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/0dc2706a806444c795a0ab2e2c2e8306><span><br></span><span>可以正常的看到页面了，但是这样只能在内网</span><span>（局域网中）</span><span>看到，我想让所有人都可以访问怎么办？</span><span><br></span><h2><span><strong><span>8. 内网穿透</span></strong></span></h2><span><strong><span><br></span></strong></span><span>内网穿透，意思就是将内网</span><span>（本地）</span><span>的 web 应用通过 nat 穿透到公网上，从而让别人可以访问到。</span><span><br></span><span>内网穿透目前主要由 ngrok 和 frp 两种，都非常好用，国内 ngrok 免费的有 ittun、sunny 和 natapp，这三个都是免费的，前面两个可以自定义域名，后面的需要 vip 版本才可以自定义域名。</span><span><br></span><span>我这三种都试过，我发现 sunny 的 arm 版本的 ngrok 客户端在我的树莓派运行不了，ittun 的和 natpp 的 ngrok 都可以，由于需要自定义域名，我使用的是 ittun 的 ngrok_arm 版本的。</span><span><br></span><span>使用方法这三者官网都有详细说明，大家自行查看。</span><span><br></span><span>这是正常运行时的截图，访问 http://zerow.ittun.com/ 时可以...</span><span><br></span><img alt=用树莓派构建一台服务器，永久运行网站 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/73095064d27a4114af61f4b2cf4834fe><img alt=用树莓派构建一台服务器，永久运行网站 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/cacf1881eb88427c9d69affe2b6d842b><span>因为需要 ngrok 在后台运行，所以我用的是 screen 会话使其可以在后台运行。但是开启自启，还没有实现，万一断电或者断网了，我必须手动去运行一下 ngrok，这是目前没有解决的痛点。</span><span><br></span><h2><strong><span>9. 更多</span></strong></h2><strong><span><br></span></strong><span>树莓派不仅仅只是可以用于运行一个网站，还有很多很多的功能等待你的开发，可以多去看看树莓派实验室里面，很多大神都写了很多实用的教程。</span><span><br></span><span>我的 zero w 状态信息如下：</span><span><br></span><img alt=用树莓派构建一台服务器，永久运行网站 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/946a6f9552e64520a4f2785799251677><span>在上面开启了一个 nginx 和 ngrok 服务，内存剩余还有 250MB，还是很舒服的，cpu 温度也不算高，运行两天了，基本在 37-39 之间。</span><span><br></span><img alt=用树莓派构建一台服务器，永久运行网站 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6f71e18666504a66b66ab9a933d261ad></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'用树莓','派构','建一'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>