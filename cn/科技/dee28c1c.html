<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>网站接入QQ登录功能 | 极客快訊</title><meta property="og:title" content="网站接入QQ登录功能 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dee28c1c.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dee28c1c.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/dee28c1c.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dee28c1c.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dee28c1c.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/dee28c1c.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/dee28c1c.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dee28c1c.html><meta property="article:published_time" content="2020-11-14T21:00:29+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:29+08:00"><meta name=Keywords content><meta name=description content="网站接入QQ登录功能"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/dee28c1c.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>网站接入QQ登录功能</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>原文链接：网站接入QQ登录功能</p><p>说明</p><ol><li>本文中所说的QQ登录功能，是采用官方的OAuth2.0来实现的，这样有更多的自主权。另一种较为简单的JS-SDK开发方式，虽然非常简便，但自主性不够，所以没有采用。</li><li>下文中所构造的URL，均使用了JavaScript的ES6语法。</li></ol><p>注册开发者</p><p>先登录QQ互联官网，登录时所用的QQ号会和相关信息绑定，这一点要注意。</p><p>登录之后点击顶部导航栏右侧自己的QQ头像，进入开发者的注册/认证界面。</p><p>这里可以选择以“公司”或“个人”的身份注册为开发者。自己最开始用的是公司的相关资料来注册的，但总是提示审核失败，却又不说为什么失败，最后干脆用个人信息注册，很快就成功了。</p><p>PS：不知道用个人信息注册为开发者的话，权限方面会不会有什么限制。微信公众平台对个人开发者是有限制的，个人身份注册的公众号无法认证，公众平台的部分权限也无法调用。</p><p>创建网站应用</p><p>要想让网站能够使用QQ登录功能，就必须先在QQ互联中创建<strong>网站应用</strong>。</p><p>在<strong>QQ互联</strong>网站顶部导航栏上，点击<strong>应用管理</strong>。点击页面中的<strong>网站应用</strong>这个标签，再点击<strong>创建应用</strong>，按照要求填写相关的信息即可。</p><p>注意这里需要填写两个 URL，一个是<strong>网站地址</strong>，也就是需要让用户能够通过QQ登录的网站。另一个是<strong>网站回调域</strong>，则是用户发起QQ登录请求之后，负责与腾讯服务器通讯，实现QQ登录功能的URL，这两个URL要注意区分。</p><p>所创建的网站应用审核通过之后，点击<strong>查看</strong>按钮，在网站应用的详情界面，能看到为这个网站分配的<strong>APP ID</strong>和<strong>APP Key</strong>，后面实现QQ登录功能的时候要用到。</p><p>另外，还能看到审核通过的网站应用，有两个可用的应用接口，第一个<strong>登录</strong>默认是开启的，第二个<strong>unionid</strong>需要手动开启，这里先把它开启了，后面说不定就用上了。</p><p>流程概述</p><p>接下来就需要编写代码，实现QQ登录功能了。这里先简要说明一下整体流程：</p><ol><li>按照要求访问指定网址，会显示QQ登录界面，选择QQ账号进行登录之后，会向之前所填写的 <strong>网站回调域</strong> 发起回调，回调URL中包含<strong>Authorization Code（授权码）</strong>。</li><li><strong>网站回调域</strong> 用这个<strong>Authorization Code（授权码）</strong>，结合其它数据，向指定的地址发送请求，接收到的响应中包含<strong>Access Token（访问令牌）</strong>。</li><li><strong>网站回调域</strong> 再用<strong>Access Token（访问令牌）</strong> 向指定的地址发送请求，接收到的响应中包含所登录QQ账号的 <strong>OpenID</strong>（不涉及用户隐私）。</li><li><strong>网站回调域</strong> 拿到用户的<strong>OpenID</strong>之后，结合前面获取到的<strong>Access Token</strong>以及其它数据，就可以调用QQ的接口，实现特定的功能了。比如可以调用<strong>get_user_info</strong>接口，获取登录用户的暱称、头像、性别，用来显示在前端页面中。</li></ol><p>一、获取Authorization Code</p><p>在自己编写的登录页面，点击QQ图标之后，请求下面的地址：</p><pre>https://graph.qq.com/oauth2.0/authorize?response_type=code&amp;client_id=${appId}&amp;redirect_uri=${redirectUrl}&amp;state=${state}&amp;scope=${scope}</pre><p>上面的地址中，appId为网站应用的APP ID，redirectUrl为网站应用的网站回调域，state为用户自定义的字符串，scope为向用户所请求的授权列表。</p><p>scope之外的参数均为必填项，scope如果不写，则默认只请求对接口get_user_info进行授权，获取用户最基本的几项信息：QQ暱称、QQ头像、性别。</p><p>发起请求之后，会将用户导向到QQ官方的登录页面，用户在这个页面上选择需要登录的QQ号，点击“登录”，<strong>网站回调域</strong>就会收到的腾讯服务器所发起的回调。</p><p>比如之前所填写的 <strong>网站回调域</strong> 为 a.com/api/getauthcode 的话，腾讯服务器就会向 <strong>网站回调域</strong> 发送如下请求：</p><pre>GET /getauthcode?code=F91C6110********</pre><p>在上面接收到的这个请求中，URL查询字符串里，code= 后面的字符串，就是腾讯服务器发来的Authorization Code。</p><p>二、获取Access Token</p><p>拿到Authorization Code，结合其它数据，请求如下地址：</p><pre>https://graph.qq.com/oauth2.0/token?grant_type=authorization_code&amp;client_id=${appId}&amp;client_secret=${appKey}&amp;code=${authCode}&amp;state=${state}&amp;redirect_uri=${redirectUrl}</pre><p><strong>网站回调域</strong> 会收到如下响应：</p><pre>access_token=FF3A****&amp;expires_in=7776000&amp;refresh_token=2516****</pre><p>其中就包含了Access Token，并且这个Access Token有90天的有效期，但并不会按照官方文档所说的，<strong>用户再次登录时自动刷新</strong>，而是短时间（一天内）连续多次登录都不会刷新。</p><p>对于这个Access Token，官网建议开发者将其进行保存，以便后续调用OpenAPI访问和修改用户信息时使用。</p><p>三、获取OpenID</p><p>有了Access Token之后，就可以用它来获取当前所登录QQ账号的OpenID了。请求如下地址：</p><pre>https://graph.qq.com/oauth2.0/me?access_token=${accessToken}</pre><p><strong>网站回调域</strong> 会收到如下响应：</p><pre>callback( {"client_id":"appId","openid":"openId"} );</pre><p>上面的响应中包含了 APP ID 和 OpenID，APP ID 可用来确认是否为合法的网站请求，OpenID 自然就是所登录QQ账号的 OpenID 了。</p><p>四、调用接口访问数据</p><p>有了第二步获取到的获取Access Token，和第三步获取到的OpenID，就可以拿来访问QQ的接口，获取用户的相关信息了。</p><p>比如以下面的方式请求 get_user_info 接口，就能够获取到用户暱称、QQ头像等信息。</p><pre>https://graph.qq.com/user/get_user_info?access_token=${accessToken}&amp;oauth_consumer_key=${appId}&amp;openid=${openId}</pre></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'网站','QQ','登录'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>