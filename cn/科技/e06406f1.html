<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Windows Server 2008 R2 主域控制器、文件服务器迁移、升级记 | 极客快訊</title><meta property="og:title" content="Windows Server 2008 R2 主域控制器、文件服务器迁移、升级记 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/bd7b5492449f49c69fa520a38a0665bc"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e06406f1.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e06406f1.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e06406f1.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e06406f1.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e06406f1.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e06406f1.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e06406f1.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e06406f1.html><meta property="article:published_time" content="2020-11-14T21:02:56+08:00"><meta property="article:modified_time" content="2020-11-14T21:02:56+08:00"><meta name=Keywords content><meta name=description content="Windows Server 2008 R2 主域控制器、文件服务器迁移、升级记"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/e06406f1.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Windows Server 2008 R2 主域控制器、文件服务器迁移、升级记</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>最近几天没发文章，因为有一客户，6年前买的戴尔R720服务器，最近频发蓝屏、死机，每次只能硬重启，有时候还不一定能顺利启动进入系统，几经讨论后，决定购买一台新的戴尔R740XD服务器来替换，旧服务器待检修后再另作他用。</p><p>实施计划 Plan A：新服务器安装vmware esxi，然后利用vmware converter，将旧服务器的Windows Server 2008 R2 直接转换成虚拟硬盘，然后导入vmware，至于文件嘛，再慢慢往新服务器拷。</p><p>1、新的戴尔R740XD服务器货到之后，立刻下载VMware-VMvisor-Installer-6.7.0.update03，并且完成安装，这个就不多说了，前面文章就有。</p><p>2、旧服务器上安装VMware-converter-en-6.2.0，然后开始转换，注意，只能选择C盘，即转换系统盘就可以了，数据盘有8T，没必要转换，也没条件转换；操作过程略，可以参考本人于2019年9月18日发表的文章；</p><p>3、转换了两小时，终于完成了，生成两个文件：一个是vmx文件，3KB；另一个是vmdk，20G；</p><p>4、登录vmware esxi，创建虚拟机，选择刚才转换而来的两个文件；</p><div class=pgc-img><img alt="Windows Server 2008 R2 主域控制器、文件服务器迁移、升级记" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bd7b5492449f49c69fa520a38a0665bc><p class=pgc-img-caption></p></div><p>5、提示导入文件失败，只支持OVF和vmdk导入，不能支持vmx和vmdk的导入！好吧，还得转一次，我的笔记本电脑里面有安装好的VMware Workstation，里面有个OVFTool能转成OVF格式，但是如果用的我笔记本电脑来转换，我得先下载这个20G的文件，转换完成后，还得上传到ESXI，我可等不了那么长时间，于是把OVFTool复制到旧服务器，准备直接转换，结果提示有一堆文件未注册，好吧，上传VMware Workstation，再安装一遍，这些文件就应该被自动注册了吧？嘿嘿，说干就干，可是，安装到90%的时候，系统提示发生未知错误，安装进度条开始回滚，灵光一闪，立刻使用任务管理器，强制结束回滚退出安装程序，我又不需要完全安装VMware Workstation，只要某些文件被注册了就行啊，哈哈，不得不为自己点个赞！果然，OVFTool 能用了，开始转换vmdk，生成名为disk1.vmdk文件，等等啊，一个小时，进度条走了一点点， 算了，时间不早了，先下班吧。。。</p><p>6、等等，还不能下班，万一转换不成功，还是得另想办法啊，Plan B 立刻出现在脑海里：新建虚拟机安装Windwos Server 2019，配置成第二台域控，然后再把旧服务器的共享文件夹拷过来，重新配置共享和网络驱动器。说干就干，新建虚拟机、装系统、安装Active Directory 域服务、将此服务器提升为域控制器（注意：此处必须选择 “将域控制器添加现有域”，然后输入域名，以及域管理员的帐户和密码），这一步，可以参考本人2019年10月7日发表的文章；</p><p>7、干等着没什么意义，先下班回家。。。</p><p>8、晚饭时间看了看，文件转换完成，得到三个文件：.mf文件、.ovf文件、.vmdk文件，可是这个vmdk文件占用空间竟然小了一半！什么情况？ 不管它，开始用它来创建虚拟机，实际上就是物理机导入虚拟机的过程。。。</p><p>9、晚上休息之前，看了一眼，还是没完成。。。</p><p>10、凌晨一点，上厕所的时候看了一眼笔记本，导入还是没完成！我汗。。。</p><p>11、辗转难眠，凌晨三点，再起来看笔记本——为了客户真是呕心沥血啊——提示导入完成，BUT ！虚拟机在哪里？怎么凭空消失了？没有任何错误报告！看日志，只有一条消息： 虚拟机files已被移除！什么意思，导入成功完成，然后又被自动移除了！ 都没让我看一眼啊，凭什么？！</p><p>12、算了算了，半夜三更，天气冷飕飕，脑子也是一团浆糊的状态，无法多作思考。。。罢了罢了，不要旧系统了，反正第二台Windwos Server 2019域控已经起来了；</p><p>13、新的戴尔R740XD服务器上面，有两个RAID5阵列，第一个是3块512G固态硬盘组成的，主要用于安装操作系统；第二个是由6块4T的SAS硬盘组成的，主要用于存储，遂将这块实际可用容量18T的硬盘挂载给了Windwos Server 2019，并且开始从旧服务器复制文件，鉴于旧服务器经常蓝屏死机，决定采用fastcopy来复制数据，理由是，复制过程中出现任何错误，只要重新开始复制，软件会快速地自动跳过已经复制的文件，此时凌晨3点半！</p><p>14、文章起草到这个时间节点（晚上21:05），已经接近42小时了，却只复制了3.2T数据，中间蓝屏一次，死机一次，中断时间大概就40分钟左右，我汗，总共将近9T的数据要复制，要多长时间才能完成啊？！清香三柱上给旧服务器，求您别再蓝屏、死机了！</p><div class=pgc-img><img alt="Windows Server 2008 R2 主域控制器、文件服务器迁移、升级记" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4c18dd33afcf4abd9d0e1b3d3edf00fb><p class=pgc-img-caption></p></div><p>IT 外包服务，我真的是认真的！ 写文章，我也是很认真的，都是自己的实际经验！</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Windows','Server','2008'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>