<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ã€ŒåŸåˆ›ã€Javaå¹¶å‘ç¼–ç¨‹ç³»åˆ—36 | FutureTask | æå®¢å¿«è¨Š</title><meta property="og:title" content="ã€ŒåŸåˆ›ã€Javaå¹¶å‘ç¼–ç¨‹ç³»åˆ—36 | FutureTask - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/SAZA4S9I6wzJm7"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e0ee178.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e0ee178.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e0ee178.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e0ee178.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e0ee178.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e0ee178.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e0ee178.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e0ee178.html><meta property="article:published_time" content="2020-10-29T20:59:17+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:17+08:00"><meta name=Keywords content><meta name=description content="ã€ŒåŸåˆ›ã€Javaå¹¶å‘ç¼–ç¨‹ç³»åˆ—36 | FutureTask"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/e0ee178.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ã€ŒåŸåˆ›ã€Javaå¹¶å‘ç¼–ç¨‹ç³»åˆ—36 | FutureTask</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p><strong>â˜…â˜…â˜…</strong><strong class=highlight-text toutiao-origin=span>å»ºè®®</strong><strong>æ˜Ÿæ ‡</strong><strong class=highlight-text toutiao-origin=span>æˆ‘ä»¬</strong><strong>â˜…â˜…â˜…</strong></p><p><strong>Javaè¿›é˜¶æ¶æ„å¸ˆ</strong><strong>â˜…</strong>â€œ<strong>æ˜Ÿæ ‡</strong>â€ï¼è¿™æ ·æ‰ä¸ä¼šé”™è¿‡æ¯æ—¥è¿›é˜¶æ¶æ„æ–‡ç« å‘€ã€‚</p><img alt="ã€ŒåŸåˆ›ã€Javaå¹¶å‘ç¼–ç¨‹ç³»åˆ—36 | FutureTask" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/SAZA4S9I6wzJm7><img alt="ã€ŒåŸåˆ›ã€Javaå¹¶å‘ç¼–ç¨‹ç³»åˆ—36 | FutureTask" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/Ryxcguy98OEq9e><p><strong>2020å¹´JavaåŸåˆ›é¢è¯•é¢˜åº“è¿è½½ä¸­</strong></p><p>ã€000æœŸã€‘Javaæœ€å…¨é¢è¯•é¢˜åº“æ€ç»´å¯¼å›¾</p><p>ã€001æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆä¸€ï¼‰ï¼šé¢å‘å¯¹è±¡</p><p>ã€002æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆäºŒï¼‰ï¼šåŸºæœ¬æ•°æ®ç±»å‹ä¸è®¿é—®ä¿®é¥°ç¬¦</p><p>ã€003æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆä¸‰ï¼‰ï¼šJavaSEè¯­æ³•ï¼ˆ1ï¼‰</p><p>ã€004æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆå››ï¼‰ï¼šJavaSEè¯­æ³•ï¼ˆ3ï¼‰</p><p>ã€005æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆäº”ï¼‰ï¼šStringç±»</p><p>ã€006æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆå…­ï¼‰ï¼šæ³›å‹</p><p>ã€007æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆä¸ƒï¼‰ï¼šå¼‚å¸¸</p><p>ã€008æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆå…«ï¼‰ï¼šé›†åˆä¹‹List</p><p>ã€009æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆä¹ï¼‰ï¼šé›†åˆä¹‹Set</p><p>ã€010æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆåï¼‰ï¼šé›†åˆä¹‹Map</p><p>ã€011æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆåä¸€ï¼‰ï¼šå¤šçº¿ç¨‹ï¼ˆ1ï¼‰</p><p>ã€012æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆåäºŒï¼‰ï¼šå¤šçº¿ç¨‹ï¼ˆ2ï¼‰</p><p>ã€013æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆåä¸‰ï¼‰ï¼šå¤šçº¿ç¨‹ï¼ˆ3ï¼‰</p><p>ã€014æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆåå››ï¼‰ï¼šåŸºæœ¬IOæµ</p><p>ã€015æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆåäº”ï¼‰ï¼šç½‘ç»œIOæµ</p><p>ã€016æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆåå…­ï¼‰ï¼šåå°„</p><p>ã€017æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆåä¸ƒï¼‰ï¼šJVMä¹‹å†…å­˜æ¨¡å‹</p><p>ã€018æœŸã€‘JavaSEé¢è¯•é¢˜ï¼ˆåå…«ï¼‰ï¼šJVMä¹‹åƒåœ¾å›æ”¶</p><p>ã€020æœŸã€‘JavaSEç³»åˆ—é¢è¯•é¢˜æ±‡æ€»ï¼ˆå…±18ç¯‡ï¼‰</p><p>ã€019æœŸã€‘JavaWebé¢è¯•é¢˜ï¼ˆä¸€ï¼‰ï¼šJDBC</p><p>ã€021æœŸã€‘JavaWebé¢è¯•é¢˜ï¼ˆäºŒï¼‰ï¼šHTTPåè®®</p><p>ã€022æœŸã€‘JavaWebé¢è¯•é¢˜ï¼ˆä¸‰ï¼‰ï¼šCookieå’ŒSession</p><p>ã€023æœŸã€‘JavaWebé¢è¯•é¢˜ï¼ˆå››ï¼‰ï¼šJSP</p><p>ã€024æœŸã€‘JavaWebé¢è¯•é¢˜ï¼ˆäº”ï¼‰ï¼šFilterå’ŒListener</p><p>ã€025æœŸã€‘Javaå·¥å…·é¢è¯•é¢˜ï¼ˆä¸€ï¼‰ï¼šç‰ˆæœ¬æ§åˆ¶å·¥å…·</p><p>ã€026æœŸã€‘Javaå·¥å…·é¢è¯•é¢˜ï¼ˆäºŒï¼‰ï¼šé¡¹ç›®ç®¡ç†å·¥å…·</p><p>ã€027æœŸã€‘Javaè®¾è®¡æ¨¡å¼é¢è¯•é¢˜</p><p>ã€028æœŸã€‘JavaWebç³»åˆ—é¢è¯•é¢˜æ±‡æ€»ï¼ˆå…±10ç¯‡ï¼‰</p><p>ã€029æœŸã€‘JavaEEé¢è¯•é¢˜ï¼ˆä¸€ï¼‰Webåº”ç”¨æœåŠ¡å™¨</p><p>ã€030æœŸã€‘JavaEEé¢è¯•é¢˜ï¼ˆäºŒï¼‰SpringMVC</p><p>ã€031æœŸã€‘JavaEEé¢è¯•é¢˜ï¼ˆä¸‰ï¼‰Springï¼ˆ1ï¼‰</p><p>ã€032æœŸã€‘JavaEEé¢è¯•é¢˜ï¼ˆå››ï¼‰Springï¼ˆ2ï¼‰</p><p>ã€033æœŸã€‘JaveEEé¢è¯•é¢˜ï¼ˆäº”ï¼‰MyBatis</p><p>ã€034æœŸã€‘JavaEEé¢è¯•é¢˜ï¼ˆå…­ï¼‰Hibernate</p><p>ã€035æœŸã€‘JavaEEé¢è¯•é¢˜ï¼ˆä¸ƒï¼‰SpringBootï¼ˆ1ï¼‰</p><p>æ›´å¤šå†…å®¹ï¼Œç‚¹å‡»ä¸Šé¢è“å­—æŸ¥çœ‹</p><img alt="ã€ŒåŸåˆ›ã€Javaå¹¶å‘ç¼–ç¨‹ç³»åˆ—36 | FutureTask" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/Ryxcguy98OEq9e><img alt="ã€ŒåŸåˆ›ã€Javaå¹¶å‘ç¼–ç¨‹ç³»åˆ—36 | FutureTask" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RyGixJJ21nOJYN><p>çº¿ç¨‹æ± æºç ä¸­å‡ºç°äº†å¾ˆå¤šCallableã€Futureã€FutureTaskç­‰ä»¥å‰æ²¡ä»‹ç»è¿‡çš„æ¥å£ï¼Œå°¤å…¶æ˜¯çº¿ç¨‹æ± æäº¤ä»»åŠ¡æ—¶æ€»æ˜¯æŠŠä»»åŠ¡å°è£…æˆFutureTaskï¼Œä»Šå¤©å°±æ¥ä¸ºå¤§å®¶è§£æƒ‘ï¼š</p><ol><li><p>Runnableã€Callableã€Futureã€FutureTask</p></li><li><p>FutureTaskç±»ç»“æ„</p></li><li><p>FutureTaskçŠ¶æ€</p></li><li><p>æ‰§è¡Œä»»åŠ¡ runæ–¹æ³•</p></li><li><p>è·å–ä»»åŠ¡è¿”å›å€¼ getæ–¹æ³•</p></li><li><p>å–æ¶ˆä»»åŠ¡ cancelæ–¹æ³•</p></li></ol><p><strong toutiao-origin=span>1. Runnableã€Callableã€Futureã€FutureTask</strong></p><p></p><h2 toutiao-origin=h3><strong toutiao-origin=h2>1.1 Runnable</strong></h2><p>Runnableæ¥å£åªæœ‰ä¸€ä¸ªrunæ–¹æ³•ï¼Œè€Œrunæ–¹æ³•çš„è¿”å›å€¼æ˜¯voidï¼Œæ‰€ä»¥çº¿ç¨‹æ‰§è¡Œå®Œä¹‹åæ²¡æœ‰è¿”å›å€¼ã€‚</p><pre><code>public interface Runnable {<br>public abstract void run;<br>}<br></code></pre><p></p><h2 toutiao-origin=h3><strong toutiao-origin=h2>1.2 Callable</strong></h2><p>åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡çº¿ç¨‹æ¥å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ä¹‹åï¼Œå¸Œæœ›è·å–åˆ°ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚æ¯”å¦‚RPCæ¡†æ¶ä¸­ï¼Œéœ€è¦å¼‚æ­¥è·å–ä»»åŠ¡è¿”å›å€¼ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒRunnableæ— æ³•è·å–è¿”å›å€¼å°±æ— æ³•æ»¡è¶³éœ€æ±‚äº†ï¼Œå› æ­¤Callableå°±å‡ºç°äº†ã€‚</p><p>Callableä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¹Ÿåªæœ‰ä¸€ä¸ªcallæ–¹æ³•ï¼Œä¸åŒçš„æ˜¯Callableçš„callæ–¹æ³•æœ‰æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œè¿”å›å€¼çš„ç±»å‹æ˜¯ä¸€ä¸ªæ³›å‹ï¼Œæ³›å‹ç”±åˆ›å»ºCallableå¯¹è±¡æ—¶æŒ‡å®šã€‚</p><pre><code>public interface Callable&lt;V&gt; {<br>V call throws Exception;<br>}<br></code></pre><p></p><h2 toutiao-origin=h3><strong toutiao-origin=h2>1.3 Future</strong></h2><p>è¦æƒ³è·å¾—Callableçš„è¿”å›å€¼å°±éœ€è¦ç”¨åˆ°Futureæ¥å£ã€‚Futrueå¯ä»¥ç›‘è§†å’Œæ§åˆ¶Callableä»»åŠ¡çš„æ‰§è¡Œæƒ…å†µï¼Œå¦‚å¯¹æ‰§è¡Œç»“æœè¿›è¡Œå–æ¶ˆã€æŸ¥è¯¢æ˜¯å¦å®Œæˆã€è·å–ç»“æœç­‰ã€‚</p><p>å¦‚ï¼šå½“ä¸€ä¸ªä»»åŠ¡é€šè¿‡çº¿ç¨‹æ± çš„submitæ–¹æ³•æäº¤åˆ°çº¿ç¨‹æ± åï¼Œçº¿ç¨‹æ± ä¼šè¿”å›ä¸€ä¸ªFutureç±»å‹çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Futureå¯¹è±¡æ¥è·å–ä»»åŠ¡åœ¨çº¿ç¨‹æ± ä¸­çš„çŠ¶æ€ã€‚</p><pre><code>public interface Future&lt;V&gt; {<br>boolean cancel(boolean mayInterruptIfRunning);<br>boolean isCancelled;<br>boolean isDone;<br>V get throws InterruptedException, ExecutionException;<br>V get(long timeout, TimeUnit unit)<br>throws InterruptedException, ExecutionException, TimeoutException;<br>}<br></code></pre><ul><li><div><p>cancelæ–¹æ³•ï¼šç”¨æ¥å–æ¶ˆä»»åŠ¡ï¼Œå¦‚æœå–æ¶ˆä»»åŠ¡æˆåŠŸåˆ™è¿”å›trueï¼Œå¦‚æœå–æ¶ˆä»»åŠ¡å¤±è´¥åˆ™è¿”å›falseã€‚</p><p>mayInterruptIfRunningå‚æ•°ç”¨æ¥è¡¨ç¤ºæ˜¯å¦éœ€è¦ä¸­æ–­çº¿ç¨‹ï¼Œå¦‚æœä¼ trueï¼Œè¡¨ç¤ºéœ€è¦ä¸­æ–­çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ä¼šå°†ä»»åŠ¡çš„çŠ¶æ€è®¾ç½®ä¸ºINTERRUPTINGï¼›å¦‚æœä¸ºfalseï¼Œé‚£ä¹ˆå°±ä¼šå°†ä»»åŠ¡çš„çŠ¶æ€è®¾ç½®ä¸ºCANCELLEDï¼ˆå…³äºä»»åŠ¡çš„çŠ¶æ€INTERRUPTINGå’ŒCANCELLEDåé¢ä¼šè¯´æ˜ï¼‰</p></div></li><li><p>isCancelledæ–¹æ³•ï¼šè¡¨ç¤ºä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆæˆåŠŸï¼Œå¦‚æœåœ¨ä»»åŠ¡æ­£å¸¸å®Œæˆå‰è¢«å–æ¶ˆæˆåŠŸï¼Œåˆ™è¿”å› true</p></li><li><p>isDoneæ–¹æ³•ï¼šè¡¨ç¤ºä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆï¼Œè‹¥ä»»åŠ¡å®Œæˆï¼Œåˆ™è¿”å›true</p></li><li><p>getæ–¹æ³•ï¼šç”¨æ¥è·å–æ‰§è¡Œç»“æœï¼Œè¿™ä¸ªæ–¹æ³•ä¼šäº§ç”Ÿé˜»å¡ï¼Œä¼šä¸€ç›´ç­‰åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ‰è¿”å›ã€‚</p></li><li><p>get(long timeout, TimeUnit unit)æ–¹æ³•ï¼šè·å–æ‰§è¡Œç»“æœï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œè¿˜æ²¡è·å–åˆ°ç»“æœï¼Œå°±ç›´æ¥è¿”å›ã€‚</p></li></ul><p>ä¸¾ä¾‹ï¼šFutureè·å–Callableä»»åŠ¡çš„è¿”å›å€¼</p><pre><code>public class FutureExample {<br>public static void main(String[] args) throws InterruptedException, ExecutionException {<br>ExecutorService threadPool = Executors.newCachedThreadPool;<br>Future&lt;String&gt; future = threadPool.submit(new Callable&lt;String&gt; {<br>@Override<br>public String call throws Exception {<br>Thread.sleep(2000);<br>return "ç»“æœ";<br>}<br>});<br>System.out.println("Callableè¿”å›å€¼=" + future.get);<br>}<br>}<br></code></pre><p>è¾“å‡ºç»“æœï¼š</p><pre><code>Callableè¿”å›å€¼=ç»“æœ<br></code></pre><p></p><h2 toutiao-origin=h3><strong toutiao-origin=h2>1.4 FutureTask</strong></h2><p>FutureTaskæ˜¯Runnableå’ŒFutureçš„å®ç°ç±»ï¼Œæ—¢å¯ä»¥ä½œä¸ºRunnableè¢«çº¿ç¨‹æ‰§è¡Œï¼Œåˆå¯ä»¥ä½œä¸ºFutureå¾—åˆ°Callableçš„è¿”å›å€¼ã€‚</p><img alt="ã€ŒåŸåˆ›ã€Javaå¹¶å‘ç¼–ç¨‹ç³»åˆ—36 | FutureTask" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/SAZA4Tj8Flk2sq><p>å½“çº¿ç¨‹æ± è°ƒç”¨submitæ–¹æ³•æ¥å‘çº¿ç¨‹æ± ä¸­æäº¤ä»»åŠ¡æ—¶ï¼Œæ— è®ºæäº¤çš„æ˜¯Runnableç±»å‹çš„ä»»åŠ¡ï¼Œè¿˜æ˜¯æäº¤çš„æ˜¯Callableç±»å‹çš„ä»»åŠ¡ï¼Œæœ€ç»ˆéƒ½æ˜¯å°†ä»»åŠ¡å°è£…æˆä¸€ä¸ªFutureTaskå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªFutureTaskå¯¹è±¡æ¥è·å–ä»»åŠ¡åœ¨çº¿ç¨‹æ± ä¸­çš„çŠ¶æ€ã€‚</p><pre><code> public &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task) {<br>if (task == ) throw new PointerException;<br>// è°ƒç”¨newTaskForå°†Callableä»»åŠ¡å°è£…æˆä¸€ä¸ªFutureTask<br>RunnableFuture&lt;T&gt; ftask = newTaskFor(task);<br>// æ‰§è¡Œä»»åŠ¡<br>execute(ftask);<br>return ftask;<br>}<br><br>// newTaskFor<br>protected &lt;T&gt; RunnableFuture&lt;T&gt; newTaskFor(Callable&lt;T&gt; callable) {<br>// ç›´æ¥newä¸€ä¸ªFutureTaskå¯¹è±¡<br>return new FutureTask&lt;T&gt;(callable);<br>}<br></code></pre><p></p><h2 toutiao-origin=h2>2. FutureTaskç±»ç»“æ„</h2><pre><code>public class FutureTask&lt;V&gt; implements RunnableFuture&lt;V&gt; {<br>/** stateå˜é‡ç”¨æ¥ä¿å­˜ä»»åŠ¡çš„çŠ¶æ€ */<br>private volatile int state;<br>private static final int NEW = 0;<br>private static final int COMPLETING = 1;<br>private static final int NORMAL = 2;<br>private static final int EXCEPTIONAL = 3;<br>private static final int CANCELLED = 4;<br>private static final int INTERRUPTING = 5;<br>private static final int INTERRUPTED = 6;<br><br>/** æäº¤çš„ä»»åŠ¡ï¼ŒRunnableç±»å‹çš„ä»»åŠ¡ä¼šé€šè¿‡Executors.callableæ¥è½¬å˜ä¸ºCallable */<br>private Callable&lt;V&gt; callable;<br>/** ç”¨æ¥ä¿å­˜Callableçš„callæ–¹æ³•çš„è¿”å›å€¼ */<br>private Object outcome;<br>/** æ‰§è¡ŒCallableä»»åŠ¡çš„çº¿ç¨‹ **/<br>private volatile Thread runner;<br>/**<br>* ä»»åŠ¡æœªå®Œæˆæ—¶ï¼Œè°ƒç”¨getæ–¹æ³•è·å–ç»“æœçš„çº¿ç¨‹ä¼šé˜»å¡ç­‰å¾…<br>* waitersç”¨äºä¿å­˜è¿™äº›çº¿ç¨‹<br>*/<br>private volatile WaitNode waiters;<br><br>static final class WaitNode {<br>volatile Thread thread;<br>volatile WaitNode next;<br>WaitNode { thread = Thread.currentThread; }<br>}<br>}<br></code></pre><p></p><h2 toutiao-origin=h2>3. FutureTaskçŠ¶æ€</h2><p>FutureTaskä»»åŠ¡çš„çŠ¶æ€å¦‚ä¸‹ï¼š</p><pre><code> // ä»»åŠ¡çš„åˆå§‹çŠ¶æ€ï¼Œå½“æ–°å»ºä¸€ä¸ªFutureTaskä»»åŠ¡æ—¶ï¼Œstateå€¼é»˜è®¤ä¸ºNEW<br>private static final int NEW = 0;<br>// ä»»åŠ¡å¤„äºå®Œæˆä¸­ï¼Œä¹Ÿå°±æ˜¯æ­£åœ¨æ‰§è¡Œè¿˜æœªè®¾ç½®è¿”å›å€¼<br>private static final int COMPLETING = 1;<br>// ä»»åŠ¡æ­£å¸¸è¢«æ‰§è¡Œå®Œæˆï¼Œå¹¶å°†ä»»åŠ¡çš„è¿”å›å€¼èµ‹å€¼ç»™outcomeå±æ€§ä¹‹å<br>private static final int NORMAL = 2;<br>// ä»»åŠ¡å‡ºäº†å¼‚å¸¸ï¼Œå¹¶å°†å¼‚å¸¸å¯¹è±¡èµ‹å€¼ç»™outcomeå±æ€§ä¹‹å<br>private static final int EXCEPTIONAL = 3;<br>// è°ƒç”¨cancle(false)ï¼Œä»»åŠ¡è¢«å–æ¶ˆäº†<br>private static final int CANCELLED = 4;<br>// è°ƒç”¨cancle(true)ï¼Œä»»åŠ¡ä¸­æ–­ï¼Œä½†æ˜¯åœ¨çº¿ç¨‹ä¸­æ–­ä¹‹å‰<br>private static final int INTERRUPTING = 5;<br>// è°ƒç”¨cancle(true)ï¼Œä»»åŠ¡ä¸­æ–­ï¼Œä½†æ˜¯åœ¨çº¿ç¨‹ä¸­æ–­ä¹‹å<br>private static final int INTERRUPTED = 6;<br></code></pre><p>çŠ¶æ€å˜åŒ–å¦‚ä¸‹å›¾ï¼š</p><img alt="ã€ŒåŸåˆ›ã€Javaå¹¶å‘ç¼–ç¨‹ç³»åˆ—36 | FutureTask" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/SAZA7SU938gfW8><p></p><h2 toutiao-origin=h2>4. æ‰§è¡Œä»»åŠ¡run</h2><ol><li><p>æ‰§è¡Œfuture.callable.callï¼Œæ‰§è¡Œä»»åŠ¡ï¼›</p></li><li><p>æ‰§è¡ŒæˆåŠŸï¼Œè®¾ç½®ç»“æœoutcomeï¼›</p></li><li><p>é€ä¸ªå”¤é†’waitersä¸­çš„çº¿ç¨‹å»è·å–æ‰§è¡Œç»“æœã€‚</p></li></ol><pre><code>public void run {<br>/*<br>* 1. ä¸æ˜¯NEWçŠ¶æ€ï¼Œä¸èƒ½æ‰§è¡Œ<br>* 2. è®¾ç½®runnerå¤±è´¥ï¼Œä¸èƒ½æ‰§è¡Œ<br>*/<br>if (state != NEW ||<br>!UNSAFE.compareAndSwapObject(this, runnerOffset,<br>, Thread.currentThread))<br>return;<br>try {<br>Callable&lt;V&gt; c = callable;<br>if (c != &amp;&amp; state == NEW) {<br>V result;<br>boolean ran;<br>try {<br>result = c.call;// çœŸæ­£æ‰§è¡Œä»»åŠ¡<br>ran = true;// æ‰§è¡ŒæˆåŠŸï¼Œè®¾ç½®æ‰§è¡ŒæˆåŠŸæ ‡å¿—<br>} catch (Throwable ex) {<br>result = ;<br>ran = false;// æœ‰å¼‚å¸¸ï¼Œæ‰§è¡Œå¤±è´¥<br>setException(ex);// è®¾ç½®å¼‚å¸¸<br>}<br>// å¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œåˆ™è®¾ç½®è¿”å›ç»“æœ<br>if (ran)<br>set(result);<br>}<br>} finally {<br>runner = ;// æ— è®ºæ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼ŒæŠŠrunnerè®¾ç½®ä¸º<br>int s = state;<br>// å¤„ç†ä¸­æ–­<br>if (s &gt;= INTERRUPTING)<br>handlePossibleCancellationInterrupt(s);<br>}<br>}<br><br>/**<br>* è®¾ç½®æ‰§è¡Œç»“æœ<br>*/<br>protected void set(V v) {<br>if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {// æ‰§è¡Œå®Œæˆï¼Œè®¾ç½®COMPLETINGçŠ¶æ€<br>outcome = v;// è®¾ç½®æ‰§è¡Œç»“æœ<br>UNSAFE.putOrderedInt(this, stateOffset, NORMAL); // è®¾ç½®å®Œç»“æœï¼Œè®¾ç½®NORMALçŠ¶æ€<br>finishCompletion;// é€ä¸ªå”¤é†’waitersä¸­çš„çº¿ç¨‹å»è·å–æ‰§è¡Œç»“æœ<br>}<br>}<br></code></pre><p></p><h2 toutiao-origin=h2>5. è·å–ä»»åŠ¡è¿”å›å€¼getæ–¹æ³•</h2><ol><li><p>ä»»åŠ¡çŠ¶æ€ä¸ºNORMALï¼Œç›´æ¥è¿”å›æ‰§è¡Œç»“æœï¼›</p></li><li><p>ä»»åŠ¡çŠ¶æ€ä¸ºCOMPLETINGï¼Œçº¿ç¨‹yieldè®©å‡ºCPUï¼Œå› ä¸ºCOMPLETINGåˆ°NORMALåªéœ€è¦å¾ˆçŸ­çš„æ—¶é—´ï¼Œgetçº¿ç¨‹è®©å‡ºCPUçš„çŸ­æš‚æ—¶é—´ï¼Œä»»åŠ¡çŠ¶æ€å°±æ˜¯ä»COMPLETINGå˜æˆäº†NORMALï¼›</p></li><li><p>ä»»åŠ¡çŠ¶æ€ä¸ºNEWï¼Œå°†getçº¿ç¨‹é˜»å¡ï¼Œå¦‚æœè®¾ç½®äº†è¶…æ—¶ï¼Œé˜»å¡è‡³è¶…æ—¶æ—¶é—´ï¼›å¦‚æœæ²¡æœ‰è®¾ç½®è¶…æ—¶ï¼Œä¼šä¸€ç›´é˜»å¡ç›´åˆ°ä»»åŠ¡å®Œæˆåå”¤é†’ã€‚</p></li></ol><pre><code>public V get throws InterruptedException, ExecutionException {<br>int s = state;<br>// å¦‚æœçŠ¶æ€å¤„äºNEWæˆ–è€…COMPLETINGçŠ¶æ€ï¼Œè¡¨ç¤ºä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆï¼ŒawaitDoneç­‰å¾…<br>if (s &lt;= COMPLETING)<br>s = awaitDone(false, 0L);// ä¸‹æ–‡è¯¦è§£<br>// è¿”å›ç»“æœï¼Œä¸‹æ–‡è¯¦è§£<br>return report(s);<br>}<br><br>/**<br>* è¿”å›æ‰§è¡Œç»“æœ<br>*/<br>private V report(int s) throws ExecutionException {<br>Object x = outcome;<br>// ä»»åŠ¡æ­£å¸¸ç»“æŸæ—¶ï¼Œè¿”å›outcome<br>if (s == NORMAL)<br>return (V)x;<br>// ä»»åŠ¡è¢«å–æ¶ˆäº†ï¼ŒæŠ›å‡ºCancellationException<br>if (s &gt;= CANCELLED)<br>throw new CancellationException;<br>// è¿™é‡Œåªèƒ½ç¬¬EXCEPTIONALçŠ¶æ€ï¼Œè¡¨ç¤ºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ï¼ŒæŠ›å‡ºExecutionExceptionã€‚<br>throw new ExecutionException((Throwable)x);<br>}<br><br>/**<br>* å¤„äºNEWæˆ–è€…COMPLETINGçŠ¶æ€æ—¶ï¼Œgetçº¿ç¨‹ç­‰å¾…<br>*/<br>private int awaitDone(boolean timed, long nanos)<br>throws InterruptedException {<br>// ......<br>for (;;) {<br>// ......<br>// ä»»åŠ¡å¤„äºCOMPLETINGä¸­ï¼Œå°±è®©å½“å‰çº¿ç¨‹å…ˆæš‚æ—¶æ”¾å¼ƒCPUçš„æ‰§è¡Œæƒ<br>else if (s == COMPLETING) // cannot time out yet<br>Thread.yield;<br>// ......<br>// å¦‚æœè®¾ç½®äº†è¶…æ—¶ï¼Œé˜»å¡è‡³è¶…æ—¶æ—¶é—´<br>else if (timed) {<br>nanos = deadline - System.nanoTime;<br>if (nanos &lt;= 0L) {<br>removeWaiter(q);<br>return state;<br>}<br>// ç­‰å¾…ä¸€æ®µæ—¶é—´<br>LockSupport.parkNanos(this, nanos);<br>}<br>else<br>// å¦‚æœæ²¡æœ‰è®¾ç½®è¶…æ—¶ï¼Œä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°è¢«ä¸­æ–­æˆ–è€…è¢«å”¤é†’<br>LockSupport.park(this);<br>}<br>}<br></code></pre><p></p><h2 toutiao-origin=h2>6. å–æ¶ˆä»»åŠ¡ cancel</h2><p>å°†ä»»åŠ¡çŠ¶æ€è®¾ç½®æˆINTERRUPTING/INTERRUPTED/CANCELLEDçŠ¶æ€å°±è¡¨ç¤ºå–æ¶ˆäº†çº¿ç¨‹ï¼Œå› ä¸ºåœ¨è¿™äº›çŠ¶æ€ä¸‹ä»»åŠ¡çš„runæ–¹æ³•æ˜¯ä¸èƒ½æ‰§è¡Œçš„ã€‚</p><pre><code>public boolean cancel(boolean mayInterruptIfRunning) {<br>/*<br>* ä»¥ä¸‹æƒ…å†µä¸èƒ½å–æ¶ˆä»»åŠ¡ï¼š<br>* 1. å½“å‰ä»»åŠ¡ä¸æ˜¯NEWçŠ¶æ€ï¼Œå·²ç»è¢«æ‰§è¡Œäº†ï¼Œä¸èƒ½å–æ¶ˆ<br>* 2. å½“å‰ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œstate == NEWï¼Œä½†æ˜¯CASè®¾ç½®çŠ¶æ€å¤±è´¥ï¼Œä¸èƒ½å–æ¶ˆ<br>*/<br>if (!(state == NEW &amp;&amp;<br>UNSAFE.compareAndSwapInt(this, stateOffset, NEW,<br>mayInterruptIfRunning ? INTERRUPTING : CANCELLED)))<br>return false;<br>try { // in case call to interrupt throws exception<br>// ä¸­æ–­<br>if (mayInterruptIfRunning) {<br>try {<br>Thread t = runner;<br>if (t != )<br>t.interrupt;// ä¸­æ–­çº¿ç¨‹<br>} finally { // final state<br>// ä¸­æ–­ä¹‹åï¼Œè®¾ç½®INTERRUPTEDçŠ¶æ€<br>UNSAFE.putOrderedInt(this, stateOffset, INTERRUPTED);<br>}<br>}<br>} finally {<br>finishCompletion;// å”¤é†’waitersä¸­çš„çº¿ç¨‹å»è·å–æ‰§è¡Œç»“æœ<br>}<br>return true;<br>}<br></code></pre><p></p><h2 toutiao-origin=h2>å¹¶å‘ç³»åˆ—æ–‡ç« æ±‡æ€»</h2><p>ã€åŸåˆ›ã€‘01|å¼€ç¯‡è·å¥–æ„Ÿè¨€</p><p>ã€åŸåˆ›ã€‘02|å¹¶å‘ç¼–ç¨‹ä¸‰å¤§æ ¸å¿ƒé—®é¢˜</p><p>ã€åŸåˆ›ã€‘03|é‡æ’åº-å¯è§æ€§å’Œæœ‰åºæ€§é—®é¢˜æ ¹æº</p><p>ã€åŸåˆ›ã€‘04|Java å†…å­˜æ¨¡å‹è¯¦è§£</p><p>ã€åŸåˆ›ã€‘05|æ·±å…¥ç†è§£ volatile</p><p>ã€åŸåˆ›ã€‘06|ä½ ä¸çŸ¥é“çš„ final</p><p>ã€åŸåˆ›ã€‘07|synchronized åŸç†</p><p>ã€åŸåˆ›ã€‘08|synchronized é”ä¼˜åŒ–</p><p>ã€åŸåˆ›ã€‘09|åŸºç¡€å¹²è´§</p><p>ã€åŸåˆ›ã€‘10|çº¿ç¨‹çŠ¶æ€</p><p>ã€åŸåˆ›ã€‘11|çº¿ç¨‹è°ƒåº¦</p><p>ã€åŸåˆ›ã€‘12|æ­ç§˜ CAS</p><p>ã€åŸåˆ›ã€‘13|LockSupport</p><p>ã€åŸåˆ›ã€‘14|AQS æºç åˆ†æ</p><p>ã€åŸåˆ›ã€‘15|é‡å…¥é” ReentrantLock</p><p>ã€åŸåˆ›ã€‘16|å…¬å¹³é”ä¸éå…¬å¹³é”</p><p>ã€åŸåˆ›ã€‘17|è¯»å†™é”å…«è®²ï¼ˆä¸Šï¼‰</p><p>ã€åŸåˆ›ã€‘18|è¯»å†™é”å…«è®²ï¼ˆä¸‹ï¼‰</p><p>ã€åŸåˆ›ã€‘19|JDK8æ–°å¢é”StampedLock</p><p>ã€åŸåˆ›ã€‘20|StampedLockæºç è§£æ</p><p>ã€åŸåˆ›ã€‘21|Condition-Lockçš„ç­‰å¾…é€šçŸ¥</p><p>ã€åŸåˆ›ã€‘22|å€’è®¡æ—¶å™¨CountDownLatch</p><p>ã€åŸåˆ›ã€‘22|å€’è®¡æ—¶å™¨CountDownLatch</p><p>ã€åŸåˆ›ã€‘23|å¾ªç¯å±éšœCyclicBarrier</p><p>ã€åŸåˆ›ã€‘24|ä¿¡å·é‡Semaphore</p><p>ã€åŸåˆ›ã€‘25|äº¤æ¢å™¨Exchangere</p><p>ã€åŸåˆ›ã€‘26|ConcurrentHashMapï¼ˆä¸Šï¼‰</p><p>ã€åŸåˆ›ã€‘27|ConcurrentHashMapï¼ˆä¸‹ï¼‰</p><p>ã€åŸåˆ›ã€‘28|Copy-On-Writeå®¹å™¨</p><p>ã€åŸåˆ›ã€‘29|ConcurrentLinkedQueue</p><p>ã€åŸåˆ›ã€‘30 | ThreadLocal</p><p>ã€åŸåˆ›ã€‘31 | é˜»å¡é˜Ÿåˆ—ï¼ˆä¸Šï¼‰</p><p>ã€åŸåˆ›ã€‘32 | é˜»å¡é˜Ÿåˆ—ï¼ˆä¸‹ï¼‰</p><p>ã€åŸåˆ›ã€‘33 | æ·±å…¥ç†è§£çº¿ç¨‹æ± ï¼ˆä¸Šï¼‰</p><p>ã€åŸåˆ›ã€‘34 | æ·±å…¥ç†è§£çº¿ç¨‹æ± ï¼ˆä¸‹ï¼‰</p><img alt="ã€ŒåŸåˆ›ã€Javaå¹¶å‘ç¼–ç¨‹ç³»åˆ—36 | FutureTask" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/R6Aez96HF10BZ3><pre><div><p><strong class=highlight-text toutiao-origin=span>ä¹‹å‰ï¼Œç»™å¤§å®¶å‘è¿‡</strong><strong class=highlight-text toutiao-origin=strong>ä¸‰ä»½Java</strong><strong class=highlight-text toutiao-origin=span>é¢è¯•å®å…¸ï¼Œè¿™æ¬¡æ–°å¢äº†ä¸€ä»½ï¼Œç›®å‰æ€»å…±æ˜¯</strong><strong class=highlight-text toutiao-origin=strong>å››ä»½</strong><strong class=highlight-text toutiao-origin=span>é¢è¯•å®å…¸ï¼Œç›¸ä¿¡åœ¨è·³æ§½å‰ä¸€ä¸ªæœˆæŒ‰ç…§é¢è¯•å®å…¸å‡†å¤‡å‡†å¤‡ï¼ŒåŸºæœ¬æ²¡å¤§é—®é¢˜ã€‚</strong></p><ul><li><p><strong class=highlight-text toutiao-origin=strong>ã€Šjavaé¢è¯•å®å…¸5.0ã€‹</strong><strong class=highlight-text toutiao-origin=span>(åˆä¸­çº§)</strong></p></li><li><p><strong class=highlight-text toutiao-origin=strong>ã€Š350é“Javaé¢è¯•é¢˜ï¼šæ•´ç†è‡ª100+å…¬å¸ã€‹</strong><strong class=highlight-text toutiao-origin=span>ï¼ˆä¸­é«˜çº§ï¼‰</strong></p></li><li><p><strong class=highlight-text toutiao-origin=strong>ã€Šèµ„æ·±javaé¢è¯•å®å…¸-è§†é¢‘ç‰ˆã€‹</strong><strong class=highlight-text toutiao-origin=span>ï¼ˆèµ„æ·±ï¼‰</strong></p></li><li><p><strong class=highlight-text toutiao-origin=strong>ã€ŠJava[BAT]é¢è¯•å¿…å¤‡ã€‹</strong><strong class=highlight-text toutiao-origin=span>ï¼ˆèµ„æ·±ï¼‰</strong></p></li></ul><p><strong class=highlight-text toutiao-origin=span>åˆ†åˆ«é€‚ç”¨äº</strong><strong class=highlight-text toutiao-origin=span>åˆä¸­çº§ï¼Œä¸­é«˜çº§</strong><strong class=highlight-text toutiao-origin=span>ï¼Œ</strong><strong class=highlight-text toutiao-origin=span>èµ„æ·±</strong><strong class=highlight-text toutiao-origin=span>çº§å·¥ç¨‹å¸ˆ</strong><strong class=highlight-text toutiao-origin=span>çš„é¢è¯•å¤ä¹ ã€‚</strong></p><p><strong class=highlight-text toutiao-origin=span>å†…å®¹åŒ…å«</strong><strong class=highlight-text toutiao-origin=span>javaåŸºç¡€ã€javawebã€mysqlæ€§èƒ½ä¼˜åŒ–ã€JVMã€é”ã€ç™¾ä¸‡å¹¶å‘ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé«˜æ€§èƒ½ç¼“å­˜ã€åå°„ã€Springå…¨å®¶æ¡¶åŸç†ã€å¾®æœåŠ¡ã€Zookeeperã€æ•°æ®ç»“æ„ã€é™æµç†”æ–­é™çº§ç­‰ç­‰ã€‚</strong></p><div><div><div><div><div><div><div><img alt="ã€ŒåŸåˆ›ã€Javaå¹¶å‘ç¼–ç¨‹ç³»åˆ—36 | FutureTask" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RFppAnaHsaFKbv></div><div><p><strong class=highlight-text toutiao-origin=span>çœ‹åˆ°è¿™é‡Œï¼Œè¯æ˜æœ‰æ‰€æ”¶è·</strong></p></div></div></div></div></div></div></div></div></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'åŸåˆ›','Java','å‘ç¼–ç¨‹'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>