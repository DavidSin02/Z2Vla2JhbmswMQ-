<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Web技术整体架构 | 极客快訊</title><meta property="og:title" content="Web技术整体架构 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/15314704812092ac6479d59"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e0f9daff.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e0f9daff.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e0f9daff.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e0f9daff.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e0f9daff.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e0f9daff.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e0f9daff.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e0f9daff.html><meta property="article:published_time" content="2020-11-14T21:06:32+08:00"><meta property="article:modified_time" content="2020-11-14T21:06:32+08:00"><meta name=Keywords content><meta name=description content="Web技术整体架构"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/e0f9daff.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Web技术整体架构</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>题记</p><p>工作也有几多年了，无论是身边遇到的还是耳间闻到的，多多少少也积攒了自己的一些经验和思考，当然，博主并没有太多接触高大上的分布式架构实践，相对比较零碎，随时补充(附带架构装逼词汇)。</p><p>俗话说的好，冰冻三尺非一日之寒，滴水穿石非一日之功，罗马也不是一天就建成的，当然对于我们开发人员来说，一个好的架构也不是一蹴而就的。</p><p>初始搭建</p><p><strong>前言</strong></p><p>工作也有几多年了，无论是身边遇到的还是耳间闻到的，多多少少也积攒了自己的一些经验和思考，当然，博主并没有太多接触高大上的分布式架构实践，相对比较零碎，随时补充。俗话说得好，冰冻三尺非一日之寒，滴水穿石非一日之功，罗马也不是一天就建成的，当然对于我们开发人员来说，一个好的架构也不是一蹴而就的。</p><p><strong>初始搭建</strong></p><p>开始的开始，就是各种框架一搭，然后扔到Tomcat容器中跑就是了，这时候我们的文件、数据库、应用都在一个服务器上。</p><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15314704812092ac6479d59><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15314704811294c444d66e1><p class=pgc-img-caption></p></div><p><strong>服务分离</strong></p><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1531470481206d943ebcf97><p class=pgc-img-caption></p></div><p>随着系统的的上线，用户量也会逐步上升，很明显一台服务器已经满足不了系统的负载，这时我们就要在服务器还没有超载时，提前做好准备。</p><p>由于我们是单体架构，优化架构在短时间内是不现实的，增加机器是一个不错的选择。这时，我们可能要把应用和数据库服务单独部署，如果有条件也可以把文件服务器单独部署。</p><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15314704811820aa61dbe0e><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15314704811294c444d66e1><p class=pgc-img-caption></p></div><p><strong>反向代理</strong></p><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1531470481206d943ebcf97><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1531470481206be2895f3f9><p class=pgc-img-caption></p></div><p>为了提升服务处理能力，我们在Tomcat容器前加一个代理服务器，我一般使用Nginx，当然你如果更熟悉Apache也未尝不可。</p><p>用户的请求发送给反向代理，然后反向代理把请求转发到后端的服务器。</p><p>严格意义上来说，Nginx是属于Web服务器，一般处理静态HTML、CSS、JS请求，而Tomcat属于Web容器，专门处理JSP请求，当然Tomcat也是支持html的，只是效果没Nginx好而已。</p><p>反向代理的优势，如下：</p><ul><li>隐藏真实后端服务</li><li>负载均衡集群</li><li>高可用集群</li><li>缓存静态内容实现动静分离</li><li>安全限流</li><li>静态文件压缩</li><li>解决多个服务跨域问题</li><li>合并静态请求(HTTP/2.0后已经被弱化)</li><li>防火墙</li><li>SSL以及http2</li></ul><p><strong>动静分离</strong></p><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15314704812012f7e2520dc><p class=pgc-img-caption></p></div><p>基于以上Nginx反向代理，我们还可以实现动静分离，静态请求如HTML、CSS、JS等请求交给Nginx处理，动态请求分发给后端Tomcat处理。</p><p>Nginx 升级到1.9.5+可以开启HTTP/2.0时代，加速网站访问。</p><p>当然，如果公司不差钱，CDN也是一个不错的选择。</p><p><strong>服务拆分</strong></p><p>在这分布式微服务已经普遍流行的年代，其实我们没必要踩过多的坑，就很容易进行拆分。市面上已经有相对比较成熟的技术，比如阿里开源的Dubbo(官方明确表示已经开始维护了)，Spring家族的Spring Cloud，当然具体如何去实施，无论是技术还是业务方面都要有很好的把控。</p><p><strong>Dubbo</strong></p><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/153147048145553acabdf5a><p class=pgc-img-caption></p></div><p><strong>SpringCloud</strong></p><ul><li>服务发现——Netflix Eureka</li><li>客服端负载均衡——Netflix Ribbon</li><li>断路器——Netflix Hystrix</li><li>服务网关——Netflix Zuul</li><li>分布式配置——Spring Cloud Config</li></ul><p><strong>微服务与轻量级通信</strong></p><ul><li>同步通信和异步通信</li><li>远程调用RPC</li><li>REST</li><li>消息队列</li></ul><p><strong>持续集成部署</strong></p><p>服务拆分以后，随着而来的就是持续集成部署，你可能会用到以下工具：Docker、Jenkins、Git、Maven。</p><p>图片源于网络，基本拓扑结构如下所示：</p><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15314704814263354d2c123><p class=pgc-img-caption></p></div><p>整个持续集成平台架构演进到如下图所示：</p><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15314704813759775b494df><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15314704811294c444d66e1><p class=pgc-img-caption></p></div><p><strong>服务集群</strong></p><p>Linux集群主要分成三大类( 高可用集群， 负载均衡集群，科学计算集群)。其实，我们最常见的也是生产中最常接触到的就是负载均衡集群。</p><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1531470481457df4f734a22><p class=pgc-img-caption></p></div><p><strong>负载均衡实现</strong></p><ul><li>DNS负载均衡，一般域名注册商的dns服务器不支持，但博主用的阿里云解析已经支持</li><li>四层负载均衡(F5、LVS)，工作在TCP协议下</li><li>七层负载均衡(Nginx、haproxy)，工作在Http协议下</li></ul><p><strong>分布式session</strong></p><p>大家都知道，服务一般分为有状态和无状态，而分布式sessoion就是针对有状态的服务。</p><p><strong>分布式Session的几种实现方式</strong></p><ul><li>基于数据库的Session共享</li><li>基于resin/tomcat web容器本身的session复制机制</li><li>基于oscache/Redis/memcached 进行 session 共享。</li><li>基于cookie 进行session共享</li></ul><p><strong>分布式Session的几种管理方式</strong></p><p><strong>Session Replication 方式管理 (即session复制)</strong></p><ul><li>简介：将一台机器上的Session数据广播复制到集群中其余机器上</li><li>使用场景：机器较少，网络流量较小</li><li>优点：实现简单、配置较少、当网络中有机器Down掉时不影响用户访问</li><li>缺点：广播式复制到其余机器有一定廷时，带来一定网络开销</li></ul><p><strong>Session Sticky 方式管理</strong></p><ul><li>简介：即粘性Session、当用户访问集群中某台机器后，强制指定后续所有请求均落到此机器上</li><li>使用场景：机器数适中、对稳定性要求不是非常苛刻</li><li>优点：实现简单、配置方便、没有额外网络开销</li><li>缺点：网络中有机器Down掉时、用户Session会丢失、容易造成单点故障</li></ul><p><strong>缓存集中式管理</strong></p><ul><li>简介：将Session存入分布式缓存集群中的某台机器上，当用户访问不同节点时先从缓存中拿Session信息</li><li>使用场景：集群中机器数多、网络环境复杂</li><li>优点：可靠性好</li><li>缺点：实现复杂、稳定性依赖于缓存的稳定性、Session信息放入缓存时要有合理的策略写入</li></ul><p><strong>目前生产中使用到的</strong></p><ul><li>基于tomcat配置实现的MemCache缓存管理session实现(麻烦)</li><li>基于OsCache和shiro组播的方式实现(网络影响)</li><li>基于spring-session+redis实现的(最适合)</li></ul><p><strong>负载均衡策略</strong></p><p>负载均衡策略的优劣及其实现的难易程度有两个关键因素：负载均衡算法，对网络系统状况的检测方式和能力。</p><p>1、rr 轮询调度算法。顾名思义，轮询分发请求。</p><p>优点：实现简单</p><p>缺点：不考虑每台服务器的处理能力</p><p>2、wrr 加权调度算法。我们给每个服务器设置权值weight，负载均衡调度器根据权值调度服务器，服务器被调用的次数跟权值成正比。</p><p>优点：考虑了服务器处理能力的不同</p><p>3、sh 原地址散列：提取用户IP，根据散列函数得出一个key，再根据静态映射表，查处对应的value，即目标服务器IP。过目标机器超负荷，则返回空。</p><p>4、dh 目标地址散列：同上，只是现在提取的是目标地址的IP来做哈希。</p><p>优点：以上两种算法的都能实现同一个用户访问同一个服务器。</p><p>5、lc 最少连接。优先把请求转发给连接数少的服务器。</p><p>优点：使得集群中各个服务器的负载更加均匀。</p><p>6、wlc 加权最少连接。在lc的基础上，为每台服务器加上权值。算法为：(活动连接数*256+非活动连接数)÷权重 ，计算出来的值小的服务器优先被选择。</p><p>优点：可以根据服务器的能力分配请求。</p><p>7、sed 最短期望延迟。其实sed跟wlc类似，区别是不考虑非活动连接数。算法为：(活动连接数+1)*256÷权重，同样计算出来的值小的服务器优先被选择。</p><p>8、nq 永不排队。改进的sed算法。我们想一下什么情况下才能“永不排队”，那就是服务器的连接数为0的时候，那么假如有服务器连接数为0，均衡器直接把请求转发给它，无需经过sed的计算。</p><p>9、LBLC 基于局部性的最少连接。均衡器根据请求的目的IP地址，找出该IP地址最近被使用的服务器，把请求转发之，若该服务器超载，最采用最少连接数算法。</p><p>10、LBLCR 带复制的基于局部性的最少连接。均衡器根据请求的目的IP地址，找出该IP地址最近使用的“服务器组”，注意，并不是具体某个服务器，然后采用最少连接数从该组中挑出具体的某台服务器出来，把请求转发之。若该服务器超载，那么根据最少连接数算法，在集群的非本服务器组的服务器中，找出一台服务器出来，加入本服务器组，然后把请求转发之。</p><p><strong>读写分离</strong></p><p>MySQL主从配置，读写分离并引入中间件，开源的MyCat，阿里的DRDS都是不错的选择。</p><p>如果是对高可用要求比较高，但是又没有相应的技术保障，建议使用阿里云的RDS或者Redis相关数据库，省事省力又省钱。</p><p><strong>全文检索</strong></p><p>如果有搜索业务需求，引入solr或者elasticsearch也是一个不错的选择，不要什么都塞进关系型数据库。</p><p><strong>缓存优化</strong></p><p>引入缓存无非是为了减轻后端数据库服务的压力，防止其"罢工"。</p><p>常见的缓存服务有，Ehcache、OsCache、MemCache、Redis，当然这些都是主流经得起考验的缓存技术实现，特别是Redis已大规模运用于分布式集群服务中，并证明了自己优越的性能。</p><p><strong>消息队列</strong></p><p>异步通知：比如短信验证，邮件验证这些非实时反馈性的逻辑操作。</p><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1531470481384267575c625><p class=pgc-img-caption></p></div><p>流量削锋：应该是消息队列中的常用场景，一般在秒杀或团抢活动中使用广泛。</p><p>日志处理：系统中日志是必不可少的，但是如何去处理高并发下的日志确是一个技术活，一不小心可能会压垮整个服务。工作中我们常用到的开源日志ELK，为嘛中间会加一个Kafka或者redis就是这么一个道理(一群人涌入和排队进的区别)。</p><p>消息通讯：点对点通信(个人对个人)或发布订阅模式(聊天室)。</p><p><strong>日志服务</strong></p><p>消息队列中提到的ELK开源日志组间对于中小型创业供公司是一个不错的选择。</p><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1531470481452c816692a4f><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=Web技术整体架构 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15314704811294c444d66e1><p class=pgc-img-caption></p></div><p><strong>安全优化</strong></p><p>以上种种，没有安全做保证可能都会归于零。</p><ul><li>阿里云的VPN虚拟专有网络以及安全组配置</li><li>自建机房的话，要自行配置防火墙安全策略</li><li>相关服务访问，比如MySQL、Redis、Solr等如果没有特殊需求尽量使用内网访问并设置鉴权</li><li>尽量使用代理服务器，不要对外开放过多的端口</li><li>https配合HTTP/2.0也是个不错的选择</li></ul><p>架构装逼必备词汇</p><p>高可用</p><ul><li>负载均衡（负载均衡算法）</li><li>反向代理</li><li>服务隔离</li><li>服务限流</li><li>服务降级（自动优雅降级）</li><li>失效转移</li><li>超时重试（代理超时、容器超时、前端超时、中间件超时、数据库超时、NoSql超时）</li><li>回滚机制（上线回滚、数据库版本回滚、事务回滚）</li></ul><p>高并发</p><ul><li>应用缓存</li><li>HTTP缓存</li><li>多级缓存</li><li>分布式缓存</li><li>连接池</li><li>异步并发</li></ul><p>分布式事务</p><ul><li>二阶段提交(强一致)</li><li>三阶段提交(强一致)</li><li>消息中间件(最终一致性)，推荐阿里的RocketMQ</li></ul><p>队列</p><ul><li>任务队列</li><li>消息队列</li><li>请求队列</li></ul><p>扩容</p><ul><li>单体垂直扩容</li><li>单体水平扩容</li><li>应用拆分</li><li>数据库拆分</li><li>数据库分库分表</li><li>数据异构</li><li>分布式任务</li></ul><p>网络安全</p><ul><li>SQL注入</li><li>XSS攻击</li><li>CSRF攻击</li><li>拒绝服务（DoS，Denial　of　Service）攻击</li></ul><p>架构装逼必备工具</p><p>操作系统</p><p>Linux（必备）、某软的</p><p>负载均衡</p><p>DNS、F5、LVS、Nginx、OpenResty、HAproxy、负载均衡SLB（阿里云）</p><p>分布式框架</p><p>Dubbo、Motan、Spring-Could</p><p>数据库中间件</p><p>DRDS （阿里云）、Mycat、360 Atlas、Cobar (不维护了)</p><p>消息队列</p><p>RabbitMQ、ZeroMQ、Redis、ActiveMQ、Kafka</p><p>注册中心</p><p>Zookeeper、Redis</p><p>缓存</p><p>Redis、Oscache、Memcache、Ehcache</p><p>集成部署</p><p>Docker、Jenkins、Git、Maven</p><p>存储</p><p>OSS、NFS、FastDFS、MogileFS</p><p>数据库</p><p>MySql、Redis、MongoDB、PostgreSQL、Memcache、HBase</p><p>网络</p><p>专用网络VPC、弹性公网IP、CDN</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Web','技术','整体'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>