<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>视频监控系统的摄像头掉线看交换机连接注意事项 | 极客快訊</title><meta property="og:title" content="视频监控系统的摄像头掉线看交换机连接注意事项 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/6f6fd3e897194a39968316956ab6a5c4"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e495a4ae.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e495a4ae.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e495a4ae.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e495a4ae.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e495a4ae.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e495a4ae.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e495a4ae.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e495a4ae.html><meta property="article:published_time" content="2020-11-14T21:02:11+08:00"><meta property="article:modified_time" content="2020-11-14T21:02:11+08:00"><meta name=Keywords content><meta name=description content="视频监控系统的摄像头掉线看交换机连接注意事项"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/e495a4ae.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>视频监控系统的摄像头掉线看交换机连接注意事项</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><span style="color:#595959;--tt-darkmode-color: #595959">某智创园做了一个监控工程，使用64台200万的IPC以及两台64路NVR，出现多个通道频繁掉线、黑屏。经初步判断，我们怀疑是网络传输存在问题，决定前往现场排查和解决问题，确保工程交付。</span></p><div class=pgc-img><img alt=视频监控系统的摄像头掉线看交换机连接注意事项 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/6f6fd3e897194a39968316956ab6a5c4><p class=pgc-img-caption></p></div><p style=text-align:justify><strong><span style="color:#595959;--tt-darkmode-color: #595959"><span style="background-color:#fbef2e;--tt-darkmode-bgcolor: #D8CE28">问题现象</span></span></strong></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">到达现场后，我们先确认问题现象：</span></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">1、NVR上多画面预览不定时出现十几个画面同时出现“资源不足”或“视频信号丢失”的提示，将出现问题的画面放大为单画面时加载较慢。</span></p><p><span style="color:#595959;--tt-darkmode-color: #595959">2、查看各通道的录像，发现回放进度条断断续续，录像存在丢失的情况。</span></p><p><strong><span style="color:#595959;--tt-darkmode-color: #595959"><span style="background-color:#fbef2e;--tt-darkmode-bgcolor: #D8CE28">问题排查</span></span></strong></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">从以往的监控现场处理经验入手，掉线问题极有可能发生在三个地方：</span><strong><span style="color:#595959;--tt-darkmode-color: #595959">网线、交换机、监控流量拥塞</span></strong><span style="color:#595959;--tt-darkmode-color: #595959">。</span></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">首先需要确认线路延</span>时和丢包情况，我们尝试从NVR端开始排查，使用NVR的诊断工具ping其中一个掉线的摄像头IP地址，50个大包进行长ping，发现网络平均延迟达到几百ms，且出现丢包的情况。诊断的结果验证了我们初步的判断：这个监控工程的网络设计一定有问题，那问题的瓶颈到底出在哪里呢？</p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">为了找到网络传输的瓶颈，我们决定先梳理网络拓扑，最终确认整个网络的拓扑如下：</span></p><div class=pgc-img><img alt=视频监控系统的摄像头掉线看交换机连接注意事项 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b6e3b827ae4f424ea7cb9328fbd929ec><p class=pgc-img-caption></p></div><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">注：摄像头的主码流的码率为2Mbps，子码流码率为0.5Mbps。</span></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">从以上拓扑图中我们可以看到，核心交换机使用的千兆上联交换机，只有2个千兆接口，图中标注的1、2两个节点连接到核心交换机的百兆接口，明显存在传输瓶颈。</span></p><p style=text-align:justify><strong><span style="color:#595959;--tt-darkmode-color: #595959"><span style="background-color:#ffa900;--tt-darkmode-bgcolor: #FFA900">【节点1】</span></span></strong></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">1#NVR添加了64个IPC，64个IPC的视频数据都要通过这个节点传输，总流量大小为：</span></p><p><strong><span style="color:#595959;--tt-darkmode-color: #595959">（主+子）*IPC数量 =（2+0.5）*64=160Mbps>100Mbps</span></strong></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">很明显无法满足传输需求，存在传输瓶颈。</span></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959"><br></span><strong><span style="color:#595959;--tt-darkmode-color: #595959"><span style="background-color:#ffa900;--tt-darkmode-bgcolor: #FFA900">【节点2】</span></span></strong></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">该汇聚交换机虽然是千兆上联交换机，但因为连接到核心交换机的百兆接口，</span><strong><span style="color:#ffa900;--tt-darkmode-color: #ED9D00">所以也只能工作在100Mbps</span></strong><span style="color:#595959;--tt-darkmode-color: #595959">；</span></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">a. 该汇聚交换机下一共接入了26个IPC（包括下方交换机接入的IPC），即其上联口需要传输26个IPC的视频数据：（2+0.5）*26=65Mbps；</span></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">b. 每个IPC被两台NVR同时添加，即每个IPC需要同时提供两路主码流+两路子码流，该节点需传输的视频数据加倍：65*2=130Mbps>100Mbps，即存在传输瓶颈。</span></p><div class=pgc-img><img alt=视频监控系统的摄像头掉线看交换机连接注意事项 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/bc31d95d-2704-4b19-bcf5-51791ee24462><p class=pgc-img-caption></p></div><p><strong><span style="color:#595959;--tt-darkmode-color: #595959"><span style="background-color:#fbef2e;--tt-darkmode-bgcolor: #D8CE28">解决方案</span></span></strong></p><p style=text-align:justify><strong><span style="color:#595959;--tt-darkmode-color: #595959">1、 更换全千兆交换机</span></strong></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">很明显只有两个千兆口的核心交换机无法满足监控数据传输的需求，需将核心交换机更换为全千兆交换机。</span></p><p style=text-align:justify><strong><span style="color:#595959;--tt-darkmode-color: #595959">2、 开启IPC的智能编码（H.265+）</span></strong></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">开启IPC的智能编码后，IPC在保证视频、图像质量的前提下，最大程度的压缩码率大小，可有效降低传输码率，降低对网络传输设备的要求，系统更稳定。</span></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">现场调整完成后，无论是单画面还是多画面预览，均没有出现黑屏或卡顿的现象，各通道录像时间轴完整无断点，问题得到完美解决。</span></p><div class=pgc-img><img alt=视频监控系统的摄像头掉线看交换机连接注意事项 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/41797000-e1dd-4ba9-ba8f-393d6cbe4af8><p class=pgc-img-caption></p></div><p><strong><span style="color:#595959;--tt-darkmode-color: #595959"><span style="background-color:#fbef2e;--tt-darkmode-bgcolor: #D8CE28">交换机选型、连接注意事项</span></span></strong></p><p><strong><span style="color:#595959;--tt-darkmode-color: #595959">1、 传输带宽加倍</span></strong></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">IPC如果被多台录像机/客户端/服务器添加取流，传输带宽会成倍增加，需要注意各级联端口是否达到传输瓶颈，需选择合适型号的汇聚交换机或核心交换机，关于监控网络中如何选配交换机可参考《千百兆、核心、PoE、光纤？详细介绍监控网络中的交换机选配方法》。</span></p><p style=text-align:justify><strong><span style="color:#595959;--tt-darkmode-color: #595959">2、 避免多层级联</span></strong></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">交换机级联层数过多时，故障率也会升高，应尽量避免交换机多层级联，建议最好不超过3级。</span></p><p style=text-align:justify><strong><span style="color:#595959;--tt-darkmode-color: #595959">3、 善用智能编码</span></strong></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">开启IPC的智能编码后，可有效降低IPC的码率，降低网络传输的压力，可有效降低因带宽不足导致的卡顿、掉线、黑屏等问题，提高监控网络的稳定性。</span></p><p style=text-align:justify><strong><span style="color:#595959;--tt-darkmode-color: #595959">4、 上联口用千兆</span></strong></p><p style=text-align:justify><span style="color:#595959;--tt-darkmode-color: #595959">交换机的上联口需要传输其接入的所有IPC（包括其下方级联交换机接入的IPC）的数据，其传输的数据量往往较大，建议选择支持千兆上联口的交换机（千兆上联交换机或全千兆交换机）。</span></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'视频','监控','系统'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../cn/%E7%A7%91%E6%8A%80/75c53fae.html alt=视频安防监控系统管线施工工艺标准 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/dfic-imagehandler/a7a51fca-8a84-4810-9372-f7799ce3221d style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/75c53fae.html title=视频安防监控系统管线施工工艺标准>视频安防监控系统管线施工工艺标准</a></li><hr><li><a href=../../cn/%E6%B8%B8%E6%88%8F/15fa281f.html alt=视频监控系统搭配无人机，动物保护再迎新发展 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/14520e104e75465cb0dc0fef974b2fd5 style=border-radius:25px></a>
<a href=../../cn/%E6%B8%B8%E6%88%8F/15fa281f.html title=视频监控系统搭配无人机，动物保护再迎新发展>视频监控系统搭配无人机，动物保护再迎新发展</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/fccb369.html alt=视频监控系统中流媒体、直写、全交换三种取流架构方案 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/99720b778db94cdba2d8e21167ad7004 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/fccb369.html title=视频监控系统中流媒体、直写、全交换三种取流架构方案>视频监控系统中流媒体、直写、全交换三种取流架构方案</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/4f70b95.html alt=视频监控系统中布线常用传输线缆分类及制作方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/aaa1c560508b4361aee127fc9a5d3648 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/4f70b95.html title=视频监控系统中布线常用传输线缆分类及制作方法>视频监控系统中布线常用传输线缆分类及制作方法</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/243797f.html alt=视频监控系统的防雷设计 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1b0fc618061b4db68dc0519772c1bfb3 style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/243797f.html title=视频监控系统的防雷设计>视频监控系统的防雷设计</a></li><hr><li><a href=../../cn/%E7%A7%91%E6%8A%80/f234b2e.html alt=视频监控系统常用线缆如何选型？读懂这篇文章足够 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/de34d952236745588feb20ec1746650c style=border-radius:25px></a>
<a href=../../cn/%E7%A7%91%E6%8A%80/f234b2e.html title=视频监控系统常用线缆如何选型？读懂这篇文章足够>视频监控系统常用线缆如何选型？读懂这篇文章足够</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>