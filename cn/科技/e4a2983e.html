<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>第九讲：C语言基础之预处理（无参宏定义、带参宏定义） | 极客快訊</title><meta property="og:title" content="第九讲：C语言基础之预处理（无参宏定义、带参宏定义） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/dfic-imagehandler/90f31d31-03c5-411e-90d2-42d13ad1637e"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e4a2983e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e4a2983e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e4a2983e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e4a2983e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e4a2983e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e4a2983e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e4a2983e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e4a2983e.html><meta property="article:published_time" content="2020-11-14T21:00:48+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:48+08:00"><meta name=Keywords content><meta name=description content="第九讲：C语言基础之预处理（无参宏定义、带参宏定义）"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/e4a2983e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>第九讲：C语言基础之预处理（无参宏定义、带参宏定义）</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>本文约3700字，主要讲了<strong>无参宏定义、带参宏定义以及案例。</strong></p><p>带你进入C语言的世界，入门C语言，后边将持续更新。<strong>可以收藏学习。想了解</strong><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6767329573534171660/?group_id=6767329573534171660" target=_blank>字符串中字符的存取方法、函数指针、指针函数、指针函数和函数指针的区别、指针数组和指向指针的指针及案例</a><strong>等，</strong>请点击该处跳转阅读。</p><p><strong>本文全干货，新手必备，感谢你的阅读，祝你学有所成，生活愉快！</strong></p><hr><p>如包含命令#include &lt;stdio.h>，宏定义命令#define PI 3.1415926等。在源程序中这些命令都放在函数之外，而且一般都放在源文件的前面，它们称为预处理部分。</p><h1><strong>一、无参宏定义</strong></h1><p>无参宏的宏名后不带参数。其定义的一般形式为：</p><p><strong>#define 标识符 字符串</strong></p><p>其中的“#”表示这是一条预处理命令。<strong>凡是以“#”开头的均为预处理命令</strong>。</p><p>define 为宏定义命令。“标识符”为所定义的宏名。“字符串”可以是常数、表达式、格式串等。</p><p>#define PI 3.1415926 //它的作用是指定标识符PI来代替数3.1415926。</p><p>在编写源程序时，所有的3.1415926都可由PI代替，而对源程序作编译时，将先由预处理程序进行宏代换，即用3.1415926表达式去置换所有的宏名PI，然后再进行编译。</p><blockquote><p><strong>案例1：</strong></p><p>#include &lt;stdio.h></p><p>#define PI 3.1415926</p><p>main()</p><p>{</p><p>double s;</p><p>int r;</p><p>printf("Please enter the radius : ");</p><p>scanf("%d", &r);</p><p>s = PI * r * r;</p><p>printf("%g\n\n", s);</p><p>}</p></blockquote><div class=pgc-img><img alt=第九讲：C语言基础之预处理（无参宏定义、带参宏定义） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/90f31d31-03c5-411e-90d2-42d13ad1637e><p class=pgc-img-caption></p></div><p><strong>1.宏定义说明</strong></p><p>（1）宏定义是用宏名来表示一个字符串，在宏展开时又以该字符串取代宏名，这只是一种简单的代换，字符串中可以含任何字符，可以是常数，也可以是表达式，预处理程序对它不作任何检查。如有错误，只能在编译已被宏展开后的源程序时发现。</p><p>（2）宏定义不是说明或语句，<strong>在行末不必加分号</strong>，如加上分号则连分号也一起置换。</p><p>（3）宏定义必须写在函数之外，其<strong>作用域为宏定义命令起到源程序结束</strong>。如要终止其作用域可使用<strong># undef</strong>命令。</p><p>（4）宏名在源程序中若用引号括起来，则预处理程序不对其作宏代换。</p><blockquote><p><strong>案例2：</strong></p><p>#include &lt;stdio.h></p><p>#define PI 3.1415926</p><p>void fun(void);</p><p>main()</p><p>{</p><p>double s;</p><p>int r;</p><p>printf("Please enter the radius : ");</p><p>scanf("%d", &r);</p><p>s = PI * r * r;</p><p>printf("\n\nThe area of the roundness = %g\n\n", s);</p><p>fun();</p><p>}</p><p>void fun(void)</p><p>{</p><p>printf("Now the PI = %g\n\n", PI);</p><p>printf("PI\n\n"); // PI在引号中应该是表示常量字符串，不替换……</p><p>}</p></blockquote><p>（5）宏定义允许嵌套，在宏定义的字符串中可以使用已经定义的宏名。在宏展开时由预处理程序层层代换。</p><p>（6）习惯上宏名用大写字母表示，以便于与变量区别。但也允许用小写字母。</p><blockquote><p><strong>案例3：</strong></p><p>#include &lt;stdio.h></p><p>#define PI 3.1415926</p><p>#define S PI*r*r</p><p>void fun(void);</p><p>main()</p><p>{</p><p>double s;</p><p>int r;</p><p>printf("Please enter the radius : ");</p><p>scanf("%d", &r);</p><p>s = S;</p><p>printf("\n\nThe area of the roundness = %g\n\n", s);</p><p>}</p></blockquote><p>（7）可用宏定义表示数据类型，使书写方便。例如：#define INTEGER int</p><p>（8）对“输出格式”作宏定义，可以减少书写麻烦。</p><blockquote><p><strong>案例4：</strong></p><p>#include &lt;stdio.h></p><p>#define P printf</p><p>#define D "%d\n"</p><p>#define F "%f\n"</p><p>main()</p><p>{</p><p>int a = 5, c = 8, e = 11;</p><p>float b = 3.8, d = 9.7, f = 21.08;</p><p><br></p><p>P(D F, a, b);</p><p>P(D F, c, d);</p><p>P(D F, e, f);</p><p><br></p><p>}</p></blockquote><p><strong>2.宏定义表示数据类型和用typedef定义数据说明符的区别</strong></p><p><strong>区别：</strong>宏定义只是简单的字符串代换，是在预处理完成的，而typedef是在编译时处理的，它不是作简单的代换，而是对类型说明符重新命名。被命名的标识符具有类型定义说明的功能。</p><p>Typedef ;是一个语句，有分号；</p><blockquote><p>#define PIN1 char*</p><p>typedef char* PIN2;</p><p>main()</p><p>{PIN1 x, y; // char *x,y;</p><p>PIN2 a, b; //char*a,*b;</p><p>printf("By #define : %d %d\n\n", sizeof(x), sizeof(y));</p><p>printf("By typedef : %d %d\n\n", sizeof(a), sizeof(b));}</p></blockquote><blockquote><p><strong>案例5：</strong></p><p>#include &lt;stdio.h></p><p>#define PIN1 char*</p><p>typedef char* PIN2;</p><p>main()</p><p>{</p><p>PIN1 x, y;</p><p>PIN2 a, b;</p><p>printf("By #define : %d %d\n\n", sizeof(x), sizeof(y));</p><p>printf("By typedef : %d %d\n\n", sizeof(a), sizeof(b));</p><p>}</p></blockquote><h1><strong>二、有参宏定义</strong></h1><p>Ｃ语言允许宏带有参数。在宏定义中的参数称为形式参数，在宏调用中的参数称为实际参数。对带参数的宏，在调用中，不仅要宏展开，而且要用实参去代换形参。带参宏定义的一般形式为：</p><p><strong>#define 宏名(形参表) 字符串</strong></p><p>带参宏调用的一般形式为：<strong>宏名(实参表)；</strong></p><p><strong>例如：</strong></p><blockquote><p>#define M(y) y*y+3*y /*宏定义*/</p><p>……</p><p>k=M(5); /*宏调用*/</p><p>……</p></blockquote><p>在宏调用时，用实参5去代替形参y，经预处理宏展开后的语句为：</p><p>k=5*5+3*5</p><blockquote><p><strong>案例6：</strong></p><p>#include &lt;stdio.h></p><p>#define MAX(a,b) (a>b)?a:b</p><p>main()</p><p>{</p><p>int x, y, max;</p><p><br></p><p>printf("input two numbers: ");</p><p><br></p><p>scanf("%d %d", &x, &y);</p><p>max = MAX(x, y); // max = (x>y) ? x : y;</p><p><br></p><p>printf("The max is %d\n\n", max);</p><p><br></p><p>}</p></blockquote><div class=pgc-img><img alt=第九讲：C语言基础之预处理（无参宏定义、带参宏定义） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/521ff723-20a2-4c10-92ae-01fee4db7f22><p class=pgc-img-caption></p></div><p><strong>带参的宏定义说明</strong></p><p>（1）带参宏定义中，<strong>宏名和形参表之间不能有空格出现</strong>。</p><p>例如把： #define MAX(a,b) (a>b)?a:b</p><p>写为： #define MAX (a,b) (a>b)?a:b //错误</p><p>（2）在带参宏定义中，形式参数不分配内存单元，因此不必作类型定义。而宏调用中的实参有具体的值。要用它们去代换形参，因此必须作类型说明。（看example01.c）</p><p>这是与函数中的情况不同的。在函数中，形参和实参是两个不同的量，各有自己的作用域，调用时要把实参值赋予形参，进行“值传递”。而在带参宏中，只是符号代换，不存在值传递的问题。</p><p>（3）在宏定义中的形参是标识符，而宏调用中的实参可以是表达式。</p><blockquote><p><strong>案例7：</strong></p><p>#include &lt;stdio.h></p><p>#define SAY(y) (y)</p><p>main()</p><p>{</p><p>int i = 0;</p><p>char say[] = {73, 32, 108, 111, 118, 101, 32, 102, 105, 115, 104, 99, 46, 99, 111, 109, 33, 0};</p><p>while( say[i] )</p><p>{</p><p>say[i] = SAY(say[i]*1+1-1);</p><p>i++;</p><p>}</p><p><br></p><p>printf("\n\t%s\n\n", say);</p><p><br></p><p>}</p></blockquote><p>（4）在宏定义中，<strong>字符串内的形参通常要用括号括起来以避免出错</strong>。在上例中的宏定义中(y)*(y)表达式的y都用括号括起来，因此结果是正确的。</p><blockquote><p><strong>案例8：</strong></p><p>#include &lt;stdio.h></p><p>#define SQ(y) (y)*(y) // y*y试试</p><p>main()</p><p>{</p><p>int a, sq;</p><p><br></p><p>printf("input a number: ");</p><p><br></p><p>scanf("%d", &a);</p><p><br></p><p>sq = SQ(a+1); // sq = a+1 * a+1</p><p><br></p><p>printf("sq = %d\n", sq);</p><p><br></p><p>}</p></blockquote><p>（5）带参的宏和带参函数很相似，但有本质上的不同，除上面已谈到的各点外，把同一表达式用函数处理与用宏处理两者的结果有可能是不同的。</p><p>（6）宏定义也可用来定义多个语句，在宏调用时，把这些语句又代换到源程序内。</p><blockquote><p><strong>案例9：</strong></p><p>#include &lt;stdio.h></p><p>#include &lt;string.h></p><p>#define STR(s1, s2, s3, sum) strcat( strcat( strcat(sum, s1), s2 ), s3)</p><p>main()</p><p>{</p><p><br></p><p>char str1[] = "I ", str2[] = "love ", str3[] = "Fishc.com!", str[40] = "";</p><p><br></p><p>STR(str1, str2, str3, str); // strcat( strcat( strcat(str, str1), str2 ), str3)</p><p><br></p><p>printf("\n\tstr1 = %s\n\tstr2 = %s\n\tstr3 = %s\n\tStr = %s\n\n\n", str1, str2, str3, str);</p><p>str[0] = 0;</p><p>STR(str2, str1, str3, str);</p><p>printf("\n\tstr1 = %s\n\tstr2 = %s\n\tstr3 = %s\n\tStr = %s\n\n\n", str1, str2, str3, str);</p><p>}</p></blockquote><hr><p><strong>感谢您的阅读，希望有所收获！会持续更新！下一章写预处理的文件包含和条件编译！</strong></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'参宏定','语言','基础'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>