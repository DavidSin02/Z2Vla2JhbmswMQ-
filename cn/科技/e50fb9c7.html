<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>有趣的Shader | 打造视频趣味特效 | 极客快訊</title><meta property="og:title" content="有趣的Shader | 打造视频趣味特效 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/d02b53bfaae745fbaddaf1e7dddb82ef"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e50fb9c7.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e50fb9c7.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e50fb9c7.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e50fb9c7.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e50fb9c7.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e50fb9c7.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e50fb9c7.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e50fb9c7.html><meta property="article:published_time" content="2020-11-14T21:00:51+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:51+08:00"><meta name=Keywords content><meta name=description content="有趣的Shader | 打造视频趣味特效"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/e50fb9c7.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>有趣的Shader | 打造视频趣味特效</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><blockquote><p>投稿作者：胡阳阳</p></blockquote><p><br></p><p><strong>目录</strong></p><p><strong>1.Shader简单介绍以及入门。</strong></p><p><strong>2.抖音特效经典滤镜实现（包含灵魂出窍、抖动）。</strong></p><p><strong>3.用Shader创造一些新鲜有趣的效果吧。</strong></p><p>1.1 什么是Fragment Shader(片段着色器)？</p><p>我们把 shaders 和古腾堡印刷术相提并论。为什么这样类比呢？更重要的是，什么是 shader？</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/d02b53bfaae745fbaddaf1e7dddb82ef><p class=pgc-img-caption></p></div><p>如果你曾经有用计算机绘图的经验，你就知道在这个过程中你需要画一个圆，然后一个长方形，一条线，一些三角形……直到画出你想要的图像。这个过程很像用手写一封信或一本书 —— 都是一系列的指令，需要你一件一件完成。 Shaders 也是一系列的指令，但是这些指令会对屏幕上的每个像素同时下达。也就是说，你的代码必须根据像素在屏幕上的不同位置执行不同的操作。就像活字印刷，你的程序就像一个 function（函数），输入位置信息，输出颜色信息，当它编译完之后会以相当快的速度运行。</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d5c01f191bd3433b8c4a73964d29ec8f><p class=pgc-img-caption></p></div><p>1.2 为什么 shaders 运行特别快？</p><p>为了回答这个问题，不得不给大家介绍并行处理（parallel processing）的神奇之处。 想象你的 CPU 是一个大的工业管道，然后每一个任务都是通过这个管道的某些东西 —— 就像一个生产流水线那样。有些任务要比别的大，也就是说要花费更多时间和精力去处理。我们就称它要求更强的处理能力。由于计算机自身的架构，这些任务需要串行；即一次一个地依序完成。现代计算机通常有一组四个处理器，就像这个管道一样运行，一个接一个地处理这些任务，从而使计算机流畅运行。每个管道通常被称为线程。</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/552d0771b9674ba58b2d034337d7629e><p class=pgc-img-caption></p></div><p>CPU视频游戏和其他图形应用比起别的程序来说，需要高得多的处理能力。因为它们的图形内容需要操作无数像素。想想看，屏幕上的每一个像素都需要计算，而在 3D 游戏中几何和透视也都需要计算。 让我们回到开始那个关于管道和任务的比喻。屏幕上的每个像素都代表一个最简单的任务。单独来看完成任何一个像素的任务对 CPU 来说都很容易，那么问题来了，屏幕上的每一个像素都需要解决这样的小任务！也就是说，哪怕是对于一个老式的屏幕（分辨率 800x600）来说，都需要每帧处理480000个像素，即每秒进行14400000次计算！是的，这对于微处理器就是大问题了！而对于一个现代的 2800x1800 视网膜屏，每秒运行60帧，就需要每秒进行311040000次计算。图形工程师是如何解决这个问题的？</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7432ca3bf47442eda13dfd13701ef6cc><p class=pgc-img-caption></p></div><p>这个时候，并行处理就是最好的解决方案。比起用三五个强大的微处理器（或者说“管道”）来处理这些信息，用一大堆小的微处理器来并行计算，就要好得多。这就是图形处理器（GPU : Graphic Processor Unit）的来由。</p><p>把GPU设想成一堆小型微处理器排成一个平面的画面，假设每个像素的数据是乒乓球。14400000个乒乓球可以在一秒内阻塞几乎任何管道。但是一面800x600的管道墙，每秒接收30波480000个像素的信息就可以流畅完成。这在更高的分辨率下也是成立的 —— 并行的处理器越多，可以处理的数据流就越大。 另一个 GPU 的魔法是特殊数学函数可通过硬件加速。非常复杂的数学操作可以直接被微芯片解决，而无须通过软件。这就表示可以有更快的三角和矩阵运算 —— 和电流一样快。</p><p>1.3 Hello world!</p><p>“Hello world!”通常都是学习一个新语言的第一个例子。这是一个非常简单，只有一行的程序。它既是一个热情的欢迎，也传达了编程所能带来的可能性。</p><p>然而在 GPU 的世界里，第一步就渲染一行文字太难了，所以我们改为选择一个鲜艳的欢迎色，来吧躁起来！</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6f56d57fadbd46b5b55c2172b347ce37><p class=pgc-img-caption></p></div><p>尽管这几行简单的代码看起来不像有很多内容，我们还是可以据此推测出一些知识点：</p><p>1.shader 语言 有一个 main 函5</p><p>2.数，会在最后返回颜色值。这点和 C 语言很像。</p><p>2.最终的像素颜色取决于预设的全局变量 gl_FragColor。</p><p>3.这个类 C 语言有内建的变量（像gl_FragColor），函数和数据类型。在本例中我们刚刚介绍了vec4（四分量浮点向量）。之后我们会见到更多的类型，像 vec3 （三分量浮点向量）和 vec2 （二分量浮点向量），还有非常著名的：float（单精度浮点型）， int（整型） 和 bool（布尔型）。</p><p>4.如果我们仔细观察 vec4 类型，可以推测这四个变元分别响应红，绿，蓝和透明度通道。同时我们也可以看到这些变量是规范化的，意思是它们的值是从0到1的。之后我们会学习如何规范化变量，使得在变量间map（映射）数值更加容易。</p><p>5.另一个可以从本例看出来的很重要的类 C 语言特征是，预处理程序的宏指令。宏指令是预编译的一部分。有了宏才可以 #define （定义）全局变量和进行一些基础的条件运算（通过使用 #ifdef 和 #endif）。所有的宏都以 # 开头。预编译会在编译前一刻发生，把所有的命令复制到 #defines 里，检查#ifdef 条件句是否已被定义， #ifndef 条件句是否没有被定义。在我们刚刚的“hello world!”的例子中，我们在第2行检查了 GL_ES 是否被定义，这个通常用在移动端或浏览器的编译中。</p><p>6.float类型在 shaders 中非常重要，所以精度非常重要。更低的精度会有更快的渲染速度，但是会以质量为代价。你可以选择每一个浮点值的精度。在第一行（precision mediump float;）我们就是设定了所有的浮点值都是中等精度。但我们也可以选择把这个值设为“低”（precision lowp float;）或者“高”（precision highp float;）。</p><p>7.最后可能也是最重要的细节是，GLSL 语言规范并不保证变量会被自动转换类别。这句话是什么意思呢？显卡的硬件制造商各有不同的显卡加速方式，但是却被要求有最精简的语言规范。因而，自动强制类型转换并没有包括在其中。在我们的“hello world!”例子中，vec4 精确到单精度浮点，所以应被赋予 float 格式。但是如果你想要代码前后一致，不要之后花费大量时间 debug 的话，最好养成在 float 型数值里加一个 . 的好习惯。如下这种代码就可能不能正常运行：</p><p>1.4 运行我们的 shader</p><p>现在你可能跃跃欲试，想在你熟悉的平台上小试牛刀了。</p><p>1.你可以下载glslViewer。这个 MacOS+树莓派程序直接在终端运行.</p><p>2.如果你想用 WebGL 显示 shader，并不关心其他平台，你可以用glslCanvas 。</p><p>3.这里提安利个桌面小工具ShaderDesigner,这个 MacOS的程序可以直接调用摄像头并预览，加入你的shader代码来创造有趣的效果。</p><p>2.1 运行我们的 ShaderDesigner.app</p><p>下载ShaderDesigner并在MacOS环境下运行如下图</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4fa086423a764d72bd3e76391cf26664><p class=pgc-img-caption></p></div><p>我们来看下Fragment Shader代码</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0e6b150923d048fda793c0fd77172319><p class=pgc-img-caption></p></div><p>1. textureCoordinate 视口分辨率（以像素计）</p><p>2. inputImageTexture 接收一个图片的引用，当做2D的纹理，这个数据类型就是smpler2D。</p><p>3. u_time shader 运行时间（以秒计</p><p>4. texture2D(Texture,v_texCoord)方法</p><p>5. 最终的像素颜色取决于vec4类型 gl_FragColor</p><p>2.2 小试牛刀解决镜像翻转</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c85ca37aa0b24b5089bc12e20c8b7109><p class=pgc-img-caption></p></div><p>2.3 试试抖音的灵魂出窍</p><p>先来看看效果吧(world无法加载gif 点击预览)</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/62d01916c3394c4a8b42654af42221f0><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/653aaf1ecb5e4f6d981477d8ba36b043><p class=pgc-img-caption></p></div><p>2.4 试试抖音的抖动效果吧</p><p>先来看看效果吧(world无法加载gif 点击预览)</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d5a7cda34ae44625b9a424509ccc41f5><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8b611a677c974b288c700bd043f236bb><p class=pgc-img-caption></p></div><p>3.1用Shader创造一些新鲜有趣的效果吧—四合一。</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/341a6d0bd61d4f2c839506797577baee><p class=pgc-img-caption></p></div><p>有趣的四合一</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ed1dfb8c26d441f182c76baf63805f45><p class=pgc-img-caption></p></div><p>3.2用Shader创造一些新鲜有趣的效果吧—三合一。</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/414ae1ce75d845baae80141c1a06c045><p class=pgc-img-caption></p></div><p>有趣的三合一</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f908f2c43c68463ba63a9a349b675dfa><p class=pgc-img-caption></p></div><p>3.3用Shader创造一些新鲜有趣的效果吧—中间镜像。</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9c9da82a4e574d9296ac1e3746e32a36><p class=pgc-img-caption></p></div><p>有趣的中间镜像</p><div class=pgc-img><img alt="有趣的Shader | 打造视频趣味特效" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ebdbeda8fd5c4ba69229a259aabb130b><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Shader','视频','特效'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>