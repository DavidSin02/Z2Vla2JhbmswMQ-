<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>æ¥çœ‹çœ‹CALayeré‚£äº›ç‰›é€¼çš„å­ç±» | æå®¢å¿«è¨Š</title><meta property="og:title" content="æ¥çœ‹çœ‹CALayeré‚£äº›ç‰›é€¼çš„å­ç±» - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/322c0001962a9d0a3860"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e7b4670e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e7b4670e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e7b4670e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e7b4670e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e7b4670e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e7b4670e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e7b4670e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e7b4670e.html><meta property="article:published_time" content="2020-10-29T21:09:16+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:16+08:00"><meta name=Keywords content><meta name=description content="æ¥çœ‹çœ‹CALayeré‚£äº›ç‰›é€¼çš„å­ç±»"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/e7b4670e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>æ¥çœ‹çœ‹CALayeré‚£äº›ç‰›é€¼çš„å­ç±»</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><p><img alt=æ¥çœ‹çœ‹CALayeré‚£äº›ç‰›é€¼çš„å­ç±» onerror=errorimg.call(this); src=https://p1.pstatp.com/large/322c0001962a9d0a3860></p><p><strong>CATransformLayer</strong></p><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ç³»ç»Ÿæœ‰æ²¡æœ‰åƒä¹‹å‰è®²è¿‡çš„å‡ ä¸ªå­ç±»ä¸€æ ·ï¼Œç»™å®ƒä¸€äº›ç‰¹æ®Šçš„å±æ€§æˆ–è€…æ–¹æ³•ï¼š</p><p><code>@interface CATransformLayer : CALayer</code></p><p><code>@end</code></p><p>å•¥éƒ½æ²¡æœ‰ï¼Œæˆ‘æ“¦å˜ï¼Œä½†æ˜¯ä¸Šé¢å¥½åƒæœ‰ä¸€æ®µæè¿°æˆ‘ä»¬çœ‹ä¸€ä¸‹ï¼š</p><p><code>/* "Transform" layers are used to create true 3D layer hierarchies.</code></p><p><code></code><code>*</code></p><p><code></code><code>* Unlike normal layers, transform layers do not project (i.e. flatten)</code></p><p><code></code><code>* their sublayers into the plane at Z=0. However due to this neither</code></p><p><code></code><code>* do they support many features of the 2D compositing model:</code></p><p><code></code><code>*</code></p><p><code></code><code>* - only their sublayers are rendered (i.e. no background, contents,</code></p><p><code></code><code>* border)</code></p><p><code></code><code>*</code></p><p><code></code><code>* - filters, backgroundFilters, compositingFilter, mask, masksToBounds</code></p><p><code></code><code>* and shadow related properties are ignored (they all assume 2D</code></p><p><code></code><code>* image processing of the projected layer)</code></p><p><code></code><code>*</code></p><p><code></code><code>* - opacity is applied to each sublayer individually, i.e. the transform</code></p><p><code></code><code>* layer does not form a compositing group.</code></p><p><code></code><code>*</code></p><p><code></code><code>* Also, the -hitTest: method should never be called on transform</code></p><p><code></code><code>* layers (they do not have a 2D coordinate space into which to map the</code></p><p><code></code><code>* supplied point.) CALayer will pass over transform layers directly to</code></p><p><code></code><code>* their sublayers, applying the effects of the transform layer's</code></p><p><code></code><code>* geometry when hit-testing each sublayer. */</code></p><p>æˆ‘ä»¬ä»ä¸­å¯ä»¥çœ‹å‡ºå®ƒä½œä¸ºçˆ¶Layeræ—¶ï¼Œå¯¹ä»–çš„sublayersä¼šæœ‰3Dæ•ˆæœï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å¹³é¢åŒ–å®ƒçš„å­å›¾å±‚ï¼Œå¤§å®¶ä¸€æåˆ°3Dæ•ˆæœï¼Œå°±ä¼šæƒ³åˆ°ä¸€ä¸ªç¥å¥‡çš„ä¸œè¥¿æ™¯æ·±ï¼Œå…ˆè¯´ä¸€ä¸‹æ™¯æ·±æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œæåˆ°æ™¯æ·±ï¼Œé‚£æˆ‘ä»¬å°±ä¸€å®šè¦è¯´CATransform3Dï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ª4x4 çš„ CGFloatå€¼çš„çŸ©é˜µï¼Œå°±æ˜¯è¿™æ ·çš„ï¼š</p><p><code>struct CATransform3D</code></p><p><code>{</code></p><p><code></code><code>CGFloat m11, m12, m13, m14;</code></p><p><code></code><code>CGFloat m21, m22, m23, m24;</code></p><p><code></code><code>CGFloat m31, m32, m33, m34;</code></p><p><code></code><code>CGFloat m41, m42, m43, m44;</code></p><p><code>}</code></p><p>å…¶ä¸­çš„m34ï¼Œå°±æ˜¯ä¸Šé¢æåˆ°çš„æ™¯æ·±æ•ˆæœçš„æºå¤´ï¼Œæˆ‘ä»¬å†™ä¸€æ®µä»£ç çœ‹ä¸€ä¸‹ï¼š</p><p><code>- (void)viewDidLoad {</code></p><p><code></code><code>[</code><code>super</code> <code>viewDidLoad];</code></p><p><code></code><code>// Do any additional setup after loading the view, typically from a nib.</code></p><p><code></code><code>CALayer *layer_ = [CALayer layer];</code></p><p><code></code><code>layer_.bounds = CGRectMake(0, 0, 100, 100);</code></p><p><code></code><code>layer_.position = CGPointMake(self.view.center.x, 200);</code></p><p><code></code><code>layer_.opacity = 0.6;</code></p><p><code></code><code>layer_.backgroundColor = [UIColor redColor].CGColor;</code></p><p><code></code><code>layer_.borderWidth = 5;</code></p><p><code></code><code>layer_.borderColor = [[UIColor greenColor] colorWithAlphaComponent:0.4].CGColor;</code></p><p><code></code><code>layer_.cornerRadius = 20;</code></p><p><code></code><code>layer_.masksToBounds = YES;</code></p><p><code></code><code>[self.view.layer addSublayer:layer_];</code></p><p><code></code><code>//</code></p><p><code></code><code>CATransform3D fromValue_ = CATransform3DIdentity;</code></p><p><code></code><code>fromValue_ = CATransform3DRotate(fromValue_, M_PI_2 / 2, 0, 1, 0);</code></p><p><code></code><code>layer_.transform = fromValue_;</code></p><p><code></code><code>CALayer *layer = [CALayer layer];</code></p><p><code></code><code>layer.bounds = CGRectMake(0, 0, 100, 100);</code></p><p><code></code><code>layer.position = self.view.center;</code></p><p><code></code><code>layer.opacity = 0.6;</code></p><p><code></code><code>layer.backgroundColor = [UIColor blueColor].CGColor;</code></p><p><code></code><code>layer.borderWidth = 5;</code></p><p><code></code><code>layer.borderColor = [[UIColor orangeColor] colorWithAlphaComponent:0.4].CGColor;</code></p><p><code></code><code>layer.cornerRadius = 20;</code></p><p><code></code><code>layer.masksToBounds = YES;</code></p><p><code></code><code>[self.view.layer addSublayer:layer];</code></p><p><code></code><code>//</code></p><p><code></code><code>CATransform3D fromValue = CATransform3DIdentity;</code></p><p><code></code><code>fromValue.m34 = 1.0 / -500;</code></p><p><code></code><code>fromValue = CATransform3DRotate(fromValue, M_PI_2 / 2, 0, 1, 0);</code></p><p><code></code><code>layer.transform = fromValue;</code></p><p><code>}</code></p><p>è¿è¡Œç»“æœï¼š</p><p><img alt=æ¥çœ‹çœ‹CALayeré‚£äº›ç‰›é€¼çš„å­ç±» onerror=errorimg.call(this); src=https://p1.pstatp.com/large/322d00042e798384e986></p><p>æ˜¯ä¸æ˜¯æ˜æ˜¾å‘ç°è“è‰²çš„layer3Dæ•ˆæœæ›´å¼ºçƒˆä¸€äº›ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬è¯•ä¸€ä¸‹è¿™æ ·çš„ä»£ç ï¼š</p><p><code>- (void)viewDidLoad {</code></p><p><code></code><code>[</code><code>super</code> <code>viewDidLoad];</code></p><p><code></code><code>CALayer *layer = [CALayer layer];</code></p><p><code></code><code>layer.bounds = CGRectMake(0, 0, 100, 100);</code></p><p><code></code><code>layer.opacity = 0.6;</code></p><p><code></code><code>layer.backgroundColor = [UIColor redColor].CGColor;</code></p><p><code></code><code>layer.borderWidth = 5;</code></p><p><code></code><code>layer.borderColor = [[UIColor greenColor] colorWithAlphaComponent:0.4].CGColor;</code></p><p><code></code><code>layer.cornerRadius = 20;</code></p><p><code></code><code>layer.masksToBounds = YES;</code></p><p><code></code><code>CALayer *layer_2 = [CALayer layer];</code></p><p><code></code><code>layer_2.bounds = CGRectMake(0, 0, 100, 100);</code></p><p><code></code><code>layer_2.opacity = 0.6;</code></p><p><code></code><code>layer_2.backgroundColor = [UIColor blueColor].CGColor;</code></p><p><code></code><code>layer_2.borderWidth = 5;</code></p><p><code></code><code>layer_2.borderColor = [[UIColor orangeColor] colorWithAlphaComponent:0.4].CGColor;</code></p><p><code></code><code>layer_2.cornerRadius = 20;</code></p><p><code></code><code>layer_2.masksToBounds = YES;</code></p><p><code></code><code>//</code></p><p><code></code><code>CALayer *containerLayer = [CALayer layer];</code></p><p><code></code><code>containerLayer.bounds = CGRectMake(0, 0, 100, 100);</code></p><p><code></code><code>containerLayer.position = self.view.center;</code></p><p><code></code><code>layer.position = CGPointMake(50, 50);</code></p><p><code></code><code>layer_2.position = CGPointMake(50, 50);</code></p><p><code></code><code>[containerLayer addSublayer:layer];</code></p><p><code></code><code>[containerLayer addSublayer:layer_2];</code></p><p><code></code><code>[self.view.layer addSublayer:containerLayer];</code></p><p><code></code><code>//</code></p><p><code></code><code>CATransform3D containerTransform = CATransform3DIdentity;</code></p><p><code></code><code>containerTransform.m34 = -1.0 / 500.0;</code></p><p><code></code><code>containerLayer.transform = containerTransform;</code></p><p><code></code><code>//</code></p><p><code></code><code>CATransform3D fromValue = CATransform3DIdentity;</code></p><p><code></code><code>fromValue = CATransform3DRotate(fromValue, M_PI_2, 0, 1, 0);</code></p><p><code></code><code>fromValue = CATransform3DTranslate(fromValue, 0, 0, -10);</code></p><p><code></code><code>layer.transform = fromValue;</code></p><p><code></code><code>CATransform3D fromValue_2 = CATransform3DIdentity;</code></p><p><code></code><code>fromValue_2 = CATransform3DRotate(fromValue_2, M_PI_2, 0, 1, 0);</code></p><p><code></code><code>fromValue_2 = CATransform3DTranslate(fromValue_2, 0, 0, -50);</code></p><p><code></code><code>layer_2.transform = fromValue_2;</code></p><p><code>}</code></p><p>è¿è¡Œç»“æœï¼Œä¸€ç‰‡ç©ºç™½ï¼Œå•¥éƒ½æ²¡æœ‰ã€‚</p><p>æˆ‘ä»¬åšä¸€å¤„æ”¹åŠ¨ï¼š</p><p>1</p><p><code>CATransformLayer *containerLayer = [CATransformLayer layer];</code></p><p>è¿è¡Œç»“æœï¼š</p><p><img alt=æ¥çœ‹çœ‹CALayeré‚£äº›ç‰›é€¼çš„å­ç±» onerror=errorimg.call(this); src=https://p1.pstatp.com/large/32100004d63d26bbca87></p><p>??ï¼šæ‰€ä»¥æœ‰äººè¯´CATransformLayerä¾¿æ˜¯ç»™ä»–çš„å­å›¾å±‚æ·»åŠ äº†æ™¯æ·±çš„æ•ˆæœã€‚çæï¼ŒæŠŠè®¾ç½®æ™¯æ·±çš„ä»£ç containerTransform.m34 = -1.0 / 500.0;å»æ‰ï¼Œè¿è¡Œï¼Œä½ ä¼šå‘ç°è¿˜æ˜¯ä¸€ç‰‡ç©ºç™½ã€‚è¿™å°±è¯´æ˜CATransformLayerå¹¶ä¸æ˜¯è¿™ä¹ˆä¸ªä½œç”¨ã€‚é‚£è¿™ä¸ªä¸œè¥¿çš„ç‰¹æ®Šä¹‹å¤„ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å…¶å®å°±æ˜¯ä¸Šé¢è¯´çš„ï¼šCATransformLayerå¹¶ä¸å¹³é¢åŒ–å®ƒçš„å­å›¾å±‚ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿç”¨äºæ„é€ ä¸€ä¸ªå±‚çº§åˆ†æ˜çš„3Dç»“æ„ã€‚</p><p>ä¸Šä»£ç ï¼š</p><p><code>- (void)viewDidLoad {</code></p><p><code></code><code>[</code><code>super</code> <code>viewDidLoad];</code></p><p><code></code><code>CALayer *layer = [CALayer layer];</code></p><p><code></code><code>layer.bounds = CGRectMake(0, 0, 100, 100);</code></p><p><code></code><code>layer.opacity = 0.6;</code></p><p><code></code><code>layer.backgroundColor = [UIColor redColor].CGColor;</code></p><p><code></code><code>layer.borderWidth = 5;</code></p><p><code></code><code>layer.borderColor = [[UIColor greenColor] colorWithAlphaComponent:0.4].CGColor;</code></p><p><code></code><code>layer.cornerRadius = 20;</code></p><p><code></code><code>layer.masksToBounds = YES;</code></p><p><code></code><code>CALayer *containerLayer = [CALayer layer];</code></p><p><code></code><code>containerLayer.bounds = CGRectMake(0, 0, 100, 100);</code></p><p><code></code><code>containerLayer.position = self.view.center;</code></p><p><code></code><code>layer.position = CGPointMake(50, 50);</code></p><p><code></code><code>layer_2.position = CGPointMake(50, 50);</code></p><p><code></code><code>[containerLayer addSublayer:layer];</code></p><p><code></code><code>[self.view.layer addSublayer:containerLayer];</code></p><p><code></code><code>CATransform3D containerTransform = CATransform3DIdentity;</code></p><p><code></code><code>containerLayer.transform = containerTransform;</code></p><p><code></code><code>CATransform3D fromValue = CATransform3DIdentity;</code></p><p><code></code><code>fromValue = CATransform3DRotate(fromValue, M_PI_2, 0, 1, 0);</code></p><p><code></code><code>layer.transform = fromValue;</code></p><p><code>}</code></p><p>è¿è¡Œç»“æœï¼šä¸å‡ºæ‰€æ–™ï¼Œä¸€ç‰‡ç©ºç™½ã€‚</p><p>äºæ˜¯ï¼Œæˆ‘ä»¬æŠŠcontainerLayerç”±CALayeræ”¹æˆCATransformLayer ï¼Œç»“æœï¼Œè¿˜æ˜¯ä¸€ç‰‡ç©ºç™½ã€‚</p><p>ç°åœ¨ï¼Œä½ è‚¯å®šè§‰çš„æˆ‘ä¹Ÿæ˜¯åœ¨æ‰¯æ·¡ï¼Œä¸‹é¢ç²¾å½©çš„éƒ¨åˆ†æ¥äº†ï¼š</p><p>æˆ‘ä»¬ç»™containerLayeræ·»åŠ ä¸€ä¸ªæ–°çš„transformï¼Œä»£ç ä¹Ÿå°±æ˜¯è¿™æ ·çš„ï¼š</p><p><code>- (void)viewDidLoad {</code></p><p><code></code><code>[</code><code>super</code> <code>viewDidLoad];</code></p><p><code></code><code>CALayer *layer = [CALayer layer];</code></p><p><code></code><code>layer.bounds = CGRectMake(0, 0, 100, 100);</code></p><p><code></code><code>layer.opacity = 0.6;</code></p><p><code></code><code>layer.backgroundColor = [UIColor redColor].CGColor;</code></p><p><code></code><code>layer.borderWidth = 5;</code></p><p><code></code><code>layer.borderColor = [[UIColor greenColor] colorWithAlphaComponent:0.4].CGColor;</code></p><p><code></code><code>layer.cornerRadius = 20;</code></p><p><code></code><code>layer.masksToBounds = YES;</code></p><p><code></code><code>CALayer *containerLayer = [CALayer layer];</code></p><p><code></code><code>containerLayer.bounds = CGRectMake(0, 0, 100, 100);</code></p><p><code></code><code>containerLayer.position = self.view.center;</code></p><p><code></code><code>layer.position = CGPointMake(50, 50);</code></p><p><code></code><code>layer_2.position = CGPointMake(50, 50);</code></p><p><code></code><code>[containerLayer addSublayer:layer];</code></p><p><code></code><code>[self.view.layer addSublayer:containerLayer];</code></p><p><code></code><code>CATransform3D containerTransform = CATransform3DIdentity;</code></p><p><code></code><code>//çœ‹è¿™ï¼Œæˆ‘æ˜¯æ–°åŠ çš„</code></p><p><code></code><code>containerTransform = CATransform3DRotate(containerTransform, M_PI_2, 0, 1, 0);</code></p><p><code></code><code>//</code></p><p><code></code><code>containerLayer.transform = containerTransform;</code></p><p><code></code><code>CATransform3D fromValue = CATransform3DIdentity;</code></p><p><code></code><code>fromValue = CATransform3DRotate(fromValue, M_PI_2, 0, 1, 0);</code></p><p><code></code><code>layer.transform = fromValue;</code></p><p><code>}</code></p><p>è¿è¡Œç»“æœï¼š</p><p><img alt=æ¥çœ‹çœ‹CALayeré‚£äº›ç‰›é€¼çš„å­ç±» onerror=errorimg.call(this); src=https://p3.pstatp.com/large/32100004d63cb1ed7d8d></p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å†æŠŠcontainerLayerç”±CATransformLayeræ”¹æˆCALayer ï¼Œç»“æœï¼Œä¸€ç‰‡ç©ºç™½ï¼ä½ æ˜¯ä¸æ˜¯æ˜ç™½äº†å‘¢ï¼Ÿå…¶å®è¿˜æ˜¯ä¸Šé¢é‚£å¥è¯ï¼</p><p>æˆ‘ä»¬åˆ©ç”¨å®ƒæ¥åšä¸€ä¸ªç«‹æ–¹ä½“ï¼š</p><p><code>#import "ViewController.h"</code></p><p><code>@interface ViewController (){</code></p><p><code></code><code>CGPoint startPoint;</code></p><p><code></code><code>CATransformLayer *s_Cube;</code></p><p><code></code><code>float pix, piy;</code></p><p><code>}</code></p><p><code>@end</code></p><p><code>@implementation ViewController</code></p><p><code>- (void)viewDidLoad {</code></p><p><code></code><code>[</code><code>super</code> <code>viewDidLoad];</code></p><p><code></code><code>// Do any additional setup after loading the view, typically from a nib.</code></p><p><code></code><code>//</code></p><p><code></code><code>CATransform3D c1t = CATransform3DIdentity;</code></p><p><code></code><code>CALayer *cube1 = [self cubeWithTransform:c1t];</code></p><p><code></code><code>s_Cube = (CATransformLayer *)cube1;</code></p><p><code></code><code>[self.view.layer addSublayer:cube1];</code></p><p><code>}</code></p><p><code>- (CALayer *)faceWithTransform:(CATransform3D)transform color:(UIColor*)color</code></p><p><code>{</code></p><p><code></code><code>CALayer *face = [CALayer layer];</code></p><p><code></code><code>face.frame = CGRectMake(-50, -50, 100, 100);</code></p><p><code></code><code>face.backgroundColor = color.CGColor;</code></p><p><code></code><code>face.transform = transform;</code></p><p><code></code><code>return</code> <code>face;</code></p><p><code>}</code></p><p><code>- (CALayer *)cubeWithTransform:(CATransform3D)transform</code></p><p><code>{</code></p><p><code></code><code>//å®¹å™¨</code></p><p><code></code><code>CATransformLayer *cube = [CATransformLayer layer];</code></p><p><code></code><code>//å‰</code></p><p><code></code><code>CATransform3D ct = CATransform3DMakeTranslation(0, 0, 50);</code></p><p><code></code><code>[cube addSublayer:[self faceWithTransform:ct color:[UIColor redColor]]];</code></p><p><code></code><code>//å³</code></p><p><code></code><code>ct = CATransform3DMakeTranslation(50, 0, 0);</code></p><p><code></code><code>ct = CATransform3DRotate(ct, M_PI_2, 0, 1, 0);</code></p><p><code></code><code>[cube addSublayer:[self faceWithTransform:ct color:[UIColor yellowColor]]];</code></p><p><code></code><code>//ä¸Š</code></p><p><code></code><code>ct = CATransform3DMakeTranslation(0, -50, 0);</code></p><p><code></code><code>ct = CATransform3DRotate(ct, M_PI_2, 1, 0, 0);</code></p><p><code></code><code>[cube addSublayer:[self faceWithTransform:ct color:[UIColor blueColor]]];</code></p><p><code></code><code>//ä¸‹</code></p><p><code></code><code>ct = CATransform3DMakeTranslation(0, 50, 0);</code></p><p><code></code><code>ct = CATransform3DRotate(ct, -M_PI_2, 1, 0, 0);</code></p><p><code></code><code>[cube addSublayer:[self faceWithTransform:ct color:[UIColor brownColor]]];</code></p><p><code></code><code>//å·¦</code></p><p><code></code><code>ct = CATransform3DMakeTranslation(-50, 0, 0);</code></p><p><code></code><code>ct = CATransform3DRotate(ct, -M_PI_2, 0, 1, 0);</code></p><p><code></code><code>[cube addSublayer:[self faceWithTransform:ct color:[UIColor greenColor]]];</code></p><p><code></code><code>//å</code></p><p><code></code><code>ct = CATransform3DMakeTranslation(0, 0, -50);</code></p><p><code></code><code>ct = CATransform3DRotate(ct, M_PI, 0, 1, 0);</code></p><p><code></code><code>[cube addSublayer:[self faceWithTransform:ct color:[UIColor orangeColor]]];</code></p><p><code></code><code>//</code></p><p><code></code><code>CGSize containerSize = self.view.bounds.size;</code></p><p><code></code><code>cube.position = CGPointMake(containerSize.width / 2.0,</code></p><p><code></code><code>containerSize.height / 2.0);</code></p><p><code></code><code>cube.transform = transform;</code></p><p><code></code><code>return</code> <code>cube;</code></p><p><code>}</code></p><p><code>- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event</code></p><p><code>{</code></p><p><code></code><code>UITouch *touch = [touches anyObject];</code></p><p><code></code><code>startPoint = [touch locationInView:self.view];</code></p><p><code>}</code></p><p><code>- (void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event</code></p><p><code>{</code></p><p><code></code><code>UITouch *touch = [touches anyObject];</code></p><p><code></code><code>CGPoint currentPosition = [touch locationInView:self.view];</code></p><p><code></code><code>CGFloat deltaX = startPoint.x - currentPosition.x;</code></p><p><code></code><code>CGFloat deltaY = startPoint.y - currentPosition.y;</code></p><p><code></code><code>CATransform3D c1t = CATransform3DIdentity;</code></p><p><code></code><code>c1t = CATransform3DRotate(c1t, pix + M_PI_2 * deltaY / 100, 1, 0, 0);</code></p><p><code></code><code>c1t = CATransform3DRotate(c1t, piy - M_PI_2 * deltaX / 100, 0, 1, 0);</code></p><p><code></code><code>s_Cube.transform = c1t;</code></p><p><code>}</code></p><p><code>- (void)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event</code></p><p><code>{</code></p><p><code></code><code>UITouch *touch = [touches anyObject];</code></p><p><code></code><code>CGPoint currentPosition = [touch locationInView:self.view];</code></p><p><code></code><code>CGFloat deltaX = startPoint.x - currentPosition.x;</code></p><p><code></code><code>CGFloat deltaY = startPoint.y - currentPosition.y;</code></p><p><code></code><code>pix = M_PI_2 * deltaY / 100;</code></p><p><code></code><code>piy = -M_PI_2 * deltaX / 100;</code></p><p><code>}</code></p><p><code>- (void)didReceiveMemoryWarning {</code></p><p><code></code><code>[</code><code>super</code> <code>didReceiveMemoryWarning];</code></p><p><code></code><code>// Dispose of any resources that can be recreated.</code></p><p><code>}</code></p><p><code>@end</code></p><p>è¿è¡Œç»“æœï¼š</p><p>å¦‚æœé’ˆå¯¹ä¸Šé¢çš„è§£é‡Šä½ è¿˜ä¸æ˜¯å¾ˆç†è§£ï¼Œé‚£ä¹ˆä½ å¯ä»¥æŠŠè¿™ä¸ªç«‹æ–¹ä½“çš„CATransformLayeræ¢æˆCALayerï¼Œè¯•è¯•çœ‹å–½ã€‚</p><p><img alt=æ¥çœ‹çœ‹CALayeré‚£äº›ç‰›é€¼çš„å­ç±» onerror=errorimg.call(this); src=https://p1.pstatp.com/large/321f0000b8b81b7e7f69></p><p><strong>CAReplicatorLayer</strong></p><p>é€šè¿‡è¿™ä¸ªåå­—ï¼Œæˆ‘å°±ç¡®å®šå®ƒå’Œå›¾å±‚å¤åˆ¶æœ‰å…³ï¼Œä½ ä¿¡ä¸ä¿¡ï¼Ÿ</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ç³»ç»Ÿæä¾›çš„APIï¼š</p><p><code>@interface CAReplicatorLayer : CALayer</code></p><p><code>@property NSInteger instanceCount; </code><code>//å¤åˆ¶å›¾å±‚çš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬åŠ åˆ°ä¸Šé¢çš„</code></p><p><code>@property BOOL preservesDepth; </code><code>// å­å›¾å±‚æ˜¯å¦å¹³é¢åŒ–ï¼ˆçœ‹ä¸Šé¢é‚£ä¸ªCATransformLayerï¼‰</code></p><p><code>@property CFTimeInterval instanceDelay; </code><code>// å¤åˆ¶å±‚åŠ¨ç”»å»¶è¿Ÿæ—¶é—´</code></p><p><code>@property CATransform3D instanceTransform; </code><code>//å­å›¾å±‚çš„transformå˜æ¢ï¼Œä¸€èˆ¬ç”¨æ¥å†³å®šå¤åˆ¶å›¾å±‚çš„åˆå§‹ä½ç½®ä»¥åŠåˆå§‹è¯•å›¾å˜æ¢</code></p><p><code>@property(nullable) CGColorRef instanceColor; </code><code>// å¤åˆ¶å±‚é¢œè‰²ï¼Œè¯¥é¢œè‰²æ˜¯ä¸æœ¬ä½“å…ƒç´ è‰²å€¼ç›¸ä¹˜ï¼Œé¬¼çŸ¥é“æ˜¯ä»€ä¹ˆé¢œè‰²</code></p><p><code>@property float instanceRedOffset; </code><code>// å¤åˆ¶å±‚çº¢è‰²åç§»é‡</code></p><p><code>@property float instanceGreenOffset; </code><code>// å¤åˆ¶å±‚ç»¿è‰²åç§»é‡</code></p><p><code>@property float instanceBlueOffset; </code><code>// å¤åˆ¶å±‚è“è‰²åç§»é‡</code></p><p><code>@property float instanceAlphaOffset; </code><code>// å¤åˆ¶å±‚é€æ˜åº¦åç§»é‡</code></p><p><code>@end</code></p><p>å±æ€§è™½å°‘ï¼Œå˜åŒ–å¾ˆå¤§ï¼Œä¸»è¦æ˜¯äºæ ¸å¿ƒåŠ¨ç”»çš„å¼ºå¼ºè”åˆï¼Œä»–å°±æœ‰æ— é™çš„å¯èƒ½æ€§ï¼Œä¸‰ç§æ•ˆæœï¼Œæ‚¨ä¸Šçœ¼ï¼š</p><p>NO.1ï¼šæ·±å¤œç”µå°å¹¿æ’­</p><p><code>-(void)lineWave{</code></p><p><code></code><code>CAReplicatorLayer *replicatorLayer = [CAReplicatorLayer layer];</code></p><p><code></code><code>replicatorLayer.bounds = self.view.frame;</code></p><p><code></code><code>replicatorLayer.position = self.view.center;</code></p><p><code></code><code>[self.view.layer addSublayer:replicatorLayer];</code></p><p><code></code><code>//</code></p><p><code></code><code>CALayer *layer = [CALayer layer];</code></p><p><code></code><code>layer.backgroundColor = [UIColor redColor].CGColor;</code></p><p><code></code><code>layer.bounds = CGRectMake(0, 0, 10, 40);</code></p><p><code></code><code>layer.position = CGPointMake(50, self.view.center.y);</code></p><p><code></code><code>[replicatorLayer addSublayer:layer];</code></p><p><code></code><code>//</code></p><p><code></code><code>CABasicAnimation *basicAni = [CABasicAnimation animationWithKeyPath:@</code><code>"transform.scale.y"</code><code>];</code></p><p><code></code><code>basicAni.toValue = @(0.1);</code></p><p><code></code><code>basicAni.duration = 0.3;</code></p><p><code></code><code>basicAni.autoreverses = YES;</code></p><p><code></code><code>basicAni.repeatCount = NSIntegerMax;</code></p><p><code></code><code>[layer addAnimation:basicAni forKey:@</code><code>"layerPosition"</code><code>];</code></p><p><code></code><code>replicatorLayer.instanceCount = 8;</code></p><p><code></code><code>CATransform3D transform = CATransform3DIdentity;</code></p><p><code></code><code>transform = CATransform3DTranslate(transform, 40, 0, 0);</code></p><p><code></code><code>replicatorLayer.instanceTransform = transform;</code></p><p><code></code><code>replicatorLayer.instanceDelay = 0.3;</code></p><p><code>}</code></p><p>è¿è¡Œç»“æœï¼š</p><p><img alt=æ¥çœ‹çœ‹CALayeré‚£äº›ç‰›é€¼çš„å­ç±» onerror=errorimg.call(this); src=https://p9.pstatp.com/large/320c0000bb013503c633></p><p>NO. 2ï¼šå‚¬çœ ç­‰å¾…å°åœˆåœˆ</p><p><code>-(void)lineRoundRoll{</code></p><p><code></code><code>CAReplicatorLayer *replicatorLayer = [CAReplicatorLayer layer];</code></p><p><code></code><code>replicatorLayer.bounds = self.view.frame;</code></p><p><code></code><code>replicatorLayer.position = self.view.center;</code></p><p><code></code><code>[self.view.layer addSublayer:replicatorLayer];</code></p><p><code></code><code>//</code></p><p><code></code><code>CALayer *layer = [CALayer layer];</code></p><p><code></code><code>layer.backgroundColor = [UIColor redColor].CGColor;</code></p><p><code></code><code>layer.cornerRadius = 20;</code></p><p><code></code><code>layer.bounds = CGRectMake(0, 0, 40, 40);</code></p><p><code></code><code>layer.position = CGPointMake(50, self.view.center.y);</code></p><p><code></code><code>[replicatorLayer addSublayer:layer];</code></p><p><code></code><code>layer.transform = CATransform3DMakeScale(0.01, 0.01, 0.01);</code></p><p><code></code><code>//</code></p><p><code></code><code>CABasicAnimation *basicAni = [CABasicAnimation animationWithKeyPath:@</code><code>"transform.scale"</code><code>];</code></p><p><code></code><code>basicAni.fromValue = @(1);</code></p><p><code></code><code>basicAni.toValue = @(0.1);</code></p><p><code></code><code>basicAni.duration = 0.75;</code></p><p><code></code><code>basicAni.repeatCount = NSIntegerMax;</code></p><p><code></code><code>[layer addAnimation:basicAni forKey:@</code><code>"layerPosition"</code><code>];</code></p><p><code></code><code>replicatorLayer.instanceCount = 15;</code></p><p><code></code><code>replicatorLayer.preservesDepth = YES;</code></p><p><code></code><code>CATransform3D transform = CATransform3DIdentity;</code></p><p><code></code><code>transform = CATransform3DRotate(transform, M_PI * 2 / 15.0, 0, 0, 1);</code></p><p><code></code><code>replicatorLayer.instanceTransform = transform;</code></p><p><code></code><code>replicatorLayer.instanceDelay = 0.05;</code></p><p><code></code><code>replicatorLayer.instanceAlphaOffset = -1.0 / 15.0;</code></p><p><code></code><code>//replicatorLayer.instanceBlueOffset = 1.0 / 15;</code></p><p><code></code><code>//replicatorLayer.instanceColor = [UIColor redColor].CGColor;</code></p><p><code>}</code></p><p>è¿è¡Œç»“æœï¼š</p><p>NO.3ï¼šè·¯å¾„è·Ÿéš</p><p><code>-(void)followPathLayer{</code></p><p><code></code><code>UIBezierPath *path = [self followPath];</code></p><p><code></code><code>//</code></p><p><code></code><code>CAReplicatorLayer *replicatorLayer = [CAReplicatorLayer layer];</code></p><p><code></code><code>replicatorLayer.bounds = self.view.frame;</code></p><p><code></code><code>replicatorLayer.position = self.view.center;</code></p><p><code></code><code>[self.view.layer addSublayer:replicatorLayer];</code></p><p><code></code><code>//</code></p><p><code></code><code>CALayer *layer = [CALayer layer];</code></p><p><code></code><code>layer.backgroundColor = [UIColor redColor].CGColor;</code></p><p><code></code><code>layer.cornerRadius = 5;</code></p><p><code></code><code>layer.bounds = CGRectMake(0, 0, 10, 10);</code></p><p><code></code><code>layer.position = CGPointMake(20, self.view.center.y);</code></p><p><code></code><code>[replicatorLayer addSublayer:layer];</code></p><p><code></code><code>//</code></p><p><code></code><code>CAKeyframeAnimation *basicAni = [CAKeyframeAnimation animationWithKeyPath:@</code><code>"position"</code><code>];</code></p><p><code></code><code>basicAni.path = path.CGPath;</code></p><p><code></code><code>basicAni.duration = 3;</code></p><p><code></code><code>basicAni.repeatCount = NSIntegerMax;</code></p><p><code></code><code>[layer addAnimation:basicAni forKey:@</code><code>"layerPosition"</code><code>];</code></p><p><code></code><code>//</code></p><p><code></code><code>replicatorLayer.instanceCount = 15;</code></p><p><code></code><code>replicatorLayer.instanceDelay = 0.3;</code></p><p><code>}</code></p><p><code>-(UIBezierPath*)followPath{</code></p><p><code></code><code>//CAShapeLayer *shapeLayer = [CAShapeLayer layer];</code></p><p><code></code><code>UIBezierPath *path = [UIBezierPath bezierPath];</code></p><p><code></code><code>[path moveToPoint:CGPointMake(20, self.view.center.y)];</code></p><p><code></code><code>[path addCurveToPoint:CGPointMake(self.view.bounds.size.width - 20, self.view.center.y) controlPoint1:CGPointMake(130, self.view.center.y - 100) controlPoint2:CGPointMake(240, self.view.center.y + 100)];</code></p><p><code></code><code>[path closePath];</code></p><p><code></code><code>//shapeLayer.path = path.CGPath;</code></p><p><code></code><code>//shapeLayer.lineWidth = 5;</code></p><p><code></code><code>//shapeLayer.strokeColor = [UIColor grayColor].CGColor;</code></p><p><code></code><code>//shapeLayer.fillColor = [UIColor clearColor].CGColor;</code></p><p><code></code><code>//[self.view.layer addSublayer:shapeLayer];</code></p><p><code></code><code>return</code> <code>path;</code></p><p><code>}</code></p><p>è¿è¡Œç»“æœï¼š</p><p><img alt=æ¥çœ‹çœ‹CALayeré‚£äº›ç‰›é€¼çš„å­ç±» onerror=errorimg.call(this); src=https://p3.pstatp.com/large/32130002934cf1c3fb6d></p><p>è¿™å‡ ä¸ªæ•ˆæœåªæ˜¯æä¾›å‡ ä¸ªæ€è·¯ï¼ŒæŠ›ç –å¼•ç‰å•¦ã€‚ï¼ˆè¿™é¬¼å½•å±å¡å¸§åŠ æ¨¡ç³Šï¼Œå¤§å®¶å°†å°±ç€çœ‹ã€‚)</p><p><strong>CAScrollLayer</strong></p><p>ä¸€çœ‹åˆ°è¿™ä¸ªä½ ä¸€å®šæƒ³åˆ°äº†UIScrollViewï¼Œå…¶å®å®ƒä»¬å¹¶æ²¡æœ‰ä»€ä¹ˆåµå…³ç³»ï¼Œå¹¶ä¸”æˆ‘ä¸ªäººè§‰å¾—è¿™ä¸ªä¸œè¥¿å¥½åƒæ²¡æœ‰å¤ªå¤§çš„ç”¨å¤„ã€‚é¦–å…ˆï¼Œä»–æ²¡æœ‰æä¾›æœ‰å…³è¾¹ç•Œçš„ç›¸å…³æ€è·¯ï¼Œå¦å¤–ï¼Œä¹Ÿä¸èƒ½å“åº”äº¤äº’ã€‚åªæœ‰ä¸€ä¸‹æ»šåˆ°è¿™ï¼Œæ»šåˆ°é‚£çš„æ–¹æ³•ã€‚</p><p>åŒæ ·æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨è¿™ä¸ªæ–‡ä»¶ä¸‹ï¼Œè¿˜æœ‰ä¸ªCALayerçš„CALayerScrollingçš„åˆ†ç±»ï¼Œä¸è¦ä»¥ä¸ºå®ƒç»™CALayeræ·»åŠ äº†å¯æ»‘åŠ¨çš„æ–¹æ³•ï¼Œå…¶å®åªæ˜¯æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¯ç”¨çš„CAScrollLayerï¼Œå¹¶å°†åˆ¶å®šç‚¹æˆ–è€…æŒ‡å®šåŒºåŸŸæ»šåŠ¨åˆ°å¯è§†èŒƒå›´ã€‚</p><p>ä¸è¿‡ä¸ºäº†çœ‹ä¸€ä¸‹å®ƒçš„æ•ˆæœï¼Œä½¿å®ƒå“åº”æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨UIViewçš„å­ç±»æ¥è‡ªå·±å†™ä¸€ä¸ªç®€å•çš„ScrollViewï¼š</p><p><code>//</code></p><p><code>// YSScrollView.m</code></p><p><code>// CAScrollLayerDemo</code></p><p><code>//</code></p><p><code>// Created by ys on 2017/3/13.</code></p><p><code>// Copyright ? 2017å¹´ ys. All rights reserved.</code></p><p><code>//</code></p><p><code>#import "YSScrollView.h"</code></p><p><code>@implementation YSScrollView</code></p><p><code>+ (Class)layerClass</code></p><p><code>{</code></p><p><code></code><code>return</code> <code>[CAScrollLayer class];</code></p><p><code>}</code></p><p><code>- (void)setUp</code></p><p><code>{</code></p><p><code></code><code>self.layer.masksToBounds = YES;</code></p><p><code></code><code>//</code></p><p><code></code><code>UIPanGestureRecognizer *panGes = [[UIPanGestureRecognizer alloc] initWithTarget:self action:@selector(panAction:)];</code></p><p><code></code><code>[self addGestureRecognizer:panGes];</code></p><p><code>}</code></p><p><code>- (id)initWithFrame:(CGRect)frame</code></p><p><code>{</code></p><p><code></code><code>if</code> <code>((self = [</code><code>super</code> <code>initWithFrame:frame])) {</code></p><p><code></code><code>[self setUp];</code></p><p><code></code><code>}</code></p><p><code></code><code>return</code> <code>self;</code></p><p><code>}</code></p><p><code>- (void)panAction:(UIPanGestureRecognizer *)pan</code></p><p><code>{</code></p><p><code></code><code>CGPoint offset = self.bounds.origin;</code></p><p><code></code><code>offset.x -= [pan translationInView:self].x;</code></p><p><code></code><code>offset.y -= [pan translationInView:self].y;</code></p><p><code></code><code>//</code></p><p><code></code><code>[(CAScrollLayer *)self.layer scrollToPoint:offset];</code></p><p><code></code><code>//</code></p><p><code></code><code>[pan setTranslation:CGPointZero inView:self];</code></p><p><code>}</code></p><p><code>@end</code></p><p><code>ç„¶åè°ƒç”¨åŠ è½½ä¸€å¼ å¤§å›¾ï¼š</code></p><p><code>- (void)viewDidLoad {</code></p><p><code></code><code>[</code><code>super</code> <code>viewDidLoad];</code></p><p><code></code><code>// Do any additional setup after loading the view, typically from a nib.</code></p><p><code></code><code>YSScrollView *ysSView = [[YSScrollView alloc] initWithFrame:self.view.bounds];</code></p><p><code></code><code>UIImageView* imageView = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, 700, 1040)];</code></p><p><code></code><code>imageView.image = [UIImage imageNamed:@</code><code>"0101010.jpg"</code><code>];</code></p><p><code></code><code>[self.view addSubview:ysSView];</code></p><p><code></code><code>[ysSView addSubview:imageView];</code></p><p><code>}</code></p><p>è¿è¡Œç»“æœï¼š</p><p>æˆ‘ä»¬å‘ç°ï¼Œå…¶å®ä»–å¹¶æ²¡æœ‰æ»‘åŠ¨åŒºåŸŸçš„é™åˆ¶ï¼Œæœ¬äººæ‰ç–å­¦æµ…ï¼Œæœ›é«˜äººæŒ‡ç‚¹ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªä¸œè¥¿ã€‚</p><p><img alt=æ¥çœ‹çœ‹CALayeré‚£äº›ç‰›é€¼çš„å­ç±» onerror=errorimg.call(this); src=https://p3.pstatp.com/large/321200046199b2f9e67e></p><p>CATiledLayer</p><p>ä¸€ä¸ªå¤§ç¥å¿…å¤‡çš„Layerå­ç±»ï¼Œä¸ºèŠ‚çœå†…å­˜æ¸²æŸ“å¼€é”€æä¾›äº†é€”å¾„ã€‚æ¯”å¦‚æˆ‘ä»¬è¦å»åŠ è½½ä¸€ä¸ªä¸–ç•Œåœ°å›¾ï¼Œç²¾ç¡®åˆ°ä½ ä»¬æ‘çš„é‚£ç§ï¼Œå¦‚æœå…¨éƒ¨ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¿™æ— ç–‘æ˜¯åƒä¸æ¶ˆçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠåœ°å›¾ä¸€ç‰‡ç‰‡åˆ‡å¼€ï¼Œç„¶åæŒ‰éƒ¨åˆ†åŠ è½½ï¼Œå¤§å®¶è”æƒ³ä¸€ä¸‹åœ°å›¾åº”ç”¨ï¼Œåº”è¯¥å°±çŸ¥é“å¤§è‡´æ˜¯ä»€ä¹ˆæ•ˆæœã€‚æˆ‘ä»¬ç›´æ¥ä¸Šä»£ç ï¼š</p><p><code>#import "ViewController.h"</code></p><p><code>@interface ViewController ()</code></p><p><code>@property (nonatomic, strong) UIScrollView *scrollView;</code></p><p><code>@end</code></p><p><code>@implementation ViewController</code></p><p><code>- (void)viewDidLoad {</code></p><p><code></code><code>[</code><code>super</code> <code>viewDidLoad];</code></p><p><code></code><code>//</code></p><p><code></code><code>CATiledLayer *tileLayer = [CATiledLayer layer];</code></p><p><code></code><code>tileLayer.frame = CGRectMake(0, 0, self.view.frame.size.width * 4, self.view.frame.size.height * 4);</code></p><p><code></code><code>tileLayer.tileSize = self.view.frame.size;</code></p><p><code></code><code>tileLayer.delegate = self;</code></p><p><code></code><code>//</code></p><p><code></code><code>self.scrollView = [[UIScrollView alloc] initWithFrame:self.view.bounds];</code></p><p><code></code><code>[self.view addSubview:_scrollView];</code></p><p><code></code><code>self.scrollView.contentSize = tileLayer.frame.size;</code></p><p><code></code><code>[self.scrollView.layer addSublayer:tileLayer];</code></p><p><code></code><code>//</code></p><p><code></code><code>[tileLayer setNeedsDisplay];</code></p><p><code>}</code></p><p><code>-(void)drawLayer:(CATiledLayer *)layer inContext:(CGContextRef)ctx{</code></p><p><code></code><code>CGRect bounds = CGContextGetClipBoundingBox(ctx);</code></p><p><code></code><code>NSInteger x = floor(bounds.origin.x / layer.tileSize.width);</code></p><p><code></code><code>NSInteger y = floor(bounds.origin.y / layer.tileSize.height);</code></p><p><code></code><code>//</code></p><p><code></code><code>NSString *imageName = [NSString stringWithFormat: @</code><code>"image_%@_%@"</code><code>, @(x), @(y)];</code></p><p><code></code><code>NSString *imagePath = [[NSBundle mainBundle] pathForResource:imageName ofType:@</code><code>"jpg"</code><code>];</code></p><p><code></code><code>UIImage *tileImage = [UIImage imageWithContentsOfFile:imagePath];</code></p><p><code></code><code>//</code></p><p><code></code><code>UIGraphicsPushContext(ctx);</code></p><p><code></code><code>[tileImage drawInRect:bounds];</code></p><p><code></code><code>UIGraphicsPopContext();</code></p><p><code>}</code></p><p><code>- (void)didReceiveMemoryWarning {</code></p><p><code></code><code>[</code><code>super</code> <code>didReceiveMemoryWarning];</code></p><p><code></code><code>// Dispose of any resources that can be recreated.</code></p><p><code>}</code></p><p>@end</p><p>è¿è¡Œç»“æœï¼š</p><p>å…¶å®æ–°åŠ è½½çš„å›¾åƒç¢ç‰‡éƒ½æ˜¯æ·¡å…¥åˆ°ç•Œé¢çš„ï¼ˆä¸‡æ¶çš„å½•å±è½¯ä»¶ï¼Œæ ¹æœ¬çœ‹ä¸å‡ºæ¥ï¼‰ã€‚è¿™æ˜¯ç³»ç»Ÿè‡ªå·±å¸¦çš„é»˜è®¤æ•ˆæœï¼Œä½ å¯ä»¥é€šè¿‡è°ƒèŠ‚fadeDurationå±æ€§æ¥ä¿®æ”¹æ”¹æ·¡å…¥åŠ¨ç”»çš„æ—¶é•¿ã€‚</p><p><strong>CATextLayer</strong></p><p>æˆ‘ä»¬è¿˜æ˜¯ä»ç³»ç»Ÿæä¾›çš„APIå…¥æ‰‹ï¼š</p><p><code>@property(nullable, copy) id string; </code><code>//æ˜¾ç¤ºå†…å®¹</code></p><p><code>@property(nullable) CFTypeRef font; </code><code>//å­—ä½“</code></p><p><code>@property CGFloat fontSize; </code><code>//å­—å·</code></p><p><code>@property(nullable) CGColorRef foregroundColor; </code><code>//æ–‡å­—é¢œè‰²</code></p><p><code>@property(getter=isWrapped) BOOL wrapped;</code><code>//æ˜¯å¦è‡ªé€‚åº”layerçš„boundsçš„å¤§å°</code></p><p><code>@property(copy) NSString *truncationMode;</code><code>//æ–‡å­—çœç•¥æ–¹å¼ï¼Œå…¶å®å°±æ˜¯æ˜¾ç¤ºä¸ä¸‹æ—¶çœç•¥å·çš„ä½ç½®</code></p><p><code>@property(copy) NSString *alignmentMode;</code><code>// å¯¹é½æ–¹å¼</code></p><p>æˆ‘ä»¬æ¥ç”¨å®ƒæ˜¾ç¤ºä¸€æ®µæ–‡å­—ï¼Œä½ å¯ä»¥è‡ªç”±ä¿®æ”¹ä¸€ä¸‹å®ƒçš„å±æ€§æ¥ç†Ÿæ‚‰æ¯ä¸ªå±æ€§çš„ä½œç”¨ï¼š</p><p><code>- (void)viewDidLoad {</code></p><p><code></code><code>[</code><code>super</code> <code>viewDidLoad];</code></p><p><code></code><code>// Do any additional setup after loading the view, typically from a nib.</code></p><p><code></code><code>//</code></p><p><code></code><code>CATextLayer *textLayer = [CATextLayer layer];</code></p><p><code></code><code>textLayer.bounds = CGRectMake(0, 0, 200, 200);</code></p><p><code></code><code>textLayer.position = self.view.center;</code></p><p><code></code><code>[self.view.layer addSublayer:textLayer];</code></p><p><code></code><code>textLayer.foregroundColor = [UIColor blackColor].CGColor;</code></p><p><code></code><code>textLayer.alignmentMode = kCAAlignmentLeft;</code></p><p><code></code><code>textLayer.wrapped = YES;</code></p><p><code></code><code>//ä»¥Retinaæ–¹å¼æ¥æ¸²æŸ“ï¼Œé˜²æ­¢ç”»å‡ºæ¥çš„æ–‡æœ¬æ¨¡ç³Š</code></p><p><code></code><code>textLayer.contentsScale = [UIScreen mainScreen].scale;</code></p><p><code></code><code>textLayer.truncationMode = kCATruncationEnd;</code></p><p><code></code><code>UIFont *font = [UIFont systemFontOfSize:15];</code></p><p><code></code><code>CFStringRef fontName = (__bridge CFStringRef)font.fontName;</code></p><p><code></code><code>CGFontRef fontRef = CGFontCreateWithFontName(fontName);</code></p><p><code></code><code>textLayer.font = fontRef;</code></p><p><code></code><code>textLayer.fontSize = font.pointSize;</code></p><p><code></code><code>CGFontRelease(fontRef);</code></p><p><code></code><code>NSString *text = @</code><code>"Age has reached the end of the beginning of a word. May be guilty in his seems to passing a lot of different life became the appearance of the same day; May be back in the past, to oneself the paranoid weird belief disillusionment, these days, my mind has been very messy, in my mind constantly. Always feel oneself should go to do something, or write something. Twenty years of life trajectory deeply shallow, suddenly feel something, do it."</code><code>;</code></p><p><code></code><code>textLayer.string = text;</code></p><p><code>}</code></p><p>è¿è¡Œç»“æœï¼š</p><p><img alt=æ¥çœ‹çœ‹CALayeré‚£äº›ç‰›é€¼çš„å­ç±» onerror=errorimg.call(this); src=https://p9.pstatp.com/large/32130002934bdf39797d></p><p><strong>CAEAGLLayerï¼ŒAVPlayerLayer</strong></p><p>CAEAGLLayerçœ‹èµ·æ¥å°±å¾ˆé«˜å¤§ä¸Šï¼Œå…¶å®çœŸçš„æŒºé«˜å¤§ä¸Šçš„ï¼Œæ²¡æœ‰OpenGLçŸ¥è¯†åŸºç¡€çš„å¾ˆéš¾ç†è§£æ›´ä¸ç”¨è¯´ä½¿ç”¨äº†ï¼Œå“ªå¤©ï¼Œç­‰æˆ‘å­¦ä¼šfreeStyleï¼Œæˆ‘å”±ç»™ä½ å¬ï¼Œå‘¦ï¼Œå‘¦ã€‚ï¼ˆä½ å†™ä»£ç æœ‰freeStyleå—ï¼Ÿï¼‰</p><p><img alt=æ¥çœ‹çœ‹CALayeré‚£äº›ç‰›é€¼çš„å­ç±» onerror=errorimg.call(this); src=https://p1.pstatp.com/large/322d00042e7740b57f57></p><p>AVPlayerLayerå®ƒå±äºAVFoundationæ¡†æ¶ï¼Œä¸ç”¨æ€€ç–‘ï¼Œå®ƒå°±æ˜¯ç”¨æ¥æ’­æ”¾è§†é¢‘çš„ï¼Œ+ (AVPlayerLayer *)playerLayerWithPlayer:(nullable AVPlayer *)player;å®ƒçš„åˆå§‹åŒ–ä¾èµ–äºAVPlayerï¼Œå½“ç„¶ï¼Œå®ƒæ—¢ç„¶æ˜¯CALayerçš„å­ç±»ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹å®ƒè¿›è¡Œé…·ç‚«çš„æ•ˆæœå˜æ¢ï¼ŒåŒæ ·ä¹Ÿå…‹æœäº†ç³»ç»Ÿæä¾›çš„æ’­æ”¾å™¨ç”±äºé«˜åº¦çš„å°è£…æ€§ï¼Œ ä½¿å¾—è‡ªå®šä¹‰æ’­æ”¾å™¨å˜çš„å¾ˆéš¾çš„é—®é¢˜ã€‚æ”¹å¤©ï¼Œä½ æœ‰éœ€æ±‚ï¼Œæˆ‘æœ‰æ—¶é—´ï¼Œä¸å¦‚æˆ‘ä»¬å†™ä¸€ä¸ªæ’­æ”¾å™¨å•Šã€‚</p><p><img alt=æ¥çœ‹çœ‹CALayeré‚£äº›ç‰›é€¼çš„å­ç±» onerror=errorimg.call(this); src=https://p1.pstatp.com/large/32120004619be2ebaf72></p><p><strong>æ€»ç»“</strong></p><p>CALayerçš„æ‰€æœ‰å­ç±»éƒ½è¯´å®Œäº†ï¼Œå¸Œæœ›åœ¨ä¸€å®šçš„ç¨‹åº¦ä¸Šèƒ½ç»™ä½ çš„å¼€å‘å¸¦æ¥æ–¹ä¾¿ï¼Œä»…æ­¤è€Œå·²ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ã€‚</p><p>åˆšæ‰è¯´åˆ°çš„æ’­æ”¾å™¨çš„éœ€æ±‚å¤§æ¦‚åº”è¯¥å¿…éœ€å°±æ˜¯è¿™æ ·çš„ï¼</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'CALayer','å­ç±»','çœ‹çœ‹'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>