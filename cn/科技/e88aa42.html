<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>java日志规约及配置示例终极总结 | 极客快訊</title><meta property="og:title" content="java日志规约及配置示例终极总结 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/0c37161f872e469b9ce6b306c9ae6042"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e88aa42.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e88aa42.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e88aa42.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e88aa42.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e88aa42.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e88aa42.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e88aa42.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e88aa42.html><meta property="article:published_time" content="2020-10-29T21:01:26+08:00"><meta property="article:modified_time" content="2020-10-29T21:01:26+08:00"><meta name=Keywords content><meta name=description content="java日志规约及配置示例终极总结"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/e88aa42.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>java日志规约及配置示例终极总结</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1 class=ql-align-justify><strong>1、什么是日志？</strong></h1><p class=ql-align-justify>简单的说，日志就是记录程序的运行轨迹，方便查找关键信息，也方便快速定位解决问题。我们 Java 程序员在开发项目时都是依赖 Eclipse/ Idea 等开发工具的 Debug 调试功能来跟踪解决 Bug，在开发环境可以这么做，但项目发布到了测试、生产环境呢？你有可能会说可以使用远程调试，但实际并不能允许让你这么做。所以，日志的作用就是在测试、生产环境没有 Debug 调试工具时开发、测试人员定位问题的手段。日志打得好，就能根据日志的轨迹快速定位并解决线上问题，反之，日志输出不好不能定位到问题不说反而会影响系统的性能。优秀的项目都是能根据日志定位问题的，而不是在线调试，或者半天找不到有用的日志。</p><h1 class=ql-align-justify><strong>2、常用日志框架</strong></h1><p class=ql-align-justify>如果想学习Java工程化、高性能及分布式、深入浅出。微服务、Spring，MyBatis，Netty源码分析的朋友可以加我的Java高级交流：854630135，群里有阿里大牛直播讲解技术，以及Java大型互联网技术的视频免费分享给大家。</p><p class=ql-align-justify>log4j、Logging、commons-logging、slf4j、logback，开发的同学对这几个日志相关的技术不陌生吧，为什么有这么多日志技术，它们都是什么区别和联系呢？相信大多数人搞不清楚它们的关系，下面我将一一介绍一下，以后大家再也不用傻傻分不清楚了。</p><p class=ql-align-justify><strong>Logging 【java 自带工具】</strong></p><p class=ql-align-justify>这是 Java 自带的日志工具类，在 JDK 1.5 开始就已经有了，在java.util.logging 包下。</p><p class=ql-align-justify><strong>Log4j 【框架实现】</strong></p><p class=ql-align-justify>Log4j 是 Apache 的一个开源日志框架，也是市场占有率最多的一个框架。大多数没用过 Java Logging， 但没人敢说没用过 Log4j 吧，反正从我接触 Java 开始就是这种情况，做 Java 项目必有 Log4j 日志框架。注意：log4j 在 2015/08/05 这一天被 Apache 宣布停止维护了，用户需要切换到 Log4j2上面去。</p><p class=ql-align-justify><em>下面是官方宣布原文</em></p><p class=ql-align-justify>On August 5, 2015 the Logging Services Project Management Committee announced that Log4j 1.x had reached end of life. For complete text of the announcement please see the Apache Blog. Users of Log4j 1 are recommended to upgrade to Apache Log4j 2.</p><p class=ql-align-justify><strong>Commons-logging 【日志接口】</strong></p><p class=ql-align-justify>上面介绍的 log4j 是一个具体的日志框架的实现，而 commons-logging 就是日志门面接口，它也是 apache 最早提供的日志门面接口，用户可以根据喜好选择不同的日志实现框架，而不必改动日志定义，这就是日志门面的好处，符合面向接口抽象编程。</p><p class=ql-align-justify><strong>Slf4j 【日志接口】</strong></p><p class=ql-align-justify>全称：Simple Logging Facade for Java，即简单日志门面接口，和 Apache 的 commons-logging是一样的概念，它们都不是具体的日志框架，你可以指定其他主流的日志实现框架。Slf4j也是现在主流的日志门面框架，使用Slf4j可以很灵活的使用占位符进行参数占位，简化代码，拥有更好的可读性，这个后面会讲到。</p><p class=ql-align-justify><strong>Logback 【框架实现】</strong></p><p class=ql-align-justify>Logback 是 Slf4j 的原生实现框架，同样也是出自 Log4j一个人之手，但拥有比log4j更多的优点、特性和更做强的性能，现在基本都用来代替 log4j 成为主流。</p><p class=ql-align-justify><strong>日志框架总结</strong></p><ol><li class=ql-align-justify>commons-loggin、slf4j 只是一种日志抽象门面，不是具体的日志框架。</li><li class=ql-align-justify>log4j、logback 是具体的日志实现框架。</li><li class=ql-align-justify>一般首选强烈推荐使用 slf4j + logback。当然也可以使用slf4j + log4j、commons-logging + log4j 这两种日志组合框架。</li></ol><h1 class=ql-align-justify><strong>3、日志级别详解</strong></h1><p class=ql-align-justify>日志的输出都是分级别的，不同的设置不同的场合打印不同的日志。下面拿最普遍用的 Log4j 日志框架来做个日志级别的说明，这个也比较全面，其他的日志框架也都大同小异。Log4j 的级别类 org.apache.log4j.Level 里面定义了日志级别，日志输出优先级由高到底分别为以下8种。</p><p class=ql-align-justify><strong>日志级别及描述</strong></p><ul><li class=ql-align-justify>ERROR：系统发生了错误事件，但仍然不影响系统的继续运行。系统需要将错误或异常细节记录ERROR日志中，方便后续人工回溯解决。</li><li class=ql-align-justify>WARN： 系统在业务处理时触发了异常流程(参数验证不过)，但系统可恢复到正常态，下一次业务可以正常执行。如程序调用了一个旧版本的接口，可选参数不合法，非业务预期的状态但仍可继续处理等</li><li class=ql-align-justify>INFO： 记录系统关键信息，旨在保留系统正常工作期间关键运行指标，开发人员可以将初始化系统配置、业务状态变化信息，或者用户业务流程中的核心处理记录到INFO日志中，方便日常运维工作以及错误回溯时上下文场景复现</li><li class=ql-align-justify>DEBUG： 可以将各类详细信息记录到DEBUG里，起到调试的作用，包括参数信息，调试细节信息，返回值信息等。</li></ul><p class=ql-align-justify><strong>日志优先级别标准顺序</strong></p><p class=ql-align-justify>ALL &lt; TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL &lt; OFF</p><p class=ql-align-justify><strong>设置级别和打印级别的关系</strong></p><p class=ql-align-justify>如果日志级别设置 INFO，只有输出级别为 INFO、WARN，后面的日志才会正常输出。</p><h1 class=ql-align-justify><strong>4、日志的记录时机</strong></h1><p class=ql-align-justify><strong>系统初始化</strong></p><p class=ql-align-justify>系统初始化时会依赖一些关键配置，根据参数不同会提供不一样的服务。将系统的启动参数记录INFO日志，打印出参数以及服务启动完成状态。</p><p class=ql-align-justify><strong>业务流程与预期不符</strong></p><p class=ql-align-justify>系统中结果与期望不符，应当记录日志。常见的合适场景包括外部参数不正确，数据处理问题导致返回码不在合理范围内等等。</p><p class=ql-align-justify><strong>系统核心的关键动作</strong></p><p class=ql-align-justify>系统中核心角色触发的业务动作是需要多加关注的，是衡量系统正常运行的重要指标，建议记录INFO级别日志，比如微服务各服务节点交互等。</p><p class=ql-align-justify><strong>捕获到异常时</strong></p><p class=ql-align-justify>这类捕获的异常是系统告知开发人员需要加以关注的，应当记录日志，根据实际情况使用warn或者error级别。</p><p class=ql-align-justify><strong>外部接口日志</strong></p><p class=ql-align-justify>这类日志涉及到与外部系统的交互，事关责任问题，建议将原始数据文件内容写入日志或数据库（如mongodb），核心处理逻辑关键业务数据也尽量写入日志。如果涉及到重发，建议将处理失败的原始数据文件日志写入数据库，以便重发执行。</p><h1 class=ql-align-justify><strong>5、日志使用规约</strong></h1><ul><li class=ql-align-justify>使用@SLF4J中的API进行日志打印。</li><li class=ql-align-justify>日志输出必须采用UTF-8字符集，推荐打印日志时输出英文，防止中文不支持而打印出乱码的情况。</li><li class=ql-align-justify>不允许记录日志后又抛出异常，因为这样会多次记录日志，只允许记录一次日志，应抛出异常，顶层打印一次日志。</li></ul><p class=ql-align-right><br></p><pre>try { // 错误} catch (Exception e) { log.error("xxxxxx", e); throw e；}</pre><ul><li class=ql-align-justify>输出Exceptions的全部堆栈信息，但是不能使用e.printStackTrace()</li></ul><p class=ql-align-right><br></p><pre>// 错误例子, 丢失掉StackTrace信息log.error(e.getMessage());// 错误例子,丢失掉StackTrace信息log.error(“Bad things : {}“, e.getMessage());// 正确例子log.error(“Bad things : {}“,e); // e.printStackTrace()的源码public void printStackTrace() { printStackTrace(System.err);}</pre><ul><li class=ql-align-justify>禁止system.out 用于日志记录。</li><li class=ql-align-justify>线上必须关闭 DEBUG 级别日志。</li><li class=ql-align-justify>非正常的情况，需要根据情况选择打印warn 或 error 日志,不能使用错误的日志级别。</li></ul><p class=ql-align-right><br></p><pre>try {// ...} catch (Exception e) {// 错误LOG.info("XX 发生异常...", e);}// 用 info 记录 error 日志，日志输出到了 info 日志文件中了，</pre><p>同事拼命地在 error 错误日志文件里 面找怎么能找到呢？</p><ul><li class=ql-align-justify>日志输出，必须使用占位符的方式，因为即使信息不打印，也会执行字符串拼接，造成资源浪费。</li><li class=ql-align-justify>日志中不允许出现计算或方法调用，防止在打印日志的时候报错。</li><li class=ql-align-justify>输出的POJO类必须重写toString方法，否则只输出对象的hashCode值，没有参考意义。</li></ul><pre class=ql-align-justify>不记录对于排查故障毫无意义的日志信息，日志信息一定要带有业务信息。//错误log.error(“handle failed“);//正确log.error(“handle failed，id= {}“, id);</pre><ul><li class=ql-align-justify>禁止大量无效重复的日志输出，通常情况下在程序日志只记录一些有意义的状态数据，参考日志记录时机。</li><li class=ql-align-justify>不可以讲敏感业务信息记录入日志文件。</li><li class=ql-align-justify>严防日志占满磁盘，定期检查磁盘（确定是否有磁盘告警）。</li><li class=ql-align-justify>不要在千层循环中打印日志</li></ul><pre>for(int i=0; i&lt;2000; i++){LOG.info("XX");}</pre><p>// 这个是什么意思，如果你的框架使用了性能不高的 Log4j 框架，</p><p>那就不要在上千个 for 循环中打印日志，</p><p>// 这样可能会拖垮你的应用程序，如果你的程序响应时间变慢，</p><p>那要考虑是不是日志打印的过多了。</p><h1 class=ql-align-justify><strong>6、logback配置参考</strong></h1><p class=ql-align-justify><strong>配置说明</strong></p><ul><li class=ql-align-justify>统一使用logback.xml配置，logback.xml 文件放在 classpath 目录下。</li><li class=ql-align-justify>所有的jar包中不建议包含logback.xml文件，避免干扰实际的业务系统。</li><li class=ql-align-justify>通过在文件logback.xml中引入资源文件log.properties定义logback属性信息，log.properties根据不同的profile放置在不同位置；</li></ul><pre>&lt;property resource="log.properties"/&gt;</pre><ul><li class=ql-align-justify>log.properties文件</li><li class=ql-align-justify>属性命名推荐使用统一使用大写，以下划线分隔，参考</li></ul><p class=ql-align-right>如果想学习Java工程化、高性能及分布式、深入浅出。微服务、Spring，MyBatis，Netty源码分析的朋友可以加我的Java高级交流：854630135，群里有阿里大牛直播讲解技术，以及Java大型互联网技术的视频免费分享给大家。</p><pre>APP_NAME = yourAppNameLOG_DIR = /export/home/logs/yourSystem/yourAppNameLOG_PATTERN = [%date{yyyy-MM-dd HH:mm:ss.SSS}] %level [%mdc{invokeNo}] %C{0}:%line - %message%n</pre><ul><li class=ql-align-justify>注意Logger间的继承关系，推荐additivity设置false;</li></ul><ol><li class=ql-align-justify>子logger会默认继承父logger的appender，将它们加入到自己的Appender中；除非加上了additivity="false"，则不再继承父logger的appender。</li><li class=ql-align-justify>子logger只在自己未定义输出级别的情况下，才会继承父logger的输出级别。</li></ol><ul><li class=ql-align-justify>将日志输出到文件当中，禁止使用FileAppender，推荐使用提供自动切换功能的RollingFileAppender Log文件位置和命名，目前Log文件的位置统一放在相同目录下面。</li></ul><div class=pgc-img><img alt=java日志规约及配置示例终极总结 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0c37161f872e469b9ce6b306c9ae6042><p class=pgc-img-caption></p></div><ul><li class=ql-align-justify>日志按天记录，单个日志文件最大不超过2000MB，考虑到有些bug按月规律出现，推荐历史日志保留30天。</li></ul><p class=ql-align-justify><br></p><pre class=ql-align-justify>&lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;　　&lt;fileNamePattern&gt;${LOG_DIR}/all-%d{yyyy-MM-dd}.log&lt;/fileNamePattern&gt;　　&lt;maxHistory&gt;30&lt;/maxHistory&gt;　　&lt;timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"&gt;　　&lt;maxFileSize&gt;2000MB&lt;/maxFileSize&gt;　　&lt;/timeBasedFileNamingAndTriggeringPolicy&gt;&lt;/rollingPolicy&gt;</pre><p class=ql-align-justify><br></p><ul><li class=ql-align-justify>在出现问题之后，需要立即根据日志定位问题。对于INFO及以上级别的日志，要求按照一定顺序，输出以下必要的信息。参考日志格式定义</li></ul><pre class=ql-align-justify>&lt;encoder charset="UTF-8"&gt;　　&lt;pattern&gt;[%date{yyyy-MM-dd HH:mm:ss.SSS}] %level 　　[%mdc{invokeNo}] %C{0}:%line - %message%n&lt;/pattern&gt;&lt;/encoder&gt;</pre><ul><li class=ql-align-justify>一个完整的Appender配置如下</li></ul><p class=ql-align-justify><br></p><pre class=ql-align-justify>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;configuration&gt;　　&lt;property resource="log.properties"/&gt; 　　&lt;contextName&gt;${APP_NAME}&lt;/contextName&gt; 　　&lt;appender name="console" class="ch.qos.logback.core.ConsoleAppender"&gt;　　　　&lt;encoder charset="UTF-8"&gt;　　　　　　&lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt;　　　　&lt;/encoder&gt;　　&lt;/appender&gt;&lt;appender name="all" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;　　&lt;file&gt;${LOG_DIR}/all.log&lt;/file&gt;　　&lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;　　　　&lt;fileNamePattern&gt;${LOG_DIR}/all-%d{yyyy-MM-dd}.%i.log&lt;/fileNamePattern&gt;　　　　&lt;maxHistory&gt;30&lt;/maxHistory&gt;　　　　&lt;timeBasedFileNamingAndTriggeringPolicy 　　　　　　class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"&gt; 　　　　　　&lt;maxFileSize&gt;2000MB&lt;/maxFileSize&gt; &lt;!-- 每个日志文件大小不超过2GB --&gt;　　　　&lt;/timeBasedFileNamingAndTriggeringPolicy&gt;　　&lt;/rollingPolicy&gt;　　&lt;encoder charset="UTF-8"&gt;　　　　&lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt;　　&lt;/encoder&gt;　　&lt;filter class="ch.qos.logback.classic.filter.ThresholdFilter"&gt;　　　　&lt;level&gt;info&lt;/level&gt;　　&lt;/filter&gt;&lt;/appender&gt;&lt;appender name="all-error" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;　　&lt;file&gt;${LOG_DIR}/all-error.log&lt;/file&gt;　　&lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt;　　　　&lt;level&gt;ERROR&lt;/level&gt;　　　　&lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;　　　　&lt;onMismatch&gt;DENY&lt;/onMismatch&gt;　　&lt;/filter&gt;　　&lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;　　　　&lt;fileNamePattern&gt;　　　　　　${LOG_DIR}/all-error-%d{yyyy-MM-dd}.%i.log 　　　　&lt;/fileNamePattern&gt;　　　　&lt;maxHistory&gt;30&lt;/maxHistory&gt;　　　　&lt;timeBasedFileNamingAndTriggeringPolicy　　　　　 class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"&gt;　　　　　　&lt;!-- 每个日志文件大小不超过2GB --&gt;　　　　　　&lt;maxFileSize&gt;2000MB&lt;/maxFileSize&gt;　　　　&lt;/timeBasedFileNamingAndTriggeringPolicy&gt;　　&lt;/rollingPolicy&gt;　　&lt;encoder charset="UTF-8"&gt;　　　　&lt;pattern&gt;　　　　　　[%date{yyyy-MM-dd HH:mm:ss.SSS}] %level [%mdc{invokeNo}] %C{0}:%line - %message%n　　　　&lt;/pattern&gt;　　&lt;/encoder&gt;&lt;/appender&gt;&lt;root level="debug"&gt;　　&lt;appender-ref ref="all"/&gt;　　&lt;appender-ref ref="all-error"/&gt;　　&lt;appender-ref ref="console"/&gt;&lt;/root&gt;&lt;/configuration&gt;</pre><p class=ql-align-justify><br></p><h1 class=ql-align-justify><strong>7、Log4j2配置参考</strong></h1><p class=ql-align-justify><strong>配置说明</strong></p><ul><li class=ql-align-justify>统一使用log4j2.xml配置，log4j2.xml 文件放在 resource目录下。</li><li class=ql-align-justify>注意Logger间的继承关系，推荐additivity设置false：</li></ul><ol><li class=ql-align-justify>子logger会默认继承父logger的appender，将它们加入到自己的Appender中；除非加上了additivity="false"，则不再继承父logger的appender。</li><li class=ql-align-justify>子logger只在自己未定义输出级别的情况下，才会继承父logger的输出级别。</li></ol><ul><li class=ql-align-justify>将日志输出到文件当中，考虑到RollingRandomAccessFile比RollingFile更灵活，推荐统一使用RollingRandomAccessFile。</li><li class=ql-align-justify>Log文件位置和命名，目前Log文件的位置统一放在相同目录下面。</li></ul><div class=pgc-img><img alt=java日志规约及配置示例终极总结 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/50cd5d68b16741089384603af9d97b0c><p class=pgc-img-caption></p></div><ul><li class=ql-align-justify>日志按天记录，单个日志文件最大不超过3000MB，考虑到有些bug按周规律出现，推荐历史日志保留14天。</li></ul><p class=ql-align-justify><br></p><pre class=ql-align-justify>&lt;RollingRandomAccessFile name="all-append" immediateFlush="true" 　　　　fileName="${LOG_DIR}/all.log" filePattern="${LOG_DIR}/all-%d{yyyy-MM-dd}-%i.log"&gt;&lt;Policies&gt;&lt;SizeBasedTriggeringPolicy size="3GB" /&gt;&lt;TimeBasedTriggeringPolicy interval="8" modulate="true" /&gt;&lt;!-- 最多备份14天以内||日志文件大小达到50GB的日志||文件数量超过20此处为策略限制，　　　　Delete中可以按自己需要用正则表达式编写 --&gt;&lt;DefaultRolloverStrategy&gt;　　&lt;Delete basePath="${filePath}" maxDepth="1"&gt;　　　　&lt;IfLastModified age="14d" /&gt;　　　　&lt;IfAccumulatedFileSize exceeds="50 GB" /&gt;　　　　&lt;IfAccumulatedFileCount exceeds="20" /&gt;　　&lt;/Delete&gt;&lt;/DefaultRolloverStrategy&gt;</pre><p class=ql-align-justify><br></p><ul><li class=ql-align-justify>在出现问题之后，需要立即根据日志定位问题。对于INFO及以上级别的日志，要求按照一定顺序，输出以下必要的信息。参考日志格式定义</li></ul><pre class=ql-align-justify>&lt;PatternLayout&gt;　　&lt;Pattern&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level [%mdc{invokeNo}] %C{2}:%L %M - %msg%n　　&lt;/Pattern&gt;&lt;/PatternLayout&gt;</pre><ul><li class=ql-align-justify>一个完整的Appender配置如下</li></ul><p class=ql-align-justify><br></p><pre class=ql-align-justify>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;!-- Configuration后面的status，这个用于设置log4j2自身内部的信息输出，可以不设置，当设置成trace时，　　你会看到log4j2内部各种详细输出。monitorInterval：Log4j能够自动检测修改配置文件和重新配置本身，　　设置间隔秒数。--&gt;&lt;configuration status="OFF" monitorInterval=”600″&gt;&lt;properties&gt;　　&lt;property name="LOG_PATH"&gt;/export/home/logs/yourSystem/yourAppName&lt;/property&gt;　　&lt;property name="LOG_PATTERN"&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level [%mdc{invokeNo}]　　　　　　　　 %C{2}:%L %M - %msg%n &lt;/property&gt;　　&lt;property name="EVERY_FILE_SIZE"&gt;3GB&lt;/property&gt;　　&lt;property name="OUTPUT_LOG_LEVEL"&gt;info&lt;/property&gt;　　&lt;property name="FILE_COUNT"&gt;20&lt;/property&gt;　　&lt;property name="ERROR_FILE_COUNT"&gt;3&lt;/property&gt;&lt;/properties&gt;&lt;!--先定义所有的appender--&gt;&lt;appenders&gt;　　&lt;!--输出控制台的配置--&gt;　　&lt;Console name="console" target="SYSTEM_OUT"&gt;　　　　&lt;!--控制台只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;　　　　&lt;ThresholdFilter level="info" onMatch="ACCEPT" onMismatch="DENY"/&gt;　　　　&lt;!--输出日志的格式--&gt;　　　　&lt;PatternLayout pattern="${LOG_PATTERN}"/&gt;　　&lt;/Console&gt;&lt;!-- 打印信息，每次大小超过size，则这size大小的日志会自动存入按年份-月份建立的文件夹下面并进行压缩，　　作为存档--&gt;&lt;RollingRandomAccessFile 　　name="all"　　immediateFlush="true" 　　fileName="${LOG_DIR}/all.log"　　filePattern="${LOG_DIR}/all-%d{yyyy-MM-dd}-%i.log"&gt;　　&lt;Filters&gt;　　　　&lt;ThresholdFilter level="error" onMatch="ACCEPT" onMismatch="NEUTRAL"/&gt;　　　　&lt;ThresholdFilter level="warn" onMatch="ACCEPT" onMismatch="NEUTRAL"/&gt;　　　　&lt;ThresholdFilter level="info" onMatch="ACCEPT" onMismatch="NEUTRAL"/&gt;　　　　&lt;ThresholdFilter level="trace" onMatch="DENY" onMismatch="DENY"/&gt;　　&lt;/Filters&gt;&lt;PatternLayout&gt;　　&lt;Pattern&gt;${LOG_PATTERN}&lt;/Pattern&gt;&lt;/PatternLayout&gt;&lt;Policies&gt;　　&lt;SizeBasedTriggeringPolicy size="${EVERY_FILE_SIZE}" /&gt;　　&lt;TimeBasedTriggeringPolicy interval="1" modulate="true" /&gt;&lt;/Policies&gt;&lt;!-- DefaultRolloverStrategy属性如不设置，则默认为最多同一文件夹下7个文件，这里设置了20 --&gt; &lt;DefaultRolloverStrategy&gt;　　&lt;!-- 最多备14 天以内||日志文件大小达到50GB的日志||文件数量超过20此处为策略限制，Delete中可以按自　　　　　己需要用正则表达式编写 --&gt;　　&lt;Delete basePath="${LOG_DIR}" maxDepth="1"&gt;　　　　&lt;IfLastModified age="14d" /&gt;　　　　&lt;IfAccumulatedFileSize exceeds="50 GB" /&gt;　　　　&lt;IfAccumulatedFileCount exceeds="20" /&gt;　　&lt;/Delete&gt;&lt;/DefaultRolloverStrategy&gt;&lt;/RollingRandomAccessFile&gt;&lt;RollingRandomAccessFile 　　name="all-error"　　immediateFlush="true" 　　fileName="${LOG_DIR}/all-error.log"　　filePattern="${LOG_DIR}/all-error-%d{yyyy-MM-dd}-%i.log"&gt;　　&lt;Filters&gt;　　　　&lt;ThresholdFilter level="error" onMatch="ACCEPT"onMismatch="NEUTRAL"/&gt;　　　　&lt;ThresholdFilter level="warn" onMatch="ACCEPT"onMismatch="DENY"/&gt;　　&lt;/Filters&gt;　　&lt;PatternLayout&gt;　　　　&lt;Pattern&gt;${LOG_PATTERN}&lt;/Pattern&gt;　　&lt;/PatternLayout&gt;　　&lt;Policies&gt;　　　　&lt;SizeBasedTriggeringPolicy size="${EVERY_FILE_SIZE}" /&gt;　　　　&lt;TimeBasedTriggeringPolicy interval="1" modulate="true" /&gt;　　&lt;/Policies&gt;　　&lt;!-- DefaultRolloverStrategy属性如不设置，则默认为最多同一文件夹下7个文件，这里设置了20 --&gt;&lt;DefaultRolloverStrategy max="${ERROR_FILE_COUNT}"/&gt;&lt;/RollingRandomAccessFile&gt;&lt;/appenders&gt;&lt;!--然后定义logger，只有定义了logger并引入的appender，appender才会生效--&gt;&lt;loggers&gt;　　&lt;!--默认的root的logger--&gt;　　&lt;Logger name="all" level="info" additivity="false"&gt; 　　　　&lt;AppenderRef ref="all" /&gt; 　　&lt;/Logger&gt;　　&lt;Logger name="all-error" level="error" additivity="false"&gt; 　　　　&lt;AppenderRef ref="all-error" /&gt; 　　&lt;/Logger&gt;　　&lt;root level="${OUTPUT_LOG_LEVEL}"&gt;　　　　&lt;appender-ref ref="console"/&gt;　　&lt;/root&gt; &lt;/loggers&gt;&lt;/configuration&gt;</pre><p>欢迎工作一到八年的Java工程师朋友们加入Java高级交流：854630135</p><p>本群提供免费的学习指导 架构资料 以及免费的解答</p><p>不懂得问题都可以在本群提出来 之后还会有直播平台和讲师直接交流噢</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'示例','java','日志'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>