<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>åˆ©ç”¨Pythonå®ç°è´¢åŠ¡æŠ¥è¡¨ä¸‹è½½å°åŠ©æ‰‹ | æå®¢å¿«è¨Š</title><meta property="og:title" content="åˆ©ç”¨Pythonå®ç°è´¢åŠ¡æŠ¥è¡¨ä¸‹è½½å°åŠ©æ‰‹ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/dfic-imagehandler/eccf200c-28b1-4270-a7be-3ff719f3d4f6"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e8f304b3.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e8f304b3.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e8f304b3.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e8f304b3.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e8f304b3.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e8f304b3.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e8f304b3.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e8f304b3.html><meta property="article:published_time" content="2020-11-14T21:04:12+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:12+08:00"><meta name=Keywords content><meta name=description content="åˆ©ç”¨Pythonå®ç°è´¢åŠ¡æŠ¥è¡¨ä¸‹è½½å°åŠ©æ‰‹"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/e8f304b3.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>åˆ©ç”¨Pythonå®ç°è´¢åŠ¡æŠ¥è¡¨ä¸‹è½½å°åŠ©æ‰‹</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><p>çˆ¬å–çš„æ•°æ®å­˜å…¥æ•°æ®åº“ä¼šå—ï¼Ÿã€Šè·Ÿè‚¡ç¥å·´è²ç‰¹å­¦ä¹ ç‚’è‚¡ä¹‹è´¢åŠ¡æŠ¥è¡¨å…¥åº“(MySQL)ã€‹ä¹Ÿè®¸èƒ½ç»™ä½ ä¸€äº›æ€è·¯ã€‚</p><div class=pgc-img><img alt=åˆ©ç”¨Pythonå®ç°è´¢åŠ¡æŠ¥è¡¨ä¸‹è½½å°åŠ©æ‰‹ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/eccf200c-28b1-4270-a7be-3ff719f3d4f6><p class=pgc-img-caption></p></div><p><strong>Pythonç‰ˆæœ¬ï¼š</strong> Python3.x</p><p><strong>è¿è¡Œå¹³å°ï¼š</strong> Windows</p><p><strong>IDEï¼š</strong> Sublime text3</p><p>æ¯ä¸ªä¸Šå¸‚å…¬å¸çš„è´¢åŠ¡æŠ¥è¡¨éƒ½æ˜¯å…è´¹æä¾›çš„ï¼Œå¯ä»¥åœ¨ä»–ä»¬çš„å®˜ç½‘è¿›è¡Œä¸‹è½½ã€‚ä½†æ˜¯è¿™æ ·ä¸€ä¸ªä¸€ä¸ªæ‰¾ï¼Œå¤ªéº»çƒ¦ã€‚æœ‰æ²¡æœ‰ä¸€ä¸ªç½‘ç«™ï¼Œé›†æˆå¥½å„ä¸ªä¸Šå¸‚å…¬å¸çš„è´¢åŠ¡ä¿¡æ¯å‘¢ï¼Ÿå½“ç„¶æœ‰ï¼Œè€Œä¸”å¾ˆå¤šï¼å„ä¸ªé‡‘èé—¨æˆ·ç½‘ç«™éƒ½æœ‰ï¼</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬çœ‹å“ªä¸ªé‡‘èé—¨æˆ·ç½‘ç«™ï¼Ÿç½‘æ˜“è´¢ç»ï¼</p><p>åŒæ‰‹å¥‰ä¸Šå®ƒçš„åœ°å€ï¼šhttp://quotes.money.163.com/hkstock/</p><p>è¿™ä¸ªç½‘ç«™é•¿è¿™æ ·ï¼š</p><div class=pgc-img><img alt=åˆ©ç”¨Pythonå®ç°è´¢åŠ¡æŠ¥è¡¨ä¸‹è½½å°åŠ©æ‰‹ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b2a5a096e11542319ff0ec3a2430e880><p class=pgc-img-caption></p></div><h1><strong>ç½‘ç«™åˆ†æ</strong></h1><p>çœ‹ä¸€ä¸‹è¿™ä¸ªURLåœ°å€æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿè…¾è®¯æ§è‚¡çš„è‚¡ç¥¨ä»£ç æ˜¯00700ã€‚å¯¹çš„ï¼Œä½ æ²¡çŒœé”™ï¼Œâ€™http://quotes.money.163.com/hkstock/cwsj_â€™ + è‚¡ç¥¨ä»£ç  + â€˜.htmlâ€™ï¼Œå°±æ˜¯å„ä¸ªä¸Šå¸‚å…¬å¸çš„è´¢åŠ¡æ•°æ®é¡µé¢ã€‚æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œä¸‹å›¾çš„è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦çˆ¬å–å—ï¼Ÿ</p><div class=pgc-img><img alt=åˆ©ç”¨Pythonå®ç°è´¢åŠ¡æŠ¥è¡¨ä¸‹è½½å°åŠ©æ‰‹ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e9c6d8dab6774ebb852c1829b4b50d60><p class=pgc-img-caption></p></div><p><strong>ç­”æ›°ï¼šä¸éœ€è¦ï¼ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè´¢åŠ¡æŠ¥è¡¨çš„æ ¼å¼æ˜¯ç»Ÿä¸€çš„ã€‚</strong>æˆ‘ä»¬éœ€è¦çš„æ˜¯è¿™äº›æŠ¥è¡¨é‡Œçš„æ•°æ®ï¼Œè€Œä¸æ˜¯è¡¨çš„æ ç›®åç§°ï¼Œè¿™äº›æ ç›®åç§°ï¼Œæˆ‘ä»¬ç›´æ¥æ‰‹åŠ¨æ•²å…¥åˆ°æ•°æ®åº“ä¸­å°±å¯ä»¥äº†ï¼Œç›´æ¥ä½œä¸ºæ•°æ®åº“çš„åˆ—åã€‚é‚£ä¹ˆï¼Œè¿™äº›æŠ¥è¡¨æ•°æ®å¦‚ä½•è·å–å‘¢ï¼Ÿè¯·çœ‹ä¸‹å›¾ï¼š</p><div class=pgc-img><img alt=åˆ©ç”¨Pythonå®ç°è´¢åŠ¡æŠ¥è¡¨ä¸‹è½½å°åŠ©æ‰‹ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fa58e55c498e4835aec185d70dce1a1c><p class=pgc-img-caption></p></div><h1><strong>ç¼–å†™ä»£ç </strong></h1><pre>import pymysqlimport requestsimport jsonimport refrom bs4 import BeautifulSoup'''é‡åˆ°ä¸æ‡‚çš„é—®é¢˜ï¼ŸPythonå­¦ä¹ äº¤æµç¾¤ï¼š821460695æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œèµ„æ–™éƒ½å·²ç»ä¸Šä¼ ç¾¤æ–‡ä»¶ï¼Œå¯ä»¥è‡ªè¡Œä¸‹è½½ï¼'''if __name__ == '__main__': #æ‰“å¼€æ•°æ®åº“è¿æ¥:host-è¿æ¥ä¸»æœºåœ°å€,port-ç«¯å£å·,user-ç”¨æˆ·å,passwd-ç”¨æˆ·å¯†ç ,db-æ•°æ®åº“å,charset-ç¼–ç  conn = pymysql.connect(host='127.0.0.1', port=3306, user='root', passwd='yourpasswd',db='financialdata',charset='utf8') #ä½¿ç”¨cursor()æ–¹æ³•è·å–æ“ä½œæ¸¸æ ‡ cursor = conn.cursor()  #ä¸»è¦è´¢åŠ¡æŒ‡æ ‡ cwzb_dict = {'EPS':'åŸºæœ¬æ¯è‚¡æ”¶ç›Š','EPS_DILUTED':'æ‘Šè–„æ¯è‚¡æ”¶ç›Š','GROSS_MARGIN':'æ¯›åˆ©ç‡', 'CAPITAL_ADEQUACY':'èµ„æœ¬å……è¶³ç‡','LOANS_DEPOSITS':'è´·æ¬¾å›æŠ¥ç‡','ROTA':'æ€»èµ„äº§æ”¶ç›Šç‡', 'ROEQUITY':'å‡€èµ„äº§æ”¶ç›Šç‡','CURRENT_RATIO':'æµåŠ¨æ¯”ç‡','QUICK_RATIO':'é€ŸåŠ¨æ¯”ç‡', 'ROLOANS':'å­˜è´·æ¯”','INVENTORY_TURNOVER':'å­˜è´§å‘¨è½¬ç‡','GENERAL_ADMIN_RATIO':'ç®¡ç†è´¹ç”¨æ¯”ç‡', 'TOTAL_ASSET2TURNOVER':'èµ„äº§å‘¨è½¬ç‡','FINCOSTS_GROSSPROFIT':'è´¢åŠ¡è´¹ç”¨æ¯”ç‡','TURNOVER_CASH':'é”€å”®ç°é‡‘æ¯”ç‡','YEAREND_DATE':'æŠ¥è¡¨æ—¥æœŸ'} #åˆ©æ¶¦è¡¨ lrb_dict = {'TURNOVER':'æ€»è¥æ”¶','OPER_PROFIT':'ç»è¥åˆ©æ¶¦','PBT':'é™¤ç¨å‰åˆ©æ¶¦', 'NET_PROF':'å‡€åˆ©æ¶¦','EPS':'æ¯è‚¡åŸºæœ¬ç›ˆåˆ©','DPS':'æ¯è‚¡æ´¾æ¯', 'INCOME_INTEREST':'åˆ©æ¯æ”¶ç›Š','INCOME_NETTRADING':'äº¤æ˜“æ”¶ç›Š','INCOME_NETFEE':'è´¹ç”¨æ”¶ç›Š','YEAREND_DATE':'æŠ¥è¡¨æ—¥æœŸ'} #èµ„äº§è´Ÿå€ºè¡¨ fzb_dict = { 'FIX_ASS':'å›ºå®šèµ„äº§','CURR_ASS':'æµåŠ¨èµ„äº§','CURR_LIAB':'æµåŠ¨è´Ÿå€º', 'INVENTORY':'å­˜æ¬¾','CASH':'ç°é‡‘åŠé“¶è¡Œå­˜ç»“','OTHER_ASS':'å…¶ä»–èµ„äº§', 'TOTAL_ASS':'æ€»èµ„äº§','TOTAL_LIAB':'æ€»è´Ÿå€º','EQUITY':'è‚¡ä¸œæƒç›Š', 'CASH_SHORTTERMFUND':'åº“å­˜ç°é‡‘åŠçŸ­æœŸèµ„é‡‘','DEPOSITS_FROM_CUSTOMER':'å®¢æˆ·å­˜æ¬¾', 'FINANCIALASSET_SALE':'å¯ä¾›å‡ºå”®ä¹‹è¯åˆ¸','LOAN_TO_BANK':'é“¶è¡ŒåŒä¸šå­˜æ¬¾åŠè´·æ¬¾', 'DERIVATIVES_LIABILITIES':'é‡‘èè´Ÿå€º','DERIVATIVES_ASSET':'é‡‘èèµ„äº§','YEAREND_DATE':'æŠ¥è¡¨æ—¥æœŸ'} #ç°é‡‘æµè¡¨ llb_dict = { 'CF_NCF_OPERACT':'ç»è¥æ´»åŠ¨äº§ç”Ÿçš„ç°é‡‘æµ','CF_INT_REC':'å·²æ”¶åˆ©æ¯','CF_INT_PAID':'å·²ä»˜åˆ©æ¯', 'CF_INT_REC':'å·²æ”¶è‚¡æ¯','CF_DIV_PAID':'å·²æ´¾è‚¡æ¯','CF_INV':'æŠ•èµ„æ´»åŠ¨äº§ç”Ÿç°é‡‘æµ', 'CF_FIN_ACT':'èèµ„æ´»åŠ¨äº§ç”Ÿç°é‡‘æµ','CF_BEG':'æœŸåˆç°é‡‘åŠç°é‡‘ç­‰ä»·ç‰©','CF_CHANGE_CSH':'ç°é‡‘åŠç°é‡‘ç­‰ä»·ç‰©å‡€å¢åŠ é¢', 'CF_END':'æœŸæœ«ç°é‡‘åŠç°é‡‘ç­‰ä»·ç‰©','CF_EXCH':'æ±‡ç‡å˜åŠ¨å½±å“','YEAREND_DATE':'æŠ¥è¡¨æ—¥æœŸ'} #æ€»è¡¨ table_dict = {'cwzb':cwzb_dict,'lrb':lrb_dict,'fzb':fzb_dict,'llb':llb_dict} #è¯·æ±‚å¤´ headers = {'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.8', 'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.109 Safari/537.36',} #ä¸Šå¸‚è‚¡ç¥¨åœ°å€ target_url = 'http://quotes.money.163.com/hkstock/cwsj_00700.html' req = requests.get(url = target_url, headers = headers) req.encoding = 'utf-8' html = req.text page_bf = BeautifulSoup(html, 'lxml') #è‚¡ç¥¨åç§°ï¼Œè‚¡ç¥¨ä»£ç  name = page_bf.find_all('span', class_ = 'name')[0].string code = page_bf.find_all('span', class_ = 'code')[0].string code = re.findall('\d+',code)[0] #æ‰“å°è‚¡ç¥¨ä¿¡æ¯ print(name + ':' + code) print('') #å­˜å‚¨å„ä¸ªè¡¨åçš„åˆ—è¡¨ table_name_list = [] table_date_list = [] each_date_list = [] url_list = [] #è¡¨åå’Œè¡¨æ—¶é—´ table_name = page_bf.find_all('div', class_ = 'titlebar3') for each_table_name in table_name: #è¡¨å table_name_list.append(each_table_name.span.string) #è¡¨æ—¶é—´ for each_table_date in each_table_name.div.find_all('select', id = re.compile('.+1$')): url_list.append(re.findall('(\w+)1',each_table_date.get('id'))[0]) for each_date in each_table_date.find_all('option'): each_date_list.append(each_date.string) table_date_list.append(each_date_list) each_date_list = [] #æ’å…¥ä¿¡æ¯ for i in range(len(table_name_list)): print('è¡¨å:',table_name_list[i]) print('') #è·å–æ•°æ®åœ°å€ url = 'http://quotes.money.163.com/hk/service/cwsj_service.php?symbol={}&amp;start={}&amp;end={}&amp;type={}&amp;unit=yuan'.format(code,table_date_list[i][-1],table_date_list[i][0],url_list[i]) req_table = requests.get(url = url, headers = headers) value_dict = {} for each_data in req_table.json(): value_dict['è‚¡ç¥¨å'] = name value_dict['è‚¡ç¥¨ä»£ç '] = code for key, value in each_data.items(): if key in table_dict[url_list[i]]: value_dict[table_dict[url_list[i]][key]] = value # print(value_dict) sql1 = """ INSERT INTO %s (`è‚¡ç¥¨å`,`è‚¡ç¥¨ä»£ç `,`æŠ¥è¡¨æ—¥æœŸ`) VALUES ('%s','%s','%s')""" % (url_list[i],value_dict['è‚¡ç¥¨å'],value_dict['è‚¡ç¥¨ä»£ç '],value_dict['æŠ¥è¡¨æ—¥æœŸ']) print(sql1) try: cursor.execute(sql1) # æ‰§è¡Œsqlè¯­å¥ conn.commit() except: # å‘ç”Ÿé”™è¯¯æ—¶å›æ»š conn.rollback() for key, value in value_dict.items(): if key not in ['è‚¡ç¥¨å','è‚¡ç¥¨ä»£ç ','æŠ¥è¡¨æ—¥æœŸ']: sql2 = """ UPDATE %s SET %s='%s' WHERE `è‚¡ç¥¨å`='%s' AND `æŠ¥è¡¨æ—¥æœŸ`='%s'""" % (url_list[i],key,value,value_dict['è‚¡ç¥¨å'],value_dict['æŠ¥è¡¨æ—¥æœŸ']) print(sql2) try: cursor.execute(sql2) # æ‰§è¡Œsqlè¯­å¥ conn.commit() except: # å‘ç”Ÿé”™è¯¯æ—¶å›æ»š conn.rollback() value_dict = {} # å…³é—­æ•°æ®åº“è¿æ¥ cursor.close()  conn.close()</pre><h1>è¿è¡Œæ•ˆæœ</h1><div class=pgc-img><img alt=åˆ©ç”¨Pythonå®ç°è´¢åŠ¡æŠ¥è¡¨ä¸‹è½½å°åŠ©æ‰‹ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a1926f5ba66f407895fdb88e65255c01><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=åˆ©ç”¨Pythonå®ç°è´¢åŠ¡æŠ¥è¡¨ä¸‹è½½å°åŠ©æ‰‹ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6ad59f0f114e412ab2c7f7103f7f5361><p class=pgc-img-caption></p></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Python','å®ç°','è´¢åŠ¡'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>