<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>你知道怎么得到真正的随机数么？没那么简单 | 极客快訊</title><meta property="og:title" content="你知道怎么得到真正的随机数么？没那么简单 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/212f000647be5f1d30e5"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/eb546a46.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/eb546a46.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/eb546a46.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/eb546a46.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/eb546a46.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/eb546a46.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/eb546a46.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/eb546a46.html><meta property="article:published_time" content="2020-11-14T21:08:08+08:00"><meta property="article:modified_time" content="2020-11-14T21:08:08+08:00"><meta name=Keywords content><meta name=description content="你知道怎么得到真正的随机数么？没那么简单"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/eb546a46.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>你知道怎么得到真正的随机数么？没那么简单</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p><img alt=你知道怎么得到真正的随机数么？没那么简单 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/212f000647be5f1d30e5></p><blockquote><p>本文将解释如何安装 pandom，这是一个由 ncomputers.org 维护的定时抖动真随机数生成器。 -- Oliver</p></blockquote><blockquote>本文导航<ul class=list-paddingleft-2><li><p>-简介 …… 02%</p></li><li><p>-1 pandom 的安装 …… 07%</p></li></ul></blockquote><ul class=list-paddingleft-2><li><p>-1.1 获得 root 权限 …… 07%</p></li><li><p>-1.2 安装编译所需的依赖 …… 08%</p></li><li><p>-1.3 下载并析出源码 …… 14%</p></li><li><p>-1.4 在安装前进行测试 (推荐) …… 17%</p></li><li><p>-1.5 确定系统的初始化程序 …… 19%</p></li><li><p>-1.6 安装 pandom …… 22%</p></li></ul><blockquote><ul class=list-paddingleft-2><li><p>-2 checkme 文件的分析 …… 27%</p></li></ul></blockquote><ul class=list-paddingleft-2><li><p>-2.1 获取 root 权限 …… 32%</p></li><li><p>-2.2 安装编译所需的依赖 …… 34%</p></li><li><p>-2.3 下载并析出源码 …… 39%</p></li><li><p>-2.4 安装 entropyarray …… 43%</p></li><li><p>-2.5 分析 checkme 文件 …… 49%</p></li><li><p>-2.6 卸载 entropyarray (可选) …… 55%</p></li></ul><blockquote><ul class=list-paddingleft-2><li><p>-3 使用 debian 的软件仓库来进行安装 …… 58%</p></li></ul></blockquote><ul class=list-paddingleft-2><li><p>-3.1 获取 root 权限 …… 59%</p></li><li><p>-3.2 安装密钥 …… 61%</p></li><li><p>-3.3 安装软件源列表 …… 63%</p></li><li><p>-3.4 升级软件源列表 …… 71%</p></li><li><p>-3.5 测试 pandom …… 73%</p></li><li><p>-3.6 安装 pandom …… 77%</p></li></ul><blockquote><ul class=list-paddingleft-2><li><p>-4 管理 pandom …… 78%</p></li></ul></blockquote><ul class=list-paddingleft-2><li><p>-4.1 性能测试 …… 79%</p></li><li><p>-4.2 熵和序列相关性检验 …… 81%</p></li><li><p>-4.3 系统服务 …… 83%</p></li></ul><blockquote><ul class=list-paddingleft-2><li><p>-5 增强不可预测性或者性能 …… 87%</p></li></ul></blockquote><ul class=list-paddingleft-2><li><p>-5.1 编辑源文件 …… 89%</p></li><li><p>-5.2 测试不可预测性 …… 91%</p></li><li><p>-5.3 安装定制的 pandom …… 93%</p></li></ul><blockquote>编译自： https://www.howtoforge.com/tutorial/how-to-install-pandom-a-true-random-number-generator/<p>作者： Oliver</p><p>译者： FSSlc</p></blockquote><p>本教程只针对 amd64/x86_64 架构 Linux 内核版本大于等于 2.6.9 的系统。本文将解释如何安装 pandom[1]，这是一个由 ncomputers.org 维护的定时抖动真随机数生成器。</p><h1>简介</h1><p>在现在的计算机状况下，比如说配置了固态硬盘（SSD）的个人电脑和虚拟专用服务器（VPS）的环境中，Linux 内核内置的真随机数发生器提供的吞吐量很低。</p><p>而出于各种不同的加密目的使得对真随机数的需求持续增长，从而使得这个低吞吐量问题在 Linux 实现中变得越来越严重。</p><p>在与上述相同的物理或者虚拟环境下，并假设没有其它进程以 root 身份向 /dev/random 进行写操作的话，64 ubits[2]/64 bits 的 pandom 可以以 8 KiB/s 的速率生成随机数。</p><h1>1 pandom 的安装</h1><h1><code>1.1 获得 root 权限</code></h1><p>Pandom 必须以 root 身份来安装，所以在必要的时候请运行如下命令：</p><blockquote>su -</blockquote><h1><code>1.2 安装编译所需的依赖</code></h1><p>为了下载并安装 pandom，你需要 GNU as 汇编器、GNU make、GNU tar 和 GNU wget (最后两个工具通常已被安装)。随后你可以按照你的意愿卸载它们。</p><p>基于 Arch 的系统：</p><blockquote>pacman -S binutils make</blockquote><p>基于 Debian 的系统：</p><blockquote>apt-get install binutils make</blockquote><p>基于 Red Hat 的系统：</p><blockquote>dnf install binutils make<p>yum install binutils make</p></blockquote><p>基于 SUSE 的系统：</p><blockquote>zypper install binutils make</blockquote><h1><code>1.3 下载并析出源码</code></h1><p>下面的命令将使用 wget 和 tar 从 ncomputers.org 下载 pandom 的源代码并将它们解压出来：</p><blockquote>wget http://ncomputers.org/pandom.tar.gz<p>tar xf pandom.tar.gz</p><p>cd pandom/amd64-linux</p></blockquote><h1><code>1.4 在安装前进行测试 (推荐)</code></h1><p>这个被推荐的测试将花费大约 8 分钟的时间，它将检查内核支持情况并生成一个名为 checkme 的文件（在下一节中将被分析）。</p><blockquote>make check</blockquote><h1><code>1.5 确定系统的初始化程序</code></h1><p>在安装 pandom 之前，你需要知道你的系统使用的是哪个初始化程序。假如下面命令的输出中包含 running，则意味着你的系统使用了 systemd，否则你的系统则可能使用了一个 init.d 的实现（例如 upstart、sysvinit）。</p><blockquote>systemctl is-system-running<p>running</p></blockquote><h1><code>1.6 安装 pandom</code></h1><p>一旦你知道了你的系统使用何种 Linux 实现，那么你就可以相应地安装 pandom 了。</p><p>使用基于 init.d 作为初始化程序（如： upstart、sysvinit）的系统：</p><p>假如你的系统使用了一个 init.d 的实现（如： upstart、sysvinit），请运行下面的命令来安装 pandom：</p><blockquote>make install-init.d</blockquote><p>以 systemd 作为初始化程序的系统：</p><p>假如你的系统使用 systemd，则请运行以下命令来安装 pandom：</p><blockquote>make install-systemd</blockquote><h1>2 checkme 文件的分析</h1><p>在使用 pandom 进行加密之前，强烈建议分析一下先前在安装过程中生成的 checkme 文件。通过分析我们便可以知道用 pandom 生成的数是否真的随机。本节将解释如何使用 ncomputers.org 的 shell 脚本 entropyarray 来测试由 pandom 产生的输出的熵及序列相关性。</p><p>注：整个分析过程也可以在另一台电脑上完成，例如在一个笔记本电脑或台式机上。举个例子：假如你正在一个资源受到限制的 VPS 上安装 pandom 程序，或许你更倾向于将 checkme 复制到自己的个人电脑中，然后再进行分析。</p><h1><code>2.1 获取 root 权限</code></h1><p>entropyarray 程序也必须以 root 身份来安装，所以在必要时请运行如下命令：</p><blockquote>su -</blockquote><h1><code>2.2 安装编译所需的依赖</code></h1><p>为了下载并安装 entropyarray， 你需要 GNU g++ 编译器、GNU make、GNU tar 和 GNU wget。在随后你可以任意卸载这些依赖。</p><p>基于 Arch 的系统：</p><blockquote>pacman -S gcc make</blockquote><p>基于 Debian 的系统：</p><blockquote>apt-get install g++ make</blockquote><p>基于 Red Hat 的系统：</p><blockquote>dnf install gcc-c++ make<p>yum install gcc-c++ make</p></blockquote><p>基于 SUSE 的系统：</p><blockquote>zypper install gcc-c++ make</blockquote><h1><code>2.3 下载并析出源码</code></h1><p>以下命令将使用 wget 和 tar 从 ncomputers.org 下载到 entropyarray 的源码并进行解压：</p><blockquote>wget http://ncomputers.org/rearray.tar.gz<p>wget http://ncomputers.org/entropy.tar.gz</p><p>wget http://ncomputers.org/entropyarray.tar.gz</p><p>tar xf entropy.tar.gz</p><p>tar xf rearray.tar.gz</p><p>tar xf entropyarray.tar.gz</p></blockquote><h1><code>2.4 安装 entropyarray</code></h1><p>注：如果在编译过程中报有关 -std=c++11 的错误，则说明当前系统安装的 GNU g++ 版本不支持 ISO C++ 2011 标准，那么你可能需要在另一个支持该标准的系统中编译 ncomputers.org/entropy 和 ncomputers.org/rearray （例如在一个你喜爱的较新的 Linux 发行版本中来编译）。接着使用 make install 来安装编译好的二进制文件，再接着你可能想继续运行 entropyarray 程序，或者跳过运行该程序这一步骤，然而我还是建议在使用 pandom 来达到加密目地之前先分析一下 checkme 文件。</p><blockquote>cd rearray; make install; cd ..<p>cd entropy; make install; cd ..</p><p>cd entropyarray; make install; cd ..</p></blockquote><h1><code>2.5 分析 checkme 文件</code></h1><p>注：64 ubits[3] / 64 bits 的 pandom 实现所生成的结果中熵应该高于 15.977 且 max 字段低于 70。假如你的结果与之相差巨大，或许你应该按照下面第 5 节介绍的那样增加你的 pandom 实现的不可预测性。假如你跳过了生成 checkme 文件的那一步，你也可以使用其他的工具来进行测试，例如 伪随机数序列测试[4]。</p><blockquote>entropyarray checkme<p>entropyarray in /tmp/tmp.mbCopmzqsg</p><p>15.977339</p><p>min:12</p><p>med:32</p><p>max:56</p><p>15.977368</p><p>min:11</p><p>med:32</p><p>max:58</p><p>15.977489</p><p>min:11</p><p>med:32</p><p>max:59</p><p>15.977077</p><p>min:12</p><p>med:32</p><p>max:60</p><p>15.977439</p><p>min:8</p><p>med:32</p><p>max:59</p><p>15.977374</p><p>min:13</p><p>med:32</p><p>max:60</p><p>15.977312</p><p>min:12</p><p>med:32</p><p>max:67</p></blockquote><h1><code>2.6 卸载 entropyarray (可选)</code></h1><p>假如你打算不再使用 entropyarray，那么你可以按照你自己的需求卸载它：</p><blockquote>cd entropyarray; make uninstall; cd ..<p>cd entropy; make uninstall; cd ..</p><p>cd rearray; make uninstall; cd ..</p></blockquote><h1>3 使用 debian 的软件仓库来进行安装</h1><p>假如你想在你基于 debian 的系统中让 pandom 保持更新，则你可以使用 ncomputers.org 的 debian 软件仓库来安装或者重新安装它。</p><h1><code>3.1 获取 root 权限</code></h1><p>以下的 debian 软件包必须以 root 身份来安装，所以在必要时请运行下面这个命令：</p><blockquote>su -</blockquote><h1><code>3.2 安装密钥</code></h1><p>下面的 debian 软件包中包含 ncomputers.org debian 软件仓库的公匙密钥：</p><blockquote>wget http://ncomputers.org/debian/keyring.deb<p>dpkg -i keyring.deb</p><p>rm keyring.deb</p></blockquote><h1><code>3.3 安装软件源列表</code></h1><p>下面这些 debian 软件包含有 ncomputers.org debian 软件仓库的软件源列表，这些软件源列表对应最新的 debian 发行版本(截至 2017 年)。</p><p>注：你也可以将下面的以 # 注释的行加入 /etc/apt/sources.list 文件中，而不是为你的 debian 发行版本安装对应的 debian 软件包。但假如这些源在将来改变了，你就需要手动更新它们。</p><p>Wheezy：</p><blockquote>#deb http://ncomputers.org/debian wheezy main<p>wget http://ncomputers.org/debian/wheezy.deb</p><p>dpkg -i wheezy.deb</p><p>rm wheezy.deb</p></blockquote><p>Jessie：</p><blockquote>#deb http://ncomputers.org/debian jessie main<p>wget http://ncomputers.org/debian/jessie.deb</p><p>dpkg -i jessie.deb</p><p>rm jessie.deb</p></blockquote><p>Stretch：</p><blockquote>#deb http://ncomputers.org/debian stretch main<p>wget http://ncomputers.org/debian/stretch.deb</p><p>dpkg -i stretch.deb</p><p>rm stretch.deb</p></blockquote><h1><code>3.4 升级软件源列表</code></h1><p>一旦密钥和软件源列表安装完成，则可以使用下面的命令来更新：</p><blockquote>apt-get update</blockquote><h1><code>3.5 测试 pandom</code></h1><p>测试完毕后，你可以随意卸载下面的软件包。</p><p>注：假如你已经在你的 Linux 中测试了 pandom ， 则你可以跳过这一步。</p><blockquote>apt-get install pandom-test<p>pandom-test</p><p>generating checkme file, please wait around 8 minutes ...</p><p>entropyarray in /tmp/tmp.5SkiYsYG3h</p><p>15.977366</p><p>min:12</p><p>med:32</p><p>max:57</p><p>15.977367</p><p>min:13</p><p>med:32</p><p>max:57</p><p>15.977328</p><p>min:12</p><p>med:32</p><p>max:61</p><p>15.977431</p><p>min:12</p><p>med:32</p><p>max:59</p><p>15.977437</p><p>min:11</p><p>med:32</p><p>max:57</p><p>15.977298</p><p>min:11</p><p>med:32</p><p>max:59</p><p>15.977196</p><p>min:10</p><p>med:32</p><p>max:57</p></blockquote><h1><code>3.6 安装 pandom</code></h1><blockquote>apt-get install pandom</blockquote><h1>4 管理 pandom</h1><p>在 pandom 安装完成后，你可能想对它进行管理。</p><h1><code>4.1 性能测试</code></h1><p>pandom 提供大约 8 kB/s 的随机数生成速率，但它的性能可能根据环境而有所差异。</p><blockquote>dd if=/dev/random of=/dev/null bs=8 count=512<p>512+0 records in</p><p>512+0 records out</p><p>4096 bytes (4.1 kB, 4.0 KiB) copied, 0.451253 s, 9.1 kB/s</p></blockquote><h1><code>4.2 熵和序列相关性检验</code></h1><p>除了 ncomputers.org/entropyarray，还存在更多的测试，例如 Ilja Gerhardt 的 NIST 测试套件[5]。</p><blockquote>entropyarray /dev/random 1M</blockquote><h1><code>4.3 系统服务</code></h1><p>pandom 还可以以系统服务的形式运行。</p><p>基于 init.d 的初始化系统（如 upstart、sysvinit）：</p><blockquote>/etc/init.d/random status<p>/etc/init.d/random start</p><p>/etc/init.d/random stop</p><p>/etc/init.d/random restart</p></blockquote><p>以 systemd 作为初始化程序的系统：</p><blockquote>systemctl status random<p>systemctl start random</p><p>systemctl stop random</p><p>systemctl restart random</p></blockquote><h1>5 增强不可预测性或者性能</h1><p>假如你想增加你编译的 pandom 程序的不可预测性或者性能，你可以尝试增加或删减 CPU 时间测量选项。</p><h1><code>5.1 编辑源文件</code></h1><p>请按照自己的意愿，在源文件 test.s 和 tRNG.s 中增加或者移除 measurement blocks 字段。</p><blockquote>#measurement block<p>mov $35,%rax</p><p>syscall</p><p>rdtsc</p><p>[...]</p><p>#measurement block</p><p>mov $35,%rax</p><p>syscall</p><p>rdtsc</p><p>[...]</p></blockquote><h1><code>5.2 测试不可预测性</code></h1><p>我们总是建议在使用个人定制的 pandom 实现来用于加密目地之前，先进行一些测试。</p><blockquote>make check</blockquote><h1><code>5.3 安装定制的 pandom</code></h1><p>假如你对测试的结果很满意，你就可以使用下面的命令来安装你的 pandom 实现。</p><blockquote>make install</blockquote><p>更多额外信息及更新详见 http://ncomputers.org/pandom 。</p><p>（题图：Pixabay，CC0）</p><hr><p>via: https://www.howtoforge.com/tutorial/how-to-install-pandom-a-true-random-number-generator/</p><p>作者：Oliver[6] 译者：FSSlc 校对：wxy</p><p>本文由 LCTT 原创编译，Linux中国 荣誉推出</p><ul class=list-paddingleft-2><li><p>[1]: pandom - http://ncomputers.org/pandom</p></li><li><p>[2]: ubits - http://ncomputers.org/ubit</p></li><li><p>[3]: ubits - http://ncomputers.org/ubit</p></li><li><p>[4]: 伪随机数序列测试 - http://www.fourmilab.ch/random/</p></li><li><p>[5]: Ilja Gerhardt 的 NIST 测试套件 - https://gerhardt.ch/random.php</p></li><li><p>[6]: Oliver - https://www.howtoforge.com/tutorial/how-to-install-pandom-a-true-random-number-generator/</p></li></ul></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'怎么','随机','数么'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>