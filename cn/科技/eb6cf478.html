<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>TypeScript+vue使用与迁移经验总结 | 极客快訊</title><meta property="og:title" content="TypeScript+vue使用与迁移经验总结 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/6c507edbae104f89b6a89cce2e9abee3"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/eb6cf478.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/eb6cf478.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/eb6cf478.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/eb6cf478.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/eb6cf478.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/eb6cf478.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/eb6cf478.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/eb6cf478.html><meta property="article:published_time" content="2020-11-14T21:01:59+08:00"><meta property="article:modified_time" content="2020-11-14T21:01:59+08:00"><meta name=Keywords content><meta name=description content="TypeScript+vue使用与迁移经验总结"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/eb6cf478.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>TypeScript+vue使用与迁移经验总结</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div class=pgc-img><img alt=TypeScript+vue使用与迁移经验总结 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6c507edbae104f89b6a89cce2e9abee3><p class=pgc-img-caption></p></div><p><br></p><p><strong>源宝导读：</strong>ERP平台的前端底层使用了Vue作为组件的基础架构，而使用了TypeScript语言进行组件的封装与开发。本文将简要介绍平台在使用TypeScript和Vue框架进行老功能重构时的经验总结。</p><h1 class=pgc-h-arrow-right><strong>一、背景</strong></h1><p style=text-align:justify>下面主要探讨是以下三个方面：</p><ul><li>目前项目中使用到的vue+ts的哪些特性，还有哪些特性值得去使用，不会涉及到太多的ts语法知识；</li><li>老项目的迁移为ts，有哪些点需要改造；</li><li>各抒己见，探讨下各位都有哪些心得和见解。</li></ul><h1 class=pgc-h-arrow-right><strong>二、为什么要用typescript</strong></h1><p style=text-align:justify><strong>TypeScript简单介绍：</strong></p><ul><li>是 JavaScript 的强类型版本。然后在编译期去掉类型和特有语法，生成纯粹的 JavaScript 代码。由于最终在浏览器中运行的仍然是 JavaScript，所以 TypeScript 并不依赖于浏览器的支持，也并不会带来兼容性问题。</li><li>TypeScript 是 JavaScript 的超集，这意味着他支持所有的 JavaScript 语法。并在此之上对 JavaScript 添加了一些扩展，如 class / interface / module 等。这样会大大提升代码的可阅读性。</li></ul><p style=text-align:justify><strong>总结优势：</strong></p><ul><li><strong>静态类型检查：</strong> 类型校验，能够避免许多低级代码错误；</li><li><strong>IDE 智能提示：</strong> 使用一个方法时，能清楚知道方法定义的参数和类型和返回值类型；使用一个对象时，只需要.就可以知道有哪些属性以及属性的类型；</li><li><strong>代码重构：</strong> 经过不停的需求迭代，代码重构避免不了，在重构时，如果前期有清晰和规范的接口定义、类定义等，对于重构帮助很大；</li><li><strong>规范性和可读性：</strong> 类似于强类型语言，有了合理的类型定义、接口定义等，对于代码实现的规范性和可读性都有很大提高，不然搜索整个项目这个方法在哪里调用、怎么定义等。</li></ul><p style=text-align:justify><strong>个人认为最有价值点</strong>：写代码前，会先构思功能需求的整体代码架构。</p><h1 class=pgc-h-arrow-right><strong>三、安装和起步</strong></h1><p style=text-align:justify>一般我们会面临两个情况：</p><ul><li>新项目创建；</li><li>觉得ts不错，想将老项目切换为vue+ts。</li></ul><h1 class=pgc-h-arrow-right><strong>3.1、新项目起步</strong></h1><ul><li>安装vue-cli3.0；</li><li>vue create vue-ts-hello-world；</li><li>选择Manually select features，勾选typescript。其他配置根据项目情况勾选。</li></ul><h1 class=pgc-h-arrow-right><strong>3.2、老项目切换为vue+ts</strong></h1><ul><li>安装ts依赖（<em>或使用yarn</em>）；</li><ul><li>yarn add vue-class-component vue-property-decorator；</li><li>yarn add ts-loader typescript tslint tslint-loader tslint-config-standard —dev。</li></ul><li>配置 webpack，添加ts-loader和tslint-loader；</li><li>添加 tsconfig.json；</li></ul><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>// 这是平台目前用的tsconfig.json{  "compilerOptions": {    "target": "esnext",    "module": "esnext",    "strict": true,    "jsx": "preserve",    "importHelpers": true,    "moduleResolution": "node",    "experimentalDecorators": true,    "esModuleInterop": true,    "allowSyntheticDefaultImports": true,    "strictNullChecks": false,    "sourceMap": true,    "baseUrl": ".",    "types": [      "webpack-env",      "jest"    ],    "paths": {      "@/*": [        "src/*"      ],      // 别名追加      "components/*": [        "src/components/*"      ],    },    "lib": [ // 编译过程中需要引入的库文件的列表      "esnext",      "dom",      "dom.iterable",      "scripthost"    ]  },  "include": [    "src/**/*.ts",    "src/**/*.tsx",    "src/**/*.vue",    "tests/**/*.ts",    "tests/**/*.tsx"  ],  "exclude": [    "node_modules",    "ui-tests"  ]}</code></pre><p style=text-align:justify><strong>备注：</strong> ts 也可支持 es6 / es7，在 tsconfig.json中，添加对es6 / es7的支持。</p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code> "lib": [  "dom",  "es5",  "es6",  "es7",  "es2015.promise"]</code></pre><ul><li>添加 tslint.json 或者 prettierrc（可以视情况而定）。</li></ul><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>// 目前平台使用的是.prettierrc.jsmodule.exports = {  "$schema": "http://json.schemastore.org/prettierrc",  "singleQuote": true,  "endOfLine": "auto",  "semi": false}</code></pre><ul><li>让 ts 识别 .vue。</li></ul><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>declare module "*.vue" {  import Vue from "vue";  export default Vue;}</code></pre><ul><ul><li>而在代码中导入 <em>.vue 文件的时候，需要写上 .vue 后缀。原因还是因为 TypeScript 默认只识别 </em>.ts 文件，不识别 *.vue 文件。</li><li>添加vue-shim.d.ts，让vue文件给vue模块来编译。</li></ul><li>改造 .vue文件，将vue中script切换为&lt;script lang="ts">；</li><li>改造.js文件，修改为ts语法，定义类型等。</li></ul><h1 class=pgc-h-arrow-right><strong>四、vue+ts常用的装饰器</strong></h1><p style=text-align:justify>这里主要用到了vue-property-decorator，这个是在vue-class-component基础上做了一层增强，新增了一些装饰器，使用更加便捷。这里只分享一些常用的，对于老项目改写vue文件很有用：</p><h1 class=pgc-h-arrow-right><strong>4.1、@Component</strong></h1><p style=text-align:justify>标识该vue文件是一个组件，并且可以引入其他组件。</p><p style=text-align:justify><strong>非ts版本：</strong></p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>import MyComponent from '@/components/MyComponent'export default {    components: {        MyComponent    }}</code></pre><p style=text-align:justify><strong>ts版本：</strong></p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>import { Vue, Component } from 'vue-property-decorator'import MyComponent from '@/components/MyComponent'@Component({    components: {        MyComponent    }})export default class YourComponent extends Vue {}</code></pre><p style=text-align:justify><strong>备注</strong>：这里不管有没有引入其他组件，都必须要使用@Component，目的是为了注册这个组件。否则在其他组件各种莫名其妙的问题。比如：路由找不到组件，而且不会报错。</p><h1 class=pgc-h-arrow-right><strong>4.2、@Prop</strong></h1><p style=text-align:justify><strong>非ts版本：</strong></p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>export default {  props: {    propA: {      type: Number    },    propB: {      default: 'default value'    },    propC: {      type: [String, Boolean]    },    propD: {        type: Object,        default: () =&gt; {},        validator(val: object) {          return val.prop = '1'        }    }  }}</code></pre><p style=text-align:justify><strong>ts版本：</strong></p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>import { Vue, Component, Prop } from 'vue-property-decorator'@Componentexport default class YourComponent extends Vue {  @Prop(Number)  readonly propA: number | undefined  @Prop({ default: 'default value' })  readonly propB!: string  @Prop([String, Boolean])  readonly propC: string | boolean | undefined  // 也可以一起  @Prop({type: Object, default: () =&gt; {},    validator(val: object) {      return val.prop = '1'    }  })  readonly propD!: object // 只是举例，一般会定义一个interface}</code></pre><h1 class=pgc-h-arrow-right><strong>4.3、@Watch<br></strong></h1><p style=text-align:justify><strong>非ts版本：</strong></p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>export default {  watch: {    child: {        handler: 'onChildChanged',        immediate: false,        deep: false    },    person: [      {        handler: 'onPersonChanged1',        immediate: true,        deep: true      },      {        handler: 'onPersonChanged2',        immediate: false,        deep: false      }    ]  },  methods: {    onChildChanged(val, oldVal) {},    onPersonChanged1(val, oldVal) {},    onPersonChanged2(val, oldVal) {}  }}</code></pre><p style=text-align:justify><strong>ts版本：</strong></p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>import { Vue, Component, Watch } from 'vue-property-decorator'@Componentexport default class YourComponent extends Vue {  @Watch('child')  onChildChanged(val: string, oldVal: string) {}  @Watch('person', { immediate: true, deep: true })  onPersonChanged1(val: Person, oldVal: Person) {}  @Watch('person')  onPersonChanged2(val: Person, oldVal: Person) {}}</code></pre><h1 class=pgc-h-arrow-right><strong>4.4、@Provide和@Inject</strong></h1><p style=text-align:justify><strong>场景：</strong>一般用于父级嵌套比较深的子孙vue组件，但是数据不是很方便传到深层级vue组件中，利用树型结构组件。</p><p style=text-align:justify><strong>非ts版本：</strong></p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>// 父组件provide () {  return {    OptionGroup: this  }}// 子孙组件inject: ['OptionGroup']</code></pre><p style=text-align:justify><strong>ts版本:</strong></p><p style=text-align:justify>父组件：</p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>@Provide()  getObj () {    return this  }</code></pre><p style=text-align:justify>子孙组件：</p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>@Inject() getObj!: anyget obj() {    return this.getObj()}</code></pre><p style=text-align:justify><strong>Privide的弊端：</strong></p><ul><li>依赖注入它将你应用程序中的组件与它们当前的组织方式耦合起来，使重构变得更加困难；</li><li>同时所提供的属性是非响应式的。这是出于设计的考虑，因为使用它们来创建一个中心化规模化的数据跟使用 $root做这件事都是不够好的。</li></ul><p style=text-align:justify><strong>建议：</strong></p><p style=text-align:justify><em>一般不推荐过度使用。</em></p><ul><li>provide 和 inject的绑定并<strong>不是可响应</strong>的，这是刻意为之的。但是，如果你传入了一个可监听的对象，那么其对象的属性还是可响应的；</li><li>如果你想要共享的这个属性是你的应用特有的，而不是通用化的，或者如果你想在祖先组件中更新所提供的数据，那么这意味着你可能需要换用一个像Vuex这样真正的状态管理方案了。</li></ul><h1 class=pgc-h-arrow-right><strong>4.5、@Ref</strong></h1><p style=text-align:justify><strong>非ts版本：</strong></p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>export default {  computed() {    anotherComponent () {        return this.$refs.anotherComponent    },    button () {        return this.$refs.aButton    }  }}</code></pre><p style=text-align:justify><strong>ts版本：</strong></p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>import { Vue, Component, Ref } from 'vue-property-decorator'import AnotherComponent from '@/Components/another-component.vue'@Componentexport default class YourComponent extends Vue {  @Ref() readonly anotherComponent!: AnotherComponent  @Ref('aButton') readonly button!: HTMLButtonElement  // 我们目前是这样使用的  $refs!: {    popover: any    search: HcProjectSelectSearch    tree: HcProjectTree  }}</code></pre><h1 class=pgc-h-arrow-right><strong>4.6、@Emit</strong></h1><p style=text-align:justify>用的很少，参数和时机不是很好控制。</p><p style=text-align:justify><strong>非ts版本：</strong></p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>export default {  methods: {    handleClick(e) {      this.$emit('click', e)    },    loadData() {      const promise = new Promise(resolve =&gt; {        setTimeout(() =&gt; {          resolve(20)        }, 0)      })      promise.then(value =&gt; {        this.$emit('load', value)      })    }  }}</code></pre><p style=text-align:justify><strong>ts版本：</strong></p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>import { Vue, Component, Emit } from 'vue-property-decorator'@Componentexport default class YourComponent extends Vue {  @Emit('click')  handleClick(e) {    // todo  }  @Emit()  promise() {    return new Promise(resolve =&gt; {      setTimeout(() =&gt; {        resolve(20)      }, 0)    })  }}</code></pre><h1 class=pgc-h-arrow-right><strong>五、mixin改写</strong></h1><p style=text-align:justify><strong>定义mixin：</strong></p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>export const cusMixin = {  mounted() {    this.$refs = {}    // $0 instanceof HTMLElement    // this.$refs = {}    console.log('mixin mounted')  },  beforeUpdate() {    this.$refs = {}    // console.log('global mounted')  },  updated() {    this.$refs = {}    // console.log('global mounted')  }}</code></pre><p style=text-align:justify><strong>引入mixin：</strong></p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>import { Vue, Component } from 'vue-property-decorator'import cusMixin from '@/mixin'@Component({  components: {},  mixins: [cusMixin]})export default class YourComponent extends Vue {}// 或者尝试使用import { Component, Mixins, Vue } from 'vue-property-decorator';import { MyOtherMixin } from './MyOtherMixin';@Componentexport class MyMixin extends Vue {   private created() {    console.log('what?');  }}@Component// 继承多个mixin，使用数组 [MyMixin, MyOtherMixin] export default class App extends Mixins(MyMixin) {   private test = "test";  private laowang = 'laowang';  created() {    console.log(this.test)    console.log(this.Kitchen)    console.log(this.Tv)  }}</code></pre><h1 class=pgc-h-arrow-right><strong>六、vue识别全局的方法和变量</strong></h1><ul><li>vue-shim.d.ts文件中，增加如下代码：</li></ul><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>import Vue from 'vue'import VueRouter, { Route } from 'vue-router'import { Store } from 'vuex'// 声明全局方法declare module 'vue/types/vue' {  interface Vue {    // 内部变量    $router: VueRouter;    $route: Route;    $store: Store&lt;any&gt;;    // element-ui等组件    $Message: any    $Modal: any    // 自定义挂载到Vue.prototype上的变量    $api: any    $mock: any    $configs: any  }}</code></pre><h1 class=pgc-h-arrow-right><strong>七、vuex的改写</strong></h1><p style=text-align:justify>关于store的改造，配置和结构和原来一样，具体编码设计没有特定套路，根据项目具体设计改写为ts的语法。</p><p style=text-align:justify>主要是关于ts在vue如何使用，目前主流的方案是vue-class-component + vuex-class，一般常用的mapGetters和mapActions改写：</p><ul><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>yarn add vuex-class</code></pre><p style=text-align:justify><strong>非ts版本：</strong></p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>import { mapGetters, mapActions } from 'vuex'export default Vue.extend({  computed: {     ...mapGetters({       'name',       'age'     })  },  methods: {    ...mapActions([        'setNameAction'    ])  }})</code></pre><p style=text-align:justify><strong>ts版本：</strong></p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>import { Vue, Component } from 'vue-property-decorator'import { Getter, Action } from 'vuex-class'import { Test } from '@/store'export default class YourComponent extends Vue {  @Getter('name') name: string  @Getter('age') age: number  @Action('setNameAction') setNameAction: Function  get innerName (): string {     return this.name  }  get innerAge (): number {     return this.age  }  setName (name: string) {    this.setNameAction(products)  }}</code></pre><p style=text-align:justify>备注：tsconfig.json需要调整下：</p><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>{  "compilerOptions": {    // 启用 vue-class-component 及 vuex-class 需要开启此选项    "experimentalDecorators": true,    // 启用 vuex-class 需要开启此选项    "strictFunctionTypes": false  }}</code></pre><h1 class=pgc-h-arrow-right><strong>八、vue render jsx语法改写</strong></h1><p style=text-align:justify>改写的原理还是和上面类似，都是借助目前流行的两个库，除了使用vue-property-decorator以外，还需要借助vue-tsx-support，vue-tsx-support是在Vue外面包装了一层，将prop、event等以泛型的方式加了一层ts接口定义传了进去，目的是为了防止ts的类检查报错。</p><ul><li><strong>步骤：</strong></li><ul><li>引入 yarn add vue-tsx-support --dev；</li><li>导入ts声明，在main,ts中import "vue-tsx-support/enable-check";</li><li>在vue.config.js中extensions添加.tsx。</li></ul><li><strong>使用：</strong></li></ul><ul><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li><li style=text-align:right;list-style-position:inside><br></li></ul><pre><code>import { Component, Prop } from "vue-property-decorator";import * as tsx from "vue-tsx-support";interface YourComponentsProps {  name?: string  age?: number}@Componentexport default class YourComponents extends tsx.Component&lt;YourComponentsProps&gt; {  @Prop() public name!: string;  @Prop() public age!: number;  protected render() {    return (      &lt;div&gt;        &lt;h1&gt;姓名:{this.name}&lt;/h1&gt;        &lt;h1&gt;年龄:{this.age}&lt;/h1&gt;      &lt;/div&gt;    );  }}</code></pre><p style=text-align:justify>这里jsx改写为tsx大致简单了解下，如果大家有兴趣，以后可以一起学习探讨下。</p><h1 class=pgc-h-arrow-right><strong>九、思考</strong></h1><ul><li>关于老项目ts的改造，如何才能平滑过渡，不影响现有的功能。</li><li>在vue中ts的实践，数据、视图、控制器分层设计的问题。</li></ul><p style=text-align:center>------ END ------</p><p style=text-align:center><br></p><p><strong>作者简介</strong></p><p><strong>罗同学：</strong> 研发工程师，目前负责ERP建模平台的设计与开发工作。</p><p><br></p><p>文章来源微信公众号：明源技术团队</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'TypeScript','vue','迁移'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>