<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>SpringMVC:æ¥æ”¶åˆ°è¯·æ±‚åçš„è°ƒç”¨ç»†èŠ‚ï¼Œä½ æ˜¯å¦æ¸…æ¥šï¼Ÿ | æå®¢å¿«è¨Š</title><meta property="og:title" content="SpringMVC:æ¥æ”¶åˆ°è¯·æ±‚åçš„è°ƒç”¨ç»†èŠ‚ï¼Œä½ æ˜¯å¦æ¸…æ¥šï¼Ÿ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/3c62f7f39c8a499fb3e7e322ceb2aa76"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ed4819d.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ed4819d.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ed4819d.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ed4819d.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ed4819d.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ed4819d.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ed4819d.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ed4819d.html><meta property="article:published_time" content="2020-10-29T21:04:55+08:00"><meta property="article:modified_time" content="2020-10-29T21:04:55+08:00"><meta name=Keywords content><meta name=description content="SpringMVC:æ¥æ”¶åˆ°è¯·æ±‚åçš„è°ƒç”¨ç»†èŠ‚ï¼Œä½ æ˜¯å¦æ¸…æ¥šï¼Ÿ"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/ed4819d.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>SpringMVC:æ¥æ”¶åˆ°è¯·æ±‚åçš„è°ƒç”¨ç»†èŠ‚ï¼Œä½ æ˜¯å¦æ¸…æ¥šï¼Ÿ</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><blockquote><p>åˆ†äº«è‡ªå·±åœ¨Javaæ–¹é¢çš„æ‰€æ€æ‰€æƒ³ï¼Œå¸Œæœ›ä½ çœ‹å®Œä¹‹åèƒ½æœ‰æ›´å¤šæ›´æ·±å…¥çš„äº†è§£</p><p><strong>æœ¬äººå¾®ä¿¡å…¬ä¼—å·ï¼ˆjwfyçš„å­¦ä¹ åˆ†äº«ï¼‰ï¼Œæ¬¢è¿å…³æ³¨ï½</strong></p></blockquote><p>æ¥æ”¶åˆ°ä¸€ä¸ªæ–°çš„è¯·æ±‚ä¹‹åï¼Œspringå°±ä¼šå»æ ¹æ®è¯·æ±‚çš„URLä¿¡æ¯é€‰æ‹©å…·ä½“çš„ä»£ç å—å»æ‰§è¡Œæ“ä½œï¼Œå¦‚å›¾å°±æ˜¯æ¥æ”¶åˆ°ä¸€ä¸ªæ–°çš„è¯·æ±‚è°ƒç”¨å›¾ï¼Œä»Tomcatå¼€å§‹ç›´åˆ°æŠŠè¯·æ±‚åˆ†å‘åˆ°springä¸­ï¼Œæœ€ååˆ°äº†doDispatchæ–¹æ³•ã€‚</p><div class=pgc-img><img alt=SpringMVC:æ¥æ”¶åˆ°è¯·æ±‚åçš„è°ƒç”¨ç»†èŠ‚ï¼Œä½ æ˜¯å¦æ¸…æ¥šï¼Ÿ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3c62f7f39c8a499fb3e7e322ceb2aa76><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>æœ¬ç¯‡å­¦ä¹ ç¬”è®°ä¸»è¦å°±æ˜¯è®²ä¸€ä¸ªæ–°çš„è¯·æ±‚è¢«åˆ†å‘åˆ°springä¸­springå¦‚ä½•å¤„ç†ï¼Œè‡³äºå¦‚ä½•æ‰«æåŒ…ä¸­çš„controllerï¼Œå¾—åˆ°URLé…ç½®ä¿¡æ¯å¯ä»¥çœ‹ <a class=pgc-link data-content=mp href="https://www.toutiao.com/i6723360987501560323/?group_id=6723360987501560323" target=_blank>ä½ æ˜¯å¦æ¸…æ¥šSpring MVCä¸­çš„URLæ˜ å°„ç®¡ç†å™¨çš„å·¥ä½œåŸç†</a> ,è€Œæœ¬ç¯‡ä¸»è¦ä»‹ç»äº†</p><ul><li>è·å–æ‰§è¡Œé“¾</li><li>404é¡µé¢è®¾ç½®</li><li>è·å–é€‚é…å™¨</li><li>LastModified</li><li>å†…å®¹æ–¹æ³•è°ƒç”¨ï¼ˆinvokeï¼‰</li><li>è§†å›¾æ¸²æŸ“</li></ul><p>è®©æˆ‘ä»¬æ›´åŠ æ¸…æ¥šçš„çŸ¥é“springä¸­ä¸€èˆ¬çš„æ–¹æ³•æ˜¯å¦‚ä½•ç¡®å®šè°ƒç”¨çš„å…·ä½“æ–¹æ³•çš„ï¼Œé€‚é…ä¸åŒçš„æ¨¡æ¿å¼•æ“ï¼Œè¾¾åˆ°æ¸²æŸ“çš„åœ°æ­¥ï¼Œå†è€…æœ‰æ—¶å€™åˆæ˜¯APIä¸€èˆ¬åªéœ€è¦è¿”å›jsonç»“æ„çš„æ•°æ®ï¼Œå…¶èƒŒåçš„åŸç†æ˜¯å¦‚ä½•å®ç°çš„ï¼Œä»¥åŠæˆ‘ä»¬åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¦‚ä½•é¿å…å‡ºç°çš„å„ç§é—®é¢˜ã€‚</p><h1><strong>doDispatch æ–¹æ³•</strong></h1><pre>protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception { HttpServletRequest processedRequest = request; HandlerExecutionChain mappedHandler = null; boolean multipartRequestParsed = false; WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request); try { ModelAndView mv = null; // åˆå§‹åŒ–è®¾ç½®æ¨¡æ¿ä¸ºnull Exception dispatchException = null; // åˆå§‹åŒ–å¼‚å¸¸ä¸ºnull try { processedRequest = checkMultipart(request); multipartRequestParsed = (processedRequest != request); // æ–‡ä»¶ä¸Šä¼ çš„ç›¸å…³è®¾ç½®å’Œæ“ä½œ mappedHandler = getHandler(processedRequest); // æ ¹æ®requestè·å–å¯¹åº”çš„è¯·æ±‚æ‰§è¡Œé“¾ if (mappedHandler == null || mappedHandler.getHandler() == null) { // å¦‚æœæ²¡æœ‰å¯¹åº”çš„handlerå¯¹äºï¼Œåˆ™åº”è¯¥æ˜¯å®šä¹‰ä¸º404ï¼Œé€šè¿‡noHandlerFoundç¡®è®¤ noHandlerFound(processedRequest, response); return; } // é€šè¿‡handlerè·å¾—åˆé€‚çš„handleré€‚é…å™¨ HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler()); String method = request.getMethod(); boolean isGet = "GET".equals(method); if (isGet || "HEAD".equals(method)) { // æ˜¯getæ–¹æ³•æˆ–è€…headæ–¹æ³• long lastModified = ha.getLastModified(request, mappedHandler.getHandler()); // å¦‚æœhandler æ˜¯LastModifiedç±»ï¼Œåˆ™è·å–å…¶lastModifiedå€¼ï¼Œå¦åˆ™è¿”å›-1 // lastModify æ˜¯springæ·»åŠ äº†ç¼“å­˜æœºåˆ¶ï¼Œå½“é‡å¤è¯·æ±‚åŒæ ·çš„å†…å®¹ï¼Œè¿”å›403ï¼Œè€Œä¸ä¼šè¿”å›çœŸæ­£çš„å†…å®¹ï¼Œå…·ä½“å¯çœ‹ä¸‹é¢çš„LastModifiedæœºåˆ¶è¿™ä¸€å°èŠ‚ if (logger.isDebugEnabled()) { logger.debug("Last-Modified value for [" + getRequestUri(request) + "] is: " + lastModified); } if (new ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) { return; } } // å‰ç½®çš„handleré¢„å¤„ç†ï¼Œå°±æ˜¯è·å–æ‰§è¡Œé“¾çš„æ‹¦æˆªå™¨ï¼Œå¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªå¤„ç† if (!mappedHandler.applyPreHandle(processedRequest, response)) { // å¦‚æœæ‹¦æˆªå™¨æ‹¦æˆªæˆåŠŸï¼Œè¿”å›falseï¼Œç›´æ¥ç»“æŸäº† // å½“ç„¶åœ¨è¿™å…¶ä¸­æ‹¦æˆªå™¨è‚¯å®šéœ€è¦ç‰¹å®šè¿”å›è‡ªèº«çš„å†…å®¹åˆ°responseä¸­ï¼Œä¾¿äºå±•ç¤ºåœ¨é¡µé¢ä¸Š // ä¸è¿‡ä»é¡µé¢è§’åº¦å‡ºå‘å¹¶æ²¡æœ‰éå¸¸å®è´¨æ€§çš„æ‹¦æˆªå™¨å¤„ç†ï¼Œè¿™ç‚¹å­˜ç–‘ï¼Ÿ return; } // çœŸæ­£çš„è°ƒç”¨å„è‡ªçš„æ‰§è¡Œæ–¹æ³•ï¼Œè¿”å›ModelAndViewåç»­åœ¨invokeè¿™ä¸€å°èŠ‚ç»†è¯´ mv = ha.handle(processedRequest, response, mappedHandler.getHandler()); if (asyncManager.isConcurrentHandlingStarted()) { return; } applyDefaultViewName(processedRequest, mv); // å¦‚æœmvæ²¡æœ‰åŒ…å«æœ‰æ•ˆçš„è§†å›¾ï¼Œåˆ™ä»dispatchçš„viewNameTranslatorå±æ€§ä¸Šè·å–å¯¹åº”çš„é»˜è®¤è§†å›¾ mappedHandler.applyPostHandle(processedRequest, response, mv); // æ‹¦æˆªå™¨çš„åç½®å¤„ç† } catch (Exception ex) { dispatchException = ex; } catch (Throwable err) { dispatchException = new NestedServletException("Handler dispatch failed", err); }  // åˆ°è¿™é‡Œäº†å¯èƒ½å­˜åœ¨å¼‚å¸¸ï¼Œç±»ä¼¼çš„500è¯·æ±‚å¤„ç†å°±æ˜¯åœ¨è¿™é‡Œå®Œæˆæ“ä½œçš„ // åŒæ—¶åŒ…å«äº†æ•°æ®å›å¡«åˆ°responseä¸­çš„æ“ä½œ processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException); } catch (Exception ex) { triggerAfterCompletion(processedRequest, response, mappedHandler, ex); } catch (Throwable err) { triggerAfterCompletion(processedRequest, response, mappedHandler, new NestedServletException("Handler processing failed", err)); } finally { if (asyncManager.isConcurrentHandlingStarted()) { // Instead of postHandle and afterCompletion if (mappedHandler != null) { mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response); } } else { // Clean up any resources used by a multipart request. if (multipartRequestParsed) { cleanupMultipart(processedRequest); } } }}</pre><p><strong>è·å–æ‰§è¡Œé“¾</strong></p><p><strong>AbstractHandlerMapping ç±»</strong></p><pre>protected HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception { for (HandlerMapping hm : this.handlerMappings) { // è¿™ä¸ªhandlerMappingså°±æ˜¯åœ¨æ‰«æURLå¾—åˆ°çš„URLå®¹å™¨ä¿¡æ¯ HandlerExecutionChain handler = hm.getHandler(request); if (handler != null) { return handler; } } return null;}</pre><p>å¦‚å›¾æ‰€ç¤ºå°±æ˜¯</p><div class=pgc-img><img alt=SpringMVC:æ¥æ”¶åˆ°è¯·æ±‚åçš„è°ƒç”¨ç»†èŠ‚ï¼Œä½ æ˜¯å¦æ¸…æ¥šï¼Ÿ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/227844fc7e344bf0ab6575bb1619e2c2><p class=pgc-img-caption></p></div><h1><strong>getHandler æ–¹æ³•</strong></h1><p><strong>AbstractHandlerMapping ç±»</strong></p><pre>public final HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception { Object handler = getHandlerInternal(request); // è°ƒç”¨å­ç±»å®ç°çš„å…·ä½“æ–¹æ³•ï¼Œè·å¾—æ‰§è¡Œé“¾å¯¹è±¡ if (handler == null) { handler = getDefaultHandler(); } if (handler == null) { // åˆ°è¿™é‡Œæ„å‘³ç€çœŸçš„æ‰¾ä¸åˆ°å¯ç”¨çš„æ‰§è¡Œé“¾å¯¹è±¡ return null; }  if (handler instanceof String) { String handlerName = (String) handler; handler = getApplicationContext().getBean(handlerName); } HandlerExecutionChain executionChain = getHandlerExecutionChain(handler, request); // é‡æ–°ç”Ÿæˆä¸€ä¸ªæ‰§è¡Œé“¾å¯¹è±¡ï¼Œå¯èƒ½ä¼šå’Œhandleræ˜¯åŒä¸€ä¸ªå¯¹è±¡  if (CorsUtils.isCorsRequest(request)) { // æŸ¥çœ‹requestå¤´éƒ¨ä¿¡æ¯æ˜¯å¦åŒ…å«äº†Originä¿¡æ¯ï¼Œå¦‚æœæœ‰åˆ™åˆ¤æ–­æˆåŠŸ // corsè·¨åŸŸè®¾ç½® CorsConfiguration globalConfig = this.corsConfigSource.getCorsConfiguration(request); // è·å–å…¨å±€çš„è·¨åŸŸé…ç½® CorsConfiguration handlerConfig = getCorsConfiguration(handler, request); CorsConfiguration config = (globalConfig != null ? globalConfig.combine(handlerConfig) : handlerConfig); // ç»“åˆå½“å‰handlerå’Œå…¨å±€é…ç½®ç»„åˆæˆä¸€ä¸ªæ–°çš„è·¨åŸŸé…ç½® executionChain = getCorsHandlerExecutionChain(request, executionChain, config); // é‡æ–°ç”Ÿæˆå¯ç”¨çš„æ‰§è¡Œé“¾å¯¹è±¡ } return executionChain;}</pre><p><strong>AbstractUrlHandlerMappingç±»</strong></p><pre>protected Object getHandlerInternal(HttpServletRequest request) throws Exception { String lookupPath = getUrlPathHelper().getLookupPathForRequest(request); // ä»requestä¸­è·å–åˆ°URLä¿¡æ¯ Object handler = lookupHandler(lookupPath, request); // å¾—åˆ°æ‰§è¡Œé“¾è·¯çš„å¯¹è±¡ï¼Œä¸€èˆ¬ä¸ºHandlerExecutionChain if (handler == null) { // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™åŒ¹é…ä¸€äº›ç‰¹æ®Šçš„è¯·æ±‚ï¼Œå°½å¯èƒ½çš„åŒ¹é…æ¸…æ¥š Object rawHandler = null; if ("/".equals(lookupPath)) { // æ ¹è·¯å¾„çš„handler rawHandler = getRootHandler(); } if (rawHandler == null) { // é»˜è®¤è·¯å¾„çš„handler rawHandler = getDefaultHandler(); } if (rawHandler != null) { // æ ¹è·¯å¾„æˆ–è€…é»˜è®¤è·¯å¾„ä¸­çš„ä¸€ä¸ªä¸ä¸ºnull if (rawHandler instanceof String) { String handlerName = (String) rawHandler; rawHandler = getApplicationContext().getBean(handlerName); } validateHandler(rawHandler, request); handler = buildPathExposingHandler(rawHandler, lookupPath, lookupPath, null); // åŒæ ·çš„å¥—è·¯å¾—åˆ°æ–°çš„æ‰§è¡Œé“¾è·¯å¯¹è±¡ä¿¡æ¯ } } if (handler != null &amp;&amp; logger.isDebugEnabled()) { logger.debug("Mapping [" + lookupPath + "] to " + handler); // æ‰“ä¸ªæ—¥å¿—ï¼Œè¡¨ç¤ºåŒ¹é…åˆ°äº†ç›¸å…³çš„beanä¿¡æ¯ } else if (handler == null &amp;&amp; logger.isTraceEnabled()) { logger.trace("No handler mapping found for [" + lookupPath + "]"); } return handler;}protected Object lookupHandler(String urlPath, HttpServletRequest request) throws Exception { // ä»hanlerMapä¸­è·å–è¯¥URLå¯¹åº”çš„controller Object handler = this.handlerMap.get(urlPath); if (handler != null) { //  if (handler instanceof String) { String handlerName = (String) handler; handler = getApplicationContext().getBean(handlerName); } validateHandler(handler, request); return buildPathExposingHandler(handler, urlPath, urlPath, null); } // æ²¡æœ‰å®Œå…¨åŒ¹é…ï¼Œé‡‡å–æ¨¡ç³ŠåŒ¹é…ï¼Œæ­£åˆ™è¿˜æ˜¯ï¼Ÿ // é¢˜å¤–è¯ï¼Œpythonçš„tornadoå’ŒDjangoéƒ½æ˜¯é‡‡ç”¨çš„æ­£åˆ™åŒ¹é…çš„ List&lt;String&gt; matchingPatterns = new ArrayList&lt;String&gt;(); for (String registeredPattern : this.handlerMap.keySet()) { if (getPathMatcher().match(registeredPattern, urlPath)) { // getPathMatcher() è¿”å›çš„å°±æ˜¯AntPathMatcherå¯¹è±¡ // åŒæ ·ä¹Ÿæ˜¯æŒ‰ç…§getPathMatcherçš„åŒ¹é…è§„åˆ™å»åŒ¹é…çš„ matchingPatterns.add(registeredPattern); } else if (useTrailingSlashMatch()) { if (!registeredPattern.endsWith("/") &amp;&amp; getPathMatcher().match(registeredPattern + "/", urlPath)) { matchingPatterns.add(registeredPattern +"/"); } } } // æ€»ä¹‹æœ€åä¼šå¾—åˆ°ä¸€ä¸ªlistï¼ŒåŒ…å«äº†åŒ¹é…ä¸­çš„URLä¿¡æ¯ String bestMatch = null; Comparator&lt;String&gt; patternComparator = getPathMatcher().getPatternComparator(urlPath); if (!matchingPatterns.isEmpty()) { Collections.sort(matchingPatterns, patternComparator); // æ¨¡ç³ŠåŒ¹é…çš„é›†åˆä¸ä¸ºç©º,åˆ™æŒ‰ç…§urlPathå®šä¹‰çš„æ’åºè§„åˆ™å»é‡æ’åº if (logger.isDebugEnabled()) { logger.debug("Matching patterns for request [" + urlPath + "] are " + matchingPatterns); } bestMatch = matchingPatterns.get(0); // ç¬¬ä¸€ä¸ªæ˜¯æœ€ä½³çš„åŒ¹é…è·¯å¾„ } if (bestMatch != null) { // æ¥ä¸‹æ¥çš„ä¸€åˆ‡éƒ½æ˜¯ä¾ç…§è¿™ä¸ªbestMatchä¸ä¸ºnullï¼Œå¦åˆ™å°±ç›´æ¥è¿”å›nullï¼Œè¡¨ç¤ºæ²¡æœ‰åˆé€‚çš„åŒ¹é…handler handler = this.handlerMap.get(bestMatch); if (handler == null) { // å¦‚æœå®¹å™¨ä¸­ä¸å­˜åœ¨è¯¥handler if (bestMatch.endsWith("/")) { handler = this.handlerMap.get(bestMatch.substring(0, bestMatch.length() - 1)); } // å¯¹æœ€ä½³çš„URLè·¯å¾„å¤„ç†ä¹‹åï¼Œè¿˜æ˜¯ä¸åœ¨å¯¹åº”çš„handlerï¼Œåˆ™æç¤ºæ²¡æœ‰å…·ä½“çš„handlerä¿¡æ¯ if (handler == null) { throw new IllegalStateException( "Could not find handler for best pattern match [" + bestMatch + "]"); } } // åŒ…å«äº†å¯¹åº”çš„handlerä¿¡æ¯äº† if (handler instanceof String) { String handlerName = (String) handler; handler = getApplicationContext().getBean(handlerName); // å¦‚æœæ˜¯stringï¼Œåˆ™é€šè¿‡springçš„å®¹å™¨è·å–å¯¹åº”çš„beanï¼ˆä¸€èˆ¬æ˜¯controllerï¼‰ } validateHandler(handler, request); String pathWithinMapping = getPathMatcher().extractPathWithinPattern(bestMatch, urlPath); //  Map&lt;String, String&gt; uriTemplateVariables = new LinkedHashMap&lt;String, String&gt;(); for (String matchingPattern : matchingPatterns) { if (patternComparator.compare(bestMatch, matchingPattern) == 0) { Map&lt;String, String&gt; vars = getPathMatcher().extractUriTemplateVariables(matchingPattern, urlPath); Map&lt;String, String&gt; decodedVars = getUrlPathHelper().decodePathVariables(request, vars); uriTemplateVariables.putAll(decodedVars); } } if (logger.isDebugEnabled()) { logger.debug("URI Template variables for request [" + urlPath + "] are " + uriTemplateVariables); }  // ç”Ÿæˆæ‰§è¡Œé“¾è·¯å¯¹è±¡HandlerExecutionChain return buildPathExposingHandler(handler, bestMatch, pathWithinMapping, uriTemplateVariables); } // ä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç°ï¼Œè¿”å›null return null;}protected Object buildPathExposingHandler(Object rawHandler, String bestMatchingPattern, String pathWithinMapping, Map&lt;String, String&gt; uriTemplateVariables) { HandlerExecutionChain chain = new HandlerExecutionChain(rawHandler); // åˆ›å»ºæ‰§è¡Œé“¾è·¯çš„å¯¹è±¡chain chain.addInterceptor(new PathExposingHandlerInterceptor(bestMatchingPattern, pathWithinMapping)); // æ·»åŠ PathExposingHandlerInterceptoræ‹¦æˆªå™¨ if (!CollectionUtils.isEmpty(uriTemplateVariables)) { chain.addInterceptor(new UriTemplateVariablesHandlerInterceptor(uriTemplateVariables)); } return chain;}</pre><p>å¦‚å›¾å°±æ˜¯è°ƒç”¨buildPathExposingHandlerä¹‹åè¿”å›çš„æ‰§è¡Œé“¾å¯¹è±¡chain</p><div class=pgc-img><img alt=SpringMVC:æ¥æ”¶åˆ°è¯·æ±‚åçš„è°ƒç”¨ç»†èŠ‚ï¼Œä½ æ˜¯å¦æ¸…æ¥šï¼Ÿ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/135a93bb7565473188e45f438fccab3a><p class=pgc-img-caption></p></div><h1><strong>404çŠ¶æ€ç </strong></h1><p>åœ¨æ²¡æ‰¾åˆ°åˆé€‚çš„handleræ‰§è¡Œé“¾çš„æ—¶å€™ï¼Œå°±ä¼šè¿›å…¥è¯¥æ–¹æ³•ï¼ˆå…¶å®å°±æ˜¯404äº†ï¼‰</p><pre>protected void noHandlerFound(HttpServletRequest request, HttpServletResponse response) throws Exception { if (pageNotFoundLogger.isWarnEnabled()) { // ç±»ä¼¼è¿™ç§ä»£ç å…¶å®æ˜¯ä¸ºäº†é€‚é…ä¸åŒçš„æ—¥å¿—ç³»ç»Ÿ pageNotFoundLogger.warn("No mapping found for HTTP request with URI [" + getRequestUri(request) + "] in DispatcherServlet with name '" + getServletName() + "'"); } if (this.throwExceptionIfNoHandlerFound) { throw new NoHandlerFoundException(request.getMethod(), getRequestUri(request), new ServletServerHttpRequest(request).getHeaders()); } else { // HttpServletResponse.SC_NOT_FOUND å°±æ˜¯404 // è°ƒç”¨çš„æ˜¯Tomcatæœ¬èº«çš„404è®¾ç½®é¡µé¢è¿”å›çš„ï¼Œå¯ä»¥åœ¨web.xml ä¸­é…ç½®è‡ªå®šä¹‰çš„404é¡µé¢ response.sendError(HttpServletResponse.SC_NOT_FOUND); }}</pre><p>å¦‚å›¾å°±æ˜¯é‡‡ç”¨äº†jdk14Loggeræ‰“å°å‡ºæ¥çš„æ•°æ®ï¼Œå½“ç„¶äº†ç°å®é¡¹ç›®ä¸­æ›´å¤šçš„åº”ç”¨log4jã€log4j2</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=SpringMVC:æ¥æ”¶åˆ°è¯·æ±‚åçš„è°ƒç”¨ç»†èŠ‚ï¼Œä½ æ˜¯å¦æ¸…æ¥šï¼Ÿ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5d11f176602b442d864f7d0184eba4dd><p class=pgc-img-caption></p></div><h1><strong>è·å–é€‚é…å™¨</strong></h1><pre>protected HandlerAdapter getHandlerAdapter(Object handler) throws ServletException { for (HandlerAdapter ha : this.handlerAdapters) { // handlerAdaptersçš„å€¼å°±æ˜¯åœ¨initStrategies()æ–¹æ³•ä¸­è·å–åˆ°çš„ // é»˜è®¤çš„é€‚é…å™¨æ˜¯ä¸‰ä¸ª  // org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter // org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter // org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter // å¦‚æœç»†çœ‹é€‚é…å™¨çš„åˆå§‹åŒ–è¿‡ç¨‹ä¼šå‘ç°ï¼Œspringä¼šä¼˜å…ˆè·å–ç”¨æˆ·è‡ªå®šä¹‰çš„é€‚é…å™¨ï¼Œå¦‚æœæ²¡æœ‰æ‰ä¼šé»˜è®¤ä½¿ç”¨è¿™ä¸‰ä¸ªé€‚é…å™¨ if (ha.supports(handler)) { return ha; } } throw new ServletException("No adapter for handler [" + handler + "]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler"); // å¸¸å‡ºç°çš„æ²¡æœ‰æ‰¾åˆ°é€‚é…å™¨çš„æŠ¥é”™çš„åœ°æ–¹å°±æ˜¯è¿™é‡Œï¼Œéå†äº†æ‰€æœ‰çš„é€‚é…å™¨å¹¶æ²¡æœ‰ç¬¦åˆhandlerçš„é€‚é…å™¨ï¼Œåˆ™æç¤ºæ²¡æœ‰é€‚é…å™¨}</pre><p>æ¥ä¸‹æ¥çœ‹çœ‹ä¸‰ç§é€‚é…å™¨åˆ°åº•æ˜¯å¦‚ä½•åˆ¤æ–­å¯¹è±¡æ˜¯ç¬¦åˆè‡ªèº«çš„è¦æ±‚çš„</p><p><strong>HttpRequestHandlerAdapter</strong></p><pre>@Overridepublic boolean supports(Object handler) { return (handler instanceof HttpRequestHandler); // æ˜¯å¦æ˜¯HttpRequestHandlerå¯¹è±¡}</pre><p><strong>SimpleControllerHandlerAdapter</strong></p><pre>@Overridepublic boolean supports(Object handler) { return (handler instanceof Controller); // æ˜¯å¦æ˜¯Controllerå¯¹è±¡}</pre><p><strong>AnnotationMethodHandlerAdapter</strong></p><pre>@Overridepublic boolean supports(Object handler) { return getMethodResolver(handler).hasHandlerMethods(); // è·å–åˆ°æ–¹æ³•å¤„ç†å™¨ï¼Œå†åˆ¤æ–­å…¶æ˜¯å¦ä¸ºç©º}private ServletHandlerMethodResolver getMethodResolver(Object handler) { Class&lt;?&gt; handlerClass = ClassUtils.getUserClass(handler); ServletHandlerMethodResolver resolver = this.methodResolverCache.get(handlerClass); if (resolver == null) { synchronized (this.methodResolverCache) { resolver = this.methodResolverCache.get(handlerClass); if (resolver == null) { resolver = new ServletHandlerMethodResolver(handlerClass); this.methodResolverCache.put(handlerClass, resolver); } } } return resolver;}</pre><h1><strong>LastModified æœºåˆ¶</strong></h1><p>ç»„åˆæˆä¸ºä¸€ä¸ªServletWebRequestå¯¹è±¡åå°±è°ƒç”¨è¯¥æ–¹æ³•ï¼Œç¡®è®¤lastModified</p><pre>public boolean checkNotModified(String etag, long lastModifiedTimestamp) { HttpServletResponse response = getResponse(); if (this.notModified || !isStatusOK(response)) { // ä¸éœ€è¦modifiedæœºåˆ¶æˆ–è€… responseä¸ºnullæˆ–è€…æ— æ•ˆæ›´æˆ–è€…çŠ¶æ€ç ä¸æ˜¯200 return this.notModified; } if (validateIfUnmodifiedSince(lastModifiedTimestamp)) { // å…¶å¯¹è±¡ä¼šå­˜å‚¨è¯¥è¯·æ±‚çš„æ—¶é—´ï¼ŒéªŒè¯æ˜¯å¦ç¬¦åˆlastModifiedçš„æ¡ä»¶ if (this.notModified) { response.setStatus(HttpStatus.PRECONDITION_FAILED.value()); } return this.notModified; } boolean validated = validateIfNoneMatch(etag); // é»˜è®¤ä¼ è¿‡æ¥çš„etagæ˜¯nullï¼Œè¿”å›false if (!validated) { validateIfModifiedSince(lastModifiedTimestamp); // çœ‹æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡æ¥ï¼Œå¦‚æœæ˜¯å°±éœ€è¦åˆ·æ–°å…¶æ—¶é—´ } boolean isHttpGetOrHead = SAFE_METHODS.contains(getRequest().getMethod()); // æ˜¯å¦ä¸ºgetæˆ–è€…headè¯·æ±‚ï¼Œå¹¶ä¸”å˜æ›´responseçš„å¤´ä¿¡æ¯ if (this.notModified) { response.setStatus(isHttpGetOrHead ? HttpStatus.NOT_MODIFIED.value() : HttpStatus.PRECONDITION_FAILED.value()); } if (isHttpGetOrHead) { if(lastModifiedTimestamp &gt; 0 &amp;&amp; isHeaderAbsent(response, LAST_MODIFIED)) { response.setDateHeader(LAST_MODIFIED, lastModifiedTimestamp); } if (StringUtils.hasLength(etag) &amp;&amp; isHeaderAbsent(response, ETAG)) { response.setHeader(ETAG, padEtagIfNecessary(etag)); } } // å¦‚æœç¬¦åˆå…¶æœºåˆ¶ï¼Œå°±è¿”å›trueï¼Œå¦åˆ™è¿”å›false return this.notModified;}</pre><p><strong>invokeè°ƒç”¨</strong></p><p>åªæ˜¯å–äº†è¿™ä¹ˆä¸ªåå­—ï¼Œåœ¨è·å–åˆ°äº†åˆé€‚çš„æ‰§è¡Œé“¾ï¼Œæœ‰äº†åˆé€‚çš„é€‚é…å™¨ï¼Œæœ‰æ²¡æœ‰è¢«æ‹¦æˆªå™¨å¤„ç†ï¼Œæœ€åæ¥åˆ°äº†çœŸæ­£è°ƒç”¨æ–¹æ³•çš„åœ°æ–¹äº†ã€‚</p><p>ä¸Šæ–‡å¯çŸ¥ï¼Œè¿™æ˜¯ç”±å„è‡ªçš„é€‚é…å™¨è°ƒç”¨handleræ–¹æ³•æ¥è·å–çœŸæ­£çš„å†…å®¹äº†ã€‚</p><p>åœ¨æ²¡çœ‹æºç å‰ï¼Œå…¶å®æˆ‘ä»¬åº”è¯¥èƒ½å¤ŸçŒœåˆ°ä¸€äº›ç»†èŠ‚ï¼Œä¾‹å¦‚</p><ul><li>ä¸Šé¢è¯´çš„beançš„nameæ˜¯\å¼€å¤´çš„è¢«SimpleControllerHandlerAdapterå‘½ä¸­ï¼Œå¯æ˜¯åœ¨è¯¥æ–¹æ³•ä¸­å¹¶æ²¡æœ‰æ˜ç¡®å®šä¹‰æ‰§è¡Œçš„æ–¹æ³•ï¼Œæ‰€ä»¥controlleræ¥å£å¿…é¡»æœ‰ä¸€äº›æ–¹æ³•è¦è¢«å®ç°ï¼Œç„¶åç”±é€‚é…å™¨è°ƒç”¨å®ç°ç±»è¾¾åˆ°è·å–å†…å®¹çš„ç›®çš„</li><li>æ™®é€šçš„åŠ äº†requestMappingè¢«AnnotationMethodHandlerAdapterå‘½ä¸­ï¼Œåˆ™åº”è¯¥æ˜¯é€šè¿‡åå°„è·å–æ‰€æœ‰çš„å¯è¡Œçš„æ–¹æ³•ï¼Œç„¶åä¾æ¬¡ç­›é€‰ï¼Œç›´åˆ°åŒ¹é…ä¸Šäº†åˆé€‚çš„æ–¹æ³•ï¼Œå†invokeè°ƒç”¨è¿”å›å…¶å†…å®¹</li></ul><p><strong>SimpleControllerHandlerAdapter</strong></p><p>HttpRequestHandlerAdapterå’ŒSimpleControllerHandlerAdapteræ˜¯ä¸€æ ·çš„ï¼Œå°±åªè§£é‡Šä¸€ç§äº†ã€‚</p><pre>public ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { return ((Controller) handler).handleRequest(request, response); // æœç„¶ä¸å‡ºæˆ‘ä»¬æœŸæœ›çš„ï¼Œå°±æ˜¯controlleræ¥å£å®ç°çš„æ–¹æ³•handleRequestå»å®ŒæˆçœŸæ­£çš„è°ƒç”¨ // å¦‚ä¸‹é¢çš„demoï¼Œå°±æ˜¯è°ƒç”¨è¯¥æ–¹æ³•ï¼Œä¸è¿‡æ­¤æ–¹æ³•æ„å‘³ç€ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªURLæ˜ å°„ // ä¸åƒæ³¨è§£é‚£æ ·ä¸€ä¸ªç±»ä¸­å¯ä»¥åŒ…å«å¤šç§URLæ˜ å°„}public class NameController implements Controller { @Override public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception { ModelAndView modelAndView=new ModelAndView(); modelAndView.setViewName("/page/404"); return modelAndView; }}</pre><p><strong>AnnotationMethodHandlerAdapter</strong></p><pre>public ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { Class&lt;?&gt; clazz = ClassUtils.getUserClass(handler); Boolean annotatedWithSessionAttributes = this.sessionAnnotatedClassesCache.get(clazz); if (annotatedWithSessionAttributes == null) { annotatedWithSessionAttributes = (AnnotationUtils.findAnnotation(clazz, SessionAttributes.class) != null); this.sessionAnnotatedClassesCache.put(clazz, annotatedWithSessionAttributes); }  if (annotatedWithSessionAttributes) { checkAndPrepare(request, response, this.cacheSecondsForSessionAttributeHandlers, true); } else { checkAndPrepare(request, response, true); } if (this.synchronizeOnSession) { HttpSession session = request.getSession(false); if (session != null) { Object mutex = WebUtils.getSessionMutex(session); synchronized (mutex) { return invokeHandlerMethod(request, response, handler); } } } // å‰é¢å„ç§æ“ä½œæ¥åˆ°äº†inVokeMethod return invokeHandlerMethod(request, response, handler);}protected ModelAndView invokeHandlerMethod(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { ServletHandlerMethodResolver methodResolver = getMethodResolver(handler); Method handlerMethod = methodResolver.resolveHandlerMethod(request); // å¤„ç†requestï¼Œå¾—åˆ°å¯¹åº”çš„éœ€è¦è¢«æ‰§è¡Œçš„æ–¹æ³• // åœ¨è¿™ä¸ªå‡½æ•°ä¸­è¿˜æœ‰ç±»URLæ³¨è§£ä¿¡æ¯å’Œæ–¹æ³•æ³¨è§£ä¿¡æ¯çš„æ‹¼æ¥åŒ¹é…è¿‡ç¨‹ // è¿”å›çš„å¯¹è±¡å°±æ˜¯ä¸€ä¸ªMethodå¯¹è±¡ ServletHandlerMethodInvoker methodInvoker = new ServletHandlerMethodInvoker(methodResolver); ServletWebRequest webRequest = new ServletWebRequest(request, response); ExtendedModelMap implicitModel = new BindingAwareModelMap(); Object result = methodInvoker.invokeHandlerMethod(handlerMethod, handler, webRequest, implicitModel); // è¿™ä¸ªæ˜¯çœŸæ­£çš„è°ƒç”¨è¿‡ç¨‹ï¼Œå…¶ä¸­è¿˜åŒ…å«äº†è¯·æ±‚å‚æ•°çš„å¤„ç†ç­‰å„ç§è¿‡ç¨‹ // è¿”å›çš„ç»“æœå¯ä»¥æ˜¯å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥æ˜¯mvï¼Œçœ‹å…·ä½“çš„æ–¹æ³•æ˜¯å¦‚ä½•å®ç°çš„ ModelAndView mav = methodInvoker.getModelAndView(handlerMethod, handler.getClass(), result, implicitModel, webRequest); // è·å–å…·ä½“çš„è§†å›¾ç±»ï¼Œå¦‚æœæ˜¯å…·ä½“ä¸šåŠ¡è¿”å›ï¼Œè§†å›¾ä¸ºnullï¼Œå…·ä½“çš„æ•°æ®å·²ç»é€šè¿‡responseçš„bodyå›å¡«è¿”å›äº† methodInvoker.updateModelAttributes(handler, (mav != null ? mav.getModel() : null), implicitModel, webRequest); // è§†å›¾å±æ€§æ›´æ–° return mav;}</pre><p class=ql-align-center><br></p><div class=pgc-img><img alt=SpringMVC:æ¥æ”¶åˆ°è¯·æ±‚åçš„è°ƒç”¨ç»†èŠ‚ï¼Œä½ æ˜¯å¦æ¸…æ¥šï¼Ÿ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2205336a8e1a4cfe8ee0f14626feb2e9><p class=pgc-img-caption></p></div><pre>public ModelAndView getModelAndView(Method handlerMethod, Class&lt;?&gt; handlerType, Object returnValue, ExtendedModelMap implicitModel, ServletWebRequest webRequest) throws Exception { ResponseStatus responseStatus = AnnotatedElementUtils.findMergedAnnotation(handlerMethod, ResponseStatus.class); // æŸ¥çœ‹è¯¥æ–¹æ³•æ˜¯å¦åŠ äº†ResponseStatusæ³¨è§£ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ›¿æ¢çŠ¶æ€ç  if (responseStatus != null) { HttpStatus statusCode = responseStatus.code(); String reason = responseStatus.reason(); // è¯¥æ‰§è¡Œæ–¹æ³•å­˜åœ¨è¯¥ResponseStatusçš„æ³¨è§£ï¼Œè·å–çŠ¶æ€ç å’ŒåŸå›  // ä¸è¿‡è¯¥å…·ä½“ä½¿ç”¨çš„æ—¶å€™ï¼Œåªèƒ½æ˜¯HttpStatusæšä¸¾ç±»ä¸­çš„é€‰é¡¹ï¼Œé»˜è®¤æ˜¯500é”™è¯¯ if (!StringUtils.hasText(reason)) { // æ²¡æœ‰å…·ä½“åŸå› ï¼Œå°±åªè®¾ç½®çŠ¶æ€ç ï¼Œå¦åˆ™å°±è¿”å›é”™è¯¯ç  webRequest.getResponse().setStatus(statusCode.value()); } else { webRequest.getResponse().sendError(statusCode.value(), reason); } // è®¾ç½®å½“å‰çš„è¯·æ±‚å±æ€§ï¼Œåå­—ä¸ºæ¨¡æ¿å’ŒçŠ¶æ€ï¼Œå€¼å°±æ˜¯çŠ¶æ€ç  webRequest.getRequest().setAttribute(View.RESPONSE_STATUS_ATTRIBUTE, statusCode); this.responseArgumentUsed = true; } // å¦‚æœå­˜åœ¨è‡ªå®šä¹‰çš„ModelAndViewè§£æ if (customModelAndViewResolvers != null) { for (ModelAndViewResolver mavResolver : customModelAndViewResolvers) { ModelAndView mav = mavResolver.resolveModelAndView( handlerMethod, handlerType, returnValue, implicitModel, webRequest); // éå†è‡ªå®šä¹‰ModelAndViewè§£æå™¨ï¼Œé€‰æ‹©åˆé€‚çš„mvï¼Œå¹¶ä¸”ä¸æ˜¯åˆå§‹åŒ–çš„è§†å›¾ç±» // è¿™ä¸ªæ˜¯ç”±ç”¨æˆ·è‡ªå®šä¹‰çš„å®ç°ç±»ï¼Œå¹¶ä¸”åˆ‡è®°è®°å¾—é€‚é…å™¨çš„è®¾ç½®ï¼Œåˆ«æ²¡å¼„å¥½å¯¼è‡´æ— åˆé€‚çš„é€‚é…å™¨çš„é”™è¯¯ // ModelAndView UNRESOLVED = new ModelAndView(); if (mav != ModelAndViewResolver.UNRESOLVED) { return mav; } } }  // è¿”å›çš„ç±»å‹æ˜¯HttpEntityã€stringã€ModelAndViewã€Modelã€Viewã€Map if (returnValue instanceof HttpEntity) { // è¿”å›å€¼æ˜¯HttpEntityç±»å‹çš„æ•°æ®ï¼Œä¸éœ€è¦åˆé€‚çš„è§†å›¾ // æ›´å¤šçš„æ˜¯è¿”å›jsonæ•°æ® handleHttpEntityResponse((HttpEntity&lt;?&gt;) returnValue, webRequest); return null; } else if (AnnotationUtils.findAnnotation(handlerMethod, ResponseBody.class) != null) { // æ–¹æ³•åŒ…å«äº†ResponseBodyæ³¨è§£ï¼Œç›´æ¥æŠŠreturnValue å¡å…¥response handleResponseBody(returnValue, webRequest); return null; } else if (returnValue instanceof ModelAndView) { ModelAndView mav = (ModelAndView) returnValue; mav.getModelMap().mergeAttributes(implicitModel); return mav; } else if (returnValue instanceof Model) { return new ModelAndView().addAllObjects(implicitModel).addAllObjects(((Model) returnValue).asMap()); } else if (returnValue instanceof View) { return new ModelAndView((View) returnValue).addAllObjects(implicitModel); } else if (AnnotationUtils.findAnnotation(handlerMethod, ModelAttribute.class) != null) { addReturnValueAsModelAttribute(handlerMethod, handlerType, returnValue, implicitModel); return new ModelAndView().addAllObjects(implicitModel); } else if (returnValue instanceof Map) { return new ModelAndView().addAllObjects(implicitModel).addAllObjects((Map&lt;String, ?&gt;) returnValue); } else if (returnValue instanceof String) { return new ModelAndView((String) returnValue).addAllObjects(implicitModel); } else if (returnValue == null) { // Either returned null or was 'void' return. if (this.responseArgumentUsed || webRequest.isNotModified()) { return null; } else { // Assuming view name translation... return new ModelAndView().addAllObjects(implicitModel); } } else if (!BeanUtils.isSimpleProperty(returnValue.getClass())) { // Assume a single model attribute... addReturnValueAsModelAttribute(handlerMethod, handlerType, returnValue, implicitModel); return new ModelAndView().addAllObjects(implicitModel); } else { throw new IllegalArgumentException("Invalid handler method return value: " + returnValue); } }</pre><p>åœ¨è¿™å…¶ä¸­çš„ä»£ç å¿«customModelAndViewResolversï¼Œæ›´å¤šçš„ç»†èŠ‚å¯ä»¥çœ‹çœ‹Spring Controllerå±‚è®°å½•æ—¥å¿—é…ç½®çš„å®è·µdemo</p><h1><strong>è§†å›¾æ¸²æŸ“</strong></h1><pre>private void processDispatchResult(HttpServletRequest request, HttpServletResponse response, HandlerExecutionChain mappedHandler, ModelAndView mv, Exception exception) throws Exception { boolean errorView = false; if (exception != null) { // æœ‰å¼‚å¸¸ï¼Œä¸èƒ½æ­£å¸¸æ˜¾ç¤ºè¯·æ±‚å†…å®¹äº† if (exception instanceof ModelAndViewDefiningException) { logger.debug("ModelAndViewDefiningException encountered", exception); mv = ((ModelAndViewDefiningException) exception).getModelAndView(); } else { Object handler = (mappedHandler != null ? mappedHandler.getHandler() : null); mv = processHandlerException(request, response, handler, exception); // å¼‚å¸¸å¤„ç†è¿”å›çš„mvï¼Œå¼‚å¸¸mvé…ç½®å­˜æ”¾åœ¨handlerExceptionResolvers errorView = (mv != null); } } // æœ‰å¯ç”¨çš„mv if (mv != null &amp;&amp; !mv.wasCleared()) { render(mv, request, response); // renderå°±æ˜¯æ¸²æŸ“ï¼Œå›å¡«æ•°æ®åˆ°responseä¸­å» if (errorView) { // å¦‚æœæœ‰éModelAndViewDefiningExceptionï¼Œåˆ™æ¸…é™¤è¯·æ±‚çš„å±æ€§ä¿¡æ¯ WebUtils.clearErrorRequestAttributes(request); } } else { // æ²¡æœ‰å¯ç”¨çš„è§†å›¾ä¿¡æ¯ if (WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) { // Concurrent handling started during a forward return; } if (mappedHandler != null) { mappedHandler.triggerAfterCompletion(request, response, null); }}</pre><p><strong>æ¸²æŸ“render</strong></p><pre>protected void render(ModelAndView mv, HttpServletRequest request, HttpServletResponse response) throws Exception { // Determine locale for request and apply it to the response. Locale locale = this.localeResolver.resolveLocale(request); response.setLocale(locale); View view; if (mv.isReference()) { // mvçš„è§†å›¾åå­—æ˜¯stringç±»å‹ï¼Œåˆ™éœ€è¦æ‰¾åˆ°çœŸæ­£çš„è§†å›¾ // éœ€è¦ä½¿ç”¨åˆ°localå­—æ®µä¿¡æ¯ view = resolveViewName(mv.getViewName(), mv.getModelInternal(), locale, request); if (view == null) { // æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„è§†å›¾ï¼ŒæŠ¥é”™æç¤º throw new ServletException("Could not resolve view with name '" + mv.getViewName() + "' in servlet with name '" + getServletName() + "'"); } } else { // å¦åˆ™å°±è¢«è®¤ä¸ºæ˜¯Viewå¯¹è±¡ï¼Œç›´æ¥è·å–å°±å¯ä»¥äº† view = mv.getView(); if (view == null) { throw new ServletException("ModelAndView [" + mv + "] neither contains a view name nor a " + "View object in servlet with name '" + getServletName() + "'"); } } // Delegate to the View object for rendering. if (logger.isDebugEnabled()) { logger.debug("Rendering view [" + view + "] in DispatcherServlet with name '" + getServletName() + "'"); } try { if (mv.getStatus() != null) { // ä»mvä¸­è·å–httpçŠ¶æ€ç  response.setStatus(mv.getStatus().value()); } // æ¥åˆ°äº†çœŸæ­£çš„æ¸²æŸ“ï¼Œæ‰€æœ‰çš„æ•°æ®å·²ç»å‡†å¤‡å°±ç»ª view.render(mv.getModelInternal(), request, response); } catch (Exception ex) { if (logger.isDebugEnabled()) { logger.debug("Error rendering view [" + view + "] in DispatcherServlet with name '" + getServletName() + "'", ex); } throw ex; }}</pre><p>å…¶ä¸­çš„resolve</p><h1><strong>View æ¸²æŸ“</strong></h1><p>Viewæœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ç±»ï¼Œspringæ ¹æ®ä¸åŒçš„ä¸šåŠ¡å®ç°äº†å¤šä¸ªä¸åŒçš„Viewå®ä½“ç±»ï¼ŒåŒ…å«äº†htmlã€pdfã€Excelç­‰ã€‚</p><p><strong>AbstractView æŠ½è±¡è§†å›¾ç±»</strong></p><pre>public void render(Map&lt;String, ?&gt; model, HttpServletRequest request, HttpServletResponse response) throws Exception { Map&lt;String, Object&gt; mergedModel = createMergedOutputModel(model, request, response); prepareResponse(request, response); renderMergedOutputModel(mergedModel, getRequestToExpose(request), response);}</pre><p>ç”±å„è‡ªçš„å­ç±»å»å®ç°renderMergedOutputModelæ–¹æ³•</p><div class=pgc-img><img alt=SpringMVC:æ¥æ”¶åˆ°è¯·æ±‚åçš„è°ƒç”¨ç»†èŠ‚ï¼Œä½ æ˜¯å¦æ¸…æ¥šï¼Ÿ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b643785ca8f8407eb0521cdde4f2c4f4><p class=pgc-img-caption></p></div><h1 class=ql-align-center><strong>åŸåˆ›æ¨è</strong></h1><p class=ql-align-center><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6714635036563341838/?group_id=6714635036563341838" target=_blank>ã€Œç³»åˆ—æ•™ç¨‹ã€æ‰‹å†™RPCæ¡†æ¶(1)ï¼Œçœ‹çœ‹100ä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨æƒ…å†µå¦‚ä½•</a></p><p class=ql-align-center><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6711984615948550670/?group_id=6711984615948550670" target=_blank>ã€Œé¢è¯•ã€new String("abc")å’Œ"abc"æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿåç¼–è¯‘çœ‹çœ‹åŸç†å§</a></p><p class=ql-align-center><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6721928402791563783/?group_id=6721928402791563783" target=_blank>é¢è¯•ï¼šä½ æ˜¯å¦äº†è§£Spring BeanPostProcessorçš„åŸç†å’Œå…·ä½“ä½¿ç”¨åœºæ™¯</a></p><p class=ql-align-center><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6716039801792889348/?group_id=6716039801792889348" target=_blank>ã€ŒSpringæºç ã€XMLè§£æBeanDefinitionåŸç†å­¦ä¹ </a></p><p class=ql-align-center><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6722403219303039501/?group_id=6722403219303039501" target=_blank>ä»Tomcatå…¥å£äº†è§£Spring MVCçš„è¯·æ±‚å¤„ç†æµç¨‹</a></p><p class=ql-align-center><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6711319178290135566/?group_id=6711319178290135566" target=_blank>ã€ŒSpringæºç ã€æ·±å…¥å­¦ä¹ äº‹ä»¶é€šçŸ¥æœºåˆ¶</a></p><p class=ql-align-center><a class=pgc-link data-content=mp href="https://www.toutiao.com/i6723792776560902670/?group_id=6723792776560902670" target=_blank>SpringåŸç†ï¼š10ä¸ªSpring&SpringBooté«˜é˜¶ç”¨æ³•ï¼Œä½ æ˜¯å¦æ¸…æ¥šï¼Ÿ</a></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'SpringMVC','è¯·æ±‚','è°ƒç”¨'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>