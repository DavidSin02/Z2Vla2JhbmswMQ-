<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>M3U8 视频文件 | 极客快訊</title><meta property="og:title" content="M3U8 视频文件 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/59af06196e7a49a2ad3e11bec58c55d1"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f0293c9b.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f0293c9b.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f0293c9b.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f0293c9b.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f0293c9b.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f0293c9b.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f0293c9b.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f0293c9b.html><meta property="article:published_time" content="2020-11-14T21:03:09+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:09+08:00"><meta name=Keywords content><meta name=description content="M3U8 视频文件"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/f0293c9b.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>M3U8 视频文件</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>这篇文章只是 M3U、M3U8、HLS、TS 相关的一些基础概念</p><p>"M3U" 和 "M3U8" 文件都是苹果公司使用的 HTTP Live Streaming（HLS） 协议格式的基础，这种协议格式可以在 iPhone 和 Macbook 等设备播放。</p><h2 class=pgc-h-arrow-right>HLS 解决方案</h2><p>HLS(HTTP Live Streaming) 是由Apple公司定义的用于实时流传输的协议，HLS基于HTTP协议实现，传输内容包括两部分，一是M3U8描述文件，二是TS媒体文件。</p><h3 class=pgc-h-arrow-right>1. HLS的优势为：自适应码率流播（adaptive streaming）。</h3><p>效果就是客户端会根据网络状况自动选择不同码率的视频流，条件允许的情况下使用高码率，网络繁忙的时候使用低码率，并且能够自动在二者之间随意切换。这对移动设备网络状况不稳定的情况下保障流畅播放非常有帮助。实现方法是服务器端提供多码率视频流，并且在列表文件中注明，播放器根据播放进度和下载速度进行自动调整。</p><h3 class=pgc-h-arrow-right>2. 为什么要用 TS 而不是 MP4</h3><p>这是因为两个 TS 片段可以无缝拼接，播放器能连续播放，而 MP4 文件由于编码方式的原因，两段 MP4 不能无缝拼接，播放器连续播放两个 MP4 文件会出现破音和画面间断，影响用户体验。而且如果要在一段长达一小时的视频中跳转，如果使用单个 MP4 格式的视频文件，并且也是用 HTTP 协议，那么需要代理服务器支持 HTTP range request 获取大文件中的一部分。这样的话，对于代理服务器的性能来说要求较高。而 HTTP Live Streaming 则只需要根据列表文件中的时间轴找出对应的 TS 片段下载即可，不需要 range request，对代理服务器的要求小很多。所有代理服务器都支持小文件的高效缓存。</p><h3 class=pgc-h-arrow-right>3. 可以使用FFmpeg转MP4为HLS(M3U8)文件。</h3><h3 class=pgc-h-arrow-right>4. hsl处理方案</h3><div class=pgc-img><img alt="M3U8 视频文件" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/59af06196e7a49a2ad3e11bec58c55d1><p class=pgc-img-caption></p></div><p>核心，在于对于 m3u8 的文件解析和 通过 XHR 去完成对分片内容二进制文件的获取，然后使用 MSE 的 appendBuffer 去进行 buffer 的封装，然后自己完成合流的工作。</p><h2 class=pgc-h-arrow-right>M3U8</h2><p>M3U 文件是记录了一个索引纯文本文件，可以指定一个或多个多媒体文件的位置，其文件扩展名是“M3U”或者“m3u”。打开它时播放软件并不是播放它，而是根据它的索引找到对应的音视频文件的网络地址进行在线播放。M3U文件的作用通常是创建指向在线流媒体的播放列表，创建的文件可以轻松访问流媒体。</p><p>M3U8 是Unicode版本的 M3U ，用UTF-8编码。</p><p>m3u8 文件实质是一个播放列表（playlist），其可能是一个媒体播放列表（Media Playlist），或者是一个主列表（Master Playlist）。</p><p>当 m3u8 文件作为媒体播放列表（Meida Playlist）时，其内部信息记录的是一系列媒体片段资源，顺序播放该片段资源，即可完整展示多媒体资源。对于点播来说，客户端只需按顺序下载片段资源，依次进行播放即可。而对于直播来说，客户端需要定时重新请求该 m3u8 文件，看下是否有新的片段数据需要进行下载并播放。</p><p>当 m3u8 作为主播放列表（Master Playlist）时，其内部提供的是同一份媒体资源的多份流列表资源（Variant Strean）。客户可以根据不同的网络状态选取合适码流的资源，并且最好根据用户喜好选择合适的资源内容。</p><p>m3u8 文件要么是媒体播放列表，要么是主播放列表。但无论是哪种列表，其有效组成均由两部分构成：</p><ul><li>以 #EXT 开头的为标签信息，作为对媒体资源的进一步描述；</li><li>剩余的为资源信息，要么是片段资源（Media Playlist）路径，要么是 m3u8 资源（Master Playlist）路径；</li></ul><h3 class=pgc-h-arrow-right>m3u8文件遵循的条件：</h3><ul><li>m3u8 文件必须以 utf-8 进行编码，不能使用 Byte Order Mark（BOM）字节序， 不能包含 utf-8 控制字符（U+0000 ~ U_001F 和 U+007F ~ u+009F）。</li><li>3u8 文件的每一行要么是一个 URI，要么是空行，要么就是以 # 开头的字符串。不能出现空白字符，除了显示声明的元素。</li><li>m3u8 文件中以 # 开头的字符串要么是注释，要么就是标签。标签以 #EXT 开头，大小写敏感。</li></ul><h3 class=pgc-h-arrow-right>m3u8 标签</h3><p>标签用于指定 m3u8 文件的全局参数或在其后面的切片文件/媒体播放列表的一些信息。</p><pre><code>#EXTM3U // 表明该文件是一个 m3u8 文件，必须在文件的第一行#EXT-X-VERSION:3   //  HLS 的协议版本号#EXT-X-ALLOW-CACHE:NO#EXT-X-MEDIA-SEQUENCE:1572999465  // M3U8直播时的直播切换序列，当播放打开M3U8时，以这个标签的值作为参考，播放对应的序列号的切片#EXT-X-TARGETDURATION:6 // 该标签指定了媒体文件持续时间的最大值,，播放文件列表中的媒体文件在EXTINF标签中定义的持续时间必须小于或者等于该标签指定的持续时间。该标签在播放列表文件中必须出现一次。#EXT-QQHLS-PIC-WIDTH:0#EXT-QQHLS-PIC-HEIGHT:0#EXT-QQHLS-CK:CRC_16#EXT-QQHLS-BN:8#EXT-QQHLS-SEGMENT-TYPE:0#EXT-QQHLS-SEGMENT_RANGE:1572999448-1572999472#EXT-X-PROGRAM-DATE-TIME:2019-11-06T10:11:57+08:00 // 片段取样时间#EXT-QQHLS-MACHINEID:56448#EXT-QQHLS-START-TIME:1573006317#EXT-SID:1572999465#EXT-SC:SZ=254364&amp;CK=e633#EXT-BC:SZ=31744&amp;CK=782e#EXT-BC:SZ=31744&amp;CK=256a#EXT-BC:SZ=31744&amp;CK=7b04#EXT-BC:SZ=31744&amp;CK=30dd#EXT-BC:SZ=31744&amp;CK=6d89#EXT-BC:SZ=31744&amp;CK=46d#EXT-BC:SZ=31744&amp;CK=8f4#EXT-BC:SZ=32156&amp;CK=71b5#EXTINF:5.000,100204101-1572999465.ts?cdncode=/18907E7BE0798990/&amp;HLSP2P=1&amp;buname=qqlive&amp;sdtfrom=10002212&amp;vkey=F1FE87B5E6D84B6FEFBB683D7C2558C08C8CF7B6E752E05C689F1117D651C359E4C7460F44AF4CA4D54188D17A34DB8F3D1E1A9B03F5F5509AFFC93EEA5B90B835EB1E096C8EA81447313AD2761912137D4F692E8AEC2D52E0E3ACD02E09272F82A1FC8573388BDE57FBE56A424E01BA// EXTINF为M3U8列表中每一个分片的duration,描述信息#EXT-X-PROGRAM-DATE-TIME:2019-11-06T10:12:02+08:00#EXT-QQHLS-MACHINEID:56448#EXT-QQHLS-START-TIME:1573006322#EXT-SID:1572999466#EXT-SC:SZ=287264&amp;CK=6abc#EXT-BC:SZ=35840&amp;CK=aa34#EXT-BC:SZ=35840&amp;CK=42f1#EXT-BC:SZ=35840&amp;CK=46f#EXT-BC:SZ=35840&amp;CK=3fd#EXT-BC:SZ=35840&amp;CK=75b2#EXT-BC:SZ=35840&amp;CK=af4f#EXT-BC:SZ=35840&amp;CK=52a1#EXT-BC:SZ=36384&amp;CK=86ed#EXTINF:5.000,100204101-1572999466.ts?cdncode=/18907E7BE0798990/&amp;HLSP2P=1&amp;buname=qqlive&amp;sdtfrom=10002212&amp;vkey=F1FE87B5E6D84B6FEFBB683D7C2558C08C8CF7B6E752E05C689F1117D651C359E4C7460F44AF4CA4D54188D17A34DB8F3D1E1A9B03F5F5509AFFC93EEA5B90B835EB1E096C8EA81447313AD2761912137D4F692E8AEC2D52E0E3ACD02E09272F82A1FC8573388BDE57FBE56A424E01BA#EXT-X-PROGRAM-DATE-TIME:2019-11-06T10:12:07+08:00#EXT-QQHLS-MACHINEID:56448#EXT-QQHLS-START-TIME:1573006327#EXT-SID:1572999467#EXT-SC:SZ=289708&amp;CK=749f#EXT-BC:SZ=35840&amp;CK=a209#EXT-BC:SZ=35840&amp;CK=abb9#EXT-BC:SZ=35840&amp;CK=13ab#EXT-BC:SZ=35840&amp;CK=40b7#EXT-BC:SZ=35840&amp;CK=2e10#EXT-BC:SZ=35840&amp;CK=3a00#EXT-BC:SZ=35840&amp;CK=62ae#EXT-BC:SZ=38828&amp;CK=65e5#EXTINF:5.000,100204101-1572999467.ts?cdncode=/18907E7BE0798990/&amp;HLSP2P=1&amp;buname=qqlive&amp;sdtfrom=10002212&amp;vkey=F1FE87B5E6D84B6FEFBB683D7C2558C08C8CF7B6E752E05C689F1117D651C359E4C7460F44AF4CA4D54188D17A34DB8F3D1E1A9B03F5F5509AFFC93EEA5B90B835EB1E096C8EA81447313AD2761912137D4F692E8AEC2D52E0E3ACD02E09272F82A1FC8573388BDE57FBE56A424E01BA#EXT-X-PROGRAM-DATE-TIME:2019-11-06T10:12:11+08:00#EXT-QQHLS-MACHINEID:56448#EXT-QQHLS-START-TIME:1573006331#EXT-SID:1572999468#EXT-SC:SZ=523016&amp;CK=97c#EXT-BC:SZ=64512&amp;CK=a072#EXT-BC:SZ=64512&amp;CK=b80e#EXT-BC:SZ=64512&amp;CK=13ee#EXT-BC:SZ=64512&amp;CK=2c70#EXT-BC:SZ=64512&amp;CK=992c#EXT-BC:SZ=64512&amp;CK=3c51#EXT-BC:SZ=64512&amp;CK=a079#EXT-BC:SZ=71432&amp;CK=a66#EXTINF:5.000,100204101-1572999468.ts?cdncode=/18907E7BE0798990/&amp;HLSP2P=1&amp;buname=qqlive&amp;sdtfrom=10002212&amp;vkey=F1FE87B5E6D84B6FEFBB683D7C2558C08C8CF7B6E752E05C689F1117D651C359E4C7460F44AF4CA4D54188D17A34DB8F3D1E1A9B03F5F5509AFFC93EEA5B90B835EB1E096C8EA81447313AD2761912137D4F692E8AEC2D52E0E3ACD02E09272F82A1FC8573388BDE57FBE56A424E01BA#EXT-X-PROGRAM-DATE-TIME:2019-11-06T10:12:16+08:00#EXT-QQHLS-MACHINEID:56448#EXT-QQHLS-START-TIME:1573006336#EXT-SID:1572999469#EXT-SC:SZ=670032&amp;CK=6479#EXT-BC:SZ=82944&amp;CK=dc72#EXT-BC:SZ=82944&amp;CK=e970#EXT-BC:SZ=82944&amp;CK=4ca4#EXT-BC:SZ=82944&amp;CK=3d1b#EXT-BC:SZ=82944&amp;CK=fa9b#EXT-BC:SZ=82944&amp;CK=e9d3#EXT-BC:SZ=82944&amp;CK=ee0b#EXT-BC:SZ=89424&amp;CK=b998#EXTINF:5.000,100204101-1572999469.ts?cdncode=/18907E7BE0798990/&amp;HLSP2P=1&amp;buname=qqlive&amp;sdtfrom=10002212&amp;vkey=F1FE87B5E6D84B6FEFBB683D7C2558C08C8CF7B6E752E05C689F1117D651C359E4C7460F44AF4CA4D54188D17A34DB8F3D1E1A9B03F5F5509AFFC93EEA5B90B835EB1E096C8EA81447313AD2761912137D4F692E8AEC2D52E0E3ACD02E09272F82A1FC8573388BDE57FBE56A424E01BA#EXT-X-PROGRAM-DATE-TIME:2019-11-06T10:12:21+08:00#EXT-QQHLS-MACHINEID:56448#EXT-QQHLS-START-TIME:1573006341#EXT-SID:1572999470#EXT-SC:SZ=777756&amp;CK=a13c#EXT-BC:SZ=96256&amp;CK=e95e#EXT-BC:SZ=96256&amp;CK=f459#EXT-BC:SZ=96256&amp;CK=33a6#EXT-BC:SZ=96256&amp;CK=bb7c#EXT-BC:SZ=96256&amp;CK=f3e4#EXT-BC:SZ=96256&amp;CK=635d#EXT-BC:SZ=96256&amp;CK=67e9#EXT-BC:SZ=103964&amp;CK=b938#EXTINF:5.000,100204101-1572999470.ts?cdncode=/18907E7BE0798990/&amp;HLSP2P=1&amp;buname=qqlive&amp;sdtfrom=10002212&amp;vkey=F1FE87B5E6D84B6FEFBB683D7C2558C08C8CF7B6E752E05C689F1117D651C359E4C7460F44AF4CA4D54188D17A34DB8F3D1E1A9B03F5F5509AFFC93EEA5B90B835EB1E096C8EA81447313AD2761912137D4F692E8AEC2D52E0E3ACD02E09272F82A1FC8573388BDE57FBE56A424E01BA#EXT-X-PROGRAM-DATE-TIME:2019-11-06T10:12:27+08:00#EXT-QQHLS-MACHINEID:56448#EXT-QQHLS-START-TIME:1573006347#EXT-SID:1572999471#EXT-SC:SZ=479212&amp;CK=c493#EXT-BC:SZ=59392&amp;CK=dec8#EXT-BC:SZ=59392&amp;CK=1ee8#EXT-BC:SZ=59392&amp;CK=b9bf#EXT-BC:SZ=59392&amp;CK=8b9c#EXT-BC:SZ=59392&amp;CK=29fe#EXT-BC:SZ=59392&amp;CK=493#EXT-BC:SZ=59392&amp;CK=ae5f#EXT-BC:SZ=63468&amp;CK=630#EXTINF:5.000,100204101-1572999471.ts?cdncode=/18907E7BE0798990/&amp;HLSP2P=1&amp;buname=qqlive&amp;sdtfrom=10002212&amp;vkey=F1FE87B5E6D84B6FEFBB683D7C2558C08C8CF7B6E752E05C689F1117D651C359E4C7460F44AF4CA4D54188D17A34DB8F3D1E1A9B03F5F5509AFFC93EEA5B90B835EB1E096C8EA81447313AD2761912137D4F692E8AEC2D52E0E3ACD02E09272F82A1FC8573388BDE57FBE56A424E01BA#EXT-X-PROGRAM-DATE-TIME:2019-11-06T10:12:32+08:00#EXT-QQHLS-MACHINEID:56448#EXT-QQHLS-START-TIME:1573006352#EXT-SID:1572999472#EXT-SC:SZ=266396&amp;CK=648#EXT-BC:SZ=32768&amp;CK=a085#EXT-BC:SZ=32768&amp;CK=8233#EXT-BC:SZ=32768&amp;CK=1831#EXT-BC:SZ=32768&amp;CK=4042#EXT-BC:SZ=32768&amp;CK=f0eb#EXT-BC:SZ=32768&amp;CK=cd3a#EXT-BC:SZ=32768&amp;CK=e245#EXT-BC:SZ=37020&amp;CK=f6e3#EXTINF:5.000,100204101-1572999472.ts?cdncode=/18907E7BE0798990/&amp;HLSP2P=1&amp;buname=qqlive&amp;sdtfrom=10002212&amp;vkey=F1FE87B5E6D84B6FEFBB683D7C2558C08C8CF7B6E752E05C689F1117D651C359E4C7460F44AF4CA4D54188D17A34DB8F3D1E1A9B03F5F5509AFFC93EEA5B90B835EB1E096C8EA81447313AD2761912137D4F692E8AEC2D52E0E3ACD02E09272F82A1FC8573388BDE57FBE56A424E01BA复制代码</code></pre><p>其他的一些常用标签：</p><ul><li>EXT-X-DISCONTINUITY 该标签表明其前一个切片与下一个切片之间存在中断。 EXT-X-DISCONTINUITY 的一个经典使用场景就是在视屏流中插入广告，由于视屏流与广告视屏流不是同一份资源，因此在这两种流切换时使用 EXT-X-DISCONTINUITY 进行指明，客户端看到该标签后，就会处理这种切换中断问题，让体验更佳。</li><li>EXT-X-KEY 媒体片段可以进行加密，而该标签可以指定解密方法。</li><li>EXT-X-PLAYLIST-TYPE ：表明流媒体类型。全局生效。该标签为可选标签。 可选值如下：VOD EVENT</li></ul><p>注：VOD 文件通常带有 EXT-X-ENDLIST 标签，因为其为点播源，不会改变；而 EVEVT 文件初始化时一般不会有 EXT-X-ENDLIST 标签，暗示有新的文件会添加到播放列表末尾，因此也需要客户端定时获取该 m3u8 文件，以获取新的媒体片段资源，直到访问到 EXT-X-ENDLIST 标签才停止。</p><ul><li>EXT-X-PROGRAM-DATE-TIME 该标签使用一个绝对日期/时间表明第一个样本片段的取样时间。</li><li>EXT-X-MEDIA-SEQUENCE ：表示播放列表第一个 URL 片段文件的序列号，每个媒体片段 URL 都拥有一个唯一的整型序列号。 每个媒体片段序列号按出现顺序依次加 1。媒体片段序列号与片段文件名无关。如果该标签未指定，则默认序列号从 0 开始。</li><li>EXT-X-ENDLIST 若出现 EXT-X-ENDLIST 标签，则表明M3U8文件不会再产生更多的切片，可以理解为该M3U8已停止更新，并且播放分片到这个标签后结束。M3U8不仅仅是可以作为直播，也可以作为点播存在，在M3U8文件中保存所有切片信息最后使用 EXT-X-ENDLIST 结尾，这个M3U8即为点播M3U8。 EXT-X-ENDLIST 标签可能会出现在播放列表文件的任何地方，但是不能出现两次或以上。</li><li>EXT-X-STREAM-INF EXT-X-STREAM-INF 标签出现在M3U8时，主要是出现在多级M3U8文件中时，例如M3U8中包含子M3U8列表，或者主M3U8中包含多码率M3U8时；该标签后需要跟一些属性，下面就来逐一说明一下这些属性：BANDWIDTH ： BANDWIDTH 的值为最高码率值，当播 放EXT-X-STREAM-INF 下对应的M3U8时占用的最大码率（必要参数）。AVERAGE-BANDWIDTH ： AVERAGE-BANDWIDTH 的值为平均码率值，当播放 EXT-X-STREAM-INF 下对应的M3U8时占用的平均码率（可选参数）。CODECS ：CODECS的值用于声明 EXT-X-STREAM-INF 下面对应M3U8里面的音视频编码、视频编码的信息（可选参数）。RESOLUTION ：M3U8中视频的宽高信息描述（可选参数）。FRAME-RATE ：子M3U8中的视频帧率（可选参数）。</li></ul><h3 class=pgc-h-arrow-right>客户端播放M3U8的一些标准：</h3><pre><code>EXT-X-ENDLISTX-DISCONTINUTY</code></pre><h3 class=pgc-h-arrow-right>注意事项</h3><ul><li>有两种请求 m3u8 播放列表的方法：一是通过 m3u8 的 URI 进行请求，则该文件必须以 .m3u8 或 .m3u 结尾；二是通过 HTTP 进行请求，则请求头 Content-Type 必须设置为 application/vnd.apple.mpegurl 或者 audio/mpegurl 。</li><li>空行和注释行在解析时都忽略。</li><li>媒体播放列表（Media Playlist）的流资源总时长就是各切片资源的时长之和。</li></ul><h2 class=pgc-h-arrow-right>TS文件</h2><p>TS（Transport Stream）是一种音视频封装格式，全称MPEG2-TS。MPEG-TS主要应用于实时传送的节目，比如实时广播的电视节目。</p><p>TS文件（流）可以分为三层：TS层（Transport Stream）、PES层（Packet Elemental Stream）、ES层（Elementary Stream）。</p><p>ES层就是音视频数据，PES层是在音视频数据上加了时间戳等对数据帧的说明信息，TS层是在PES层上加入了数据流识别和传输的必要信息。TS文件（码流）由多个TS Packet组成的。</p><p>TS文件（码流）的分层结构图</p><div class=pgc-img><img alt="M3U8 视频文件" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5d36fe47b294442f92f50e2816b9518f><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>TS流生成流程</h3><ol start=1><li>将原始音视频数据压缩之后，压缩结果组成一个基本码流（ES）。</li><li>对ES（基本码流）进行打包形成PES。</li><li>在PES包中加入时间戳信息(PTS/DTS)。</li><li>将PES包内容分配到一系列固定长度的传输包（TS Packet）中。</li><li>在传输包中加入定时信息(PCR)。</li><li>在传输包中加入节目专用信息(PSI) 。</li><li>连续输出传输包形成具有恒定比特率的MPEG-TS流。</li></ol><h3 class=pgc-h-arrow-right>TS流解析流程</h3><ol start=1><li>复用的MPEG-TS流中解析出TS包；</li><li>从TS包中获取PAT及对应的PMT；</li><li>从而获取特定节目的音视频PID；</li><li>通过PID筛选出特定音视频相关的TS包，并解析出PES；</li><li>从PES中读取到PTS/DTS，并从PES中解析出基本码流ES；</li><li>将ES交给解码器，获得压缩前的原始音视频数据。</li></ol></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'M3U8','视频','文件'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>