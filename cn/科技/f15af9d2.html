<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>MyBatis整体架构分析：基础支持层、核心处理层和接口层 | 极客快訊</title><meta property="og:title" content="MyBatis整体架构分析：基础支持层、核心处理层和接口层 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/8d6a0b300b114d07b2f3fe66d7ef7005"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f15af9d2.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f15af9d2.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f15af9d2.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f15af9d2.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f15af9d2.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f15af9d2.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f15af9d2.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f15af9d2.html><meta property="article:published_time" content="2020-11-14T21:06:33+08:00"><meta property="article:modified_time" content="2020-11-14T21:06:33+08:00"><meta name=Keywords content><meta name=description content="MyBatis整体架构分析：基础支持层、核心处理层和接口层"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/f15af9d2.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>MyBatis整体架构分析：基础支持层、核心处理层和接口层</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><blockquote><p><strong>推荐阅读：<a class=pgc-link data-content=mp href="https://www.toutiao.com/i6750559979859608075/?group_id=6750559979859608075" target=_blank>阿里、京东等大厂面试官必问！MySQL的八大核心知识点你都吃透了吗</a></strong><br></p></blockquote><p>MyBatis 的整体架构分为三层， 分别是<strong>基础支持层</strong>、<strong>核心处理层</strong>和<strong>接口层</strong>，如下图所示。</p><div class=pgc-img><img alt=MyBatis整体架构分析：基础支持层、核心处理层和接口层 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8d6a0b300b114d07b2f3fe66d7ef7005><p class=pgc-img-caption></p></div><h1>基础支持层</h1><p><strong>反射模块</strong></p><p>该模块对 Java 原生的反射进行了良好的封装，提供了更加简洁易用的 API ，方便上层使调用，并且对反射操作进行了一系列优化，例如缓存了类的元数据，提高了反射操作的性能。</p><p><strong>类型转换模块</strong></p><p>类型转换模块提供了两个主要功能，一个功能是别名机制，MyBatis 为了简化配置文件提供了别名机制；另一个功能是实现 JDBC 类型与 Java 类型之间的转换，该功能在为 SQL 语句绑定实参以及映射查询结果集时都会涉及。</p><p><strong>日志模块</strong></p><p>提供详细的日志输出信息，并且能够集成多种日志框架，其日志模块的一个主要功能就是集成第三方日志框架。</p><p><strong>资源加载模块</strong></p><p>资源加载模块主要是对类加载器进行封装，确定类加载器的使用顺序，并提供了加载类文件以及其他资源文件的功能。</p><p><strong>解析器模块</strong></p><p>解析器模块主要提供两个功能，一个功能是对 XPath 进行封装，为 MyBatis 初始化时解析 mybatis-config.xml 配置文件以及映射配置文件提供支持；另一个功能是为处理动态 SQL 语句中的占位符提供支持。</p><p><strong>数据源模块</strong></p><p>MyBatis 自身提供了相应的数据源实现，也提供了与第三方数据源集成的接口。</p><p><strong>事务管理</strong></p><p>MyBatis 对数据库中的事务进行了抽象,其自身提供了相应的事务接口和简单实现。一般在应用中，MyBatis 会与 Spring 框架集成，并由 Spring 框架管理事务。</p><p><strong>缓存模块</strong></p><p>MyBatis 中提供了一级缓存和二级缓存，而这两级缓存都是依赖于基础支持层中的缓存模块实现的。MyBatis 中自带的这两级缓存与 MyBatis 以及整个应用是运行在同一个 JVM 中的，共享同一块堆内存。如果这两级缓存中的数据量较大， 则可能影响系统中其他功能的运行，所以当需要缓存大量数据时，优先考虑使用 Redis 、Memcache 等缓存产品。</p><p><strong>Binding 模块</strong></p><p>在调用 SqlSession 相应方法执行数据库操作时，需要指定映射文件中定义的 SQL 节点，如果出现拼写错误，我们只能在运行时才能发现相应的异常。为了尽早发现这种错误，MyBatis 通过 Binding 模块将用户自定义的 Mapper 接口与映射配置文件关联起来，系统可以通过调用自定义 Mapper 接口中的方法执行相应的SQL 语句完成数据库操作，从而避免上述问题。</p><p>需要注意的是，开发人员无须编写自定义 Mapper 接口的实现，MyBatis 会自动为其创建动态代理对象。</p><h1>核心处理层</h1><p>在核心处理层中实现了 MyBatis 的核心处理流程，其中包括 MyBatis 的初始化以及完成一次数据库操作涉及的全部流程。</p><p><strong>配置解析</strong></p><p>在 MyBatis 初始化过程中，会加载 mybatis-config.xml 配置文件、映射配置文件以及 Mapper 接口中的注解信息，解析后的配置信息会形成相应的对象并保存到 Configuration 对象中。之后，利用该 Configuration 对象创建 SqlSessionFactory 对象。待 MyBatis 初始化之后，开发人员可以通过初始化得到 SqlSessionFactory 创建 SqlSession 对象并完成数据库操作。</p><p><strong>SOL 解析与 scripting 模块</strong></p><p>拼凑 SQL 语句是一件烦琐且易出错的过程，为了将开发人员从这项枯燥无趣的工作中解脱出来，MyBatis 实现动态 SQL 语句的功能，提供了多种动态 SQL 语句对应的节点，例如，&lt;where> 节点、&lt;if> 节点、&lt;foreach> 节点等。通过这些节点的组合使用，开发人员可以写出几乎满足所有需求的动态 SQL 语句。</p><p>MyBatis 中的 scripting 模块会根据用户传入的实参，解析映射文件中定义的动态 SQL 节点，并形成数据库可执行的 SQL 语句。之后会处理 SQL 语句中的占位符，绑定用户传入的实参。</p><p><strong>SQL 执行</strong></p><p>SQL 语句的执行涉及多个组件，其中比较重要的是 Executor 、StatementHandler 、ParameterHandler 和 ResultSetHandler。Executor 主要负责维护一级缓存和二级缓存，并提供事务管理的相关操作，它会将数据库相关操作委托给 StatementHandler 完成。StatementHandler 首先通过 ParameterHandler 完成 SQL 语句的实参绑定；然后通过 java.sql.Statement 对象执行 SQL 语句并得到结果集；最后通过 ResultSetHandler 完成结果集的映射，得到结果对象并返回。</p><p><strong>插件</strong></p><p>用户可以通过添加自定义插件的方式对 MyBatis 进行扩展。用户自定义插件也可以改变 MyBatis 的默认行为，例如，我们可以拦截 SQL 语句并对其进行重写。由于用户自定义插件会影响 MyBatis 的核心行为，在使用自定义插件之前，开发人员需要了解 MyBatis 内部的原理，这样才能编写出安全、高效的插件。</p><p>下图展示了 MyBatis 执行一条 SQL 语句的大致过程。</p><div class=pgc-img><img alt=MyBatis整体架构分析：基础支持层、核心处理层和接口层 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/5ece91cfaaeb4794803105687a3b4958><p class=pgc-img-caption></p></div><h1>接口层</h1><p>接口层相对简单，其核心是 SqlSession 接口，该接口中定义了 MyBatis 暴露给应用程序调用的 API，也就是上层应用与 MyBatis 交互的桥梁。接口层在接收到调用请求时，会调用核心处理层的相应模块来完成具体的数据库操作。</p><p>可以通过 MyBatis 源码的目录结构查看各个模块的具体实现，目录结构如下图所示。</p><div class=pgc-img><img alt=MyBatis整体架构分析：基础支持层、核心处理层和接口层 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/635ab39a293647dd9e90152f93b52084><p class=pgc-img-caption></p></div><p>封装的很清晰，基本是一个模块一个 package。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'MyBatis','整体','架构'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>