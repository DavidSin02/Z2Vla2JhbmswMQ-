<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>éƒ½è¯´é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå·å·å‘Šè¯‰ä½ é¢å‘å¯¹è±¡ç¼–ç¨‹çš„6å¤§è®¾è®¡åŸåˆ™ | æå®¢å¿«è¨Š</title><meta property="og:title" content="éƒ½è¯´é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå·å·å‘Šè¯‰ä½ é¢å‘å¯¹è±¡ç¼–ç¨‹çš„6å¤§è®¾è®¡åŸåˆ™ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/1532998144998addd88387a"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f1896377.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f1896377.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f1896377.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f1896377.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f1896377.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f1896377.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f1896377.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f1896377.html><meta property="article:published_time" content="2020-10-29T21:10:38+08:00"><meta property="article:modified_time" content="2020-10-29T21:10:38+08:00"><meta name=Keywords content><meta name=description content="éƒ½è¯´é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå·å·å‘Šè¯‰ä½ é¢å‘å¯¹è±¡ç¼–ç¨‹çš„6å¤§è®¾è®¡åŸåˆ™"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/f1896377.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>éƒ½è¯´é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå·å·å‘Šè¯‰ä½ é¢å‘å¯¹è±¡ç¼–ç¨‹çš„6å¤§è®¾è®¡åŸåˆ™</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><div class=pgc-img><img alt=éƒ½è¯´é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå·å·å‘Šè¯‰ä½ é¢å‘å¯¹è±¡ç¼–ç¨‹çš„6å¤§è®¾è®¡åŸåˆ™ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1532998144998addd88387a><p class=pgc-img-caption></p></div><blockquote><p>æœ€è¿‘åœ¨é˜…è¯»ã€ŠAndroidæºç è®¾è®¡æ¨¡å¼è§£æä¸å®æˆ˜ã€‹ä¸€ä¹¦ï¼Œæˆ‘è§‰å¾—å†™çš„å¾ˆæ¸…æ™°ï¼Œæ¯ä¸€ä¸ªçŸ¥è¯†ç‚¹éƒ½æœ‰ç¤ºä¾‹ï¼Œé€šè¿‡ç¤ºä¾‹æ›´åŠ å®¹æ˜“ç†è§£ã€‚ä¹¦ä¸­çš„çŸ¥è¯†ç‚¹æœ‰äº›éƒ½æ¥è§¦è¿‡ï¼Œæœ‰çš„æ²¡æœ‰æ¥è§¦è¿‡ï¼Œæ€»ä¹‹ï¼Œé€šè¿‡é˜…è¯»è¿™æœ¬ä¹¦æ¥æ¢³ç†ä¸€ä¸‹çŸ¥è¯†ç‚¹ï¼Œå¯èƒ½æœ‰äº›ä¸œè¥¿åœ¨é¡¹ç›®ä¸­ä¸€ç›´åœ¨ä½¿ç”¨ï¼Œç„¶å¹¶ä¸èƒ½ç¬¼ç»Ÿï¼Œæ¸…ç†çš„è¯´æ˜ç†è§£å®ƒã€‚æœ¬æ–‡ä¸»è¦æ˜¯è®°å½•é˜…è¯»è¿™æœ¬ä¹¦çš„çŸ¥è¯†ç‚¹å’Œè‡ªå·±çš„ä¸€äº›ç†è§£ã€‚ä¸€æ¥æ•´ç†çŸ¥è¯†ç‚¹ï¼ŒäºŒæ¥æ–¹ä¾¿ä»¥åæŸ¥çœ‹ï¼Œå¿«é€Ÿå®šä½ã€‚</p></blockquote><p><strong>å•ä¸€èŒè´£åŸåˆ™ ï¼šä¼˜åŒ–ä»£ç ç¬¬ä¸€æ­¥</strong></p><p>å•ä¸€èŒè´£åŸåˆ™ï¼ˆè‹±æ–‡ç®€ç§°ï¼šSRPï¼‰ï¼šå¯¹äºä¸€ä¸ªç±»è€Œè¨€ï¼Œåº”è¯¥ä»…æœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚è¿™ä¸ªæœ‰ç‚¹æŠ½è±¡ï¼Œå› ä¸ºè¯¥åŸåˆ™çš„åˆ’åˆ†ç•Œé¢å¹¶ä¸æ˜¯é‚£ä¹ˆæ¸…æ™°ï¼Œå¾ˆå¤šæ—¶å€™é ä¸ªäººç»éªŒæ¥åŒºåˆ†ã€‚ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½ï¼Œæ¯”å¦‚åŠ å‡ä¹˜é™¤åº”åˆ†åˆ«å¯¹åº”ä¸€ä¸ªç±»ï¼Œè€Œä¸æ˜¯æŠŠå››ä¸ªåŠŸèƒ½æ”¾åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œè¿™æ ·åœ¨åªè¦æœ‰ä¸€ä¸ªåŠŸèƒ½å˜åŒ–éƒ½éœ€è¦æ›´æ”¹è¿™ä¸ªç±»ã€‚</p><p>ä¸‹é¢ä»¥å®ç°ä¸€ä¸ªå›¾ç‰‡åŠ è½½å™¨ï¼ˆImageLoaderï¼‰æ¥è¯´æ˜:</p><p>public class ImageLoader {</p><p>//å›¾ç‰‡å†…å­˜ç¼“å­˜</p><p>private LruCache&lt;String,Bitmap> mImageCache;</p><p>//çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ•°é‡ä¸ºCPUçš„æ•°é‡</p><p>private ExecutorService mExecutorService = Executors.newFixedThreadPool(</p><p>Runtime.getRuntime().availableProcessors()</p><p>);</p><p>public ImageLoader(){</p><p>initImageLoader();</p><p>}</p><p>//åˆå§‹åŒ–</p><p>private void initImageLoader() {</p><p>//è®¡ç®—æœ€å¤§çš„å¯ä½¿ç”¨å†…å­˜</p><p>final int maxMemory = (int) (Runtime.getRuntime().maxMemory() / 1024);</p><p>//å–å››åˆ†ä¹‹ä¸€ä½œä¸ºæœ€å¤§ç¼“å­˜å†…å­˜</p><p>final int cacheSize = maxMemory / 4;</p><p>mImageCache = new LruCache&lt;String,Bitmap>(cacheSize){</p><p>@Override</p><p>protected int sizeOf(String key, Bitmap bitmap) {</p><p>return bitmap.getRowBytes() * bitmap.getHeight() / 1024;</p><p>}</p><p>};</p><p>}</p><p>public void displayImage(final String url, final ImageView imageView){</p><p>Bitmap bitmap = mImageCache.get(url);</p><p>if(bitmap != null){</p><p>imageView.setImageBitmap(bitmap);</p><p>return;</p><p>}</p><p>imageView.setTag(url);</p><p>mExecutorService.submit(new Runnable() {</p><p>@Override</p><p>public void run() {</p><p>Bitmap bitmap = downloadImage(url);</p><p>if(bitmap == null){</p><p>return;</p><p>}</p><p>if (imageView.getTag().equals(url)) {</p><p>imageView.setImageBitmap(bitmap);</p><p>}</p><p>mImageCache.put(url,bitmap);</p><p>}</p><p>});</p><p>}</p><p>}</p><blockquote><p>æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šè¿™æ ·è¿™æ ·ç®€å•çš„å®ç°ä¸€ä¸ªå›¾ç‰‡åŠ è½½å·¥å…·ç±»ï¼Œè¿™æ ·å†™åŠŸèƒ½è™½ç„¶å®ç°äº†ï¼Œä½†æ˜¯ä»£ç æ˜¯æœ‰é—®é¢˜çš„ï¼Œä»£ç è€¦åˆä¸¥é‡ï¼Œéšç€ImageLoaderåŠŸèƒ½è¶Šæ¥è¶Šå¤šï¼Œè¿™ä¸ªç±»ä¼šè¶Šæ¥è¶Šå¤§ï¼Œä»£ç è¶Šæ¥è¶Šå¤æ‚ã€‚æŒ‰ç…§å•ä¸€èŒè´£åŸåˆ™ï¼Œæˆ‘ä»¬åº”è¯¥æŠŠImageLoaderæ‹†åˆ†ä¸€ä¸‹ï¼ŒæŠŠå„ä¸ªåŠŸèƒ½ç‹¬ç«‹å‡ºæ¥ã€‚</p></blockquote><div class=pgc-img><img alt=éƒ½è¯´é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå·å·å‘Šè¯‰ä½ é¢å‘å¯¹è±¡ç¼–ç¨‹çš„6å¤§è®¾è®¡åŸåˆ™ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/153299821411690bb324a51><p class=pgc-img-caption></p></div><p>ImageLoaderä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š</p><p>public class ImageLoader {</p><p>//å›¾ç‰‡ç¼“å­˜</p><p>ImageCache mImageCache = new ImageCache();</p><p>//çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ•°é‡ä¸ºCPUçš„æ•°é‡</p><p>private ExecutorService mExecutorService = Executors.newFixedThreadPool(</p><p>Runtime.getRuntime().availableProcessors()</p><p>);</p><p>public void displayImage(final String url, final ImageView imageView){</p><p>.............</p><p>}</p><p>}</p><p>public class ImageCache {</p><p>//å›¾ç‰‡å†…å­˜ç¼“å­˜</p><p>private LruCache&lt;String,Bitmap> mImageCache;</p><p>public ImageCache(){</p><p>initImageCache();</p><p>}</p><p>//åˆå§‹åŒ–</p><p>private void initImageCache() {</p><p>//è®¡ç®—æœ€å¤§çš„å¯ä½¿ç”¨å†…å­˜</p><p>final int maxMemory = (int) (Runtime.getRuntime().maxMemory() / 1024);</p><p>//å–å››åˆ†ä¹‹ä¸€ä½œä¸ºæœ€å¤§ç¼“å­˜å†…å­˜</p><p>final int cacheSize = maxMemory / 4;</p><p>mImageCache = new LruCache&lt;String,Bitmap>(cacheSize){</p><p>@Override</p><p>protected int sizeOf(String key, Bitmap bitmap) {</p><p>return bitmap.getRowBytes() * bitmap.getHeight() / 1024;</p><p>}</p><p>};</p><p>}</p><p>public Bitmap get(String url){</p><p>return mImageCache.get(url);</p><p>}</p><p>public void put(String url,Bitmap bitmap){</p><p>mImageCache.put(url,bitmap);</p><p>}</p><p>}</p><blockquote><p>ä¸Šè¿°ä»£ç å°†ImageLoaderä¸€åˆ†ä¸ºäºŒï¼ŒImageLoaderåªè´Ÿè´£å›¾ç‰‡åŠ è½½çš„é€»è¾‘ï¼ŒImageCacheè´Ÿè´£ç¼“å­˜ç­–ç•¥ï¼Œè¿™æ ·ï¼ŒImageLoaderçš„ä»£ç å˜å°‘äº†ï¼ŒèŒè´£ä¹Ÿæ¸…æ™°äº†ï¼Œå¹¶ä¸”å¦‚æœç¼“å­˜ç­–ç•¥æ”¹å˜äº†çš„è¯ï¼Œåªéœ€è¦ä¿®æ”¹ImageCacheè€Œä¸éœ€è¦åœ¨ä¿®æ”¹ImageLoaderäº†ã€‚ä»è¿™ä¸ªä¾‹å­å¯ä»¥æ›´åŠ æ¸…æ™°çš„ç†è§£ä»€ä¹ˆæ˜¯å•ä¸€èŒè´£åŸåˆ™ï¼Œå¦‚ä½•å»åˆ’åˆ†ä¸€ä¸ªç±»çš„èŒè´£ï¼Œæ¯ä¸ªäººçš„çœ‹æ³•ä¸åŒï¼Œè¿™éœ€è¦æ ¹æ®ä¸ªäººçš„ç»éªŒï¼Œä¸šåŠ¡é€»è¾‘è€Œå®šã€‚</p></blockquote><p><strong>å¼€é—­åŸåˆ™ï¼šè®©ç¨‹åºæ›´ç¨³å®šï¼Œæ›´çµæ´»</strong></p><p>å¼€é—­åŸåˆ™ï¼ˆè‹±æ–‡ç¼©å†™ä¸ºOCPï¼‰: è½¯ä»¶ä¸­çš„å¯¹è±¡ï¼ˆç±»ï¼Œå‡½æ•°ï¼Œæ¨¡å—ç­‰ï¼‰å¯¹äºæ‰©å±•æ˜¯å¼€æ”¾çš„ï¼Œä½†æ˜¯å¯¹äºä¿®æ”¹æ˜¯å°é—­çš„ã€‚åœ¨è½¯ä»¶çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œå› ä¸ºå˜åŒ–ï¼Œå‡çº§å’Œç»´æŠ¤çš„åŸå› éœ€è¦å¯¹åŸä»£ç ä¿®æ”¹æ—¶ï¼Œå¯èƒ½ä¼šå°†é”™è¯¯å¼•å…¥å·²ç»ç»è¿‡æµ‹è¯•çš„æ—§ä»£ç ï¼Œç ´ååŸæœ‰çš„ç³»ç»Ÿã€‚å› ä¸ºå½“éœ€æ±‚å˜åŒ–æ—¶ï¼Œæˆ‘ä»¬åº”å°½å¯èƒ½çš„é€šè¿‡æ‰©å±•æ¥å®ç°ï¼Œè€Œä¸æ˜¯ä¿®æ”¹åŸæ¥çš„</p><p>ä»£ç ã€‚</p><p>åœ¨å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåªé€šè¿‡ç»§æ‰¿çš„æ–¹å¼æ¥å‡çº§ï¼Œç»´æŠ¤åŸæœ‰çš„ç³»ç»Ÿåªæ˜¯ä¸€ä¸ªç†æƒ³åŒ–çš„çŠ¶æ€ï¼Œä¿®æ”¹åŸä»£ç ï¼Œæ‰©å±•ä»£ç å¾€å¾€æ˜¯åŒæ—¶å­˜åœ¨çš„ã€‚æˆ‘ä»¬åº”å°½å¯èƒ½çš„å½±å“åŸä»£ç ã€‚é¿å…å¼•å…¥çš„é”™è¯¯é€ æˆç³»ç»Ÿçš„ç ´åã€‚</p><p>è¿˜æ˜¯ä¸Šé¢çš„é‚£ä¸ªä¾‹å­ï¼Œè™½ç„¶é€šè¿‡å†…å­˜ç¼“å­˜è§£å†³äº†æ¯æ¬¡éƒ½ä»ç½‘ç»œä¸‹è½½å›¾ç‰‡çš„é—®é¢˜ï¼Œä½†æ˜¯Androidå†…å­˜æœ‰é™ï¼Œå¹¶ä¸”å½“åº”ç”¨é‡å¯åå†…å­˜ç¼“å­˜ä¼šä¸¢å¤±ã€‚æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œå¢åŠ SDå¡ç¼“å­˜ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><p>public class ImageLoader {</p><p>//å†…å­˜ç¼“å­˜</p><p>ImageCache mImageCache = new ImageCache();</p><p>//SDå¡ç¼“å­˜</p><p>DiskCache mDiskCache = new DiskCache();</p><p>//çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ•°é‡ä¸ºCPUçš„æ•°é‡</p><p>private ExecutorService mExecutorService = Executors.newFixedThreadPool(</p><p>Runtime.getRuntime().availableProcessors()</p><p>);</p><p>public void displayImage(final String url, final ImageView imageView){</p><p>//å…ˆä»å†…å­˜ç¼“å­˜ä¸­è¯»å–ï¼Œå¦‚æœæ²¡æœ‰å†ä»SDå¡ä¸­è¯»å–</p><p>Bitmap bitmap = mImageCache.get(url);</p><p>if(bitmap == null){</p><p>bitmap = mDiskCache.get(url);</p><p>}</p><p>if(bitmap != null){</p><p>imageView.setImageBitmap(bitmap);</p><p>return;</p><p>}</p><p>//ä»ç½‘ç»œä¸‹è½½å›¾ç‰‡</p><p>..........</p><p>}</p><p>}</p><p>public class DiskCache {</p><p>private final static String cacheDir = "sdcard/cache/";</p><p>/* ä»ç¼“å­˜ä¸­è·å–å›¾ç‰‡ */</p><p>public Bitmap get(String url){</p><p>return BitmapFactory.decodeFile(cacheDir + url);</p><p>}</p><p>/* å°†å›¾ç‰‡æ·»åŠ åˆ°ç¼“å­˜ä¸­ */</p><p>public void put(String url,Bitmap bitmap){</p><p>FileOutputStream fileOutputStream = null;</p><p>try {</p><p>fileOutputStream = new FileOutputStream(cacheDir + url);</p><p>bitmap.compress(Bitmap.CompressFormat.PNG,100,fileOutputStream);</p><p>} catch (FileNotFoundException e) {</p><p>e.printStackTrace();</p><p>}finally {</p><p>if(fileOutputStream != null){</p><p>try {</p><p>fileOutputStream.close();</p><p>} catch (IOException e) {</p><p>e.printStackTrace();</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><blockquote><p>ä¸Šè¿°ä»£ç æˆ‘ä»¬å¢åŠ äº†SDå¡ç¼“å­˜ï¼Œæˆ‘ä»¬åœ¨æ˜¾ç¤ºå›¾ç‰‡çš„æ—¶å€™å…ˆåˆ¤æ–­å†…å­˜ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨å¦‚æœä¸å­˜åœ¨å°±åœ¨SDå¡ä¸­æ‰¾ï¼Œå¦åˆ™å†ä»ç½‘ç»œä¸‹è½½ï¼Œè¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ¯å¢åŠ ä¸€ä¸ªæ–°çš„ç¼“å­˜æ–¹æ³•ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ä¿®æ”¹åŸæ¥çš„ä»£ç ï¼Œè¿™æ ·å¯èƒ½å¼•å…¥Bug,è€Œä¸”ä¼šä½¿åŸæ¥çš„ä»£ç è¶Šæ¥è¶Šå¤æ‚ï¼Œè¿˜æœ‰ç”¨æˆ·ä¹Ÿä¸èƒ½è‡ªå®šä¹‰ç¼“å­˜æ–¹æ³•ã€‚æˆ‘ä»¬å…·ä½“ä½¿ç”¨å“ªä¸€ç§ç¼“å­˜æ–¹æ³•æ˜¯é€šè¿‡ifæ¡ä»¶åˆ¤æ–­çš„,æ¡ä»¶å¤ªå¤šï¼Œæ˜¯å¾ˆå®¹æ˜“å†™é”™çš„ã€‚è€Œä¸”ä»£ç ä¼šè¶Šæ¥è¶Šè‡ƒè‚¿ï¼Œå¹¶ä¸”å¯æ‰©å±•æ€§å·®ã€‚å¯æ‰©å±•æ€§æ˜¯æ¡†æ¶çš„é‡è¦ç‰¹æ€§ä¹‹ä¸€ã€‚</p></blockquote><p>æ ¹æ®å¼€é—­åŸåˆ™ï¼Œå½“è½¯ä»¶éœ€æ±‚æ”¹å˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥é€šè¿‡æ‰©å±•çš„æ–¹å¼å®ç°ï¼Œè€Œä¸æ˜¯ä¿®æ”¹è‡ªå·±çš„ä»£ç ã€‚å¯¹ä¸Šè¿°ä»£ç è¿›è¡Œä¼˜åŒ–ï¼š</p><div class=pgc-img><img alt=éƒ½è¯´é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå·å·å‘Šè¯‰ä½ é¢å‘å¯¹è±¡ç¼–ç¨‹çš„6å¤§è®¾è®¡åŸåˆ™ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1532998275479ab885a1e4f><p class=pgc-img-caption></p></div><p>public class ImageLoader {</p><p>//é»˜è®¤ç¼“å­˜æ–¹å¼ä¸ºå†…å­˜ç¼“å­˜</p><p>ImageCache mImageCache = new MemoryCache();</p><p>//çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ•°é‡ä¸ºCPUçš„æ•°é‡</p><p>private ExecutorService mExecutorService = Executors.newFixedThreadPool(</p><p>Runtime.getRuntime().availableProcessors()</p><p>);</p><p>//è®¾ç½®ç¼“å­˜æ–¹å¼</p><p>public void setImageCache(ImageCache cache){</p><p>mImageCache = cache;</p><p>}</p><p>public void displayImage(final String url, final ImageView imageView){</p><p>//å…ˆä»ç¼“å­˜ä¸­è¯»å–</p><p>Bitmap bitmap = mImageCache.get(url);</p><p>if(bitmap != null){</p><p>imageView.setImageBitmap(bitmap);</p><p>return;</p><p>}</p><p>//ç½‘ç»œä¸‹è½½å›¾ç‰‡</p><p>............</p><p>}</p><p>}</p><p>public interface ImageCache {</p><p>Bitmap get(String url);</p><p>void put(String url, Bitmap bitmap);</p><p>}</p><blockquote><p>é€šè¿‡ä¸Šè¿°ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒImageLoaderå¢åŠ äº†ä¸€ä¸ªæ–¹æ³•setImageCacheï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥æ–¹æ³•è®¾ç½®ç¼“å­˜æ–¹å¼ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ä¾èµ–æ³¨å…¥ã€‚å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„ç¼“å­˜æ–¹å¼ï¼Œåªéœ€è¦å®ç°ImageCacheè¿™ä¸ªæ¥å£å³å¯ã€‚ç„¶åå†è°ƒç”¨setImageCacheè¿™ä¸ªæ–¹æ³•æ¥è®¾ç½®ã€‚è€Œä¸éœ€è¦ä¿®æ”¹ImageLoaderçš„ä»£ç ã€‚è¿™æ ·å½“ç¼“å­˜éœ€æ±‚æ”¹å˜çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰©å±•çš„æ–¹å¼æ¥å®ç°è€Œä¸æ˜¯ä¿®æ”¹çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯æ‰€è¯´çš„å¼€é—­åŸåˆ™ã€‚åŒæ—¶æ˜¯ImageLoaderçš„ä»£ç æ›´ç®€æ´ï¼Œæ‰©å±•æ€§å’Œçµæ´»æ€§ä¹Ÿæ›´é«˜ã€‚</p></blockquote><p><strong>é‡Œæ°æ›¿æ¢åŸåˆ™ï¼šæ„å»ºæ‰©å±•æ€§æ›´å¥½çš„ç³»ç»Ÿ</strong></p><p>é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆè‹±æ–‡ç¼©å†™ä¸ºLSPï¼‰ï¼šæ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹éƒ½å¿…é¡»èƒ½å¤Ÿé€æ˜çš„ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ã€‚æˆ‘ä»¬çŸ¥é“é¢å‘å¯¹è±¡æœ‰ä¸‰å¤§ç‰¹æ€§ï¼šå°è£…ï¼Œç»§æ‰¿å’Œå¤šæ€ï¼Œé‡Œæ°æ›¿æ¢åŸåˆ™å°±æ˜¯ä¾èµ–ç»§æ‰¿å’Œå¤šæ€è¿™ä¸¤å¤§åŸåˆ™ï¼Œé‡Œæ°æ›¿æ¢åŸåˆ™ç®€å•æ¥è¯´å°±æ˜¯ï¼šåªè¦æ˜¯çˆ¶ç±»å¼•ç”¨å‡ºç°çš„åœ°æ–¹éƒ½å¯ä»¥æ›¿æ¢æˆå…¶å­ç±»çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¸ä¼šäº§ç”Ÿä»»ä½•çš„é”™è¯¯å’Œå¼‚å¸¸ã€‚</p><p>ä¸‹é¢ä»¥Androidä¸­çš„Windowå’ŒViewçš„å…³ç³»çš„ä¾‹å­æ¥ç†è§£é‡Œæ°æ›¿æ¢åŸåˆ™ï¼š</p><div class=pgc-img><img alt=éƒ½è¯´é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå·å·å‘Šè¯‰ä½ é¢å‘å¯¹è±¡ç¼–ç¨‹çš„6å¤§è®¾è®¡åŸåˆ™ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1532998275564d514f8a225><p class=pgc-img-caption></p></div><p>//çª—å£ç±»</p><p>public class Window {</p><p>public void show(View child){</p><p>child.draw();</p><p>}</p><p>}</p><p>å»ºç«‹è§†å›¾æŠ½è±¡ç±»ï¼Œæµ‹é‡è§†å›¾çš„å®½é«˜ä¸ºå…¬å…±ä»£ç ï¼Œç»˜åˆ¶äº¤ç»™å…·ä½“çš„å­ç±»å»å®ç°</p><p>public abstract class View {</p><p>public abstract void draw();</p><p>public void measure(int width,int height){</p><p>//æµ‹é‡è§†å›¾å¤§å°</p><p>...........</p><p>}</p><p>}</p><p>//æ–‡æœ¬ç±»å…·ä½“å®ç°</p><p>public class TextView extends View {</p><p>@Override</p><p>public void draw() {</p><p>//ç»˜åˆ¶æ–‡æœ¬</p><p>...........</p><p>}</p><p>}</p><p>//æŒ‰é’®ç±»å…·ä½“å®ç°</p><p>public class Button extends View {</p><p>@Override</p><p>public void draw() {</p><p>//ç»˜åˆ¶æŒ‰é’®</p><p>.............</p><p>}</p><p>}</p><blockquote><p>ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒWindowä¾èµ–äºViewï¼ŒViewå®šä¹‰äº†ä¸€ä¸ªè§†å›¾æŠ½è±¡ï¼Œmeasureæ˜¯å„ä¸ªå­ç±»å…±äº«çš„æ–¹æ³•ï¼Œå­ç±»é€šè¿‡é‡å†™Viewçš„drawæ–¹æ³•æ¥å®ç°å…·ä½“å„è‡ªç‰¹è‰²çš„å†…å®¹ã€‚ä»»ä½•ç»§æ‰¿Viewçš„å­ç±»éƒ½å¯ä»¥è®¾ç½®ç»™showæ–¹æ³•ï¼Œè¿™å°±æ˜¯æ‰€è¯´çš„é‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œé€šè¿‡é‡Œå¼æ›¿æ¢ï¼Œå°±å¯ä»¥è‡ªå®šä¹‰å„ç§å„æ ·çš„ï¼Œåƒå˜ä¸‡åŒ–çš„Viewï¼Œç„¶åä¼ é€’ç»™Windowï¼ŒWindowè´Ÿè´£ç»„ç»‡Viewï¼Œå¹¶å°†Viewæ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚</p></blockquote><p>ä¸Šé¢ImageLoaderçš„ä¾‹å­ä¹Ÿä½“ç°äº†é‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œå¯ä»¥é€šè¿‡setImageCacheæ–¹æ³•æ¥è®¾ç½®å„ç§å„æ ·çš„ç¼“å­˜æ–¹å¼ï¼Œå¦‚æœ setImageCacheä¸­çš„cacheå¯¹è±¡ä¸èƒ½è¢«å­ç±»æ›¿æ¢ï¼Œé‚£ä¹ˆåˆæ€ä¹ˆèƒ½è®¾ç½®å„ç§å„æ ·çš„ç¼“å­˜æ–¹å¼å‘¢ï¼Ÿ</p><p><strong>ä¾èµ–å€’ç½®åŸåˆ™ï¼šè®©é¡¹ç›®æ‹¥æœ‰å˜åŒ–çš„èƒ½åŠ›</strong></p><p>ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆè‹±æ–‡ç¼©å†™ä¸ºDIP)æŒ‡ä»£äº†ä¸€ç§ç‰¹å®šçš„è§£è€¦æ–¹å¼ï¼Œä½¿å¾—é«˜å±‚æ¬¡çš„æ¨¡å—ä¸ä¾èµ–äºä½å±‚æ¬¡æ¨¡å—çš„å®ç°ç»†èŠ‚çš„ç›®çš„ï¼Œä¾èµ–æ¨¡å—è¢«é¢ å€’äº†ã€‚è¿™ä¸ªæ¦‚å¿µæ›´åŠ çš„æŠ½è±¡ï¼Œè¯¥æ€ä¹ˆç†è§£å‘¢ï¼Ÿ</p><p>ä¾èµ–å€’ç½®åŸåˆ™æœ‰å‡ ä¸ªå…³é”®çš„ç‚¹ï¼š</p><p>* 1.é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–åº•å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ã€‚</p><p>* 2.æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ã€‚</p><p>* 3.ç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚</p><p>åœ¨Javaè¯­è¨€ä¸­ï¼ŒæŠ½è±¡å°±æ˜¯æ¥å£æˆ–è€…æŠ½è±¡ç±»ï¼Œä¸¤è€…éƒ½æ˜¯ä¸èƒ½ç›´æ¥è¢«å®ä¾‹åŒ–çš„ï¼›ç»†èŠ‚å°±æ˜¯å®ç°ç±»ï¼Œå®ç°æ¥å£æˆ–è€…ç»§æ‰¿æŠ½è±¡ç±»è€Œäº§ç”Ÿçš„ç±»å°±æ˜¯ç»†èŠ‚ï¼Œå¯ä»¥ç›´æ¥å®ä¾‹åŒ–ï¼›é«˜å±‚æ¨¡å—å°±æ˜¯è°ƒç”¨ç«¯ï¼›åº•å±‚æ¨¡å—å°±æ˜¯å®ç°ç«¯ã€‚</p><p><strong>ä¾èµ–å€’ç½®åŸåˆ™åœ¨Javaè¯­è¨€ä¸­çš„è¡¨ç°å°±æ˜¯ï¼šæ¨¡å—é—´çš„ä¾èµ–é€šè¿‡æŠ½è±¡å‘ç”Ÿï¼Œå®ç°ç±»ç›´æ¥ä¸èƒ½ç›´æ¥å‘ç”Ÿä¾èµ–ï¼Œå…¶ä¾èµ–å…³ç³»æ˜¯é€šè¿‡æ¥å£æˆ–è€…æŠ½è±¡ç±»äº§ç”Ÿçš„ã€‚</strong></p><p>å¦‚æœç±»ä¸ç±»ä¹‹é—´ç›´æ¥ä¾èµ–äºç»†èŠ‚ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´å°±æœ‰ç›´æ¥çš„è€¦åˆï¼Œå½“éœ€æ±‚å˜åŒ–çš„æ—¶å€™ï¼Œæ„å‘³ç€è¦åŒæ—¶ä¿®æ”¹ä¾èµ–è€…çš„ä»£ç ã€‚è¿™å°±é™åˆ¶äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚</p><p>public class ImageLoader {</p><p>//ç›´æ¥ä¾èµ–äºç»†èŠ‚</p><p>MemoryCache mImageCache = new MemoryCache();</p><p>...................</p><p>}</p><blockquote><p>ImageLoaderç›´æ¥ä¾èµ–äºMemoryCache,MemoryCacheæ˜¯ä¸€ä¸ªå…·ä½“çš„å®ç°ï¼Œè¿™å°±å¯¼è‡´ImageLoaderç›´æ¥ä¾èµ–äºç»†èŠ‚ï¼Œå½“MemoryCacheä¸èƒ½æ»¡è¶³è€Œè¢«å…¶ä»–ç¼“å­˜å®ç°æ›¿æ¢æ—¶ï¼Œå°±å¿…é¡»éœ€è¦ä¿®æ”¹ImageLoaderçš„ä»£ç ã€‚</p></blockquote><p>public interface ImageCache {</p><p>Bitmap get(String url);</p><p>void put(String url, Bitmap bitmap);</p><p>}</p><p>public class ImageLoader {</p><p>//ä¾èµ–äºæŠ½è±¡ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªé»˜è®¤çš„å®ç°</p><p>ImageCache mImageCache = new MemoryCache();</p><p>......................</p><blockquote><p>åœ¨è¿™é‡Œæˆ‘ä»¬å»ºç«‹äº†ImageCacheæŠ½è±¡ï¼Œå¹¶ä¸”è®©ImageLoaderç›´æ¥ä¾èµ–äºæŠ½è±¡è€Œä¸æ˜¯å…·ä½“çš„ç»†èŠ‚ï¼Œå½“éœ€æ±‚å˜åŒ–æ—¶ï¼Œåªéœ€è¦å®ç°ImageCacheæˆ–è€…ç»§æ‰¿å·²æœ‰çš„ç±»æ¥å®Œæˆç›¸åº”çš„ç¼“å­˜åŠŸèƒ½ã€‚ç„¶åå†å°†å…·ä½“çš„å®ç°æ³¨å…¥åˆ°ImageLoaderä¸­ï¼Œä¿è¯äº†ç³»ç»Ÿçš„é«˜æ‰©å±•æ€§ã€‚è¿™å°±æ˜¯ä¾èµ–å€’ç½®åŸåˆ™ã€‚</p></blockquote><p><strong>æ¥å£éš”ç¦»åŸåˆ™ï¼šè®©ç³»ç»Ÿæ‹¥æœ‰æ›´é«˜çš„çµæ´»æ€§</strong></p><p>æ¥å£éš”ç¦»åŸåˆ™ï¼ˆè‹±æ–‡ç¼©å†™ä¸ºLSPï¼‰:å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ã€‚å¦å¤–ä¸€ç§å®šä¹‰æ˜¯ï¼šç±»é—´çš„ä¾èµ–å…³ç³»åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šã€‚æ¥å£éš”ç¦»åŸåˆ™å°†åºå¤§ï¼Œè‡ƒè‚¿çš„æ¥å£æ‹†åˆ†æˆæ›´å°æ›´å…·ä½“çš„æ¥å£ï¼Œè¿™æ ·å®¢æˆ·ç«¯åªéœ€è¦çŸ¥é“å®ƒæ„Ÿå…´è¶£çš„æ–¹æ³•ã€‚æ¥å£éš”ç¦»çš„ç›®çš„æ˜¯è§£å¼€è€¦åˆï¼Œä»è€Œå®¹æ˜“é‡æ„æ›´æ”¹å’Œé‡æ–°éƒ¨ç½²ã€‚</p><p>æ¥å£éš”ç¦»åŸåˆ™è¯´ç™½äº†å°±æ˜¯è®©ä¾èµ–çš„æ¥å£å°½å¯èƒ½çš„å°ï¼Œçœ‹ä¸€ä¸‹ä¸Šä¸ªä¾‹å­å®ç°SDå¡ç¼“å­˜çš„ä»£ç ï¼š</p><p>/* å°†å›¾ç‰‡æ·»åŠ åˆ°ç¼“å­˜ä¸­ */</p><p>public void put(String url,Bitmap bitmap){</p><p>FileOutputStream fileOutputStream = null;</p><p>try {</p><p>fileOutputStream = new FileOutputStream(cacheDir + url);</p><p>bitmap.compress(Bitmap.CompressFormat.PNG,100,fileOutputStream);</p><p>} catch (FileNotFoundException e) {</p><p>e.printStackTrace();</p><p>}finally {</p><p>if(fileOutputStream != null){</p><p>try {</p><p>fileOutputStream.close();</p><p>} catch (IOException e) {</p><p>e.printStackTrace();</p><p>}</p><p>}</p><p>}</p><p>}</p><blockquote><p>æˆ‘ä»¬çœ‹åˆ°è¿™æ®µä»£ç çš„å¯è¯»æ€§éå¸¸çš„å·®ï¼Œå„ç§try...catchéƒ½æ˜¯éå¸¸ç®€å•çš„ä»£ç ï¼Œä½†æ˜¯ä¼šä¸¥é‡å½±å“ä»£ç çš„å¯è¯»æ€§ï¼Œå¹¶ä¸”å¤šå±‚çº§çš„å¤§æ‹¬å·å¾ˆå®¹æ˜“å°†ä»£ç å†™åˆ°é”™è¯¯çš„å±‚çº§ä¸­ã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™æ ·çš„é—®é¢˜å‘¢ï¼ŸJavaä¸­æœ‰ä¸€ä¸ªCloseableæ¥å£ï¼Œè¯¥æ¥å£æ ‡è¯†äº†ä¸€ä¸ªå¯å…³é—­çš„å¯¹è±¡ï¼Œå®ƒåªæœ‰ä¸€ä¸ªcloseæ–¹æ³•ã€‚å®ç°è¯¥æ¥å£çš„ç±»æœ‰å¾ˆå¤šï¼ŒFileOutputStreamä¹Ÿå®ç°äº†è¯¥æ¥å£ï¼Œå½“ç¨‹åºæœ‰æœ‰å¤šä¸ªå¯å…³é—­çš„å¯¹è±¡æ—¶ï¼Œå¦‚æœéƒ½åƒä¸Šè¿°ä»£ç é‚£æ ·åœ¨finallyä¸­å»å…³é—­ï¼Œå°±éå¸¸çš„éº»çƒ¦äº†ã€‚</p></blockquote><p>æˆ‘ä»¬å¯ä»¥æŠ½å–ä¸€ä¸ªå·¥å…·ç±»æ¥ä¸“é—¨å»å…³é—­éœ€è¦å…³é—­çš„å¯¹è±¡ã€‚</p><p>public class CloseUtils {</p><p>/**</p><p>* å…³é—­Closeableå¯¹è±¡</p><p>* @param closeable</p><p>*/</p><p>public static void closeQuietly(Closeable closeable){</p><p>if(null != closeable){</p><p>try {</p><p>closeable.close();</p><p>} catch (IOException e) {</p><p>e.printStackTrace();</p><p>}</p><p>}</p><p>}</p><p>}</p><p>ä½¿ç”¨å·¥å…·ç±»æ›¿æ¢ä¸Šè¿°çš„ä»£ç </p><p>public void put(String url,Bitmap bitmap){</p><p>FileOutputStream fileOutputStream = null;</p><p>try {</p><p>fileOutputStream = new FileOutputStream(cacheDir + url);</p><p>bitmap.compress(Bitmap.CompressFormat.PNG,100,fileOutputStream);</p><p>} catch (FileNotFoundException e) {</p><p>e.printStackTrace();</p><p>}finally {</p><p>CloseUtils.closeQuietly(fileOutputStream);</p><p>}</p><p>}</p><blockquote><p>è¿™æ ·ä»£ç å°±ç®€æ´å¤šäº†ï¼Œå¹¶ä¸”CloseUtilså¯ä»¥ç”¨åˆ°å¤šä¸ªå¯ä»¥å…³é—­å¯¹è±¡çš„åœ°æ–¹ï¼Œä¿è¯äº†ä»£ç çš„é‡ç”¨æ€§ï¼Œå®ƒä¾èµ–äºCloseableæŠ½è±¡è€Œä¸æ˜¯å…·ä½“çš„å®ç°ï¼Œå¹¶ä¸”å»ºç«‹åœ¨æœ€å°çš„ä¾èµ–åŸåˆ™ä¹‹ä¸Šï¼Œä»–åªéœ€è¦çŸ¥é“å¯¹è±¡æ˜¯å¦å¯å…³é—­ï¼Œå…¶ä»–çš„ä¸€æ¦‚ä¸å…³å¿ƒï¼Œè¿™å°±æ˜¯æ¥å£éš”ç¦»ã€‚å¦‚æœç°åœ¨åªéœ€è¦å…³é—­ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå®ƒå´æš´éœ²äº†å…¶ä»–çš„æ¥å£æ–¹æ³•ï¼Œæ¯”å¦‚OutputStreamçš„writeæ–¹æ³•ï¼Œè¿™ä½¿å¾—æ›´å¤šçš„ç»†èŠ‚æš´éœ²åœ¨å®¢æˆ·ç«¯é¢å‰ï¼Œè¿˜å¢åŠ äº†ä½¿ç”¨éš¾åº¦ã€‚è€Œé€šè¿‡Closeableæ¥å£å°†å¯å…³é—­çš„å¯¹è±¡æŠ½è±¡èµ·æ¥ï¼Œè¿™æ ·å®¢æˆ·ç«¯åªéœ€è¦ä¾èµ–Closeableå°±å¯å°†å…¶ä»–çš„ç»†èŠ‚éšè—èµ·æ¥ï¼Œå®¢æˆ·ç«¯åªéœ€è¦çŸ¥é“è¿™ä¸ªå¯¹è±¡å¯å…³é—­å³å¯ã€‚</p></blockquote><p>åœ¨ä¸Šè¿°çš„ImageLoaderä¸­ï¼Œåªéœ€è¦çŸ¥é“è¯¥ç¼“å­˜å¯¹è±¡æœ‰è¯»å–å’Œç¼“å­˜çš„æ¥å£å³å¯ï¼Œå…¶ä»–çš„ä¸€æ¦‚ä¸ç®¡ï¼Œè¿™æ ·ç¼“å­˜çš„å…·ä½“å®ç°æ˜¯å¯¹ImageLoaderéšè—çš„ã€‚è¿™å°±æ˜¯ç”¨æœ€å°åŒ–æ¥å£éš”ç¦»äº†å®ç°ç±»çš„ç»†èŠ‚ã€‚</p><p><strong>Robert C Martinåœ¨21ä¸–çºªæ—©æœŸå°†å•ä¸€èŒè´£ï¼Œå¼€é—­åŸåˆ™ï¼Œé‡Œæ°æ›¿æ¢ï¼Œæ¥å£éš”ç¦»å’Œä¾èµ–å€’ç½®5ä¸ªåŸåˆ™å®šä¹‰ä¸ºSOLIDåŸåˆ™ï¼Œä½œä¸ºé¢å‘å¯¹è±¡ç¼–ç¨‹çš„5ä¸ªåŸºæœ¬åŸåˆ™ã€‚å½“è¿™äº›åŸåˆ™åœ¨ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå®ƒä½¿å¾—ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿæ›´æ¸…æ™°ï¼Œæ›´ç®€å•ï¼Œæœ€å¤§ç¨‹åº¦çš„æ‹¥æŠ±å˜åŒ–ã€‚</strong></p><p><strong>è¿ªç±³ç‰¹åŸåˆ™ï¼šæ›´å¥½çš„å¯æ‰©å±•æ€§</strong></p><p>è¿ªç±³ç‰¹åŸåˆ™ï¼ˆè‹±æ–‡ç¼©å†™ä¸ºLODï¼‰:ä¹Ÿç§°ä¸ºæœ€å°‘çŸ¥è¯†åŸåˆ™ï¼Œä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡æœ‰æœ€å°‘çš„ç†è§£ã€‚é€šä¿—çš„è®²ï¼Œä¸€ä¸ªç±»å¯¹è‡ªå·±éœ€è¦è€¦åˆæˆ–è€…è°ƒç”¨çš„ç±»çŸ¥é“çš„æœ€å°‘ï¼Œç±»çš„å†…éƒ¨å¦‚æœå®ç°ä¸è°ƒç”¨è€…æˆ–ä¾èµ–è€…æ²¡æœ‰å…³ç³»ã€‚è°ƒç”¨è€…æˆ–ä¾èµ–è€…åªéœ€è¦çŸ¥é“å®ƒè°ƒç”¨çš„æ–¹æ³•å³å¯ï¼Œå…¶ä»–çš„ä¸€æ¦‚ä¸çŸ¥ã€‚</p><p>ä¸‹é¢ä»¥ç§Ÿæˆ¿çš„ä¾‹å­æ¥ç†è§£è¯´æ˜è¿™ä¸ªåŸåˆ™ã€‚</p><p>ç§Ÿæˆ¿å¤§å¤šæ•°é€šè¿‡ä¸­ä»‹æ¥ç§Ÿï¼Œæˆ‘ä»¬å‡è®¾è®¾å®šçš„æƒ…æ™¯ä¸ºï¼šæˆ‘ä»¬åªè¦æ±‚æˆ¿å­çš„é¢ç§¯å’Œç§Ÿé‡‘ï¼Œå…¶ä»–çš„ä¸€æ¦‚ä¸ç®¡ï¼Œä¸­ä»‹æä¾›ç»™æˆ‘ä»¬ç¬¦åˆè¦æ±‚çš„æˆ¿å­ã€‚</p><p>public class Room {</p><p>public float area;</p><p>public float price;</p><p>public Room(float area, float price) {</p><p>this.area = area;</p><p>this.price = price;</p><p>}</p><p>}</p><p>public class Mediator {</p><p>private List&lt;Room> mRooms = new ArrayList&lt;>();</p><p>public Mediator(){</p><p>for (int i = 0; i &lt; 5; i++) {</p><p>mRooms.add(new Room(14 + i,(14 + i) * 150));</p><p>}</p><p>}</p><p>public List&lt;Room> getRooms(){</p><p>return mRooms;</p><p>}</p><p>}</p><p>public class Tenant {</p><p>private float roomArea;</p><p>private float roomPrice;</p><p>private static final float diffArea = 0.0001f;</p><p>private static final float diffPrice = 100.0001f;</p><p>public void rentRoom(Mediator mediator){</p><p>List&lt;Room> rooms = mediator.getRooms();</p><p>for (Room room : rooms) {</p><p>if(isSuitable(room)){</p><p>System.out.print("ç§Ÿåˆ°æˆ¿å­äº†" + room.toString());</p><p>break;</p><p>}</p><p>}</p><p>}</p><p>private boolean isSuitable(Room room){</p><p>return Math.abs(room.price - roomPrice) &lt; diffPrice</p><p>&& Math.abs(room.area - roomArea) &lt; diffArea;</p><p>}</p><p>}</p><blockquote><p>ä»ä¸Šé¢çš„ä»£ç çœ‹å‡ºï¼ŒTenantä¸ä»…ä¾èµ–Mediatorï¼Œè¿˜éœ€è¦é¢‘ç¹çš„ä¸Roomæ‰“äº¤é“ï¼Œç§Ÿæˆ·ç±»åªéœ€è¦é€šè¿‡ä¸­ä»‹æ‰¾åˆ°ä¸€é—´ç¬¦åˆè¦æ±‚çš„æˆ¿å­å³å¯ã€‚å¦‚æœæŠŠè¿™äº›æ£€ç´¢éƒ½æ”¾åœ¨Tenantä¸­ï¼Œå°±å¼±åŒ–äº†ä¸­ä»‹çš„ä½œç”¨ï¼Œè€Œä¸”å¯¼è‡´Tenantå’ŒRoomè€¦åˆåº¦è¾ƒé«˜ã€‚å½“Roomå˜åŒ–çš„æ—¶å€™ï¼ŒTenantä¹Ÿå¿…é¡»è·Ÿç€å˜åŒ–ï¼Œè€Œä¸”Tenantè¿˜å’ŒMediatorè€¦åˆï¼Œè¿™æ ·å…³ç³»å°±æ˜¾å¾—æœ‰äº›æ··ä¹±äº†ã€‚</p></blockquote><p>æˆ‘ä»¬éœ€è¦æ ¹æ®è¿ªç±³ç‰¹åŸåˆ™è¿›è¡Œè§£è€¦ã€‚</p><div class=pgc-img><img alt=éƒ½è¯´é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå·å·å‘Šè¯‰ä½ é¢å‘å¯¹è±¡ç¼–ç¨‹çš„6å¤§è®¾è®¡åŸåˆ™ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1532998275528fbe002dd47><p class=pgc-img-caption></p></div><p>public class Mediator {</p><p>private List&lt;Room> mRooms = new ArrayList&lt;>();</p><p>public Mediator(){</p><p>for (int i = 0; i &lt; 5; i++) {</p><p>mRooms.add(new Room(14 + i,(14 + i) * 150));</p><p>}</p><p>}</p><p>public Room rentOut(float price,float area){</p><p>for (Room room : mRooms) {</p><p>if (isSuitable(price,area,room)) {</p><p>return room;</p><p>}</p><p>}</p><p>return null;</p><p>}</p><p>private boolean isSuitable(float price,float area,Room room){</p><p>return Math.abs(room.price - price) &lt; Tenant.diffPrice</p><p>&& Math.abs(room.area - area) &lt; Tenant.diffArea;</p><p>}</p><p>}</p><p>public class Tenant {</p><p>private float roomArea;</p><p>private float roomPrice;</p><p>public static final float diffArea = 0.0001f;</p><p>public static final float diffPrice = 100.0001f;</p><p>public void rentRoom(Mediator mediator) {</p><p>Room room = mediator.rentOut(roomPrice, roomArea);</p><p>if(null != room){</p><p>System.out.print("ç§Ÿåˆ°æˆ¿å­äº†" + room.toString());</p><p>}</p><p>}</p><p>}</p><blockquote><p>æˆ‘ä»¬å°†å¯¹Roomçš„æ“ä½œç§»åˆ°äº†Mediatorä¸­ï¼Œè¿™æœ¬æ¥å°±æ˜¯Mediatorçš„èŒè´£ï¼Œæ ¹æ®ç§Ÿæˆ·çš„æ¡ä»¶æ£€ç´¢ç¬¦åˆçš„æˆ¿å­ï¼Œå¹¶ä¸”å°†æˆ¿å­è¿”å›ç»™ç”¨æˆ·å³å¯ã€‚è¿™æ ·ç§Ÿæˆ·å°±ä¸éœ€è¦çŸ¥é“æœ‰å…³Roomçš„ç»†èŠ‚ï¼Œæ¯”å¦‚å’Œæˆ¿ä¸œç­¾åˆåŒï¼Œæˆ¿äº§è¯çš„çœŸä¼ªç­‰ã€‚åªéœ€è¦å…³æ³¨å’Œæˆ‘ä»¬ç›¸å…³çš„å³å¯ã€‚</p></blockquote><p><strong>æ€»ç»“</strong></p><p>åœ¨åº”ç”¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸ä»…è¦å®Œæˆåº”ç”¨çš„å¼€å‘å·¥ä½œï¼Œè¿˜éœ€è¦åœ¨åç»­çš„å‡çº§ï¼Œç»´æŠ¤ä¸­è®©åº”ç”¨ç³»ç»Ÿèƒ½å¤Ÿæ‹¥æŠ±å˜åŒ–ã€‚æ‹¥æŠ±å˜åŒ–æ„å‘³ç€åœ¨æ»¡è¶³éœ€æ±‚ä¸”ä¸ç ´åç³»ç»Ÿç¨³å®šçš„å‰æä¸‹ä¿æŒé«˜æ‰©å±•æ€§ï¼Œé«˜å†…èšï¼Œä½è€¦åˆï¼Œåœ¨ç»å†äº†å„ä¸ªç‰ˆæœ¬å˜æ›´ä¹‹åä¾ç„¶ä¿æŒæ¸…æ™°ï¼Œçµæ´»ï¼Œç¨³å®šçš„ç³»ç»Ÿæ¶æ„ã€‚é‚£ä¹ˆéµå®ˆé¢å‘å¯¹è±¡çš„å…­å¤§åŸåˆ™æ˜¯æˆ‘ä»¬è¿ˆå‘çš„ç¬¬ä¸€æ­¥ã€‚</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'å¯¹è±¡','ç¼–ç¨‹','é¢å‘'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>