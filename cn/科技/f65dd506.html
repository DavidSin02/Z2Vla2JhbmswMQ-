<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Linux内核简介，你能看懂么 | 极客快訊</title><meta property="og:title" content="Linux内核简介，你能看懂么 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/01f248e03b78487093db92f7873aacb8"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f65dd506.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f65dd506.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f65dd506.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f65dd506.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f65dd506.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f65dd506.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f65dd506.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f65dd506.html><meta property="article:published_time" content="2020-11-14T21:03:22+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:22+08:00"><meta name=Keywords content><meta name=description content="Linux内核简介，你能看懂么"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/f65dd506.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Linux内核简介，你能看懂么</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>大纲：</p><p>理解Linux内核最好预备的知识点</p><p>Linux内核的特点</p><p>Linux内核的任务</p><p>内核的组成部分</p><p>哪些地方用到了内核机制？</p><p>Linux进程</p><p>Linux创建新进程的机制</p><p>Linux线程</p><p>内核线程</p><p>地址空间与特权级别</p><p>虚拟地址与物理地址</p><p>特权级别（Linux的两种状态）</p><p>系统调用</p><p>设备驱动程序、块设备和字符设备</p><p>网络</p><p>文件系统</p><p>模块和热插拔</p><p>注:本文为《深入Linux内核架构》 的学习笔记</p><p>理解Linux内核最好预备的知识点：</p><p>懂C语言</p><p>懂一点操作系统的知识</p><p>熟悉少量相关算法</p><p>懂计算机体系结构</p><p>Linux内核的特点：</p><p>结合了unix操作系统的一些基础概念</p><p>Linux内核的任务：</p><p>1.从技术层面讲，内核是硬件与软件之间的一个中间层。作用是将应用层序的请求传递给硬件，并充当底层驱动程序，对系统中的各种设备和组件进行寻址。</p><p>2.从应用程序的层面讲，应用程序与硬件没有联系，只与内核有联系，内核是应用程序知道的层次中的最底层。在实际工作中内核抽象了相关细节。</p><p>3.内核是一个资源管理程序。负责将可用的共享资源(CPU时间、磁盘空间、网络连接等)分配得到各个系统进程。</p><p>4.内核就像一个库，提供了一组面向系统的命令。系统调用对于应用程序来说，就像调用普通函数一样。</p><p>内核实现策略：</p><p>1.微内核。最基本的功能由中央内核（微内核）实现。所有其他的功能都委托给一些独立进程，这些进程通过明确定义的通信接口与中心内核通信。</p><p>2.宏内核。内核的所有代码，包括子系统（如内存管理、文件管理、设备驱动程序）都打包到一个文件中。内核中的每一个函数都可以访问到内核中所有其他部分。目前支持模块的动态装卸(裁剪)。Linux内核就是基于这个策略实现的。</p><p>内核的组成部分：</p><p>1.用户空间（在“地址空间与特权级别”小节会详细介绍）：</p><p>应用程序：</p><p>C库</p><p>2.内核空间（在“地址空间与特权级别”小节会详细介绍）：</p><p>核心内核</p><p>设备驱动程序</p><p>硬件</p><p>详细可参考图1</p><div class=pgc-img><img alt=Linux内核简介，你能看懂么 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/01f248e03b78487093db92f7873aacb8><p class=pgc-img-caption></p></div><p>图1 Linux内核组成部分</p><p>哪些地方用到了内核机制？</p><p>1.进程（在cpu的虚拟内存中分配地址空间，各个进程的地址空间完全独立;同时执行的进程数最多不超过cpu数目）之间进行通 信，需要使用特定的内核机制。</p><p>2.进程间切换(同时执行的进程数最多不超过cpu数目)，也需要用到内核机制。</p><p>进程切换也需要像FreeRTOS任务切换一样保存状态，并将进程置于闲置状态/恢复状态。</p><p>3.进程的调度。确认哪个进程运行多长的时间。</p><p>Linux进程</p><p>1.采用层次结构，每个进程都依赖于一个父进程。内核启动init程序作为第一个进程。该进程负责进一步的系统初始化操作。init进程是进程树的根，所有的进程都直接或者间接起源于该进程。</p><p>2.通过pstree命令查询。实际上得系统第一个进程是systemd，而不是init（这也是疑问点）</p><p>3.系统中每一个进程都有一个唯一标识符(ID),用户（或其他进程）可以使用ID来访问进程。</p><p>Linux创建新进程的机制;</p><p>1.使用fork函数。</p><p>功能：创建当前进程的一个副本。父进程和子进程只有PID（进程ID）不同。父进程的内容被复制。(写时复制：可以了解下这个概念)</p><p>2.使用exec函数。</p><p>功能：将一个新程序加载到当前进程的内存中并执行。旧程序的内存页将刷出，其内容替换为新的数据。然后开始执行新程序。</p><p>Linux线程</p><p>进程可以看成是一个正在执行的程序，而线程则是与主程序并行运行的程序函数或例程。</p><p>Linux创建新线程</p><p>采用clone方法创建线程。</p><p>内核线程</p><p>特点：</p><p>1.不与任何特定的用户空间进程相关联。</p><p>2.与中断上下文运转的内核相比，内核线程可以进入睡眠状态,也可以像系统中的普通进程一样被调度器跟踪。</p><p>用途：</p><p>1.从内存和块设备之间的数据同步。</p><p>2.帮助调度器在CPU上分配进程。</p><p>如何查看内核线程：</p><p>命令：ps fax 方括号内的就是内核线程。</p><p>地址空间与特权级别</p><p>在正式介绍之前先介绍几个单位：</p><p>KiB ２^10字节</p><p>MiB ２^20</p><p>GiB ２^30</p><p>地址空间</p><p>虚拟地址与物理地址：</p><p>虚拟地址：在计算机的专用术语中是指标识一个虚拟(非物理地址)的实体地址。</p><p>物理地址：切切实实存在的地址。在存储器里以字节为单位存储信息，为正确地存放或取得信息，每一个字节单元给以一个唯一的存储器地址，称为物理地址。</p><p>映射关系：</p><p>用页表为物理地址分配虚拟地址</p><p>注意：未必虚拟地址的所有页都映射到某个页帧。</p><p>原因：</p><p>1.页没有内存可以使用</p><p>2.数据尚不需要使用而没有载入内存。</p><p>3.页已经换出硬盘，需要时再换回内存。</p><p>页帧：物理内存页</p><p>页：专指虚拟地址空间中的页。</p><p>页表：将虚拟地址空间映射到物理地址空间的数据结构。</p><p>多级分页：建立虚拟地址到物理地址映射的一种方法，能有效减少内存用量。</p><p>CPU加速内存的访问过程，方法：</p><p>1.MMU(Memory Management Unit)内存管理单元</p><p>2.TLB(Translation Lookaside Buffer)地址转换后备缓冲器</p><p>IA-32位结构的CPU只需要使用二级页表,Linux内核总是使用四级页表，剩余部分由内核通过控页表对缺少的页表进行仿真。</p><p>概念注意：</p><p>1.CPU的字长决定了所能管理的地址空间的最大长度。对于32位系统是２^32 B = 4GiB</p><p>2.虚拟地址空间：地址空间的最大长度与实际可用的物理内存的数量无关。</p><p>虚拟地址空间划分为两个部分：</p><p>内核空间</p><p>用户空间</p><p>如图2所示：</p><div class=pgc-img><img alt=Linux内核简介，你能看懂么 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7b5b0506af324132868f422c6024d2a2><p class=pgc-img-caption></p></div><p>图2 虚拟内存的划分</p><p>有个等价名称值得一提：</p><p>用户层：指应用程序本身。指不属于内核的东西。</p><p>用户空间：不仅可以表示应用程序，还指代应用程序所运行的虚拟地址空间的一部分。与内核空间相对。</p><p>注意：每一个进程都有上述独立的虚拟地址空间。对于图2所示，每个进程有4GiB的内存空间。</p><p>特权级别</p><p>Linux有两种状态，两种状态代表两种特权级别：</p><p>核心态:在虚拟地址的内核空间运行的状态。</p><p>用户状态:在虚拟地址的用户空间运行的状态。</p><p>注意：在用户状态禁止访问内核空间</p><p>这两种状态的差别在于：对高于TASK_SIZE的内存区域的访问。</p><p>系统调用</p><p>定义：从用户状态到核心态的切换通过系统调用的特定手段完成。</p><p>方法：</p><p>1.内核代表用户程序执行代码</p><p>2.异步硬件中断激活，然后在中断上下文中进行。注意：在中断上下文运行时，内核不能进入睡眠状态。</p><p>注意：</p><p>CPU大多数在执行用户空间中的代码。当应用程序执行系统调用时，则会切换到核心态，内核将完成其请求。在此期间，内核可以访问虚拟地址空间的用户部分。在系统调用完成之后，CPU切换回用户状态。</p><p>硬件中断也使CPU切换到核心态，但这种情况下内核不能访问用户空间。</p><p>系统调用有哪些：</p><p>进程管理</p><p>信号</p><p>文件</p><p>目录和文件系统</p><p>保护机制</p><p>定时器函数</p><p>如：在IA-32处理器上，Linux使用一个专用软件中断执行系统调用。</p><p>设备驱动程序、块设备和字符设备</p><p>设备驱动程序的任务:是在于支持应用程序经由设备文件与设备通信。换言之，使得能按恰当的方式在设备上读取/写入数据。</p><p>设备驱动程序的定义：用于与系统连接的输入/输出装置通信。如硬盘、软驱、各种接口、声卡等。</p><p>外设分为两类：</p><p>1.字符设备。提供连续的数据流，数据可以顺序读取，通常不支持随机存取。支持按字节/字符来读写数据。</p><p>典型:调制解调器</p><p>2.块设备。可以随机访问设备数据，程序可以自行确定读取数据的位置。不支持基于字符寻址，数据读写只能以块的倍数进行。</p><p>典型:硬盘。</p><p>复杂性:比字符设备复杂，因为设计到缓存机制。</p><p>网络</p><p>网卡也可以通过设备驱动程序控制。</p><p>但在内核中，网卡不能以设备文件访问。因为网络通信期间数据打包到各种协议层，内存处理数据必须针对协议层处理，才能有效将数据对接应用程序。</p><p>为了支持用文件接口处理网络连接。Linux提供了套接字抽象，套接字可以看成是应用程序、文件接口、内核的网络实现之间的代理。</p><p>文件系统</p><p>文件存储在硬盘或者其他块设备(如光盘等),采用层次式文件系统。</p><p>文件系统使用目录结构主治存储的数据，并将其他原信息（如所有者、访问权限等）关联起来。</p><p>Linux支持许多不同的文件系统：</p><p>如标准的Ext2和Ext3文件系统、ReiserFS、XFS、VFAT等</p><p>注意：软件层（Virtual Filesystem虚拟文件系统）内核必须提供一个额外的软件层，将各种底层的文件系统的具体特征与应用层隔离开。如图3所示。</p><div class=pgc-img><img alt=Linux内核简介，你能看懂么 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7ca5fad55d234195b7c44a1f0b1b1d98><p class=pgc-img-caption></p></div><p>图3 文件系统的额外软件层</p><h1><strong>需要更多关于Linux后台开发免费视频教学、请加群720209036。</strong></h1><div class=pgc-img><img alt=Linux内核简介，你能看懂么 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a2bf7f2a36214417acd93b2b9bec3835><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=Linux内核简介，你能看懂么 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/afe161a8fef142e8b1eb468d8e4859fe><p class=pgc-img-caption></p></div><p>版权声明：本文为CSDN博主「TommyMusk」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</p><p>原文链接：https://blog.csdn.net/TommyMusk/article/details/80714364</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Linux','内核','简介'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>