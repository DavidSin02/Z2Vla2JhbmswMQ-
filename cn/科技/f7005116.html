<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å— | æå®¢å¿«è¨Š</title><meta property="og:title" content="ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å— - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/8a4624de47524aa69601b3047226a318"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f7005116.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f7005116.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f7005116.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f7005116.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f7005116.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f7005116.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f7005116.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f7005116.html><meta property="article:published_time" content="2020-11-14T21:00:34+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:34+08:00"><meta name=Keywords content><meta name=description content="ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å—"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/f7005116.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å—</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right><strong>Web å¼€å‘ä¸­çš„ cookie æ˜¯ä»€ä¹ˆ?</strong></h1><p><strong>cookie æ˜¯åç«¯å¯ä»¥å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­çš„å°å—æ•°æ®ã€‚</strong> Cookie æœ€å¸¸è§ç”¨ä¾‹åŒ…æ‹¬ç”¨æˆ·è·Ÿè¸ªï¼Œä¸ªæ€§åŒ–ä»¥åŠèº«ä»½éªŒè¯ã€‚</p><p><strong>Cookies</strong> å…·æœ‰å¾ˆå¤šéšç§é—®é¢˜ï¼Œå¤šå¹´æ¥ä¸€ç›´å—åˆ°ä¸¥æ ¼çš„ç›‘ç®¡ã€‚</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œä¸»è¦ä¾§é‡äºæŠ€æœ¯æ–¹é¢ï¼šå­¦ä¹ å¦‚ä½•åœ¨å‰ç«¯å’Œåç«¯åˆ›å»ºï¼Œä½¿ç”¨ HTTP cookieã€‚</p><h1 class=pgc-h-arrow-right><strong>åç«¯é…ç½®</strong></h1><p>åç«¯ç¤ºä¾‹æ˜¯<strong>Flask</strong>ç¼–å†™çš„ã€‚å¦‚æœä½ æƒ³è·Ÿç€å­¦ä¹ ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Pythonè™šæ‹Ÿç¯å¢ƒï¼Œç§»åŠ¨åˆ°å…¶ä¸­å¹¶å®‰è£…Flask</p><pre><code>mkdirÂ cookiesÂ &amp;&amp;Â cdÂ $_python3Â -mÂ venvÂ venvsourceÂ venv/bin/activatepipÂ installÂ Flask</code></pre><p>åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºflask app.pyçš„æ–°æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨æœ¬æ–‡çš„ç¤ºä¾‹åœ¨æœ¬åœ°è¿›è¡Œå®éªŒã€‚</p><h1 class=pgc-h-arrow-right><strong>è°åˆ›å»º cookies ?</strong></h1><p>é¦–å…ˆï¼Œcookies ä»ä½•è€Œæ¥ï¼Ÿè°åˆ›å»º cookies ï¼Ÿ</p><p>è™½ç„¶å¯ä»¥ä½¿ç”¨document.cookieåœ¨æµè§ˆå™¨ä¸­åˆ›å»º cookieï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåç«¯çš„è´£ä»»æ˜¯åœ¨å°†å“åº”å®¢æˆ·ç«¯è¯·æ±‚ä¹‹å‰åœ¨è¯·æ±‚ä¸­è®¾ç½® cookieã€‚</p><p>åç«¯æ˜¯æŒ‡å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ›å»º Cookieï¼š</p><ul><li>åç«¯å®é™…åº”ç”¨ç¨‹åºçš„ä»£ç (Pythonã€JavaScriptã€PHPã€Java)</li><li>å“åº”è¯·æ±‚çš„WebæœåŠ¡å™¨ï¼ˆNginxï¼ŒApacheï¼‰</li></ul><p>åç«¯å¯ä»¥åœ¨ HTTP è¯·æ±‚æ±‚ä¸­ Set-Cookie å±æ€§æ¥è®¾ç½® cookieï¼Œå®ƒæ˜¯ç”±é”®/å€¼å¯¹ä»¥åŠå¯é€‰å±æ€§ç»„æˆçš„ç›¸åº”å­—ç¬¦ä¸²ï¼š</p><pre><code>Set-Cookie:Â myfirstcookie=somecookievalue</code></pre><p>ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ›å»º cookieï¼Ÿè¿™å–å†³äºéœ€æ±‚ã€‚</p><p>cookie æ˜¯ç®€å•çš„å­—ç¬¦ä¸²ã€‚åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºflask_app.pyçš„Pythonæ–‡ä»¶ï¼Œå¹¶è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><pre><code>fromÂ flaskÂ importÂ Flask,Â make_responseappÂ =Â Flask(__name__)@app.route("/index/",Â methods=["GET"])defÂ index():Â Â Â Â responseÂ =Â make_response("Here,Â takeÂ someÂ cookie!")Â Â Â Â response.headers["Set-Cookie"]Â =Â "myfirstcookie=somecookievalue"Â Â Â Â returnÂ response</code></pre><p>ç„¶åè¿è¡Œåº”ç”¨ç¨‹åº:</p><pre><code>FLASK_ENV=developmentÂ FLASK_APP=flask_app.pyÂ flaskÂ run</code></pre><p>å½“è¯¥åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼Œç”¨æˆ·è®¿é—®http://127.0.0.1:5000/index/ï¼Œåç«¯å°†è®¾ç½®ä¸€ä¸ªå…·æœ‰é”®/å€¼å¯¹çš„åä¸ºSet-Cookieçš„å“åº”æ ‡å¤´ã€‚</p><p>ï¼ˆ127.0.0.1:5000æ˜¯å¼€å‘ä¸­çš„ Flask åº”ç”¨ç¨‹åºçš„é»˜è®¤ä¾¦å¬åœ°å€/ç«¯å£ï¼‰ã€‚</p><p>Set-Cookieæ ‡å¤´æ˜¯äº†è§£å¦‚ä½•åˆ›å»ºcookieçš„å…³é”®ï¼š</p><pre><code>response.headers["Set-Cookie"]Â =Â "myfirstcookie=somecookievalue"</code></pre><p>å¤§å¤šæ•°æ¡†æ¶éƒ½æœ‰è‡ªå·±è®¾ç½® cookie çš„æ–¹æ³•ï¼Œæ¯”å¦‚Flaskçš„set_cookie()ã€‚</p><h1 class=pgc-h-arrow-right><strong>å¦‚ä½•æŸ¥çœ‹ cookies ï¼Ÿ</strong></h1><p>è®¿é—®http://127.0.0.1:5000/index/åï¼Œåç«¯å°†åœ¨æµè§ˆå™¨ä¸­è®¾ç½®cookieã€‚è¦æŸ¥çœ‹æ­¤cookieï¼Œå¯ä»¥ä»æµè§ˆå™¨çš„æ§åˆ¶å°è°ƒç”¨document.cookieï¼š</p><div class=pgc-img><img alt="ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å—" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8a4624de47524aa69601b3047226a318><p class=pgc-img-caption></p></div><p>æˆ–è€…å¯ä»¥åœ¨å¼€å‘äººå‘˜å·¥å…·ä¸­é€‰ä¸­Storageé€‰é¡¹å¡ã€‚å•å‡»cookie,ä¼šçœ‹åˆ° cookie å…·ä½“çš„å†…å®¹ï¼š</p><div class=pgc-img><img alt="ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å—" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/61a36d7e7fae49ecabbb7c65b5c868bb><p class=pgc-img-caption></p></div><p>åœ¨å‘½ä»¤è¡Œä¸Šï¼Œè¿˜å¯ä»¥ä½¿ç”¨curlæŸ¥çœ‹åç«¯è®¾ç½®äº†å“ªäº› cookie</p><pre><code>curlÂ -IÂ http://127.0.0.1:5000/index/</code></pre><p>å¯ä»¥å°† Cookie ä¿å­˜åˆ°æ–‡ä»¶ä¸­ä»¥ä¾›ä»¥åä½¿ç”¨ï¼š</p><pre><code>curlÂ -IÂ http://127.0.0.1:5000/index/Â --cookie-jarÂ mycookies</code></pre><p>åœ¨ stdout ä¸Šæ˜¾ç¤º cookie:</p><pre><code>curlÂ -IÂ http://127.0.0.1:5000/index/Â --cookie-jarÂ -</code></pre><p>è¯·æ³¨æ„ï¼Œæ²¡æœ‰HttpOnlyå±æ€§çš„cookieï¼Œåœ¨æµè§ˆå™¨ä¸­å¯ä»¥ä½¿ç”¨document.cookieä¸Šè®¿é—®ï¼Œå¦‚æœè®¾ç½®äº† HttpOnly å±æ€§ï¼Œdocument.cookieå°±è¯»å–ä¸åˆ°ã€‚</p><pre><code>Set-Cookie:Â myfirstcookie=somecookievalue;Â HttpOnly</code></pre><p>ç°åœ¨ï¼Œè¯¥cookie ä»å°†å‡ºç°åœ¨ Storage é€‰é¡¹å¡ä¸­ï¼Œä½†æ˜¯ document.cookieè¿”å›çš„æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚</p><p>ä»ç°åœ¨å¼€å§‹ï¼Œä¸ºæ–¹ä¾¿èµ·è§ï¼Œä½¿ç”¨Flaskçš„ response.set_cookie() åœ¨åç«¯ä¸Šåˆ›å»º cookieã€‚</p><h1 class=pgc-h-arrow-right><strong>æˆ‘æœ‰ä¸€ä¸ª cookieï¼Œç°åœ¨æ€ä¹ˆåŠï¼Ÿ</strong></h1><p>ä½ çš„æµè§ˆå™¨å¾—åˆ°ä¸€ä¸ª cookieã€‚ç°åœ¨æ€ä¹ˆåŠå‘¢?ä¸€æ—¦æœ‰äº† cookieï¼Œæµè§ˆå™¨å°±å¯ä»¥å°†cookieå‘é€å›åç«¯ã€‚</p><p>è¿™æœ‰è®¸å¤šç”¨é€”å‘å¦‚ï¼šç”¨æˆ·è·Ÿè¸ªã€ä¸ªæ€§åŒ–ï¼Œä»¥åŠæœ€é‡è¦çš„èº«ä»½éªŒè¯ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€æ—¦ä½ ç™»å½•ç½‘ç«™ï¼Œåç«¯å°±ä¼šç»™ä½ ä¸€ä¸ªcookieï¼š</p><pre><code>Set-Cookie:Â userid=sup3r4n0m-us3r-1d3nt1f13r</code></pre><p>ä¸ºäº†åœ¨æ¯ä¸ªåç»­è¯·æ±‚ä¸­æ­£ç¡®è¯†åˆ« æˆ‘ä»¬çš„èº«ä»½ï¼Œåç«¯ä¼šæ£€æŸ¥æ¥è‡ªè¯·æ±‚ä¸­æµè§ˆå™¨çš„ cookie</p><p>è¦å‘é€Cookieï¼Œæµè§ˆå™¨ä¼šåœ¨è¯·æ±‚ä¸­é™„åŠ ä¸€ä¸ªCookieæ ‡å¤´ï¼š</p><pre><code>Cookie:Â userid=sup3r4n0m-us3r-1d3nt1f13r</code></pre><h1 class=pgc-h-arrow-right><strong>cookie å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´: Max-Age å’Œ expires</strong></h1><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œcookie åœ¨ç”¨æˆ·å…³é—­ä¼šè¯æ—¶å³å…³é—­æµè§ˆå™¨æ—¶è¿‡æœŸã€‚è¦æŒä¹…åŒ–cookieï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡expiresæˆ–Max-Ageå±æ€§</p><pre><code>Set-Cookie:Â myfirstcookie=somecookievalue;Â expires=Tue,Â 09Â JunÂ 2020Â 15:46:52Â GMT;Â Max-Age=1209600</code></pre><p>æ³¨æ„ï¼š<strong>Max-Age</strong>ä¼˜å…ˆäº<strong>expires</strong>ã€‚</p><h1 class=pgc-h-arrow-right><strong>cookieçš„ä½œç”¨åŸŸæ˜¯ç½‘ç«™è·¯å¾„: path å±æ€§</strong></h1><p>è€ƒè™‘è¯¥åç«¯ï¼Œè¯¥åç«¯åœ¨è®¿é—®http://127.0.0.1:5000/æ—¶ä¸ºå…¶å‰ç«¯è®¾ç½®äº†ä¸€ä¸ªæ–°çš„ cookieã€‚ç›¸åï¼Œåœ¨å…¶ä»–ä¸¤æ¡è·¯å¾„ä¸Šï¼Œæˆ‘ä»¬æ‰“å°è¯·æ±‚çš„cookieï¼š</p><pre><code>fromÂ flaskÂ importÂ Flask,Â make_response,Â requestappÂ =Â Flask(__name__)@app.route("/",Â methods=["GET"])defÂ index():Â Â Â Â responseÂ =Â make_response("Here,Â takeÂ someÂ cookie!")Â Â Â Â response.set_cookie(key="id",Â value="3db4adj3d",Â path="/about/")Â Â Â Â returnÂ response@app.route("/about/",Â methods=["GET"])defÂ about():Â Â Â Â print(request.cookies)Â Â Â Â returnÂ "HelloÂ world!"@app.route("/contact/",Â methods=["GET"])defÂ contact():Â Â Â Â print(request.cookies)Â Â Â Â returnÂ "HelloÂ world!"</code></pre><p>è¿è¡Œè¯¥åº”ç”¨ç¨‹åº:</p><pre><code>FLASK_ENV=developmentÂ FLASK_APP=flask_app.pyÂ flaskÂ run</code></pre><p>åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ä¸æ ¹è·¯ç”±å»ºç«‹è¿æ¥ï¼Œåˆ™å¯ä»¥åœ¨Set-Cookieä¸­çœ‹åˆ°cookieï¼š</p><pre><code>curlÂ -IÂ http://127.0.0.1:5000/Â --cookie-jarÂ cookiesHTTP/1.0Â 200Â OKContent-Type:Â text/html;Â charset=utf-8Content-Length:Â 23Set-Cookie:Â id=3db4adj3d;Â Path=/about/Server:Â Werkzeug/1.0.1Â Python/3.8.3Date:Â Wed,Â 27Â MayÂ 2020Â 09:21:37Â GMT</code></pre><p>è¯·æ³¨æ„ï¼Œæ­¤æ—¶ cookie å…·æœ‰Pathå±æ€§ï¼š</p><pre><code>Set-Cookie:Â id=3db4adj3d;Â Path=/about/</code></pre><p>/about/ è·¯ç”±å¹¶ä¿å­˜ cookit</p><pre><code>curlÂ -IÂ http://127.0.0.1:5000/about/Â --cookieÂ cookies</code></pre><p>åœ¨ Flask åº”ç”¨ç¨‹åºçš„ç»ˆç«¯ä¸­è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p><pre><code>ImmutableMultiDict([('id',Â '3db4adj3d')])127.0.0.1Â -Â -Â [27/May/2020Â 11:27:55]Â "HEADÂ /about/Â HTTP/1.1"Â 200Â -</code></pre><p>æ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œcookie è¿”å›åˆ°åç«¯ã€‚ç°åœ¨å°è¯•è®¿é—® /contact/ è·¯ç”±ï¼š</p><pre><code>urlÂ -IÂ http://127.0.0.1:5000/contact/Â --cookieÂ cookies</code></pre><p>åœ¨ Flask åº”ç”¨ç¨‹åºçš„ç»ˆç«¯ä¸­è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p><pre><code>ImmutableMultiDict([])127.0.0.1Â -Â -Â [27/May/2020Â 11:29:00]Â "HEADÂ /contact/Â HTTP/1.1"Â 200Â -</code></pre><p>è¿™è¯´æ˜å•¥?cookie çš„ä½œç”¨åŸŸæ˜¯Path ã€‚å…·æœ‰ç»™å®šè·¯å¾„å±æ€§çš„cookieä¸èƒ½è¢«å‘é€åˆ°å¦ä¸€ä¸ªä¸ç›¸å…³çš„è·¯å¾„ï¼Œå³ä½¿è¿™ä¸¤ä¸ªè·¯å¾„ä½äºåŒä¸€åŸŸä¸­ã€‚</p><p><strong>è¿™æ˜¯cookieæƒé™çš„ç¬¬ä¸€å±‚ã€‚</strong></p><p>åœ¨cookieåˆ›å»ºè¿‡ç¨‹ä¸­çœç•¥Pathæ—¶ï¼Œæµè§ˆå™¨é»˜è®¤ä¸º/ã€‚</p><h1 class=pgc-h-arrow-right><strong>cookie çš„ä½œç”¨åŸŸæ˜¯åŸŸå: domain å±æ€§</strong></h1><p>cookie çš„ Domain å±æ€§çš„å€¼æ§åˆ¶æµè§ˆå™¨æ˜¯å¦åº”è¯¥æ¥å—cookieä»¥åŠcookieè¿”å›çš„ä½ç½®ã€‚</p><p>è®©æˆ‘ä»¬çœ‹ä¸€äº›ä¾‹å­ã€‚</p><h1 class=pgc-h-arrow-right><strong>ä¸»æœºä¸åŒ¹é…ï¼ˆé”™è¯¯çš„ä¸»æœºï¼‰</strong></h1><p>æŸ¥çœ‹ https://serene-bastion-01422.herokuapp.com/get-wrong-domain-cookie/è®¾ç½®çš„cookieï¼š</p><pre><code>Set-Cookie:Â coookiename=wr0ng-d0m41n-c00k13;Â Domain=api.valentinog.com</code></pre><p>è¿™é‡Œçš„ cookie æ¥è‡ª<strong>serene-bastion-01422.herokuapp.com</strong>ï¼Œä½†æ˜¯Domainå±æ€§å…·æœ‰<strong>api.valentinog.com</strong>ã€‚</p><p>æµè§ˆå™¨æ²¡æœ‰å…¶ä»–é€‰æ‹©æ¥æ‹’ç»è¿™ä¸ª cookieã€‚æ¯”å¦‚ Chrome ä¼šç»™å‡ºä¸€ä¸ªè­¦å‘Š(Firefoxæ²¡æœ‰)</p><div class=pgc-img><img alt="ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å—" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7c81fe6e3a2446dbb6b576bfad0f481e><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>ä¸»æœºä¸åŒ¹é…ï¼ˆå­åŸŸåï¼‰</strong></h1><p>æŸ¥çœ‹ https://serene-bastion-01422.herokuapp.com/get-wrong-subdomain-cookie/è®¾ç½®çš„cookieï¼š</p><pre><code>Set-Cookie:Â coookiename=wr0ng-subd0m41n-c00k13;Â Domain=secure-brushlands-44802.herokuapp.com</code></pre><p>è¿™é‡Œçš„ Cookie æ¥è‡ªserene-bastion-01422.herokuapp.comï¼Œä½†**â€œDomainâ€**å±æ€§æ˜¯secure-brushlands-44802.herokuapp.comã€‚</p><p>å®ƒä»¬åœ¨ç›¸åŒçš„åŸŸä¸Šï¼Œä½†æ˜¯å­åŸŸåä¸åŒã€‚åŒæ ·ï¼Œæµè§ˆå™¨ä¹Ÿæ‹’ç»æ­¤cookieï¼š</p><div class=pgc-img><img alt="ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å—" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8a96594e351b44a6be4a707ee00506bf><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>ä¸»æœºåŒ¹é…ï¼ˆæ•´ä¸ªåŸŸï¼‰</strong></h1><p>æŸ¥çœ‹ https://www.valentinog.com/get-domain-cookie.htmlè®¾ç½®çš„cookieï¼š</p><pre><code>set-cookie:Â cookiename=d0m41n-c00k13;Â Domain=valentinog.com</code></pre><p>æ­¤cookieæ˜¯ä½¿ç”¨ Nginx add_headeråœ¨WebæœåŠ¡å™¨ä¸Šè®¾ç½®çš„ï¼š</p><pre><code>add_headerÂ Set-CookieÂ "cookiename=d0m41n-c00k13;Â Domain=valentinog.com";</code></pre><p>è¿™é‡Œä½¿ç”¨ Nginx ä¸­è®¾ç½®cookieçš„å¤šç§æ–¹æ³•ã€‚Cookie æ˜¯ç”± Web æœåŠ¡å™¨æˆ–åº”ç”¨ç¨‹åºçš„ä»£ç è®¾ç½®çš„ï¼Œå¯¹äºæµè§ˆå™¨æ¥è¯´æ— å…³ç´§è¦ã€‚</p><p>é‡è¦çš„æ˜¯ cookie æ¥è‡ªå“ªä¸ªåŸŸã€‚</p><p>åœ¨æ­¤æµè§ˆå™¨å°†æ„‰å¿«åœ°æ¥å—cookieï¼Œå› ä¸ºDomainä¸­çš„ä¸»æœºåŒ…æ‹¬cookieæ‰€æ¥è‡ªçš„ä¸»æœºã€‚</p><p>æ¢å¥è¯è¯´ï¼Œvalentinog.comåŒ…æ‹¬å­åŸŸåwww.valentinog.comã€‚</p><p>åŒæ—¶ï¼Œå¯¹valentinog.comçš„æ–°è¯·æ±‚,cookie éƒ½ä¼šæºå¸¦ç€ï¼Œä»¥åŠä»»ä½•å¯¹valentinog.comå­åŸŸåçš„è¯·æ±‚ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªé™„åŠ äº†Cookieçš„ www å­åŸŸè¯·æ±‚ï¼š</p><div class=pgc-img><img alt="ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å—" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9dc2184e57334a21b7116989b14435cb><p class=pgc-img-caption></p></div><p>ä¸‹é¢æ˜¯å¯¹å¦ä¸€ä¸ªè‡ªåŠ¨é™„åŠ cookieçš„å­åŸŸçš„è¯·æ±‚</p><div class=pgc-img><img alt="ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å—" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/220b42278e584c89b7a7d7081dcd9cb5><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>Cookies å’Œå…¬å…±åç¼€åˆ—è¡¨</strong></h1><p>æŸ¥çœ‹ https://serene-bastion-01422.herokuapp.com/get-domain-cookie/:è®¾ç½®çš„ cookieï¼š</p><pre><code>Set-Cookie:Â coookiename=d0m41n-c00k13;Â Domain=herokuapp.com</code></pre><p>è¿™é‡Œçš„ cookie æ¥è‡ªserene-bas-01422.herokuapp.comï¼ŒDomain å±æ€§æ˜¯herokuapp.comã€‚æµè§ˆå™¨åœ¨è¿™é‡Œåº”è¯¥åšä»€ä¹ˆ</p><p>ä½ å¯èƒ½è®¤ä¸ºserene-base-01422.herokuapp.comåŒ…å«åœ¨herokuapp.comåŸŸä¸­ï¼Œå› æ­¤æµè§ˆå™¨åº”è¯¥æ¥å—cookieã€‚</p><p>ç›¸åï¼Œå®ƒæ‹’ç» cookieï¼Œå› ä¸ºå®ƒæ¥è‡ª<strong>å…¬å…±åç¼€åˆ—è¡¨</strong>ä¸­åŒ…å«çš„åŸŸã€‚</p><p>Public Suffix Listï¼ˆå…¬å…±åç¼€åˆ—è¡¨ï¼‰ã€‚æ­¤åˆ—è¡¨åˆ—ä¸¾äº†é¡¶çº§åŸŸåå’Œå¼€æ”¾æ³¨å†Œçš„åŸŸåã€‚æµè§ˆå™¨ç¦æ­¢æ­¤åˆ—è¡¨ä¸Šçš„åŸŸåè¢«å­åŸŸåå†™å…¥Cookieã€‚</p><h1 class=pgc-h-arrow-right><strong>ä¸»æœºåŒ¹é…ï¼ˆå­åŸŸï¼‰</strong></h1><p>æŸ¥çœ‹ https://serene-bastion-01422.herokuapp.com/get-subdomain-cookie/:è®¾ç½®çš„ cookieï¼š</p><pre><code>Set-Cookie:Â coookiename=subd0m41n-c00k13</code></pre><p>å½“åŸŸåœ¨cookieåˆ›å»ºæœŸé—´è¢«çœç•¥æ—¶ï¼Œæµè§ˆå™¨ä¼šé»˜è®¤åœ¨åœ°å€æ ä¸­æ˜¾ç¤ºåŸå§‹ä¸»æœºï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘çš„ä»£ç ä¼šè¿™æ ·åš:</p><pre><code>response.set_cookie(key="coookiename",Â value="subd0m41n-c00k13")</code></pre><p>å½“ Cookie è¿›å…¥æµè§ˆå™¨çš„ Cookie å­˜å‚¨åŒºæ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°å·²åº”ç”¨Domain ï¼š</p><div class=pgc-img><img alt="ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å—" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c6e523e434ec47de96940fcf5fa3d1ea><p class=pgc-img-caption></p></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰æ¥è‡ªserene-bastion-01422.herokuapp.com çš„ cookie, é‚£ cookie ç°åœ¨åº”è¯¥é€åˆ°å“ªé‡Œ?</p><p>å¦‚æœä½ è®¿é—®https://serene-bastion-01422.herokuapp.com/ï¼Œåˆ™ cookie éšè¯·æ±‚ä¸€èµ·å‡ºç°ï¼š</p><div class=pgc-img><img alt="ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å—" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/14758019996745419eb718a261cde202><p class=pgc-img-caption></p></div><p>ä½†æ˜¯ï¼Œå¦‚æœè®¿é—®herokuapp.comï¼Œåˆ™ cookie ä¸ä¼šéšè¯·æ±‚ä¸€èµ·å‡ºç°ï¼š</p><div class=pgc-img><img alt="ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å—" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f38726407a5d46afa1acd29b16c93669><p class=pgc-img-caption></p></div><p>æ¦‚æ‹¬åœ°è¯´ï¼Œæµè§ˆå™¨ä½¿ç”¨ä»¥ä¸‹å¯å‘å¼è§„åˆ™æ¥å†³å®šå¦‚ä½•å¤„ç†cookies(è¿™é‡Œçš„å‘é€è€…ä¸»æœºæŒ‡çš„æ˜¯ä½ è®¿é—®çš„å®é™…ç½‘å€):</p><ul><li>å¦‚æœâ€œDomainâ€ä¸­çš„åŸŸæˆ–å­åŸŸä¸è®¿é—®çš„ä¸»æœºä¸åŒ¹é…ï¼Œåˆ™å®Œå…¨æ‹’ç» Cookie</li><li>å¦‚æœ Domain çš„å€¼åŒ…å«åœ¨å…¬å…±åç¼€åˆ—è¡¨ä¸­ï¼Œåˆ™æ‹’ç» cookie</li><li>å¦‚æœDomain ä¸­çš„åŸŸæˆ–å­åŸŸä¸è®¿é—®åœ¨ä¸»æœºåŒ¹é…ï¼Œåˆ™æ¥å— Cookie</li></ul><p>ä¸€æ—¦æµè§ˆå™¨æ¥å—äº†cookieï¼Œå¹¶ä¸”å³å°†å‘å‡ºè¯·æ±‚ï¼Œå®ƒå°±ä¼šè¯´ï¼š</p><ul><li>å¦‚æœè¯·æ±‚ä¸»æœºä¸æˆ‘åœ¨Domainä¸­çœ‹åˆ°çš„å€¼å®Œå…¨åŒ¹é…ï¼Œåˆ™ä¼šå›ä¼  cookie</li><li>å¦‚æœè¯·æ±‚ä¸»æœºæ˜¯ä¸æˆ‘åœ¨â€œDomainâ€ä¸­çœ‹åˆ°çš„å€¼å®Œå…¨åŒ¹é…çš„å­åŸŸï¼Œåˆ™å°†å›ä¼  cookie</li><li>å¦‚æœè¯·æ±‚ä¸»æœºæ˜¯sub.example.devä¹‹ç±»çš„å­åŸŸï¼ŒåŒ…å«åœ¨example.devä¹‹ç±»çš„ Domain ä¸­ï¼Œåˆ™å°†å›ä¼  cookie</li><li>å¦‚æœè¯·æ±‚ä¸»æœºæ˜¯ä¾‹å¦‚example.devä¹‹ç±»çš„ä¸»åŸŸï¼Œè€Œ Domain æ˜¯sub.example.devä¹‹ç±»ï¼Œåˆ™ä¸ä¼šå›ä¼ cookieã€‚</li></ul><p><strong>Domain å’Œ Path å±æ€§ä¸€ç›´æ˜¯ cookie æƒé™çš„ç¬¬äºŒå±‚ã€‚</strong></p><h1 class=pgc-h-arrow-right><strong>Cookieså¯ä»¥é€šè¿‡AJAXè¯·æ±‚ä¼ é€’</strong></h1><p>Cookies å¯ä»¥é€šè¿‡AJAXè¯·æ±‚ä¼ æ’­ã€‚<strong>AJAX è¯·æ±‚</strong>æ˜¯ä½¿ç”¨ JS ï¼ˆXMLHttpRequestæˆ–Fetchï¼‰è¿›è¡Œçš„å¼‚æ­¥HTTPè¯·æ±‚ï¼Œç”¨äºè·å–æ•°æ®å¹¶å°†å…¶å‘é€å›åç«¯ã€‚</p><p>è€ƒè™‘ Flaskçš„å¦ä¸€ä¸ªç¤ºä¾‹ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ¨¡æ¿ï¼Œè¯¥æ¨¡æ¿åˆä¼šåŠ è½½ JS æ–‡ä»¶ï¼š</p><pre><code>fromÂ flaskÂ importÂ Flask,Â make_response,Â render_templateappÂ =Â Flask(__name__)@app.route("/",Â methods=["GET"])defÂ index():Â Â Â Â returnÂ render_template("index.html")@app.route("/get-cookie/",Â methods=["GET"])defÂ get_cookie():Â Â Â Â responseÂ =Â make_response("Here,Â takeÂ someÂ cookie!")Â Â Â Â response.set_cookie(key="id",Â value="3db4adj3d")Â Â Â Â returnÂ response</code></pre><p>ä»¥ä¸‹æ˜¯ templates/index.html æ¨¡æ¿ï¼š</p><pre><code>&lt;!DOCTYPEÂ html&gt;&lt;htmlÂ lang="en"&gt;&lt;head&gt;Â Â Â Â &lt;metaÂ charset="UTF-8"&gt;Â Â Â Â &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;button&gt;FETCH&lt;/button&gt;&lt;/body&gt;&lt;scriptÂ src="{{Â url_for('static',Â filename='index.js')Â }}"&gt;&lt;/script&gt;&lt;/html&gt;</code></pre><p>ä¸‹é¢æ˜¯ static/index.js çš„å†…å®¹ï¼š</p><pre><code>constÂ buttonÂ =Â document.getElementsByTagName("button")[0];button.addEventListener("click",Â function()Â {Â Â getACookie();});functionÂ getACookie()Â {Â Â fetch("/get-cookie/")Â Â Â Â .then(responseÂ =&gt;Â {Â Â Â Â Â Â //Â makeÂ sureÂ toÂ checkÂ response.okÂ inÂ theÂ realÂ world!Â Â Â Â Â Â returnÂ response.text();Â Â Â Â })Â Â Â Â .then(textÂ =&gt;Â console.log(text));}</code></pre><p>å½“è®¿é—®http://127.0.0.1:5000/æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ä¸ªæŒ‰é’®ã€‚é€šè¿‡å•å‡»æŒ‰é’®ï¼Œæˆ‘ä»¬å‘/get-cookie/å‘å‡ºè·å–è¯·æ±‚å¹¶è·å–Cookieã€‚æ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œcookie è½åœ¨æµè§ˆå™¨çš„ Cookie storageä¸­ã€‚</p><p>å¯¹ Flask åº”ç”¨ç¨‹åºè¿›è¡Œä¸€äº›æ›´æ”¹ï¼Œå¤šåŠ ä¸€ä¸ªè·¯ç”±ï¼š</p><pre><code>fromÂ flaskÂ importÂ Flask,Â make_response,Â request,Â render_template,Â jsonifyappÂ =Â Flask(__name__)@app.route("/",Â methods=["GET"])defÂ index():Â Â Â Â returnÂ render_template("index.html")@app.route("/get-cookie/",Â methods=["GET"])defÂ get_cookie():Â Â Â Â responseÂ =Â make_response("Here,Â takeÂ someÂ cookie!")Â Â Â Â response.set_cookie(key="id",Â value="3db4adj3d")Â Â Â Â returnÂ response@app.route("/api/cities/",Â methods=["GET"])defÂ cities():Â Â Â Â ifÂ request.cookies["id"]Â ==Â "3db4adj3d":Â Â Â Â Â Â Â Â citiesÂ =Â [{"name":Â "Rome",Â "id":Â 1},Â {"name":Â "Siena",Â "id":Â 2}]Â Â Â Â Â Â Â Â returnÂ jsonify(cities)Â Â Â Â returnÂ jsonify(msg="Ops!")</code></pre><p>å¦å¤–ï¼Œè°ƒæ•´ä¸€ä¸‹ JS ä»£ç ï¼Œç”¨äºä¸‹è¯·æ±‚åˆšæ–°å¢çš„è·¯ç”±ï¼š</p><pre><code>constÂ buttonÂ =Â document.getElementsByTagName("button")[0];button.addEventListener("click",Â function()Â {Â Â getACookie().then(()Â =&gt;Â getData());});functionÂ getACookie()Â {Â Â returnÂ fetch("/get-cookie/").then(responseÂ =&gt;Â {Â Â Â Â //Â makeÂ sureÂ toÂ checkÂ response.okÂ inÂ theÂ realÂ world!Â Â Â Â returnÂ Promise.resolve("AllÂ good,Â fetchÂ theÂ data");Â Â });}functionÂ getData()Â {Â Â fetch("/api/cities/")Â Â Â Â .then(responseÂ =&gt;Â {Â Â Â Â Â Â //Â makeÂ sureÂ toÂ checkÂ response.okÂ inÂ theÂ realÂ world!Â Â Â Â Â Â returnÂ response.json();Â Â Â Â })Â Â Â Â .then(jsonÂ =&gt;Â console.log(json));</code></pre><p>å½“è®¿é—®http://127.0.0.1:5000/æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ä¸ªæŒ‰é’®ã€‚é€šè¿‡å•å‡»æŒ‰é’®ï¼Œæˆ‘ä»¬å‘/get-cookie/å‘å‡ºè·å–è¯·æ±‚ä»¥è·å–Cookieã€‚Cookieå‡ºç°åï¼Œæˆ‘ä»¬å°±ä¼šå¯¹/api/cities/å†æ¬¡å‘å‡ºFetchè¯·æ±‚ã€‚</p><p>åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è¯·æ±‚å›æ¥ çš„æ•°æ®ã€‚å¦å¤–ï¼Œåœ¨å¼€å‘è€…å·¥å…·çš„Networké€‰é¡¹å¡ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªåä¸ºCookieçš„å¤´ï¼Œè¿™æ˜¯é€šè¿‡AJAXè¯·æ±‚ä¼ ç»™åç«¯ã€‚</p><p>åªè¦å‰ç«¯ä¸åç«¯åœ¨åŒä¸€ä¸Šä¸‹æ–‡ä¸­ï¼Œåœ¨å‰ç«¯å’Œåç«¯ä¹‹é—´æ¥å›äº¤æ¢cookieå°±å¯ä»¥æ­£å¸¸å·¥ä½œï¼šæˆ‘ä»¬è¯´å®ƒä»¬æ¥è‡ªåŒæºã€‚</p><p>è¿™æ˜¯å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼ŒFetch ä»…åœ¨è¯·æ±‚åˆ°è¾¾è§¦å‘è¯·æ±‚çš„æ¥æºæ—¶æ‰å‘é€å‡­æ®ï¼Œå³ Cookieã€‚</p><h1 class=pgc-h-arrow-right><strong>cookie ä¸èƒ½æ€»æ˜¯é€šè¿‡AJAXè¯·æ±‚ä¼ é€’</strong></h1><p>è€ƒè™‘å¦ä¸€ç§æƒ…å†µï¼Œåœ¨åç«¯ç‹¬ç«‹è¿è¡Œï¼Œå¯ä»¥è¿™æ ·å¯åŠ¨åº”ç”¨ç¨‹åº:</p><pre><code>FLASK_ENV=developmentÂ FLASK_APP=flask_app.pyÂ flaskÂ run</code></pre><p>ç°åœ¨ï¼Œåœ¨ Flask åº”ç”¨ç¨‹åºä¹‹å¤–çš„å…¶ä»–æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»ºindex.htmlï¼š</p><pre><code>&lt;!DOCTYPEÂ html&gt;&lt;htmlÂ lang="en"&gt;&lt;head&gt;Â Â Â Â &lt;metaÂ charset="UTF-8"&gt;Â Â Â Â &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;button&gt;FETCH&lt;/button&gt;&lt;/body&gt;&lt;scriptÂ src="index.js"&gt;&lt;/script&gt;&lt;/html&gt;</code></pre><p>ä½¿ç”¨ä»¥ä¸‹ä»£ç åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºindex.jsçš„ JS æ–‡ä»¶ï¼š</p><pre><code>button.addEventListener("click",Â function()Â {Â Â getACookie().then(()Â =&gt;Â getData());});functionÂ getACookie()Â {Â Â returnÂ fetch("http://localhost:5000/get-cookie/").then(responseÂ =&gt;Â {Â Â Â Â //Â makeÂ sureÂ toÂ checkÂ response.okÂ inÂ theÂ realÂ world!Â Â Â Â returnÂ Promise.resolve("AllÂ good,Â fetchÂ theÂ data");Â Â });}functionÂ getData()Â {Â Â fetch("http://localhost:5000/api/cities/")Â Â Â Â .then(responseÂ =&gt;Â {Â Â Â Â Â Â //Â makeÂ sureÂ toÂ checkÂ response.okÂ inÂ theÂ realÂ world!Â Â Â Â Â Â returnÂ response.json();Â Â Â Â })Â Â Â Â .then(jsonÂ =&gt;Â console.log(json));}</code></pre><p>åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸­ï¼Œä»ç»ˆç«¯è¿è¡Œï¼š</p><pre><code>npxÂ serve</code></pre><p>æ­¤å‘½ä»¤ä¸ºæ‚¨æä¾›äº†è¦è¿æ¥çš„æœ¬åœ°åœ°å€/ç«¯å£ï¼Œä¾‹å¦‚http://localhost:42091/ã€‚è®¿é—®é¡µé¢å¹¶å°è¯•åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰“å¼€çš„æƒ…å†µä¸‹å•å‡»æŒ‰é’®ã€‚åœ¨æ§åˆ¶å°ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p><pre><code>Cross-OriginÂ RequestÂ Blocked:Â TheÂ SameÂ OriginÂ PolicyÂ disallowsÂ readingÂ theÂ remoteÂ resourceÂ atÂ http://localhost:5000/get-cookie/.Â (Reason:Â CORSÂ headerÂ â€˜Access-Control-Allow-Originâ€™Â missing)</code></pre><p>å› ä¸º http://localhost:5000/ ä¸http://localhost:42091/.ä¸åŒã€‚å®ƒä»¬æ˜¯ä¸åŒçš„åŸŸï¼Œå› æ­¤ä¼š CORS çš„é™åˆ¶ã€‚</p><h1 class=pgc-h-arrow-right><strong>å¤„ç† CORS</strong></h1><p>CORS æ˜¯ä¸€ä¸ª W3C æ ‡å‡†ï¼Œå…¨ç§°æ˜¯â€œè·¨åŸŸèµ„æºå…±äº«â€ï¼ˆCross-origin resource sharingï¼‰ã€‚å®ƒå…è®¸æµè§ˆå™¨å‘è·¨åŸŸçš„æœåŠ¡å™¨ï¼Œå‘å‡ºXMLHttpRequestè¯·æ±‚ï¼Œä»è€Œå…‹æœäº† AJAX åªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚</p><p>æ•´ä¸ª CORS é€šä¿¡è¿‡ç¨‹ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦ç”¨æˆ·å‚ä¸ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼ŒCORS é€šä¿¡ä¸æ™®é€šçš„ AJAX é€šä¿¡æ²¡æœ‰å·®åˆ«ï¼Œä»£ç å®Œå…¨ä¸€æ ·ã€‚æµè§ˆå™¨ä¸€æ—¦å‘ç° AJAX è¯·æ±‚è·¨åŸŸï¼Œå°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€äº›é™„åŠ çš„å¤´ä¿¡æ¯ï¼Œæœ‰æ—¶è¿˜ä¼šå¤šå‡ºä¸€æ¬¡é™„åŠ çš„è¯·æ±‚ï¼Œä½†ç”¨æˆ·ä¸ä¼šæœ‰æ„ŸçŸ¥ã€‚å› æ­¤ï¼Œå®ç° CORS é€šä¿¡çš„å…³é”®æ˜¯æœåŠ¡å™¨ã€‚åªè¦æœåŠ¡å™¨å®ç°äº† CORS æ¥å£ï¼Œå°±å¯ä»¥è·¨åŸŸé€šä¿¡ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé™¤éæœåŠ¡å™¨è®¾ç½®äº†Access-Control-Allow-Originçš„ç‰¹å®šHTTPæ ‡å¤´ï¼Œå¦åˆ™æµè§ˆå™¨å°†é˜»æ­¢AJAXå¯¹éç›¸åŒæ¥æºçš„è¿œç¨‹èµ„æºçš„è¯·æ±‚ã€‚</p><p>è¦è§£å†³æ­¤ç¬¬ä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºFlaské…ç½®CORSï¼š</p><pre><code>pipÂ installÂ flask-cors</code></pre><p>ç„¶åå°† CORS åº”ç”¨äº Flaskï¼š</p><pre><code>fromÂ flaskÂ importÂ Flask,Â make_response,Â request,Â render_template,Â jsonifyfromÂ flask_corsÂ importÂ CORSappÂ =Â Flask(__name__)CORS(app=app)@app.route("/",Â methods=["GET"])defÂ index():Â Â Â Â returnÂ render_template("index.html")@app.route("/get-cookie/",Â methods=["GET"])defÂ get_cookie():Â Â Â Â responseÂ =Â make_response("Here,Â takeÂ someÂ cookie!")Â Â Â Â response.set_cookie(key="id",Â value="3db4adj3d")Â Â Â Â returnÂ response@app.route("/api/cities/",Â methods=["GET"])defÂ cities():Â Â Â Â ifÂ request.cookies["id"]Â ==Â "3db4adj3d":Â Â Â Â Â Â Â Â citiesÂ =Â [{"name":Â "Rome",Â "id":Â 1},Â {"name":Â "Siena",Â "id":Â 2}]Â Â Â Â Â Â Â Â returnÂ jsonify(cities)Â Â Â Â returnÂ jsonify(msg="Ops!")</code></pre><p>ç°åœ¨å°è¯•åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰“å¼€çš„æƒ…å†µä¸‹å†æ¬¡å•å‡»æŒ‰é’®ã€‚åœ¨æ§åˆ¶å°ä¸­ä½ åº”è¯¥çœ‹åˆ°</p><pre><code>Cross-OriginÂ RequestÂ Blocked:Â TheÂ SameÂ OriginÂ PolicyÂ disallowsÂ readingÂ theÂ remoteÂ resourceÂ atÂ http://localhost:5000/api/cities/.Â (Reason:Â CORSÂ headerÂ â€˜Access-Control-Allow-Originâ€™Â missing)</code></pre><p>å°½ç®¡æˆ‘ä»¬çŠ¯äº†åŒæ ·çš„é”™è¯¯ï¼Œä½†è¿™æ¬¡çš„ç½ªé­ç¥¸é¦–æ˜¯ç¬¬äºŒä¸ªè·¯ç”±ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡æŸ¥çœ‹ â€œNetworkâ€ æ ‡ç­¾ä¸­çš„è¯·æ±‚æ¥ç¡®è®¤,æ²¡æœ‰å‘é€æ­¤ç±»Cookieï¼š</p><div class=pgc-img><img alt="ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å—" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9b32b26734f34c2490259a7785b8d6c4><p class=pgc-img-caption></p></div><p>ä¸ºäº†åœ¨ä¸åŒæ¥æºçš„Fetchè¯·æ±‚ä¸­åŒ…å«cookieï¼Œæˆ‘ä»¬å¿…é¡»æcredentials æ ‡å¿—ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯ç›¸åŒæ¥æºï¼‰ã€‚</p><p>å¦‚æœæ²¡æœ‰è¿™ä¸ªæ ‡å¿—ï¼ŒFetch å°±ä¼šå¿½ç•¥ cookieï¼Œå¯ä»¥è¿™æ ·ä¿®å¤ï¼š</p><pre><code>constÂ buttonÂ =Â document.getElementsByTagName("button")[0];button.addEventListener("click",Â function()Â {Â Â getACookie().then(()Â =&gt;Â getData());});functionÂ getACookie()Â {Â Â returnÂ fetch("http://localhost:5000/get-cookie/",Â {Â Â Â Â credentials:Â "include"Â Â }).then(responseÂ =&gt;Â {Â Â Â Â //Â makeÂ sureÂ toÂ checkÂ response.okÂ inÂ theÂ realÂ world!Â Â Â Â returnÂ Promise.resolve("AllÂ good,Â fetchÂ theÂ data");Â Â });}functionÂ getData()Â {Â Â fetch("http://localhost:5000/api/cities/",Â {Â Â Â Â credentials:Â "include"Â Â })Â Â Â Â .then(responseÂ =&gt;Â {Â Â Â Â Â Â //Â makeÂ sureÂ toÂ checkÂ response.okÂ inÂ theÂ realÂ world!Â Â Â Â Â Â returnÂ response.json();Â Â Â Â })Â Â Â Â .then(jsonÂ =&gt;Â console.log(json));}</code></pre><p>credentials: "include" å¿…é¡»åœ¨ç¬¬ä¸€ä¸ª Fetch è¯·æ±‚ä¸­å‡ºç°ï¼Œæ‰èƒ½å°†Cookieä¿å­˜åœ¨æµè§ˆå™¨çš„Cookie storage ä¸­ï¼š</p><pre><code>fetch("http://localhost:5000/get-cookie/",Â {Â Â Â Â credentials:Â "include"Â Â })</code></pre><p>å®ƒè¿˜å¿…é¡»åœ¨ç¬¬äºŒä¸ªè¯·æ±‚æ—¶å‡ºç°ï¼Œä»¥å…è®¸å°†cookieä¼ è¾“å›åç«¯</p><pre><code>Â Â fetch("http://localhost:5000/api/cities/",Â {Â Â Â Â credentials:Â "include"Â Â })</code></pre><p>å†è¯•ä¸€æ¬¡ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨åç«¯ä¿®å¤å¦ä¸€ä¸ªé”™è¯¯ï¼š</p><pre><code>Cross-OriginÂ RequestÂ Blocked:Â TheÂ SameÂ OriginÂ PolicyÂ disallowsÂ readingÂ theÂ remoteÂ resourceÂ atÂ http://localhost:5000/get-cookie/.Â (Reason:Â expectedÂ â€˜trueâ€™Â inÂ CORSÂ headerÂ â€˜Access-Control-Allow-Credentialsâ€™).</code></pre><p>ä¸ºäº†å…è®¸åœ¨CORSè¯·æ±‚ä¸­ä¼ è¾“cookieï¼Œåç«¯è¿˜éœ€è¦è®¾ç½® Access-Control-Allow-Credentialsæ ‡å¤´ã€‚</p><pre><code>CORS(app=app,Â supports_credentials=True)</code></pre><p>è¦ç‚¹ï¼šä¸ºäº†ä½¿Cookieåœ¨ä¸åŒæ¥æºä¹‹é—´é€šè¿‡AJAXè¯·æ±‚ä¼ é€’ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><ul><li>credentials: "include" ç”¨äºå‰ç«¯çš„ fetch è¯·æ±‚ä¸­</li><li>Access-Control-Allow-Credentials å’Œ Access-Control-Allow-Origin ç”¨äºåç«¯</li></ul><p>cookieå¯ä»¥é€šè¿‡AJAXè¯·æ±‚ä¼ é€’ï¼Œä½†æ˜¯å®ƒä»¬å¿…é¡»éµå®ˆæˆ‘ä»¬å‰é¢æè¿°çš„åŸŸè§„åˆ™ã€‚</p><h1 class=pgc-h-arrow-right><strong>Cookie çš„ Secure å±æ€§</strong></h1><p>Secure å±æ€§æ˜¯è¯´å¦‚æœä¸€ä¸ª cookie è¢«è®¾ç½®äº†Secure=trueï¼Œé‚£ä¹ˆè¿™ä¸ªcookieåªèƒ½ç”¨httpsåè®®å‘é€ç»™æœåŠ¡å™¨ï¼Œç”¨ http åè®®æ˜¯ä¸å‘é€çš„ã€‚æ¢å¥è¯è¯´ï¼Œcookie æ˜¯åœ¨httpsçš„æƒ…å†µä¸‹åˆ›å»ºçš„ï¼Œè€Œä¸”ä»–çš„Secure=trueï¼Œé‚£ä¹ˆä¹‹åä½ ä¸€ç›´ç”¨httpsè®¿é—®å…¶ä»–çš„é¡µé¢ï¼ˆæ¯”å¦‚ç™»å½•ä¹‹åç‚¹å‡»å…¶ä»–å­é¡µé¢ï¼‰ï¼Œcookieä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ï¼Œä½ æ— éœ€é‡æ–°ç™»å½•å°±å¯ä»¥è·³è½¬åˆ°å…¶ä»–é¡µé¢ã€‚ä½†æ˜¯å¦‚æœè¿™æ—¶ä½ æŠŠurlæ”¹æˆhttpåè®®è®¿é—®å…¶ä»–é¡µé¢ï¼Œä½ å°±éœ€è¦é‡æ–°ç™»å½•äº†ï¼Œå› ä¸ºè¿™ä¸ªcookieä¸èƒ½åœ¨httpåè®®ä¸­å‘é€ã€‚</p><p>å¯ä»¥è¿™æ ·è®¾ç½® Secure å±æ€§</p><pre><code>response.set_cookie(key="id",Â value="3db4adj3d",Â secure=True)</code></pre><p>å¦‚æœè¦åœ¨çœŸå®ç¯å¢ƒä¸­å°è¯•ï¼Œè¯·å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¹¶æ³¨æ„curlåœ¨æ­¤å¤„æ˜¯ä¸é€šè¿‡HTTPä¿å­˜cookieï¼š</p><pre><code>curlÂ -IÂ http://serene-bastion-01422.herokuapp.com/get-secure-cookie/Â --cookie-jarÂ -</code></pre><p>ç›¸åï¼Œé€šè¿‡HTTPSï¼Œcookie å‡ºç°åœ¨cookie jarä¸­ï¼š</p><pre><code>curlÂ -IÂ https://serene-bastion-01422.herokuapp.com/get-secure-cookie/Â --cookie-jarÂ -</code></pre><p>cookie jar æ–‡ä»¶ï¼š</p><pre><code>serene-bastion-01422.herokuapp.comÂ Â Â Â Â Â FALSEÂ Â Â /Â Â Â Â Â Â Â TRUEÂ Â Â Â 0</code></pre><p>ä¸è¦è¢«Secureæ¬ºéª—ï¼šæµè§ˆå™¨é€šè¿‡HTTPSæ¥å—cookieï¼Œä½†æ˜¯ä¸€æ—¦cookieè¿›å…¥æµè§ˆå™¨ï¼Œå°±æ²¡æœ‰ä»»ä½•ä¿æŠ¤ã€‚</p><p>å› ä¸ºå¸¦æœ‰ Secure çš„ Cookie ä¸€èˆ¬ä¹Ÿä¸ç”¨äºä¼ è¾“æ•æ„Ÿæ•°æ®.</p><h1 class=pgc-h-arrow-right><strong>Cookie çš„ HttpOnly å±æ€§</strong></h1><p>å¦‚æœcookieä¸­è®¾ç½®äº†HttpOnlyå±æ€§ï¼Œé‚£ä¹ˆé€šè¿‡jsè„šæœ¬å°†æ— æ³•è¯»å–åˆ°cookieä¿¡æ¯ï¼Œè¿™æ ·èƒ½æœ‰æ•ˆçš„é˜²æ­¢XSSæ”»å‡»ï¼Œçªƒå–cookieå†…å®¹ï¼Œè¿™æ ·å°±å¢åŠ äº†cookieçš„å®‰å…¨æ€§ï¼Œå³ä¾¿æ˜¯è¿™æ ·ï¼Œä¹Ÿä¸è¦å°†é‡è¦ä¿¡æ¯å­˜å…¥cookieã€‚</p><blockquote><p>XSS å…¨ç§°Cross SiteScriptï¼Œè·¨ç«™è„šæœ¬æ”»å‡»ï¼Œæ˜¯Webç¨‹åºä¸­å¸¸è§çš„æ¼æ´ï¼ŒXSSå±äºè¢«åŠ¨å¼ä¸”ç”¨äºå®¢æˆ·ç«¯çš„æ”»å‡»æ–¹å¼ï¼Œæ‰€ä»¥å®¹æ˜“è¢«å¿½ç•¥å…¶å±å®³æ€§ã€‚å…¶åŸç†æ˜¯æ”»å‡»è€…å‘æœ‰XSSæ¼æ´çš„ç½‘ç«™ä¸­è¾“å…¥(ä¼ å…¥)æ¶æ„çš„HTMLä»£ç ï¼Œå½“å…¶å®ƒç”¨æˆ·æµè§ˆè¯¥ç½‘ç«™æ—¶ï¼Œè¿™æ®µHTMLä»£ç ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ”»å‡»çš„ç›®çš„ã€‚å¦‚ï¼Œç›—å–ç”¨æˆ·Cookieã€ç ´åé¡µé¢ç»“æ„ã€é‡å®šå‘åˆ°å…¶å®ƒç½‘ç«™ç­‰ã€‚</p></blockquote><p>å¦‚æœæœ‰è®¾ç½® HttpOnly çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><pre><code>Set-Cookie:Â "id=3db4adj3d;Â HttpOnly"</code></pre><p>åœ¨ Flask ä¸­</p><pre><code>response.set_cookie(key="id",Â value="3db4adj3d",Â httponly=True)</code></pre><p>è¿™æ ·ï¼Œcookie è®¾ç½®äº†HttpOnlyå±æ€§ï¼Œé‚£ä¹ˆé€šè¿‡jsè„šæœ¬å°†æ— æ³•è¯»å–åˆ°cookieä¿¡æ¯ã€‚å¦‚æœåœ¨æ§åˆ¶å°ä¸­è¿›è¡Œæ£€æŸ¥ï¼Œåˆ™document.cookieå°†è¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚</p><p>ä½•æ—¶ä½¿ç”¨HttpOnlyï¼Ÿcookie åº”è¯¥å§‹ç»ˆæ˜¯HttpOnlyçš„ï¼Œé™¤éæœ‰ç‰¹å®šçš„è¦æ±‚å°†å®ƒä»¬æš´éœ²ç»™è¿è¡Œæ—¶ JSã€‚</p><h1 class=pgc-h-arrow-right><strong>å¯æ€•çš„ SameSite å±æ€§</strong></h1><h1 class=pgc-h-arrow-right><strong>first-party cookie å’Œ third-party cookie</strong></h1><p>æŸ¥çœ‹https://serene-bastion-01422.herokuapp.com/get-cookie/ ä¸­æ‰€æºå¸¦çš„ Cookie</p><pre><code>Set-Cookie:Â simplecookiename=c00l-c00k13;Â Path=/</code></pre><p>first-partyæ˜¯æŒ‡ä½ ç™»å½•æˆ–ä½¿ç”¨çš„ç½‘ç«™æ‰€å‘è¡Œçš„ cookieï¼Œè€Œthird-party cookie å¸¸ä¸ºä¸€äº›å¹¿å‘Šç½‘ç«™ï¼Œæœ‰ä¾µçŠ¯éšç§ä»¥åŠå®‰å…¨éšæ‚£ã€‚</p><p>æˆ‘ä»¬å°†è¿™ç±» Cookie ç§°ä¸º first-partyã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘åœ¨æµè§ˆå™¨ä¸­è®¿é—®è¯¥URLï¼Œå¹¶ä¸”å¦‚æœæˆ‘è®¿é—®ç›¸åŒçš„URLæˆ–è¯¥ç«™ç‚¹çš„å¦ä¸€ä¸ªè·¯å¾„ï¼ˆå‡è®¾Pathä¸º/ï¼‰ï¼Œåˆ™æµè§ˆå™¨ä¼šå°†cookieå‘é€å›è¯¥ç½‘ç«™ã€‚</p><p>ç°åœ¨è€ƒè™‘åœ¨https://serene-bastion-01422.herokuapp.com/get-frog/ä¸Šçš„å¦ä¸€ä¸ªç½‘é¡µã€‚è¯¥é¡µé¢è®¾ç½®äº†ä¸€ä¸ªcookieï¼Œæ­¤å¤–ï¼Œå®ƒè¿˜ä»https://www.valentinog.com/cookie-frog.jpgæ‰˜ç®¡çš„è¿œç¨‹èµ„æºä¸­åŠ è½½å›¾åƒã€‚</p><p>è¯¥è¿œç¨‹èµ„æºåˆä¼šè‡ªè¡Œè®¾ç½®ä¸€ä¸ªcookie:</p><div class=pgc-img><img alt="ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å—" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1b74edbd458949768cb0dcbf91765f8c><p class=pgc-img-caption></p></div><p>æˆ‘ä»¬å°†è¿™ç§ cookie ç§°ä¸ºthird-party(ç¬¬ä¸‰æ–¹) Cookieã€‚</p><p><strong>ç¬¬ä¸‰æ–¹ Cookie</strong> é™¤äº†ç”¨äº CSRF æ”»å‡»ï¼Œè¿˜å¯ä»¥ç”¨äºç”¨æˆ·è¿½è¸ªã€‚æ¯”å¦‚ï¼ŒFacebook åœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™æ’å…¥ä¸€å¼ çœ‹ä¸è§çš„å›¾ç‰‡ã€‚</p><pre><code>&lt;imgÂ src="facebook.com"Â style="visibility:hidden;"&gt;</code></pre><p>æµè§ˆå™¨åŠ è½½ä¸Šé¢ä»£ç æ—¶ï¼Œå°±ä¼šå‘ Facebook å‘å‡ºå¸¦æœ‰ Cookie çš„è¯·æ±‚ï¼Œä»è€Œ Facebook å°±ä¼šçŸ¥é“ä½ æ˜¯è°ï¼Œè®¿é—®äº†ä»€ä¹ˆç½‘ç«™ã€‚</p><h1 class=pgc-h-arrow-right><strong>ä½¿ç”¨ SameSite å±æ€§</strong></h1><p>Cookie çš„SameSite å±æ€§ç”¨æ¥é™åˆ¶third-party Cookieï¼Œä»è€Œå‡å°‘å®‰å…¨é£é™©ã€‚å®ƒå¯ä»¥è®¾ç½®ä¸‰ä¸ªå€¼ã€‚</p><ul><li>Strict</li><li>Lax</li><li>None</li></ul><p>Strictæœ€ä¸ºä¸¥æ ¼ï¼Œå®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹ Cookieï¼Œè·¨ç«™ç‚¹æ—¶ï¼Œä»»ä½•æƒ…å†µä¸‹éƒ½ä¸ä¼šå‘é€ Cookieã€‚æ¢è¨€ä¹‹ï¼Œåªæœ‰å½“å‰ç½‘é¡µçš„ URL ä¸è¯·æ±‚ç›®æ ‡ä¸€è‡´ï¼Œæ‰ä¼šå¸¦ä¸Š Cookieã€‚</p><pre><code>Set-Cookie:Â CookieName=CookieValue;Â SameSite=Strict;</code></pre><p>è¿™ä¸ªè§„åˆ™è¿‡äºä¸¥æ ¼ï¼Œå¯èƒ½é€ æˆéå¸¸ä¸å¥½çš„ç”¨æˆ·ä½“éªŒã€‚æ¯”å¦‚ï¼Œå½“å‰ç½‘é¡µæœ‰ä¸€ä¸ª GitHub é“¾æ¥ï¼Œç”¨æˆ·ç‚¹å‡»è·³è½¬å°±ä¸ä¼šå¸¦æœ‰ GitHub çš„ Cookieï¼Œè·³è½¬è¿‡å»æ€»æ˜¯æœªç™»é™†çŠ¶æ€ã€‚</p><p>Laxè§„åˆ™ç¨ç¨æ”¾å®½ï¼Œå¤§å¤šæ•°æƒ…å†µä¹Ÿæ˜¯ä¸å‘é€ç¬¬ä¸‰æ–¹ Cookieï¼Œä½†æ˜¯å¯¼èˆªåˆ°ç›®æ ‡ç½‘å€çš„ Get è¯·æ±‚é™¤å¤–ã€‚</p><pre><code>Set-Cookie:Â CookieName=CookieValue;Â SameSite=Lax;</code></pre><p>å¯¼èˆªåˆ°ç›®æ ‡ç½‘å€çš„ GET è¯·æ±‚ï¼ŒåªåŒ…æ‹¬ä¸‰ç§æƒ…å†µï¼šé“¾æ¥ï¼Œé¢„åŠ è½½è¯·æ±‚ï¼ŒGET è¡¨å•ã€‚è¯¦è§ä¸‹è¡¨ã€‚</p><div class=pgc-img><img alt="ã€Œå¿…éœ€çŸ¥é“ã€å®ç”¨ï¼Œå®Œæ•´çš„HTTP cookieæŒ‡å—" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f8c4f74cd6444e6f9bf8b6f044e6d646><p class=pgc-img-caption></p></div><p>è®¾ç½®äº†Strictæˆ–Laxä»¥åï¼ŒåŸºæœ¬å°±æœç»äº† CSRF æ”»å‡»ã€‚å½“ç„¶ï¼Œå‰ææ˜¯ç”¨æˆ·æµè§ˆå™¨æ”¯æŒ SameSite å±æ€§ã€‚</p><p>Chrome è®¡åˆ’å°†Laxå˜ä¸ºé»˜è®¤è®¾ç½®ã€‚è¿™æ—¶ï¼Œç½‘ç«™å¯ä»¥é€‰æ‹©æ˜¾å¼å…³é—­SameSiteå±æ€§ï¼Œå°†å…¶è®¾ä¸ºNoneã€‚ä¸è¿‡ï¼Œå‰ææ˜¯å¿…é¡»åŒæ—¶è®¾ç½®Secureå±æ€§ï¼ˆCookie åªèƒ½é€šè¿‡ HTTPS åè®®å‘é€ï¼‰ï¼Œå¦åˆ™æ— æ•ˆã€‚</p><p>ä¸‹é¢çš„è®¾ç½®æ— æ•ˆã€‚</p><pre><code>Set-Cookie:Â widget_session=abc123;Â SameSite=None</code></pre><p>ä¸‹é¢çš„è®¾ç½®æœ‰æ•ˆã€‚</p><pre><code>Set-Cookie:Â widget_session=abc123;Â SameSite=None;Â Secure</code></pre><h1 class=pgc-h-arrow-right><strong>Cookies å’Œ è®¤è¯</strong></h1><p>èº«ä»½éªŒè¯æ˜¯ web å¼€å‘ä¸­æœ€å…·æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ä¹‹ä¸€ã€‚å…³äºè¿™ä¸ªä¸»é¢˜ä¼¼ä¹æœ‰å¾ˆå¤šå›°æƒ‘ï¼Œå› ä¸ºJWTä¸­çš„åŸºäºä»¤ç‰Œçš„èº«ä»½éªŒè¯ä¼¼ä¹è¦å–ä»£â€œæ—§çš„â€ã€å¯é çš„æ¨¡å¼ï¼Œå¦‚åŸºäºä¼šè¯çš„èº«ä»½éªŒè¯ã€‚</p><p>æ¥çœ‹çœ‹ cookie åœ¨è¿™é‡Œæ‰®æ¼”ä»€ä¹ˆè§’è‰²ã€‚</p><h1 class=pgc-h-arrow-right><strong>åŸºäºä¼šè¯çš„èº«ä»½éªŒè¯</strong></h1><p>èº«ä»½éªŒè¯æ˜¯ cookie æœ€å¸¸è§çš„ç”¨ä¾‹ä¹‹ä¸€ã€‚</p><p>å½“ä½ è®¿é—®ä¸€ä¸ªè¯·æ±‚èº«ä»½éªŒè¯çš„ç½‘ç«™æ—¶ï¼Œåç«¯å°†é€šè¿‡<strong>å‡­æ®</strong>æäº¤ï¼ˆä¾‹å¦‚é€šè¿‡è¡¨å•ï¼‰åœ¨åå°å‘é€ä¸€ä¸ªSet-Cookieæ ‡å¤´åˆ°å‰ç«¯ã€‚</p><p>å‹çš„ä¼šè¯ cookie å¦‚ä¸‹æ‰€ç¤º:</p><pre><code>Set-Cookie:Â sessionid=sty1z3kz11mpqxjv648mqwlx4ginpt6c;Â expires=Tue,Â 09Â JunÂ 2020Â 15:46:52Â GMT;Â HttpOnly;Â Max-Age=1209600;Â Path=/;Â SameSite=Lax</code></pre><p>è¿™ä¸ªSet-Cookieå¤´ä¸­ï¼ŒæœåŠ¡å™¨å¯ä»¥åŒ…æ‹¬ä¸€ä¸ªåä¸ºsessionã€session idæˆ–ç±»ä¼¼çš„cookieã€‚</p><p>è¿™æ˜¯æµè§ˆå™¨å¯ä»¥æ¸…æ¥šçœ‹åˆ°çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚æ¯å½“é€šè¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·å‘åç«¯è¯·æ±‚æ–°é¡µé¢æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šå‘å›ä¼šè¯cookieã€‚</p><p>åŸºäºä¼šè¯çš„èº«ä»½éªŒè¯æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå› ä¸ºåç«¯å¿…é¡»è·Ÿè¸ªæ¯ä¸ªç”¨æˆ·çš„ä¼šè¯ã€‚è¿™äº›ä¼šè¯çš„å­˜å‚¨å¯èƒ½æ˜¯ï¼š</p><ul><li>æ•°æ®åº“</li><li>åƒ Redis è¿™æ ·çš„é”®/å€¼å­˜å‚¨</li><li>æ–‡ä»¶ç³»ç»Ÿ</li></ul><p>åœ¨è¿™ä¸‰ä¸ªä¼šè¯å­˜å‚¨ä¸­ï¼ŒRedis ä¹‹ç±»åº”ä¼˜å…ˆäºæ•°æ®åº“æˆ–æ–‡ä»¶ç³»ç»Ÿã€‚</p><p>è¯·æ³¨æ„ï¼ŒåŸºäºä¼šè¯çš„èº«ä»½éªŒè¯ä¸æµè§ˆå™¨çš„ä¼šè¯å­˜å‚¨æ— å…³ã€‚</p><p>ä¹‹æ‰€ä»¥ç§°ä¸º<strong>åŸºäºä¼šè¯</strong>çš„ä¼šè¯ï¼Œæ˜¯å› ä¸ºç”¨äºç”¨æˆ·è¯†åˆ«çš„ç›¸å…³æ•°æ®å­˜åœ¨äºåç«¯çš„ä¼šè¯å­˜å‚¨ä¸­ï¼Œè¿™ä¸æµè§ˆå™¨çš„ä¼šè¯å­˜å‚¨ä¸åŒã€‚</p><h1 class=pgc-h-arrow-right><strong>ä½•æ—¶ä½¿ç”¨åŸºäºä¼šè¯çš„èº«ä»½éªŒè¯</strong></h1><p>åªè¦èƒ½ä½¿ç”¨å°±ä½¿ç”¨å®ƒã€‚åŸºäºä¼šè¯çš„èº«ä»½éªŒè¯æ˜¯ä¸€ç§æœ€ç®€å•ã€å®‰å…¨ã€ç›´æ¥çš„ç½‘ç«™èº«ä»½éªŒè¯å½¢å¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå¯ä»¥åœ¨Djangoç­‰æ‰€æœ‰æµè¡Œçš„webæ¡†æ¶ä¸Šä½¿ç”¨ã€‚</p><p>ä½†æ˜¯ï¼Œå®ƒçš„çŠ¶æ€ç‰¹æ€§ä¹Ÿæ˜¯å®ƒçš„ä¸»è¦ç¼ºç‚¹ï¼Œç‰¹åˆ«æ˜¯å½“ç½‘ç«™æ˜¯ç”±è´Ÿè½½å‡è¡¡å™¨æä¾›æœåŠ¡æ—¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåƒç²˜è´´ä¼šè¯ï¼Œæˆ–è€…åœ¨é›†ä¸­çš„Rediså­˜å‚¨ä¸Šå­˜å‚¨ä¼šè¯è¿™æ ·çš„æŠ€æœ¯ä¼šæœ‰æ‰€å¸®åŠ©ã€‚</p><h1 class=pgc-h-arrow-right><strong>å…³äº JWT çš„è¯´æ˜</strong></h1><p><strong>JWT</strong>æ˜¯ JSON Web Tokensçš„ç¼©å†™ï¼Œæ˜¯ä¸€ç§èº«ä»½éªŒè¯æœºåˆ¶ï¼Œè¿‘å¹´æ¥è¶Šæ¥è¶Šæµè¡Œã€‚</p><p>JWT éå¸¸é€‚åˆå•é¡µå’Œç§»åŠ¨åº”ç”¨ç¨‹åºï¼Œä½†å®ƒå¸¦æ¥äº†ä¸€ç³»åˆ—æ–°æŒ‘æˆ˜ã€‚æƒ³è¦é’ˆå¯¹APIè¿›è¡Œèº«ä»½éªŒè¯çš„å‰ç«¯åº”ç”¨ç¨‹åºçš„å…¸å‹æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å‰ç«¯å°†å‡­è¯å‘é€åˆ°åç«¯</li><li>åç«¯æ£€æŸ¥å‡­è¯å¹¶å‘å›ä»¤ç‰Œ</li><li>å‰ç«¯åœ¨æ¯ä¸ªåç»­è¯·æ±‚ä¸Šå¸¦ä¸Šè¯¥ä»¤ç‰Œ</li></ul><p>è¿™ç§æ–¹æ³•å¸¦æ¥çš„ä¸»è¦é—®é¢˜æ˜¯ï¼šä¸ºäº†ä½¿ç”¨æˆ·ä¿æŒç™»å½•çŠ¶æ€ï¼Œæˆ‘å°†è¯¥ä»¤ç‰Œå­˜å‚¨åœ¨å‰ç«¯çš„å“ªä¸ªåœ°æ–¹ï¼Ÿ</p><p>å¯¹äºå‰ç«¯å¼€å‘æ¥è¯´ï¼Œæœ€è‡ªç„¶çš„äº‹æƒ…æ˜¯å°†ä»¤ç‰Œä¿å­˜åœ¨localStorageä¸­ã€‚ç”±äºè®¸å¤šåŸå› ï¼Œè¿™å¾ˆç³Ÿç³•ã€‚</p><p>localStorageå¾ˆå®¹æ˜“ä» JS ä»£ç è®¿é—®ï¼Œè€Œä¸”å®ƒå¾ˆå®¹æ˜“æˆä¸º<strong>XSS</strong>æ”»å‡»çš„ç›®æ ‡ã€‚</p><p>ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œå¤§å¤šæ•°å¼€å‘äººå‘˜éƒ½å°†<strong>JWT</strong>ä»¤ç‰Œä¿å­˜åœ¨cookieä¸­ï¼Œä»¥ä¸ºHttpOnlyå’ŒSecureå¯ä»¥ä¿æŠ¤cookieï¼Œè‡³å°‘å¯ä»¥å…å—XSSæ”»å‡»ã€‚</p><p>å°† SameSite è®¾ç½®ä¸º strict å°±å¯ä»¥å®Œå…¨ä¿æŠ¤ JWTå…å—CSRFæ”»å‡»</p><p>è®¾ç½®ä¸ºSameSite = Strictçš„æ–°SameSiteå±æ€§è¿˜å°†ä¿æŠ¤ä½ çš„â€œç†ŸåŒ–â€ JWTå…å—CSRFæ”»å‡»ã€‚ä½†æ˜¯ï¼Œç”±äºSameSite = Strictä¸ä¼šåœ¨è·¨åŸŸè¯·æ±‚ä¸Šå‘é€cookieï¼Œå› æ­¤ï¼Œè¿™ä¹Ÿå®Œå…¨ä½¿JWTçš„ç”¨ä¾‹æ— æ•ˆã€‚</p><p>é‚£SameSite=Laxå‘¢ï¼Ÿæ­¤æ¨¡å¼å…è®¸ä½¿ç”¨å®‰å…¨çš„HTTPæ–¹æ³•ï¼ˆå³GETï¼ŒHEADï¼ŒOPTIONSå’ŒTRACEï¼‰å°† cookieå‘é€å›å»ã€‚POST è¯·æ±‚ä¸ä¼šä»¥ä»»ä½•ä¸€ç§æ–¹å¼ä¼ è¾“ cookieã€‚</p><p>å®é™…ä¸Šï¼Œå°†JWTæ ‡è®°å­˜å‚¨åœ¨cookieæˆ–localStorageä¸­éƒ½ä¸æ˜¯å¥½ä¸»æ„ã€‚</p><p>å¦‚æœä½ ç¡®å®è¦ä½¿ç”¨JWTè€Œä¸æ˜¯åšæŒä½¿ç”¨åŸºäºä¼šè¯çš„èº«ä»½éªŒè¯å¹¶æ‰©å±•ä¼šè¯å­˜å‚¨ï¼Œåˆ™å¯èƒ½è¦ä½¿ç”¨å¸¦æœ‰åˆ·æ–°ä»¤ç‰Œçš„JWTæ¥ä¿æŒç”¨æˆ·ç™»å½•ã€‚</p><h1 class=pgc-h-arrow-right><strong>æ€»ç»“</strong></h1><p>è‡ª1994å¹´ä»¥æ¥ï¼ŒHTTP cookieä¸€ç›´å­˜åœ¨ï¼Œå®ƒä»¬æ— å¤„ä¸åœ¨ã€‚</p><p>Cookiesæ˜¯ç®€å•çš„æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œä½†å¯ä»¥é€šè¿‡<strong>Domain</strong>å’ŒPathå¯¹å…¶æƒé™è¿›è¡Œæ§åˆ¶ï¼Œå…·æœ‰Secureçš„Cookieï¼Œåªèƒ½é€šè¿‡ HTTP Sè¿›è¡Œä¼ è¾“ï¼Œè€Œå¯ä»¥ä½¿ç”¨ HttpOnlyä» JSéšè—ã€‚</p><p>ä½†æ˜¯ï¼Œå¯¹äºæ‰€æœ‰é¢„æœŸçš„ç”¨é€”ï¼Œcookieéƒ½å¯èƒ½ä½¿ç”¨æˆ·æš´éœ²äºæ”»å‡»å’Œæ¼æ´ä¹‹ä¸­ã€‚</p><p>æµè§ˆå™¨çš„ä¾›åº”å•†å’ŒInternetå·¥ç¨‹ä»»åŠ¡ç»„ï¼ˆInternet Engineering Task Forceï¼‰å¹´å¤ä¸€å¹´åœ°è‡´åŠ›äºæé«˜cookieçš„å®‰å…¨æ€§ï¼Œæœ€è¿‘çš„ä¸€æ­¥æ˜¯SameSiteã€‚</p><p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ‰ç®—æ˜¯æ¯”è¾ƒå®‰å…¨cookieï¼Ÿï¼Œå¦‚ä¸‹å‡ ç‚¹ï¼š</p><ul><li>ä»…ä½¿ç”¨ HTTPS</li><li>å°½å¯èƒ½å¸¦æœ‰ HttpOnly å±æ€§</li><li>æ­£ç¡®çš„SameSiteé…ç½®</li><li>ä¸æºå¸¦æ•æ„Ÿæ•°æ®</li></ul><p>äººæ‰ä»¬çš„ <strong>ã€ä¸‰è¿ã€‘</strong> å°±æ˜¯å°æ™ºä¸æ–­åˆ†äº«çš„æœ€å¤§åŠ¨åŠ›ï¼Œå¦‚æœæœ¬ç¯‡åšå®¢æœ‰ä»»ä½•é”™è¯¯å’Œå»ºè®®ï¼Œæ¬¢è¿äººæ‰ä»¬ç•™è¨€ï¼Œæœ€åï¼Œè°¢è°¢å¤§å®¶çš„è§‚çœ‹ã€‚</p><hr><p>ä½œè€…ï¼švalentinog è¯‘è€…ï¼šå‰ç«¯å°æ™º æ¥æºï¼švalentinog</p><p>åŸæ–‡ï¼šhttps://gizmodo.com/the-complete-guide-to-cookies-and-all-the-stuff-w-1794247382</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'å®ç”¨','HTTP','cookie'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>