<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Elasticsearch字段类型之Range经典应用场景 | 极客快訊</title><meta property="og:title" content="Elasticsearch字段类型之Range经典应用场景 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/2eaaae99f1dd40bcb89f1de7b4952fa4"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f887ea5.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f887ea5.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f887ea5.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f887ea5.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f887ea5.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f887ea5.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f887ea5.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f887ea5.html><meta property="article:published_time" content="2020-10-29T20:59:31+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:31+08:00"><meta name=Keywords content><meta name=description content="Elasticsearch字段类型之Range经典应用场景"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/f887ea5.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Elasticsearch字段类型之Range经典应用场景</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-decimal data-index=01>序言</h1><p>Elasticsearch产品功能越来越强大，字段类型支持很多种，部分类型还引入了专用的算法。一个客户企业选中Elastic作为搜索中台，居然是看中了Elastic的Range字段类型，下面就围绕这个Range类型展开。</p><h1 class=pgc-h-decimal data-index=02>现状背景</h1><p><strong>背景需求</strong></p><p>客户企业行业所属传统工业领域，有自己专业化的工业信息平台，多年发展积累了大量的工业产品信息，数据量在几个TB级以上，每种工业产品都有大量的标签信息，标签信息多数属于数值类型，且是属于范围那种数据，如某安防头盔尺寸是L码，配合适合范围55cm~65cm，对于此种数据查询，若标签属性较少，还可以走传统的数据库索引查询，若标签属性很多，则显然很吃力。</p><p><strong>原有方案</strong></p><p>企业技术负责人入行IT很早，原始的技术栈组合是Sqlserver+Clucene组合，原始工业产品信息存储在数据库中，搜索查询走Clucene，有很多问题，如下：</p><ul><li>自主包装Clucene核心库，框架与业务代码深度耦合，单次需求变更都需要发布版本，不具备稳定性</li><li>索引实时更新几乎没有，属于离线更新，且更新一次周期很长</li><li>Clucene版本很旧，对于搜索的支持还是早期分词阶段，仅支持倒排索引</li><li>对于范围搜索，采用的是分词方式实现，不能做到精确的范围搜索，这个是最核心迫切需要的功能</li><li>基于Clucene开发的搜索应用 ，索引数据太大，客户花很多精力实现分布式，且效果不理想</li></ul><div class=pgc-img><img alt=Elasticsearch字段类型之Range经典应用场景 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2eaaae99f1dd40bcb89f1de7b4952fa4><p class=pgc-img-caption>原有技术栈体系</p></div><h1 class=pgc-h-decimal data-index=03>技术实现</h1><p>相比传统关系型数据库，Elasticsearch实现的方式更加直接高效。</p><p><strong>Range类型设置</strong></p><p>Elasticsearch支持多种范围类型</p><ul><li>数值类型</li><li>日期类型</li><li>IP地址类型</li></ul><div class=pgc-img><img alt=Elasticsearch字段类型之Range经典应用场景 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3f7c1762b00549da82af8645003601e5><p class=pgc-img-caption>设置索引字段映射类型示意图</p></div><p>若在关系数据库中则每个标签属性需要2个字段表示范围值。</p><p><strong>Range数据填充</strong></p><p>填充范围数据，有多种表达式</p><ul><li>大于，gt</li><li>小于，lt</li><li>大于等于，gte</li><li>小于等于，lte</li></ul><div class=pgc-img><img alt=Elasticsearch字段类型之Range经典应用场景 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4c3ade00c7654bef9343bd94bc12bf27><p class=pgc-img-caption>填充字段数据示意图</p></div><p><strong>Range数据查询</strong></p><p>查询语法很简单，不过查询的关联关系有几种</p><ul><li>相交，查询条件的范围与字段数据范围有交叉，默认使用</li><li>包含，查询条件的范围值，包含字段的数据范围值</li><li>反包含，与包含相反，查询条件的范围值包含在字段的数据范围之内。</li></ul><div class=pgc-img><img alt=Elasticsearch字段类型之Range经典应用场景 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d089a86881164ceb8005f1b4b5b43ba1><p class=pgc-img-caption>范围条件查询示意图</p></div><p>若在关系数据库中查询相交则需要2组表达式合并才可以，若多个标签属性同时查询，则更复杂。</p><h1 class=pgc-h-decimal data-index=04>技术原理</h1><p>在跟客户企业沟通中，发现比较重要的信息是，技术负责人对于搜索领域的知识认知比较陈旧，Lucene发展早已不仅仅是倒排索引，已经支持了很多索引算法，且应用领域也早就突破分词搜索，Elastic产品版本近年更新很快，相应的Lucene也一样</p><p>为什么选择Elasticsearch替代关系型数据库做范围查询最合适呢？原因如下</p><p><strong>产品功能</strong></p><div class=pgc-img><img alt=Elasticsearch字段类型之Range经典应用场景 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/3eb30bf6a8184f12966d7b63c3b13921><p class=pgc-img-caption>Elasticsearch核心功能发展时间</p></div><p>Elasticsearch从2016年引入了BKD树算法，在构建索引时会依据字段类型设置不同的算法实现，无需要人工干预，只要设计正确的类型，如下</p><ul><li>若是字符类型的，基于 Inverted Index 构建索引</li><li>若是数值类型，基于 BKD-Tree 构建索引</li></ul><p><strong>算法介绍</strong></p><div class=pgc-img><img alt=Elasticsearch字段类型之Range经典应用场景 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/80d69304aeaf4e7e8de47c9631f03f5f><p class=pgc-img-caption>BKD-Tree算法示意图</p></div><ul><li>Bkd-Tree作为一种基于K-D-B-tree的索引结构，用来对多维度的点数据(multi-dimensional point data)集进行索引。关于构建BKD-Tree过程不在本文探讨范围内，详细可以查阅更专业的论文。</li><li>从前面客户需求描述得到，客户的工业产品信息有很多范围类型的标签属性，在Elasticsearch中，仅需要构建一个索引即可满足高效查找，且默认是所有标签属性自动构造索引。</li><li>想想看若基于传统关系型数据库实现，每标签属性都需要至少2个字段，且多个标签属性要任意组合查询，不能通过一个索引实现，需要创建很多索引，查询时还必须保持最左原则；</li><li>BKD-Tree索引查询效率比关系型数据库的BTree更胜一筹。</li></ul><p><br></p><h1 class=pgc-h-decimal data-index=05>结语</h1><p><strong>经验总结</strong></p><ul><li>Elastic核心基于Lucene，功能发展非常成熟，普通用户没有必要基于Lucene自主开发搜索应用，只需要关注自己的业务实现。</li><li>数据产品的竞争更多的是产品背后实现算法的竞争，对于我们来说需要经常更新自己的知识体系，选择最合适的技术方案响应变化。</li><li>DB与ES混合应用已经成为当前潮流，Elastic已经成为当前查询应用标配</li><li>ES用的好，下班必须早</li></ul><p><strong>关于我们</strong></p><ul><li>李猛（ynuosoft），是Elastic-stack产品深度用户，通过Elastic工程师认证，2012年接触Elasticsearch，对Elastic-Stack开发、架构、运维等方面有深入体验，实践过多种Elastic项目，最暴力的大数据分析应用，最复杂的业务系统应用；业余为企业提供Elastic-stack咨询培训以及调优实施；多年IT实战经验，专注大数据，机器学习，系统架构。</li><li>深圳星图智能 星图智能是Elastic官方MSP技术合作伙伴</li></ul></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'Elasticsearch','类型','Range'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>