<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ä¸€æ–‡æå®šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFS | æå®¢å¿«è¨Š</title><meta property="og:title" content="ä¸€æ–‡æå®šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFS - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/c4fc524877574c51905170a1f43effdb"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f9a6017f.html><meta property="article:published_time" content="2020-11-14T21:03:23+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:23+08:00"><meta name=Keywords content><meta name=description content="ä¸€æ–‡æå®šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFS"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/f9a6017f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ä¸€æ–‡æå®šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFS</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><p><strong>å¿…é¡»å…ˆè½¬å‘ï¼Œè½¬å‘ï¼Œè½¬å‘ï¼ŒåŠ â€œå¤§æ•°æ®javaæ¶æ„å¸ˆâ€å…³æ³¨ï¼Œå…³æ³¨ï¼Œç„¶åç§ä¿¡æˆ‘â€œDFSâ€å³å¯å…è´¹è·å–æ›´å¤šèµ„æ–™ä¸‹è½½åœ°å€</strong></p><p>æ¦‚è¿°</p><p>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼šDistributed file system, DFSï¼Œåˆå«åšç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼šNetwork File Systemã€‚ä¸€ç§å…è®¸æ–‡ä»¶é€šè¿‡ç½‘ç»œåœ¨å¤šå°ä¸»æœºä¸Šåˆ†äº«çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¯è®©å¤šæœºå™¨ä¸Šçš„å¤šç”¨æˆ·åˆ†äº«æ–‡ä»¶å’Œå­˜å‚¨ç©ºé—´ã€‚</p><p>FastDFSæ˜¯ç”¨cè¯­è¨€ç¼–å†™çš„ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå……åˆ†è€ƒè™‘äº†å†—ä½™å¤‡ä»½ã€è´Ÿè½½å‡è¡¡ã€çº¿æ€§æ‰©å®¹ç­‰æœºåˆ¶ï¼Œå¹¶æ³¨é‡é«˜å¯ç”¨ã€é«˜æ€§èƒ½ç­‰æŒ‡æ ‡ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼šæ–‡ä»¶å­˜å‚¨ã€æ–‡ä»¶åŒæ­¥ã€æ–‡ä»¶è®¿é—®ï¼ˆæ–‡ä»¶ä¸Šä¼ ã€æ–‡ä»¶ä¸‹è½½ï¼‰ç­‰ï¼Œè§£å†³äº†å¤§å®¹é‡å­˜å‚¨å’Œè´Ÿè½½å‡è¡¡çš„é—®é¢˜ã€‚ç‰¹åˆ«é€‚åˆä¸­å°æ–‡ä»¶ï¼ˆå»ºè®®èŒƒå›´ï¼š4KB &lt; file_size &lt;500MBï¼‰ï¼Œå¯¹ä»¥æ–‡ä»¶ä¸ºè½½ä½“çš„åœ¨çº¿æœåŠ¡ï¼Œå¦‚ç›¸å†Œç½‘ç«™ã€è§†é¢‘ç½‘ç«™ç­‰ã€‚</p><p>FastDFS æ¶æ„</p><p>FastDFSæ¶æ„åŒ…æ‹¬Tracker serverå’ŒStorage serverã€‚å®¢æˆ·ç«¯è¯·æ±‚Tracker serverè¿›è¡Œæ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ï¼Œé€šè¿‡Tracker serverè°ƒåº¦æœ€ç»ˆç”±Storage serverå®Œæˆæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ã€‚</p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c4fc524877574c51905170a1f43effdb><p class=pgc-img-caption></p></div><p>è·Ÿè¸ªæœåŠ¡å™¨Tracker Server</p><p>ä¸»è¦åšè°ƒåº¦å·¥ä½œï¼Œèµ·åˆ°å‡è¡¡çš„ä½œç”¨ï¼›è´Ÿè´£ç®¡ç†æ‰€æœ‰çš„ storage serverå’Œ groupï¼Œæ¯ä¸ª storage åœ¨å¯åŠ¨åä¼šè¿æ¥ Trackerï¼Œå‘ŠçŸ¥è‡ªå·±æ‰€å± group ç­‰ä¿¡æ¯ï¼Œå¹¶ä¿æŒå‘¨æœŸæ€§å¿ƒè·³ã€‚trackeræ ¹æ®storageçš„å¿ƒè·³ä¿¡æ¯ï¼Œå»ºç«‹group==>[storage serverlist]çš„æ˜ å°„è¡¨ã€‚</p><p>Trackeréœ€è¦ç®¡ç†çš„å…ƒä¿¡æ¯å¾ˆå°‘ï¼Œä¼šå…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼›å¦å¤–trackerä¸Šçš„å…ƒä¿¡æ¯éƒ½æ˜¯ç”±storageæ±‡æŠ¥çš„ä¿¡æ¯ç”Ÿæˆçš„ï¼Œæœ¬èº«ä¸éœ€è¦æŒä¹…åŒ–ä»»ä½•æ•°æ®ï¼Œè¿™æ ·ä½¿å¾—trackeréå¸¸å®¹æ˜“æ‰©å±•ï¼Œç›´æ¥å¢åŠ trackeræœºå™¨å³å¯æ‰©å±•ä¸ºtracker clusteræ¥æœåŠ¡ï¼Œclusteré‡Œæ¯ä¸ªtrackerä¹‹é—´æ˜¯å®Œå…¨å¯¹ç­‰çš„ï¼Œæ‰€æœ‰çš„trackeréƒ½æ¥å—stroageçš„å¿ƒè·³ä¿¡æ¯ï¼Œç”Ÿæˆå…ƒæ•°æ®ä¿¡æ¯æ¥æä¾›è¯»å†™æœåŠ¡ã€‚</p><p>å­˜å‚¨æœåŠ¡å™¨Storage Server</p><p>ä¸»è¦æä¾›å®¹é‡å’Œå¤‡ä»½æœåŠ¡ï¼›ä»¥ group ä¸ºå•ä½ï¼Œæ¯ä¸ª group å†…å¯ä»¥æœ‰å¤šå° storage serverï¼Œæ•°æ®äº’ä¸ºå¤‡ä»½ã€‚ä»¥groupä¸ºå•ä½ç»„ç»‡å­˜å‚¨èƒ½æ–¹ä¾¿çš„è¿›è¡Œåº”ç”¨éš”ç¦»ã€è´Ÿè½½å‡è¡¡ã€å‰¯æœ¬æ•°å®šåˆ¶ï¼ˆgroupå†…storage serveræ•°é‡å³ä¸ºè¯¥groupçš„å‰¯æœ¬æ•°ï¼‰ï¼Œæ¯”å¦‚å°†ä¸åŒåº”ç”¨æ•°æ®å­˜åˆ°ä¸åŒçš„groupå°±èƒ½éš”ç¦»åº”ç”¨æ•°æ®ï¼ŒåŒæ—¶è¿˜å¯æ ¹æ®åº”ç”¨çš„è®¿é—®ç‰¹æ€§æ¥å°†åº”ç”¨åˆ†é…åˆ°ä¸åŒçš„groupæ¥åšè´Ÿè½½å‡è¡¡ï¼›ç¼ºç‚¹æ˜¯groupçš„å®¹é‡å—å•æœºå­˜å‚¨å®¹é‡çš„é™åˆ¶ï¼ŒåŒæ—¶å½“groupå†…æœ‰æœºå™¨åæ‰æ—¶ï¼Œæ•°æ®æ¢å¤åªèƒ½ä¾èµ–groupå†…åœ°å…¶ä»–æœºå™¨ï¼Œä½¿å¾—æ¢å¤æ—¶é—´ä¼šå¾ˆé•¿ã€‚</p><p>groupå†…æ¯ä¸ªstorageçš„å­˜å‚¨ä¾èµ–äºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œstorageå¯é…ç½®å¤šä¸ªæ•°æ®å­˜å‚¨ç›®å½•ï¼Œæ¯”å¦‚æœ‰10å—ç£ç›˜ï¼Œåˆ†åˆ«æŒ‚è½½åœ¨/data/disk1-/data/disk10ï¼Œåˆ™å¯å°†è¿™10ä¸ªç›®å½•éƒ½é…ç½®ä¸ºstorageçš„æ•°æ®å­˜å‚¨ç›®å½•ã€‚storageæ¥å—åˆ°å†™æ–‡ä»¶è¯·æ±‚æ—¶ï¼Œä¼šæ ¹æ®é…ç½®å¥½çš„è§„åˆ™é€‰æ‹©å…¶ä¸­ä¸€ä¸ªå­˜å‚¨ç›®å½•æ¥å­˜å‚¨æ–‡ä»¶ã€‚ä¸ºäº†é¿å…å•ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶æ•°å¤ªå¤šï¼Œåœ¨storageç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œä¼šåœ¨æ¯ä¸ªæ•°æ®å­˜å‚¨ç›®å½•é‡Œåˆ›å»º2çº§å­ç›®å½•ï¼Œæ¯çº§256ä¸ªï¼Œæ€»å…±65536ä¸ªæ–‡ä»¶ï¼Œæ–°å†™çš„æ–‡ä»¶ä¼šä»¥hashçš„æ–¹å¼è¢«è·¯ç”±åˆ°å…¶ä¸­æŸä¸ªå­ç›®å½•ä¸‹ï¼Œç„¶åå°†æ–‡ä»¶æ•°æ®ä½œä¸ºæœ¬åœ°æ–‡ä»¶å­˜å‚¨åˆ°è¯¥ç›®å½•ä¸­ã€‚</p><p>FastDFSçš„å­˜å‚¨ç­–ç•¥</p><p>ä¸ºäº†æ”¯æŒå¤§å®¹é‡ï¼Œå­˜å‚¨èŠ‚ç‚¹ï¼ˆæœåŠ¡å™¨ï¼‰é‡‡ç”¨äº†åˆ†å·ï¼ˆæˆ–åˆ†ç»„ï¼‰çš„ç»„ç»‡æ–¹å¼ã€‚å­˜å‚¨ç³»ç»Ÿç”±ä¸€ä¸ªæˆ–å¤šä¸ªå·ç»„æˆï¼Œå·ä¸å·ä¹‹é—´çš„æ–‡ä»¶æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ‰€æœ‰å·çš„æ–‡ä»¶å®¹é‡ç´¯åŠ å°±æ˜¯æ•´ä¸ªå­˜å‚¨ç³»ç»Ÿä¸­çš„æ–‡ä»¶å®¹é‡ã€‚ä¸€ä¸ªå·å¯ä»¥ç”±ä¸€å°æˆ–å¤šå°å­˜å‚¨æœåŠ¡å™¨ç»„æˆï¼Œä¸€ä¸ªå·ä¸‹çš„å­˜å‚¨æœåŠ¡å™¨ä¸­çš„æ–‡ä»¶éƒ½æ˜¯ç›¸åŒçš„ï¼Œå·ä¸­çš„å¤šå°å­˜å‚¨æœåŠ¡å™¨èµ·åˆ°äº†å†—ä½™å¤‡ä»½å’Œè´Ÿè½½å‡è¡¡çš„ä½œç”¨ã€‚</p><p>åœ¨å·ä¸­å¢åŠ æœåŠ¡å™¨æ—¶ï¼ŒåŒæ­¥å·²æœ‰çš„æ–‡ä»¶ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆï¼ŒåŒæ­¥å®Œæˆåï¼Œç³»ç»Ÿè‡ªåŠ¨å°†æ–°å¢æœåŠ¡å™¨åˆ‡æ¢åˆ°çº¿ä¸Šæä¾›æœåŠ¡ã€‚å½“å­˜å‚¨ç©ºé—´ä¸è¶³æˆ–å³å°†è€—å°½æ—¶ï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ å·ã€‚åªéœ€è¦å¢åŠ ä¸€å°æˆ–å¤šå°æœåŠ¡å™¨ï¼Œå¹¶å°†å®ƒä»¬é…ç½®ä¸ºä¸€ä¸ªæ–°çš„å·ï¼Œè¿™æ ·å°±æ‰©å¤§äº†å­˜å‚¨ç³»ç»Ÿçš„å®¹é‡ã€‚</p><p>FastDFSçš„ä¸Šä¼ è¿‡ç¨‹</p><p>FastDFSå‘ä½¿ç”¨è€…æä¾›åŸºæœ¬æ–‡ä»¶è®¿é—®æ¥å£ï¼Œæ¯”å¦‚uploadã€downloadã€appendã€deleteç­‰ï¼Œä»¥å®¢æˆ·ç«¯åº“çš„æ–¹å¼æä¾›ç»™ç”¨æˆ·ä½¿ç”¨ã€‚</p><p>Storage Serverä¼šå®šæœŸçš„å‘Tracker Serverå‘é€è‡ªå·±çš„å­˜å‚¨ä¿¡æ¯ã€‚å½“Tracker Server Clusterä¸­çš„Tracker Serverä¸æ­¢ä¸€ä¸ªæ—¶ï¼Œå„ä¸ªTrackerä¹‹é—´çš„å…³ç³»æ˜¯å¯¹ç­‰çš„ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ä¸Šä¼ æ—¶å¯ä»¥é€‰æ‹©ä»»æ„ä¸€ä¸ªTrackerã€‚</p><p>å½“Trackeræ”¶åˆ°å®¢æˆ·ç«¯ä¸Šä¼ æ–‡ä»¶çš„è¯·æ±‚æ—¶ï¼Œä¼šä¸ºè¯¥æ–‡ä»¶åˆ†é…ä¸€ä¸ªå¯ä»¥å­˜å‚¨æ–‡ä»¶çš„groupï¼Œå½“é€‰å®šäº†groupåå°±è¦å†³å®šç»™å®¢æˆ·ç«¯åˆ†é…groupä¸­çš„å“ªä¸€ä¸ªstorage serverã€‚å½“åˆ†é…å¥½storage serveråï¼Œå®¢æˆ·ç«¯å‘storageå‘é€å†™æ–‡ä»¶è¯·æ±‚ï¼Œstorageå°†ä¼šä¸ºæ–‡ä»¶åˆ†é…ä¸€ä¸ªæ•°æ®å­˜å‚¨ç›®å½•ã€‚ç„¶åä¸ºæ–‡ä»¶åˆ†é…ä¸€ä¸ªfileidï¼Œæœ€åæ ¹æ®ä»¥ä¸Šçš„ä¿¡æ¯ç”Ÿæˆæ–‡ä»¶åå­˜å‚¨æ–‡ä»¶ã€‚</p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/01f99f6d91f94b6b8b31e47feb7e2c6d><p class=pgc-img-caption></p></div><p>é€‰æ‹©tracker server</p><p>å½“é›†ç¾¤ä¸­ä¸æ­¢ä¸€ä¸ªtracker serveræ—¶ï¼Œç”±äºtrackerä¹‹é—´æ˜¯å®Œå…¨å¯¹ç­‰çš„å…³ç³»ï¼Œå®¢æˆ·ç«¯åœ¨uploadæ–‡ä»¶æ—¶å¯ä»¥ä»»æ„é€‰æ‹©ä¸€ä¸ªtrakcerã€‚</p><p>é€‰æ‹©å­˜å‚¨çš„group</p><p>å½“trackeræ¥æ”¶åˆ°upload fileçš„è¯·æ±‚æ—¶ï¼Œä¼šä¸ºè¯¥æ–‡ä»¶åˆ†é…ä¸€ä¸ªå¯ä»¥å­˜å‚¨è¯¥æ–‡ä»¶çš„groupï¼Œæ”¯æŒå¦‚ä¸‹é€‰æ‹©groupçš„è§„åˆ™ï¼š 1. Round robinï¼Œæ‰€æœ‰çš„groupé—´è½®è¯¢ 2. Specified groupï¼ŒæŒ‡å®šæŸä¸€ä¸ªç¡®å®šçš„group 3. Load balanceï¼Œå‰©ä½™å­˜å‚¨ç©ºé—´å¤šå¤šgroupä¼˜å…ˆ</p><p>é€‰æ‹©storage server</p><p>å½“é€‰å®šgroupåï¼Œtrackerä¼šåœ¨groupå†…é€‰æ‹©ä¸€ä¸ªstorage serverç»™å®¢æˆ·ç«¯ï¼Œæ”¯æŒå¦‚ä¸‹é€‰æ‹©storageçš„è§„åˆ™ï¼š 1. Round robinï¼Œåœ¨groupå†…çš„æ‰€æœ‰storageé—´è½®è¯¢ 2. First server ordered by ipï¼ŒæŒ‰ipæ’åº 3. First server ordered by priorityï¼ŒæŒ‰ä¼˜å…ˆçº§æ’åºï¼ˆä¼˜å…ˆçº§åœ¨storageä¸Šé…ç½®ï¼‰</p><p>é€‰æ‹©storage path</p><p>å½“åˆ†é…å¥½storage serveråï¼Œå®¢æˆ·ç«¯å°†å‘storageå‘é€å†™æ–‡ä»¶è¯·æ±‚ï¼Œstorageå°†ä¼šä¸ºæ–‡ä»¶åˆ†é…ä¸€ä¸ªæ•°æ®å­˜å‚¨ç›®å½•ï¼Œæ”¯æŒå¦‚ä¸‹è§„åˆ™ï¼š 1. Round robinï¼Œå¤šä¸ªå­˜å‚¨ç›®å½•é—´è½®è¯¢ 2. å‰©ä½™å­˜å‚¨ç©ºé—´æœ€å¤šçš„ä¼˜å…ˆ</p><p>ç”ŸæˆFileid</p><p>é€‰å®šå­˜å‚¨ç›®å½•ä¹‹åï¼Œstorageä¼šä¸ºæ–‡ä»¶ç”Ÿä¸€ä¸ªFileidï¼Œç”±storage server ipã€æ–‡ä»¶åˆ›å»ºæ—¶é—´ã€æ–‡ä»¶å¤§å°ã€æ–‡ä»¶crc32å’Œä¸€ä¸ªéšæœºæ•°æ‹¼æ¥è€Œæˆï¼Œç„¶åå°†è¿™ä¸ªäºŒè¿›åˆ¶ä¸²è¿›è¡Œbase64ç¼–ç ï¼Œè½¬æ¢ä¸ºå¯æ‰“å°çš„å­—ç¬¦ä¸²ã€‚</p><p>é€‰æ‹©ä¸¤çº§ç›®å½•</p><p>å½“é€‰å®šå­˜å‚¨ç›®å½•ä¹‹åï¼Œstorageä¼šä¸ºæ–‡ä»¶åˆ†é…ä¸€ä¸ªfileidï¼Œæ¯ä¸ªå­˜å‚¨ç›®å½•ä¸‹æœ‰ä¸¤çº§256*256çš„å­ç›®å½•ï¼Œstorageä¼šæŒ‰æ–‡ä»¶fileidè¿›è¡Œä¸¤æ¬¡hashï¼ˆçŒœæµ‹ï¼‰ï¼Œè·¯ç”±åˆ°å…¶ä¸­ä¸€ä¸ªå­ç›®å½•ï¼Œç„¶åå°†æ–‡ä»¶ä»¥fileidä¸ºæ–‡ä»¶åå­˜å‚¨åˆ°è¯¥å­ç›®å½•ä¸‹ã€‚</p><p>ç”Ÿæˆæ–‡ä»¶å</p><p>å½“æ–‡ä»¶å­˜å‚¨åˆ°æŸä¸ªå­ç›®å½•åï¼Œå³è®¤ä¸ºè¯¥æ–‡ä»¶å­˜å‚¨æˆåŠŸï¼Œæ¥ä¸‹æ¥ä¼šä¸ºè¯¥æ–‡ä»¶ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶åï¼Œæ–‡ä»¶åç”±groupã€å­˜å‚¨ç›®å½•ã€ä¸¤çº§å­ç›®å½•ã€fileidã€æ–‡ä»¶åç¼€åï¼ˆç”±å®¢æˆ·ç«¯æŒ‡å®šï¼Œä¸»è¦ç”¨äºåŒºåˆ†æ–‡ä»¶ç±»å‹ï¼‰æ‹¼æ¥è€Œæˆã€‚</p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/32867cb165b0459bb46f06c0a825cd82><p class=pgc-img-caption></p></div><p>FastDFSçš„æ–‡ä»¶åŒæ­¥</p><p>å†™æ–‡ä»¶æ—¶ï¼Œå®¢æˆ·ç«¯å°†æ–‡ä»¶å†™è‡³groupå†…ä¸€ä¸ªstorage serverå³è®¤ä¸ºå†™æ–‡ä»¶æˆåŠŸï¼Œstorage serverå†™å®Œæ–‡ä»¶åï¼Œä¼šç”±åå°çº¿ç¨‹å°†æ–‡ä»¶åŒæ­¥è‡³åŒgroupå†…å…¶ä»–çš„storage serverã€‚</p><p>æ¯ä¸ªstorageå†™æ–‡ä»¶åï¼ŒåŒæ—¶ä¼šå†™ä¸€ä»½binlogï¼Œbinlogé‡Œä¸åŒ…å«æ–‡ä»¶æ•°æ®ï¼ŒåªåŒ…å«æ–‡ä»¶åç­‰å…ƒä¿¡æ¯ï¼Œè¿™ä»½binlogç”¨äºåå°åŒæ­¥ï¼Œstorageä¼šè®°å½•å‘groupå†…å…¶ä»–storageåŒæ­¥çš„è¿›åº¦ï¼Œä»¥ä¾¿é‡å¯åèƒ½æ¥ä¸Šæ¬¡çš„è¿›åº¦ç»§ç»­åŒæ­¥ï¼›è¿›åº¦ä»¥æ—¶é—´æˆ³çš„æ–¹å¼è¿›è¡Œè®°å½•ï¼Œæ‰€ä»¥æœ€å¥½èƒ½ä¿è¯é›†ç¾¤å†…æ‰€æœ‰serverçš„æ—¶é’Ÿä¿æŒåŒæ­¥ã€‚</p><p>storageçš„åŒæ­¥è¿›åº¦ä¼šä½œä¸ºå…ƒæ•°æ®çš„ä¸€éƒ¨åˆ†æ±‡æŠ¥åˆ°trackerä¸Šï¼Œtrackeåœ¨é€‰æ‹©è¯»storageçš„æ—¶å€™ä¼šä»¥åŒæ­¥è¿›åº¦ä½œä¸ºå‚è€ƒã€‚</p><p>æ¯”å¦‚ä¸€ä¸ªgroupå†…æœ‰Aã€Bã€Cä¸‰ä¸ªstorage serverï¼ŒAå‘CåŒæ­¥åˆ°è¿›åº¦ä¸ºT1 (T1ä»¥å‰å†™çš„æ–‡ä»¶éƒ½å·²ç»åŒæ­¥åˆ°Bä¸Šäº†ï¼‰ï¼ŒBå‘CåŒæ­¥åˆ°æ—¶é—´æˆ³ä¸ºT2ï¼ˆT2 > T1)ï¼Œtrackeræ¥æ”¶åˆ°è¿™äº›åŒæ­¥è¿›åº¦ä¿¡æ¯æ—¶ï¼Œå°±ä¼šè¿›è¡Œæ•´ç†ï¼Œå°†æœ€å°çš„é‚£ä¸ªåšä¸ºCçš„åŒæ­¥æ—¶é—´æˆ³ï¼Œæœ¬ä¾‹ä¸­T1å³ä¸ºCçš„åŒæ­¥æ—¶é—´æˆ³ä¸ºT1ï¼ˆå³æ‰€æœ‰T1ä»¥å‰å†™çš„æ•°æ®éƒ½å·²ç»åŒæ­¥åˆ°Cä¸Šäº†ï¼‰ï¼›åŒç†ï¼Œæ ¹æ®ä¸Šè¿°è§„åˆ™ï¼Œtrackerä¼šä¸ºAã€Bç”Ÿæˆä¸€ä¸ªåŒæ­¥æ—¶é—´æˆ³ã€‚</p><p>FastDFSçš„æ–‡ä»¶ä¸‹è½½</p><p>å®¢æˆ·ç«¯uploadfileæˆåŠŸåï¼Œä¼šæ‹¿åˆ°ä¸€ä¸ªstorageç”Ÿæˆçš„æ–‡ä»¶åï¼Œæ¥ä¸‹æ¥å®¢æˆ·ç«¯æ ¹æ®è¿™ä¸ªæ–‡ä»¶åå³å¯è®¿é—®åˆ°è¯¥æ–‡ä»¶ã€‚</p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/010c054136f84170900a3d04086edd24><p class=pgc-img-caption></p></div><p>è·Ÿupload fileä¸€æ ·ï¼Œåœ¨downloadfileæ—¶å®¢æˆ·ç«¯å¯ä»¥é€‰æ‹©ä»»æ„tracker serverã€‚trackerå‘é€downloadè¯·æ±‚ç»™æŸä¸ªtrackerï¼Œå¿…é¡»å¸¦ä¸Šæ–‡ä»¶åä¿¡æ¯ï¼Œtrackeä»æ–‡ä»¶åä¸­è§£æå‡ºæ–‡ä»¶çš„groupã€å¤§å°ã€åˆ›å»ºæ—¶é—´ç­‰ä¿¡æ¯ï¼Œç„¶åä¸ºè¯¥è¯·æ±‚é€‰æ‹©ä¸€ä¸ªstorageç”¨æ¥æœåŠ¡è¯»è¯·æ±‚ã€‚</p><p>FastDFSæ€§èƒ½æ–¹æ¡ˆ</p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ccf74326f11d4bb0a37cfd1885433b76><p class=pgc-img-caption></p></div><p>FastDFS å®‰è£…</p><p>è½¯ä»¶åŒ…ç‰ˆæœ¬FastDFSv5.05libfastcommonv1.0.7</p><p>ä¸‹è½½å®‰è£…libfastcommon</p><ul><li>ä¸‹è½½</li></ul><pre>wget https://github.com/happyfish100/libfastcommon/archive/V1.0.7.tar.gz</pre><ul><li>è§£å‹</li></ul><pre>tar -xvf V1.0.7.tar.gzcd libfastcommon-1.0.7</pre><ul><li>ç¼–è¯‘ã€å®‰è£…</li></ul><pre>./make.sh./make.sh install</pre><ul><li>åˆ›å»ºè½¯é“¾æ¥</li></ul><pre>ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.soln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.soln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.soln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so </pre><p>ä¸‹è½½å®‰è£…FastDFS</p><ul><li>ä¸‹è½½FastDFS</li></ul><pre> wget https://github.com/happyfish100/fastdfs/archive/V5.05.tar.gz</pre><ul><li>è§£å‹</li></ul><pre>tar -xvf V5.05.tar.gzcd fastdfs-5.05</pre><ul><li>ç¼–è¯‘ã€å®‰è£…</li></ul><pre>./make.sh./make.sh install</pre><p>é…ç½® Tracker æœåŠ¡</p><p>ä¸Šè¿°å®‰è£…æˆåŠŸåï¼Œåœ¨/etc/ç›®å½•ä¸‹ä¼šæœ‰ä¸€ä¸ªfdfsçš„ç›®å½•ï¼Œè¿›å…¥å®ƒã€‚ä¼šçœ‹åˆ°ä¸‰ä¸ª.sampleåç¼€çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä½œè€…ç»™æˆ‘ä»¬çš„ç¤ºä¾‹æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå…¶ä¸­çš„tracker.conf.sampleæ–‡ä»¶æ”¹ä¸ºtracker.confé…ç½®æ–‡ä»¶å¹¶ä¿®æ”¹å®ƒï¼š</p><pre>cp tracker.conf.sample tracker.confvi tracker.conf</pre><p>ç¼–è¾‘tracker.conf</p><pre># é…ç½®æ–‡ä»¶æ˜¯å¦ä¸ç”Ÿæ•ˆï¼Œfalse ä¸ºç”Ÿæ•ˆdisabled=false# æä¾›æœåŠ¡çš„ç«¯å£port=22122# Tracker æ•°æ®å’Œæ—¥å¿—ç›®å½•åœ°å€base_path=//home/data/fastdfs# HTTP æœåŠ¡ç«¯å£http.server_port=80</pre><p>åˆ›å»ºtrackeråŸºç¡€æ•°æ®ç›®å½•ï¼Œå³base_pathå¯¹åº”çš„ç›®å½•</p><pre>mkdir -p /home/data/fastdfs</pre><p>ä½¿ç”¨ln -s å»ºç«‹è½¯é“¾æ¥</p><pre>ln -s /usr/bin/fdfs_trackerd /usr/local/binln -s /usr/bin/stop.sh /usr/local/binln -s /usr/bin/restart.sh /usr/local/bin</pre><p>å¯åŠ¨æœåŠ¡</p><pre>service fdfs_trackerd start</pre><p>æŸ¥çœ‹ç›‘å¬</p><pre>netstat -unltp|grep fdfs</pre><p>å¦‚æœçœ‹åˆ°22122ç«¯å£æ­£å¸¸è¢«ç›‘å¬åï¼Œè¿™æ—¶å€™è¯´æ˜TrackeræœåŠ¡å¯åŠ¨æˆåŠŸå•¦ï¼</p><p>tracker server ç›®å½•åŠæ–‡ä»¶ç»“æ„ TrackeræœåŠ¡å¯åŠ¨æˆåŠŸåï¼Œä¼šåœ¨base_pathä¸‹åˆ›å»ºdataã€logsä¸¤ä¸ªç›®å½•ã€‚ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><pre>${base_path} |__data | |__storage_groups.datï¼šå­˜å‚¨åˆ†ç»„ä¿¡æ¯ | |__storage_servers.datï¼šå­˜å‚¨æœåŠ¡å™¨åˆ—è¡¨ |__logs | |__trackerd.logï¼š tracker server æ—¥å¿—æ–‡ä»¶ </pre><p>é…ç½® Storage æœåŠ¡</p><p>è¿›å…¥ /etc/fdfs ç›®å½•ï¼Œå¤åˆ¶ FastDFS å­˜å‚¨å™¨æ ·ä¾‹é…ç½®æ–‡ä»¶ storage.conf.sampleï¼Œå¹¶é‡å‘½åä¸º storage.conf</p><pre># cd /etc/fdfs# cp storage.conf.sample storage.conf# vi storage.conf</pre><p>ç¼–è¾‘storage.conf</p><pre># é…ç½®æ–‡ä»¶æ˜¯å¦ä¸ç”Ÿæ•ˆï¼Œfalse ä¸ºç”Ÿæ•ˆdisabled=false# æŒ‡å®šæ­¤ storage server æ‰€åœ¨ ç»„(å·)group_name=group1# storage server æœåŠ¡ç«¯å£port=23000# å¿ƒè·³é—´éš”æ—¶é—´ï¼Œå•ä½ä¸ºç§’ (è¿™é‡Œæ˜¯æŒ‡ä¸»åŠ¨å‘ tracker server å‘é€å¿ƒè·³)heart_beat_interval=30# Storage æ•°æ®å’Œæ—¥å¿—ç›®å½•åœ°å€(æ ¹ç›®å½•å¿…é¡»å­˜åœ¨ï¼Œå­ç›®å½•ä¼šè‡ªåŠ¨ç”Ÿæˆ)base_path=/home/data/fastdfs/storage# å­˜æ”¾æ–‡ä»¶æ—¶ storage server æ”¯æŒå¤šä¸ªè·¯å¾„ã€‚è¿™é‡Œé…ç½®å­˜æ”¾æ–‡ä»¶çš„åŸºè·¯å¾„æ•°ç›®ï¼Œé€šå¸¸åªé…ä¸€ä¸ªç›®å½•ã€‚store_path_count=1# é€ä¸€é…ç½® store_path_count ä¸ªè·¯å¾„ï¼Œç´¢å¼•å·åŸºäº 0ã€‚# å¦‚æœä¸é…ç½® store_path0ï¼Œé‚£å®ƒå°±å’Œ base_path å¯¹åº”çš„è·¯å¾„ä¸€æ ·ã€‚store_path0=/home/data/fastdfs/storage# FastDFS å­˜å‚¨æ–‡ä»¶æ—¶ï¼Œé‡‡ç”¨äº†ä¸¤çº§ç›®å½•ã€‚è¿™é‡Œé…ç½®å­˜æ”¾æ–‡ä»¶çš„ç›®å½•ä¸ªæ•°ã€‚ # å¦‚æœæœ¬å‚æ•°åªä¸º Nï¼ˆå¦‚ï¼š 256ï¼‰ï¼Œé‚£ä¹ˆ storage server åœ¨åˆæ¬¡è¿è¡Œæ—¶ï¼Œä¼šåœ¨ store_path ä¸‹è‡ªåŠ¨åˆ›å»º N * N ä¸ªå­˜æ”¾æ–‡ä»¶çš„å­ç›®å½•ã€‚subdir_count_per_path=256# tracker_server çš„åˆ—è¡¨ ï¼Œä¼šä¸»åŠ¨è¿æ¥ tracker_server# æœ‰å¤šä¸ª tracker server æ—¶ï¼Œæ¯ä¸ª tracker server å†™ä¸€è¡Œtracker_server=192.168.1.190:22122# å…è®¸ç³»ç»ŸåŒæ­¥çš„æ—¶é—´æ®µ (é»˜è®¤æ˜¯å…¨å¤©) ã€‚ä¸€èˆ¬ç”¨äºé¿å…é«˜å³°åŒæ­¥äº§ç”Ÿä¸€äº›é—®é¢˜è€Œè®¾å®šã€‚sync_start_time=00:00sync_end_time=23:59</pre><p>ä½¿ç”¨ln -s å»ºç«‹è½¯é“¾æ¥</p><pre>ln -s /usr/bin/fdfs_storaged /usr/local/bin</pre><p>å¯åŠ¨æœåŠ¡</p><pre>service fdfs_storaged start</pre><p>æŸ¥çœ‹ç›‘å¬</p><pre>netstat -unltp|grep fdfs</pre><p>å¯åŠ¨Storageå‰ç¡®ä¿Trackeræ˜¯å¯åŠ¨çš„ã€‚åˆæ¬¡å¯åŠ¨æˆåŠŸï¼Œä¼šåœ¨ /home/data/fastdfs/storage ç›®å½•ä¸‹åˆ›å»º dataã€ logs ä¸¤ä¸ªç›®å½•ã€‚å¦‚æœçœ‹åˆ°23000ç«¯å£æ­£å¸¸è¢«ç›‘å¬åï¼Œè¿™æ—¶å€™è¯´æ˜StorageæœåŠ¡å¯åŠ¨æˆåŠŸå•¦ï¼</p><p>æŸ¥çœ‹Storageå’ŒTrackeræ˜¯å¦åœ¨é€šä¿¡</p><pre>/usr/bin/fdfs_monitor /etc/fdfs/storage.conf</pre><p>FastDFS é…ç½® Nginx æ¨¡å—</p><p>è½¯ä»¶åŒ…ç‰ˆæœ¬openrestyv1.13.6.1fastdfs-nginx-modulev1.1.6</p><p>FastDFS é€šè¿‡ Tracker æœåŠ¡å™¨ï¼Œå°†æ–‡ä»¶æ”¾åœ¨ Storage æœåŠ¡å™¨å­˜å‚¨ï¼Œ ä½†æ˜¯åŒç»„å­˜å‚¨æœåŠ¡å™¨ä¹‹é—´éœ€è¦è¿›è¡Œæ–‡ä»¶å¤åˆ¶ï¼Œæœ‰åŒæ­¥å»¶è¿Ÿçš„é—®é¢˜ã€‚</p><p>å‡è®¾ Tracker æœåŠ¡å™¨å°†æ–‡ä»¶ä¸Šä¼ åˆ°äº† 192.168.1.190ï¼Œä¸Šä¼ æˆåŠŸåæ–‡ä»¶ IDå·²ç»è¿”å›ç»™å®¢æˆ·ç«¯ã€‚æ­¤æ—¶ FastDFS å­˜å‚¨é›†ç¾¤æœºåˆ¶ä¼šå°†è¿™ä¸ªæ–‡ä»¶åŒæ­¥åˆ°åŒç»„å­˜192.168.1.190ï¼Œåœ¨æ–‡ä»¶è¿˜æ²¡æœ‰å¤åˆ¶å®Œæˆçš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¦‚æœç”¨è¿™ä¸ªæ–‡ä»¶ ID åœ¨ 192.168.1.190 ä¸Šå–æ–‡ä»¶,å°±ä¼šå‡ºç°æ–‡ä»¶æ— æ³•è®¿é—®çš„é”™è¯¯ã€‚è€Œ fastdfs-nginx-module å¯ä»¥é‡å®šå‘æ–‡ä»¶é“¾æ¥åˆ°æºæœåŠ¡å™¨å–æ–‡ä»¶ï¼Œé¿å…å®¢æˆ·ç«¯ç”±äºå¤åˆ¶å»¶è¿Ÿå¯¼è‡´çš„æ–‡ä»¶æ— æ³•è®¿é—®é”™è¯¯ã€‚</p><p>ä¸‹è½½ å®‰è£… Nginx å’Œ fastdfs-nginx-moduleï¼š</p><p>æ¨èæ‚¨ä½¿ç”¨yumå®‰è£…ä»¥ä¸‹çš„å¼€å‘åº“:</p><pre>yum install readline-devel pcre-devel openssl-devel -y</pre><p>ä¸‹è½½æœ€æ–°ç‰ˆæœ¬å¹¶è§£å‹ï¼š</p><pre>wget https://openresty.org/download/openresty-1.13.6.1.tar.gztar -xvf openresty-1.13.6.1.tar.gzwget https://github.com/happyfish100/fastdfs-nginx-module/archive/master.zipunzip master.zip</pre><p>é…ç½® nginx å®‰è£…ï¼ŒåŠ å…¥fastdfs-nginx-moduleæ¨¡å—ï¼š</p><pre>./configure --add-module=../fastdfs-nginx-module-master/src/</pre><p>ç¼–è¯‘ã€å®‰è£…ï¼š</p><pre>make &amp;&amp; make install</pre><p>æŸ¥çœ‹Nginxçš„æ¨¡å—ï¼š</p><pre>/usr/local/openresty/nginx/sbin/nginx -v</pre><p>æœ‰ä¸‹é¢è¿™ä¸ªå°±è¯´æ˜æ·»åŠ æ¨¡å—æˆåŠŸ</p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a79861202b6542259f8e45e474232e2b><p class=pgc-img-caption></p></div><p>å¤åˆ¶ fastdfs-nginx-module æºç ä¸­çš„é…ç½®æ–‡ä»¶åˆ°/etc/fdfs ç›®å½•ï¼Œ å¹¶ä¿®æ”¹ï¼š</p><pre>cp /fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs/# è¿æ¥è¶…æ—¶æ—¶é—´connect_timeout=10# Tracker Servertracker_server=192.168.1.190:22122# StorageServer é»˜è®¤ç«¯å£storage_server_port=23000# å¦‚æœæ–‡ä»¶IDçš„uriä¸­åŒ…å«/group**ï¼Œåˆ™è¦è®¾ç½®ä¸ºtrueurl_have_group_name = true# Storage é…ç½®çš„store_path0è·¯å¾„ï¼Œå¿…é¡»å’Œstorage.confä¸­çš„ä¸€è‡´store_path0=/home/data/fastdfs/storage</pre><p>å¤åˆ¶ FastDFS çš„éƒ¨åˆ†é…ç½®æ–‡ä»¶åˆ°/etc/fdfs ç›®å½•ï¼š</p><pre>cp /fastdfs-nginx-module/src/http.conf /etc/fdfs/cp /fastdfs-nginx-module/src/mime.types /etc/fdfs/</pre><p>é…ç½®nginxï¼Œä¿®æ”¹nginx.confï¼š</p><pre>location ~/group([0-9])/M00 { ngx_fastdfs_module;}</pre><p>å¯åŠ¨Nginxï¼š</p><pre>[root@iz2ze7tgu9zb2gr6av1tysz sbin]# ./nginxngx_http_fastdfs_set pid=9236</pre><p>æµ‹è¯•ä¸Šä¼ ï¼š</p><pre>[root@iz2ze7tgu9zb2gr6av1tysz fdfs]# /usr/bin/fdfs_upload_file /etc/fdfs/client.conf /etc/fdfs/4.jpggroup1/M00/00/00/rBD8EFqVACuAI9mcAAC_ornlYSU088.jpg</pre><p>éƒ¨ç½²ç»“æ„å›¾ï¼š</p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ee55bfdb87f6471498455185dfd98de9><p class=pgc-img-caption></p></div><p>JAVA å®¢æˆ·ç«¯é›†æˆ</p><p>pom.xmlå¼•å…¥ï¼š</p><pre>&lt;!-- fastdfs --&gt;&lt;dependency&gt;	&lt;groupId&gt;org.csource&lt;/groupId&gt;	&lt;artifactId&gt;fastdfs-client-java&lt;/artifactId&gt;	&lt;version&gt;1.27&lt;/version&gt;&lt;/dependency&gt;</pre><p>fdfs_client.confé…ç½®ï¼š</p><pre>#è¿æ¥trackeræœåŠ¡å™¨è¶…æ—¶æ—¶é•¿connect_timeout = 2 #socketè¿æ¥è¶…æ—¶æ—¶é•¿network_timeout = 30#æ–‡ä»¶å†…å®¹ç¼–ç  charset = UTF-8 #trackeræœåŠ¡å™¨ç«¯å£http.tracker_http_port = 8080http.anti_steal_token = nohttp.secret_key = FastDFS1234567890#trackeræœåŠ¡å™¨IPå’Œç«¯å£ï¼ˆå¯ä»¥å†™å¤šä¸ªï¼‰tracker_server = 192.168.1.190:22122 </pre><p>FastDFSClientä¸Šä¼ ç±»ï¼š</p><pre>public class FastDFSClient{	private static final String CONFIG_FILENAME = "D:\\itstyle\\src\\main\\resources\\fdfs_client.conf";	private static final String GROUP_NAME = "market1";	private TrackerClient trackerClient = null; private TrackerServer trackerServer = null; private StorageServer storageServer = null; private StorageClient storageClient = null; static{ 	try {			ClientGlobal.init(CONFIG_FILENAME);		} catch (IOException e) {			e.printStackTrace();		} catch (MyException e) {			e.printStackTrace();		} } public FastDFSClient() throws Exception {	 trackerClient = new TrackerClient(ClientGlobal.g_tracker_group);	 trackerServer = trackerClient.getConnection();	 storageServer = trackerClient.getStoreStorage(trackerServer);;	 storageClient = new StorageClient(trackerServer, storageServer); } /** * ä¸Šä¼ æ–‡ä»¶ * @param file æ–‡ä»¶å¯¹è±¡ * @param fileName æ–‡ä»¶å * @return */ public String[] uploadFile(File file, String fileName) { return uploadFile(file,fileName,null); } /** * ä¸Šä¼ æ–‡ä»¶ * @param file æ–‡ä»¶å¯¹è±¡ * @param fileName æ–‡ä»¶å * @param metaList æ–‡ä»¶å…ƒæ•°æ® * @return */ public String[] uploadFile(File file, String fileName, Map&lt;String,String&gt; metaList) { try { byte[] buff = IOUtils.toByteArray(new FileInputStream(file)); NameValuePair[] nameValuePairs = null; if (metaList != null) { nameValuePairs = new NameValuePair[metaList.size()]; int index = 0; for (Iterator&lt;Map.Entry&lt;String,String&gt;&gt; iterator = metaList.entrySet().iterator(); iterator.hasNext();) { Map.Entry&lt;String,String&gt; entry = iterator.next(); String name = entry.getKey(); String value = entry.getValue(); nameValuePairs[index++] = new NameValuePair(name,value); } } return storageClient.upload_file(GROUP_NAME,buff,fileName,nameValuePairs); } catch (Exception e) { e.printStackTrace(); } return null; } /** * è·å–æ–‡ä»¶å…ƒæ•°æ® * @param fileId æ–‡ä»¶ID * @return */ public Map&lt;String,String&gt; getFileMetadata(String groupname,String fileId) { try { NameValuePair[] metaList = storageClient.get_metadata(groupname,fileId); if (metaList != null) { HashMap&lt;String,String&gt; map = new HashMap&lt;String, String&gt;(); for (NameValuePair metaItem : metaList) { map.put(metaItem.getName(),metaItem.getValue()); } return map; } } catch (Exception e) { e.printStackTrace(); } return null; } /** * åˆ é™¤æ–‡ä»¶ * @param fileId æ–‡ä»¶ID * @return åˆ é™¤å¤±è´¥è¿”å›-1ï¼Œå¦åˆ™è¿”å›0 */ public int deleteFile(String groupname,String fileId) { try { return storageClient.delete_file(groupname,fileId); } catch (Exception e) { e.printStackTrace(); } return -1; } /** * ä¸‹è½½æ–‡ä»¶ * @param fileId æ–‡ä»¶IDï¼ˆä¸Šä¼ æ–‡ä»¶æˆåŠŸåè¿”å›çš„IDï¼‰ * @param outFile æ–‡ä»¶ä¸‹è½½ä¿å­˜ä½ç½® * @return */ public int downloadFile(String groupName,String fileId, File outFile) { FileOutputStream fos = null; try { byte[] content = storageClient.download_file(groupName,fileId); fos = new FileOutputStream(outFile); InputStream ips = new ByteArrayInputStream(content);  IOUtils.copy(ips,fos); return 0; } catch (Exception e) { e.printStackTrace(); } finally { if (fos != null) { try { fos.close(); } catch (IOException e) { e.printStackTrace(); } } } return -1; } public static void main(String[] args) throws Exception { 	FastDFSClient client = new FastDFSClient(); 	File file = new File("D:\\23456.png"); String[] result = client.uploadFile(file, "png"); System.out.println(result.length); System.out.println(result[0]); System.out.println(result[1]); }}</pre><p>æ‰§è¡Œmainæ–¹æ³•æµ‹è¯•è¿”å›ï¼š</p><pre>2group1M00/00/00/rBD8EFqTrNyAWyAkAAKCRJfpzAQ227.png</pre><p><strong>å¿…é¡»å…ˆè½¬å‘ï¼Œè½¬å‘ï¼Œè½¬å‘ï¼ŒåŠ â€œå¤§æ•°æ®javaæ¶æ„å¸ˆâ€å…³æ³¨ï¼Œå…³æ³¨ï¼Œç„¶åç§ä¿¡æˆ‘â€œDFSâ€å³å¯å…è´¹è·å–æ›´å¤šèµ„æ–™ä¸‹è½½åœ°å€</strong></p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b061b0d4ad4f4b04880908202540b791><p class=pgc-img-caption></p></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'ç³»ç»Ÿ','FastDFS','æå®š'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>