<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>计算机之间是如何进行通信的？ | 极客快訊</title><meta property="og:title" content="计算机之间是如何进行通信的？ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/2c97ec99285f487ca9cd23f690ef1efd"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fac1ada8.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fac1ada8.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/fac1ada8.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fac1ada8.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fac1ada8.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/fac1ada8.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/fac1ada8.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fac1ada8.html><meta property="article:published_time" content="2020-10-29T21:10:18+08:00"><meta property="article:modified_time" content="2020-10-29T21:10:18+08:00"><meta name=Keywords content><meta name=description content="计算机之间是如何进行通信的？"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/fac1ada8.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>计算机之间是如何进行通信的？</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><blockquote class=pgc-blockquote-abstract><p>作者：逃离地球的小小呆</p><p>原文：https://blog.csdn.net/gui951753/article/details/79386734</p></blockquote><p>目录：</p><p>网络常见术语介绍</p><p>计算机之间是如何互相通信的</p><p>相同网段的通信</p><p>不同网段的通信</p><p>计算机如何访问Internet</p><p>第一步：域名解析</p><p>第二步：打包http报文</p><p>第三步：http触发TCP进程三次握手连接</p><p>第四步：TCP传输HTTP</p><p>第五步:服务器回传自身网页</p><p>第六步：释放TCP连接（四次挥手）</p><p>总结</p><p><br></p><p><strong>网络常见术语介绍</strong></p><p>从一张图看网络参数，我们经常使用网络的人都会见过下面这张图，不过一般情况下大家都不会手动去配置，而是选择自动获取。那么有的时候当我们网络出现故障了，无法自动获取了，可能就需要去手动设置ip，所以还是需要对下面这些参数进行一定的了解的。</p><p><br></p><div class=pgc-img><img alt=计算机之间是如何进行通信的？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2c97ec99285f487ca9cd23f690ef1efd><p class=pgc-img-caption></p></div><p><br></p><p>ip地址：这是一个很大很繁琐的东西，大家只需要知道电脑之间如果想要进行通信，就必须有一个网络地址来识别每一台电脑。就好像我们打电话一样，你要给你女朋友打电话，你就必须知道你女朋友的电话号，你如果想和目的主机通信，你就必须知道目的主机的ip地址。</p><p><br></p><p>子网掩码（subnet mask）：将某个IP地址划分成网络地址和主机地址两部分。通常，我们使用子网掩码和目的Ip进行&运算，来判断目的Ip和自己的ip是否是在同一个局域网内。</p><p><br></p><p>默认网关（default gateway）：我们可以把网关理解为路由器的ip地址。我们把ip地址拟人化，那么网关就是一栋大厦的门卫，所有人进出都要通过他。举个例子，小米路由器的默认网关是192.168.31.1。而TPlink等等的大部分是192.168.0.1或者192.168.1.1。这些路由器所管理的所有主机要访问外网的主机时，就必须要通过他们的默认网关。</p><p><br></p><p>DNS服务器：域名服务器(Domain Name Server)。在Internet上域名与IP地址之间是一一对应的，域名虽然便于人们记忆，但机器之间只能互相认识IP地址，它们之间的转换工作称为域名解析，域名解析需要由专门的域名解析服务器来完成，DNS就是进行域名解析的服务器 。我们可以通俗的把它理解为一个黑盒子，你输入域名，他就会输出这个域名对应的ip地址。网络之间通信还是靠的是ip，但是大多数人记不住这么多Ip,所以我们就想到了一个办法建立一个黑盒子来实现ip和通俗域名之间的转换。</p><p><br></p><p>DHCP服务器：就是能够自动识别当前网络环境，并依照当前网络环境给你分配合适的ip地址的服务器。它的存在就是使手动设置Ip变得更加傻瓜式，实现一键上网。不需要你自己进行手动的配置</p><p></p><p>ping:it术语中的ping类似于下图的声呐设置，如果目的电脑联网，目的电脑会把这个Ping包发送回来。如果目的电脑不联网，则ping包不会返还任何信息。所以在It界会经常使用这个命令来检测电脑是否已经连上网络。</p><p><br></p><div class=pgc-img><img alt=计算机之间是如何进行通信的？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a6bd4de79dd240a1a968bdc9ebce3e24><p class=pgc-img-caption></p></div><p><br></p><p>网段号：我们知道ip由两部分构成 网段号+主机号。当我们使用自身的子网掩码和目的主机进行&运算时，我们就能得出目的主机的网段号，进而判断目的主机与自己是否处在同一个网络中。</p><p><br></p><p>arp: 将已知的ip地址解析为对应的mac地址。（具体请百度）</p><p>集线器、交换机、路由器等设备介绍，请参看我下面的这篇博文。</p><p>https://blog.csdn.net/gui951753/article/details/79402528</p><p>子网划分：对于该知识点的理解，可以参看下面博文：</p><p>https://blog.csdn.net/gui951753/article/details/79412524</p><p><br></p><p><strong>计算机之间是如何互相通信的</strong></p><p><br></p><div class=pgc-img><img alt=计算机之间是如何进行通信的？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/38a4cfe592d34190af9368ef4a4d1c25><p class=pgc-img-caption></p></div><p><br></p><p>从上图我们大概可以看到，小明和小美是处在同一个局域网内的，而小丽和他们都不在一个局域网内,那么肯定就会有两种情况发生，一种是统一局域网之间的通信，还有一种情况就是不同局域网之间的通信。下面就分别对这两种情况进行细致的说明。</p><p><br></p><p><strong>相同网段的通信：</strong></p><p>小明和小美之间通信，其实就相当于小明主机ping10.1.1.3。下面我们来分析一下ping的这个流程。</p><p><br></p><p>1）小明利用自身的子网掩码和小美的ip地址进行&运算，得到小美的网段号。然后小明发现自己和小美处在同一个网络中。</p><p>2）检查自身的arp缓存</p><p><br></p><ul><li>当IP层的ARP高速缓存表中存在目的IP对应的MAC地址时：</li><li>直接封装这个ping包并发送给小美</li><li>当IP层的ARP高速缓存表中不存在目的IP对应的MAC地址时:</li></ul><p><br></p><p>小明按照路由表中的默认接口ETH0发送广播给整个局域网，局域网内的每台主机都收到了这个信息，其他主机都无反应，但是小美这台主机10.1.1.3意识到这是在叫自己。然后采取点对点单播回复小明：我在这里，我的mac地址是xxxx.以后你可以用这个联系方式联系我。小明收到此回复后，保存到自己的通讯录中（arp缓存中），方便下次联系。然后通过刚才记录的小红的mac地址发送ping包，依照类似的步骤，很快小红发出了回信。小明主机收到ping包的返回内容。</p><p><br></p><p><strong>不同网段的通信：（也就是上图中小明和小丽的通信）</strong></p><p>小明ip:10.1.1.2/24</p><p>小丽ip:10.1.2.2/24</p><p><br></p><p>第一步：判断是否在同一个网段</p><p>小明将自己的子网掩码和小丽的ip进行&运算，发现二人不在同一个网络内。小明无法利用上文中的通信手段和小丽进行通信</p><p><br></p><p>第二步：查找路由表</p><p>既然无法直接通信，小明就想有没有别的道路能够到达小丽。于是他查看了自己的路由表，信息如下：</p><p><br></p><div class=pgc-img><img alt=计算机之间是如何进行通信的？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/666eefa54d0d4b3ab9a0a042a7ede413><p class=pgc-img-caption></p></div><p><br></p><p>路由表内并没有小丽的Ip信息。走投无路的小明决定走0.0.0.0这条路，0.0.0.0是默认路由，它的终点站是默认网关。</p><p><br></p><p>第三步：发现网关的mac地址</p><p>小明将网关的ip进行了第一步的操作，发现他们是在同一个网络中，于是利用arp协议小明得到了默认网关的mac地址。</p><p><br></p><p>第四步：发送ping包给网关。</p><p><br></p><p>第五步：网关接收以太网帧。</p><p><br></p><p>第六步：网关路由转发。</p><p><br></p><p>网关ip层查看这个ping包，去路由表里尝试能否匹配到小丽的ip，下面是默认网关的路由表信息。</p><p><br></p><div class=pgc-img><img alt=计算机之间是如何进行通信的？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5aa17dbe76d04a649d48bb8a86237be1><p class=pgc-img-caption></p></div><p>刚好路由表里的第二条匹配到了小丽的网段号，到达下一条的方式是广播，所以网关开始发送ARP广播，并得到了小丽的mac地址，于是网关将这个ping包发送给了小丽。</p><p><br></p><p>第七步：ping包弹回</p><p>小丽收到这个ping包后，不修改任何内容，重复第一步到第六步的内容，将这个ping包发送给了小明。</p><p><br></p><p>第八步：ping程序打印输出。</p><p><br></p><div class=pgc-img><img alt=计算机之间是如何进行通信的？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/bf1e979990ff4627a9d4563cc385a118><p class=pgc-img-caption></p></div><p><br></p><p>上图是我用自己主机ping百度得到的结果，而小明电脑上将会收到跟我这个类似的结果。</p><p><br></p><p><strong>计算机如何访问Internet</strong></p><p><br></p><div class=pgc-img><img alt=计算机之间是如何进行通信的？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7df71fa308f74cc492e688a41e6c3c29><p class=pgc-img-caption></p></div><p><br></p><p>上图是我和室友在教室的网络拓扑图。下面我们来探讨下，阿呆，ip：172.18.0.200是如何访问百度服务器的，其过程是怎样的。</p><p><br></p><p>当阿呆想要上百度的时候,阿呆就在浏览器中输入www.baidu.com，那么接下来，电脑，路由器，以及百度服务器都做了什么呢？</p><p><br></p><p><strong>第一步：域名解析</strong></p><p>首先浏览器（程序）告诉DNS进程（程序）请帮我解析www.baidu.com的ip地址,然后才有一下dns的一系列操作。</p><p><br></p><p>①用户主机上运行着DNS的客户端，就是我们的PC机或者手机客户端运行着DNS客户端了。</p><p>②浏览器将接收到的url中抽取出域名字段，就是访问的主机名，比如我现在要访问百度：http://www.baidu.com/, 并将这个主机名传送给DNS应用的客户端。</p><p>③DNS客户机端向DNS服务器端发送一份查询报文，报文中包含着要访问的主机名字段（中间包括一些列缓存查询以及分布式DNS集群的工作）。</p><p>④该DNS客户机最终会收到一份回答报文，其中包含有该主机名对应的IP地址。</p><p>⑤一旦该浏览器收到来自DNS的IP地址，就可以向该IP地址定位的HTTP服务器发起TCP连接。</p><p><br></p><p>其实也就是通过dns服务器，使我们能获取到域名背后的ip地址。</p><p><br></p><p><strong>第二步：打包http报文</strong></p><p><br></p><div class=pgc-img><img alt=计算机之间是如何进行通信的？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ade00c94f8324802a52b6143fdd49256><p class=pgc-img-caption></p></div><p><br></p><p>如上图所示浏览器将阿呆访问百度的请求打包成http报文，然后浏览器将这份报文和百度服务器的ip交给tcp进程。tcp进程虽然知道了目的Ip地址，但是觉得不安全，不敢发出去，他觉得先发个ip包看看能不能收到比较好一点儿，于是有了第三步，TCP三次握手。</p><p><br></p><p><strong>第三步：http触发TCP进程三次握手连接</strong></p><p>首先，我们来看一个简单的示意图，阿呆和百度服务器进行了三次对话.</p><p><br></p><div class=pgc-img><img alt=计算机之间是如何进行通信的？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/72190b81d2c0406c8c27aae8344c61f0><p class=pgc-img-caption></p></div><p><br></p><p>通话A_阿呆to服务器：老铁，有空嘛，听到请回答。</p><p>通话B_服务器to阿呆：阿呆，我听得到，你能听到我嘛？</p><p>由通话A和通话B，我们能够确定阿呆to服务器这条信道是通的。</p><p>通话C_阿呆to服务器：我也听得到你</p><p>同理，由通话B和通话C，我们能够确定服务器to阿呆这条信道是通的</p><p><br></p><p>问题：为什么是三次握手，而不是二次或四次。谈一下自己的理解：</p><p>两次握手：只能确定阿呆能发给百度信息，百度能收到，有可能百度to阿呆的信道是不通的，就有可能出现下面的情形：</p><p></p><div class=pgc-img><img alt=计算机之间是如何进行通信的？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8d8bb919387247dea56535a9fb9a5789><p class=pgc-img-caption></p></div><p><br></p><p>因为信道不通，不知道对方喜欢自己，导致默默流泪，孤独终老。</p><p><br></p><p>四次握手：我们通过三次就能够知道阿呆和百度之间是能够互相通信的，多增加一次握手，没有任何实际意义。</p><p><br></p><p>三次是保证双方互相明确对方能收能发的最低值。再往上加握手次数不过是提高“它是可用的”这个结论的可信程度。在ip进程的眼里，三次握手就是三个ip包，也就是说，我们在传送数据之前，就花费了三个ip包的代价。</p><p><br></p><p><strong>第四步：TCP传输HTTP。到了这一步TCP真正开始传输数据了。</strong></p><p><br></p><p>首先TCP把阿呆要访问百度服务器的请求打包成一个ip包，然后发送给服务器，这个ip包里面不但有阿呆的请求，还有一个唯一的序列号.比如序列号为9527。服务器收到请求的ip包后，回传一个ip包，告诉阿呆，我收到序列号为9527的Ip包了。我们由此知道这个序列好的作用就是让阿呆知道服务器确实收到了请求ip包而不是其他ip包。</p><p><br></p><p>上述过程涉及到了两个ip包，一个是阿呆发送的内容为”请求访问服务器”的ip包，另一个是服务器发送的内容为”收到你的请求”的ip包。</p><p><br></p><p>这两个ip包总共传送了一个数据，就是请求访问服务器。服务器发送的IP包，主要是为了发送确认收到。</p><p><br></p><p><strong>第五步:服务器回传自身网页。</strong></p><p><br></p><div class=pgc-img><img alt=计算机之间是如何进行通信的？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d14258288ce64073917a577a649fac30><p class=pgc-img-caption></p></div><p><br></p><p>百度服务器开始把自己的主页内容，也就是上图的内容回传给阿呆，我们假设百度回传的内容只有一个ip包（实际可能很多）那么回传的过程也很好理解，类似于第四步，一个ip包的内容是要发送的数据，一个ip发送的内容是：确认收到。服务器发送内容为百度主页的ip包，阿呆发送内容为“确认收到”的ip包。</p><p><br></p><p>同样，这两个ip包也只发送了一个数据，这个数据是百度的主页内容。简而言之,tcp的可靠传输机制就是己方发送数据，对方发送确认。</p><p><br></p><p><strong>第六步：释放TCP连接（四次挥手）。</strong></p><p><br></p><p>tcp连接是耗费资源的，包括内存资源和端口资源，所以当我们传输完数据之后，是时候说再见了，于是我们就有了四次挥手说拜拜。</p><p><br></p><div class=pgc-img><img alt=计算机之间是如何进行通信的？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/301ab1099bee45ce8937e6c51ac70cf6><p class=pgc-img-caption></p></div><p><br></p><p>为了方便我们更好地理解tcp。我们可以把tcp连接看成两根水管儿，如上图所示，一个蓝水管，一个红水管。对于阿呆而言，蓝水管是出水管负责发送数据给服务器，而红水管是进水管负责接收来自于服务器的数据，对于服务器而言，蓝水管是进水管负责接收阿呆发的数据，红水管是出水管负责给阿呆发送数据。</p><p><br></p><p>我们关闭TCP连接，其实就是要关闭这两根水管。我们利用四次对话来关闭这两根管道。</p><p><br></p><p>通话A_阿呆to服务器：老铁，我没水(数据)要送了，准备关出水管了（蓝水管）（服务器的进水管）。</p><p><br></p><p>通话B_服务器to阿呆：阿呆啊，你的所有水，我都接收完毕，你可以关掉蓝水管了。</p><p><br></p><p>于是，阿呆就关掉了他的出水管（蓝水管）。</p><p><br></p><p>通话C_服务器to阿呆：阿呆啊，我没水要送了，准备关出水管了（红水管）（阿呆的进水管）。</p><p><br></p><p>通话D_阿呆to服务器：老哥，你的出水管里的水(数据)我已经接收完毕，请放心关闭。</p><p><br></p><p>于是，服务器就关掉了他的出水管（红水管）。到此为止，TCP进程释放资源完毕。</p><p><br></p><p>从tcp建立连接到tcp释放连接我们一共用了11个ip包。tcp建立连接（三次握手）用了3个包；tcp传送数据用了4个包，其中两个用于传送数据，两个用来确认收到数据；关闭tcp连接（四次挥手）用了4个包。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'计算机','之间','进行'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>