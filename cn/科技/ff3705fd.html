<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFSå®‰è£…éƒ¨ç½²(é«˜å¯ç”¨) | æå®¢å¿«è¨Š</title><meta property="og:title" content="åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFSå®‰è£…éƒ¨ç½²(é«˜å¯ç”¨) - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/cb2346c189b7453fa0d3b98ad3c71cee"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ff3705fd.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ff3705fd.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ff3705fd.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ff3705fd.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ff3705fd.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ff3705fd.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ff3705fd.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ff3705fd.html><meta property="article:published_time" content="2020-11-14T21:03:23+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:23+08:00"><meta name=Keywords content><meta name=description content="åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFSå®‰è£…éƒ¨ç½²(é«˜å¯ç”¨)"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/ff3705fd.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFSå®‰è£…éƒ¨ç½²(é«˜å¯ç”¨)</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>æœ¬æ–‡ä¼šæ­å»ºä¸€ä¸ªé€‚åˆä½ä¸šåŠ¡è®¿é—®ä¸šåŠ¡é‡çš„é«˜å¯ç”¨çš„FastDFSé›†ç¾¤ç¯å¢ƒï¼šä¸¤ä¸ªTrackeræœåŠ¡ï¼Œä¸€ä¸ªstorage groupä¸­ä¸¤ä¸ªstorageæœåŠ¡èŠ‚ç‚¹ï¼›è¯¥æ–¹æ¡ˆä»…é€‚ç”¨äºä¸šåŠ¡è®¿é—®é‡è¾ƒä½çš„ç¯å¢ƒä¸‹ã€‚å¯¹äºå¤§é‡ä¸šåŠ¡ç³»ç»Ÿçš„é«˜å¹¶å‘è®¿é—®ï¼Œä¸ºäº†ä¿è¯å­˜å‚¨ç³»ç»Ÿæ­£å¸¸å·¥ä½œä¸€èˆ¬çš„æ¶æ„æ€è·¯ï¼šå®‰è£…å¤šä¸ªTrackeræœåŠ¡(è‡³å°‘ä¸¤ä¸ªï¼Œæ ¹æ®ä¸šåŠ¡é‡è°ƒæ•´)ï¼Œæ­å»ºå¤šä¸ªstorage group(è‡³å°‘ä¸¤ä¸ªï¼Œæ ¹æ®ä¸šåŠ¡é‡è°ƒæ•´)ï¼Œæ¯ä¸ªstorage groupä¸­å¤šä¸ªstorage node(è‡³å°‘ä¸¤ä¸ªï¼Œåšæ•°æ®çš„å†—ä½™å¤‡ä»½ï¼Œè¿›è¡Œå®¹ç¾æœºåˆ¶ï¼Œè€Œä¸”nodeå¿…é¡»åœ¨ä¸åŒçš„æœºå™¨ä¸Š)</p><p><strong>ä¸€ã€FastDFSç®€ä»‹</strong></p><p>FastDFSæ˜¯ä¸€ä¸ªå¼€æºçš„è½»é‡çº§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒå¯¹æ–‡ä»¶è¿›è¡Œç®¡ç†ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼šæ–‡ä»¶å­˜å‚¨ã€æ–‡ä»¶åŒæ­¥ã€æ–‡ä»¶è®¿é—®ï¼ˆæ–‡ä»¶ä¸Šä¼ ã€æ–‡ä»¶ä¸‹è½½ï¼‰ç­‰ï¼Œè§£å†³äº†å¤§å®¹é‡å­˜å‚¨å’Œè´Ÿè½½å‡è¡¡çš„é—®é¢˜ã€‚ç‰¹åˆ«é€‚åˆä»¥æ–‡ä»¶ä¸ºè½½ä½“çš„åœ¨çº¿æœåŠ¡ï¼Œå¦‚ç›¸å†Œç½‘ç«™ã€è§†é¢‘ç½‘ç«™ç­‰ç­‰ã€‚</p><p>FastDFSä¸ºäº’è”ç½‘é‡èº«å®šåˆ¶ï¼Œå……åˆ†è€ƒè™‘äº†å†—ä½™å¤‡ä»½ã€è´Ÿè½½å‡è¡¡ã€çº¿æ€§æ‰©å®¹ç­‰æœºåˆ¶ï¼Œå¹¶æ³¨é‡é«˜å¯ç”¨ã€é«˜æ€§èƒ½ç­‰æŒ‡æ ‡ï¼Œä½¿ç”¨FastDFSå¾ˆå®¹æ˜“æ­å»ºä¸€å¥—é«˜æ€§èƒ½çš„æ–‡ä»¶æœåŠ¡å™¨é›†ç¾¤æä¾›æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ç­‰æœåŠ¡ã€‚</p><p>FastDFSæœåŠ¡ç«¯æœ‰ä¸¤ä¸ªè§’è‰²ï¼šè·Ÿè¸ªå™¨ï¼ˆtrackerï¼‰å’Œå­˜å‚¨èŠ‚ç‚¹ï¼ˆstorageï¼‰ã€‚è·Ÿè¸ªå™¨ä¸»è¦åšè°ƒåº¦å·¥ä½œï¼Œåœ¨è®¿é—®ä¸Šèµ·è´Ÿè½½å‡è¡¡çš„ä½œç”¨ã€‚</p><p>å­˜å‚¨èŠ‚ç‚¹å­˜å‚¨æ–‡ä»¶ï¼Œå®Œæˆæ–‡ä»¶ç®¡ç†çš„æ‰€æœ‰åŠŸèƒ½ï¼šå°±æ˜¯è¿™æ ·çš„å­˜å‚¨ã€åŒæ­¥å’Œæä¾›å­˜å–æ¥å£ï¼ŒFastDFSåŒæ—¶å¯¹æ–‡ä»¶çš„metadataè¿›è¡Œç®¡ç†ã€‚æ‰€è°“æ–‡ä»¶çš„meta dataå°±æ˜¯æ–‡ä»¶çš„ç›¸å…³å±æ€§ï¼Œä»¥é”®å€¼å¯¹ï¼ˆkey valueï¼‰æ–¹å¼è¡¨ç¤ºï¼Œå¦‚ï¼šwidth=1024ï¼Œå…¶ä¸­çš„keyä¸ºwidthï¼Œvalueä¸º1024ã€‚æ–‡ä»¶metadataæ˜¯æ–‡ä»¶å±æ€§åˆ—è¡¨ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªé”®å€¼å¯¹ã€‚</p><p>è·Ÿè¸ªå™¨å’Œå­˜å‚¨èŠ‚ç‚¹éƒ½å¯ä»¥ç”±ä¸€å°æˆ–å¤šå°æœåŠ¡å™¨æ„æˆã€‚è·Ÿè¸ªå™¨å’Œå­˜å‚¨èŠ‚ç‚¹ä¸­çš„æœåŠ¡å™¨å‡å¯ä»¥éšæ—¶å¢åŠ æˆ–ä¸‹çº¿è€Œä¸ä¼šå½±å“çº¿ä¸ŠæœåŠ¡ã€‚å…¶ä¸­è·Ÿè¸ªå™¨ä¸­çš„æ‰€æœ‰æœåŠ¡å™¨éƒ½æ˜¯å¯¹ç­‰çš„ï¼Œå¯ä»¥æ ¹æ®æœåŠ¡å™¨çš„å‹åŠ›æƒ…å†µéšæ—¶å¢åŠ æˆ–å‡å°‘ã€‚</p><p>ä¸ºäº†æ”¯æŒå¤§å®¹é‡ï¼Œå­˜å‚¨èŠ‚ç‚¹ï¼ˆæœåŠ¡å™¨ï¼‰é‡‡ç”¨äº†åˆ†å·ï¼ˆæˆ–åˆ†ç»„ï¼‰çš„ç»„ç»‡æ–¹å¼ã€‚å­˜å‚¨ç³»ç»Ÿç”±ä¸€ä¸ªæˆ–å¤šä¸ªå·ç»„æˆï¼Œå·ä¸å·ä¹‹é—´çš„æ–‡ä»¶æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ‰€æœ‰å·çš„æ–‡ä»¶å®¹é‡ç´¯åŠ å°±æ˜¯æ•´ä¸ªå­˜å‚¨ç³»ç»Ÿä¸­çš„æ–‡ä»¶å®¹é‡ã€‚ä¸€ä¸ªå·å¯ä»¥ç”±ä¸€å°æˆ–å¤šå°å­˜å‚¨æœåŠ¡å™¨ç»„æˆï¼Œä¸€ä¸ªå·ä¸‹çš„å­˜å‚¨æœåŠ¡å™¨ä¸­çš„æ–‡ä»¶éƒ½æ˜¯ç›¸åŒçš„ï¼Œå·ä¸­çš„å¤šå°å­˜å‚¨æœåŠ¡å™¨èµ·åˆ°äº†å†—ä½™å¤‡ä»½å’Œè´Ÿè½½å‡è¡¡çš„ä½œç”¨ã€‚</p><p>åœ¨å·ä¸­å¢åŠ æœåŠ¡å™¨æ—¶ï¼ŒåŒæ­¥å·²æœ‰çš„æ–‡ä»¶ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆï¼ŒåŒæ­¥å®Œæˆåï¼Œç³»ç»Ÿè‡ªåŠ¨å°†æ–°å¢æœåŠ¡å™¨åˆ‡æ¢åˆ°çº¿ä¸Šæä¾›æœåŠ¡ã€‚</p><p>å½“å­˜å‚¨ç©ºé—´ä¸è¶³æˆ–å³å°†è€—å°½æ—¶ï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ å·ã€‚åªéœ€è¦å¢åŠ ä¸€å°æˆ–å¤šå°æœåŠ¡å™¨ï¼Œå¹¶å°†å®ƒä»¬é…ç½®ä¸ºä¸€ä¸ªæ–°çš„å·ï¼Œè¿™æ ·å°±æ‰©å¤§äº†å­˜å‚¨ç³»ç»Ÿçš„å®¹é‡ã€‚</p><p>FastDFSä¸­çš„æ–‡ä»¶æ ‡è¯†åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šå·åå’Œæ–‡ä»¶åï¼ŒäºŒè€…ç¼ºä¸€ä¸å¯ã€‚</p><p>â€”â€”â€”ç®€ä»‹æ‘˜è‡ªç™¾åº¦ç™¾ç§‘</p><p><strong>äºŒã€FastDFSåŸç†ä»‹ç»</strong></p><p>1.æ–‡ä»¶ä¸Šä¼ </p><p>FastDFSä»¥å®¢æˆ·ç«¯åº“çš„æ–¹å¼æä¾›åŸºæœ¬çš„æ–‡ä»¶è®¿é—®æ¥å£å¦‚uploadã€downloadã€appendã€deleteç­‰ï¼ŒStorage æœåŠ¡ä¼šå®šæ—¶çš„å‘TrackeræœåŠ¡å‘é€è‡ªå·±çš„å­˜å‚¨ä¿¡æ¯ã€‚å½“Tracker æœåŠ¡é›†ç¾¤ä¸­çš„Tracker æœåŠ¡æ˜¯å¤šä¸ªæ—¶ï¼Œå„ä¸ªTrackeræœåŠ¡ä¹‹é—´çš„å…³ç³»æ˜¯å¯¹ç­‰çš„ï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸Šä¼ æ—¶ä¼šä»»æ„é€‰æ‹©ä¸€ä¸ªTrackreæœåŠ¡ã€‚å½“TrackeræœåŠ¡æ”¶åˆ°å®¢æˆ·ç«¯ä¸Šä¼ æ–‡ä»¶è¯·æ±‚æ—¶ï¼Œä¼šä¸ºè¯¥æ–‡ä»¶åˆ†é…ä¸€ä¸ªå¯ä»¥å­˜å‚¨æ–‡ä»¶çš„groupï¼Œå½“é€‰å®šäº†groupåå°±è¦å†³å®šç»™å®¢æˆ·ç«¯åˆ†é…groupä¸­çš„å“ªä¸€ä¸ªstorageæœåŠ¡ã€‚å½“åˆ†é…å¥½storage æœåŠ¡åï¼Œå®¢æˆ·ç«¯å‘storageå‘é€å†™æ–‡ä»¶è¯·æ±‚ï¼Œstorageå°†ä¼šä¸ºæ–‡ä»¶åˆ†é…ä¸€ä¸ªæ•°æ®å­˜å‚¨ç›®å½•ã€‚ç„¶åä¸ºæ–‡ä»¶åˆ†é…ä¸€ä¸ªæ–‡ä»¶IDæ ‡ç¤ºï¼Œç„¶åæ ¹æ®ä»¥ä¸Šçš„ä¿¡æ¯ç”Ÿæˆæ–‡ä»¶åå­˜å‚¨æ–‡ä»¶ã€‚</p><p>2.æ–‡ä»¶åŒæ­¥</p><p>ä¸Šä¼ æ–‡ä»¶åï¼Œå®¢æˆ·ç«¯å°†æ–‡ä»¶å†™åˆ°groupå†…çš„ä¸€ä¸ªstorage æœåŠ¡å³ä¸ºä¸Šä¼ æ–‡ä»¶æˆåŠŸï¼ŒstorageæœåŠ¡å†™å®Œæ–‡ä»¶åï¼Œä¼šç”±åå°çº¿ç¨‹å°†æ–‡ä»¶åŒæ­¥è‡³åŒgroupå†…çš„å…¶ä»–çš„storage æœåŠ¡èŠ‚ç‚¹ä¸Šã€‚ æ¯ä¸ªstorageæœåŠ¡å†™æ–‡ä»¶åï¼Œä¼šåŒæ—¶å†™ä¸€ä»½binlogï¼Œbinlogé‡Œä¸åŒ…å«æ–‡ä»¶æ•°æ®ï¼ŒåªåŒ…å«æ–‡ä»¶åç­‰å…ƒä¿¡æ¯ï¼Œè¿™ä»½binlogç”¨äºåå°åŒæ­¥ï¼Œstorageä¼šè®°å½•å‘groupå†…å…¶ä»–storageåŒæ­¥çš„è¿›åº¦ï¼Œä»¥ä¾¿é‡å¯åèƒ½æ¥ä¸Šæ¬¡çš„è¿›åº¦ç»§ç»­åŒæ­¥ï¼›è¿›åº¦ä»¥æ—¶é—´æˆ³çš„æ–¹å¼è¿›è¡Œè®°å½•ï¼Œæ‰€ä»¥æœ€å¥½èƒ½ä¿è¯é›†ç¾¤å†…çš„æ‰€æœ‰serverçš„å§‹ç»ˆä¿æŒåŒæ­¥ã€‚æœ€åStorageæœåŠ¡çš„åŒæ­¥è¿›åº¦ä¼šä½œä¸ºå…ƒæ•°æ®çš„ä¸€éƒ¨åˆ†æ±‡æŠ¥åˆ°trackeræœåŠ¡ä¸Šï¼ŒtrackeræœåŠ¡åœ¨é€‰æ‹©è¯»storageçš„æ—¶å€™ä¼šä»¥åŒæ­¥è¿›åº¦ä½œä¸ºå‚è€ƒæŒ‡æ ‡ã€‚</p><p>3.ä¸‹è½½æ–‡ä»¶</p><p>å½“ä¸‹è½½æ–‡ä»¶æ—¶ï¼Œå®¢æˆ·ç«¯å…ˆè¯¢é—®trackeræœåŠ¡ä¸‹è½½æ–‡ä»¶çš„storageï¼Œå‚æ•°ä¸ºæ–‡ä»¶æ ‡è¯†ï¼ˆå·åå’Œæ–‡ä»¶åï¼‰ï¼›ç„¶åtrackerå‘å®¢æˆ·ç«¯è¿”å›ä¸€å°å¯ç”¨çš„storageï¼›æœ€åå®¢æˆ·ç«¯ç›´æ¥å’Œstorageé€šè®¯å®Œæˆæ–‡ä»¶ä¸‹è½½ã€‚</p><p><strong>ä¸‰ã€éƒ¨ç½²ç¯å¢ƒå‡†å¤‡</strong></p><p>1.ç¯å¢ƒè¯´æ˜</p><p>æ“ä½œç³»ç»ŸCentOS7.6</p><p>fastdfsç‰ˆæœ¬ï¼š6.01</p><p>nginxç‰ˆæœ¬ï¼š1.16.1</p><p>keepalivedç‰ˆæœ¬ï¼š2.0.19</p><p>2.ç³»ç»Ÿä¾èµ–</p><p>gcc gcc-c++ perl pcre pcre-devel zlib zlib-devel openssl openssl-devel</p><p>3.è½¯ä»¶ç¯å¢ƒ</p><p>libeventä¸‹è½½åœ°å€ï¼šhttp://libevent.org/</p><p>nginxä¸‹è½½åœ°å€ï¼šhttp://nginx.org/en/download.html</p><p>keepalivedä¸‹è½½åœ°å€ï¼šhttps://www.keepalived.org/software/</p><p>fastdfsä¸‹è½½åœ°å€ï¼šhttps://github.com/happyfish100/fastdfs/releases</p><p>libfasttcommonä¸‹è½½åœ°å€ï¼šhttps://github.com/happyfish100/libfastcommon/releases</p><p>fastdfs-nginx-moduleä¸‹è½½åœ°å€ï¼šhttps://github.com/happyfish100/fastdfs-nginx-module/releases</p><p>4.æœºå™¨åŠç½‘ç»œç¯å¢ƒè§„åˆ’</p><pre>Fdfs Server VIPï¼š 192.168.100.110Tracker Server1ï¼š 192.168.100.111Tracker Server2ï¼š 192.168.100.112Storage Group1 Node1ï¼š 192.168.100.111Storage Group1 Node2ï¼š 192.168.100.112</pre><p>5.é˜²ç«å¢™è®¾ç½®</p><p>å…³é—­ç³»ç»Ÿé˜²ç«å¢™ï¼šsudo systemctl stop firewalld && systemctl disable firewalld</p><p><strong>å››ã€KeepalivedæœåŠ¡å®‰è£…é…ç½®</strong></p><p>1.ä¸‹è½½Keepalivedæºç åŒ…</p><p>å®˜ç½‘åœ°å€ï¼šhttps://www.keepalived.org/</p><p>ä¸‹è½½åœ°å€ï¼šhttps://www.keepalived.org/software/keepalived-2.0.19.tar.gz</p><p>2.ä¸Šä¼ å¹¶è§£å‹Keepalivedæºç åŒ…</p><p>tar -zxvf keepalived-2.0.19.tar.gz</p><p>3.ç¼–è¯‘Keepalivedå‡†å¤‡</p><p>è¿›å…¥è§£å‹ç›®å½•ï¼šcd keepalived-2.0.19</p><p>æ‰§è¡Œç¼–è¯‘å‡†å¤‡ï¼š./configure --prefix=/work/keepalived</p><p>æ³¨æ„ï¼šä¸€å®šè¦æœ‰gccå’Œopensslç¼–è¯‘ç›¸å…³çš„ä¾èµ–</p><p>4.ç¼–è¯‘å®‰è£…Keepalived</p><p>make && make install</p><p>5.å®‰è£…é…ç½®Keepalived</p><p>keepalivedå¯åŠ¨æ—¶ä¼šä»/etc/keepalived/ä¸­ç›¸å…³çš„ç›®å½•ä¸‹æŸ¥æ‰¾keepalived.confé…ç½®æ–‡ä»¶ï¼Œå› æ­¤å°†keepalivedå®‰è£…å½•/usr/local/keepalived/etc/keepalived.conf æ‹·è´åˆ°/etc/keepalived/ä¸­ã€‚</p><p>mkdir /etc/keepalived/</p><p>cp /work/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf</p><p>cp /work/keepalived/etc/sysconfig/keepalived /etc/sysconfig/keepalived</p><p>6.è®¾ç½®Keepalivedå¼€æœºå¯åŠ¨é¡¹</p><p>systemctl enable keepalived</p><p>ç„¶åå°±èƒ½ä½¿ç”¨systemctl start/stop/status keepalivedç®¡ç†keepalivedäº†</p><p>7.é…ç½®KeepalivedæœåŠ¡</p><p>192.168.100.111æœºå™¨ä¸Šé…ç½®ï¼švi /etc/keepalived/keepalived.conf</p><pre>vrrp_script check_nginx { interval 3 script "/work/script/check_nginx.sh"} vrrp_instance fdfs_server { state MASTER interface enp0s3 virtual_router_id 110 priority 100 advert_int 3 authentication { auth_type PASS auth_pass password } virtual_ipaddress { 192.168.100.110 } track_script { check_nginx }}</pre><p>192.168.100.112æœºå™¨ä¸Šé…ç½®ï¼švi /etc/keepalived/keepalived.conf</p><pre>vrrp_script check_nginx { interval 3 script "/work/script/check_nginx.sh"} vrrp_instance fdfs_server { state BACKUP interface enp0s3 virtual_router_id 110 priority 90 advert_int 3 authentication { auth_type PASS auth_pass password } virtual_ipaddress { 192.168.100.110 } track_script { check_nginx }}</pre><p>8.ç¼–å†™nginxæœåŠ¡æ£€æµ‹è„šæœ¬</p><p>vi /work/script/check_nginx.sh</p><pre>#!/bin/bashactive_status=`netstat -lntp|grep nginx|wc -l`if [ $active_status -gt 0 ]; then exit 0else exit 1fi</pre><p>ç„¶åç»™è„šæœ¬èµ‹äºˆæ‰§è¡Œæƒé™ï¼šchmod +x /work/script/check_nginx.sh</p><p>9.ä¿®æ”¹å†…æ ¸å‚æ•°</p><p>vi /etc/sysctl.conf</p><p>å¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><pre>net.ipv4.ip_nonlocal_bind = 1 #å…è®¸å¿½è§†VIPçš„å­˜åœ¨net.ipv4.ip_forward = 1 #å…è®¸è½¬å‘</pre><p>sysctl --system ä½¿é…ç½®ç”Ÿæ•ˆ</p><p><strong>äº”ã€å®‰è£…FastDFSä¾èµ–åº“</strong></p><p>1.å®‰è£…libeventä¾èµ–</p><p>è§£å‹libeventæºç åŒ…ï¼štar -zxvf libevent-2.1.11-stable.tar.gz</p><p>è¿›å…¥æºç ç›®å½•ï¼šcd libevent-2.1.11-stable</p><p>ç¼–è¯‘å®‰è£…å‰é…ç½®ï¼š./configure</p><p>ç¼–è¯‘å®‰è£…ï¼šmake && make install</p><p>é»˜è®¤å®‰è£…ä½ç½®ï¼š/usr/local/lib</p><p>2.å®‰è£…libfasttcommonä¾èµ–</p><p>è§£å‹libfasttcommonæºç åŒ…ï¼štar -zxvf libfastcommon-1.0.41.tar.gz</p><p>è¿›å…¥æºç ç›®å½•ï¼šcd libfastcommon-1.0.41</p><p>ç¼–è¯‘å®‰è£…ï¼š./make.sh && ./make.sh install</p><p>é»˜è®¤å®‰è£…ä½ç½®ï¼š/usr/lib64</p><p><strong>å…­ã€å®‰è£…éƒ¨ç½²TrackeræœåŠ¡å’ŒStorageæœåŠ¡</strong></p><p>1.å®‰è£…fastdfsæœåŠ¡</p><p>è§£å‹fastdfsæºç åŒ…ï¼štar -zxvf fastdfs-6.01.tar.gz</p><p>è¿›å…¥fastdfsæºç åŒ…ï¼šcd fastdfs-6.01</p><p>ç¼–è¯‘å®‰è£…ï¼š./make.sh && ./make.sh install</p><p>2.fastdfsæœåŠ¡ç›®å½•ä¿¡æ¯</p><p>å®‰è£…å®ŒæˆåæœåŠ¡åŠè„šæœ¬æ‹·è´åˆ°/usr/bin ç›®å½•ï¼Œé…ç½®æ–‡ä»¶æ‹·è´åˆ°/etc/fdfsç›®å½•ï¼Œå¯åŠ¨è„šæœ¬æ‹·è´åˆ°/etc/init.d/ç›®å½•</p><p>3.æ³¨å†Œå¼€æœºå¯åŠ¨</p><p>chkconfig --add fdfs_trackerd</p><p>chkconfig fdfs_trackerd on</p><p>chkconfig --add fdfs_storaged</p><p>chkconfig fdfs_storaged on</p><p>4.æ•°æ®ç›®å½•è§„åˆ’</p><p>åˆ›å»ºfdfsæ•°æ®ä¸»ç›®å½•ï¼šmkdir /work/fdfs</p><p>åˆ›å»ºtrackeræ•°æ®ç›®å½•ï¼šmkdir /work/fdfs/tracker</p><p>åˆ›å»ºstorageæ•°æ®ç›®å½•ï¼šmkdir /work/fdfs/storage</p><p>5.é…ç½®trackeræœåŠ¡</p><p>å°†/etc/fdfsç›®å½•ä¸‹çš„tracker.conf.sampleæ”¹ä¸ºtracker.confï¼šmv tracker.conf.sample tracker.confä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š</p><p>å°†base_path=/home/yuqing/fastdfs æ”¹ä¸ºï¼š/work/fdfs/tracker(è¯¥ç›®å½•ä¸ºä¸Šé¢å®šä¹‰åˆ›å»º)</p><p>å¯åŠ¨TrackeræœåŠ¡ï¼šsystemctl start fdfs_trackerd</p><p>6.é…ç½®storageæœåŠ¡</p><p>å°†/etc/fdfsç›®å½•ä¸‹çš„storage.conf.sampleæ”¹ä¸ºstorage.confï¼šmv storage.conf.sample storage.confä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š</p><p>base_path=/home/yuqing/fastdfs æ”¹ä¸ºï¼šbase_path=/work/fdfs/storage(è¯¥ç›®å½•ä¸ºä¸Šé¢å®šä¹‰åˆ›å»º)</p><p>store_path0=/home/yuqing/fastdfs æ”¹ä¸ºï¼šstore_path0=/work/fdfs/storage(è¯¥ç›®å½•ä¸ºä¸Šé¢å®šä¹‰åˆ›å»º)</p><p>tracker_server=192.168.209.121:22122 æ”¹ä¸ºï¼štracker_server=192.168.100.111:22122å’Œtracker_server=192.168.100.112:22122</p><p>å°†/etc/fdfs/torage_ids.conf.sample ä¸ºstorage_ids.confï¼Œå†…å®¹ä¿®æ”¹ä¸ºå½“å‰groupçš„storageèŠ‚ç‚¹ä¿¡æ¯ï¼š</p><p>100001 group1 192.168.100.111</p><p>100002 group1 192.168.100.112</p><p>å¯åŠ¨StorageæœåŠ¡ï¼šsystemctl start fdfs_storaged</p><p><strong>ä¸ƒã€NginxæœåŠ¡å®‰è£…é…ç½®</strong></p><p>1.ä¸‹è½½Nginxæºç åŒ…</p><p>å®˜ç½‘åœ°å€ï¼šhttp://nginx.org/</p><p>ä¸‹è½½åœ°å€ï¼šhttp://nginx.org/en/download.html</p><p>2.ä¸Šä¼ å¹¶è§£å‹Nginxæºç åŒ…åŠfastdfsæ’ä»¶åŒ…</p><p>tar -zxvf nginx-1.16.1.tar.gz</p><p>tar -zxvf fastdfs-nginx-module-1.21.tar.gz</p><p>3.ç¼–è¯‘Nginxå‡†å¤‡</p><p>è¿›å…¥è§£å‹ç›®å½•ï¼šcd nginx-1.16.1</p><p>æ‹·è´fastdfsæ’ä»¶åŒ…åˆ°nginxæºç ç›®å½•ï¼šmv ../fastdfs-nginx-module-1.21 .</p><p>æ‰§è¡Œç¼–è¯‘å‡†å¤‡ï¼š./configure --prefix=/work/nginx \--with-stream \--add-module=fastdfs-nginx-module-1.21/src</p><p>æ³¨æ„ï¼šä¸€å®šè¦æœ‰gccå’Œopensslç¼–è¯‘ç›¸å…³çš„ä¾èµ–</p><p>4.ç¼–è¯‘å®‰è£…Nginx</p><p>make && make install</p><p>5.æ³¨å†Œåˆ°ç³»ç»ŸæœåŠ¡</p><p>vi /usr/lib/systemd/system/nginx.service</p><pre>[Unit]Description=nginxDocumentation=http://nginx.org/en/docs/After=network.target[Service]Type=forkingPIDFile=/work/nginx/logs/nginx.pidExecStartPre=/work/nginx/sbin/nginx -t -c /work/nginx/conf/nginx.confExecStart=/work/nginx/sbin/nginx -c /work/nginx/conf/nginx.confExecReload=/bin/kill -s HUP $MAINPIDExecStop=/bin/kill -s QUIT $MAINPIDPrivateTmp=true[Install]WantedBy=multi-user.target</pre><p>6.è®¾ç½®Nginxå¼€æœºå¯åŠ¨é¡¹</p><p>systemctl enable nginx</p><p>ç„¶åå°±èƒ½ä½¿ç”¨systemctl start/stop/status nginxç®¡ç†nginxäº†</p><p>7.ä¿®æ”¹Nginxé…ç½®</p><p>vi /work/nginx/conf/nginx.conf</p><pre>#user nobody;worker_processes 1;#error_log logs/error.log;#error_log logs/error.log notice;#error_log logs/error.log info;#pid logs/nginx.pid;events { worker_connections 1024;}stream { upstream tracker { server 192.168.100.111:22122 weight=1 max_fails=2 fail_timeout=10s; server 192.168.100.112:22122 weight=1 max_fails=2 fail_timeout=10s; } server { listen 7777; proxy_timeout 5m; proxy_pass tracker; proxy_connect_timeout 10s; }}http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; upstream storage { server 192.168.100.111:8888 weight=1 max_fails=2 fail_timeout=10s; server 192.168.100.112:8888 weight=1 max_fails=2 fail_timeout=10s; } server { listen 80; server_name localhost;  location /group1 { proxy_pass http://storage; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; }  error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } server { listen 8888; server_name localhost; location / { alias /work/fdfs/storage/data/; ngx_fastdfs_module; } }}</pre><p>8.é…ç½®nginxçš„fdfsæ’ä»¶</p><p>å°†/etc/fdfsä¸‹çš„http.conf.sampleå’Œmime.types.sampleé‡å‘½åä¸ºï¼šhttp.confå’Œmime.types</p><p>å°†fastdfs-nginx-module-1.21/srcä¸‹çš„mod_fastdfs.confæ‹·è´åˆ°/etc/fdfsä¸‹</p><p>ä¿®æ”¹mod_fastdfs.confå¦‚ä¸‹ï¼š</p><p>è¿æ¥è¶…æ—¶æ—¶é—´ï¼š connect_timeout=5</p><p>TrackeræœåŠ¡åœ°å€ï¼štracker_server=192.168.100.111:22122 å’Œtracker_server=192.168.100.112:22122</p><p>StorageæœåŠ¡ç«¯å£ï¼šstorage_server_port=23000</p><p>å¦‚æœæ–‡ä»¶IDçš„uriä¸­åŒ…å«/group**ï¼Œåˆ™è¦è®¾ç½®ä¸ºtrueï¼šurl_have_group_name = true</p><p>Storageé…ç½®çš„store_path0è·¯å¾„ï¼Œå¿…é¡»å’Œstorage.confä¸­çš„ä¸€è‡´ï¼šstore_path0=/work/fdfs/storage</p><p>å…¶ä»–è¯¦ç»†é…ç½®å¦‚ä¸‹ï¼š</p><pre># connect timeout in seconds# default value is 30sconnect_timeout=5# network recv and send timeout in seconds# default value is 30snetwork_timeout=10# the base path to store log filesbase_path=/work/fdfs/storage# if load FastDFS parameters from tracker server# since V1.12# default value is falseload_fdfs_parameters_from_tracker=true# storage sync file max delay seconds# same as tracker.conf# valid only when load_fdfs_parameters_from_tracker is false# since V1.12# default value is 86400 seconds (one day)storage_sync_file_max_delay = 86400# if use storage ID instead of IP address# same as tracker.conf# valid only when load_fdfs_parameters_from_tracker is false# default value is false# since V1.13use_storage_id = false# specify storage ids filename, can use relative or absolute path# same as tracker.conf# valid only when load_fdfs_parameters_from_tracker is false# since V1.13storage_ids_filename = storage_ids.conf# FastDFS tracker_server can ocur more than once, and tracker_server format is# "host:port", host can be hostname or ip address# valid only when load_fdfs_parameters_from_tracker is truetracker_server=192.168.100.111:22122tracker_server=192.168.100.112:22122# the port of the local storage server# the default value is 23000storage_server_port=23000# the group name of the local storage servergroup_name=group1# if the url / uri including the group name# set to false when uri like /M00/00/00/xxx# set to true when uri like ${group_name}/M00/00/00/xxx, such as group1/M00/xxx# default value is falseurl_have_group_name = true# path(disk or mount point) count, default value is 1# must same as storage.confstore_path_count=1# store_path#, based 0, if store_path0 not exists, it's value is base_path# the paths must be exist# must same as storage.confstore_path0=/work/fdfs/storage# standard log level as syslog, case insensitive, value list:### emerg for emergency### alert### crit for critical### error### warn for warning### notice### info### debuglog_level=info# set the log filename, such as /usr/local/apache2/logs/mod_fastdfs.log# empty for output to stderr (apache and nginx error_log file)log_filename=# response mode when the file not exist in the local file system## proxy: get the content from other storage server, then send to client## redirect: redirect to the original storage server (HTTP Header is Location)response_mode=proxy# the NIC alias prefix, such as eth in Linux, you can see it by ifconfig -a# multi aliases split by comma. empty value means auto set by OS type# this paramter used to get all ip address of the local host# default values is emptyif_alias_prefix=# use "#include" directive to include HTTP config file# NOTE: #include is an include directive, do NOT remove the # before include#include http.conf# if support flv# default value is false# since v1.15flv_support = true# flv file extension name# default value is flv# since v1.15flv_extension = flv# set the group count# set to none zero to support multi-group on this storage server# set to 0 for single group only# groups settings section as [group1], [group2], ..., [groupN]# default value is 0# since v1.14group_count = 1# group settings for group #1# since v1.14# when support multi-group on this storage server, uncomment following section[group1]group_name=group1storage_server_port=23000store_path_count=1store_path0=/work/fdfs/storage# group settings for group #2# since v1.14# when support multi-group, uncomment following section as neccessary#[group2]#group_name=group2#storage_server_port=23000#store_path_count=1#store_path0=/home/yuqing/fastdfs</pre><p><strong>å…«ã€æœåŠ¡å¯åŠ¨åŠéªŒè¯</strong></p><p>åˆ†åˆ«å¯åŠ¨keepaliveã€nginxã€trackerã€storageæœåŠ¡</p><p>æŸ¥çœ‹æœåŠ¡æ˜¯å¦æ­£å¸¸æœåŠ¡ï¼š</p><div class=pgc-img><img alt=åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFSå®‰è£…éƒ¨ç½²(é«˜å¯ç”¨) onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/cb2346c189b7453fa0d3b98ad3c71cee><p class=pgc-img-caption></p></div><p>åœ¨ä»»æ„Storageæœºå™¨ä¸ŠæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼šfdfs_monitor /etc/fdfs/storage.conf</p><div class=pgc-img><img alt=åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸFastDFSå®‰è£…éƒ¨ç½²(é«˜å¯ç”¨) onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9158363a50154d49b8f9d41648645e25><p class=pgc-img-caption></p></div><p><strong>ä¹ã€Javaå®¢æˆ·ç«¯æµ‹è¯•</strong></p><p>1.javaé¡¹ç›®Mavenä¾èµ–</p><pre>é¡¹ç›®åœ°å€ï¼šhttps://github.com/tobato/FastDFS_Clientç›®å‰å®¢æˆ·ç«¯ä¸»è¦ä¾èµ–äºSpringBootï¼Œå› æ­¤å¿…é¡»å¼•å…¥:&lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.0.RELEASE&lt;/version&gt; &lt;relativePath/&gt;&lt;/parent&gt;FastDFS ä¾èµ–åŒ…ï¼š&lt;dependency&gt; &lt;groupId&gt;com.github.tobato&lt;/groupId&gt; &lt;artifactId&gt;fastdfs-client&lt;/artifactId&gt; &lt;version&gt;1.26.7&lt;/version&gt;&lt;/dependency&gt;å°†FastDFSå¼•å…¥é¡¹ç›®ï¼š@Import(FdfsClientConfig.class)åœ¨application.ymlå½“ä¸­é…ç½®Fdfsç›¸å…³å‚æ•°ï¼šfdfs: pool: #è¿æ¥æ± æœ€å¤§æ•°é‡ max-total: 200 #æ¯ä¸ªtrackeråœ°å€çš„æœ€å¤§è¿æ¥æ•° max-total-per-key: 50 #è¿æ¥è€—å°½æ—¶ç­‰å¾…è·å–è¿æ¥çš„æœ€å¤§æ¯«ç§’æ•° max-wait-millis: 5000 so-timeout: 1500 connect-timeout: 600 thumb-image: width: 150 height: 150 tracker-list: - 192.168.100.110:7777æˆ–è€…fdfs: pool: #è¿æ¥æ± æœ€å¤§æ•°é‡ max-total: 200 #æ¯ä¸ªtrackeråœ°å€çš„æœ€å¤§è¿æ¥æ•° max-total-per-key: 50 #è¿æ¥è€—å°½æ—¶ç­‰å¾…è·å–è¿æ¥çš„æœ€å¤§æ¯«ç§’æ•° max-wait-millis: 5000 so-timeout: 1500 connect-timeout: 600 thumb-image: width: 150 height: 150 tracker-list: - 192.168.100.111:22122 - 192.168.100.112:22122ä½¿ç”¨æ¥å£æœåŠ¡å¯¹FdfsæœåŠ¡ç«¯è¿›è¡Œæ“ä½œï¼Œä¸»è¦æ¥å£åŒ…æ‹¬ï¼šTrackerClient - TrackerServeræ¥å£GenerateStorageClient - ä¸€èˆ¬æ–‡ä»¶å­˜å‚¨æ¥å£ (StorageServeræ¥å£)FastFileStorageClient - ä¸ºæ–¹ä¾¿é¡¹ç›®å¼€å‘é›†æˆçš„ç®€å•æ¥å£(StorageServeræ¥å£)AppendFileStorageClient - æ”¯æŒæ–‡ä»¶ç»­ä¼ æ“ä½œçš„æ¥å£ (StorageServeræ¥å£)</pre><p>2.ä»£ç æµ‹è¯•</p><pre>package com.maxbill;import com.github.tobato.fastdfs.FdfsClientConfig;import com.github.tobato.fastdfs.domain.fdfs.MetaData;import com.github.tobato.fastdfs.domain.fdfs.StorePath;import com.github.tobato.fastdfs.domain.proto.storage.DownloadByteArray;import com.github.tobato.fastdfs.service.FastFileStorageClient;import lombok.extern.log4j.Log4j2;import org.apache.commons.lang3.StringUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.annotation.Import;import org.springframework.stereotype.Component;import javax.annotation.PostConstruct;import java.io.File;import java.io.FileInputStream;import java.text.DateFormat;import java.text.SimpleDateFormat;import java.util.*;@Log4j2@Component@Import(FdfsClientConfig.class)public class FdfsClientUtil { private static final String BASE_URL = "http://192.168.100.110:8888/"; @Autowired private FastFileStorageClient storageClient; private static FdfsClientUtil fdfsClientUtil; @PostConstruct public void init() { fdfsClientUtil = this; } /** * æ–‡ä»¶ä¸Šä¼  * * @param file æ–‡ä»¶ä¿¡æ¯ * @param infoMap æ–‡ä»¶æ‰©å±•ä¿¡æ¯ * @return ä¸Šä¼ è·¯å¾„ */ public static Map&lt;String, Object&gt; uploadFile(File file, Map&lt;String, String&gt; infoMap) { try { String fileName = file.getName(); String fileType = fileName.substring(fileName.lastIndexOf("\\") + 1); //String fileType = FilenameUtils.getExtension(file.getName()) log.info("[fdfs-upload]-start upload file ... "); log.info("[fdfs-upload]-request upload file name: {}", fileName); log.info("[fdfs-upload]-request upload file info: {}", infoMap); StorePath path = fdfsClientUtil.storageClient.uploadFile(new FileInputStream(file), file.length(), fileType, getMetaData(infoMap)); log.info("[fdfs-upload]-upload success path: {}", path.getFullPath()); return getResultMap(BASE_URL.concat(path.getFullPath()), null); } catch (Exception e) { log.error("[fdfs-upload]-upload file exception info: {}", e.getMessage()); return getResultMap(null, e.getMessage()); } } /** * ä¸‹è½½æ–‡ä»¶ * * @param filePath æ–‡ä»¶è·¯å¾„æ ‡è¯† * @return æ–‡ä»¶å­—èŠ‚ */ public static Map&lt;String, Object&gt; downloadFile(String filePath) { try { filePath = filePath.replace(BASE_URL, ""); StorePath storePath = StorePath.parseFromUrl(filePath); String group = storePath.getGroup(); String path = storePath.getPath(); log.info("[fdfs-download]-start download file ... "); log.info("[fdfs-download]-request download file group: {}", group); log.info("[fdfs-download]-request download file path: {}", path); byte[] data = fdfsClientUtil.storageClient.downloadFile(group, path, new DownloadByteArray()); log.info("[fdfs-download]-request download file success ... "); return getResultMap(data, null); } catch (Exception e) { log.error("[fdfs-download]-download file exception info: {}", e.getMessage()); return getResultMap(null, e.getMessage()); } } /** * åˆ é™¤æ–‡ä»¶ * * @param filePath æ–‡ä»¶è·¯å¾„æ ‡è¯† * @return æ“ä½œç»“æœ */ public static boolean deleteFile(String filePath) { try { filePath = filePath.replace(BASE_URL, ""); StorePath storePath = StorePath.parseFromUrl(filePath); String group = storePath.getGroup(); String path = storePath.getPath(); log.info("[fdfs-delete]-start delete file ... "); log.info("[fdfs-delete]-request delete file group: {}", group); log.info("[fdfs-delete]-request delete file path: {}", path); fdfsClientUtil.storageClient.deleteFile(storePath.getGroup(), storePath.getPath()); log.info("[fdfs-delete]-request delete file success ... "); return true; } catch (Exception e) { log.error("[fdfs-delete]-delete file exception info: {}", e.getMessage()); return false; } } /** * æŸ¥çœ‹æ–‡ä»¶å…ƒä¿¡æ¯ * * @param filePath æ–‡ä»¶è·¯å¾„æ ‡è¯† * @return æ–‡ä»¶ä¿¡æ¯ */ public static Map&lt;String, Object&gt; getFileInfo(String filePath) { try { filePath = filePath.replace(BASE_URL, ""); StorePath storePath = StorePath.parseFromUrl(filePath); String group = storePath.getGroup(); String path = storePath.getPath(); log.info("[fdfs-meta]-start meta file ... "); log.info("[fdfs-meta]-request meta file group: {}", group); log.info("[fdfs-meta]-request meta file path: {}", path); Map&lt;String, String&gt; infoMap = new HashMap&lt;&gt;(); infoMap.put("createPath", filePath); Set&lt;MetaData&gt; metaData = fdfsClientUtil.storageClient.getMetadata(storePath.getGroup(), storePath.getPath()); log.info("[fdfs-meta]-request meta file success ... "); if (null != metaData &amp;&amp; !metaData.isEmpty()) { metaData.forEach(meta -&gt; { infoMap.put(meta.getName(), meta.getValue()); }); } return getResultMap(infoMap, null); } catch (Exception e) { log.error("[fdfs-meta]-meta file exception info: {}", e.getMessage()); return getResultMap(null, e.getMessage()); } } /** * å°è£…é™„ä»¶å…ƒä¿¡æ¯ * * @param infoMap è‡ªå®šä¹‰æ•°æ® * @return é™„ä»¶å…ƒä¿¡æ¯ */ private static Set&lt;MetaData&gt; getMetaData(Map&lt;String, String&gt; infoMap) { if (null != infoMap &amp;&amp; !infoMap.isEmpty()) { Set&lt;MetaData&gt; metaDataSet = new HashSet&lt;&gt;(); for (String key : infoMap.keySet()) { metaDataSet.add(new MetaData(key, infoMap.get(key))); } return metaDataSet; } else { DateFormat df = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"); Set&lt;MetaData&gt; metaDataSet = new HashSet&lt;&gt;(); metaDataSet.add(new MetaData("createUser", "MaxBill")); metaDataSet.add(new MetaData("createDate", df.format(new Date()))); return metaDataSet; } } /** * å°è£…ç»“æœä¿¡æ¯ * * @param data æ•°æ® * @param info ä¿¡æ¯ * @return æ“ä½œç»“æœ */ private static Map&lt;String, Object&gt; getResultMap(Object data, String info) { Map&lt;String, Object&gt; resultMap = new HashMap&lt;&gt;(); if (StringUtils.isEmpty(info)) { resultMap.put("flag", true); resultMap.put("data", data); resultMap.put("info", "success"); } else { resultMap.put("flag", false); resultMap.put("info", info); resultMap.put("data", null); } return resultMap; }}</pre><p><br></p><p>æ¥æºï¼šå¼€æºä¸­å›½</p><p>åŸæ–‡ï¼šhttps://my.oschina.net/zss1993/blog/3131684</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'ç³»ç»Ÿ','FastDFS','å®‰è£…'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>