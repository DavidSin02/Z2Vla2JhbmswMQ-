<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>å¤§å‚é¢è¯•å®˜ï¼šè¯´ä¸€ä¸‹JDK1.8 HashMapæœ‰å“ªäº›äº®ç‚¹ï¼Ÿ | æå®¢å¿«è¨Š</title><meta property="og:title" content="å¤§å‚é¢è¯•å®˜ï¼šè¯´ä¸€ä¸‹JDK1.8 HashMapæœ‰å“ªäº›äº®ç‚¹ï¼Ÿ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p1.pstatp.com/large/dfic-imagehandler/b7654aee-bb6d-4c0d-906a-a0021a4438b6"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ff4b52ea.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ff4b52ea.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ff4b52ea.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ff4b52ea.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ff4b52ea.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ff4b52ea.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ff4b52ea.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ff4b52ea.html><meta property="article:published_time" content="2020-10-29T21:09:19+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:19+08:00"><meta name=Keywords content><meta name=description content="å¤§å‚é¢è¯•å®˜ï¼šè¯´ä¸€ä¸‹JDK1.8 HashMapæœ‰å“ªäº›äº®ç‚¹ï¼Ÿ"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/ff4b52ea.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è®¯ Geek Bank</a></h1><p class=description>ä¸ºä½ å¸¦æ¥æœ€å…¨çš„ç§‘æŠ€çŸ¥è¯† ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>å¤§å‚é¢è¯•å®˜ï¼šè¯´ä¸€ä¸‹JDK1.8 HashMapæœ‰å“ªäº›äº®ç‚¹ï¼Ÿ</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p><br></p><div class=pgc-img><img alt="å¤§å‚é¢è¯•å®˜ï¼šè¯´ä¸€ä¸‹JDK1.8 HashMapæœ‰å“ªäº›äº®ç‚¹ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/b7654aee-bb6d-4c0d-906a-a0021a4438b6><p class=pgc-img-caption></p></div><p>ä¸Šç¯‡æˆ‘ä»¬ä»‹ç»äº†JDK1.7ç‰ˆçš„HashMapï¼Œä»Šå¤©æˆ‘ä»¬æ¥è®²è§£ä¸‹JDK1.8ç‰ˆçš„HashMapã€‚</p><p style=text-align:start>JDK1.7çš„å®ç°å¤§å®¶çœ‹å‡ºæœ‰æ²¡æœ‰éœ€è¦ä¼˜åŒ–çš„åœ°æ–¹ï¼Ÿ</p><p style=text-align:start>å…¶å®ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„åœ°æ–¹å°±æ˜¯ï¼š<strong>å½“ Hash å†²çªä¸¥é‡æ—¶ï¼Œ</strong><strong>åœ¨</strong><strong>æ¡¶ä¸Šå½¢æˆçš„é“¾è¡¨ä¼š</strong><strong>å˜çš„</strong><strong>è¶Šæ¥è¶Šé•¿ï¼Œè¿™æ ·åœ¨æŸ¥è¯¢æ—¶çš„æ•ˆç‡å°±ä¼šè¶Šæ¥è¶Šä½ï¼›æ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚</strong></p><p style=text-align:start>å› æ­¤JDK1.8 ä¸­é‡ç‚¹ä¼˜åŒ–äº†è¿™ä¸ªæŸ¥è¯¢æ•ˆç‡ã€‚</p><h1 class=pgc-h-arrow-right>1ã€JDK1.8 HashMap æ•°æ®ç»“æ„å›¾</h1><div class=pgc-img><img alt="å¤§å‚é¢è¯•å®˜ï¼šè¯´ä¸€ä¸‹JDK1.8 HashMapæœ‰å“ªäº›äº®ç‚¹ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a9f8b0c626dd4e09afa66d734860c448><p class=pgc-img-caption></p></div><p>æˆ‘ä»¬ä¼šå‘ç°ä¼˜åŒ–çš„éƒ¨åˆ†å°±æ˜¯æŠŠé“¾è¡¨ç»“æ„å˜æˆäº†çº¢é»‘æ ‘ã€‚åŸæ¥jdk1.7çš„ä¼˜ç‚¹æ˜¯å¢åˆ æ•ˆç‡é«˜ï¼Œäºæ˜¯åœ¨jdk1.8çš„æ—¶å€™ï¼Œä¸ä»…ä»…å¢åˆ æ•ˆç‡é«˜ï¼Œè€Œä¸”æŸ¥æ‰¾æ•ˆç‡ä¹Ÿæå‡äº†ã€‚</p><p style=text-align:start>æ³¨æ„ï¼š<strong>ä¸æ˜¯è¯´å˜æˆäº†çº¢é»‘æ ‘æ•ˆç‡å°±ä¸€å®šæé«˜äº†ï¼Œåªæœ‰åœ¨é“¾è¡¨çš„é•¿åº¦ä¸å°äº8ï¼Œè€Œä¸”</strong><strong>æ•°ç»„</strong><strong>çš„é•¿åº¦ä¸å°äº64çš„æ—¶å€™æ‰ä¼šå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ã€‚</strong></p><p style=text-align:start><strong>é—®é¢˜ä¸€ï¼šä»€ä¹ˆæ˜¯çº¢é»‘æ ‘å‘¢ï¼Ÿ</strong></p><p style=text-align:start>çº¢é»‘æ ‘æ˜¯ä¸€ä¸ªè‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œä¹Ÿå°±æ˜¯è¯´çº¢é»‘æ ‘çš„æŸ¥æ‰¾æ•ˆç‡æ˜¯éå¸¸çš„é«˜ï¼ŒæŸ¥æ‰¾æ•ˆç‡ä¼šä»é“¾è¡¨çš„o(n)é™ä½ä¸ºo(logn)ã€‚å¦‚æœä¹‹å‰æ²¡æœ‰äº†è§£è¿‡çº¢é»‘æ ‘çš„è¯ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œä½ å°±è®°ä½çº¢é»‘æ ‘çš„æŸ¥æ‰¾æ•ˆç‡å¾ˆé«˜å°±OKäº†ã€‚</p><p style=text-align:start><strong>é—®é¢˜äºŒï¼šä¸ºä»€ä¹ˆä¸ä¸€ä¸‹å­æŠŠæ•´ä¸ªé“¾è¡¨å˜ä¸ºçº¢é»‘æ ‘å‘¢ï¼Ÿ</strong></p><p style=text-align:start>è¿™ä¸ªé—®é¢˜çš„æ„æ€æ˜¯è¿™æ ·çš„ï¼Œå°±æ˜¯è¯´æˆ‘ä»¬ä¸ºä»€ä¹ˆéè¦ç­‰åˆ°é“¾è¡¨çš„é•¿åº¦å¤§äºç­‰äº8çš„æ—¶å€™ï¼Œæ‰è½¬å˜æˆçº¢é»‘æ ‘ï¼Ÿåœ¨è¿™é‡Œå¯ä»¥ä»ä¸¤æ–¹é¢æ¥è§£é‡Š</p><p style=text-align:start>ï¼ˆ1ï¼‰æ„é€ çº¢é»‘æ ‘è¦æ¯”æ„é€ é“¾è¡¨å¤æ‚ï¼Œåœ¨é“¾è¡¨çš„èŠ‚ç‚¹ä¸å¤šçš„æ—¶å€™ï¼Œä»æ•´ä½“çš„æ€§èƒ½çœ‹æ¥ï¼Œ æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„ç»“æ„å¯èƒ½ä¸ä¸€å®šæ¯”æ•°ç»„+é“¾è¡¨çš„ç»“æ„æ€§èƒ½é«˜ã€‚å°±å¥½æ¯”æ€é¸¡ç„‰ç”¨ç‰›åˆ€çš„æ„æ€ã€‚</p><p style=text-align:start>ï¼ˆ2ï¼‰HashMapé¢‘ç¹çš„æ‰©å®¹ï¼Œä¼šé€ æˆåº•éƒ¨çº¢é»‘æ ‘ä¸æ–­çš„è¿›è¡Œæ‹†åˆ†å’Œé‡ç»„ï¼Œè¿™æ˜¯éå¸¸è€—æ—¶çš„ã€‚å› æ­¤ï¼Œä¹Ÿå°±æ˜¯é“¾è¡¨é•¿åº¦æ¯”è¾ƒé•¿çš„æ—¶å€™è½¬å˜æˆçº¢é»‘æ ‘æ‰ä¼šæ˜¾è‘—æé«˜æ•ˆç‡ã€‚</p><h1 class=pgc-h-arrow-right>2ã€HashMapæ„é€ æ–¹æ³•</h1><p style=text-align:start>æ„é€ æ–¹æ³•ä¸€å…±æœ‰å››ä¸ªï¼š</p><pre><code>public HashMap() {     this.loadFactor = DEFAULT_LOAD_FACTOR; }public HashMap(int initialCapacity) {     this(initialCapacity, DEFAULT_LOAD_FACTOR);}public HashMap(Map&lt;? extends K, ? extends V&gt; m) {    this.loadFactor = DEFAULT_LOAD_FACTOR;    putMapEntries(m, false);}public HashMap(int initialCapacity, float loadFactor) {    if (initialCapacity &lt; 0)        throw new IllegalArgumentException("Illegal initial capacity: " +                                           initialCapacity);    if (initialCapacity &gt; MAXIMUM_CAPACITY)        initialCapacity = MAXIMUM_CAPACITY;    if (loadFactor &lt;= 0 || Float.isNaN(loadFactor))        throw new IllegalArgumentException("Illegal load factor: " +                                           loadFactor);    this.loadFactor = loadFactor;    this.threshold = tableSizeFor(initialCapacity);}</code></pre><p>è¿™å››ä¸ªæ„é€ æ–¹æ³•å¾ˆæ˜æ˜¾ç¬¬å››ä¸ªæœ€éº»çƒ¦ï¼Œæˆ‘ä»¬å°±æ¥åˆ†æä¸€ä¸‹ç¬¬å››ä¸ªæ„é€ æ–¹æ³•ï¼Œå…¶ä»–ä¸‰ä¸ªè‡ªç„¶è€Œç„¶ä¹Ÿå°±æ˜ç™½äº†ã€‚ä¸Šé¢å‡ºç°äº†ä¸¤ä¸ªæ–°çš„åè¯ï¼šloadFactorå’ŒinitialCapacityã€‚æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæ¥åˆ†æï¼š</p><p style=text-align:start>ï¼ˆ1ï¼‰initialCapacityåˆå§‹å®¹é‡</p><p style=text-align:start>å®˜æ–¹è¦æ±‚æˆ‘ä»¬è¦è¾“å…¥ä¸€ä¸ª2çš„Næ¬¡å¹‚çš„å€¼ï¼Œæ¯”å¦‚è¯´2ã€4ã€8ã€16ç­‰ç­‰è¿™äº›ï¼Œä½†æ˜¯æˆ‘ä»¬å¿½ç„¶ä¸€ä¸ªä¸å°å¿ƒï¼Œè¾“å…¥äº†ä¸€ä¸ª20æ€ä¹ˆåŠï¼Ÿæ²¡å…³ç³»ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®ä½ è¾“å…¥çš„å€¼ï¼Œæ‰¾ä¸€ä¸ªç¦»20æœ€è¿‘çš„2çš„Næ¬¡å¹‚çš„å€¼ï¼Œæ¯”å¦‚è¯´16ç¦»ä»–æœ€è¿‘ï¼Œå°±å–16ä¸ºåˆå§‹å®¹é‡ã€‚</p><p style=text-align:start>ï¼ˆ2ï¼‰loadFactorè´Ÿè½½å› å­</p><p style=text-align:start>è´Ÿè½½å› å­ï¼Œé»˜è®¤å€¼æ˜¯0.75ã€‚è´Ÿè½½å› å­è¡¨ç¤ºä¸€ä¸ªæ•£åˆ—è¡¨çš„ç©ºé—´çš„ä½¿ç”¨ç¨‹åº¦ï¼Œæœ‰è¿™æ ·ä¸€ä¸ªå…¬å¼ï¼šinitailCapacity*loadFactor=HashMapçš„å®¹é‡ã€‚ æ‰€ä»¥è´Ÿè½½å› å­è¶Šå¤§åˆ™æ•£åˆ—è¡¨çš„è£…å¡«ç¨‹åº¦è¶Šé«˜ï¼Œä¹Ÿå°±æ˜¯èƒ½å®¹çº³æ›´å¤šçš„å…ƒç´ ï¼Œå…ƒç´ å¤šäº†ï¼Œé“¾è¡¨å¤§äº†ï¼Œæ‰€ä»¥æ­¤æ—¶ç´¢å¼•æ•ˆç‡å°±ä¼šé™ä½ã€‚åä¹‹ï¼Œè´Ÿè½½å› å­è¶Šå°åˆ™é“¾è¡¨ä¸­çš„æ•°æ®é‡å°±è¶Šç¨€ç–ï¼Œæ­¤æ—¶ä¼šå¯¹ç©ºé—´é€ æˆçƒ‚è´¹ï¼Œä½†æ˜¯æ­¤æ—¶ç´¢å¼•æ•ˆç‡é«˜ã€‚</p><h1 class=pgc-h-arrow-right>3ã€putæ–¹æ³•</h1><p style=text-align:start>æˆ‘ä»¬åœ¨å­˜å‚¨ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œå¤§å¤šæ˜¯ä½¿ç”¨ä¸‹é¢çš„è¿™ç§æ–¹å¼ã€‚</p><pre><code>public class Test {    public static void main(String[] args) {        HashMap&lt;String, Integer&gt; map= new HashMap&lt;&gt;();        //å­˜å‚¨ä¸€ä¸ªå…ƒç´         map.put("å¼ ä¸‰", 20);    }}</code></pre><p>åœ¨è¿™é‡ŒHashMap&lt;String, Integer>ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é”®ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å€¼ï¼Œåˆèµ·æ¥å«åšé”®å€¼å¯¹ã€‚å­˜å‚¨çš„æ—¶å€™åªéœ€è¦è°ƒç”¨putæ–¹æ³•å³å¯ã€‚é‚£åº•å±‚çš„å®ç°åŸç†æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿè¿™é‡Œè¿˜æ˜¯å…ˆç»™å‡ºä¸€ä¸ªæµç¨‹å›¾ï¼š</p><div class=pgc-img><img alt="å¤§å‚é¢è¯•å®˜ï¼šè¯´ä¸€ä¸‹JDK1.8 HashMapæœ‰å“ªäº›äº®ç‚¹ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ece71a757d8f480d8780a82e9efd1173><p class=pgc-img-caption></p></div><p>ä¸Šé¢è¿™ä¸ªæµç¨‹ï¼Œä¸çŸ¥é“ä½ èƒ½å¦çœ‹åˆ°ï¼Œçº¢è‰²å­—è¿¹çš„æ˜¯ä¸‰ä¸ªåˆ¤æ–­æ¡†ï¼Œä¹Ÿæ˜¯è½¬æŠ˜ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨æ–‡å­—æ¥æ¢³ç†ä¸€ä¸‹è¿™ä¸ªæµç¨‹ï¼š</p><p style=text-align:start>ï¼ˆ1ï¼‰ç¬¬ä¸€æ­¥ï¼šè°ƒç”¨putæ–¹æ³•ä¼ å…¥é”®å€¼å¯¹</p><p style=text-align:start>ï¼ˆ2ï¼‰ç¬¬äºŒæ­¥ï¼šä½¿ç”¨hashç®—æ³•è®¡ç®—hashå€¼</p><p style=text-align:start>ï¼ˆ3ï¼‰ç¬¬ä¸‰æ­¥ï¼šæ ¹æ®hashå€¼ç¡®å®šå­˜æ”¾çš„ä½ç½®ï¼Œåˆ¤æ–­æ˜¯å¦å’Œå…¶ä»–é”®å€¼å¯¹ä½ç½®å‘ç”Ÿäº†å†²çª</p><p style=text-align:start>ï¼ˆ4ï¼‰ç¬¬å››æ­¥ï¼šè‹¥æ²¡æœ‰å‘ç”Ÿå†²çªï¼Œç›´æ¥å­˜æ”¾åœ¨æ•°ç»„ä¸­å³å¯</p><p style=text-align:start>ï¼ˆ5ï¼‰ç¬¬äº”æ­¥ï¼šè‹¥å‘ç”Ÿäº†å†²çªï¼Œè¿˜è¦åˆ¤æ–­æ­¤æ—¶çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</p><p style=text-align:start>ï¼ˆ6ï¼‰ç¬¬å…­æ­¥ï¼šè‹¥æ­¤æ—¶çš„æ•°æ®ç»“æ„æ˜¯çº¢é»‘æ ‘ï¼Œé‚£å°±ç›´æ¥æ’å…¥çº¢é»‘æ ‘ä¸­</p><p style=text-align:start>ï¼ˆ7ï¼‰ç¬¬ä¸ƒæ­¥ï¼šè‹¥æ­¤æ—¶çš„æ•°æ®ç»“æ„æ˜¯é“¾è¡¨ï¼Œåˆ¤æ–­æ’å…¥ä¹‹åæ˜¯å¦å¤§äºç­‰äº8</p><p style=text-align:start>ï¼ˆ8ï¼‰ç¬¬å…«æ­¥ï¼šæ’å…¥ä¹‹åå¤§äº8äº†ï¼Œå°±è¦å…ˆè°ƒæ•´ä¸ºçº¢é»‘æ ‘ï¼Œåœ¨æ’å…¥</p><p style=text-align:start>ï¼ˆ9ï¼‰ç¬¬ä¹æ­¥ï¼šæ’å…¥ä¹‹åä¸å¤§äº8ï¼Œé‚£ä¹ˆå°±ç›´æ¥æ’å…¥åˆ°é“¾è¡¨å°¾éƒ¨å³å¯ã€‚</p><p style=text-align:start>ä¸Šé¢å°±æ˜¯æ’å…¥æ•°æ®çš„æ•´ä¸ªæµç¨‹ï¼Œå…‰çœ‹æµç¨‹è¿˜ä¸è¡Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ·±å…¥åˆ°æºç ä¸­å»çœ‹çœ‹åº•éƒ¨æ˜¯å¦‚ä½•æŒ‰ç…§è¿™ä¸ªæµç¨‹å†™ä»£ç çš„ã€‚</p><p style=text-align:start>é¼ æ ‡èšç„¦åœ¨putæ–¹æ³•ä¸Šé¢ï¼ŒæŒ‰ä¸€ä¸‹F3ï¼Œæˆ‘ä»¬å°±èƒ½è¿›å…¥putçš„æºç ã€‚æ¥çœ‹ä¸€ä¸‹ï¼š</p><pre><code>public V put(K key, V value) {     return putVal(hash(key), key, value, false, true);}</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œputæ–¹æ³•å…¶å®è°ƒç”¨çš„æ˜¯putValæ–¹æ³•ã€‚putValæ–¹æ³•æœ‰5ä¸ªå‚æ•°ï¼š</p><p style=text-align:start>ï¼ˆ1ï¼‰ç¬¬ä¸€ä¸ªå‚æ•°hashï¼šè°ƒç”¨äº†hashæ–¹æ³•è®¡ç®—hashå€¼</p><p style=text-align:start>ï¼ˆ2ï¼‰ç¬¬äºŒä¸ªå‚æ•°keyï¼šå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„keyå€¼ï¼Œä¹Ÿå°±æ˜¯ä¾‹å­ä¸­çš„å¼ ä¸‰</p><p style=text-align:start>ï¼ˆ3ï¼‰ç¬¬ä¸‰ä¸ªå‚æ•°valueï¼šå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„valueå€¼ï¼Œä¹Ÿå°±æ˜¯ä¾‹å­ä¸­çš„20</p><p style=text-align:start>ï¼ˆ4ï¼‰ç¬¬å››ä¸ªå‚æ•°onlyIfAbsentï¼šä¹Ÿå°±æ˜¯å½“é”®ç›¸åŒæ—¶ï¼Œä¸ä¿®æ”¹å·²å­˜åœ¨çš„å€¼</p><p style=text-align:start>ï¼ˆ5ï¼‰ç¬¬äº”ä¸ªå‚æ•°evict ï¼šå¦‚æœä¸ºfalseï¼Œé‚£ä¹ˆæ•°ç»„å°±å¤„äºåˆ›å»ºæ¨¡å¼ä¸­ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ºtrueã€‚</p><p style=text-align:start>çŸ¥é“äº†è¿™5ä¸ªå‚æ•°çš„å«ä¹‰ï¼Œæˆ‘ä»¬å°±è¿›å…¥åˆ°è¿™ä¸ªputValæ–¹æ³•ä¸­ã€‚</p><pre><code>final V putVal(int hash, K key, V value, boolean onlyIfAbsent,               boolean evict) {    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i;    //ç¬¬ä¸€éƒ¨åˆ†    if ((tab = table) == null || (n = tab.length) == 0)        n = (tab = resize()).length;    //ç¬¬äºŒéƒ¨åˆ†    if ((p = tab[i = (n - 1) &amp; hash]) == null)        tab[i] = newNode(hash, key, value, null);    //ç¬¬ä¸‰éƒ¨åˆ†    else {        Node&lt;K,V&gt; e; K k;        //ç¬¬ä¸‰éƒ¨åˆ†ç¬¬ä¸€å°èŠ‚        if (p.hash == hash &amp;&amp;            ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))            e = p;        //ç¬¬ä¸‰éƒ¨åˆ†ç¬¬äºŒå°èŠ‚        else if (p instanceof TreeNode)            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value);        //ç¬¬ä¸‰éƒ¨åˆ†ç¬¬ä¸‰å°èŠ‚        else {            for (int binCount = 0; ; ++binCount) {                //ç¬¬ä¸‰å°èŠ‚ç¬¬ä¸€æ®µ                if ((e = p.next) == null) {                    p.next = newNode(hash, key, value, null);                    if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st                        treeifyBin(tab, hash);                    break;                }                //ç¬¬ä¸‰å°èŠ‚ç¬¬ä¸€æ®µ                if (e.hash == hash &amp;&amp;                    ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))                    break;                //ç¬¬ä¸‰å°èŠ‚ç¬¬ä¸‰æ®µ                p = e;            }        }        //ç¬¬ä¸‰éƒ¨åˆ†ç¬¬å››å°èŠ‚        if (e != null) { // existing mapping for key            V oldValue = e.value;            if (!onlyIfAbsent || oldValue == null)                e.value = value;            afterNodeAccess(e);            return oldValue;        }    }    ++modCount;    //ç¬¬å››éƒ¨åˆ†    if (++size &gt; threshold)        resize();    afterNodeInsertion(evict);    return null;}</code></pre><p>ä¹ä¸€çœ‹ï¼Œè¿™ä»£ç å®Œå…¨æ²¡æœ‰è¯»ä¸‹å»çš„æ¬²æœ›ï¼Œç¬¬ä¸€æ¬¡çœ‹çš„æ—¶å€™çœŸå®æ¶å¿ƒåˆ°æƒ³åï¼Œä½†æ˜¯ç»“åˆä¸Šä¸€å¼€å§‹ç”»çš„æµç¨‹å›¾å†æ¥åˆ†æï¼Œç›¸ä¿¡å°±ä¼šå¥½å¾ˆå¤šã€‚æˆ‘ä»¬æŠŠä»£ç è¿›è¡Œæ‹†åˆ†ï¼ˆæ•´ä½“åˆ†äº†å››å¤§éƒ¨åˆ†ï¼‰ï¼š</p><p style=text-align:start>ï¼ˆ1ï¼‰Node&lt;K,V>[] tabä¸­tabè¡¨ç¤ºçš„å°±æ˜¯æ•°ç»„ã€‚Node&lt;K,V> pä¸­pè¡¨ç¤ºçš„å°±æ˜¯å½“å‰æ’å…¥çš„èŠ‚ç‚¹</p><p style=text-align:start>ï¼ˆ2ï¼‰ç¬¬ä¸€éƒ¨åˆ†ï¼š</p><pre><code>if ((tab = table) == null || (n = tab.length) == 0)       n = (tab = resize()).length;</code></pre><p>è¿™ä¸€éƒ¨åˆ†è¡¨ç¤ºçš„æ„æ€æ˜¯å¦‚æœæ•°ç»„æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆå°±é€šè¿‡resizeæ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ã€‚åœ¨è¿™é‡Œresizeæ–¹æ³•å…ˆä¸è¯´æ˜ï¼Œåœ¨ä¸‹ä¸€å°èŠ‚æ‰©å®¹çš„æ—¶å€™ä¼šæåˆ°ã€‚</p><p style=text-align:start>ï¼ˆ3ï¼‰ç¬¬äºŒéƒ¨åˆ†ï¼š</p><pre><code>if ((p = tab[i = (n - 1) &amp; hash]) == null)      tab[i] = newNode(hash, key, value, null);</code></pre><p>iè¡¨ç¤ºåœ¨æ•°ç»„ä¸­æ’å…¥çš„ä½ç½®ï¼Œè®¡ç®—çš„æ–¹å¼ä¸º(n - 1) & hashã€‚åœ¨è¿™é‡Œéœ€è¦åˆ¤æ–­æ’å…¥çš„ä½ç½®æ˜¯å¦æ˜¯å†²çªçš„ï¼Œå¦‚æœä¸å†²çªå°±ç›´æ¥newNodeï¼Œæ’å…¥åˆ°æ•°ç»„ä¸­å³å¯ï¼Œè¿™å°±å’Œæµç¨‹å›¾ä¸­ç¬¬ä¸€ä¸ªåˆ¤æ–­æ¡†å¯¹åº”äº†ã€‚</p><p style=text-align:start>å¦‚æœæ’å…¥çš„hashå€¼å†²çªäº†ï¼Œé‚£å°±è½¬åˆ°ç¬¬ä¸‰éƒ¨åˆ†ï¼Œå¤„ç†å†²çª</p><p style=text-align:start>ï¼ˆ4ï¼‰ç¬¬ä¸‰éƒ¨åˆ†ï¼š</p><pre><code>else {    Node&lt;K,V&gt; e; K k;    //ç¬¬ä¸‰éƒ¨åˆ†a    if (p.hash == hash &amp;&amp;        ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))        e = p;    //ç¬¬ä¸‰éƒ¨åˆ†b    else if (p instanceof TreeNode)        e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value);    //ç¬¬ä¸‰éƒ¨åˆ†c    else {        for (int binCount = 0; ; ++binCount) {            //ç¬¬ä¸‰å°èŠ‚ç¬¬ä¸€æ®µ            if ((e = p.next) == null) {                p.next = newNode(hash, key, value, null);                if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st                    treeifyBin(tab, hash);                break;            }            //ç¬¬ä¸‰å°èŠ‚ç¬¬ä¸€æ®µ            if (e.hash == hash &amp;&amp;                ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))                break;            //ç¬¬ä¸‰å°èŠ‚ç¬¬ä¸‰æ®µ            p = e;        }    }    //ç¬¬ä¸‰éƒ¨åˆ†d    if (e != null) { // existing mapping for key        V oldValue = e.value;        if (!onlyIfAbsent || oldValue == null)            e.value = value;        afterNodeAccess(e);        return oldValue;    }}</code></pre><p>æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œå¤„ç†å†²çªè¿˜çœŸæ˜¯éº»çƒ¦ï¼Œå¥½åœ¨æˆ‘ä»¬å¯¹è¿™ä¸€éƒ¨åˆ†åˆè¿›è¡Œäº†åˆ’åˆ†</p><p style=text-align:start>aï¼‰ç¬¬ä¸‰éƒ¨åˆ†ç¬¬ä¸€å°èŠ‚ï¼š</p><pre><code>if (p.hash == hash      &amp;&amp;((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))     e = p;</code></pre><p>åœ¨è¿™é‡Œåˆ¤æ–­table[i]ä¸­çš„å…ƒç´ æ˜¯å¦ä¸æ’å…¥çš„keyä¸€æ ·ï¼Œè‹¥ç›¸åŒé‚£å°±ç›´æ¥ä½¿ç”¨æ’å…¥çš„å€¼pæ›¿æ¢æ‰æ—§çš„å€¼eã€‚</p><p style=text-align:start>bï¼‰ç¬¬ä¸‰éƒ¨åˆ†ç¬¬äºŒå°èŠ‚ï¼š</p><pre><code>else if (p instanceof TreeNode)       e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value);</code></pre><p>åˆ¤æ–­æ’å…¥çš„æ•°æ®ç»“æ„æ˜¯çº¢é»‘æ ‘è¿˜æ˜¯é“¾è¡¨ï¼Œåœ¨è¿™é‡Œè¡¨ç¤ºå¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œé‚£å°±ç›´æ¥putTreeValåˆ°çº¢é»‘æ ‘ä¸­ã€‚è¿™å°±å’Œæµç¨‹å›¾é‡Œé¢çš„ç¬¬äºŒä¸ªåˆ¤æ–­æ¡†å¯¹åº”äº†ã€‚</p><p style=text-align:start>cï¼‰ç¬¬ä¸‰éƒ¨åˆ†ç¬¬ä¸‰å°èŠ‚ï¼š</p><pre><code>//ç¬¬ä¸‰éƒ¨åˆ†celse {     for (int binCount = 0; ; ++binCount) {        //ç¬¬ä¸‰å°èŠ‚ç¬¬ä¸€æ®µ         if ((e = p.next) == null) {              p.next = newNode(hash, key, value, null);              if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st                  treeifyBin(tab, hash);                  break;         }         //ç¬¬ä¸‰å°èŠ‚ç¬¬ä¸€æ®µ         if (e.hash == hash &amp;&amp;               ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))              break;         //ç¬¬ä¸‰å°èŠ‚ç¬¬ä¸‰æ®µ         p = e;    }}</code></pre><p>å¦‚æœæ•°æ®ç»“æ„æ˜¯é“¾è¡¨ï¼Œé¦–å…ˆè¦éå†tableæ•°ç»„æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ç›´æ¥newNode(hash, key, value, null)ã€‚å¦‚æœå­˜åœ¨äº†ç›´æ¥ä½¿ç”¨æ–°çš„valueæ›¿æ¢æ‰æ—§çš„ã€‚</p><p style=text-align:start>æ³¨æ„ä¸€ç‚¹ï¼šä¸å­˜åœ¨å¹¶ä¸”åœ¨é“¾è¡¨æœ«å°¾æ’å…¥å…ƒç´ çš„æ—¶å€™ï¼Œä¼šåˆ¤æ–­binCount >= TREEIFY_THRESHOLD - 1ã€‚ä¹Ÿå°±æ˜¯åˆ¤æ–­å½“å‰é“¾è¡¨çš„é•¿åº¦æ˜¯å¦å¤§äºé˜ˆå€¼8ï¼Œå¦‚æœå¤§äºé‚£å°±ä¼šæŠŠå½“å‰é“¾è¡¨è½¬å˜æˆçº¢é»‘æ ‘ï¼Œæ–¹æ³•æ˜¯treeifyBinã€‚è¿™ä¹Ÿå°±å’Œæµç¨‹å›¾ä¸­ç¬¬ä¸‰ä¸ªåˆ¤æ–­æ¡†å¯¹åº”äº†ã€‚</p><p style=text-align:start>ï¼ˆ5ï¼‰ç¬¬å››éƒ¨åˆ†ï¼š</p><pre><code>if (++size &gt; threshold)        resize();afterNodeInsertion(evict);return null;</code></pre><p>æ’å…¥æˆåŠŸä¹‹åï¼Œè¿˜è¦åˆ¤æ–­ä¸€ä¸‹å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡sizeæ˜¯å¦å¤§äºé˜ˆå€¼thresholdã€‚å¦‚æœå¤§äºé‚£å°±å¼€å§‹æ‰©å®¹äº†ã€‚</p><h1 class=pgc-h-arrow-right>4ã€resizeæ–¹æ³•</h1><p style=text-align:start>ä¸ºä»€ä¹ˆæ‰©å®¹å‘¢ï¼Ÿå¾ˆæ˜æ˜¾å°±æ˜¯å½“å‰å®¹é‡ä¸å¤Ÿï¼Œä¹Ÿå°±æ˜¯putäº†å¤ªå¤šçš„å…ƒç´ ã€‚ä¸ºæ­¤æˆ‘ä»¬è¿˜æ˜¯å…ˆç»™å‡ºä¸€ä¸ªæµç¨‹å›¾ï¼Œå†æ¥è¿›è¡Œåˆ†æã€‚</p><div class=pgc-img><img alt="å¤§å‚é¢è¯•å®˜ï¼šè¯´ä¸€ä¸‹JDK1.8 HashMapæœ‰å“ªäº›äº®ç‚¹ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/098abf61655b41e297aff192b6806eaf><p class=pgc-img-caption></p></div><p>è¿™ä¸ªæ‰©å®¹å°±æ¯”è¾ƒç®€å•äº†ï¼ŒHaspMapæ‰©å®¹å°±æ˜¯å°±æ˜¯å…ˆè®¡ç®— æ–°çš„hashè¡¨å®¹é‡å’Œæ–°çš„å®¹é‡é˜€å€¼ï¼Œç„¶ååˆå§‹åŒ–ä¸€ä¸ªæ–°çš„hashè¡¨ï¼Œå°†æ—§çš„é”®å€¼å¯¹é‡æ–°æ˜ å°„åœ¨æ–°çš„hashè¡¨é‡Œã€‚å¦‚æœåœ¨æ—§çš„hashè¡¨é‡Œæ¶‰åŠåˆ°çº¢é»‘æ ‘ï¼Œé‚£ä¹ˆåœ¨æ˜ å°„åˆ°æ–°çš„hashè¡¨ä¸­è¿˜æ¶‰åŠåˆ°çº¢é»‘æ ‘çš„æ‹†åˆ†ã€‚æ•´ä¸ªæµç¨‹ä¹Ÿç¬¦åˆæˆ‘ä»¬æ­£å¸¸æ‰©å®¹ä¸€ä¸ªå®¹é‡çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ ¹æ®æµç¨‹å›¾ç»“åˆä»£ç æ¥åˆ†æï¼š</p><pre><code>final Node&lt;K,V&gt;[] resize() {    Node&lt;K,V&gt;[] oldTab = table;    int oldCap = (oldTab == null) ? 0 : oldTab.length;    int oldThr = threshold;    int newCap, newThr = 0;    //ç¬¬ä¸€éƒ¨åˆ†ï¼šæ‰©å®¹    if (oldCap &gt; 0) {        if (oldCap &gt;= MAXIMUM_CAPACITY) {            threshold = Integer.MAX_VALUE;            return oldTab;        }        else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp;                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)            newThr = oldThr &lt;&lt; 1; // double threshold    }    //ç¬¬äºŒéƒ¨åˆ†ï¼šè®¾ç½®é˜ˆå€¼    else if (oldThr &gt; 0) // initial capacity was placed in threshold        newCap = oldThr;    else {               // zero initial threshold signifies using defaults        newCap = DEFAULT_INITIAL_CAPACITY;        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);    }    if (newThr == 0) {        float ft = (float)newCap * loadFactor;        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ?                  (int)ft : Integer.MAX_VALUE);    }    threshold = newThr;    @SuppressWarnings({"rawtypes","unchecked"})        Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap];    table = newTab;    //ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ—§æ•°æ®ä¿å­˜åœ¨æ–°æ•°ç»„é‡Œé¢    if (oldTab != null) {        for (int j = 0; j &lt; oldCap; ++j) {            Node&lt;K,V&gt; e;            if ((e = oldTab[j]) != null) {                oldTab[j] = null;                //åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé€šè¿‡ç´¢å¼•ä½ç½®ç›´æ¥æ˜ å°„                if (e.next == null)                    newTab[e.hash &amp; (newCap - 1)] = e;                //å¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œéœ€è¦è¿›è¡Œæ ‘æ‹†åˆ†ç„¶åæ˜ å°„                else if (e instanceof TreeNode)                    ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap);                else {                     //å¦‚æœæ˜¯å¤šä¸ªèŠ‚ç‚¹çš„é“¾è¡¨ï¼Œå°†åŸé“¾è¡¨æ‹†åˆ†ä¸ºä¸¤ä¸ªé“¾è¡¨                    Node&lt;K,V&gt; loHead = null, loTail = null;                    Node&lt;K,V&gt; hiHead = null, hiTail = null;                    Node&lt;K,V&gt; next;                    do {                        next = e.next;                        if ((e.hash &amp; oldCap) == 0) {                            if (loTail == null)                                loHead = e;                            else                                loTail.next = e;                            loTail = e;                        }                        else {                            if (hiTail == null)                                hiHead = e;                            else                                hiTail.next = e;                            hiTail = e;                        }                    } while ((e = next) != null);                    //é“¾è¡¨1å­˜äºåŸç´¢å¼•                    if (loTail != null) {                        loTail.next = null;                        newTab[j] = loHead;                    }                    //é“¾è¡¨2å­˜äºåŸç´¢å¼•åŠ ä¸ŠåŸhashæ¡¶é•¿åº¦çš„åç§»é‡                    if (hiTail != null) {                        hiTail.next = null;                        newTab[j + oldCap] = hiHead;                    }                }            }        }    }    return newTab;}</code></pre><p>è¿™ä»£ç é‡åŒæ ·è®©äººæ¶å¿ƒï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯åˆ†æ®µæ¥åˆ†æï¼š</p><p style=text-align:start>ï¼ˆ1ï¼‰ç¬¬ä¸€éƒ¨åˆ†ï¼š</p><pre><code>//ç¬¬ä¸€éƒ¨åˆ†ï¼šæ‰©å®¹if (oldCap &gt; 0) {      if (oldCap &gt;= MAXIMUM_CAPACITY) {           threshold = Integer.MAX_VALUE;           return oldTab;      }      else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp;          oldCap &gt;= DEFAULT_INITIAL_CAPACITY)            newThr = oldThr &lt;&lt; 1; // double threshold}</code></pre><p>æ ¹æ®ä»£ç ä¹Ÿèƒ½çœ‹æ˜ç™½ï¼šé¦–å…ˆå¦‚æœè¶…è¿‡äº†æ•°ç»„çš„æœ€å¤§å®¹é‡ï¼Œé‚£ä¹ˆå°±ç›´æ¥å°†é˜ˆå€¼è®¾ç½®ä¸ºæ•´æ•°æœ€å¤§å€¼ï¼Œç„¶åå¦‚æœæ²¡æœ‰è¶…è¿‡ï¼Œé‚£å°±æ‰©å®¹ä¸ºåŸæ¥çš„2å€ï¼Œè¿™é‡Œè¦æ³¨æ„æ˜¯oldThr &lt;&lt; 1ï¼Œç§»ä½æ“ä½œæ¥å®ç°çš„ã€‚</p><p style=text-align:start>ï¼ˆ2ï¼‰ç¬¬äºŒéƒ¨åˆ†ï¼š</p><pre><code>//ç¬¬äºŒéƒ¨åˆ†ï¼šè®¾ç½®é˜ˆå€¼else if (oldThr &gt; 0) //é˜ˆå€¼å·²ç»åˆå§‹åŒ–äº†ï¼Œå°±ç›´æ¥ä½¿ç”¨      newCap = oldThr;else {    // æ²¡æœ‰åˆå§‹åŒ–é˜ˆå€¼é‚£å°±åˆå§‹åŒ–ä¸€ä¸ªé»˜è®¤çš„å®¹é‡å’Œé˜ˆå€¼      newCap = DEFAULT_INITIAL_CAPACITY;      newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);}if (newThr == 0) {      float ft = (float)newCap * loadFactor;      newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ?                      (int)ft : Integer.MAX_VALUE);}//ä¸ºå½“å‰çš„å®¹é‡é˜ˆå€¼èµ‹å€¼threshold = newThr;@SuppressWarnings({"rawtypes","unchecked"})Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap];table = newTab;</code></pre><p>é¦–å…ˆç¬¬ä¸€ä¸ªelse ifè¡¨ç¤ºå¦‚æœé˜ˆå€¼å·²ç»åˆå§‹åŒ–è¿‡äº†ï¼Œé‚£å°±ç›´æ¥ä½¿ç”¨æ—§çš„é˜ˆå€¼ã€‚ç„¶åç¬¬äºŒä¸ªelseè¡¨ç¤ºå¦‚æœæ²¡æœ‰åˆå§‹åŒ–ï¼Œé‚£å°±åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„æ•°ç»„å®¹é‡å’Œæ–°çš„é˜ˆå€¼ã€‚</p><p style=text-align:start>ï¼ˆ3ï¼‰ç¬¬ä¸‰éƒ¨åˆ†</p><p style=text-align:start>ç¬¬ä¸‰éƒ¨åˆ†åŒæ ·ä¹Ÿå¾ˆå¤æ‚ï¼Œå°±æ˜¯æŠŠæ—§æ•°æ®å¤åˆ¶åˆ°æ–°æ•°ç»„é‡Œé¢ã€‚è¿™é‡Œé¢éœ€è¦æ³¨æ„çš„æœ‰ä¸‹é¢å‡ ç§æƒ…å†µï¼š</p><p style=text-align:start>Aï¼šæ‰©å®¹åï¼Œè‹¥hashå€¼æ–°å¢å‚ä¸è¿ç®—çš„ä½=0ï¼Œé‚£ä¹ˆå…ƒç´ åœ¨æ‰©å®¹åçš„ä½ç½®=åŸå§‹ä½ç½®</p><p style=text-align:start>Bï¼šæ‰©å®¹åï¼Œè‹¥hashå€¼æ–°å¢å‚ä¸è¿ç®—çš„ä½!=0ï¼Œé‚£ä¹ˆå…ƒç´ åœ¨æ‰©å®¹åçš„ä½ç½®=åŸå§‹ä½ç½®+æ‰©å®¹åçš„æ—§ä½ç½®ã€‚</p><p style=text-align:start>è¿™é‡Œé¢æœ‰ä¸€ä¸ªéå¸¸å¥½çš„è®¾è®¡ç†å¿µï¼Œ<strong>æ‰©å®¹åé•¿åº¦ä¸ºåŸhashè¡¨çš„2å€ï¼Œäºæ˜¯æŠŠhashè¡¨åˆ†ä¸ºä¸¤åŠï¼Œåˆ†ä¸ºä½ä½å’Œé«˜ä½ï¼Œå¦‚æœèƒ½æŠŠåŸé“¾è¡¨çš„é”®å€¼å¯¹ï¼Œ ä¸€åŠæ”¾åœ¨ä½ä½ï¼Œä¸€åŠæ”¾åœ¨é«˜ä½</strong>ï¼Œè€Œä¸”æ˜¯é€šè¿‡e.hash & oldCap == 0æ¥åˆ¤æ–­ï¼Œè¿™ä¸ªåˆ¤æ–­æœ‰ä»€ä¹ˆä¼˜ç‚¹å‘¢ï¼Ÿ</p><p style=text-align:start>ä¸¾ä¸ªä¾‹å­ï¼šn = 16ï¼ŒäºŒè¿›åˆ¶ä¸º10000ï¼Œç¬¬5ä½ä¸º1ï¼Œe.hash & oldCap æ˜¯å¦ç­‰äº0å°±å–å†³äºe.hashç¬¬5 ä½æ˜¯0è¿˜æ˜¯1ï¼Œè¿™å°±ç›¸å½“äºæœ‰50%çš„æ¦‚ç‡æ”¾åœ¨æ–°hashè¡¨ä½ä½ï¼Œ50%çš„æ¦‚ç‡æ”¾åœ¨æ–°hashè¡¨é«˜ä½ã€‚</p><h1 class=pgc-h-arrow-right>5ã€hashæ–¹æ³•</h1><p style=text-align:start>Java 8ä¸­çš„æ•£åˆ—å€¼ä¼˜åŒ–å‡½æ•°ï¼š</p><pre><code>static final int hash(Object key) {    int h;    return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);}</code></pre><p>æºç ä¸­æ¨¡è¿ç®—å°±æ˜¯æŠŠæ•£åˆ—å€¼å’Œæ•°ç»„é•¿åº¦åšä¸€ä¸ª"ä¸"æ“ä½œï¼š</p><pre><code>if ((p = tab[i = (n - 1) &amp; hash]) == null)</code></pre><p>è¿™ä¹Ÿæ­£å¥½è§£é‡Šäº†ä¸ºä»€ä¹ˆHashMapçš„æ•°ç»„é•¿åº¦è¦å–2çš„æ•´æ¬¡å¹‚ï¼Œå› ä¸ºè¿™æ ·ï¼ˆæ•°ç»„é•¿åº¦-1ï¼‰æ­£å¥½ç›¸å½“äºä¸€ä¸ªâ€œä½ä½æ©ç â€ï¼Œâ€œä¸â€æ“ä½œçš„ç»“æœå°±æ˜¯æ•£åˆ—å€¼çš„é«˜ä½å…¨éƒ¨å½’é›¶ï¼Œåªä¿ç•™ä½ä½å€¼ï¼Œç”¨æ¥åšæ•°ç»„ä¸‹æ ‡è®¿é—®ã€‚</p><p style=text-align:start>ä»¥åˆå§‹é•¿åº¦16ä¸ºä¾‹ï¼Œ16-1=15ï¼Œ2è¿›åˆ¶è¡¨ç¤ºæ˜¯00000000 00000000 00001111ï¼Œå’ŒæŸæ•£åˆ—å€¼åšâ€œä¸â€æ“ä½œå¦‚ä¸‹ï¼Œç»“æœå°±æ˜¯æˆªå–äº†æœ€ä½çš„å››ä½å€¼ï¼š</p><div class=pgc-img><img alt="å¤§å‚é¢è¯•å®˜ï¼šè¯´ä¸€ä¸‹JDK1.8 HashMapæœ‰å“ªäº›äº®ç‚¹ï¼Ÿ" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/9bca5eda8f8e430b85d0b9e95f8ba898><p class=pgc-img-caption></p></div><p>ä½†è¿™æ—¶å€™é—®é¢˜å°±æ¥äº†ï¼šè¿™æ ·å°±ç®—æˆ‘çš„æ•£åˆ—å€¼åˆ†å¸ƒå†æ¾æ•£ï¼Œè¦æ˜¯åªå–æœ€åå‡ ä½çš„è¯ï¼Œç¢°æ’ä¹Ÿä¼šå¾ˆä¸¥é‡ï¼Œè¿™æ—¶å€™â€œæ‰°åŠ¨å‡½æ•°â€çš„ä»·å€¼å°±ä½“ç°å‡ºæ¥äº†ï¼š</p><div class=pgc-img><img alt="å¤§å‚é¢è¯•å®˜ï¼šè¯´ä¸€ä¸‹JDK1.8 HashMapæœ‰å“ªäº›äº®ç‚¹ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a8ab38992a99423388da0f4097aec857><p class=pgc-img-caption></p></div><p><strong>å³ä½ç§»16ä½ï¼Œæ­£å¥½æ˜¯32ä½ä¸€åŠï¼Œè‡ªå·±çš„é«˜åŠåŒºå’Œä½åŠåŒºåšå¼‚æˆ–ï¼Œå°±æ˜¯ä¸ºäº†æ··åˆåŸå§‹hashCodeçš„é«˜ä½å’Œä½ä½ï¼Œä»¥æ­¤æ¥åŠ å¤§ä½ä½çš„éšæœºæ€§ï¼Œè€Œä¸”æ··åˆåçš„ä½ä½æºæ‚äº†é«˜ä½çš„éƒ¨åˆ†ç‰¹å¾ï¼Œè¿™æ ·é«˜ä½çš„ä¿¡æ¯ä¹Ÿè¢«å˜ç›¸ä¿ç•™ä¸‹æ¥ï¼Œå³é™ä½äº†å“ˆå¸Œå†²çªçš„é£é™©åˆä¸ä¼šå¸¦æ¥å¤ªå¤§çš„æ€§èƒ½é—®é¢˜</strong>ã€‚è¿™ä¸ªè®¾è®¡å¾ˆå·§å¦™ï¼</p><h1 class=pgc-h-arrow-right>6ã€hashå†²çª</h1><p style=text-align:start>é€šè¿‡å¼‚æˆ–è¿ç®—èƒ½å¤Ÿæ˜¯çš„è®¡ç®—å‡ºæ¥çš„hashæ¯”è¾ƒå‡åŒ€ï¼Œä¸å®¹æ˜“å‡ºç°å†²çªã€‚ä½†æ˜¯ååå‡ºç°äº†å†²çªç°è±¡ï¼Œè¿™æ—¶å€™è¯¥å¦‚ä½•å»è§£å†³å‘¢ï¼Ÿ</p><p style=text-align:start>åœ¨æ•°æ®ç»“æ„ä¸­ï¼Œæˆ‘ä»¬å¤„ç†hashå†²çªå¸¸ä½¿ç”¨çš„æ–¹æ³•æœ‰ï¼š<strong>å¼€å‘å®šå€æ³•ã€å†å“ˆå¸Œæ³•ã€é“¾åœ°å€æ³•ã€å»ºç«‹å…¬å…±æº¢å‡ºåŒºã€‚è€ŒhashMapä¸­å¤„ç†hashå†²çªçš„æ–¹æ³•å°±æ˜¯é“¾åœ°å€æ³•ã€‚</strong></p><p style=text-align:start>è¿™ç§æ–¹æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯å°†æ‰€æœ‰å“ˆå¸Œåœ°å€ä¸ºiçš„å…ƒç´ æ„æˆä¸€ä¸ªç§°ä¸ºåŒä¹‰è¯é“¾çš„å•é“¾è¡¨ï¼Œå¹¶å°†å•é“¾è¡¨çš„å¤´æŒ‡é’ˆå­˜åœ¨å“ˆå¸Œè¡¨çš„ç¬¬iä¸ªå•å…ƒä¸­ï¼Œå› è€ŒæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤ä¸»è¦åœ¨åŒä¹‰è¯é“¾ä¸­è¿›è¡Œã€‚é“¾åœ°å€æ³•é€‚ç”¨äºç»å¸¸è¿›è¡Œæ’å…¥å’Œåˆ é™¤çš„æƒ…å†µã€‚</p><h1 class=pgc-h-arrow-right>7ã€tableæ•°ç»„ç”¨transientä¿®é¥°</h1><pre><code>/** * The table, initialized on first use, and resized as * necessary. When allocated, length is always a power of two. * (We also tolerate length zero in some operations to allow * bootstrapping mechanics that are currently not needed.) */transient Node&lt;K,V&gt;[] table;</code></pre><p>ä»HashMap çš„æºç ï¼Œä¼šå‘ç°æ¡¶æ•°ç»„ table è¢«ç”³æ˜ä¸º transientã€‚transient è¡¨ç¤ºæ˜“å˜çš„æ„æ€ï¼Œåœ¨ Java ä¸­ï¼Œè¢«è¯¥å…³é”®å­—ä¿®é¥°çš„å˜é‡ä¸ä¼šè¢«é»˜è®¤çš„åºåˆ—åŒ–æœºåˆ¶åºåˆ—åŒ–ã€‚æˆ‘ä»¬å†å›åˆ°æºç ä¸­ï¼Œè€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼šæ¡¶æ•°ç»„ table æ˜¯ HashMap åº•å±‚é‡è¦çš„æ•°æ®ç»“æ„ï¼Œä¸åºåˆ—åŒ–çš„è¯ï¼Œåˆ«äººè¿˜æ€ä¹ˆè¿˜åŸå‘¢ï¼Ÿ</p><p style=text-align:start>è¿™é‡Œç®€å•è¯´æ˜ä¸€ä¸‹å§ï¼ŒHashMap å¹¶æ²¡æœ‰ä½¿ç”¨é»˜è®¤çš„åºåˆ—åŒ–æœºåˆ¶ï¼Œè€Œæ˜¯<strong>é€šè¿‡å®ç°readObject/writeObjectä¸¤ä¸ªæ–¹æ³•è‡ªå®šä¹‰äº†åºåˆ—åŒ–çš„å†…å®¹</strong>ã€‚è¿™æ ·åšæ˜¯æœ‰åŸå› çš„ï¼Œè¯•é—®ä¸€å¥ï¼ŒHashMap ä¸­å­˜å‚¨çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿä¸ç”¨è¯´ï¼Œå¤§å®¶ä¹ŸçŸ¥é“æ˜¯é”®å€¼å¯¹ã€‚æ‰€ä»¥åªè¦æˆ‘ä»¬æŠŠé”®å€¼å¯¹åºåˆ—åŒ–äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®é”®å€¼å¯¹æ•°æ®é‡å»º HashMapã€‚æœ‰çš„æœ‹å‹å¯èƒ½ä¼šæƒ³ï¼Œåºåˆ—åŒ– table ä¸æ˜¯å¯ä»¥ä¸€æ­¥åˆ°ä½ï¼Œåé¢ç›´æ¥è¿˜åŸä¸å°±è¡Œäº†å—ï¼Ÿè¿™æ ·ä¸€æƒ³ï¼Œå€’ä¹Ÿæ˜¯åˆç†ã€‚ä½†åºåˆ—åŒ– talbe å­˜åœ¨ç€ä¸¤ä¸ªé—®é¢˜ï¼š</p><p style=text-align:start>1ï¼‰table å¤šæ•°æƒ…å†µä¸‹æ˜¯æ— æ³•è¢«å­˜æ»¡çš„ï¼Œåºåˆ—åŒ–æœªä½¿ç”¨çš„éƒ¨åˆ†ï¼Œæµªè´¹ç©ºé—´ã€‚<br>2ï¼‰<strong>åŒä¸€ä¸ªé”®å€¼å¯¹åœ¨ä¸åŒ JVM ä¸‹ï¼Œæ‰€å¤„çš„æ¡¶ä½ç½®å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œåœ¨ä¸åŒçš„ JVM ä¸‹ååºåˆ—åŒ– table å¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ã€‚</strong></p><p style=text-align:start>ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜ä¸­ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜æ¯”è¾ƒå¥½ç†è§£ï¼Œç¬¬äºŒä¸ªé—®é¢˜è§£é‡Šä¸€ä¸‹ã€‚HashMap çš„get/put/removeç­‰æ–¹æ³•ç¬¬ä¸€æ­¥å°±æ˜¯æ ¹æ® hash æ‰¾åˆ°é”®æ‰€åœ¨çš„æ¡¶ä½ç½®ï¼Œä½†å¦‚æœé”®æ²¡æœ‰è¦†å†™ hashCode æ–¹æ³•ï¼Œè®¡ç®— hash æ—¶æœ€ç»ˆè°ƒç”¨ Object ä¸­çš„ hashCode æ–¹æ³•ã€‚ä½† Object ä¸­çš„ hashCode æ–¹æ³•æ˜¯ native å‹çš„ï¼Œä¸åŒçš„ JVM ä¸‹ï¼Œå¯èƒ½ä¼šæœ‰ä¸åŒçš„å®ç°ï¼Œäº§ç”Ÿçš„ hash å¯èƒ½ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚ä¹Ÿå°±æ˜¯è¯´åŒä¸€ä¸ªé”®åœ¨ä¸åŒå¹³å°ä¸‹å¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„ hashï¼Œæ­¤æ—¶å†å¯¹åœ¨åŒä¸€ä¸ª table ç»§ç»­æ“ä½œï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚</p><p style=text-align:start>ç»¼ä¸Šæ‰€è¿°ï¼Œå¤§å®¶åº”è¯¥èƒ½æ˜ç™½ HashMap ä¸åºåˆ—åŒ– table çš„åŸå› äº†ï¼Œä¸‹é¢æ˜¯HashMapè‡ªå®šä¹‰çš„åºåˆ—åŒ–ä»£ç ï¼š</p><pre><code>private void writeObject(java.io.ObjectOutputStream s)    throws IOException {    int buckets = capacity();    // Write out the threshold, loadfactor, and any hidden stuff    // å†™å…¥ä¸€äº›å±æ€§å€¼ï¼Œå¾…ååºåˆ—åŒ–æ—¶ç”¨åˆ°    s.defaultWriteObject();    s.writeInt(buckets);    s.writeInt(size);    internalWriteEntries(s);} // Called only from writeObject, to ensure compatible ordering.    void internalWriteEntries(java.io.ObjectOutputStream s) throws IOException {   Node&lt;K,V&gt;[] tab;    if (size &gt; 0 &amp;&amp; (tab = table) != null) {        for (int i = 0; i &lt; tab.length; ++i) {            for (Node&lt;K,V&gt; e = tab[i]; e != null; e = e.next) {            	 //å†™å…¥é”®å€¼å¯¹                s.writeObject(e.key);                s.writeObject(e.value);            }        }    }}private void readObject(java.io.ObjectInputStream s)        throws IOException, ClassNotFoundException {    // Read in the threshold (ignored), loadfactor, and any hidden stuff    s.defaultReadObject();    reinitialize();    if (loadFactor &lt;= 0 || Float.isNaN(loadFactor))        throw new InvalidObjectException("Illegal load factor: " +                                         loadFactor);    s.readInt();                // Read and ignore number of buckets    int mappings = s.readInt(); // Read number of mappings (size)    if (mappings &lt; 0)        throw new InvalidObjectException("Illegal mappings count: " +                                         mappings);    else if (mappings &gt; 0) { // (if zero, use defaults)        // Size the table using given load factor only if within        // range of 0.25...4.0        float lf = Math.min(Math.max(0.25f, loadFactor), 4.0f);        float fc = (float)mappings / lf + 1.0f;        int cap = ((fc &lt; DEFAULT_INITIAL_CAPACITY) ?                   DEFAULT_INITIAL_CAPACITY :                   (fc &gt;= MAXIMUM_CAPACITY) ?                   MAXIMUM_CAPACITY :                   tableSizeFor((int)fc));        float ft = (float)cap * lf;        threshold = ((cap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; MAXIMUM_CAPACITY) ?                     (int)ft : Integer.MAX_VALUE);        @SuppressWarnings({"rawtypes","unchecked"})            Node&lt;K,V&gt;[] tab = (Node&lt;K,V&gt;[])new Node[cap];        table = tab;        // Read the keys and values, and put the mappings in the HashMap        // è¯»å‡ºé”®å€¼å¯¹ï¼Œæ”¾å…¥hashMap        for (int i = 0; i &lt; mappings; i++) {            @SuppressWarnings("unchecked")                K key = (K) s.readObject();            @SuppressWarnings("unchecked")                V value = (V) s.readObject();            putVal(hash(key), key, value, false, false);        }    }}</code></pre><h1 class=pgc-h-arrow-right>8ã€HashMapéçº¿ç¨‹å®‰å…¨</h1><p style=text-align:start>HashMapæºç é‡Œé¢æ–¹æ³•æ˜¯æ²¡æœ‰synchronizedæˆ–lockå¤„ç†çš„ï¼Œæ— æ³•ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚äºæ˜¯å‡ºç°äº†çº¿ç¨‹å®‰å…¨çš„ConcurrentHashMapï¼Œè¿™ä¸ªæˆ‘ä»¬åç»­è®²è§£ã€‚</p><p style=text-align:start>æ¬¢è¿å°ä¼™ä¼´ä»¬ç•™è¨€äº¤æµ~~</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'å¤§å‚','é¢è¯•','JDK1.8'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>