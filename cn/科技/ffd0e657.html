<!doctype html><html lang=cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>python词法作用域和动态作用域 | 极客快訊</title><meta property="og:title" content="python词法作用域和动态作用域 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="cn"><meta property="og:image" content="https://p3.pstatp.com/large/dfic-imagehandler/ca259624-7126-44b3-a451-29f178fdb11d"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ffd0e657.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ffd0e657.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ffd0e657.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ffd0e657.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ffd0e657.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ffd0e657.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ffd0e657.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ffd0e657.html><meta property="article:published_time" content="2020-11-14T21:00:34+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:34+08:00"><meta name=Keywords content><meta name=description content="python词法作用域和动态作用域"><meta name=author content="极客快訊"><meta property="og:url" content="/cn/%E7%A7%91%E6%8A%80/ffd0e657.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快讯 Geek Bank</a></h1><p class=description>为你带来最全的科技知识 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>python词法作用域和动态作用域</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=cn/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><div class=pgc-img><img alt=python词法作用域和动态作用域 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/ca259624-7126-44b3-a451-29f178fdb11d><p class=pgc-img-caption></p></div><p>不管什么语言，我们总要学习作用域(或生命周期)的概念，比如常见的称呼：全局变量、包变量、模块变量、本地变量、局部变量等等。不管如何称呼这些作用域的范围，实现它们的目的都一样：</p><ol><li>为了避免名称冲突;</li><li>为了限定变量的生命周期(本文以变量名说事，其它的名称在规则上是一样的)。</li></ol><p>但是不同语言的作用域规则不一样，虽然学个简单的基础就足够应用，因为我们有编程规范：</p><ol><li>尽量避免名称冲突;</li><li>加上类似于local的修饰符尽量缩小生效范围;</li><li>放进代码块，等等。</li></ol><p>但是真正去细心验证作用域的生效机制却并非易事(我学Python的时候，花了很长时间细细验证，学perl的时候又花了很长时间细细验证)，但可以肯定的是，理解本文的词法作用域规则(Lexical scoping)和动态作用域规则(dynamic scoping)，对学习任何语言的作用域规则都有很大帮助，这两个规则是各种语言都宏观通用的。</p><p>很简单的一段bash下的代码：</p><pre>1 x=12 function g(){ echo "g: $x" ; x=2; }3 function f(){ local x=3 ; g; echo "f: $x"; } # 输出2还是34 f # 输出1还是3？5 echo $x # 输出1还是2？</pre><p>对于bash来说，上面输出的分别是3(g函数中echo)、2(f函数中的echo)和1(最后一行echo)。但是同样语义的代码在其它语言下得到的结果可能就不一样(分别输出1、3和2，例如perl中将local替换为my)。</p><p>这牵扯到两种贯穿所有程序语言的作用域概念：<strong>词法作用域(类似于C语言中static)和动态作用域</strong>。词法作用域和"词法"这个词真的没什么关系，反而更应该称之为"文本段作用域"。要区别它们，只需要回答"函数out_func中嵌套的内层函数in_func能否看见out_func中的环境"。</p><p>对于上面的bash代码来说，假如这段代码是适用于所有语言的伪代码：</p><ul><li>对于词法作用域的语言，执行f时会调用g，<strong>g将无法访问f文本段的变量，词法作用域认为g并不是f的一部分，而是跳出f的，因为g的定义文本段是在全局范围内的，所以它是全局文本段的一部分。如果函数g的定义文本段是在f内部，则g属于f文本段的一部分</strong>。</li><li class=ql-indent-1>所以g不知道f文本段中local x=3的设置，于是g的echo会输出全局变量x=1，然后设置x=2，因为它没有加上作用域修饰符，而g又是全局内的函数，所以x将修改全局作用域的x值，使得最后的echo输出2，而f中的echo则输出它自己文本段中的local x=3。所以整个流程输出1 3 2</li><li>对于动态作用域的语言，执行f时会调用g，<strong>g将可以访问f文本中的变量，动态作用域认为g是f文本段的一部分，是f中的嵌套函数</strong>。</li><li class=ql-indent-1>所以g能看到local x=3的设置，所以g的echo会输出3。g中设置x=2后，仅仅只是在f的内层嵌套函数中设置，所以x=2对g文本段和f文本段(因为g是f的一部分)都可见，但对f文本段外部不可见，所以f中的echo输出2，最后一行的echo输出1。所以整个流程输出3 2 1</li><li>总结来说：</li><li class=ql-indent-1><strong>词法作用域是关联在编译期间的，对于函数来说就是函数的定义文本段的位置决定这个函数所属的范围</strong>。</li><li class=ql-indent-1><strong>动态作用域是关联在程序执行期间的，对于函数来说就是函数执行的位置决定这个函数所属的范围</strong>。</li></ul><p>由于bash实现的是动态作用域规则。所以，输出的是3 2 1。对于perl来说，my修饰符实现词法作用域规则，local修饰符实现动态作用域规则。</p><p>例如，使用my修饰符的perl程序：</p><pre>1 #!/usr/bin/perl23 $x=1;4 sub g { print "g: $x\n"; $x=2; }5 sub f { my $x=3; g(); print "f: $x\n"; } # 词法作用域6 f(); 7 print "$x\n"; </pre><p>执行结果：</p><pre>1 [fairy@fairy:/perlapp]$ perl scope2.pl 2 g: 13 f: 34 2</pre><p>使用local修饰符的perl程序：</p><pre>1 #!/usr/bin/perl23 $x=1;4 sub g { print "g: $x\n"; $x=2; }5 sub f { local $x=3; g(); print "f: $x\n"; } # 动态作用域6 f(); 7 print "$x\n"; </pre><p>执行结果：</p><pre>1 [fairy@fairy:/perlapp]$ perl scope2.pl 2 g: 33 f: 24 1</pre><p>有些语言只支持一种作用域规则，特别是那些比较现代化的语言，而有些语言支持两种作用域规则(正如perl语言，my实现词法变量作用域规则，local实现动态作用域规则)。</p><p>相对来说，词法作用域规则比较好控制整个流程，还能借此实现更丰富的功能(如最典型的"闭包"以及高阶函数)，而动态作用域由于让变量生命周期"没有任何深度"(回想一下shell脚本对函数和作用域的控制，非常傻瓜化)，比较少应用上，甚至有些语言根本不支持动态作用域。</p><p><strong>觉得文章还不错的话不妨点个赞，有任何建议或看法欢迎大家在评论区分享讨论！</strong></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>'作用域','python','词法'</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-146415161-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>