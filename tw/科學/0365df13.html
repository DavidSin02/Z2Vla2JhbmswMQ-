<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>TCP與IP的對比，TCP的報文頭介紹，TCP的三次握手和TCP的安全機制 | 极客快訊</title><meta property="og:title" content="TCP與IP的對比，TCP的報文頭介紹，TCP的三次握手和TCP的安全機制 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/f1fd0df30c1c4366be12eef1be8b593b"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/0365df13.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/0365df13.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/0365df13.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/0365df13.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/0365df13.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/0365df13.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/0365df13.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/0365df13.html><meta property="article:published_time" content="2020-11-14T20:50:52+08:00"><meta property="article:modified_time" content="2020-11-14T20:50:52+08:00"><meta name=Keywords content><meta name=description content="TCP與IP的對比，TCP的報文頭介紹，TCP的三次握手和TCP的安全機制"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E5%AD%B8/0365df13.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>TCP與IP的對比，TCP的報文頭介紹，TCP的三次握手和TCP的安全機制</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E5%AD%B8.html>科學</a></span></div><div class=post-content><p>IP協議是無連接的通訊協議不會佔用兩個正在通訊的計算機之間的通訊線路,這樣IP就降低了對網絡線路的需求,每條線可以同時滿足許多不同計算機之間的通訊需要.</p><p>通過IP,消息或者其他數據會被分割為較小的獨立的包並通過因特網在計算機之間傳送<br>IP負責將每個包路由到目的地,但是<strong>IP協議沒用做任何工作去確認數據是否按順序發送或者包是否被破壞,所以IP數據包是不可靠的</strong>,因此需要它的上層傳輸層TCP協議來做控制!</p><h6 class=pgc-h-arrow-right>TCP（Transmission Control Protocol 傳輸控制協議）</h6><ul><li>面向連接的、可靠的、基於字節流的傳輸層通信協議</li><li>將應用層的數據流分割成報文段(報文段長度受MTU影響)併發送給目標節點的TCP層</li><li>數據包<strong>都有</strong>序號，對方收到則發送ACK(確認字符)確認，未收到則重傳</li><li>使用校驗和來檢驗數據在傳輸過程中是否有誤</li></ul><p><strong>報文頭介紹</strong></p><div class=pgc-img><img alt=TCP與IP的對比，TCP的報文頭介紹，TCP的三次握手和TCP的安全機制 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f1fd0df30c1c4366be12eef1be8b593b><p class=pgc-img-caption></p></div><blockquote><p>源端口標識發起通信的那個進程，目的端口標識接受通信的那個進程。<br>有了端口號，接受到報文後才能夠知道將報文發送到哪個進程。</p></blockquote><blockquote><p>在TCP傳輸中，每一個字節都是有序號的，從0開始。<strong>通過序號的方式保存數據的順序</strong>,接收端接受到之後進行重新排列成為需要的數據。<br>因此，我對於SEQ和ACK的瞭解就是：<br><strong>seq(Sequence Nubmer) 代表：發送的這個包中第一個字節（如果有payload的話）的序號<br>ack(Acknowledgement) 代表：已成功接受序列號到 ack-1 的數據，期望接收的下一個字節的序號為 ack</strong></p></blockquote><blockquote><p>首部長度（Data Offset）：表示TCP報文首部信息的長度。由於首部可能含有選項內容，因為TCP首部的長度是不確定的。首部長度指示了數據區在報文段中的起始偏移值。沒有任何選項字段的TCP頭部長度為20字節，做多可以有60字節的TCP頭部。</p></blockquote><blockquote><p>保留(Reserved)：6位保留字段，值通常為0；</p></blockquote><h6 class=pgc-h-arrow-right>TCP Flags標誌位(每個標誌位表示一個控制功能)</h6><p>◆URG：緊急指針(為0無效忽略,為1有效)<br>◆<strong>ACK：確認序號(為0表示報文中不含確認信息忽略確認號字段,為1表示確認號有效)</strong><br>◆PSH：(為1表示帶有PAH數據讓接收方應該儘快將這個報文段交給應用層,不在緩衝區排隊)<br>◆RST：重建連接。(用於重置由於主機崩潰或其他原因出現錯誤的鏈接或用於拒絕非法報文段和非法請求)<br>◆<strong>SYN：同步序列號,用於建立連接過程</strong><br>◆<strong>FIN：finsh標誌,用於釋放連接。為1時表示發送方已經沒有數據發送了</strong></p><ul><li>window指滑動窗口大小,用來告知發送端目的接收端的緩存大小以此來控制發送端發送數據的速率以此達到流量控制的效果</li><li>CheckSum 校驗和：奇偶校驗。對整個TCP報文段，即TCP頭部和TCP數據進行校驗和計算以16位進行計算所得,由發送端計算和存儲，並由接收端進行驗證</li><li>緊急指針（Urgent Pointer）：只有TCPFlags中URG=1時有效,如果TCP通信中，一方有緊急的數據需要儘快發送給接收方，並且讓接收方的TCP協議儘快通知相應的應用程序，可以將URG置位，並通過緊急指針指示緊急數據在報文段中的結束位置。佔16比特。它是一個偏移量，和序號字段中的值相加表示緊急數據最後一個字節的序號。</li><li>Options可定義一些其他參數</li></ul><h1 class=pgc-h-arrow-right>TCP的三次握手流程</h1><div class=pgc-img><img alt=TCP與IP的對比，TCP的報文頭介紹，TCP的三次握手和TCP的安全機制 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4580d68c41d642d785e2869ce7b7db89><p class=pgc-img-caption></p></div><p>這裡每次傳遞seq ack+1的原因是每次一個報文傳送告知,都要消耗一個序號</p><pre><code>書面解釋,專業回答```在TCP/IP協議中，TCP協議提供可靠的連接服務，採用三次握手建立一個連接。第一次握手：建立連接時，客戶端發送SYN包（syn=j）到服務器，並進入SYN_SEND狀態，等待服務器確認；第二次握手：服務器收到SYN包，必須確認客戶的SYN(ack=j+1),同時自己也發送一個SYN包（syn=k）            即SYN+ACK包，此時服務器進入SYN_RECV狀態；第三次握手：客戶端收到服務器的SYN+ACK包，向服務器發送確認包ACK（ack=k+1]，此包發送完畢           客戶端和服務器進入ESTABLISHED狀態，完成三次握手。</code></pre><p>三次握手模擬,只限理解,專業回答看上面</p><pre><code>兩者建立鏈接的過程類似於彼此確認彼此能否正確的收到信息(類似於相互在進行一次小型的通訊)```AB在一個很高的樓層想嘗試帶彼此東西上樓,於是要嘗試能不能收到彼此的東西,:第一次握手,SYN=1,A告訴B,老子要給你送東西了,seq=X,你在x樓等包裹:第二次握手,ACK=1,老子聽到了你說啥了,SYN=1,B告訴A,老子願意收,我這就去x樓等你,ack=x+1,我在在x樓了,下一次x+1樓,seq=y,我把你的重新給你我再給你我自己的東西你試試能不能收到,你到y樓等我):第三次握手,ACK=1,我收到我發的包和你發的包了,沒問題,seq=x+1,你下次去的樓是x+1樓,sck=y+1,老子到y樓了,下一層y+1樓;```哈哈哈除了我大概別人也難看懂</code></pre><p><strong>為什麼需要三次握手才能建立鏈接???</strong></p><p><strong>為了初始化Sequence Number的初始值,其實就是上面的x和y,通訊雙方要告訴彼此自己的Sequence Number這個號要作為以後數據通訊的序號,以保證應用層接收到的數據接收到的數據不會因為網絡上的問題而產生問題,即TCP會用這個序號來拼接數據,因此服務器端收到客戶端的Sequence Number要發送一個確認報文,告訴客戶端,我已收到你的Sequence Number;</strong></p><h5 class=pgc-h-arrow-right>首次握手的隱患-SYN超時</h5><p><strong>問題原因:</strong></p><ul><li>Server收到Client的SYN，回覆SYN-ACK的時候未收到ACK確認(比如IP地址是偽造的,服務器找不到)</li><li>Server不斷重試直至超時，Linux默認等待63秒才斷開連接(重試5次,間隔時間翻倍1,2,4,8,16,32)</li></ul><p><strong>後果</strong><br>可能服務器收到SYN Flood的風險,每一次這樣的鏈接會讓服務器等待63秒,如果有很多這樣的請求，導致服務器打開了大量的SYNC_RECV半連接,就會把TCP的連接隊列耗盡，最後導致TCP無法對其他TCP連接進行響應。</p><p><strong>針對SYN Flood的預防措施</strong></p><ul><li>SYN隊列滿後，TCP通過源地址端口目標地址端口和時間戳打造出一個tcp_syncookies(可看作Sequence Numbe)參數回發SYN Cookie</li><li>若為正常連接則Client會回發SYN Cookie，直接建立連接(即使服務器隊列滿了也可以)</li></ul><h5 class=pgc-h-arrow-right>若建立連接後Client出現故障怎麼辦?</h5><p><strong>TCP設有保活機制</strong></p><ul><li>若一段時間內(保活時間)若連接處於非活動狀態,開啟保活功能的一段向對方發送保活探測報文，如果未收到響應則繼續發送</li><li>嘗試次數達到保活探測數仍未收到響應(這時可以確認對方主機為不可達)則中斷連接</li></ul><h1 class=pgc-h-arrow-right>需要以下視頻資料可後臺回覆【架構】獲取</h1><p>nginx源碼—線程池的實現</p><p>高性能服務器為什麼需要內存池</p><p>去中心化，p2p，網絡穿透一起搞定</p><p>如何快速掌握WebRTC音視頻通話技術</p><p>Nginx模塊開發</p><p>進程與CPU之間的故事</p><p>tcp/ip協議棧不為人知的祕密</p><p>如何掌握MySQL</p><div class=pgc-img><img alt=TCP與IP的對比，TCP的報文頭介紹，TCP的三次握手和TCP的安全機制 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/85c99b85ad7a46cc9e326531d21b6ed0><p class=pgc-img-caption></p></div><p><br></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>TCP</a></li><li><a>IP</a></li><li><a>報文頭</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/a660d731.html alt=網絡基本概念-TCP/IP架構及各層網絡協議 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/7f834ac140184ca6a079de4d0d3e515c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a660d731.html title=網絡基本概念-TCP/IP架構及各層網絡協議>網絡基本概念-TCP/IP架構及各層網絡協議</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/024d3fc2.html alt=TCP/IP報文格式，康康就知道了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/73eecbbd2b0c4f93ad75a83ff43ace41 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/024d3fc2.html title=TCP/IP報文格式，康康就知道了>TCP/IP報文格式，康康就知道了</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/f51b5ddc.html alt=TCP/IP-運輸層-你需要知道的運輸層概念 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/a47a604cc4e34358a5357f9e7af4f2da style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/f51b5ddc.html title=TCP/IP-運輸層-你需要知道的運輸層概念>TCP/IP-運輸層-你需要知道的運輸層概念</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a2afccb6.html alt="TCP/IP 門禁控制器通訊不上故障排查方法" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a2afccb6.html title="TCP/IP 門禁控制器通訊不上故障排查方法">TCP/IP 門禁控制器通訊不上故障排查方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2eb6f16c.html alt="一文讀懂 TCP/IP 網絡模型" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c7aa7812af5c4f46b1cfc94a150dc976 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2eb6f16c.html title="一文讀懂 TCP/IP 網絡模型">一文讀懂 TCP/IP 網絡模型</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5351d79a.html alt=學習TCP/IP協議之前，你應該先理解OSI開放式互聯參考模型，功倍 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/d7d062cd949b4d148ab7f6a0b6af23b4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5351d79a.html title=學習TCP/IP協議之前，你應該先理解OSI開放式互聯參考模型，功倍>學習TCP/IP協議之前，你應該先理解OSI開放式互聯參考模型，功倍</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d3de5499.html alt=說說TCP/IP參考模型與OSI七層模型的關係 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ac183e86a25c4c249fa89a3bd6cbeeb6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d3de5499.html title=說說TCP/IP參考模型與OSI七層模型的關係>說說TCP/IP參考模型與OSI七層模型的關係</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/48b15feb.html alt=TCP/IP參考模型 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1e7063fc1fad41fdb324668595754ef6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/48b15feb.html title=TCP/IP參考模型>TCP/IP參考模型</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/42d2a01.html alt=TCP/IP安全：ACL訪問控制列表 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/966d9db48c2a496cb8675c8402cd3855 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/42d2a01.html title=TCP/IP安全：ACL訪問控制列表>TCP/IP安全：ACL訪問控制列表</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8edbb66.html alt="【乾貨】TCP/IP 及訪問控制列表（ACL）" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8edbb66.html title="【乾貨】TCP/IP 及訪問控制列表（ACL）">【乾貨】TCP/IP 及訪問控制列表（ACL）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1dce693.html alt=TCP/IP協議族（TCP/UDP的區別） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d023d5e0584149758d5d49fba3fd0613 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1dce693.html title=TCP/IP協議族（TCP/UDP的區別）>TCP/IP協議族（TCP/UDP的區別）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1bd1e17.html alt=一文讀懂TCP/IP協議工作原理和工作流程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/ea27784370b9441090baaf9c8cf57977 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1bd1e17.html title=一文讀懂TCP/IP協議工作原理和工作流程>一文讀懂TCP/IP協議工作原理和工作流程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a6fbf04.html alt=這樣的TCP/IP協議，你看懂了嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/009609673911487a82bf5b8b85d972cc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a6fbf04.html title=這樣的TCP/IP協議，你看懂了嗎？>這樣的TCP/IP協議，你看懂了嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/13955a3.html alt="TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/8f291e6a61fa4b45a91b81f2589002c5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/13955a3.html title="TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）">TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c8da7b9.html alt=TCP/IP協議分為哪四層，具體作用是什麼？http與tcp區別 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/250b6d508b7a4694baa0371a1f53a17c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c8da7b9.html title=TCP/IP協議分為哪四層，具體作用是什麼？http與tcp區別>TCP/IP協議分為哪四層，具體作用是什麼？http與tcp區別</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>