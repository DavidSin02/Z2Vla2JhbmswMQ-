<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>無線攻擊工具：SDR設備 | 极客快訊</title><meta property="og:title" content="無線攻擊工具：SDR設備 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/856c65c20f5d4762998abff788fdf2b9"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/0ae197d8.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/0ae197d8.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/0ae197d8.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/0ae197d8.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/0ae197d8.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/0ae197d8.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/0ae197d8.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/0ae197d8.html><meta property="article:published_time" content="2020-11-14T20:58:37+08:00"><meta property="article:modified_time" content="2020-11-14T20:58:37+08:00"><meta name=Keywords content><meta name=description content="無線攻擊工具：SDR設備"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E5%AD%B8/0ae197d8.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>無線攻擊工具：SDR設備</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E5%AD%B8.html>科學</a></span></div><div class=post-content><div><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/856c65c20f5d4762998abff788fdf2b9><p class=pgc-img-caption></p></div><p>當程控電話（phone phreaking）和撥號調制解調器的日子走到了盡頭，廉價的“軟件無線收發”（Software-Defined Radio）出現了，並且一出現就重新定義了無線竊聽的前景。通過“軟件無線收發”的使用，對於無線，我們不再限制在以前的“黑盒子”（black box）操作模式，相反，這時幾乎可以不受任何限制地訪問射頻頻譜、無線模塊和協議。以前通過“保密協議”（Non-Disclosure Agreement，NDA）進行屏蔽的內容和只有專業設備才能看到的現象，現在已全部無遮無攔地展示在您面前，任由您操縱。</p><p>無線頻譜的使用是由不同的政府機構嚴格監管的，所以您有責任確保在“接收和發送”，以及“接收或發送”無線電信號的時候，<strong>請遵守當地的法律</strong>。</p><p>其次，您也應該注意到，“軟件無線收發”目前仍然處於起步階段，還談不上是真正的“即插即用”。即使您按照軟件說明書上的指示操作，仍有可能出錯。信號處理涉及大量高等數學的概念，並且很多概念之間經常有循環依賴。</p><p><strong>一、“軟件無線收發”設備的體系結構</strong></p><p>我們將“軟件無線收發”比作一種處理無線電波的聲卡。下面就是一個簡化後，並且以功能塊分割後的一個基本“軟件無線收發”原理圖。大多數“軟件無線收發”有三個主要部分：“射頻信號放大器”（Radio Frequency Amplifier，簡稱“RF放大器”），“調諧器”（tuner）和“模數轉換器”（Analog-to-Digital Converter，ADC）。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/652c9006f5194267a411ea2a4af7996b><p class=pgc-img-caption></p></div><p>雖然從技術角度上來看，天線並不能算是無線的一部分，因為天線只是“採集”（picking up）無線信號，不過，真要說起天線，還是有很多講究的。有一些天線的功能可以很好地在多個頻率上使用，而另一些天線的功能則只能在一個頻率上使用。各向同性天線可以發送和接收（或同時收發）來自任何方向的信號。然而，如果想進行長距離的溝通，那麼一個定向天線（如“八木天線”）將會是一個更好的選擇。其實有一個簡單的原則，那就是在大多數情況下，“軟件無線收發”設備自帶的天線應該基本足夠使用了。</p><p>“射頻放大器”負責將弱信號功率提高。用戶指定的增益值是以“分貝”為單位，表示為“dB”，“射頻放大器”所控制的是在沒有增益的前提下放大的數量，因為可能接收不到太弱的信號。但太多的增益也會扭曲信號，就像將一個音響的音量開得太大了，一些聲音會發生變形一樣。還有一些無線是通過增益的多個階段獲得的。除此之外，還包括“自動增益控制”（Automatic Gain Control，AGC），在使用這種設備的時候，它會試圖幫您選擇最佳的增益值。</p><p>接下來的“調諧器”，或者叫“混合器”。就像老式收音機的調諧旋鈕一樣，“混合器”的作用是選擇無線電的頻譜部分進行分析。這個過程可以理解為“混合器”將一系列的頻率“拉到”到一個較低的頻率上。有一些無線處理設備是通過幾步完成這一操作的，而處理的信號中包含“中頻”（Intermediate Frequency，IF）和“基帶”（BaseBand，BB）信號的增益。</p><p>最後，無線信號的選擇，是通過一個“模數轉換器”實現的。“模數轉換器”的作用是在進行“採樣”（sample）的過程中，將模擬的語音波形轉變成數字流。</p><p>以圖1為例，我們在理想狀態下，把整個過程中每一個模塊的處理過程放到一起，集中展示出來。“射頻輸入”（RF Input，即圖上的第一行）代表許多傳輸中的無線頻率，您可能會注意到一些熟悉的波段，如FM調頻廣播、Wi-Fi無線網絡，還有藍牙網絡。“低噪聲放大器”（Low Noise Ampfifier，LNA，即圖上第二行），簡稱“放大器”，作用是在模擬信號的頻譜中增加增益，使信號得到加強。“調諧器”（Tuner，即圖上的第三行），在這個情況下，中心頻率是800MHz，主要作用是將高頻的頻譜調諧到基帶區域，以方便“模數轉換器”的採樣。通過配置“模數轉換器”，使其運行在每秒1000萬的採樣值，換句話說，達到10個“每秒百萬次採樣值”（Million Samples Per Second，MSPS），計算機可以處理的頻譜範圍是795MHz~805MHz，也就是說計算機可以處理的帶寬是70MHz。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5c77d3f5798d4e4d8b22bc5857a4edb8><p class=pgc-img-caption></p></div><p class=ql-align-center>圖1 理想狀態下的“軟件無線收發”SDR處理過程</p><p>“模數轉換器”並不知道正在採樣的是哪一部分頻譜，其實在“混合器”階段之後，我們就不知道正在轉換的是什麼信號了。如圖1所示，任何波段的信號均可以混合到“模數轉換器”所需要的這10MHz帶寬中。最終用戶的軟件，比如gqrx程序會持續跟蹤這一信號的變化，並以圖形的方式還原成原來的頻率。在分析過程中，會經常看到相對於調諧頻率的頻率變化值。需要注意的是，分析時總的可用帶寬和原來採樣信號的帶寬是相等的，只是頻率位於0MHz左右，並且中心頻率位於0MHz。</p><p><strong>二、選擇合適的“軟件無線收發”設備</strong></p><p>讓我們先看看市場已有的各種“軟件無線收發”設備，主要討論選擇一款設備的四個主要特性。</p><p><strong>採樣率（Sample Rate）/帶寬（Bandwidth）</strong>採樣率就是您能同時看到的最大帶寬，通常以“每秒百萬次採樣值”為單位。看看Wi-Fi無線網絡的802.11b/g，或者是“低功耗藍牙”的信號，至少需要20MSPS的帶寬。不過，相比於這些“帶寬大戶”，我們更多使用的信號帶寬都是2MSPS。</p><p><strong>動態範圍（Dynamic Range）/“模數轉換器”分辨率（ADC Resolution）</strong>“模數轉換器”的分辨率，類似於現代電視上對比度和“每英寸點數”（Dots-Per-Inch，DPI），是以“位”（bit）為單位。較高的“模數轉換器”的分辨率一般是14位或16位，這樣既可以在記錄中分辨出很大的聲音和極其細微的小細聲音，並且可以對信號中聲音的輕微差別進行區分。對於一些要求比較苛刻的應用，如“低功耗藍牙”加上“全球定位系統”，8位的分辨率可能是不夠的。不過，具體還要看是做什麼，對於跟蹤飛機、解碼傳呼消息和更多簡單的應用上，8位就足夠了！</p><p><strong>發送功能（Transmit Capability）</strong>一些“軟件無線收發”設備只有接收功能，而沒有發送功能。雖然據大部分的調查工作，大家都是把“軟件無線收發”設備作為一個接收器使用。要鑑別設備是隻有接收功能，還是兼具收發功能，可以注意一下“軟件無線收發”設備的輸入/輸出配置，即使是具有收發功能，有一些“軟件無線收發”設備可以同時發送和接收，一般標註為“全雙工”（full duplex），而另一部分則只具有“半雙工”（half duplex）的傳輸能力。</p><p><strong>調諧器調諧範圍（Tuner Range）</strong>調諧器的調諧頻率範圍決定能夠接收的頻率範圍。例如，如果想接收藍牙通信數據包，最好確保挑的這款“軟件無線收發”設備包括了2.4GHz的範圍！</p><p>在軟硬件產品市場上，有幾款“軟件無線收發”設備可以使用，表1中列出了其中四個最常見的產品介紹。在後面的介紹中，我們將集中圍繞著RTL-SDR和HackRF-SDR這兩款“軟件無線收發”設備中的技術進行分析，而這兩款也是目前可用的“軟件無線收發”技術中最常用的。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a3429e6347544f5f8a52bd08be73f6a6><p class=pgc-img-caption></p></div><p class=ql-align-center>表1“軟件無線收發”設備硬件與功能註釋</p><p><strong>1、RTL-SDR：入門級的軟件無線收發設備</strong></p><p>RTL版的“軟件無線收發”設備就是作為一款最廉價的“軟件無線收發”設備粉墨登場的，這款設備的作用主要是收看“數據廣播電視”（Digital Broadcast Television，DVB-T），收看節目遍及歐洲、亞洲和大洋洲。插到您的筆記本電腦的USB口中，只要有信號，就可以看電視。</p><p>研究人員Eric Fry發現這個設備是通過USB口發送原始無線信號的波形的。更重要的是，該設備可以在50~1750MHz之間任何調諧。於是他隨即編寫了一個簡單的驅動程序，並增加了支持“GNU計劃”中的無線部分。這項開發迅速發展，不久，各地“軟件無線收發”設備的無線電愛好者都熱追該軟件。同時，這款設備的售價也只有20美元，其實物圖如圖2所示。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/ac5ad3af7391498980f7b4ee0f6687e1><p class=pgc-img-caption></p></div><p class=ql-align-center>圖2 RTL版“軟件無線收發”設備</p><p>不過，雖然20美元聽起來對於這樣一個基於USB加密狗的RTL版“軟件無線收發”SDR設備來說，是相當吸引人的，但也不可否認，這個設備也有一些缺點。比如該設備的晶體振盪器（也可以認為是設備的時鐘）很容易發生振盪漂移，從結果上來說，那就是時鐘不準，偏差較大，當溫度高的時候，這種現象更是明顯。比如，您把您的調諧器降到10kHz左右，可當您回來再看的時候，您的無線信道已經漂移出這個範圍了。同時，接收到的信號噪聲太大，還有系統內部時鐘的加工工藝是在28.8MHz的整數倍。</p><p>對於RTL版“軟件無線收發”設備來說，這是一個理想的無線信息處理設備，並且通過這個設備，可以完成這裡所有的例子。這只不過是一個收看電視的小信號接收器，怎麼可能成為一個黑客工具？如果您還在迷茫於這個問題而表示不服氣的話，那麼可以將注意轉向http://www.rtl-sdr.com網站，您將看到使用該設備所進行的一些最近的項目列表。</p><p><strong>2、HackRF：多功能的軟件無線收發設備</strong></p><p>2014年，Mike Ossmann發佈了“HackRF一號”（HackRF One），該設備如圖3所示。這是一個靈活的、基於USB接口的“軟件無線收發”設備平臺。該設備可以在10MHz和6GHz之間進行調諧。可以實現接收功能和發送功能，但屬於“半雙工”通信模式。HackRF版的“軟件無線收發”設備在“軟件無線收發”設備系列中，與提供了相同功能的更昂貴的“軟件無線收發”設備平臺相比，成本相對較低的。該設備包括一個20MSPS的採樣率。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/785e0712c3cb45c7bf39c0dcf8fb8d49><p class=pgc-img-caption></p></div><p class=ql-align-center>圖3“HackRF一號”</p><p>對於您來說，要開始研究“軟件無線收發”技術，RTL版“軟件無線收發”設備是進行實驗和學習的最低成本的平臺。在這裡，我們將集中大量的例子介紹RTL版“軟件無線收發”設備平臺上的應用，還有少量附加的例子則需要使用HackRF版“軟件無線收發”設備，這主要是針對那些在功能上想使用超過RTL版“軟件無線收發”設備的附加功能的那一部分用戶。</p><p>另一個基於“軟件無線收發”技術的開發平臺就是Airspy版的“軟件無線收發”SDR平臺。Airspy版的“軟件無線收發”平臺的設計目標就是為了滿足“軟件無線收發”愛好者人群中，希望功能比RTL版的“軟件無線收發”平臺多一點，價格又比HackRF版的“軟件無線收發”平臺少一點的那些人的要求。</p><p><strong>三、開始使用軟件無線收發設備</strong></p><p>接下來，我們將分別在Windows和Linux操作系統上，看看要成功運行“軟件無線收發”設備，一些作為先決條件的軟件工具是怎麼工作的。</p><p><strong>1、在Windows操作系統上的下載與安裝SDR#程序</strong></p><p>在Windows操作系統中，首先介紹的能與RTL版和其他版的“軟件無線收發”平臺進行交互操作的流行工具是“軟件無線收發#版”（SDR#），發音同於“SDRSharp”，是由Youssef Touil編寫的。SDR#提供了一個直觀的界面，可以用來瀏覽無線頻譜，界面有“瀑布式”（waterfall）視圖和“實時信號”視圖兩種。</p><p>在Windows“資源管理器”中，導航到上面安裝程序所創建的sdrsharp目錄中，以管理員的身份啟動zadiag.exe文件。該程序會讓用戶配置系統驅動程序，以便支持RTL版“軟件無線收發”設備的使用。對用戶來說，要完成這一操作，需要先單擊“選項（Options）|列出所有的設備（List All Devices）”菜單，然後在界面下拉列表菜單中，選擇“散裝，接口（Interface 0）”（Bulk-In，Interface（Interface 0））的下拉列表項。這時的界面如圖4所示。單擊“安裝驅動程序”（Install Driver）按鈕，程序就會開始安裝要與RTL版“軟件無線收發”設備進行交換所需要的驅動程序。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/57c8d2caf0bc4029971db0205f47955e><p class=pgc-img-caption></p></div><p class=ql-align-center>圖4 配置系統驅動程序</p><p>“SDR#軟件支持通過插件方式增強工具的功能。一組由軟件開發者提供的插件列表，發表在網站上，可供用戶查閱使用。其實“頻率管理器+掃描器”（Frequency Manager+Scanner）插件是由Jeff Knapp開發的，在保存有價值頻率時所用的功能時必須用到這個插件，所以建議想要使用這一功能的朋友，先下載並安裝這個插件。</p><p><strong>2、在Linux操作系統上的下載與安裝gqrx程序</strong></p><p>就像“軟件無線收發#版”軟件這樣的Windows應用程序，在啟動SDR設備的時候，都可以分別設置時間。然而，多數使用SDR設備進行信號分析和解碼的工具，都假設您現在使用的操作系統是Linux操作系統。所以雖然後面的例子中，大多數的攻擊目標是Linux操作系統的，但如果有可能的話，作為控制SDR設備的軟件，我們會盡量介紹一些Windows操作系統上的工具使用的例子。</p><p>首先，從http://www.ubuntu.com網站上下載和安裝最新的64位Ubuntu操作系統的ISO映象文件。後面該映象文件可以作為一個Ubuntu的虛擬機使用，但這樣做後，系統整體的性能會下降，另外，USB接口對高吞吐量適配器的支持開始變得挑剔，由於SDR設備也是基於USB接口的，所以這也會影響對SDR設備的支持。因此，不建議以虛擬機的方式使用Ubuntu操作系統。</p><p>有了Ubuntu操作系統，下一步就是在Ubuntu系統中添加一個第三方程序包文件，這個程序包文件由Alexandru Csete提供技術支持。這個人同時也是gqrx程序的作者，而這個gqrx程序是一個基於UNIX的多種操作系統下的SDR設備工具。這個程序包所在的站點經常會更新這一程序包，有的時候頻率甚至比官方的Ubuntu程序包還頻繁。這個程序包可以讓您輕鬆地在Linux操作系統上，安裝和配置RTL版SDR平臺和HackRF版SDR平臺。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/17aed7cd58d54ef9962afbf91688005a><p class=pgc-img-caption></p></div><p>其次，就是更新軟件包列表，安裝以下軟件包到安裝了SDR平臺的目錄中。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/eda45465243a46ae94c250b88a1f2f3f><p class=pgc-img-caption></p></div><p>安裝了核心的，與SDR相關的軟件之後，我們首先要做的事情就是確認RTL版的SDR設備能正常運行。這一步很容易，只要運行rtl_test命令就可以輕鬆驗證：</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/081066fdc5a4405c9417c734081b601e><p class=pgc-img-caption></p></div><p>上面代碼中，最後一句的內容是：如果在這兒之後，沒有看到更多的輸出內容，那就說明您的RTL版的SDR設備安裝正確。</p><p>RTL版的SDR設備的“主業”是收看多國多地的電視信號，所以有一些版本的Ubuntu操作系統會天真地以為您真的想用RTL版的SDR設備來看電視。因而Ubuntu也會“自作多情”地自動加載該設備的驅動程序，這種“畫蛇添足”的行為最終會導致驅動程序訪問上衝突。如果遇到了此類問題，簡單的處理辦法是通過“rmmod dvb_lisb_rt128xxu命令簡單地卸載由Ubuntu操作系統安裝的驅動程序。</p><p>測試程序rtl_test是一個不會停止工作的程序，該程序在運行後會一直處於測試狀態，所以一旦認為您已完成了測試工作，按Ctrl+c組合鍵中止當前的測試工作。在RTL版的SDR設備上，一次只能同時使用一個應用，另外，在RTL版的SDR設備上有一個輕微的小毛病（slightly buggy），即當您關機的時候，偶爾會看到一個“數據段操作失敗”的錯誤，即segfault錯誤。另外，如果您的設備停止響應，重插一下USB軟件狗再試一次，一般問題就可以解決。如果重插設備後問題仍然存在，那就要考慮重新啟動SDR系統。</p><p>如果只能夠以root用戶的身份運行rtl_test程序，那麼需要安裝一個Linux操作系統中的“設備管理器”，名叫udev，這其實是一個以“rules”為擴展名的配置文件，從該擴展名上可以看出，該配置文件中保存的應該是一些“規則”。</p><p>如果足夠幸運地擁有一款HackRF版的SDR設備，那麼該設備也有一個簡單的工具，可以如法炮製地使用這一工具驗證該設備與計算機之間的通信。這個與HackRF版的SDR設備進行通信的工具，名字叫hackrf_info。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/df0c6924009e4467963920f5ffd88240><p class=pgc-img-caption></p></div><p>一旦驗證試驗是成功的，就可以在“命令提示符”中運行gqrx工具了。這個命令的運行權限並不侷限於root用戶，非root用戶也可以使用。與Windows操作系統上使用SDR設備的SDR#程序相比，gqrx程序不僅提供了所在SDR#程序的功能，而且還支持其他有用的功能。</p><p><strong>3、使用SDR#和gqrx程序掃描無線頻譜</strong></p><p>接下來，我們研究如何通過Windows操作系統下的SDR#程序和Linux操作系統下的gqrx程序，對各種無線信號進行分析。</p><p>通過RTL版的“軟件無線收發”設備，我們要做的第一件事就是監聽當地的“調頻廣播電臺”（FM radio station）。這是一個開始的好地方，因為幾乎每個人都生活在一些調頻廣播電臺的信號覆蓋範圍之內，它們都位於全國一致的頻率。</p><p>SDR#程序和gqrx程序的界面一致，主界面都是由四個主要的“用戶界面”元素（User Interface element）組成。其中“音量控制/調諧器”（volume control/tuner）突出位於頂部，我們不妨稱之為“1區”。而這些功能都如預期所料，是一個收聽調頻廣播的最基本功能。在左邊的一列，是無線配置區，不妨稱為“2區”。在這裡，主要是由您告訴程序要接收什麼類型的信號。現在，輸入一個當地的調頻廣播站調頻號碼，設置無線“寬帶調頻”（Wide FM，WFM）。在圖5中，我們收聽的廣播是WBRU95.5的調頻廣播，當地的一個另類搖滾電臺，設置完上面的操作以後，按“播放”按鈕或“電源”按鈕，就可以開始收聽了。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15d25f4799434b3e8f7ab24f51e56a27><p class=pgc-img-caption></p></div><p class=ql-align-center>圖5 SDR#程序界面截圖</p><p>“快速傅里葉變換”（Fast Fourier Transform，FFT）區顯示的是您的RTL版的SDR設備不停地採集到的“振幅”（amplitude）和“頻率”的顯示值。不妨稱該區為“3區”，其中的豎線（即“3區”正中的黑線），表示的是當前調諧到哪個電臺的頻率。下面是瀑布顯示區，不妨稱為“4區”。在這裡，顯示的是接收信號的歷史過程，以時間為單位。當試圖找到一個無線電信號時，“3區”和“4區”的數據都被證明是有用的。</p><p>雖然我們還沒有討論“頻率”和所用的單位“Hz”（中文名也寫作“赫茲”），然而，在前面的內容中已多次遇到過這些術語。現在，我們需要知道的是：對於一個信道的“頻率”，是電臺在使用之前分配到然後由電臺告訴我們的。“Hz”，全稱是Herz，只是“頻率”的單位，一個調頻廣播電臺會佔據的一小段頻率。以上面的WBRU 95.5為例，雖然95.5MHz是WBRU廣播所指定的中心頻率，但在實際的傳輸中，這個頻率實際佔用的寬度大約100KHz，換句話就是0.1MHz，在以95.5MHz為中心，向兩邊方向上偏移。這也是為什麼電臺的調頻頻率從來都不用偶數結尾的原因。</p><p>另一個要注意的事項，就是多個調頻電臺都在不停地對外廣播。而SDR#程序和gqrx程序一次只能解調一個電臺的廣播。通俗地講，就是一個這樣的設備，一次只能收聽一路廣播信號。但這並不是程序和SDR設備的限制，這只是因為這個程序並不想讓您同時收聽多個流。其實只要程序稍做修改，就可以產生額外的線程，來同時收聽多個，甚至是所有的電臺！</p><p>當然，費這麼大的勁，如果只是聽聽收音機信號，那就不值了，因為直接買個收音機，就可以以更容易的方法聽調頻廣播電臺了。然而，我們特意使用的是SDR設備，這是因為相比於收音機，可以讀取到其他無線電系統不容易找到的頻率，比如“廣播式自動相關監視”（Automatic Dependent Surveillance-Broadcast，ADS-B）中的無線信號。</p><p><strong>通過dump1090工具解碼“廣播式自動相關監視”系統</strong></p><p>首先我們使用專用的應用程序與RTL版的“軟件無線收發”（SDR）設備進行通信，這個專用程序就是dump1090。這個程序是由Salvatore Sanfilippo編寫的，作者其實在黑客界還有一個更響亮的名字，叫做antirez。從dump1090這個名字來看，1090應該是得名於頻率值，因為飛機通常都使用1090MHz的頻率發送自己的位置和航班號，與地面空管基站進行通信，而這個程序又與“廣播式自動相關監視”息息相關。必須手工下載和編譯dump1090手，不過這個很簡單，操作步驟如下所示：</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/690d175a8c6d4b1184da861b48a38280><p class=pgc-img-caption></p></div><p>命令中的“--interactive”標誌會讓dump1090程序輸出一個標準格式化的ASCII表，“-net”參數會讓程序關聯到8080端口，而該端口是“Google地圖”（Google map）軟件所用的端口。</p><p>一些航班不發送“緯度”（latitude）和“經度”（longitude）信息。所以有時即使看到有某個航班的消息彈出，但卻看不到該航班相關的座標或航班號。</p><p>上面輸出的這張表格中，有很多信息是相當令人印象深刻的，這些內容真的是從稀薄的空氣中主動以“拉”（pull）的方式讀取出來的嗎？但是“一張圖片勝過一千句話”。打開http://127.0.0.1：8080，隨後確實看到了飛機實時的跟蹤信息，如圖6所示。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2ceee70cb9214c60a39773fbcdd62188><p class=pgc-img-caption></p></div><p class=ql-align-center>圖6 飛機實時的跟蹤信息</p><p>dump1090工具的工作就是解調飛機以1090MHz頻率上發出的“廣播式自動相關監視”信號。這些信息會被該飛機信號發射功率覆蓋範圍內的其他飛機以及地面站所使用。數據沒有加密，所以很容易在數英里以內接收到，甚至在室內，只要是帶有天線，無論是RTL版的SDR設備，還是HackRF版的SDR設備都可以收到！</p><p>接下來，讓我們特別關注一下SDR設備的另一個功能，那就是捕獲業餘無線電愛好者的短信信號。</p><p><strong>通過gqrx程序解碼“自動分組報告系統”協議</strong></p><p>“自動分組報告系統”（Automatic Packet Reporting System，APRS）協議大致相當於業餘無線電愛好者之間的“手機短信服務”（Short Message Service，SMS）協議，是1993年在“業餘無線電頻段”（Ham radio band）發送短的基於文本消息（short text-based message）而設計的一個無線協議。通過該協議所發的數據包可以在“中繼器”（repeater）補發以後，最終連接到互聯網，甚至連接到到國際空間站上！</p><p>gqrx工具有一個內置的AFSK1200解調器模塊，這意味著可以簡單地調諧到144.39MHz，然後選擇“窄帶FM”（Narrow FM，NFM）模式，再單擊軟件“工具（Tools）|AFSK1200解碼器（AFSK1200 Decoder）”菜單項。那麼隨後，當設備接收到“自動分組報告系統”信息的時候，這些信息就將被解碼出來，並顯示在屏幕上，如圖7所示的是在“北緯39.2148，西經76.4991”（即圖上“3921.48N/07649.91W”）位置處捕獲到的“自動分組報告系統”數據包。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/55a12252ec34425dae9b9034ab704df7><p class=pgc-img-caption></p></div><p class=ql-align-center>圖7 被捕獲到的“自動分組報告系統”數據包</p><p>RTL版的SDR設備可能會有頻率的漂移，所以在使用“瀑布”視圖查看附近無線電愛好者所發送的數據的時候，數據會略有偏差！</p><p>有時可能會發現，在您的程序的“自動分組報告系統”解碼器窗口中，一直是空空如也。如果想接收到這些“空野來信”，需要從下面幾處建議中排查沒有收到的原因。</p><p>撥弄一下增益，調調看其他值的情況下是不是能收到什麼數據。當有“自動分組報告系統”信息出現時，SDR設備會有很明顯的“嗞…嘀…噢…喀”的聲音出現。調一會兒增益，正常情況下，總是能聽到一個的。</p><p>換另一副更好的天線，或者是將天線的頭朝向山外沒遮擋的方位。</p><p>一旦開始收到一些“自動分組報告系統”的消息，就可能想進一步解碼這些信息，最好是能將顯示的消息中包含有GPS座標的信息，都以加亮的方式顯示。這樣的工具也有不少，比如Dire Wolf軟件，另外還有Xastir軟件，都可以從接收到“自動分組報告系統”數據包中，提取地理位置信息，並且可以將這些信息按這些地址繪製在地圖上，甚至如果您有正確的硬件和無線電許可證，對方會要求您回傳一個回執信息。</p><p>雖然通過gqrx工具，可以將“自動分組報告系統”消息直接接收和解碼，但是作為“自動分組報告系統”協議本身，對於業餘無線電愛好者來說，還是有一些限制的。而另一個相似的，具有與“自動分組報告系統”差不多的功能，但卻被更廣泛地使用的協議叫作“傳呼網絡”（pager network），對於公眾來說，更加普及，而且值得高興的是，我們的SDR設備也仍然可以訪問這種協議。</p><p><strong>對傳呼信號進行破解</strong></p><p>我們最後要解碼的數字信號，就是“POCSAG傳呼”（POCSAG pager）通信數據包，其全稱是“基於‘郵局代碼標準化顧問組’的傳呼業務”（Post Office Code Standardization Advisory Group pager）。尋呼機仍被廣泛地運用在醫療和工業領域中，所以對於黑客來說，這仍然是一個很好的機會，通過傳呼，可以在家裡，就能聽到一些外邊人相互發送的傳呼內容。只要能捕獲到這些數據包，傳呼的信號很容易識別和解碼。由於傳呼的使用頻率範圍在不同的地理位置有顯著的差異，所以不得不需要到處尋找傳呼可能使用的信號。可以搜索的頻率有如下幾種：</p><p>.152~163MHz，這段頻率被稱為“甚高頻”（Very High Frequency，VHF）</p><p>.454~465MHz，這段頻率被稱為“特高頻”（Ultra High Frequency，UHF）</p><p>.929~931MHz，這段頻率被稱為“特高頻”（Ultra High Frequency，UHF）</p><p>幸運的是，“郵局代碼標準化顧問組”協議有一個非常獨特的波形和聲音效果。當您聽到“嗶…嘟，嗶…嘟”的聲音的時候，就說明現在有“窄帶FM”（NFM）音頻解調信號。將信號通過“快速傅里葉變換”（FFT），信號就會變成“蝙蝠耳朵”的形狀，在信號的兩端有兩個明顯的峰值，通過gqrx程序，其顯示效果如圖8所示。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d560d21b6c4e466fa7f92fa083cd67b4><p class=pgc-img-caption></p></div><p class=ql-align-center>圖8“郵局代碼標準化顧問組”協議信號顯示效果圖</p><p>在gqrx工具中，內置了一個“自動分組報告系統”解調器，但這裡所用的“軟件無線收發”設備中，並沒有配置對“郵局代碼標準化顧問組”碼的解調支持。不過，這個問題也不大，我們可以將這些音頻通過UDP協議傳送到另外具備對該協議進行解調和轉換的軟件工具上。整個操作的過程的概述如圖9所示。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0e826062ecab438780b78c6d42ba9bf6><p class=pgc-img-caption></p></div><p class=ql-align-center>圖9 操作流程圖</p><p>一旦我們發現了有通過“郵局代碼標準化顧問組”協議傳輸的信道頻率，我們需要將這個信道上捕獲的音頻數據流，通過UDP協議轉發出去。要完成這個操作，我們在gqrx軟件的“音頻”（Audio）選項卡（在前面gqrx程序主界面的右下角），然後單擊“音頻設置”（Audio Settings）按鈕（就是那個“扳手和螺絲刀”圖標的按鈕），然後選擇一個端口，默認的端口值為7355。然後我們單擊界面上“兩臺電腦”的圖標開始在本地以“廣播”（broadcasting）的方式發送音頻流。可以通過Netcat程序（其命令是“nc”命令）進行測試，使用時，將該命令連接到上面指定的端口即可工作，其操作實例如下所示：</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f46d3514eef042199642392fcf3bf367><p class=pgc-img-caption></p></div><p>因為上面gqrx程序和multimon-ng程序分別由不同的作者編寫的，我們必須改變程序音的採樣率，以便兩個程序可以統一參數。儘管gqrx程序輸出音頻頻率是48個“每秒千次採樣值”（KSPS），而multimon-ng程序希望運行在22050“每秒採樣值”（SPS）。命令行工具sox可以完成這種轉變。不過，在使用這個程序之前，必須首先安裝了sox數據包：</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c08e24fe5c404705af2bd1c0299fc9da><p class=pgc-img-caption></p></div><p>sox安裝好以後，我們就可以通過該工具將gqrx的輸出轉換成通過UDP發送的數據包，其命令格式如下所示。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6b8de2d5993042dba1749853cec0a072><p class=pgc-img-caption></p></div><p>這個命令的前一半是告訴sox程序以“原始（raw）的16位有符號整數”值的形式從“標準輸入設備”（stdin），以48000Hz的採樣率進行採樣。這裡的“原始”採樣，指的是所採用的音頻值沒有頭部數據，直接全部都是音頻採樣值，就像我們在wav文件或mp3文件中保存的那樣。命令的後半部分是告訴sox程序以“16位有符號整數”值的形式從“標準輸出設備”（stdout），以22050Hz的採樣率進行輸出，同樣，發送的時候，採用原始沒有頭部數據的格式。最後，我們在multimon-ng程序中，接收由sox程序輸出的數據，作為自己重新採樣的數據。</p><p>multimon-ng是一個命令行實用程序，是由Elias nal編寫，該程序可以解調許多不同的數字信號。要使用這一工具，我們需要下載和編譯該程序的源代碼，然後安裝編譯後的二進制可執行文件。其步驟如下所示：</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/759a4cc5e91847b8810244eef7fd11de><p class=pgc-img-caption></p></div><p>multimon-ng程序的執行實際上是相當簡單的。我們只是告訴該程序希望使用原始格式進行採集（即“-t raw”參數），並且是從“標準輸入設備”作為輸入源（這是通過單獨一個減號“-”作為參數），而且在命令中，給出了一組嘗試潛在的調製參數列表。在這組列表中，程序會依次嘗試這些組參數，遇到成功即停止隨後的嘗試，或全部都不成功則退出。“郵局代碼標準化顧問組”支持三種信息格式的解碼，對於每種格式，multimon-ng程序都有相應的解碼模式：</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a4dc7e4ab0294475b1c33985cc29b7f9><p class=pgc-img-caption></p></div><p>如果我們把所有上述命令集中到一行中操作的話，就會生成一個超長的命令行。這時，這個命令行的格式將如下所示。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/96865430ee9341cb8f37bbd58181a998><p class=pgc-img-caption></p></div><p>shell命令中的“\”表示的是轉義符，而該符號後面緊跟回車的話，表示的是當前這一段和下一段的內容是連接在一起的，不僅這個“\”轉義符不屬於shell命令的一部分，隨後的“回車”也不是命令格式的一部分。可以將“\&lt;回車>”理解為只是顯示格式上的優化，在命令執行的時候，該符號都將被去掉。</p><p>一旦mulLimon-ng程序正常運行，它就會打開一個簡單的示波器（oscilloscope）界面顯示從輸入接口中採集到的數據。下面顯示了一個有效的輸入信號所展示的示波器界面效果，該圖上起伏的波形，正是通過gqrx程序選定的頻率後，捕獲到的音頻頻率的一個實例效果。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/42d6067b486d4a029d0cd76ac9ab4bd6><p class=pgc-img-caption></p></div><p>運氣好的話，在程序的界面上將會開始出現滾動的頁面。一個傳呼數據捕獲的實例，內容如下所示，考慮到隱私問題，內容中，部分與技術無關的敏感信息和累贅的冗餘信息都經過了編輯，比如，有些都以“XXXXXX”顯示，有些以“…”省略掉。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3675f7a448bc428aba959005a2e2af3a><p class=pgc-img-caption></p></div><p>沒有這些專業的硬件，能將模擬的無線電波想盡辦法轉換到ASCII數據的格式，也都是徒勞的。</p><p><strong>四、數字信號處理</strong></p><p>在“頻域”（frequency domain）的範圍內分析數據的傳輸，對用戶來說，通常會有一個相當直觀的形式化印象，這無論對於信號定位、識別、兩信號間比較都是一樣。然而，這也只是圖表中所表達的內容中的一半內容，另一半對信號的分析，則是通過“時域”（time domain）實現的。下面我們來討論一下數字無線通信的內部工作機制。</p><p><strong>1、最基礎的通信</strong></p><p>想象一下，在我們十歲的時候，我們需要通過我們的“樹上堡壘”（tree fort）之間傳送祕密的信息，兩個“樹上堡壘”之間有一定的距離（如圖10所示）。所以就用了花園澆花軟管，在軟管的一頭套上一個氣球，然後您在那邊的“樹上堡壘”中對著軟管吹氣，您所吹的氣通過軟管到達我這邊，就把氣球吹大了。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7cbd113f9a5e4da1b7911925030c928c><p class=pgc-img-caption></p></div><p class=ql-align-center>圖10 通過“樹上堡壘”通信</p><p>通過軟管吹氣球，我可以向您發送一個消息；如果在預定吹的時候，我沒有吹，那麼一個癟的氣球也同樣表示我向您發送了一個消息，只是這兩個消息表示的意思不一樣。比如不吹氣球表示“送我一塊巧克力；我餓了”；那麼，吹氣球則可以表示為相反的意思。當然，既然這麼做可以發送多於一個消息了，所以我們很快就發明了二進制，並且通過上面的方式，約定了每五秒我們之間至少會做一個“吹”與“不吹”的動作，這裡的“吹”與“不吹”的動作其實就是二進制傳輸中“位”（bit）的概念。</p><p>很顯然，這個方法很快就遇到了一些問題。我們都有了難以說出的節奏感（sense of rhythm），因為有時我需要超過五秒或者更長的時間才能發送一個“位”。這會對接收方帶來困擾，對方是發了連接的兩個“0”？還是隻有一個“0”？或者，在無意識中，您接收的時間起始點，正好是發送方發送過程中的某個點。這都會導致“發送方的發送沒有出錯，接收方的接收也沒有出錯，但接收方接收的信息不是發送方發送的信息”的現象。為了解決這個問題，我們發明了一種數據包結構，即在數據中增加一個“校驗和”（checksum）。這樣，發送方在發送前，先對要發送的數據通過一定的算法算出一個“校驗和”，然後在發送的時候，除了發送數據之外，額外加上這個“校驗和”。接收方將數據與“校驗和”一起接收後，通過同樣的方法對數據進行計算，然後將自己算出的“校驗和”和接收到的“校驗和”進行比較，如果二者一樣，則表示數據是對的，不一樣則表示或者接收到的“數據”是錯的，或者接收到的“校驗和”是錯的，總之，接收到的數據是錯的。這樣，我們至少可以確保得到消息的正確性（包括正確和錯誤兩種可能）。</p><p>如果您用過像Arduinog一樣的微控制器，會知道這是怎樣的數字通信工程。上面例子中的軟管代表的是信號傳輸線（或電路板上的走線），吹到氣球中的壓力代表電壓。顯然，上面吹氣球的這個“系統”具有一定的物理侷限性，因為我們只能在一個方向上進行通信（就是吹氣），除非我們再拉第二條等長的軟管，在另一端套上氣球由這邊來吹，或者事先約定好，在軟管的兩端都可以套上氣球，並定時切換由誰來吹。同時，如果軟管的長度太長，那麼要吹大一個氣球，將耗費的能量太多了。</p><p><strong>2、最基礎的無線通信</strong></p><p>同樣在上面的例子中，我們在發送1和0的過程中，隨時有可能會有數據丟失現象。顯然，我不能在發送0的時候，把周圍所有的大氣都吸淨，而生成一個真空的環境。同樣，我們可以像動畫片“Cap’n Crunch”一樣，只要吹響哨子（whistle），就可以攪動周圍的空氣壓力以便讓您的耳朵可以聽到，這樣做的好處是雙向通信也容易了，但是代價就是附近的所有人都可以接收到我們之間通信的信息。</p><p>要想讓我們所做的事變得更容易，我們只有把我們的哨子換成長笛，因為長笛有許多個音洞，多種發音的音調，這樣，當我們遇到一種干擾源的時候，我們可以“移動”到另一個遠離干擾源的通信方式上。</p><p>這種原始的例子正在一點一點地接近無線通信工程。大致的意思就是：我一次發送一個“廣場”的1，雖然簡單，但是也難免出錯；但是如果能在傳輸的過程中，發送一個需要改變的“通知”，然後臨時地改變頻譜卻是件很容易的事。通過下面的一個例子，我們看看能不能理解“郵局代碼標準化顧問組”協議的工作原理。</p><p><strong>3、在“時域”和“頻域”上的POCSAG信號</strong></p><p>“郵局代碼標準化顧問組”（POCSAG）協議是一個無線通信協議。這個協議的數據傳送機制是，從開始時首先拿到一段文本信息，然後將這段文本信息保存在一個有幾千字節容量的內存芯片中，再根據數據包的結構將數據打包，最後，將這段打好包後的信息以“位流”（stream of bit）的方式發送到空中，而無線調製模塊在調製這些信息，然後將它們依次發送到空中的時候，是以一個電磁波的形式發送的（見圖11）。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/4828d1913f354355937d518f3047290e><p class=pgc-img-caption></p></div><p class=ql-align-center>圖11 以電磁波的形式發送信息</p><p>在這裡，可以看到一個模擬的“郵局代碼標準化顧問組”協議編碼在“時域”上的傳輸過程。上面的虛線是幫助您看清楚原始的二進制信息。在這種情況下，“郵局代碼標準化顧問組”協議使用兩個頻率值代表數據，其中較低的頻率表示0，較高的頻率表示1。這種調製稱為“二進制頻移鍵控”（Binary Frequency Shift-Keying，BFSK），也可簡稱為FSK。利用“樹上堡壘”的例子，“二進制頻移鍵控”就像用長笛發出兩種不同的音符來表示發送的信息。</p><p>回到我們的例子上，在信息結束之前，有人用一個強大的發射器開始與我們進行對話，這就形成了對我們的“干擾”。虛線表示我們的數據仍然是存在的，但由於新的信號疊加進來以後，導致我們很難看出原來的數據信號，如圖12所示。不過，在我們放棄這些後來干擾時的數據包時，讓我們來檢查一直被幹擾期間的“頻域”信號。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4dca020756c14d3b8985d9a8056be87b><p class=pgc-img-caption></p></div><p class=ql-align-center>圖12“干擾”信號加入後的波形圖</p><p>兩條豎直的“鐵軌”瀑布代表的是信道上的每個用戶正在發送信號。兩個“鐵軌”的每一個軌道上，都有兩個頻率值，而使用這兩個頻率信號就可以構成上面所說的“二進制頻移鍵控”。如果您看到這個信號的“快速傅里葉變換”圖的話，那麼這裡的兩個“鐵軌”看起來，會像一對“兔子耳朵”。</p><p>比原來信號中的“1”和“0”本身大得多的是“干擾信號”（interfering signal）；就是圖12中，右邊的豎亮條。如果我們讓這個信號通過一個“濾波器”（filter），就可以可以把干擾過濾掉，然後留下我們想要的信號，消除不必要的“噪聲”（noise）。在“時域”上，這樣做就可以消除“干擾信號”，最終讓我們看到我們的信號。當然，無論我們怎麼做，總是還會有一些“干擾信號”通過濾波器，最後仍然保存在正常信號中；只是我們希望能儘可能多地過濾掉這些“噪聲”，防止讀取“位”發生差錯的現象發生！</p><p><strong>4、聲音中的信息</strong></p><p>到目前為止，我們已經可以方便地將無線通信信號想象成我們經常聽到的聲音了。但是畢竟二者還不能完全等價，簡單地說，二者唯一的區別在於聲波和通信用的無線電波之間的傳播介質和使用的頻率是不一樣的。這是一種說法，其實還有的區別就是，不是所有的無線信號都有聲音。著名的“木星之聲”（Sounds of Jupiter），是由“旅行者一號”（Voyager I）航天器所錄，其實名為“之聲”，實際上所錄的只是在經過這個星球的時候，這個星球表面的太陽風（solar wind）所引發的電磁波的信號值。然後有人將這些信號加速，並且將其轉換到人類聽覺頻率的範圍，然後再把轉換後的信號通過揚聲器播放出來，享受這種“天籟之音”的效果。而實際上，在太空中，是沒有我們人類可以聽得到的聲音的，只有那些聽不到的無線電磁波。</p><p>可是，換一種角度，我們也可以發現，有好多種無線通信方式喜歡用聲音進行交流，比如“自動分組報告系統”（APRS）解調器，以及V.92協議調制解調器。這取決於如何看待它。這些調制解調器的原始設計者意識到電話線有3~4KHz帶寬，所以在設計自己的協議產生的電信號時，如果能“看”到這些信號，那會顯得很直觀，於是他們就把這個帶寬的數據當成是聲音的帶寬，然後將其當作聲音。在某些情況下，比如對方傳的原始信號恰在聲音的範圍內，那麼這個信號通過“聲音耦合器”（acoustic coupler）後，在調制解調器上還是可以聽到聲音，這時，就相當於有兩個持有手機在通話一樣。</p><p>拋開上述個別比較鑽牛角尖的事例之外，整體上，您應該對原始的無線通信理論有較好的理解。下面就將結合這一新的認識去攻擊脆弱的無線設備。</p><p><strong>攻擊車庫入口的電子鑰匙</strong></p><p>SDR設備的功能遠遠超過我們已經展示的上述，在生態系統領域內有限的應用。當然，“好馬還要配上好鞍”，除了SDR設備本身，還要有dump1090程序和multimon-ng程序的鼎立支持。其實，“好馬好鞍之外，還要有好的騎師”，那就是對於SDR設備，有什麼樣的工具能從“無線輪胎壓力監測系統”（Wireless Tire Pressure Monitoring System，TPMS）以“拉”的方式拿到數據呢？在一次模糊測試中，又有什麼應用程序允許發送任意格式的“全球移動通信系統”（GSM）協議的數據包呢？這下麻煩了，我們大概要東拼西湊地去各處找針對具體應用的這些程序。其實則不然，想想這個設備名字中，本應屬於“硬件”來做的“無線收發”，現在卻改成了“軟件”來負責，這其實就足以說明，即使是針對上述不同的應用，通過軟件的定義，我們仍然可以通過SDR設備進行控制。</p><p>下面我們將分析“無線電子鑰匙”（wireless key fob）系統，並試圖確定該設備是否存在容易遭受攻擊的漏洞。</p><p>像所有真正的入侵一樣，黑客需要一些努力、技巧、耐心和運氣。這種類型的分析一直是充滿著挑戰性，心臟脆弱的請繞道離開！</p><p><strong>5、挑選攻擊目標</strong></p><p>找到一個“開關鍵控”的發射器應該不會太難。在您的房子周圍，可能就有多個這樣的設備是採用“開關鍵控”技術的，比如車庫門遙控器、汽車的電子鑰匙、氣象站、門鈴、智能噴水槍。我們建議先從一個廉價的無線門鈴，或者簡單的車庫門開啟裝置開始，因為越便宜的無線設備，越有可能採用“開關鍵控”技術。</p><p>在這次攻擊中，我們的目標是“精靈公司”（Genie Company）的車庫門開啟裝置。不需要為了檢驗這裡的內容而專門再買一個這樣特定的產品，因為這裡介紹的是通用的步驟，這些對付這類電子產品的技術可以直接應用於您所選的其他電子產品上，一般情況下，同樣可以作為您自己攻擊實驗中的目標。</p><p><strong>設備的偵聽</strong></p><p>雖然，進行“黑盒測試”（black-box testing）是完全有可能的，但那樣只是對於一個初學者才採用的方式。為了減少這裡攻擊情節描述的複雜性，現在，我們假設您已經能對要攻擊的電子設備進行物理層面上的訪問，換句話說，就是您可以走的離車庫電子門足夠得近。那麼第一個問題就是“什麼是FCCID？”，“美國聯邦通訊委員會”（Federal Communications Commission，FCC）是一個組織的名稱，大多數的無線設備，若要在美國銷售就必須符合該組織的“FCC Part 15”條例。“美國聯邦通訊委員會”維護著一個兼容設備的在線數據庫，提供對各種電子產品的測試“記錄”（test record）、“所分配頻率”（frequency allocation），“產品用戶手冊”（manual），甚至產品內部的照片！“美國聯邦通訊委員會”會為每個設備編一個唯一的識別碼，有了這個概念，那麼FCCID就是“美國聯邦通訊委員會設備編碼”。</p><p>通常情況下，“美國聯邦通訊委員會設備編碼”（FCCID）會印在裝置的背面，有時候該碼也會直接在設備模具的外殼塑料上塑模成型，也有時候只是簡單地在外殼上印上一個標籤，在標籤上打印或手寫上這樣的編碼。如果在設備上找不到編碼，那就檢查包裝盒或說明書。找到這個“美國聯邦通訊委員會設備編碼”之後，就可以通過“美國聯邦通訊委員會”的網站進行查詢。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/4d5be7bc9a94463eaab1fd40dadb1cca><p class=pgc-img-caption></p></div><p class=ql-align-center>圖13 車庫門遙控器上的FCCID</p><p>如圖13所示，這個車庫門遙控器上的“美國聯邦通訊委員會設備編碼”是“B8QACSCT”，乍一看，我們也看不出什麼意義。要想知道每一位的明確含義，我們需要知道該編碼的組成結構，這個ID值可分為兩個部分，分別是“受讓人代碼”（grantee code）和“產品代碼”（product code），其中，“受讓人代碼”由三或五個字符組成，剩下的那當然就是“產品代碼”了。對於這個實例，“B8Q”就是“受讓人代碼”，而“ACSCT”就是“產品代碼”。把這兩個值輸入到“美國聯邦通訊委員會”FCC的網站後，可以查詢到一組產品文檔的列表，本實例中，查到了兩個結果，如圖14所示。對這些文檔的內容稍稍進行一點點的信息挖掘，我們就會發現這款車庫門遙控器的無線頻率被分配到390MHz上，如圖14產品列表中，最右邊一列字段所示。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e27788cf90614d28811129dcfc83cba1><p class=pgc-img-caption></p></div><p class=ql-align-center>圖14 實例查詢結果</p><p>沒有上述這些信息，我們就只能通過gqrx工具在空氣中，通過暴力破解（brute-force）的方式，搜遍所有頻率來找這個無線車庫門遙控器的頻率。這種情況也不是不可能的，每次當我們按下“搜索”按鈕的時候，當然心裡希望能有所斬獲，只是有些時候，用些巧勁兒又是完全必要的，比如如果某次攻擊中，必須得靠暴力方式找到對方所用的頻率，若要搜索的產品屬於工業（Industrial）、科學（Scientific）和醫療（Medical），三者常被合稱為“ISM”，那麼它們三個行業產品的無線頻率，一般分別開始於315MHz、433MHz和915MHz。如果採用更高的採樣率，將會不斷地看到更多射頻頻率的頻譜。</p><p><strong>6、查找和捕獲射頻發送信號</strong></p><p>我們將使用一個新的工具，名叫osmocom_fft。該程序的用戶界面是一個精簡版gqrx程序和SDR#程序，不過該功能注重的是實用而不是功能繁雜。我們的目標是找到要捕獲無線設備的信號，所以該軟件主界面圖的正中間，就是頻段的中心，在圖中設定好中心頻率以後，再選擇一個合適的增益，並將這些參數保存到一個文件。</p><p>下面就可以運行RTL版的SDR設備，中心頻率設定為390MHz，採樣率設定為2.5“每秒百萬次採樣值”（MSPS）。這給了我們一個“大水桶”（wide bucket）來裝所捕獲到的信號，這是為了防止某些無線電子設備萬一不按“美國聯邦通訊委員會”規定的頻率值發送數據的時候，我們也能捕獲到。另外，我們也把射頻增益調在某個地方的中部，對於增益這種耗大、影響極大的參數來說，僅憑預感，我們就知道電池可能很快就能耗掉一半。最後，我們知道這些無線設備信號傳輸持續時間將是很短的，想想按一個汽車的無線鑰匙還能用多長時間呀，多數情況下比眨眼還快。為了讓我們不錯過對方的每一次按鍵，我們不妨啟用“峰值保持”（Peak Hold）功能。</p><p>一旦我們按下了車庫門遙控器的按鈕，在軟件osmocom_fft的主界面上，我們就會看到一個突發的活動，在390MHz的左邊一點，如圖15所示。這是我們第一次嘗試就抓到的第一個信號。不用說，在實戰中，我們並不總是這麼幸運。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/25ed4e4d72474495ac44fa565a5ba418><p class=pgc-img-caption></p></div><p class=ql-align-center>圖15 在軟件osmocom_fft上看到的突發活動</p><p>雖然我們找到了要找的信號，我們還沒有準備好去捕獲到它。在這個例子中，我們所設的增益值太高了。所以在該頻率的左邊和右邊，分別都出現了一些干擾導致的扭曲，解決這個問題，我們可以降低增益，直至這些扭曲消失在噪聲層（noise floor）中，如果看到“載波振盪”（carrier wandering），那就每次給予100KHz的微調，因為這種偏移不是接收機造成的，而是對方廉價的無線車庫門遙控器造成的，可以說這也是廉價的“開關鍵控”類發射器的共同特點。您可能也注意到圖的中心一個直流的“穗”狀毛刺，這是射頻測量系統中的一種常見偽影現象（artifact）。調整您的信號“偏移量”（offset），一直到直流的“穗”狀毛刺不再幹擾您的正常數據！</p><p>剩下要做的就是將捕獲到的數據保存到一個文件中。按下右下角的“錄製”（record）按鈕後，應用程序就開始將射頻採樣的數據保存到硬盤中了。連續捕獲兩個或三個好的發射數據以後，就可以再次單擊“錄製”按鈕停止當前錄音。</p><p><strong>7、通過盲測發起“重播”攻擊</strong></p><p>示例中的這個車庫遙控鑰匙是很老的型號，所以只要簡單地將上面捕獲到的數據包簡單地“重播”（replay）一下，就可以打開車庫的大門。打開HackRF版的SDR設備，後面的處理過程非常簡單，注意在osmocom_fft軟件上的設置，主要是“頻率”、“增益”和“採樣率”三個參數。接下來，就可以開始捕獲的過程了，這裡用的是HackRF版的SDR設備上自帶的hackrf_transfer程序。其命令格式和運行效果如下所示：</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9d0bf4b6e5004d479612662f8690726e><p class=pgc-img-caption></p></div><p>採樣的數據都被保存到一個文件中。命令中的“-a”參數、“-l”（小寫L）參數和“-g”參數主要分別用於調整“幅度”，“低噪音”（low noise），和“中頻增益控制”（intermediate frequency gain control）。另外，“-f”參數是以Hz為單位的採樣率。如果想知道該命令中更多有關參數的信息，可以運行“hackrf_transfer--help”。在完成採集數據的記錄以後，按Ctrl+C停止捕獲過程。</p><p>要重傳這些信號，以發運“重播”攻擊，可以運行以下命令：</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/931c3a1736114232a03ac9cf6232092c><p class=pgc-img-caption></p></div><p>在這個例子中，“-x”參數的作用是設置發射增益。這個參數具體選什麼值，當然就是“仁者見仁，智者見智”的事情了，一般都是“看不同人的口味下調料”。除非碰巧有一個頻譜分析儀，可以幫您確定需要設置多少發送信號的輸出功率。您可能會認為存在一個0分貝（dB）的增益值來發送原始信號，但實際中這種情況是不可能存在的，因為發送0分貝的增益就意味著您的發射器必須位於一個“極度安靜”（quietest signal）的場所中。</p><p>假設您站在車庫門附近，我們發現10~20分貝的增益就可以很好地捕獲信號。但如果沒有發射天線連接到您的無線收發設備中，一個噪音的干擾就有可能破壞，甚至摧毀設備中的模擬電路，所以一定要確保您的天線是與您的SDR設備是硬件兼容的！這裡所說的“兼容”不是尺寸上正好可以安裝，而是指二者要匹配正確阻抗（impedance），阻抗組一般在50歐姆（ohms）左右，並且在操作前就將頻率設好，直接設為目標的工作頻率。</p><p>如果設備不工作怎麼辦？</p><p>設備的正常工作，通常是所有環節設置都對的結果，但導致設備不能正常工作的原因太多了，所以面對“如果設備不工作，該怎麼辦”這樣的問題，答案就是“沒有直接的答案”。這種練習就像是“撬鎖”（lock-picking），誰也不能說哪種方法就是好的，哪種方法就是對的。“自己動手，豐衣足食”，通過您對SDR設備工作原理的理解，需要自己開發出一套直觀的操作流程，然後藉助於您自己的流程，操控SDR設備，完成攻擊，並且在某些情況下，需要的純粹是運氣。對於創建符合自己習慣的套路，我們可以給您一些想法，但是沒有承諾。</p><p>如果您攻擊一個廉價的無線門鈴，或是一箇舊車庫的電子門，這一招應該很靈。攻擊上述設備失敗的主要原因，最大的可能是您的SDR設備的發射信號太弱導致的。解決方法也很簡單，逐步認真地加強發射增益，並嘗試重新接近這些無線設備的接收機。如果還失敗，那就是您的信號仍然還是太弱，繼續嘗試加大到更大的接收增益，直到顯示出接收的波形。</p><p>現代車庫的電子門和汽車，都在安全系統上有了較大的改進，很多產品都通過“滾動碼”實現。這樣做的好處是，即使您偷偷錄製了某個電子門或汽車的上一次通信數據包，但由於電子門或汽車在使用一段時間以後，就自動滾動到下一組值上了，所以即使通過“重播”攻擊，也許只能有效地使用一次，也許根本連一次也用不了。在錄製遠端通信的過程中，如果想“重播”看看效果，也要確保您的距離足夠遠，以便對方的電子門和汽車接收器無法“聽到”您發的“重播”信號。對於現代的電子門和汽車系統，這些錄製的數據通信包應該儘可能早地使用，因為先進的系統可以在某個編碼使用一段時間以後，自動終止該碼的使用，而更換成新的編碼，這個時候，再用原來保存的舊碼通過“重播”攻擊方式進行攻擊就沒有效果了。</p><p>現在我們已經檢驗了捕獲和“重播”功能，所使用的實例就是開啟一個簡單的車庫電子門。下一步，讓我們進入到一個更高級的攻擊方式，即攻擊一個“免鑰匙開門”的汽車系統。</p><p><strong>攻擊“免鑰匙開門”的汽車系統</strong></p><p>根據前面我們破解車庫大門電子鎖的那套設備和操作流程，我們使用了相同的認證手段、相同的捕獲數據包方式、相同的“重播”技術，的確打開了一次它的車門。不過，當我們想第二次打開的時候，我們發現之前捕獲的數據包已不再有效。難道“Mini Cooper”使用的是“滾動碼”機制？或者車鎖系統採用的是“質疑響應”（Challenge response）機制？我們不得不回過頭來，從自身的操作流程和分析思路上找問題的原因和解決辦法。既然前面我們已經將捕獲到的開門無線信號的波形記錄到磁盤上了，那麼我們就不需要再從捕獲無線信號這一步開始了。</p><p>我們使用“‘GNU計劃’中無線部分同伴”（GNU Radio Companion）設計一個信號處理算法，來還原從無線車鑰匙上捕獲到的數據包。我們的算法將非常接近於那個我們正在分析的無線電子車鑰匙的型號，所以您需要在這些設備上改變這些步驟的時候，只需要進行微調即可，當然也不排除有大幅調整的可能。而且，這種設計方法是非線性的（nonlinear）和實驗化的（experimental），所以要想在最大程度上獲得成功，我們需要關注的是概念的內涵（implicit concept），理解它想表達的深層含義；而不是“邯鄲學步”，只是簡單地模仿前面各個明確的操作步驟（explicit step）。</p><p>“GNU計劃”中無線部分的“Hello World”當我們要創建一個應用程序的時候，通常會先構建一個框架，然後藉助於這個框架來驗證當前的工作是不是有益的。對於現在要進行“Mini Cooper”車門只能接受一次“重播”攻擊的事實，我們要建立的框架就是將一些信號加入到一個“快速傅里葉變換”數據塊（FFT block）中，並且確認一下，我們確實看到了相同的發送數據包，而這個發送的數據包正是我們之前記錄的。記錄的步驟如下。</p><p>（1）打開gnuradio-companion程序，這個程序可以讓我們通過對所用數據包的選用數據塊（using block）的拖放處理（drag-and-drop process）設計出我們自己的信息處理算法。</p><p>（2）按下Ctrl+F組合鍵，查詢“文件源”（File Source）數據塊，然後將選中的塊拖到“工作區”（workspace）上。</p><p>（3）雙擊“文件源”（File Source）數據塊，就可以打開該數據塊的“屬性”（properties）窗口，單擊窗口中的標題為省略號“...”的按鈕，就可以打開文件瀏覽器，並選中所捕獲的文件。</p><p>（4）查詢“減速”（Throttle）數據塊，將該數據塊放在“文件源”數據塊的後面。單擊“輸入”（In）和“輸出”（Out）選項卡就可以將這些信息插入到“減速”（Throttle）數據塊中。這個數據塊的作用是負責限制採樣樣品從磁盤文件中的讀取速度。除非使用的是一塊硬件（例如聲卡或SDR設備），否則應該在流程圖（flowgraph）中的某個地方包含這個數據塊。</p><p>（5）在“減速”數據塊的後面放置一個基於QT的圖形化頻率接收器，然後連接上去。當運行這個程序的時候，程序將會在輸出顯示中增加一個“快速傅里葉變換”視圖。</p><p>（6）確保“選項”數據塊（Options block，通常在界面的左上角）是用於生成一個QT圖形化界面的設置，而不是使用WX工具包（QT最終會成為gnuradio-companion程序的圖形化界面）。</p><p>（7）打開名為samp_rate的“變量”數據塊（Variable block），將該項設置成與文件的採樣率相同的值。我們在osmocom_fft程序中使用的是1個“每秒百萬次採樣值”（MSPS），所以我們進入1e6（或1000000）。這個變量是全局和傳播在工作區中的所有數據塊。</p><p>以C語言為主的編程中，數字的科學計數法表示形式。1e6等價於1×106，即100萬。</p><p>（8）將上面流程保存到磁盤文件中，然後單擊綠色箭頭來開始執行程序。</p><p>在設置的時候，要確保您的samp_rate值設置的是正確的。許多“數據塊”操作都需要知道兩次採樣之間的這個時間段長度，比如說“濾波器”就與採樣率關係很大。另外，雖然同為“數據塊”的名稱，但不要在上面的概念中混淆了“減速”數據塊的作用，“減速”數據塊隻影響文件處理的速度，而不會影響到收發速度怎麼處理。</p><p>在圖16只有一個峰值了，一峰值就意味著只有一個“開關鍵控”發射器。如果看到兩個峰值，那您的設備可能是一個“二進制頻移鍵控”發射器。保持這種狀態繼續監聽著！還應該能夠得到一些數據；只是我們得多做一些工作才能夠關聯並得到這一些值！</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/21116da1727a448fa6b99bec0552ea6b><p class=pgc-img-caption></p></div><p class=ql-align-center>圖16 我們的第一個“GNU計劃”中的無線程序，包含了程序的輸出</p><p><strong>信號波形加工</strong>：在我們的例子中有一個非常乾淨的信號，中心頻率接近於0Hz。大約40dB的信噪比（Signal-to-Noise Ratio，SNR）是一種優良的低數據率數據，很像前面提到的“開關鍵控”發射器。如果設備所接收到的信號中有干擾信號，或很弱的信噪比，那麼可能需要對您的信號波形進行加工。雖然不能改變您的信號所對應“底噪”（noise floor）的振幅，但是可以去除噪聲，有效地提高信噪比，這個過程可以通過以下步驟實現：</p><p>（1）從前面的步驟中，使用“快速傅里葉變換”公式，寫下您的信號佔用頻率的範圍。在我們的例子中，信號之間運行在-100kHz和+100kHz之間。</p><p>（2）如果您的信號是接近您的圖形的中心，那麼使用一個“低通濾波器”（Low Pass Filter）。並且放在“減速”數據塊和“快速傅里葉變換”之間。</p><p>（3）如果您的信號向一側發生偏移，可以使用“複用”數據塊（Multiply block），配以餘弦函數（cosine）調用，將其調諧到中心點上。然而，這樣可能會發現使用的“帶通濾波器”（Band Pass Filter）會更容易。</p><p>（4）設置您的濾波器的“截止頻率”（Cutoff Frequencies）和“傳輸帶寬”（Transition Width），並重新運行程序。在這個例子中，我們配置了“頻率接收器”（frequency sink）同時接收兩個流，所以我們可以比較它們的之前數據和之後數據的差異，如圖17所示。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8d7e8147e6aa4080ab0ad6fdad6936f7><p class=pgc-img-caption></p></div><p class=ql-align-center>圖17 配置頻率接收器後接收的兩個數據流</p><p>什麼是一個合適的濾波器？如果我們從開始到結束，設計的是一個高性能的無線濾波器，我們可能需要使用“匹配的濾波器”（matched filter），這樣可以利用一個已知的信號更可靠地檢測到一個未知的信號。然而，這更多的是一種“餐巾紙的背面”（back of the napkin）式的逆向工程項目，同樣，現在僅僅是設計一個濾波器，通過該濾波器讓您的信號在通過的時候去除掉您不要的那部分頻譜。</p><p>也就是說，數字濾波器不是讓信號更自由地想到哪個頻段就到哪個頻段，而是在傳輸的時候，限制在更窄的帶寬範圍之內。帶寬越窄，您的濾波器就與CPU關係越大。選擇一個比您的採樣頻率略少百分之十，可能會使您的模擬顯得更緩慢。在這個例子中，我們將“低通濾波器”設置在任一方向上允許+/-100kHz的變化範圍，這樣可以將下一個100kHz內的噪聲逐漸減弱。您可以在前面的圖像中看到，在濾波器濾通區域之外的“底噪聲”顯著地下降了。</p><p>解調“開關鍵控”發射器　該過程的下一步，是瞥一眼正在發射的實際的數據“位”。這裡，我們需要引入兩個新的數據塊。“複數型Mag”數據塊（Complex to Mag block）負責解調“開關鍵控”發射器，和“QT圖形界面時間接收器”數據塊的作用是及時將解調後的聲波輸出出來。如果碰巧有一個“二進制頻移鍵控”信號，那就用“正交解調器”（Quadrature Demodulator）取代“複雜型Mag”數據塊。</p><p>在放置數據塊的時候，需要注意“複數型Mag”數據塊的選項卡的顏色將會由藍色變成桔黃色，變化的原因是因為數據類型已從“複數”變為“浮點數”。令人遺憾的是，我們沒有足夠的空間來討論複數型信號。在任何情況下，都要確保配置“QT圖形界面時間接收器”（QT GUI Time Sink）的數據類型是“從複數型到浮點型”（Complex to Float）這個選項。</p><p>“QT圖形界面時間接收器”是一個複雜的數據塊，有許多配置選項。圖上所選擇的參數值，也正好是將根據上面例子中所用的參數值。這些選項可以在運行時通過雙擊圖上區域進行查看。</p><p>第一次時，我們按這個流程圖的順序運行程序，迎接我們的是部分數據“位”因為數值不停地變化，而從整體看上去在不停地閃來閃去。回想起來，這是有道理的，因為我們已經將“QT圖形界面時間接收器”的值配置為一次顯示1024個採樣值。對於一個有1個“每秒百萬次採樣值”（MSPS）變化率的採樣值，每個值只能在窗口中顯示短暫的1毫秒，那數據位不閃反而不正常了。找到問題所在，解決方法也很簡單，在圖像中間單擊菜單，我們配置數據塊顯示的點數為“100倍速”顯示（即“100 x”）。這樣，一旦有一次數據發送出現，我們就可以停止當前的顯示，操作方法仍然是在圖像中間單擊一下菜單。然後按下鼠標左鍵，拖動出一個“縮放框”（zoom box），以便讓系統知道我們想看的區域，然後系統就只顯示這個區域內的圖像內容。如果想調整圖像內容的大小，可以通過右鍵鼠標縮小（zooms out）圖像，左鍵鼠標放大（zooms in）圖像，或者可以使用鼠標滾動輪進行調節，其方式和其他程序通過滾動輪調整大小的方式一樣。</p><p>在圖18中，可以看到，數據流的部分是由1和0組成。每一個“位”看起來和旁邊相同的值的“位”看上去都有些不同，這是系統中的噪聲造成的。如果信號傳輸的距離遠一些，那麼“位”的振幅會減小。如果噪音太大，或信號的幅度太低，那麼可能會在記錄某一位的時候意外地出錯。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/9e89f612a0fc417a82267d9c1e12262e><p class=pgc-img-caption></p></div><p class=ql-align-center>圖18 調整後的數據流</p><p>對信息進行解碼的方法之一，是把一個屏幕的窗口進行截屏，然後手工地錄製每一個比特位。這也是一種“把自己搞得頭暈腦漲，失去僅有的那麼一點理智”的偉大方式，這樣做很容易讓電腦明白和理解我們。除此之外，“時鐘恢復”（clock recovery）也是一個最複雜的、令人沮喪和棘手的一件事。另外，因為我們對“逆向工程”（reverse engineering）就是一個睜眼瞎，所以想知道我們正在做的這一部分是否正確，也是件很困難的事。最重要的事情是我們可以幫助您設計自己的系統，那就是放置一個“時間接收器”（Time Sink）到流程圖的每一步，這樣只要您在每一步中檢查時間接收器的結果，就可以確定所輸出的結果是不是您所期望的值了。</p><p>首先，我們必須確定一下，數據“位”發送的速度有多快，換句話說就是“波特率”（baud rate）的值有多大。在傳輸開始時，首先傳的是“前導碼”（preamble），這樣對於同步定位是有幫助的。“前導碼”通常是一個值為“10101010……”的字符串，並且在通信的時候，“前導碼”會重複地發送足夠多次，以便幫助作為接收方的計算機“鎖定”時鐘。通過使用“時間接收器”，我們算出它花了大約2.1毫秒發送10個數據“位”，做一個小小的除法運算，也就是4761比特/秒，因此我們使用最接近的波特率值為4800波特，因為對於串行端口來說，這是一個有效的波特率，在這個波特率中，我們有足夠的信心可以保證數據傳輸的正確性。</p><p>很簡單，就是10/2.1×103=4761.90。</p><p>在速率為1個“每秒百萬次採樣值”（MSPS）時，每個“位”將有208.3個採樣。這是一個很大數據量的樣本！我們配置的“低通濾波器”將其除以20，也就是說每20個採樣，只取其中1個。那麼這樣，每一個符號“位”就給我們留下了約10.4個樣本。通過使用“Marker”標註“時間接收器”，我們可以看到實際的採樣值，如圖19所示。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4e2d4acf80d84a628fd544dcc04e284f><p class=pgc-img-caption></p></div><p class=ql-align-center>圖19 通過Marker標註“時間接收器”，看到實際的採樣值</p><p>在圖19中，可以看到的數據代表的是“1011”（至少我們非常肯定，我們沒有看到有一位少於10個採樣）。每一個“位”剛剛超過10個“採樣/符號”。我們的目標是將這個值再下降到每個“位”一個採樣，並將其寫入一個文件。我們通過設置“決策閾值”（Decision Threshold）約為0.5。這樣採樣在大於這個值後，就會知道哪個位代表數字1，剩下的位當然就代表數字0。</p><p>您可能會天真地認為，配置一個“低通濾波器”，然後再除了208就“足夠好”了，（1個“每秒百萬次採樣值”除以208約為4800Hz）。但很快會發現，不幸的是，“時鐘抖動”（clock jitter）會引起數據“位”的錯誤。一個更好的方式來做這件事是使用“時鐘恢復”數據塊。您可以告訴這段代碼您對每個符號會產生多少採樣，這樣一來，整個系統就會表現得很好，並且盡最大的努力智能地挑選每一個數據“位”。</p><p>“時鐘恢復”數據塊是很微妙的，它的工作就是提供一個每個符號採樣四次的濾波信號。只要試著將“時鐘恢復”數據塊的輸出與您的“輸入信號”（Input Signal）做一個對比，就會發現有趣的現象，那就是因為採樣率發生了改變，所以最後導致您需要兩個獨立的“時間接收器”。試著建立起這樣的觸發機制有助於後面數據的捕獲。</p><p>因為這裡的“時鐘恢復”數據塊輸出了一個“估計位”（estimated bit），所以我們需要做出一個決定。“二進制識別器”（binary slicer）將會把正的採樣值（positive sample），也就是大於0.0的採樣值識別成“邏輯1”（logical 1），而把負的採樣值（negative sample），識別成“邏輯0”（logical 0）。可以指定“減速”值，以便使用“減速”數據塊幫助濾波器輸出這些數據“位”。</p><p>在這個系統中的一個有趣的數據塊，就是“根升餘弦濾波器”（Root Raised Cosine Filter）。這種特殊的濾波器只用於數字數據。配置輸入採樣率和預期的波特率，它就會通過刪除不必要的頻率，平滑地輸出比特位。正確使用“根升餘弦濾波器”，可以幫助我們得到一個較低的“誤碼率”（Bit Error Rate，BER）。</p><p>圖20說明了一個可以可靠地工作的解決方案。應該指出的是，這種設計只適用於在“實驗室環境”中可以良好地工作，因為“實驗室環境”中，一切傳輸條件都是理想化的。而對於一個在野外的環境中進行工作的系統，設計更為複雜，並且涉及大量的參數微調，如果把這個系統安裝在您的車中，會發現您只能對在10英尺範圍內的汽車車門進行開鎖的破解工作。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c7b8118539204e3ea4bd269d330328e6><p class=pgc-img-caption></p></div><p class=ql-align-center>圖20 終極“開關鍵控”發射器解調方案</p><p>經驗豐富的信號處理專家可以在上面方案中指出一些糟糕的設計選項。比如，在流程的正中間，我們決定需要有“減速”選項的地方都放置了“減速”數據塊。另外，我們任意地選擇了0.5作為一個“減速”值的參數。然而對於這個“減速”值需要設置多低，我們仍然還能接收到信息？也許，額外的分析和濾波器的結構，可更好地提高對傳輸數據捕獲的可靠性。</p><p>一旦我們有數據“位”輸出，我們就需要從中找到我們所需要的信息，並且顯示出來。這時，應該多注意那些在每個傳輸開始的“前導碼”，因為這之後的，才是發送的內容部分，為此，我們專門寫了一塊叫“模式輸出”（Pattern Dump）的數據塊。可以配置一定的模式，然後進行搜索。當這個數據塊的運行中發現有合適的模式，就會打印隨後的N個字節到屏幕上。或者，也可以按位次把這些數據“位”拼湊成一個一個的字節，然後依次將它寫到一個文件中，用於以後分析。</p><p><strong>8、還有什麼遺漏嗎</strong></p><p>下面的內容，就是通過上面的信號處理流程輸出的結果中的一小段。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4f12f8b4dd40400bb93a4029028c6518><p class=pgc-img-caption></p></div><p>從整個文件的內容來看，很明顯，有人使用電子鑰匙首先發送了一個長的“前導碼”。跟著連續發送了4次相同的信息，看上去這把電子鑰匙是拿錯了。如果我們的車沒有接收到第一次所發的消息，那麼電子鑰匙還有三次開鎖的機會。在文件中深度查找，我們可以找到五次相似的塊信息。</p><p>我們注意到一件奇怪的事情，沒有消息順序地依次超過兩個1秒的時間。有一些無線電使用“曼徹斯特編碼”（Manchester encoding）避免“1秒”的長串是“背靠背”（back to back）的形式。也就是說當出現一長串1或一長串0的時候，“曼徹斯特編碼”可以有效地避免接收方無法通過“時間恢復”數據塊進行同步的問題，這是因為“曼徹斯特編碼”將要傳送的數字“1”轉換成了二進制的“10”，而將數字“0”轉換成了二進制的“01”，所以無論傳輸什麼樣的值，中間總有一個“跳變”的過程，因而十分利於“時間恢復”的操作。</p><p>在配置“模式輸出”數據塊以後，就可以完成“曼徹斯特碼”的解碼工作，如上所述，我們可以從中恢復出可靠的比特流數據，如下所示。不過，有些與被攻擊汽車門鎖上，帶有隱私性質的數據都已去掉。</p><div class=pgc-img><img alt=無線攻擊工具：SDR設備 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/190e2f751954493680907838f95045fe><p class=pgc-img-caption></p></div><p>儘管我們還沒有完全做到通過逆向工程破解這把電子鑰匙，但是看上去，上面的數據中，好像有兩個字段正在發生變化：一個16位的字段和一個32位的字段。如果我們重複使用第一次的消息會發生什麼呢？是這次能夠把車門打開，還是顯示代碼已過期？16位字段的第二字節為什麼一直以3為步長進行增量累加？為什麼鎖車按鈕所發送的數據，每次會有如此驚奇的不同？這輛汽車能夠反過來跟電子鑰匙進行數據傳輸嗎？</p><p>要回答這些問題，唯一的辦法就是收集更多的數據。在您理解了車鎖和電子鑰匙之間通信協議的詳細格式以後，就可以進展到實時修改程序的工作了，然後就可以將這一方法擴展到其他車型的車鎖和電子鑰匙上。在某些時候，甚至可能會嘗試構建一個發射器，然後通過暴力的方式破解這些汽車的車鎖安全系統。</p><p><strong>五、結語</strong></p><p>這些SDR設備對以前的無線攻擊進行了重新定義，因而黑客的興趣都轉向瞭如何做好一個個人預算，以便購買更好的一款SDR設備。本文首先介紹了每一款SDR設備的重要特徵，這對於黑客選擇SDR設備都是非常重要的建議。然後介紹了許多可以用於數字信號解碼的第三方的應用程序，有一點好運氣、耐心，加上一個具有發射功能的SDR設備，您就應該能夠進行一些基本的“重播”攻擊，這樣至少可以破解大量常見的電子設備。對於技術深厚的朋友來說，他們應該有更堅實的基礎，可以運行與本文實例相似的攻擊方案，並將無線信息解調，使之恢復到它們原來作為二進制有效載荷時的狀態，因為這是下一步進行分析、修改、重新攻擊的基礎。</p><p>您現在在對無線安全方面進行研究的時候，都需要將SDR設備工具作為您的攻擊裝備隨時攜帶，這些工具毫無疑問都是必不可少的。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>無線</a></li><li><a>攻擊</a></li><li><a>SDR</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/ac5c47fd.html alt=FPGA無線通信課程連載——擾碼的原理及實現 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RzH3OlM2Sr7uEv style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ac5c47fd.html title=FPGA無線通信課程連載——擾碼的原理及實現>FPGA無線通信課程連載——擾碼的原理及實現</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5ccb8575.html alt=建築工地無線傳輸視頻監控系統解決方案 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f9859575f6154e0bb86298076179c081 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5ccb8575.html title=建築工地無線傳輸視頻監控系統解決方案>建築工地無線傳輸視頻監控系統解決方案</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/11159663.html alt=無線局域網的組網方式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1536563136079a680e70cbf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/11159663.html title=無線局域網的組網方式>無線局域網的組網方式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9334bf46.html alt=無線網橋的連接方式有哪些？多條寬帶如何疊加？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/37716df4aae74dea9be705ae817bbfec style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9334bf46.html title=無線網橋的連接方式有哪些？多條寬帶如何疊加？>無線網橋的連接方式有哪些？多條寬帶如何疊加？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8502a93b.html alt=新基建下的5G產業，基站無線傳輸設備質量如何保證？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/103166e6bb564fa28672d82ed5a39cfc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8502a93b.html title=新基建下的5G產業，基站無線傳輸設備質量如何保證？>新基建下的5G產業，基站無線傳輸設備質量如何保證？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bdcc4e56.html alt=一種高級的DoS攻擊-Hash碰撞攻擊 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c1c0537cde484d3daea887e3ef059355 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bdcc4e56.html title=一種高級的DoS攻擊-Hash碰撞攻擊>一種高級的DoS攻擊-Hash碰撞攻擊</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b180767b.html alt=激光和無線電波產生的原理本質上有區別嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2e965d5e74f44420b87ba3688e1d4034 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b180767b.html title=激光和無線電波產生的原理本質上有區別嗎？>激光和無線電波產生的原理本質上有區別嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/07abeb8b.html alt=黑客攻擊中最常見的“用戶憑證”，到底是什麼？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/c357560982c640efb9d6b90ef0f08085 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/07abeb8b.html title=黑客攻擊中最常見的“用戶憑證”，到底是什麼？>黑客攻擊中最常見的“用戶憑證”，到底是什麼？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ae9ac502.html alt=無線擦地機：手握灑哇地咔，變身清潔專家 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/37ed000096c67661674c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ae9ac502.html title=無線擦地機：手握灑哇地咔，變身清潔專家>無線擦地機：手握灑哇地咔，變身清潔專家</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/21423045.html alt=筆記本電腦無線WiFi總是自動關閉怎麼解決 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/R6YvQw5ARZ7UKF style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/21423045.html title=筆記本電腦無線WiFi總是自動關閉怎麼解決>筆記本電腦無線WiFi總是自動關閉怎麼解決</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ebada982.html alt=TP-LINK無線廣播怎麼設置 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7845c4da04ea41db9d4c852b9c5c712e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ebada982.html title=TP-LINK無線廣播怎麼設置>TP-LINK無線廣播怎麼設置</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f472d407.html alt=無線對講應用之地下停車場FM調頻廣播覆蓋方案 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d1b8ab0859f8403aa0c96e85533dc067 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f472d407.html title=無線對講應用之地下停車場FM調頻廣播覆蓋方案>無線對講應用之地下停車場FM調頻廣播覆蓋方案</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/74df2943.html alt=論飽和攻擊在華為高速成長中的重要價值 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/74df2943.html title=論飽和攻擊在華為高速成長中的重要價值>論飽和攻擊在華為高速成長中的重要價值</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a81ce1a8.html alt=一分鐘帶您認識無線網橋知識 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1538195953013fb02f339fc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a81ce1a8.html title=一分鐘帶您認識無線網橋知識>一分鐘帶您認識無線網橋知識</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/99484730.html alt=有關無線網橋的知識都在這裡了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/438d0003b24fdd282793 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/99484730.html title=有關無線網橋的知識都在這裡了>有關無線網橋的知識都在這裡了</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>