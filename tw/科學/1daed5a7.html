<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 | 极客快訊</title><meta property="og:title" content="從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/2801f22bc84a40908012ce49b617e26c"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/1daed5a7.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/1daed5a7.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/1daed5a7.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/1daed5a7.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/1daed5a7.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/1daed5a7.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/1daed5a7.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/1daed5a7.html><meta property="article:published_time" content="2020-11-14T20:51:10+08:00"><meta property="article:modified_time" content="2020-11-14T20:51:10+08:00"><meta name=Keywords content><meta name=description content="從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E5%AD%B8/1daed5a7.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E5%AD%B8.html>科學</a></span></div><div class=post-content><div><h1><strong>1、引言</strong></h1><p>本文以設計淘寶網的後臺架構為例，介紹從一百個併發到千萬級併發情況下服務端的架構的14次演進過程，同時列舉出每個演進階段會遇到的相關技術，讓大家對架構的演進有一個整體的認知。文章最後彙總了一些架構設計的原則。</p><p>（本文同步發佈於：http://www.52im.net/thread-2665-1-1.html）</p><h1><strong>2、關於作者</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2801f22bc84a40908012ce49b617e26c><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p><strong>huashiou：</strong>廣東工業大學計算機科學與技術碩士畢業，大數據開發工程師。在大數據領域具有多年的開發經驗，對常用大數據技術都有所瞭解，在架構設計、高併發、分佈式等方面具有一定經驗。喜歡學習新技術，樂於分享，歡迎大家關注本博客。</p><h1><strong>3、相關文章</strong></h1><blockquote><p>《新手入門：零基礎理解大型分佈式架構的演進歷史、技術原理、最佳實踐》</p><p>《騰訊資深架構師乾貨總結：一文讀懂大型分佈式系統設計的方方面面》</p><p>《一篇讀懂分佈式架構下的負載均衡技術：分類、原理、算法、常見方案等》</p><p>《快速理解高性能HTTP服務端的負載均衡技術原理》</p><p>《知乎技術分享：從單機到2000萬QPS併發的Redis高性能緩存實踐之路》</p><p>《達達O2O後臺架構演進實踐：從0到4000高併發請求背後的努力》</p><p>《小米技術分享：解密小米搶購系統千萬高併發架構的演進和實踐》</p><p>《通俗易懂：如何設計能支撐百萬併發的數據庫架構？》</p></blockquote><h1><strong>4、基本概念</strong></h1><p>在介紹架構之前，為了避免部分讀者對架構設計中的一些概念不瞭解，下面對幾個最基礎的概念進行介紹。</p><p><strong>1）什麼是分佈式？</strong></p><p>系統中的多個模塊在不同服務器上部署，即可稱為分佈式系統，如Tomcat和數據庫分別部署在不同的服務器上，或兩個相同功能的Tomcat分別部署在不同服務器上。</p><p><strong>2）什麼是高可用？</strong></p><p>系統中部分節點失效時，其他節點能夠接替它繼續提供服務，則可認為系統具有高可用性。</p><p><strong>3）什麼是集群？</strong></p><p>一個特定領域的軟件部署在多臺服務器上並作為一個整體提供一類服務，這個整體稱為集群。</p><p>如Zookeeper中的Master和Slave分別部署在多臺服務器上，共同組成一個整體提供集中配置服務。</p><p>在常見的集群中，客戶端往往能夠連接任意一個節點獲得服務，並且當集群中一個節點掉線時，其他節點往往能夠自動的接替它繼續提供服務，這時候說明集群具有高可用性。</p><p><strong>4）什麼是負載均衡？</strong></p><p>請求發送到系統時，通過某些方式把請求均勻分發到多個節點上，使系統中每個節點能夠均勻的處理請求負載，則可認為系統是負載均衡的。</p><p><strong>5）什麼是正向代理和反向代理？</strong></p><p>系統內部要訪問外部網絡時，統一通過一個代理服務器把請求轉發出去，在外部網絡看來就是代理服務器發起的訪問，此時代理服務器實現的是正向代理；</p><p>當外部請求進入系統時，代理服務器把該請求轉發到系統中的某臺服務器上，對外部請求來說，與之交互的只有代理服務器，此時代理服務器實現的是反向代理。</p><p>簡單來說，正向代理是代理服務器代替系統內部來訪問外部網絡的過程，反向代理是外部請求訪問系統時通過代理服務器轉發到內部服務器的過程。</p><h1><strong>5、純真年代：單機架構</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/bc337b6cd10f422c9ef39a9d97f73f0c><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>以淘寶作為例子：在網站最初時，應用數量與用戶數都較少，可以把Tomcat和數據庫部署在同一臺服務器上。瀏覽器往www.taobao.com發起請求時，首先經過DNS服務器（域名系統）把域名轉換為實際IP地址10.102.4.1，瀏覽器轉而訪問該IP對應的Tomcat。</p><p><strong>架構瓶頸：</strong>隨著用戶數的增長，Tomcat和數據庫之間競爭資源，單機性能不足以支撐業務。</p><h1><strong>6、第一次演進：Tomcat與數據庫分開部署</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/94bf27bc01c14d4bba2ff4036e135360><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>Tomcat和數據庫分別獨佔服務器資源，顯著提高兩者各自性能。</p><p><strong>架構瓶頸：</strong>隨著用戶數的增長，併發讀寫數據庫成為瓶頸。</p><h1><strong>7、第二次演進：引入本地緩存和分佈式緩存</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6b03350420e34a65abdaf54083848aab><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>在Tomcat同服務器上或同JVM中增加本地緩存，並在外部增加分佈式緩存，緩存熱門商品信息或熱門商品的html頁面等。通過緩存能把絕大多數請求在讀寫數據庫前攔截掉，大大降低數據庫壓力。其中涉及的技術包括：使用memcached作為本地緩存，使用Redis作為分佈式緩存，還會涉及緩存一致性、緩存穿透/擊穿、緩存雪崩、熱點數據集中失效等問題。</p><p><strong>架構瓶頸：</strong>緩存抗住了大部分的訪問請求，隨著用戶數的增長，併發壓力主要落在單機的Tomcat上，響應逐漸變慢。</p><h1><strong>8、第三次演進：引入反向代理實現負載均衡</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3844d793068d4aa286e07d07908ea055><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>在多臺服務器上分別部署Tomcat，使用反向代理軟件（Nginx）把請求均勻分發到每個Tomcat中。此處假設Tomcat最多支持100個併發，Nginx最多支持50000個併發，那麼理論上Nginx把請求分發到500個Tomcat上，就能抗住50000個併發。</p><p>其中涉及的技術包括：Nginx、HAProxy，兩者都是工作在網絡第七層的反向代理軟件，主要支持http協議，還會涉及session共享、文件上傳下載的問題。</p><p><strong>架構瓶頸：</strong>反向代理使應用服務器可支持的併發量大大增加，但併發量的增長也意味著更多請求穿透到數據庫，單機的數據庫最終成為瓶頸。</p><h1><strong>9、第四次演進：數據庫讀寫分離</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/dc102be96e1b4a8680b1450569881760><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>把數據庫劃分為讀庫和寫庫，讀庫可以有多個，通過同步機制把寫庫的數據同步到讀庫，對於需要查詢最新寫入數據場景，可通過在緩存中多寫一份，通過緩存獲得最新數據。其中涉及的技術包括：Mycat，它是數據庫中間件，可通過它來組織數據庫的分離讀寫和分庫分表，客戶端通過它來訪問下層數據庫，還會涉及數據同步，數據一致性的問題。</p><p><strong>架構瓶頸：</strong>業務逐漸變多，不同業務之間的訪問量差距較大，不同業務直接競爭數據庫，相互影響性能。</p><h1><strong>10、第五次演進：數據庫按業務分庫</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/21df217c6c354517b45fb184ad95d6ad><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>把不同業務的數據保存到不同的數據庫中，使業務之間的資源競爭降低，對於訪問量大的業務，可以部署更多的服務器來支撐。這樣同時導致跨業務的表無法直接做關聯分析，需要通過其他途徑來解決，但這不是本文討論的重點，有興趣的可以自行搜索解決方案。</p><p><strong>架構瓶頸：</strong>隨著用戶數的增長，單機的寫庫會逐漸會達到性能瓶頸。</p><h1><strong>11、第六次演進：把大表拆分為小表</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/04f0fb91f23341abb799b0df7879c04f><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>比如針對評論數據，可按照商品ID進行hash，路由到對應的表中存儲；針對支付記錄，可按照小時創建表，每個小時表繼續拆分為小表，使用用戶ID或記錄編號來路由數據。只要實時操作的表數據量足夠小，請求能夠足夠均勻的分發到多臺服務器上的小表，那數據庫就能通過水平擴展的方式來提高性能。其中前面提到的Mycat也支持在大表拆分為小表情況下的訪問控制。</p><p>這種做法顯著的增加了數據庫運維的難度，對DBA的要求較高。數據庫設計到這種結構時，已經可以稱為分佈式數據庫，但是這只是一個邏輯的數據庫整體，數據庫裡不同的組成部分是由不同的組件單獨來實現的，如分庫分表的管理和請求分發，由Mycat實現，SQL的解析由單機的數據庫實現，讀寫分離可能由網關和消息隊列來實現，查詢結果的彙總可能由數據庫接口層來實現等等，這種架構其實是MPP（大規模並行處理）架構的一類實現。</p><p>目前開源和商用都已經有不少MPP數據庫，開源中比較流行的有Greenplum、TiDB、Postgresql XC、HAWQ等，商用的如南大通用的GBase、睿帆科技的雪球DB、華為的LibrA等等，不同的MPP數據庫的側重點也不一樣，如TiDB更側重於分佈式OLTP場景，Greenplum更側重於分佈式OLAP場景，這些MPP數據庫基本都提供了類似Postgresql、Oracle、MySQL那樣的SQL標準支持能力，能把一個查詢解析為分佈式的執行計劃分發到每臺機器上並行執行，最終由數據庫本身彙總數據進行返回，也提供了諸如權限管理、分庫分表、事務、數據副本等能力，並且大多能夠支持100個節點以上的集群，大大降低了數據庫運維的成本，並且使數據庫也能夠實現水平擴展。</p><p><strong>架構瓶頸：</strong>數據庫和Tomcat都能夠水平擴展，可支撐的併發大幅提高，隨著用戶數的增長，最終單機的Nginx會成為瓶頸。</p><h1><strong>12、第七次演進：使用LVS或F5來使多個Nginx負載均衡</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/b7570de99d57443b987c92b414665c67><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>由於瓶頸在Nginx，因此無法通過兩層的Nginx來實現多個Nginx的負載均衡。圖中的LVS和F5是工作在網絡第四層的負載均衡解決方案，其中LVS是軟件，運行在操作系統內核態，可對TCP請求或更高層級的網絡協議進行轉發，因此支持的協議更豐富，並且性能也遠高於Nginx，可假設單機的LVS可支持幾十萬個併發的請求轉發；F5是一種負載均衡硬件，與LVS提供的能力類似，性能比LVS更高，但價格昂貴。由於LVS是單機版的軟件，若LVS所在服務器宕機則會導致整個後端系統都無法訪問，因此需要有備用節點。可使用keepalived軟件模擬出虛擬IP，然後把虛擬IP綁定到多臺LVS服務器上，瀏覽器訪問虛擬IP時，會被路由器重定向到真實的LVS服務器，當主LVS服務器宕機時，keepalived軟件會自動更新路由器中的路由表，把虛擬IP重定向到另外一臺正常的LVS服務器，從而達到LVS服務器高可用的效果。</p><p>此處需要注意的是，上圖中從Nginx層到Tomcat層這樣畫並不代表全部Nginx都轉發請求到全部的Tomcat，在實際使用時，可能會是幾個Nginx下面接一部分的Tomcat，這些Nginx之間通過keepalived實現高可用，其他的Nginx接另外的Tomcat，這樣可接入的Tomcat數量就能成倍的增加。</p><p><strong>架構瓶頸：</strong>由於LVS也是單機的，隨著併發數增長到幾十萬時，LVS服務器最終會達到瓶頸，此時用戶數達到千萬甚至上億級別，用戶分佈在不同的地區，與服務器機房距離不同，導致了訪問的延遲會明顯不同。</p><h1><strong>13、第八次演進：通過DNS輪詢實現機房間的負載均衡</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/de23edfa10fb4bc892d9e93e4a3d8ee8><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>在DNS服務器中可配置一個域名對應多個IP地址，每個IP地址對應到不同的機房裡的虛擬IP。當用戶訪問www.taobao.com時，DNS服務器會使用輪詢策略或其他策略，來選擇某個IP供用戶訪問。此方式能實現機房間的負載均衡，至此，系統可做到機房級別的水平擴展，千萬級到億級的併發量都可通過增加機房來解決，系統入口處的請求併發量不再是問題。</p><p><strong>架構瓶頸：</strong>隨著數據的豐富程度和業務的發展，檢索、分析等需求越來越豐富，單單依靠數據庫無法解決如此豐富的需求。</p><h1><strong>14、第九次演進：引入NoSQL數據庫和搜索引擎等技術</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6675e8591eac4edb8f94e7e23a552b1a><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>當數據庫中的數據多到一定規模時，數據庫就不適用於複雜的查詢了，往往只能滿足普通查詢的場景。對於統計報表場景，在數據量大時不一定能跑出結果，而且在跑複雜查詢時會導致其他查詢變慢，對於全文檢索、可變數據結構等場景，數據庫天生不適用。因此需要針對特定的場景，引入合適的解決方案。如對於海量文件存儲，可通過分佈式文件系統HDFS解決，對於key value類型的數據，可通過HBase和Redis等方案解決，對於全文檢索場景，可通過搜索引擎如ElasticSearch解決，對於多維分析場景，可通過Kylin或Druid等方案解決。</p><p>當然，引入更多組件同時會提高系統的複雜度，不同的組件保存的數據需要同步，需要考慮一致性的問題，需要有更多的運維手段來管理這些組件等。</p><p><strong>架構瓶頸：</strong>引入更多組件解決了豐富的需求，業務維度能夠極大擴充，隨之而來的是一個應用中包含了太多的業務代碼，業務的升級迭代變得困難。</p><h1><strong>15、第十次演進：大應用拆分為小應用</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/ad511370704544919e611d4f1becd040><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>按照業務板塊來劃分應用代碼，使單個應用的職責更清晰，相互之間可以做到獨立升級迭代。這時候應用之間可能會涉及到一些公共配置，可以通過分佈式配置中心Zookeeper來解決。</p><p><strong>架構瓶頸：</strong>不同應用之間存在共用的模塊，由應用單獨管理會導致相同代碼存在多份，導致公共功能升級時全部應用代碼都要跟著升級。</p><h1><strong>16、第十一次演進：複用的功能抽離成微服務</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12f866c3247c4424815a6fa06b277aff><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>如用戶管理、訂單、支付、鑑權等功能在多個應用中都存在，那麼可以把這些功能的代碼單獨抽取出來形成一個單獨的服務來管理，這樣的服務就是所謂的微服務，應用和服務之間通過HTTP、TCP或RPC請求等多種方式來訪問公共服務，每個單獨的服務都可以由單獨的團隊來管理。此外，可以通過Dubbo、SpringCloud等框架實現服務治理、限流、熔斷、降級等功能，提高服務的穩定性和可用性。</p><p><strong>架構瓶頸：</strong>不同服務的接口訪問方式不同，應用代碼需要適配多種訪問方式才能使用服務，此外，應用訪問服務，服務之間也可能相互訪問，調用鏈將會變得非常複雜，邏輯變得混亂。</p><h1><strong>17、第十二次演進：引入企業服務總線ESB屏蔽服務接口的訪問差異</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12ebad3254104475a0c022242ef3ed71><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>通過ESB統一進行訪問協議轉換，應用統一通過ESB來訪問後端服務，服務與服務之間也通過ESB來相互調用，以此降低系統的耦合程度。</p><p>這種單個應用拆分為多個應用，公共服務單獨抽取出來來管理，並使用企業消息總線來解除服務之間耦合問題的架構，就是所謂的SOA（面向服務）架構，這種架構與微服務架構容易混淆，因為表現形式十分相似。</p><p>個人理解，微服務架構更多是指把系統裡的公共服務抽取出來單獨運維管理的思想，而SOA架構則是指一種拆分服務並使服務接口訪問變得統一的架構思想，SOA架構中包含了微服務的思想。</p><p><strong>架構瓶頸：</strong>業務不斷髮展，應用和服務都會不斷變多，應用和服務的部署變得複雜，同一臺服務器上部署多個服務還要解決運行環境衝突的問題，此外，對於如大促這類需要動態擴縮容的場景，需要水平擴展服務的性能，就需要在新增的服務上準備運行環境，部署服務等，運維將變得十分困難。</p><h1><strong>18、第十三次演進：引入容器化技術實現運行環境隔離與動態服務管理</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/bdc87c75dd73423b8e7c2603913f1133><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>目前最流行的容器化技術是Docker，最流行的容器管理服務是Kubernetes(K8S)，應用/服務可以打包為Docker鏡像，通過K8S來動態分發和部署鏡像。Docker鏡像可理解為一個能運行你的應用/服務的最小的操作系統，裡面放著應用/服務的運行代碼，運行環境根據實際的需要設置好。把整個“操作系統”打包為一個鏡像後，就可以分發到需要部署相關服務的機器上，直接啟動Docker鏡像就可以把服務起起來，使服務的部署和運維變得簡單。</p><p>在大促的之前，可以在現有的機器集群上劃分出服務器來啟動Docker鏡像，增強服務的性能，大促過後就可以關閉鏡像，對機器上的其他服務不造成影響（在第18節之前，服務運行在新增機器上需要修改系統配置來適配服務，這會導致機器上其他服務需要的運行環境被破壞）。</p><p><strong>架構瓶頸：</strong>使用容器化技術後服務動態擴縮容問題得以解決，但是機器還是需要公司自身來管理，在非大促的時候，還是需要閒置著大量的機器資源來應對大促，機器自身成本和運維成本都極高，資源利用率低。</p><h1><strong>19、第十四次演進：以雲平臺承載系統</strong></h1><p class=ql-align-center><br></p><div class=pgc-img><img alt=從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8791b8fa508e4aacaccd060e8cfb6738><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>系統可部署到公有云上，利用公有云的海量機器資源，解決動態硬件資源的問題，在大促的時間段裡，在雲平臺中臨時申請更多的資源，結合Docker和K8S來快速部署服務，在大促結束後釋放資源，真正做到按需付費，資源利用率大大提高，同時大大降低了運維成本。</p><p>所謂的雲平臺，就是把海量機器資源，通過統一的資源管理，抽象為一個資源整體，在之上可按需動態申請硬件資源（如CPU、內存、網絡等），並且之上提供通用的操作系統，提供常用的技術組件（如Hadoop技術棧，MPP數據庫等）供用戶使用，甚至提供開發好的應用，用戶不需要關係應用內部使用了什麼技術，就能夠解決需求（如音視頻轉碼服務、郵件服務、個人博客等）。</p><p><strong>在雲平臺中會涉及如下幾個概念：</strong></p><p>1）IaaS：基礎設施即服務。對應於上面所說的機器資源統一為資源整體，可動態申請硬件資源的層面；</p><p>2）PaaS：平臺即服務。對應於上面所說的提供常用的技術組件方便系統的開發和維護；</p><p>3）SaaS：軟件即服務。對應於上面所說的提供開發好的應用或服務，按功能或性能要求付費。</p><p><strong>至此：</strong>以上所提到的從高併發訪問問題，到服務的架構和系統實施的層面都有了各自的解決方案。但同時也應該意識到，在上面的介紹中，其實是有意忽略了諸如跨機房數據同步、分佈式事務實現等等的實際問題，這些問題以後有機會再拿出來單獨討論。</p><h1><strong>20、架構設計經驗小結</strong></h1><p><strong><em>1）架構的調整是否必須按照上述演變路徑進行？</em></strong></p><p>不是的，以上所說的架構演變順序只是針對某個側面進行單獨的改進，在實際場景中，可能同一時間會有幾個問題需要解決，或者可能先達到瓶頸的是另外的方面，這時候就應該按照實際問題實際解決。如在政府類的併發量可能不大，但業務可能很豐富的場景，高併發就不是重點解決的問題，此時優先需要的可能會是豐富需求的解決方案。</p><p><strong><em>2）對於將要實施的系統，架構應該設計到什麼程度？</em></strong></p><p>對於單次實施並且性能指標明確的系統，架構設計到能夠支持系統的性能指標要求就足夠了，但要留有擴展架構的接口以便不備之需。對於不斷髮展的系統，如電商平臺，應設計到能滿足下一階段用戶量和性能指標要求的程度，並根據業務的增長不斷的迭代升級架構，以支持更高的併發和更豐富的業務。</p><p><strong><em>3）服務端架構和大數據架構有什麼區別？</em></strong></p><p>所謂的“大數據”其實是海量數據採集清洗轉換、數據存儲、數據分析、數據服務等場景解決方案的一個統稱，在每一個場景都包含了多種可選的技術，如數據採集有Flume、Sqoop、Kettle等，數據存儲有分佈式文件系統HDFS、FastDFS，NoSQL數據庫HBase、MongoDB等，數據分析有Spark技術棧、機器學習算法等。總的來說大數據架構就是根據業務的需求，整合各種大數據組件組合而成的架構，一般會提供分佈式存儲、分佈式計算、多維分析、數據倉庫、機器學習算法等能力。而服務端架構更多指的是應用組織層面的架構，底層能力往往是由大數據架構來提供。</p><p><strong><em>4）有沒有一些架構設計的原則？</em></strong></p><p>a. N+1設計：系統中的每個組件都應做到沒有單點故障；</p><p>b. 回滾設計：確保系統可以向前兼容，在系統升級時應能有辦法回滾版本；</p><p>c. 禁用設計：應該提供控制具體功能是否可用的配置，在系統出現故障時能夠快速下線功能；</p><p>d. 監控設計：在設計階段就要考慮監控的手段；</p><p>e. 多活數據中心設計：若系統需要極高的高可用，應考慮在多地實施數據中心進行多活，至少在一個機房斷電的情況下系統依然可用；</p><p>f. 採用成熟的技術：剛開發的或開源的技術往往存在很多隱藏的bug，出了問題沒有商業支持可能會是一個災難；</p><p>g. 資源隔離設計：應避免單一業務佔用全部資源；</p><p>h. 架構應能水平擴展：系統只有做到能水平擴展，才能有效避免瓶頸問題；</p><p>i. 非核心則購買：非核心功能若需要佔用大量的研發資源才能解決，則考慮購買成熟的產品；</p><p>j. 使用商用硬件：商用硬件能有效降低硬件故障的機率；</p><p>k. 快速迭代：系統應該快速開發小功能模塊，儘快上線進行驗證，早日發現問題大大降低系統交付的風險；</p><p>l. 無狀態設計：服務接口應該做成無狀態的，當前接口的訪問不依賴於接口上次訪問的狀態。</p><h1><strong>附錄：更多架構設計方面的文章</strong></h1><blockquote><p><strong>[1] 更多其它架構設計相關文章：</strong></p><p>《騰訊資深架構師乾貨總結：一文讀懂大型分佈式系統設計的方方面面》</p><p>《快速理解高性能HTTP服務端的負載均衡技術原理》</p><p>《子彈短信光鮮的背後：網易雲信首席架構師分享億級IM平臺的技術實踐》</p><p>《知乎技術分享：從單機到2000萬QPS併發的Redis高性能緩存實踐之路》</p><p>《新手入門：零基礎理解大型分佈式架構的演進歷史、技術原理、最佳實踐》</p><p>《阿里技術分享：深度揭祕阿里數據庫技術方案的10年變遷史》</p><p>《阿里技術分享：阿里自研金融級數據庫OceanBase的艱辛成長之路》</p><p>《達達O2O後臺架構演進實踐：從0到4000高併發請求背後的努力》</p><p>《優秀後端架構師必會知識：史上最全MySQL大表優化方案總結》</p><p>《小米技術分享：解密小米搶購系統千萬高併發架構的演進和實踐》</p><p>《一篇讀懂分佈式架構下的負載均衡技術：分類、原理、算法、常見方案等》</p><p>《通俗易懂：如何設計能支撐百萬併發的數據庫架構？》</p><p>《多維度對比5款主流分佈式MQ消息隊列，媽媽再也不擔心我的技術選型了》</p><p>《從新手到架構師，一篇就夠：從100到1000萬高併發的架構演進之路》</p><p>>> 更多同類文章 ……</p><p><strong>[2] 有關IM架構設計的文章：</strong></p><p>《淺談IM系統的架構設計》</p><p>《簡述移動端IM開發的那些坑：架構設計、通信協議和客戶端》</p><p>《一套海量在線用戶的移動端IM架構設計實踐分享(含詳細圖文)》</p><p>《一套原創分佈式即時通訊(IM)系統理論架構方案》</p><p>《從零到卓越：京東客服即時通訊系統的技術架構演進歷程》</p><p>《蘑菇街即時通訊/IM服務器開發之架構選擇》</p><p>《騰訊QQ1.4億在線用戶的技術挑戰和架構演進之路PPT》</p><p>《微信後臺基於時間序的海量數據冷熱分級架構設計實踐》</p><p>《微信技術總監談架構：微信之道——大道至簡(演講全文)》</p><p>《如何解讀《微信技術總監談架構：微信之道——大道至簡》》</p><p>《快速裂變：見證微信強大後臺架構從0到1的演進歷程（一）》</p><p>《17年的實踐：騰訊海量產品的技術方法論》</p><p>《移動端IM中大規模群消息的推送如何保證效率、實時性？》</p><p>《現代IM系統中聊天消息的同步和存儲方案探討》</p><p>《IM開發基礎知識補課(二)：如何設計大量圖片文件的服務端存儲架構？》</p><p>《IM開發基礎知識補課(三)：快速理解服務端數據庫讀寫分離原理及實踐建議》</p><p>《IM開發基礎知識補課(四)：正確理解HTTP短連接中的Cookie、Session和Token》</p><p>《WhatsApp技術實踐分享：32人工程團隊創造的技術神話》</p><p>《微信朋友圈千億訪問量背後的技術挑戰和實踐總結》</p><p>《王者榮耀2億用戶量的背後：產品定位、技術架構、網絡方案等》</p><p>《IM系統的MQ消息中間件選型：Kafka還是RabbitMQ？》</p><p>《騰訊資深架構師乾貨總結：一文讀懂大型分佈式系統設計的方方面面》</p><p>《以微博類應用場景為例，總結海量社交系統的架構設計步驟》</p><p>《快速理解高性能HTTP服務端的負載均衡技術原理》</p><p>《子彈短信光鮮的背後：網易雲信首席架構師分享億級IM平臺的技術實踐》</p><p>《知乎技術分享：從單機到2000萬QPS併發的Redis高性能緩存實踐之路》</p><p>《IM開發基礎知識補課(五)：通俗易懂，正確理解並用好MQ消息隊列》</p><p>《微信技術分享：微信的海量IM聊天消息序列號生成實踐（算法原理篇）》</p><p>《微信技術分享：微信的海量IM聊天消息序列號生成實踐（容災方案篇）》</p><p>《新手入門：零基礎理解大型分佈式架構的演進歷史、技術原理、最佳實踐》</p><p>《一套高可用、易伸縮、高併發的IM群聊、單聊架構方案設計實踐》</p><p>《阿里技術分享：深度揭祕阿里數據庫技術方案的10年變遷史》</p><p>《阿里技術分享：阿里自研金融級數據庫OceanBase的艱辛成長之路》</p><p>《社交軟件紅包技術解密(一)：全面解密QQ紅包技術方案——架構、技術實現等》</p><p>《社交軟件紅包技術解密(二)：解密微信搖一搖紅包從0到1的技術演進》</p><p>《社交軟件紅包技術解密(三)：微信搖一搖紅包雨背後的技術細節》</p><p>《社交軟件紅包技術解密(四)：微信紅包系統是如何應對高併發的》</p><p>《社交軟件紅包技術解密(五)：微信紅包系統是如何實現高可用性的》</p><p>《社交軟件紅包技術解密(六)：微信紅包系統的存儲層架構演進實踐》</p><p>《社交軟件紅包技術解密(七)：支付寶紅包的海量高併發技術實踐》</p><p>《社交軟件紅包技術解密(八)：全面解密微博紅包技術方案》</p><p>《社交軟件紅包技術解密(九)：談談手Q紅包的功能邏輯、容災、運維、架構等》</p><p>《即時通訊新手入門：一文讀懂什麼是Nginx？它能否實現IM的負載均衡？》</p><p>《即時通訊新手入門：快速理解RPC技術——基本概念、原理和用途》</p><p>《多維度對比5款主流分佈式MQ消息隊列，媽媽再也不擔心我的技術選型了》</p><p>>> 更多同類文章 ……</p></blockquote><p>（本文同步發佈於：http://www.52im.net/thread-2665-1-1.html）</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>構師</a></li><li><a>就夠</a></li><li><a>100</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/93dc93ab.html alt="招商銀行 掌上生活 12.17飯票日優惠 吃100送100" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RCUBXg83GsdCPy style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/93dc93ab.html title="招商銀行 掌上生活 12.17飯票日優惠 吃100送100">招商銀行 掌上生活 12.17飯票日優惠 吃100送100</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c96865e4.html alt=C語言經典100例004-統計各個年齡階段的人數 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/98c4bb54-8d7e-4234-bf07-0d8190ba1a0c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c96865e4.html title=C語言經典100例004-統計各個年齡階段的人數>C語言經典100例004-統計各個年齡階段的人數</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2a9a3956.html alt="100 個網絡基礎知識普及，看完成半個網絡高手！" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/955ea722-be77-4b2d-b87a-64a8a04c8ea8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2a9a3956.html title="100 個網絡基礎知識普及，看完成半個網絡高手！">100 個網絡基礎知識普及，看完成半個網絡高手！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bd43eb89.html alt=看懂這100張電工電路圖，基本上月薪過萬了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f56a71916a9b4de8ae8ca5ac56544fa0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bd43eb89.html title=看懂這100張電工電路圖，基本上月薪過萬了>看懂這100張電工電路圖，基本上月薪過萬了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4daed3e6.html alt=室內裝修施工《100個工藝細節做法圖》，看看夠不夠規範？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/17f9195add024164ac7099ca415bd905 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4daed3e6.html title=室內裝修施工《100個工藝細節做法圖》，看看夠不夠規範？>室內裝修施工《100個工藝細節做法圖》，看看夠不夠規範？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/95a57792.html alt=面試官：100萬個成員的數組取第一個和最後一個有性能差距嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5d61204d36a64ca9864df863782072b0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/95a57792.html title=面試官：100萬個成員的數組取第一個和最後一個有性能差距嗎？>面試官：100萬個成員的數組取第一個和最後一個有性能差距嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b506f512.html alt=九年新浪架構師整理PHP架構核心技術教程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b3a3c32254344742b6746996f7fab54b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b506f512.html title=九年新浪架構師整理PHP架構核心技術教程>九年新浪架構師整理PHP架構核心技術教程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/600bb915.html alt=100秒：“秒懂”常見鎳及鎳基合金牌號及應用方向 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/152308789249923dda71700 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/600bb915.html title=100秒：“秒懂”常見鎳及鎳基合金牌號及應用方向>100秒：“秒懂”常見鎳及鎳基合金牌號及應用方向</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8ad38ff5.html alt=國內首臺100千瓦微型燃氣輪機滿負荷發電運行 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8ad38ff5.html title=國內首臺100千瓦微型燃氣輪機滿負荷發電運行>國內首臺100千瓦微型燃氣輪機滿負荷發電運行</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e87a5a36.html alt=大漲100+！全國鋼材價格全面上漲 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/c7f49f368945457bb5e0b721cc19546e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e87a5a36.html title=大漲100+！全國鋼材價格全面上漲>大漲100+！全國鋼材價格全面上漲</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e7d9e446.html alt=100個高分子名詞解釋，不管你是材料界小白還是老司機，果斷收藏 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/f6ea54307aa34f28987a6be5fa625ee1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e7d9e446.html title=100個高分子名詞解釋，不管你是材料界小白還是老司機，果斷收藏>100個高分子名詞解釋，不管你是材料界小白還是老司機，果斷收藏</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d2aad16e.html alt=風華：從0到100萬【逆襲方法】 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d2aad16e.html title=風華：從0到100萬【逆襲方法】>風華：從0到100萬【逆襲方法】</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0e8ffd27.html alt=100多種（含品種）秋海棠在上海植物園展出 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f7620b02b90c4ef1a5828e9834476b0e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0e8ffd27.html title=100多種（含品種）秋海棠在上海植物園展出>100多種（含品種）秋海棠在上海植物園展出</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e9f5a569.html alt=搞懂給排水專業的100個問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/66c9000136849b38a4a2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e9f5a569.html title=搞懂給排水專業的100個問題>搞懂給排水專業的100個問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/384f3f9e.html alt=給排水專業知識100問 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/68a438622fc94d71b3fcbdcf58e14049 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/384f3f9e.html title=給排水專業知識100問>給排水專業知識100問</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>