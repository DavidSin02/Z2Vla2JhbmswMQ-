<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>操作系統 - 操作系統的調試 | 极客快訊</title><meta property="og:title" content="操作系統 - 操作系統的調試 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/b0c1b20accf448409c81b82f7bcc4bdc"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/43a8cb7.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/43a8cb7.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/43a8cb7.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/43a8cb7.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/43a8cb7.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/43a8cb7.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/43a8cb7.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/43a8cb7.html><meta property="article:published_time" content="2020-10-29T21:02:12+08:00"><meta property="article:modified_time" content="2020-10-29T21:02:12+08:00"><meta name=Keywords content><meta name=description content="操作系統 - 操作系統的調試"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E5%AD%B8/43a8cb7.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>操作系統 - 操作系統的調試</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E5%AD%B8.html>科學</a></span></div><div class=post-content><p>我們總是時不時的提起調試。現在我們就好好看看這玩意兒。寬泛點說，<strong>調試</strong>就是在系統中發現和修復問題的行為，包括硬件和軟件。性能問題也認為是bug，所以調試也包括<strong>性能調優</strong>，也就是尋求通過去除處理過程中的瓶頸來改善性能。接下來，我們會提到調試的過程、內核錯誤以及性能問題。暫時不涉及硬件調試。</p><h1 class=pgc-h-arrow-right>錯誤分析</h1><p>如果一個進程發生了錯誤，大多數的操作系統會把錯誤信息寫進日誌文件從來警告管理員或用戶有問題發生了。操作系統也會用<strong>core dump(核心轉儲)</strong>，是進程地址空間的內容以及有關進程狀態的其他信息寫出的一個磁盤文件，用來之後分析。運行的程序和core dump可以通過調試器探測到，這可以讓程序員檢查代碼並且查看失敗時進程地址空間到底發生了什麼。</p><p>調試用戶級別的進程代碼是一個挑戰。因為內核的大小和複雜度，操作系統的內核調試更是複雜，它既控制著硬件，有缺少用戶級別的調試工具。當crash發生時，錯誤信息會被保存到日誌文件中，內存狀態信息會被保存到<strong>crash dump</strong>。</p><p>操作系統的調試和進程調試，因為這兩個任務天生的不同而通常使用不同的工具和技術。考慮到文件系統代碼中的內核故障會導致內核在重啟之前嘗試將其狀態保存到下文件系統上的文件中的風險，一種常見的技術是將內核的內存狀態保存到為此保留的一部分磁盤中，該部分不包含文件系統。如果內存檢測到不可回覆的錯誤，則會將內存的全部內容，或至少是系統內存中內核擁有的部分，寫入該磁盤區域。當系統重啟時，將運行一個進程從該區域收集數據並將其寫入文件系統中的crash dump文件中以進行分析。顯然，這樣的策略對於調試普通的用戶進程是沒有必要的。</p><h1 class=pgc-h-arrow-right>性能監測和調優</h1><p>我們之前性能調優就是提過通過去除處理過程中瓶頸來尋求改善性能。為了識別瓶頸，我們必須能夠監測系統性能呢個。因此，操作系統必須有一些方式用來計算和展示系統的行為。根據是按每個進程或整個系統的觀測角度的不同，每個工具都有自己的特徵。為了達成這些觀測，工具會使用這兩個方法中的一個 --- counters計數或追蹤tracing。下面，我們會探究一下這倆玩意兒。</p><hr><h1 class=pgc-h-arrow-right>計數器</h1><p>操作系統通過一系列的計數器保持對系統行為的追蹤，比如系統調用的次數或是對網絡設備或磁盤的操作次數。下面是Liunx用作計數器的工具：</p><ul><li>進城級</li><ul><li>ps - 報告對單個或選中進程的信息</li><li>top - 報告當前進程們的實時統計信息</li></ul><li>系統級</li><ul><li>vmstat - 報告內存使用的統計</li><li>netstat - 報告網絡接口門的統計信息</li><li>iostat - 包括對磁盤的I/O使用情況</li></ul></ul><p><br></p><p>在Linux中大多數基於計數的工具都是從/proc文件系統裡讀取統計信息的。/proc是一個假的文件系統，它只存在於內核的內存中，並且主要被用來查尋各個進程和內核的統計信息。/ proc文件系統組織為目錄層次結構，每個進程（分配給每個進程的唯一整數值）顯示為/ proc下的子目錄。例如，目錄條目/ proc / 2155將包含ID為2155的進程的每個進程統計信息。/proc這也有各種條目，用於各種內核統計信息，如下圖：</p><div class=pgc-img><img alt="操作系統 - 操作系統的調試" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b0c1b20accf448409c81b82f7bcc4bdc><p class=pgc-img-caption></p></div><p>Unbuntu中也提供了一個系統監測應用，一個包含進程進程，系統資源，和文件系統信息的工具。截圖如下：</p><div class=pgc-img><img alt="操作系統 - 操作系統的調試" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c618e19c25f6473d8ef3a8402516a7f0><p class=pgc-img-caption>Ubuntu中的系統監測工具</p></div><h1 class=pgc-h-arrow-right>追蹤</h1><p>儘管基於計數的工具只是簡單的查詢內核維護的某些統計信息中的當前值，但追蹤工具則收集一些特殊時間的數據，諸如系統調用中包含的每一步。</p><p>下面是Linux中追蹤事件工具的示例：</p><ul><li>進程級</li><ul><li>strace - 追蹤單個進程的系統調用</li><li>gdb - 一個源代碼級的調試器</li></ul><li>系統級</li><ul><li>perf - Linux性能收集工具</li><li>tcpdump - 採集網絡包</li></ul></ul><blockquote class=pgc-blockquote-abstract><p>柯林漢定律 (Kernighan's Law)</p><p>調試在一開始就比編寫程序困難一倍。因此，按照定義，如果你的代碼寫得非常巧妙，那麼你就沒有足夠的能力來調試它。</p></blockquote><p>使操作系統在運行時更易於理解，調試和調優是研究和實踐的活躍領域。新一代支持內核的性能分析工具在實現此目標的方式上有了重大改進。接下來，我們討論BCC，一個動態Linux內核追蹤工具包。</p><hr><h1 class=pgc-h-arrow-right>BCC</h1><p>如果沒有能夠理解兩組代碼並能夠檢測它們之間的交互作用的工具集，幾乎不可能調試用戶級代碼與內核代碼之間的交互。為了使該工具集真正有用，它必須能夠調試系統的任何區域，包括未考慮調試的部分，並且在不影響系統可靠性的情況下進行調試。該工具集還必須對性能產生最小的影響-理想情況下，它在不使用時不受影響，而在使用中的影響是不成比例。 BCC工具箱滿足了這些要求，並提供了動態，安全，低影響的調試環境。</p><p><strong>BBC</strong>（<strong>BPF</strong> Compiler Collection）是個豐富的工具包，用於提供對Linux系統的追蹤。BCC是e BPF（extended <strong>Berkeley Packet Filter</strong>，擴展的Berkeley數據包過濾器）工具的前端接口。 BPF技術是在1990年代初開發的，用於過濾計算機網絡中的流量。 “extened擴展的” BPF（e BPF）為BPF添加了各種功能。 BPF程序是用C的子集編寫的，並被編譯成e BPF指令，這些指令可以動態地插入正在運行的Linux系統中。 e BPF指令可用於捕獲特定事件（例如正在調用的某個系統調用）或監視系統性能（例如執行磁盤I / O所需的時間）。為了確保BPF指令的行為良好，在插入運行Linux內核之前，它們會通過<strong>verifier驗證者</strong>傳入。驗證者會進行檢查以確保說明不會影響系統性能或安全性。</p><p>儘管e BPF為Linux內核中的跟蹤提供了豐富的功能集，但是從傳統上來說，使用其C接口開發程序非常困難。開發BCC的目的是通過在Python中提供一個前端接口來簡化使用e BPF編寫工具的過程。 BCC工具是用Python編寫的，它嵌入了與e BPF工具接口的C代碼，後者又與內核接口。 BCC工具還將C程序編譯為e BPF指令，並使用<strong>探測</strong>或將其<strong>跟蹤點</strong>插入內核中，這是兩種允許在Linux內核中跟蹤事件的技術。</p><p>編寫自定義BCC工具的細節不在討論範圍之內，但是BCC軟件包提供了許多現有工具，用於監視正在運行的Linux內核中多個活動區域。</p><p>ubuntu下的安裝命令如下：</p><pre><code>sudo apt-get install bpfcc-tools linux-headers-$(uname -r)</code></pre><p>其他系統可參考https://github.com/iovisor/bcc/blob/master/INSTALL.md</p><p>使BCC特別強大的是，它的工具可以在運行關鍵應用程序的實時生產系統上使用，而不會對系統造成損害。這對於必須監視系統性能以識別可能的瓶頸或安全漏洞的系統管理員特別有用。下圖說明了BCC和e BPF當前提供的各種工具，以及它們跟蹤Linux操作系統的幾乎任何區域的能力。 BCC是一種快速變化的技術，不斷地被添加新功能。</p><div class=pgc-img><img alt="操作系統 - 操作系統的調試" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/6fa74d1005cc425fbd84bdd5e73ee4d2><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>系統</a></li><li><a>調試</a></li><li><a>操作</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/031eafc4.html alt=電廠直流系統調試方案 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/5e8200036f19e04c25bf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/031eafc4.html title=電廠直流系統調試方案>電廠直流系統調試方案</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ea182b49.html alt=液壓系統調試之前，為什麼要讓液壓泵站先空載循環一段時間？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/7e5d0001487382aeec79 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ea182b49.html title=液壓系統調試之前，為什麼要讓液壓泵站先空載循環一段時間？>液壓系統調試之前，為什麼要讓液壓泵站先空載循環一段時間？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4b6cf795.html alt=海水淡化系統調試方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/dd81844b90a3421588751e361e7de81a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4b6cf795.html title=海水淡化系統調試方法>海水淡化系統調試方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ce9c74e3.html alt=信息系統安全：操作系統安全 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ce9c74e3.html title=信息系統安全：操作系統安全>信息系統安全：操作系統安全</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a87ea009.html alt="操作系統 - 中斷" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e5a3cb6cc12e4b3880e8b1ce8e6f32ca style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a87ea009.html title="操作系統 - 中斷">操作系統 - 中斷</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7022912.html alt=什麼是操作系統，操作系統都有哪些？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/9113e93c7ffc45908f24f3815f20997c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7022912.html title=什麼是操作系統，操作系統都有哪些？>什麼是操作系統，操作系統都有哪些？</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/424587c.html alt=公共廣播系統的調試方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/14d6b3bd72034ca4916248957953d6c5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/424587c.html title=公共廣播系統的調試方法>公共廣播系統的調試方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/27a9aa1.html alt=液壓系統調試及應用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d01d59beeaf7470286ab77ee9d1d4fcc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/27a9aa1.html title=液壓系統調試及應用>液壓系統調試及應用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/adc1d50.html alt=操作系統基礎 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/876d7a61014e42409417891da4c2e0a5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/adc1d50.html title=操作系統基礎>操作系統基礎</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0923cc0.html alt=「操作系統」科普一下目前主流的電腦操作系統 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/bd1ebe0977d949de9324ab91ecddce41 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0923cc0.html title=「操作系統」科普一下目前主流的電腦操作系統>「操作系統」科普一下目前主流的電腦操作系統</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7541404.html alt=生化系統的調試運行—異常狀況及解決措施 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=http://p1.pstatp.com/large/pgc-image/e90302b2b8ee436890456d8c1b86661f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7541404.html title=生化系統的調試運行—異常狀況及解決措施>生化系統的調試運行—異常狀況及解決措施</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fc3b4b2c.html alt=一文讀懂智能客服：發展歷程、系統搭建、市場推廣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RbYMTZ55OrJUgU style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fc3b4b2c.html title=一文讀懂智能客服：發展歷程、系統搭建、市場推廣>一文讀懂智能客服：發展歷程、系統搭建、市場推廣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/51410370.html alt=生活垃圾焚燒發電及蒸汽系統優化改造項目公告 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RcblrbTDBokV23 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/51410370.html title=生活垃圾焚燒發電及蒸汽系統優化改造項目公告>生活垃圾焚燒發電及蒸汽系統優化改造項目公告</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b4913b56.html alt=電驅動橋系統或加快電氣化進程，多個案例共同說明問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1539571595921bc5b27eff6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b4913b56.html title=電驅動橋系統或加快電氣化進程，多個案例共同說明問題>電驅動橋系統或加快電氣化進程，多個案例共同說明問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9a7b7719.html alt=基於混沌系統的偽隨機數發生器設計 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9a7b7719.html title=基於混沌系統的偽隨機數發生器設計>基於混沌系統的偽隨機數發生器設計</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>