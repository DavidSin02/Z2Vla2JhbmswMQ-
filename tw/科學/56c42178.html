<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>嵌入式C語言編程——5年程序員給你講文件操作fopen fputs fwrite | 极客快訊</title><meta property="og:title" content="嵌入式C語言編程——5年程序員給你講文件操作fopen fputs fwrite - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/502ca92374204ac896961ef228e42b1e"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/56c42178.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/56c42178.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/56c42178.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/56c42178.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/56c42178.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/56c42178.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/56c42178.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/56c42178.html><meta property="article:published_time" content="2020-10-29T21:13:10+08:00"><meta property="article:modified_time" content="2020-10-29T21:13:10+08:00"><meta name=Keywords content><meta name=description content="嵌入式C語言編程——5年程序員給你講文件操作fopen fputs fwrite"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E5%AD%B8/56c42178.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>嵌入式C語言編程——5年程序員給你講文件操作fopen fputs fwrite</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E5%AD%B8.html>科學</a></span></div><div class=post-content><p>本文主要是對C基礎編程關於文件的初步講解，後續會深入講解C高級相關的概念（C大神可先略過）。 本人近期會陸續上傳IT編程相關的資料和視頻教程，可以關注一下互相交流：C C++ Java python linux ARM 嵌入式 物聯網等。想學編程的朋友進入主頁即可看到相關教程和資料。</p><p><strong>本文的主要內容：</strong></p><p><strong>1文件概述</strong></p><p><strong>2文件指針</strong></p><p><strong>3文件的打開與關閉</strong></p><p><strong>3.1文件的打開(fopen 函數)</strong></p><p><strong>3.2文件關閉函數（fclose 函數）</strong></p><p><strong>4文件的讀寫</strong></p><p><strong>4.1字符讀寫函數 fgetc 和 fputc</strong></p><p><strong>4.2字符串讀寫函數 fgets 和 fputs</strong></p><p><strong>4.3數據塊讀寫函數 fread 和 fwtrite</strong></p><p><strong>4.4格式化讀寫函數 fscanf 和 fprintf</strong></p><p><strong>5文件的隨機讀寫</strong></p><p><strong>5.1文件定位</strong></p><p><strong>5.2文件的隨機讀寫</strong></p><p><strong>6本章小結</strong></p><h1 class=pgc-h-arrow-right>12.1 C 文件概述</h1><p><br></p><p>所謂"文件"是指一組相關數據的有序集合。這個數據集有一個名稱，叫做文件名。實 際上在前面的各章中我們已經多次使用了文件，例如源程序文件、目標文件、可執行文件、 庫文件 (頭文件)等。</p><p>文件通常是駐留在外部介質(如磁盤等)上的，在使用時才調入內存中來。從不同的角度 可對文件作不同的分類。從用戶的角度看，文件可分為普通文件和設備文件兩種。</p><p>普通文件是指駐留在磁盤或其它外部介質上的一個有序數據集，可以是源文件、目標文 件、可執行程序；也可以是一組待輸入處理的原始數據，或者是一組輸出的結果。對於原文 件、目標文件、可執行程序可以稱作程序文件，對輸入輸出數據可稱作數據文件。</p><p>設備文件是指與主機相聯的各種外部設備，如顯示器、打印機、鍵盤等。在操作系統中，把 外部設備也看作是一個文件來進行管理，把它們的輸入、輸出等同於對磁盤文件的讀和寫。 通常把顯示器定義為標準輸出文件，一般情況下在屏幕上顯示有關信息就是向標準輸出文件輸出。如前面經常使用的 printf,putchar 函數就是這類輸出。</p><p>鍵盤通常被指定標準的輸入文件，從鍵盤上輸入就意味著從標準輸入文件上輸入數據。</p><p>scanf,getchar 函數就屬於這類輸入。</p><p>從文件編碼的方式來看，文件可分為 ASCII 碼文件和二進制碼文件兩種。ASCII 文件也稱為文本文件，這種文件在磁盤中存放時每個字符對應一個字節，用於存放對應的 ASCII 碼。例如，數 5678 的存儲形式為：</p><div class=pgc-img><img alt="嵌入式C語言編程——5年程序員給你講文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/502ca92374204ac896961ef228e42b1e><p class=pgc-img-caption></p></div><p>ASCII 碼文件可在屏幕上按字符顯示，例如源程序文件就是 ASCII 文件，用 DOS 命令 TYPE 可顯示文件的內容。由於是按字符顯示，因此能讀懂文件內容。</p><p>二進制文件是按二進制的編碼方式來存放文件的。 例如， 數 5678 的存儲形式為：</p><p>00010110 00101110</p><p>只佔二個字節。二進制文件雖然也可在屏幕上顯示，但其內容無法讀懂。C 系統在處理這些文件時，並不區分類型，都看成是字符流，按字節進行處理。</p><p>輸入輸出字符流的開始和結束只由程序控制而不受物理符號(如回車符)的控制。因此也把這 種文件稱作"流式文件"。</p><p>本章討論流式文件的打開、關閉、讀、寫、 定位等各種操作。</p><h1 class=pgc-h-arrow-right>12.2 文件指針</h1><p><br></p><p>在Ｃ語言中用一個指針變量指向一個文件，這個指針稱為文件指針。通過文件指針就可對它 所指的文件進行各種操作。</p><p>定義說明文件指針的一般形式為：</p><p>FILE* 指針變量標識符；</p><p>其中 FILE 應為大寫，它實際上是由系統定義的一個結構，該結構中含有文件名、文件狀態和文件當前位置等信息。在編寫源程序時不必關心 FILE 結構的細節。</p><p>例如：</p><p>FILE* fp；</p><p>表示 fp 是指向 FILE 結構的指針變量，通過 fp 即可找存放某個文件信息的結構變量，然後按結構變量提供的信息找到該文件，實施對文件的操作。習慣上也籠統地把 fp 稱為指向一個文件的指針。</p><h1 class=pgc-h-arrow-right>12.3 文件的打開與關閉</h1><p><br></p><p>文件在進行讀寫操作之前要先打開，使用完畢要關閉。所謂打開文件，實際上是建立文 件的各種有關信息，並使文件指針指向該文件，以便進行其它操作。關閉文件則斷開指針與 文件之間的聯繫，也就禁止再對該文件進行操作。</p><p>在Ｃ語言中，文件操作都是由庫函數來完成的。在本章內將介紹主要的文件操作函數。</p><h1 class=pgc-h-arrow-right>12.3.1 文件的打開(fopen 函數)</h1><p><br></p><p>fopen 函數用來打開一個文件，其調用的一般形式為： 文件指針名 = fopen(文件名,使用文件方式);</p><p>其中，</p><p>"文件指針名"必須是被說明為 FILE 類型的指針變量；</p><p>"文件名"是被打開文件的文件名；</p><p>"使用文件方式"是指文件的類型和操作要求。</p><p>"文件名"是字符串常量或字符串數組。例如：</p><p>FILE *fp；</p><p>fp = ( "filename", "r" );</p><p>其意義是在當前目錄下打開文件 file a，只允許進行"讀"操作，並使 fp 指向該文件。又如：</p><p>FILE* fphzk</p><p>Fphzk = ( "./hzk16", "rb" )</p><p>其意義是打開當前目錄下的文件 hzk16，這是一個二進制文件，只允許按二進制方式進行讀操作。</p><p>使用文件的方式共有 12 種，下面給出了它們的符號和意義。</p><div class=pgc-img><img alt="嵌入式C語言編程——5年程序員給你講文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/291e2356309642a589c5474cf8b293a0><p class=pgc-img-caption></p></div><p>對於文件使用方式有以下幾點說明：</p><p>文件使用方式由 r,w,a,t,b，+六個字符拼成，各字符的含義是：</p><p>r(read): 讀</p><p>w(write): 寫</p><p>a(append): 追加</p><p>t(text): 文本文件，可省略不寫</p><p>b(banary): 二進制文件</p><p>+: 讀和寫</p><p>凡用"r"打開一個文件時，該文件必須已經存在，且只能從該文件讀出。</p><p>用"w"打開的文件只能向該文件寫入。若打開的文件不存在，則以指定的文件名建立該文件， 若打開的文件已經存在，則將該文件刪去，重建一個新文件。</p><p>若要向一個已存在的文件追加新的信息，只能用"a"方式打開文件。但此時該文件必須是存 在的，否則將會出錯。</p><p>在打開一個文件時，如果出錯，fopen 將返回一個空指針值 NULL。在程序中可以用這一信息來判別是否完成打開文件的工作，並作相應的處理。因此常用以下程序段打開文件：</p><p>if (( fp = fopen("./hzk16", "rb") == NULL)</p><p>{</p><p>printf("\nerror on open ./hzk16 file!"); getchar();</p><p>exit(1);</p><p>}</p><p>這段程序的意義是，如果返回的指針為空，表示不能打開 C 盤根目錄下的 hzk16 文件，則給出提示信息"error on open ./hzk16 file!"，下一行的作用是等待，只有當用戶從鍵盤敲任一鍵時，程序才繼續執行，因此用戶可利用這個等待時間閱讀出錯提示。敲鍵後執行 exit(1) 退出程序。</p><p>把一個文本文件讀入內存時，要將 ASCII 碼轉換成二進制碼，而把文件以文本方式寫入磁盤時，也要把二進制碼轉換成 ASCII 碼，因此文本文件的讀寫要花費較多的轉換時間。對二進制文件的讀寫不存在這種轉換。</p><p>標準輸入文件(鍵盤)，標準輸出文件(顯示器)，標準出錯輸出(出錯信息)是由系統打開的， 可直接使用。</p><h1 class=pgc-h-arrow-right>12.3.2 文件關閉函數（fclose 函數）</h1><p><br></p><p>文件一旦使用完畢，應用關閉文件函數把文件關閉，以避免文件的數據丟失等錯誤。</p><p>fclose 函數調用的一般形式是：</p><p>fclose(文件指針)；</p><p>例如：</p><p>fclose(fp);</p><p>正常完成關閉文件操作時，fclose 函數返回值為 0。如返回非零值則表示有錯誤發生。</p><h1 class=pgc-h-arrow-right>12.4 文件的讀寫</h1><p><br></p><p>對文件的讀和寫是最常用的文件操作。在Ｃ語言中提供了多種文件讀寫的函數： 字符讀寫函數 ：fgetc 和 fputc</p><p>格式化讀寫函數：fscanf 和 fprinf 字符串讀寫函數：fgets 和 fputs 數據塊讀寫函數：freed 和 fwrite</p><p>·下面分別予以介紹。使用以上函數都要求包含頭文件 stdio.h。</p><h1 class=pgc-h-arrow-right>12.4.1 字符讀寫函數 fgetc 和 fputc</h1><p><br></p><p>字符讀寫函數是以字符(字節)為單位的讀寫函數。 每次可從文件讀出或向文件寫入一個字符。</p><p>讀字符函數 fgetc</p><p>fgetc 函數的功能是從指定的文件中讀一個字符，函數調用的形式為： 字符變量 = fgetc(文件指針)；</p><p>例如：</p><p>char ch;</p><p>ch = fgetc(fp);</p><p>其意義是從打開的文件 fp 中讀取一個字符並送入 ch 中。對於 fgetc 函數的使用有以下幾點說明：</p><p>在 fgetc 函數調用中，讀取的文件必須是以讀或讀寫方式打開的。讀取字符的結果也可以不向字符變量賦值，</p><p>例 如 ： fgetc(fp);</p><p>但是讀出的字符不能保存。</p><p>在文件內部有一個位置指針。用來指向文件的當前讀寫字節。在文件打開時，該指針總是指 向文件的第一個字節。使用 fgetc 函數後，該位置指針將向後移動一個字節。 因此可連續多次使用 fgetc 函數，讀取多個字符。應注意文件指針和文件內部的位置指針不是一回事。文件指針是指向整個文件的，須在程序中定義說明，只要不重新賦值，文件指針的值是不變 的。文件內部的位置指針用以指示文件內部的當前讀寫位置，每讀寫一次，該指針均向後移 動，它不需在程序中定義說明，而是由系統自動設置的。</p><p>【例 12.1】讀入文件 c1.txt，在屏幕上輸出。</p><div class=pgc-img><img alt="嵌入式C語言編程——5年程序員給你講文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/404be6bcdea046cb9009446dc6affc90><p class=pgc-img-caption></p></div><p>本例程序的功能是從文件中逐個讀取字符，在屏幕上顯示。程序定義了文件指針 fp,以讀文本文件方式打開文件"cl.txt"，並使 fp 指向該文件。如打開文件出錯，給出提示並退出程序。程序第 14 行先讀出一個字符，然後進入循環，只要讀出的字符不是文件結束標誌(每個文件末有一結束標誌 EOF)就把該字符顯示在屏幕上，再讀入下一字符。每讀一次，文件內部的位置指針向後移動一個字符，文件結束時，該指針指向 EOF。執行本程序將顯示整個文件。</p><p>寫字符函數 fputc</p><p>fputc 函數的功能是把一個字符寫入指定的文件中，函數調用的形式為：</p><p>fputc(字符量，文件指針)；</p><p>其中，待寫入的字符量可以是字符常量或變量，例如： fputc('a', fp);</p><p>其意義是把字符 a 寫入 fp 所指向的文件中。對於 fputc 函數的使用也要說明幾點：</p><p>被寫入的文件可以用寫、讀寫、追加方式打開，用寫或讀寫方式打開一個已存在的文件時將 清除原有的文件內容，寫入字符從文件首開始。如需保留原有文件內容，希望寫入的字符以 文件末開始存放，必須以追加方式打開文件。被寫入的文件若不存在，則創建該文件。</p><p>每寫入一個字符，文件內部位置指針向後移動一個字節。</p><p>fputc 函數有一個返回值，如寫入成功則返回寫入的字符，否則返回一個 EOF。可用此來判斷寫入是否成功。</p><p>【例 12.2】從鍵盤輸入一行字符，寫入一個文件，再把該文件內容讀出顯示在屏幕上。</p><div class=pgc-img><img alt="嵌入式C語言編程——5年程序員給你講文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/783364881d3340c78a93476599e6b0f4><p class=pgc-img-caption></p></div><p>程序中以讀寫文本文件方式打開文件 string。從鍵盤讀入一個字符後進入循環，當讀入字符不為回車符時，則把該字符寫入文件之中，然後繼續從鍵盤讀入下一字符。每輸入一個字符， 文件內部位置指針向後移動一個字節。寫入完畢，該指針已指向文件末。如要把文件從頭讀出，須把指針移向文件頭，rewind 函數用於把 fp 所指文件的內部位置指針移到文件頭。</p><p>【例 12.3】把命令行參數中的前一個文件名標識的文件，複製到後一個文件名標識的文件中， 如命令行中只有一個文件名則把該文件寫到標準輸出文件(顯示器)中。</p><div class=pgc-img><img alt="嵌入式C語言編程——5年程序員給你講文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/702f8214c4c248e597d86361b1e278ba><p class=pgc-img-caption></p></div><p>本程序為帶參的 main 函數。程序中定義了兩個文件指針 fp1 和 fp2，分別指向命令行參數中給出的文件。如命令行參數中沒有給出文件名，則給出提示信息。程序第 18 行表示如果只給出一個文件名，則使 fp2 指向標準輸出文件(即顯示器)。程序第 25 行至 28 行用循環語句逐個讀出文件 1 中的字符再送到文件 2 中。再次運行時，給出了一個文件名，故輸出給標準輸出文件 stdout，即在顯示器上顯示文件內容。第三次運行，給出了二個文件名，因此把 string 中的內容讀出，寫入到 OK 之中。可用 DOS 命令 type 顯示 OK 的內容。</p><h1 class=pgc-h-arrow-right>12.4.2 字符串讀寫函數 fgets 和 fputs</h1><p><br></p><p>讀字符串函數 fgets</p><p>函數的功能是從指定的文件中讀一個字符串到字符數組中，函數調用的形式為：</p><p>fgets(字符數組名, n, 文件指針);</p><p>其中的 n 是一個正整數。表示從文件中讀出的字符串不超過 n-1 個字符。在讀入的最後一個字符後加上串結束標誌'\0'。</p><p>例如：</p><p>fgets(str, n, fp);</p><p>的意義是從 fp 所指的文件中讀出 n-1 個字符送入字符數組 str 中。</p><p>【例 12.4】從 string 文件中讀入一個含 10 個字符的字符串。</p><div class=pgc-img><img alt="嵌入式C語言編程——5年程序員給你講文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2aac3908f8bf43d497f8280ab56aa82d><p class=pgc-img-caption></p></div><p>本例定義了一個字符數組 str 共 11 個字節，在以讀文本文件方式打開文件 string 後，從中讀出 10 個字符送入 str 數組，在數組最後一個單元內將加上'\0'，然後在屏幕上顯示輸出</p><p>str 數組。輸出的十個字符正是例 13.1 程序的前十個字符。對 fgets 函數有兩點說明：</p><p>在讀出 n-1 個字符之前，如遇到了換行符或 EOF，則讀出結束。</p><p>fgets 函數也有返回值，其返回值是字符數組的首地址。寫字符串函數 fputs</p><p>fputs 函數的功能是向指定的文件寫入一個字符串，其調用形式為：</p><p>fputs( 字符串, 文件指針 );</p><p>其中字符串可以是字符串常量，也可以是字符數組名，或指針變量，例如： fputs("abcd", fp);</p><p>其意義是把字符串"abcd"寫入 fp 所指的文件之中。</p><p>【例 12.5】在例 13.2 中建立的文件 string 中追加一個字符串。</p><div class=pgc-img><img alt="嵌入式C語言編程——5年程序員給你講文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/8e84582fb7ce432c91bdf79211f1f80b><p class=pgc-img-caption></p></div><p>本例要求在 string 文件末加寫字符串，因此，在程序第 6 行以追加讀寫文本文件的方式打開文件 string。然後輸入字符串，並用 fputs 函數把該串寫入文件 string。在程序 15 行用 rewind 函數把文件內部位置指針移到文件首。再進入循環逐個顯示當前文件中的全部內容。</p><h1 class=pgc-h-arrow-right>12.4.3 數據塊讀寫函數 fread 和 fwtrite</h1><p><br></p><p>Ｃ語言還提供了用於整塊數據的讀寫函數。可用來讀寫一組數據，如一個數組元素，一 個結構變量的值等。</p><p>讀數據塊函數調用的一般形式為： fread( buffer, size, count, fp ); 寫數據塊函數調用的一般形式為： fwrite( buffer, size, count, fp ); 其中:</p><p>buffer 是一個指針，在 fread 函數中，它表示存放輸入數據的首地址。在 fwrite 函數中，它表示存放輸出數據的首地址。</p><p>size 表示數據塊的字節數。</p><p>count 表示要讀寫的數據塊塊數。</p><p>fp 表示文件指針。</p><p>例如：</p><p>fread( fa, 4, 5, fp );</p><p>其意義是從 fp 所指的文件中，每次讀 4 個字節(一個實數)送入實數組 fa 中，連續讀 5 次， 即讀 5 個實數到 fa 中。</p><p>【例 12.6】從鍵盤輸入兩個學生數據，寫入一個文件中，再讀出這兩個學生的數據顯示在屏幕上。</p><div class=pgc-img><img alt="嵌入式C語言編程——5年程序員給你講文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/b08aa1a7e6f74439900edfa33b0fabe8><p class=pgc-img-caption></p></div><p>本例程序定義了一個結構 stu,說明了兩個結構數組 boya 和 boyb 以及兩個結構指針變量 pp 和 qq。pp 指向 boya,qq 指向 boyb。程序第 16 行以讀寫方式打開二進制文件"stu_list"， 輸入二個學生數據之後，寫入該文件中，然後把文件內部位置指針移到文件首，讀出兩塊學生數據後，在屏幕上顯示。</p><h1 class=pgc-h-arrow-right>12.4.4 格式化讀寫函數 fscanf 和 fprintf</h1><p><br></p><p>fscanf 函數，fprintf 函數與前面使用的 scanf 和 printf 函數的功能相似，都是格式化讀寫函數。兩者的區別在於 fscanf 函數和 fprintf 函數的讀寫對象不是鍵盤和顯示器，而是磁盤文件。</p><p>這兩個函數的調用格式為：</p><p>fscanf(文件指針, 格式字符串, 輸入表列);</p><p>fprintf(文件指針, 格式字符串, 輸出表列);</p><p>例如：</p><p>fscanf( fp, "%d%s", &i, s );</p><p>fprintf( fp, "%d%c", j, ch );</p><p>用 fscanf 和 fprintf 函數也可以完成例 11.6 的問題。修改後的程序如例 11.7 所示。</p><p>【例 12.7】用 fscanf 和 fprintf 函數成例 11.6 的問題。</p><div class=pgc-img><img alt="嵌入式C語言編程——5年程序員給你講文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7969c7a3a3464386b1cff440a2b8793c><p class=pgc-img-caption></p></div><p>與例 11.6 相比，本程序中 fscanf 和 fprintf 函數每次只能讀寫一個結構數組元素，因此採</p><p>用了循環語句來讀寫全部數組元素。還要注意指針變量 pp,qq 由於循環改變了它們的值，因此在程序的 25 和 32 行分別對它們重新賦予了數組的首地址。</p><h1 class=pgc-h-arrow-right>12.5 文件的隨機讀寫</h1><p><br></p><p>前面介紹的對文件的讀寫方式都是順序讀寫，即讀寫文件只能從頭開始，順序讀寫各個數據。 但在實際問題中常要求只讀寫文件中某一指定的部分。為了解決這個問題可移動文件內部的位置指針到需要讀寫的位置，再進行讀寫，這種讀寫稱為隨機讀寫。</p><p>實現隨機讀寫的關鍵是要按要求移動位置指針，這稱為文件的定位。</p><h1 class=pgc-h-arrow-right>12.5.1 文件定位</h1><p><br></p><p>移動文件內部位置指針的函數主要有兩個，即 rewind 函數和 fseek 函數。</p><p>rewind 函數前面已多次使用過，其調用形式為：</p><p>rewind(文件指針);</p><p>它的功能是把文件內部的位置指針移到文件首。 下面主要介紹 fseek 函數。</p><p>fseek 函數用來移動文件內部位置指針，其調用形式為：</p><p>fseek(文件指針, 位移量, 起始點); 其中：</p><p>"文件指針"指向被移動的文件。</p><p>"位移量"表示移動的字節數，要求位移量是 long 型數據，以便在文件長度大於 64KB 時不會出錯。當用常量表示位移量時，要求加後綴"L"。</p><p>"起始點"表示從何處開始計算位移量，規定的起始點有三種：文件首，當前位置和文件尾。 其表示方法如下表。</p><div class=pgc-img><img alt="嵌入式C語言編程——5年程序員給你講文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fe07839cc1624e6cacee3cd212bb1842><p class=pgc-img-caption></p></div><p>例如：</p><p>fseek( fp, 100L, 0 );</p><p>其意義是把位置指針移到離文件首 100 個字節處。</p><p>還要說明的是 fseek 函數一般用於二進制文件。在文本文件中由於要進行轉換，故往往計算的位置會出現錯誤。</p><h1 class=pgc-h-arrow-right>12.5.2 文件的隨機讀寫</h1><p><br></p><p>在移動位置指針之後，即可用前面介紹的任一種讀寫函數進行讀寫。由於一般是讀寫一個數 據據塊，因此常用 fread 和 fwrite 函數。</p><p>下面用例題來說明文件的隨機讀寫。</p><p>【例 12.8】在學生文件 stu_list 中讀出第二個學生的數據。</p><div class=pgc-img><img alt="嵌入式C語言編程——5年程序員給你講文件操作fopen fputs fwrite" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/693288afc4ce4fe29fed106740ca842f><p class=pgc-img-caption></p></div><p>本程序用隨機讀出的方法讀出第二個學生的數據。程序中定義 boy 為 stu 類型變量，qq 為指向 boy 的指針。以讀二進制文件方式打開文件，程序第 22 行移動文件位置指針。其中的</p><p>i 值為 1，表示從文件頭開始，移動一個 stu 類型的長度，然後再讀出的數據即為第二個學生的數據。</p><h1 class=pgc-h-arrow-right>12.6 本章小結</h1><p>1."文件"是指一組相關數據的有序集合。</p><p>2. Ｃ語言中用一個指針變量指向一個文件，稱為文件指針。通過文件指針就可對它所指 的文件進行各種操作。</p><p>3. 文件在進行讀寫操作之前要先打開，使用完畢要關閉。</p><p>4. Ｃ語言中提供了多種文件讀寫的函數，參考 10.4 節。</p><p>5. 移動文件內部的位置指針到需要讀寫的位置，再進行讀寫，這種讀寫稱為隨機讀寫。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>語言</a></li><li><a>編程</a></li><li><a>員給</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/9f9a0ab8.html alt=P4語言編程詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/b0509dc83f844c6e9e133d81e9855e4b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9f9a0ab8.html title=P4語言編程詳解>P4語言編程詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8ba54309.html alt=C語言編程第19講——斷言的使用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/92ee4886-fdd7-4a4a-b45a-d647ef966836 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8ba54309.html title=C語言編程第19講——斷言的使用>C語言編程第19講——斷言的使用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dd5b00b1.html alt=嵌入式C語言基礎編程—5年程序員給你講函數，你真的懂函數嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/40851dc497a8409bbff6a6aae1e42e8b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dd5b00b1.html title=嵌入式C語言基礎編程—5年程序員給你講函數，你真的懂函數嗎？>嵌入式C語言基礎編程—5年程序員給你講函數，你真的懂函數嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e2c14705.html alt=C語言編程知識總結，思維導圖版本，事半功倍！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/721353b3b68a41059d980e19083d03e7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e2c14705.html title=C語言編程知識總結，思維導圖版本，事半功倍！>C語言編程知識總結，思維導圖版本，事半功倍！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/293e60e3.html alt=Rust編程語言初探 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/b47797c4e0b5476e86050d174aea893c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/293e60e3.html title=Rust編程語言初探>Rust編程語言初探</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/34838dce.html alt=C精品編程之——指針，C語言的精髓，每個編程初學者的噩夢 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a0b5a50b90804963b14ab394517ae294 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/34838dce.html title=C精品編程之——指針，C語言的精髓，每個編程初學者的噩夢>C精品編程之——指針，C語言的精髓，每個編程初學者的噩夢</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8f9d60af.html alt=自然語言與編程語言的不同之處 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2212e09b2dac4c80a8c3e8b80da92bb1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8f9d60af.html title=自然語言與編程語言的不同之處>自然語言與編程語言的不同之處</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/82646fb0.html alt=C/C++編程筆記：C語言編程知識要點總結！大一C語言知識點（全） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d208ccdc7f074f67a257d52df74e4f48 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/82646fb0.html title=C/C++編程筆記：C語言編程知識要點總結！大一C語言知識點（全）>C/C++編程筆記：C語言編程知識要點總結！大一C語言知識點（全）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1d74ece6.html alt=C語言編程入門必做的76題（加速你的學習效率） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/76e1f716eb894036a029992b044b5036 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1d74ece6.html title=C語言編程入門必做的76題（加速你的學習效率）>C語言編程入門必做的76題（加速你的學習效率）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/de0da135.html alt=C語言編程實例3 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/870917da8c744479b2ec65ee0173974e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/de0da135.html title=C語言編程實例3>C語言編程實例3</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9e4e4f6f.html alt=C語言編程實例4 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/870917da8c744479b2ec65ee0173974e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9e4e4f6f.html title=C語言編程實例4>C語言編程實例4</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/daee4c3b.html alt=C語言編程筆記丨利用C語言寫一個小程序——胖胖的愛心桃 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/df26c625ad3d44d4b515522c28f5462c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/daee4c3b.html title=C語言編程筆記丨利用C語言寫一個小程序——胖胖的愛心桃>C語言編程筆記丨利用C語言寫一個小程序——胖胖的愛心桃</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7b754ba6.html alt="C語言編程筆記丨編寫第一個C語言程序'hello world'，我教你哇" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/ad42f4fc-8976-4d2d-81e8-c62c3808e213 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7b754ba6.html title="C語言編程筆記丨編寫第一個C語言程序'hello world'，我教你哇">C語言編程筆記丨編寫第一個C語言程序'hello world'，我教你哇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/462f5440.html alt=實用C語言編程（第三版）高清PDF class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/dfic-imagehandler/31d1bba3-4fda-47c1-8435-00e90b1c2930 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/462f5440.html title=實用C語言編程（第三版）高清PDF>實用C語言編程（第三版）高清PDF</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0aa68fb2.html alt=那些主流編程語言的知識，C語言 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ea2299c59ca0407b8cf1263f5a4c42f0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0aa68fb2.html title=那些主流編程語言的知識，C語言>那些主流編程語言的知識，C語言</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>