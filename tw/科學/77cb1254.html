<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>詳解RS232、RS485、RS485、串口&握手 | 极客快訊</title><meta property="og:title" content="詳解RS232、RS485、RS485、串口&握手 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/a3a420637e374a1190a121cc810c1282"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/77cb1254.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/77cb1254.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/77cb1254.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/77cb1254.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/77cb1254.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/77cb1254.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/77cb1254.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/77cb1254.html><meta property="article:published_time" content="2020-11-14T20:50:52+08:00"><meta property="article:modified_time" content="2020-11-14T20:50:52+08:00"><meta name=Keywords content><meta name=description content="詳解RS232、RS485、RS485、串口&握手"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E5%AD%B8/77cb1254.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>詳解RS232、RS485、RS485、串口&握手</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E5%AD%B8.html>科學</a></span></div><div class=post-content><div><p class=ql-align-justify><strong>一、RS232基礎知識</strong></p><p class=ql-align-justify>計算機與計算機或計算機與終端之間的數據傳送可以採用串行通訊和並行通訊二種方式。由於串行通訊方式具有使用線路少、成本低，特別是在遠程傳輸時，避免了多條線路特性的不一致而被廣泛採用。</p><p class=ql-align-justify>在串行通訊時，要求通訊雙方都採用一個標準接口，使不同的設備可以方便地連接起來進行通訊。RS-232-C接口（又稱EIA RS-232-C）是目前最常用的一種串行通訊接口。</p><p class=ql-align-justify>RS-232-C是美國電子工業協會EIA（Electronic Industry Association）制定的一種串行物理接口標準。RS是英文“推薦標準”的縮寫，232為標識號，C表示修改次數，代表RS232的最新一次修改（1969），在這之前，有RS232B、RS232A。它是在1970 年由美國電子工業協會（EIA）聯合貝爾系統、調制解調器廠家及計算機終端生產廠家共同制定的用於串行通訊的標準。它的全名是“數據終端設備（DTE）和數據通訊設備（DCE）之間串行二進制數據交換接口技術標準”。</p><div class=pgc-img><img alt=詳解RS232、RS485、RS485、串口&握手 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a3a420637e374a1190a121cc810c1282><p class=pgc-img-caption></p></div><p class=ql-align-justify><strong>1、電氣特性</strong></p><p class=ql-align-justify>EIA-RS-232C對電器特性、邏輯電平和各種信號線功能都作了規定。</p><p class=ql-align-justify>在TxD和RxD上：邏輯1(MARK)=-3V～-15V ，邏輯0(SPACE)=+3～＋15V 在RTS、CTS、DSR、DTR和DCD等控制線上：</p><p class=ql-align-justify>信號有效（接通，ON狀態，正電壓）＝+3V～+15V</p><p class=ql-align-justify>信號無效（斷開，OFF狀態，負電壓)=-3V～-15V</p><p class=ql-align-justify>根據設備供電電源的不同，+-5、+-10、+-12和+-15這樣的電平都是可能的。</p><p class=ql-align-justify><strong>2、連接器的機械特性</strong></p><p class=ql-align-justify>由於RS-232C並未定義連接器的物理特性，因此，出現了DB-25、DB-15和DB-9各種類型的連接器，其引腳的定義也各不相同。最近，8管腳的RJ-45型連接器變得越來越普遍，儘管它的管腳分配相差很大。EIA/TIA 561標準規定了一種管腳分配的方法，但是由Dave Yost發明的被廣泛使用在Unix計算機上的Yost串連設備配線標準 （"Yost Serial Device Wiring Standard"）以及其他很多設備都沒有采用上述任一種連線標準。下表中列出的是被較多使用的RS-232中的信號和管腳分配：</p><div class=pgc-img><img alt=詳解RS232、RS485、RS485、串口&握手 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/e117840854874209afeea308733de3f1><p class=pgc-img-caption></p></div><p class=ql-align-justify>信號的標註是從DTE設備的角度出發的，TD、DTR和RTS信號是由DTE產生的，RD、DSR、CTS、DCD和RI信號是由DCE產生的。</p><p class=ql-align-justify>PC 機的RS-232 口為9 芯針插座。一些設備與PC 機連接的RS-232 接口,因為不使用對方的傳送控制信號,只需三條接口線,即“發送數據TXD”、“接收數據RXD”和“信號地GND”。</p><div class=pgc-img><img alt=詳解RS232、RS485、RS485、串口&握手 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d2347167f26d4445b48afe01baf77067><p class=pgc-img-caption></p></div><p class=ql-align-justify>雙向接口能夠只需要3根線製作是因為RS-232的所有信號都共享一個公共接地。非平衡電路使得RS-232非常的容易受兩設備間基點電壓偏移的影響。對於信號的上升期和下降期，RS-232也只有相對較差的控制能力，很容易發生串話的問題。RS-232被推薦在短距離（15m以內）間通信。由於非對稱電路的關係，RS-232接口電纜通常不是由雙絞線製作的。</p><p class=ql-align-justify><strong>3、傳輸電纜</strong></p><p class=ql-align-justify>RS-232-C標準規定的數據傳輸速率為每秒50、75、 100、150、300、600、1200、2400、4800、9600、19200波特，驅動器允許有2500pF的電容負載，通信距離將受此電容限制。</p><p class=ql-align-justify>例如，採用150pF/m的通信電纜時，最大通信距離為15m；若每米電纜的電容量減小，通信距離可以增加。傳輸距離短的另一原因是RS-232屬單端信號傳送，存在共地噪聲和不能抑制共模干擾等問題，因此一般用於20m以內的通信。</p><p class=ql-align-justify>由RS-232C標準規定在碼元畸變小於4%的情況下，傳輸電纜長度應為50 英尺，其實這個4%的碼元畸變是很保守的，在實際應用中，約有99%的用戶是按碼元畸變10-20%的範圍工作的，所以實際使用中最大距離會遠超過50英尺，美國DEC公司曾規定允許碼元畸變為10%而得出下面實驗結果。其中1 號電纜為屏蔽電纜，型號為DECP.NO.9107723 內有三對雙絞線，每對由22# AWG 組成，其外覆以屏蔽網。2 號電纜為不帶屏蔽的電纜。型號為DECP.NO.9105856-04是22#AWG 的四芯電纜。</p><div class=pgc-img><img alt=詳解RS232、RS485、RS485、串口&握手 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b8512d5e24dd46c2ad3925e8902be8ad><p class=pgc-img-caption></p></div><p class=ql-align-justify><strong>4、鏈路層</strong></p><p class=ql-align-justify>在RS-232標準中，字符是以一系列位元來一個接一個的傳輸。最長用的編碼格式是異步起停asynchronous start-stop格式，它使用一個起始位後面緊跟7或8 個數據比特，這個可能是奇偶位，然後是兩個停止位。所以發送一個字符需要10比特，帶來的一個好的效果是使全部的傳輸速率，發送信號的速率以10分劃。</p><p class=ql-align-justify>串行通信在軟件設置裡需要做多項設置，最常見的設置包括波特率、奇偶校驗和停止位。 波特率是指從一設備發到另一設備的波特率，即每秒鐘多少比特bits per second (bit/s)。典型的波特率是300、1200、2400、9600、19200等bit/s。一般通信兩端設備都要設為相同的波特率，但有些設備也可以設置為自動檢測波特率。</p><p class=ql-align-justify>奇偶校驗Parity是用來驗證數據的正確性。奇偶校驗一般不用，如果使用，那麼既可以做奇校驗也可以做偶校驗。奇偶校驗是通過修改每一發送字節（也可以限制發送的字節）來工作的。如果不作奇偶校驗，那麼數據是不會被改變的。在偶校驗中，因為奇偶校驗位會被相應的置1或0（一般是最高位或最低位），所以數據會被改變以使得所有傳送的數位（含字符的各數位和校驗位）中“1”的個數為偶數；在奇校驗中，所有傳送的數位（含字符的各數位和校驗位）中“1”的個數為奇數。奇偶校驗可以用於接受方檢查傳輸是否發送生錯誤——如果某一字節中“1”的個數發生了錯誤，那麼這個字節在傳輸中一定有錯誤發生。如果奇偶校驗是正確的，那麼要麼沒有發生錯誤要麼發生了偶數個的錯誤。</p><p class=ql-align-justify>停止位是在每個字節傳輸之後發送的，它用來幫助接受信號方硬件重同步。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=詳解RS232、RS485、RS485、串口&握手 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8fbbc9091c0340edae5005b9aa8e4e26><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-justify>在串行通信軟件設置中D/P/S是常規的符號表示。8/N/1（非常普遍）表明8bit數據，沒有奇偶校驗，1bit停止位。數據位可以設置為7、8或者9，奇偶校驗位可以設置為無（N）、奇（O）或者偶（E），奇偶校驗位可以使用數據中的比特位，所以8/E/1就表示一共8位數據位，其中一位用來做奇偶校驗位。停止位可以是1、1.5或者2位的（1.5是用在波特率為60wpm的電傳打字機上的）。</p><p class=ql-align-justify><strong>5、傳輸控制</strong></p><p class=ql-align-justify>當需要發送握手信號或數據完整性檢測時需要制定其他設置。公用的組合有RTS/CTS，DTR/DSR或者XON/XOFF（實際中不使用連接器管腳而在數據流內插入特殊字符）。</p><p class=ql-align-justify>接受方把XON/XOFF信號發給發送方來控制發送方何時發送數據，這些信號是與發送數據的傳輸方向相反的。XON信號告訴發送方接受方準備好接受更多的數據，XOFF信號告訴發送方停止發送數據直到知道接受方再次準備好。XON/XOFF一般不贊成使用，推薦用RTS/CTS控制流來代替它們。</p><p class=ql-align-justify>XON/XOFF是一種工作在終端間的帶內方法，但是必須兩端都支持這個協議，而且在突然啟動的時候會有混淆的可能。</p><p class=ql-align-justify>XON/XOFF可以工作於3線的接口。RTS/CTS最初是設計為電傳打字機和調制解調器半雙工協作通信的，每次它只能一方調制解調器發送數據。終端必須發送請求發送信號然後等到調制解調器迴應清除發送信號。儘管RTS/CTS是通過硬件達到握手，但它有自己的優勢。</p><p class=ql-align-justify><strong>6、RS-232標準的不足</strong></p><p class=ql-align-justify>經過許多年來RS-232 器件以及通信技術的改進，RS-232 的通信距離已經大大增加。由於RS-232 接口標準出現較早，難免有不足之處，主要有以下四點：</p><p class=ql-align-justify>（1） 接口的信號電平值較高，易損壞接口電路的芯片，又因為與TTL 電平不兼容故需使用電平轉換電路方能與TTL 電路連接。</p><p class=ql-align-justify>（2） 傳輸速率較低，在異步傳輸時，波特率為20Kbps。現在由於採用新的UART 芯片16C550 等，波特率達到115.2Kbps。</p><p class=ql-align-justify>（3） 接口使用一根信號線和一根信號返回線而構成共地的傳輸形式， 這種共地傳輸容易產生共模干擾，所以抗噪聲干擾性弱。</p><p class=ql-align-justify>（4） 傳輸距離有限，最大傳輸距離標準值為50 米，實際上也只能用在15米左右。</p><p class=ql-align-justify><strong>二、RS485基礎知識</strong></p><p class=ql-align-justify>針對RS-232串口標準的侷限性，人們又提出了RS-422,RS-485接口標準。RS-485/422採用平衡發送和差分接收方式實現通信：發送端將串行口的TTL電平信號轉換成差分信號A、B兩路輸出，經過線纜傳輸之後在接收端將差分信號還原成TTL電平信號。由於傳輸線通常使用雙絞線，又是差分傳輸，所以又極強的抗共模干擾的能力，總線收發器靈敏度很高，可以檢測到低至200mV電壓。故傳輸信號在千米之外都是可以恢復。</p><p class=ql-align-justify><strong>1、RS-485 的電氣特性</strong></p><p class=ql-align-justify>驅動器能輸出±7V的共模電壓</p><p class=ql-align-justify>接收器的輸入電阻RIN≥12kΩ</p><p class=ql-align-justify>輸入端的電容≤50pF</p><p class=ql-align-justify>在節點數為32個，配置了120Ω的終端電阻的情況下，驅動器至少還能輸出電壓1.5V（終端電阻的大小與所用雙絞線的參數有關）</p><p class=ql-align-justify>發送端：邏輯"1"以兩線間的電壓差為+（2 至6） V 表示；邏輯"0"以兩線間的電壓差為-（2 至6）V 表示。</p><p class=ql-align-justify>接收器的輸入靈敏度為200mV（即（V+）-（V-）≥0.2V，表示信號"0"；（V+）-（V-）≤-0.2V，表示信號"1"）</p><p class=ql-align-justify><strong>2、傳輸速率與傳輸距離</strong></p><p class=ql-align-justify>RS-485 的數據最高傳輸速率為10Mbps，最大的通信距離約為1219M，傳輸速率與傳輸距離成反比，在10Kb/S的傳輸速率下，才可以達到最大的通信距離。</p><p class=ql-align-justify>但是由於RS-485 常常要與PC 機的RS-232口通信，所以實際上一般最高115.2Kbps。又由於太高的速率會使RS-485 傳輸距離減小，所以往往為9600bps 左右或以下。</p><p class=ql-align-justify><strong>3、網絡拓撲</strong></p><p class=ql-align-justify>RS-485 接口是採用平衡驅動器和差分接收器的組合，抗共模幹能力增強，即抗噪聲干擾性好。RS-485採用半雙工工作方式，支持多點數據通信。</p><p class=ql-align-justify>RS-485總線網絡拓撲一般採用終端匹配的總線型結構。即採用一條總線將各個節點串接起來，不支持環形或星型網絡。如果需要使用星型結構，就必須使用485中繼器或者485集線器才可以。RS-485/422總線一般最大支持32個節點，如果使用特製的485芯片，可以達到128個或者256個節點，最大的可以支持到400個節點。</p><p class=ql-align-justify>4、連接器</p><p class=ql-align-justify>RS-485 的國際標準並沒有規定RS485 的接口連接器標準、所以採用接線端子或者DB-9、DB-25 等連接器都可以。</p><div class=pgc-img><img alt=詳解RS232、RS485、RS485、串口&握手 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ecd7b491c88a4423b377eee53fdba038><p class=pgc-img-caption></p></div><p class=ql-align-justify><strong>三、RS422基礎知識</strong></p><p class=ql-align-justify>RS-422 的電氣性能與RS-485近似一樣。主要的區別在於：</p><p class=ql-align-justify>（1）RS-485 有2 根信號線：發送和接收都是A 和B。由於RS-485 的收與發是共用兩根線，所以不能夠同時收和發（半雙工）。</p><p class=ql-align-justify>（2）RS-422 有4 根信號線：兩根發送（Y、Z）、兩根接收（A、B）。由於RS-422 的收與發是分開的，所以可以同時收和發（全雙工）。</p><p class=ql-align-justify>（3）支持多機通信的RS-422將Y-A 短接作為RS-485 的A、將RS-422 的Z-B 短接作為RS-485 的B可以這樣簡單轉換為RS-485。</p><div class=pgc-img><img alt=詳解RS232、RS485、RS485、串口&握手 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7863a19a930e4b60a5c763b61a5cad0b><p class=pgc-img-caption></p></div><p class=ql-align-justify>很多人往往都誤認為RS-422串行接口是RS-485串行接口的全雙工版本，實際上，它們在電器特性上存在著不少差異，共模電壓範圍和接收器輸入電阻不同使得該兩個標準適用於不同的應用領域。RS-485串行接口的驅動器可用於RS-422串行接口的應用中，因為RS-485串行接口滿足所有的RS-422串行接口性能參數，反之則不能成立。對於RS-485串行接口的驅動器，共模電壓的輸出範圍是-7V和+12V之間；對於RS-422串行接口的驅動器，該項性能指標僅有±7V。RS-422串行接口接收器的最小輸入電阻是4KΩ；而RS-485串行接口接收器的最小輸入電阻則是12KΩ。</p><p class=ql-align-justify><strong>串口與握手基礎知識</strong></p><p class=ql-align-justify><strong>一、串口基礎知識</strong></p><div class=pgc-img><img alt=詳解RS232、RS485、RS485、串口&握手 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d16e0b637e6f4d499ec5d86579346a03><p class=pgc-img-caption></p></div><p class=ql-align-justify>串口是計算機上一種非常通用設備通信的協議（不要與通用串行總線Universal Serial Bus或者USB混淆）。大多數計算機包含兩個基於RS232的串口。串口同時也是儀器儀表設備通用的通信協議；很多GPIB兼容的設備也帶有RS-232口。同時，串口通信協議也可以用於獲取遠程採集設備的數據。</p><p class=ql-align-justify>串口通信的概念非常簡單，串口按位（bit）發送和接收字節。儘管比按字節（byte）的並行通信慢，但是串口可以在使用一根線發送數據的同時用另一根線接收數據。它很簡單並且能夠實現遠距離通信。比如IEEE488定義並行通行狀態時，規定設備線總常不得超過20米，並且任意兩個設備間的長度不得超過2米；而對於串口而言，長度可達1200米。</p><div class=pgc-img><img alt=詳解RS232、RS485、RS485、串口&握手 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ce7a5ce6f1e24bca95895d6dc4e945a4><p class=pgc-img-caption></p></div><p class=ql-align-justify>典型地，串口用於ASCII碼字符的傳輸。通信使用3根線完成：（1）地線，（2）發送，（3）接收。由於串口通信是異步的，端口能夠在一根線上發送數據同時在另一根線上接收數據。其他線用於握手，但是不是必須的。串口通信最重要的參數是波特率、數據位、停止位和奇偶校驗。對於兩個進行通行的端口，這些參數必須匹配：</p><p class=ql-align-justify>1、波特率</p><p class=ql-align-justify>這是一個衡量通信速度的參數。它表示每秒鐘傳送的bit的個數。例如300波特表示每秒鐘發送300個bit。當我們提到時鐘週期時，我們就是指波特率例如如果協議需要4800波特率，那麼時鐘是4800Hz。這意味著串口通信在數據線上的採樣率為4800Hz。通常電話線的波特率為14400，28800和36600。波特率可以遠遠大於這些值，但是波特率和距離成反比。高波特率常常用於放置的很近的儀器間的通信，典型的例子就是GPIB設備的通信。</p><p class=ql-align-justify>2、數據位</p><p class=ql-align-justify>這是衡量通信中實際數據位的參數。當計算機發送一個信息包，實際的數據不會是8位的，標準的值是5、7和8位。如何設置取決於你想傳送的信息。比如，標準的ASCII碼是0～127（7位）。擴展的ASCII碼是0～255（8位）。如果數據使用簡單的文本（標準 ASCII碼），那麼每個數據包使用7位數據。每個包是指一個字節，包括開始/停止位，數據位和奇偶校驗位。由於實際數據位取決於通信協議的選取，術語“包”指任何通信的情況。</p><p class=ql-align-justify>3、停止位</p><p class=ql-align-justify>用於表示單個包的最後一位。典型的值為1，1.5和2位。由於數據是在傳輸線上定時的，並且每一個設備有其自己的時鐘，很可能在通信中兩臺設備間出現了小小的不同步。因此停止位不僅僅是表示傳輸的結束，並且提供計算機校正時鐘同步的機會。適用於停止位的位數越多，不同時鐘同步的容忍程度越大，但是數據傳輸率同時也越慢。</p><p class=ql-align-justify>4、奇偶校驗位</p><p class=ql-align-justify>在串口通信中一種簡單的檢錯方式。有四種檢錯方式：偶、奇、高和低。當然沒有校驗位也是可以的。對於偶和奇校驗的情況，串口會設置校驗位（數據位後面的一位），用一個值確保傳輸的數據有偶個或者奇個邏輯高位。例如，如果數據是011，那麼對於偶校驗，校驗位為0，保證邏輯高的位數是偶數個。如果是奇校驗，校驗位位1，這樣就有3個邏輯高位。高位和低位不真正的檢查數據，簡單置位邏輯高或者邏輯低校驗。這樣使得接收設備能夠知道一個位的狀態，有機會判斷是否有噪聲干擾了通信或者是否傳輸和接收數據是否不同步。</p><p class=ql-align-justify><strong>二、握手基礎知識</strong></p><p class=ql-align-justify>RS-232通行方式允許簡單連接三線：Tx、Rx和地線。但是對於數據傳輸，雙方必須對數據定時採用使用相同的波特率。儘管這種方法對於大多數應用已經足夠，但是對於接收方過載的情況這種使用受到限制。這時需要串口的握手功能。在這一部分，我們討論三種最常用的RS-232握手形式：軟件握手、硬件握手和Xmodem。</p><p class=ql-align-justify>1、軟件握手</p><p class=ql-align-justify>我們討論的第一種握手是軟件握手。通常用在實際數據是控制字符的情況，類似於GPIB使用命令字符串的方式。必須的線仍然是三根：Tx、Rx和地線，因為控制字符在傳輸線上和普通字符沒有區別，函數SetXModem允許用戶使能或者禁止用戶使用兩個控制字符XON和OXFF。這些字符在通信中由接收方發送，使發送方暫停。</p><div class=pgc-img><img alt=詳解RS232、RS485、RS485、串口&握手 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/92fae6941ff0421e8b3eada8877bcf1c><p class=pgc-img-caption></p></div><p class=ql-align-justify>例如：假設發送方以高波特率發送數據。在傳輸中，接收方發現由於CPU忙於其他工作，輸入buffer已經滿了。為了暫時停止傳輸，接收方發送XOFF，典型的值是十進制19，即十六進制13，直到輸入buffer空了。一旦接收方準備好接收，它發送XON，典型的值是十進制17，即十六進制11，繼續通信。輸入buffer半滿時，LabWindows發送XOFF。此外，如果XOFF傳輸被打斷，LabWindows會在buffer達到75％和90％時發送XOFF。顯然，發送方必須遵循此守則以保證傳輸繼續。</p><p class=ql-align-justify>2、硬件握手</p><p class=ql-align-justify>第二種是使用硬件線握手。和Tx和Rx線一樣，RTS/CTS和DTR/DSR一起工作，一個作為輸出，另一個作為輸入。第一組線是RTS （Request to Send）和CTS（Clear to Send）。當接收方準備好接收數據，它置高RTS線表示它準備好了，如果發送方也就緒，它置高CTS，表示它即將發送數據。另一組線是DTR（Data Terminal Ready）和DSR（Data Set Ready）。這些現主要用於Modem通信。使得串口和Modem通信他們的狀態。例如：當Modem已經準備好接收來自PC的數據，它置高DTR線，表示和電話線的連接已經建立。讀取DSR線置高，PC機開始發送數據。一個簡單的規則是DTR/DSR用於表示系統通信就緒，而RTS/CTS用於單個數據包的傳輸。</p><div class=pgc-img><img alt=詳解RS232、RS485、RS485、串口&握手 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/dcedd6b47a9047b58079ece519543cf6><p class=pgc-img-caption></p></div><p class=ql-align-justify>在LabWindows，函數SetCTSMode使能或者禁止使用硬件握手。如果CTS模式使能，LabWindows使用如下規則：當PC發送數據：RS-232庫必須檢測CTS線高後才能發送數據。</p><p class=ql-align-justify>當PC接收數據：</p><p class=ql-align-justify>如果端口打開，且輸入隊列有空接收數據，庫函數置高RTS和DTR。</p><p class=ql-align-justify>如果輸入隊列90％滿，庫函數置低RTS，但使DTR維持高電平。</p><p class=ql-align-justify>如果端口隊列近乎空了，庫函數置高RTS，但使DRT維持高電平。</p><p class=ql-align-justify>如果端口關閉，庫函數置低RTS和DTR。</p><p class=ql-align-justify>3、XModem握手</p><p class=ql-align-justify>最後討論的握手叫做XModem文件傳輸協議。這個協議在Modem通信中非常通用。儘管它通常使用在Modem通信中，XModem協議能夠直接在其他遵循這個協議的設備通信中使用。在LabWindows中，實際的XModem應用對用戶隱藏了。只要PC和其他設備使用XModem協議，在文件傳輸中就使用LabWindows的XModem函數。函數是XModemConfig，XModemSend和XModemReceive。</p><div class=pgc-img><img alt=詳解RS232、RS485、RS485、串口&握手 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/187da30fcb4e49ecb93506eb0a6f5fe9><p class=pgc-img-caption></p></div><p class=ql-align-justify>XModem使用介於如下參數的協議：start_of_data、end_of_data、neg_ack、wait_delay、 start_delay、max_tries、packet_size。這些參數需要通信雙方認定，標準的XModem有一個標準的定義：然而，可以通過 XModemConfig函數修改，以滿足具體需要。這些參數的使用方法由接收方發送的字符neg_ack確定。這通知發送方其準備接收數據。它開始嘗試發送，有一個超時參數start_delay；當超時的嘗試超過max_ties次數，或者收到接收方發送的start_of_data，發送方停止嘗試。如果從發送方收到start_of_data，接收方將讀取後繼信息數據包。包中含有包的數目、包數目的補碼作為錯誤校驗、packet_size字節大小的實際數據包，和進一步錯誤檢查的求和校驗值。在讀取數據後，接收方會調用wait_delay，然後想發送方發送響應。如果發送方沒有收到響應，它會重新發送數據包，直到收到響應或者超過重發次數的最大值max_tries。如果一直沒有收到響應，發送方通知用戶傳輸數據失敗。</p><p class=ql-align-justify>由於數據必須以pack_size個字節按包發送，當最後一個數據包發送時，如果數據不夠放滿一個數據包，後面會填充ASCII碼NULL（0）字節。這導致接收的數據比原數據多。在XModem情況下一定不要使用XON/XOFF，因為XModem發送方發出包的數目很可能增加到XON/OFF控制字符的值，從而導致通信故障。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>RS485</a></li><li><a>串口</a></li><li><a>詳解</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/dcf34db.html alt="串口知識詳解 串口功能及電路介紹" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/28288ac78a924410a9a1143ae134af22 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dcf34db.html title="串口知識詳解 串口功能及電路介紹">串口知識詳解 串口功能及電路介紹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ecad0bd.html alt=串口通信的RS232，RS485，RS422，這麼多RS，你還分不清楚嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/6f4b8b5e-647f-4708-9681-ed72c5ccac93 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ecad0bd.html title=串口通信的RS232，RS485，RS422，這麼多RS，你還分不清楚嗎？>串口通信的RS232，RS485，RS422，這麼多RS，你還分不清楚嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f8b2a960.html alt="思路方法詳解 高三數學複習難點突破 圓錐曲線中的定點、定值問題" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/afd28158b4384f5eaa05c44c3104e24f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f8b2a960.html title="思路方法詳解 高三數學複習難點突破 圓錐曲線中的定點、定值問題">思路方法詳解 高三數學複習難點突破 圓錐曲線中的定點、定值問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/17054f8d.html alt=詳解CD編碼格式（16bit/44.1kHz）合理性之量化篇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/6f23d12bac3843e2b09628221846ce0f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/17054f8d.html title=詳解CD編碼格式（16bit/44.1kHz）合理性之量化篇>詳解CD編碼格式（16bit/44.1kHz）合理性之量化篇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c84544ec.html alt=詳解CD編碼格式（16bit/44.1kHz）合理性之採樣篇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5dc880024dac477f8aed432054712f82 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c84544ec.html title=詳解CD編碼格式（16bit/44.1kHz）合理性之採樣篇>詳解CD編碼格式（16bit/44.1kHz）合理性之採樣篇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/feaa3a52.html alt=詳解音頻編解碼的原理、演進和應用選型等 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c0abba2ccef04296b442c6457cc98f49 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/feaa3a52.html title=詳解音頻編解碼的原理、演進和應用選型等>詳解音頻編解碼的原理、演進和應用選型等</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8293e598.html alt=MySQl事務最全詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c61163c863114226b14bb3760da19e4d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8293e598.html title=MySQl事務最全詳解>MySQl事務最全詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cb944fe7.html alt=Mysql事務詳解(一文讀懂數據庫事務) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/cb7ba6cbda8c44438d9d3d7c57bd25b9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cb944fe7.html title=Mysql事務詳解(一文讀懂數據庫事務)>Mysql事務詳解(一文讀懂數據庫事務)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dc1a27dd.html alt="詳解Oracle 數據庫啟動過程" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/1538236609349861be8e044 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dc1a27dd.html title="詳解Oracle 數據庫啟動過程">詳解Oracle 數據庫啟動過程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b8bda645.html alt=「Java」隨機數詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b471807e699b44c2b1dedc580ea3f3af style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b8bda645.html title=「Java」隨機數詳解>「Java」隨機數詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f44ab8f6.html alt=詳解13項鋼筋安裝質量標準及通病防治 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/fd3ff534941a487884c7a67361337cfb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f44ab8f6.html title=詳解13項鋼筋安裝質量標準及通病防治>詳解13項鋼筋安裝質量標準及通病防治</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/464b2d9e.html alt=史上最全電路圖詳解！老電工都收藏了！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1533138404073909636bf43 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/464b2d9e.html title=史上最全電路圖詳解！老電工都收藏了！>史上最全電路圖詳解！老電工都收藏了！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/79cb5594.html alt=每一滴油力爭做到不浪費，詳解各種燃油噴射方式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/3ed00001d75ac552f05c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/79cb5594.html title=每一滴油力爭做到不浪費，詳解各種燃油噴射方式>每一滴油力爭做到不浪費，詳解各種燃油噴射方式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4ea3618a.html alt="Excel萬金油套路詳解 單條件查找返回多行數據" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2633664673fd439a862a2527763e82c7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4ea3618a.html title="Excel萬金油套路詳解 單條件查找返回多行數據">Excel萬金油套路詳解 單條件查找返回多行數據</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4d1e6d96.html alt=詳解如何使用sum+offset+match函數進行動態區域求和，大神祕籍 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/7360fe7df5e241e7af4b15f75f6474fd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4d1e6d96.html title=詳解如何使用sum+offset+match函數進行動態區域求和，大神祕籍>詳解如何使用sum+offset+match函數進行動態區域求和，大神祕籍</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>