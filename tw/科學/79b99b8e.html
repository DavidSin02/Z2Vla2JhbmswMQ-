<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>多樣性算法在58部落的實踐和思考 | 极客快訊</title><meta property="og:title" content="多樣性算法在58部落的實踐和思考 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/8fdd772c61cf4d3397fc224079b298a1"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/79b99b8e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/79b99b8e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/79b99b8e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/79b99b8e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/79b99b8e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/79b99b8e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/79b99b8e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/79b99b8e.html><meta property="article:published_time" content="2020-11-14T20:52:19+08:00"><meta property="article:modified_time" content="2020-11-14T20:52:19+08:00"><meta name=Keywords content><meta name=description content="多樣性算法在58部落的實踐和思考"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E5%AD%B8/79b99b8e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>多樣性算法在58部落的實踐和思考</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E5%AD%B8.html>科學</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right><strong>導讀</strong></h1><p>本文在明確“推薦系統個體多樣性優化”主題後，由整體架構出發，清楚闡述了在召回層、規則層、多樣性層的優化細節。在MMR 和 DPP算法部分既有原理也有實踐，最後用圖表方式展示出了效果對比，並且結合自身業務特點做了針對性的距離設計 。</p><p style=text-align:start>背景</p><p style=text-align:start>在推薦系統中，衡量系統好壞的指標，除了相關性之外，多樣性也是重要的指標之一。但多樣性和相關性之間往往存在一些矛盾的地方，本文從業務指標的角度，探討了多樣性和相關性之間如何權衡的思想方法，介紹了多樣性算法的落地實踐方案，最終達到了通過多樣性手段提升業務指標的目的。</p><h1 class=pgc-h-arrow-right><strong>1. 多樣性算法的意義和難點</strong></h1><p style=text-align:start>推薦系統中，準確度一直是衡量系統好壞最重要的指標，大多數的工作都是在研究如何提高準確度。然而，推薦結果的質量是通過多個維度來衡量的，越來越多研究表明，僅依賴準確度的推薦已經不能對用戶的體驗和滿意度有所提升，反而容易促進信息繭房的產生。於是，如何在準確性和多樣性之間進行權衡和協同優化，從而提高業務的整體數據指標成為了現在推薦系統的又一個優化方向。</p><p style=text-align:start>在實踐中，我們總結了多樣性算法落地的幾個難點：</p><p style=text-align:start>1）模型的優化目標模糊</p><p style=text-align:start>眾所周知，各種用戶行為（點擊、轉化、停留、分享等等）都可以作為優化準確度的目標，我們可以明確的收集用戶的行為作為模型的目標標籤，從而設計模型並優化。因為多樣性本身是一個集合統計量，很難找到直接的用戶行為來作為模型優化的目標。</p><p style=text-align:start>2）業務指標和多樣性指標的衝突</p><p style=text-align:start>業務關注的指標（轉化率、停留時長等）和多樣性指標並不是簡單的正向或者負向的關係。如果單純為了提高多樣性指標而做多樣性，反而會導致最終結果與業務目標偏離，使推薦的質量下降。</p><p style=text-align:start>綜上所述，我們在58部落推薦系統的多樣性實踐中，排除了單純使用多樣性指標作為評估算法好壞的方法。結合部落的業務特點，我們定下了這樣的目標：把多樣性作為一個提高業務指標的手段，通過多個業務指標和多樣性指標來綜合評估算法的效果，最終達到兩種指標共同提升，進而提高用戶體驗的目的。</p><h1 class=pgc-h-arrow-right><strong>58部落的多樣性算法實踐</strong></h1><p style=text-align:start>在多樣性算法的研究中，通常把多樣性分成兩種：</p><p style=text-align:start>基於個體用戶的多樣性，旨在避免給單一用戶推薦相似的物品，從而提高用戶體驗和增加用戶滿意度；</p><p style=text-align:start>基於全部用戶的多樣性，旨在優化長尾的物品分發效果；</p><p style=text-align:start>因為我們現階段的主要目標是針對個體用戶體驗，所以選擇了基於個體用戶的多樣性作為實踐方向。</p><h1 class=pgc-h-arrow-right><strong>1. 推薦系統架構圖</strong></h1><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8fdd772c61cf4d3397fc224079b298a1><p class=pgc-img-caption></p></div><p style=text-align:start>推薦系統在線分層架構圖</p><p style=text-align:start>為了保證推薦數據的多元化，我們在三個地方進行了優化：</p><p style=text-align:start>1）召回層：從數據源提供多樣性的候選集合，通過提高粗排候選池中主題、類別和作者的覆蓋度來保證數據源的多樣化；</p><p style=text-align:start>2）規則層：在相關性損失不大的情況下，通過提高精排候選池中主題和類別的覆蓋度來保證進入精排數據的多樣化；</p><p style=text-align:start>3） 多樣性層：對數據統一做多樣化處理，保證數據輸出多樣化。</p><p style=text-align:start>數據決定了效果的上限，而算法只是逼近這個上限。在多樣性層，只是儘可能保證了精排後的數據多樣性，由於結果受精排候選池數據多樣性的影響，所以如果能在召回層數據源保持候選集合的多樣性，效果會更好。</p><h1 class=pgc-h-arrow-right><strong>2. 數據源多樣化</strong></h1><h1 class=pgc-h-arrow-right><strong>2.1 召回層多樣化的實現</strong></h1><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2cdfb491de3c43f5b23aecab7a5d1efb><p class=pgc-img-caption></p></div><p style=text-align:start>召回層架構圖</p><p style=text-align:start>在召回階段，我們採用的是多路召回。為了保證數據多樣性，通過增加若干多樣性的召回策略來豐富數據源，例如：</p><p style=text-align:start>通過多樣性算法，獲取用戶個性化和多樣化的主題、類別、作者進行召回，以保證召回兼顧多樣性和相關性；</p><p style=text-align:start>通過一些長尾、時間、驚喜的召回分路，來增加數據新穎性和多樣性；</p><p style=text-align:start>通過一些基於關係、屬性的協同召回分路，提高數據多樣性。</p><p style=text-align:start>通過增加多樣性和新穎性召回，粗排候選池中的數據基於主題的覆蓋度提高了120%左右，基於類別覆蓋度提高了100%左右。</p><h1 class=pgc-h-arrow-right><strong>2.2 規則層多樣化的實現</strong></h1><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/03faba9d3bcd4601b479cb2895a2fbf0><p class=pgc-img-caption></p></div><p style=text-align:start>規則層架構圖</p><p style=text-align:start>我們推薦的數據是多種異構類型的實體，因此進入精排前（規則層）會對類型進行分桶處理。每種類型從粗排到精排都要經過一個數據截取階段，主要截取指標一般是粗排的相關性分數。為了防止截斷操作破壞召回層對數據源所做的多樣性優化，我們通過對該類型的粗排結果先按照類別進行分桶，然後在做多樣性控制。最後對各種類型進行比例調整、數據補充以及一些必要的過濾。在相關性影響不大的情況下提高精排數據的多樣性。</p><p style=text-align:start>因為規則層多樣性算法是按照類型分桶，因此不受多種異構類型的實體混排的影響，適合於各種多樣性算法。</p><p style=text-align:start>規則層添加多樣性算法干預之後，精排候選池中的數據基於主題的覆蓋度提高了80%左右，基於類別覆蓋度提高了70%左右。</p><p style=text-align:start>規則層加入多樣性後的線上ctr和uvctr轉化效果，如下圖：</p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/c57d3ab39da440fc8f3ae7ff63f7409d><p class=pgc-img-caption></p></div><p style=text-align:start>規則層算法效果對比</p><p style=text-align:start>從上圖可以看出，就而言，各個算法差異度並不是很大，和表現略好。就而言，算法表現稍微好一點。規則層主要是通過多樣性算法替換之前的啟發式規則，使據源多樣性自動化。</p><p style=text-align:start><br></p><h1 class=pgc-h-arrow-right><strong>3. 基於重排序方法的多樣層</strong></h1><p style=text-align:start>算法調參，我們主要參考三個業務指標：</p><p style=text-align:start>pvctr 表示pv點擊率； uvctr 表示uv點擊率； avgpv 表示人均展示數。</p><p style=text-align:start>對於多樣性算法應用的場景，在規則層單類型上使用了常用的多樣性算法，binomal，EE,DPP,XQUAD,PM2,Bayes，MMR，在多樣性層多種異構類型的實體上常用算法並不是合適，因為58部落物品類型多樣而且異構，很難用單一的向量生成方法把異構物品放在一個稠密空間度量，而且不同類型的實體興趣分佈重疊度並不是很高，所以我們使用了基於自定義距離的MMR,DPP算法以及不是基於距離的EE算法。</p><h1 class=pgc-h-arrow-right><strong>3.1 多樣性架構圖</strong></h1><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1f0daa6ee9994aa0bf4f3d63fe5b48cc><p class=pgc-img-caption></p></div><p style=text-align:start>多樣性層架構圖</p><p style=text-align:start>限於篇幅、業務結合的重要性、時效性等原因，下面重點介紹MMR和DPP這兩種算法在工程實踐中的應用。</p><h1 class=pgc-h-arrow-right><strong>3.2 MMR 的原理</strong></h1><h1 class=pgc-h-arrow-right><strong>MMR 的原理的全稱為MaximalMarginal Relevance，是一種以減少冗餘、保證相關的貪心排序算法。在推薦場景體現在，給用戶推薦相關商品的同時，保證推薦結果的多樣性。公式：</strong></h1><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/bc85365cf9384db8b0af06ab33830abc><p class=pgc-img-caption></p></div><p style=text-align:start>S 是已經選擇的文檔有序集合,一般是相關性排序結果;</p><p style=text-align:start>R 表示下一個候選文檔；</p><p style=text-align:start>Di 表示下一個候選文檔;</p><p style=text-align:start>Dj 表示S中的文檔;</p><p style=text-align:start>sim 函數：是相似度度量函數，例如相似度；</p><p></p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f895761ac19e4dadbc57858c6a07de49><p class=pgc-img-caption></p></div><p>表示候選文檔與查詢文檔的相關性；</p><p></p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/357f2960b0054ab5acc115bf0867798c><p class=pgc-img-caption></p></div><p>表示該文檔與已有文檔的相似性最大值；</p><p style=text-align:start>權重係數，調節推薦結果相關性與多樣性。</p><p style=text-align:start>作為一種貪婪算法，同樣是每次計算出公式中最大值，放入有序結果集，同時從候選集中刪除選中的物品，然後更新參數，進而進行下一輪繼續選擇，直到結果集中數據量滿足需要或者沒有數據可選擇為止。</p><h1 class=pgc-h-arrow-right><strong>實現流程</strong></h1><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/91219e5749054c5a9411cd1155097524><p class=pgc-img-caption></p></div><p style=text-align:start>MMR算法流程圖</p><h1 class=pgc-h-arrow-right><strong>實驗效果</strong></h1><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d65372da5b6b44b080b20379f65a49cd><p class=pgc-img-caption></p></div><p style=text-align:start>MMR參數效果對照圖</p><p style=text-align:start>我們工程實現上為了算法流程統一，把原始論文中的公式裡面的和調換了一下位置，為了保證幾個指標在同一張圖中對比，圖中把和進行一定程度的放大和縮小。從圖上可以看出，逐漸調整多樣性參數, 逐漸降低，在的時候達到最高點，因為越小，結果越偏向於相關性。和人均瀏覽數穩定提高，說明隨著多樣性的增加會吸引一些人產生點擊行為，並且會使得他們瀏覽更多的內容，並且在的時候效果最好，在的時候達到最高點。</p><h1 class=pgc-h-arrow-right><strong>工程實現問題</strong></h1><p style=text-align:start>距離計算的時候，我們的實現是當前文檔與已選文檔之間的平均距離，來避免使用最大距離而導致推薦結果中後續加入的文檔之間有高的相似性。</p><p style=text-align:start>物品之間相似度函數的定義，可以根據論文裡提到的用相似度。但是這樣就要求候選列表之間必須要有一個統一的物品向量，以保證該向量是anything-to-anything。因為推薦結果有多種類型，並且是異構的，這種情況下相似度並沒有很好的可解釋性。我們的做法是使用和業務結合的自定義距離，下文會詳細介紹自定義距離。</p><h1 class=pgc-h-arrow-right><strong>3.3 DPP 的原理</strong></h1><p style=text-align:start>全稱determinantal point process，是在一個離散的點集的冪集上定義的概率分佈。是隨機採樣得到的一個子集，對於任意，有</p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0b70dd1e2b734f0d84c0a0ccf9113d9c><p class=pgc-img-caption></p></div><p style=text-align:start>公式中變量含義：</p><p style=text-align:start>Y 行列式點過程隨機採樣得到的一個隨機子集;</p><p></p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/43493fbd0f43499b8274d435f4783a10><p class=pgc-img-caption></p></div><p>是Y的任意子集;</p><p></p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bb814a61f1c8448ab2de8ee1d1b5b650><p class=pgc-img-caption></p></div><p>表示中所有元素在採樣中被命中的概率;</p><p style=text-align:start>k 是一個的實對稱方陣，也是被稱為的核矩陣，每個元素 可以認為是集合中第個元素之間的相似度，與採樣概率成反比。可以看做物品與用戶的相關性，和採樣概率成正比。</p><p style=text-align:start>Ka 是K的主子式，階數是中元素個數。</p><p style=text-align:start>行列式點過程，通過下圖可以形象的描述：</p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6b88ed989e5840b2b1a1e43cc0c14114><p class=pgc-img-caption></p></div><p style=text-align:start>行列式點過程示意圖</p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b16390c3c44d4a2aa4370d01f3031e6e><p class=pgc-img-caption></p></div><p style=text-align:start>表示物品i、j同時被採樣出來的概率。從公式可以看出，越是相似的物品，被同時採樣出來的概率就越小。</p><p style=text-align:start>該算法思路是把重排序問題看成一個子集選擇問題，目標是從原始數據集合中選擇具有高質量但又多樣化的的子集，通過DPP來保持高質量和多樣性的平衡。DPP是一個性能較高的概率模型，通過行列式將複雜的概率計算簡單化。DPP還可以理解為一個抽樣的過程，兩個元素作為子集被抽取的概率與單一元素被抽取的概率以及這兩個元素的相似度有關。</p><h1 class=pgc-h-arrow-right><strong>DDP實現方案</strong></h1><p style=text-align:start>第一種是Google提出一種基於窗口的重排序方案，論文中提到的核矩陣構建方案是：</p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/45a04cc843be4546a1ee34506ad58a4b><p class=pgc-img-caption></p></div><p>Dij表示物品i、j 的距離， 是自由變量。當a=1時，等價於標準RBF內核。當</p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/665cb1bff9e34294b610adc404373494><p class=pgc-img-caption></p></div><p>時，按比例縮小矩陣的非對角線，這基本上對應於將所有物品更多樣化。當a>1時，按比例放大矩陣的對角線，其相反的效果是使所有項更相似。</p><p style=text-align:start>隨著集合的增長，小集合的概率增大，而大集合的概率減小。由於 a>1 時，可能導致L非半正定，為了保證每次計算的核矩陣半正定，論文對核矩陣做了一個映射，計算L的特徵分解並用0代替任何負的特徵值。</p><p style=text-align:start>同時也提出了基於深度格拉姆核矩陣的深度學習模型優化方法，減少網格搜索參數的複雜度。</p><p style=text-align:start>第二種是賓夕法尼亞大學提供的方案，該方案是一個通用的DDP最大後驗推斷求解方案，但是每獲取一個物品，都要經過計算而重新構建核矩陣，延遲不太樂觀。</p><p style=text-align:start>第三種是Huhu視頻提出最大後驗推斷解決方案，該論文提出了一種改進的貪心算法能夠快速的求解以解決傳統MAP時間複雜度很高的問題：</p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2876cfe6a84c4aad894183163bf9beea><p class=pgc-img-caption></p></div><p>通過構造</p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d4a4179e5a204b48a8cfdfd204b70935><p class=pgc-img-caption></p></div><p>的次模函數把MAP求解問題轉化為次模函數最大化為題。並通過貪心算法來解決次模函數最大化帶來的NP-hard問題。</p><p style=text-align:start>每次選擇商品添加到結果集中Yg中，Yg初始化為空集，直到滿足條件為止，商品需要滿足下面的等式：</p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d308587033a14582b6df91a6e52fc077><p class=pgc-img-caption></p></div><p style=text-align:start>由於計算行列式複雜度較高，論文對的進行Cholesky分解，初始化為空，並通過一些列轉化得到：</p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fc7c917a2e89419292e1ae513275adc5><p class=pgc-img-caption></p></div><p style=text-align:start>作者又提出了增量更新，通過推導（具體推導過程請參考原論文）得到最終增量更新公式：</p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f1b8458cb29b4127857440188690a60f><p class=pgc-img-caption></p></div><p style=text-align:start>我們實現了三種方案，方案二延遲較大，無法應用到線上。方案一我們實現的簡單模式，是直接計算行列式，延遲比方案三大。方案三沒有核矩陣就行修復，會出現排序結果小於預期數據量的情況。實際應用中，結合數據量的需求以及效率，我們最終選擇的是第三種hulu提出的實現方案。</p><p style=text-align:start>DPP實現流程</p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/21456a963f4c4b6b9b4352ae7fe44531><p class=pgc-img-caption></p></div><p style=text-align:start>DPP算法流程圖</p><h1 class=pgc-h-arrow-right><strong>實驗效果</strong></h1><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/95f399ea0cb04f15b3513ce988639bce><p class=pgc-img-caption></p></div><p style=text-align:start>DPP參數變化對應效果圖</p><p style=text-align:start>為了保證幾個指標在同一張圖中相互對比，圖中把pvctr和avgpv進行一定程度的放大和縮小。從上圖可以看出，逐漸調整多樣性參數, pvctr在變大，在0.7左右的時候達到最高。uvctr和人均瀏覽數穩定提高，說明隨著多樣性的增加會吸引不點擊的人產生點擊行為，並且會使得人們瀏覽更多的內容，並且uvctr在0.7的時候達到最高點，在0.7時的時候效果最好。DDP每條曲線最後一個參數值都很低，是因為在0.999的時候，在構建核矩陣的時候a的值變得很大，在經過指數變化，導致很多核矩陣的值為最大值，矩陣不滿秩，數據只返回幾個，屬於非正常情況，各種指標都下降，這也是算法調試過程中需要避開的點。</p><h1 class=pgc-h-arrow-right><strong>工程實現問題</strong></h1><p style=text-align:start>實現上，我們主要使用EJML這個高效的開源的Java矩陣運算庫實現的，這個庫是目前嘗試過程中效率比較高的庫。</p><p style=text-align:start>工程實現上，主要參考論文中提到的使用</p><pre><code>exp(αr_u )</code></pre><p style=text-align:start>代替Ru，通過對多樣性和相關性進行調節，</p><pre><code>α=θ/((2(1-θ)) )</code></pre><p style=text-align:start>論文中提到的保證半正定性就行修正</p><pre><code>S_ij=(1+⟨f_i,f_j ⟩)/2</code></pre><p style=text-align:start>在我們應用中影響並不是很大，主要是我們的相似度矩陣是自定義的。</p><p style=text-align:start>DPP 主要優化點在效率，我們採用huhu視頻的優化方案，通過增量求解的方式代替遍歷求行列式的方式，平均100個物品整個重排序過程延遲只有4ms。</p><p style=text-align:start>核矩陣的構建，因為我們需要一個可解釋性比較強並且能和業務結合比較緊密的自定義距離，因此相似度矩陣、核矩陣也是自定義。</p><p style=text-align:start>採用窗口的方式對整個列表分批排序。針對次模函數性質，小的數據集排斥性比大的數據集更大，採用窗口效果更好。</p><p style=text-align:start>針對DPP調參，首先固定自定義距離參數，找到一個合適的，然後固定，循環調節距離參數，網格搜索的方式優化參數。</p><p style=text-align:start>由於核矩陣不滿秩，導致返回數據量可能會小於預期的數據量，在對業務影響不大的情況下，可以正常使用。如果對返回數據量有嚴格要求，需要考慮對核矩陣進行修正，可以參考類似google提出的核矩陣修正方式，同時會對延遲有一點影響，延遲大概增加一倍。</p><h1 class=pgc-h-arrow-right><strong>3.4 多樣性層算法效果對比圖</strong></h1><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/0030f0e296f24d7aace2c24b88dfa8ed><p class=pgc-img-caption></p></div><p style=text-align:start>原始算法、MMR和DPP效果對比</p><p style=text-align:start>多樣性層主要考慮穩定性以及時效性，我們主要流量在兩個隱式多樣性算法MMR和DDP，而我們原始算法是通過啟發式規則進行控制的。通過對比最優參數下的算法，發現DDP整體效果上好於MMR，並且相對於原始算法都有很大程度提升。下表表示兩個算法相比原始算法變化。</p><p>指標 \ 算法</p><p>MMRDDPpvctr</p><p>+3.4%</p><p>+5.8%</p><p>+5.4%</p><p>+7.9%</p><p>+4.2%</p><p>+6.0%</p><p style=text-align:start>各算法業務指標變化圖</p><p style=text-align:start>自定義距離</p><p style=text-align:start>為了可解釋性更強以及更緊密的融合業務，我們使用了自定義的距離，自定義距離好處如下：</p><p style=text-align:start>可解釋性比較強，自定義的距離偏向於人可理解的目的，使距離更可解釋;</p><p style=text-align:start>和業務結合更緊密，自定義的距離使用業務相關的信息緊密結合業務;</p><p style=text-align:start>通用性比較強，可以在不同異構實體間使用，其他距離無法做到這一點.</p><p style=text-align:start>我們實踐過的自定義距離如下：</p><h1 class=pgc-h-arrow-right><strong>1. 傑卡德距離/漢明距離</strong></h1><p style=text-align:start>這種自定義距離實現方式，採用漢明-傑卡德距離平鋪近似法</p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/19f20773dcc1480d81a7cbed5c469667><p class=pgc-img-caption></p></div><p style=text-align:start>自定義距離-傑卡德/漢明距離</p><p style=text-align:start>就是構造和業務結合的漢明向量,先求出漢明距離，然後通過傑卡德相似度做歸一化。</p><h1 class=pgc-h-arrow-right><strong>2. 自定義距離-樹模型距離</strong></h1><p style=text-align:start>自定義樹模型的距離是通過樹狀分層衰減，自頂而下結合業務實現的</p><div class=pgc-img><img alt=多樣性算法在58部落的實踐和思考 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fd10de6d97ed4a0e8952722a28a1ab7c><p class=pgc-img-caption></p></div><p style=text-align:start>自定義距離-樹模型</p><p style=text-align:start>樹的葉子節點，就是距離的散點值。</p><p style=text-align:start>我們嘗試了以上三種自定義距離方式，從可解釋性、業務結合性以及線上實驗效果來看，樹模型是目前效果最適合的。</p><p style=text-align:start>總結與展望</p><p style=text-align:start>推薦系統多樣性的好壞有很多評估的方面，本文不單純用多樣性指標來衡量算法的好壞，同時還基於業務指標綜合考慮多樣性結果，把多樣性和業務關注的指標進行權衡，最終實現了通過多樣性算法提升業務指標的目的。在工程實現上，本文從召回、規則、重排序多個層面分別介紹了為達到多樣性的目的而做的算法嘗試，特別是最重要的重排序階段，我們基於MMR和DDP算法，在計算效率上進行了優化，並且針對業務數據的特點，對距離進行定製化改造，滿足了從多維度衡量物品相似度的業務需求。</p><p style=text-align:start>目前多樣性的實踐就文獻中的效果來說，學習式的多樣性算法效果大於非學習式的，顯式的大於隱式的，然而多類別異構實體的關係並不是那麼直觀，後續我們會結合業務特點進行嘗試。另外基於強化學習的多樣性算法也是多樣性研究的一個方向，目前我們已經再做相關嘗試。</p><h1 class=pgc-h-arrow-right><strong>參考文獻：</strong></h1><p style=text-align:start>1. C.-N. Ziegler, S.M. McNee, J.A. Konstan andG. Lausen. Improving recommendation lists through topic diversification. WWW2005</p><p style=text-align:start>2. J. Carbonell and J. Goldstein. The use ofMMR, diversity-based reranking for reordering documents and producingsummaries. SIGIR 1998</p><p style=text-align:start>3. Jennifer Gillenwater Alex Kulesza Ben Taskar. Near-Optimal MAP Inference forDeterminantal Point Processes. NIPS 2012</p><p style=text-align:start>4. Mark Wilhelm, Ajith Ramanathan, AlexanderBonomo, Sagar Jain, Ed H. Chi, Jennifer Gillenwater. Practical DiversifiedRecommendations on YouTube withDeterminantal Point Processes. CIKM’18 2018</p><p style=text-align:start>5. Laming Chen, Guoxin Zhang, Hanning Zhou. FastGreedy MAP Inference for Determinantal PointProcess to Improve RecommendationDiversity. NeurIPS 2018</p><p style=text-align:start>6. Caoys,CSDN博主.Determinantalpoint process 入門.csdn,2019</p><h1 class=pgc-h-arrow-right><strong>作者簡介：</strong></h1><p style=text-align:start>劉發帥，58趕集集團，資深算法工程師</p><p style=text-align:start>周建斌，58趕集集團，算法架構師，技術委員會委員</p><p>原文地址:https://mp.weixin.qq.com/s?__biz=MzI1NDc5MzIxMw==&mid=2247489500&idx=1&sn=e2ce6302b4d1ada92108a4854b8408f2</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>多樣</a></li><li><a>58</a></li><li><a>實踐</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/b6acbddb.html alt=「壓鑄實踐」大截面ZA27鋅合金蝸輪的雙重擠壓鑄造應用案例 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/972374c8b24644389e188cb290249f17 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b6acbddb.html title=「壓鑄實踐」大截面ZA27鋅合金蝸輪的雙重擠壓鑄造應用案例>「壓鑄實踐」大截面ZA27鋅合金蝸輪的雙重擠壓鑄造應用案例</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a6bd6cd9.html alt=並行的繁榮與衰落：58同城，神奇不在 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/S97zswJAhCdbYu style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a6bd6cd9.html title=並行的繁榮與衰落：58同城，神奇不在>並行的繁榮與衰落：58同城，神奇不在</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b096e432.html alt=餐飲業的共益實踐案例：是什麼留住了海底撈的員工？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3253c0fd3b54497282e5ebfb67cc350c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b096e432.html title=餐飲業的共益實踐案例：是什麼留住了海底撈的員工？>餐飲業的共益實踐案例：是什麼留住了海底撈的員工？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8ece3d8b.html alt=溼法鋅冶煉氟、氯現在走向及生產實踐 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/c6ec0692-63fe-42f8-8df3-b0a6226ca1a5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8ece3d8b.html title=溼法鋅冶煉氟、氯現在走向及生產實踐>溼法鋅冶煉氟、氯現在走向及生產實踐</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c018b81b.html alt=58種鋼材性能、用途彙總！建議收藏！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/eeff0908-48e5-4ff5-b702-23c8318b7358 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c018b81b.html title=58種鋼材性能、用途彙總！建議收藏！>58種鋼材性能、用途彙總！建議收藏！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e361e272.html alt=梧州中年女子在廣州被救助，高1米58，自稱叫黃素媚，穿紅色花上衣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/24320004606441bd94c2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e361e272.html title=梧州中年女子在廣州被救助，高1米58，自稱叫黃素媚，穿紅色花上衣>梧州中年女子在廣州被救助，高1米58，自稱叫黃素媚，穿紅色花上衣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/130bed32.html alt=「理論實踐」地方人大常委會研究室工作的實踐與思考 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/R9AiF6fHzZIbrG style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/130bed32.html title=「理論實踐」地方人大常委會研究室工作的實踐與思考>「理論實踐」地方人大常委會研究室工作的實踐與思考</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3998ae89.html alt=服務治理最佳實踐：如何依據參數值進行服務路由、鑑權、限流？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/3f6fb254f0cc4ba390695e1d561d4a5c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3998ae89.html title=服務治理最佳實踐：如何依據參數值進行服務路由、鑑權、限流？>服務治理最佳實踐：如何依據參數值進行服務路由、鑑權、限流？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a3e6ba64.html alt=“百名紅通人員”已有58人歸案（下） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RDygZAVDCACh74 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a3e6ba64.html title=“百名紅通人員”已有58人歸案（下）>“百名紅通人員”已有58人歸案（下）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ae87e8de.html alt=火炬孵化第58期新人訓練營順利開班 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/dae07941430c4ec78f0a64950696cbef style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ae87e8de.html title=火炬孵化第58期新人訓練營順利開班>火炬孵化第58期新人訓練營順利開班</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e4a0bd2a.html alt=一消倒計時58天-努力往前闖｜自噴重點：自動噴水滅火系統設計規範 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/1536703724717f74f9a0848 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e4a0bd2a.html title=一消倒計時58天-努力往前闖｜自噴重點：自動噴水滅火系統設計規範>一消倒計時58天-努力往前闖｜自噴重點：自動噴水滅火系統設計規範</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8654883c.html alt=項目實踐中的一些性能優化指南 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/8c9ad977831f4b6bbaaf2e1b4651b667 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8654883c.html title=項目實踐中的一些性能優化指南>項目實踐中的一些性能優化指南</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5138fb06.html alt=東勝氣田錦58井區首口氣藏評價直井試氣獲高產 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15281672163292de1c904be style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5138fb06.html title=東勝氣田錦58井區首口氣藏評價直井試氣獲高產>東勝氣田錦58井區首口氣藏評價直井試氣獲高產</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4af6c403.html alt=家用新風系統的58個常見問題，附解決方法，值得收藏 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/272cd40b22d7492f9dd88d0618ffe25d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4af6c403.html title=家用新風系統的58個常見問題，附解決方法，值得收藏>家用新風系統的58個常見問題，附解決方法，值得收藏</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/15c14279.html alt="諾獎得主 58 年前的量子謎題破解！因天線爆炸，澳研究人員意外發現“核電共振”" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RtOjCif1AjAaWU style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/15c14279.html title="諾獎得主 58 年前的量子謎題破解！因天線爆炸，澳研究人員意外發現“核電共振”">諾獎得主 58 年前的量子謎題破解！因天線爆炸，澳研究人員意外發現“核電共振”</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>