<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>揭祕《Sherman》：使用Unity製作影視級光照效果 | 极客快訊</title><meta property="og:title" content="揭祕《Sherman》：使用Unity製作影視級光照效果 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/4a79ed9a1e9b4205bd6efda968932cbd"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/7f7839d8.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/7f7839d8.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/7f7839d8.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/7f7839d8.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/7f7839d8.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/7f7839d8.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/7f7839d8.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/7f7839d8.html><meta property="article:published_time" content="2020-11-14T20:51:54+08:00"><meta property="article:modified_time" content="2020-11-14T20:51:54+08:00"><meta name=Keywords content><meta name=description content="揭祕《Sherman》：使用Unity製作影視級光照效果"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E5%AD%B8/7f7839d8.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>揭祕《Sherman》：使用Unity製作影視級光照效果</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E5%AD%B8.html>科學</a></span></div><div class=post-content><div><p>《Sherman》是由曾榮獲艾美獎的《大白的夢》創作團隊，使用Unity高清晰渲染管線HDRP製作的實時渲染動畫短片。</p><p>Unity媒體與娛樂創新團隊的光照主管Jean-Philippe Leroux參與制作了一些優秀影視動畫項目，包括：《ADAM 2》和《ADAM 3》，以及《大白的夢》。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4a79ed9a1e9b4205bd6efda968932cbd><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>現今影視動畫行業，正在進行著重大變革－實時製作的興起。實時動畫現在不僅僅是一個渲染解決方案，它還革新了整個創作流程。</p><p>實時創作引擎最初是用於遊戲開發的工具，隨著畫面質量的提高和技術的不斷成熟，如今實時創作引擎已經能夠作為創作工具，製作影視級的內容。</p><p>那麼實時渲染與離線渲染有什麼不同呢？我們是如何把大型渲染農場上數小時的處理過程，轉變為在幾秒內實現的即時反饋和4K畫質結果呢？這裡沒有使用任何魔法，而是許多簡化操作、近似處理、優化過程和小技巧結合起來的結果。</p><p>我們製作的實時渲染動畫短片《Sherman》的目標之一：展示HDRP製作高級實時渲染效果的能力。</p><p>本文，Jean-Philippe Leroux將重點介紹如何在Unity實現《Sherman》的實時光照解決方案，並提供實用的建議與技巧。不論你是3D動畫專家還是傳統光照藝術家，本文都將提供需要的工具，幫助你在Unity中為實時內容創建豐富而細膩的光照效果。</p><p>解析《Sherman》</p><p>在下圖的畫面中，光照部分進行了很多處理，我們將詳細講解所有元素是如何結合起來的。在這個鏡頭中，我們可以梳理出幾乎所有Unity光照效果方面的知識，以便你在自己的項目中活學活用。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ddab0e9c94e24eba82e989cecaec5647><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>我們可以把實現該畫面的光照效果分為四類，然後分別介紹如何控制這些光照類型。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/274af1828fa640e2b1d5a09fb15d97cb><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>掌控環境光照</p><p>如下圖所示，展現了間接漫反射光照即全局光照對畫面的影響。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/bcc0bb5fa8c742ef8e81627bb5a4fbfd><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>首先，我們定義場景的環境光照。在《Sherman》中，環境光照並不是簡單地使用一個環境光來模擬光線散射，而是利用了Unity漸進式光照貼圖，將全局光照的結果烘焙到光照貼圖中，製作出局部的環境光照。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/231b51619a984aec8b510461b6abe50e><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>光照貼圖</p><p>我們的項目使用了多場景設置，所有靜態場景元素保存在episode_set場景遊戲對象。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bfe6dab80128426f90648ce914e8f6a7><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>場景光照元素保存在Unity的活動場景episode_set_lighting中。這點非常重要，因為活動場景決定生成的光照數據保存在什麼位置。</p><p>瞭解多場景工作流程：</p><p>https://docs.unity3d.com/Manual/MultiSceneEditing.html</p><p>我們不需要使用001_timeline場景來構建場景光照，因此在製作過程中，我們會卸載該場景。如果仔細觀察，我們可以看到名稱為ToHide的部分，其中包含一個攝像機和一個太陽定向光的實例。</p><p>一些後期處理效果對光照很重要，例如：色調映射和環境遮蔽，但我們需要攝像機來呈現這些效果。在給場景添加光照時，我們使用一個臨時的攝像機，而在項目完全加載後，應該只會留下一個攝像機。當烘焙完成後，ToHide調試攝像機和光照會被再次隱藏起來。</p><p>對於光照貼圖中的任何對象來說，相應的UV不應該發生重疊，每個表面都需要有特定的UV。大部分情況下，我們可以在導入時讓Unity自動生成光照貼圖UV。</p><p>瞭解更多UV內容：</p><p>https://docs.unity3d.com/Manual/LightingGiUvs-GeneratingLightmappingUVs.html</p><p>對於複雜的有機對象，最好讓美術使用數字內容創作DCC軟件來製作UV2。如果想要在光照貼圖中不連續的邊緣上，實現更加平滑的結果，拼接縫隙是一個簡單的方法。</p><p>下圖為Unity Lighting設置面板。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2ad452e38a53480eab1f067e6f48e8b3><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>我們來看看Lighting光照標籤頁，瞭解製作《Sherman》場景的光照設置：</p><p>首先，我們在CPU漸進式光照貼圖中使用了Mixed Lighting Bake Indirect。由於HDRP不支持Realtime Global Illumination（實時全局光照），因此我們沒有使用該功能。每次發佈新版本的Unity時，GPU Lightmapper都有很大的改進，但在製作《Sherman》時，它仍缺少我們需要的關鍵功能。我不喜歡使用Shadowmask模式，該模式會將陰影和大部分光照烘焙到光照貼圖中，以進行動畫製作。通過使用Bake Indirect，光照計算會非常簡單，但分辨率較低，這意味著烘焙時間更短，而且我們可以靈活地矯正每個鏡頭的光照方向。Direct Samples設置和所選模式沒有任何關係，因為我們沒有烘焙任何直接光照，因此可以無視該設置。一開始可以將Indirect Sample的數值設置得小一點，例如：250左右，在確定場景設置後，我們可以提高該數值。對於Bounces設置，一般設為2就夠了，但如果是室內場景，我建議設為4。在設置Lightmap Resolution時，可以先設置較小的數值，隨後逐漸增大。在此場景中，我們最後選擇的分辨率為10，因此每平方米有100個紋素。</p><p>請注意：在光照和物理方面的設置中，我們要把1個Unity單位等價於真實環境中的1米。</p><p>在場景中，瞭解和利用網格的Scale In Lightmap參數非常重要。如果小型對象的三角面太小，無法覆蓋多個光照貼圖紋素，我們可以提高Scale In Lightmap值，對於遠處的較大對象，我們可以減小該值。我們可以啟用Baked Lightmap視圖和Show Lightmap Resolution選項，輕鬆預覽光照貼圖的分辨率。</p><p>並非所有對象都適合添加光照貼圖。我們不應該為光照貼圖標記多個表面的複雜對象，或是對全局光照影響不大的小型對象，例如：草、樹葉、小石子或碎片，否則渲染光照貼圖耗費的性能開銷會很大。為此，我們可以禁用Lightmap Static。</p><p>部分大型靜態對象也不適合使用光照貼圖，例如：短片中的籬笆，但我們仍希望它們能夠影響光照解決方案。</p><p>為了讓對象對光照產生影響的同時，不必為其製作光照貼圖，我們在此使用了一個技巧：把該對象的Scale In Lightmap值設為0。例如：在籬笆的邊緣部分，我們可以清楚看到籬笆對光線的遮蔽效果，即使籬笆沒有製作光照貼圖。</p><p>下圖中展示了場景視圖設置，以及籬笆區域光照貼圖的近距離效果。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2963b776351a4709bd44a4d3a4dd37c9><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>在其它部分使用光照探針</p><p>在設置好環境光照和光照貼圖後，光照探針組將照亮剩餘的小型動態對象。在《Sherman》中，我們創建了一組間距為1米的光照探針組。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d79000084fff400fb07dc1d0b9d29f92><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>通過巧妙使用光照探針代理體積，草坪等大型對象會從更為精細的探針光照中受益。通過這種方法，對象會被局部探針採樣照亮，而不是被單個探針照亮。</p><p>下圖中為在大型對象上使用光照探針代理體積的效果。我們可以看見，被不同探針照亮的草地會被分為大塊的區域。</p><p>小提示：在多場景設置中，只有來自最近加載場景的光照探針會在光照中考慮。</p><p>環境遮蔽</p><p>現在我們已經瞭解如何產生精美的局部環境光照，那麼要如何才能避免環境光照填補不應該影響的區域光，並讓對象接觸到地面呢？</p><p>首先，我們需要使用常用的DCC工具，為部分對象生成環境遮蔽貼圖，例如：狗窩內部和浣熊的嘴巴。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/e46c641efb9d48d2810183b62d075192><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>然後，我們使用屏幕空間環境遮蔽（SSAO）後期處理效果來將元素結合在一起。我們會在之後的後期處理部分進行詳細介紹。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/33a11697e7f045f8bd318aaafb8c1b47><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>規劃反射效果</p><p>如下圖所示，左側畫面為使用間接鏡面反射光照的部分，右側畫面為結合環境反射和烘焙反射的效果。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/46a28efdd659483abe3eecd6faf61b46><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>在實時環境中，間接鏡面光照即反射效果是一系列技術結合的成果。這些技術包括：</p><p>實時平面反射實時反射探針小型烘焙反射探針大型反射探針：較小探針體積的優先級比較大探針體積更高天空平面反射效果示例</p><p>下圖展示了平面反射的效果。</p><p>反射效果分辨率和緩存大小都通過HDRenderPipelineAsset資源來管理。平面反射就跟鏡子一樣，這類反射非常適合平坦表面，但也能夠用於較複雜的情況，例如：影片中浣熊和膨脹的水管表面上的反射。但須小心使用這類效果，因為它們會使用較多內存。</p><p>實時反射探針也可以用於展示光源上反射和遮蔽部分的重要細節。在影片中，我們使用了一個小的實時球型探針來包住食盆，在上面反射出即將爆炸的水管。</p><p>我們需要使用烘焙反射光照探針來覆蓋場景。我們應該利用大小探針的不同優先級，投射體積的視差矯正和高級混合模式。一個不錯的方法是：將光照捕捉點放在攝像機工作的平均高度上。</p><p>如果仔細觀察，我們會發現部分反射探針專門用於陰影區域。這些探針用來消除來自天空的定向光產生的多餘鏡面反射效果。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a27167fcb11248388e3551173a6dbc1e><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>使用Timeline</p><p>對於所有基於動畫的內容而言，Timeline是實用的序列工具和管理中心。在Timeline上，我們可以為大部分對象添加動畫，而在製作每個鏡頭的光照時，我們使用的是Activation Track激活軌道。</p><p>相對於在各個鏡頭調整光照綁定的每個組件，我認為管理特定鏡頭的分組會更加簡單。下圖展示了跟隨攝像機變換的光照分組激活軌道。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/82a1bbc291f647f982e997cb158ba5e7><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>下面是使用Timeline的一些小技巧：</p><p>如果希望在Timeline上為某個對象添加動畫，對象一定要和Timeline本身在同一個場景。在《Sherman》中，Timeline所在的場景為001_timeline場景。當重新打開項目或進入運行模式時，指向其它場景的鏈接都會丟失。禁用Post-playback狀態，否則在進行渲染時，場景會保留播放後的光照綁定。在修改鏡頭編輯內容或時間設置時，可以將動畫軌道轉換為剪輯軌道，方便重新安排動畫。瞭解更多關於激活軌道的信息：https://docs.unity3d.com/Manual/TimelineActivationTrackProperties.html</p><p>使用預製件</p><p>預製件非常適合對需要多次重複使用的對象進行分組，我們可以使用預製件修改分組的組成內容，所有對應實例會自動發生相應變化。</p><p>在預製件實例上，我們可以選擇性撤銷任何改動，也可以將實例恢復原始預製件的樣子，即時應用預製件的改動。此外，預製件系統也提供框架，實現無縫派生的工作流程，不僅可以調整實例，也可以快速創建和驗證變體。</p><p>從Unity 2018.2版本開始，Unity支持預製件嵌套功能，該功能非常適用於光照綁定的快速迭代。</p><p>下圖展示了第一個動畫的光照預製件結構，我們可以從中看到激活軌道上每個鏡頭的結構。由於只展示當前鏡頭中存在的光照對象，因此其它對象都暫時被隱藏起來。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8dea038836014944ae6b7bf9146fc063><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>在場景層級窗口的光照部分中，我們可以看到：</p><p>場景設置的重寫對象在鏡頭中嚴格用於構成陰影的對象控制大氣效果的密度體積食盆的實時反射探針太陽光、補光與邊緣光等其它預製件</p><p>使用預製件系統還有另一個好處：當對象在場景中實例化後，在處理光照時，不必在版本控制工具中反覆檢查場景。這意味著，團隊的其他成員也能夠在場景中進行製作。</p><p>需要注意的是：預製件上的部分屬性無法派生變化，需要使用自定義實例來實現變化，相關情況包括：體積配置文件、後期處理配置文件和Timeline等可編程對象。</p><p>添加太陽光</p><p>每個鏡頭分組都有一個太陽的實例，我們可以在每個鏡頭進行太陽朝向的微調。如下圖所示，我們還使用了樹木的裁剪貼圖，來製作有趣的陰影效果。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bf3c364b7d774eaaa94be08f943b1066><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>高質量陰影</p><p>通過進行正向渲染，HDRP為我們提供了百分比近距離柔和陰影（PCSS），它可以模擬光線照射在對象上產生的半陰影。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ea8be8d4bf97482cbb7883d0e32d7810><div class=pgc-img-handler><div class="pgc-img-button deleteImage delete-gif fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>在實時環境下，光線沒有使用光線追蹤功能，我們使用陰影貼圖來產生陰影。陰影會耗費一定的性能，而且每個光線都需要啟用陰影。</p><p>HDRP的陰影圖集系統讓我們可以使用大量能夠投射陰影的光線。在《Sherman》中，我們儘可能使用了最大的陰影圖集。雖然較大的陰影圖集能夠極大地提升畫質，但由於所含的信息更多，因此計算時間也更長，</p><p>如果陰影圖集的信息變得飽和，該系統會動態地調整陰影大小。陰影分辨率會根據光線來定義。在我們的設置中，精準光源的分辨率設為1024，而定向光分辨率設為4x2048。注意：為了表示立方體，點光源的分辨率設為6x1024，因此它們非常消耗性能。</p><p>定向光陰影可以使用級聯陰影貼圖CSM技術來優化。為了獲得最佳質量，我們需要通過使用HD Shadow Settings組件的重寫，來調整每個鏡頭的級聯陰影分佈。</p><p>我們也需要在Cinemachine的虛擬攝像機鏡頭設置中，調整近距離剪裁平面。這樣可以向前推動第一個級聯陰影，這步隨著當前鏡頭的時長增加，會顯得越來越重要。</p><p>使用體積（Volume）</p><p>在HDRP中，許多渲染和後期處理的屬性都使用帶有相關“配置文件”的體積來控制。在Unity 2019.1中，這兩類屬性被結合到相同的體積組件中，根據類別進行管理。</p><p>根據當前攝像機的位置，配置文件的數值會進行插值調整，如果攝像機不在任何體積中，那麼這些屬性會使用全局配置文件。每個體積都有優先級與權重值，配置文件的數值不能動態調整，但是優先級和權重值可以動態調整。</p><p>如下圖所示，我們使用優先級與權重值這兩個屬性來製作浣熊的觸電動畫。</p><p>光照圖層</p><p>在Unity中，我們可以將對象指定到特定光照圖層上。如下圖所示，我們手動為浣熊的眼睛加入眼神光，讓其看起來更鮮活有趣。</p><p>我們還可以使用該功能管理不合適的鏡面高光，這些鏡面高光來自本應用於補光和邊緣光的精準光源。我們通過使用該功能，避免精準光源影響水面效果。</p><p>控制直接鏡面光照</p><p>HDRP有一個非常有趣的光照功能：可以調整光線的最大柔和度（Max Smoothness），該功能可用於模擬鏡面光源特定大小的色散效果。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/cf42776a36c34d35863e46cf9596a44b><div class=pgc-img-handler><div class="pgc-img-button deleteImage delete-gif fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>我們還能夠將光照設定為影響鏡面光（Affect Specular）或影響漫反射（Affect Diffuse），並在場景內容中測試這些設置的效果。</p><p>體積光照</p><p>在場景中實現深度感時，大氣效果是我們的重要工具。HDRP高質量體積光在HDRP設置中定義，它提供了穩定可靠的解決方案，我們可以使用體積光照控制器（Volumetric Lighting Controller），來最大化效果的質量。</p><p>在《Sherman》中，為了實現最佳局部效果，我們使用了密度體積，逐個鏡頭進行放置，從而實現對這些外觀的完整控制。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/45e4f99e284f483f90ea91c2bd0a63ed><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>編輯器內顏色分級和攝像機效果</p><p>顏色分級效果在任何製片過程中都是必不可少的部分。我們可以使用該效果在Unity實現出色的結果。自從Unity 2019.1開始，後期處理效果已經完全集成到HDRP中。</p><p>下圖展示了《Sherman》使用顏色分級（Color Grading）效果的前後對比。</p><p>本文，我將以《Sherman》的工作流程為基礎進行介紹，在《Sherman》中，我們使用的是Post-Processing Stack V2。</p><p>請注意：Post-Processing Stack V2和Unity 2019.1中HDRP的Post-Processing Stack V3互不兼容。雖然有部分功能發生了改變，但基礎概念還是一樣的。</p><p>後期處理效果在體積上使用，我們可以在光照場景的主要體積上定義顏色分級、環境遮蔽、膠片顆粒和影視級動態模糊效果。這些設置可能會被部分Timeline上擁有更高優先級的體積所覆蓋。</p><p>我們也可以使用CinemachinePostProcessing擴展，為每個針對Cinemachine虛擬攝像機創建的自定義配置文件，定義所有攝像機相關效果，包括：泛光、景深和暈影。在某些情況下，因為當時Unity 2018.4還沒有預曝光處理功能，所以我們也使用了後期曝光重寫功能。</p><p>色調映射</p><p>由於整個渲染過程發生在HDR線性空間中，設定顏色輸出非常重要。《Sherman》項目一開始就決定使用ACES（學院色彩編碼系統）輸出，ACES色調映射提供高對比度的圖像，帶有非常強烈的暗色調。</p><p>為了獲得色彩鮮亮的調色板，我們需要調整伽馬值。使用這種色調映射風格的大多數遊戲也會進行同樣的調整。</p><p>軌跡球</p><p>我們的新Trackballs軌跡球工具，非常受人喜愛。對專業人員來說，軌跡球是非常熟悉的工具，它們易於操控。</p><p>下圖為顏色分級設置中的Trackballs軌跡球控制面板。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8c5c8382085d4f9183e718d1f8067fba><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>顏色分級曲線</p><p>雖然每次只能展示一條曲線，但我們可以使用許多顏色分級曲線。我們使用了Hue vs Sat、Sat vs Sat和Lum vs Sat三種曲線。</p><p>我們給主攝像機添加了Post Process Debug組件，我們可以在該組件上，啟用波形監視器和顏色直方圖。波形監視器是非常強大的工具，適合分析黑色與白色部分的適宜程度。</p><div class=pgc-img><img alt=揭祕《Sherman》：使用Unity製作影視級光照效果 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5c8ae62756c34698a1882fc82b4c92a9><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"></div><div class="pgc-img-button setImageCover fix-ios"></div><div class="pgc-img-button deleteImage fix-ios"></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p>環境遮蔽</p><p>上文已經提到過環境遮蔽，這裡我們會詳細介紹部分設置。</p><p>在《Sherman》中，Intensity光照強度被設為0.75，而在部分鏡頭中，我們會減小該值，以減少大多出現在樹葉部分的噪聲圖案。</p><p>我們沒有使用任何不基於物理的渲染（PBR）選項，例如：Color顏色或Direct Lighting Strength直接光照強度。環境遮蔽效果取決於分辨率，因此我們需要調整該效果，來適應預期的輸出分辨率。</p><p>景深效果</p><p>景深DOF不只是快速鏡頭的額外效果，它也是在敘事中轉移焦點的重要工具。圖像會快速變化，因此我們需要小心處理觀眾的注意力。</p><p>Cinemachine有非常實用的跟蹤焦點功能。新版本後期處理工具已經完全重寫，不再取決於分辨率。</p><p>在Unity 2018中，Visual Effect Graph還沒有透明度渲染隊列功能。因此在《Sherman》包含水面效果的部分鏡頭中，我們必須避免出現較淺的景深效果。</p><p>好消息是，Unity 2019.2的Visual Effect Graph加入了透明度渲染隊列功能。</p><p>暈影</p><p>暈影會模仿真實鏡頭拍攝時產生的瑕疵，呈現鏡頭畫面邊角部分的光線丟失效果。為了實現逼真的感覺，該效果應該總是偏圓形的。</p><p>請注意：暈影是非常強大的效果，但也容易被過度使用，請注意謹慎使用。</p><p>泛光</p><p>泛光是一種美觀的瑕疵效果，它是由攝像機傳感器和骯髒鏡頭漏出的強光產生的。我們可以在Unity模擬該效果，但也要記得合理使用。</p><p>結語</p><p>動畫的光照很複雜，而且難以掌控。本文，我們針對傳統光照藝術家講解了在實時渲染影片中添加光照的所有知識。希望你能夠喜歡本文，並主動嘗試文中介紹的一些技巧。</p><p>我們已經回不到過去傳統光照製作的“美好時光”了，實時動畫製作正在革新創作方法，開啟了新的可能性。由於有更多嘗試和實驗的空間，我們不必承擔相應後果，因此可以創作更多優秀的作品。</p><p>來源：Unity官方平臺</p><p>原文：https://mp.weixin.qq.com/s/1v8V722x0B1bfQE7et1tYA</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Sherman</a></li><li><a>Unity</a></li><li><a>光照</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/7de06372.html alt="Unity分享：為MR設計，Project MARS頭顯配套應用的研發和設計" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RqvEX1t8PTANYJ style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7de06372.html title="Unity分享：為MR設計，Project MARS頭顯配套應用的研發和設計">Unity分享：為MR設計，Project MARS頭顯配套應用的研發和設計</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/67b3f9dd.html alt=Unity推出業內首款智能化AR創作工具MARS class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/67b3f9dd.html title=Unity推出業內首款智能化AR創作工具MARS>Unity推出業內首款智能化AR創作工具MARS</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>