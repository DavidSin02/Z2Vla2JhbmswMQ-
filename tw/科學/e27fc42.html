<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>第三彈——鏈路層初探：來自底層的微笑中篇 | 极客快訊</title><meta property="og:title" content="第三彈——鏈路層初探：來自底層的微笑中篇 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/5b5b00034a0c276bc853"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/e27fc42.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/e27fc42.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/e27fc42.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/e27fc42.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/e27fc42.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/e27fc42.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e5%ad%b8/e27fc42.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e5%ad%b8/e27fc42.html><meta property="article:published_time" content="2020-10-29T21:03:57+08:00"><meta property="article:modified_time" content="2020-10-29T21:03:57+08:00"><meta name=Keywords content><meta name=description content="第三彈——鏈路層初探：來自底層的微笑中篇"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E5%AD%B8/e27fc42.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>第三彈——鏈路層初探：來自底層的微笑中篇</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E5%AD%B8.html>科學</a></span></div><div class=post-content><div><p>聊完以太網，再來聊聊鏈路層的其他結構。</p><p>首先是最簡單的，就是直接用一根網線直連兩臺主機，即串行線路IP（SLIP）。SLIP適用於幾乎所有計算機都有的RS-232串行端口以及調制解調器接入Internet。它是一種對於IP數據報的簡單封裝（見下圖），</p><p><img alt=第三彈——鏈路層初探：來自底層的微笑中篇 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/5b5b00034a0c276bc853></p><p class=pgc-img-caption>SLIP數據幀格式</p><p>幀格式定義如下：</p><p>1.IP數據報以END（0xc0）特殊字符起止；</p><p>2.當需要於數據報中傳輸END時，就要連續傳輸兩個指定字節（0xdb,0xdc）取代它；</p><p>3.同時0xdb是SLIP的ESC特殊字符，當需要於數據報中傳輸ESC時，就要連續傳輸兩個指定字節（0xdb,0xdd）取代它。</p><p>顯而易見，SLIP雖然簡單，但存在很大缺陷：</p><p>1.串行線路兩端需要互相知道對方IP，這點要求串行鏈路初始化時進行相關配置；</p><p>2.鏈路數據幀中不存在類型字段，這意味著每條串行線路只能專線專用；</p><p>3.鏈路數據幀中不存在檢驗和，數據的完整與安全傳輸仰賴上層協議保證。</p><p>於是針對這些缺陷，一個新協議創立——PPP：點對點協議，它很好地解決SLIP存在的缺陷：</p><p>1.對物理層而言，PPP既支持數據為8位且無奇偶校驗的異步鏈路又支持面向比特的同步鏈路；</p><p>2.提供LCP（Link Control Protocol）協議，用於各種鏈路層參數的協商；</p><p>3.提供NCP（Network Control Protocol）協議體系（如IPCP、IPXCP），用於各網絡層參數的協商，更好地向上服務網絡層協議；</p><p>4.提供認證協議CHAP（Challenge-Handshake Authentication Protocol）、PAP（Password Authentication Protocol），更好地保證網絡安全性；</p><p>5.PPP具有良好擴展性，如需要於以太網鏈路上承載PPP協議時，PPP可擴展為PPPoE；</p><p>6.無重傳機制，網絡開銷小，速度快。</p><p>PPP數據幀格式（見下圖），</p><p><img alt=第三彈——鏈路層初探：來自底層的微笑中篇 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/5b5900037ca6442375c2></p><p class=pgc-img-caption>PPP數據幀格式</p><p>Flag域標識物理幀的起止，字節值為0x7E。</p><p>Address域能夠唯一標識對端。但由於PPP協議被運用於點對點鏈路，故使用PPP協議的互連主機不必知曉對方MAC地址。此處按協議規定將該字節填充為全1的廣播地址，對PPP協議本身，該字段無實際意義。</p><p>Control域默認值為0x03，表明為無序號幀，PPP默認未採用序列號於確認應答實現可靠傳輸。Address和Control域一起標識此報文為PPP報文，即PPP報文頭為0xFF03。</p><p>Protocol域用於區分PPP數據幀中信息域所承載的數據包類型（0x0021表示IP數據報，0xc021表示LCP數據，0x8021表示NCP數據）。Protocol域內容必須依據ISO3309的地址擴展機制給出的規範。該機制規定協議域填充內容必須為奇數，即要求最低有效字節的最低有效位為1。如果當發送端發送的PPP數據幀的協議域字段不符合上述規定，接收端則會認為此數據幀是不可識別的。接收端向發送端發送一個Protocol-Reject報文，在該報文尾部將填充被拒絕報文的協議號。</p><p>Information域最大長度1500字節，包括填充域內容。Information域長度不足時，可被填充，但不是必須。如填充則需通信雙方兩端均能辨認填充信息和真正傳送的信息。當需要於Information域中傳輸標誌符號0x7e時，如果是同步鏈路，該過程由被稱為比特填充的硬件技術完成；如果是異步鏈路，則需要使用轉義字符0x7d進行字符批量替換，即當0x7d出現時，緊接著的字符第六個比特需要取其補碼（補碼及相關內容，筆者也會單獨成章）。</p><p>FCS域是一個循環冗餘檢驗碼，用於檢測數據幀錯誤。</p><p>如果讀者有興趣可自行了解LCP報文封裝格式，此處筆者不作展開。</p><p>筆者準備對PPP的建鏈過程稍作展開（當然也就意味著，這個所謂的初探會衍生出上中下三篇），PPP運行過程如下：</p><p>1.通信雙方開始建立PPP鏈路時，先進入到Establish階段。</p><p>2.Establish階段，PPP鏈路進行LCP協商。協商內容包括工作方式是SP（Single-link PPP）還是MP（Multilink PPP）、最大接收單元MRU（Maximum Receive Unit）、驗證方式和魔術字（magic number）等選項。LCP協商成功進入Opened狀態，表示底層鏈路已建立。</p><p>3.如果配置驗證，將進入Authenticate階段，開始CHAP或PAP驗證。如果無配置驗證，則直接進入Network階段。</p><p>4.Authenticate階段，如驗證失敗，進入Terminate階段，拆除鏈路，LCP狀態轉為Down。如驗證成功，進入Network階段，此時LCP狀態仍為Opened。</p><p>5.Network階段，PPP鏈路進行NCP協商。通過NCP協商選擇和配置一個網絡層協議並進行網絡層參數協商。只有相應網絡層協議協商成功後，該網絡層協議才可通過這條PPP鏈路發送報文。</p><p>6.NCP協商包括IPCP（IP Control Protocol）、MPLSCP（MPLS Control Protocol）等協商。IPCP協商內容主要包括雙方的IP地址，即通信雙方可以進行IP地址的動態協商，相較SLIP於靈活性上提升明顯。</p><p>7.NCP協商成功後，PPP鏈路將持續保持通信。PPP運行過程中，可隨時中斷連接，物理鏈路斷開、認證失敗、超時定時器時間到、管理員通過配置關閉連接等動作都能讓鏈路進入Terminate階段。</p><p>8.Terminate階段，如所有資源都被釋放，通信雙方將回到Dead階段，直到通信雙方重新開始新的PPP鏈路建立。</p><p>如下圖所示，</p><p><img alt=第三彈——鏈路層初探：來自底層的微笑中篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/5b5b000350f8202aba72></p><p class=pgc-img-caption>PPP狀態轉換示意圖</p><p>還有一點需要注意，由於串行線路速率通常較低，且會存在很多小分組，為保證交互的時延性能可被容忍，需要對首部字段進行壓縮。SLIP運用CSLIP進行壓縮，PPP也使用類似壓縮技術，其原理是當鏈路連接建立且上層協議也準備完畢，每個連接中協議的首部字段通常不會再發生變化，因此傳遞過程只需關注可能變化的字段，從而實現壓縮。</p><p>儘管PPP比SLIP進步很多，但由於歷史遺留，SLIP使用依然廣泛，不過其被取代的趨勢不可逆。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>鏈路層</a></li><li><a>自底</a></li><li><a>初探</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/09972eef.html alt="計算機網絡: 鏈路層(入門)" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e50e09971c3a4165866d14abf2df9da4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/09972eef.html title="計算機網絡: 鏈路層(入門)">計算機網絡: 鏈路層(入門)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/49c42cc2.html alt=人工智能之自然語言處理初探 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/S4bjUwAFhO20v style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/49c42cc2.html title=人工智能之自然語言處理初探>人工智能之自然語言處理初探</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/590a64ef.html alt=神祕的滿洲“薩滿”初探 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b8270cc1a3f24e16afdaac2d87271e05 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/590a64ef.html title=神祕的滿洲“薩滿”初探>神祕的滿洲“薩滿”初探</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/ef8fcf18.html alt=屈遠志：“新語言”初探 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/dfic-imagehandler/fa62eb78-8503-4899-bb73-b06e263137bb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/ef8fcf18.html title=屈遠志：“新語言”初探>屈遠志：“新語言”初探</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/7442a980.html alt=宋代道教驅邪模式與世俗政治關係初探 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/107af49bd7304accbe1720eac4967956 style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/7442a980.html title=宋代道教驅邪模式與世俗政治關係初探>宋代道教驅邪模式與世俗政治關係初探</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/377d5818.html alt=數據鏈路層和物理層一些相關解釋 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/438e00006fbdfee8aae7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/377d5818.html title=數據鏈路層和物理層一些相關解釋>數據鏈路層和物理層一些相關解釋</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/21a6ac1.html alt=春初探訪黎坪 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/35557f4d90b64111b317a9cd0b1d42c0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/21a6ac1.html title=春初探訪黎坪>春初探訪黎坪</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2c3fee9.html alt=物理層和數據鏈路層(TCP/IP協議) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/d98c425a-98a0-49f0-ad54-f72a98385f3e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2c3fee9.html title=物理層和數據鏈路層(TCP/IP協議)>物理層和數據鏈路層(TCP/IP協議)</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>