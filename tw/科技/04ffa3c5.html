<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>一文徹底理解ReentrantLock可重入鎖的使用 | 极客快訊</title><meta property="og:title" content="一文徹底理解ReentrantLock可重入鎖的使用 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/fac9edcff76544d79bff13c1d73e74a1"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/04ffa3c5.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/04ffa3c5.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/04ffa3c5.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/04ffa3c5.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/04ffa3c5.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/04ffa3c5.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/04ffa3c5.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/04ffa3c5.html><meta property="article:published_time" content="2020-11-14T20:55:07+08:00"><meta property="article:modified_time" content="2020-11-14T20:55:07+08:00"><meta name=Keywords content><meta name=description content="一文徹底理解ReentrantLock可重入鎖的使用"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/04ffa3c5.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一文徹底理解ReentrantLock可重入鎖的使用</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p class=ql-align-justify>java除了使用關鍵字synchronized外,還可以使用ReentrantLock實現獨佔鎖的功能。而且ReentrantLock相比synchronized而言功能更加豐富，使用起來更為靈活，也更適合複雜的併發場景。這篇文章主要是從使用的角度來分析一下ReentrantLock。</p><p class=ql-align-justify>一、簡介</p><p class=ql-align-justify>ReentrantLock常常對比著synchronized來分析，我們先對比著來看然後再一點一點分析。</p><p class=ql-align-justify>（1）synchronized是獨佔鎖，加鎖和解鎖的過程自動進行，易於操作，但不夠靈活。ReentrantLock也是獨佔鎖，加鎖和解鎖的過程需要手動進行，不易操作，但非常靈活。</p><p class=ql-align-justify>（2）synchronized可重入，因為加鎖和解鎖自動進行，不必擔心最後是否釋放鎖；ReentrantLock也可重入，但加鎖和解鎖需要手動進行，且次數需一樣，否則其他線程無法獲得鎖。</p><p class=ql-align-justify>（3）synchronized不可響應中斷，一個線程獲取不到鎖就一直等著；ReentrantLock可以相應中斷。</p><p class=ql-align-justify>ReentrantLock好像比synchronized關鍵字沒好太多，我們再去看看synchronized所沒有的，一個最主要的就是ReentrantLock還可以實現公平鎖機制。什麼叫公平鎖呢？也就是在鎖上等待時間最長的線程將獲得鎖的使用權。通俗的理解就是誰排隊時間最長誰先執行獲取鎖。</p><p class=ql-align-justify>字數寫的多可能大家都會煩，乾脆直接上代碼演示。</p><p class=ql-align-justify>二、使用</p><p class=ql-align-justify><strong>1、簡單使用</strong></p><p class=ql-align-justify>我們先給出一個最基礎的使用案例，也就是實現鎖的功能。</p><div class=pgc-img><img alt=一文徹底理解ReentrantLock可重入鎖的使用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fac9edcff76544d79bff13c1d73e74a1><p class=pgc-img-caption></p></div><p class=ql-align-justify>在這裡我們定義了一個ReentrantLock，然後再test方法中分別lock和unlock，運行一邊就可以實現我們的功能。這就是最簡單的功能實現，代碼很簡單。我們再看看ReentrantLock和synchronized不一樣的地方，那就是公平鎖的實現。</p><p class=ql-align-justify><strong>2、公平鎖實現</strong></p><p class=ql-align-justify>對於公平鎖的實現，就要結合著我們的可重入性質了。公平鎖的含義我們上面已經說了，就是誰等的時間最長，誰就先獲取鎖。</p><div class=pgc-img><img alt=一文徹底理解ReentrantLock可重入鎖的使用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c936657eed9947b2b443755cc21807b3><p class=pgc-img-caption></p></div><p class=ql-align-justify>首先new一個ReentrantLock的時候參數為true，表明實現公平鎖機制。在這裡我們多定義幾個線程ABCDE，然後再test方法中循環執行了兩次加鎖和解鎖的過程。</p><div class=pgc-img><img alt=一文徹底理解ReentrantLock可重入鎖的使用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7f1575b66b6349bb80eea01624131532><p class=pgc-img-caption></p></div><p class=ql-align-justify><strong>3、非公平鎖實現</strong></p><p class=ql-align-justify>非公平鎖那就隨機的獲取，誰運氣好，cpu時間片輪到哪個線程，哪個線程就能獲取鎖，和上面公平鎖的區別很簡單，就在於先new一個ReentrantLock的時候參數為false，當然我們也可以不寫，默認就是false。直接測試一下</p><div class=pgc-img><img alt=一文徹底理解ReentrantLock可重入鎖的使用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c74020ecd4444d7baf389c35401b3437><p class=pgc-img-caption></p></div><p class=ql-align-justify><strong>4、響應中斷</strong></p><p class=ql-align-justify>響應中斷就是一個線程獲取不到鎖，不會傻傻的一直等下去，ReentrantLock會給與一箇中斷迴應。在這裡我們舉一個死鎖的案例。</p><p class=ql-align-justify>首先我們定義一個測試類ReentrantLockTest3。</p><div class=pgc-img><img alt=一文徹底理解ReentrantLock可重入鎖的使用 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/603f9a034d0d4975b6bce3963b30b619><p class=pgc-img-caption></p></div><p class=ql-align-justify>在這裡我們定義了兩個鎖lock1和lock2。然後使用兩個線程thread和thread1構造死鎖場景。正常情況下，這兩個線程相互等待獲取資源而處於死循環狀態。但是我們此時thread中斷，另外一個線程就可以獲取資源，正常的執行了。</p><div class=pgc-img><img alt=一文徹底理解ReentrantLock可重入鎖的使用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7a3d2e089d5f45f2bf4839de9dc45b0b><p class=pgc-img-caption></p></div><p class=ql-align-justify>我們運行測試一下：</p><div class=pgc-img><img alt=一文徹底理解ReentrantLock可重入鎖的使用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/93fb89ebf5614f7fb35c1a6a4baf41b5><p class=pgc-img-caption></p></div><p class=ql-align-justify><strong>5、限時等待</strong></p><p class=ql-align-justify>這個是什麼意思呢？也就是通過我們的tryLock方法來實現，可以選擇傳入時間參數,表示等待指定的時間,無參則表示立即返回鎖申請的結果:true表示獲取鎖成功,false表示獲取鎖失敗。我們可以將這種方法用來解決死鎖問題。</p><p class=ql-align-justify>首先還是測試代碼，不過在這裡我們不需要再去中斷其中的線程了，我們直接看線程類是如何實現的。</p><div class=pgc-img><img alt=一文徹底理解ReentrantLock可重入鎖的使用 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/d8ffafea31724afa98a410ca528035d3><p class=pgc-img-caption></p></div><p class=ql-align-justify>​在這個案例中，一個線程獲取lock1時候第一次失敗，那就等10毫秒之後第二次獲取，就這樣一直不停的調試，一直等到獲取到相應的資源為止。</p><p class=ql-align-justify>當然，我們可以設置tryLock的超時等待時間<strong>tryLock</strong>(long timeout,TimeUnit unit)，也就是說一個線程在指定的時間內沒有獲取鎖，那就會返回false，就可以再去做其他事了。</p><p>OK，到這裡我們就把ReentrantLock常見的方法說明了，所以其原理，還是主要通過源碼來解釋。而且分析起來還需要集合AQS和CAS機制來分析。我也會在下一篇文章來分析。感謝大家的持續關注和支持。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>徹底</a></li><li><a>ReentrantLock</a></li><li><a>可重</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/71738cfb.html alt="ReentrantLock 可重入鎖這樣學，面試沒煩惱" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/171a3f887b56417fbb19b5fc26084bc9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/71738cfb.html title="ReentrantLock 可重入鎖這樣學，面試沒煩惱">ReentrantLock 可重入鎖這樣學，面試沒煩惱</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e7d3ffd2.html alt=「ReentrantLock」可重入鎖，使用場景 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3914d0316be14cb6bdc585ccb482b6a1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e7d3ffd2.html title=「ReentrantLock」可重入鎖，使用場景>「ReentrantLock」可重入鎖，使用場景</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/874a768a.html alt=可重入鎖ReentrantLock class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/af2d1fa083d64835aee2987581761467 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/874a768a.html title=可重入鎖ReentrantLock>可重入鎖ReentrantLock</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0cdba029.html alt=C++｜徹底弄清偽隨機數與隨機數 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0cdba029.html title=C++｜徹底弄清偽隨機數與隨機數>C++｜徹底弄清偽隨機數與隨機數</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d2e1ceb0.html alt="縱橫談｜徹底清除基層治理中的'灰色手段'" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d2e1ceb0.html title="縱橫談｜徹底清除基層治理中的'灰色手段'">縱橫談｜徹底清除基層治理中的'灰色手段'</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bd423c48.html alt=口罩產業鏈徹底亂了！丙烯週末瘋狂上漲，價格兩日翻倍，PP期價暴力拉昇；多廠家發緊急聲明…… class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/Rw0qyU6Ao0YcN0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bd423c48.html title=口罩產業鏈徹底亂了！丙烯週末瘋狂上漲，價格兩日翻倍，PP期價暴力拉昇；多廠家發緊急聲明……>口罩產業鏈徹底亂了！丙烯週末瘋狂上漲，價格兩日翻倍，PP期價暴力拉昇；多廠家發緊急聲明……</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4a687640.html alt=寶興縣開展“徹底清理層層加碼、堅決真切為基層減負”專項行動 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4a687640.html title=寶興縣開展“徹底清理層層加碼、堅決真切為基層減負”專項行動>寶興縣開展“徹底清理層層加碼、堅決真切為基層減負”專項行動</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6d451ce4.html alt=熔斷14次！房多多徹底撕開房產平臺暗傷 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0fa1fe78f52a407186f92787addf5ae3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6d451ce4.html title=熔斷14次！房多多徹底撕開房產平臺暗傷>熔斷14次！房多多徹底撕開房產平臺暗傷</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c78b6d52.html alt=8分鐘看完，徹底掌握Java正則表達式的十大問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/14ae145d-0620-476a-8a82-7912b192e9b5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c78b6d52.html title=8分鐘看完，徹底掌握Java正則表達式的十大問題>8分鐘看完，徹底掌握Java正則表達式的十大問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/006333f2.html alt=一篇文讓你徹底瞭解java多線程併發 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/fbdb8be32a094b448c052c5058d1d2f2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/006333f2.html title=一篇文讓你徹底瞭解java多線程併發>一篇文讓你徹底瞭解java多線程併發</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6c172832.html alt=一文徹底掌握二叉查找樹，（多組動圖）史上最全總結 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/f9d23b4550d741b8b8c0a156d712f69d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6c172832.html title=一文徹底掌握二叉查找樹，（多組動圖）史上最全總結>一文徹底掌握二叉查找樹，（多組動圖）史上最全總結</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bedd02a9.html alt=Access徹底隱藏表顯示錶 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/3b0200038f286f1db52e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bedd02a9.html title=Access徹底隱藏表顯示錶>Access徹底隱藏表顯示錶</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6c0c417f.html alt=粉絲徹底怒了，T1大樓被緊急關閉！你們不配擁有Faker class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/3522a4f2aeeb479bbc5a1b3a8580232a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6c0c417f.html title=粉絲徹底怒了，T1大樓被緊急關閉！你們不配擁有Faker>粉絲徹底怒了，T1大樓被緊急關閉！你們不配擁有Faker</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c85ab63d.html alt=依靠立法徹底解決二手菸問題？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/02cea07b-7716-45f3-b9a5-efe0f9dd9498 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c85ab63d.html title=依靠立法徹底解決二手菸問題？>依靠立法徹底解決二手菸問題？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d258b9eb.html alt="徹底凍結Android 應用後臺活動 讓他們不耗電、不聯網、不啟動" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/e4fd87bc-b2e5-40e2-841d-2e3dc5f9a2b9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d258b9eb.html title="徹底凍結Android 應用後臺活動 讓他們不耗電、不聯網、不啟動">徹底凍結Android 應用後臺活動 讓他們不耗電、不聯網、不啟動</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>