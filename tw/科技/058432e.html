<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Milvus 實戰 | Milvus 與 BERT 搭建文本搜索 | 极客快訊</title><meta property="og:title" content="Milvus 實戰 | Milvus 與 BERT 搭建文本搜索 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/a8eec11fa7fa434bb456702338ad52a0"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/058432e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/058432e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/058432e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/058432e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/058432e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/058432e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/058432e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/058432e.html><meta property="article:published_time" content="2020-10-29T20:50:15+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:15+08:00"><meta name=Keywords content><meta name=description content="Milvus 實戰 | Milvus 與 BERT 搭建文本搜索"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/058432e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Milvus 實戰 | Milvus 與 BERT 搭建文本搜索</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>Google 的 BERT 模型在 NLP 領域中具有巨大的影響力。它是一個通用的語言表示模型，可以應用於諸多領域。本文的項目是將 Milvus 與 BERT 模型結合搭建文本搜索引擎，使用 BERT 模型將文本數據轉成向量，結合 Milvus 特徵向量相似度搜索引擎可以快速搜索相似文本。</p><p><br></p><h1 class=pgc-h-arrow-right>| 關鍵技術</h1><ol start=1><li><strong></strong>Milvus</li></ol><p>Milvus 是一款開源向量相似度搜索引擎，建立在 Faiss、NMSLIB、Annoy 等向量索引庫基礎之上，具有功能強大、穩定可靠以及易於使用等特點。Milvus 集成了這些向量索引庫，對外提供了一套簡單而一致的 API 。除了提供針對向量的近實時搜索能力外，Milvus 可以對標量數據進行過濾。隨著數據和查詢規模的增加，Milvus 還提供了集群分片的解決方案，支持讀寫分離、水平擴展、動態擴容等功能，實現了對於超大數據規模的支持。</p><p><br></p><div class=pgc-img><img alt="Milvus 實戰 | Milvus 與 BERT 搭建文本搜索" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a8eec11fa7fa434bb456702338ad52a0><p class=pgc-img-caption></p></div><ol start=2><li>BERT</li></ol><p>BERT 模型是 Google 發佈的一個新的語言表達模型（Language Representation Model），全稱是 Bidirectional Encoder Representations from Transformers，即雙向編碼表徵模型。BERT 模型的優勢體現在兩方面。</p><ul><li>一方面，它使用基於特別設計的注意力機制（Attention Mechanism）的簡單全連接網絡取代了複雜的 CNN 和 RNN 網絡。不但大大減少了訓練時間，同時有效地提升了網絡性能。</li><li>另一方面，BERT 模型是第一個真正捕獲上下文語義信息的預訓練語言表示模型。這是因為 BERT 模型使用了 Transformer 作為算法的主要框架，而 Transformer 框架能更徹底地捕捉語句中的雙向關係。</li></ul><div class=pgc-img><img alt="Milvus 實戰 | Milvus 與 BERT 搭建文本搜索" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ed2c33785d8c487dbf068e588428bfcc><p class=pgc-img-caption></p></div><p>Google 提供了一些預先訓練的模型，其中最基本的兩個模型是BERT-base 模型和 BERT-large 模型。具體參數如下表所示：</p><div class=pgc-img><img alt="Milvus 實戰 | Milvus 與 BERT 搭建文本搜索" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/af8e8d4d86be4b8d8d889ef1ef92b26c><p class=pgc-img-caption></p></div><p>BERT-base 模型和 BERT-large 模型的參數總量大小和網絡層數不同，BERT-large 模型所佔計算機內存較多，所以本文項目選用 BERT-base 模型對文本數據進行向量轉化。（注：其中，層數（即 Transformer 塊個數）表示為 L，隱藏尺寸表示為 H ，自注意力頭數表示為 A 。）</p><p><br></p><h1 class=pgc-h-arrow-right>數據來源</h1><p>本項目所需的新聞數據集包含兩個部分：一個標題集，一個文本集。文本集與標題集是一一對應的，存在 data 目錄下（data 目錄下面的數據是經過預處理的）。數據集來源於和鯨社區的中文新聞數據集 （注1），有將近 14w 條數據。</p><p><br></p><h1 class=pgc-h-arrow-right>整體架構</h1><p>本文的文本搜索引擎項目使用的 Milvus 整體架構如圖所示：</p><div class=pgc-img><img alt="Milvus 實戰 | Milvus 與 BERT 搭建文本搜索" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/753303063c7a470fab690cd7852e12bb><p class=pgc-img-caption>深藍色線為數據導入過程，橘黃色線為用戶查詢過程</p></div><ol start=1><li>首先，本文項目使用開源的 bert-as-service ，使用 BERT 做為句子編碼器，將新聞標題數據轉化為固定長度為 728 維的特徵向量，並導入 Milvus 庫。</li><li>然後，對存入 Milvus 庫中的特徵向量進行存儲並建立索引，同時 Milvus 會給這些特徵向量分配一個 ID，將 ID 和對應的新聞標題和文本存儲在 PostgreSQL 中。</li><li>最後，用戶輸入一個新聞標題，BERT 將其轉成特徵向量。Milvus 對特徵向量進行相似度檢索，得到相似的新聞標題的 ID ，在 PostgreSQL 中找出 ID 對應的新聞標題和文本返回。在後續界面展示中可以看到新聞文本搜索的一個例子。</li></ol><p><br></p><h1 class=pgc-h-arrow-right>實現步驟</h1><p>下面我們來看一下 BERT 模型與 Milvus 搭建的文本搜索引擎實現的關鍵步驟。詳細步驟可參考 GitHub 項目（注2）。</p><p><br></p><p><strong>1. 安裝 Milvus</strong></p><p>Milvus 提供兩個發行版本：CPU 版本和 GPU 版本。為了得到更優的查詢性能，項目中使用的是 GPU 版本。具體安裝方法參考 <u>Milvus 文檔</u>。</p><p><br></p><p><strong>2. 安裝 PostgreSQL</strong></p><p>PostgreSQL 是一個強大的、開源的對象關係數據庫系統。PostgreSQL 在可靠性、穩定性、數據一致性等性能方面表現不錯。具體安裝方法參考<u>PostgreSQL 官網</u>。</p><p><br></p><p><strong>3. 安裝 bert-as-service</strong></p><p>使用 bert-as-service 將標題集轉化為特徵向量，以便 Milvus 後續進行相似度檢索。更多安裝細節可參考 bert-as-service 的 Github 存儲庫（注3）。</p><pre><code>#下載模型$ wget https://storage.googleapis.com/BERT_models/2018_11_03/chinese_L-12_H-768_A-12.zip#啟動服務$ BERT-serving-start -model_dir chinese_L-12_H-768_A-12/ -num_worker=12 -max_seq_len=40</code></pre><p><br></p><p><strong>4. 數據導入</strong></p><p>在項目中的 Milvus-bert-server 文件的 main.py 文本數據導入腳本。用戶只需要修改腳本中的標題集路徑和文本集路徑，即可運行腳本進行文本數據導入。</p><pre><code>python main.py --collection test11 --title data/title.txt --version data/version.txt --load</code></pre><p><br></p><p><strong>5. 啟動查詢服務</strong></p><p>在項目中啟動查詢服務，然後在瀏覽器中進行文本搜索，得到最終的文本搜索結果。</p><pre><code>python app.py</code></pre><p><br></p><h1 class=pgc-h-arrow-right>| 界面展示</h1><p>打開 <em>http://127.0.0.1:3001/search</em>，下面是一個文本搜索的例子。首先進入搜索頁面，輸入“中國股市”，點擊 Search 進行搜索。</p><div class=pgc-img><img alt="Milvus 實戰 | Milvus 與 BERT 搭建文本搜索" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9da69123041e47ddb7b2ebc17d8bb28a><p class=pgc-img-caption></p></div><p>可以得到與“中國股市”相關的新聞文本。比如圖中所示的文本“中國股市吸引外資......”等。</p><div class=pgc-img><img alt="Milvus 實戰 | Milvus 與 BERT 搭建文本搜索" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/332392a592aa4e72b2cead02c4054b4d><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>| 總結展望</strong></h1><p>在 AI 高速發展的時代，我們可以使用深度學習模型去處理各種類型的非結構化數據，例如圖片、文本、視頻和語音等。本文項目通過 BERT 模型可以將這些非結構化數據提取為特徵向量，然後通過 Milvus 對這些特徵向量進行計算，實現對非結構化數據的分析與檢索。</p><p>本文利用 Milvus 搭建的文本搜索引擎也只是其中一個場景，展示了 Milvus 在非結構化數據處理中的應用。歡迎大家導入自己的數據建立自己的文本搜索引擎。Milvus 向量相似度檢索引擎可以兼容各種深度學習平臺，搜索十億向量僅需毫秒響應時間。你可以使用 Milvus 探索更多 AI 用法！我們還提供了其他應用場景以供參考，詳見 Milvus 應用場景（注4）。</p><p><br></p><h1 class=pgc-h-arrow-right>參考資料：</h1><ul><li>和鯨社區的中文新聞數據集：https://www.kesci.com/home/dataset/5d8878638499bc002c1148f7/files</li></ul><ul><li>GitHub 項目：https://github.com/milvus-io/bootcamp/blob/0.10.0/solutions/Textsys/README.md</li></ul><ul><li>bert-as-service：https://github.com/hanxiao/BERT-as-service</li></ul><ul><li>Milvus 應用場景：https://milvus.io/cn/scenarios/</li></ul></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Milvus</a></li><li><a>實戰</a></li><li><a>BERT</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/cfc7290d.html alt=OpenCV項目實戰---人臉檢測 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f267e46946554437b5ffe48234f3b78d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cfc7290d.html title=OpenCV項目實戰---人臉檢測>OpenCV項目實戰---人臉檢測</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fcc2ad9e.html alt=音頻編碼實戰 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/aacf5cab-b987-443f-815e-236f984fb2d0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fcc2ad9e.html title=音頻編碼實戰>音頻編碼實戰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/02729303.html alt=java實戰項目常用類，Date、Calendar、BigDecimal、Math、UUID class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d69c7c9d8b85444da9360e334ba6555d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/02729303.html title=java實戰項目常用類，Date、Calendar、BigDecimal、Math、UUID>java實戰項目常用類，Date、Calendar、BigDecimal、Math、UUID</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/73ba27bb.html alt=老股民總結的賣出技巧實戰圖解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/7575000bb7b8e57fa260 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/73ba27bb.html title=老股民總結的賣出技巧實戰圖解>老股民總結的賣出技巧實戰圖解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/22408815.html alt=股票交易指南：實戰圖解經典的賣出技巧 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15305260751844061be70e0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/22408815.html title=股票交易指南：實戰圖解經典的賣出技巧>股票交易指南：實戰圖解經典的賣出技巧</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eaa95354.html alt=股票賣出實戰技術圖解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/88520001219b9b7dabd2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eaa95354.html title=股票賣出實戰技術圖解>股票賣出實戰技術圖解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/feeaba4f.html alt="在線報表設計實戰系列 – ②製作表格類報表" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/47190002d9db05c4adc2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/feeaba4f.html title="在線報表設計實戰系列 – ②製作表格類報表">在線報表設計實戰系列 – ②製作表格類報表</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d288ac1b.html alt=打通實戰保障鏈路“最後一公里” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d288ac1b.html title=打通實戰保障鏈路“最後一公里”>打通實戰保障鏈路“最後一公里”</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/79ca353a.html alt=「案例實戰」案例解析（24）自噴系統 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/c8b46117-9cc6-4c33-be2f-ca4e35b8431f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/79ca353a.html title=「案例實戰」案例解析（24）自噴系統>「案例實戰」案例解析（24）自噴系統</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/db5ee11c.html alt=「案例實戰」案例解析（39）自噴系統 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/db5ee11c.html title=「案例實戰」案例解析（39）自噴系統>「案例實戰」案例解析（39）自噴系統</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c3d6e4c9.html alt=Java項目實戰第10天：分頁欄的實現 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/000f44dadac946188c05567c6741ae3c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c3d6e4c9.html title=Java項目實戰第10天：分頁欄的實現>Java項目實戰第10天：分頁欄的實現</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/20b12ef6.html alt=Java項目實戰第7天：導航欄業務的實現 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5ed388098e304e21872e291ae4eebf6f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/20b12ef6.html title=Java項目實戰第7天：導航欄業務的實現>Java項目實戰第7天：導航欄業務的實現</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4110ca16.html alt=股市真正厲害的實戰操盤手：“尾盤30分鐘”是股市全天的最黃金時刻，讀懂本文等於讀懂中國股市 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RbYtVhS9wGTmMO style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4110ca16.html title=股市真正厲害的實戰操盤手：“尾盤30分鐘”是股市全天的最黃金時刻，讀懂本文等於讀懂中國股市>股市真正厲害的實戰操盤手：“尾盤30分鐘”是股市全天的最黃金時刻，讀懂本文等於讀懂中國股市</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/63d702d9.html alt=實戰：快速製作晶格化界面 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f6d9a49e175845eeb3f1cf0891713c6f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/63d702d9.html title=實戰：快速製作晶格化界面>實戰：快速製作晶格化界面</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c3c2cbf1.html alt=三、彙編初步實戰 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c3c2cbf1.html title=三、彙編初步實戰>三、彙編初步實戰</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>