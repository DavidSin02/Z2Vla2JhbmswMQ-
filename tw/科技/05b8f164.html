<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Python中的多進程 | 极客快訊</title><meta property="og:title" content="Python中的多進程 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/49dd44b999924b69bd3396709ecacaf4"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05b8f164.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05b8f164.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/05b8f164.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05b8f164.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05b8f164.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/05b8f164.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/05b8f164.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05b8f164.html><meta property="article:published_time" content="2020-11-14T21:06:37+08:00"><meta property="article:modified_time" content="2020-11-14T21:06:37+08:00"><meta name=Keywords content><meta name=description content="Python中的多進程"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/05b8f164.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Python中的多進程</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>回顧</h1><p>在Python進階記錄之基礎篇（二十二）中，我們介紹了Python中對文本文件和二進制文件的簡單操作，需要重點掌握文件的各種打開方式，以及簡單的讀寫操作。今天我們講一下Python中的多進程。</p><h1>進程的基本概念</h1><p>進程就是操作系統中執行的一個程序，操作系統以進程為單位分配存儲空間，每個進程都有自己的地址空間、數據棧以及其他用於跟蹤進程執行的輔助數據，操作系統管理所有進程的執行，為它們合理的分配資源。</p><p>進程可以通過fork或spawn的方式來創建新的進程來執行其他的任務，不過新的進程也有自己獨立的內存空間，因此必須通過進程間通信機制來實現數據共享，具體的方式包括管道、信號、套接字、共享內存區等。</p><p>我們先來看這樣一個例子：假設現在我們需要下載兩個文件（具體怎麼下載暫時先忽略）。按照我們之前掌握的知識點，就是一個一個地逐一下載。</p><div class=pgc-img><img alt=Python中的多進程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/49dd44b999924b69bd3396709ecacaf4><p class=pgc-img-caption>逐一下載</p></div><p>上述代碼中，我們將兩個文件按順序進行下載，為了模擬真實下載場景，我們設置相應的下載時間。可以看到，如果按順序逐一下載，需要先等待一個文件下載完成後才能開始下一個文件的下載，整個過程下來需要耗費兩個下載任務時間的總和，即9秒左右。</p><p>但是我們知道，這是兩個毫不相關的下載任務，像這樣逐一下載顯然效率太低了。因此，就出現了併發編程的概念，而多進程就是Python實現併發編程的三種方式之一。</p><h1>Python中多進程的創建方式</h1><p>Python為我們提供了兩種方式來實現多進程：系統的fork( )函數和multiprocessing</p><p>模塊。其中multiprocessing模塊是我們使用多進程的主要方式。</p><ul><li>系統的fork( )函數</li></ul><p>Unix和Linux操作系統提供了fork( )系統調用來創建進程，調用fork( )函數的是父進程，創建出的是子進程，子進程就是父進程的一個拷貝，但是子進程擁有自己的PID（進程標識）。</p><p>fork( )函數非常特殊，它會返回兩次，父進程中可以通過fork( )函數的返回值得到子進程的PID，而子進程中的返回值永遠都是0。</p><p>因此，在Unix和Linux操作系統中，Python的os模塊也擁有fork( )函數。</p><div class=pgc-img><img alt=Python中的多進程 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a7a5b5f0b116442bbdffadce98955cb5><p class=pgc-img-caption>fork( )創建子進程</p></div><p>fork( )函數可以創建子進程，通過子進程實現多進程。可以看到，通過創建子進程，耗時從原來的9秒左右縮短到5秒左右。</p><ul><li>multiprocessing模塊</li></ul><p>由於Windows系統中沒有fork調用，因此我們在Windows系統中使用os.fork( )是無法運行的。</p><p>為了實現跨平臺的多進程編程，Python為我們提供了multiprocessing模塊。該模塊中的Process類可以創建子進程，而且該模塊還提供了更高級的封裝，例如批量啟動進程的進程池、用於進程間通信的隊列和管道等。</p><p>因此，在Python的實際開發過程中，我們更多地是使用multiprocessing模塊來實現多進程。</p><div class=pgc-img><img alt=Python中的多進程 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e80670e248384885afb4cc7b84e701e1><p class=pgc-img-caption>Process類創建進程</p></div><p>上述代碼中，我們通過multiprocessing模塊的Process類創建了進程對象，target參數表示目標函數，即進程啟動後要執行的代碼，args參數是目標函數所需要的參數，用一個元組接收。Process的start( )方法用於啟動進程，而join( )方法表示等待進程執行結束再繼續往下運行。</p><p>我們運行上述代碼，可以發現兩個下載任務一起執行，從而大大縮短了程序的執行時間。並且與fork( )函數相比，這種方式更加清晰。</p><h1>進程池Pool</h1><p>當下載文件增多，需要大量子進程時，我們也可以使用multiprocessing模塊中的進程池Pool。假設現在有5個文件待下載，我們通過進程池Pool來實現併發下載。</p><div class=pgc-img><img alt=Python中的多進程 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ed43dd7784dd439eb184fa264f0f7719><p class=pgc-img-caption>進程池Pool</p></div><p>上述代碼中，我們創建了一個Pool對象，然後通過循環調用apply_async( )方法來創建進程。創建結束調用close( )方法，調用此方法後進程池就不能繼續添加新的進程了。最後調用join( )方法等待所有子進程執行完畢。</p><p>從運行結果我們看到，程序並沒有像我們預計地5個文件一起下載，而是先下載其中四個，直到四個中有一個下載完成才開始第5個。這是因為Pool線程池是有默認大小的，在我電腦上默認就是4，因此，最多同時執行4個進程。</p><p>如果你想同時執行5個，需要在創建Pool對象時傳入一個5即可，p = Pool(5)。</p><h1>進程間的通信</h1><p>進程與進程之間有時也需要通信，在介紹進程的基本概念中我們提到，操作系統提供了很多機制來實現進程間的通信。Python的multiprocessing模塊也包裝了操作系統底層的機制，提供了對列（Queue）、管道（Pipes）等多種方式來實現數據共享。</p><p>下面我們以對列Queue為例，首先創建兩個子進程，其中，一個往對列中寫數據，一個從對列中讀數據。</p><div class=pgc-img><img alt=Python中的多進程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/85087df80efb443f991a5cb31e8b4fe1><p class=pgc-img-caption>進程間的通信</p></div><p>上述代碼中，我們首先創建對列對象，然後創建兩個進程分別用於數據的讀和寫。通過對列的put/get方法實現了兩個進程之間的數據共享。</p><h1>總結</h1><p>以上內容介紹了進程的基本概念以及Python中多進程的使用方法，需要重點理解進程的概念。熟練掌握多進程的創建方法和各種基本操作。感謝大家的支持與關注，歡迎一起學習交流~</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Python</a></li><li><a>進程</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/91eece92.html alt="只需 45 秒，Python 給故宮畫一組手繪圖！" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/df1bd890ffee4a439e9f5142ae42c102 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/91eece92.html title="只需 45 秒，Python 給故宮畫一組手繪圖！">只需 45 秒，Python 給故宮畫一組手繪圖！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8aab963e.html alt=Python手繪圖瞭解一下！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/746c9e6e214b48b2a0215fc9e151cdc8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8aab963e.html title=Python手繪圖瞭解一下！>Python手繪圖瞭解一下！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cfd854c6.html alt=故宮下雪了！我用Python給它畫了一組手繪圖，僅用45秒（附代碼） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/774d2f0a372f48c589ec84dd3a164dd9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cfd854c6.html title=故宮下雪了！我用Python給它畫了一組手繪圖，僅用45秒（附代碼）>故宮下雪了！我用Python給它畫了一組手繪圖，僅用45秒（附代碼）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b3994691.html alt=世界發展進程中的耀眼篇章 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RCLmM9dF1KnwoT style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b3994691.html title=世界發展進程中的耀眼篇章>世界發展進程中的耀眼篇章</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b433c17e.html alt="四十、Python模塊random: 偽隨機數據生成與隨機元素抽取" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/25f231d6-c1ce-4cf8-8988-5da509a0c26a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b433c17e.html title="四十、Python模塊random: 偽隨機數據生成與隨機元素抽取">四十、Python模塊random: 偽隨機數據生成與隨機元素抽取</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/04486eba.html alt=Python爬蟲使用selenium爬取群成員信息（全自動實現自動登陸） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/e11e69f643584941aaa2b71ee6ed3d7f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/04486eba.html title=Python爬蟲使用selenium爬取群成員信息（全自動實現自動登陸）>Python爬蟲使用selenium爬取群成員信息（全自動實現自動登陸）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/86b46e6d.html alt=Python爬蟲教程，利用Python採集QQ群成員信息 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6d6cce76ad48405c9dbb960d4617bcef style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/86b46e6d.html title=Python爬蟲教程，利用Python採集QQ群成員信息>Python爬蟲教程，利用Python採集QQ群成員信息</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7739dc7a.html alt=Python數據可視化Matplotlib，如何在一副圖像中顯示多組柱形圖？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/5d4a0000046e1bea8b90 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7739dc7a.html title=Python數據可視化Matplotlib，如何在一副圖像中顯示多組柱形圖？>Python數據可視化Matplotlib，如何在一副圖像中顯示多組柱形圖？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/09d5d35b.html alt=加速年輕化進程，脈動宣佈吳亦凡為品牌全球代言人 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/09d5d35b.html title=加速年輕化進程，脈動宣佈吳亦凡為品牌全球代言人>加速年輕化進程，脈動宣佈吳亦凡為品牌全球代言人</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eb1cbd4a.html alt=Java併發編程：進程和線程之由來 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/4f658919-1d85-46bc-bbf1-64aac52f4c80 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eb1cbd4a.html title=Java併發編程：進程和線程之由來>Java併發編程：進程和線程之由來</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dad48786.html alt=Linux併發服務器模型一、多進程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dad48786.html title=Linux併發服務器模型一、多進程>Linux併發服務器模型一、多進程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/77f5407e.html alt="PHP 線程，進程和併發" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7a700a857098411d884a928d6b5f5e01 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/77f5407e.html title="PHP 線程，進程和併發">PHP 線程，進程和併發</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b7ce9ac1.html alt=java併發編程之進程狀態 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/0779ab7cadfe428f8d74d66161aa48b4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b7ce9ac1.html title=java併發編程之進程狀態>java併發編程之進程狀態</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d62f6365.html alt=java併發編程之進程與線程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a1b777a6b4c24fc390776034329c92d2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d62f6365.html title=java併發編程之進程與線程>java併發編程之進程與線程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fa5f4d06.html alt="linux fork多進程併發服務器模型之C/C++代碼實戰" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/5794b6eba487410ebcd6838aac6772fc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fa5f4d06.html title="linux fork多進程併發服務器模型之C/C++代碼實戰">linux fork多進程併發服務器模型之C/C++代碼實戰</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>