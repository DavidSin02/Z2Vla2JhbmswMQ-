<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>圖片處理命令行工具ImageMagick介紹 | 极客快訊</title><meta property="og:title" content="圖片處理命令行工具ImageMagick介紹 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/c35de0098713435083009e05a5a29d57"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05f64af1.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05f64af1.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/05f64af1.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05f64af1.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05f64af1.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/05f64af1.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/05f64af1.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/05f64af1.html><meta property="article:published_time" content="2020-11-14T21:03:07+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:07+08:00"><meta name=Keywords content><meta name=description content="圖片處理命令行工具ImageMagick介紹"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/05f64af1.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>圖片處理命令行工具ImageMagick介紹</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>最近在做百度OCR圖片文字識別時，因為免費版OCR接口調用次數有限，就想把多張圖片合併成一張進行文字識別。這就需要在代碼中進行圖片合併操作，在查找圖片批量合併方案時，看到了linux的convert命令，可以將多張圖片合併，且使用特別方便，記錄一下convert是如何使用的。</p><p>convert命令屬於ImageMagick工具包，具有圖片創建、編輯，轉換圖像格式，以及調整圖像大小、模糊、裁切、除去雜點、抖動 、繪圖、翻轉、合併、重新採樣等功能。</p><p>要想使用covert命令，首先要安裝ImageMagick包。</p><p><strong>ImageMagick包介紹</strong></p><p>ImageMagick是一款創建、編輯、合成，轉換圖像的命令行工具，支持格式超過 200 種，包括常見的 PNG, JPEG, GIF, HEIC, TIFF, DPX, EXR, WebP, Postscript, PDF, SVG 等。功能包括調整大小，翻轉，鏡像，旋轉，扭曲，修剪和變換圖像，調整圖像顏色，應用各種特殊效果，或繪製文本，線條，多邊形，橢圓和貝塞爾曲線等。對於圖片的處理，ImageMagick基本可以實現任何常用操作。</p><p>官網：https://imagemagick.org/</p><p>中文鏡像站： http://www.imagemagick.com.cn/index.html</p><p><strong>安裝</strong></p><p>ImageMagick支持Linux, Windows, Mac OS X, iOS, Android OS 等平臺。</p><p>安裝參考文檔地址：https://www.imagemagick.org/script/download.php</p><p>我以mac為例，安裝方式如下：</p><pre><code>brew install imagemagick</code></pre><p>安裝ImageMagick工具包後，即可使用其工具命令。</p><p><strong>基本命令</strong></p><p>ImageMagick 包括一組命令行工具來操作圖片，安裝好 ImageMagick 後，終端就可以使用如下命令了。</p><p>magick: 創建、編輯圖像，轉換圖像格式，以及調整圖像大小、模糊、裁切、除去雜點、抖動 ( dither )、繪圖、 翻轉、合併、重新採樣等。</p><p>convert: 等同於 magick 命令。</p><p>identify: 輸出一個或多個圖像文件的格式和特徵信息，如分辨率、大小、尺寸、色彩空間等。</p><p>mogrify: 與 magick 功能一樣，不過不需要指定輸出文件，自動覆蓋原始圖像文件。</p><p>composite: 將一個圖片或多個圖片組合成新圖片。</p><p>montage: 組合多個獨立的圖像來創建合成圖像。每個圖像都可以用邊框，透明度等特性進行裝飾。</p><p>compare: 從數學和視覺角度比較源圖像與重建圖像之間的差異。</p><p>display: 在任何 X server 上顯示一個圖像或圖像序列。</p><p>animate: 在任何 X server 上顯示圖像序列。</p><p>import: 保存 X server 上的任何可見窗口並把它作為圖像文件輸出。可以捕捉單個窗口，整個屏幕或屏幕的任意 矩形部分。</p><p>conjure: 解釋並執行 MSL ( Magick Scripting Language ) 寫的腳本。</p><p>stream: 一個輕量級工具，用於將圖像或部分圖像的一個或多個像素組件流式傳輸到存儲設備。在處理大圖像或 原始像素組件時很有用。</p><p>各個命令具體介紹，參考地址：https://imagemagick.org/script/command-line-tools.php</p><p><strong>命令使用格式</strong></p><p>基本命令的使用，遵循 Unix 風格的標準格式：</p><pre><code>command [options] input_image output_image</code></pre><p>比如我們將一張寬高 300x300 的圖片 goods.png 轉換成 200x200 的goods.jpg，可以這樣用</p><pre><code>convert -resize 200x200 goods.png goods.jpg</code></pre><p>-resize 定義圖片尺寸，ImageMagick 所有的選項參數都在這個【】。</p><p><strong>圖片合併實例</strong></p><p>接下來介紹我在OCR文字識別中將多張圖片合併一張方法，代碼合併使用convert命令，如我有圖片1.jpg、2.jpg、3.jpg，我想將這三張圖片合併成1張並命名為a.jpg,命令如下：</p><pre><code>convert -append 1.jpg 2.jpg 3.jpg a.jpg</code></pre><p>Python代碼：</p><pre><code>import osimgDir = ''pathDir = sorted(filter(is_img, os.listdir(imgDir))) # 通過拼接convert命令，進行圖片合併tmp = 0shell = 'convert -append 'for imgName in pathDir:	tmp = tmp + 1    # 每20張圖片合併成一張	if tmp % 20 == 0:         # 將合併後圖片放到圖片目錄下的convert_img子目錄		shell = shell + ' ' + imgDir + 'convert_img/' + imgName        # 執行convert命令		os.system(shell)		shell = 'convert -append '	shell = shell + imgDir + imgName + ' '# 圖片遍歷完成後將最後的圖片合併shell = shell + ' ' + imgDir + 'convert_img/' + imgNameos.system(shell)</code></pre><p>使用上面方法就可以將多張圖片合併成1張，再去識別這一張圖片就可以省很多借口調用量了。但要注意若合併的圖片太多，會導致識別失敗；要根據原圖片情況選擇合適的圖片合併量；若原圖片只有固定的一部分有文字，還可以先把圖片上有文字的部分裁剪下來再合併。</p><p>對於ImageMagick，不光可以用執行系統命令的形式，各常用語言都有封裝好的包，可以直接使用。</p><p>各語言包參考地址：https://imagemagick.org/script/develop.php</p><p><strong>其他實際案例</strong></p><p><strong>1、生成縮略圖和裁剪圖片</strong></p><p>需求：將一張寬高為 900x600 的圖片 goods.jpg 生成寬高為 150x100 的縮略圖 thumbnail.jpg</p><pre><code>convert -resize 150x100 -quality 70 -strip goods.jpg thumbnail.jpg</code></pre><p>解釋：</p><p>· -resize 150x100：定義輸出的縮略圖尺寸為 150x100。</p><p>· -quality 70：降低縮略圖的質量為 70，取值範圍 1 ( 最低圖像質量和最高壓縮率 ) 到 100 ( 最高圖像質量和最低壓縮率 )，默認值根據輸出格式有 75、92、100，選項適用於 JPEG / MIFF / PNG。</p><p>· -strip：讓縮略圖移除圖片內嵌的所有配置文件，註釋等信息，以減小文件大小。</p><p>-resize 延伸解讀，如下。</p><p>上面的例子中，輸入的圖片和輸出的圖片比例是一致的，所以不會有特殊情況出現，但是遇到比例不同的時候，上面的寫法並不會得到 150x100 的圖像，而是會根據圖像的寬高比例，取最大值，得出來的結果可能是 150 寬和更小的高，或者 100 高和更小的寬；所以 IamgeMagick 提供了幾種符號來定義縮放。</p><pre><code>convert -resize '150x100!' goods.jpg thumbnail.jpgconvert -resize '150x100&gt;' goods.jpg thumbnail.jpgconvert -resize '150x100&lt;' goods.jpg thumbnail.jpg</code></pre><p>!：不管圖片寬高如何，都縮放成 150x100 這樣的尺寸。</p><p>>：只有寬高均大於 150x100 的圖片才縮放成該尺寸 ( 按比例取最大值 )，小於的圖片不做處理。</p><p>&lt;：與 > 功能相反。</p><p>提示：因為有些字符是 Linux shell 或其他系統的特殊字符，所以需要用引號包裹起來或者用反斜線 \ 轉義，另外，不同平臺可能引號都是有差異的。</p><p><strong>自定義裁剪圖片：</strong></p><pre><code>convert -crop MxN+a+b src.jpg dst.jpg</code></pre><p>從原始圖片中剪切出 M x N 尺寸（寬為M，高為N）的圖片，+a+b 表示以左上角為座標原點，向右和下方向分別為X軸Y軸的點 (a,b) 位置開始。你也可以使用 -a-b 以右下角為座標原點，左和上為XY軸的座標系。</p><p><strong>2、添加水印</strong></p><p>需求 ① ：給圖片居中加上透明文本水印。</p><pre><code>convert -draw 'text 0,0 "JD.COM"' -fill 'rgba(221, 34, 17, 0.25)' -pointsize 36 \-font 'cochin.ttc' -gravity center joy.jpg watermark.jpg</code></pre><p>解釋：</p><p>· -draw：繪圖選項，text 聲明繪製文本， 0,0 聲明文本距離圖片左上角的偏移值， JD.COM 聲明繪製的文本，最好用引號包裹起來，避免輸入特殊字符引起錯誤。繪製文本的格式為 text x,y string，當然還可以繪製其他類型，諸如圓 ( circle )、折線 ( polyline )。</p><p>· -fill：對文本填充顏色，貌似 ImageMagick 命令中前面的選項是用來控制後面的選項的，所以應該把這樣的修飾選項放到 -draw 前面比較好，很重要，後面的案例就是這樣的。</p><p>· -pointsize：指定文本的字體大小。</p><p>· -font：指定字體。</p><p>· -gravity：設置文本在圖片裡的排列方式 ( 類似 CSS 裡的 align-items + justify-content )，center 表示水平垂直都居中，其他值還可以是：NorthWest, North, NorthEast, West, East, SouthWest, South, SouthEast，不記大小寫。</p><p>· \：反斜線也是類 Unix 系統的續行字符，當一個命令很長時，我們可以把它寫成多行，以便視覺上的美觀和直觀。</p><p>需求 ② ：給圖片加上傾斜平鋪透明文本水印。</p><pre><code>convert -size 100x100 xc:none \-fill '#d90f02' -pointsize 18 -font 'cochin.ttc' \-gravity center -draw 'rotate -45 text 0,0 "JD.COM"' \-resize 60% miff:- | composite -tile -dissolve 25 - joy.jpg watermark.jpg</code></pre><p>解釋：文本平鋪水印其實是將文本畫成一張 png 圖片，然後用這張透明圖片在目標圖片上進行平鋪。</p><p>· -size：設置畫布的大小。</p><p>· xc:：全稱 X Constant Image，是 canvas: 的別名，定義一張畫布，用來繪圖，常用格式為 xc:color，none 或者 transparent 設置畫布為透明底，默認為白色。</p><p>· -resize：該選項還可以指定百分比，意為縮放至原圖像的百分之幾。貌似 -pointsize 小於 14 後，-draw 裡的 rotate 會不生效，所以用 -resize 來把平鋪圖案變得更小。</p><p>· miff:-：</p><p>· miff: 聲明輸出 ImageMagick ( IM ) 自己的圖像文件格式：，主要用途是以複雜的方式處理圖像時當做中間保存格式，適用於從一個 IM 命令向另一個 IM 命令傳遞圖像元數據和其他關聯屬性。</p><p>· - 在管道符前面意為將 IM 命令執行的結果作為標準輸出，在管道符後面則表示從標準輸入中讀取這個數據，如在管道符後面的 composite 中使用 - 讀取剛剛生成的透明圖像。</p><p>· |：Linux shell 管道符，用於將上一個命令的標準輸出傳遞到下一個命令作為標準輸入。這裡將生成的水印圖案傳遞給 composite 命令。</p><p>· -tile：顧名思義，讓圖案平鋪。</p><p>· -dissolve：設置平鋪圖案的透明度。</p><p>圖釋：</p><div class=pgc-img><img alt=圖片處理命令行工具ImageMagick介紹 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c35de0098713435083009e05a5a29d57><p class=pgc-img-caption></p></div><p><strong>3、繪製驗證碼</strong></p><p>大概邏輯如下：</p><p>1. 隨機生成 4 個英文字母或數字。</p><p>2. 創建一個寬高 100x40 的畫布。</p><p>3. 設置字體大小為 16，每個字符的寬高也就是 16 左右了，依次計算出每個字符的 x, y 座標，再增加一丁點旋轉。</p><p>4. 隨機創建一條透明曲線，加上噪點，增加圖片被破解的難度（在保證肉眼能看得清楚的用戶體驗下）。</p><p>5. 如果需要安全性更高的驗證碼，請了解驗證碼破解原理並做合理調整。</p><p>如果加上隨機計算，可能代碼會比較多，所以這裡寫成固定值，方便理解。</p><pre><code>convert 'xc:[100x40!]' -pointsize 20 -font 'cochin.ttc' \-gravity NorthWest -strokewidth 1 \-fill '#b72b36' -stroke '#b72b36' -draw 'translate 13,19 rotate 10 text -5,-8 "5"' \-fill '#821d70' -stroke '#821d70' -draw 'translate 36,13 rotate -8 text -8,-8 "C"' \-fill '#c7960a' -stroke '#c7960a' -draw 'translate 60,23 rotate 5 text -5,-8 "2"' \-fill '#03610a' -stroke '#03610a' -draw 'translate 85,25 rotate 13 text -8,-8 "E"' \-strokewidth 2 -stroke 'rgba(248, 100, 30, 0.5)' -fill 'rgba(0, 0, 0, 0)' \-draw 'bezier -20,30 -16,10 20,2 50,20' \-draw 'bezier 50,20 78,42 138,36 140,16' \+noise Impulse \captcha.jpg</code></pre><p>結果：</p><div class=pgc-img><img alt=圖片處理命令行工具ImageMagick介紹 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4fa88f77c3104281a3f048af02b2ba63><p class=pgc-img-caption></p></div><p>鑑於字體比較細，可以用 strokewidth 加邊框來加粗，或者使用字體的粗體版本，這裡使用了第一種方式。</p><p>解釋：</p><p>· xc:[100x40!]：設置畫布大小的一種簡寫方式，方括號裡寫入畫布寬高，注意要加 !，否則會出乎意料喲。</p><p>· 文本定位與旋轉</p><p>1. 畫布寬 100px，平均分成 4 分，每份 25px, 文字寬 16px, 得文字 x 的座標左右擺動範圍為 +0px, +9px，y 座標同理，用於設置 translate 值。</p><p>2. 實際上字體本身並沒有填充滿整個 16x16 的區域，根據字體的不同，填滿的區域可能各有不同，所以根據cochin 字體的特性，上面稍微將字體大小調整為 20，實際渲染出來的字母才是 16x16 左右大小，數字大概是 10x16，所以設置數字的 x,y 為 -5,-8，結合下面兩個屬性解釋 x,y 的計算方式。</p><p>3. translate: 設置文本的橫縱向偏移值。</p><p>4. rotate：設置文本旋轉，單位 degrees。根據 gravity 的設置座標系統有一丁點變化，所以請設置為 西北(NorthWest) ，表示以畫布 0,0 座標旋轉，跟 HTML 5 Canvas 座標系統一致。</p><p>5. 根據這樣的座標系統，如果要文字按自身的中心旋轉，得配合 translate 和 text 的 x,y 一起使用，原理可參考，注意 translate 與 rotate 的順序。</p><p>· strokewidth：設置文本的邊框寬度或線條寬度。</p><p>· stroke：設置文本的邊框顏色或線條顏色。</p><p>· -fill 'rgba(0, 0, 0, 0)'：上面設置了文本的填充顏色，會影響下面的貝塞爾曲線，所以這裡指定一個透明的填充色以覆蓋上面的設定，使曲線沒有填充。</p><p>· bezier：繪製貝塞爾曲線，一兩句話我怕解釋不清楚，所以請大家參考一下或者，最後再參考一下 。上面兩條三次貝塞爾曲線的座標分別表示 起始點，起始點的控制點，結束點的控制點，結束點。</p><p>· +noise：增加噪點，可以使用 convert -list noise 查看當前系統支持哪些算法的噪點，大概有 Gaussian, Impulse, Laplacian, Multiplicative, Poisson, Random, Uniform。</p><p><strong>4、克隆及拼合圖像</strong></p><pre><code>convert \\( -crop 300x300+10+25 joy.jpg \) \\( -resize 400x400 -crop 300x300+50+0 logo: \) -swap 0,1 +append \\( -clone 0 -flop -flip \) -append \-resize 200x200 combined.jpg</code></pre><p>結果如下：</p><div class=pgc-img><img alt=圖片處理命令行工具ImageMagick介紹 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/19fece9f26464857b789d3f2337093fd><p class=pgc-img-caption></p></div><p>解釋：</p><p>· 圓括號 \( ... \)：圖像堆棧 ( image stack )，相當於創建了一個獨立作用域處理圖像，這個可以使圖像之前的處理互不干擾。圓括號需用反斜槓轉義，才能不被 Shell 當做特殊字符處理，並且每個圓括號兩邊需要用空格隔開。不必要的圓括號會使 IM 增加少許額外的工作，但是卻讓命令更清晰不容易出錯。</p><p>· -crop：裁剪出圖像的一個或多個矩形區域，格式為 {size}{+-}x{+-}y，如果不指定偏移值 x,y，則會被解釋為按指定寬高切割圖像成多少份（多圖像）。</p><p>· logo:：IM 內置圖像，這個就是上圖中拿著魔法棒的主人公了，本身寬高 640x480，其他內置圖像還有：rose:，granite:等，。</p><p>· -swap：</p><p>1. 交換圖像的位置，格式 -swap index,index。</p><p>2. IM 在圖像處理操作時，實際上很可能是在處理一個圖像列表，當新圖像被讀入或者創建時，IM 會將該新圖像添加到當前圖像列表的末尾。</p><p>3. 如上，本來我們的圖像列表裡有 2 張圖，第一張是 joy，但是 -swap 0,1 的意思是交換第一張圖與第二張圖的位置，所以 joy 變成跑到後面了。</p><p>· +append：水平連接當前圖像列表的圖像來創建單個較長的圖像。</p><p>· -append：垂直連接當前圖像列表的圖像來創建單個較長的圖像。</p><p>· -clone：克隆圖像，格式為-clone {index_range_list}。</p><p>· -clone 0：表示克隆圖像列表裡的第一張圖像。</p><p>· -clone 1-2：表示克隆圖像列表裡的第二張到第三張圖像。</p><p>· -clone 0--1：0 表示第一張圖像，-1 表示最後一張圖像，所以整句命令則表示克隆整個圖像列表。</p><p>· -clone 2,0,1：表示克隆第三張，第一張，第二張圖像，順序根據指定的索引決定，用逗號分隔。</p><p>· -flop：將圖像水平翻轉。</p><p>· -flip：將圖像垂直翻轉。</p><p>筆記：</p><p>1. 選項之間的順序很重要。</p><p>2. 與 -clone 雷同的選項還有諸如：-delete, -insert, -reverse, -duplicate，用於操作圖像列表，功能與單詞意思相同。</p><p><strong>5、GIF 與圖片互轉</strong></p><p><strong>5.1、GIF 轉圖片</strong></p><pre><code>convert -coalesce rain.gif frame.jpg</code></pre><p>-coalesce：根據圖像 -dispose 元數據的設置覆蓋圖像序列中的每個圖像，以重現動畫序列中每個點的動畫.</p><p>也就是加-coalesce參數每張圖片和gif中肉眼看到的一致，不加該參數圖片會失真。</p><p><strong>5.2、定義輸出文件名</strong></p><p>上面默認輸出的文件名為：frame-0.jpg, frame-1.jpg, frame-2.jpg ...，</p><p>如果想使用下劃線作為符號，輸出為 frame_0.jpg, frame_1.jpg, frame_2.jpg ...，則可以如下設置。</p><pre><code>convert -coalesce rain.gif frame_%d.jpg</code></pre><p>或者</p><pre><code>convert -coalesce -set filename:n '%p' rain.gif 'frame_%[filename:n].jpg'</code></pre><p>解釋：</p><p>1. 第一種方式 %d 是 C 語言 printf() 中表示輸出一個整數，參考 選項。</p><p>2. 第二種為常規方式。</p><p>· -set：設置圖像屬性，格式為 -set key value</p><p>· filename:n '%p'：以 filename: 開頭的 key 用於設置輸出文件名的相關信息，如這裡使用 filename:n，在輸出文件名時，則可以使用 %[filename:n] 拿到剛剛的設置，而設置的內容則是 '%p'。'%p' 表示圖像在圖像列表中的索引值，更多 參考。</p><p><strong>5.3、解析特定幀</strong></p><p>如果只想拿到 GIF 的第一幀，可以這樣設置。</p><pre><code>convert -coalesce 'rain.gif[0]' first_frame.jpg</code></pre><p>拿到某些幀，如同 -clone 的寫法。</p><pre><code>convert -coalesce 'rain.gif[0-2]' some_frames_%d.jpg</code></pre><p><strong>5.4、獲取頁數</strong></p><p>通過 identify 命令我們可以簡要得到文件的信息，如下。</p><pre><code>identify rain.gif</code></pre><div class=pgc-img><img alt=圖片處理命令行工具ImageMagick介紹 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/a81e6c3627f1426cac82f0fd060fb73d><p class=pgc-img-caption></p></div><p>通過identify，將結果用換行符分割，可以得到gif的圖片頁數。</p><p>對於pdf,同樣可以使用該命令。</p><p><strong>5.5、圖片轉 GIF</strong></p><pre><code>convert -loop 0 'frame-*.jpg' rain_animation.gif</code></pre><p>將所有與 frame-*.jpg 模式匹配的圖像轉換成一張 GIF 圖像，如 frame-0.jpg，frame-1.jpg等。</p><p>-loop 設置動畫循環次數，0 表示無限循環。</p><p>設置每張圖像的播放速度可以使用 選項。</p><p>筆記： 在 IM 讀取系列文件時，frame-10.jpg 會排在 frame-2.jpg 前面，為獲得圖像正確的讀取順序，可以為文件名設置前導零 ( leading zeros )。如：frame-000.jpg, frame-001.jpg, frame-002.jpg ... frame-010.jpg。</p><p>所以在生成圖像時，我們可以使用 %03d 獲得三位前導零。</p><pre><code>convert -coalesce rain.gif frame-%03d.jpg</code></pre><p><strong>6、PDF 與圖片互轉</strong></p><p>PDF 與圖片互轉跟 GIF 很相似，稍微有些格式自身需要注意的區別。</p><p>ImageMagick本身是不具備解析 PDF 的功能的，需要依賴專門解析這種格式的外部程序，如官方指明的 ghostscript 解析程序。</p><p>首先安裝 gs，還是演示 Mac OS 安裝：</p><p>brew install ghostscript</p><p>把pdf轉換成圖片，有兩種方式能達到我們想要的結果:</p><pre><code>① convert -density 150 -flatten 'download.pdf[0]' first_page.jpg② convert -density 150 -background white -alpha remove download.pdf download.jpg</code></pre><p>解釋：</p><p>1. 當轉換 PDF 成 JPG 格式圖像時，某些情況得到的 JPG 圖片會出現黑色背景（轉換成 PNG 不會），所以可以使用 -flatten 選項讓其保持白色背景，但加上這個選項，多頁 PDF 不會分成多個 JPG 圖像，第二種方式 -background white -alpha remove 則可以一次命令轉換多頁 PDF 成多個圖像並保持白色背景。</p><p>2. 第二種方式 IM 內部應該是一頁一頁的轉換，所以一個 10 頁的 PDF 耗時會比較久，採用第一種方式讓 Node.js 多進程同時轉換該 PDF 可以提升速率。</p><p>3. -density：指定輸出圖像的分辨率 ( DPI )，在 Mac OS 上，默認的分辨率 ( 72 ) 輸出的圖像字跡不清，需要更高分辨率獲得清晰的圖像。</p><p><strong>參考文檔：</strong></p><p>圖像處理 - ImageMagick 簡單介紹與案例 https://aotu.io/notes/2018/06/06/ImageMagick_intro/</p><p>convert 命令剪切合並圖片 https://upliu.net/convert-crop-composite-image.html</p><p>ImageMagick 中文站 http://www.imagemagick.com.cn/index.html</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>圖片</a></li><li><a>處理</a></li><li><a>ImageMagick</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/f384339f.html alt=8個圖片處理神資源！個個都很腦洞，第一個給100分…… class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ae4c23ea8c4f4afdb648dd37d1aa8f64 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f384339f.html title=8個圖片處理神資源！個個都很腦洞，第一個給100分……>8個圖片處理神資源！個個都很腦洞，第一個給100分……</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/66f51c1.html alt="ImageJ | 如何批量處理圖片？" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5d223d15e2ad4d9aa20c27a8568f66b8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/66f51c1.html title="ImageJ | 如何批量處理圖片？">ImageJ | 如何批量處理圖片？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6e9df60.html alt=PS教程——批量處理圖片 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/58b23f3078634b59be4fccdcc8333221 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6e9df60.html title=PS教程——批量處理圖片>PS教程——批量處理圖片</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4e0e185.html alt=圖片信息批量處理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/579d7af1987e4694a6f169816bdcbbba style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4e0e185.html title=圖片信息批量處理>圖片信息批量處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2ec0643.html alt=圖片批量處理工具（一鍵批量添加水印軟件，超強大！）永久免費 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/9be755f2-0fa5-483a-97dd-616db5ede359 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2ec0643.html title=圖片批量處理工具（一鍵批量添加水印軟件，超強大！）永久免費>圖片批量處理工具（一鍵批量添加水印軟件，超強大！）永久免費</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ab2a0f8.html alt=輕量級的PS圖片處理軟件：PhotoScape，完全免費，可批量處理圖片 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0e18b224db4844bab2e7c954fd96e81e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ab2a0f8.html title=輕量級的PS圖片處理軟件：PhotoScape，完全免費，可批量處理圖片>輕量級的PS圖片處理軟件：PhotoScape，完全免費，可批量處理圖片</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/56564da.html alt=辦公利器-圖片批量處理，助你高效辦公 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/444e23f7e5e14b0b92782a0f6bf6b66a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/56564da.html title=辦公利器-圖片批量處理，助你高效辦公>辦公利器-圖片批量處理，助你高效辦公</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1a800c1.html alt="［分享］圖片批量處理工具（FastStone Image Viewer）" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/7af3c74ec1f346e6a1e14af624a6753d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1a800c1.html title="［分享］圖片批量處理工具（FastStone Image Viewer）">［分享］圖片批量處理工具（FastStone Image Viewer）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/10c7d8fd.html alt=神州泰嶽：公司在自然語言處理領域的基礎技術研究和應用落地均走在行業前列 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/10c7d8fd.html title=神州泰嶽：公司在自然語言處理領域的基礎技術研究和應用落地均走在行業前列>神州泰嶽：公司在自然語言處理領域的基礎技術研究和應用落地均走在行業前列</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0be408a4.html alt="MySQL 事務處理" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0be408a4.html title="MySQL 事務處理">MySQL 事務處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/011d2da0.html alt=MySql併發與事務的處理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/f13d8a1e-5e60-4b48-90bc-3c26e312a208 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/011d2da0.html title=MySql併發與事務的處理>MySql併發與事務的處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0756d624.html alt=40億像素的圖片到底有多清楚？幾百米外能看到毛孔 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/3b03000053d1f613ef3c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0756d624.html title=40億像素的圖片到底有多清楚？幾百米外能看到毛孔>40億像素的圖片到底有多清楚？幾百米外能看到毛孔</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d3c48fcc.html alt=Spring聲明式事務處理的實現原理，來自面試官的窮追拷問 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d3c48fcc.html title=Spring聲明式事務處理的實現原理，來自面試官的窮追拷問>Spring聲明式事務處理的實現原理，來自面試官的窮追拷問</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/748f28e8.html alt=一張800億像素的圖片，10公里外可以看到你家窗戶 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1528891037552a23fde99aa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/748f28e8.html title=一張800億像素的圖片，10公里外可以看到你家窗戶>一張800億像素的圖片，10公里外可以看到你家窗戶</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/efc2a519.html alt=你知道MySQL的事務處理和隔離級別嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/efc2a519.html title=你知道MySQL的事務處理和隔離級別嗎？>你知道MySQL的事務處理和隔離級別嗎？</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>