<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>JavaScript的宏任務和微任務 | 极客快訊</title><meta property="og:title" content="JavaScript的宏任務和微任務 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/73a5badff31b42da8f8c62a9761be636"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0701c85a.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0701c85a.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0701c85a.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0701c85a.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0701c85a.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0701c85a.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0701c85a.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0701c85a.html><meta property="article:published_time" content="2020-11-14T21:05:38+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:38+08:00"><meta name=Keywords content><meta name=description content="JavaScript的宏任務和微任務"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/0701c85a.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>JavaScript的宏任務和微任務</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>JavaScript是單線程的語言，也就是說同一時間只能進行一個任務，畢竟JavaScript可以操作dom,進行ui交互，刪除dom和修改dom同時進行，那麼應該聽哪一個？。</p><p>正是因為這樣，決定了它是單線程的，但是又說單線程只能在同一個時間內執行一個任務，這樣豈不是會造成阻塞？前一個任務執行很久，後面都卡死了，所以就需要JavaScript的事件循環機制來進行分配，這樣就會被分為</p><h1 class=pgc-h-arrow-right>宏任務：當前調用棧執行的代碼稱為宏任務</h1><p>宏任務有哪些？</p><ul><li>主代碼塊</li><li>定時器 setTimeout、setInterval、setImmediate</li><li>同步代碼</li><li>I/O</li></ul><h1 class=pgc-h-arrow-right>微任務：當前宏任務執行完，在下一個宏任務開始之前需要執行的在隊列（先進先出）裡的任務，可理解為回調事件</h1><p>微任務有哪些？</p><ul><li>promise.then</li><li>nextTick</li><li>process</li><li>Object.observe、MutationObserve</li><li>catch finally</li></ul><h1 class=pgc-h-arrow-right>運行機制，面試中經常會遇到這樣的題目（讓說出它的執行順序）：</h1><pre><code>console.log('1');setTimeout(function() {    console.log('2');}, 0);Promise.resolve().then(function() {    console.log('3');}).then(function() {    console.log('4');});console.log('5');</code></pre><p>執行結果：1 5 3 4 2</p><p>先了解一下運行機制：</p><p>1. 在執行棧中執行一個宏任務（程序剛開始執行時，會把整個代碼當成第一個宏任務）。</p><p>2. 執行的過程中遇到微任務，先將微任務添加到微任務隊列中（它是屬於本次執行的宏任務中分出來微任務），遇到宏任務，放到下一個執行棧中。</p><p>3. 當前宏任務執行完畢，立即執行任務隊列（先進先出的原則）中的微任務</p><p>4. 當前微任務隊列中的任務執行完畢</p><p>5. 接著開始執行執行棧中的下一個宏任務，</p><p>6. 依次循環這個規律</p><p>解析上面的代碼：</p><p>1. 整體代碼被當成第一個宏任務，代碼從上到下執行</p><p>2. 遇到console.log('1');是同步任務，直接執行，輸出<strong>1</strong></p><p>3. 遇到setTimeout，是宏任務，放到執行棧中</p><p>4. 再往下執行，遇到promise，promise的執行器裡是立即執行的，這裡沒有執行器，而是有then，then是微任務，先放到本次宏任務的微任務隊列中，then後面返回的也是一個promise，第二個then也是一個微任務，放到微任務隊列中。</p><p>5.接著遇到同步代碼console.log('5');直接輸出<strong>5</strong>，這時候，第一輪宏任務執行完畢</p><p>6.需要去執行本輪它產生的微任務，先進先出的原則，輸出<strong>3 4</strong></p><p>7.這時候循環的第一週期就結束了</p><p>8.再去執行棧中的第二個宏任務，輸出 <strong>2</strong></p><hr><p><strong>來個難的練習一下：</strong></p><pre><code>console.log('1');setTimeout(function() {    console.log('2');    process.nextTick(function() {        console.log('3');    })    new Promise(function(resolve) {        console.log('4');        resolve();    }).then(function() {        console.log('5')    })})process.nextTick(function() {    console.log('6');})new Promise(function(resolve) {    console.log('7');    resolve();}).then(function() {    console.log('8')})setTimeout(function() {    console.log('9');    process.nextTick(function() {        console.log('10');    })    new Promise(function(resolve) {        console.log('11');        resolve();    }).then(function() {        console.log('12')    })})</code></pre><p>結果：1 7 6 8 2 4 3 5 9 11 10 12</p><p>process.nextTick 需要放在node環境下才能執行：</p><div class=pgc-img><img alt=JavaScript的宏任務和微任務 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/73a5badff31b42da8f8c62a9761be636><p class=pgc-img-caption></p></div><hr><p>加上async和await</p><pre><code>async function async1() {    console.log('1');    let a = await async2();    console.log(a);    console.log('2');}async function async2() {    return new Promise((resolve) =&gt; {        setTimeout(() =&gt; {            resolve('data');        }, 0);    });}console.log('3');setTimeout(function () {    console.log('4');}, 0);async1();new Promise(function (resolve) {    console.log('5');    resolve();}).then(function () {    console.log('6');});console.log('7');// 3 1 5 7 6 4 data 2</code></pre><p>提示：</p><ol start=1><li><strong>await是一個讓出線程的標誌</strong>。</li><li>正常情況下， await 命令後面是一個 Promise 對象。如果不是，會被轉成一個立即 resolve 的 Promise 對象</li><li>當函數執行的時候， 一旦遇到 await 就會先返回，跳出函數體執行外部的代碼，等到異步操作完成，再接著執行函數體內後面的代碼。</li></ol></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>JavaScript</a></li><li><a>宏任務</a></li><li><a>任務</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/09fe16de.html alt="JavaScript 之 宏任務，微任務" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/164237e0297c4f8697eccedecb547980 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/09fe16de.html title="JavaScript 之 宏任務，微任務">JavaScript 之 宏任務，微任務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f1d32f3f.html alt=javascript中的宏任務與微任務 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/664e98c4-c156-458f-a172-5502c246e157 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f1d32f3f.html title=javascript中的宏任務與微任務>javascript中的宏任務與微任務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f97d341c.html alt=使用易語言控制檯製作（任務管理器）系統進程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/153036512103769cec6250b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f97d341c.html title=使用易語言控制檯製作（任務管理器）系統進程>使用易語言控制檯製作（任務管理器）系統進程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a2847433.html alt=常用JavaScript正則表達式彙編與示例詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/dca255e6-9611-4395-afc6-7e9fa5ac5e38 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a2847433.html title=常用JavaScript正則表達式彙編與示例詳解>常用JavaScript正則表達式彙編與示例詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/47bf383c.html alt="JavaScript 正則表達式理論學習和案例分析" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/23450277ff8a4edb976123f0d7b823d0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/47bf383c.html title="JavaScript 正則表達式理論學習和案例分析">JavaScript 正則表達式理論學習和案例分析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/de5a6f15.html alt=JavaScript正則表達式詳細總結 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/6cd0893b009045c794771d55a21a19a6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/de5a6f15.html title=JavaScript正則表達式詳細總結>JavaScript正則表達式詳細總結</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/79da6281.html alt=玩透JavaScript正則表達式一 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/71659719aeb045fb850e61cb749198d2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/79da6281.html title=玩透JavaScript正則表達式一>玩透JavaScript正則表達式一</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9215af22.html alt=“十一”超7成白領在旅途中工作，職場上該如何有效指派任務？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/27492ce76b7d45a1a1b935e56c695b22 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9215af22.html title=“十一”超7成白領在旅途中工作，職場上該如何有效指派任務？>“十一”超7成白領在旅途中工作，職場上該如何有效指派任務？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3dc85d2e.html alt=JavaScript二叉樹（二叉搜索樹）的詳細介紹 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9f01674b907b45c390bbc94168d16a71 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3dc85d2e.html title=JavaScript二叉樹（二叉搜索樹）的詳細介紹>JavaScript二叉樹（二叉搜索樹）的詳細介紹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6e3e1b61.html alt=事件循環：微任務與宏任務 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0bfecfff8e394205b16a211beb605d5d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6e3e1b61.html title=事件循環：微任務與宏任務>事件循環：微任務與宏任務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7e41f2a4.html alt=從EventLoop到宏任務與微任務 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/79a6de2f384a4574920524c200fb5949 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7e41f2a4.html title=從EventLoop到宏任務與微任務>從EventLoop到宏任務與微任務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/51cec254.html alt=百度多個短視頻嵌套了“收徒做任務賺現金”模式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/R8Ld2A5AsKC7Zw style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/51cec254.html title=百度多個短視頻嵌套了“收徒做任務賺現金”模式>百度多個短視頻嵌套了“收徒做任務賺現金”模式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7262ab0d.html alt=除了支付寶，百度也正在做活動，每天登陸做任務都可以領取 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ee2949da8f7342678c8f6678b8d88cd2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7262ab0d.html title=除了支付寶，百度也正在做活動，每天登陸做任務都可以領取>除了支付寶，百度也正在做活動，每天登陸做任務都可以領取</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f8b58ea4.html alt=百度做任務領紅包 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/7ec3ba96286444dda8e0729ff9d15751 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f8b58ea4.html title=百度做任務領紅包>百度做任務領紅包</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5f24f86b.html alt=一文讀懂JavaScript位的與、或、異或、取反及左移右移操作 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/916bb38f066f47f192ae06cc60210ae0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5f24f86b.html title=一文讀懂JavaScript位的與、或、異或、取反及左移右移操作>一文讀懂JavaScript位的與、或、異或、取反及左移右移操作</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>