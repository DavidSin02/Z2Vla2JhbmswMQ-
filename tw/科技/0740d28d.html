<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>åŒ…æ•™åŒ…æœƒï¼çœ‹äº†é€™ç¯‡ä½ å°±æœƒæ‰‹å¯«RPCæ¡†æ¶äº† | æå®¢å¿«è¨Š</title><meta property="og:title" content="åŒ…æ•™åŒ…æœƒï¼çœ‹äº†é€™ç¯‡ä½ å°±æœƒæ‰‹å¯«RPCæ¡†æ¶äº† - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/55d9c37ea69242bb9e645344cd879609"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0740d28d.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0740d28d.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0740d28d.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0740d28d.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0740d28d.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0740d28d.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0740d28d.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0740d28d.html><meta property="article:published_time" content="2020-11-14T20:59:17+08:00"><meta property="article:modified_time" content="2020-11-14T20:59:17+08:00"><meta name=Keywords content><meta name=description content="åŒ…æ•™åŒ…æœƒï¼çœ‹äº†é€™ç¯‡ä½ å°±æœƒæ‰‹å¯«RPCæ¡†æ¶äº†"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/0740d28d.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>åŒ…æ•™åŒ…æœƒï¼çœ‹äº†é€™ç¯‡ä½ å°±æœƒæ‰‹å¯«RPCæ¡†æ¶äº†</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><blockquote><p>æœ¬æ–‡ä½œè€…ï¼šæ±æ–¹é›¨å‚¾<br>æœ¬æ–‡éˆæ¥ï¼šhttps://www.cnblogs.com/itoak/p/13370031.html</p></blockquote><h1 class=pgc-h-arrow-right><strong>ä¸€ã€å­¸ç¿’æœ¬æ–‡ä½ èƒ½å­¸åˆ°ä»€éº¼ï¼Ÿ</strong></h1><ul><li>RPCçš„æ¦‚å¿µåŠé‹ä½œæµç¨‹</li><li>RPCå”è­°åŠRPCæ¡†æ¶çš„æ¦‚å¿µ</li><li>Nettyçš„åŸºæœ¬ä½¿ç”¨</li><li>Javaåºåˆ—åŒ–åŠååºåˆ—åŒ–æŠ€è¡“</li><li>Zookeeperçš„åŸºæœ¬ä½¿ç”¨ï¼ˆè¨»å†Šä¸­å¿ƒï¼‰</li><li>è‡ªå®šç¾©è¨»è§£å¯¦ç¾ç‰¹æ®Šæ¥­å‹™é‚è¼¯</li><li>Javaçš„å‹•æ…‹ä»£ç†</li><li>è‡ªå®šç¾©Spring Boot Starter</li></ul><p style=text-align:start>é€™è£¡åªæ˜¯åˆ—å‡ºäº†ä½ èƒ½å¾RPCæ¡†æ¶æºç¢¼ä¸­èƒ½å­¸åˆ°çš„æ±è¥¿ï¼Œæœ¬æ–‡ä¸¦ä¸æœƒæ¯å€‹çŸ¥è­˜é»éƒ½é»åˆ°ï¼Œä¸»è¦è¬›è¿°å¦‚ä½•æ‰‹å¯«ä¸€å€‹RPCæ¡†æ¶ï¼Œæ›´å¤šç´°ç¯€éœ€è¦è®€è€…é–±è®€æºç¢¼ï¼Œæ–‡ç« çš„ä¸‹æ–¹æœƒæä¾›æºç¢¼éˆæ¥å“¦ã€‚</p><h1 class=pgc-h-arrow-right><strong>äºŒã€RPCåŸºç¤çŸ¥è­˜</strong></h1><h1 class=pgc-h-arrow-right><strong>2.1 RPCæ˜¯ä»€éº¼ï¼Ÿ</strong></h1><p style=text-align:start>Remote Procedure Callï¼ˆRPCï¼‰ï¼šé ç¨‹éç¨‹èª¿ç”¨ã€‚</p><blockquote><p>éç¨‹æ˜¯ä»€éº¼ï¼Ÿéç¨‹å°±æ˜¯æ¥­å‹™è™•ç†ã€è¨ˆç®—ä»»å‹™ï¼Œæ›´ç›´ç™½ç†è§£ï¼Œå°±æ˜¯ç¨‹åºã€‚ï¼ˆåƒèª¿ç”¨æœ¬åœ°æ–¹æ³•ä¸€æ¨£èª¿ç”¨é ç¨‹çš„éç¨‹ã€‚ï¼‰</p></blockquote><p style=text-align:start>RPCæ¡ç”¨Client-Serverçµæ§‹ï¼Œé€šéRequest-Responseæ¶ˆæ¯æ¨¡å¼å¯¦ç¾ã€‚</p><h1 class=pgc-h-arrow-right><strong>2.2 RPCçš„æµç¨‹</strong></h1><div class=pgc-img><img alt=åŒ…æ•™åŒ…æœƒï¼çœ‹äº†é€™ç¯‡ä½ å°±æœƒæ‰‹å¯«RPCæ¡†æ¶äº† onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/55d9c37ea69242bb9e645344cd879609><p class=pgc-img-caption></p></div><ul><li>å®¢æˆ¶ç«¯è™•ç†éç¨‹ä¸­èª¿ç”¨Client stubï¼ˆå°±åƒèª¿ç”¨æœ¬åœ°æ–¹æ³•ä¸€æ¨£ï¼‰ï¼Œå‚³éåƒæ•¸ï¼›</li><li>Client stubå°‡åƒæ•¸ç·¨çµ„ç‚ºæ¶ˆæ¯ï¼Œç„¶å¾Œé€šéç³»çµ±èª¿ç”¨å‘æœå‹™ç«¯ç™¼é€æ¶ˆæ¯ï¼›</li><li>å®¢æˆ¶ç«¯æœ¬åœ°æ“ä½œç³»çµ±å°‡æ¶ˆæ¯å¾å®¢æˆ¶ç«¯æ©Ÿå™¨ç™¼é€åˆ°æœå‹™ç«¯æ©Ÿå™¨ï¼›</li><li>æœå‹™ç«¯æ“ä½œç³»çµ±å°‡æ¥æ”¶åˆ°çš„æ•¸æ“šåŒ…å‚³éçµ¦Server stub;</li><li>Server stubè§£çµ„æ¶ˆæ¯ç‚ºåƒæ•¸ï¼›</li><li>Server stubå†èª¿ç”¨æœå‹™ç«¯çš„éç¨‹ï¼Œéç¨‹åŸ·è¡Œçµæœä»¥åæ–¹å‘çš„ç›¸åŒæ­¥é©ŸéŸ¿æ‡‰çµ¦å®¢æˆ¶ç«¯ã€‚</li></ul><h1 class=pgc-h-arrow-right><strong>2.3 RPCæµç¨‹ä¸­éœ€è¦è™•ç†çš„å•é¡Œ</strong></h1><ul><li>Client stubã€Server stubçš„é–‹ç™¼ï¼›</li><li>åƒæ•¸å¦‚ä½•ç·¨çµ„ç‚ºæ¶ˆæ¯ï¼Œä»¥åŠè§£çµ„æ¶ˆæ¯ï¼›</li><li>æ¶ˆæ¯å¦‚ä½•ç™¼é€ï¼›</li><li>éç¨‹çµæœå¦‚ä½•è¡¨ç¤ºã€ç•°å¸¸æƒ…æ³å¦‚ä½•è™•ç†ï¼›</li><li>å¦‚ä½•å¯¦ç¾å®‰å…¨çš„è¨ªå•æ§åˆ¶ã€‚</li></ul><h1 class=pgc-h-arrow-right><strong>2.4 RPCå”è­°æ˜¯ä»€éº¼ï¼Ÿ</strong></h1><p style=text-align:start>RPCèª¿ç”¨éç¨‹ä¸­éœ€è¦å°‡åƒæ•¸ç·¨çµ„ç‚ºæ¶ˆæ¯é€²è¡Œç™¼é€ï¼Œæ¥æ”¶æ–¹éœ€è¦è§£çµ„æ¶ˆæ¯ç‚ºåƒæ•¸ï¼Œéç¨‹è™•ç†çµæœåŒæ¨£éœ€è¦ç¶“ç·¨çµ„ã€è§£çµ„ã€‚æ¶ˆæ¯ç”±å“ªäº›éƒ¨åˆ†æ§‹æˆåŠæ¶ˆæ¯çš„è¡¨ç¤ºå½¢å¼å°±æ§‹æˆäº†æ¶ˆæ¯å”è­°ã€‚</p><p style=text-align:start><strong>RPCèª¿ç”¨éç¨‹ä¸­æ¡ç”¨çš„æ¶ˆæ¯å”è­°ç¨±ç‚ºRPCå”è­°</strong></p><blockquote><p>RPCå”è­°è¦å®šè«‹æ±‚ã€éŸ¿æ‡‰æ¶ˆæ¯çš„æ ¼å¼</p><p>åœ¨TCPï¼ˆç¶²çµ¡å‚³è¼¸æ§åˆ¶å”è­°ï¼‰ä¸Šå¯é¸ç”¨æˆ–è‡ªå®šç¾©æ¶ˆæ¯å”è­°ä¾†å®ŒæˆRPCæ¶ˆæ¯äº¤äº’</p><p>æˆ‘å€‘å¯ä»¥é¸ç”¨é€šç”¨çš„æ¨™æº–å”è­°ï¼ˆå¦‚ï¼šhttpã€httpsï¼‰ï¼Œä¹Ÿä¹Ÿå¯æ ¹æ“šè‡ªèº«çš„éœ€è¦å®šç¾©è‡ªå·±çš„æ¶ˆæ¯å”è­°ã€‚</p></blockquote><p style=text-align:start><br></p><h1 class=pgc-h-arrow-right><strong>2.5 RPCæ¡†æ¶æ˜¯ä»€éº¼ï¼Ÿ</strong></h1><p style=text-align:start>å°è£å¥½åƒæ•¸ç·¨çµ„ã€æ¶ˆæ¯è§£çµ„ã€åº•å±¤ç¶²çµ¡é€šä¿¡çš„RPCç¨‹åºé–‹ç™¼æ¡†æ¶ï¼Œå¸¶ä¾†çš„ä¾¿æ·æ˜¯å¯ä»¥ç›´æ¥åœ¨å…¶åŸºç¤ä¸Šåªéœ€è¦å°ˆæ³¨æ–¼éç¨‹ä»£ç¢¼ç·¨å¯«ã€‚</p><p style=text-align:start>Javaé ˜åŸŸï¼š</p><ul><li>å‚³çµ±çš„webserviceæ¡†æ¶ï¼šApache CXFã€Apache Axis2ã€Javaè‡ªå¸¶çš„JAX-WSç­‰ã€‚webserviceæ¡†æ¶å¤§å¤šåŸºæ–¼æ¨™æº–çš„SOAPå”è­°ã€‚</li><li>æ–°èˆˆçš„å¾®æœå‹™æ¡†æ¶ï¼šDubboã€spring cloudã€Apache Thriftç­‰ã€‚</li></ul><h1 class=pgc-h-arrow-right><strong>ä¸‰ã€æ‰‹å¯«RPC</strong></h1><h1 class=pgc-h-arrow-right><strong>3.1 ç›®æ¨™</strong></h1><p style=text-align:start>æˆ‘å€‘å°‡æœƒå¯«ä¸€å€‹ç°¡æ˜“çš„RPCæ¡†æ¶ï¼Œæš«ä¸”å«å®ƒleisure-rpc-spring-boot-starterï¼Œé€šéåœ¨é …ç›®ä¸­å¼•å…¥è©²starterï¼Œä¸¦ç°¡å–®çš„é…ç½®ä¸€ä¸‹ï¼Œé …ç›®å³æ“æœ‰æä¾›é ç¨‹æœå‹™çš„èƒ½åŠ›ã€‚</p><p style=text-align:start>ç·¨å¯«è‡ªå®šç¾©è¨»è§£@Serviceï¼Œè¢«å®ƒè¨»è§£çš„é¡å°‡æœƒæä¾›é ç¨‹æœå‹™ã€‚</p><p style=text-align:start>ç·¨å¯«è‡ªå®šç¾©è¨»è§£@InjectServiceï¼Œä½¿ç”¨å®ƒå¯æ³¨å…¥é ç¨‹æœå‹™ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.2 é …ç›®æ•´é«”çµæ§‹</strong></h1><div class=pgc-img><img alt=åŒ…æ•™åŒ…æœƒï¼çœ‹äº†é€™ç¯‡ä½ å°±æœƒæ‰‹å¯«RPCæ¡†æ¶äº† onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/747182abb8da4394b1b197c9d7b7d3e2><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>3.3 å®¢æˆ¶ç«¯ç·¨å¯«</strong></h1><h1 class=pgc-h-arrow-right><strong>3.3.1 å®¢æˆ¶ç«¯éœ€è¦åšä»€éº¼ï¼Ÿ</strong></h1><p style=text-align:start>å®¢æˆ¶ç«¯æƒ³è¦èª¿ç”¨é ç¨‹æœå‹™ï¼Œå¿…é ˆå…·å‚™<strong>æœå‹™ç™¼ç¾</strong>çš„èƒ½åŠ›ï¼›åœ¨çŸ¥é“æœ‰å“ªäº›æœå‹™éå¾Œï¼Œé‚„å¿…é ˆæœ‰<strong>æœå‹™ä»£ç†</strong>ä¾†åŸ·è¡Œæœå‹™èª¿ç”¨ï¼›å®¢æˆ¶ç«¯æƒ³è¦èˆ‡æœå‹™ç«¯é€šä¿¡ï¼Œå¿…é ˆè¦æœ‰ç›¸åŒçš„<strong>æ¶ˆæ¯å”è­°</strong>ï¼›å®¢æˆ¶ç«¯æƒ³è¦èª¿ç”¨é ç¨‹æœå‹™ï¼Œé‚£éº¼å¿…é ˆå…·å‚™ç¶²çµ¡è«‹æ±‚çš„èƒ½åŠ›ï¼Œå³<strong>ç¶²çµ¡å±¤</strong>åŠŸèƒ½ã€‚</p><p style=text-align:start>ç•¶ç„¶ï¼Œé€™æ˜¯å®¢æˆ¶ç«¯æ‰€éœ€çš„æœ€åŸºæœ¬çš„èƒ½åŠ›ï¼Œå…¶å¯¦é‚„å¯ä»¥æ“´å±•çš„èƒ½åŠ›ï¼Œä¾‹å¦‚è² è¼‰å‡è¡¡ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.3.2 å…·é«”å¯¦ç¾</strong></h1><p style=text-align:start>æˆ‘å€‘å…ˆçœ‹çœ‹å®¢æˆ¶ç«¯çš„ä»£ç¢¼çµæ§‹ï¼š</p><div class=pgc-img><img alt=åŒ…æ•™åŒ…æœƒï¼çœ‹äº†é€™ç¯‡ä½ å°±æœƒæ‰‹å¯«RPCæ¡†æ¶äº† onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7a4fa227f9f5460aa20360b0aab5b3f0><p class=pgc-img-caption></p></div><p style=text-align:start>åŸºæ–¼é¢å‘æ¥å£ç·¨ç¨‹çš„ç†å¿µï¼Œä¸åŒè§’è‰²éƒ½å¯¦ç¾äº†å®šç¾©äº†ç›¸æ‡‰è¦ç¯„çš„æ¥å£ã€‚é€™è£¡é¢æˆ‘å€‘æ²’æœ‰ç™¼ç¾æ¶ˆæ¯å”è­°ç›¸é—œå…§å®¹ï¼Œé‚£æ˜¯å› ç‚ºæœå‹™ç«¯ä¹Ÿéœ€è¦æ¶ˆæ¯å”è­°ï¼Œå› æ­¤æŠ½é›¢äº†å‡ºä¾†ï¼Œæ”¾åœ¨å…¬å…±å±¤ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.3.2.1 æœå‹™ç™¼ç¾è€…</strong></h1><pre><code>/*** æœå‹™ç™¼ç¾æŠ½è±¡é¡ï¼Œå®šç¾©æœå‹™ç™¼ç¾è¦ç¯„** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/publicÂ interfaceÂ ServiceDiscovererÂ {Â  Â List&lt;Service&gt;Â getServices(StringÂ name);}/*** Zookeeperæœå‹™ç™¼ç¾è€…ï¼Œå®šç¾©ä»¥Zookeeperç‚ºè¨»å†Šä¸­å¿ƒçš„æœå‹™ç™¼ç¾ç´°å‰‡** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/publicÂ classÂ ZookeeperServiceDiscovererÂ implementsÂ ServiceDiscovererÂ {Â  Â privateÂ ZkClientÂ zkClient;Â  Â publicÂ ZookeeperServiceDiscoverer(StringÂ zkAddress) {Â  Â  Â  Â zkClientÂ =Â newÂ ZkClient(zkAddress);Â  Â  Â  Â zkClient.setZkSerializer(newÂ ZookeeperSerializer());Â  }Â  Â /**Â  Â Â * ä½¿ç”¨Zookeeperå®¢æˆ¶ç«¯ï¼Œé€šéæœå‹™åç²å–æœå‹™åˆ—è¡¨Â  Â Â * æœå‹™åæ ¼å¼ï¼šæ¥å£å…¨è·¯å¾‘Â  Â Â *Â  Â Â * @param name æœå‹™åÂ  Â Â * @return æœå‹™åˆ—è¡¨Â  Â Â */Â  Â @OverrideÂ  Â publicÂ List&lt;Service&gt;Â getServices(StringÂ name) {Â  Â  Â  Â StringÂ servicePathÂ =Â LeisureConstant.ZK_SERVICE_PATHÂ +LeisureConstant.PATH_DELIMITERÂ +Â nameÂ +Â "/service";Â  Â  Â  Â List&lt;String&gt;Â childrenÂ =Â zkClient.getChildren(servicePath);Â  Â  Â  Â returnÂ Optional.ofNullable(children).orElse(newÂ ArrayList&lt;&gt;()).stream().map(strÂ -&gt;Â {Â  Â  Â  Â  Â  Â StringÂ deChÂ =Â null;Â  Â  Â  Â  Â  Â tryÂ {Â  Â  Â  Â  Â  Â  Â  Â deChÂ =Â URLDecoder.decode(str,Â LeisureConstant.UTF_8);Â  Â  Â  Â  Â  }Â catchÂ (UnsupportedEncodingExceptionÂ e) {Â  Â  Â  Â  Â  Â  Â  Â e.printStackTrace();Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â returnÂ JSON.parseObject(deCh,Â Service.class);Â  Â  Â  }).collect(Collectors.toList());Â  }}</code></pre><p style=text-align:start>æœå‹™ç™¼ç¾è€…ä½¿ç”¨Zookeeperä¾†å¯¦ç¾ï¼Œé€šéZkClientæˆ‘å€‘å¾ˆå®¹æ˜“ç™¼ç¾å·²ç¶“è¨»å†Šåœ¨ZKä¸Šçš„æœå‹™ã€‚ç•¶ç„¶æˆ‘å€‘ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çµ„ä»¶ä½œç‚ºè¨»å†Šä¸­å¿ƒï¼Œä¾‹å¦‚Redisã€‚</p><h1 class=pgc-h-arrow-right><strong>3.3.2.2 ç¶²çµ¡å®¢æˆ¶ç«¯</strong></h1><pre><code>/*** ç¶²çµ¡è«‹æ±‚å®¢æˆ¶ç«¯ï¼Œå®šç¾©ç¶²çµ¡è«‹æ±‚è¦ç¯„** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/publicÂ interfaceÂ NetClientÂ {Â  Â byte[]Â sendRequest(byte[]Â data,Â ServiceÂ service)Â throwsÂ InterruptedException;}/*** Nettyç¶²çµ¡è«‹æ±‚å®¢æˆ¶ç«¯ï¼Œå®šç¾©é€šéNettyå¯¦ç¾ç¶²çµ¡è«‹æ±‚çš„ç´°å‰‡ã€‚** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/publicÂ classÂ NettyNetClientÂ implementsÂ NetClientÂ {Â  Â privateÂ staticÂ LoggerÂ loggerÂ =Â LoggerFactory.getLogger(NettyNetClient.class);Â  Â /**Â  Â Â * ç™¼é€è«‹æ±‚Â  Â Â *Â  Â Â * @param data Â  è«‹æ±‚æ•¸æ“šÂ  Â Â * @param service æœå‹™ä¿¡æ¯Â  Â Â * @return éŸ¿æ‡‰æ•¸æ“šÂ  Â Â * @throws InterruptedException ç•°å¸¸Â  Â Â */Â  Â @OverrideÂ  Â publicÂ byte[]Â sendRequest(byte[]Â data,Â ServiceÂ service)Â throwsInterruptedExceptionÂ {Â  Â  Â  Â String[]Â addInfoArrayÂ =Â service.getAddress().split(":");Â  Â  Â  Â StringÂ serverAddressÂ =Â addInfoArray[0];Â  Â  Â  Â StringÂ serverPortÂ =Â addInfoArray[1];Â  Â  Â  Â SendHandlerÂ sendHandlerÂ =Â newÂ SendHandler(data);Â  Â  Â  Â byte[]Â respData;Â  Â  Â  Â // é…ç½®å®¢æˆ¶ç«¯Â  Â  Â  Â EventLoopGroupÂ groupÂ =Â newÂ NioEventLoopGroup();Â  Â  Â  Â tryÂ {Â  Â  Â  Â  Â  Â BootstrapÂ bÂ =Â newÂ Bootstrap();Â  Â  Â  Â  Â  Â b.group(group).channel(NioSocketChannel.class).option(ChannelOption.TCP_NODELAY,Â true)Â  Â  Â  Â  Â  Â  Â  Â  Â  .handler(newÂ ChannelInitializer&lt;SocketChannel&gt;() {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â @OverrideÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â publicÂ voidÂ initChannel(SocketChannelÂ ch) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ChannelPipelineÂ pÂ =Â ch.pipeline();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â p.addLast(sendHandler);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â // å•Ÿå‹•å®¢æˆ¶ç«¯é€£æ¥Â  Â  Â  Â  Â  Â b.connect(serverAddress,Â Integer.parseInt(serverPort)).sync();Â  Â  Â  Â  Â  Â respDataÂ =Â (byte[])Â sendHandler.rspData();Â  Â  Â  Â  Â  Â logger.info("SendRequest get reply: {}",Â respData);Â  Â  Â  }Â finallyÂ {Â  Â  Â  Â  Â  Â // é‡‹æ”¾ç·šç¨‹çµ„è³‡æºÂ  Â  Â  Â  Â  Â group.shutdownGracefully();Â  Â  Â  }Â  Â  Â  Â returnÂ respData;Â  }}/*** ç™¼é€è™•ç†é¡ï¼Œå®šç¾©Nettyå…¥ç«™è™•ç†ç´°å‰‡** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/publicÂ classÂ SendHandlerÂ extendsÂ ChannelInboundHandlerAdapterÂ {Â  Â privateÂ staticÂ LoggerÂ loggerÂ =Â LoggerFactory.getLogger(SendHandler.class);Â  Â privateÂ CountDownLatchÂ cdl;Â  Â privateÂ ObjectÂ readMsgÂ =Â null;Â  Â privateÂ byte[]Â data;Â  Â publicÂ SendHandler(byte[]Â data) {Â  Â  Â  Â cdlÂ =Â newÂ CountDownLatch(1);Â  Â  Â  Â this.dataÂ =Â data;Â  }Â  Â /**Â  Â Â * ç•¶é€£æ¥æœå‹™ç«¯æˆåŠŸå¾Œï¼Œç™¼é€è«‹æ±‚æ•¸æ“šÂ  Â Â *Â  Â Â * @param ctx é€šé“ä¸Šä¸‹æ–‡Â  Â Â */Â  Â @OverrideÂ  Â publicÂ voidÂ channelActive(ChannelHandlerContextÂ ctx) {Â  Â  Â  Â logger.info("Successful connection to serverï¼š{}",Â ctx);Â  Â  Â  Â ByteBufÂ reqBufÂ =Â Unpooled.buffer(data.length);Â  Â  Â  Â reqBuf.writeBytes(data);Â  Â  Â  Â logger.info("Client sends messageï¼š{}",Â reqBuf);Â  Â  Â  Â ctx.writeAndFlush(reqBuf);Â  }Â  Â /**Â  Â Â * è®€å–æ•¸æ“šï¼Œæ•¸æ“šè®€å–å®Œç•¢é‡‹æ”¾CDé–Â  Â Â *Â  Â Â * @param ctx ä¸Šä¸‹æ–‡Â  Â Â * @param msg ByteBufÂ  Â Â */Â  Â @OverrideÂ  Â publicÂ voidÂ channelRead(ChannelHandlerContextÂ ctx,Â ObjectÂ msg) {Â  Â  Â  Â logger.info("Client reads message: {}",Â msg);Â  Â  Â  Â ByteBufÂ msgBufÂ =Â (ByteBuf)Â msg;Â  Â  Â  Â byte[]Â respÂ =Â newÂ byte[msgBuf.readableBytes()];Â  Â  Â  Â msgBuf.readBytes(resp);Â  Â  Â  Â readMsgÂ =Â resp;Â  Â  Â  Â cdl.countDown();Â  }Â  Â /**Â  Â Â * ç­‰å¾…è®€å–æ•¸æ“šå®ŒæˆÂ  Â Â *Â  Â Â * @return éŸ¿æ‡‰æ•¸æ“šÂ  Â Â * @throws InterruptedException ç•°å¸¸Â  Â Â */Â  Â publicÂ ObjectÂ rspData()Â throwsÂ InterruptedExceptionÂ {Â  Â  Â  Â cdl.await();Â  Â  Â  Â returnÂ readMsg;Â  }Â  Â @OverrideÂ  Â publicÂ voidÂ channelReadComplete(ChannelHandlerContextÂ ctx) {Â  Â  Â  Â ctx.flush();Â  }Â  Â @OverrideÂ  Â publicÂ voidÂ exceptionCaught(ChannelHandlerContextÂ ctx,Â ThrowableÂ cause) {Â  Â  Â  Â // Close the connection when an exception is raised.Â  Â  Â  Â cause.printStackTrace();Â  Â  Â  Â logger.error("Exception occurredï¼š{}",Â cause.getMessage());Â  Â  Â  Â ctx.close();Â  }}</code></pre><p style=text-align:start>åœ¨é€™è£¡æˆ‘å€‘ä½¿ç”¨Nettyä¾†å¯¦ç¾ç¶²çµ¡è«‹æ±‚å®¢æˆ¶ç«¯ï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨Minaã€‚ç¶²çµ¡è«‹æ±‚å®¢æˆ¶ç«¯èƒ½é€£æ¥é ç¨‹æœå‹™ç«¯ï¼Œä¸¦å°‡ç·¨çµ„å¥½çš„è«‹æ±‚æ•¸æ“šç™¼é€çµ¦æœå‹™ç«¯ï¼Œå¾…æœå‹™ç«¯è™•ç†å¥½å¾Œï¼Œåˆå°‡æœå‹™ç«¯çš„éŸ¿æ‡‰æ•¸æ“šè¿”å›çµ¦å®¢æˆ¶ç«¯ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.3.2.3 æœå‹™ä»£ç†</strong></h1><pre><code>/*** å®¢æˆ¶ç«¯ä»£ç†å·¥å» ï¼šç”¨æ–¼å‰µå»ºé ç¨‹æœå‹™ä»£ç†é¡* å°è£ç·¨çµ„è«‹æ±‚ã€è«‹æ±‚ç™¼é€ã€ç·¨çµ„éŸ¿æ‡‰ç­‰æ“ä½œã€‚** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/publicÂ classÂ ClientProxyFactoryÂ {Â  Â privateÂ ServiceDiscovererÂ serviceDiscoverer;Â  Â privateÂ Map&lt;String,Â MessageProtocol&gt;Â supportMessageProtocols;Â  Â privateÂ NetClientÂ netClient;Â  Â privateÂ Map&lt;Class&lt;?&gt;,Â Object&gt;Â objectCacheÂ =Â newÂ HashMap&lt;&gt;();Â  Â /**Â  Â Â * é€šéJavaå‹•æ…‹ä»£ç†ç²å–æœå‹™ä»£ç†é¡Â  Â Â *Â  Â Â * @param clazz è¢«ä»£ç†é¡ClassÂ  Â Â * @param &lt;T&gt; Â  æ³›å‹Â  Â Â * @return æœå‹™ä»£ç†é¡Â  Â Â */Â  Â @SuppressWarnings("unchecked")Â  Â publicÂ &lt;T&gt;Â TÂ getProxy(Class&lt;T&gt;Â clazz) {Â  Â  Â  Â returnÂ (T)Â this.objectCache.computeIfAbsent(clazz,Â  Â  Â  Â  Â  Â  Â  Â clsÂ -&gt;Â newProxyInstance(cls.getClassLoader(),Â newÂ Class&lt;?&gt;[]{cls},Â newClientInvocationHandler(cls)));Â  }Â  Â // getter setter ...Â  Â /**Â  Â Â * å®¢æˆ¶ç«¯æœå‹™ä»£ç†é¡invokeå‡½æ•¸ç´°ç¯€å¯¦ç¾Â  Â Â */Â  Â privateÂ classÂ ClientInvocationHandlerÂ implementsÂ InvocationHandlerÂ {Â  Â  Â  Â privateÂ Class&lt;?&gt;Â clazz;Â  Â  Â  Â privateÂ RandomÂ randomÂ =Â newÂ Random();Â  Â  Â  Â publicÂ ClientInvocationHandler(Class&lt;?&gt;Â clazz) {Â  Â  Â  Â  Â  Â super();Â  Â  Â  Â  Â  Â this.clazzÂ =Â clazz;Â  Â  Â  }Â  Â  Â  Â @OverrideÂ  Â  Â  Â publicÂ ObjectÂ invoke(ObjectÂ proxy,Â MethodÂ method,Â Object[]Â args)Â throwsExceptionÂ {Â  Â  Â  Â  Â  Â ifÂ (method.getName().equals("toString")) {Â  Â  Â  Â  Â  Â  Â  Â returnÂ proxy.getClass().toString();Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â ifÂ (method.getName().equals("hashCode")) {Â  Â  Â  Â  Â  Â  Â  Â returnÂ 0;Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â // 1ã€ç²å¾—æœå‹™ä¿¡æ¯Â  Â  Â  Â  Â  Â StringÂ serviceNameÂ =Â this.clazz.getName();Â  Â  Â  Â  Â  Â List&lt;Service&gt;Â servicesÂ =Â serviceDiscoverer.getServices(serviceName);Â  Â  Â  Â  Â  Â ifÂ (servicesÂ ==Â nullÂ ||Â services.isEmpty()) {Â  Â  Â  Â  Â  Â  Â  Â throwÂ newÂ LeisureException("No provider available!");Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â // éš¨æ©Ÿé¸æ“‡ä¸€å€‹æœå‹™æä¾›è€…ï¼ˆè»Ÿè² è¼‰å‡è¡¡ï¼‰Â  Â  Â  Â  Â  Â ServiceÂ serviceÂ =Â services.get(random.nextInt(services.size()));Â  Â  Â  Â  Â  Â // 2ã€æ§‹é€ requestå°è±¡Â  Â  Â  Â  Â  Â LeisureRequestÂ reqÂ =Â newÂ LeisureRequest();Â  Â  Â  Â  Â  Â req.setServiceName(service.getName());Â  Â  Â  Â  Â  Â req.setMethod(method.getName());Â  Â  Â  Â  Â  Â req.setParameterTypes(method.getParameterTypes());Â  Â  Â  Â  Â  Â req.setParameters(args);Â  Â  Â  Â  Â  Â // 3ã€å”è­°å±¤ç·¨çµ„Â  Â  Â  Â  Â  Â // ç²å¾—è©²æ–¹æ³•å°æ‡‰çš„å”è­°Â  Â  Â  Â  Â  Â MessageProtocolÂ protocolÂ =supportMessageProtocols.get(service.getProtocol());Â  Â  Â  Â  Â  Â // ç·¨çµ„è«‹æ±‚Â  Â  Â  Â  Â  Â byte[]Â dataÂ =Â protocol.marshallingRequest(req);Â  Â  Â  Â  Â  Â // 4ã€èª¿ç”¨ç¶²çµ¡å±¤ç™¼é€è«‹æ±‚Â  Â  Â  Â  Â  Â byte[]Â repDataÂ =Â netClient.sendRequest(data,Â service);Â  Â  Â  Â  Â  Â // 5è§£çµ„éŸ¿æ‡‰æ¶ˆæ¯Â  Â  Â  Â  Â  Â LeisureResponseÂ rspÂ =Â protocol.unmarshallingResponse(repData);Â  Â  Â  Â  Â  Â // 6ã€çµæœè™•ç†Â  Â  Â  Â  Â  Â ifÂ (rsp.getException()Â !=Â null) {Â  Â  Â  Â  Â  Â  Â  Â throwÂ rsp.getException();Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â returnÂ rsp.getReturnValue();Â  Â  Â  }Â  }}</code></pre><p style=text-align:start>æœå‹™ä»£ç†é¡ç”±å®¢æˆ¶ç«¯ä»£ç†å·¥å» é¡ç”¢ç”Ÿï¼Œä»£ç†æ–¹å¼æ˜¯åŸºæ–¼Javaçš„å‹•æ…‹ä»£ç†ã€‚åœ¨è™•ç†é¡ClientInvocationHandlerçš„invokeå‡½æ•¸ä¸­ï¼Œå®šç¾©äº†ä¸€ç³»åˆ—çš„æ“ä½œï¼ŒåŒ…æ‹¬ç²å–æœå‹™ã€é¸æ“‡æœå‹™æä¾›è€…ã€æ§‹é€ è«‹æ±‚å°è±¡ã€ç·¨çµ„è«‹æ±‚å°è±¡ã€ç¶²çµ¡è«‹æ±‚å®¢æˆ¶ç«¯ç™¼é€è«‹æ±‚ã€è§£çµ„éŸ¿æ‡‰æ¶ˆæ¯ã€ç•°å¸¸è™•ç†ç­‰ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.3.2.4 æ¶ˆæ¯å”è­°</strong></h1><pre><code>/*** æ¶ˆæ¯å”è­°ï¼Œå®šç¾©ç·¨çµ„è«‹æ±‚ã€è§£çµ„è«‹æ±‚ã€ç·¨çµ„éŸ¿æ‡‰ã€è§£çµ„éŸ¿æ‡‰è¦ç¯„** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/publicÂ interfaceÂ MessageProtocolÂ {Â  Â /**Â  Â Â * ç·¨çµ„è«‹æ±‚Â  Â Â *Â  Â Â * @param req è«‹æ±‚ä¿¡æ¯Â  Â Â * @return è«‹æ±‚å­—ç¯€æ•¸çµ„Â  Â Â * @throws Exception ç·¨çµ„è«‹æ±‚ç•°å¸¸Â  Â Â */Â  Â byte[]Â marshallingRequest(LeisureRequestÂ req)Â throwsÂ Exception;Â  Â /**Â  Â Â * è§£çµ„è«‹æ±‚Â  Â Â *Â  Â Â * @param data è«‹æ±‚å­—ç¯€æ•¸çµ„Â  Â Â * @return è«‹æ±‚ä¿¡æ¯Â  Â Â * @throws Exception è§£çµ„è«‹æ±‚ç•°å¸¸Â  Â Â */Â  Â LeisureRequestÂ unmarshallingRequest(byte[]Â data)Â throwsÂ Exception;Â  Â /**Â  Â Â * ç·¨çµ„éŸ¿æ‡‰Â  Â Â *Â  Â Â * @param rsp éŸ¿æ‡‰ä¿¡æ¯Â  Â Â * @return éŸ¿æ‡‰å­—ç¯€æ•¸çµ„Â  Â Â * @throws Exception ç·¨çµ„éŸ¿æ‡‰ç•°å¸¸Â  Â Â */Â  Â byte[]Â marshallingResponse(LeisureResponseÂ rsp)Â throwsÂ Exception;Â  Â /**Â  Â Â * è§£çµ„éŸ¿æ‡‰Â  Â Â *Â  Â Â * @param data éŸ¿æ‡‰å­—ç¯€æ•¸çµ„Â  Â Â * @return éŸ¿æ‡‰ä¿¡æ¯Â  Â Â * @throws Exception è§£çµ„éŸ¿æ‡‰ç•°å¸¸Â  Â Â */Â  Â LeisureResponseÂ unmarshallingResponse(byte[]Â data)Â throwsÂ Exception;}/*** Javaåºåˆ—åŒ–æ¶ˆæ¯å”è­°** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/publicÂ classÂ JavaSerializeMessageProtocolÂ implementsÂ MessageProtocolÂ {Â  Â privateÂ byte[]Â serialize(ObjectÂ obj)Â throwsÂ ExceptionÂ {Â  Â  Â  Â ByteArrayOutputStreamÂ boutÂ =Â newÂ ByteArrayOutputStream();Â  Â  Â  Â ObjectOutputStreamÂ outÂ =Â newÂ ObjectOutputStream(bout);Â  Â  Â  Â out.writeObject(obj);Â  Â  Â  Â returnÂ bout.toByteArray();Â  }Â  Â @OverrideÂ  Â publicÂ byte[]Â marshallingRequest(LeisureRequestÂ req)Â throwsÂ ExceptionÂ {Â  Â  Â  Â returnÂ this.serialize(req);Â  }Â  Â @OverrideÂ  Â publicÂ LeisureRequestÂ unmarshallingRequest(byte[]Â data)Â throwsÂ ExceptionÂ {Â  Â  Â  Â ObjectInputStreamÂ inÂ =Â newÂ ObjectInputStream(newByteArrayInputStream(data));Â  Â  Â  Â returnÂ (LeisureRequest)Â in.readObject();Â  }Â  Â @OverrideÂ  Â publicÂ byte[]Â marshallingResponse(LeisureResponseÂ rsp)Â throwsÂ ExceptionÂ {Â  Â  Â  Â returnÂ this.serialize(rsp);Â  }Â  Â @OverrideÂ  Â publicÂ LeisureResponseÂ unmarshallingResponse(byte[]Â data)Â throwsÂ ExceptionÂ {Â  Â  Â  Â ObjectInputStreamÂ inÂ =Â newÂ ObjectInputStream(newByteArrayInputStream(data));Â  Â  Â  Â returnÂ (LeisureResponse)Â in.readObject();Â  }}</code></pre><p style=text-align:start>æ¶ˆæ¯å”è­°ä¸»è¦æ˜¯å®šç¾©äº†å®¢æˆ¶ç«¯å¦‚ä½•<strong>ç·¨çµ„è«‹æ±‚</strong>ã€<strong>è§£çµ„éŸ¿æ‡‰</strong>ï¼Œæœå‹™ç«¯å¦‚ä½•<strong>è§£çµ„è«‹æ±‚</strong>ã€<strong>ç·¨çµ„éŸ¿æ‡‰</strong>é€™å››å€‹æ“ä½œè¦ç¯„ã€‚æœ¬æ–‡æä¾›äº†Javaåºåˆ—åŒ–èˆ‡ååºåˆ—åŒ–çš„å¯¦ç¾ï¼Œæ„Ÿèˆˆè¶£çš„è®€è€…å¯ä»¥åŸºæ–¼å…¶ä»–åºåˆ—åŒ–æŠ€è¡“å¯¦ç¾å…¶ä»–æ¶ˆæ¯å”è­°ï¼ˆå·å·èªªä¸€å¥ï¼šJavaçš„åºåˆ—åŒ–æ€§èƒ½å¾ˆä¸ç†æƒ³ï¼‰ã€‚</p><p style=text-align:start><br></p><h1 class=pgc-h-arrow-right><strong>3.4 æœå‹™ç«¯ç·¨å¯«</strong></h1><h1 class=pgc-h-arrow-right><strong>3.4.1 æœå‹™ç«¯éœ€è¦åšä»€éº¼ï¼Ÿ</strong></h1><p style=text-align:start>é¦–å…ˆï¼Œæœå‹™ç«¯è¦æä¾›é ç¨‹æœå‹™ï¼Œå¿…é ˆå…·å‚™<strong>æœå‹™è¨»å†ŠåŠæš´éœ²</strong>çš„èƒ½åŠ›ï¼›åœ¨é€™ä¹‹å¾Œï¼Œé‚„éœ€è¦é–‹å•Ÿ<strong>ç¶²çµ¡æœå‹™</strong>ï¼Œä¾›å®¢æˆ¶ç«¯é€£æ¥ã€‚æœ‰äº›é …ç›®å¯èƒ½æ—¢æ˜¯æœå‹™æä¾›è€…ï¼Œåˆæ˜¯æœå‹™æ¶ˆè²»è€…ï¼Œé‚£ä»€éº¼æ™‚å€™é–‹å•Ÿæœå‹™ï¼Œä»€éº¼æ™‚å€™æ³¨å…¥æœå‹™å‘¢ï¼Ÿé€™è£¡æˆ‘å€‘å¼•å…¥ä¸€å€‹<strong>RPCè™•ç†è€…</strong>çš„æ¦‚å¿µï¼Œç”±å®ƒä¾†å¹«æˆ‘å€‘é–‹å•Ÿæœå‹™ï¼Œä»¥åŠæ³¨å…¥æœå‹™ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.4.3 å…·é«”å¯¦ç¾</strong></h1><p style=text-align:start>å…ˆçœ‹çœ‹æœå‹™ç«¯çš„ä»£ç¢¼çµæ§‹ï¼š</p><div class=pgc-img><img alt=åŒ…æ•™åŒ…æœƒï¼çœ‹äº†é€™ç¯‡ä½ å°±æœƒæ‰‹å¯«RPCæ¡†æ¶äº† onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6df64a1fc70b447da611d69af84df99c><p class=pgc-img-caption></p></div><p style=text-align:start>æœå‹™ç«¯åšçš„äº‹æƒ…ä¹Ÿå¾ˆç°¡å–®ï¼Œè¨»å†Šæœå‹™ä¸¦æš´éœ²æœå‹™ï¼Œç„¶å¾Œé–‹å•Ÿç¶²çµ¡æœå‹™ï¼›å¦‚æœæœå‹™ç«¯ä¹Ÿæ˜¯æ¶ˆè²»è€…ï¼Œå‰‡æ³¨å…¥é ç¨‹æœå‹™ã€‚</p><p style=text-align:start>æœå‹™è¨»å†Šå’Œæœå‹™æ³¨å…¥ä¾è³´å…©å€‹è‡ªå®šç¾©è¨»è§£ä¾†å¯¦ç¾ï¼š</p><ul><li>@Serviceï¼šè¨»å†Šæœå‹™</li><li>@InjectServiceï¼šæ³¨å…¥æœå‹™</li></ul><p style=text-align:start>ä¸‹é¢æ˜¯ä»–å€‘çš„å¯¦ç¾ä»£ç¢¼ï¼š</p><pre><code>/*** è¢«è©²è¨»è§£æ¨™è¨˜çš„æœå‹™å¯æä¾›é ç¨‹RPCè¨ªå•çš„èƒ½åŠ›** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/@Target({ElementType.TYPE})@Retention(RetentionPolicy.RUNTIME)@Documented@ComponentpublicÂ @interfaceÂ ServiceÂ {Â  Â StringÂ value()Â defaultÂ "";}/*** è©²è¨»è§£ç”¨æ–¼æ³¨å…¥é ç¨‹æœå‹™** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/@Target({ElementType.FIELD})@Retention(RetentionPolicy.RUNTIME)@DocumentedpublicÂ @interfaceÂ InjectServiceÂ {}</code></pre><h1 class=pgc-h-arrow-right><strong>3.4.3.1 æœå‹™è¨»å†Š(æš´éœ²)</strong></h1><pre><code>/*** æœå‹™è¨»å†Šå™¨ï¼Œå®šç¾©æœå‹™è¨»å†Šè¦ç¯„** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/publicÂ interfaceÂ ServiceRegisterÂ {Â  Â voidÂ register(ServiceObjectÂ so)Â throwsÂ Exception;Â  Â ServiceObjectÂ getServiceObject(StringÂ name)Â throwsÂ Exception;}/*** é»˜èªæœå‹™è¨»å†Šå™¨** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/publicÂ classÂ DefaultServiceRegisterÂ implementsÂ ServiceRegisterÂ {Â  Â privateÂ Map&lt;String,Â ServiceObject&gt;Â serviceMapÂ =Â newÂ HashMap&lt;&gt;();Â  Â protectedÂ StringÂ protocol;Â  Â protectedÂ IntegerÂ port;Â  Â @OverrideÂ  Â publicÂ voidÂ register(ServiceObjectÂ so)Â throwsÂ ExceptionÂ {Â  Â  Â  Â ifÂ (soÂ ==Â null) {Â  Â  Â  Â  Â  Â throwÂ newÂ IllegalArgumentException("Parameter cannot be empty.");Â  Â  Â  }Â  Â  Â  Â this.serviceMap.put(so.getName(),Â so);Â  }Â  Â @OverrideÂ  Â publicÂ ServiceObjectÂ getServiceObject(StringÂ name) {Â  Â  Â  Â returnÂ this.serviceMap.get(name);Â  }}/*** Zookeeperæœå‹™è¨»å†Šå™¨ï¼Œæä¾›æœå‹™è¨»å†Šã€æœå‹™æš´éœ²çš„èƒ½åŠ›** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/publicÂ classÂ ZookeeperExportServiceRegisterÂ extendsÂ DefaultServiceRegisterimplementsÂ ServiceRegisterÂ {Â  Â /**Â  Â Â * Zkå®¢æˆ¶ç«¯Â  Â Â */Â  Â privateÂ ZkClientÂ client;Â  Â publicÂ ZookeeperExportServiceRegister(StringÂ zkAddress,Â IntegerÂ port,Â Stringprotocol) {Â  Â  Â  Â clientÂ =Â newÂ ZkClient(zkAddress);Â  Â  Â  Â client.setZkSerializer(newÂ ZookeeperSerializer());Â  Â  Â  Â this.portÂ =Â port;Â  Â  Â  Â this.protocolÂ =Â protocol;Â  }Â  Â /**Â  Â Â * æœå‹™è¨»å†ŠÂ  Â Â *Â  Â Â * @param so æœå‹™æŒæœ‰è€…Â  Â Â * @throws Exception è¨»å†Šç•°å¸¸Â  Â Â */Â  Â @OverrideÂ  Â publicÂ voidÂ register(ServiceObjectÂ so)Â throwsÂ ExceptionÂ {Â  Â  Â  Â super.register(so);Â  Â  Â  Â ServiceÂ serviceÂ =Â newÂ Service();Â  Â  Â  Â StringÂ hostÂ =Â InetAddress.getLocalHost().getHostAddress();Â  Â  Â  Â StringÂ addressÂ =Â hostÂ +Â ":"Â +Â port;Â  Â  Â  Â service.setAddress(address);Â  Â  Â  Â service.setName(so.getClazz().getName());Â  Â  Â  Â service.setProtocol(protocol);Â  Â  Â  Â this.exportService(service);Â  }Â  Â /**Â  Â Â * æœå‹™æš´éœ²Â  Â Â *Â  Â Â * @param serviceResource éœ€è¦æš´éœ²çš„æœå‹™ä¿¡æ¯Â  Â Â */Â  Â privateÂ voidÂ exportService(ServiceÂ serviceResource) {Â  Â  Â  Â StringÂ serviceNameÂ =Â serviceResource.getName();Â  Â  Â  Â StringÂ uriÂ =Â JSON.toJSONString(serviceResource);Â  Â  Â  Â tryÂ {Â  Â  Â  Â  Â  Â uriÂ =Â URLEncoder.encode(uri,Â UTF_8);Â  Â  Â  }Â catchÂ (UnsupportedEncodingExceptionÂ e) {Â  Â  Â  Â  Â  Â e.printStackTrace();Â  Â  Â  }Â  Â  Â  Â StringÂ servicePathÂ =Â ZK_SERVICE_PATHÂ +Â PATH_DELIMITERÂ +Â serviceNameÂ +"/service";Â  Â  Â  Â ifÂ (!client.exists(servicePath)) {Â  Â  Â  Â  Â  Â client.createPersistent(servicePath,Â true);Â  Â  Â  }Â  Â  Â  Â StringÂ uriPathÂ =Â servicePathÂ +Â PATH_DELIMITERÂ +Â uri;Â  Â  Â  Â ifÂ (client.exists(uriPath)) {Â  Â  Â  Â  Â  Â client.delete(uriPath);Â  Â  Â  }Â  Â  Â  Â client.createEphemeral(uriPath);Â  }}</code></pre><p style=text-align:start>é€™å€‹éç¨‹å…¶å¯¦æ²’å•¥å¥½èªªçš„ï¼Œå°±æ˜¯å°‡æŒ‡å®šServiceObjectå°è±¡åºåˆ—åŒ–å¾Œä¿å­˜åˆ°ZKä¸Šï¼Œä¾›å®¢æˆ¶ç«¯ç™¼ç¾ã€‚åŒæ™‚æœƒå°‡æœå‹™å°è±¡ç·©å­˜èµ·ä¾†ï¼Œåœ¨å®¢æˆ¶ç«¯èª¿ç”¨æœå‹™æ™‚ï¼Œé€šéç·©å­˜çš„ServiceObjectå°è±¡åå°„æŒ‡å®šæœå‹™ï¼Œèª¿ç”¨æ–¹æ³•ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.4.3.2 ç¶²çµ¡æœå‹™</strong></h1><pre><code>/*** RPCæœå‹™ç«¯æŠ½è±¡é¡** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/publicÂ abstractÂ classÂ RpcServerÂ {Â  Â /**Â  Â Â * æœå‹™ç«¯å£Â  Â Â */Â  Â protectedÂ intÂ port;Â  Â /**Â  Â Â * æœå‹™å”è­°Â  Â Â */Â  Â protectedÂ StringÂ protocol;Â  Â /**Â  Â Â * è«‹æ±‚è™•ç†è€…Â  Â Â */Â  Â protectedÂ RequestHandlerÂ handler;Â  Â publicÂ RpcServer(intÂ port,Â StringÂ protocol,Â RequestHandlerÂ handler) {Â  Â  Â  Â super();Â  Â  Â  Â this.portÂ =Â port;Â  Â  Â  Â this.protocolÂ =Â protocol;Â  Â  Â  Â this.handlerÂ =Â handler;Â  }Â  Â /**Â  Â Â * é–‹å•Ÿæœå‹™Â  Â Â */Â  Â publicÂ abstractÂ voidÂ start();Â  Â /**Â  Â Â * åœæ­¢æœå‹™Â  Â Â */Â  Â publicÂ abstractÂ voidÂ stop();// getter setter ...}/*** Netty RPCæœå‹™ç«¯ï¼Œæä¾›Nettyç¶²çµ¡æœå‹™é–‹å•Ÿã€é—œé–‰çš„èƒ½åŠ›** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/publicÂ classÂ NettyRpcServerÂ extendsÂ RpcServerÂ {Â  Â privateÂ staticÂ LoggerÂ loggerÂ =Â LoggerFactory.getLogger(NettyRpcServer.class);Â  Â privateÂ ChannelÂ channel;Â  Â publicÂ NettyRpcServer(intÂ port,Â StringÂ protocol,Â RequestHandlerÂ handler) {Â  Â  Â  Â super(port,Â protocol,Â handler);Â  }Â  Â @OverrideÂ  Â publicÂ voidÂ start() {Â  Â  Â  Â // é…ç½®æœå‹™å™¨Â  Â  Â  Â EventLoopGroupÂ bossGroupÂ =Â newÂ NioEventLoopGroup(1);Â  Â  Â  Â EventLoopGroupÂ workerGroupÂ =Â newÂ NioEventLoopGroup();Â  Â  Â  Â tryÂ {Â  Â  Â  Â  Â  Â ServerBootstrapÂ bÂ =Â newÂ ServerBootstrap();Â  Â  Â  Â  Â  Â b.group(bossGroup,workerGroup).channel(NioServerSocketChannel.class).option(ChannelOption.SO_BACKLOG,Â 100)Â  Â  Â  Â  Â  Â  Â  Â  Â  .handler(newÂ LoggingHandler(LogLevel.INFO)).childHandler(newChannelInitializer&lt;SocketChannel&gt;() {Â  Â  Â  Â  Â  Â  Â  Â @OverrideÂ  Â  Â  Â  Â  Â  Â  Â publicÂ voidÂ initChannel(SocketChannelÂ ch) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ChannelPipelineÂ pÂ =Â ch.pipeline();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â p.addLast(newÂ ChannelRequestHandler());Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â // å•Ÿå‹•æœå‹™Â  Â  Â  Â  Â  Â ChannelFutureÂ fÂ =Â b.bind(port).sync();Â  Â  Â  Â  Â  Â logger.info("Server started successfully.");Â  Â  Â  Â  Â  Â channelÂ =Â f.channel();Â  Â  Â  Â  Â  Â // ç­‰å¾…æœå‹™é€šé“é—œé–‰Â  Â  Â  Â  Â  Â f.channel().closeFuture().sync();Â  Â  Â  }Â catchÂ (ExceptionÂ e) {Â  Â  Â  Â  Â  Â e.printStackTrace();Â  Â  Â  }Â finallyÂ {Â  Â  Â  Â  Â  Â // é‡‹æ”¾ç·šç¨‹çµ„è³‡æºÂ  Â  Â  Â  Â  Â bossGroup.shutdownGracefully();Â  Â  Â  Â  Â  Â workerGroup.shutdownGracefully();Â  Â  Â  }Â  }Â  Â @OverrideÂ  Â publicÂ voidÂ stop() {Â  Â  Â  Â this.channel.close();Â  }Â  Â privateÂ classÂ ChannelRequestHandlerÂ extendsÂ ChannelInboundHandlerAdapterÂ {Â  Â  Â  Â @OverrideÂ  Â  Â  Â publicÂ voidÂ channelActive(ChannelHandlerContextÂ ctx) {Â  Â  Â  Â  Â  Â logger.info("Channel activeï¼š{}",Â ctx);Â  Â  Â  }Â  Â  Â  Â @OverrideÂ  Â  Â  Â publicÂ voidÂ channelRead(ChannelHandlerContextÂ ctx,Â ObjectÂ msg)Â throwsExceptionÂ {Â  Â  Â  Â  Â  Â logger.info("The server receives a message: {}",Â msg);Â  Â  Â  Â  Â  Â ByteBufÂ msgBufÂ =Â (ByteBuf)Â msg;Â  Â  Â  Â  Â  Â byte[]Â reqÂ =Â newÂ byte[msgBuf.readableBytes()];Â  Â  Â  Â  Â  Â msgBuf.readBytes(req);Â  Â  Â  Â  Â  Â byte[]Â resÂ =Â handler.handleRequest(req);Â  Â  Â  Â  Â  Â logger.info("Send responseï¼š{}",Â msg);Â  Â  Â  Â  Â  Â ByteBufÂ respBufÂ =Â Unpooled.buffer(res.length);Â  Â  Â  Â  Â  Â respBuf.writeBytes(res);Â  Â  Â  Â  Â  Â ctx.write(respBuf);Â  Â  Â  }Â  Â  Â  Â @OverrideÂ  Â  Â  Â publicÂ voidÂ channelReadComplete(ChannelHandlerContextÂ ctx) {Â  Â  Â  Â  Â  Â ctx.flush();Â  Â  Â  }Â  Â  Â  Â @OverrideÂ  Â  Â  Â publicÂ voidÂ exceptionCaught(ChannelHandlerContextÂ ctx,Â ThrowableÂ cause) {Â  Â  Â  Â  Â  Â // Close the connection when an exception is raised.Â  Â  Â  Â  Â  Â cause.printStackTrace();Â  Â  Â  Â  Â  Â logger.error("Exception occurredï¼š{}",Â cause.getMessage());Â  Â  Â  Â  Â  Â ctx.close();Â  Â  Â  }Â  }}/*** è«‹æ±‚è™•ç†è€…ï¼Œæä¾›è§£çµ„è«‹æ±‚ã€ç·¨çµ„éŸ¿æ‡‰ç­‰æ“ä½œ** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/publicÂ classÂ RequestHandlerÂ {Â  Â privateÂ MessageProtocolÂ protocol;Â  Â privateÂ ServiceRegisterÂ serviceRegister;Â  Â publicÂ RequestHandler(MessageProtocolÂ protocol,Â ServiceRegisterÂ serviceRegister) {Â  Â  Â  Â super();Â  Â  Â  Â this.protocolÂ =Â protocol;Â  Â  Â  Â this.serviceRegisterÂ =Â serviceRegister;Â  }Â  Â publicÂ byte[]Â handleRequest(byte[]Â data)Â throwsÂ ExceptionÂ {Â  Â  Â  Â // 1ã€è§£çµ„æ¶ˆæ¯Â  Â  Â  Â LeisureRequestÂ reqÂ =Â this.protocol.unmarshallingRequest(data);Â  Â  Â  Â // 2ã€æŸ¥æ‰¾æœå‹™å°è±¡Â  Â  Â  Â ServiceObjectÂ soÂ =Â this.serviceRegister.getServiceObject(req.getServiceName());Â  Â  Â  Â LeisureResponseÂ rspÂ =Â null;Â  Â  Â  Â ifÂ (soÂ ==Â null) {Â  Â  Â  Â  Â  Â rspÂ =Â newÂ LeisureResponse(LeisureStatus.NOT_FOUND);Â  Â  Â  }Â elseÂ {Â  Â  Â  Â  Â  Â // 3ã€åå°„èª¿ç”¨å°æ‡‰çš„éç¨‹æ–¹æ³•Â  Â  Â  Â  Â  Â tryÂ {Â  Â  Â  Â  Â  Â  Â  Â MethodÂ mÂ =Â so.getClazz().getMethod(req.getMethod(),req.getParameterTypes());Â  Â  Â  Â  Â  Â  Â  Â ObjectÂ returnValueÂ =Â m.invoke(so.getObj(),Â req.getParameters());Â  Â  Â  Â  Â  Â  Â  Â rspÂ =Â newÂ LeisureResponse(LeisureStatus.SUCCESS);Â  Â  Â  Â  Â  Â  Â  Â rsp.setReturnValue(returnValue);Â  Â  Â  Â  Â  }Â catchÂ (NoSuchMethodExceptionÂ |Â SecurityExceptionÂ |Â IllegalAccessExceptionÂ |IllegalArgumentExceptionÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â |Â InvocationTargetExceptionÂ e) {Â  Â  Â  Â  Â  Â  Â  Â rspÂ =Â newÂ LeisureResponse(LeisureStatus.ERROR);Â  Â  Â  Â  Â  Â  Â  Â rsp.setException(e);Â  Â  Â  Â  Â  }Â  Â  Â  }Â  Â  Â  Â // 4ã€ç·¨çµ„éŸ¿æ‡‰æ¶ˆæ¯Â  Â  Â  Â returnÂ this.protocol.marshallingResponse(rsp);Â  }// getter setter ...}</code></pre><p style=text-align:start>ç¶²çµ¡æœå‹™å®šç¾©äº†å•Ÿå‹•æœå‹™çš„ç´°å‰‡ï¼Œä»¥åŠå¦‚ä½•è™•ç†å®¢æˆ¶ç«¯ç™¼ä¾†çš„è«‹æ±‚ã€‚</p><h1 class=pgc-h-arrow-right><strong>3.4.3.3 RPCè™•ç†è€…</strong></h1><pre><code>/*** RPCè™•ç†è€…ï¼Œæ”¯æŒæœå‹™å•Ÿå‹•æš´éœ²ã€è‡ªå‹•æ³¨å…¥Service** @author æ±æ–¹é›¨å‚¾* @since 1.0.0*/publicÂ classÂ DefaultRpcProcessorÂ implementsApplicationListener&lt;ContextRefreshedEvent&gt;Â {Â  Â @ResourceÂ  Â privateÂ ClientProxyFactoryÂ clientProxyFactory;Â  Â @ResourceÂ  Â privateÂ ServiceRegisterÂ serviceRegister;Â  Â @ResourceÂ  Â privateÂ RpcServerÂ rpcServer;Â  Â @OverrideÂ  Â publicÂ voidÂ onApplicationEvent(ContextRefreshedEventÂ event) {Â  Â  Â  Â ifÂ (Objects.isNull(event.getApplicationContext().getParent())) {Â  Â  Â  Â  Â  Â ApplicationContextÂ contextÂ =Â event.getApplicationContext();Â  Â  Â  Â  Â  Â // é–‹å•Ÿæœå‹™Â  Â  Â  Â  Â  Â startServer(context);Â  Â  Â  Â  Â  Â // æ³¨å…¥ServiceÂ  Â  Â  Â  Â  Â injectService(context);Â  Â  Â  }Â  }Â  Â privateÂ voidÂ startServer(ApplicationContextÂ context) {Â  Â  Â  Â Map&lt;String,Â Object&gt;Â beansÂ =Â context.getBeansWithAnnotation(Service.class);Â  Â  Â  Â ifÂ (beans.size()Â !=Â 0) {Â  Â  Â  Â  Â  Â booleanÂ startServerFlagÂ =Â true;Â  Â  Â  Â  Â  Â forÂ (ObjectÂ objÂ :Â beans.values()) {Â  Â  Â  Â  Â  Â  Â  Â tryÂ {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Class&lt;?&gt;Â clazzÂ =Â obj.getClass();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Class&lt;?&gt;[]Â interfacesÂ =Â clazz.getInterfaces();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ServiceObjectÂ so;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ifÂ (interfaces.lengthÂ !=Â 1) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ServiceÂ serviceÂ =Â clazz.getAnnotation(Service.class);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â StringÂ valueÂ =Â service.value();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ifÂ (value.equals("")) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â startServerFlagÂ =Â false;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â throwÂ newÂ UnsupportedOperationException("The exposed interface is not specific with '"Â +Â obj.getClass().getName()Â +Â "'");Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â soÂ =Â newÂ ServiceObject(value,Â Class.forName(value),Â obj);Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â elseÂ {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Class&lt;?&gt;Â superClassÂ =Â interfaces[0];Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â soÂ =Â newÂ ServiceObject(superClass.getName(),Â superClass,Â obj);Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â serviceRegister.register(so);Â  Â  Â  Â  Â  Â  Â  }Â catchÂ (ExceptionÂ e) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â e.printStackTrace();Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â ifÂ (startServerFlag) {Â  Â  Â  Â  Â  Â  Â  Â rpcServer.start();Â  Â  Â  Â  Â  }Â  Â  Â  }Â  }Â  Â privateÂ voidÂ injectService(ApplicationContextÂ context) {Â  Â  Â  Â String[]Â namesÂ =Â context.getBeanDefinitionNames();Â  Â  Â  Â forÂ (StringÂ nameÂ :Â names) {Â  Â  Â  Â  Â  Â Class&lt;?&gt;Â clazzÂ =Â context.getType(name);Â  Â  Â  Â  Â  Â ifÂ (Objects.isNull(clazz))Â continue;Â  Â  Â  Â  Â  Â Field[]Â fieldsÂ =Â clazz.getDeclaredFields();Â  Â  Â  Â  Â  Â forÂ (FieldÂ fieldÂ :Â fields) {Â  Â  Â  Â  Â  Â  Â  Â InjectServiceÂ injectLeisureÂ =Â field.getAnnotation(InjectService.class);Â  Â  Â  Â  Â  Â  Â  Â ifÂ (Objects.isNull(injectLeisure))Â continue;Â  Â  Â  Â  Â  Â  Â  Â Class&lt;?&gt;Â fieldClassÂ =Â field.getType();Â  Â  Â  Â  Â  Â  Â  Â ObjectÂ objectÂ =Â context.getBean(name);Â  Â  Â  Â  Â  Â  Â  Â field.setAccessible(true);Â  Â  Â  Â  Â  Â  Â  Â tryÂ {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â field.set(object,Â clientProxyFactory.getProxy(fieldClass));Â  Â  Â  Â  Â  Â  Â  }Â catchÂ (IllegalAccessExceptionÂ e) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â e.printStackTrace();Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  }Â  Â  Â  }Â  }}</code></pre><p style=text-align:start>DefaultRpcProcessorå¯¦ç¾äº†ApplicationListenerï¼Œä¸¦ç›£è½äº†ContextRefreshedEventäº‹ä»¶ï¼Œå…¶æ•ˆæœå°±æ˜¯åœ¨Springå•Ÿå‹•å®Œç•¢éå¾Œæœƒæ”¶åˆ°ä¸€å€‹äº‹ä»¶é€šçŸ¥ï¼ŒåŸºæ–¼é€™å€‹æ©Ÿåˆ¶ï¼Œå°±å¯ä»¥åœ¨é€™è£¡é–‹å•Ÿæœå‹™ï¼Œä»¥åŠæ³¨å…¥æœå‹™ã€‚å› ç‚ºä¸€åˆ‡å·²ç¶“æº–å‚™å°±ç·’äº†ï¼Œæ‰€éœ€è¦çš„è³‡æºéƒ½æ˜¯OKçš„ã€‚</p><p style=text-align:start><br></p><h1 class=pgc-h-arrow-right><strong>å››ã€ä½¿ç”¨RPCæ¡†æ¶</strong></h1><p style=text-align:start>æ¡†æ¶ä¸€å€‹å¾ˆé‡è¦çš„ç‰¹æ€§å°±æ˜¯è¦ä½¿ç”¨ç°¡å–®ï¼Œä½¿ç”¨è©²æ¡†æ¶åªéœ€è¦ä¸€å€‹æ¢ä»¶å’Œå››å€‹æ­¥é©Ÿå³å¯ã€‚</p><h1 class=pgc-h-arrow-right><strong>4.1 ä¸€å€‹æ¢ä»¶</strong></h1><p style=text-align:start>éœ€è¦æº–å‚™ä¸€å€‹Zookeeperä½œç‚ºè¨»å†Šä¸­å¿ƒï¼Œå–®ç¯€é»å³å¯ã€‚</p><h1 class=pgc-h-arrow-right><strong>4.2 æ­¥é©Ÿä¸€</strong></h1><p style=text-align:start>å¼•å…¥Mavenä¾è³´ï¼š</p><pre><code>&lt;dependency&gt;Â  Â &lt;groupId&gt;wang.leisure&lt;/groupId&gt;Â  Â &lt;artifactId&gt;leisure-rpc-spring-boot-starter&lt;/artifactId&gt;Â  Â &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt;</code></pre><blockquote><p>ä¸çŸ¥é“å¦‚ä½•ç²å¾—ä¾è³´çš„è®€è€…ï¼Œè«‹åœ¨æºç¢¼ä¸‹è¼‰å¾Œï¼Œé€²å…¥é …ç›®ç›®éŒ„ä¸‹ï¼ˆpom.xmlæ–‡ä»¶æ‰€åœ¨ä½ç½®ï¼‰ï¼ŒåŸ·è¡Œ mvn installå‘½ä»¤ï¼Œå³å¯åœ¨æœ¬åœ°å€‰åº«ç”Ÿæˆmavenä¾è³´ã€‚</p></blockquote><h1 class=pgc-h-arrow-right><strong>4.3 æ­¥é©ŸäºŒ</strong></h1><p style=text-align:start>åœ¨ä½ çš„é …ç›®é…ç½®æ–‡ä»¶ï¼ˆapplication.propertiesï¼‰ä¸­é…ç½®è¨»å†Šä¸­å¿ƒåœ°å€ï¼Œä¾‹å¦‚ï¼š</p><pre><code>leisure.rpc.register-address=192.168.199.241:2181</code></pre><h1 class=pgc-h-arrow-right><strong>4.4 æ­¥é©Ÿä¸‰</strong></h1><p style=text-align:start>å°‡ä½ çš„é ç¨‹æœå‹™ä½¿ç”¨@Serviceè¨»è§£ï¼Œä¾‹å¦‚ï¼š</p><pre><code>importÂ wang.leisure.rpc.annotation.Service;@ServicepublicÂ classÂ UserServiceImplÂ implementsÂ UserServiceÂ {Â  Â @OverrideÂ  Â publicÂ ApiResult&lt;User&gt;Â getUser(LongÂ id) {Â  Â  Â  Â UserÂ userÂ =Â getFromDbOrCache(id);Â  Â  Â  Â returnÂ ApiResult.success(user);Â  }Â  Â privateÂ UserÂ getFromDbOrCache(LongÂ id) {Â  Â  Â  Â returnÂ newÂ User(id,Â "æ±æ–¹é›¨å‚¾",Â 1,Â "https://leisure.wang");Â  }}</code></pre><h1 class=pgc-h-arrow-right><strong>4.5 æ­¥é©Ÿå››</strong></h1><p style=text-align:start>ä½¿ç”¨è¨»è§£@InjectServiceæ³¨å…¥é ç¨‹æœå‹™ï¼Œä¾‹å¦‚ï¼š</p><pre><code>@RestController@RequestMapping("/index/")publicÂ classÂ IndexControllerÂ {Â  Â @InjectServiceÂ  Â privateÂ UserServiceÂ userService;Â  Â /**Â  Â Â * ç²å–ç”¨æˆ¶ä¿¡æ¯Â  Â Â * http://localhost:8080/index/getUser?id=1Â  Â Â *Â  Â Â * @param id ç”¨æˆ¶idÂ  Â Â * @return ç”¨æˆ¶ä¿¡æ¯Â  Â Â */Â  Â @GetMapping("getUser")Â  Â publicÂ ApiResult&lt;User&gt;Â getUser(LongÂ id) {Â  Â  Â  Â returnÂ userService.getUser(id);Â  }}</code></pre><h1 class=pgc-h-arrow-right><strong>äº”ã€æºç¢¼ä¸‹è¼‰</strong></h1><p style=text-align:start>æ¡†æ¶æºç¢¼ï¼š<u>https://github.com/OakWang/leisure-rpc-spring-boot-starter.git</u></p><p style=text-align:start>ç¤ºä¾‹æºç¢¼ï¼š<u>https://github.com/OakWang/leisure-rpc-example.git</u></p><h1 class=pgc-h-arrow-right><strong>å…­ã€ç¸½çµ</strong></h1><p>å¸Œæœ›è®€è€…èƒ½å¤ çœŸæ­£å‹•æ‰‹å»è©¦ä¸€è©¦ï¼Œåªæœ‰å¯¦è¸äº†æ‰èƒ½çŸ¥é“é‡Œé¢çš„é‹ä½œé‚è¼¯ã€‚ç­†è€…ä¹Ÿæ˜¯èŠ±äº†å…©å€‹æ˜ŸæœŸæ‰æŠŠä»£ç¢¼è·Ÿæ–‡ç« æ•´ç†å¥½ï¼Œä¸¦ä¸æ˜¯å› ç‚ºé€™å€‹æ±è¥¿é›£ï¼Œè€Œæ˜¯å› ç‚ºæ²’æ™‚é–“ï¼Œè‹¦é€¼çš„ç¨‹åºçŒ¿</p><p>å¦‚æœæ–‡ç« å°ä½ æœ‰å¹«åŠ©ï¼Œå¸Œæœ›å¤šå¤šæ”¯æŒã€‚</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>åŒ…æ•™</a></li><li><a>åŒ…æœƒ</a></li><li><a>é€™ç¯‡</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/8a8b2e0.html alt=åŒ…æ•™åŒ…æœƒï¼šç ‚æ¼¿è©¦å¡Šå¦‚ä½•å–æ¨£ã€è£½ä½œã€é¤Šè­·ã€è©¦é©—ã€è©•å®šï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/1cec45dcf92d4020b7f231b7fe521b23 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8a8b2e0.html title=åŒ…æ•™åŒ…æœƒï¼šç ‚æ¼¿è©¦å¡Šå¦‚ä½•å–æ¨£ã€è£½ä½œã€é¤Šè­·ã€è©¦é©—ã€è©•å®šï¼Ÿ>åŒ…æ•™åŒ…æœƒï¼šç ‚æ¼¿è©¦å¡Šå¦‚ä½•å–æ¨£ã€è£½ä½œã€é¤Šè­·ã€è©¦é©—ã€è©•å®šï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/647d835d.html alt=çœŸæ­£â€œé›¶åŸºç¤â€çš„æ°´é›»æ”¹é€ ï¼Œçœ‹å®Œé€™ç¯‡å°±å¤ äº† class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/fbeb6fb2-d305-4fd6-a231-0574538df212 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/647d835d.html title=çœŸæ­£â€œé›¶åŸºç¤â€çš„æ°´é›»æ”¹é€ ï¼Œçœ‹å®Œé€™ç¯‡å°±å¤ äº†>çœŸæ­£â€œé›¶åŸºç¤â€çš„æ°´é›»æ”¹é€ ï¼Œçœ‹å®Œé€™ç¯‡å°±å¤ äº†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3136e082.html alt="é–‹å­¸é˜²è­·çœ‹é€™ç¯‡ï¼Œ1 è¬ä»½å£ç½©ç­‰é˜²è­·è£å‚™ï¼Œ9.9 å…ƒç§’" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/S71cGv9EsUW6QK style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3136e082.html title="é–‹å­¸é˜²è­·çœ‹é€™ç¯‡ï¼Œ1 è¬ä»½å£ç½©ç­‰é˜²è­·è£å‚™ï¼Œ9.9 å…ƒç§’">é–‹å­¸é˜²è­·çœ‹é€™ç¯‡ï¼Œ1 è¬ä»½å£ç½©ç­‰é˜²è­·è£å‚™ï¼Œ9.9 å…ƒç§’</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9d028021.html alt=å¦‚ä½•æ›´å¥½çš„ä½¿ç”¨Javaç•°å¸¸ï¼Œçœ‹é€™ç¯‡å°±å°äº† class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d68c79ce68d041fe814db22f4dbe74bc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9d028021.html title=å¦‚ä½•æ›´å¥½çš„ä½¿ç”¨Javaç•°å¸¸ï¼Œçœ‹é€™ç¯‡å°±å°äº†>å¦‚ä½•æ›´å¥½çš„ä½¿ç”¨Javaç•°å¸¸ï¼Œçœ‹é€™ç¯‡å°±å°äº†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f2fa7b83.html alt="çœ‹å®Œé€™ç¯‡Exception å’Œ Errorï¼Œå’Œé¢è©¦å®˜æ‰¯çš®å°±æ²’å•é¡Œäº†" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c9bb7006f740478c8f6ce97dce25a688 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f2fa7b83.html title="çœ‹å®Œé€™ç¯‡Exception å’Œ Errorï¼Œå’Œé¢è©¦å®˜æ‰¯çš®å°±æ²’å•é¡Œäº†">çœ‹å®Œé€™ç¯‡Exception å’Œ Errorï¼Œå’Œé¢è©¦å®˜æ‰¯çš®å°±æ²’å•é¡Œäº†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/63721d0a.html alt=çœ‹å®Œé€™ç¯‡ä¹¾è²¨åˆ†äº«ï¼Œè®“æ»‘å¡ç›£æ¸¬æ›´è¼•é¬† class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/25931a2b682d4ad2bf98026edfd1cb64 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/63721d0a.html title=çœ‹å®Œé€™ç¯‡ä¹¾è²¨åˆ†äº«ï¼Œè®“æ»‘å¡ç›£æ¸¬æ›´è¼•é¬†>çœ‹å®Œé€™ç¯‡ä¹¾è²¨åˆ†äº«ï¼Œè®“æ»‘å¡ç›£æ¸¬æ›´è¼•é¬†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9dab105f.html alt=ä¸åŒçš„çšºç´‹è­·ç†æ–¹æ³•ï¼Œé€™ç¯‡çµ±çµ±å‘Šè¨´ä½  class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/297e9d41def741dd94c4fa78c39cadaf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9dab105f.html title=ä¸åŒçš„çšºç´‹è­·ç†æ–¹æ³•ï¼Œé€™ç¯‡çµ±çµ±å‘Šè¨´ä½ >ä¸åŒçš„çšºç´‹è­·ç†æ–¹æ³•ï¼Œé€™ç¯‡çµ±çµ±å‘Šè¨´ä½ </a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6c91b9b3.html alt=ã€æ”»ç•¥åˆ†äº«ã€‘æ¬å®¶9æ¬¡ï¼Œè‰¯å¿ƒæ•´ç†å‡ºé€™ç¯‡æ¬å®¶æŠ€å·§ï¼ˆå…§é™„æ¬å®¶ç¥å™¨ï¼‰ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f11d3f579b1c4e25ae756fd81c4c7b65 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6c91b9b3.html title=ã€æ”»ç•¥åˆ†äº«ã€‘æ¬å®¶9æ¬¡ï¼Œè‰¯å¿ƒæ•´ç†å‡ºé€™ç¯‡æ¬å®¶æŠ€å·§ï¼ˆå…§é™„æ¬å®¶ç¥å™¨ï¼‰>ã€æ”»ç•¥åˆ†äº«ã€‘æ¬å®¶9æ¬¡ï¼Œè‰¯å¿ƒæ•´ç†å‡ºé€™ç¯‡æ¬å®¶æŠ€å·§ï¼ˆå…§é™„æ¬å®¶ç¥å™¨ï¼‰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f615acc6.html alt=æ¬å®¶5æ¬¡ï¼Œæ•´ç†å‡ºçš„é€™ç¯‡è‰¯å¿ƒæ¬å®¶æŠ€å·§ï¼Œä½ æ‡‰è©²æ”¶è— class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c7cb17415a4640a19f01cb736489950c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f615acc6.html title=æ¬å®¶5æ¬¡ï¼Œæ•´ç†å‡ºçš„é€™ç¯‡è‰¯å¿ƒæ¬å®¶æŠ€å·§ï¼Œä½ æ‡‰è©²æ”¶è—>æ¬å®¶5æ¬¡ï¼Œæ•´ç†å‡ºçš„é€™ç¯‡è‰¯å¿ƒæ¬å®¶æŠ€å·§ï¼Œä½ æ‡‰è©²æ”¶è—</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3b6526c7.html alt=æ¬å®¶6æ¬¡ï¼Œè‰¯å¿ƒæ•´ç†å‡ºçš„é€™ç¯‡æ¬å®¶æ”»ç•¥ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/52a57683-0d8c-4853-954c-5e1d9b62634f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3b6526c7.html title=æ¬å®¶6æ¬¡ï¼Œè‰¯å¿ƒæ•´ç†å‡ºçš„é€™ç¯‡æ¬å®¶æ”»ç•¥>æ¬å®¶6æ¬¡ï¼Œè‰¯å¿ƒæ•´ç†å‡ºçš„é€™ç¯‡æ¬å®¶æ”»ç•¥</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c436c7e9.html alt=æ™ºèƒ½é–€é–å¦‚ä½•é¸ï¼Ÿçœ‹å®Œé€™ç¯‡å°±å¤ äº† class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ea74dbcd9a8245d59c662e7c38b2799b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c436c7e9.html title=æ™ºèƒ½é–€é–å¦‚ä½•é¸ï¼Ÿçœ‹å®Œé€™ç¯‡å°±å¤ äº†>æ™ºèƒ½é–€é–å¦‚ä½•é¸ï¼Ÿçœ‹å®Œé€™ç¯‡å°±å¤ äº†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e896d220.html alt=å·®é€Ÿå™¨å’Œè®Šé€Ÿç®±ï¼ŒåŠŸèƒ½ä¸€æ¨£å—ï¼Ÿçœ‹äº†é€™ç¯‡ä¸å†å‚»å‚»åˆ†ä¸æ¸… class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/863d559592d04f168a6567fd5cd54d3c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e896d220.html title=å·®é€Ÿå™¨å’Œè®Šé€Ÿç®±ï¼ŒåŠŸèƒ½ä¸€æ¨£å—ï¼Ÿçœ‹äº†é€™ç¯‡ä¸å†å‚»å‚»åˆ†ä¸æ¸…>å·®é€Ÿå™¨å’Œè®Šé€Ÿç®±ï¼ŒåŠŸèƒ½ä¸€æ¨£å—ï¼Ÿçœ‹äº†é€™ç¯‡ä¸å†å‚»å‚»åˆ†ä¸æ¸…</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2389dc8c.html alt=æ¬„æ†çš„4å¤§æ¬¾å¼ï¼Œ5å¤§åˆ†é¡ï¼çœ‹å®Œé€™ç¯‡ï¼Œé¸ææ™‚å°±æœ‰æ•¸äº† class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e2bbe70bd5a74b9c8dd318d465aaa6bc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2389dc8c.html title=æ¬„æ†çš„4å¤§æ¬¾å¼ï¼Œ5å¤§åˆ†é¡ï¼çœ‹å®Œé€™ç¯‡ï¼Œé¸ææ™‚å°±æœ‰æ•¸äº†>æ¬„æ†çš„4å¤§æ¬¾å¼ï¼Œ5å¤§åˆ†é¡ï¼çœ‹å®Œé€™ç¯‡ï¼Œé¸ææ™‚å°±æœ‰æ•¸äº†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e6939e5f.html alt=çœ‹äº†é€™ç¯‡å°±çŸ¥é“å¦‚ä½•é–‹ç™¼ä¸€å€‹å„ªç§€çš„API class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e6939e5f.html title=çœ‹äº†é€™ç¯‡å°±çŸ¥é“å¦‚ä½•é–‹ç™¼ä¸€å€‹å„ªç§€çš„API>çœ‹äº†é€™ç¯‡å°±çŸ¥é“å¦‚ä½•é–‹ç™¼ä¸€å€‹å„ªç§€çš„API</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/72599eab.html alt=ç´«å¤–ç·šæ®ºèŒä½ ç­è§£å¤šå°‘?çœ‹å®Œé€™ç¯‡BBCçš„å ±é“å°±çŸ¥é“äº† class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/f0747b6e-83b3-4415-83d0-863015470c16 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/72599eab.html title=ç´«å¤–ç·šæ®ºèŒä½ ç­è§£å¤šå°‘?çœ‹å®Œé€™ç¯‡BBCçš„å ±é“å°±çŸ¥é“äº†>ç´«å¤–ç·šæ®ºèŒä½ ç­è§£å¤šå°‘?çœ‹å®Œé€™ç¯‡BBCçš„å ±é“å°±çŸ¥é“äº†</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>