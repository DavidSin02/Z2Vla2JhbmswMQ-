<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>騰訊開源TurboTransformers,推理加速性能超TensorRT主流優化引擎 | 极客快訊</title><meta property="og:title" content="騰訊開源TurboTransformers,推理加速性能超TensorRT主流優化引擎 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/42922a5c526a463294f0a5f08a2ee281"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/083e83e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/083e83e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/083e83e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/083e83e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/083e83e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/083e83e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/083e83e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/083e83e.html><meta property="article:published_time" content="2020-10-29T21:01:27+08:00"><meta property="article:modified_time" content="2020-10-29T21:01:27+08:00"><meta name=Keywords content><meta name=description content="騰訊開源TurboTransformers,推理加速性能超TensorRT主流優化引擎"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/083e83e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>騰訊開源TurboTransformers,推理加速性能超TensorRT主流優化引擎</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>機器之心報道</p><p><strong>機器之心編輯部</strong></p><blockquote><p>4月24日，騰訊發佈了在 GitHub 上的第 100 個開源項目「TurboTransformers」，在多種 CPU 和 GPU 硬件測試中，這款 Transformer 推理加速工具獲得了超越 PyTorch/TensorFlow 和目前主流優化引擎的性能表現。</p></blockquote><p><br></p><div class=pgc-img><img alt=騰訊開源TurboTransformers,推理加速性能超TensorRT主流優化引擎 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/42922a5c526a463294f0a5f08a2ee281><p class=pgc-img-caption></p></div><p>在自然語言處理領域，以 BERT 為代表的 Transformer 神經網絡模型是近年來最重要的模型創新，為諸如閱讀理解、文章摘要、語義分類、同義改寫等 NLP 任務帶了顯著的效果提升。但 Transformer 在提高模型精度的同時，也引入了更多的計算量，這導致 Transformer 的線上 NLP 服務在部署方面面臨著巨大挑戰。</p><div class=pgc-img><img alt=騰訊開源TurboTransformers,推理加速性能超TensorRT主流優化引擎 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/76dbdb7d1a2e47cbb65ba2a504c0321d><p class=pgc-img-caption></p></div><p><br></p><p>業界普遍採用 TensorFlow 或者 Pytorch 來完成 Transformer 的訓練部分，但由於深度學習的訓練和推理任務存在差異，訓練框架直接應用於線上推理並不能得到極致的性能。</p><p>4月24日，騰訊宣佈開源 Transformer 推理加速工具「TurboTransformers」。Turbo 的意思是「渦輪」，一般用來增加發動機氧氣含量，帶來更大動力，TurboTransformers 則意味著可使推理引擎更加強勁。</p><p>項目地址：https://github.com/Tencent/TurboTransformers</p><p><strong>從業界痛點出發：高速、實用、簡單</strong></p><p>具體而言，TurboTransformers 具備高速、實用、簡單三個特點：</p><p><strong>1. 優異的CPU/GPU 性能表現</strong></p><p>面向 Intel 多核 CPU 和 NVIDIA GPU 硬件平臺，通過核心融合和並行算法優化，TurboTransformers 充發揮硬件的各層級並行計算的能力。在多種 CPU 和 GPU 硬件上獲得了超過 PyTorch/TensorFlow 和目前主流優化引擎（如 onnxruntime-mkldnn/onnxruntime-gpu, torch JIT, NVIDIA faster transformers）的性能表現。</p><p><strong>2. 為NLP推理任務特點量身定製</strong></p><p>TurboTransformers 可以支持變長輸入序列處理，無需序列補零、截斷或者分桶帶來的無用計算，也無需任何針對計算圖在推理前進行預調優的過程。</p><p><strong>3. 使用方式簡單</strong></p><p>TurboTransformers 支持 python 和 C++接口進行調用。TurboTransformers 支持 TensorFlow 和 PyTorch 預訓練模型的載入。它可以作為 huggingface/transformers 的推理加速插件，通過加入幾行 python 代碼獲得 BERT 模型的端對端加速效果。</p><p>和 ONNX-runtime、TensorRT、Torchlib 等推理優化引擎相比，TurboTransformers 在性能和使用方式上都具備優勢。</p><p><br></p><div class=pgc-img><img alt=騰訊開源TurboTransformers,推理加速性能超TensorRT主流優化引擎 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5fec29499c22488a81013c061070dc16><p class=pgc-img-caption></p></div><p><br></p><p>此前，TurboTransformers 已應用在騰訊內部多個線上 BERT 服務服務場景，微信常用問題回覆服務獲得 1.88x 加速，公有云情感分析服務獲得 2.11x 加速，QQ 看點推薦服務獲得 13.6x 加速。</p><p><strong>整體架構</strong></p><p>TurboTransformers 在算子優化、框架優化和接口部署方式簡化三個方面做了改進。</p><div class=pgc-img><img alt=騰訊開源TurboTransformers,推理加速性能超TensorRT主流優化引擎 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/50f9462e4e1a4e8985b11e011e9196c8><p class=pgc-img-caption></p></div><p>TurboTransformers 軟件架構圖。</p><p><strong>算子層優化</strong></p><div class=pgc-img><img alt=騰訊開源TurboTransformers,推理加速性能超TensorRT主流優化引擎 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c24309bc32b04531ad7aed82eca15f84><p class=pgc-img-caption></p></div><p><br></p><p>上圖 (a) 展示了論文 Transformer 結構示意圖，灰色方框內的結構稱為一個 Transformer Cell，BERT encoder 堆疊了 Nx 個這樣的 Transformer Cell。圖 (b) 為 Cell 的展開細節，每一個矩形都是一個獨立的計算核心。</p><p>Transformer Cell 計算包含了 8 個 GEMM（通用矩陣乘法，General Matrix Multiplication）運算，通過調優 Intel MKL 和 cuBLAS 的 GEMM 調用方式來獲得最佳 GEMM 性能，並在硬件允許條件下，在 GPU 上使用 tensor core 方式進行 GEMM 運算。</p><p>類似於 NVIDIA FasterTransformers 方案，TurboTransformers 將所有 GEMM 運算之間的計算融合成一個調用核心。這樣有兩個好處，一是減少了內存訪問開銷，二是減少多線程啟動開銷。</p><p>對於這些核心，TurboTransformers 在 CPU 上採用 openmp 進行並行，在 GPU 上使用 CUDA 進行優化實現。對於比較複雜的 LayerNorm 和 Softmax 算子，它們包含了不適合 GPU 上並行的規約操作，TurboTransformers 為它們設計了創新並行算法，極大降低了這些算子的延遲。</p><p><strong>框架層優化</strong></p><p>由於 NLP 的採用變長輸入特性，每次運算中間結果的大小其實並不相同。為了避免每次都分配釋放內存，TurboTransformers 通過 Caching 方式管理顯存。</p><p>此外，團隊為 TurboTransformers 提供了一些腳本，將二者的預訓練模型轉化為 npz 格式供其讀入，以無縫支持 pytorch/tensorflow 訓練好的序列化模型。考慮到 pytorch huggingface/transformers 是目前最流行的 transformer 訓練方法，TurboTransformers 支持直接讀入 huggingface/transformers 預訓練模型。</p><p><strong>應用部署</strong></p><p>為了減少用戶開發難度，TurboTransformers 提供了 C++和 Python 調用接口，可以嵌入到 C++多線程後臺服務流程中，也可加入到 pytorch 服務流程中，增加幾行代碼即可獲得端到端 BERT 加速。現階段更建議通過 docker 部署 TurboTransformers，一方面保證了編譯的可移植性，另一方面也可以無縫應用於 K8S 等線上部署平臺。</p><p><strong>性能測試</strong></p><p>團隊首先在三個 CPU 硬件平臺上測試了 TurboTransformers 的性能，下圖顯示了在 Intel Xeon 6133 CPU 上的性能測試結果（150 次迭代的均值）：</p><div class=pgc-img><img alt=騰訊開源TurboTransformers,推理加速性能超TensorRT主流優化引擎 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f5c706652c73481ca5a305db00739880><p class=pgc-img-caption></p></div><p><br></p><p>接下來在四個 GPU 硬件平臺上進行測試，下圖顯示了在 NVIDIA RTX 2060 GPU 和 NVIDIA V100 GPU 上的性能測試結果（150 次迭代的均值）：</p><div class=pgc-img><img alt=騰訊開源TurboTransformers,推理加速性能超TensorRT主流優化引擎 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e70d053b2efc4a8bbad89a4c55c0e57a><p class=pgc-img-caption></p></div><p>NVIDIA RTX 2060 GPU 測試結果。</p><div class=pgc-img><img alt=騰訊開源TurboTransformers,推理加速性能超TensorRT主流優化引擎 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fb12a16a8eab481380b750fcd916878c><p class=pgc-img-caption></p></div><p>NVIDIA V100 GPU 測試結果。</p><p>此外，團隊還在多個CPU和GPU等平臺上測試了 TurboTransformers，更多性能測試結果可見項目主頁。</p><p>目前，TurboTransformers 暫時只支持 FP32 的計算，未來騰訊將對其進一步改進，包括對 GPU FP16 的支持等能力等。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>騰訊</a></li><li><a>開源</a></li><li><a>TurboTransformers</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/a2871b0c.html alt="可用於企業的 7 個最佳開源 Web 服務器！" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1531874286737ba179830a5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a2871b0c.html title="可用於企業的 7 個最佳開源 Web 服務器！">可用於企業的 7 個最佳開源 Web 服務器！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/75735682.html alt=不愧是騰訊！光靠遊戲一天血賺4.6億人民幣，你貢獻了多少？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/cc290697431a45ef916ee0c90f6ad0f6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/75735682.html title=不愧是騰訊！光靠遊戲一天血賺4.6億人民幣，你貢獻了多少？>不愧是騰訊！光靠遊戲一天血賺4.6億人民幣，你貢獻了多少？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5cd7abc7.html alt=分享一組開源的匹配中國大陸手機號碼的正則表達式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ef9e7cc39f8b46b6a66d5b3de5c68e5c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5cd7abc7.html title=分享一組開源的匹配中國大陸手機號碼的正則表達式>分享一組開源的匹配中國大陸手機號碼的正則表達式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fa0e7702.html alt=阿里巴巴開源的超輕量的跨平臺圖形渲染引擎——GCanvas class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/549e2d3e22db49d4a5e13667f7bdd3e3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fa0e7702.html title=阿里巴巴開源的超輕量的跨平臺圖形渲染引擎——GCanvas>阿里巴巴開源的超輕量的跨平臺圖形渲染引擎——GCanvas</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9ef2b040.html alt=開源的的二維繪圖引擎，EChart在用的圖形渲染器——ZRender class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/c2d8dcb7ff7945758fe1df812324bd89 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9ef2b040.html title=開源的的二維繪圖引擎，EChart在用的圖形渲染器——ZRender>開源的的二維繪圖引擎，EChart在用的圖形渲染器——ZRender</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d1922e6f.html alt=780億+騰訊、百度多個巨頭加持，中國聯通的“混改”真心強 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d1922e6f.html title=780億+騰訊、百度多個巨頭加持，中國聯通的“混改”真心強>780億+騰訊、百度多個巨頭加持，中國聯通的“混改”真心強</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fed0e97d.html alt=華為、騰訊、阿里被評亞洲品牌前10強；聯通電信將聯手共建5G網絡 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f254f371b68a426eb3b1dadaa6992676 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fed0e97d.html title=華為、騰訊、阿里被評亞洲品牌前10強；聯通電信將聯手共建5G網絡>華為、騰訊、阿里被評亞洲品牌前10強；聯通電信將聯手共建5G網絡</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fefdfee3.html alt=開源的iT和資源管理--GLPI class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fefdfee3.html title=開源的iT和資源管理--GLPI>開源的iT和資源管理--GLPI</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/caf49203.html alt="免費開源資源管理器——RX 文件管理器" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9069364bb291498eba907fca4e2c38df style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/caf49203.html title="免費開源資源管理器——RX 文件管理器">免費開源資源管理器——RX 文件管理器</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/888474fb.html alt=PHP開源項目那麼多，你們都喜歡哪幾個？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/153097330447768a536afb3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/888474fb.html title=PHP開源項目那麼多，你們都喜歡哪幾個？>PHP開源項目那麼多，你們都喜歡哪幾個？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/89a099de.html alt=「開源分享」一個仿網易嚴選的微信小程序商城，包括後臺接口 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/78d6ba7fe094418186990242c5eb8635 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/89a099de.html title=「開源分享」一個仿網易嚴選的微信小程序商城，包括後臺接口>「開源分享」一個仿網易嚴選的微信小程序商城，包括後臺接口</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3106c5a7.html alt=如何更好地擁抱新零售？開源！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a38094e444704c6db6b98bdc5a6c20ea style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3106c5a7.html title=如何更好地擁抱新零售？開源！>如何更好地擁抱新零售？開源！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dbe2103e.html alt=技術在左，分享在右，商派用開源發力新零售！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15317113618129d71470735 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dbe2103e.html title=技術在左，分享在右，商派用開源發力新零售！>技術在左，分享在右，商派用開源發力新零售！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5d1652c5.html alt="騰訊呂一平：安全左移，智能網聯安全從研發做起  | CCF-GAIR 2020" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/S75AgH6yuVXpY style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5d1652c5.html title="騰訊呂一平：安全左移，智能網聯安全從研發做起  | CCF-GAIR 2020">騰訊呂一平：安全左移，智能網聯安全從研發做起 | CCF-GAIR 2020</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/833fcd87.html alt="重磅開源｜AOP for Flutter開發利器——AspectD" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a9081cd0f8f5469dbff78c136b207e34 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/833fcd87.html title="重磅開源｜AOP for Flutter開發利器——AspectD">重磅開源｜AOP for Flutter開發利器——AspectD</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>