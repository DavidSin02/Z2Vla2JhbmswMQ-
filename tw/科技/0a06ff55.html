<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>區塊鏈上的隨機性：概述與構造 | 极客快訊</title><meta property="og:title" content="區塊鏈上的隨機性：概述與構造 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/RJjGCjxAt6MQlC"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0a06ff55.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0a06ff55.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0a06ff55.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0a06ff55.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0a06ff55.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0a06ff55.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0a06ff55.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0a06ff55.html><meta property="article:published_time" content="2020-11-14T21:08:09+08:00"><meta property="article:modified_time" content="2020-11-14T21:08:09+08:00"><meta name=Keywords content><meta name=description content="區塊鏈上的隨機性：概述與構造"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/0a06ff55.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>區塊鏈上的隨機性：概述與構造</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><blockquote>"Randomness is something beyond human beings."<p>—— The Big Qiu</p></blockquote><p>隨機是不確定性，而依賴確定性是人的天性。程序本是確定的，而引入隨機數這個不確定因素之後，帶來了更多的可能性。</p><p>而隨機數作為區塊鏈生態中的一部分，應用層面，如各類遊戲；協議層面，能解決性能瓶頸。</p><p>作為區塊鏈中重要的組件之一，隨機被應用在各個領域，應用層面，如遊戲；協議層面，則能解決性能瓶頸。但在區塊鏈公共可驗證的透明之下，隨機數的生成機制被徹底暴露；而貨幣成為原生屬性之後，所有人都更有激勵希望去操作隨機的天平導向自己。2018 年出現最多的事件就是，某 Dapp 隨機數出現漏洞，並且愈演愈烈，讓我們質疑：區塊鏈上的隨機數，能夠“隨機”嗎？</p><p>或許利用密碼學和博弈論，結合激勵和懲罰，能出現無限可能的解法。</p><p>本文從隨機數的基本概念講起，為大家理清楚“區塊鏈上的隨機數”。</p><p>技術的發展總是盤旋而上，區塊鏈帶來無限可能性，原本無限美好的“透明”卻帶來了意想不到的不安全感，然而有新的方式來解決。</p><p>就像那句話：“而現在，我們生活在一個技術沒有天花板的時代，由新技術造成的問題，只能由更新的技術解決。”</p><p><strong>隨機性 (Randomness)</strong>的獲取是區塊鏈中非常重要的一個課題。這裡的隨機性的獲取包括但不僅限於：如何在智能合約中引入不可預測的隨機數；如何在共識協議中安全地進行隨機抽籤。顯然，上述對於隨機性獲取的問題描述已經說明了為何這個課題十分重要。而<strong>在區塊鏈中獲取隨機數非常困難</strong>，這一方面來自於<strong>區塊鏈系統的透明性</strong>——從通常意義上來講，該特性會使得一切算法的輸入，輸出以及算法本身暴露給所有的系統參與者——因此，在密碼學中廣泛使用的偽隨機數發生器不可以被直接以硬編碼的方式或者是智能合約代碼的方式應用在區塊鏈系統中來獲取安全的隨機數，因為透明性，系統參與者能夠根據代碼預測到隨機數甚至操縱隨機數，從而讓隨機源不“隨機”。另一方面，隨機數獲取協議作為區塊鏈系統的一個子協議常常與該系統下的其他協議有緊密的關係，如共識協議，這意味著<strong>其他協議很有可能會影響隨機數獲取協議的安全性</strong>。從而使隨機數獲取協議的設計變得非常複雜，常常需要具體問題具體分析。</p><p>本篇文章總結了目前主要的應用在區塊鏈的不可預測隨機數獲取協議，並提煉出它們的設計思想，方法論以及依賴的假設，然後對他們進行比較。本文分為兩部分：第一部分介紹基本概念，並從零開始解釋構造適用於分佈式系統的隨機數協議核心；第二部分介紹目前主流的應用在區塊鏈項目中的隨機數協議，並分析他們是如何使用第一部分所介紹的某類或者某幾類協議核心。</p><p>本文假設讀者已經具有基本的區塊鏈知識，並對以太坊智能合約的基本原理和比特幣共識協議的基本原理有大致的瞭解。</p><p></p><h2>隨機性的定義</h2><p>在日常生活中，我們經常會聽到諸如“隨機選擇”，“偽隨機數”，“隨機模型”，“隨機序列”之類的詞彙，以及“偽隨機數”、“真隨機數”這樣的概念。想要理解這些詞彙和概念，必須要搞清楚隨機是什麼。事實上，與“隨機”相對的是“確定”。因此，我們可以將“隨機”直觀上理解為“不確定”——無論是隨機數，還是隨機選擇，我們都希望這個數或者選擇的結果從某種程度上來講是不確定的。因此，如果直接給出一個數，而不給出這個數的產生方式，它不能被稱之為隨機數，比如直接給出一個數字 1，我們不能說 1 是隨機數，但是如果這個 1 是通過擲骰子決定的，則可以說這個 1 是隨機的。當然，這些都是非常直觀而寬泛的理解。更精確地講，“隨機”，或者我們說“隨機數”、“隨機序列”，在不同的領域有不同的定義。在數學上，隨機數的定義和概率論相關；在計算複雜性理論中，使用描述隨機序列的程序長度來定義（即序列越隨機，描述它的程序的長度就越長）；密碼學會結合統計特性和密碼攻擊來描述隨機數。</p><p>我們這裡先給出隨機序列的描述性定義，我們可以稱一個序列為隨機序列，當它滿足：</p><ul><li>均勻性：該序列服從均勻分佈。</li><li>獨立性：該序列的各個元素相互獨立。</li><li>不可預測性：依據該序列的任意片段，不能預測該序列餘下的部分。</li></ul><p>展開來講，我們可以先考慮如下問題：</p><ol><li>考慮一個每一項要麼取 1 要麼取 0 的數列。假設它的每一項均為1，它顯然不是隨機序列，因為違反了均勻性。均勻性要求0和1出現的概率相同。</li><li>假設它的每一項都和前一項不相等。比如 “0101010101”，它滿足了均勻性，但是仍然不是隨機序列，因為違反了獨立性。</li><li>對於一個滿足獨立性和均勻性的隨機序列。比如從常數 e 的小數點後第 10 位開始依次選取數碼組成序列。這樣的序列在統計上滿足獨立性和均勻性，但是它的序列是可以被預測的。</li></ol><p>我們說過，不同的領域對隨機性有不同的定義。比如，在仿真當中我們想要模擬顧客到達的間隔時間，用只滿足前兩條的隨機序列是足夠的。但是在密碼學中，比如生成隨機的密鑰，僅滿足前兩條的隨機序列是不夠的，一個有可能被預測的隨機序列用在密鑰生成中當然是有安全問題的。比如我們用自然對數的底 e 的數碼作為隨機序列。e 確實可以被認為在統計上是均勻分佈和獨立的（儘管沒有完全證明），用來做仿真是足夠的，但是不能用作密碼學中的隨機種子。因為對手有可能通過一定長度的已知序列猜測到是在使用 e 。同理，在抽獎、遊戲當中使用的隨機數也通常是要求不可預測的。鑑於區塊鏈領域中涉及的多是密碼學和遊戲的場景，接下來的內容都是滿足全部三條性質的隨機序列。</p><p>隨機序列又可以被分為<strong>真隨機 (True Random)</strong>序列和<strong>偽隨機 (Pseudorandom)</strong>序列。偽隨機序列，顧名思義，就是“不是真的隨機，只是看起來是隨機的”。因此，根據圖靈獎得主姚期智提出的概念，粗略地講，<strong>偽隨機序列就是指一個與真隨機序列在計算上不可區分的序列</strong>。而<strong>真隨機序列，指的是不可被重現的隨機序列</strong>，比如通過拋硬幣產生的隨機序列。我們可以看出來，在這樣的定義下，偽隨機序列的統計特性應當和真隨機序列無法區分，也就是說，偽隨機序列同樣是滿足全部三條性質的隨機序列。當然，這樣的定義通常用在計算複雜性理論以及密碼學當中，在其他領域，只滿足前兩條性質的隨機序列也可以被稱作偽隨機序列。</p><p>產生隨機序列的發生器叫做<strong>隨機數發生器 (Random Number Generator, RNG)</strong>。按照產生的序列的性質，我們可以將其分為真隨機數發生器<strong>(True Random Number Generator, TRNG)</strong>和<strong>偽隨機數發生器 (Pseudorandom Number Generator, PRNG)</strong>。此外，還有一種與之正交的分類方法是從隨機數發生器的實現方法來分類，可以將隨機數發生器分為硬件隨機數發生器和軟件隨機數發生器，它們之間的關係如圖 1 所示</p><img alt=區塊鏈上的隨機性：概述與構造 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RJjGCjxAt6MQlC><p>真隨機數發生器通常利用一些非確定現象，通過物理手段將其轉換為真隨機序列。<strong>通常的非確定現象包括混沌效應和量子隨機過程</strong>。其中混沌效應的特點是目前物理學能夠明確解釋其因果，但是由於結果對於初始值過於敏感，導致無法精確預測其結果。比如，通過收集大氣噪聲而產生的隨機數就是利用混沌效應產生的隨機數的例子。而量子隨機過程則是利用微觀量子態的不確定性，這個不確定性已經被目前物理學理論承認，它能夠保證即使輸入值完全相同，輸出值也是可能完全不同的。比如利用激光器的相位噪聲來生成隨機數。硬件真隨機數發生器，通常使用芯片實現；而軟件真隨機數發生器，通常利用系統自帶的一些非確定現象，譬如硬盤尋道時間、RAM 中的內容或者是用戶的輸入，Linux 系統裡的<code>/dev/random</code>就是一種軟件真隨機數發生器，它通過採集機器運行過程中的硬件噪音數據來獲取足夠的隨機性來源，並依此生成隨機數。</p><p>而偽隨機數發生器是一段程序，是一種確定性的算法，通常以短的真隨機數作為輸入，進行擴充，生成更長的和真隨機序列非常接近的隨機數序列。它的輸入被稱作<strong>種子 (Seed)</strong>。它同樣也有硬件實現和軟件實現。</p><p></p><h2>如何從區塊鏈上取得隨機數</h2><p>上一節中我們給出了隨機性的一個定義，這樣的定義也將用於本文餘下的部分。並且，我們還給出了偽隨機性以及偽隨機數發生器的概念。在實際應用中，可用於密碼學的偽隨機數發生器有很多並且也已經很成熟了，那麼我們很自然地想到，能否將偽隨機數發生器直接用在區塊鏈，在區塊鏈的共識過程或者應用上面加入隨機性，使得這樣的隨機性滿足我們上面提到的三條性質？</p><p>很遺憾的是，答案是否定的。偽隨機數發生器產生的隨機序列的不可預測性的前提是偽隨機數發生器作為一個黑盒，除了它的輸出，外界無法得知其他一切信息。但是<strong>區塊鏈上的一切都是公開透明的</strong>，包括使用的偽隨機數發生器及輸入到偽隨機數發生器裡面的種子也是一樣公開透明的。在這樣的情況下，所有傳統的偽隨機數發生器都無法在區塊鏈的環境下產出具有不可預測性的隨機數序列。而至於真隨機數發生器，的確存在將真隨機數發生器的結果通過可驗證的不可篡改的通道引入區塊鏈系統內部，這樣的通道又被稱作 Oracle。以太坊現在常用的隨機數發生器就是通過Oracle，引入random.org（random.org 是一個網站，它聲稱提供真隨機數）提供的隨機數。但是這種方法的問題在於，所謂的“真隨機數發生器”往往是中心化的，擁有這樣的硬件或者軟件的人或者組織擁有篡改隨機數發生器結果並且不讓用戶發覺的能力。這對於主打“去中心化”的區塊鏈系統來說，無疑如鯁在喉。</p><p><strong>除了偽隨機數發生器和真隨機數發生器，還有一類隨機數發生器會直接利用區塊鏈系統中共識過程所天然產生的隨機性</strong>。比如，使用未來某個塊或者之前某個塊的 Hash 值來作為種子之一生成隨機數（其他的種子可以是用戶的地址、用戶支付的以太幣數量等，但是這些是用戶可控的部分，沒有增加不可預測性的作用）。這種做法也常見於各種區塊鏈博彩類遊戲以及資金盤遊戲當中，但是這樣的隨機數獲取過程有著致命的漏洞——用戶有可能通過仔細選擇交易時間來控制隨機數向有利於自己的方向生成；即使用戶無法控制，礦工也可以控制隨機數的生成，並且這樣的攻擊成立並不需要太多算力的參與。只要最終隨機數牽涉的金額足夠，完全可以使用租用算力或者賄賂礦工的方式進行攻擊。</p><p>那麼歸根結底，在區塊鏈這樣的一個系統當中隨機性可以來自哪裡呢？也就是說，通過上面的分析，我們發現，對於如上做法的隨機數發生器，<strong>無論規則或者程序設計得如何複雜，它都是確定性的算法</strong>。對於一個確定性的算法，算法本身不會對輸出的隨機性有任何的影響，能夠影響最終輸出的隨機性的，只有算法的輸入。因此，在區塊鏈系統當中，我們需要在一個分佈式的，公開透明的環境中去仔細選擇一個有足夠隨機性的輸入。</p><p>那麼符合要求的輸入存在嗎？答案是肯定的，這樣的輸入實際上來源於我們對於<strong>區塊鏈系統參與者之間不是一個整體</strong>的假設。</p><p><strong>隨機數生成協議模型</strong></p><p>我們現在從最簡單的情況開始去逐步構造一個區塊鏈上可以使用的公平的隨機數發生器。下文所涉及到的在分佈式的環境下的協議都可以轉換為區塊鏈的環境，因此不對“分佈式”和“區塊鏈”做區分。</p><blockquote><strong>“分佈式”和“區塊鏈”的區別</strong><p>區塊鏈系統屬於分佈式系統，但是分佈式系統不僅僅是區塊鏈系統，還包括點對點文件傳輸系統，分佈式數據庫系統等等。“分佈式”只是對網絡的拓撲結構進行描述，表明網絡不是集中式的，而是分佈的多節點控制的。</p></blockquote><p>為了更清楚地說明構造分佈式隨機數協議，也叫<strong>分佈式隨機數信標 Distributed Randomness Beacon, DRB)</strong>，的方法論，我們首先引入一個隨機數協議的抽象模型：</p><img alt=區塊鏈上的隨機性：概述與構造 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RJjGCkD4IHLfxF><p>（圖2）</p><p>這個模型能夠完整地描述一個分佈式隨機數協議的輸入輸出與其節點之間的關係。如圖 2 所示，假設每個節點地位相同，不做區分，那麼每個節點都會運行同樣的協議。一個分佈式隨機數協議包含三部分的輸入：每個節點i自己的輸入 I<sup>i</sup><sub>self</sub>，來自其他節點的輸入I<sup>j</sup><sub>inter</sub>,j≠i以及一個公開的預先約定好的公共輸入I<sub>common</sub>，這三部分輸入每一部分都可以包含多次的輸入。作為一個分佈式隨機協議，其輸出隨機性的來源只能由輸入提供，我們先不考慮這三部分輸入進入協議的先後順序，那麼我們可以將協議分為兩類，一類是採用I<sub>self</sub>與I<sub>inter</sub>作為隨機性來源的協議，另一類是採用I<sub>common</sub>作為隨機性來源的協議。大家可以發現，這兩類事實上已經涵蓋了所有的隨機性來源的可能，其他類別的協議都可以視為這兩類協議的組合。文章後面的部分將主要對這兩類協議展開分析。</p><p></p><h2>使用I<sub>self</sub>與I<sub>inter</sub>作為隨機性來源</h2>下面，我們考慮這樣的一個場景：Alice 和 Bob 在網上湊錢一起買了一張彩票，結果中了神祕的頭獎，令他們吃驚的是，獎品竟然是一隻皮卡丘，如圖 3 所示。但是皮卡丘不可分割，並且由於兩人相隔甚遠無法見面猜拳，所以他們倆決定設計一個對兩個人都公平的隨機數生成協議來確定誰能獲得這隻皮卡丘。<p><strong>v1.0：最簡單的隨機數生成協議</strong></p><p>Alice 設計瞭如圖 4 所示的一個協議，這個協議又被稱作 <strong>Coin-Tossing Protocol</strong>或是<strong>Coin-Flipping Protocol</strong>。協議接收每位參與者的一次輸入，在該場景下是ξ<sub>A</sub>和ξ<sub>B</sub>，輸入的取值只能是 0 或者 1。協議擁有唯一公共輸出ξ,取值也是 0 或者 1，如果最後ξ=0，Alice 獲得皮卡丘；若ξ=1， Bob 獲得皮卡丘。而從每一位參與者的角度來講，這個協議接收自己的輸入以及其他運行這個協議的節點的輸入，經過算法運算之後，輸出一個一致的最終結果，其實就是上一節中我們提到的抽象模型中的，利用I<sub>self</sub>與I<sub>inter</sub>作為隨機性來源的協議。</p><img alt=區塊鏈上的隨機性：概述與構造 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RJjGCkP8OWevFy><p>那麼這樣的協議具體是怎麼做的呢？為了構造這樣的一個協議，我們需要確定這樣的協議需要滿足什麼樣的性質。考慮到每個人之間的輸入是相互獨立的，這樣的協議需要保證每個人自己的輸入也應當是和輸出相互獨立的，但是他們又共同對輸出做出了一定貢獻。只有這樣，才能確保每個人都無法光憑藉改變自己的選擇來改變輸出。同時，協議也需要保證只要有一個人的輸入是均勻分佈的，那麼結果就是均勻分佈的。現實中滿足這些條件的構造方式有很多，其中一種是異或操作，將兩人的輸入異或之後輸出：在給定 Bob 選 1 的情況下（Alice 不知道），Alice 不管選 0 還是 1，輸出結果都是 0 和 1 各一半的可能性；給定 Bob 選 0 的情況同理。</p><p>ξ=ξ<sub>A</sub>⊕ξ<sub>B</sub></p><p>另一種方法是利用 mod 加法，將兩人的輸入進行模 2 加法之後輸出，也能得到類似的結果。</p><p>ξ=ξ<sub>A</sub>+ξ<sub>B </sub>mod 2</p><p><strong>v2.0：帶有承諾的版本</strong></p><p>v1.0 看似解決了我們的問題，實際上它有非常大的漏洞。這個漏洞在於，我們無法保證 Alice 和 Bob “同時” 輸入。假如 Bob 等 Alice 向協議輸入她的選擇之後再進行選擇，那麼由於協議的交互對於兩人來講是公開的，Bob 可以根據 Alice 的選擇來調整自己的選擇。例如，如果 Alice 的選擇是 0，那 Bob 就輸入 0；如果 Alice 是 1，那他就輸入 1。這樣，無論 Alice 怎麼選擇，Bob 都可以使得異或的結果永遠是 1，就能拿走這隻皮卡丘。</p><img alt=區塊鏈上的隨機性：概述與構造 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RJjGCkbBuMOu2z><p>（圖5）</p><p>事實上，同時輸入是很難保證的，而為了防止這種作弊行為，我們需要保證，協議中的來自其他人的輸入對於參與者來講應該是暫時機密的，不會透露任何他們的選擇的信息。與此相應的，應該多出一個去機密化的過程以計算出協議的輸出。為了實現這樣的需求，我們需要引入新的機制：<strong>承諾 (Commitment)</strong>。</p><p>如圖 5 所示，該機制包含兩個階段：<strong>承諾 (Commit)</strong>階段和<strong>揭示 (Reveal)</strong>階段。在第一個承諾階段，協議參與者不再直接輸入自己的選擇，而是對自己的選擇進行數字簽名，將簽名的結果，我們稱之為承諾，輸入進協議。例如，Alice 會將她的選擇ξ<sub>A</sub>用自己的私鑰skA進行簽名，獲得結果sigsk<sub>A</sub>(ξA)輸入進協議。當所有參與者的簽名結果均輸入進協議中後，進入第二個揭示階段。該階段所有參與者將第一輪自己的選擇輸入進協議，例如 Alice 會輸入ξ′<sub>A</sub>，協議會結合第一個階段的承諾進行驗證，確認輸入的ξ′<sub>A</sub>和ξ<sub>A</sub>相等。如果所有的驗證都通過，則輸出最終結果 ξ，最終結果就是我們想要的隨機數。</p><p>這樣的協議保證了，在第一個階段裡沒有任何人的選擇會被除自己以外的其他人獲知，並且在第二階段，即使 Bob 先知道了 Alice 揭示出來的選擇值然後在自己揭示之前計算出結果，他也無法改變自己的選擇了，因為第一個階段的簽名已經做出了“承諾”。這裡，數字簽名能夠保證消息的不可篡改性，不可否認性以及暫時的機密性。如果該協議是運行於區塊鏈之上，由於通常區塊鏈協議都會對交易內容進行數字簽名，那麼我們的協議也可以將使用數字簽名改為使用 Hash 函數。</p><p><strong>v3.0a：使用經濟懲罰</strong></p><p>v2.0 的版本在對於兩個人的情況的時候看起來非常公平，但是對於兩人以上的情況，它仍然是有漏洞的。假設 Alice、Bob、Clare 三個人分一隻皮卡丘，其他設定不變，採用 v2.0 協議。這時，Bob 想到了個主意：“在最後的第二階段，我可以在輸入自己的選擇進行揭示之前先依據別人的揭示結果計算出輸出，如果不是對我有利的輸出，我就不進行揭示階段，假裝網線被挖斷了。”</p><p>剛才的協議無法處理這種情況。是重新再來一遍，還是就取剩下兩個人的輸入呢？這兩種方法是都有問題的：如果重新再運行一遍協議，那麼攻擊者就可以利用這種重新運行的機制在每次自己不利的情況下強行使得協議重新運行；如果只取剩下兩個人的輸入，攻擊者同樣可以利用這種機制選擇是否放棄輸入來趨利避害。因此，我們需要有一種機制來保證參與者不得隨意放棄，最簡單的方式就是利用經濟懲罰。如圖 6 所示，當參與者在第一階段承諾的時候，必須要向協議鎖定一個比特幣（也可以是其他的數字貨幣）——如果是在帶有智能合約的區塊鏈的環境，這樣的操作十分容易。如果 Bob 不按時揭示他的選擇ξ<sub>B</sub>，那麼就會沒收 Bob 的比特幣分給 Alice 和 Clare，然後重啟協議。由於皮卡丘的價值（也許）通常並不會超過一個比特幣，Bob 不會選擇這樣的方式進行作弊。這樣的一個懲罰機制，就是為了防止這樣的拒絕服務攻擊。</p><img alt=區塊鏈上的隨機性：概述與構造 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RJjGCkmB0kZvby><p>需要注意的是，之所以本節一開始所述的攻擊對只有兩個參與者的協議不奏效，是因為兩個人的情況下，在僅剩一個人的時候，我們可以直接給出有利於剩下的參與者的結果，而在多於兩個人的情形下，我們仍舊無法保證在剩下的人當中做出選擇。這樣的規則是一種天然的對拒絕服務的參與者的懲罰。</p><p><strong>v3.0b：使用門限機制</strong></p><p>除了經濟懲罰之外，還有另外一種方式，我們稱之為<strong>門限 (Threshold)</strong>機制。門限機制指的是一種協議的某一個指標達到一定閾值就可以執行特定流程的機制。在這裡我們引入門限機制，主要是為了使得在協議參與人數有缺失的時候仍然能夠給出正常的輸出。門限機制的作用在於增強協議的健壯性，使得它能夠容忍一定程度的拒絕服務攻擊。我們接下來討論的門限機制都是(t,n)門限機制，意思就是對於 n 個參與者的協議，只需要 t 個參與者的輸入即可完成協議的輸出，注意這裡的 n 不一定是協議預先規定好的，或者說是協議必須知道的，它也有可能是一個不確定的數字。如果協議必須規定了確切的 n 才能夠保證正確性，那麼這樣的協議只能用於<strong>許可環境 (Permissioned Setting)</strong>中；如果不需要規定確切的 n ，那麼這樣的協議可以被用於<strong>非許可環境 (Permissionless Setting)</strong>中。如圖 7 和 圖 8 所示，我們使用最基本的 v1.0 版本的 Coin-Tossing 協議，將門限機制的輸出作為 Coin-Tossing 協議的輸入。這樣的門限機制總的說來有三種。</p><img alt=區塊鏈上的隨機性：概述與構造 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RJjGCxy6dfrcgJ><img alt=區塊鏈上的隨機性：概述與構造 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RJjGCyi5wODDrh><p>第一種門限機制是將輸入按照某種規則排序之後，簡單地取前 t 個輸入。但是這種方式不抗<strong>女巫攻擊 (Sybil Attack)</strong>——假如 Bob 是黑客帝國的複製人，他複製了一萬個自己，因此 Bob 通過控制這一萬個身份有很大的可能佔有前 t 個輸入，從而控制隨機數的結果。因此，這種門限機制是無法用在沒有抗女巫攻擊機制的環境下——譬如，沒有身份驗證的非許可環境下，但它的優點在於，這樣的機制不需要知道 n 的確切值。</p><blockquote><strong>女巫攻擊</strong><p>簡單來講，指的是一種網絡內的少數節點控制多重身份的攻擊方式</p></blockquote><p>第二種門限機制是無分發者的祕密分享系列的。這一系列協議均需要每產生一個隨機數輸出都進行一次祕密分享來保證門限機制，屬於<strong>有狀態 (Stateful)</strong>協議。更直觀地講，比如有 n 個人，假設只需要有 t 個人提交了就能輸出我們想要的隨機數，同時，我們需要 r 個這樣的隨機數。那麼如果採用無分發者的祕密分享系列的門限機制，我們需要這 n 個人相互交互至少 r 輪。另一個侷限是，該方案需要在許可環境下實施，也就是說協議必須知道總人數 n ，才能確定合理的門限 t 。</p><p>這一系列協議包含很多種形式，其中最基本的形式是無分發者的<strong>祕密分享 (Secret Sharing)</strong>。祕密分享可以將一個祕密字符串分成多個碎片，又稱作<strong>份額 (Share)</strong>，只有集齊一定數量的碎片才能將該祕密恢復出來。通常，祕密分享需要有一個可信第三方充當分發者將祕密分成祕密碎片然後分發。而無分發者的含義則是祕密分享的過程不需要這樣的分發者，也就是說，更加去中心化了。如圖 9 所示，首先是分發階段，比如說 Bob 把他的選擇 ξ<sub>B </sub>分成三份：s<sup>A</sup><sub>ξB，</sub>s<sup>B</sup><sub>ξB</sub>，s<sup>C</sup><sub>ξB，</sub>這三份中的任意兩份都可以恢復出完整的ξ<sub>B</sub>。上角標代表了這個份額發送給的人，例如s<sup>C</sup><sub>ξB</sub>表示該份額發送給 Clare。每個人都像 Bob 這樣做之後，每個人手上都有 3 份來自包括自己在內的不同的人的份額。例如，Clare 此時手上應該有 s<sup>C</sup><sub>ξA，</sub>s<sup>C</sup><sub>ξB</sub>，s<sup>C</sup><sub>ξC</sub>。此時，每個人再把這些份額拼成份額向量廣播給所有人。例如 Clare 會將份額向量s<sup>C</sup>=[s<sup>C</sup><sub>ξA</sub>,s<sup>C</sup><sub>ξB</sub>,s<sup>C</sup><sub>ξC</sub>]廣播給其他兩個人。這樣每個人只要手裡有包括自己在內的兩份這樣的向量就能恢復出 Alice、Bob 和 Clare 三人的選擇，然後就可以算出最終的隨機數，例如 Bob 擁有向量s<sup>B</sup>=[s<sup>B</sup><sub>ξA</sub>,s<sup>B</sup><sub>ξB</sub>,s<sup>B</sup><sub>ξC</sub>]和 s<sup>C</sup>=[s<sup>C</sup><sub>ξA</sub>,s<sup>C</sup><sub>ξB</sub>,s<sup>C</sup><sub>ξC</sub>]。下角標相同上角標不同的任意兩個份額都可以恢復出相應的祕密，例如s<sup>B</sup><sub>ξB</sub>和s<sup>C</sup><sub>ξB</sub>可以恢復出ξ<sub>B</sub>。由於這一點，我們可以得到 [ξ<sub>A</sub>,ξ<sub>B</sub>,ξ<sub>C</sub>]，由此算出最終的結果ξ。</p><img alt=區塊鏈上的隨機性：概述與構造 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RJjGCyu4drvqrs><p>但是這樣的祕密分享方案是有漏洞的，如果祕密分發者——譬如 Bob——在分發份額s<sup>A</sup><sub>ξB，</sub>s<sup>B</sup><sub>ξB</sub>，s<sup>C</sup><sub>ξB</sub>的時候，將其中一份份額s<sup>A</sup><sub>ξB</sub>替換為其他的一個任意值，那麼收到這個份額的 Alice 在使用該份額進行恢復的時候有可能恢復出錯誤的 ξ<sub>B</sub>。為了防止這樣的攻擊，我們需要保證使用的祕密分享方案中包含可以驗證祕密份額的步驟。</p><p>於是，如圖 10 所示，我們使用無分發者的<strong>公開可驗證祕密分享 (Publicly Verifiable Secret Sharing, PVSS)</strong>——與第一種相比則是在分發階段的時候多了一些額外的數據。這些數據就是“證明”，記作 π 。“證明” π 可以被用來檢驗每個人收到的份額是否和其他人的一致。所有人都會使用這個公開的 π 去驗證收到的份額，驗證通過就可以說明這個份額確實是和其他發出去的份額是一致的，都是按照正確的規則生成的。</p><img alt=區塊鏈上的隨機性：概述與構造 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RJjGCz5BxyAFht><p>第三種方法是<strong>分佈式密鑰生成 (Distributed Key Generation)</strong>+<strong>門限簽名 (Threshold Signature)</strong>。門限簽名可以理解為祕密分享應用到了數字簽名方案中，但是它又不是單純將兩者相疊加。通常的數字簽名方案是，一個人用自己的私鑰加密了消息獲得簽名之後，簽名可以被公鑰等公開參數驗證。而該方案使用的門限簽名方案裡同樣有一對公私鑰，但是每個參與者分別只有總私鑰的其中一個碎片以及相應的公鑰碎片；這些私鑰碎片集合起來可以恢復出完整的私鑰，公鑰碎片同理；每個人可以利用自己的私鑰碎片進行簽名獲得簽名碎片，這些簽名碎片可以被公鑰的相應碎片驗證；並且，這些簽名碎片中的任意 t 個合起來可以計算出一個總簽名，該總簽名相當於用總私鑰進行簽名，因此也能被總公鑰驗證。故而這樣的簽名過程並不需要所有人蔘與，只需要 n 個人中的 t 個人的有效簽名即可完成簽名過程。而且無論是哪 t 個人參與簽名，最後生成的簽名是一樣的。並且簽名過程中涉及到的私鑰不會被洩露，每個人分享的只有公鑰碎片和自己的簽名結果，這使得多輪無交互簽名成為可能。當然，這個總的公私鑰對以及相應碎片不是任意選取的，它的生成需要所有的 n 個人在協議第一次運行時運行分佈式密鑰生成協議才能生成有這樣的密碼學特性的公私鑰對及其碎片。因此，這個方案同樣存在協議必須要知道總人數 n 的問題。</p><p></p><h2>使用I<sub>common</sub>作為隨機性來源</h2><p>使用I<sub>common</sub>作為隨機性來源，最常見的方法是採用比特幣鏈上未來某一個塊的 Hash 值作為I<sub>common</sub>，或者使用當日股票市場上某一支股票的收盤價。但是這個方法的問題在於，輸出 O 完全由 I<sub>common</sub>計算得來，攻擊者有可能通過操縱 I<sub>common</sub>的值來使得 O 變為他想要的值。如果從I<sub>common</sub>計算 O 的過程沒有那麼容易，比如說有可能要耗上一整天，那麼攻擊者將沒有足夠的時間去提前預測 O 的值。為了實現這樣的需求，我們引入了一個新的密碼學工具：<strong>可驗證延遲函數 (Verifiable Delay Function, VDF)</strong>。這樣的工具能夠使得輸出 O 在給定時間 t 內是很難通過輸入I<sub>common</sub>計算出的，即使擁有任意的並行處理器以及多項式級別的提前計算量。同時，輸出 O 是唯一的並且可以被公開驗證是由 I<sub>common</sub>正確計算得來的。它很像 PoW，但是 PoW 不抗並行處理器及多項式級別的提前計算攻擊，也就是說，使用並行處理器能夠顯著縮小 PoW 的計算時間到遠遠小於 t。<strong>使用 VDF 可以保證在給定時間內全世界沒有任何一個人可以預測與給定輸入相匹配的輸出</strong>。以太坊 2.0 已經計劃使用 VDF 作為隨機數信標。</p><p></p><h2>參考文獻</h2><p>[1] Yao, Andrew C. "Theory and application of trapdoor functions." <em>Foundations of Computer Science, 1982. SFCS'08. 23rd Annual Symposium on</em>. IEEE, 1982.</p><p>[2] Boneh, Dan, et al. "Verifiable delay functions." <em>Annual International Cryptology Conference</em>. Springer, Cham, 2018.</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>區塊</a></li><li><a>隨機性</a></li><li><a>構造</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/15f60fea.html alt=此地無人生還：區塊鏈隨機數的原罪與救贖 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/153820081912869d8e48468 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/15f60fea.html title=此地無人生還：區塊鏈隨機數的原罪與救贖>此地無人生還：區塊鏈隨機數的原罪與救贖</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a382d16d.html alt="區塊鏈入門：為什麼 DApp 經常會遭遇隨機數攻擊？| 火星技術帖" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RivR6n1AU5yy8h style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a382d16d.html title="區塊鏈入門：為什麼 DApp 經常會遭遇隨機數攻擊？| 火星技術帖">區塊鏈入門：為什麼 DApp 經常會遭遇隨機數攻擊？| 火星技術帖</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ec7b59f3.html alt=從密碼學的隨機性探討區塊鏈與隨機數 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RivR6n1AU5yy8h style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ec7b59f3.html title=從密碼學的隨機性探討區塊鏈與隨機數>從密碼學的隨機性探討區塊鏈與隨機數</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9f220780.html alt=當科學和哲學遇到隨機性，確定性和混亂時 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/9e3b0b83044245e887f1fa23093c56a6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9f220780.html title=當科學和哲學遇到隨機性，確定性和混亂時>當科學和哲學遇到隨機性，確定性和混亂時</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/51a9663e.html alt=橫滑式單元幕牆防水構造典型誤區分析 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/31a722f1541d41fa9475a525a782a0a7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/51a9663e.html title=橫滑式單元幕牆防水構造典型誤區分析>橫滑式單元幕牆防水構造典型誤區分析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bd2e41b9.html alt=二、地球運行的方式-3(板塊構造) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/4785b7af93d249b0972f939f77351e73 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bd2e41b9.html title=二、地球運行的方式-3(板塊構造)>二、地球運行的方式-3(板塊構造)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/416cd00d.html alt=地球構造板塊開始移動的時間比以前認為的更早 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5ff9ade37cba4a7e9239926d89584046 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/416cd00d.html title=地球構造板塊開始移動的時間比以前認為的更早>地球構造板塊開始移動的時間比以前認為的更早</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1c2deaa5.html alt=原子熒光光譜儀的構造原理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f47572eecf684fc79c8ea400d9985f61 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1c2deaa5.html title=原子熒光光譜儀的構造原理>原子熒光光譜儀的構造原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1a5783a2.html alt=史上最全圖解汽車構造與原理系列（九）活塞連桿組圖解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/37d7000172f8074b6abc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1a5783a2.html title=史上最全圖解汽車構造與原理系列（九）活塞連桿組圖解>史上最全圖解汽車構造與原理系列（九）活塞連桿組圖解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f6aa19dd.html alt=汽車發動機構造---曲柄連桿機構 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c8524852e5654ae1b3e82b4df617e501 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f6aa19dd.html title=汽車發動機構造---曲柄連桿機構>汽車發動機構造---曲柄連桿機構</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/70bde363.html alt=圖文解剖剎車構造原理——解讀制動系統剎車的歷史及未來 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3d92b7bc5ee44899939efd4f8f9ddf60 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/70bde363.html title=圖文解剖剎車構造原理——解讀制動系統剎車的歷史及未來>圖文解剖剎車構造原理——解讀制動系統剎車的歷史及未來</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f3ef1b57.html alt=清華-泰嶽區塊鏈，公益培訓第10堂內容-區塊鏈整體結構解析1 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/bb90db89a11643b7a657bcdb3f60a8bb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f3ef1b57.html title=清華-泰嶽區塊鏈，公益培訓第10堂內容-區塊鏈整體結構解析1>清華-泰嶽區塊鏈，公益培訓第10堂內容-區塊鏈整體結構解析1</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bd76328b.html alt=混床的設備構造 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7887fee51ec542229e649d6d67f6d8b2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bd76328b.html title=混床的設備構造>混床的設備構造</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9e7dc8cb.html alt=精釀啤酒設備的基本構造及設計原理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/74addd9fbd4b48439fb3f60435e27db8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9e7dc8cb.html title=精釀啤酒設備的基本構造及設計原理>精釀啤酒設備的基本構造及設計原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3097ef6c.html alt=各種擋土牆構造與施工最全解讀！看了你才真正瞭解！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/153926362844833ae90c1eb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3097ef6c.html title=各種擋土牆構造與施工最全解讀！看了你才真正瞭解！>各種擋土牆構造與施工最全解讀！看了你才真正瞭解！</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>