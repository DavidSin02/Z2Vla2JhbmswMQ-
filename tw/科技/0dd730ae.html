<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>使用Oauth2實現微服務的安全保護 | 极客快訊</title><meta property="og:title" content="使用Oauth2實現微服務的安全保護 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/6681021783c347c1be319363de838822"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0dd730ae.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0dd730ae.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0dd730ae.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0dd730ae.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0dd730ae.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0dd730ae.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0dd730ae.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0dd730ae.html><meta property="article:published_time" content="2020-11-14T21:00:29+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:29+08:00"><meta name=Keywords content><meta name=description content="使用Oauth2實現微服務的安全保護"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/0dd730ae.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>使用Oauth2實現微服務的安全保護</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>序言</h1><p>安全性是暴露由許多微服務組成的公共訪問API時要考慮的最重要的一個方面。Spring有一些有趣的功能和框架，使我們的微服務安全配置更容易。在本文中，我將向您展示如何使用Spring Cloud和Oauth2在API網關後面提供令牌訪問安全性。</p><h1>理論知識</h1><p>OAuth2標準目前被所有主要網站使用並且允許通過共享API訪問其資源。它是一種開放式授權標準，允許用戶將存儲在一個頁面中的私有資源共享到另一個頁面，而無需進入其憑據服務。這些是與oauth2相關的基本術語。</p><ul><li class=ql-align-justify>Resource Owner – 處理對資源的訪問</li><li class=ql-align-justify>Resource Server – 存儲可以使用特殊令牌共享的所有者資源的服務器</li><li class=ql-align-justify>Authorization Server – 管理密鑰，令牌和其他臨時資源訪問代碼的分配。它還必須確保授予相關人員訪問權限</li><li class=ql-align-justify>Access Token – 允許訪問資源的密鑰</li><li class=ql-align-justify>Authorization Grant – 授予訪問權限。有多種方法可以確認訪問權限：授權代碼，隱式，資源所有者密碼憑據和客戶端憑據</li></ul><p>您可以在此處以及在digitalocean文章中閱讀有關此標準的更多信息。該協議的流程主要有三個步驟。首先，我們將授權請求發送給資源所有者。在資源所有者響應後，我們向授權服務器發送授權請求並接收訪問令牌。最後，我們將此訪問令牌發送到資源服務器，如果它有效，則API將資源提供給應用程序。</p><h1>方案</h1><p>下圖顯示了我們案例的架構。我們用API網關（Zuul）代理我們對授權服務器的請求和兩個帳戶微服務實例。授權服務器是某種提供outh2安全機制的基礎結構服務。我們還有發現服務（Eureka），我們所有的微服務都已註冊。</p><div class=pgc-img><img alt=使用Oauth2實現微服務的安全保護 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6681021783c347c1be319363de838822><p class=pgc-img-caption></p></div><h1>網關</h1><p>對於我們的示例，我們不會在API網關上提供任何安全性。它只需要將客戶端的請求代理到授權服務器和帳戶微服務。在下面可見的Zuul的網關配置中，我們將sensitiveHeaders屬性設為空值以啟用授權HTTP頭轉發。默認情況下，Zuul在將我們的請求轉發到目標API時切斷了該頭，這是不正確的，因為網關後面的服務需要基本授權。</p><div class=pgc-img><img alt=使用Oauth2實現微服務的安全保護 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cdeb5d9695ce439c8465c87d587bd894><p class=pgc-img-caption></p></div><p>網關源代碼中的主類非常簡單。它只需要啟用Zuul代理功能和發現客戶端來收集Eureka註冊表中的服務。</p><div class=pgc-img><img alt=使用Oauth2實現微服務的安全保護 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/63fb4a5629b34e209053f9075abe44e2><p class=pgc-img-caption></p></div><h1>授權服務器</h1><p>gaOur授權服務器內的主類也很簡單。它基於默認的Spring安全配置。客戶端授權詳細信息存儲在內存存儲庫中。當然在生產模式中，您也可以使用其他實現而不是內存存儲庫，如JDBC數據源和令牌存儲。您可以在Spring Security Reference和Spring Boot Security中閱讀有關Spring授權機制的更多信息。這是application.yml的配置片段。我們為/ token端點提供了用戶基本身份驗證數據和基本安全憑證：client-id和client-secret。用戶憑據是普通的Spring Security用戶詳細信息。</p><div class=pgc-img><img alt=使用Oauth2實現微服務的安全保護 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a800bff45f02417a9e4eacb31447074b><p class=pgc-img-caption></p></div><p>這是用@EnableAuthorizationServer實現身份驗證服務器的主要類。我們公開一個REST端點驗證帳戶服務的用戶身份詳情，併為客戶端啟用了Eureka註冊和發現。</p><div class=pgc-img><img alt=使用Oauth2實現微服務的安全保護 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/739683e476e0449fa9255547114a0881><p class=pgc-img-caption></p></div><h1>Application-賬戶微服務</h1><p>我們的示例微服務只有一個@GET請求的端點，它始終返回相同的帳戶。在主類中，資源服務和Eureka發現都已啟用。服務配置很簡單。 GitHub上提供了示例應用程序源代碼。</p><div class=pgc-img><img alt=使用Oauth2實現微服務的安全保護 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c8120c42ff704d58ac0a6a9e01655b88><p class=pgc-img-caption></p></div><h1>測試</h1><p>我們只需要Web瀏覽器和REST客戶端（例如Chrome Advanced REST客戶端）來測試我們的解決方案。從向資源所有者發送授權請求開始測試。我們可以通過Web瀏覽器中的Zuul網關調用oauth2授權端點。</p><p>http://localhost:8765/uaa/oauth/authorize?response_type=token&client_id=acme&redirect_uri=http://example.com&scope=openid&state=48532</p><p>發送請求後，我們應該看到下面的頁面。選擇“Approve”，然後單擊“Authorize”,從授權服務器請求訪問令牌。如果應用程序標識已通過身份驗證且授權授予有效，則應在HTTP響應中返回應用程序的訪問標記。</p><div class=pgc-img><img alt=使用Oauth2實現微服務的安全保護 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5c036f408c4c4d87804b2651f10db341><p class=pgc-img-caption></p></div><p>http://example.com/#access_token=b1acaa35-1ebd-4995-987d-56ee1c0619e5&token_type=bearer&state=48532&expires_in=43199</p><p>最後一步是使用訪問令牌調用帳戶端點。我們不得不將其作為承載令牌放入Authorization標頭中。在示例應用程序中，安全操作的日誌記錄級別設置為TRACE，因此您可以輕鬆找出問題發生時的情況。</p><div class=pgc-img><img alt=使用Oauth2實現微服務的安全保護 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/58d5ccca0b854fabb55377c7cc93c1bb><p class=pgc-img-caption></p></div><h1>結束語</h1><p>說實話，我不太熟悉應用程序中的安全問題。所以對我來說一個非常重要的是使用的安全解決方案的簡單性。在Spring Security中，我們幾乎所有需要的機制都是開箱即用的。它還提供可輕鬆擴展的組件，以滿足更高級的要求。您應該將本文視為使用Spring Cloud和Spring Security項目的更高級解決方案的簡要介紹。</p><blockquote><p>原文鏈接：https://piotrminkowski.wordpress.com/2017/02/22/microservices-security-with-oauth2/</p><p>作者：Piotr Mińkowski</p><p>譯者：Emma</p></blockquote></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Oauth2</a></li><li><a>實現</a></li><li><a>保護</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/f09ac34c.html alt=彩色電子書在廣州率先實現量產 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RkPMb9G6tipobr style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f09ac34c.html title=彩色電子書在廣州率先實現量產>彩色電子書在廣州率先實現量產</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4f3d4ceb.html alt="黃河流域保護 | 周晉峰：採砂問題事關生物多樣性與食品安全" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c875f033313740458476cd1ee9d05bce style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4f3d4ceb.html title="黃河流域保護 | 周晉峰：採砂問題事關生物多樣性與食品安全">黃河流域保護 | 周晉峰：採砂問題事關生物多樣性與食品安全</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2d12804e.html alt=[玩轉MySQL之九]MySQL實現ACID之原子性 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bdb044d821f74107a3fd9119fc34c642 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2d12804e.html title=[玩轉MySQL之九]MySQL實現ACID之原子性>[玩轉MySQL之九]MySQL實現ACID之原子性</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fb2bc471.html alt="「譯」 Spring 的分佈式事務實現—使用和不使用 XA—第二部分" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fb2bc471.html title="「譯」 Spring 的分佈式事務實現—使用和不使用 XA—第二部分">「譯」 Spring 的分佈式事務實現—使用和不使用 XA—第二部分</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e41fd8de.html alt="撫順各項防汛工作實現“六到位” 確保全市安全度汛" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e41fd8de.html title="撫順各項防汛工作實現“六到位” 確保全市安全度汛">撫順各項防汛工作實現“六到位” 確保全市安全度汛</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f22ee5ad.html alt="Redis 設計與實現 : Lua 腳本" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f22ee5ad.html title="Redis 設計與實現 : Lua 腳本">Redis 設計與實現 : Lua 腳本</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/56e2a065.html alt=這位大叔在隨機的彩票上實現了90%的中獎率 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/50ab0003166decded7e4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/56e2a065.html title=這位大叔在隨機的彩票上實現了90%的中獎率>這位大叔在隨機的彩票上實現了90%的中獎率</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cf633068.html alt="Java 多態的實現機制，看了都說好" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9d3b0e55813d46b4982ae7d9b81d1802 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cf633068.html title="Java 多態的實現機制，看了都說好">Java 多態的實現機制，看了都說好</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d0662f03.html alt="廣西鐵路出海大通道 全面實現電氣化運營" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d0662f03.html title="廣西鐵路出海大通道 全面實現電氣化運營">廣西鐵路出海大通道 全面實現電氣化運營</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/930693d7.html alt=保護太空電子設備的材料如何減輕重量？新技術：添加生鏽粉末 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7edb0c835071408a85277eec5651718a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/930693d7.html title=保護太空電子設備的材料如何減輕重量？新技術：添加生鏽粉末>保護太空電子設備的材料如何減輕重量？新技術：添加生鏽粉末</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c78a6fe2.html alt=HashMap的底層實現 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/0f9ffe95e10e4ff5804a8fd9cf591cfc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c78a6fe2.html title=HashMap的底層實現>HashMap的底層實現</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7c3d9f70.html alt=新穎的混合材料或有助於實現高效的下一代顯示器 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/47050004da4f36dcec1b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7c3d9f70.html title=新穎的混合材料或有助於實現高效的下一代顯示器>新穎的混合材料或有助於實現高效的下一代顯示器</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8d93e49d.html alt=教程：採用梯度下降算法實現線性迴歸！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1537162000876f4501fb1c4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8d93e49d.html title=教程：採用梯度下降算法實現線性迴歸！>教程：採用梯度下降算法實現線性迴歸！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e8e17d90.html alt=重要突破！中國科學家實現基底細胞癌4.1秒人工智能精準識別 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RtbWBYL9koJMmN style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e8e17d90.html title=重要突破！中國科學家實現基底細胞癌4.1秒人工智能精準識別>重要突破！中國科學家實現基底細胞癌4.1秒人工智能精準識別</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1b218e68.html alt=圖像拼接算法及實現（一） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1534489824878547eee8fc2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1b218e68.html title=圖像拼接算法及實現（一）>圖像拼接算法及實現（一）</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>