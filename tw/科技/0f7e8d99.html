<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>基於異常的獵殺行動——自保護觸發自殺 | 极客快訊</title><meta property="og:title" content="基於異常的獵殺行動——自保護觸發自殺 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/dfic-imagehandler/02304faf-c13a-4a5c-8140-936c459a313f"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0f7e8d99.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0f7e8d99.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0f7e8d99.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0f7e8d99.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0f7e8d99.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0f7e8d99.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/0f7e8d99.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/0f7e8d99.html><meta property="article:published_time" content="2020-11-14T21:02:39+08:00"><meta property="article:modified_time" content="2020-11-14T21:02:39+08:00"><meta name=Keywords content><meta name=description content="基於異常的獵殺行動——自保護觸發自殺"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/0f7e8d99.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>基於異常的獵殺行動——自保護觸發自殺</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div class=pgc-img><img alt=基於異常的獵殺行動——自保護觸發自殺 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/02304faf-c13a-4a5c-8140-936c459a313f><p class=pgc-img-caption></p></div><p></p><h1 class=pgc-h-arrow-right>0、引言</h1><p>這次分析的問題 ，非常又意思，一款軟件的自保護機制觸發了，拋出了一次異常，在異常鏈的處理中做了點簡單的檢測，命中則再次觸發一次異常，即異常中嵌套異常，然而最具有挑戰意思的事情是如何找到案發第一現場，屋漏偏逢連夜雨，Windbg提供的常用命令集體罷工，增添了分析的趣味性。做一次偵探，從dmp的蛛絲馬跡中找到案發第一現場，分析問題的根本原因，便是此文的來由。</p><p>涉及到以下知識點：</p><p>1、命令失效時，如何手動在dmp中找到關鍵調用，關鍵數據；</p><p>2、如何手動重構棧幀，復原調用棧；</p><p>3、用戶態異常分發的優先級及路徑；</p><p>4、32位下，OS從內核分發至用戶態時做的關鍵動作，64位下又有何區別；</p><p>5、嵌套的異常如何找到案發第一現場；</p><p></p><h1 class=pgc-h-arrow-right>1、背景</h1><p>週末閒居在家，老友發來求助信息，說是玩遊戲玩的好好的，突然崩潰了，作為軟件開發的他自然想探尋下crash的原因羅，通過Everything搜索了下電腦上的*.dmp，找到了本次遊戲崩潰產生的dmp文件。題外話，遊戲一般都會在crash時保存下dmp，併發送至後臺處理，這裡能找到也就不奇怪了。然後便祭出神器——Windbg開始分析，但由於各種原因諸如MiniDump，沒有PDB，棧回溯失敗，Windbg的很多自動化命令失效等等原因，沒有分析各所以然出來，遂拋給了我，請我助其一臂之力，看看到底是啥子原因。分析之餘，覺得挺有意思，撰文以分享之。</p><p></p><h1 class=pgc-h-arrow-right>2、分析過程</h1><p>2.1 step1：看一下異常記錄，如下，為了規避哪款遊戲，這裡隱藏著與遊戲相關的信息，包括遊戲的各個模塊名，代之以GameModule,GameExe這樣的名字；</p><pre><code>0:023&gt; .exr -1ExceptionAddress: 013e50c1 (GameExe+0x000050c1)   ExceptionCode: c0000005 (Access violation)  ExceptionFlags: 00000000NumberParameters: 2   Parameter[0]: 00000001   Parameter[1]: 00000000Attempt to write to address 00000000</code></pre><p>常規的異常，往空指針裡寫數據了；</p><p>2.2 step2：再看下異常上下文，如下：</p><pre><code>0:023&gt; .ecxreax=000001e7 ebx=7755d418 ecx=7f1d0720 edx=00000000 esi=00000000 edi=0b369ee8eip=013e50c1 esp=0ea8e600 ebp=0ea8e644 iopl=0         nv up ei pl nz ac pe nccs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010216GameExe+0x50c1:013e50c1 a300000000      mov     dword ptr ds:[00000000h],eax ds:002b:00000000=????????</code></pre><p>與上邊異常記錄給的信息也是吻合的，但這條反彙編代碼非常的奇怪，居然是硬編碼好了的往0x00000000地址中寫數據，這到底是在幹嘛？看下附近的反彙編代碼吧，看看在幹什麼，如下：</p><pre><code>0:023&gt; u 013e5090  l20GameExe+0x5090:013e5090 8b442404        mov     eax,dword ptr [esp+4]013e5094 8b00            mov     eax,dword ptr [eax]013e5096 813803000080    cmp     dword ptr [eax],80000003h013e509c 752a            jne     GameExe+0x50c8 (013e50c8)013e509e 68982d4e01      push    offset GameExe+0x102d98 (014e2d98)013e50a3 6a00            push    0013e50a5 68982d4e01      push    offset GameExe+0x102d98 (014e2d98)013e50aa 68982d4e01      push    offset GameExe+0x102d98 (014e2d98)013e50af 688c2e4e01      push    offset GameExe+0x102e8c (014e2e8c)013e50b4 e8e7e00300      call    GameExe+0x431a0 (014231a0)013e50b9 83c414          add     esp,14h013e50bc e8cfe00300      call    GameExe+0x43190 (01423190)013e50c1 a300000000      mov     dword ptr ds:[00000000h],eax013e50c6 ebfe            jmp     GameExe+0x50c6 (013e50c6)013e50c8 33c0            xor     eax,eax013e50ca c20400          ret     4</code></pre><p>從上邊反匯編出來的代碼來看，有意思的還不僅僅是這一行代碼，緊接著的下一行代碼也是非常奇怪，死循環，在原地打轉。越來越有趣了，簡單分析下這段代碼的功能：</p><p>首先，這個函數沒有自己獨立的棧幀，[esp+4]取出的便是第一個參數，而這個函數也只有一個參數，ret 4可以說明；當然這裡邊沒有用到ecx，edx之類的寄存器，所以就排除了寄存器傳參的可能性；</p><p>接著，80000003h這個數字有著特殊的含義的，正如C0000005h代表的是 EXCEPTION_ACCESS_VIOLATION，80000003h代表的是 EXCEPTION_BREAKPOINT;</p><pre><code>節選自WinBase.h和WinNT.h#define STATUS_ACCESS_VIOLATION          ((DWORD)0xC0000005L)#define STATUS_BREAKPOINT                ((DWORD)0x80000003L)  #define EXCEPTION_ACCESS_VIOLATION       STATUS_ACCESS_VIOLATION#define EXCEPTION_BREAKPOINT             STATUS_BREAKPOINT</code></pre><p>這就更增加了問題的有趣性，顯然這裡是在判斷當前異常是不是EXCEPTION_BREAKPOINT，不是的話直接返回0，什麼也不幹；否則的話則調用其他函數處理，然後再次觸發寫0x00000000地址，再次嵌套觸發異常，觸發自殺；我的第一反應是：遊戲在做反調試的事情嗎？但立馬又否定了這個想法，原因很簡單——如果當前進程處於調試狀態，EXCEPTION_BREAKPOINT異常壓根不會派遣給進程，調試器就給處理掉了。當然，我們也可以看下，進程是否被調試，如下：</p><pre><code>0:023&gt; !pebPEB at 00889000    InheritedAddressSpace:    No    ReadImageFileExecOptions: No    BeingDebugged:            No    ImageBaseAddress:         013e0000    Ldr                       7755fbe0+0x068 NtGlobalFlag     : 0</code></pre><p>這些證據都或多或少的證實著，當前的遊戲進程沒有被調試。[後邊會專門寫文章講解異常是如何被CPU發現並轉交給OS，OS又是如何確認是內核異常還是用戶態異常，如果是用戶態異常，OS又是如何分發給用戶態進程的。]。先不著急回答這些問題，看下棧回溯，看看程序的執行路徑；</p><p>2.3 step3：棧回溯，如下：</p><pre><code>0:023&gt; k# ChildEBP RetAddr  WARNING: Stack unwind information not available. Following frames may be wrong.00 0ea8e644 774af15a GameExe+0x50c101 0ea8e6d8 774c088f ntdll!RtlDispatchException+0x7c02 0ea8e6d8 0f688051 ntdll!KiUserExceptionDispatcher+0xf03 0ea8eb9c 0f652ee8 libcef+0x19805104 0ea8f0e8 116521a8 libcef+0x162ee805 0ea8f264 116529ba libcef+0x21621a806 0ea8f2bc 1167c36c libcef+0x21629ba07 0ea8f2c8 11636600 libcef+0x218c36c08 0ea8f4e0 11650bb1 libcef+0x214660009 0ea8f524 11b4b196 libcef+0x2160bb10a 0ea8f538 0f692ab5 libcef+0x265b1960b 0ea8f594 0f65f0ef libcef+0x1a2ab50c 0ea8f6d8 0f65eae3 libcef+0x16f0ef0d 0ea8f758 0f6943b7 libcef+0x16eae30e 0ea8f77c 0f65ee20 libcef+0x1a43b70f 0ea8f7ac 0f65eddd libcef+0x16ee2010 0ea8f7d4 0f67a94b libcef+0x16eddd11 0ea8f7dc 0f67ad9a libcef+0x18a94b12 0ea8f814 0f65d2e2 libcef+0x18ad9a13 0ea8f830 76da62c4 libcef+0x16d2e214 0ea8f844 774b0f79 kernel32!BaseThreadInitThunk+0x2415 0ea8f88c 774b0f44 ntdll!__RtlUserThreadStart+0x2f16 0ea8f89c 00000000 ntdll!_RtlUserThreadStart+0x1b</code></pre><p>由於沒有符號，當然也肯定不會有羅，所以回溯出來的棧可讀性差，但不要緊，做逆向分析，不也這樣的嘛。但這個棧不正常，這裡還沒有進入SEH的分發，而是在VEH就被攔截掉了；VHE的全稱是Vectored Exception Handling，向量化異常處理，這個與SEH不太一樣，且只能用在Ring3，是進程級別的，不像SEH是線程級別的，異常在分發時，先遍歷VEH鏈，處理了則不會繼續往後傳遞，沒處理則繼續後遍歷，分發異常；我為什麼說當前處於VEH呢？很簡單，因為沒有看見SEH的特徵處理函數，哪怕是相關聯的一點點函數調用的影子都沒有，為了打消你的疑慮，我們來逆向分析下ntdll!RtlDispatchException的關鍵部分，這個函數很大，我們就看看774af15a返回地址附近的代碼。</p><p>2.4 step4：逆向分析關鍵API的關鍵部分，如下：</p><pre><code>0:023&gt; u 774af13fntdll!RtlDispatchException+0x61:774af13f 7411            je      ntdll!RtlDispatchException+0x74 (774af152)774af141 e89137fcff      call    ntdll!RtlGuardIsValidStackPointer (774728d7)774af146 85c0            test    eax,eax774af148 0f8468010000    je      ntdll!RtlDispatchException+0x1d8 (774af2b6)774af14e 8b542410        mov     edx,dword ptr [esp+10h]774af152 53              push    ebx774af153 8bce            mov     ecx,esi774af155 e8f7610000      call    ntdll!RtlpCallVectoredHandlers (774b5351)774af15a 84c0            test    al,al774af15c 0f851c010000    jne     ntdll!RtlDispatchException+0x1a0 (774af27e)...省略774af22a e8b13a0200      call    ntdll!RtlpExecuteHandlerForException (774d2ce0)</code></pre><p>會判斷RtlpCallVectoredHandlers()的返回值，如果是0的話，則調用RtlpExecuteHandlerForException()，那麼0是啥意思呢？且看下邊的定義，返回0意味著繼續分發異常，也就是RtlpExecuteHandlerForException()中做的勒，即遍歷SEH鏈進行異常的分發，暫且按下不表。</p><pre><code>節選自excpt.h#define EXCEPTION_EXECUTE_HANDLER       1#define EXCEPTION_CONTINUE_SEARCH       0#define EXCEPTION_CONTINUE_EXECUTION    -1</code></pre><p>回過頭來看看上邊遊戲做的事情，如果不是EXCEPTION_BREAKPOINT則讓異常繼續分發，不做任何特殊處理，如果是EXCEPTION_BREAKPOINT的話，則沒有接下來的事情了。簡單分析下RtlpCallVectoredHandlers()即可知道OS是如何管理VEH的了，如下：</p><pre><code>0:023&gt; u ntdll!RtlpCallVectoredHandlers l30ntdll!RtlpCallVectoredHandlers:774b5351 8bff            mov     edi,edi774b5353 55              push    ebp774b5354 8bec            mov     ebp,esp774b5356 83ec30          sub     esp,30h774b5359 a1d4425677      mov     eax,dword ptr [ntdll!__security_cookie (775642d4)]774b535e 33c5            xor     eax,ebp774b5360 8945fc          mov     dword ptr [ebp-4],eax774b5363 8b4508          mov     eax,dword ptr [ebp+8]774b5366 53              push    ebx774b5367 56              push    esi774b5368 8bf1            mov     esi,ecx774b536a 6bd80c          imul    ebx,eax,0Ch774b536d 648b0d30000000  mov     ecx,dword ptr fs:[30h]774b5374 894df0          mov     dword ptr [ebp-10h],ecx774b5377 8d4802          lea     ecx,[eax+2]774b537a 33c0            xor     eax,eax774b537c 8955ec          mov     dword ptr [ebp-14h],edx774b537f 8b55f0          mov     edx,dword ptr [ebp-10h]774b5382 40              inc     eax774b5383 d3e0            shl     eax,cl774b5385 81c318d45577    add     ebx,offset ntdll!LdrpVectorHandlerList (7755d418)774b538b 57              push    edi774b538c 8975e0          mov     dword ptr [ebp-20h],esi774b538f 854228          test    dword ptr [edx+28h],eax774b5392 8b55ec          mov     edx,dword ptr [ebp-14h]774b5395 c645fb00        mov     byte ptr [ebp-5],0774b5399 894dd8          mov     dword ptr [ebp-28h],ecx774b539c 0f85cbaf0300    jne     ntdll!RtlpCallVectoredHandlers+0x3b01c (774f036d)774b53a2 8b4dfc          mov     ecx,dword ptr [ebp-4]774b53a5 8a45fb          mov     al,byte ptr [ebp-5]774b53a8 33cd            xor     ecx,ebp774b53aa 5f              pop     edi774b53ab 5e              pop     esi774b53ac 5b              pop     ebx774b53ad e88eb10000      call    ntdll!__security_check_cookie (774c0540)774b53b2 8be5            mov     esp,ebp774b53b4 5d              pop     ebp774b53b5 c20400          ret     4</code></pre><p>即通過ntdll!LdrpVectorHandlerList這個鏈表來管理每個Handler， AddVectoredExceptionHandler、 RemoveVectoredExceptionHandler分別往這個鏈表裡增刪項。https://docs.microsoft.com/en-us/windows/win32/debug/vectored-exception-handling</p><p>2.5 step5：尋找案發第一現場——分析起因</p><p>到目前為止，我們看見的所有的異常上下文，包括棧回溯，都是第二案發現場了，是”mov dword ptr ds:[00000000h],eax”這條指令觸發的，它並不是最直接導致這次crash的罪魁禍首，頂多算個背鍋的，自殺的罪名被他坐實了。按理說，如果嵌套了一次異常，那.cxr後執行k進行回溯的話，棧上應該有兩個ntdll!KiUserExceptionDispatcher才對，我們看下現實的情況是怎樣的：</p><pre><code>0:023&gt; .cxr;k# ChildEBP RetAddr  00 0ea8cd98 76f41d80 ntdll!NtWaitForMultipleObjects+0xc01 0ea8cf2c 76f41c78 kernelbase!WaitForMultipleObjectsEx+0xf002 0ea8cf48 71021997 kernelbase!WaitForMultipleObjects+0x18WARNING: Stack unwind information not available. Following frames may be wrong.03 0ea8dfdc 71021179 GameCrashdmp+0x199704 0ea8dfe4 774edff0 GameCrashdmp+0x117905 0ea8f88c 774b0f44 ntdll!__RtlUserThreadStart+0x3d0a606 0ea8f89c 00000000 ntdll!_RtlUserThreadStart+0x1b</code></pre><p>what？？？這是啥，居然一個ntdll!KiUserExceptionDispatcher都沒有，剛剛上邊.ecxr之後的k看棧回溯不是還有一個ntdll!KiUserExceptionDispatcher的嗎？怎麼現在一個都沒有了？這當然是Windbg在棧回溯時除了問題了，而且也經常會出問題，這也怪不得他，原因有很多，我們沒有符號，dmp也是Minidump類型的，有的也是FPO的，它回溯起來肯定會有問題的。現在就有兩個問題需要解決了，第一：上邊出現的這個ntdll!KiUserExceptionDispatcher是第一案發現場還是。。。</p><p>第二：如果是第一案發現場，那第二案發現場的ntdll!KiUserExceptionDispatcher如何找出來；</p><p>我們再用下Windbg提供的其他兩個很厲害的命令來找ntdll!KiUserExceptionDispatcher，看看能不能揪出來，如下:</p><pre><code>0:023&gt; !ddstackRange: 0ea89000-&gt;0ea900000x0ea8cd90    0x664c17e5    nvwgf2um+005817e50x0ea8ce1c    0x76f4627c    kernelbase!CreateProcessW+0000002c0x0ea8e004    0x774c2330    ntdll!_except_handler4_common+000000800x0ea8e1c8    0x01426886    GameExe+000468860x0ea8e244    0x7755d418    ntdll!LdrpVectorHandlerList+000000000x0ea8e274    0x01426886    GameExe+000468860x0ea8e400    0x013e50c1    GameExe+000050c10x0ea8e490    0x013e50c1    GameExe+000050c10x0ea8e5dc    0x014d5818    GameExe+000f58180x0ea8e5f4    0x014e2d98    GameExe+00102d980x0ea8e638    0x013e5090    GameExe+000050900x0ea8e648    0x774af15a    ntdll!RtlDispatchException+0000007c0x0ea8e768    0x1165331a    libcef+0216331a0x0ea8e814    0x1165331a    libcef+0216331a0x0ea8e980    0x0f688051    libcef+001980510x0ea8eb04    0x77185bd9    ucrtbase!&lt;lambda_54dcfcba6f8e0c549fa430f4d53fb7dd&gt;::operator()+000000330x0ea8eb64    0x0f65390b    libcef+0016390b0x0ea8ec54    0x5deb11c8    AudioSes+000011c80x0ea8f0f8    0x0f653f19    libcef+00163f190x0ea8f158    0x11636410    libcef+021464100x0ea8f2e8    0x116362c5    libcef+021462c50x0ea8f340    0x10cc84df    libcef+017d84df0x0ea8f3b0    0x10cc9c91    libcef+017d9c910x0ea8f528    0x11b4b196    libcef+0265b1960x0ea8f54c    0x0f3e3702    ffmpeg+002237020x0ea8f564    0x0f692aca    libcef+001a2aca0x0ea8f574    0x0f3e3702    ffmpeg+002237020x0ea8f57c    0x1165095c    libcef+0216095c0x0ea8f5b4    0x0f3e1bd3    ffmpeg+00221bd30x0ea8f724    0x0f3e3702    ffmpeg+002237020x0ea8f794    0x0f363c33    ffmpeg+001a3c330x0ea8f850    0x664c22d5    nvwgf2um+005822d50x0ea8f898    0x774d2ec5    ntdll!FinalExceptionHandlerPad37+000000000:023&gt; !findstack ntdll!KiUserExceptionDispatc*rScanning thread 004</code></pre><p>很遺憾，這些命令集體啞火，啥幫助也沒有，我們要開始靠自己的雙手來掘金了，使用dps來做，輸出的太多了，簡單整理下如下所示：</p><div class=pgc-img><img alt=基於異常的獵殺行動——自保護觸發自殺 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a2931a662e8b44a1b05a6b0c1b7ac894><p class=pgc-img-caption></p></div><p>果然不出所料，找出來了。根據棧的遞減原理，我們可以推斷，第一案發現場的ntdll!KiUserExceptionDispatcher應該是0x0ea8e6dc這個，下一步就是還原到案發第一現場了，如下操作：</p><pre><code>KiUserExceptionDispatcher( PEXCEPTION_RECORD pExcptRec, CONTEXT * pContext )0:023&gt; dd 0ea8e6dc0ea8e6dc  774c088f 0ea8e6f0 0ea8e740 0ea8e6f00ea8e6ec  0ea8e740 80000003 00000000 000000000ea8e6fc  0f688051 00000001 00000000 000000000ea8e70c  00000000 00000000 00000000 000000000ea8e71c  00000000 00000000 00000000 000000000ea8e72c  00000000 00000000 00000000 000000000ea8e73c  00000000 0001007f 00000000 000000000ea8e74c  00000000 00000000 00000000 00000000</code></pre><p>這裡需要說明下，32位的程序，OS在從內核將異常分發至用戶態時，會偽造兩個參數，並且通過用戶態棧傳遞，而對於64位的程序，則有差別，是通過寄存器傳遞的參數，而非通過棧，這個後邊分析dmp時詳解；好了，有了KiUserExceptionDispatcher的原型，又有了傳遞給他的兩個參數，那麼下一步就開始復原案發現場吧。</p><pre><code>0:023&gt; .exr 0ea8e6f0ExceptionAddress: 0f688051 (libcef+0x00198051)   ExceptionCode: 80000003 (Break instruction exception)  ExceptionFlags: 00000000NumberParameters: 1   Parameter[0]: 000000000:023&gt; .cxr 0ea8e740eax=0ea8ec00 ebx=0ea8f1a8 ecx=00000000 edx=000003d1 esi=0ea8f1b4 edi=000003d1eip=0f688051 esp=0ea8eba0 ebp=0ea8f0e8 iopl=0         nv up ei pl zr na pe nccs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00000246libcef+0x198051:0f688051 ??              ???</code></pre><p>看到這些數據，我懸著的心落下來了，畢竟看到這個就已然證明了之前的推測都是正確的。簡單分析下，異常記錄中記錄下來的異常Code是80000003，以為了遊戲自身觸發了一個int 3的斷點，這於之前那裡分析的邏輯也是對的上的，異常上下文則直接恢復出了遊戲執行int 3時的執行狀態；可以的是，dmp時這塊內存沒有被保存下來，導致現在看不了反彙編，不過也不要緊了，這裡的指令一定是int 3；</p><p>這裡的指令看不了，但還是可以看下程序執行到這裡的執行路徑，看下調用棧吧，如下：</p><pre><code>0:023&gt; kf#   Memory  ChildEBP RetAddr  WARNING: Stack unwind information not available. Following frames may be wrong.00           0ea8eb9c 0f652ee8 libcef+0x19805101       54c 0ea8f0e8 116521a8 libcef+0x162ee802       17c 0ea8f264 116529ba libcef+0x21621a803        58 0ea8f2bc 1167c36c libcef+0x21629ba04         c 0ea8f2c8 11636600 libcef+0x218c36c05       218 0ea8f4e0 11650bb1 libcef+0x214660006        44 0ea8f524 11b4b196 libcef+0x2160bb107        14 0ea8f538 0f692ab5 libcef+0x265b19608        5c 0ea8f594 0f65f0ef libcef+0x1a2ab509       144 0ea8f6d8 0f65eae3 libcef+0x16f0ef0a        80 0ea8f758 0f6943b7 libcef+0x16eae30b        24 0ea8f77c 0f65ee20 libcef+0x1a43b70c        30 0ea8f7ac 0f65eddd libcef+0x16ee200d        28 0ea8f7d4 0f67a94b libcef+0x16eddd0e         8 0ea8f7dc 0f67ad9a libcef+0x18a94b0f        38 0ea8f814 0f65d2e2 libcef+0x18ad9a10        1c 0ea8f830 76da62c4 libcef+0x16d2e211        14 0ea8f844 774b0f79 kernel32!BaseThreadInitThunk+0x2412        48 0ea8f88c 774b0f44 ntdll!__RtlUserThreadStart+0x2f13        10 0ea8f89c 00000000 ntdll!_RtlUserThreadStart+0x1b0:023&gt; ?54cEvaluate expression: 1356 = 0000054c</code></pre><p>棧有些不太對勁，表現為01#棧幀太大了；用了這麼多字節，先來看看這裡存儲的數據有沒有什麼特別的；找到的字符串，如下所示：</p><pre><code>0:023&gt; da 0ea8ecdc+8 l100000ea8ece4  "[0812/210050:FATAL:core_audio_ut"0ea8ed04  "il_win.cc(292)] Check failed: de"0ea8ed24  "vice_enumerator. .Backtrace:..ce"0ea8ed44  "f_time_to_timet [0x0F6889A7+8270"0ea8ed64  "31]..cef_time_to_timet [0x0F652D"0ea8ed84  "17+606727]..TerminateProcessWith"0ea8eda4  "outDump [0x116521A8+10745848]..T"0ea8edc4  "erminateProcessWithoutDump [0x11"0ea8ede4  "6529BA+10747914]..TerminateProce"0ea8ee04  "ssWithoutDump [0x1167C36C+109183"0ea8ee24  "32]..TerminateProcessWithoutDump"0ea8ee44  " [0x11636600+10632272]..Terminat"0ea8ee64  "eProcessWithoutDump [0x11650BB1+"0ea8ee84  "10740225]..TerminateProcessWitho"0ea8eea4  "utDump [0x11B4B196+15960038]..Ge"0ea8eec4  "tHandleVerifier [0x0F692AB5+469]"0ea8eee4  "..cef_time_to_timet [0x0F65F0EF+"0ea8ef04  "656863]..cef_time_to_timet [0x0F"0ea8ef24  "65EAE3+655315]..GetHandleVerifie"0ea8ef44  "r [0x0F6943B7+6871]..cef_time_to"0ea8ef64  "_timet [0x0F65EE20+656144]..cef_"0ea8ef84  "time_to_timet [0x0F65EDDD+656077"0ea8efa4  "]..cef_time_to_timet [0x0F67A94B"0ea8efc4  "+769595]..cef_time_to_timet [0x0"0ea8efe4  "F67AD9A+770698]..cef_time_to_tim"0ea8f004  "et [0x0F65D2E2+649170]..BaseThre"0ea8f024  "adInitThunk [0x76DA62C4+36]..Rtl"0ea8f044  "SubscribeWnfStateChangeNotificat"0ea8f064  "ion [0x774B0F79+1081]..RtlSubscr"0ea8f084  "ibeWnfStateChangeNotification [0"0ea8f0a4  "x774B0F44+1028].."</code></pre><p>整理之後如下所示：</p><div class=pgc-img><img alt=基於異常的獵殺行動——自保護觸發自殺 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/dd914f0c237e4783862b7d10ddab00eb><p class=pgc-img-caption></p></div><p>原理是一大推字符串佔據可這塊內存，但這著實不是什麼好習慣；現在來解釋下，為何遊戲進程自己就執行了一個int 3；根據提示的字符串文本可推測：</p><p>libcef.dll中檢測到一個FATAL錯誤，具體的錯誤就是跟audio相關的校驗失敗了，由於Check failed，且libcef還認為這是個FATAL——致命類型的錯誤，就直接執行int 3 觸發斷點了；話又說回來，這種死法確實不優雅也不高明。libcef的具體信息如下：</p><pre><code>0:023&gt; lmvm libcefBrowse full module liststart    end        module name0f4f0000 129bd000   libcef   T (no symbols)               Loaded symbol image file: libcef.dll    Image path: c:xxxxlibcef.dll    Image name: libcef.dll    Browse all global symbols  functions  data    Timestamp:        Wed Jan 30 12:17:12 2019 (5c512548)    CheckSum:         0348AAFD    ImageSize:        034CD000    File version:     2.1432.2186.0    Product version:  2.1432.2186.0    File flags:       0 (Mask 17)    File OS:          4 Unknown Win32    File type:        2.0 Dll    File date:        00000000.00000000    Translations:     0000.04b0 0000.04e4 0409.04b0 0409.04e4    Information from resource tables:</code></pre><p>沒啥有用的信息，我有看了看我本地有沒有這個dll，結果還真有，印象筆記裡就有用他；原來是大佬google家的，失敬失敬。</p><div class=pgc-img><img alt=基於異常的獵殺行動——自保護觸發自殺 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ab4ca36465d544abb0cf24fdfe098e84><p class=pgc-img-caption></p></div><p>2.6 step6：最後的戰役——手動重構戰；</p><p>現在想看下整個程序從第一次異常觸發到異常的分發過程再到程序的最後一條指令的整個棧回溯，該怎麼辦呢？當然是棧重構了。 重構的思路是什麼？需要怎麼做呢？重構做要做的核心工作便是修復受損的棧幀，那如何找到那些棧幀是受損的呢？靠猜測，當然不是瞎猜，綜合現有的證據。我們回到當前線程的初始上下文環境，然後棧回溯下看看；</p><pre><code>0:023&gt; .cxr;kfResetting default scope#   Memory  ChildEBP RetAddr  00           0ea8cd98 76f41d80 ntdll!NtWaitForMultipleObjects+0xc01       194 0ea8cf2c 76f41c78 kernelbase!WaitForMultipleObjectsEx+0xf002        1c 0ea8cf48 71021997 kernelbase!WaitForMultipleObjects+0x18WARNING: Stack unwind information not available. Following frames may be wrong.03      1094 0ea8dfdc 71021179 GameCrashDmp+0x199704         8 0ea8dfe4 774edff0 GameCrashDmp+0x117905      18a8 0ea8f88c 774b0f44 ntdll!__RtlUserThreadStart+0x3d0a606        10 0ea8f89c 00000000 ntdll!_RtlUserThreadStart+0x1b</code></pre><p>根據上邊的信息可知，03#和05#棧幀有問題，我們逐一進行查看；</p><p>先看03#的數據:</p><div class=pgc-img><img alt=基於異常的獵殺行動——自保護觸發自殺 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/7aa09f224c964ebca2945ab947a2968c><p class=pgc-img-caption></p></div><p>再看05#幀的數據:</p><pre><code>0:023&gt; dd 0ea8dfe40ea8dfe4  0ea8f88c 774edff0 0ea8e014 774c2a200ea8dff4  0ea8f88c 00000000 fffffffe 0ea8e02c0ea8e004  774c2330 00000000 00000000 000000000ea8e014  0ea8e150 0ea8e1a0 77548760 000000010ea8e024  77548750 00000047 0ea8e04c 774c67700ea8e034  775642d4 774c0540 0ea8e150 0ea8f87c0ea8e044  0ea8e1a0 0ea8e0dc 0ea8e070 774d2d420ea8e054  0ea8e150 0ea8f87c 0ea8e1a0 0ea8e0dc</code></pre><p>如上所示，這個棧幀明顯有問題了，我們試著這樣改一下，看看效果如何：</p><pre><code>0:023&gt; ed 0ea8dfe4  0ea8dfe4+80:023&gt; kf#   Memory  ChildEBP RetAddr  00           0ea8cd98 76f41d80 ntdll!NtWaitForMultipleObjects+0xc01       194 0ea8cf2c 76f41c78 kernelbase!WaitForMultipleObjectsEx+0xf002        1c 0ea8cf48 71021997 kernelbase!WaitForMultipleObjects+0x1803      1094 0ea8dfdc 71021179 GameCrashdmp+0x199704         8 0ea8dfe4 774edff0 GameCrashdmp+0x117905         8 0ea8dfec 774c2a20 ntdll!__RtlUserThreadStart+0x3d0a606        14 0ea8e000 774c2330 ntdll!_EH4_CallFilterFunc+0x1207        2c 0ea8e02c 774c6770 ntdll!_except_handler4_common+0x8008        20 0ea8e04c 774d2d42 ntdll!_except_handler4+0x2009        24 0ea8e070 774d2d14 ntdll!ExecuteHandler2+0x260a        c8 0ea8e138 774c088f ntdll!ExecuteHandler+0x240b         0 0ea8e138 013e50c1 ntdll!KiUserExceptionDispatcher+0xf        ;第二次異常分發0c       50c 0ea8e644 774af15a GameExe+0x50c1                             ;案發第二現場0d        94 0ea8e6d8 774c088f ntdll!RtlDispatchException+0x7c0e         0 0ea8e6d8 0f688051 ntdll!KiUserExceptionDispatcher+0xf        ;第一次異常分發0f       4c4 0ea8eb9c 0f652ee8 libcef+0x198051                            ;案發第一現場10       54c 0ea8f0e8 116521a8 libcef+0x162ee811       17c 0ea8f264 116529ba libcef+0x21621a812        58 0ea8f2bc 1167c36c libcef+0x21629ba13         c 0ea8f2c8 11636600 libcef+0x218c36c14       218 0ea8f4e0 11650bb1 libcef+0x214660015        44 0ea8f524 11b4b196 libcef+0x2160bb116        14 0ea8f538 0f692ab5 libcef+0x265b19617        5c 0ea8f594 0f65f0ef libcef+0x1a2ab518       144 0ea8f6d8 0f65eae3 libcef+0x16f0ef19        80 0ea8f758 0f6943b7 libcef+0x16eae31a        24 0ea8f77c 0f65ee20 libcef+0x1a43b71b        30 0ea8f7ac 0f65eddd libcef+0x16ee201c        28 0ea8f7d4 0f67a94b libcef+0x16eddd1d         8 0ea8f7dc 0f67ad9a libcef+0x18a94b1e        38 0ea8f814 0f65d2e2 libcef+0x18ad9a1f        1c 0ea8f830 76da62c4 libcef+0x16d2e220        14 0ea8f844 774b0f79 kernel32!BaseThreadInitThunk+0x2421        48 0ea8f88c 774b0f44 ntdll!__RtlUserThreadStart+0x2f22        10 0ea8f89c 00000000 ntdll!_RtlUserThreadStart+0x1b</code></pre><p>完美，這個棧回溯要好得多，程序的執行脈絡很清晰了；</p><p></p><h1 class=pgc-h-arrow-right>3、總結</h1><p>本文從異常入手，通過各種分析，辨識出第一次案發現場，第二次案發現場，並逆向分析了關鍵的異常分發函數，簡要介紹了VEH，接著根據搜索到的數據猜測除了程序為何觸發int 3進行自殺的動作；最後通過手動重構，恢復出程序執行到死亡的整個執行流程；</p><p>本文由<strong>void *</strong>原創發佈<br>轉載，請參考轉載聲明，註明出處： https://www.anquanke.com/post/id/209035</p><div class=tt-column-card data-content='{"url":"","content":"","thumb_url":"http://p10.pstatp.com/large/pgc-image/47e2f4b3dc7d4e349073a3b4be67210a","title":"web安全深度解析","author_description":"安界","price":299,"share_price":119.6,"sold":0,"column_id":"6844049146677035267","new_thumb_url":"http://sf3-ttcdn-tos.pstatp.com/img/pgc-image/47e2f4b3dc7d4e349073a3b4be67210a"}'><p class=column-placeholder></p></div><p>我是安仔，一名剛入職網絡安全圈的網安萌新，歡迎關注我，跟我一起成長； 歡迎大傢俬信回覆【入群】，加入安界網大咖交流群，跟我一起交流討論。</p><p style=text-align:start>小白入行網絡安全、混跡安全行業找大咖，以及更多成長乾貨資料，歡迎關注#安界網人才培養計劃#、#網絡安全在我身邊#、@安界人才培養計劃</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>異常</a></li><li><a>獵殺</a></li><li><a>行動</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/d2d681b6.html alt=中超賽場異常火爆，賽後場面陷入一片混亂，數名安保人員驅趕球員 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c6d14dc62de74f24afb5dfefc3a2ee52 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d2d681b6.html title=中超賽場異常火爆，賽後場面陷入一片混亂，數名安保人員驅趕球員>中超賽場異常火爆，賽後場面陷入一片混亂，數名安保人員驅趕球員</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cd064e23.html alt=掌上生活“異常登錄5702”招行阻擋羊毛黨或存“誤傷” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RrZPeex25JpWHz style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cd064e23.html title=掌上生活“異常登錄5702”招行阻擋羊毛黨或存“誤傷”>掌上生活“異常登錄5702”招行阻擋羊毛黨或存“誤傷”</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/40ae48c0.html alt=利劍行動丨“魔鬼周”裡到處充滿“政”能量 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1527775437609be11dfc1fa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/40ae48c0.html title=利劍行動丨“魔鬼周”裡到處充滿“政”能量>利劍行動丨“魔鬼周”裡到處充滿“政”能量</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/af7275e8.html alt="【樹鑄謀 在行動】聞喜農商銀行各網點召開差距分析會 推進“樹鑄謀”主題活動深入開展" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/21a969fdde4f436c877050ab6dd2aa39 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/af7275e8.html title="【樹鑄謀 在行動】聞喜農商銀行各網點召開差距分析會 推進“樹鑄謀”主題活動深入開展">【樹鑄謀 在行動】聞喜農商銀行各網點召開差距分析會 推進“樹鑄謀”主題活動深入開展</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8f5e3399.html alt=你最近也被稅務局通知自查個稅異常記錄了麼？如何更正申報數據？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/4e7ec7ffb2c342c7be4ddb095b3e6b78 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8f5e3399.html title=你最近也被稅務局通知自查個稅異常記錄了麼？如何更正申報數據？>你最近也被稅務局通知自查個稅異常記錄了麼？如何更正申報數據？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/48369f70.html alt=你的企業被列入經營異常名錄了嗎？趕緊查一下吧 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a0b412cb3a8143cdb4c6c61fae4d2005 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/48369f70.html title=你的企業被列入經營異常名錄了嗎？趕緊查一下吧>你的企業被列入經營異常名錄了嗎？趕緊查一下吧</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c53c25fc.html alt=異常檢測怎麼做，試試孤立隨機森林算法（附代碼） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/921efc56bfa341e49b30abd3ddc326ed style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c53c25fc.html title=異常檢測怎麼做，試試孤立隨機森林算法（附代碼）>異常檢測怎麼做，試試孤立隨機森林算法（附代碼）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/092053a1.html alt=異常檢測的N種方法，阿里工程師都盤出來了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/9ef2201093fc4b46982d0c55442a6b5e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/092053a1.html title=異常檢測的N種方法，阿里工程師都盤出來了>異常檢測的N種方法，阿里工程師都盤出來了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ddcce717.html alt="被列入異常名錄了，好嚇人，咋辦？看這>>" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/5b12000bf34b4284c92f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ddcce717.html title="被列入異常名錄了，好嚇人，咋辦？看這>>">被列入異常名錄了，好嚇人，咋辦？看這>></a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bfcd46de.html alt=32家個體公司，全部被列入異常名錄？都是地址惹的禍 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/15144889-84f2-4333-aa5a-a375984313e7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bfcd46de.html title=32家個體公司，全部被列入異常名錄？都是地址惹的禍>32家個體公司，全部被列入異常名錄？都是地址惹的禍</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/03619879.html alt="java foreach  對異常的處理" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/66551f46-dfc4-46b3-8cb2-b3551d77e648 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/03619879.html title="java foreach  對異常的處理">java foreach 對異常的處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ffb4d729.html alt=「每天一道面試題」檢查異常和非檢查異常的區別？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/152112070414787f2e33262 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ffb4d729.html title=「每天一道面試題」檢查異常和非檢查異常的區別？>「每天一道面試題」檢查異常和非檢查異常的區別？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/12d49a9e.html alt="一文讀懂 Java 異常處理" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/6c395510d4e245a19bf9cdde6dd9ac2e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/12d49a9e.html title="一文讀懂 Java 異常處理">一文讀懂 Java 異常處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c620fd72.html alt=企業被工商列入異常名錄怎麼辦 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/a5e6d22e7101421f961ea2c9e38a7737 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c620fd72.html title=企業被工商列入異常名錄怎麼辦>企業被工商列入異常名錄怎麼辦</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/112f60f0.html alt=公示信息抽查中被列入了經營異常名錄，怎麼辦？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/S6f6k2a77xyjv2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/112f60f0.html title=公示信息抽查中被列入了經營異常名錄，怎麼辦？>公示信息抽查中被列入了經營異常名錄，怎麼辦？</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>