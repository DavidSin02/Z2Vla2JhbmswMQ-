<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Linux網絡編程——無連接和面向連接協議的區別 | 极客快訊</title><meta property="og:title" content="Linux網絡編程——無連接和面向連接協議的區別 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/38755fbc61154d06a243d159fdae398b"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/103109d.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/103109d.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/103109d.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/103109d.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/103109d.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/103109d.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/103109d.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/103109d.html><meta property="article:published_time" content="2020-10-29T20:49:59+08:00"><meta property="article:modified_time" content="2020-10-29T20:49:59+08:00"><meta name=Keywords content><meta name=description content="Linux網絡編程——無連接和面向連接協議的區別"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/103109d.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Linux網絡編程——無連接和面向連接協議的區別</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>網絡編程中最基本的概念就是面向連接（connection-oriented）和無連接（connectionless）協議。儘管本質上來說，兩者之間的區別並不難理解，但對那些剛剛開始進行網絡編程的人來說，卻是個很容易混淆的問題。這個問題與上下文有些關聯：很顯然，如果兩臺計算機要進行通信，就必須以某種形式“連接”起來，那“無連接通信”又是什麼意思呢？</p><p style=text-align:start>答案是：<strong>面向連接和無連接指的都是協議。</strong>也就是說，這些術語指的並不是物理介質本身，而是用來說明如何在物理介質上傳輸數據的。面向連接和無連接協議可以，而且通常也確實會共享同一條物理介質。<br>如果兩者的區別與承載數據的物理介質無關，又和什麼有關呢？它們的本質區別在於，對無連接協議來說，每個分組的處理都獨立於所有其他分組，而對面向連接的協議來說，協議實現則維護了與後繼分組有關的狀態信息。</p><p style=text-align:start>無連接協議中的分組被稱為數據報（datagram），每個分組都是獨立尋址，並由應用程序發送的。從協議的角度來看，每個數據報都是一個獨立的實體，與在兩個相同的對等實體之間傳送的任何其他數據報都沒有關係，這就意味著協議很可能是不可靠的。也就是說，網絡會盡最大努力傳送每一個數據報，但並不保證數據報不丟失、不延遲或者不錯序傳輸。</p><p style=text-align:start><br>另一方面，面向連接的協議則維護了分組之間的狀態，使用這種協議的應用程序通常都會進行長期的對話。記住這些狀態，協議就可以提供可靠的傳輸。比如，發送端可以記住哪些數據已經發送出去了但還未被確認，以及數據是什麼時候發送的。如果在某段時間間隔內沒有收到確認，發送端可以重傳數據。接收端可以記住已經收到了哪些數據，並將重複的數據丟棄。如果分組不是按序到達的，接收端可以將其保存下來，直到邏輯上先於它的分組到達為止。</p><p style=text-align:start>典型的面向連接協議有三個階段。第一階段，在對等實體間建立連接。接下來是數據傳輸階段，在這個階段中，數據在對等實體間傳輸。最後，當對等實體完成數據傳輸時，連接被拆除。</p><p style=text-align:start>一種標準的類比是：<strong>使用無連接協議就像寄信，而使用面向連接的協議就像打電話。</strong></p><p style=text-align:start>給朋友寄信時，每封信都是一個獨立尋址且自包含的實體。郵局在處理這些信件時不會考慮到兩個通信者之間的任何其他信件。郵局不會維護以往通信者的歷史記錄--也就是說，它不會維護信件之間的狀態。郵局也不保證信件不丟失、不延遲、不錯序。這種方式就對應於無連接協議發送數據報的方式。（用明信片進行類比會更合適一些，因為寫錯地址的信件會被退回發信人，而（和典型的無連接協議數據報一樣）明信片則不會。）<br></p><p style=text-align:start><strong>需要C/C++ Linux服務器架構師學習資料私信“資料”（資料包括C/C++，Linux，golang技術，Nginx，ZeroMQ，MySQL，Redis，fastdfs，MongoDB，ZK，流媒體，CDN，P2P，K8S，Docker，TCP/IP，協程，DPDK，ffmpeg等），免費分享</strong></p><div class=pgc-img><img alt=Linux網絡編程——無連接和麵向連接協議的區別 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/38755fbc61154d06a243d159fdae398b><p class=pgc-img-caption></p></div><p style=text-align:start>現在來看看不是給朋友寄信，而是打電話時會發生些什麼事情。</p><p style=text-align:start>首先，撥朋友的號碼來發起呼叫。朋友應答，會說“嗨”之類的話，然後我們迴應：“嗨，Lucy。我是 Mike。”我們和朋友聊一會兒，然後互說再見並掛機。這是面向連接協議中發生的典型狀況。在連接建立階段，一端與其對等實體聯繫，交換初始問候信息，對會話中要用到的一些參數和選項進行溝通，然後連接進入數據傳輸階段。<br>在電話交談的過程中，兩端用戶都知道他們在和誰說話，因此沒必要不停地說“這是 Mike 在跟 Lucy 說話”。也沒必要在每次說話之前都撥一次朋友的電話號碼——我們的電話已經連接起來了。同理，在面向連接協議的數據傳輸階段，也沒必要說明我們自己或對等實體的地址。連接為我們維護的狀態中包含了這些地址。我們只要發送數據就行了，不需要考慮尋址或其他與協議相關的問題。<br>就像用電話交談一樣，連接的任一端完成數據的傳輸時，都要通知其對等實體。兩端都完成傳輸時，要依次將連接拆除。</p><p style=text-align:start>既然無連接協議有這麼多的缺點，大家可能會奇怪，為什麼還要使用這種協議呢？我們會看到，在很多情況下，使用無連接協議構建應用程序都是有意義的。比如，使用無連接協議可以很方便地支持一對多和多對一通信，而面向連接協議通常都需要多個獨立的連接才能做到。但更重要的是，無連接協議是構建面向連接協議的基礎。TCP/IP 是基於一個４層的協議棧，如下圖所示：</p><div class=pgc-img><img alt=Linux網絡編程——無連接和麵向連接協議的區別 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ae48525c66234d5f8ece5bbd1b13c006><p class=pgc-img-caption></p></div><p>如圖所示，TCP 和 UDP 都是構建在 IP 之上的。因此，IP 是構建整個 TCP/IP 協議族的基礎。但 IP 提供的是一種盡力而為的、不可靠的無連接服務。它接收來自其上層的分組，將它們封裝在一個 IP 分組中，根據路由為分組選擇正確的硬件接口，從這個接口將分組發送出去。一旦將分組發送出去了，IP 就不再關心這個分組了。和所有無連接協議一樣，它將分組發送出去之後就不再記得這個分組了。<br></p><p style=text-align:start>這種簡單性也是 IP 的主要優點。因為它對底層的物理介質沒有作任何假設，所以在任何能夠承載分組的物理鏈路上都可以運行 IP。例如，IP 可以運行在簡單的串行鏈路、以太網和令牌環 LAN、X.25 和使用 ATM（Asychronous Transfer Mode，異步轉移模式）的 WAN、CDPD（Cellular Digital Packet Data，無線蜂窩數字分組數據）網，以及很多其他網絡上。儘管這些網絡技術之間有很大的差異，但 IP 對它們一視同仁，除了認為它們可以轉發分組之外沒有對其作任何假設。這種機制隱含了很深的意義。IP 可以運行在任何能夠承載分組的網絡上，所以整個 TCP/IP 協議族也可以。<br></p><p style=text-align:start>現在我們來看看 TCP 是怎樣利用這種簡單的無連接服務來提供可靠的面向連接服務的。TCP 的分組被稱為段（segment），是放在 IP 數據報中發送的，因此，根本無法假定這些分組會抵達目的地，更不用說保證分組無損壞且以原來的順序到達了。</p><p style=text-align:start><br></p><p style=text-align:start><strong>為了提供這種可靠性，TCP 向基本的 IP 服務中添加了三項功能</strong>：<br>首先，它為 TCP 段中的數據提供了校驗和。這樣有助於確保抵達目的地的數據在傳輸過程中不會被網絡損壞。<br>第二，它為每字節分配了一個序列號，這樣，如果數據抵達目的地時真的錯序了，接收端也能夠按照恰當的順序將其重裝起來。當然，TCP 並沒有為每字節都附加一個序列號。實際上，每個 TCP 段的首部都包含了段中第一字節的序列號。這樣，就隱含地知道了段中其他字節的序列號。<br>第三，TCP 提供了一種確認-重傳機制，以確保最終每個段都會被傳送出去。<br></p><p style=text-align:start>另一方面，UDP 為編寫應用程序的程序員提供了一種不可靠的無連接服務。事實上，UDP 只向底層的 IP 協議中添加了兩項功能。</p><p style=text-align:start>首先，它提供了一個可選的校驗和來檢測數據的損壞情況。儘管 IP 也有校驗和，但它只對 IP 分組首部進行計算，所以，TCP 和 UDP 也都提供了校驗和來保護它們自己的首部和數據。</p><p style=text-align:start>其次，UDP 向 IP添加的第二項特性就是端口的概念。<br></p><p style=text-align:start>回到與電話/寄信的類比中來，我們可以把 TCP 連接中的網絡地址當作一個辦公室總機的電話號碼，把端口號當作辦公室中某臺正被呼叫的特定電話的分機號。同理，可以將UDP網絡地址當作一座公寓樓的地址，並把端口號當作公寓樓大廳中的個人郵箱</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Linux</a></li><li><a>網絡</a></li><li><a>編程</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/7e66a0e7.html alt=Linux網絡編程——UDP廣播詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/a2667182b3d34b2e98e8503a00af90fd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7e66a0e7.html title=Linux網絡編程——UDP廣播詳解>Linux網絡編程——UDP廣播詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2806cf4d.html alt=嵌入式Linux編程——程序員小白不懂的進程、信號量、併發、互斥 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6fea5f2744614de3884ab26fa09e5a40 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2806cf4d.html title=嵌入式Linux編程——程序員小白不懂的進程、信號量、併發、互斥>嵌入式Linux編程——程序員小白不懂的進程、信號量、併發、互斥</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e7646f9b.html alt=Linux高級網絡編程篇-UDP丟包問題總結 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e7646f9b.html title=Linux高級網絡編程篇-UDP丟包問題總結>Linux高級網絡編程篇-UDP丟包問題總結</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6395d518.html alt=Linux內核網絡設備驅動 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/a142a9a74ca54da4851cedb3505e52ef style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6395d518.html title=Linux內核網絡設備驅動>Linux內核網絡設備驅動</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/426b5581.html alt="一篇文章告訴你：Linux 網絡驅動，網卡原理，它們之間怎麼交互？" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/558e398aa7324540ab97b34d2d46930a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/426b5581.html title="一篇文章告訴你：Linux 網絡驅動，網卡原理，它們之間怎麼交互？">一篇文章告訴你：Linux 網絡驅動，網卡原理，它們之間怎麼交互？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c500d29b.html alt="高級網絡編程之疑症：TCP 的 Peer 兩端同時斷開連接" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/153201394276200d66036c8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c500d29b.html title="高級網絡編程之疑症：TCP 的 Peer 兩端同時斷開連接">高級網絡編程之疑症：TCP 的 Peer 兩端同時斷開連接</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/ca430d03.html alt=Linux高性能服務器編程之高級I/O函數詳解（含實例代碼） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/a2cc0f57fdec4d4bae7110590a705e39 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/ca430d03.html title=Linux高性能服務器編程之高級I/O函數詳解（含實例代碼）>Linux高性能服務器編程之高級I/O函數詳解（含實例代碼）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a96a3a1.html alt=嵌入式linux網絡編程—學TCPIP網絡的看過來，終於有人講清楚了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a9f8dacb3f5c4b27becd312c01203d69 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a96a3a1.html title=嵌入式linux網絡編程—學TCPIP網絡的看過來，終於有人講清楚了>嵌入式linux網絡編程—學TCPIP網絡的看過來，終於有人講清楚了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/732d199.html alt=嵌入式Linux系統編程——linux大神深度給你講解進程、調度、信號 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/88364fad7d5246c191ed1444d983d186 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/732d199.html title=嵌入式Linux系統編程——linux大神深度給你講解進程、調度、信號>嵌入式Linux系統編程——linux大神深度給你講解進程、調度、信號</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6049529.html alt=嵌入式linux網絡編程——你所不知道的計算機網絡系統，精品講解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/23be2c97fd8344c9aef5fb19168425ef style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6049529.html title=嵌入式linux網絡編程——你所不知道的計算機網絡系統，精品講解>嵌入式linux網絡編程——你所不知道的計算機網絡系統，精品講解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/42e7ad9.html alt="網絡編程 用戶態協議棧之 TCP/IP 的設計" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f1ee5eb624d94284bf71514f3cc5ea7b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/42e7ad9.html title="網絡編程 用戶態協議棧之 TCP/IP 的設計">網絡編程 用戶態協議棧之 TCP/IP 的設計</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/731d1aa.html alt="網絡編程 - TCP/IP協議" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b35dbde7fc6b4b9da051bf33eace2319 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/731d1aa.html title="網絡編程 - TCP/IP協議">網絡編程 - TCP/IP協議</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ea1bb612.html alt=光纜——未來網絡主導 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e75c1afe12354a93bad8495ad1057693 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ea1bb612.html title=光纜——未來網絡主導>光纜——未來網絡主導</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bdc59733.html alt="網絡詞名場面是什麼意思 名場面是什麼梗" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bdc59733.html title="網絡詞名場面是什麼意思 名場面是什麼梗">網絡詞名場面是什麼意思 名場面是什麼梗</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a002ca18.html alt=王一博那句年度網絡流行語「不愧是我」的：正版英文翻譯 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/26add5cdc08e4214800b25e21b623eb1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a002ca18.html title=王一博那句年度網絡流行語「不愧是我」的：正版英文翻譯>王一博那句年度網絡流行語「不愧是我」的：正版英文翻譯</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>