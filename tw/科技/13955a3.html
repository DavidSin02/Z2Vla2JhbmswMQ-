<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP） | 极客快訊</title><meta property="og:title" content="TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/8f291e6a61fa4b45a91b81f2589002c5"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/13955a3.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/13955a3.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/13955a3.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/13955a3.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/13955a3.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/13955a3.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/13955a3.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/13955a3.html><meta property="article:published_time" content="2020-10-29T20:50:28+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:28+08:00"><meta name=Keywords content><meta name=description content="TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/13955a3.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>每天十分鐘，熟讀一個技術點，水滴石穿，一切只為渴望更優秀的你！</p><p>————零聲學院</p><p><br></p><hr><p>最近幾年來分佈處理的發展趨勢已經從原來的主要依賴大中型機，轉變成由 LAN 連接的 PC 機。這些PC 機網絡往往由許多不同類型的計算機和其它多售主設備組成。這種情況給一度曾支配大型主機通信的專有通信協議帶來了嚴重衝擊。專有協議只允許同一廠家的計算機系統之間互相通信。例如，DEC 的計算機只能和 DECnet 通信；IBM 主機只能與 SNA 通信；Apple 計算機只能與 Apple Talk 通信。</p><p>當今的分佈式的 LAN 需要把一個組織的大型機、小型機、企業級 LAN 和公共數據網連在一起。無疑這將對開發互聯多種不兼容系統的非專有協議是一個很大的促進。</p><p>當前出現的主要非專有網際互聯產品是 TCP/IP 和 OSI 協議。OSI 七層協議已經在國際上通用。TCP/IP 許多年來就一直被人們所採用，而且越來越成熟，已稱為被廣泛接收的協議。據不完全同級，目前世界上已有大約 40 多個國家使用這種協議連接了 5000 多個網絡， 幾十萬臺主機。這充分反映了 TCP/IP 的成熟和廣泛的可用性。大多數類型的計算機環境都有 TCP/IP 產品，它提供了文件傳輸、電子郵件、終端仿真、傳輸服務和網絡管理。</p><p>從長遠的觀點看，OSI 標準最終會超過 TCP/IP，提供較完善的目錄和網絡管理服務。但是 OSI 承諾的網際互聯設備目前還只限於 LAN 標準的 IEEE802 系列。雖然 OSI 的報文處理服務（MHS）或 X.400 電子郵件；生產自動協議；文件傳送、存儲和管理（FTAM ） 以及虛擬終端（VT）能以各種不同形式採用，但不同廠家的產品是不能互相操作的。這種情況有利於 TCP/IP 的流行。</p><h2 class=Editable-styled><strong>TCP/IP 結構模型</strong></h2><p>TCP/IP 實際上一個一起工作的通信家族，為網際數據通信提供通路。為討論方便可將</p><p>TCP/IP 協議組大體上分為三部分：</p><p>1. Internet 協議（IP）</p><p>2. 傳輸控制協議（TCP）和用戶數據報文協議（UDP）</p><p>3. 處於TCP 和UDP 之上的一組協議專門開發的應用程序。它們包括：TELNET，文件傳送協議（FTP），域名服務（DNS）和簡單的郵件傳送程序（SMTP）等許多協議</p><div class=pgc-img><img alt="TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/8f291e6a61fa4b45a91b81f2589002c5><p class=pgc-img-caption>圖1 TCP/IP 和 OSI 網絡模型的分層圖</p></div><p></p><p>以下分別簡介這三部分：</p><p>第一部分也稱為網絡層。包括 Internet 協議（IP）、網際控制報文協議（ICMP）和地址識別協議（ARP）.</p><p><strong>Internet 協議（IP）</strong></p><p>該協議被設計成互聯分組交換通信網，以形成一個網際通信環境。它負責在源主機和目的地主機之間傳輸來自其較高層軟件的稱為數據報文的數據塊，它在源和目的地之間提供非連接型傳遞服務。</p><p><strong>網際控制報文協議（ICMP）</strong></p><p>它實際上不是 IP 層部分，但直接同 IP 層一起工作，報告網絡上的某些出錯情況。允許網際路由器傳輸差錯信息或測試報文。</p><p><strong>地址識別協議（ARP）</strong></p><p>ARP 實際上不是網絡層部分，它處於 IP 和數據鏈路層之間，它是在 32 位 IP 地址和 48</p><p>位局域網地址之間執行翻譯的協議。</p><p>第二部分是傳輸層協議。包括傳輸控制協議和用戶數據報文協議。</p><p><strong>傳輸控制協議（TCP）</strong></p><p>由於 IP 提供非連接型傳遞服務，因此 TCP 應為應用程序存取網絡創造了條件，使用可靠的面向連接的傳輸層服務。該協議為建立網際上用戶進程之間的對話負責。此外，還確保兩個以上進程之間的可靠通信。它所提供的功能如下。</p><p>1. 監聽輸入對話建立請求。</p><p>2. 請求另一網絡站點對話</p><p>3. 可靠的發送和接收數據。</p><p>4. 適度的關閉對話。</p><p>用戶數據報文協議（UDP）。UDP 提供不可靠的非連接型傳輸層服務，它允許在源和目的地站點之間傳送數據，而不必在傳送數據之前建立對話。此外，該協議還不使用TCP 使用的端對端差錯校驗。當使用 UDP 時，傳輸層功能全都發回，而開銷卻比較低。它主要用於那些不要求 TCP 協議的非連接型的應用程序。例如，名字服務和網絡管理。</p><p>最後是應用程序部分。這部分包括 Telnet，文件傳送協議（FTP 和 TFTP），簡單的文件傳送協議（SMTP）和域名服務（DNS）等協議。</p><p>TCP/IP 使用了主幹網絡，能連接各種主機和 LAN 的多級分層結構，局部用戶能方便的聯網，不致影響到整個網絡系統。此外這種結構還有利於局部用戶控制操作和管理。</p><p>TCP/IP 具有兩個主要功能。第一是 IP 在網絡之間（有時在個別網絡內部）提供路由選擇。第二是 TCP 將TP 傳遞的數據傳送的接收主機那的適當的處理部件。</p><hr><p><strong>Internet</strong> <strong>協議（IP）</strong></p><p>IP 的主要目的是提供子網的互聯，形成較大的網際，使不同的子網之間能傳輸數據。網際是由許多自治系統組成的，每個系統是一箇中央管理的網絡或是一系列的子網，每個自治系統提供用於連到其它自治系統的網關。IP 規定如何連接子網和互聯設備如何工作。</p><p>IP 規定包如何從一個子網路由選擇到另一個子網。自治系統中的每個節點具有唯一的IP 地址。IP 使用本身的幀頭和檢查來確保數據報文的正確傳送。由於有維持當前路由選擇表的路由選擇修改信息，從而幫助了這個過程的順利完成。路由選擇表列出了子網上各種不同節點之間的通路和通路開銷，如果個別節點之間有較多的通路，則可選擇最經濟的一條。如果數據包過大，使目的地不能接收，則將它分成較小的段。當從 LAN 向 WAN 傳輸數據時，包的分段是特別重要的。例如 Token-Ring LAN 能支持 4500 字節的包，而 X.25 分組網通常只支持 128 字節的包，因此必須進行分段。</p><p>歸納起來 IP 主要有以下四個主要功能：</p><p>（1） 數據傳送</p><p>（2） 尋址</p><p>（3） 路由選擇</p><p>（4） 數據報文的分段</p><p><strong>1. 數據傳送的基本特點（無連接的最佳努力服務）</strong></p><p>IP 層使用於經過網際傳遞數據的通路進入傳遞系統。當人們一聽到IP 這個名字時自然會聯想起將許多子網連在一起的通稱為路由器的設備。IP 的確是執行路由器相關的任務。但正如上面所提到的，IP 的功能不只是這些，它還完成許多其它工作。IP 協議運行在連接子網的所有參與網絡的站點機上，以使各個站點能將它們的數據包遞交給路由器或傳送給同一網絡上的其它設備。IP 協議處於數據鏈路層和傳輸層之間。</p><p>IP 的主要目的是為數據輸入/輸出網絡提供基本算法，為高層協議提供無連接的傳送服務。這意味著在 IP 將數據遞交給接收站點以前不在傳輸站點和接收站點之間建立對話（虛擬鏈路）。它只是封裝和傳遞數據，但不向發送者或接收者報告包的狀態，不處理所遇到的故障。這意味這如果數據鏈路故障或遭遇可恢復的錯誤時，IP 不予通知和處理。它將報文和錯誤一起傳出去，由高層協議（TCP）負責執行消除差錯。換句話說，TCP 可能反覆傳輸和發送數據。</p><p>IP 將正確格式化的數據包遞交給目的地站點，不期待狀態相應。由於IP 是無連接的協議，因此它可能接收和傳遞發送給它的錯誤序列的數據。此外它還可能發送復份的數據。提供消除差錯的過程是高層協議的責任。IP 是網絡傳遞系統的一部分。它接受並格式化數據，以便傳輸到數據鏈路層。此外 IP 還檢索來自數據鏈路的數據，並將它送給請求的高層。IP 傳送的信息單元被稱為“數據報文”，這種數據報文可經過告訴網絡（Ethernet Token Ring或 FDDI）傳送，當經過這類網絡傳送時，數據報文被組裝稱為包。</p><p>IP 協議不注意包內的數據類型，它所知道的一切是必須將某些稱為IP 幀頭的控制協議加到高層協議（TCP 或者 UDP）所接受的數據上，並試圖把它傳遞給網絡或者網際上的某些節點。</p><div class=pgc-img><img alt="TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/57bc8fb6ad76405fba64f270ffb80150><p class=pgc-img-caption>圖2 封裝在 Ethernet 幀中的 IP 頭</p></div><p></p><p>IP 協議向主機和路由器提供應如何處理被傳輸或被接受的包的機制。為了瞭解IP 的功能，請觀察它向包增加的控制信息（IP 頭）。見圖 5-2。該圖表示 IP 頭北包裝在 Ethenet 幀內。從中可以看到 IP 幀頭在包中的位置。</p><p>圖 2 的上面部分是 IP 幀頭。這時一個 IP 數據報文的標準包頭。下面我們將通過觀察 IP 數據報文中的幀頭信息來研究 IP 數據報文傳遞的功能。各字段定義如下：</p><p>VERS 是 4 位，規定網絡站點所實現的 IP 當前版本。</p><p>HLEN 是 IP 頭的長度，共 4 位。在實際使用中，並不是必須使用 IP 頭的所有位， 所以需要該字段來指明 IP 頭的長度。以 32 位表示字，IP 頭的長度以字為增量變化，最短的 IP 頭是 20 字節（不包括數據和選項），因此這個字段的值是 5（20 字節=160 位；160 位/32 位=5），也就是 5 個字。如果這個字段的值變成了 6，就等於增加了 32 位（一個字）。</p><p>服務類型 8 位，它可以細分為如下的形式：</p><div class=pgc-img><img alt="TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6c4238746fd546b29dff3b753df5136f><p class=pgc-img-caption></p></div><p>優先權字段 3 位，可以有 0-7 的值（0 為正常值，7 為網絡控制）。它允許傳輸站點的應用程序向 IP 層發送數據報文的優先權。該字段與 D（時延）、T（吞吐量）和 R（可靠性相結合，這些位向路由器表明應採取哪個路由。這個字段被稱為 Type of Service（TOS）服務類型標識符。</p><p>D 位—當設置為 1 時請求低時延</p><p>T 位—請求高吞吐量時置 1</p><p>R 位—請求高可靠性時置 1</p><p><br></p><p>例如，如果去目的地有兩個以上的路由，路由器將讀這個字段，以選擇一個正確的路由。由應用程序（即 Telnet 或 Ftp）設置 TOS 字段，路由器只讀這種字段，不負責設置。在讀信息的基礎上，路由器將選擇數據報文的最佳路由。在網絡上傳輸包以前，由運行在主機上的 TCP/IP 應用程序設置這些位。它不要求路由器維持許多路由選擇表。</p><p>總長度（16 位）</p><p>這是以字節度量的數據報文長度。IP 數據報文的數據區可以有 65535 字節長（包括頭和數據部分）。</p><p><strong>2. 分段包</strong></p><p>有時會出現從一個網絡傳出的包大得不能傳入另外網絡的情況。例如考慮從 TokenRing 網絡（典型情況是支持 4472 字節的最大傳輸包）向 Ethernet LAN（只支持 1518 字節的最大傳輸包）傳輸幀。TCP/IP 路由器必須能將較大的包破碎成較小的包。TCP 將建立適於連接的包大小，但如果兩個通信站點被多種類型的媒體分開，那麼將怎樣支持不同的傳輸包大小呢？將包分裂成適合於 LAN 傳輸或異機種 WAN 路由選擇是 IP 層完成的另一任務。使用下面的字段完成這方面的工作。</p><p><strong>識別、標誌和分段偏移（分段控制，共 16 位）</strong></p><p>這些概念表明如何分段被傳送的太大的數據報文。TCP/IP 幾乎可以運行在任何數據鏈路上，當向不同的網絡發送數據時，可以同時發送的數據的最大規模（包大小）在那些網絡上可以發生變化。Ethernet 的最大包長度為 1518 字節（包括所有的幀頭）,Token-Ring 是17800 字節（16Mbps）和 4472 字節（4Mbps），FDDI 考慮到 4472 字節數據規模。任何一個網絡都可能通過最大的幀，IP 考慮了它能接受多大的包，可以滿足所有這些網絡之間數據交換的需要。</p><p>每個被分裂的數據報文的 IP 頭幾乎是相等的。它識別哪些數據報文屬於一個小組，確保數據報文不適配。接受 IP 會使用這個字段和源 IP 地址來識別哪些數據報文應歸屬在一起，使用標記完成如下任務：</p><p>（1） 標誌出是否出現了較多的分段。</p><p>（2） 是否將一份數據報文分段。</p><p>如果所經過的網絡使用不同的幀長度，那麼將包分段就是特別重要的。瞭解網橋的讀者知道，網橋沒有這種能力，如果網橋接受了太大的包（傳送網絡不能傳遞），正如 IEEE802 標準所提到的，它將這個包丟棄。一旦建立對話，大多數協議具有處理最大包長度的能力， 因此每個站點可以處理包的分段，不影響網橋操作。</p><p>總長度和分段偏移字段使 IP 能重新構造數據報文並將它傳遞到高層軟件。總長度指出原始包的總長度，偏移字段向正在組裝包的節點指出該包偏離的開始端，此時數據處於分段，以重新構造包.</p><p><strong>生存時間（TTL）（8 位）</strong></p><p>在包的傳遞過程中可能會出現錯誤情況，引起包在網際的路由器之間不斷循環。為防止此類事件發生，因而引入了 TTL。由包的發源地設置生存事件的起始值。生存事件是一個由路由器使用的字段，確保包不會無限的循環。在發送站點設置這個字段，然後隨著數據報文通過每個路由器而減一。當把這個字段的值減到 0 時，路由器將廢棄這個包，並通知數據報文的發源地，它不能轉送這個包</p><p><strong>協議字段</strong></p><p>該字段用於指出哪個較高級協議發送了幀，哪個接受協議應得到這個幀。有許多協議可以處於 IP 的上面。就在 IP 上的協議而言，對 IP 並不是特定的。當前對通用的傳輸實現是 TCP 和 UDP。該字段的目的是使 IP 知道如何正確的將包傳遞到它上面的正確的機構， 如果將協議字段設置成 TCP，則將包處理得適合 TCP 要求，以便進一步進行幀處理。UDP 的情況也一樣。</p><p><strong>校驗和</strong></p><p>這是一個 16 位的循環冗餘檢驗，目的是確保幀頭的完整性。利用 IP 數據段中的數據產生 CRC（循環冗餘檢驗）數，由發送站點放入這個字段。當接收站點讀數據時，它將計算 CRC。如果兩個 CRC 不匹配，則表示幀頭有錯位，將廢棄包。隨著數據報文被每個路由器接收，每個路由器將重新計算校驗和，這是因為數據報文由所穿過的每個路由器改變TTL。</p><p><strong>IP 選項字段</strong></p><p>選項類別確定數據是正常數據還是用作網絡控制的數據。在選項類別內包含了多種選項編號。“0”的選項類別代表數據報文或網絡控制包、類別“0”內的好書表示必須使用嚴格的源路由選擇（如由源主機所規定的）。在那種情況下，包所經過的每個網關向包增加它的 IP 地址，以便識別。選項類別“2”中的編號 4 用於規定計時打印包在去目的地的途中所執行的所有暫停。通過記錄平均時延和節點的處理時間可測量總體網絡性能。</p><p><strong>IP 源和目的地地址字段</strong></p><p>這些字段指出包將被傳遞到的最終目的地 IP 地址和起始發送這個包的站點的 IP 地址</p><p>（各 32 位）。這些地址將分辨 IP 網際上的所有主機。IP 地址是非常重要的，以下詳細討論。</p><p><strong>3. IP 尋址</strong></p><p>Internet 地址由位於斯坦福研究所（SRI）的 Internet Network Information Center（Internet NIC）Registration Service 發放。Inter NIC 可提供給你一個相當大的主要網絡地址，以識別你的網絡上的每個端點。</p><p>如果你有自己的網絡，可以建立自己的網絡信息中心，除非你計劃連到 Internet 不需</p><p>要和 Internet 的 NIC 接洽。但即使你不連接 Internet，NIC 仍將幫助你建立你自己的網絡地址方案。如果有一天你希望同其它 TCP/IP 網絡連接（例如同 Internet 連接）最好使用下面的約定。</p><p>你大概已經看到了 32 位 IP 地址。它使用了帶點的十進制數，例如 128.101.4.9。它的二進制等效是：1000 0000 0110 0100 0000 0100 0000 1001。顯然表示成點的十進制數方便得多。</p><p>Internet 地址可分成 5 類：</p><div class=pgc-img><img alt="TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/c6f65cfb4f3a429da5ede83348c5aaab><p class=pgc-img-caption></p></div><p>A 類網絡地址有 128 個（支持 127）個網絡，佔有最左邊的一個字節（8 位）。高位（0） 表示識別這種地址的類型。因此這個位不能用作地址位，剩下右邊的 31 位提供231 個端點</p><p>的尋址。這些大致中大約 1/3 已經被分配，想得到這類地址是很困難的。</p><p>B 類地址使用左邊兩個 8 位用來網絡尋址。兩個高位（10）用於識別這種地址的類型， 其餘的 14 位用作網絡地址，右邊的兩個字節（16 位）用作網絡節點，大約已經分配了 5000 個 B 類地址。</p><p>C 類地址是最常見的 Internet 地址。三個高位（110）用於地址類型識別，左邊三個字節的其餘 21 位用於尋址。C 類地址支持4 ´106 個網絡，每個網絡可多達 256 端點，到目前為止已經使用了2 ´106 個 C 類地址。</p><p>D 類地址是相當新的。它的識別頭是 1110，用於組播，例如用於路由器修改。E 類地址為時延保留，其識別頭是 1111。</p><p>網絡軟件和路由器使用子網掩碼來識別報文臨時呆在網絡內部，還是被路由選擇到其它地方。在一個字段內“1”出現表明一個字段保換所有或部分網絡地址。“0”表明主機地址為止。例如，最常用的 C 類地址使用前三個 8 位來識別網絡，最後一個 8 位識別主機。因此子網掩碼是 255.255.255.0。</p><p>此外還可以使用掩碼建立子網，讓我們來假定用戶申請 B 類地址，Inter NIC 提供給用戶179.143.XXX.XXX。如果他 11 個 LAN，每個 LAN 有 89 個工作站，那麼他可以把所有的工作站連入具有這種 B 類地址的 Internet。（Internet 地址正在變得缺少，按目前的使用增長率，到 2002 年將全部被使用，但目前正在考慮機種地址擴充方案）。</p><p>建立一個 255.255.255.0 的掩碼在第三單元那對每個 LAN 分配一固定的數，比如 1-11， 最後的單元用於每個 LAN 上的工作站（按 TCP/IP 的說法是主機）地址，因此你的地址將有形式：179.143.（1-11）.（1-254）。在最後的兩個 8 位字組那怎樣選擇地址完全由你決定，不一定是順序的。</p><p>IP 數據報文是無連接的，按 TCP/IP 的說法是不可靠的。但由於 TCP 協議提供了可靠的（確認的）面向連接的服務，因此不確認的傳輸是可接受的。</p><p>無連接服務的缺點是明顯的，如果數據報文被破壞，或者由於緩衝器太小不能存放它們，將會引起數據報文被放棄。此外，鏈路也可能故障，主機和網關可能擁塞，以及由於不正確的實現建立了錯誤的路由或失效的幀頭。</p><p>由於存在上述這些可能性，因此總是實現稱為 Internet Control Message Protocal（ICMP）的第二協議。ICMP 可以告訴發源主機問題，並期待它解決。</p><p><strong>4.網際控制報文協議（ICMP）</strong></p><p>網絡層上另一個重要協議是網際控制報文協議（ICMP）。IP 需要它幫助傳輸差錯和控制報文。ICMP 報文在不同的 IP 模塊間交換。一種報文是迴應請求，用於測試目的地是否可達。此外迴應請求報文還跟蹤相應時間，以便確定線路的平均時延，進一步同應用程序的時延闕進行比較。例如，如果線路時延太長，則基於主機的應用程序可以暫停。</p><p>當網關接收它們不能轉送的包時，便發送一個不可到達目的地的報文，這類報文能指出網絡或主機是不能到達的，或個別較高層協議或端口是不可到達的。如果源主機表示不需要分段包，網關還可以回送報文，指出若不分段數據就不能轉送。如果源規定的路由故障，則可發送這類報文，說明目的地網絡或主機是不可到達的。</p><p>如果由於某種原因目的地是不可到達的，則 IP 模塊將通知 TCP 模塊，然後 TCP 模塊通知 Telnet 虛擬終端服務，最後 Telnet 將在屏幕上顯示一個報文，通知用戶這個報文是不可傳遞的。</p><p>另一類 ICMP 報文被稱為“源斷開”報文。它是一種擁塞控制方法。如果在 IP 網關接收了較多的包，超出控制能力，則可以靠 ICMP 進行擺脫，典型做法是經過緩衝器析溢出， 然後網關發出一個“源斷開”報文，以命令發送模塊降低發送率。這些報文只是在短期生效。接收到“源斷開”報文後，暫時降低了傳輸率。然後自動逐漸恢復一直到達原來的傳輸率為止。當接到新的“源斷開”報文時，再次降低傳輸率。“源斷開”報文增強了基於窗口的流量控制能力。</p><p>ICMP 報文的另一種類型仍舊是路由選擇變化請求，它有幾種不同的請求內容。例如， 大，當網關得知所選擇的網關不是去目的地的最佳網關時，便向源主機發送一個“重定向數據請求”。這些報文也用來規定重定向某些類型的服務。當網關接到一個標有生存期限的包時，便發送一個“長路由通知”。當 IP 模塊遇到生存期滿的包時，也通知源主機。</p><p>第四類 ICMP 報文用於計時打印請求和確認。這些報文用於估算網絡上的平均往復時延，以便確定特定的程序所使用的最佳傳輸率和路由（傳輸設備）。為了估算這種往復時延使用了四種計時打印：</p><p>（1） 發送方計時打印請求包。</p><p>（2） 當接收方接收到包時打印包。</p><p>（3） 當它發送回答報文時再次打印。</p><p>（4） 當源發方接收到回答報文時打印回答報文。</p><p>計時打印（2）和（3）提供了處理這種信息需要多長時間的基本估算，計時打印（1） 和（4）提供了包在網絡上傳輸所需時間總量。反覆計算多次打印可產生平均時延。</p><h2 class=Editable-styled><strong>傳輸控制協議（TCP）</strong></h2><p>原始的 TCP/IP 主機是經過電話線連接的。70 年代早期通信工具和當今的通信設備截然不同，線路的噪聲非常大，不能處理數據，因此 TCP 協議具有嚴格的內裝差錯檢驗算法確保數據的完整性。下面幾段文章解釋了 TCP 協議的結構嚴格性。</p><p>TCP 是重要的傳輸層協議，它和 UDP 不同，傳輸層軟件 TCP 的目的是允許數據同網絡上的另外站點進行可靠的交換。它能提供端口編號的譯碼，以識別主機的應用程序，而且完成數據的可靠傳輸。</p><p>為了說明 TCP 結構的嚴格性，讓我們先來打個比方。假設你正在向某人講述一個故事。如果那個人只是站在那裡不應答你，你將不能辯明他是否瞭解你所講述的內容。如果那個人用點頭之類的方式應答，那麼你將知道你所講的話他是瞭解的，因此能繼續同他交談。與此相似，TCP 協議使用順序編號和確認信息同網絡上另外的站點交談。使用順序編號來確定包內數據的排序並發現故障的包。因為網際上不同的包不一定會以發送它們的順序到達（例如，路由器廢棄一系列傳輸包中的某一個），所以要對包中的數據進行排序，以確保與發送的順序相同。此外，接收站點還可能接收兩個同樣的包，為了進行可靠類型的通信， 使用帶有確認信息的順序編號，這種處理被稱為全雙工。連接的每一端都必須考慮到另一端的需要而維持它自己的順序編號。</p><p>TCP 是面向字節的順序協議，這意味著包內的每個字節被分配一個順序編號，並分配給每包一個順序編號。分配給包那每個字節的順序編號可以合理的重複。</p><p>TCP 的順序編號方法與它的產生年代有關，那時的通信手段落後，不是所有的網絡都</p><p>採用這種辦法（使用一個獨立的傳輸層軟件）。例如：NetWare 是依靠網絡層軟件傳輸數據</p><p>NetWare 控制協議提供包的順序編號。</p><p>為可靠的完成數據傳輸任務，TCP 將報文或數據分成可管理的長度並加上 TCP 頭。</p><p>圖3 表示一個TCP頭。它描述了TCP頭中一些主要的字段：</p><div class=pgc-img><img alt="TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/2124dc02122a4b0bbfac79c2021ef8d4><p class=pgc-img-caption>圖 3 TCP 頭信息</p></div><p></p><p>源端口（16 位）。源發站點的端口編號</p><p>目的地端口（16 位）。接收站點的端口編號</p><p>順序號數（32 位）。分配給 TCP 包的編號</p><p>除設置 SYN 位指出包的開始字節編號外，如果設置了這個位，順序編號是最初的順序號數（ISN），第一個數據字節是 ISN+1。</p><p><strong>確認編號數（32 位）</strong></p><p>目的地站點向源站點發送的編號。對以前所接收的包（或許多包）表明確認。該序號指出目的地站點希望接收下一個順序編號。一旦建立了連接就始終設置這個字段。</p><p><strong>數據偏移（4 位）</strong></p><p>指出 TCP 頭的長度（即 TCP 頭中的 32 位字的數）。它表明數據開始和 TCP 頭結束。對於正常的 20 字節的頭，這個字段設置成 0101。</p><p><strong>保留位（6 位）</strong></p><p>為未來使用而保留。必須設置為 0。</p><p><strong>控制位（6 位）</strong></p><p>用作個別控制位，見表 5-6。</p><div class=pgc-img><img alt="TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/86c2564b14924cc0ba381d897268eaae><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5d8c113cc19a4b31be99aa5926966b6c><p class=pgc-img-caption>圖 4 控制位的取值及其含義</p></div><p></p><p><strong>窗口（16 位）</strong></p><p>窗口字段也稱接收窗口大小，表示在 TCP 連接上準備由主機接收的的 8 位字節的數目。</p><p><strong>CRC 校驗和（16 位）</strong></p><p>一個差錯檢驗數，用於確定被接收的數據報文在傳輸期間是否被訛誤。包括 TCP 頭和所有數據。</p><p><strong>緊急指示字段（16 位）</strong></p><p>它指出了緊接緊急數據的字節的順序編號。</p><p><strong>選項</strong></p><p>長度變量，它考慮到 TCP 使用的各種選項：</p><p>（1） 選項表的結束</p><p>（2） 無操作</p><p>（3） 最大分段長度</p><p>TCP 提供的主要服務有：</p><p>（1） 建立、維持和終結兩個進程之間的連接。</p><p>（2） 可靠的包傳遞（經過確認過程）。</p><p>（3） 編序包（可靠的數據傳送）。</p><p>（4） 控制差錯的機制。</p><p>（5） 通過使用端口，允許在個別的源和目的地主機內部實現和不同進程多重連接的能力。</p><p>（6） 使用全雙工操作的數據交換。</p><h2 class=Editable-styled><strong>用戶數據報文協議</strong></h2><p>UDP 也是TCP/IP的傳輸層協議，它是無連接的，不可靠的傳輸服務。當接收數據時它不向發送方提供確認信息，它不提供輸入包的順序，如果出現丟失包或重份包的情況，也不會向發送方發出差錯報文。這一點很象IP 協議。UDP的主要作用是分配和管理端口編號，以正確無誤的識別運行在網絡站點上的個別應用程序。由於它執行功能時具有低的開銷，因而執行速度比TCP 快。它多半用於不需要可靠傳輸的應用程序，例如網絡管理域，域名服務器等。</p><div class=pgc-img><img alt="TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/bac32d970bfe4fb497fa7a3ee758ff6e><p class=pgc-img-caption>圖 5 UDP 頭</p></div><p></p><p>任何與 UDP 相配合作為傳輸層服務的應用程序必須提供確認和順序系統，以確保包是以發送它們的同樣順序到達。也就是說，使用 UDP 的應用程序必須提供這類服務。（參見後面章節中關於 tftp 協議的介紹）</p><p>圖 5 表示一個一個 UDP 頭，應用數據被封裝在 UDP 頭那。傳輸層具有它自己的， 與所有其它層不相關的幀頭。然後 UDP 頭及其數據被封裝在 IP 頭內，由 IP 協議將這個數據報文發送到數據鏈路層，依次下去，數據鏈路層又使用它的幀頭包裝這個報文，最後將數據送到物理層實際傳輸。</p><p>當接收包時，數據鏈路層將把地址解釋為它自己的，剝去它的幀頭，將包傳遞給 IP 層，</p><p>IP 層將根據 IP 頭上的正確 IP 地址接受包。剝去它的頭，最後將包交給 UDP 軟件，UDP 接受包，而且必須按 UDP 頭上的端口編號進行譯碼。</p><p><strong>小結</strong></p><p>本文介紹了幾種 LAN 協議。其中，著重討論了 TCP/IP 協議。</p><p>TCP/IP 現在正在被越來越多的團體用戶所接收。目前 TCP/IP 已經演變成最成熟的聯網環境之一。事實上最近幾年來 TCP/IP 和 UNIX 已經提供了多廠家產品互聯性的模式， TCP/IP 的最大價值是它的不同平臺之間提供互聯性的能力。</p><p>在 OSI 真正履行自己的承諾以前，不太完善的通信協議結構，如 SNA、DECnet 和 TCP/IP</p><p>將繼續流行。</p><hr><p><strong>每日分享15分鐘技術摘要選讀，關注一波，一起保持學習動力！</strong></p><p><br></p><p><a class=pgc-link data-content=mp href=https://www.ixigua.com/i6813989506241266187/ rel="noopener noreferrer" target=_blank>面試中常見的TCP/IP協議棧問題</a></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>TCP</a></li><li><a>IP</a></li><li><a>協議</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/1bd1e17.html alt=一文讀懂TCP/IP協議工作原理和工作流程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/ea27784370b9441090baaf9c8cf57977 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1bd1e17.html title=一文讀懂TCP/IP協議工作原理和工作流程>一文讀懂TCP/IP協議工作原理和工作流程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c8da7b9.html alt=TCP/IP協議分為哪四層，具體作用是什麼？http與tcp區別 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/250b6d508b7a4694baa0371a1f53a17c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c8da7b9.html title=TCP/IP協議分為哪四層，具體作用是什麼？http與tcp區別>TCP/IP協議分為哪四層，具體作用是什麼？http與tcp區別</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3364d34.html alt=TCP/IP協議是網絡協議中的核心協議，含三次握手，四次分手 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/fc06324c0dfc4990bb88bbf41769b159 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3364d34.html title=TCP/IP協議是網絡協議中的核心協議，含三次握手，四次分手>TCP/IP協議是網絡協議中的核心協議，含三次握手，四次分手</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7302fb0.html alt=TCP/IP協議：傳輸層協議 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5bccccba9b1243d3afefcee4cc0d04ed style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7302fb0.html title=TCP/IP協議：傳輸層協議>TCP/IP協議：傳輸層協議</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8756f3f.html alt=以太網接口TCP/IP協議介紹，說的很容易懂了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/d073c29b03984e3aa025b70cd50cc493 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8756f3f.html title=以太網接口TCP/IP協議介紹，說的很容易懂了>以太網接口TCP/IP協議介紹，說的很容易懂了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a660d731.html alt=網絡基本概念-TCP/IP架構及各層網絡協議 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/7f834ac140184ca6a079de4d0d3e515c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a660d731.html title=網絡基本概念-TCP/IP架構及各層網絡協議>網絡基本概念-TCP/IP架構及各層網絡協議</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/024d3fc2.html alt=TCP/IP報文格式，康康就知道了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/73eecbbd2b0c4f93ad75a83ff43ace41 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/024d3fc2.html title=TCP/IP報文格式，康康就知道了>TCP/IP報文格式，康康就知道了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ce824d7f.html alt=淺談TCP協議（建立與斷開連接） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/4112ca2d63f04cddae0aadca168ea063 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ce824d7f.html title=淺談TCP協議（建立與斷開連接）>淺談TCP協議（建立與斷開連接）</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/0365df13.html alt=TCP與IP的對比，TCP的報文頭介紹，TCP的三次握手和TCP的安全機制 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f1fd0df30c1c4366be12eef1be8b593b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/0365df13.html title=TCP與IP的對比，TCP的報文頭介紹，TCP的三次握手和TCP的安全機制>TCP與IP的對比，TCP的報文頭介紹，TCP的三次握手和TCP的安全機制</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/f51b5ddc.html alt=TCP/IP-運輸層-你需要知道的運輸層概念 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/a47a604cc4e34358a5357f9e7af4f2da style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/f51b5ddc.html title=TCP/IP-運輸層-你需要知道的運輸層概念>TCP/IP-運輸層-你需要知道的運輸層概念</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a2afccb6.html alt="TCP/IP 門禁控制器通訊不上故障排查方法" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a2afccb6.html title="TCP/IP 門禁控制器通訊不上故障排查方法">TCP/IP 門禁控制器通訊不上故障排查方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2eb6f16c.html alt="一文讀懂 TCP/IP 網絡模型" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c7aa7812af5c4f46b1cfc94a150dc976 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2eb6f16c.html title="一文讀懂 TCP/IP 網絡模型">一文讀懂 TCP/IP 網絡模型</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5351d79a.html alt=學習TCP/IP協議之前，你應該先理解OSI開放式互聯參考模型，功倍 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/d7d062cd949b4d148ab7f6a0b6af23b4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5351d79a.html title=學習TCP/IP協議之前，你應該先理解OSI開放式互聯參考模型，功倍>學習TCP/IP協議之前，你應該先理解OSI開放式互聯參考模型，功倍</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d3de5499.html alt=說說TCP/IP參考模型與OSI七層模型的關係 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ac183e86a25c4c249fa89a3bd6cbeeb6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d3de5499.html title=說說TCP/IP參考模型與OSI七層模型的關係>說說TCP/IP參考模型與OSI七層模型的關係</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/48b15feb.html alt=TCP/IP參考模型 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1e7063fc1fad41fdb324668595754ef6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/48b15feb.html title=TCP/IP參考模型>TCP/IP參考模型</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>