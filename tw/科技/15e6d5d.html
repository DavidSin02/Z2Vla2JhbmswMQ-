<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>美食圖譜復現指南之依存句法分析 | 极客快訊</title><meta property="og:title" content="美食圖譜復現指南之依存句法分析 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/d5962d33a0f546488eaca3acf9447c87"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/15e6d5d.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/15e6d5d.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/15e6d5d.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/15e6d5d.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/15e6d5d.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/15e6d5d.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/15e6d5d.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/15e6d5d.html><meta property="article:published_time" content="2020-10-29T21:05:58+08:00"><meta property="article:modified_time" content="2020-10-29T21:05:58+08:00"><meta name=Keywords content><meta name=description content="美食圖譜復現指南之依存句法分析"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/15e6d5d.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>美食圖譜復現指南之依存句法分析</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>文章轉載自公眾號</p><div class=pgc-img><img alt=美食圖譜復現指南之依存句法分析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d5962d33a0f546488eaca3acf9447c87><p class=pgc-img-caption></p></div><p>牛衣古柳 ， 作者 古柳DesertsX</p><p class=ql-align-justify>本文代碼開源在：DesertsX/gulius-projects</p><p class=ql-align-justify>哈工大語言云的官網有一篇名為《使用語言云分析微博用戶飲食習慣》的文章，裡面講到了藉助分詞、詞性標註和依存句法分析等NLP技術，可以從微博文本內容中提取出用戶飲食習慣等數據。</p><p class=ql-align-justify>進而可以結合用戶性別、地區、發微博時間等不同維度信息，展現出許多有趣的結果，比如下圖分別是上海、重慶、以及廣東（男性）的特色飲食習慣：</p><div class=pgc-img><img alt=美食圖譜復現指南之依存句法分析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ef40561721f24f7fb1448c5ee33074a7><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>那麼如何抽取出上述食物呢？原文給出了由三個條件組成的規則：<strong>一條微博裡含有詞語“吃”+與“吃”相關的句法關係為VOB（動賓關係）+“吃”的賓語為名詞</strong>，就可以判斷髮生飲食行為，進而提取出“吃”的賓語就是相關的食物。</p><p class=ql-align-justify>作為解釋，給出了三個例句：“我剛吃了一塊巧克力”、“今天我去電影院看了濃情巧克力”、“我吃了個巧克力味冰淇淋”。</p><div class=pgc-img><img alt=美食圖譜復現指南之依存句法分析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7d331fdda55c41df97d8d0757e45706e><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>句子經過分詞，並在下方標註了詞性，依存弧表明每個詞語之間的關係，比如主謂關係（SBV）、動賓關係（VOB）等等。</p><p class=ql-align-justify>由上述規則可以判斷出第二句沒有飲食行為，於是進行過濾；而從另外兩句中可以分別抽取出“巧克力”和“冰淇淋”（當然第三句更細粒度、更準確地應該是“巧克力味冰淇淋”，如何改進上面的規則，後面再提）。</p><p class=ql-align-justify>經過上面的介紹，看起來這條規則還蠻符合邏輯，應該能行的吧？但不知怎的腦海中突然浮現出張學友這張表情包，呼之欲出就是這句……</p><div class=pgc-img><img alt=美食圖譜復現指南之依存句法分析 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/20e2ce9bf51d4f45b6f6c718cb3895ac><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>於是用語言云官方的在線演示試了下：出現“吃”這個字+與“吃”相關的有VOB動賓關係+賓語是名詞“n”……過於完美地符合所有條件。</p><div class=pgc-img><img alt=美食圖譜復現指南之依存句法分析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/adb6fb5e4807412b9f7a20f600d5c732><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>扯回來，總得來看，給出的判斷邏輯還是靠譜的，那麼該如何實現呢？“章口就萊”甩下一句：Talk is cheap. Show me the code. 然而翻遍原文也沒找到實現代碼。</p><div class=pgc-img><img alt=美食圖譜復現指南之依存句法分析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/60a4c1f91148455491f9d5b26c8569a1><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>很早以前就看過這篇文章，一直不會，重新試了下，發現非常簡單，果然是“難者不會，會者不難”，核心代碼也就兩行。</p><div class=pgc-img><img alt=美食圖譜復現指南之依存句法分析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4e0f76e5331e47a09ab163a59dcb3c8c><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>以下是代碼部分（本文代碼開源在：DesertsX/gulius-projects），原本不必講pip install pyltp這種基礎安裝第三方庫的事，但因為windows下可能會出現Microsoft Visual C++等相關錯誤，所以建議參考：《哈工大自然語言處理ltp在windows10下的安裝使用》一文的方案二，親測可行。</p><div class=pgc-img><img alt=美食圖譜復現指南之依存句法分析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4c4fe80692064872a59d3b5eb3930433><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>再是pyltp的入門介紹此處略過，看官方文檔使用 pyltp一文就夠了。</p><blockquote>pyltp 是 LTP 的 Python 封裝，提供了分詞，詞性標註，命名實體識別，依存句法分析，語義角色標註的功能。</blockquote><p class=ql-align-justify>pyltp 安裝成功，並下載好相應的 LTP 模型文件後，分別加載分詞、詞性標註和依存句法分析的模型。</p><pre class=ql-align-justify>import osfrom pyltp import SegmentorLTP_DATA_DIR = '/path/to/your/ltp_data' # ltp模型目錄的路徑# 加載分詞模型cws_model_path = os.path.join(LTP_DATA_DIR, 'cws.model')segmentor = Segmentor()segmentor.load(cws_model_path)# 加載詞性標註模型from pyltp import Postaggerpos_model_path = os.path.join(LTP_DATA_DIR, 'pos.model')postagger = Postagger()postagger.load(pos_model_path)# 加載依存句法分析模型from pyltp import Parserpar_model_path = os.path.join(LTP_DATA_DIR, 'parser.model')parser = Parser()parser.load(par_model_path)</pre><p class=ql-align-justify>對每個句子分別進行分詞、詞性標註和依存句法分析，並對分詞後的每個詞語依次提取依存弧的父節點id（Root 的 id 為0，其他按分詞結果依次遞增）、依存關係以及依存父節點對應的詞語。最後寫出進行飲食行為判斷的核心代碼即可。</p><pre class=ql-align-justify>def extract_food(sentence): words = segmentor.segment(sentence) print(" ".join(words)) postags = postagger.postag(words) for word, postag in zip(words, postags): print(word + '/'+ postag, end=' ') netags = recognizer.recognize(words, postags) arcs = parser.parse(words, postags) # 例句：我 剛 吃 了 一 塊 巧克力 。 # 提取依存父節點id # 3, 3, 0, 3, 6, 7, 3, 3 rely_id = [arc.head for arc in arcs] # 提取依存關係 # ['SBV', 'ADV', 'HED', 'RAD', 'ATT', 'ATT', 'VOB', 'WP'] relation = [arc.relation for arc in arcs] # 匹配依存父節點詞語 # ['吃', '吃', 'Root', '吃', '塊', '巧克力', '吃', '吃'] heads = ['Root' if id==0 else words[id-1] for id in rely_id] print("\n") for i in range(len(words)): if postags[i] == 'n' and heads[i] == '吃' and relation[i] == 'VOB': print("找到了一種食物：" + words[i]) print("=" * 30) </pre><p class=ql-align-justify>對依存關係這部分還不太理解的可以看下此文：依存句法分析結果的輸出怎麼看</p><div class=pgc-img><img alt=美食圖譜復現指南之依存句法分析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/adb6fb5e4807412b9f7a20f600d5c732><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>接著三個例句進行測試，結果和原文相符。</p><pre class=ql-align-justify>sentences = ['我剛吃了一塊巧克力。', '今天我去電影院看了濃情巧克力。', '我吃了個巧克力味冰淇淋。']for sent in sentences: extract_food(sent)</pre><p class=ql-align-justify><br></p><div class=pgc-img><img alt=美食圖譜復現指南之依存句法分析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/adb6fb5e4807412b9f7a20f600d5c732><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>以上算是簡單復現了下這篇博客的思路。還有個問題就是，現實中大家討論飲食的方式可能並不像例句中那麼規整簡單。</p><p class=ql-align-justify>以以前爬取的知乎想法裡與“#好吃的杭州#”相關的言論為例（該話題知乎想法API），各種表述方式應有盡有，理想與現實的差距可見一斑。</p><div class=pgc-img><img alt=美食圖譜復現指南之依存句法分析 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b4c857beb11542b193e758d6eb561f0b><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>再者是復現的代碼，對於食物賓語的提取邏輯過於簡單，以致諸如“巧克力味冰淇淋”、“西湖醋魚”等帶有前綴修飾的詞語都無法提取。當然賓語補全也能實現，此處暫且不表。</p><div class=pgc-img><img alt=美食圖譜復現指南之依存句法分析 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/90292b6fe4de40cd94598e983d0379bc><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>本文代碼開源在：DesertsX/gulius-projects</p><p class=ql-align-justify>https://github.com/DesertsX/gulius-projects</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>圖譜</a></li><li><a>句法分析</a></li><li><a>依存</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/e01935fe.html alt=全面回顧：從知識工程到知識圖譜 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/0bd3ad5610cd4559b8d67d52178858ed style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e01935fe.html title=全面回顧：從知識工程到知識圖譜>全面回顧：從知識工程到知識圖譜</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/027a28e1.html alt=知識工程技術：知識圖譜歷程及未來 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6fc6bdfc164044eabc7143c861118c35 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/027a28e1.html title=知識工程技術：知識圖譜歷程及未來>知識工程技術：知識圖譜歷程及未來</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8668225c.html alt=從知識工程到知識圖譜全面回顧 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RPUfnTjEp79Eds style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8668225c.html title=從知識工程到知識圖譜全面回顧>從知識工程到知識圖譜全面回顧</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6b7f9996.html alt=一分鐘讀懂鏽病、附高清圖譜 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/0e7fbd3db54243e29d2fddd025529900 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6b7f9996.html title=一分鐘讀懂鏽病、附高清圖譜>一分鐘讀懂鏽病、附高清圖譜</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3667ca1b.html alt=基於知識圖譜的語義理解技術及應用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9ea87d167ca743a884338d2b73b202ad style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3667ca1b.html title=基於知識圖譜的語義理解技術及應用>基於知識圖譜的語義理解技術及應用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b947c7a9.html alt=用於XRD衍射圖譜定量分析的免費專業化學軟件-Maud class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1ed8fd4bf0804d46a8704016bf0320e1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b947c7a9.html title=用於XRD衍射圖譜定量分析的免費專業化學軟件-Maud>用於XRD衍射圖譜定量分析的免費專業化學軟件-Maud</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/710fdc3d.html alt=日本刀劍圖譜（珍藏版） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/dfic-imagehandler/e58fd295-2e66-4047-8531-5643b8bb54e1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/710fdc3d.html title=日本刀劍圖譜（珍藏版）>日本刀劍圖譜（珍藏版）</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/88c7288e.html alt=材料信息學：解碼材料基因圖譜丨科普硅立方 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/SEZiftMGCnWBWI style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/88c7288e.html title=材料信息學：解碼材料基因圖譜丨科普硅立方>材料信息學：解碼材料基因圖譜丨科普硅立方</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/a24adb9b.html alt=173種·常見花卉植物圖譜，保你啥花都能叫上名 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ef57cec5061e468f95dcfa6bb466474e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/a24adb9b.html title=173種·常見花卉植物圖譜，保你啥花都能叫上名>173種·常見花卉植物圖譜，保你啥花都能叫上名</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/d51a8375.html alt=愛養花的有福了：100款花卉圖譜，保你啥花都能叫上名，值得收藏 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/442047bb872b4e5bb3dfcec419206337 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/d51a8375.html title=愛養花的有福了：100款花卉圖譜，保你啥花都能叫上名，值得收藏>愛養花的有福了：100款花卉圖譜，保你啥花都能叫上名，值得收藏</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/2e5d5ef4.html alt=最全中草藥圖譜，附主治功效（建議收藏）（中） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f2f98e7d1fc64221adb8aac0e1467610 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/2e5d5ef4.html title=最全中草藥圖譜，附主治功效（建議收藏）（中）>最全中草藥圖譜，附主治功效（建議收藏）（中）</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/3c130fcf.html alt=圖譜--腕韌帶撕裂：MRI、MDCT關節造影和MR關節造影對比 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2a11237b904d496383bee9195dcf5eff style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/3c130fcf.html title=圖譜--腕韌帶撕裂：MRI、MDCT關節造影和MR關節造影對比>圖譜--腕韌帶撕裂：MRI、MDCT關節造影和MR關節造影對比</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/cdd9156e.html alt="圖譜筆記 | 交感/副交感神經系統" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/11105d27694e468cbf1a07609b8b89bb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/cdd9156e.html title="圖譜筆記 | 交感/副交感神經系統">圖譜筆記 | 交感/副交感神經系統</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/f01e22ee.html alt=茶花病蟲害原色圖譜（2017更新版） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/5e790004b51faea1865b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/f01e22ee.html title=茶花病蟲害原色圖譜（2017更新版）>茶花病蟲害原色圖譜（2017更新版）</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/ff2fc416.html alt=201個中草藥圖譜（附主治功效），知道一半就太牛了（下） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9944ecd9e8ad4f4dbc19d017bc3b1075 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/ff2fc416.html title=201個中草藥圖譜（附主治功效），知道一半就太牛了（下）>201個中草藥圖譜（附主治功效），知道一半就太牛了（下）</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>