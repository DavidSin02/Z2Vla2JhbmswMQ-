<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>é«˜ä½µç™¼ä¹‹APIæ¥å£ï¼Œåˆ†ä½ˆå¼ï¼Œé˜²åˆ·é™æµï¼Œå¦‚ä½•åšï¼Ÿ | æå®¢å¿«è¨Š</title><meta property="og:title" content="é«˜ä½µç™¼ä¹‹APIæ¥å£ï¼Œåˆ†ä½ˆå¼ï¼Œé˜²åˆ·é™æµï¼Œå¦‚ä½•åšï¼Ÿ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/72ef0f380abf4c6693d26afc863a1782"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/16e9e712.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/16e9e712.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/16e9e712.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/16e9e712.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/16e9e712.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/16e9e712.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/16e9e712.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/16e9e712.html><meta property="article:published_time" content="2020-11-14T21:04:37+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:37+08:00"><meta name=Keywords content><meta name=description content="é«˜ä½µç™¼ä¹‹APIæ¥å£ï¼Œåˆ†ä½ˆå¼ï¼Œé˜²åˆ·é™æµï¼Œå¦‚ä½•åšï¼Ÿ"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/16e9e712.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>é«˜ä½µç™¼ä¹‹APIæ¥å£ï¼Œåˆ†ä½ˆå¼ï¼Œé˜²åˆ·é™æµï¼Œå¦‚ä½•åšï¼Ÿ</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>åœ¨é–‹ç™¼åˆ†ä½ˆå¼é«˜ä½µç™¼ç³»çµ±æ™‚æœ‰ä¸‰æŠŠåˆ©å™¨ç”¨ä¾†ä¿è­·ç³»çµ±ï¼šç·©å­˜ã€é™ç´šã€é™æµ</p><h3 class=pgc-h-arrow-right>ç·©å­˜</h3><p>ç·©å­˜çš„ç›®çš„æ˜¯æå‡ç³»çµ±è¨ªå•é€Ÿåº¦å’Œå¢å¤§ç³»çµ±è™•ç†å®¹é‡</p><h3 class=pgc-h-arrow-right>é™ç´š</h3><p>é™ç´šæ˜¯ç•¶æœå‹™å‡ºç¾å•é¡Œæˆ–è€…å½±éŸ¿åˆ°æ ¸å¿ƒæµç¨‹æ™‚ï¼Œéœ€è¦æš«æ™‚å±è”½æ‰ï¼Œå¾…é«˜å³°æˆ–è€…å•é¡Œè§£æ±ºå¾Œå†æ‰“é–‹</p><h3 class=pgc-h-arrow-right>é™æµ</h3><p>é™æµçš„ç›®çš„æ˜¯é€šéå°ä½µç™¼è¨ªå•/è«‹æ±‚é€²è¡Œé™é€Ÿï¼Œæˆ–è€…å°ä¸€å€‹æ™‚é–“çª—å£å…§çš„è«‹æ±‚é€²è¡Œé™é€Ÿä¾†ä¿è­·ç³»çµ±ï¼Œä¸€æ—¦é”åˆ°é™åˆ¶é€Ÿç‡å‰‡å¯ä»¥æ‹’çµ•æœå‹™ã€æ’éšŠæˆ–ç­‰å¾…ã€é™ç´šç­‰è™•ç†</p><h3 class=pgc-h-arrow-right>å•é¡Œæè¿°</h3><p><strong>1ã€</strong>æŸå¤©Aå›çªç„¶ç™¼ç¾è‡ªå·±çš„æ¥å£è«‹æ±‚é‡çªç„¶æ¼²åˆ°ä¹‹å‰çš„10å€ï¼Œæ²’å¤šä¹…è©²æ¥å£å¹¾ä¹ä¸å¯ä½¿ç”¨ï¼Œä¸¦å¼•ç™¼é€£é–åæ‡‰å°è‡´æ•´å€‹ç³»çµ±å´©æ½°ã€‚å¦‚ä½•æ‡‰å°é€™ç¨®æƒ…æ³å‘¢ï¼Ÿç”Ÿæ´»çµ¦äº†æˆ‘å€‘ç­”æ¡ˆï¼šæ¯”å¦‚è€å¼é›»é–˜éƒ½å®‰è£äº†ä¿éšªçµ²ï¼Œä¸€æ—¦æœ‰äººä½¿ç”¨è¶…å¤§åŠŸç‡çš„è¨­å‚™ï¼Œä¿éšªçµ²å°±æœƒç‡’æ–·ä»¥ä¿è­·å„å€‹é›»å™¨ä¸è¢«å¼·é›»æµçµ¦ç‡’å£ã€‚åŒç†æˆ‘å€‘çš„æ¥å£ä¹Ÿéœ€è¦å®‰è£ä¸Šâ€œä¿éšªçµ²â€ï¼Œä»¥é˜²æ­¢éé æœŸçš„è«‹æ±‚å°ç³»çµ±å£“åŠ›éå¤§è€Œå¼•èµ·çš„ç³»çµ±ç™±ç˜“ï¼Œç•¶æµé‡éå¤§æ™‚ï¼Œå¯ä»¥æ¡å–æ‹’çµ•æˆ–è€…å¼•æµç­‰æ©Ÿåˆ¶ã€‚æ•´ç·¨ï¼šå¾®ä¿¡å…¬çœ¾è™Ÿï¼Œæœé›²åº«æŠ€è¡“åœ˜éšŠï¼ŒIDï¼šsouyunku</p><p><strong>2ã€</strong>ç·©å­˜çš„ç›®çš„æ˜¯æå‡ç³»çµ±è¨ªå•é€Ÿåº¦å’Œå¢å¤§ç³»çµ±èƒ½è™•ç†çš„å®¹é‡ï¼Œå¯è¬‚æ˜¯æŠ—é«˜ä½µç™¼æµé‡çš„éŠ€å½ˆï¼›è€Œé™ç´šæ˜¯ç•¶æœå‹™å‡ºå•é¡Œæˆ–è€…å½±éŸ¿åˆ°æ ¸å¿ƒæµç¨‹çš„æ€§èƒ½å‰‡éœ€è¦æš«æ™‚å±è”½æ‰ï¼Œå¾…é«˜å³°æˆ–è€…å•é¡Œè§£æ±ºå¾Œå†æ‰“é–‹ï¼›è€Œæœ‰äº›å ´æ™¯ä¸¦ä¸èƒ½ç”¨ç·©å­˜å’Œé™ç´šä¾†è§£æ±ºï¼Œæ¯”å¦‚ç¨€ç¼ºè³‡æºï¼ˆç§’æ®ºã€æ¶è³¼ï¼‰ã€å¯«æœå‹™ï¼ˆå¦‚è©•è«–ã€ä¸‹å–®ï¼‰ã€é »ç¹çš„è¤‡é›œæŸ¥è©¢ï¼ˆè©•è«–çš„æœ€å¾Œå¹¾é ï¼‰ï¼Œå› æ­¤éœ€æœ‰ä¸€ç¨®æ‰‹æ®µä¾†é™åˆ¶é€™äº›å ´æ™¯çš„ä½µç™¼/è«‹æ±‚é‡ï¼Œå³é™æµã€‚</p><p><strong>3ã€</strong>ç³»çµ±åœ¨è¨­è¨ˆä¹‹åˆå°±æœƒæœ‰ä¸€å€‹é ä¼°å®¹é‡ï¼Œé•·æ™‚é–“è¶…éç³»çµ±èƒ½æ‰¿å—çš„TPS/QPSé–¾å€¼ï¼Œç³»çµ±å¯èƒ½æœƒè¢«å£“å®ï¼Œæœ€çµ‚å°è‡´æ•´å€‹æœå‹™ä¸å¤ ç”¨ã€‚ç‚ºäº†é¿å…é€™ç¨®æƒ…æ³ï¼Œæˆ‘å€‘å°±éœ€è¦å°æ¥å£è«‹æ±‚é€²è¡Œé™æµã€‚</p><p><strong>4ã€</strong>é™æµçš„ç›®çš„æ˜¯é€šéå°ä½µç™¼è¨ªå•è«‹æ±‚é€²è¡Œé™é€Ÿæˆ–è€…ä¸€å€‹æ™‚é–“çª—å£å…§çš„çš„è«‹æ±‚æ•¸é‡é€²è¡Œé™é€Ÿä¾†ä¿è­·ç³»çµ±ï¼Œä¸€æ—¦é”åˆ°é™åˆ¶é€Ÿç‡å‰‡å¯ä»¥æ‹’çµ•æœå‹™ã€æ’éšŠæˆ–ç­‰å¾…ã€‚</p><p><strong>5ã€</strong>ä¸€èˆ¬é–‹ç™¼é«˜ä½µç™¼ç³»çµ±å¸¸è¦‹çš„é™æµæ¨¡å¼æœ‰æ§åˆ¶ä½µç™¼å’Œæ§åˆ¶é€Ÿç‡ï¼Œä¸€å€‹æ˜¯é™åˆ¶ä½µç™¼çš„ç¸½æ•¸é‡ï¼ˆæ¯”å¦‚æ•¸æ“šåº«é€£æ¥æ± ã€ç·šç¨‹æ± ï¼‰ï¼Œä¸€å€‹æ˜¯é™åˆ¶ä½µç™¼è¨ªå•çš„é€Ÿç‡ï¼ˆå¦‚nginxçš„limitconnæ¨¡å¡Šï¼Œç”¨ä¾†é™åˆ¶ç¬æ™‚ä½µç™¼é€£æ¥æ•¸ï¼‰ï¼Œå¦å¤–é‚„å¯ä»¥é™åˆ¶å–®ä½æ™‚é–“çª—å£å…§çš„è«‹æ±‚æ•¸é‡ï¼ˆå¦‚Guavaçš„RateLimiterã€nginxçš„limitreqæ¨¡å¡Šï¼Œé™åˆ¶æ¯ç§’çš„å¹³å‡é€Ÿç‡ï¼‰ã€‚å…¶ä»–é‚„æœ‰å¦‚é™åˆ¶é ç¨‹æ¥å£èª¿ç”¨é€Ÿç‡ã€é™åˆ¶MQçš„æ¶ˆè²»é€Ÿç‡ã€‚å¦å¤–é‚„å¯ä»¥æ ¹æ“šç¶²çµ¡é€£æ¥æ•¸ã€ç¶²çµ¡æµé‡ã€CPUæˆ–å…§å­˜è² è¼‰ç­‰ä¾†é™æµã€‚</p><h2 class=pgc-h-arrow-right>ç›¸é—œæ¦‚å¿µï¼š</h2><h3 class=pgc-h-arrow-right>PV:</h3><p>page view é é¢ç¸½è¨ªå•é‡ï¼Œæ¯åˆ·æ–°ä¸€æ¬¡è¨˜éŒ„ä¸€æ¬¡ã€‚</p><h3 class=pgc-h-arrow-right>UV:</h3><p>unique view å®¢æˆ¶ç«¯ä¸»æ©Ÿè¨ªå•ï¼ŒæŒ‡ä¸€å¤©å…§ç›¸åŒIPçš„è¨ªå•è¨˜ç‚º1æ¬¡ã€‚</p><h3 class=pgc-h-arrow-right>QPS:</h3><p>query per second,å³æ¯ç§’è¨ªå•é‡ã€‚qpså¾ˆå¤§ç¨‹åº¦ä¸Šä»£è¡¨äº†ç³»çµ±çš„ç¹å¿™åº¦ï¼Œæ²’æ¬¡è«‹æ±‚å¯èƒ½å­˜åœ¨å¤šæ¬¡çš„ç£ç›¤ioï¼Œç¶²çµ¡è«‹æ±‚ï¼Œå¤šå€‹cpuæ™‚é–“ç‰‡ï¼Œä¸€æ—¦qpsè¶…éäº†é å…ˆè¨­ç½®çš„é–¥å€¼ï¼Œå¯ä»¥è€ƒé‡æ“´å®¹å¢åŠ æœå‹™å™¨ï¼Œé¿å…è¨ªå•é‡éå¤§å°è‡´çš„å®•æ©Ÿã€‚æ•´ç·¨ï¼šå¾®ä¿¡å…¬çœ¾è™Ÿï¼Œæœé›²åº«æŠ€è¡“åœ˜éšŠï¼ŒIDï¼šsouyunku</p><h3 class=pgc-h-arrow-right>RT:</h3><p>response time,æ¯æ¬¡è«‹æ±‚çš„éŸ¿æ‡‰æ™‚é–“,ç›´æ¥æ±ºå®šç”¨æˆ¶é«”é©—æ€§ã€‚</p><p>æœ¬æ–‡ä¸»è¦ä»‹ç´¹æ‡‰ç”¨ç´šé™æµæ–¹æ³•ï¼Œåˆ†ä½ˆå¼é™æµã€æµé‡å…¥å£é™æµï¼ˆæ¥å…¥å±¤å¦‚NGINX limitconnå’Œlimitreq æ¨¡å¡Šï¼‰ã€‚</p><h2 class=pgc-h-arrow-right>æ‡‰ç”¨ç´šé™æµ</h2><h3 class=pgc-h-arrow-right>ä¸€ã€æ§åˆ¶ä½µç™¼æ•¸é‡</h3><p>å±¬æ–¼ä¸€ç¨®è¼ƒå¸¸è¦‹çš„é™æµæ‰‹æ®µï¼Œåœ¨å¯¦éš›æ‡‰ç”¨ä¸­å¯ä»¥é€šéä¿¡è™Ÿé‡æ©Ÿåˆ¶ï¼ˆå¦‚Javaä¸­çš„Semaphoreï¼‰ä¾†å¯¦ç¾ã€‚æ“ä½œç³»çµ±çš„ä¿¡è™Ÿé‡æ˜¯å€‹å¾ˆé‡è¦çš„æ¦‚å¿µï¼ŒJava ä½µç™¼åº« çš„Semaphore å¯ä»¥å¾ˆè¼•é¬†å®Œæˆä¿¡è™Ÿé‡æ§åˆ¶ï¼ŒSemaphoreå¯ä»¥æ§åˆ¶æŸå€‹è³‡æºå¯è¢«åŒæ™‚è¨ªå•çš„å€‹æ•¸ï¼Œé€šé acquire() ç²å–ä¸€å€‹è¨±å¯ï¼Œå¦‚æœæ²’æœ‰å°±ç­‰å¾…ï¼Œè€Œ release() é‡‹æ”¾ä¸€å€‹è¨±å¯ã€‚</p><p>èˆ‰å€‹ä¾‹å­ï¼Œæˆ‘å€‘å°å¤–æä¾›ä¸€å€‹æœå‹™æ¥å£ï¼Œå…è¨±æœ€å¤§ä½µç™¼æ•¸ç‚º10ï¼Œä»£ç¢¼å¯¦ç¾å¦‚ä¸‹ï¼š</p><pre><code>public class DubboService {    private final Semaphore permit = new Semaphore(10, true);    public void process(){        try{            permit.acquire();            //æ¥­å‹™é‚è¼¯è™•ç†        } catch (InterruptedException e) {            e.printStackTrace();        } finally {            permit.release();        }    }}</code></pre><p>åœ¨ä»¥ä¸Šä»£ç¢¼ä¸­ï¼Œé›–ç„¶æœ‰30å€‹ç·šç¨‹åœ¨åŸ·è¡Œï¼Œä½†æ˜¯éš»å…è¨±10å€‹ä½µç™¼çš„åŸ·è¡Œã€‚Semaphoreçš„æ§‹é€ æ–¹æ³•Semaphore(int permits) æ¥å—ä¸€å€‹æ•´å‹çš„æ•¸å­—ï¼Œè¡¨ç¤ºå¯ç”¨çš„è¨±å¯è­‰æ•¸é‡ã€‚Semaphore(10)è¡¨ç¤ºå…è¨±10å€‹ç·šç¨‹ç²å–è¨±å¯è­‰ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§ä½µç™¼æ•¸æ˜¯10ã€‚Semaphoreçš„ç”¨æ³•ä¹Ÿå¾ˆç°¡å–®ï¼Œé¦–å…ˆç·šç¨‹ä½¿ç”¨Semaphoreçš„acquire()ç²å–ä¸€å€‹è¨±å¯è­‰ï¼Œä½¿ç”¨å®Œä¹‹å¾Œèª¿ç”¨release()æ­¸é‚„è¨±å¯è­‰ï¼Œé‚„å¯ä»¥ç”¨tryAcquire()æ–¹æ³•å˜—è©¦ç²å–è¨±å¯è­‰ï¼Œä¿¡è™Ÿé‡çš„æœ¬è³ªæ˜¯æ§åˆ¶æŸå€‹è³‡æºå¯è¢«åŒæ™‚è¨ªå•çš„å€‹æ•¸ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æ§åˆ¶æŸè³‡æºçš„è¨ªå•é »ç‡ï¼Œä½†ä¸èƒ½ç²¾ç¢ºæ§åˆ¶ï¼Œæ§åˆ¶è¨ªå•é »ç‡çš„æ¨¡å¼è¦‹ä¸‹æ–‡æè¿°ã€‚</p><h3 class=pgc-h-arrow-right>äºŒã€æ§åˆ¶è¨ªå•é€Ÿç‡</h3><p>åœ¨å·¥ç¨‹å¯¦è¸ä¸­ï¼Œå¸¸è¦‹çš„æ˜¯ä½¿ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•ä¾†å¯¦ç¾é€™ç¨®æ¨¡å¼ï¼Œå¸¸ç”¨çš„é™æµç®—æ³•æœ‰å…©ç¨®ï¼šæ¼æ¡¶ç®—æ³•å’Œä»¤ç‰Œæ¡¶ç®—æ³•ã€‚</p><h3 class=pgc-h-arrow-right>æ¼æ¡¶ç®—æ³•</h3><p>æ¼æ¡¶ç®—æ³•æ€è·¯å¾ˆç°¡å–®ï¼Œæ°´ï¼ˆè«‹æ±‚ï¼‰å…ˆé€²å…¥åˆ°æ¼æ¡¶è£¡ï¼Œæ¼æ¡¶ä»¥ä¸€å®šçš„é€Ÿåº¦å‡ºæ°´ï¼Œç•¶æ°´æµå…¥é€Ÿåº¦éå¤§æœƒç›´æ¥æº¢å‡ºï¼Œå¯ä»¥çœ‹å‡ºæ¼æ¡¶ç®—æ³•èƒ½å¼·è¡Œé™åˆ¶æ•¸æ“šçš„å‚³è¼¸é€Ÿç‡ã€‚</p><div class=pgc-img><img alt=é«˜ä½µç™¼ä¹‹APIæ¥å£ï¼Œåˆ†ä½ˆå¼ï¼Œé˜²åˆ·é™æµï¼Œå¦‚ä½•åšï¼Ÿ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/72ef0f380abf4c6693d26afc863a1782><p class=pgc-img-caption></p></div><p>å°æ–¼å¾ˆå¤šæ‡‰ç”¨å ´æ™¯ä¾†èªªï¼Œé™¤äº†è¦æ±‚èƒ½å¤ é™åˆ¶æ•¸æ“šçš„å¹³å‡å‚³è¼¸é€Ÿç‡å¤–ï¼Œé‚„è¦æ±‚å…è¨±æŸç¨®ç¨‹åº¦çš„çªç™¼å‚³è¼¸ã€‚é€™æ™‚å€™æ¼æ¡¶ç®—æ³•å¯èƒ½å°±ä¸åˆé©äº†ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•æ›´ç‚ºé©åˆã€‚</p><h3 class=pgc-h-arrow-right>ä»¤ç‰Œæ¡¶ç®—æ³•</h3><p>å¦‚åœ–æ‰€ç¤ºï¼Œä»¤ç‰Œæ¡¶ç®—æ³•çš„åŸç†æ˜¯ç³»çµ±æœƒä»¥ä¸€å€‹æ†å®šçš„é€Ÿåº¦å¾€æ¡¶è£¡æ”¾å…¥ä»¤ç‰Œï¼Œè€Œå¦‚æœè«‹æ±‚éœ€è¦è¢«è™•ç†ï¼Œå‰‡éœ€è¦å…ˆå¾æ¡¶è£¡ç²å–ä¸€å€‹ä»¤ç‰Œï¼Œç•¶æ¡¶è£¡æ²’æœ‰ä»¤ç‰Œå¯å–æ™‚ï¼Œå‰‡æ‹’çµ•æœå‹™ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•é€šéç™¼æ”¾ä»¤ç‰Œï¼Œæ ¹æ“šä»¤ç‰Œçš„rateé »ç‡åšè«‹æ±‚é »ç‡é™åˆ¶ï¼Œå®¹é‡é™åˆ¶ç­‰ã€‚æ•´ç·¨ï¼šå¾®ä¿¡å…¬çœ¾è™Ÿï¼Œæœé›²åº«æŠ€è¡“åœ˜éšŠï¼ŒIDï¼šsouyunku</p><div class=pgc-img><img alt=é«˜ä½µç™¼ä¹‹APIæ¥å£ï¼Œåˆ†ä½ˆå¼ï¼Œé˜²åˆ·é™æµï¼Œå¦‚ä½•åšï¼Ÿ onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/95c698a90b3e44f688b87d29d568efce><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>åœ¨Wikipediaä¸Šï¼Œä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯é€™éº¼æè¿°çš„ï¼š</h3><p><strong>1ã€</strong>æ¯é1/rç§’æ¡¶ä¸­å¢åŠ ä¸€å€‹ä»¤ç‰Œã€‚</p><p><strong>2ã€</strong>æ¡¶ä¸­æœ€å¤šå­˜æ”¾bå€‹ä»¤ç‰Œï¼Œå¦‚æœæ¡¶æ»¿äº†ï¼Œæ–°æ”¾å…¥çš„ä»¤ç‰Œæœƒè¢«ä¸Ÿæ£„ã€‚</p><p><strong>3ã€</strong>ç•¶ä¸€å€‹nå­—ç¯€çš„æ•¸æ“šåŒ…åˆ°é”æ™‚ï¼Œæ¶ˆè€—nå€‹ä»¤ç‰Œï¼Œç„¶å¾Œç™¼é€è©²æ•¸æ“šåŒ…ã€‚</p><p><strong>4ã€</strong>å¦‚æœæ¡¶ä¸­å¯ç”¨ä»¤ç‰Œå°æ–¼nï¼Œå‰‡è©²æ•¸æ“šåŒ…å°‡è¢«ç·©å­˜æˆ–ä¸Ÿæ£„ã€‚</p><p>ä»¤ç‰Œæ¡¶æ§åˆ¶çš„æ˜¯ä¸€å€‹æ™‚é–“çª—å£å…§é€šéçš„æ•¸æ“šé‡ï¼Œåœ¨APIå±¤é¢æˆ‘å€‘å¸¸èªªçš„QPSã€TPSï¼Œæ­£å¥½æ˜¯ä¸€å€‹æ™‚é–“çª—å£å…§çš„è«‹æ±‚é‡æˆ–è€…äº‹å‹™é‡ï¼Œåªä¸éæ™‚é–“çª—å£é™å®šåœ¨1sç½·äº†ã€‚ä»¥ä¸€å€‹æ†å®šçš„é€Ÿåº¦å¾€æ¡¶è£¡æ”¾å…¥ä»¤ç‰Œï¼Œè€Œå¦‚æœè«‹æ±‚éœ€è¦è¢«è™•ç†ï¼Œå‰‡éœ€è¦å…ˆå¾æ¡¶è£¡ç²å–ä¸€å€‹ä»¤ç‰Œï¼Œç•¶æ¡¶è£¡æ²’æœ‰ä»¤ç‰Œå¯å–æ™‚ï¼Œå‰‡æ‹’çµ•æœå‹™ã€‚ä»¤ç‰Œæ¡¶çš„å¦å¤–ä¸€å€‹å¥½è™•æ˜¯å¯ä»¥æ–¹ä¾¿çš„æ”¹è®Šé€Ÿåº¦ï¼Œä¸€æ—¦éœ€è¦æé«˜é€Ÿç‡ï¼Œå‰‡æŒ‰éœ€æé«˜æ”¾å…¥æ¡¶ä¸­çš„ä»¤ç‰Œçš„é€Ÿç‡ã€‚</p><p>åœ¨æˆ‘å€‘çš„å·¥ç¨‹å¯¦è¸ä¸­ï¼Œé€šå¸¸ä½¿ç”¨Googleé–‹æºå·¥å…·åŒ…Guavaæä¾›çš„é™æµå·¥å…·é¡RateLimiterä¾†å¯¦ç¾æ§åˆ¶é€Ÿç‡ï¼Œè©²é¡åŸºæ–¼ä»¤ç‰Œæ¡¶ç®—æ³•ä¾†å®Œæˆé™æµï¼Œéå¸¸æ˜“æ–¼ä½¿ç”¨ï¼Œè€Œä¸”éå¸¸é«˜æ•ˆã€‚å¦‚æˆ‘å€‘ä¸å¸Œæœ›æ¯ç§’çš„ä»»å‹™æäº¤è¶…é1å€‹</p><pre><code>public static void main(String[] args) {    String start = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(new Date());    RateLimiter limiter = RateLimiter.create(1.0); // é€™è£¡çš„1è¡¨ç¤ºæ¯ç§’å…è¨±è™•ç†çš„é‡ç‚º1å€‹    for (int i = 1; i &lt;= 10; i++) {        double waitTime = limiter.acquire(i); // è«‹æ±‚RateLimiter, è¶…épermitsæœƒè¢«é˜»å¡        System.out.println("cutTime=" + System.currentTimeMillis() + " call execute:" + i + " waitTime:" + waitTime);    }    String end = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(new Date());    System.out.println("start time:" + start);    System.out.println("end time:" + end);}</code></pre><p>é¦–å…ˆé€šéRateLimiter.create(1.0);å‰µå»ºä¸€å€‹é™æµå™¨ï¼Œåƒæ•¸ä»£è¡¨æ¯ç§’ç”Ÿæˆçš„ä»¤ç‰Œæ•¸ï¼Œé€šélimiter.acquire(i);ä¾†ä»¥é˜»å¡çš„æ–¹å¼ç²å–ä»¤ç‰Œï¼Œä»¤ç‰Œæ¡¶ç®—æ³•å…è¨±ä¸€å®šç¨‹åº¦çš„çªç™¼ï¼ˆå…è¨±æ¶ˆè²»æœªä¾†çš„ä»¤ç‰Œï¼‰ï¼Œæ‰€ä»¥å¯ä»¥ä¸€æ¬¡æ€§æ¶ˆè²»iå€‹ä»¤ç‰Œï¼›ç•¶ç„¶ä¹Ÿå¯ä»¥é€šétryAcquire(int permits, long timeout, TimeUnit unit)ä¾†è¨­ç½®ç­‰å¾…è¶…æ™‚æ™‚é–“çš„æ–¹å¼ç²å–ä»¤ç‰Œï¼Œå¦‚æœè¶…timeoutç‚º0ï¼Œå‰‡ä»£è¡¨éé˜»å¡ï¼Œç²å–ä¸åˆ°ç«‹å³è¿”å›ï¼Œæ”¯æŒé˜»å¡æˆ–å¯è¶…æ™‚çš„ä»¤ç‰Œæ¶ˆè²»ã€‚</p><p>å¾è¼¸å‡ºä¾†çœ‹ï¼ŒRateLimiteræ”¯æŒé æ¶ˆè²»ï¼Œæ¯”å¦‚åœ¨acquire(5)æ™‚ï¼Œç­‰å¾…æ™‚é–“æ˜¯4ç§’ï¼Œæ˜¯ä¸Šä¸€å€‹ç²å–ä»¤ç‰Œæ™‚é æ¶ˆè²»äº†3å€‹å…©æ’ï¼Œå›ºéœ€è¦ç­‰å¾…3*1ç§’ï¼Œç„¶å¾Œåˆé æ¶ˆè²»äº†5å€‹ä»¤ç‰Œï¼Œä»¥æ­¤é¡æ¨ã€‚</p><p><strong>RateLimiteré€šéé™åˆ¶å¾Œé¢è«‹æ±‚çš„ç­‰å¾…æ™‚é–“ï¼Œä¾†æ”¯æŒä¸€å®šç¨‹åº¦çš„çªç™¼è«‹æ±‚(é æ¶ˆè²»</strong>)ï¼Œåœ¨ä½¿ç”¨éç¨‹ä¸­éœ€è¦æ³¨æ„é€™ä¸€é»ï¼ŒGuavaæœ‰å…©ç¨®é™æµæ¨¡å¼ï¼Œä¸€ç¨®ç‚ºç©©å®šæ¨¡å¼(SmoothBursty:ä»¤ç‰Œç”Ÿæˆé€Ÿåº¦æ†å®šï¼Œå¹³æ»‘çªç™¼é™æµ)ï¼Œä¸€ç¨®ç‚ºæ¼¸é€²æ¨¡å¼(SmoothWarmingUp:ä»¤ç‰Œç”Ÿæˆé€Ÿåº¦ç·©æ…¢æå‡ç›´åˆ°ç¶­æŒåœ¨ä¸€å€‹ç©©å®šå€¼ï¼Œå¹³æ»‘é ç†±é™æµ) å…©ç¨®æ¨¡å¼å¯¦ç¾æ€è·¯é¡ä¼¼ï¼Œä¸»è¦å€åˆ¥åœ¨ç­‰å¾…æ™‚é–“çš„è¨ˆç®—ä¸Šã€‚</p><h3 class=pgc-h-arrow-right>SmoothBursty æ¨¡å¼ï¼š</h3><p>RateLimiter limiter = RateLimiter.create(5); RateLimiter.create(5)è¡¨ç¤ºæ¡¶å®¹é‡ç‚º5ä¸”æ¯ç§’æ–°å¢5å€‹ä»¤ç‰Œï¼Œå³æ¯éš”200æ¯«ç§’æ–°å¢ä¸€å€‹ä»¤ç‰Œï¼›limiter.acquire()è¡¨ç¤ºæ¶ˆè²»ä¸€å€‹ä»¤ç‰Œï¼Œå¦‚æœç•¶å‰æ¡¶ä¸­æœ‰è¶³å¤ ä»¤ç‰Œå‰‡æˆåŠŸï¼ˆè¿”å›å€¼ç‚º0ï¼‰ï¼Œå¦‚æœæ¡¶ä¸­æ²’æœ‰ä»¤ç‰Œå‰‡æš«åœä¸€æ®µæ™‚é–“ï¼Œæ¯”å¦‚ç™¼ä»¤ç‰Œé–“éš”æ˜¯200æ¯«ç§’ï¼Œå‰‡ç­‰å¾…200æ¯«ç§’å¾Œå†å»æ¶ˆè²»ä»¤ç‰Œï¼Œé€™ç¨®å¯¦ç¾å°‡çªç™¼è«‹æ±‚é€Ÿç‡å¹³å‡ç‚ºäº†å›ºå®šè«‹æ±‚é€Ÿç‡ã€‚</p><h3 class=pgc-h-arrow-right>SmoothWarmingUpæ¨¡å¼ï¼š</h3><p>RateLimiter limiter = RateLimiter.create(5,1000, TimeUnit.MILLISECONDS);</p><h3 class=pgc-h-arrow-right>å‰µå»ºæ–¹å¼ï¼š</h3><p><strong>RateLimiter.create(doublepermitsPerSecond, long warmupPeriod, TimeUnit unit)ï¼ŒpermitsPerSecondè¡¨ç¤ºæ¯ç§’æ–°å¢çš„ä»¤ç‰Œæ•¸ï¼Œ</strong>warmupPeriodè¡¨ç¤ºåœ¨å¾å†·å•Ÿå‹•é€Ÿç‡éæ¸¡åˆ°å¹³å‡é€Ÿç‡çš„æ™‚é–“é–“éš”ã€‚é€Ÿç‡æ˜¯æ¢¯å½¢ä¸Šå‡é€Ÿç‡çš„ï¼Œä¹Ÿå°±æ˜¯èªªå†·å•Ÿå‹•æ™‚æœƒä»¥ä¸€å€‹æ¯”è¼ƒå¤§çš„é€Ÿç‡æ…¢æ…¢åˆ°å¹³å‡é€Ÿç‡ï¼›ç„¶å¾Œè¶¨æ–¼å¹³å‡é€Ÿç‡ï¼ˆæ¢¯å½¢ä¸‹é™åˆ°å¹³å‡é€Ÿç‡ï¼‰ã€‚å¯ä»¥é€šéèª¿ç¯€warmupPeriodåƒæ•¸å¯¦ç¾ä¸€é–‹å§‹å°±æ˜¯å¹³æ»‘å›ºå®šé€Ÿç‡ã€‚æ•´ç·¨ï¼šå¾®ä¿¡å…¬çœ¾è™Ÿï¼Œæœé›²åº«æŠ€è¡“åœ˜éšŠï¼ŒIDï¼šsouyunku</p><h3 class=pgc-h-arrow-right>æ”¾åœ¨Controllerä¸­ç”¨Jemterå£“æ¸¬</h3><div class=pgc-img><img alt=é«˜ä½µç™¼ä¹‹APIæ¥å£ï¼Œåˆ†ä½ˆå¼ï¼Œé˜²åˆ·é™æµï¼Œå¦‚ä½•åšï¼Ÿ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/87bc89502ca74351af14886b576b1ae4><p class=pgc-img-caption></p></div><p>æ³¨ï¼šRateLimiteræ§åˆ¶çš„æ˜¯é€Ÿç‡ï¼ŒSamephoreæ§åˆ¶çš„æ˜¯ä½µç™¼é‡ã€‚RateLimiterçš„åŸç†å°±æ˜¯ä»¤ç‰Œæ¡¶ï¼Œå®ƒä¸»è¦ç”±è¨±å¯ç™¼å‡ºçš„é€Ÿç‡ä¾†å®šç¾©ï¼Œå¦‚æœæ²’æœ‰é¡å¤–çš„é…ç½®ï¼Œè¨±å¯è­‰å°‡æŒ‰æ¯ç§’è¨±å¯è­‰è¦å®šçš„å›ºå®šé€Ÿåº¦åˆ†é…ï¼Œè¨±å¯å°‡è¢«å¹³æ»‘åœ°åˆ†ç™¼ï¼Œè‹¥è«‹æ±‚è¶…épermitsPerSecondå‰‡RateLimiteræŒ‰ç…§æ¯ç§’ 1/permitsPerSecond çš„é€Ÿç‡é‡‹æ”¾è¨±å¯ã€‚æ³¨æ„:RateLimiteré©ç”¨æ–¼å–®é«”æ‡‰ç”¨ï¼Œä¸”RateLimiterä¸ä¿è­‰å…¬å¹³æ€§è¨ªå•ã€‚</p><p>ä½¿ç”¨ä¸Šè¿°æ–¹å¼ä½¿ç”¨RateLimiterçš„æ–¹å¼ä¸å¤ å„ªé›…ï¼Œè‡ªå®šç¾©è¨»è§£+AOPçš„æ–¹å¼å¯¦ç¾(é©ç”¨æ–¼å–®é«”æ‡‰ç”¨)ï¼Œè©³ç´°è¦‹ä¸‹é¢ä»£ç¢¼ï¼š</p><h3 class=pgc-h-arrow-right>è‡ªå®šç¾©è¨»è§£ï¼š</h3><pre><code>import java.lang.annotation.*;/** * è‡ªå®šç¾©è¨»è§£å¯ä»¥ä¸åŒ…å«å±¬æ€§ï¼Œæˆç‚ºä¸€å€‹æ¨™è­˜è¨»è§£ */@Inherited@Documented@Target({ElementType.METHOD, ElementType.FIELD, ElementType.TYPE})@Retention(RetentionPolicy.RUNTIME)public @interface RateLimitAspect {}</code></pre><h3 class=pgc-h-arrow-right>è‡ªå®šç¾©åˆ‡é¢é¡</h3><pre><code>import com.google.common.util.concurrent.RateLimiter;import com.test.cn.springbootdemo.util.ResultUtil;import net.sf.json.JSONObject;import org.aspectj.lang.ProceedingJoinPoint;import org.aspectj.lang.annotation.Around;import org.aspectj.lang.annotation.Aspect;import org.aspectj.lang.annotation.Pointcut;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.annotation.Scope;import org.springframework.stereotype.Component;import javax.servlet.ServletOutputStream;import javax.servlet.http.HttpServletResponse;import java.io.IOException;@Component@Scope@Aspectpublic class RateLimitAop {    @Autowired    private HttpServletResponse response;    private RateLimiter rateLimiter = RateLimiter.create(5.0); //æ¯”å¦‚èªªï¼Œæˆ‘é€™è£¡è¨­ç½®"ä½µç™¼æ•¸"ç‚º5    @Pointcut("@annotation(com.test.cn.springbootdemo.aspect.RateLimitAspect)")    public void serviceLimit() {    }    @Around("serviceLimit()")    public Object around(ProceedingJoinPoint joinPoint) {        Boolean flag = rateLimiter.tryAcquire();        Object obj = null;        try {            if (flag) {                obj = joinPoint.proceed();            }else{                String result = JSONObject.fromObject(ResultUtil.success1(100, "failure")).toString();                output(response, result);            }        } catch (Throwable e) {            e.printStackTrace();        }        System.out.println("flag=" + flag + ",obj=" + obj);        return obj;    }    public void output(HttpServletResponse response, String msg) throws IOException {        response.setContentType("application/json;charset=UTF-8");        ServletOutputStream outputStream = null;        try {            outputStream = response.getOutputStream();            outputStream.write(msg.getBytes("UTF-8"));        } catch (IOException e) {            e.printStackTrace();        } finally {            outputStream.flush();            outputStream.close();        }    }}</code></pre><h3 class=pgc-h-arrow-right>æ¸¬è©¦controller</h3><pre><code>import com.test.cn.springbootdemo.aspect.RateLimitAspect;import com.test.cn.springbootdemo.util.ResultUtil;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.ResponseBody;@Controllerpublic class TestController {    @ResponseBody    @RateLimitAspect    @RequestMapping("/test")    public String test(){        return ResultUtil.success1(1001, "success").toString();    }</code></pre><h3 class=pgc-h-arrow-right>å£“æ¸¬çµæœï¼š</h3><div class=pgc-img><img alt=é«˜ä½µç™¼ä¹‹APIæ¥å£ï¼Œåˆ†ä½ˆå¼ï¼Œé˜²åˆ·é™æµï¼Œå¦‚ä½•åšï¼Ÿ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/56355c9bd23f4860aa771a1aaff34dfa><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>ä¸‰ã€æ§åˆ¶å–®ä½æ™‚é–“çª—å£å…§è«‹æ±‚æ•¸</h3><p>æŸäº›å ´æ™¯ä¸‹ï¼Œæˆ‘å€‘æƒ³é™åˆ¶æŸå€‹æ¥å£æˆ–æœå‹™ æ¯ç§’/æ¯åˆ†é˜/æ¯å¤© çš„è«‹æ±‚æ¬¡æ•¸æˆ–èª¿ç”¨æ¬¡æ•¸ã€‚ä¾‹å¦‚é™åˆ¶æœå‹™æ¯ç§’çš„èª¿ç”¨æ¬¡æ•¸ç‚º50ï¼Œå¯¦ç¾å¦‚ä¸‹ï¼š</p><pre><code>private LoadingCache &lt; Long, AtomicLong &gt; counter = CacheBuilder.newBuilder().expireAfterWrite(2, TimeUnit.SECONDS).build(new CacheLoader &lt; Long, AtomicLong &gt; () {@    Override    public AtomicLong load(Long seconds) throws Exception {        return new AtomicLong(0);    }});public static long permit = 50;public ResponseEntity getData() throws ExecutionException {    //å¾—åˆ°ç•¶å‰ç§’    long currentSeconds = System.currentTimeMillis() / 1000;    if (counter.get(currentSeconds).incrementAndGet() &gt; permit) {        return ResponseEntity.builder().code(404).msg("è¨ªå•é€Ÿç‡éå¿«").build();    }    //æ¥­å‹™è™•ç†}</code></pre><p>åˆ°æ­¤æ‡‰ç”¨ç´šé™æµçš„ä¸€äº›æ–¹æ³•å°±ä»‹ç´¹å®Œäº†ã€‚å‡è¨­å°‡æ‡‰ç”¨éƒ¨ç½²åˆ°å¤šè‡ºæ©Ÿå™¨ï¼Œæ‡‰ç”¨ç´šé™æµæ–¹å¼åªæ˜¯å–®æ‡‰ç”¨å…§çš„è«‹æ±‚é™æµï¼Œä¸èƒ½é€²è¡Œå…¨ä¾·é™æµã€‚å› æ­¤æˆ‘å€‘éœ€è¦åˆ†ä½ˆå¼é™æµå’Œæ¥å…¥å±¤é™æµä¾†è§£æ±ºé€™å€‹å•é¡Œã€‚</p><h2 class=pgc-h-arrow-right>åˆ†ä½ˆå¼é™æµ</h2><p><strong>è‡ªå®šç¾©è¨»è§£+æ””æˆªå™¨+Rediså¯¦ç¾é™æµ (å–®é«”å’Œåˆ†ä½ˆå¼å‡é©ç”¨ï¼Œå…¨ä¾·é™æµ)</strong></p><h3 class=pgc-h-arrow-right>è‡ªå®šç¾©è¨»è§£ï¼š</h3><pre><code>@Inherited@Documented@Target({ElementType.FIELD,ElementType.TYPE,ElementType.METHOD})@Retention(RetentionPolicy.RUNTIME)public @interface AccessLimit {    int limit() default 5;      int sec() default 5;}</code></pre><h3 class=pgc-h-arrow-right>æ””æˆªå™¨ï¼š</h3><pre><code>public class AccessLimitInterceptor implements HandlerInterceptor {    @Autowired    private RedisTemplate&lt;String, Integer&gt; redisTemplate;  //ä½¿ç”¨RedisTemplateæ“ä½œredis    @Override    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {        if (handler instanceof HandlerMethod) {            HandlerMethod handlerMethod = (HandlerMethod) handler;            Method method = handlerMethod.getMethod();            if (!method.isAnnotationPresent(AccessLimit.class)) {                return true;            }            AccessLimit accessLimit = method.getAnnotation(AccessLimit.class);            if (accessLimit == null) {                return true;            }            int limit = accessLimit.limit();            int sec = accessLimit.sec();            String key = IPUtil.getIpAddr(request) + request.getRequestURI();            Integer maxLimit = redisTemplate.opsForValue().get(key);            if (maxLimit == null) {                redisTemplate.opsForValue().set(key, 1, sec, TimeUnit.SECONDS);  //setæ™‚ä¸€å®šè¦åŠ éæœŸæ™‚é–“            } else if (maxLimit &lt; limit) {                redisTemplate.opsForValue().set(key, maxLimit + 1, sec, TimeUnit.SECONDS);            } else {                output(response, "è«‹æ±‚å¤ªé »ç¹!");                return false;            }        }        return true;    }    public void output(HttpServletResponse response, String msg) throws IOException {        response.setContentType("application/json;charset=UTF-8");        ServletOutputStream outputStream = null;        try {            outputStream = response.getOutputStream();            outputStream.write(msg.getBytes("UTF-8"));        } catch (IOException e) {            e.printStackTrace();        } finally {            outputStream.flush();            outputStream.close();        }    }    @Override    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {    }    @Override    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {    }}</code></pre><h3 class=pgc-h-arrow-right>controller:</h3><pre><code>@Controller@RequestMapping("/activity")public class AopController {    @ResponseBody    @RequestMapping("/seckill")    @AccessLimit(limit = 4,sec = 10)  //åŠ ä¸Šè‡ªå®šç¾©è¨»è§£å³å¯    public String test (HttpServletRequest request,@RequestParam(value = "username",required = false) String userName){        //TODO somethingsâ€¦â€¦        return   "hello world !";    }}</code></pre><h3 class=pgc-h-arrow-right>é…ç½®æ–‡ä»¶ï¼š</h3><pre><code>/*springmvcçš„é…ç½®æ–‡ä»¶ä¸­åŠ å…¥è‡ªå®šç¾©æ””æˆªå™¨*/&lt;mvc:interceptors&gt;   &lt;mvc:interceptor&gt;      &lt;mvc:mapping path="/**"/&gt;      &lt;bean class="com.pptv.activityapi.controller.pointsmall.AccessLimitInterceptor"/&gt;   &lt;/mvc:interceptor&gt;&lt;/mvc:interceptors&gt;</code></pre><p>è¨ªå•æ•ˆæœå¦‚ä¸‹ï¼Œ10så…§è¨ªå•æ¥å£è¶…é4æ¬¡ä»¥ä¸Šå°±éæ¿¾è«‹æ±‚ï¼ŒåŸç†å’Œè¨ˆæ•¸å™¨ç®—æ³•é¡ä¼¼ï¼š</p><div class=pgc-img><img alt=é«˜ä½µç™¼ä¹‹APIæ¥å£ï¼Œåˆ†ä½ˆå¼ï¼Œé˜²åˆ·é™æµï¼Œå¦‚ä½•åšï¼Ÿ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/30a03c505d154a2b981658d94c6523ed><p class=pgc-img-caption></p></div><h2 class=pgc-h-arrow-right>æ¥å…¥å±¤é™æµ</h2><p><strong>ä¸»è¦ä»‹ç´¹nginx é™æµï¼Œæ¡ç”¨æ¼æ¡¶ç®—æ³•ã€‚</strong></p><p>é™åˆ¶åŸç†:å¯ä¸€å¥è©±æ¦‚æ‹¬ç‚ºï¼šâ€œæ ¹æ“šå®¢æˆ¶ç«¯ç‰¹å¾µï¼Œé™åˆ¶å…¶è¨ªå•é »ç‡â€ï¼Œå®¢æˆ¶ç«¯ç‰¹å¾µä¸»è¦æŒ‡IPã€UserAgentç­‰ã€‚ä½¿ç”¨IPæ¯”UserAgentæ›´å¯é ï¼Œå› ç‚ºIPç„¡æ³•é€ å‡ï¼ŒUserAgentå¯éš¨æ„å½é€ ã€‚æ•´ç·¨ï¼šå¾®ä¿¡å…¬çœ¾è™Ÿï¼Œæœé›²åº«æŠ€è¡“åœ˜éšŠï¼ŒIDï¼šsouyunku</p><p>ç”¨limit_reqæ¨¡å¡Šä¾†é™åˆ¶åŸºæ–¼IPè«‹æ±‚çš„è¨ªå•é »ç‡ï¼š</p><p>http://nginx.org/en/docs/http/ngxhttplimitreqmodule.html</p><p>ä¹Ÿå¯ä»¥ç”¨tengineä¸­çš„å¢å¼·ç‰ˆï¼š</p><p>http://tengine.taobao.org/documentcn/httplimitreqcn.html</p><h3 class=pgc-h-arrow-right>1ã€ä½µç™¼æ•¸å’Œé€£æ¥æ•¸æ§åˆ¶çš„é…ç½®ï¼š</h3><pre><code>nginx httpé…ç½®ï¼š    #è«‹æ±‚æ•¸é‡æ§åˆ¶ï¼Œæ¯ç§’20å€‹    limit_req_zone $binary_remote_addr zone=one:10m rate=20r/s;    #ä½µç™¼é™åˆ¶30å€‹    limit_conn_zone $binary_remote_addr zone=addr:10m;    serverå¡Šé…ç½®    limit_req zone=one burst=5;    limit_conn addr 30;</code></pre><h3 class=pgc-h-arrow-right>2ã€ngxhttplimitconnmodule å¯ä»¥ç”¨ä¾†é™åˆ¶å–®å€‹IPçš„é€£æ¥æ•¸ï¼š</h3><p>ngxhttplimitconnmoduleæ¨¡å¡Šå¯ä»¥æŒ‰ç…§å®šç¾©çš„éµé™å®šæ¯å€‹éµå€¼çš„é€£æ¥æ•¸ã€‚å¯ä»¥è¨­å®šå–®ä¸€ IP ä¾†æºçš„é€£æ¥æ•¸ã€‚</p><p>ä¸¦ä¸æ˜¯æ‰€æœ‰çš„é€£æ¥éƒ½æœƒè¢«æ¨¡å¡Šè¨ˆæ•¸ï¼›åªæœ‰é‚£äº›æ­£åœ¨è¢«è™•ç†çš„è«‹æ±‚ï¼ˆé€™äº›è«‹æ±‚çš„é ­ä¿¡æ¯å·²è¢«å®Œå…¨è®€å…¥ï¼‰æ‰€åœ¨çš„é€£æ¥æ‰æœƒè¢«è¨ˆæ•¸ã€‚</p><pre><code>http {    limit_conn_zone $binary_remote_addr zone=addr:10m;    ...    server {        ...        location /download/ {            limit_conn addr 1;        }</code></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>é™æµ</a></li><li><a>API</a></li><li><a>é˜²åˆ·</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/3998ae89.html alt=æœå‹™æ²»ç†æœ€ä½³å¯¦è¸ï¼šå¦‚ä½•ä¾æ“šåƒæ•¸å€¼é€²è¡Œæœå‹™è·¯ç”±ã€é‘‘æ¬Šã€é™æµï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/3f6fb254f0cc4ba390695e1d561d4a5c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3998ae89.html title=æœå‹™æ²»ç†æœ€ä½³å¯¦è¸ï¼šå¦‚ä½•ä¾æ“šåƒæ•¸å€¼é€²è¡Œæœå‹™è·¯ç”±ã€é‘‘æ¬Šã€é™æµï¼Ÿ>æœå‹™æ²»ç†æœ€ä½³å¯¦è¸ï¼šå¦‚ä½•ä¾æ“šåƒæ•¸å€¼é€²è¡Œæœå‹™è·¯ç”±ã€é‘‘æ¬Šã€é™æµï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8b2f4f92.html alt="Java - æ—¥æœŸæ™‚é–“API" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8b2f4f92.html title="Java - æ—¥æœŸæ™‚é–“API">Java - æ—¥æœŸæ™‚é–“API</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f2b89270.html alt="ç¹¼Java APIä¹‹å¾Œè°·æ­ŒMap APIè¢«è¨´ä¾µæ¬Š" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/93cccb8ab813488f9355335120e11164 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f2b89270.html title="ç¹¼Java APIä¹‹å¾Œè°·æ­ŒMap APIè¢«è¨´ä¾µæ¬Š">ç¹¼Java APIä¹‹å¾Œè°·æ­ŒMap APIè¢«è¨´ä¾µæ¬Š</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4abab263.html alt=è©³è§£é«˜ä½µç™¼ï¼Œå„„ç´šä½µç™¼æµé‡æ§åˆ¶ï¼Œåˆ†ä½ˆå¼å ´æ™¯ä¸‹çš„ç³»çµ±é™æµå¯¦æˆ° class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/2ce419d547834633a15d0be9cd7b4be2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4abab263.html title=è©³è§£é«˜ä½µç™¼ï¼Œå„„ç´šä½µç™¼æµé‡æ§åˆ¶ï¼Œåˆ†ä½ˆå¼å ´æ™¯ä¸‹çš„ç³»çµ±é™æµå¯¦æˆ°>è©³è§£é«˜ä½µç™¼ï¼Œå„„ç´šä½µç™¼æµé‡æ§åˆ¶ï¼Œåˆ†ä½ˆå¼å ´æ™¯ä¸‹çš„ç³»çµ±é™æµå¯¦æˆ°</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/483ff7c0.html alt="ä½¿ç”¨springcloud gatewayæ­å»ºç¶²é—œï¼ˆåˆ†æµï¼Œé™æµï¼Œç†”æ–·ï¼‰" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5dedf0d033b54111b51594e9169ef331 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/483ff7c0.html title="ä½¿ç”¨springcloud gatewayæ­å»ºç¶²é—œï¼ˆåˆ†æµï¼Œé™æµï¼Œç†”æ–·ï¼‰">ä½¿ç”¨springcloud gatewayæ­å»ºç¶²é—œï¼ˆåˆ†æµï¼Œé™æµï¼Œç†”æ–·ï¼‰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/25895d7e.html alt=5.ç©©å£“äºŒæ¥µç®¡çš„ç‰¹æ€§åŠé›»è·¯æ‡‰ç”¨ï¼ˆé™æµé›»é˜»è¨ˆç®—ï¼‰ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/dfic-imagehandler/fc5ebf22-a2ec-4faa-93c8-2455b5aa1964 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/25895d7e.html title=5.ç©©å£“äºŒæ¥µç®¡çš„ç‰¹æ€§åŠé›»è·¯æ‡‰ç”¨ï¼ˆé™æµé›»é˜»è¨ˆç®—ï¼‰>5.ç©©å£“äºŒæ¥µç®¡çš„ç‰¹æ€§åŠé›»è·¯æ‡‰ç”¨ï¼ˆé™æµé›»é˜»è¨ˆç®—ï¼‰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d5b0bb60.html alt=37ã€æ—¥æœŸ/æ™‚é–“å¸¸ç”¨APIâ€”â€”å·¥å…·/æ ¼å¼åŒ– class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/12e3b2aa4de6444fa9c899a90429aaa8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d5b0bb60.html title=37ã€æ—¥æœŸ/æ™‚é–“å¸¸ç”¨APIâ€”â€”å·¥å…·/æ ¼å¼åŒ–>37ã€æ—¥æœŸ/æ™‚é–“å¸¸ç”¨APIâ€”â€”å·¥å…·/æ ¼å¼åŒ–</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/17be6b38.html alt="REST APIä¸€äº›å¿…å‚™çš„å®‰å…¨åŸºç¤--ç­è§£ä¸€ä¸‹" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9d96827535e743af9bf55e5af185e5b7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/17be6b38.html title="REST APIä¸€äº›å¿…å‚™çš„å®‰å…¨åŸºç¤--ç­è§£ä¸€ä¸‹">REST APIä¸€äº›å¿…å‚™çš„å®‰å…¨åŸºç¤--ç­è§£ä¸€ä¸‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/49435d4e.html alt=å¿…ä¸å¯å°‘çš„APIç®¡ç†å¹³è‡ºï¼IAMç­è§£ä¸€ä¸‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/061ee5b53073474ca26b4d135ff8704f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/49435d4e.html title=å¿…ä¸å¯å°‘çš„APIç®¡ç†å¹³è‡ºï¼IAMç­è§£ä¸€ä¸‹>å¿…ä¸å¯å°‘çš„APIç®¡ç†å¹³è‡ºï¼IAMç­è§£ä¸€ä¸‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6e359400.html alt=ä¸€æ–‡è©³ç´°è¬›è§£APIç¶²é—œæ ¸å¿ƒåŠŸèƒ½å’ŒAPIç®¡ç†æ“´å±• class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/dd99cf31064849fa8e0b357249d15cf8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6e359400.html title=ä¸€æ–‡è©³ç´°è¬›è§£APIç¶²é—œæ ¸å¿ƒåŠŸèƒ½å’ŒAPIç®¡ç†æ“´å±•>ä¸€æ–‡è©³ç´°è¬›è§£APIç¶²é—œæ ¸å¿ƒåŠŸèƒ½å’ŒAPIç®¡ç†æ“´å±•</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8616d752.html alt=äº¤ä»˜æˆåŠŸçš„APIï¼šçŸ¥é“éœ€è¦ä»€éº¼å‘¢ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1ed4479cdd974216a1c10b8858e57dd7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8616d752.html title=äº¤ä»˜æˆåŠŸçš„APIï¼šçŸ¥é“éœ€è¦ä»€éº¼å‘¢ï¼Ÿ>äº¤ä»˜æˆåŠŸçš„APIï¼šçŸ¥é“éœ€è¦ä»€éº¼å‘¢ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/31a309d2.html alt=ä¼æ¥­APIæ¥å£è¨­è¨ˆ(tokenã€timestampã€sign)ä¹‹å…·é«”å¯¦ç¾ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/030192793c5048239b469f5e5db8b18d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/31a309d2.html title=ä¼æ¥­APIæ¥å£è¨­è¨ˆ(tokenã€timestampã€sign)ä¹‹å…·é«”å¯¦ç¾>ä¼æ¥­APIæ¥å£è¨­è¨ˆ(tokenã€timestampã€sign)ä¹‹å…·é«”å¯¦ç¾</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/989ea117.html alt=ç®¡ç†APIè¨ªå•ä»¤ç‰Œçš„å®‰å…¨æœ€ä½³å¯¦è¸ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/288f721723b1489c81d62de6aa6cfd33 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/989ea117.html title=ç®¡ç†APIè¨ªå•ä»¤ç‰Œçš„å®‰å…¨æœ€ä½³å¯¦è¸>ç®¡ç†APIè¨ªå•ä»¤ç‰Œçš„å®‰å…¨æœ€ä½³å¯¦è¸</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7dc97f07.html alt=ç‰©è¯ç¶²é–‹ç™¼æ¥å£APIé›²æœå‹™å™¨IISéƒ¨ç½²åŠåŸŸåè§£æå®šå‘ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/2149450612d7407fbefcec8e9b5709d9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7dc97f07.html title=ç‰©è¯ç¶²é–‹ç™¼æ¥å£APIé›²æœå‹™å™¨IISéƒ¨ç½²åŠåŸŸåè§£æå®šå‘>ç‰©è¯ç¶²é–‹ç™¼æ¥å£APIé›²æœå‹™å™¨IISéƒ¨ç½²åŠåŸŸåè§£æå®šå‘</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/16431777.html alt=Javaä¸­å¸¸ç”¨çš„APIâ€”â€”é˜¿é‡Œæ¶æ§‹å¸«çš„å…©è¬å­—ç¸½çµ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/a7567f0bc0694fd0ad5ba0987efc07ce style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/16431777.html title=Javaä¸­å¸¸ç”¨çš„APIâ€”â€”é˜¿é‡Œæ¶æ§‹å¸«çš„å…©è¬å­—ç¸½çµ>Javaä¸­å¸¸ç”¨çš„APIâ€”â€”é˜¿é‡Œæ¶æ§‹å¸«çš„å…©è¬å­—ç¸½çµ</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>