<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>一文了解，公網（外網）、私網（內網）的原理，so easy | 极客快訊</title><meta property="og:title" content="一文了解，公網（外網）、私網（內網）的原理，so easy - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/c7467801f76845048063fa6aeda62751"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1978900e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1978900e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/1978900e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1978900e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1978900e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/1978900e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/1978900e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1978900e.html><meta property="article:published_time" content="2020-11-14T21:00:38+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:38+08:00"><meta name=Keywords content><meta name=description content="一文了解，公網（外網）、私網（內網）的原理，so easy"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/1978900e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一文了解，公網（外網）、私網（內網）的原理，so easy</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>在Internet沒有形成之前，各個地方已經建立了很多小型的網絡，稱為局域網。Internet的中文意義是"互聯網"，它實際上就是將全球各地的局域網連接起來而形成的一個"可以互相連接的網絡（即互聯網）"。然而，在連接之前的各式各樣的局域網卻存在不同的網絡結構和數據傳輸規則，將這些小網連接起來後各網之間要通過什麼樣的規則來傳輸數據呢？這就像世界上有很多個國家，各個國家的人說各自的語言，世界上任意兩個人要怎樣才能互相溝通呢？如果全世界的人都能夠說同一種語言（即世界語），這個問題不就解決了嗎？TCP/IP協議正是Internet上的"世界語"。而IP地址就是TCP/IP協議所規定的"門牌號碼"。</p><p>所謂IP地址其實是基於TCP/IP的理論所規定的網絡地址。TCP/IP（Transmission Control Protocol/Internet Protocol的簡寫，中文譯名為傳輸控制協議/互聯網絡協議）協議是Internet最基本的協議，簡單地說，就是由底層的IP協議和TCP協議組成的。TCP/IP是國際上通用的網絡協議，也是用於互聯網的第一套協議，也正因為有了TCP/IP標準，世界各地的電腦等設備能夠鏈接到互聯網上，並互相訪問及共享資源</p><p>再者，我們大多人都是使用寬帶上網，結果發現，A 和 B 的局域網 IP 都是192.168.31.11,當他們都訪問百度瀏覽網頁時，百度服務器回覆數據時，如何區分是給 A 還是給 B 呢？</p><div class=pgc-img><img alt="一文了解，公網（外網）、私網（內網）的原理，so easy" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c7467801f76845048063fa6aeda62751><p class=pgc-img-caption></p></div><p>一、公有 IP 和私有 IP 的區別</p><p>首先，我們需要了解一下什麼是公有 IP 和私有 IP ？</p><p>公有地址（Public address）：由 Inter NIC（Internet Network Information Center 因特網信息中心）負責。這些 IP 地址分配給註冊並向Inter NIC提出申請的組織機構，公有 IP 全球唯一，通過它直接訪問因特網（直接能上網）。</p><p>私有地址（Private address）：屬於非註冊地址，專門為組織機構內部使用，說白了，私有 IP 不能直接上網。</p><p>而我們平時通過運營商（電信、移動、聯通寬帶等）上網，家裡面通過路由器分出來的 IP 都是私有 IP（局域網 IP），大家可能會疑問，我們可以上網啊，怎麼會是私有 IP 呢？</p><p>租用（申請）公有 IP 是需要錢的。 運營商買了一些公有 IP，然後通過這些公有 IP 分出來，再分給一個一個的用戶使用。這個過程有點類似於，我們去安裝了寬度，通過路由器分出幾個 IP，讓好幾個人都能上網，當然運營商通過公有 IP 分出來的過程肯定比這個複雜多了。所以，我們平時上網用的 IP 是私有 IP，真正擁有公有 IP 的是運營商（當然，我們可以租用一個公有 IP ）。所以，A 家庭的局域網 IP 和 B 家庭的局域網 IP 相同很正常，但是，最終 A 和 B 能上網（數據走出去）還是通過運營商的公有 IP，畢竟，公有 IP 的資源有限，這一片區域的用戶使用的很有可能（實際上就是這樣的）是同一個公有 IP，這樣的話，又回到前面的問題，假如 A 和 B 的局域網 IP 相同（192.168.31.11），當他們同時訪問百度服務器的時候，百度服務器如何區分哪個是 A，哪個是 B 呢？</p><div class=pgc-img><img alt="一文了解，公網（外網）、私網（內網）的原理，so easy" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e1b47e5d35c54c42b342bea4dd40a392><p class=pgc-img-caption></p></div><p>二、端口映射</p><p>1、方法一視角</p><p>接下來，給大家介紹一下什麼是端口映射？</p><p>端口映射是 NAT 的一種，它將外網主機的 IP 地址的一個端口映射到內網中一臺機器，提供相應的服務。當用戶訪問該 IP 的這個端口時，服務器自動將請求映射到對應局域網內部的機器上。</p><p>現在市場上的家庭路由器都具備 NAT 功能，也可以實現端口映射。下圖為小米路由器的端口映射設置圖：</p><div class=pgc-img><img alt="一文了解，公網（外網）、私網（內網）的原理，so easy" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2228c8f8e0554e9aa7c5aa887f8c7246><p class=pgc-img-caption></p></div><p>我們平時經過路由器，通過寬帶，最終去到運營商那邊，數據是從運營商出去，最終數據是回到運營商那邊，運營商再把數據發送到用戶的電腦。</p><p>路由器，至少有兩個端口：WAN 口和 LAN 口。</p><p>WAN：接外部 IP 地址用，通常指的是出口，轉發來自內部 LAN 接口的 IP 數據包，這個口的 IP 是唯一的。</p><p>LAN：接內部 IP 地址用，LAN 內部是交換機。</p><p>這裡，我們簡化這個過程，我們把運營商當做一個 NAT 設備。</p><div class=pgc-img><img alt="一文了解，公網（外網）、私網（內網）的原理，so easy" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b36d512349cf40cda9ebf419419ea2c3><p class=pgc-img-caption></p></div><p>為了方便大家理解，我們把 IP 的轉化方向反過來分析（準確來說，公網轉局域網）。</p><p>A 電腦的 IP 是局域網 IP（192.168.31.11），這個 IP（192.168.31.11）是從路由器的 lan口分配的。</p><p>當我們上百度的時候，經過路由器的 wan口，進行相應的IP、端口轉化：192.168.31.11:80 -> 10.221.0.24:8080,所以，從 wan口出去的地址為：10.221.0.24:8080。</p><div class=pgc-img><img alt="一文了解，公網（外網）、私網（內網）的原理，so easy" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/01d4bc426e8f4e08a749c699290f54e4><p class=pgc-img-caption></p></div><p>最後，經過運營商，運營商那邊會做相應的端口映射（而且是動態端口映射），子網 IP（10.221.0.24:8080）轉化為公網 IP（128.0.0.1:8888），通過這個公網 IP 去訪問百度服務器。</p><div class=pgc-img><img alt="一文了解，公網（外網）、私網（內網）的原理，so easy" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a82853514195462cb4acadb4241cb4db><p class=pgc-img-caption></p></div><p>同理，B 的過程也是一樣。通過這樣的層層端口映射，最終保證地址（IP + 端口）的唯一性。A 和 B 訪問百度服務器，儘管它們的局域網 IP 是一樣的，但是最終它們訪問百度的地址（IP + 端口）是唯一的，所以，百度服務器回覆時，原路返回時能夠區分到底給誰回。</p><p>2、方法二視角</p><p>一對一的基本NAT地址轉換原理：</p><div class=pgc-img><img alt="一文了解，公網（外網）、私網（內網）的原理，so easy" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/36e72efa80504f578e7a9be8a939e2dc><p class=pgc-img-caption></p></div><p>內部網絡的地址是192.168.0.0網段，而對外的公有網絡IP地址是203.196.3.23。內部網絡財務部主機192.168.8.88訪問外部網絡新浪網(IP222.76.214.60)，主機192.168.8.88發出一個數據報文，隨機選擇一個源端口4396，目的端口為80。在經過NAT設備後，該報文的源地址和端口可能改為203.196.3.23:32814，目的地址與端口不改變。在NAT設備中維護著一張地址和端口對應轉換表，當外部網絡的新浪網服務器返回數據包時，NAT設備檢查轉換表，將數據報文中目的IP地址及端口轉化為192.168.8.88:4396。</p><p>這個交換的過程，實現了內部主機訪問外部服務器，這樣只要少量的公網IP地址就可以實現內網多臺主機訪問外部網絡的過程，當然有些朋友注意到了，外網服務器由始至終都不知道是內網裡哪臺主機訪問了它。地址轉換NAT的有點在於，在為內部主機提供"隱私"保護的前提下，實現了內部網絡的主機通過該功能訪問外部網絡資源的目的。</p><p>同理，如果NAT Router後面是若干臺服務器，外部網絡的訪問者Client只需通過公網IP地址訪問，不知道服務器內網IP和開放端口是什麼，提高安全性。</p><p>多對一的NAT地址轉換(NAPT)原理</p><div class=pgc-img><img alt="一文了解，公網（外網）、私網（內網）的原理，so easy" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2f3058fc7d414c2bbe161460822f6098><p class=pgc-img-caption></p></div><p>當內部網絡的多臺主機併發地要求訪問外部網絡時，則一對一地址轉換肯定滿足不了要求。這是就要用到NAT的一種變形——NAPT網絡地址端口轉換，或地址複用。通過NAPT，一個合適的外部地址(203.196.3.23)就可以被多個內部用戶(財務部、技術部和業務部)併發地訪問外部網絡資源，只要使用這個外部地址(203.196.3.23)不同的端口就行。</p><p>三、如何讓外網能夠訪問自己寫的網絡程序（服務器）</p><p>首先，我們需要在運營商那邊申請（租用）一個公有 IP （長城寬帶一年需要 2000 元左右），假如這個公有 IP 為：128.0.0.123。</p><p>假如，我們寫的服務器如下：</p><div class=pgc-img><img alt="一文了解，公網（外網）、私網（內網）的原理，so easy" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/876faded7e304c8f8412544bc4ae9eab><p class=pgc-img-caption></p></div><p>接著，找個 NAT 設備進行相應的端口映射，家庭路由器都有這個功能。這裡以小米路由器為例：</p><div class=pgc-img><img alt="一文了解，公網（外網）、私網（內網）的原理，so easy" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1a4e55c928a3449aaf2db794284871a3><p class=pgc-img-caption></p></div><p>映射關係如下：</p><div class=pgc-img><img alt="一文了解，公網（外網）、私網（內網）的原理，so easy" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fcd4ca4a7dad4a91aff0b72f35c53960><p class=pgc-img-caption></p></div><p>最後，其他人寫客戶端程序時（電腦能上外網），只要指定目的 IP 地址為 128.0.0.123，端口為 8888，通過這個地址，就能找到192.168.31.248：8080，因為這兩者已經建立好映射，如上圖，這樣，我們的服務器就能收到數據。</p><p>總結NAT的作用有：</p><p>1.節約IP地址，內部網絡可以使用私有IP和外部網絡通信；</p><p>2.增強了內部網絡和外部網絡通信的靈活性。</p><p>3.隱藏內部網絡的細節，避免來自網絡外部的端口掃描等指向攻擊，可以起到一定的安全作用。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>公網</a></li><li><a>外網</a></li><li><a>私網</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/92398cfe.html alt=什麼是內網、公網和NAT？讀懂這一篇就夠！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9fbdb7afa9ae4b0fba8caa8617dd79a8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/92398cfe.html title=什麼是內網、公網和NAT？讀懂這一篇就夠！>什麼是內網、公網和NAT？讀懂這一篇就夠！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/237370a1.html alt=開玩笑，想在公網建立自己的局域網？有蒲公英X1旁路路由就行 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/7fa9e357a3b8414aa8144f4bd11736f2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/237370a1.html title=開玩笑，想在公網建立自己的局域網？有蒲公英X1旁路路由就行>開玩笑，想在公網建立自己的局域網？有蒲公英X1旁路路由就行</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/d68f635c.html alt=“超萌老爹”外網破圈，61歲陪女兒學街舞，網友：趕緊C位出道 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/450b08123e404a8c8d7be9da13bd1adb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/d68f635c.html title=“超萌老爹”外網破圈，61歲陪女兒學街舞，網友：趕緊C位出道>“超萌老爹”外網破圈，61歲陪女兒學街舞，網友：趕緊C位出道</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/d774c535.html alt=如何阻止外網攻擊公司局域網 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/370dc35aff3b413084b302eaa6ca3403 style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/d774c535.html title=如何阻止外網攻擊公司局域網>如何阻止外網攻擊公司局域網</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dfeb7c5.html alt=如何禁止外網訪問公司內網服務器？ACL配置立馬解決 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/09dc0542ea0a4ea78010b5ed2e201e03 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dfeb7c5.html title=如何禁止外網訪問公司內網服務器？ACL配置立馬解決>如何禁止外網訪問公司內網服務器？ACL配置立馬解決</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e2e1d8f.html alt=好看的字體太少？外網蒐集5萬設計師，在用的超火字體庫打包給你 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/43dbfa3b832047088a74a310a72e05d7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e2e1d8f.html title=好看的字體太少？外網蒐集5萬設計師，在用的超火字體庫打包給你>好看的字體太少？外網蒐集5萬設計師，在用的超火字體庫打包給你</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a5de836.html alt=我爬了3個月外網，總算找到100款硬核字體，極具設計感 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a260075a88844998af01a4b7b6defb41 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a5de836.html title=我爬了3個月外網，總算找到100款硬核字體，極具設計感>我爬了3個月外網，總算找到100款硬核字體，極具設計感</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>