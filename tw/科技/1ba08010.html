<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>巨杉Tech | SequoiaDB數據域及存儲規劃 | 极客快訊</title><meta property="og:title" content="巨杉Tech | SequoiaDB數據域及存儲規劃 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/abe829f5094640daac5d712107f153c2"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1ba08010.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1ba08010.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/1ba08010.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1ba08010.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1ba08010.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/1ba08010.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/1ba08010.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1ba08010.html><meta property="article:published_time" content="2020-11-14T21:00:35+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:35+08:00"><meta name=Keywords content><meta name=description content="巨杉Tech | SequoiaDB數據域及存儲規劃"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/1ba08010.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>巨杉Tech | SequoiaDB數據域及存儲規劃</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>1 背景</p><p>近年來，企業的各項業務發展迅猛，客戶數目不斷增加，後臺服務系統壓力也越來越大，系統的各項硬件資源也變得非常緊張。因此，在技術風險可控的基礎上，希望引入大數據技術，利用大數據技術優化現有IT系統實現升級改造，搭建一個統一存儲和管理歷史、近線數據的服務平臺，同時能夠對外支持高併發、低延時的數據查詢服務，以提高IT系統的計算能力，降低IT系統的建設成本，優化IT系統的服務體系，為各個業務部門提供更加優質的IT服務。</p><p>這類服務平臺在整個IT系統架構中實質上是一個為核心業務系統減負的系統。SequoiaDB 巨杉數據庫支持海量分佈式數據存儲，並且支持垂直分區和水平分區，利用這些特性可以將歷史、近線數據存儲到 SequoiaDB 中，並能夠對外支持高併發、低延時的數據查詢服務。本文主要講解如何利用巨杉數據庫域的特性在歷史、近線數據應用場景下進行存儲規劃已滿足業務系統對性能、存儲、維護等方便的要求。</p><p>2 相關概念</p><p>多維度數據分區</p><p>SequoiaDB 支持水平和垂直方式分區。採用散列（hash）或範圍(range)水平分區是將數據分佈至多個節點，加大數據吞吐量， 加速數據查詢和寫入；採用範圍（range）垂直分區是在一個節點內將數據邏輯劃分為多個區間，每個區間作為獨立的存儲單元，減少查詢時網絡I/O， 進一步加速查詢。</p><p>水平分區</p><p>散列水平分區，原理是將選擇的分區鍵進行 hash 運算，根據 hash 值將數據分發至相應分區。範圍水平分區則是直接匹配分區鍵和所對應的範圍，存放到相應的分區。兩種分區方式各有適用的場景，和運行的業務息息相關。一般不建議採用範圍水平分區，除範圍分區鍵（如月）能保證數據均衡（如每月的數據量級一致）。如圖2-1所示。</p><div class=pgc-img><img alt="巨杉Tech | SequoiaDB數據域及存儲規劃" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/abe829f5094640daac5d712107f153c2><p class=pgc-img-caption></p></div><p>圖2-1. SequoiaDB 水平分區</p><p>垂直分區</p><p>垂直分區是指在一個節點內集合數據按某字段，分成成多個數據段。每個範圍代表一個垂直分區。數據查詢、寫入時自動分發至相應分區中。垂直分區極大減少硬盤數據訪問，降低網絡I/O，加速查詢。垂直分區共享資源（同一臺物理機），出發點在於將冷熱數據隔離，如圖2-2所示。</p><div class=pgc-img><img alt="巨杉Tech | SequoiaDB數據域及存儲規劃" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b205ef71463c40c59dee35c9f16bed92><p class=pgc-img-caption></p></div><p>圖2-2. SequoiaDB 垂直分區</p><p>複製組和域</p><p>分區組又被稱為複製組，一個複製組內可以包含一個或多個數據節點（或編目節點），節點之間的數據使用異步日誌複製機制，保持最終一致。</p><p>域（Domain）是由若干個複製組（ReplicaGroup）組成的邏輯單元。每個域都可以根據定義好的策略自動管理所屬數據，如數據切片和數據隔離等。</p><p>以3臺服務器為例，每臺服務器9塊磁盤。複製組的物理部署和域的邏輯組成如圖2-3所示：</p><div class=pgc-img><img alt="巨杉Tech | SequoiaDB數據域及存儲規劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/23fd39434042415183103ddb16694ff4><p class=pgc-img-caption></p></div><p>採用3副本，按磁盤部署數據節點，每臺機器部署9個數據節點，3臺機器橫向組成數據組，共9個數據組。如圖域1包括數據組1-3，域2包括數據組5-9，域3包括數據組1-6，因此域在邏輯上由數據組組成，並且組成的數據組可以重疊。</p><p>3 業務場景</p><p>隨著用戶的增加、業務的發展，大型企業用戶的業務系統的數據量越來越大，而且原有系統絕大部分基於關係型數據構建，表結構複雜，每個查詢都需要關聯若干張大數據表，導致關聯查詢的性能非常低。</p><p>因此可以利用 SequoiaDB 存儲海量歷史、近線數據並開發數據查詢統一入口，按照數據生命週期管理的規則對歷史、近線數據進行統一在線存儲。另外平臺提供高併發、實時查詢服務，解決了關係型數據庫海量數據關聯查詢性能慢的問題。</p><p>根據業務系統歷史、近線數據的需求，建立歷史、近線數據存儲區用於存儲從源系統直接導入的原始數據，包括超出生產系統保存期限的數據以及需要按時點備份的數據。同時為提供在線、中高併發，小結果集的數據處理能力，可根據源系統不同劃分多個存儲區域，集群內部使用劃分數據域的方式進行分類管理。</p><p>4 數據域劃分方式</p><p>在業務系統通過接入平臺將結構化數據接入到巨杉數據庫時，需根據數據調研信息對業務系統進行分類，以確定業務系統的存儲量、併發大小、數據生命週期等，為結構化數據在巨杉數據庫中的存儲規劃提供信息支撐。業務系統結構化數據存儲到巨杉數據庫可利用數據域技術對業務系統的數據區域進行功能劃分，具體劃分方式如下：</p><p>海量數據或者高併發查詢業務系統</p><p>這類業務系統的特點是業務查詢併發較大，數據所佔存儲空間較大，對cpu、內存、網絡要求較高，利用域對這類系統進行隔離，可以使數據在寫入、讀取時充分利用集群中域所在機器的物理資源以提升性能。</p><p>數據量較小或者查詢併發數較小的業務系統</p><p>這類業務系統一般對cpu、內存、網絡要求較低，所佔存儲空間較小。因此這類系統可以和其他併發、所佔存儲較小的業務系統的數據域共享數據組以節省機器資源。</p><p>5 利用數據域水平擴展集群</p><p>目前，企業的部分業務系統結構化數據年增長量較大並且數據越來越多。在業務系統投產後，隨著業務量的增加集群可使用容量逐漸變小，因此在業務系統接入集群前需考慮存儲容量耗盡後整個集群的水平擴展。SequoiaDB 是分佈式數據庫，因此可以通過集群的擴容實現集群性能的近線性增長。而通過擴容後主要解決兩個問題是數據存儲的容量問題和整個集群的性能問題。因為數據量的不斷增長及上線後的推廣使用，所以需要進行擴容來提升集群性能及增加數據存儲空間。</p><p>SequoiaDB 在集群的管理上定義了數據域概念，一個數據域可以將多個數據組包含進來。一個集群可以根據不同的業務系統來劃分不同的數據域，不僅實現將不同業務系統數據在物理層面的隔離存儲，同時也實現了不同業務系統數據的統一調度管理，而且以後的集群擴容也可以根據域的使用需求而只針對此域進行集群擴容。</p><p>所以在進行擴容時，我們需要結合 SequoiaDB 數據域和業務系統需求進行擴容規劃及實施。結構化數據在擴容時，可針對結構化數據所在數據域增加數據組再進行數據均衡切分到新擴容的機器上；或者使子表分散在單獨的集合空間中，並使子表對應的集合空間所屬數據組在新擴容機器的數據組上。</p><p>6 具體案例</p><p>某大型金融用戶的某系統歷史數據量60T，每天有80G左右的增量數據。假設按照3年數據總量做存儲規劃，則三年數據佔總存儲約為(60+80G<em>365/1024)</em>3=266T。</p><p>假設現在客戶提供的硬件配置信息如下：</p><div class=pgc-img><img alt="巨杉Tech | SequoiaDB數據域及存儲規劃" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/90454cf7055d4c9283c9425f1d6bb56a><p class=pgc-img-caption></p></div><p>具體安裝部署如圖6-1所示：</p><div class=pgc-img><img alt="巨杉Tech | SequoiaDB數據域及存儲規劃" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/ab38b54cf99240a9ae2ffe05390ecc74><p class=pgc-img-caption></p></div><p>圖6-1</p><p>存儲規則</p><p>根據上述業務系統的信息，可將這類系統劃分為高併發海量存儲業務場景。結合數據域劃分方式以及未來擴容需求，該業務系統的結構化數據存儲在接入時數據域劃分規則如下：</p><p>1、 海量數據高併發查詢業務系統使用獨立的域進行存儲；</p><p>2、 使用主子表按照時間切分，每個子表按照ID散列分佈到域所對應的所有機器上；</p><p>3、 海量數據高併發查詢業務系統子表單獨使用集合空間；</p><p>4、 數據量較小或者併發查詢較小的業務系統可以共用域；</p><p>5、 結構化域擴容可使用增加數據組再進行數據均衡切分到新擴容的機器上，或者使子表分散在單獨的集合空間中，並使子表對應的集合空間所屬數據組在新擴容機器的數據組上。</p><p>集合空間和集合設計</p><p>根據上述存儲規則，該業務場景下的結構化數據和非結構化數據存儲方式如下：</p><p>使用主子表按照時間切分，每個子表按照ID或者業務字段散列分佈，子表跨度按月進行切分，並且子表分散在單獨的集合空間中。</p><p>7 總結</p><p>數據域在邏輯上由一個或多個數據組組成，在物理上對應具體的數據節點，並且不同的域之間可以重疊數據組。因此，業務系統可以根據主子表特性以及域包含數據組的靈活性將集群劃分為不同的區域存儲結構化數據，充分利用集群的計算、存儲資源。巨杉數據庫，支持海量數據存儲，SequoiaDB 支持垂直分區和水平分區，提供高併發、低延時數據查詢服務。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Tech</a></li><li><a>SequoiaDB</a></li><li><a>數據域</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E5%AD%B8/e3058a48.html alt="CST Tech Tips - WB 實驗設計：選擇陽性對照" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e9f1bc07b25a405a87755d4b3ea6dfc5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/e3058a48.html title="CST Tech Tips - WB 實驗設計：選擇陽性對照">CST Tech Tips - WB 實驗設計：選擇陽性對照</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/1c27ea49.html alt="CST Tech Tips--如何在IHC實驗中加入細胞沉澱物對照？" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/53edc984f3c944e89354ed0a99b17abc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/1c27ea49.html title="CST Tech Tips--如何在IHC實驗中加入細胞沉澱物對照？">CST Tech Tips--如何在IHC實驗中加入細胞沉澱物對照？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/079c3d12.html alt=2020情人節Tech禮物指南 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/0c78d5262db948b88d4dcccc3704314c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/079c3d12.html title=2020情人節Tech禮物指南>2020情人節Tech禮物指南</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3d191ad.html alt=V-Tech加持“冰水同框”，美的冰箱“微晶現象”引領行業保鮮口感時代 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RLslF1l7y2eZcD style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3d191ad.html title=V-Tech加持“冰水同框”，美的冰箱“微晶現象”引領行業保鮮口感時代>V-Tech加持“冰水同框”，美的冰箱“微晶現象”引領行業保鮮口感時代</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2c52343.html alt=汽車鋁合金智能ELMA-Tech電阻點焊技術解決方案 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1bd2d6f089b84b1aa03d62d835383567 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2c52343.html title=汽車鋁合金智能ELMA-Tech電阻點焊技術解決方案>汽車鋁合金智能ELMA-Tech電阻點焊技術解決方案</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>