<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ä¸€èµ·ä¾†è«‡è«‡ThreadLocal åŸç†å§ï¼ä½ éœ€è¦äº†è§£ï¼ | æå®¢å¿«è¨Š</title><meta property="og:title" content="ä¸€èµ·ä¾†è«‡è«‡ThreadLocal åŸç†å§ï¼ä½ éœ€è¦äº†è§£ï¼ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/499a403f2b63464db8e3e12298c1a3e5"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1c9afde0.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1c9afde0.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/1c9afde0.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1c9afde0.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1c9afde0.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/1c9afde0.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/1c9afde0.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1c9afde0.html><meta property="article:published_time" content="2020-11-14T21:07:43+08:00"><meta property="article:modified_time" content="2020-11-14T21:07:43+08:00"><meta name=Keywords content><meta name=description content="ä¸€èµ·ä¾†è«‡è«‡ThreadLocal åŸç†å§ï¼ä½ éœ€è¦äº†è§£ï¼"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/1c9afde0.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ä¸€èµ·ä¾†è«‡è«‡ThreadLocal åŸç†å§ï¼ä½ éœ€è¦äº†è§£ï¼</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p><strong>æˆ‘å€‘éƒ½çŸ¥é“ç•¶å¤šç·šç¨‹è¨ªå•å…±äº«å¯è®Šæ•¸æ“šæ™‚ï¼Œæ¶‰åŠåˆ°ç·šç¨‹é–“åŒæ­¥çš„å•é¡Œï¼Œä¸¦ä¸æ˜¯æ‰€æœ‰æ™‚å€™ï¼Œéƒ½è¦ç”¨åˆ°å…±äº«æ•¸æ“šï¼Œæ‰€ä»¥å°±éœ€è¦ç·šç¨‹å°é–‰å‡ºå ´äº†ã€‚</strong></p><p>æ•¸æ“šéƒ½è¢«å°é–‰åœ¨å„è‡ªçš„ç·šç¨‹ä¹‹ä¸­ï¼Œå°±ä¸éœ€è¦åŒæ­¥ï¼Œé€™ç¨®é€šéå°‡æ•¸æ“šå°é–‰åœ¨ç·šç¨‹ä¸­è€Œé¿å…ä½¿ç”¨åŒæ­¥çš„æŠ€è¡“ç¨±ç‚º<strong>ã€Œç·šç¨‹å°é–‰ã€</strong>ã€‚</p><p>æœ¬æ–‡ä¸»è¦ä»‹ç´¹ç·šç¨‹å°é–‰ä¸­çš„å…¶ä¸­ä¸€ç¨®é«”ç¾ï¼šThreadLocalï¼Œå°‡æœƒä»‹ç´¹ä»€éº¼æ˜¯ ThreadLocalï¼›å¾ ThreadLocal æºç¢¼è§’åº¦åˆ†æï¼Œæœ€å¾Œä»‹ç´¹ ThreadLocal çš„æ‡‰ç”¨å ´æ™¯ã€‚</p><h2 class=pgc-h-arrow-right>ä»€éº¼æ˜¯ ThreadLocalï¼Ÿ</h2><p>ThreadLocal æ˜¯ Java è£¡ä¸€ç¨®ç‰¹æ®Šè®Šé‡ï¼Œå®ƒæ˜¯ä¸€å€‹ç·šç¨‹ç´šåˆ¥è®Šé‡ï¼Œæ¯å€‹ç·šç¨‹éƒ½æœ‰ä¸€å€‹ ThreadLocal å°±æ˜¯æ¯å€‹ç·šç¨‹éƒ½æ“æœ‰äº†è‡ªå·±ç¨ç«‹çš„ä¸€å€‹è®Šé‡ï¼Œç«¶æ…‹æ¢ä»¶è¢«å¾¹åº•æ¶ˆé™¤äº†ï¼Œåœ¨ä½µç™¼æ¨¡å¼ä¸‹æ˜¯çµ•å°å®‰å…¨çš„è®Šé‡ã€‚</p><p>å¯ä»¥é€šé ThreadLocal value = new ThreadLocal(); ä¾†ä½¿ç”¨ã€‚</p><p>æœƒè‡ªå‹•åœ¨æ¯ä¸€å€‹ç·šç¨‹ä¸Šå‰µå»ºä¸€å€‹ T çš„å‰¯æœ¬ï¼Œå‰¯æœ¬ä¹‹é–“å½¼æ­¤ç¨ç«‹ï¼Œäº’ä¸å½±éŸ¿ï¼Œå¯ä»¥ç”¨ ThreadLocal å­˜å„²ä¸€äº›åƒæ•¸ï¼Œä»¥ä¾¿åœ¨ç·šç¨‹ä¸­å¤šå€‹æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œç”¨ä»¥ä»£æ›¿æ–¹æ³•å‚³åƒçš„åšæ³•ã€‚</p><p>ä¸‹é¢é€šéä¾‹å­ä¾†äº†è§£ä¸‹ ThreadLocalï¼š</p><pre><code>public class ThreadLocalDemo {	/**	 * ThreadLocalè®Šé‡ï¼Œæ¯å€‹ç·šç¨‹éƒ½æœ‰ä¸€å€‹å‰¯æœ¬ï¼Œäº’ä¸å¹²æ“¾	 */	public static final ThreadLocal&lt;String&gt; THREAD_LOCAL = new ThreadLocal&lt;&gt;();	public static void main( String[] args ) throws Exception	{		new ThreadLocalDemo().threadLocalTest();	}	public void threadLocalTest() throws Exception	{		/* ä¸»ç·šç¨‹è¨­ç½®å€¼ */		THREAD_LOCAL.set( "wupx" );		String v = THREAD_LOCAL.get();		System.out.println( "Thread-0ç·šç¨‹åŸ·è¡Œä¹‹å‰ï¼Œ" + Thread.currentThread().getName() + "ç·šç¨‹å–åˆ°çš„å€¼ï¼š" + v );		new Thread( new Runnable()			    {				    @Override				    public void run()				    {					    String v = THREAD_LOCAL.get();					    System.out.println( Thread.currentThread().getName() + "ç·šç¨‹å–åˆ°çš„å€¼ï¼š" + v );		                            /* è¨­ç½® threadLocal */					    THREAD_LOCAL.set( "huxy" );					    v = THREAD_LOCAL.get();					    System.out.println( "é‡æ–°è¨­ç½®ä¹‹å¾Œï¼Œ" + Thread.currentThread().getName() + "ç·šç¨‹å–åˆ°çš„å€¼ç‚ºï¼š" + v );					    System.out.println( Thread.currentThread().getName() + "ç·šç¨‹åŸ·è¡ŒçµæŸ" );				    }			    } ).start();		/* ç­‰å¾…æ‰€æœ‰ç·šç¨‹åŸ·è¡ŒçµæŸ */		Thread.sleep( 3000L );		v = THREAD_LOCAL.get();		System.out.println( "Thread-0ç·šç¨‹åŸ·è¡Œä¹‹å¾Œï¼Œ" + Thread.currentThread().getName() + "ç·šç¨‹å–åˆ°çš„å€¼ï¼š" + v );	}}</code></pre><p>é¦–å…ˆé€šé static final å®šç¾©äº†ä¸€å€‹ THREAD_LOCAL è®Šé‡ï¼Œå…¶ä¸­ static æ˜¯ç‚ºäº†ç¢ºä¿å…¨å±€åªæœ‰ä¸€å€‹ä¿å­˜ String å°è±¡çš„ ThreadLocal å¯¦ä¾‹ï¼›final ç¢ºä¿ ThreadLocal çš„å¯¦ä¾‹ä¸å¯æ›´æ”¹ï¼Œé˜²æ­¢è¢«æ„å¤–æ”¹è®Šï¼Œå°è‡´æ”¾å…¥çš„å€¼å’Œå–å‡ºä¾†çš„ä¸ä¸€è‡´ï¼Œå¦å¤–é‚„èƒ½é˜²æ­¢ ThreadLocal çš„å…§å­˜æ´©æ¼ã€‚ä¸Šé¢çš„ä¾‹å­æ˜¯æ¼”ç¤ºåœ¨ä¸åŒçš„ç·šç¨‹ä¸­ç²å–å®ƒæœƒå¾—åˆ°ä¸åŒçš„çµæœï¼Œé‹è¡Œçµæœå¦‚ä¸‹ï¼š</p><pre><code>Thread-0ç·šç¨‹åŸ·è¡Œä¹‹å‰ï¼Œmainç·šç¨‹å–åˆ°çš„å€¼ï¼šwupxThread-0ç·šç¨‹å–åˆ°çš„å€¼ï¼šnullé‡æ–°è¨­ç½®ä¹‹å¾ŒThread-0ç·šç¨‹å–åˆ°çš„å€¼ç‚ºï¼šhuxyThread-0ç·šç¨‹åŸ·è¡ŒçµæŸThread-0ç·šç¨‹åŸ·è¡Œä¹‹å¾Œï¼Œmainç·šç¨‹å–åˆ°çš„å€¼ï¼šwupx</code></pre><p>é¦–å…ˆåœ¨ Thread-0 ç·šç¨‹åŸ·è¡Œä¹‹å‰ï¼Œå…ˆçµ¦ THREAD_LOCAL è¨­ç½®ç‚º wupxï¼Œç„¶å¾Œå¯ä»¥å–åˆ°é€™å€‹å€¼ï¼Œç„¶å¾Œé€šéå‰µå»ºä¸€å€‹æ–°çš„ç·šç¨‹ä»¥å¾Œå»å–é€™å€‹å€¼ï¼Œç™¼ç¾æ–°ç·šç¨‹å–åˆ°çš„ç‚º nullï¼Œæ„å¤–è‘—é€™å€‹è®Šé‡åœ¨ä¸åŒç·šç¨‹ä¸­å–åˆ°çš„å€¼æ˜¯ä¸åŒçš„ï¼Œä¸åŒç·šç¨‹ä¹‹é–“å°æ–¼ ThreadLocal æœƒæœ‰å°æ‡‰çš„å‰¯æœ¬ï¼Œæ¥è‘—åœ¨ç·šç¨‹ Thread-0 ä¸­åŸ·è¡Œå° THREAD_LOCAL çš„ä¿®æ”¹ï¼Œå°‡å€¼æ”¹ç‚º huxyï¼Œå¯ä»¥ç™¼ç¾ç·šç¨‹ Thread-0 ç²å–çš„å€¼è®Šç‚ºäº† huxyï¼Œä¸»ç·šç¨‹ä¾ç„¶æœƒè®€å–åˆ°å±¬æ–¼å®ƒçš„å‰¯æœ¬æ•¸æ“š wupxï¼Œé€™å°±æ˜¯ç·šç¨‹çš„å°é–‰ã€‚</p><p>çœ‹åˆ°é€™è£¡ï¼Œæˆ‘ç›¸ä¿¡å¤§å®¶ä¸€å®šæœƒå¥½å¥‡ ThreadLocal æ˜¯å¦‚ä½•åšåˆ°å¤šå€‹ç·šç¨‹å°åŒä¸€å°è±¡ set æ“ä½œï¼Œä½†æ˜¯ get ç²å–çš„å€¼é‚„éƒ½æ˜¯æ¯å€‹ç·šç¨‹ set çš„å€¼å‘¢ï¼Œæ¥ä¸‹ä¾†å°±è®“æˆ‘å€‘é€²å…¥æºç¢¼è§£æç’°ç¯€ï¼š</p><h2 class=pgc-h-arrow-right>ThreadLocal æºç¢¼è§£æ</h2><p>é¦–å…ˆçœ‹ä¸‹ ThreadLocal éƒ½æœ‰å“ªäº›é‡è¦å±¬æ€§ï¼š</p><pre><code>// ç•¶å‰ ThreadLocal çš„ hashCodeï¼Œç”± nextHashCode() è¨ˆç®—è€Œä¾†ï¼Œç”¨æ–¼è¨ˆç®—ç•¶å‰ ThreadLocal åœ¨ ThreadLocalMap ä¸­çš„ç´¢å¼•ä½ç½®private final int threadLocalHashCode = nextHashCode();// å“ˆå¸Œé­”æ•¸ï¼Œä¸»è¦èˆ‡æ–æ³¢é‚£å¥‘æ•£åˆ—æ³•ä»¥åŠé»ƒé‡‘åˆ†å‰²æœ‰é—œprivate static final int HASH_INCREMENT = 0x61c88647;// è¿”å›è¨ˆç®—å‡ºçš„ä¸‹ä¸€å€‹å“ˆå¸Œå€¼ï¼Œå…¶å€¼ç‚º i * HASH_INCREMENTï¼Œå…¶ä¸­ i ä»£è¡¨èª¿ç”¨æ¬¡æ•¸private static int nextHashCode() {    return nextHashCode.getAndAdd(HASH_INCREMENT);}// ä¿è­‰äº†åœ¨ä¸€è‡ºæ©Ÿå™¨ä¸­æ¯å€‹ ThreadLocal çš„ threadLocalHashCode æ˜¯å”¯ä¸€çš„private static AtomicInteger nextHashCode = new AtomicInteger();</code></pre><p>å…¶ä¸­çš„ HASH_INCREMENT ä¹Ÿä¸æ˜¯éš¨ä¾¿å–çš„ï¼Œå®ƒè½‰åŒ–ç‚ºåé€²åˆ¶æ˜¯ 1640531527ï¼Œ2654435769 è½‰æ›æˆ int é¡å‹å°±æ˜¯ -1640531527ï¼Œ2654435769 ç­‰æ–¼ (âˆš5-1)/2 ä¹˜ä»¥ 2 çš„ 32 æ¬¡æ–¹ã€‚(âˆš5-1)/2 å°±æ˜¯é»ƒé‡‘åˆ†å‰²æ•¸ï¼Œè¿‘ä¼¼ç‚º 0.618ï¼Œä¹Ÿå°±æ˜¯èªª 0x61c88647 ç†è§£ç‚ºä¸€å€‹é»ƒé‡‘åˆ†å‰²æ•¸ä¹˜ä»¥ 2 çš„ 32 æ¬¡æ–¹ï¼Œå®ƒå¯ä»¥ä¿è­‰ nextHashCode ç”Ÿæˆçš„å“ˆå¸Œå€¼ï¼Œå‡å‹»çš„åˆ†ä½ˆåœ¨ 2 çš„å†ªæ¬¡æ–¹ä¸Šï¼Œä¸”å°æ–¼ 2 çš„ 32 æ¬¡æ–¹ã€‚</p><p>ä¸‹é¢æ˜¯ javaspecialists ä¸­ä¸€ç¯‡æ–‡ç« å°å®ƒçš„ä»‹ç´¹ï¼š</p><blockquote class=article-blockquote><p>â</p><p>This number represents the golden ratio (sqrt(5)-1) times two to the power of 31 ((sqrt(5)-1) * (2^31)). The result is then a golden number, either 2654435769 or -1640531527.</p><p>â</p></blockquote><p>ä¸‹é¢ç”¨ä¾‹å­ä¾†è­‰æ˜ä¸‹ï¼š</p><pre><code>private static final int HASH_INCREMENT = 0x61c88647;public static void main(String[] args) throws Exception {    int n = 5;    int max = 2 &lt;&lt; (n - 1);    for (int i = 0; i &lt; max; i++) {        System.out.print(i * HASH_INCREMENT &amp; (max - 1));        System.out.print(" ");    }}</code></pre><p>é‹è¡Œçµæœç‚ºï¼š0 7 14 21 28 3 10 17 24 31 6 13 20 27 2 9 16 23 30 5 12 19 26 1 8 15 22 29 4 11 18 25</p><p>å¯ä»¥ç™¼ç¾å…ƒç´ ç´¢å¼•å€¼å®Œç¾çš„æ•£åˆ—åœ¨æ•¸çµ„ç•¶ä¸­ï¼Œä¸¦æ²’æœ‰å‡ºç¾è¡çªã€‚</p><h3 class=pgc-h-arrow-right>ThreadLocalMap</h3><p>é™¤äº†ä¸Šè¿°å±¬æ€§å¤–ï¼Œé‚„æœ‰ä¸€å€‹é‡è¦çš„å±¬æ€§ ThreadLocalMapï¼ŒThreadLocalMap æ˜¯ ThreadLocal çš„éœæ…‹å…§éƒ¨é¡ï¼Œç•¶ä¸€å€‹ç·šç¨‹æœ‰å¤šå€‹ ThreadLocal æ™‚ï¼Œéœ€è¦ä¸€å€‹å®¹å™¨ä¾†ç®¡ç†å¤šå€‹ ThreadLocalï¼ŒThreadLocalMap çš„ä½œç”¨å°±æ˜¯ç®¡ç†ç·šç¨‹ä¸­å¤šå€‹ ThreadLocalï¼Œæºç¢¼å¦‚ä¸‹ï¼š</p><pre><code>static class ThreadLocalMap {	/**	 * éµå€¼å°å¯¦é«”çš„å­˜å„²çµæ§‹	 */	static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; {		// ç•¶å‰ç·šç¨‹é—œè¯çš„ valueï¼Œé€™å€‹ value ä¸¦æ²’æœ‰ç”¨å¼±å¼•ç”¨è¿½è¹¤		Object value;		/**		 * æ§‹é€ éµå€¼å°		 *		 * @param k k ä½œ key,ä½œç‚º key çš„ ThreadLocal æœƒè¢«åŒ…è£ç‚ºä¸€å€‹å¼±å¼•ç”¨		 * @param v v ä½œ value		 */		Entry(ThreadLocal&lt;?&gt; k, Object v) {			super(k);			value = v;		}	}	// åˆå§‹å®¹é‡ï¼Œå¿…é ˆç‚º 2 çš„å†ª	private static final int INITIAL_CAPACITY = 16;	// å­˜å„² ThreadLocal çš„éµå€¼å°å¯¦é«”æ•¸çµ„ï¼Œé•·åº¦å¿…é ˆç‚º 2 çš„å†ª	private Entry[] table;	// ThreadLocalMap å…ƒç´ æ•¸é‡	private int size = 0;	// æ“´å®¹çš„é–¾å€¼ï¼Œé»˜èªæ˜¯æ•¸çµ„å¤§å°çš„ä¸‰åˆ†ä¹‹äºŒ	private int threshold;}</code></pre><p>å¾æºç¢¼ä¸­çœ‹åˆ° ThreadLocalMap å…¶å¯¦å°±æ˜¯ä¸€å€‹ç°¡å–®çš„ Map çµæ§‹ï¼Œåº•å±¤æ˜¯æ•¸çµ„ï¼Œæœ‰åˆå§‹åŒ–å¤§å°ï¼Œä¹Ÿæœ‰æ“´å®¹é–¾å€¼å¤§å°ï¼Œæ•¸çµ„çš„å…ƒç´ æ˜¯ Entryï¼Œ<strong>ã€ŒEntry çš„ key å°±æ˜¯ ThreadLocal çš„å¼•ç”¨ï¼Œvalue æ˜¯ ThreadLocal çš„å€¼ã€</strong>ã€‚ThreadLocalMap è§£æ±º hash è¡çªçš„æ–¹å¼æ¡ç”¨çš„æ˜¯<strong>ã€Œç·šæ€§æ¢æ¸¬æ³•ã€</strong>ï¼Œå¦‚æœç™¼ç”Ÿè¡çªæœƒç¹¼çºŒå°‹æ‰¾ä¸‹ä¸€å€‹ç©ºçš„ä½ç½®ã€‚</p><p>é€™æ¨£çš„å°±æœ‰å¯èƒ½æœƒç™¼ç”Ÿå…§å­˜æ´©æ¼çš„å•é¡Œï¼Œä¸‹é¢è®“æˆ‘å€‘é€²è¡Œåˆ†æï¼š</p><h3 class=pgc-h-arrow-right>ThreadLocal å…§å­˜æ´©æ¼</h3><p>ThreadLocal åœ¨æ²’æœ‰å¤–éƒ¨å¼·å¼•ç”¨æ™‚ï¼Œç™¼ç”Ÿ GC æ™‚æœƒè¢«å›æ”¶ï¼Œé‚£éº¼ ThreadLocalMap ä¸­ä¿å­˜çš„ key å€¼å°±è®Šæˆäº† nullï¼Œè€Œ Entry åˆè¢« threadLocalMap å°è±¡å¼•ç”¨ï¼ŒthreadLocalMap å°è±¡åˆè¢« Thread å°è±¡æ‰€å¼•ç”¨ï¼Œé‚£éº¼ç•¶ Thread ä¸€ç›´ä¸çµ‚çµçš„è©±ï¼Œvalue å°è±¡å°±æœƒä¸€ç›´å­˜åœ¨æ–¼å…§å­˜ä¸­ï¼Œä¹Ÿå°±å°è‡´äº†å…§å­˜æ´©æ¼ï¼Œç›´è‡³ Thread è¢«éŠ·ç‡¬å¾Œï¼Œæ‰æœƒè¢«å›æ”¶ã€‚</p><p>é‚£éº¼å¦‚ä½•é¿å…å…§å­˜æ´©æ¼å‘¢ï¼Ÿ</p><p>åœ¨ä½¿ç”¨å®Œ ThreadLocal è®Šé‡å¾Œï¼Œéœ€è¦æˆ‘å€‘æ‰‹å‹• remove æ‰ï¼Œé˜²æ­¢ ThreadLocalMap ä¸­ Entry ä¸€ç›´ä¿æŒå° value çš„å¼·å¼•ç”¨ï¼Œå°è‡´ value ä¸èƒ½è¢«å›æ”¶ï¼Œå…¶ä¸­ remove æºç¢¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>/** * æ¸…ç†ç•¶å‰ ThreadLocal å°è±¡é—œè¯çš„éµå€¼å° */public void remove() {	// è¿”å›ç•¶å‰ç·šç¨‹æŒæœ‰çš„ map	ThreadLocalMap m = getMap(Thread.currentThread());	if (m != null) {		// å¾ map ä¸­æ¸…ç†ç•¶å‰ ThreadLocal å°è±¡é—œè¯çš„éµå€¼å°		m.remove(this);	}}</code></pre><p>remove æ–¹æ³•çš„æ™‚åºåœ–å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class=pgc-img><img alt="ä¸€èµ·ä¾†è«‡è«‡ThreadLocal åŸç†å§ï¼ä½ éœ€è¦äº†è§£ï¼" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/499a403f2b63464db8e3e12298c1a3e5><p class=pgc-img-caption></p></div><p>remove æ–¹æ³•æ˜¯å…ˆç²å–åˆ°ç•¶å‰ç·šç¨‹çš„ ThreadLocalMapï¼Œä¸¦ä¸”èª¿ç”¨äº†å®ƒçš„ remove æ–¹æ³•ï¼Œå¾ map ä¸­æ¸…ç†ç•¶å‰ ThreadLocal å°è±¡é—œè¯çš„éµå€¼å°ï¼Œé€™æ¨£ value å°±å¯ä»¥è¢« GC å›æ”¶äº†ã€‚</p><p>é‚£éº¼ ThreadLocal æ˜¯å¦‚ä½•å¯¦ç¾ç·šç¨‹éš”é›¢çš„å‘¢ï¼Ÿ</p><h3 class=pgc-h-arrow-right>ThreadLocal çš„ set æ–¹æ³•</h3><p>æˆ‘å€‘å…ˆå»çœ‹ä¸‹ ThreadLocal çš„ set æ–¹æ³•ï¼Œæºç¢¼å¦‚ä¸‹ï¼š</p><pre><code>/** * ç‚ºç•¶å‰ ThreadLocal å°è±¡é—œè¯ value å€¼ * * @param value è¦å­˜å„²åœ¨æ­¤ç·šç¨‹çš„ç·šç¨‹å‰¯æœ¬çš„å€¼ */public void set(T value) {	// è¿”å›ç•¶å‰ThreadLocalæ‰€åœ¨çš„ç·šç¨‹	Thread t = Thread.currentThread();	// è¿”å›ç•¶å‰ç·šç¨‹æŒæœ‰çš„map	ThreadLocalMap map = getMap(t);	if (map != null) {		// å¦‚æœ ThreadLocalMap ä¸ç‚ºç©ºï¼Œå‰‡ç›´æ¥å­˜å„²&lt;ThreadLocal, T&gt;éµå€¼å°		map.set(this, value);	} else {		// å¦å‰‡ï¼Œéœ€è¦ç‚ºç•¶å‰ç·šç¨‹åˆå§‹åŒ– ThreadLocalMapï¼Œä¸¦å­˜å„²éµå€¼å° &lt;this, firstValue&gt;		createMap(t, value);	}}</code></pre><p>set æ–¹æ³•çš„ä½œç”¨æ˜¯æŠŠæˆ‘å€‘æƒ³è¦å­˜å„²çš„ value çµ¦ä¿å­˜é€²å»ã€‚set æ–¹æ³•çš„æµç¨‹ä¸»è¦æ˜¯ï¼š</p><ul><li>å…ˆç²å–åˆ°ç•¶å‰ç·šç¨‹çš„å¼•ç”¨</li><li>åˆ©ç”¨é€™å€‹å¼•ç”¨ä¾†ç²å–åˆ° ThreadLocalMap</li><li>å¦‚æœ map ç‚ºç©ºï¼Œå‰‡å»å‰µå»ºä¸€å€‹ ThreadLocalMap</li><li>å¦‚æœ map ä¸ç‚ºç©ºï¼Œå°±åˆ©ç”¨ ThreadLocalMap çš„ set æ–¹æ³•å°‡ value æ·»åŠ åˆ° map ä¸­</li></ul><p>set æ–¹æ³•çš„æ™‚åºåœ–å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class=pgc-img><img alt="ä¸€èµ·ä¾†è«‡è«‡ThreadLocal åŸç†å§ï¼ä½ éœ€è¦äº†è§£ï¼" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/db077816974a47b284549ab35e1e4800><p class=pgc-img-caption></p></div><p>å…¶ä¸­ map å°±æ˜¯æˆ‘å€‘ä¸Šé¢è¬›åˆ°çš„ ThreadLocalMapï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ˜¯é€šéç•¶å‰ç·šç¨‹å°è±¡ç²å–åˆ°çš„ ThreadLocalMapï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘çœ‹ getMapæ–¹æ³•çš„æºä»£ç¢¼ï¼š</p><pre><code>/** * è¿”å›ç•¶å‰ç·šç¨‹ thread æŒæœ‰çš„ ThreadLocalMap * * @param t ç•¶å‰ç·šç¨‹ * @return ThreadLocalMap */ThreadLocalMap getMap(Thread t) {	return t.threadLocals;}</code></pre><p>getMap æ–¹æ³•çš„ä½œç”¨ä¸»è¦æ˜¯ç²å–ç•¶å‰ç·šç¨‹å…§çš„ ThreadLocalMap å°è±¡ï¼ŒåŸä¾†é€™å€‹ ThreadLocalMap æ˜¯ç·šç¨‹çš„ä¸€å€‹å±¬æ€§ï¼Œä¸‹é¢è®“æˆ‘å€‘çœ‹çœ‹ Thread ä¸­çš„ç›¸é—œä»£ç¢¼ï¼š</p><pre><code>/** * ThreadLocal çš„ ThreadLocalMap æ˜¯ç·šç¨‹çš„ä¸€å€‹å±¬æ€§ï¼Œæ‰€ä»¥åœ¨å¤šç·šç¨‹ç’°å¢ƒä¸‹ threadLocals æ˜¯ç·šç¨‹å®‰å…¨çš„ */ThreadLocal.ThreadLocalMap threadLocals = null;</code></pre><p>å¯ä»¥çœ‹å‡ºæ¯å€‹ç·šç¨‹éƒ½æœ‰ ThreadLocalMap å°è±¡ï¼Œè¢«å‘½åç‚º threadLocalsï¼Œé»˜èªç‚º nullï¼Œæ‰€ä»¥æ¯å€‹ç·šç¨‹çš„ ThreadLocals éƒ½æ˜¯éš”é›¢ç¨äº«çš„ã€‚</p><p>èª¿ç”¨ ThreadLocalMap.set() æ™‚ï¼ŒæœƒæŠŠç•¶å‰ threadLocal å°è±¡ä½œç‚º keyï¼Œæƒ³è¦ä¿å­˜çš„å°è±¡ä½œç‚º valueï¼Œå­˜å…¥ mapã€‚</p><p>å…¶ä¸­ ThreadLocalMap.set() çš„æºç¢¼å¦‚ä¸‹ï¼š</p><pre><code>/** * åœ¨ map ä¸­å­˜å„²éµå€¼å°&lt;key, value&gt; * * @param key   threadLocal * @param value è¦è¨­ç½®çš„ value å€¼ */private void set(ThreadLocal&lt;?&gt; key, Object value) {	Entry[] tab = table;	int len = tab.length;	// è¨ˆç®— key åœ¨æ•¸çµ„ä¸­çš„ä¸‹æ¨™	int i = key.threadLocalHashCode &amp; (len - 1);	// éæ­·ä¸€æ®µé€£çºŒçš„å…ƒç´ ï¼Œä»¥æŸ¥æ‰¾åŒ¹é…çš„ ThreadLocal å°è±¡	for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) {		// ç²å–è©²å“ˆå¸Œå€¼è™•çš„ThreadLocalå°è±¡		ThreadLocal&lt;?&gt; k = e.get();		// éµå€¼ThreadLocalåŒ¹é…ï¼Œç›´æ¥æ›´æ”¹mapä¸­çš„value		if (k == key) {			e.value = value;			return;		}		// è‹¥ key æ˜¯ nullï¼Œèªªæ˜ ThreadLocal è¢«æ¸…ç†äº†ï¼Œç›´æ¥æ›¿æ›æ‰		if (k == null) {			replaceStaleEntry(key, value, i);			return;		}	}	// ç›´åˆ°é‡è¦‹äº†ç©ºæ§½ä¹Ÿæ²’æ‰¾åˆ°åŒ¹é…çš„ThreadLocalå°è±¡ï¼Œé‚£éº¼åœ¨æ­¤ç©ºæ§½è™•å®‰æ’ThreadLocalå°è±¡å’Œç·©å­˜çš„value	tab[i] = new Entry(key, value);	int sz = ++size;	// å¦‚æœæ²’æœ‰å…ƒç´ è¢«æ¸…ç†ï¼Œé‚£éº¼å°±è¦æª¢æŸ¥ç•¶å‰å…ƒç´ æ•¸é‡æ˜¯å¦è¶…éäº†å®¹é‡é—•å€¼(æ•¸çµ„å¤§å°çš„ä¸‰åˆ†ä¹‹äºŒ)ï¼Œä»¥ä¾¿æ±ºå®šæ˜¯å¦æ“´å®¹	if (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold) {		// æ“´å®¹çš„éç¨‹ä¹Ÿæ˜¯å°æ‰€æœ‰çš„ key é‡æ–°å“ˆå¸Œçš„éç¨‹		rehash();	}}</code></pre><p>ç›¸ä¿¡åˆ°é€™è£¡ï¼Œå¤§å®¶æ‡‰è©²å° Threadã€ThreadLocal ä»¥åŠ ThreadLocalMap çš„é—œä¿‚æœ‰äº†é€²ä¸€æ­¥çš„ç†è§£ï¼Œä¸‹åœ–ç‚ºä¸‰è€…ä¹‹é–“çš„é—œä¿‚ï¼š</p><div class=pgc-img><img alt="ä¸€èµ·ä¾†è«‡è«‡ThreadLocal åŸç†å§ï¼ä½ éœ€è¦äº†è§£ï¼" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4131172641b649859790c628511d2240><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>ThreadLocal çš„ get æ–¹æ³•</h3><p>ç­è§£å®Œ set æ–¹æ³•å¾Œï¼Œè®“æˆ‘å€‘çœ‹ä¸‹ get æ–¹æ³•ï¼Œæºç¢¼å¦‚ä¸‹ï¼š</p><pre><code>/** * è¿”å›ç•¶å‰ ThreadLocal å°è±¡é—œè¯çš„å€¼ * * @return */public T get() {	// è¿”å›ç•¶å‰ ThreadLocal æ‰€åœ¨çš„ç·šç¨‹	Thread t = Thread.currentThread();	// å¾ç·šç¨‹ä¸­æ‹¿åˆ° ThreadLocalMap	ThreadLocalMap map = getMap(t);	if (map != null) {		// å¾ map ä¸­æ‹¿åˆ° entry		ThreadLocalMap.Entry e = map.getEntry(this);		// å¦‚æœä¸ç‚ºç©ºï¼Œè®€å–ç•¶å‰ ThreadLocal ä¸­ä¿å­˜çš„å€¼		if (e != null) {			@SuppressWarnings("unchecked")			T result = (T) e.value;			return result;		}	}	// è‹¥ map ç‚ºç©ºï¼Œå‰‡å°ç•¶å‰ç·šç¨‹çš„ ThreadLocal é€²è¡Œåˆå§‹åŒ–ï¼Œæœ€å¾Œè¿”å›ç•¶å‰çš„ ThreadLocal å°è±¡é—œè¯çš„åˆå€¼ï¼Œå³ value	return setInitialValue();}</code></pre><p>get æ–¹æ³•çš„ä¸»è¦æµç¨‹ç‚ºï¼š</p><ul><li>å…ˆç²å–åˆ°ç•¶å‰ç·šç¨‹çš„å¼•ç”¨</li><li>ç²å–ç•¶å‰ç·šç¨‹å…§éƒ¨çš„ ThreadLocalMap</li><li>å¦‚æœ map å­˜åœ¨ï¼Œå‰‡ç²å–ç•¶å‰ ThreadLocal å°æ‡‰çš„ value å€¼</li><li>å¦‚æœ map ä¸å­˜åœ¨æˆ–è€…æ‰¾ä¸åˆ° value å€¼ï¼Œå‰‡èª¿ç”¨ setInitialValue() é€²è¡Œåˆå§‹åŒ–</li></ul><p>get æ–¹æ³•çš„æ™‚åºåœ–å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class=pgc-img><img alt="ä¸€èµ·ä¾†è«‡è«‡ThreadLocal åŸç†å§ï¼ä½ éœ€è¦äº†è§£ï¼" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0106664e046945fea9d8491fedf8b509><p class=pgc-img-caption></p></div><p>å…¶ä¸­æ¯å€‹ Thread çš„ ThreadLocalMap ä»¥ threadLocal ä½œç‚º keyï¼Œä¿å­˜è‡ªå·±ç·šç¨‹çš„ value å‰¯æœ¬ï¼Œä¹Ÿå°±æ˜¯ä¿å­˜åœ¨æ¯å€‹ç·šç¨‹ä¸­ï¼Œä¸¦æ²’æœ‰ä¿å­˜åœ¨ ThreadLocal å°è±¡ä¸­ã€‚</p><p>å…¶ä¸­ ThreadLocalMap.getEntry() æ–¹æ³•çš„æºç¢¼å¦‚ä¸‹ï¼š</p><pre><code>/** * è¿”å› key é—œè¯çš„éµå€¼å°å¯¦é«” * * @param key threadLocal * @return */private Entry getEntry(ThreadLocal&lt;?&gt; key) {	int i = key.threadLocalHashCode &amp; (table.length - 1);	Entry e = table[i];	// è‹¥ e ä¸ç‚ºç©ºï¼Œä¸¦ä¸” e çš„ ThreadLocal çš„å…§å­˜åœ°å€å’Œ key ç›¸åŒï¼Œç›´æ¥è¿”å›	if (e != null &amp;&amp; e.get() == key) {		return e;	} else {		// å¾ i é–‹å§‹å‘å¾Œéæ­·æ‰¾åˆ°éµå€¼å°å¯¦é«”		return getEntryAfterMiss(key, i, e);	}}</code></pre><h3 class=pgc-h-arrow-right>ThreadLocalMap çš„ resize æ–¹æ³•</h3><p>ç•¶ ThreadLocalMap ä¸­çš„ ThreadLocal çš„å€‹æ•¸è¶…éå®¹é‡é–¾å€¼æ™‚ï¼ŒThreadLocalMap å°±è¦é–‹å§‹æ“´å®¹äº†ï¼Œæˆ‘å€‘ä¸€èµ·ä¾†çœ‹ä¸‹ resize çš„æºä»£ç¢¼ï¼š</p><pre><code>/** * æ“´å®¹ï¼Œé‡æ–°è¨ˆç®—ç´¢å¼•ï¼Œæ¨™è¨˜åƒåœ¾å€¼ï¼Œæ–¹ä¾¿ GC å›æ”¶ */private void resize() {	Entry[] oldTab = table;	int oldLen = oldTab.length;	int newLen = oldLen * 2;	// æ–°å»ºä¸€å€‹æ•¸çµ„ï¼ŒæŒ‰ç…§2å€é•·åº¦æ“´å®¹	Entry[] newTab = new Entry[newLen];	int count = 0;	// å°‡èˆŠæ•¸çµ„çš„å€¼æ‹·è²åˆ°æ–°æ•¸çµ„ä¸Š	for (int j = 0; j &lt; oldLen; ++j) {		Entry e = oldTab[j];		if (e != null) {			ThreadLocal&lt;?&gt; k = e.get();			// è‹¥æœ‰åƒåœ¾å€¼ï¼Œå‰‡æ¨™è¨˜æ¸…ç†è©²å…ƒç´ çš„å¼•ç”¨ï¼Œä»¥ä¾¿GCå›æ”¶			if (k == null) {				e.value = null;			} else {				// è¨ˆç®— ThreadLocal åœ¨æ–°æ•¸çµ„ä¸­çš„ä½ç½®				int h = k.threadLocalHashCode &amp; (newLen - 1);				// å¦‚æœç™¼ç”Ÿè¡çªï¼Œä½¿ç”¨ç·šæ€§æ¢æ¸¬å¾€å¾Œå°‹æ‰¾åˆé©çš„ä½ç½®				while (newTab[h] != null) {					h = nextIndex(h, newLen);				}				newTab[h] = e;				count++;			}		}	}	// è¨­ç½®æ–°çš„æ“´å®¹é–¾å€¼ï¼Œç‚ºæ•¸çµ„é•·åº¦çš„ä¸‰åˆ†ä¹‹äºŒ	setThreshold(newLen);	size = count;	table = newTab;}</code></pre><p>resize æ–¹æ³•ä¸»è¦æ˜¯é€²è¡Œæ“´å®¹ï¼ŒåŒæ™‚æœƒå°‡åƒåœ¾å€¼æ¨™è¨˜æ–¹ä¾¿ GC å›æ”¶ï¼Œæ“´å®¹å¾Œæ•¸çµ„å¤§å°æ˜¯åŸä¾†æ•¸çµ„çš„å…©å€ã€‚</p><h2 class=pgc-h-arrow-right>ThreadLocal æ‡‰ç”¨å ´æ™¯</h2><p>ThreadLocal çš„ç‰¹æ€§ä¹Ÿå°è‡´äº†æ‡‰ç”¨å ´æ™¯æ¯”è¼ƒå»£æ³›ï¼Œä¸»è¦çš„æ‡‰ç”¨å ´æ™¯å¦‚ä¸‹ï¼š</p><ul><li>ç·šç¨‹é–“æ•¸æ“šéš”é›¢ï¼Œå„ç·šç¨‹çš„ ThreadLocal äº’ä¸å½±éŸ¿</li><li>æ–¹ä¾¿åŒä¸€å€‹ç·šç¨‹ä½¿ç”¨æŸä¸€å°è±¡ï¼Œé¿å…ä¸å¿…è¦çš„åƒæ•¸å‚³é</li><li>å…¨éˆè·¯è¿½è¹¤ä¸­çš„ traceId æˆ–è€…æµç¨‹å¼•æ“ä¸­ä¸Šä¸‹æ–‡çš„å‚³éä¸€èˆ¬æ¡ç”¨ ThreadLocal</li><li>Spring äº‹å‹™ç®¡ç†å™¨æ¡ç”¨äº† ThreadLocal</li><li>Spring MVC çš„ RequestContextHolder çš„å¯¦ç¾ä½¿ç”¨äº† ThreadLocal</li></ul><h1 class=pgc-h-arrow-right>ç¸½çµ</h1><p>æœ¬æ–‡ä¸»è¦å¾æºç¢¼çš„è§’åº¦è§£æäº† ThreadLocalï¼Œä¸¦åˆ†æäº†ç™¼ç”Ÿå…§å­˜æ´©æ¼çš„åŸå› ï¼Œæœ€å¾Œå°å®ƒçš„æ‡‰ç”¨å ´æ™¯é€²è¡Œäº†ç°¡å–®ä»‹ç´¹ã€‚</p><p>æ­¡è¿ç•™è¨€äº¤æµè¨è«–ï¼ŒåŸå‰µä¸æ˜“ï¼Œè¦ºå¾—æ–‡ç« ä¸éŒ¯ï¼Œè«‹åœ¨çœ‹è½‰ç™¼æ”¯æŒä¸€ä¸‹ã€‚</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>è«‡è«‡</a></li><li><a>ThreadLocal</a></li><li><a>åŸç†</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/4adca96d.html alt=ä¸é½é‹¼æ—‹è½‰æ¨“æ¢¯â€”ä¸é½é‹¼æ—‹è½‰æ¨“æ¢¯çš„åŸç†å’Œå°ºå¯¸ä»‹ç´¹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1532917894689e20edadba9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4adca96d.html title=ä¸é½é‹¼æ—‹è½‰æ¨“æ¢¯â€”ä¸é½é‹¼æ—‹è½‰æ¨“æ¢¯çš„åŸç†å’Œå°ºå¯¸ä»‹ç´¹>ä¸é½é‹¼æ—‹è½‰æ¨“æ¢¯â€”ä¸é½é‹¼æ—‹è½‰æ¨“æ¢¯çš„åŸç†å’Œå°ºå¯¸ä»‹ç´¹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/798c35eb.html alt=é¼ æ¨™æ»¾è¼ªå·¥ä½œåŸç† class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a32f01002df34196a3ca95824a0705c9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/798c35eb.html title=é¼ æ¨™æ»¾è¼ªå·¥ä½œåŸç†>é¼ æ¨™æ»¾è¼ªå·¥ä½œåŸç†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0fe7a863.html alt=åœŸå£¤æ¡æ¨£å™¨çš„å·¥ä½œåŸç† class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/3591b04ce0ef4b24b7f04dcf6d4f0e5a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0fe7a863.html title=åœŸå£¤æ¡æ¨£å™¨çš„å·¥ä½œåŸç†>åœŸå£¤æ¡æ¨£å™¨çš„å·¥ä½œåŸç†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/382d9587.html alt=è«‡è«‡æˆ‘çš„å°å½©ç¥¨éš¨æ©Ÿäº‹ä»¶å°æ¦‚ç‡çš„çœ‹æ³• class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/64e0d9189e2a40128e7577bbadd25154 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/382d9587.html title=è«‡è«‡æˆ‘çš„å°å½©ç¥¨éš¨æ©Ÿäº‹ä»¶å°æ¦‚ç‡çš„çœ‹æ³•>è«‡è«‡æˆ‘çš„å°å½©ç¥¨éš¨æ©Ÿäº‹ä»¶å°æ¦‚ç‡çš„çœ‹æ³•</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/64d13873.html alt=æ–‡ç§‘ç„¡ç”¨è«–ï¼šè«‡è«‡è¿‘ä»£ä»¥ä¾†æ–‡ç§‘çš„è¡°è½ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/f1b9f3e9-2ccf-4782-9011-bbcf07d0905b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/64d13873.html title=æ–‡ç§‘ç„¡ç”¨è«–ï¼šè«‡è«‡è¿‘ä»£ä»¥ä¾†æ–‡ç§‘çš„è¡°è½>æ–‡ç§‘ç„¡ç”¨è«–ï¼šè«‡è«‡è¿‘ä»£ä»¥ä¾†æ–‡ç§‘çš„è¡°è½</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a915e749.html alt=å¤šç·šç¨‹ä¹‹ThreadLocalçš„é‚£äº›äº‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/58bb67505b204eef816b6e3b75935246 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a915e749.html title=å¤šç·šç¨‹ä¹‹ThreadLocalçš„é‚£äº›äº‹>å¤šç·šç¨‹ä¹‹ThreadLocalçš„é‚£äº›äº‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ef5bd4a5.html alt=å¾æºç¢¼è§’åº¦ä¾†å‰–æThreadLocalåˆ°åº•æœ‰æ²’æœ‰å…§å­˜æ´©æ¼ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/67412c6e1bba450b9581452ab0e56e4c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ef5bd4a5.html title=å¾æºç¢¼è§’åº¦ä¾†å‰–æThreadLocalåˆ°åº•æœ‰æ²’æœ‰å…§å­˜æ´©æ¼ï¼Ÿ>å¾æºç¢¼è§’åº¦ä¾†å‰–æThreadLocalåˆ°åº•æœ‰æ²’æœ‰å…§å­˜æ´©æ¼ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4bac2fc4.html alt=é€™4ç¨®ThreadLocalä½ éƒ½çŸ¥é“å—ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/02621283c0574fd79fbb6ff5ea971384 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4bac2fc4.html title=é€™4ç¨®ThreadLocalä½ éƒ½çŸ¥é“å—ï¼Ÿ>é€™4ç¨®ThreadLocalä½ éƒ½çŸ¥é“å—ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2eecc1b9.html alt=é¢è©¦å†å•ThreadLocalï¼Œåˆ¥èªªä½ ä¸æœƒ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3a95ff3cd79a456d9221f66851f8c2f9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2eecc1b9.html title=é¢è©¦å†å•ThreadLocalï¼Œåˆ¥èªªä½ ä¸æœƒ>é¢è©¦å†å•ThreadLocalï¼Œåˆ¥èªªä½ ä¸æœƒ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/203dfed4.html alt=å’Œéºµæ©Ÿçš„åŸç†åŠé‹ç”¨ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1bd01e6484624601ae66ef141b0cdbd7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/203dfed4.html title=å’Œéºµæ©Ÿçš„åŸç†åŠé‹ç”¨>å’Œéºµæ©Ÿçš„åŸç†åŠé‹ç”¨</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2537ec20.html alt=å’Œéºµæ©Ÿçš„å·¥ä½œåŸç† class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/01f3205782f045a2a5aec20d70b9efc8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2537ec20.html title=å’Œéºµæ©Ÿçš„å·¥ä½œåŸç†>å’Œéºµæ©Ÿçš„å·¥ä½œåŸç†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4ac331a0.html alt=åŠŸç‡å› ç´ è¡¨çš„å·¥ä½œåŸç†åŠæ¥ç·šæ–¹å¼ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/470a0003e8a9a1d2d829 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4ac331a0.html title=åŠŸç‡å› ç´ è¡¨çš„å·¥ä½œåŸç†åŠæ¥ç·šæ–¹å¼>åŠŸç‡å› ç´ è¡¨çš„å·¥ä½œåŸç†åŠæ¥ç·šæ–¹å¼</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/504d903f.html alt=ç–ŠåŠ åŸç†åŠå…¶æ‡‰ç”¨ï¼ˆç¬¬1é›†ï¼‰ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/504d903f.html title=ç–ŠåŠ åŸç†åŠå…¶æ‡‰ç”¨ï¼ˆç¬¬1é›†ï¼‰>ç–ŠåŠ åŸç†åŠå…¶æ‡‰ç”¨ï¼ˆç¬¬1é›†ï¼‰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b9eda782.html alt=è£½å†·åŸç†å’Œè£½å†·å¾ªç’°åŸç†ï¼Œè£½å†·åŠ‘åœ¨å¾ªç’°ä¸­ä»€éº¼ç‹€æ…‹ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/304eeaadf64047798a7c26b9d06a7987 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b9eda782.html title=è£½å†·åŸç†å’Œè£½å†·å¾ªç’°åŸç†ï¼Œè£½å†·åŠ‘åœ¨å¾ªç’°ä¸­ä»€éº¼ç‹€æ…‹ï¼Ÿ>è£½å†·åŸç†å’Œè£½å†·å¾ªç’°åŸç†ï¼Œè£½å†·åŠ‘åœ¨å¾ªç’°ä¸­ä»€éº¼ç‹€æ…‹ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/894f3dfe.html alt=è«‡è«‡æ¶²å£“æ²¹ç¼¸é˜²é½å’Œæ§åˆ¶æº«åº¦ã€é€Ÿåº¦çš„é‡è¦æ€§ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1c05777a41984cc29fcc7d8550c1c45e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/894f3dfe.html title=è«‡è«‡æ¶²å£“æ²¹ç¼¸é˜²é½å’Œæ§åˆ¶æº«åº¦ã€é€Ÿåº¦çš„é‡è¦æ€§>è«‡è«‡æ¶²å£“æ²¹ç¼¸é˜²é½å’Œæ§åˆ¶æº«åº¦ã€é€Ÿåº¦çš„é‡è¦æ€§</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>