<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>緩存的正確使用方式 | 极客快訊</title><meta property="og:title" content="緩存的正確使用方式 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/d55249e945b14abfaf4d2d6466b5715d"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1ef6874.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1ef6874.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/1ef6874.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1ef6874.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1ef6874.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/1ef6874.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/1ef6874.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/1ef6874.html><meta property="article:published_time" content="2020-10-29T20:52:48+08:00"><meta property="article:modified_time" content="2020-10-29T20:52:48+08:00"><meta name=Keywords content><meta name=description content="緩存的正確使用方式"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/1ef6874.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>緩存的正確使用方式</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div class=pgc-img><img alt=緩存的正確使用方式 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d55249e945b14abfaf4d2d6466b5715d><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>前言</strong></h1><p>開發中不同的業務場景有不同的緩存使用方式，如對於單機的、數據量不大的場景，用<strong class=highlight-text>HashMap</strong>就能實現一個簡單的緩存，也可以藉助<strong class=highlight-text>Guava cache</strong>等來實現。對於分佈式緩存，常用的如<strong class=highlight-text>Redis</strong>、<strong class=highlight-text>Tair</strong>。下面探討下平時在項目中特別是高併發場景下使用緩存時需要考慮的一些問題以及其應對的策略。</p><h1 class=pgc-h-arrow-right>緩存的使用</h1><h1 class=pgc-h-arrow-right>緩存模式</h1><ul><li>Cache Aside Pattern</li><li>Read/Write Through Pattern</li><li>Write Behind Caching Pattern</li></ul><h1 class=pgc-h-arrow-right><strong>Cache Aside Pattern</strong></h1><p>應用先去緩存中找數據，若命中緩存則直接返回。如果未命中緩存，則需要先去數據庫中查詢數據，並將查詢到的數據存儲到緩存中。在這種模式下，沒有單獨的緩存組件，緩存和DB的讀寫操作由應用方負責。</p><div class=pgc-img><img alt=緩存的正確使用方式 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2639844e60df43a8853102d789e710a9><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>先刪除緩存，再寫數據庫有什麼問題？</strong></h1><p>我們先來看一下場景:</p><div class=pgc-img><img alt=緩存的正確使用方式 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/aef1ba9b8d3143b48b6e1ef2cb5883b4><p class=pgc-img-caption></p></div><p>在請求A淘汰緩存後，這時候請求B查詢緩存，未命中，再查詢數據庫，此時請求尚未寫完成，請求B讀取的老數據，再將其寫入緩存中，緩存中的數據就會一直髒下去。</p><h1 class=pgc-h-arrow-right><strong>為什麼是刪除緩存，而不是更新緩存？</strong></h1><div class=pgc-img><img alt=緩存的正確使用方式 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9502f6323d094f2e9a6ee5a331fcea9a><p class=pgc-img-caption></p></div><p>寫請求B在請求A之前更新了緩存，這時候請求B再更新緩存，則會導致緩存中的數據就會一直髒下去。</p><blockquote><p>若緩存需要繁雜的計算才能得到，且寫操作頻繁，則會浪費大量的計算，可以通過請求來緩存數據，也符合數據懶加載。</p></blockquote><h1 class=pgc-h-arrow-right><strong>先更新數據，再刪除緩存，同樣存在數據不一致，只是概率相對小很多</strong></h1><div class=pgc-img><img alt=緩存的正確使用方式 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f6ce308d6427489fa6fc39c252ce23b4><p class=pgc-img-caption></p></div><blockquote><p>若讀請求B在寫請求A寫數據成功之前讀取數據庫中的數據，同時更新了緩存中的數據，緩存中的數據會一直髒下去。</p></blockquote><p>由於寫數據庫和更新緩存是兩個獨立的操作，很難保證數據一致性，通常是儘量降低不一致的概率。</p><h1 class=pgc-h-arrow-right><strong>Read/Write Through Pattern</strong></h1><p><strong class=highlight-text>Cache Aside Pattern</strong>是由應用程序來更新緩存中的數據，導致應用方數據庫和緩存的維護設計侵入代碼，數據層的耦合增大，而<strong class=highlight-text>Read/Write Through Pattern</strong>則是通過緩存自身來更新數據，調用方直接和緩存管理組件打交道，避免應用和數據庫之間的直接連接。</p><h1 class=pgc-h-arrow-right><strong>Read Through</strong></h1><p>應用向緩存管理組件發送查詢請求，由緩存管理組件查詢緩存，若緩存未命中，查詢數據庫，並將查詢的數據寫入緩存，並返回給應用。</p><div class=pgc-img><img alt=緩存的正確使用方式 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/19e4820d306641c9b53f8e221bf2bcce><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>Write Through</strong></h1><p><strong class=highlight-text>Write Through</strong>套路和<strong class=highlight-text>Read Through</strong>相仿，當更新數據的時候，將請求發送給緩存管理組件，由緩存管理組件同步更數據庫和緩存數據。</p><div class=pgc-img><img alt=緩存的正確使用方式 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/398d8329ff154dc8854514c35efd7558><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>Write Behind Caching Pattern</h1><p><strong class=highlight-text>Write Behind</strong>模式和<strong class=highlight-text>Write Through</strong>模式非常相似，不同點在於<strong class=highlight-text>Write through</strong>將數據更新到數據庫中是同步的方式，而<strong class=highlight-text>Write Behind</strong>是通過異步方式。</p><div class=pgc-img><img alt=緩存的正確使用方式 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/577f24e1273d4c5b8352a255ddaf3768><p class=pgc-img-caption></p></div><p>請求直接將數據寫入緩存，並沒有更新到數據庫。而通過定時或者一定閾值的方式，將數據異步的同步到數據庫中。這種方式優勢在於有效減少了更新數據的頻率，讀寫響應非常快，吞吐量也會有明顯的提升。</p><blockquote><p>由於數據操作不是強一致性的，而此時數據存放在緩存中，如果緩存在同步到數據庫的過程中宕機了，則這部分數據就會有丟失的風險。</p></blockquote><h1 class=pgc-h-arrow-right><strong>總結</strong></h1><p><strong class=highlight-text>Cache Aside</strong> 使用簡單，但需要使用方維護數據庫數據和緩存的更新</p><p><strong class=highlight-text>Read/Write Through</strong> 引入了緩存組件來統一管理緩存和數據庫，對於使用方來說是透明的，無代碼侵入，但相對於Cache Aside實現會負責一些</p><p><strong class=highlight-text>Write Behind Caching</strong> 數據的讀寫直接通過緩存，性能最好，在高併發場景下可以降低數據庫的壓力，通過定時或閾值的方式刷新到數據庫中，但是存在宕機丟失數據的風險。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>緩存</a></li><li><a>正確</a></li><li><a>方式</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/a50e3bab.html alt=揉揉耳朵可以防病保健康？教你正確按揉方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/80a60006b9ce9dc4686e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a50e3bab.html title=揉揉耳朵可以防病保健康？教你正確按揉方法>揉揉耳朵可以防病保健康？教你正確按揉方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a6a1aa5c.html alt=腹肌輪的正確用法，幫你練腹肌 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f6e41f0952784d6dbca16297383a3cc7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a6a1aa5c.html title=腹肌輪的正確用法，幫你練腹肌>腹肌輪的正確用法，幫你練腹肌</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7ce12767.html alt=如何正確利用杆底的彈性角？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/403a00004d9132c02145 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7ce12767.html title=如何正確利用杆底的彈性角？>如何正確利用杆底的彈性角？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b96b5bf9.html alt=如何正確認識Java多態 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d2896b2f39694d39957b901a62cfe7fb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b96b5bf9.html title=如何正確認識Java多態>如何正確認識Java多態</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eccb2e83.html alt=如何正確賣出股票 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eccb2e83.html title=如何正確賣出股票>如何正確賣出股票</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/aad0ebdb.html alt=如何正確賣出股票？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/01a2a013-f9b1-4526-9ae1-116444959bf1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/aad0ebdb.html title=如何正確賣出股票？>如何正確賣出股票？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4e10861a.html alt=四種正確的排線方式，送給正在自學素描的你 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/1532619425892d285117bdb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4e10861a.html title=四種正確的排線方式，送給正在自學素描的你>四種正確的排線方式，送給正在自學素描的你</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b214ae92.html alt=素描教程：素描排線的正確方法與握筆技巧 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15e66b4dc377448898cd4f57fd5a52e6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b214ae92.html title=素描教程：素描排線的正確方法與握筆技巧>素描教程：素描排線的正確方法與握筆技巧</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c091fa09.html alt=液壓油缸怎麼拆卸既快速又正確？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/efe77427ebe440cd8022a74450e1ff2d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c091fa09.html title=液壓油缸怎麼拆卸既快速又正確？>液壓油缸怎麼拆卸既快速又正確？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/116d816d.html alt=家長一定要告訴孩子正確的自我保護方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/07415fb8e30248fcb64ab3b43446471d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/116d816d.html title=家長一定要告訴孩子正確的自我保護方法>家長一定要告訴孩子正確的自我保護方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4a6b896b.html alt="自我保護很重要 正確洗手不可少" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/S0Nl2QrFRTZ1o9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4a6b896b.html title="自我保護很重要 正確洗手不可少">自我保護很重要 正確洗手不可少</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b9031018.html alt=這才是正確的Java正則表達式入門方式，要有代碼案例！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/a0539e711ea44df18f3e9923c851ebaf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b9031018.html title=這才是正確的Java正則表達式入門方式，要有代碼案例！>這才是正確的Java正則表達式入門方式，要有代碼案例！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4032bf21.html alt=如何正確保養汽車玻璃 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0d7a0d7def074ea7a0a4b5e1180a0309 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4032bf21.html title=如何正確保養汽車玻璃>如何正確保養汽車玻璃</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2340c059.html alt=C盤文件，你算什麼垃圾？（C盤的正確清理方式） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/fa99a511c6e1439abce3af5fcf26a1c1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2340c059.html title=C盤文件，你算什麼垃圾？（C盤的正確清理方式）>C盤文件，你算什麼垃圾？（C盤的正確清理方式）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e7fdb73b.html alt=正確認識跑步的疲勞「極點」現象，有助於小白跑者突破瓶頸 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/f20f262b-9f3a-42f4-bd0f-181b2d52bad8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e7fdb73b.html title=正確認識跑步的疲勞「極點」現象，有助於小白跑者突破瓶頸>正確認識跑步的疲勞「極點」現象，有助於小白跑者突破瓶頸</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>