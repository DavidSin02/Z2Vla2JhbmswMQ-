<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>如何設計實時數據平臺（技術篇） | 极客快訊</title><meta property="og:title" content="如何設計實時數據平臺（技術篇） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/3653b3c59fab441db784572a9c557afe"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2347cc9a.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2347cc9a.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2347cc9a.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2347cc9a.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2347cc9a.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2347cc9a.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2347cc9a.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2347cc9a.html><meta property="article:published_time" content="2020-11-14T21:00:57+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:57+08:00"><meta name=Keywords content><meta name=description content="如何設計實時數據平臺（技術篇）"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/2347cc9a.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>如何設計實時數據平臺（技術篇）</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>導讀：實時數據平臺（RTDP，Real-time Data Platform）是一個重要且常見的大數據基礎設施平臺。在上篇<a class=pgc-link data-content=mp href="https://www.toutiao.com/i6801266226736661003/?group_id=6801266226736661003?group_id=6801266226736661003" rel="noopener noreferrer" target=_blank>如何設計實時數據平臺（設計篇）</a>中，我們從現代數倉架構角度和典型數據處理角度介紹了RTDP，並探討了RTDP的整體設計架構。本文作為下篇（技術篇），則是從技術角度入手，介紹RTDP的技術選型和相關組件，探討適用不同應用場景的相關模式。RTDP的敏捷之路就此展開~</p><p>拓展閱讀：<a class=pgc-link data-content=mp href="https://www.toutiao.com/i6801266226736661003/?group_id=6801266226736661003?group_id=6801266226736661003" rel="noopener noreferrer" target=_blank>如何設計實時數據平臺（設計篇）</a></p><h1 class=pgc-h-arrow-right>一、技術選型介紹</h1><p>在設計篇中，我們給出了RTDP的一個整體架構設計（圖1）。在技術篇裡，我們則會推薦整體技術組件選型；對每個技術組件做出簡單介紹，尤其對我們抽象並實現的四個技術平臺（統一數據採集平臺、統一流式處理平臺、統一計算服務平臺、統一數據可視化平臺）著重介紹設計思路；對Pipeline端到端切面話題進行探討，包括功能整合、數據管理、數據安全等。</p><p><br></p><div class=pgc-img><img alt=如何設計實時數據平臺（技術篇） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3653b3c59fab441db784572a9c557afe><p class=pgc-img-caption></p></div><p>圖1 RTDP架構</p><h1 class=pgc-h-arrow-right>1.1 整體技術選型</h1><p><br></p><div class=pgc-img><img alt=如何設計實時數據平臺（技術篇） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7d8d2f2a3f0c446d816747329bec539f><p class=pgc-img-caption></p></div><p>圖2 整體技術選型</p><p>首先，我們簡要解讀一下圖2：</p><ul><li>數據源、客戶端，列舉了大多數數據應用項目的常用數據源類型。</li><li>數據總線平臺DBus，作為統一數據採集平臺，負責對接各種數據源。DBus將數據以增量或全量方式抽取出來，並進行一些常規數據處理，最後將處理後的消息發佈在Kafka上。</li><li>分佈式消息系統Kafka，以分佈式、高可用、高吞吐、可發佈-訂閱等能力，連接消息的生產者和消費者。</li><li>流式處理平臺Wormhole，作為統一流式處理平臺，負責流上處理和對接各種數據目標存儲。Wormhole從Kafka消費消息，支持流上配置SQL方式實現流上數據處理邏輯，並支持配置化方式將數據以最終一致性（冪等）效果落入不同數據目標存儲（Sink）中。</li><li>在數據計算存儲層，RTDP架構選擇開放技術組件選型，用戶可以根據實際數據特性、計算模式、訪問模式、數據量等信息選擇合適的存儲，解決具體數據項目問題。RTDP還支持同時選擇多個不同數據存儲，從而更靈活的支持不同項目需求。</li><li>計算服務平臺Moonbox，作為統一計算服務平臺，對異構數據存儲端負責整合、計算下推優化、異構數據存儲混算等（數據虛擬化技術），對數據展示和交互端負責收口統一元數據查詢、統一數據計算和下發、統一數據查詢語言（SQL）、統一數據服務接口等。</li><li>可視應用平臺Davinci，作為統一數據可視化平臺，以配置化方式支持各種數據可視化和交互需求，並可以整合其他數據應用以提供數據可視化部分需求解決方案，另外還支持不同數據從業人員在平臺上協作完成各項日常數據應用。其他數據終端消費系統如數據開發平臺Zeppelin、數據算法平臺Jupyter等在本文不做介紹。</li><li>切面話題如數據管理、數據安全、開發運維、驅動引擎，可以通過對接DBus、Wormhole、Moonbox、Davinci的服務接口進行整合和二次開發，以支持端到端管控和治理需求。</li></ul><p>下面我們會進一步細化上圖涉及到的技術組件和切面話題，介紹技術組件的功能特性，著重講解我們自研技術組件的設計思想，並對切面話題展開討論。</p><h1 class=pgc-h-arrow-right>1.2 技術組件介紹</h1><h1 class=pgc-h-arrow-right>1.2.1 數據總線平臺DBus</h1><p><br></p><div class=pgc-img><img alt=如何設計實時數據平臺（技術篇） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d99ba0e1f3dc4ed5a3fa596ea076ca67><p class=pgc-img-caption></p></div><p>圖3 RTDP架構之DBus</p><h1 class=pgc-h-arrow-right>1.2.1.1 DBus設計思想</h1><p>1）從外部角度看待設計思想</p><ul><li>負責對接不同的數據源，實時抽取出增量數據，對於數據庫會採用操作日誌抽取方式，對於日誌類型支持與多種Agent對接。</li><li>將所有消息以統一的UMS消息格式發佈在Kafka上，UMS是一種標準化的自帶元數據信息的JSON格式，通過統一UMS實現邏輯消息與物理Kafka Topic解耦，使得同一Topic可以流轉多個UMS消息表。</li><li>支持數據庫的全量數據拉取，並且和增量數據統一融合成UMS消息，對下游消費透明無感知。</li></ul><p>2）從內部角度看待設計思想</p><ul><li>基於Storm計算引擎進行數據格式化，確保消息端到端延遲最低。</li><li>對不同數據源數據進行標準化格式化，生成UMS信息，其中包括：</li></ul><p>生成每條消息的唯一單調遞增id，對應系統字段ums_id_</p><p>確認每條消息的事件時間戳（event timestamp），對應系統字段ums_ts_</p><p>確認每條消息的操作模式（增刪改，或insert only），對應系統字段ums_op_</p><ul><li>對數據庫表結構變更實時感知並採用版本號進行管理，確保下游消費時明確上游元數據變化。</li><li>在投放Kafka時確保消息強有序（非絕對有序）和at least once語義。</li><li>通過心跳錶機制確保消息端到端探活感知。</li></ul><h1 class=pgc-h-arrow-right>1.2.1.2 DBus功能特性</h1><ul><li>支持配置化全量數據拉取</li><li>支持配置化增量數據拉取</li><li>支持配置化在線格式化日誌</li><li>支持可視化監控預警</li><li>支持配置化多租戶安全管控</li><li>支持分表數據彙集成單邏輯表</li></ul><h1 class=pgc-h-arrow-right>1.2.1.3 DBus技術架構</h1><p><br></p><div class=pgc-img><img alt=如何設計實時數據平臺（技術篇） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/727adc07584c4c2abfc9cd77663bbdd5><p class=pgc-img-caption></p></div><p>圖4 DBus數據流轉架構圖</p><p>更多DBus技術細節和用戶界面，可以參看：</p><p>GitHub： https://github.com/BriData</p><h1 class=pgc-h-arrow-right>1.2.2 分佈式消息系統Kafka</h1><p>Kafka已經成為事實標準的大數據流式處理分佈式消息系統，當然Kafka在不斷的擴展和完善，現在也具備了一定的存儲能力和流式處理能力。關於Kafka本身的功能和技術已經有很多文章信息可以查閱，本文不再詳述Kafka的自身能力。</p><p>這裡我們具體探討Kafka上消息元數據管理（Metadata Management）和模式演變（Schema Evolution）的話題。</p><p><br></p><div class=pgc-img><img alt=如何設計實時數據平臺（技術篇） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4c5b0a9210634f049ecc8be7b4f40e53><p class=pgc-img-caption></p></div><p>圖5</p><blockquote><p>圖片來源：http://cloudurable.com/images/kafka-ecosystem-rest-proxy-schema-registry.png</p></blockquote><p>圖5顯示，在Kafka背後的Confluent公司解決方案中，引入了一個元數據管理組件：Schema Registry。這個組件主要負責管理在Kafka上流轉消息的 元數據信息和Topic信息，並提供一系列元數據管理服務。之所以要引入這樣一個組件，是為了Kafka的消費方能夠了解不同Topic上流轉的是哪些數據，以及數據的元數據信息，並進行有效的解析消費。</p><p>任何數據流轉鏈路，不管是在什麼系統上流轉，都會存在這段數據鏈路的元數據管理問題，Kafka也不例外。Schema Registry是一種中心化的Kafka數據鏈路元數據管理解決方案，並且基於Schema Registry，Confluent提供了相應的Kafka數據安全機制和模式演變機制。</p><blockquote><p>更多關於Schema Registry的介紹，可以參看：</p><p>Kafka Tutorial:Kafka, Avro Serialization and the Schema Registry</p><p>http://cloudurable.com/blog/kafka-avro-schema-registry/index.html</p></blockquote><p>那麼在RTDP架構中，如何解決Kafka消息元數據管理和模式演變問題呢？</p><h1 class=pgc-h-arrow-right>1.2.2.1 元數據管理（Metadata Management）</h1><ul><li>DBus會自動將實時感知的數據庫元數據變化記錄下來並提供服務</li><li>DBus會自動將在線格式化的日誌元數據信息記錄下來並提供服務</li><li>DBus會發布在Kafka上發佈統一UMS消息，UMS本身自帶消息元數據信息，因此下游消費時無需調用中心化元數據服務，可以直接從UMS消息裡拿到數據的元數據信息</li></ul><h1 class=pgc-h-arrow-right>1.2.2.2 模式演變（Schema Evolution）</h1><ul><li>UMS消息會自帶Schema的Namespace信息，Namespace是一個7層定位字符串，可以唯一定位任何表的任何生命週期，相當於數據表的IP地址，形式如下：</li></ul><p>[Datastore].[Datastore Instance].[Database].[Table].[TableVersion].[Database Partition].[Table Partition]</p><p>例：oracle.oracle01.db1.table1.v2.dbpar01.tablepar01</p><p>其中[Table Version]代表了這張表的某個Schema的版本號，如果數據源是數據庫，那麼這個版本號是由DBus自動維護的。</p><ul><li>在RTDP架構中，Kafka的下游是由Wormhole消費的，Wormhole在消費UMS時，會將[TableVersion]作為*處理，意味著當某表上游Schema變更時，Version會自動升號，但Wormhole會無視這個Version變化，將會消費此表所有版本的增量/全量數據，那麼Wormhole如何做到兼容性模式演變支持呢？在Wormhole裡可以配置流上處理SQL和輸出字段，當上遊Schema變更是一種“兼容性變更”（指增加字段，或者修改擴大字段類型等）時，是不會影響到Wormhole SQL正確執行的。當上遊發生非兼容性變更時，Wormhole會報錯，這時就需要人工介入對新Schema的邏輯進行修復。</li></ul><p>由上文可以看出，Schema Registry和DBus+UMS是兩種不同的解決元數據管理和模式演變的設計思路，兩者各有優勢和劣勢，可以參考表1的簡單比較。</p><p><br></p><div class=pgc-img><img alt=如何設計實時數據平臺（技術篇） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d61c1237e99141f8ad08b5e32d8ba293><p class=pgc-img-caption></p></div><p>表1 Schema Registry 與 DBus+UMS 對比</p><p>這裡給出一個UMS的例子：</p><p><br></p><div class=pgc-img><img alt=如何設計實時數據平臺（技術篇） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2bbafaccd19a46ec82ad600cd575e0ec><p class=pgc-img-caption></p></div><p>圖6 UMS消息舉例</p><h1 class=pgc-h-arrow-right>1.2.3 流式處理平臺Wormhole</h1><p><br></p><div class=pgc-img><img alt=如何設計實時數據平臺（技術篇） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/181218f0e21f46c4b8cc4f2a3bed3982><p class=pgc-img-caption></p></div><p>圖7 RTDP架構之Wormhole</p><h1 class=pgc-h-arrow-right>1.2.3.1 Wormhole設計思想</h1><p>1)從外部角度看待設計思想</p><ul><li>消費來自Kafka 的UMS消息和自定義JSON消息</li><li>負責對接不同的數據目標存儲 (Sink)，並通過冪等邏輯實現Sink的最終一致性</li><li>支持配置SQL方式實現流上處理邏輯</li><li>提供Flow抽象。Flow由一個Source Namespace和一個Sink Namespace定義，且具備唯一性。Flow上可以定義處理邏輯，是一種流上處理的邏輯抽象，通過與物理Spark Streaming、Flink Streaming解耦，使得同一個Stream可以處理多個Flow處理流，且Flow可以在不同Stream上任意切換。</li><li>支持基於回灌（backfill）的Kappa架構；支持基於Wormhole Job的Lambda架構</li></ul><p>2)從內部角度看待設計思想</p><ul><li>基於Spark Streaming、Flink計算引擎進行數據流上處理。Spark Streaming可支持高吞吐、批量Lookup、批量寫Sink等場景；Flink可支持低延遲、CEP規則等場景。</li><li>通過ums_id_, ums_op_實現不同Sink的冪等入庫邏輯</li><li>通過計算下推實現Lookup邏輯優化</li><li>抽象幾個統一以支持功能靈活性和設計一致性</li></ul><p>統一DAG高階分形抽象</p><p>統一通用流消息UMS協議抽象</p><p>統一數據邏輯表命名空間Namespace抽象</p><ul><li>抽象幾個接口以支持可擴展性</li></ul><p>SinkProcessor：擴展更多Sink支持</p><p>SwiftsInterface：自定義流上處理邏輯支持</p><p>UDF：更多流上處理UDF支持</p><ul><li>通過Feedback消息實時歸集流式作業動態指標和統計</li></ul><h1 class=pgc-h-arrow-right>1.2.3.2 Wormhole功能特性</h1><ul><li>支持可視化，配置化，SQL化開發實施流式項目</li><li>支持指令式動態流式處理的管理、運維、診斷和監控</li><li>支持統一結構化UMS消息和自定義半結構化JSON消息</li><li>支持處理增刪改三態事件消息流</li><li>支持單個物理流同時並行處理多個邏輯業務流</li><li>支持流上Lookup Anywhere，Pushdown Anywhere</li><li>支持基於業務策略的事件時間戳流式處理</li><li>支持UDF的註冊管理和動態加載</li><li>支持多目標數據系統的併發冪等入庫</li><li>支持多級基於增量消息的數據質量管理</li><li>支持基於增量消息的流式處理和批量處理</li><li>支持Lambda架構和Kappa架構</li><li>支持與三方系統無縫集成，可作為三方系統的流控引擎</li><li>支持私有云部署，安全權限管控和多租戶資源管理</li></ul><h1 class=pgc-h-arrow-right>1.2.3.3 Wormhole技術架構</h1><p><br></p><div class=pgc-img><img alt=如何設計實時數據平臺（技術篇） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5413384cc01f460988a7d51d63386143><p class=pgc-img-caption></p></div><p>圖8 Wormhole數據流轉架構圖</p><p>更多Wormhole技術細節和用戶界面，可以參看：</p><p>GitHub：https://github.com/edp963/wormhole</p><h1 class=pgc-h-arrow-right>1.2.4 常用數據計算存儲選型</h1><p>RTDP架構對待數據計算存儲選型的選擇採取開放整合的態度。不同數據系統有各自的優勢和適合的場景，但並沒有一個數據系統可以適合各種各樣的存儲計算場景。因此當有合適的、成熟的、主流的數據系統出現，Wormhole和Moonbox會按照需要相應的擴展整合支持。</p><p>這裡大致列舉一些比較通用的選型：</p><ul><li>關係型數據庫（Oracle/MySQL等）：適合小數據量的複雜關係計算</li><li>分佈式列存儲系統</li></ul><p>Kudu：Scan優化，適合OLAP分析計算場景</p><p>HBase：隨機讀寫，適合提供數據服務場景</p><p>Cassandra：高性能寫，適合海量數據高頻寫入場景</p><p>ClickHouse：高性能計算，適合只有insert寫入場景（後期將支持更新刪除操作）</p><ul><li>分佈式文件系統</li></ul><p>HDFS/Parquet/Hive：append only，適合海量數據批量計算場景</p><ul><li>分佈式文檔系統</li></ul><p>MongoDB：平衡能力，適合大數據量中等複雜計算</p><ul><li>分佈式索引系統</li></ul><p>ElasticSearch：索引能力，適合做模糊查詢和OLAP分析場景</p><ul><li>分佈式預計算系統</li></ul><p>Druid/Kylin：預計算能力，適合高性能OLAP分析場景</p><h1 class=pgc-h-arrow-right>1.2.5 計算服務平臺Moonbox</h1><p><br></p><div class=pgc-img><img alt=如何設計實時數據平臺（技術篇） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/375a5ac1dc1145c08ba62a58fb97ef01><p class=pgc-img-caption></p></div><p>圖9 RTDP架構之Moonbox</p><h1 class=pgc-h-arrow-right>1.2.5.1 Moonbox設計思想</h1><p>1)從外部角度看待設計思想</p><ul><li>負責對接不同的數據系統，支持統一方式跨異構數據系統即席混算</li><li>提供三種Client調用方式：RESTful服務、JDBC連接、ODBC連接</li><li>統一元數據收口；統一查詢語言SQL收口；統一權限控制收口</li><li>提供兩種查詢結果寫出模式：Merge、Replace</li><li>提供兩種交互模式：Batch模式、Adhoc模式</li><li>數據虛擬化實現，多租戶實現，可看作是虛擬數據庫</li></ul><p>2)從內部角度看待設計思想</p><ul><li>對SQL進行解析，經過常規Catalyst處理解析流程，最終生成可下推數據系統的邏輯執行子樹進行下推計算，然後將結果拉回進行混算並返回</li><li>支持兩層Namespace：database.table，以提供虛擬數據庫體驗</li><li>提供分佈式服務模塊Moonbox Grid提供高可用高併發能力</li><li>對可全部下推邏輯（無混算）提供快速執行通道</li></ul><h1 class=pgc-h-arrow-right>1.2.5.2 Moonbox功能特性</h1><ul><li>支持跨異構系統無縫混算</li><li>支持統一SQL語法查詢計算和寫入</li><li>支持三種調用方式：RESTful服務、JDBC連接、ODBC連接</li><li>支持兩種交互模式：Batch模式、Adhoc模式</li><li>支持Cli Command工具和Zeppelin</li><li>支持多租戶用戶權限體系</li><li>支持表級權限、列級權限、讀權限、寫權限、UDF權限</li><li>支持YARN調度器資源管理</li><li>支持元數據服務</li><li>支持定時任務</li><li>支持安全策略</li></ul><h1 class=pgc-h-arrow-right>1.2.5.3 Moonbox技術架構</h1><p><br></p><div class=pgc-img><img alt=如何設計實時數據平臺（技術篇） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0c37980748e646b58f06a64c91b21b16><p class=pgc-img-caption></p></div><p>圖10 Moonbox邏輯模塊</p><p>更多Moonbox技術細節和用戶界面，可以參看：</p><p>GitHub： https://github.com/edp963/moonbox</p><h1 class=pgc-h-arrow-right>1.2.6 可視應用平臺Davinci</h1><p><br></p><div class=pgc-img><img alt=如何設計實時數據平臺（技術篇） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/76d4cad6ee09400db42680e130e26d80><p class=pgc-img-caption></p></div><p>圖11 RTDP架構之Davinci</p><h1 class=pgc-h-arrow-right>1.2.6.1 Davinci設計思想</h1><p>1)從外部角度看待設計思想</p><ul><li>負責各種數據可視化展示功能</li><li>支持JDBC數據源</li><li>提供平權用戶體系，每個用戶可以建立屬於自己的Org、Team和Project</li><li>支持SQL編寫數據處理邏輯，支持拖拽式編輯可視化展示，提供多用戶社交化分工協作環境</li><li>提供多種不同的圖表交互能力和定製化能力，以應對不同數據可視化需求</li><li>提供嵌入整合進其他數據應用的能力</li></ul><p>2)從內部角度看待設計思想</p><ul><li>圍繞View和Widget展開。View是數據的邏輯視圖；Widget是數據可視化視圖</li><li>通過用戶自定義選擇分類數據、有序數據和量化數據，按照合理的可視化邏輯自動展現視圖</li></ul><h1 class=pgc-h-arrow-right>1.2.6.2 Davinci功能特性</h1><p>1)數據源</p><ul><li>支持JDBC數據源</li><li>支持CSV文件上傳</li></ul><p>2)數據視圖</p><ul><li>支持定義SQL模版</li><li>支持SQL高亮顯示</li><li>支持SQL測試</li><li>支持回寫操作</li></ul><p>3)可視組件</p><ul><li>支持預定義圖表</li><li>支持控制器組件</li><li>支持自由樣式</li></ul><p>4)交互能力</p><ul><li>支持可視組件全屏顯示</li><li>支持可視組件本地控制器</li><li>支持可視組件間過濾聯動</li><li>支持群控控制器可視組件</li><li>支持可視組件本地高級過濾器</li><li>支持大數據量展示分頁和滑塊</li></ul><p>5)集成能力</p><ul><li>支持可視組件CSV下載</li><li>支持可視組件公共分享</li><li>支持可視組件授權分享</li><li>支持儀表板公共分享</li><li>支持儀表板授權分享</li></ul><p>6)安全權限</p><ul><li>支持數據行列權限</li><li>支持LDAP登錄集成</li></ul><p>更多Davinci技術細節和用戶界面，可以參看：</p><p>GitHub：https://github.com/edp963/davinci</p><h1 class=pgc-h-arrow-right>1.3 切面話題討論</h1><h1 class=pgc-h-arrow-right>1.3.1 數據管理</h1><p>1）元數據管理</p><ul><li>DBus可以實時拿到數據源的元數據並提供服務查詢</li><li>Moonbox可以實時拿到數據系統的元數據並提供服務查詢</li><li>對於RTDP架構來說，實時數據源和即席數據源的元數據信息可以通過調用DBus和Moonbox的RESTful服務歸集，可以基於此建設企業級元數據管理系統</li></ul><p>2）數據質量</p><ul><li>Wormhole可以配置消息實時落入HDFS（hdfslog）。基於hdfslog的Wormhole Job支持Lambda架構；基於hdfslog的Backfill支持Kappa架構。可以通過設置定時任務選擇Lambda架構或者Kappa架構對Sink進行定時刷新，以確保數據的最終一致性。Wormhole還支持將流上處理異常或Sink寫入異常的消息信息實時Feedback到Wormhole系統中，並提供RESTful服務供三方應用調用處理。</li><li>Moonbox可以對異構系統進行即席混算，這個能力賦予Moonbox“瑞士軍刀”般的便利性。可以通過Moonbox編寫定時SQL腳本邏輯，對關注的異構系統數據進行比對，或對關注的數據表字段進行統計等，可以基於Moonbox的能力二次開發數據質量檢測系統。</li></ul><p>3）血緣分析</p><ul><li>Wormhole的流上處理邏輯通常SQL即可滿足，這些SQL可以通過RESTful服務進行歸集。</li><li>Moonbox掌管了數據查詢的統一入口，並且所有邏輯均為SQL，這些SQL可以通過Moonbox日誌進行歸集。</li><li>對於RTDP架構來說，實時處理邏輯和即席處理邏輯的SQL可以通過調用Wormhole的RESTful服務和Moonbox的日誌歸集，可以基於此建設企業級血緣分析系統。</li></ul><h1 class=pgc-h-arrow-right>1.3.2 數據安全</h1><p><br></p><div class=pgc-img><img alt=如何設計實時數據平臺（技術篇） onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/d8b22d8275a0427d94d2cac569455790><p class=pgc-img-caption></p></div><p>圖12 RTDP數據安全</p><p>上圖給出了RTDP架構中，四個開源平臺覆蓋了端到端數據流轉鏈路，並且在每個節點上都有對數據安全各個方面的考量和支持，確保了實時數據管道端到端的數據安全性。</p><p>另外，由於Moonbox成為了面向應用層數據訪問的統一入口，因此基於Moonbox的操作審計日誌可以獲得很多安全層面的信息，可以圍繞操作審計日誌建立數據安全預警機制，進而建設企業級數據安全系統。</p><h1 class=pgc-h-arrow-right>1.3.3 開發運維</h1><p>1）運維管理</p><ul><li>實時數據處理的運維管理向來是個痛點，DBus和Wormhole通過可視化UI提供了可視化運維管理能力，讓人工運維變得簡單。</li><li>DBus和Wormhole提供了健康檢查、操作管理、Backfill、Flow漂移等RESTful服務，可以基於此研發自動化運維繫統。</li></ul><p>2）監控預警</p><ul><li>DBus和Wormhole均提供可視化監控界面，可以實時看到邏輯表級的吞吐和延遲等信息。</li><li>DBus和Wormhole提供了心跳、Stats、狀態等RESTful服務，可以基於此研發自動化預警系統。</li></ul><h1 class=pgc-h-arrow-right>二、模式場景探討</h1><p>上一章我們介紹了RTDP架構各個技術組件的設計架構和功能特性，至此讀者已經對RTDP架構如何落地有了具體的認識和了解。那麼RTDP架構可以解決哪些常見數據應用場景呢？下面我們會探討幾種使用模式，以及不同模式適應何種需求場景。</p><h1 class=pgc-h-arrow-right>2.1 同步模式</h1><h1 class=pgc-h-arrow-right>2.1.1 模式描述</h1><p>同步模式，是指只配置異構數據系統之間的數據實時同步，在流上不做任何處理邏輯的使用模式。</p><p>具體而言，通過配置DBus將數據從數據源實時抽取出來投放在Kafka上，然後通過配置Wormhole將Kafka上數據實時寫入到Sink存儲中。同步模式主要提供了兩個能力：</p><ul><li>後續數據處理邏輯不再執行在業務備庫上，減少了對業務備庫的使用壓力</li><li>提供了將不同物理業務備庫數據實時同步到同一物理數據存儲的可能性</li></ul><h1 class=pgc-h-arrow-right>2.1.2 技術難點</h1><p>具體實施比較簡單。</p><p>IT實施人員無需瞭解太多流式處理的常見問題，不需要考慮流上處理邏輯實現的設計和實施，只需要瞭解基本的流控參數配置即可。</p><h1 class=pgc-h-arrow-right>2.1.3 運維管理</h1><p>運維管理比較簡單。</p><p>需要人工運維。但由於流上沒有處理邏輯，因此容易把控流速，無需考慮流上處理邏輯本身的功耗，可以給出一個相對穩定的同步管道配置。並且也很容易做到定時端到端數據比對來確保數據質量，因為源端和目標端的數據是完全一致的。</p><h1 class=pgc-h-arrow-right>2.1.4 適用場景</h1><ul><li>跨部門數據實時同步共享</li><li>交易數據庫和分析數據庫解耦</li><li>支持數倉實時ODS層建設</li><li>用戶自助實時簡單報表開發</li><li>等等</li></ul><h1 class=pgc-h-arrow-right>2.2 流算模式</h1><h1 class=pgc-h-arrow-right>2.2.1 模式描述</h1><p>流算模式，是指在同步模式的基礎上，在流上配置處理邏輯的使用模式。</p><p>在RTDP架構中，流上處理邏輯的配置和支持主要在Wormhole平臺上進行。在同步模式的能力之上，流算模式主要提供了兩個能力：</p><ul><li>流上計算將批量計算集中功耗分散在流上增量計算持續功耗，極大降低了結果快照的時間延遲</li><li>流上計算提供了跨異構系統混算的新的計算入口（Lookup）</li></ul><h1 class=pgc-h-arrow-right>2.2.2 技術難點</h1><p>具體實施相對較難。</p><p>用戶需要了解流上處理能做哪些事，適合做哪些事，如何轉化全量計算邏輯成為增量計算邏輯等。還要考慮流上處理邏輯本身功耗和依賴的外部數據系統等因素來調節配置更多參數。</p><h1 class=pgc-h-arrow-right>2.2.3 運維管理</h1><p>運維管理相對較難。</p><p>需要人工運維。但比同步模式運維管理更難，主要體現在流控參數配置考慮因素較多、無法支持端到端數據比對、要選擇結果快照最終一致性實現策略、要考慮流上Lookup時間對齊策略等方面問題。</p><h1 class=pgc-h-arrow-right>2.2.4 適用場景</h1><ul><li>對低延遲要求較高的數據應用項目或報表</li><li>需要低延遲調用外部服務（如流上調用外部規則引擎、在線算法模型使用等）</li><li>支持數倉實時事實表+維度表的寬表建設</li><li>實時多表融合、分拆、清洗、標準化Mapping場景</li><li>等等</li></ul><h1 class=pgc-h-arrow-right>2.3 輪轉模式</h1><h1 class=pgc-h-arrow-right>2.3.1 模式描述</h1><p>輪轉模式，是指在流算模式的基礎上，在數據實時落庫中，同時跑短時定時任務在庫上進一步計算後，將結果再次投放在Kafka上跑下一輪流上計算，這樣流算轉批算、批算轉流算的使用模式。</p><p>在RTDP架構中，可以利用Kafka->Wormhole->Sink->Moonbox->Kafka的整合方式實現任何輪次任何頻次的輪轉計算。在流算模式的能力之上，輪轉模式提供的主要能力是：理論上支持低延遲的任何複雜流轉計算邏輯。</p><h1 class=pgc-h-arrow-right>2.3.2 技術難點</h1><p>具體實施難。</p><p>Moonbox轉Wormhole能力的引入，比流算模式進一步增加了考慮的變量因素，如多Sink的選擇、Moonbox計算的頻率設定、如何拆分Wormhole和Moonbox的計算分工等方面問題。</p><h1 class=pgc-h-arrow-right>2.3.3 運維管理</h1><p>運維管理難。</p><p>需要人工運維。和流算模式比，需要更多數據系統因素的考慮、更多參數的配置調優、更難的數據質量管理和診斷監控。</p><h1 class=pgc-h-arrow-right>2.3.4 適用場景</h1><ul><li>低延遲的多步驟的複雜數據處理邏輯場景</li><li>公司級實時數據流轉處理網絡建設</li></ul><h1 class=pgc-h-arrow-right>2.4 智能模式</h1><h1 class=pgc-h-arrow-right>2.4.1 模式描述</h1><p>智能模式，是指利用規則或算法模型來進行優化和增效的使用模式。</p><p>可以智能化的點：</p><ul><li>Wormhole Flow的智能漂移（智能化自動化運維）</li><li>Moonbox預計算的智能優化（智能化自動化調優）</li><li>全量計算邏輯智能轉換成流式計算邏輯，然後部署在Wormhole + Moonbox（智能化自動化開發部署）</li><li>等等</li></ul><h1 class=pgc-h-arrow-right>2.4.2 技術難點</h1><p>具體實施在理論上最簡單，但有效的技術實現最難。</p><p>用戶只需要完成離線邏輯開發，剩下交由智能化工具完成開發、部署、調優、運維。</p><h1 class=pgc-h-arrow-right>2.4.3 運維管理</h1><p>零運維。</p><h1 class=pgc-h-arrow-right>2.4.4 適用場景</h1><p>全場景。</p><p>自此，我們對“如何設計實時數據平臺”這個話題的討論暫時告一段落。我們從概念背景，討論到架構設計，接著介紹了技術組件，最後探討了模式場景。由於這裡涉及到的每個話題點都很大，本文只是做了淺層的介紹和探討。後續我們會不定期針對某個具體話題點展開詳細討論，將我們的實踐和心得呈現出來，拋磚引玉，集思廣益。如果對RTDP架構中的四個開源平臺感興趣，歡迎在GitHub上找到我們，瞭解使用，交流建議。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>設計</a></li><li><a>實時</a></li><li><a>數據平</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/ffc81f45.html alt=實時數據平臺設計：技術選型與應用場景適配模式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15254882999416c80866253 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ffc81f45.html title=實時數據平臺設計：技術選型與應用場景適配模式>實時數據平臺設計：技術選型與應用場景適配模式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0143ac46.html alt=這麼設計實時數據平臺，OLAP再也不是個事兒 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/361d1848623f4a2092fad3b17ae2c4da style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0143ac46.html title=這麼設計實時數據平臺，OLAP再也不是個事兒>這麼設計實時數據平臺，OLAP再也不是個事兒</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9bd6b239.html alt=鋼構人福利——鋼結構設計經典問題解讀 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a72bd60ea48d471b8ce03ebf0ce15869 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9bd6b239.html title=鋼構人福利——鋼結構設計經典問題解讀>鋼構人福利——鋼結構設計經典問題解讀</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6bbe6ec4.html alt=鋼管混凝土結構設計原理及在強震區橋樑結構研究成果達國際領先 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/153569494612546362474a9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6bbe6ec4.html title=鋼管混凝土結構設計原理及在強震區橋樑結構研究成果達國際領先>鋼管混凝土結構設計原理及在強震區橋樑結構研究成果達國際領先</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6d006e47.html alt=鋼結構設計基礎知識問答 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/63b48928-d7cd-4346-b80f-4f77015517c1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6d006e47.html title=鋼結構設計基礎知識問答>鋼結構設計基礎知識問答</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0dc64d99.html alt=38個鋼結構設計問題，都很常見 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/f1181ce8-cf01-4194-b9c2-362f43894ddb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0dc64d99.html title=38個鋼結構設計問題，都很常見>38個鋼結構設計問題，都很常見</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b6fd930e.html alt=步步解析橋樑設計計算，不可錯過的一篇乾貨 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d88dd927b4f2474fbe4ea261c2397ba8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b6fd930e.html title=步步解析橋樑設計計算，不可錯過的一篇乾貨>步步解析橋樑設計計算，不可錯過的一篇乾貨</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/97b90000.html alt=結構設計、校對、審核三字經，速速收藏 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/97b90000.html title=結構設計、校對、審核三字經，速速收藏>結構設計、校對、審核三字經，速速收藏</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fd0540fa.html alt=解析橋樑設計計算 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/fa4d0bcf2a204a2fac9b37978b1b0713 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fd0540fa.html title=解析橋樑設計計算>解析橋樑設計計算</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/83530974.html alt=解析橋樑設計計算，不可錯過的一篇乾貨 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/af9ca7f120da4e23b0ca589375e05dd2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/83530974.html title=解析橋樑設計計算，不可錯過的一篇乾貨>解析橋樑設計計算，不可錯過的一篇乾貨</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e8b9b44c.html alt=設計師解析橋樑設計計算，錯過了就沒有機會 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e01645937bda4ae7a7f148666ff89117 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e8b9b44c.html title=設計師解析橋樑設計計算，錯過了就沒有機會>設計師解析橋樑設計計算，錯過了就沒有機會</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/15d8539d.html alt=經典設計延續至今的烏尼莫克403萬能卡車 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/132ba54553374c7eb2c0a9c155bba041 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/15d8539d.html title=經典設計延續至今的烏尼莫克403萬能卡車>經典設計延續至今的烏尼莫克403萬能卡車</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/69536588.html alt=線纜設計初級課程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1532759411210988051a0cb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/69536588.html title=線纜設計初級課程>線纜設計初級課程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/219919c3.html alt=梯度效果的創意Logo設計案例分享（1） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15226471428904df67cc724 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/219919c3.html title=梯度效果的創意Logo設計案例分享（1）>梯度效果的創意Logo設計案例分享（1）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/29b61120.html alt=梯度效果的創意Logo設計案例分享（2） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1522647184765cbbd0b4dcd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/29b61120.html title=梯度效果的創意Logo設計案例分享（2）>梯度效果的創意Logo設計案例分享（2）</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>