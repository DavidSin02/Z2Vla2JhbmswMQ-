<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap | 极客快訊</title><meta property="og:title" content="瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/d7714f65761648ee9b73a6bd5cca2fcb"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2cb59e3c.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2cb59e3c.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2cb59e3c.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2cb59e3c.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2cb59e3c.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2cb59e3c.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2cb59e3c.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2cb59e3c.html><meta property="article:published_time" content="2020-11-14T21:07:43+08:00"><meta property="article:modified_time" content="2020-11-14T21:07:43+08:00"><meta name=Keywords content><meta name=description content="瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/2cb59e3c.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>HashMap是Java中常用的集合，而且HashMap的一些思想，對於我們平時解決業務上的一些問題，在思路上有幫助，基於此，本文將分析HashMap底層設計思想，並手寫一個迷你版的HashMap!</p><p><strong>對HashMap的思考</strong></p><div class=pgc-img><img alt=瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d7714f65761648ee9b73a6bd5cca2fcb><p class=pgc-img-caption></p></div><p>HashMap底層數據結構第一，如圖所示，HashMap有3個要素：hash函數+數組+單鏈表。</p><p>第二，對於hash函數而言，需要考慮些什麼?</p><p>要快，對於給定的Key，要能夠快速計算出在數組中的index。那麼什麼運算夠快呢?顯然是位運算!要均勻分佈，要較少碰撞。說白了，我們希望通過hash函數，讓數據均勻分佈在數組中，不希望大量數據發生碰撞，導致鏈表過長。那麼怎麼辦到呢?也是利用位運算，通過對數據的二進制的位進行移動，讓hash函數得到的數據散列開來，從而減低了碰撞的概率。</p><p>如果發生了碰撞怎麼辦?上面的圖其實已經說明了JDK的HashMap是如何處理hash衝突的，就是通過單鏈表解決的。那麼除了這個方法，還有其他思路嗎？比如說，如果發生衝突，那麼記下這個衝突的位置為 index，然後在加上固定步長，即index+step，找到這個位置，看一下是否仍然衝突，如果繼續衝突，那麼按照這個思路，繼續加上固定步長。其實這就是所謂的線性探測來解決Hash衝突的方法!</p><p><strong>通過寫一個迷你版的HashMap來深刻理解定義接口</strong></p><p>定義接口</p><div class=pgc-img><img alt=瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bd569bce185b4ac1a7cb83bf98ea0d3a><p class=pgc-img-caption></p></div><p>接口</p><p>定義一個接口，對外暴露快速存取的方法。注意MyMap接口內部定義了一個內部接口Entry。</p><p><strong>接口實現</strong></p><div class=pgc-img><img alt=瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/68a55c6e9bb84a689c04aa305abe4fa9><p class=pgc-img-caption></p></div><p>HashMap的要素之一，就是數組，自然在這裡，我們要定義數組，數組的初始化大小，還要考慮擴容的閥值。</p><p><strong>看MyHashMap的構造</strong></p><div class=pgc-img><img alt=瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9acebff137e546648d7681b9957ed779><p class=pgc-img-caption></p></div><p>構造方法有什麼好說的呢?</p><p>仔細觀察下，你會發現，其實這裡使用到了“門面模式”。這裡的2個構造方法其實指向的是同一個，但是對外卻暴露了2個“門面”!</p><p><strong>Entry</strong></p><div class=pgc-img><img alt=瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/64d1710d53ab427d98251f918a933b4a><p class=pgc-img-caption></p></div><p>HashMap的要素之一，單鏈表的體現就在這裡!</p><p><strong>看put如何實現</strong></p><div class=pgc-img><img alt=瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1991db9959314404bf8b32410a82b647><p class=pgc-img-caption></p></div><p>第一，要考慮是否擴容?</p><p>HashMap中的Entry的數量(數組以及單鏈表中的所有Entry)是否達到閥值?</p><p>第二，如果擴容，意味著新生成一個Entry[]，不僅如此還得重新散列。</p><p>第三，要根據Key計算出在Entry[]中的位置，定位後，如果Entry[]中的元素為null，那麼可以放入其中，如</p><p>果不為空，那麼得遍歷單鏈表，要麼更新value，要麼形成一個新的Entry“擠壓”單鏈表!</p><p><strong>hash函數</strong></p><div class=pgc-img><img alt=瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b6d2a7c4ce0041bfb76d570ad5b24f40><p class=pgc-img-caption></p></div><p>MyHashMap提供的hash函數</p><div class=pgc-img><img alt=瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/dca6e3ba0f4245e29f71646182540f14><p class=pgc-img-caption></p></div><p>JDK的HashMap提供的hash函數</p><p>我這裡參考了JDK的HashMap的hash函數的實現，這裡也再次說明了：要想散列均勻，就得進行二進制的位運算!</p><p><strong>resize和rehash</strong></p><div class=pgc-img><img alt=瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d3b5d5cb4e964a8d9917b833df9f4f81><p class=pgc-img-caption></p></div><p>這裡可以看出，對於HashMap而言，如果頻繁進行resize/rehash操作，是會影響性能的。</p><p>resize/rehash的過程，就是數組變大，原來數組中的entry元素一個個的put到新數組的過程，需要注意的是一些狀態變量的改變。</p><p><strong>get實現</strong></p><div class=pgc-img><img alt=瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d20970332785492b8362bd53831da5b7><p class=pgc-img-caption></p></div><p>get</p><p>get很簡單，只需要注意在遍歷單鏈表的過程中使用== or equals來判斷下即可。</p><p><strong>Test測試</strong></p><div class=pgc-img><img alt=瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e95bad186cae4af691a599c06ba4e1a3><p class=pgc-img-caption></p></div><p>利用MyHashMap進行存取</p><p><strong>運行結果</strong></p><div class=pgc-img><img alt=瞭解HashMap底層設計思想，教你手寫一個迷你版的HashMap onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/086b60d65ca548c2b29cb133f6382cc1><p class=pgc-img-caption></p></div><p>OK，一個迷你版的HashMap就寫好了，你學到了麼?</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>HashMap</a></li><li><a>迷你版</a></li><li><a>瞭解</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/5010a4b6.html alt=兩分鐘瞭解低損耗電纜結構 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9af84f52bbed4ee39f3825e0f43e619b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5010a4b6.html title=兩分鐘瞭解低損耗電纜結構>兩分鐘瞭解低損耗電纜結構</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cae5a51a.html alt=「施工技巧」詳細瞭解光纜、終端盒、尾纖的接法和光纖各種接口 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/decf8edb02a34404b92b86681378575f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cae5a51a.html title=「施工技巧」詳細瞭解光纜、終端盒、尾纖的接法和光纖各種接口>「施工技巧」詳細瞭解光纜、終端盒、尾纖的接法和光纖各種接口</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/47bcd6a6.html alt=詳細瞭解光纜、終端盒、尾纖的接法和光纖各種接口 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/dcdae811e636496d948cf5a745f470fc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/47bcd6a6.html title=詳細瞭解光纜、終端盒、尾纖的接法和光纖各種接口>詳細瞭解光纜、終端盒、尾纖的接法和光纖各種接口</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8aab963e.html alt=Python手繪圖瞭解一下！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/746c9e6e214b48b2a0215fc9e151cdc8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8aab963e.html title=Python手繪圖瞭解一下！>Python手繪圖瞭解一下！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c90e11f6.html alt=「瞭解」房屋的層高和淨高怎麼算？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1526054178152a496189726 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c90e11f6.html title=「瞭解」房屋的層高和淨高怎麼算？>「瞭解」房屋的層高和淨高怎麼算？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2db74f7c.html alt=瞭解鍋爐循環泵與換熱站循環泵的佈置 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1533630871099dca28f1fe7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2db74f7c.html title=瞭解鍋爐循環泵與換熱站循環泵的佈置>瞭解鍋爐循環泵與換熱站循環泵的佈置</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/090306a0.html alt="[Spring] 深入瞭解事務原理" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/a8c6dbd7c51741f5a76262e8e2c7a670 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/090306a0.html title="[Spring] 深入瞭解事務原理">[Spring] 深入瞭解事務原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5b46ca88.html alt=做跨境電商站外推廣，你必須瞭解的Facebook像素 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/2df772dcb2d747f8b55ff9e4610cbcad style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5b46ca88.html title=做跨境電商站外推廣，你必須瞭解的Facebook像素>做跨境電商站外推廣，你必須瞭解的Facebook像素</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ed10eec0.html alt=瞭解了“屍填巨港之岸，血滿長城之窟”，還覺得宋代窩囊嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/79d0cee860504ee48c8e419052ceab23 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ed10eec0.html title=瞭解了“屍填巨港之岸，血滿長城之窟”，還覺得宋代窩囊嗎？>瞭解了“屍填巨港之岸，血滿長城之窟”，還覺得宋代窩囊嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1fe1c2dd.html alt=瞭解生成對抗網絡（GAN） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/634604de44ad4d17931ccc0bcf3e46ef style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1fe1c2dd.html title=瞭解生成對抗網絡（GAN）>瞭解生成對抗網絡（GAN）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c2f3b02a.html alt=牆繪知識來了，帶你一分鐘瞭解丙烯顏料 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f33c910d91a847bdb6baabc3ab01e0cd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c2f3b02a.html title=牆繪知識來了，帶你一分鐘瞭解丙烯顏料>牆繪知識來了，帶你一分鐘瞭解丙烯顏料</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6114a4bb.html alt=格鬥周：帶你瞭解各類格鬥術 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/46b75604edfa491990901ac982573db9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6114a4bb.html title=格鬥周：帶你瞭解各類格鬥術>格鬥周：帶你瞭解各類格鬥術</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/444cae24.html alt=瞭解房屋建築圈樑 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/154043230417821ced6ef46 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/444cae24.html title=瞭解房屋建築圈樑>瞭解房屋建築圈樑</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/57257e28.html alt=你對鋼製文件櫃瞭解多少呢 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9ad059f36d954de2b5517d99057887f9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/57257e28.html title=你對鋼製文件櫃瞭解多少呢>你對鋼製文件櫃瞭解多少呢</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/92675aff.html alt=關於哈希表，你該瞭解這些 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8d18861a74ac4577abd03b0064a1016b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/92675aff.html title=關於哈希表，你該瞭解這些>關於哈希表，你該瞭解這些</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>