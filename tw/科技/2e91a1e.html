<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>乾貨教程！第四章：本地存儲和圖片緩存 | 极客快訊</title><meta property="og:title" content="乾貨教程！第四章：本地存儲和圖片緩存 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/1531103917914e2164f0742"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2e91a1e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2e91a1e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2e91a1e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2e91a1e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2e91a1e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2e91a1e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2e91a1e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2e91a1e.html><meta property="article:published_time" content="2020-10-29T21:08:25+08:00"><meta property="article:modified_time" content="2020-10-29T21:08:25+08:00"><meta name=Keywords content><meta name=description content="乾貨教程！第四章：本地存儲和圖片緩存"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/2e91a1e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>乾貨教程！第四章：本地存儲和圖片緩存</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><div class=pgc-img><img alt=乾貨教程！第四章：本地存儲和圖片緩存 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1531103917914e2164f0742><p class=pgc-img-caption></p></div><p>上期APICloud和大家分享了《30天，App開發從0到1》一書中，數據雲的用途和特點的相關知識，相信小夥伴們也有了一些收穫。這次，小編又帶著精彩內容來和大家見面了（請為無私奉獻的小編點贊！）</p><p>在第三章中介紹了 APICloud 和後端交互的機制，並將商品列表根據數據進行了顯示。本章將學習doT 模板引擎的基本使用、本地存儲和圖片緩存的使用、以及下拉刷新、上拉加載的實現。</p><p><strong>● 學習目標</strong></p><p>(1)學習 doT 模板引擎的使用。</p><p>(2)學習本地存儲和圖片緩存。</p><p>(3)下拉刷新、上拉加載的實現。</p><p>(4)理解 APICloud 應用沙箱結構。</p><p>(5)掌握 APICloud 資源訪問協議使用。</p><p>(6)學習常用對話窗口的使用。</p><p>(7)學習窗口間的通信機制。</p><p>(8)學習 APICloud 平臺的事件機制。</p><p>本期，APICloud和大家重點分享的是第二節：</p><p><strong>本地存儲和圖片緩存</strong></p><p>數據的本地存儲和圖片緩存可以極大地提高 app 的用戶體驗、提高 UI 響應速度、減少網絡使用。</p><p><strong>1．uzStorage</strong></p><p>APICloud 提供了 uzStorage來提供類似 localStorage 的功能，但是比 localStorage 更適合混合app 開發。uzStorage 比標準的localStorage 更安全易用。</p><p>舉個栗子： localStorage 有大小限制、異步會導致一些安全、不能存儲對象等問題，但這些問題均在 uzStorage 中得到了解決。通過下面的 API 控制 uzStorage :</p><p>$api.getStorage("key"); 獲取數據 $api.setStorage("key","value");存儲數據 $api.rmStorage("key"); 移除保存的數據 $api.clearStorage(); 清空本地存儲</p><p><strong>2．偏好設置</strong></p><p>APICloud 提供了針對系統原生偏好設置操作的 API(如 Android 的 preference 和 iOS 的 plist)，使用鍵值對的方式存儲。</p><p><strong>3．文件</strong></p><p>APICloud 提供了標準的文件操作接口，支持同步和異步的調用方式。使用下面的 API 操作文件:</p><p>api.readFile({sync:false,//是否同步，默認 falsepath:"PathToFile"// 文件路徑，支持絕對路徑和文件路徑協議如 fs://、widget:// 等</p><p>}, function(ret,err){</p><p>//ret = {status:true,data:""}</p><p>}); //err = {code:0,msg:""}</p><p>api.writeFile({path:"PathToFile",//文件路徑，支持絕對路徑和文件路徑協議如 fs://、cache:// 等，不支持 widget:// 目錄，</p><p>該目錄只讀data:"data",// 文件內容</p><p>append:false// 是否以追加方式寫入數據，默認 false，會清除之前文件內容 }, function(ret,err){</p><p>//ret = {status:true}</p><p>}); //err = {code:0,msg:""}</p><p>如果想獲得更多對文件操作的能力請使用“fs”模塊:</p><p>var fs = api.require('fs');</p><p>// 創建文件 fs.createFile({</p><p>path:'path/to/file'//文件路徑 },function(ret,err){})//ret ={status: true} 是否成功</p><p>// 刪除文件 fs.remove({</p><p>path:'path/to/file'//文件路徑 },function(ret,err){})//ret ={status: true} 是否成功</p><p>// 獲取文件數據的 MD5 值 fs.getMD5({</p><p>path:'path/to/file'//文件路徑 },function(req,err){</p><p>//req = {// status:true,是否成功// md5Str:'' 文件數據的MD5值</p><p>}) //}</p><p>“fs”模塊還提供了很多操作文件和目錄的方法，請參閱相關文檔。</p><p><strong>4. database</strong></p><p>使用“db”模塊操作數據庫，“db”模塊封裝了手機常用數據庫 sqlite 的增刪改查語句，可實現數據的本地存儲，極大地簡化了數據持久化問題，並且支持同步接口。“db”模塊的使用如下:</p><p>var db = api.require('db');</p><p>// 打開數據庫，若不存在則創建新的數據庫 db.openDatabase({</p><p>name: 'name'， //數據庫名稱</p><p>path:'path' // 數據庫所在路徑，不傳時使用默認創建的路徑，可選}, function(ret,err) {</p><p>//ret ={status:true} 是否創建成功 });</p><p>// 關閉數據庫 db.closeDatabase({</p><p>name: 'name'//數據庫名稱 }, function(ret, err) {</p><p>//ret = {//status:true 是否成功</p><p>}); //}</p><p>//執行SQL語句 db.executeSql({</p><p>name: 'name',//數據庫名稱</p><p>sql: 'CREATE TABLEPersons(Id_P int, LastName varchar(255), FirstName varchar(255), A ddressvarchar(255), City varchar(255))'//要執行的SQL語句</p><p>}, function(ret,err) {//ret = {status:true} 是否執行成功</p><p>});</p><p>// 查詢 SQL db.selectSql({</p><p>name: 'name',//數據庫名稱</p><p>sql: 'SELECT *FROM Persons'//查詢SQL字符串 }, function(ret, err) {</p><p>//ret = {//status:true, 是否執行成功// data:[] 查詢到的數據</p><p>}); //}</p><p><strong>5. 存儲容量</strong></p><p>APICloud 提供了關於存儲容量的 API，代碼如下:</p><p>api.getFreeDiskSpace({sync:false//執行結果的返回方式。為 false 時通過 callback 返回，為 true 時直接返回，默認false</p><p>},function(ret,err){//ret = {size:1024} 剩餘存儲空間大小，單位為Byte，數字類型。(-1:無存儲設備、-2:正在準備USB存</p><p>儲設備、-3 :無法訪問存儲設備) });</p><p>api.getTotalSpace({sync:false//執行結果的返回方式。為false時通過callback返回，為true時直接返回，默認false</p><p>},function(ret,err){//ret = {size:1024} 總存儲空間大小，單位為Byte，數字類型。(-1:無存儲設備、-2:正在準備USB存儲設備、-3 :無法訪問存儲設備) });</p><p>api.getCacheSize({sync:false//執行結果的返回方式。為 false 時通過 callback 返回，為 true 時直接返回，默認false},function(ret,err){//ret = {size} 緩存大小，單位為Byte，數字類型。(-1:無存儲設備、-2:正在準備USB存儲設備、-3:無法訪問存儲設備)});</p><p>api.clearCache({timeThreshold:10//(可選項)清除多少天前的緩存，默認 0</p><p>},function(ret,err){ }); //清除完成</p><p><strong>6. 沙箱機制</strong></p><p>在 Android 和 iOS 中均採用虛擬沙箱的機制來保障數據存儲的安全和獨立，app 只能訪問自己文件系統的沙箱區域。沙箱位置如下：</p><p>• Android 的默認沙箱位置:sdcard/UZMap/appId。</p><p>• iOS 的默認沙箱位置:Documents/uzfs/appId。</p><p>可以通過修改 config.xml 中的 sandbox 屬性來指定 Android 沙箱位置: &lt;widget id="A1234567890123", sandbox="myBox"> 通過以上配置，app 將在 Android 手機的外部存儲(如 SD 卡)的根目錄中建立名為“myBox” 的目錄，並以該目錄作為本 app 的沙箱目錄，app 運行過程中動態產生的資源文件將存儲在該目錄及其子目錄下，並且這些資源不會隨著 app 的卸載而清除。</p><p><strong>7．資源訪問協議</strong></p><p>APICloud 資源被存放在 app 安裝包(ipa 包或者 apk 包)中或應用沙箱中。沙箱分為 APICloud 應用虛擬沙箱和 Native 應用真實沙箱，真實沙箱是操作系統為 app 在設備內部存儲上分配的空間，不可見，只允許 app 本身訪問。訪問這些位置的資源可以使用如下協議:</p><p>• widget://(訪問安裝包中的資源，根目錄指向你的項目代碼根路徑，即 widget路徑。只讀屬性);</p><p>•fs:/(/訪問APICloud應用虛擬沙箱中資源，可讀可寫);</p><p>•cache://(訪問本地緩存中的資源，存儲在該路徑下的資源，在調用 api.clearCache 時將 被清除。可讀可寫);</p><p>•box://(訪問應用真實沙箱中的資源，私密數據建議使用本協議操作。可讀可寫)。 相關路徑可以通過如下代碼獲取:</p><p>api.wgtDir(返回 widget 包根路徑);</p><p>api.fsDir(返回 APICloud 應用虛擬沙箱根路徑);</p><p>api.cacheDir(返回緩存根路徑);</p><p>api.boxDir(返回應用真實沙箱根路徑)。</p><p><strong>8. 圖片緩存</strong></p><p>對於圖片緩存，可使用如下代碼:</p><p>var img = $api.byId("myImg");</p><p>api.imageCache({</p><p>url:'http://example.com/dir/file.png'</p><p>},function(ret,err){</p><p>if(ret && ret.status == true){</p><p>} img.src = ret.url;</p><p>else{} //處理錯誤 });</p><p>上述代碼首先在參數中指定了要緩存的遠程圖片路徑(url)，在之後的回調函數中判斷是否緩存成功(if(ret && ret.status == true){})，如果成功就可以使用 ret.url 來更新 &lt;img> 標籤。ret.url 是圖片緩存到本地後的路徑。</p><p>這裡實現了圖片緩存，app 在第一次從指定位置加載圖片後會緩存到本地存儲上面，下次使用時會直接調用緩存，以此提升加載速度和渲染效率。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>乾貨</a></li><li><a>存儲</a></li><li><a>圖片</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/efdb7210.html alt=乾貨丨光纖跳線類型、尾纖類型（附PPT全文） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/cb29513613c245eb85b248ac90e3b149 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/efdb7210.html title=乾貨丨光纖跳線類型、尾纖類型（附PPT全文）>乾貨丨光纖跳線類型、尾纖類型（附PPT全文）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/24b0e60e.html alt=乾貨|西大學長教你玩轉計算機07——圖像導數實戰 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/74830a84f854431294e917cf61f29fb7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/24b0e60e.html title=乾貨|西大學長教你玩轉計算機07——圖像導數實戰>乾貨|西大學長教你玩轉計算機07——圖像導數實戰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/02402c9e.html alt=「乾貨」藍牙耳機編碼（SBC、AAC、aptX）都有啥區別？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/feb0ab00-bb82-4c38-9e77-e3570f56137d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/02402c9e.html title=「乾貨」藍牙耳機編碼（SBC、AAC、aptX）都有啥區別？>「乾貨」藍牙耳機編碼（SBC、AAC、aptX）都有啥區別？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ce442e1f.html alt=【購房乾貨】層高和淨高的區別？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ba8f2c776647469baae689a0da1b401d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ce442e1f.html title=【購房乾貨】層高和淨高的區別？>【購房乾貨】層高和淨高的區別？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6d98984a.html alt=重磅乾貨！柯春曉談“世界一流企業的創新生態與知識創新服務業” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2211f4f2f5c349ffa46e9937b47c9f39 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6d98984a.html title=重磅乾貨！柯春曉談“世界一流企業的創新生態與知識創新服務業”>重磅乾貨！柯春曉談“世界一流企業的創新生態與知識創新服務業”</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ac4494ba.html alt=乾貨｜機械行業面試題大整合，興許哪天就用上了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/4f9b97c36b5848f4af9c56ac14d665cf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ac4494ba.html title=乾貨｜機械行業面試題大整合，興許哪天就用上了>乾貨｜機械行業面試題大整合，興許哪天就用上了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/652f4ceb.html alt=智慧電廠乾貨｜火電燃煤機組APS啟動步序設計管窺 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/RsEtY3nI5h4LXq style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/652f4ceb.html title=智慧電廠乾貨｜火電燃煤機組APS啟動步序設計管窺>智慧電廠乾貨｜火電燃煤機組APS啟動步序設計管窺</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bfcc99b0.html alt=智慧電廠乾貨｜火電燃煤機組APS邏輯步序設計管窺：停機步序設計點評 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/RsEtY3nI5h4LXq style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bfcc99b0.html title=智慧電廠乾貨｜火電燃煤機組APS邏輯步序設計管窺：停機步序設計點評>智慧電廠乾貨｜火電燃煤機組APS邏輯步序設計管窺：停機步序設計點評</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0756d624.html alt=40億像素的圖片到底有多清楚？幾百米外能看到毛孔 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/3b03000053d1f613ef3c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0756d624.html title=40億像素的圖片到底有多清楚？幾百米外能看到毛孔>40億像素的圖片到底有多清楚？幾百米外能看到毛孔</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/748f28e8.html alt=一張800億像素的圖片，10公里外可以看到你家窗戶 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1528891037552a23fde99aa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/748f28e8.html title=一張800億像素的圖片，10公里外可以看到你家窗戶>一張800億像素的圖片，10公里外可以看到你家窗戶</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3e1ab8af.html alt=乾貨｜你知道像素和分辨率的關係嗎？（轉載） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1538281328795ef3472794a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3e1ab8af.html title=乾貨｜你知道像素和分辨率的關係嗎？（轉載）>乾貨｜你知道像素和分辨率的關係嗎？（轉載）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/38ae079e.html alt=乾貨｜建築工程測量常見的錯誤分析，測量人一定要知道！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/b2e4d031-2bd9-4ad0-83b1-b4efc2c7cdb5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/38ae079e.html title=乾貨｜建築工程測量常見的錯誤分析，測量人一定要知道！>乾貨｜建築工程測量常見的錯誤分析，測量人一定要知道！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7d8b2470.html alt=固定翼乾貨教學（一）|滾轉技能的前置——側飛 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0db847e70bb246fa984b944ad03c867c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7d8b2470.html title=固定翼乾貨教學（一）|滾轉技能的前置——側飛>固定翼乾貨教學（一）|滾轉技能的前置——側飛</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/56844b1a.html alt=乾貨！鋼結構焊接中局部變形的預防措施 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/2257712ee72b4328897d67ef1b3090ce style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/56844b1a.html title=乾貨！鋼結構焊接中局部變形的預防措施>乾貨！鋼結構焊接中局部變形的預防措施</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/16ff516f.html alt=乾貨滿滿，大眾寶來後尾板切割案例分析 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/79792dd3520447838f2934fed4dc0c14 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/16ff516f.html title=乾貨滿滿，大眾寶來後尾板切割案例分析>乾貨滿滿，大眾寶來後尾板切割案例分析</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>