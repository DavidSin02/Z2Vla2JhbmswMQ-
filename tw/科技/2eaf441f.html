<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>MySQL 最全語法大全 | 极客快訊</title><meta property="og:title" content="MySQL 最全語法大全 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2eaf441f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2eaf441f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2eaf441f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2eaf441f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2eaf441f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2eaf441f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/2eaf441f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/2eaf441f.html><meta property="article:published_time" content="2020-11-14T21:04:12+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:12+08:00"><meta name=Keywords content><meta name=description content="MySQL 最全語法大全"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/2eaf441f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>MySQL 最全語法大全</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><br></p><p>Windows服務</p><p>-- 啟動MySQL</p><p>net start mysql</p><p>-- 創建Windows服務</p><p>sc create mysql binPath= mysqld_bin_path(注意：等號與值之間有空格)</p><p>連接與斷開服務器</p><p>mysql -h 地址 -P 端口 -u 用戶名 -p 密碼</p><p></p><p>SHOW PROCESSLIST -- 顯示哪些線程正在運行</p><p>SHOW VARIABLES -- 顯示系統變量信息</p><p>數據庫操作</p><p>-- 查看當前數據庫</p><p>SELECT DATABASE();</p><p>-- 顯示當前時間、用戶名、數據庫版本</p><p>SELECT now(), user(), version();</p><p>-- 創建庫</p><p>CREATE DATABASE[ IF NOT EXISTS] 數據庫名 數據庫選項</p><p>數據庫選項：</p><p>CHARACTER SET charset_name</p><p>COLLATE collation_name</p><p>-- 查看已有庫</p><p>SHOW DATABASES[ LIKE 'PATTERN']</p><p>-- 查看當前庫信息</p><p>SHOW CREATE DATABASE 數據庫名</p><p>-- 修改庫的選項信息</p><p>ALTER DATABASE 庫名 選項信息</p><p>-- 刪除庫</p><p>DROP DATABASE[ IF EXISTS] 數據庫名</p><p>同時刪除該數據庫相關的目錄及其目錄內容</p><p>表的操作</p><p>-- 創建表</p><p>CREATE [TEMPORARY] TABLE[ IF NOT EXISTS] [庫名.]表名 ( 表的結構定義 )[ 表選項]</p><p>每個字段必須有數據類型</p><p>最後一個字段後不能有逗號</p><p>TEMPORARY 臨時表，會話結束時表自動消失</p><p>對於字段的定義：</p><p>字段名 數據類型 [NOT NULL | NULL] [DEFAULT default_value] [AUTO_INCREMENT] [UNIQUE [KEY] | [PRIMARY] KEY] [COMMENT 'string']</p><p>-- 表選項</p><p>-- 字符集</p><p>CHARSET = charset_name</p><p>如果表沒有設定，則使用數據庫字符集</p><p>-- 存儲引擎</p><p>ENGINE = engine_name</p><p>表在管理數據時採用的不同的數據結構，結構不同會導致處理方式、提供的特性操作等不同</p><p>常見的引擎：InnoDB MyISAM Memory/Heap BDB Merge Example CSV MaxDB Archive</p><p>不同的引擎在保存表的結構和數據時採用不同的方式</p><p>MyISAM表文件含義：.frm表定義，.MYD表數據，.MYI表索引</p><p>InnoDB表文件含義：.frm表定義，表空間數據和日誌文件</p><p>SHOW ENGINES -- 顯示存儲引擎的狀態信息</p><p>SHOW ENGINE 引擎名 {LOGS|STATUS} -- 顯示存儲引擎的日誌或狀態信息</p><p>-- 自增起始數</p><p>AUTO_INCREMENT = 行數</p><p>-- 數據文件目錄</p><p>DATA DIRECTORY = '目錄'</p><p>-- 索引文件目錄</p><p>INDEX DIRECTORY = '目錄'</p><p>-- 表註釋</p><p>COMMENT = 'string'</p><p>-- 分區選項</p><p>PARTITION BY ... (詳細見手冊)</p><p>-- 查看所有表</p><p>SHOW TABLES[ LIKE 'pattern']</p><p>SHOW TABLES FROM 表名</p><p>-- 查看錶機構</p><p>SHOW CREATE TABLE 表名 （信息更詳細）</p><p>DESC 表名 / DESCRIBE 表名 / EXPLAIN 表名 / SHOW COLUMNS FROM 表名 [LIKE 'PATTERN']</p><p>SHOW TABLE STATUS [FROM db_name] [LIKE 'pattern']</p><p>-- 修改表</p><p>-- 修改表本身的選項</p><p>ALTER TABLE 表名 表的選項</p><p>eg: ALTER TABLE 表名 ENGINE=MYISAM;</p><p>-- 對錶進行重命名</p><p>RENAME TABLE 原表名 TO 新表名</p><p>RENAME TABLE 原表名 TO 庫名.表名 （可將表移動到另一個數據庫）</p><p>-- RENAME可以交換兩個表名</p><p>-- 修改表的字段機構（13.1.2. ALTER TABLE語法）</p><p>ALTER TABLE 表名 操作名</p><p>-- 操作名</p><p>ADD[ COLUMN] 字段定義 -- 增加字段</p><p>AFTER 字段名 -- 表示增加在該字段名後面</p><p>FIRST -- 表示增加在第一個</p><p>ADD PRIMARY KEY(字段名) -- 創建主鍵</p><p>ADD UNIQUE [索引名] (字段名)-- 創建唯一索引</p><p>ADD INDEX [索引名] (字段名) -- 創建普通索引</p><p>DROP[ COLUMN] 字段名 -- 刪除字段</p><p>MODIFY[ COLUMN] 字段名 字段屬性 -- 支持對字段屬性進行修改，不能修改字段名(所有原有屬性也需寫上)</p><p>CHANGE[ COLUMN] 原字段名 新字段名 字段屬性 -- 支持對字段名修改</p><p>DROP PRIMARY KEY -- 刪除主鍵(刪除主鍵前需刪除其AUTO_INCREMENT屬性)</p><p>DROP INDEX 索引名 -- 刪除索引</p><p>DROP FOREIGN KEY 外鍵 -- 刪除外鍵</p><p>-- 刪除表</p><p>DROP TABLE[ IF EXISTS] 表名 ...</p><p>-- 清空表數據</p><p>TRUNCATE [TABLE] 表名</p><p>-- 複製表結構</p><p>CREATE TABLE 表名 LIKE 要複製的表名</p><p>-- 複製表結構和數據</p><p>CREATE TABLE 表名 [AS] SELECT * FROM 要複製的表名</p><p>-- 檢查表是否有錯誤</p><p>CHECK TABLE tbl_name [, tbl_name] ... [option] ...</p><p>-- 優化表</p><p>OPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...</p><p>-- 修復表</p><p>REPAIR [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ... [QUICK] [EXTENDED] [USE_FRM]</p><p>-- 分析表</p><p>ANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...</p><p>數據操作</p><p>-- 增</p><p>INSERT [INTO] 表名 [(字段列表)] VALUES (值列表)[, (值列表), ...]</p><p>-- 如果要插入的值列表包含所有字段並且順序一致，則可以省略字段列表。</p><p>-- 可同時插入多條數據記錄！</p><p>REPLACE 與 INSERT 完全一樣，可互換。</p><p>INSERT [INTO] 表名 SET 字段名=值[, 字段名=值, ...]</p><p>-- 查</p><p>SELECT 字段列表 FROM 表名[ 其他子句]</p><p>-- 可來自多個表的多個字段</p><p>-- 其他子句可以不使用</p><p>-- 字段列表可以用*代替，表示所有字段</p><p>-- 刪</p><p>DELETE FROM 表名[ 刪除條件子句]</p><p>沒有條件子句，則會刪除全部</p><p>-- 改</p><p>UPDATE 表名 SET 字段名=新值[, 字段名=新值] [更新條件]</p><p>字符集編碼</p><p>-- MySQL、數據庫、表、字段均可設置編碼</p><p>-- 數據編碼與客戶端編碼不需一致</p><p>SHOW VARIABLES LIKE 'character_set_%' -- 查看所有字符集編碼項</p><p>character_set_client 客戶端向服務器發送數據時使用的編碼</p><p>character_set_results 服務器端將結果返回給客戶端所使用的編碼</p><p>character_set_connection 連接層編碼</p><p>SET 變量名 = 變量值</p><p>SET character_set_client = gbk;</p><p>SET character_set_results = gbk;</p><p>SET character_set_connection = gbk;</p><p>SET NAMES GBK; -- 相當於完成以上三個設置</p><p>-- 校對集</p><p>校對集用以排序</p><p>SHOW CHARACTER SET [LIKE 'pattern']/SHOW CHARSET [LIKE 'pattern'] 查看所有字符集</p><p>SHOW COLLATION [LIKE 'pattern'] 查看所有校對集</p><p>CHARSET 字符集編碼 設置字符集編碼</p><p>COLLATE 校對集編碼 設置校對集編碼</p><p>數據類型（列類型）</p><p>1. 數值類型</p><p></p><p>-- a. 整型 ----------</p><p>類型 字節 範圍（有符號位）</p><p>tinyint 1字節 -128 ~ 127 無符號位：0 ~ 255</p><p>smallint 2字節 -32768 ~ 32767</p><p>mediumint 3字節 -8388608 ~ 8388607</p><p>int 4字節</p><p>bigint 8字節</p><p>int(M) M表示總位數</p><p>- 默認存在符號位，unsigned 屬性修改</p><p>- 顯示寬度，如果某個數不夠定義字段時設置的位數，則前面以0補填，zerofill 屬性修改</p><p>例：int(5) 插入一個數'123'，補填後為'00123'</p><p>- 在滿足要求的情況下，越小越好。</p><p>- 1表示bool值真，0表示bool值假。MySQL沒有布爾類型，通過整型0和1表示。常用tinyint(1)表示布爾型。</p><p></p><p>-- b. 浮點型 ----------</p><p>類型 字節 範圍</p><p>float(單精度) 4字節</p><p>double(雙精度) 8字節</p><p>浮點型既支持符號位 unsigned 屬性，也支持顯示寬度 zerofill 屬性。</p><p>不同於整型，前後均會補填0.</p><p>定義浮點型時，需指定總位數和小數位數。</p><p>float(M, D) double(M, D)</p><p>M表示總位數，D表示小數位數。</p><p>M和D的大小會決定浮點數的範圍。不同於整型的固定範圍。</p><p>M既表示總位數（不包括小數點和正負號），也表示顯示寬度（所有顯示符號均包括）。</p><p>支持科學計數法表示。</p><p>浮點數表示近似值。</p><p></p><p>-- c. 定點數 ----------</p><p>decimal -- 可變長度</p><p>decimal(M, D) M也表示總位數，D表示小數位數。</p><p>保存一個精確的數值，不會發生數據的改變，不同於浮點數的四捨五入。</p><p>將浮點數轉換為字符串來保存，每9位數字保存為4個字節。</p><p></p><p>2. 字符串類型</p><p></p><p>-- a. char, varchar ----------</p><p>char 定長字符串，速度快，但浪費空間</p><p>varchar 變長字符串，速度慢，但節省空間</p><p>M表示能存儲的最大長度，此長度是字符數，非字節數。</p><p>不同的編碼，所佔用的空間不同。</p><p>char,最多255個字符，與編碼無關。</p><p>varchar,最多65535字符，與編碼有關。</p><p>一條有效記錄最大不能超過65535個字節。</p><p>utf8 最大為21844個字符，gbk 最大為32766個字符，latin1 最大為65532個字符</p><p>varchar 是變長的，需要利用存儲空間保存 varchar 的長度，如果數據小於255個字節，則採用一個字節來保存長度，反之需要兩個字節來保存。</p><p>varchar 的最大有效長度由最大行大小和使用的字符集確定。</p><p>最大有效長度是65532字節，因為在varchar存字符串時，第一個字節是空的，不存在任何數據，然後還需兩個字節來存放字符串的長度，所以有效長度是64432-1-2=65532字節。</p><p>例：若一個表定義為 CREATE TABLE tb(c1 int, c2 char(30), c3 varchar(N)) charset=utf8; 問N的最大值是多少？ 答：(65535-1-2-4-30*3)/3</p><p></p><p>-- b. blob, text ----------</p><p>blob 二進制字符串（字節字符串）</p><p>tinyblob, blob, mediumblob, longblob</p><p>text 非二進制字符串（字符字符串）</p><p>tinytext, text, mediumtext, longtext</p><p>text 在定義時，不需要定義長度，也不會計算總長度。</p><p>text 類型在定義時，不可給default值</p><p></p><p>-- c. binary, varbinary ----------</p><p>類似於char和varchar，用於保存二進制字符串，也就是保存字節字符串而非字符字符串。</p><p>char, varchar, text 對應 binary, varbinary, blob.</p><p></p><p>3. 日期時間類型</p><p>一般用整型保存時間戳，因為PHP可以很方便的將時間戳進行格式化。</p><p>datetime 8字節 日期及時間 1000-01-01 00:00:00 到 9999-12-31 23:59:59</p><p>date 3字節 日期 1000-01-01 到 9999-12-31</p><p>timestamp 4字節 時間戳 19700101000000 到 2038-01-19 03:14:07</p><p>time 3字節 時間 -838:59:59 到 838:59:59</p><p>year 1字節 年份 1901 - 2155</p><p>datetime YYYY-MM-DD hh:mm:ss</p><p>timestamp YY-MM-DD hh:mm:ss</p><p>YYYYMMDDhhmmss</p><p>YYMMDDhhmmss</p><p>YYYYMMDDhhmmss</p><p>YYMMDDhhmmss</p><p>date YYYY-MM-DD</p><p>YY-MM-DD</p><p>YYYYMMDD</p><p>YYMMDD</p><p>YYYYMMDD</p><p>YYMMDD</p><p>time hh:mm:ss</p><p>hhmmss</p><p>hhmmss</p><p>year YYYY</p><p>YY</p><p>YYYY</p><p>YY</p><p></p><p>4. 枚舉和集合</p><p></p><p>-- 枚舉(enum) ----------</p><p>enum(val1, val2, val3...)</p><p>在已知的值中進行單選。最大數量為65535.</p><p>枚舉值在保存時，以2個字節的整型(smallint)保存。每個枚舉值，按保存的位置順序，從1開始逐一遞增。</p><p>表現為字符串類型，存儲卻是整型。</p><p>NULL值的索引是NULL。</p><p>空字符串錯誤值的索引值是0。</p><p><br></p><p>-- 集合（set） ----------</p><p>set(val1, val2, val3...)</p><p>create table tab ( gender set('男', '女', '無') );</p><p>insert into tab values ('男, 女');</p><p>最多可以有64個不同的成員。以bigint存儲，共8個字節。採取位運算的形式。</p><p>當創建表時，SET成員值的尾部空格將自動被刪除。</p><p>選擇類型</p><p>-- PHP角度</p><p>1. 功能滿足</p><p>2. 存儲空間儘量小，處理效率更高</p><p>3. 考慮兼容問題</p><p></p><p>-- IP存儲 ----------</p><p>1. 只需存儲，可用字符串</p><p>2. 如果需計算，查找等，可存儲為4個字節的無符號int，即unsigned</p><p>1) PHP函數轉換</p><p>ip2long可轉換為整型，但會出現攜帶符號問題。需格式化為無符號的整型。</p><p>利用sprintf函數格式化字符串</p><p>sprintf("%u", ip2long('192.168.3.134'));</p><p>然後用long2ip將整型轉回IP字符串</p><p>2) MySQL函數轉換(無符號整型，UNSIGNED)</p><p>INET_ATON('127.0.0.1') 將IP轉為整型</p><p>INET_NTOA(2130706433) 將整型轉為IP</p><p>列屬性（列約束）</p><p>1. PRIMARY 主鍵</p><p>- 能唯一標識記錄的字段，可以作為主鍵。</p><p>- 一個表只能有一個主鍵。</p><p>- 主鍵具有唯一性。</p><p>- 聲明字段時，用 primary key 標識。</p><p>也可以在字段列表之後聲明</p><p>例：create table tab ( id int, stu varchar(10), primary key (id));</p><p>- 主鍵字段的值不能為null。</p><p>- 主鍵可以由多個字段共同組成。此時需要在字段列表後聲明的方法。</p><p>例：create table tab ( id int, stu varchar(10), age int, primary key (stu, age));</p><p>2. UNIQUE 唯一索引（唯一約束）</p><p>使得某字段的值也不能重複。</p><p>3. NULL 約束</p><p>null不是數據類型，是列的一個屬性。</p><p>表示當前列是否可以為null，表示什麼都沒有。</p><p>null, 允許為空。默認。</p><p>not null, 不允許為空。</p><p>insert into tab values (null, 'val');</p><p>-- 此時表示將第一個字段的值設為null, 取決於該字段是否允許為null</p><p>4. DEFAULT 默認值屬性</p><p>當前字段的默認值。</p><p>insert into tab values (default, 'val'); -- 此時表示強制使用默認值。</p><p>create table tab ( add_time timestamp default current_timestamp );</p><p>-- 表示將當前時間的時間戳設為默認值。</p><p>current_date, current_time</p><p>5. AUTO_INCREMENT 自動增長約束</p><p>自動增長必須為索引（主鍵或unique）</p><p>只能存在一個字段為自動增長。</p><p>默認為1開始自動增長。可以通過表屬性 auto_increment = x進行設置，或 alter table tbl auto_increment = x;</p><p>6. COMMENT 註釋</p><p>例：create table tab ( id int ) comment '註釋內容';</p><p>7. FOREIGN KEY 外鍵約束</p><p>用於限制主表與從表數據完整性。</p><p>alter table t1 add constraint `t1_t2_fk` foreign key (t1_id) references t2(id);</p><p>-- 將表t1的t1_id外鍵關聯到表t2的id字段。</p><p>-- 每個外鍵都有一個名字，可以通過 constraint 指定</p><p>存在外鍵的表，稱之為從表（子表），外鍵指向的表，稱之為主表（父表）。</p><p>作用：保持數據一致性，完整性，主要目的是控制存儲在外鍵表（從表）中的數據。</p><p>MySQL中，可以對InnoDB引擎使用外鍵約束：</p><p>語法：</p><p>foreign key (外鍵字段） references 主表名 (關聯字段) [主表記錄刪除時的動作] [主表記錄更新時的動作]</p><p>此時需要檢測一個從表的外鍵需要約束為主表的已存在的值。外鍵在沒有關聯的情況下，可以設置為null.前提是該外鍵列，沒有not null。</p><p>可以不指定主表記錄更改或更新時的動作，那麼此時主表的操作被拒絕。</p><p>如果指定了 on update 或 on delete：在刪除或更新時，有如下幾個操作可以選擇：</p><p>1. cascade，級聯操作。主表數據被更新（主鍵值更新），從表也被更新（外鍵值更新）。主表記錄被刪除，從表相關記錄也被刪除。</p><p>2. set null，設置為null。主表數據被更新（主鍵值更新），從表的外鍵被設置為null。主表記錄被刪除，從表相關記錄外鍵被設置成null。但注意，要求該外鍵列，沒有not null屬性約束。</p><p>3. restrict，拒絕父表刪除和更新。</p><p>注意，外鍵只被InnoDB存儲引擎所支持。其他引擎是不支持的。</p><p>建表規範</p><p>-- Normal Format, NF</p><p>- 每個表保存一個實體信息</p><p>- 每個具有一個ID字段作為主鍵</p><p>- ID主鍵 + 原子表</p><p>-- 1NF, 第一範式</p><p>字段不能再分，就滿足第一範式。</p><p>-- 2NF, 第二範式</p><p>滿足第一範式的前提下，不能出現部分依賴。</p><p>消除符合主鍵就可以避免部分依賴。增加單列關鍵字。</p><p>-- 3NF, 第三範式</p><p>滿足第二範式的前提下，不能出現傳遞依賴。</p><p>某個字段依賴於主鍵，而有其他字段依賴於該字段。這就是傳遞依賴。</p><p>將一個實體信息的數據放在一個表內實現。</p><p>SELECT</p><p>SELECT [ALL|DISTINCT] select_expr FROM -> WHERE -> GROUP BY [合計函數] -> HAVING -> ORDER BY -> LIMIT</p><p>a. select_expr</p><p>-- 可以用 * 表示所有字段。</p><p>select * from tb;</p><p>-- 可以使用表達式（計算公式、函數調用、字段也是個表達式）</p><p>select stu, 29+25, now() from tb;</p><p>-- 可以為每個列使用別名。適用於簡化列標識，避免多個列標識符重複。</p><p>- 使用 as 關鍵字，也可省略 as.</p><p>select stu+10 as add10 from tb;</p><p>b. FROM 子句</p><p>用於標識查詢來源。</p><p>-- 可以為表起別名。使用as關鍵字。</p><p>SELECT * FROM tb1 AS tt, tb2 AS bb;</p><p>-- from子句後，可以同時出現多個表。</p><p>-- 多個表會橫向疊加到一起，而數據會形成一個笛卡爾積。</p><p>SELECT * FROM tb1, tb2;</p><p>-- 向優化符提示如何選擇索引</p><p>USE INDEX、IGNORE INDEX、FORCE INDEX</p><p>SELECT * FROM table1 USE INDEX (key1,key2) WHERE key1=1 AND key2=2 AND key3=3;</p><p>SELECT * FROM table1 IGNORE INDEX (key3) WHERE key1=1 AND key2=2 AND key3=3;</p><p>c. WHERE 子句</p><p>-- 從from獲得的數據源中進行篩選。</p><p>-- 整型1表示真，0表示假。</p><p>-- 表達式由運算符和運算數組成。</p><p>-- 運算數：變量（字段）、值、函數返回值</p><p>-- 運算符：</p><p>=, &lt;=>, &lt;>, !=, &lt;=, &lt;, >=, >, !, &&, ||,</p><p>in (not) null, (not) like, (not) in, (not) between and, is (not), and, or, not, xor</p><p>is/is not 加上ture/false/unknown，檢驗某個值的真假</p><p>&lt;=>與&lt;>功能相同，&lt;=>可用於null比較</p><p>d. GROUP BY 子句, 分組子句</p><p>GROUP BY 字段/別名 [排序方式]</p><p>分組後會進行排序。升序：ASC，降序：DESC</p><p>以下[合計函數]需配合 GROUP BY 使用：</p><p>count 返回不同的非NULL值數目 count(*)、count(字段)</p><p>sum 求和</p><p>max 求最大值</p><p>min 求最小值</p><p>avg 求平均值</p><p>group_concat 返回帶有來自一個組的連接的非NULL值的字符串結果。組內字符串連接。</p><p>e. HAVING 子句，條件子句</p><p>與 where 功能、用法相同，執行時機不同。</p><p>where 在開始時執行檢測數據，對原數據進行過濾。</p><p>having 對篩選出的結果再次進行過濾。</p><p>having 字段必須是查詢出來的，where 字段必須是數據表存在的。</p><p>where 不可以使用字段的別名，having 可以。因為執行WHERE代碼時，可能尚未確定列值。</p><p>where 不可以使用合計函數。一般需用合計函數才會用 having</p><p>SQL標準要求HAVING必須引用GROUP BY子句中的列或用於合計函數中的列。</p><p>f. ORDER BY 子句，排序子句</p><p>order by 排序字段/別名 排序方式 [,排序字段/別名 排序方式]...</p><p>升序：ASC，降序：DESC</p><p>支持多個字段的排序。</p><p>g. LIMIT 子句，限制結果數量子句</p><p>僅對處理好的結果進行數量限制。將處理好的結果的看作是一個集合，按照記錄出現的順序，索引從0開始。</p><p>limit 起始位置, 獲取條數</p><p>省略第一個參數，表示從索引0開始。limit 獲取條數</p><p>h. DISTINCT, ALL 選項</p><p>distinct 去除重複記錄</p><p>默認為 all, 全部記錄</p><p>UNION</p><p>將多個select查詢的結果組合成一個結果集合。</p><p>SELECT ... UNION [ALL|DISTINCT] SELECT ...</p><p>默認 DISTINCT 方式，即所有返回的行都是唯一的</p><p>建議，對每個SELECT查詢加上小括號包裹。</p><p>ORDER BY 排序時，需加上 LIMIT 進行結合。</p><p>需要各select查詢的字段數量一樣。</p><p>每個select查詢的字段列表(數量、類型)應一致，因為結果中的字段名以第一條select語句為準。</p><p>子查詢</p><p>- 子查詢需用括號包裹。</p><p>-- from型</p><p>from後要求是一個表，必須給子查詢結果取個別名。</p><p>- 簡化每個查詢內的條件。</p><p>- from型需將結果生成一個臨時表格，可用以原表的鎖定的釋放。</p><p>- 子查詢返回一個表，表型子查詢。</p><p>select * from (select * from tb where id>0) as subfrom where id>1;</p><p>-- where型</p><p>- 子查詢返回一個值，標量子查詢。</p><p>- 不需要給子查詢取別名。</p><p>- where子查詢內的表，不能直接用以更新。</p><p>select * from tb where money = (select max(money) from tb);</p><p>-- 列子查詢</p><p>如果子查詢結果返回的是一列。</p><p>使用 in 或 not in 完成查詢</p><p>exists 和 not exists 條件</p><p>如果子查詢返回數據，則返回1或0。常用於判斷條件。</p><p>select column1 from t1 where exists (select * from t2);</p><p>-- 行子查詢</p><p>查詢條件是一個行。</p><p>select * from t1 where (id, gender) in (select id, gender from t2);</p><p>行構造符：(col1, col2, ...) 或 ROW(col1, col2, ...)</p><p>行構造符通常用於與對能返回兩個或兩個以上列的子查詢進行比較。</p><p>-- 特殊運算符</p><p>!= all() 相當於 not in</p><p>= some() 相當於 in。any 是 some 的別名</p><p>!= some() 不等同於 not in，不等於其中某一個。</p><p>all, some 可以配合其他運算符一起使用。</p><p>連接查詢(join)</p><p>將多個表的字段進行連接，可以指定連接條件。</p><p>-- 內連接(inner join)</p><p>- 默認就是內連接，可省略inner。</p><p>- 只有數據存在時才能發送連接。即連接結果不能出現空行。</p><p>on 表示連接條件。其條件表達式與where類似。也可以省略條件（表示條件永遠為真）</p><p>也可用where表示連接條件。</p><p>還有 using, 但需字段名相同。 using(字段名)</p><p>-- 交叉連接 cross join</p><p>即，沒有條件的內連接。</p><p>select * from tb1 cross join tb2;</p><p>-- 外連接(outer join)</p><p>- 如果數據不存在，也會出現在連接結果中。</p><p>-- 左外連接 left join</p><p>如果數據不存在，左表記錄會出現，而右表為null填充</p><p>-- 右外連接 right join</p><p>如果數據不存在，右表記錄會出現，而左表為null填充</p><p>-- 自然連接(natural join)</p><p>自動判斷連接條件完成連接。</p><p>相當於省略了using，會自動查找相同字段名。</p><p>natural join</p><p>natural left join</p><p>natural right join</p><p></p><p>select info.id, info.name, info.stu_num, extra_info.hobby, extra_info.sex from info, extra_info where info.stu_num = extra_info.stu_id;</p><p>導出</p><p>select * into outfile 文件地址 [控制格式] from 表名; -- 導出表數據</p><p></p><p>load data [local] infile 文件地址 [replace|ignore] into table 表名 [控制格式]; -- 導入數據</p><p>生成的數據默認的分隔符是製表符</p><p>local未指定，則數據文件必須在服務器上</p><p>replace 和 ignore 關鍵詞控制對現有的唯一鍵記錄的重複的處理</p><p>-- 控制格式</p><p>fields 控制字段格式</p><p>默認：fields terminated by ' ' enclosed by '' escaped by '\'</p><p>terminated by 'string' -- 終止</p><p>enclosed by 'char' -- 包裹</p><p>escaped by 'char' -- 轉義</p><p>-- 示例：</p><p>SELECT a,b,a+b INTO OUTFILE '/tmp/result.text'</p><p>FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"'</p><p>LINES TERMINATED BY '<br>'</p><p>FROM test_table;</p><p>lines 控制行格式</p><p>默認：lines terminated by '<br>'</p><p>terminated by 'string' -- 終止</p><p>INSERT</p><p>select語句獲得的數據可以用insert插入。</p><p>可以省略對列的指定，要求 values () 括號內，提供給了按照列順序出現的所有字段的值。</p><p>或者使用set語法。</p><p>INSERT INTO tbl_name SET field=value,...；</p><p>可以一次性使用多個值，採用(), (), ();的形式。</p><p>INSERT INTO tbl_name VALUES (), (), ();</p><p>可以在列值指定時，使用表達式。</p><p>INSERT INTO tbl_name VALUES (field_value, 10+10, now());</p><p>可以使用一個特殊值 DEFAULT，表示該列使用默認值。</p><p>INSERT INTO tbl_name VALUES (field_value, DEFAULT);</p><p>可以通過一個查詢的結果，作為需要插入的值。</p><p>INSERT INTO tbl_name SELECT ...;</p><p>可以指定在插入的值出現主鍵（或唯一索引）衝突時，更新其他非主鍵列的信息。</p><p>INSERT INTO tbl_name VALUES/SET/SELECT ON DUPLICATE KEY UPDATE 字段=值, …;</p><p>DELETE</p><p>DELETE FROM tbl_name [WHERE where_definition] [ORDER BY ...] [LIMIT row_count]</p><p>按照條件刪除。where</p><p>指定刪除的最多記錄數。limit</p><p>可以通過排序條件刪除。order by + limit</p><p>支持多表刪除，使用類似連接語法。</p><p>delete from 需要刪除數據多表1，表2 using 表連接操作 條件。</p><p>TRUNCATE</p><p>TRUNCATE [TABLE] tbl_name</p><p>清空數據</p><p>刪除重建表</p><p>區別：</p><p>1，truncate 是刪除表再創建，delete 是逐條刪除</p><p>2，truncate 重置auto_increment的值。而delete不會</p><p>3，truncate 不知道刪除了幾條，而delete知道。</p><p>4，當被用於帶分區的表時，truncate 會保留分區</p><p>備份與還原</p><p>備份，將數據的結構與表內數據保存起來。</p><p>利用 mysqldump 指令完成。</p><p>-- 導出</p><p>mysqldump [options] db_name [tables]</p><p>mysqldump [options] ---database DB1 [DB2 DB3...]</p><p>mysqldump [options] --all--database</p><p>1. 導出一張表</p><p>mysqldump -u用戶名 -p密碼 庫名 表名 > 文件名(D:/a.sql)</p><p>2. 導出多張表</p><p>mysqldump -u用戶名 -p密碼 庫名 表1 表2 表3 > 文件名(D:/a.sql)</p><p>3. 導出所有表</p><p>mysqldump -u用戶名 -p密碼 庫名 > 文件名(D:/a.sql)</p><p>4. 導出一個庫</p><p>mysqldump -u用戶名 -p密碼 --lock-all-tables --database 庫名 > 文件名(D:/a.sql)</p><p>可以-w攜帶WHERE條件</p><p>-- 導入</p><p>1. 在登錄mysql的情況下：</p><p>source 備份文件</p><p>2. 在不登錄的情況下</p><p>mysql -u用戶名 -p密碼 庫名 &lt; 備份文件</p><p>視圖</p><p>什麼是視圖：</p><p>視圖是一個虛擬表，其內容由查詢定義。同真實的表一樣，視圖包含一系列帶有名稱的列和行數據。但是，視圖並不在數據庫中以存儲的數據值集形式存在。行和列數據來自由定義視圖的查詢所引用的表，並且在引用視圖時動態生成。</p><p>視圖具有表結構文件，但不存在數據文件。</p><p>對其中所引用的基礎表來說，視圖的作用類似於篩選。定義視圖的篩選可以來自當前或其它數據庫的一個或多個表，或者其它視圖。通過視圖進行查詢沒有任何限制，通過它們進行數據修改時的限制也很少。</p><p>視圖是存儲在數據庫中的查詢的sql語句，它主要出於兩種原因：安全原因，視圖可以隱藏一些數據，如：社會保險基金錶，可以用視圖只顯示姓名，地址，而不顯示社會保險號和工資數等，另一原因是可使複雜的查詢易於理解和使用。</p><p>-- 創建視圖</p><p>CREATE [OR REPLACE] [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}] VIEW view_name [(column_list)] AS select_statement</p><p>- 視圖名必須唯一，同時不能與表重名。</p><p>- 視圖可以使用select語句查詢到的列名，也可以自己指定相應的列名。</p><p>- 可以指定視圖執行的算法，通過ALGORITHM指定。</p><p>- column_list如果存在，則數目必須等於SELECT語句檢索的列數</p><p>-- 查看結構</p><p>SHOW CREATE VIEW view_name</p><p>-- 刪除視圖</p><p>- 刪除視圖後，數據依然存在。</p><p>- 可同時刪除多個視圖。</p><p>DROP VIEW [IF EXISTS] view_name ...</p><p>-- 修改視圖結構</p><p>- 一般不修改視圖，因為不是所有的更新視圖都會映射到表上。</p><p>ALTER VIEW view_name [(column_list)] AS select_statement</p><p>-- 視圖作用</p><p>1. 簡化業務邏輯</p><p>2. 對客戶端隱藏真實的表結構</p><p>-- 視圖算法(ALGORITHM)</p><p>MERGE 合併</p><p>將視圖的查詢語句，與外部查詢需要先合併再執行！</p><p>TEMPTABLE 臨時表</p><p>將視圖執行完畢後，形成臨時表，再做外層查詢！</p><p>UNDEFINED 未定義(默認)，指的是MySQL自主去選擇相應的算法。</p><p>事務(transaction)</p><p>事務是指邏輯上的一組操作，組成這組操作的各個單元，要不全成功要不全失敗。</p><p>- 支持連續SQL的集體成功或集體撤銷。</p><p>- 事務是數據庫在數據晚自習方面的一個功能。</p><p>- 需要利用 InnoDB 或 BDB 存儲引擎，對自動提交的特性支持完成。</p><p>- InnoDB被稱為事務安全型引擎。</p><p>-- 事務開啟</p><p>START TRANSACTION; 或者 BEGIN;</p><p>開啟事務後，所有被執行的SQL語句均被認作當前事務內的SQL語句。</p><p>-- 事務提交</p><p>COMMIT;</p><p>-- 事務回滾</p><p>ROLLBACK;</p><p>如果部分操作發生問題，映射到事務開啟前。</p><p>-- 事務的特性</p><p>1. 原子性（Atomicity）</p><p>事務是一個不可分割的工作單位，事務中的操作要麼都發生，要麼都不發生。</p><p>2. 一致性（Consistency）</p><p>事務前後數據的完整性必須保持一致。</p><p>- 事務開始和結束時，外部數據一致</p><p>- 在整個事務過程中，操作是連續的</p><p>3. 隔離性（Isolation）</p><p>多個用戶併發訪問數據庫時，一個用戶的事務不能被其它用戶的事物所幹擾，多個併發事務之間的數據要相互隔離。</p><p>4. 持久性（Durability）</p><p>一個事務一旦被提交，它對數據庫中的數據改變就是永久性的。</p><p>-- 事務的實現</p><p>1. 要求是事務支持的表類型</p><p>2. 執行一組相關的操作前開啟事務</p><p>3. 整組操作完成後，都成功，則提交；如果存在失敗，選擇回滾，則會回到事務開始的備份點。</p><p>-- 事務的原理</p><p>利用InnoDB的自動提交(autocommit)特性完成。</p><p>普通的MySQL執行語句後，當前的數據提交操作均可被其他客戶端可見。</p><p>而事務是暫時關閉“自動提交”機制，需要commit提交持久化數據操作。</p><p>-- 注意</p><p>1. 數據定義語言（DDL）語句不能被回滾，比如創建或取消數據庫的語句，和創建、取消或更改表或存儲的子程序的語句。</p><p>2. 事務不能被嵌套</p><p>-- 保存點</p><p>SAVEPOINT 保存點名稱 -- 設置一個事務保存點</p><p>ROLLBACK TO SAVEPOINT 保存點名稱 -- 回滾到保存點</p><p>RELEASE SAVEPOINT 保存點名稱 -- 刪除保存點</p><p>-- InnoDB自動提交特性設置</p><p>SET autocommit = 0|1; 0表示關閉自動提交，1表示開啟自動提交。</p><p>- 如果關閉了，那普通操作的結果對其他客戶端也不可見，需要commit提交後才能持久化數據操作。</p><p>- 也可以關閉自動提交來開啟事務。但與START TRANSACTION不同的是，</p><p>SET autocommit是永久改變服務器的設置，直到下次再次修改該設置。(針對當前連接)</p><p>而START TRANSACTION記錄開啟前的狀態，而一旦事務提交或回滾後就需要再次開啟事務。(針對當前事務)</p><p>鎖表</p><p>表鎖定只用於防止其它客戶端進行不正當地讀取和寫入</p><p>MyISAM 支持表鎖，InnoDB 支持行鎖</p><p>-- 鎖定</p><p>LOCK TABLES tbl_name [AS alias]</p><p>-- 解鎖</p><p>UNLOCK TABLES</p><p>觸發器</p><p>觸發程序是與表有關的命名數據庫對象，當該表出現特定事件時，將激活該對象</p><p>監聽：記錄的增加、修改、刪除。</p><p>-- 創建觸發器</p><p>CREATE TRIGGER trigger_name trigger_time trigger_event ON tbl_name FOR EACH ROW trigger_stmt</p><p>參數：</p><p>trigger_time是觸發程序的動作時間。它可以是 before 或 after，以指明觸發程序是在激活它的語句之前或之後觸發。</p><p>trigger_event指明瞭激活觸發程序的語句的類型</p><p>INSERT：將新行插入表時激活觸發程序</p><p>UPDATE：更改某一行時激活觸發程序</p><p>DELETE：從表中刪除某一行時激活觸發程序</p><p>tbl_name：監聽的表，必須是永久性的表，不能將觸發程序與TEMPORARY表或視圖關聯起來。</p><p>trigger_stmt：當觸發程序激活時執行的語句。執行多個語句，可使用BEGIN...END複合語句結構</p><p>-- 刪除</p><p>DROP TRIGGER [schema_name.]trigger_name</p><p>可以使用old和new代替舊的和新的數據</p><p>更新操作，更新前是old，更新後是new.</p><p>刪除操作，只有old.</p><p>增加操作，只有new.</p><p>-- 注意</p><p>1. 對於具有相同觸發程序動作時間和事件的給定表，不能有兩個觸發程序。</p><p></p><p>-- 字符連接函數</p><p>concat(str1,str2,...])</p><p>concat_ws(separator,str1,str2,...)</p><p></p><p>-- 分支語句</p><p>if 條件 then</p><p>執行語句</p><p>elseif 條件 then</p><p>執行語句</p><p>else</p><p>執行語句</p><p>end if;</p><p></p><p>-- 修改最外層語句結束符</p><p>delimiter 自定義結束符號</p><p>SQL語句</p><p>自定義結束符號</p><p>delimiter ; -- 修改回原來的分號</p><p></p><p>-- 語句塊包裹</p><p>begin</p><p>語句塊</p><p>end</p><p></p><p>-- 特殊的執行</p><p>1. 只要添加記錄，就會觸發程序。</p><p>2. Insert into on duplicate key update 語法會觸發：</p><p>如果沒有重複記錄，會觸發 before insert, after insert;</p><p>如果有重複記錄並更新，會觸發 before insert, before update, after update;</p><p>如果有重複記錄但是沒有發生更新，則觸發 before insert, before update</p><p>3. Replace 語法 如果有記錄，則執行 before insert, before delete, after delete, after insert</p><p>SQL編程</p><p>--// 局部變量 ----------</p><p>-- 變量聲明</p><p>declare var_name[,...] type [default value]</p><p>這個語句被用來聲明局部變量。要給變量提供一個默認值，請包含一個default子句。值可以被指定為一個表達式，不需要為一個常數。如果沒有default子句，初始值為null。</p><p>-- 賦值</p><p>使用 set 和 select into 語句為變量賦值。</p><p>- 注意：在函數內是可以使用全局變量（用戶自定義的變量）</p><p><br></p><p>--// 全局變量 ----------</p><p>-- 定義、賦值</p><p>set 語句可以定義併為變量賦值。</p><p>set @var = value;</p><p>也可以使用select into語句為變量初始化並賦值。這樣要求select語句只能返回一行，但是可以是多個字段，就意味著同時為多個變量進行賦值，變量的數量需要與查詢的列數一致。</p><p>還可以把賦值語句看作一個表達式，通過select執行完成。此時為了避免=被當作關係運算符看待，使用:=代替。（set語句可以使用= 和 :=）。</p><p>select @var:=20;</p><p>select @v1:=id, @v2=name from t1 limit 1;</p><p>select * from tbl_name where @var:=30;</p><p>select into 可以將表中查詢獲得的數據賦給變量。</p><p>-| select max(height) into @max_height from tb;</p><p>-- 自定義變量名</p><p>為了避免select語句中，用戶自定義的變量與系統標識符（通常是字段名）衝突，用戶自定義變量在變量名前使用@作為開始符號。</p><p>@var=10;</p><p>- 變量被定義後，在整個會話週期都有效（登錄到退出）</p><p><br></p><p>--// 控制結構 ----------</p><p>-- if語句</p><p>if search_condition then</p><p>statement_list</p><p>[elseif search_condition then</p><p>statement_list]</p><p>...</p><p>[else</p><p>statement_list]</p><p>end if;</p><p>-- case語句</p><p>CASE value WHEN [compare-value] THEN result</p><p>[WHEN [compare-value] THEN result ...]</p><p>[ELSE result]</p><p>END</p><p>-- while循環</p><p>[begin_label:] while search_condition do</p><p>statement_list</p><p>end while [end_label];</p><p>- 如果需要在循環內提前終止 while循環，則需要使用標籤；標籤需要成對出現。</p><p>-- 退出循環</p><p>退出整個循環 leave</p><p>退出當前循環 iterate</p><p>通過退出的標籤決定退出哪個循環</p><p><br></p><p>--// 內置函數 ----------</p><p>-- 數值函數</p><p>abs(x) -- 絕對值 abs(-10.9) = 10</p><p>format(x, d) -- 格式化千分位數值 format(1234567.456, 2) = 1,234,567.46</p><p>ceil(x) -- 向上取整 ceil(10.1) = 11</p><p>floor(x) -- 向下取整 floor (10.1) = 10</p><p>round(x) -- 四捨五入去整</p><p>mod(m, n) -- m%n m mod n 求餘 10%3=1</p><p>pi() -- 獲得圓周率</p><p>pow(m, n) -- m^n</p><p>sqrt(x) -- 算術平方根</p><p>rand() -- 隨機數</p><p>truncate(x, d) -- 截取d位小數</p><p>-- 時間日期函數</p><p>now(), current_timestamp(); -- 當前日期時間</p><p>current_date(); -- 當前日期</p><p>current_time(); -- 當前時間</p><p>date('yyyy-mm-dd hh:ii:ss'); -- 獲取日期部分</p><p>time('yyyy-mm-dd hh:ii:ss'); -- 獲取時間部分</p><p>date_format('yyyy-mm-dd hh:ii:ss', '%d %y %a %d %m %b %j'); -- 格式化時間</p><p>unix_timestamp(); -- 獲得unix時間戳</p><p>from_unixtime(); -- 從時間戳獲得時間</p><p>-- 字符串函數</p><p>length(string) -- string長度，字節</p><p>char_length(string) -- string的字符個數</p><p>substring(str, position [,length]) -- 從str的position開始,取length個字符</p><p>replace(str ,search_str ,replace_str) -- 在str中用replace_str替換search_str</p><p>instr(string ,substring) -- 返回substring首次在string中出現的位置</p><p>concat(string [,...]) -- 連接字串</p><p>charset(str) -- 返回字串字符集</p><p>lcase(string) -- 轉換成小寫</p><p>left(string, length) -- 從string2中的左邊起取length個字符</p><p>load_file(file_name) -- 從文件讀取內容</p><p>locate(substring, string [,start_position]) -- 同instr,但可指定開始位置</p><p>lpad(string, length, pad) -- 重複用pad加在string開頭,直到字串長度為length</p><p>ltrim(string) -- 去除前端空格</p><p>repeat(string, count) -- 重複count次</p><p>rpad(string, length, pad) --在str後用pad補充,直到長度為length</p><p>rtrim(string) -- 去除後端空格</p><p>strcmp(string1 ,string2) -- 逐字符比較兩字串大小</p><p>-- 流程函數</p><p>case when [condition] then result [when [condition] then result ...] [else result] end 多分支</p><p>if(expr1,expr2,expr3) 雙分支。</p><p>-- 聚合函數</p><p>count()</p><p>sum();</p><p>max();</p><p>min();</p><p>avg();</p><p>group_concat()</p><p>-- 其他常用函數</p><p>md5();</p><p>default();</p><p></p><p>--// 存儲函數，自定義函數 ----------</p><p>-- 新建</p><p>CREATE FUNCTION function_name (參數列表) RETURNS 返回值類型</p><p>函數體</p><p>- 函數名，應該合法的標識符，並且不應該與已有的關鍵字衝突。</p><p>- 一個函數應該屬於某個數據庫，可以使用db_name.funciton_name的形式執行當前函數所屬數據庫，否則為當前數據庫。</p><p>- 參數部分，由"參數名"和"參數類型"組成。多個參數用逗號隔開。</p><p>- 函數體由多條可用的mysql語句，流程控制，變量聲明等語句構成。</p><p>- 多條語句應該使用 begin...end 語句塊包含。</p><p>- 一定要有 return 返回值語句。</p><p>-- 刪除</p><p>DROP FUNCTION [IF EXISTS] function_name;</p><p>-- 查看</p><p>SHOW FUNCTION STATUS LIKE 'partten'</p><p>SHOW CREATE FUNCTION function_name;</p><p>-- 修改</p><p>ALTER FUNCTION function_name 函數選項</p><p></p><p>--// 存儲過程，自定義功能 ----------</p><p>-- 定義</p><p>存儲存儲過程 是一段代碼（過程），存儲在數據庫中的sql組成。</p><p>一個存儲過程通常用於完成一段業務邏輯，例如報名，交班費，訂單入庫等。</p><p>而一個函數通常專注與某個功能，視為其他程序服務的，需要在其他語句中調用函數才可以，而存儲過程不能被其他調用，是自己執行 通過call執行。</p><p>-- 創建</p><p>CREATE PROCEDURE sp_name (參數列表)</p><p>過程體</p><p>參數列表：不同於函數的參數列表，需要指明參數類型</p><p>IN，表示輸入型</p><p>OUT，表示輸出型</p><p>INOUT，表示混合型</p><p>注意，沒有返回值。</p><p><br></p><p>/* 存儲過程 */ ------------------</p><p>存儲過程是一段可執行性代碼的集合。相比函數，更偏向於業務邏輯。</p><p>調用：CALL 過程名</p><p>-- 注意</p><p>- 沒有返回值。</p><p>- 只能單獨調用，不可夾雜在其他語句中</p><p>-- 參數</p><p>IN|OUT|INOUT 參數名 數據類型</p><p>IN 輸入：在調用過程中，將數據輸入到過程體內部的參數</p><p>OUT 輸出：在調用過程中，將過程體處理完的結果返回到客戶端</p><p>INOUT 輸入輸出：既可輸入，也可輸出</p><p>-- 語法</p><p>CREATE PROCEDURE 過程名 (參數列表)</p><p>BEGIN</p><p>過程體</p><p>END</p><p>用戶和權限管理</p><p>-- root密碼重置</p><p>1. 停止MySQL服務</p><p>2. [Linux] /usr/local/mysql/bin/safe_mysqld --skip-grant-tables &</p><p>[Windows] mysqld --skip-grant-tables</p><p>3. use mysql;</p><p>4. UPDATE `user` SET PASSWORD=PASSWORD("密碼") WHERE `user` = "root";</p><p>5. FLUSH PRIVILEGES;</p><p>用戶信息表：mysql.user</p><p>-- 刷新權限</p><p>FLUSH PRIVILEGES;</p><p>-- 增加用戶</p><p>CREATE USER 用戶名 IDENTIFIED BY [PASSWORD] 密碼(字符串)</p><p>- 必須擁有mysql數據庫的全局CREATE USER權限，或擁有INSERT權限。</p><p>- 只能創建用戶，不能賦予權限。</p><p>- 用戶名，注意引號：如 'user_name'@'192.168.1.1'</p><p>- 密碼也需引號，純數字密碼也要加引號</p><p>- 要在純文本中指定密碼，需忽略PASSWORD關鍵詞。要把密碼指定為由PASSWORD()函數返回的混編值，需包含關鍵字PASSWORD</p><p>-- 重命名用戶</p><p>RENAME USER old_user TO new_user</p><p>-- 設置密碼</p><p>SET PASSWORD = PASSWORD('密碼') -- 為當前用戶設置密碼</p><p>SET PASSWORD FOR 用戶名 = PASSWORD('密碼') -- 為指定用戶設置密碼</p><p>-- 刪除用戶</p><p>DROP USER 用戶名</p><p>-- 分配權限/添加用戶</p><p>GRANT 權限列表 ON 表名 TO 用戶名 [IDENTIFIED BY [PASSWORD] 'password']</p><p>- all privileges 表示所有權限</p><p>- *.* 表示所有庫的所有表</p><p>- 庫名.表名 表示某庫下面的某表</p><p>GRANT ALL PRIVILEGES ON `pms`.* TO 'pms'@'%' IDENTIFIED BY 'pms0817';</p><p>-- 查看權限</p><p>SHOW GRANTS FOR 用戶名</p><p>-- 查看當前用戶權限</p><p>SHOW GRANTS; 或 SHOW GRANTS FOR CURRENT_USER; 或 SHOW GRANTS FOR CURRENT_USER();</p><p>-- 撤消權限</p><p>REVOKE 權限列表 ON 表名 FROM 用戶名</p><p>REVOKE ALL PRIVILEGES, GRANT OPTION FROM 用戶名 -- 撤銷所有權限</p><p>-- 權限層級</p><p>-- 要使用GRANT或REVOKE，您必須擁有GRANT OPTION權限，並且您必須用於您正在授予或撤銷的權限。</p><p>全局層級：全局權限適用於一個給定服務器中的所有數據庫，mysql.user</p><p>GRANT ALL ON *.*和 REVOKE ALL ON *.*只授予和撤銷全局權限。</p><p>數據庫層級：數據庫權限適用於一個給定數據庫中的所有目標，mysql.db, mysql.host</p><p>GRANT ALL ON db_name.*和REVOKE ALL ON db_name.*只授予和撤銷數據庫權限。</p><p>表層級：表權限適用於一個給定表中的所有列，mysql.talbes_priv</p><p>GRANT ALL ON db_name.tbl_name和REVOKE ALL ON db_name.tbl_name只授予和撤銷表權限。</p><p>列層級：列權限適用於一個給定表中的單一列，mysql.columns_priv</p><p>當使用REVOKE時，您必須指定與被授權列相同的列。</p><p>-- 權限列表</p><p>ALL [PRIVILEGES] -- 設置除GRANT OPTION之外的所有簡單權限</p><p>ALTER -- 允許使用ALTER TABLE</p><p>ALTER ROUTINE -- 更改或取消已存儲的子程序</p><p>CREATE -- 允許使用CREATE TABLE</p><p>CREATE ROUTINE -- 創建已存儲的子程序</p><p>CREATE TEMPORARY TABLES -- 允許使用CREATE TEMPORARY TABLE</p><p>CREATE USER -- 允許使用CREATE USER, DROP USER, RENAME USER和REVOKE ALL PRIVILEGES。</p><p>CREATE VIEW -- 允許使用CREATE VIEW</p><p>DELETE -- 允許使用DELETE</p><p>DROP -- 允許使用DROP TABLE</p><p>EXECUTE -- 允許用戶運行已存儲的子程序</p><p>FILE -- 允許使用SELECT...INTO OUTFILE和LOAD DATA INFILE</p><p>INDEX -- 允許使用CREATE INDEX和DROP INDEX</p><p>INSERT -- 允許使用INSERT</p><p>LOCK TABLES -- 允許對您擁有SELECT權限的表使用LOCK TABLES</p><p>PROCESS -- 允許使用SHOW FULL PROCESSLIST</p><p>REFERENCES -- 未被實施</p><p>RELOAD -- 允許使用FLUSH</p><p>REPLICATION CLIENT -- 允許用戶詢問從屬服務器或主服務器的地址</p><p>REPLICATION SLAVE -- 用於複製型從屬服務器（從主服務器中讀取二進制日誌事件）</p><p>SELECT -- 允許使用SELECT</p><p>SHOW DATABASES -- 顯示所有數據庫</p><p>SHOW VIEW -- 允許使用SHOW CREATE VIEW</p><p>SHUTDOWN -- 允許使用mysqladmin shutdown</p><p>SUPER -- 允許使用CHANGE MASTER, KILL, PURGE MASTER LOGS和SET GLOBAL語句，mysqladmin debug命令；允許您連接（一次），即使已達到max_connections。</p><p>UPDATE -- 允許使用UPDATE</p><p>USAGE -- “無權限”的同義詞</p><p>GRANT OPTION -- 允許授予權限</p><p>表維護</p><p>-- 分析和存儲表的關鍵字分佈</p><p>ANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE 表名 ...</p><p>-- 檢查一個或多個表是否有錯誤</p><p>CHECK TABLE tbl_name [, tbl_name] ... [option] ...</p><p>option = {QUICK | FAST | MEDIUM | EXTENDED | CHANGED}</p><p>-- 整理數據文件的碎片</p><p>OPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...</p><p>雜項</p><p>1. 可用反引號（`）為標識符（庫名、表名、字段名、索引、別名）包裹，以避免與關鍵字重名！中文也可以作為標識符！</p><p>2. 每個庫目錄存在一個保存當前數據庫的選項文件db.opt。</p><p>3. 註釋：</p><p>單行註釋 # 註釋內容</p><p>多行註釋 /* 註釋內容 */</p><p>單行註釋 -- 註釋內容 (標準SQL註釋風格，要求雙破折號後加一空格符（空格、TAB、換行等）)</p><p>4. 模式通配符：</p><p>_ 任意單個字符</p><p>% 任意多個字符，甚至包括零字符</p><p>單引號需要進行轉義 '</p><p>5. CMD命令行內的語句結束符可以為 ";", "G", "g"，僅影響顯示結果。其他地方還是用分號結束。delimiter 可修改當前對話的語句結束符。</p><p>6. SQL對大小寫不敏感</p><p>7. 清除已有語句：c</p><p></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>MySQL</a></li><li><a>語法</a></li><li><a>最全</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/19bc7b4b.html alt=遷移到MySQL的語法轉換工具初步設計 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/S7ayKzs1L0kknf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/19bc7b4b.html title=遷移到MySQL的語法轉換工具初步設計>遷移到MySQL的語法轉換工具初步設計</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0be408a4.html alt="MySQL 事務處理" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0be408a4.html title="MySQL 事務處理">MySQL 事務處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c9091681.html alt="MySQL 學習筆記" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c9091681.html title="MySQL 學習筆記">MySQL 學習筆記</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8a538d3c.html alt=MySQL——事務(Transaction)詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/29d4c92c9c2344838eb72ef948cf08fa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8a538d3c.html title=MySQL——事務(Transaction)詳解>MySQL——事務(Transaction)詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a79ba4c0.html alt=MySQL事務隔離級別 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/2d4e804a44534da997212c94ea61e90c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a79ba4c0.html title=MySQL事務隔離級別>MySQL事務隔離級別</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3269d080.html alt=MySQL數據庫的事務管理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/152203544367254a708f807 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3269d080.html title=MySQL數據庫的事務管理>MySQL數據庫的事務管理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2d12804e.html alt=[玩轉MySQL之九]MySQL實現ACID之原子性 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bdb044d821f74107a3fd9119fc34c642 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2d12804e.html title=[玩轉MySQL之九]MySQL實現ACID之原子性>[玩轉MySQL之九]MySQL實現ACID之原子性</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/156d2a92.html alt="圖解MySQL | 「原理解析」 MySQL組提交(group commit)" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e5444e9094614d6b88bd3fc8ac0524fb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/156d2a92.html title="圖解MySQL | 「原理解析」 MySQL組提交(group commit)">圖解MySQL | 「原理解析」 MySQL組提交(group commit)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7d322f7b.html alt=MySQL系列-第14篇：事務詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/a5b520dd476345e2b3aac97a8fcb77d5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7d322f7b.html title=MySQL系列-第14篇：事務詳解>MySQL系列-第14篇：事務詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d95e4e3f.html alt=MySQL進階之InnoDB事務原子性實現原理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/e1d208ac-c0ed-4238-bce5-e4b3760228c3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d95e4e3f.html title=MySQL進階之InnoDB事務原子性實現原理>MySQL進階之InnoDB事務原子性實現原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/efc2a519.html alt=你知道MySQL的事務處理和隔離級別嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/efc2a519.html title=你知道MySQL的事務處理和隔離級別嗎？>你知道MySQL的事務處理和隔離級別嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cf061a5c.html alt="我對 MySQL 鎖、事務、MVCC 的一些認識" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5d6e32482c364fe3b5f9436a30671330 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cf061a5c.html title="我對 MySQL 鎖、事務、MVCC 的一些認識">我對 MySQL 鎖、事務、MVCC 的一些認識</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4959ed6a.html alt="技術分享 | MySQL 的嵌套事務、自治事務與鏈式事務" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4959ed6a.html title="技術分享 | MySQL 的嵌套事務、自治事務與鏈式事務">技術分享 | MySQL 的嵌套事務、自治事務與鏈式事務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ad3f3a1e.html alt="數據庫技術：MySQL 基礎和 SQL 入門，單表、約束和事務" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/107897c16ae7461caa62dd375b631afe style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ad3f3a1e.html title="數據庫技術：MySQL 基礎和 SQL 入門，單表、約束和事務">數據庫技術：MySQL 基礎和 SQL 入門，單表、約束和事務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/175f9730.html alt=深入學習MySQL事務：ACID特性的實現原理「轉」 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/cdc702d66d6943499997d11e931425eb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/175f9730.html title=深入學習MySQL事務：ACID特性的實現原理「轉」>深入學習MySQL事務：ACID特性的實現原理「轉」</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>