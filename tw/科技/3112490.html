<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>TiDB 混沌工程實踐：如何打造健壯的分佈式系統？ | 极客快訊</title><meta property="og:title" content="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/3d0eb599932b4d429593071f749afd32"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3112490.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3112490.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3112490.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3112490.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3112490.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3112490.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3112490.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3112490.html><meta property="article:published_time" content="2020-10-29T20:52:47+08:00"><meta property="article:modified_time" content="2020-10-29T20:52:47+08:00"><meta name=Keywords content><meta name=description content="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/3112490.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>TiDB 混沌工程實踐：如何打造健壯的分佈式系統？</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><blockquote><p>作為一個分佈式數據庫，TiDB 面臨的嚴重挑戰在於如何讓用戶相信存儲在 TiDB 裡面的數據是安全的，不會出現丟失，損壞等情況。因此，在 TiDB 研發初期，PingCAP 就引入了混沌工程，來保證 TiDB 在各種極端情況下面的穩定性。本文整理自 ArchSummit 全球架構師峰會（深圳站）2019 峰會演講，分享了 TiDB 應用混沌工程的方法，介紹基於 K8s 自研的自動化測試平臺 Schrodinger，並通過實際例子說明如何在 Schrodinger 裡應用混沌來測試系統。</p></blockquote><p class=ql-align-justify><br></p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3d0eb599932b4d429593071f749afd32><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>大家好！我是唐劉，現在是 PingCAP 的首席架構師，同時負責 TiDB 底層組件 TiKV 的研發，該項目屬於 CNCF 孵化中項目，應該也是國內唯一進入 CNCF 的數據庫項目。同時，我也是典型的開源愛好者，做了很多 go-mysql， raft.rs ，grpc-rs 等開源組件的工作。</p><h1 class=ql-align-justify>為什麼需要混沌工程？</h1><p class=ql-align-justify>假設，我們現在開始建造一個系統，無論該系統的具體功能是什麼，我們都需要保證系統的穩定性，但是如何知道系統是否處於穩定狀態呢？通常，團隊可以通過單元測試、集成測試和性能測試等手段進行驗證。但是，無論這些測試寫的多好，我們認為都遠遠不夠，因為錯誤可以在任何時間發生，尤其是對分佈式系統而言，此時就需要引入混沌工程（Chaos Engineering）。</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d907be88363949cc80c9941d1b6297d5><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>以 TiDB 的實際生產流程為例，由於 TiDB 底層採用 Raft 一致性協議進行副本複製，因此存在 Follower 和 Leader 的概念，Follower 被動接受 Leader 的日誌，同步相關數據。當新的 Follower 節點加入集群后，Leader 會給 Follower 發送 Snapshot，也就是說，Leader 會把當前整個數據進項打包成 Snapshot 發給 Follower。在 TiDB 裡面，Snapshot 包括四部分，分別是 Meta 文件，default.sst，write.sst 和 lock.sst。Meta 文件記錄數據文件源信息，包括數據文件的大小等，其餘三個是數據文件。</p><p class=ql-align-justify>當 Follower 接收到 Snapshot 文件後，會進行 Save Snapshot 的操作，將四個部分存到不同的文件裡面。然後，Follower 會 Check Snapshot，也就是檢查 Snapshot 的正確性，如果 Snapshot 是正確的，就會將其應用到整個 Follower 狀態。如上圖所示，在 Save Snapshot 和 Check Snapshot 之間發生了 Panic，並且進行了重啟。要知道，對 Linux 系統而言，如果寫文件時進程掛掉，但 Linux 系統沒有掛掉，那麼這個文件還可以認為是安全的，雖然會把文件寫到 Page Cache 裡面，但掛掉之後，Linux 系統會強制將 Page Cache 刷到磁盤裡面，保證文件安全。</p><p class=ql-align-justify>但是，當我們的 Follower 掛掉重啟之後，我們發現文件出現丟失，如上圖所示 write.sst 變成了 0 兆，但根據 Meta 文件，write.sst 不可能是 0 兆。也就是說，在磁盤沒有任何問題的情況下，進程重啟後出現了文件丟失。通過查看 dmseg，出現了<em>SLUB：unable to allocate memoy on node</em>的提示。這可以理解為，雖然系統沒有出現問題，但可能由於內存不足等其他問題讓文件 Page Cache 無法正常進行，此時就會出現上述問題。</p><p class=ql-align-justify>對我們來說，雖然很多時候可以認為程序沒有問題，但是與程序一起合作的操作系統可能會出現 Bug，導致整個數據丟失，這是對程序進行多少次單元測試都無法避免的事情。</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/a1f0b1e6e71a43c7a1a3093e8710f6a5><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>上圖是第二個示例，顯示的是分佈式系統裡常見的 Gray Failure 問題。通常情況下，判斷一個程序的死活，很直觀的感覺就是寫一個 Checker 程序，定期運行以試探程序狀態。我們可能會出現一種情況，就是上文提到的 Gray Failure，具體指的是檢查程序與整個系統相通，但客戶端與系統很可能已經完全無法交互，我們自認為系統是好的，但實際上系統已經出現問題。</p><p class=ql-align-justify>綜上，分佈式系統會出現很多僅僅通過測試無法解決的問題，因此我們想到了非常好的解決方法就是混沌工程。</p><h1 class=ql-align-justify>混沌工程是什麼？</h1><p class=ql-align-justify>混沌工程的概念很早之前就有，但是直到 2012 年，Netflix 公司才讓外界更多人知道了“混沌”。為了更好地推廣混沌工程，Netflix 引入了一隻猴子（Chaos Monkey），試想一隻猴子在系統裡面，平時是安安靜靜的，什麼事情都不做，突然一天發瘋開始在系統裡到處搗亂，作為工程師，要乾的一件事情就是逮住這隻猴子，讓它別搗亂，這大概就是混沌工程要表達的意思。</p><p class=ql-align-justify>簡單來說，混沌工程也是一個工程學科，這就意味著需要做實驗，通過設計進行混沌實驗，觀察系統對各類故障的真實反映，以此來完善保證系統的穩定性。但是在開始混沌工程之前，這一切的前提是確保系統是容錯的 ，也就是平常所說的雙活、多活。假設系統是典型的單點架構，只要單點損壞，整個系統就崩潰了，沒法驗證混沌工程的效果，因此係統必須能夠支持容錯，然後通過不斷的故障引入來驗證系統容錯性，如果系統不能容錯，我們不限要考慮的是讓系統能容錯，從而再去考慮混沌工程。</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9f8eae7d34b349bfa36e44d9523c9d07><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>具體到實踐層面，大家可以參考 Principles of Chaos Engineering 網頁裡面的步驟。如上圖，第一步，需要定義系統穩態，通常情況下，可以通過 metrics 或者客戶端指標定義系統，比如 QPS、延遲等，只要這些指標沒有太大波動，就可以認為系統是穩定的；第二步，定義系統穩態後，我們分為實驗組和對照組進行實驗，假設無論對實驗組做任何操作，整個系統都可以繼續維持穩定狀態；第三步，引進現實生活中的變量，也就是模擬現實世界可能發生的錯誤故障，比如硬件故障，網絡延遲隔離等到實驗組中；最後，比較實驗組和對照組前後穩定狀態的差異，是否可以滿足預期。如果前後保持一致，則可以認為系統對該故障的有容錯能力；反之，如果兩者的穩定狀態不一致，那就找到了一個系統弱點，從而可以修復它，提高系統可靠性。</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/45f53ad7778f4cafb38e1f7cd2e0edf1><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>如上圖以 TiDB 為例，對三副本的 Raft 算法而言，Leader 對外提供客戶端寫入操作。如果把 Leader 幹掉，Follower 會立刻選出一個新的 Leader，繼續對外提供服務，對於這個系統來說，如果要做混沌工程，應該怎麼做呢？</p><p class=ql-align-justify>首先，根據一些指標定義系統穩態，比如 QPS；其次，假設客戶端的 QPS 在受到攻擊，Leader 節點被殺死後會出現一個抖動，Follower 會立馬選出新的 Leader 節點，迅速恢復至穩定狀態；第三步，進行錯誤注入實驗；最後，觀察結果，如果發現系統 QPS 降為零並再也沒有恢復，證明系統有 bug，我們就需要去找出問題並修正；反之，如果 QPS 恢復了，則證明系統可以容忍這次故障，可以繼續進行下一個實驗。</p><p class=ql-align-justify>為了更好地進行混沌工程實踐，Netflix 在官網提供了相關原則：第一個原則是構建系統穩態的假設；第二個原則是引入現實環境的變量事件；第三個原則是在生產環境中運行實驗，此處需要注意任何在生產環境進行的操作都是有風險的，因此需要提前與相關部門進行溝通，以免因為疏忽導致業務掛掉不可用；第四個原則是持續自動化運行實驗，如果全部通過手工方式實現，效率將非常低；最後一個原則是要控制好“爆炸半徑”，在進行混沌實驗時一定要注意受影響的範圍，如果沒有預估好，很容易導致所有的用戶都沒法使用，這是很嚴重的問題。</p><h1 class=ql-align-justify>PingCAP 在 TiDB 實踐混沌工程</h1><p class=ql-align-justify>在 PingCAP，我們主要針對 TiDB 進行混沌工程實踐，重點關注兩個大方向：一是發現錯誤；二是注入錯誤。在 TiDB，我們採用的是比較原始的三種方法分析系統狀態：Metrics、Log 和 Tracing。</p><p class=ql-align-justify>第一種，是基於 Metrics，TiDB 使用的是普羅米修斯，以下是典型的 QPS 曲線圖，可以看到凌晨兩點，latency 曲線突然飆升。</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/77bb09cd474d4d7b846131967f2d3bbb><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>於是，我們有一個非常粗暴簡單的腳本，當檢測到延遲大於某個閾值時，就會發起告警。</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bdd0c3227cd3456884993eba1fd07d06><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>但是，如果認真觀察前後兩天的曲線，可以看出每天固定時間的延遲都會升高，這可認為是用戶正常的工作負載，如果只是簡單粗暴的通過 Metrics 等弱指標進行相關判斷，並不能很好地發現系統相關問題，所以需要查看歷史數據，尤其是 Metrics 的歷史，然後進行比較，就可以基本判斷出數據是否正常。當然，我們也會通過機器學習的方式進行更精確的判斷。</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1ba47ab8e3114e599ead9f1181f29900><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>第二種是基於 Log，因為 Log 裡面存放了詳細的錯誤信息，但是作為一家創業公司，我們現階段還沒辦法做一整套 Log 系統，因此採用了業界比較主流的開源方案，比如 FluentBit 或 Promtail，將這些數據導入 ES 或 LOKI 進行相關分析。後續我們也會自己寫相關日誌分析組件，比如，對於 transaction，我們會有一個 transaction ID，將事物查詢可能會分到多個不同的組件上，都會有統一的 ID 詳細顯示出來，這其實是通過 Log 進行分析。</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b7feab85083c4b398e783bc7750e3b70><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>第三種是引入 Tracing，雖然我們採用的是業界通用的主流方案—— TiDB 支持 OpenTracing，但我一直認為，只有當 Log 或者 Metrics 沒辦法解決問題時，才不得已使用 Tracing，因為開啟 Tracing 會對整個系統的性能產生一定影響。通常情況下，TiDB 默認關閉 Tracing，僅在必要時才會啟動該方法，比如需要查詢到底在哪個地方消耗較多時間等。</p><p class=ql-align-justify>現在，Metrics、Log 和 Tracing 也會被稱作 Observability（可觀測性），TiDB 的可觀測性還是採用業界的主流方案，並沒有做太多定製化。</p><p class=ql-align-justify>故障注入</p><p class=ql-align-justify>學會發現錯誤之後，接下來就是考慮如何注入錯誤，對系統引入各種故障。因為 TiDB 是一個分佈式數據庫，所以我們主要關心兩個問題：網絡和文件系統的故障。因為是分佈式的，所以一定繞不開網絡問題；因為需要進行數據存儲，因此要考慮文件系統。</p><p class=ql-align-justify>雖然現在有很多網絡拓撲結構，但如果要對網絡進行錯誤注入，通常情況下有三種模型：</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b3b76facfe7a497f9ae5716c32aebed2><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>如上圖所示，第一種是 Complete，兩個節點之間的網絡完全不通；第二種是 Simplex，A 能給 B 發送消息，但是 B 不能給 A 回覆消息；第三種是 Partial，A 和 B 完全不通，但是 A 和 B 能夠通過另一個節點也就是 C 進行互動。對 TiDB 而言，我們儘量模擬相關網絡環境，儘可能多的發現在網絡隔離下面的錯誤。</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/652bb07ea38140379cda13bb7a5bd382><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>這裡，一個比較典型的例子，我們稱之為 Network Partition Ring 。如上圖，假設有五個節點，一共分成五組，在這個組裡面，N1 可以給 N2、N3、N4、N5 發送消息，但是 N1 只能夠收取 N2 和 N3 的消息，不能收取 N4 和 N5 的消息。其實這種網絡拓撲出現的問題在現實生活中很難被發現，為什麼還需要來做這個事情呢？我們希望進行混沌實驗，在還沒出現對用戶造成傷害之前，我們可以主動發現並解決這些問題。</p><p class=ql-align-justify>除了網絡，存儲也需要進行相應的故障注入。</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ebe15a805ffd41a99b5201bc1fbf1fc9><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>在 TiDB 裡，我們主要是通過 Fuse 的機制進行文件系統干擾，如上圖所示，實際數據可能存儲在 /Root/O 路徑下，可以通過 Fuse Mount 到另外一個路徑下面，讓應用程序跟在 Mount 路徑進行交互。因為採用的 Fuse，Mount 的時候可以在整個 IO 鏈上做錯誤注入。通過這種方式，我們能夠非常方便地模擬各種 IO 錯誤的情況，如果不想使用 Fuse，也可以考慮 Linux 的其他 Debug 工具。</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3fea400570cd48b8a1cd4376dad8ea3e><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>對文件系統而言，我們可能還有更加粗暴的一種方式。在 TiDB 裡面，我們也會經常將電源拔掉，手工觸發斷電、斷網等情況，以考察系統是否可以維持穩定，以下是我們常用的錯誤畫像，僅供參考：</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6c61bd3c605c42549f985d8fb8e5d3ba><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>此外，對分佈式系統測試而言，Jepsen 也是一個不錯的工具，對錯誤注入感興趣的可以參考 Jepsen 的代碼。不過，Jepsen 是用 Clojure 語言編寫的，有些難以理解。</p><h1 class=ql-align-justify>雲上混沌工程實踐</h1><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4fb827cffb28406c90928b7d849d36ea><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>在 TiDB 研發初期，PingCAP 就對其引入了混沌工程。早期，如果需要進行混沌工程實驗，只能自己申請幾臺冗餘或閒置的機器，所有實驗都需要手動完成，包括自己構建併發布整個 TiDB 集群，雖然這個過程也發現了不少問題，但手工部署耗時且非常低效，在資源利用上也十分不合理。</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5bdc270e8a944c90b5e2fafb405c684f><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>我們決定簡化整個流程。如上圖，第一步是通過 Kubernetes 更好的管理機器；第二步是進行流程自動化，因此，基於 Kubernetes 平臺我們搭建了一套自動化的混沌工程平臺——薛定諤平臺（Schrodinger）。</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3fae5624c0604f8593c3ac411a98c877><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>如上圖，在 Kubernetes 裡面有三個 Box，每個 Box 都有兩個用例，通過隨機注入來驗證系統是否可以保持穩定。實現自動化之後，只需要將錯誤輸入薛定諤平臺，該平臺就可以自動編譯版本，自動運行相關測試用例。如果用例掛掉了，系統會通知我們進行相應處理。PingCAP 現在已經跟其他企業合作，努力優化做更加通用的混沌工程平臺，讓大家能夠把自己的業務放到這個平臺上跑。因為我們仍然基於 Kubernetes，只要將集群 Helm 的配置文件與混沌工程結合，就可以直接運行在我們的平臺上。如果大家對一些 Kubernetes 的概念不熟悉，可以對比 Linux 的相關概念理解。</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4036c2621ace497bb59455fc2076ceda><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>具體來說，要想將業務運行在該平臺之上，主要是使用 Chaos Operator，Operator 會把所有對象就是 Chaos 定義成 CRD，在不同的物理節點上啟動一個 DaemonSets，這個 DaemonSets 就負責干擾不同的 Load，以及上面不同的 Pod，對應的 Pod 裡面會注入一個 Sidecar，這可以認為是一個 Thread，Sidecar 幫我們進行注入，負責破壞 Pod。對用戶來說，只要提供他自己的 Helm Chart，同時把我們的 Chaos CRD 一起放到 Chaos Operator 裡面即可。Chaos Operator 啟動之後，會通過 Web Hook 的方式把 Daemmsets 起來，隨後進行系列操作。</p><div class=pgc-img><img alt="TiDB 混沌工程實踐：如何打造健壯的分佈式系統？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d4d125d9575b415aba4085710ab96113><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><blockquote><p><strong>嘉賓介紹：</strong>唐劉，PingCAP 首席架構師，主要是負責分佈式 key-value TiKV 的研發工作，也會折騰下 TiDB 整個產品的測試，工具開發等工作。</p></blockquote></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>TiDB</a></li><li><a>實踐</a></li><li><a>健壯</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/b6acbddb.html alt=「壓鑄實踐」大截面ZA27鋅合金蝸輪的雙重擠壓鑄造應用案例 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/972374c8b24644389e188cb290249f17 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b6acbddb.html title=「壓鑄實踐」大截面ZA27鋅合金蝸輪的雙重擠壓鑄造應用案例>「壓鑄實踐」大截面ZA27鋅合金蝸輪的雙重擠壓鑄造應用案例</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b096e432.html alt=餐飲業的共益實踐案例：是什麼留住了海底撈的員工？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3253c0fd3b54497282e5ebfb67cc350c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b096e432.html title=餐飲業的共益實踐案例：是什麼留住了海底撈的員工？>餐飲業的共益實踐案例：是什麼留住了海底撈的員工？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8ece3d8b.html alt=溼法鋅冶煉氟、氯現在走向及生產實踐 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/c6ec0692-63fe-42f8-8df3-b0a6226ca1a5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8ece3d8b.html title=溼法鋅冶煉氟、氯現在走向及生產實踐>溼法鋅冶煉氟、氯現在走向及生產實踐</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/130bed32.html alt=「理論實踐」地方人大常委會研究室工作的實踐與思考 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/R9AiF6fHzZIbrG style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/130bed32.html title=「理論實踐」地方人大常委會研究室工作的實踐與思考>「理論實踐」地方人大常委會研究室工作的實踐與思考</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3998ae89.html alt=服務治理最佳實踐：如何依據參數值進行服務路由、鑑權、限流？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/3f6fb254f0cc4ba390695e1d561d4a5c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3998ae89.html title=服務治理最佳實踐：如何依據參數值進行服務路由、鑑權、限流？>服務治理最佳實踐：如何依據參數值進行服務路由、鑑權、限流？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8654883c.html alt=項目實踐中的一些性能優化指南 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/8c9ad977831f4b6bbaaf2e1b4651b667 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8654883c.html title=項目實踐中的一些性能優化指南>項目實踐中的一些性能優化指南</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/231d1667.html alt=數據倉庫實踐之如何設計可執行表命名規範 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/43bcbccdb0084c158129e23d3bce3b31 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/231d1667.html title=數據倉庫實踐之如何設計可執行表命名規範>數據倉庫實踐之如何設計可執行表命名規範</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c6860eb9.html alt=疫情期間做好職工思想政治工作的探索與實踐 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/SAiPd9B1uasVed style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c6860eb9.html title=疫情期間做好職工思想政治工作的探索與實踐>疫情期間做好職工思想政治工作的探索與實踐</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/80ae7e84.html alt=數據治理分析項目最佳實踐 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/67ed2ac0609b4877ae82c58a9507432d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/80ae7e84.html title=數據治理分析項目最佳實踐>數據治理分析項目最佳實踐</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d323acd6.html alt="一文搞定 REST Assured 實踐(二)：斷言實現" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2d017d59689b467b93d6e1a4bcb3a13c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d323acd6.html title="一文搞定 REST Assured 實踐(二)：斷言實現">一文搞定 REST Assured 實踐(二)：斷言實現</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c70cc169.html alt=數據標準管理實踐白皮書 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f9700cf0c5d846deba0644a21ed93f80 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c70cc169.html title=數據標準管理實踐白皮書>數據標準管理實踐白皮書</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a775bff0.html alt="「文明實踐 情滿沂水」蒙陰縣婦聯黨組成員、婦兒工委服務中心主任類秀雲一行到四十里堡鎮調研督導美在農家工作" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/SEvz4Jw8VTojqM style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a775bff0.html title="「文明實踐 情滿沂水」蒙陰縣婦聯黨組成員、婦兒工委服務中心主任類秀雲一行到四十里堡鎮調研督導美在農家工作">「文明實踐 情滿沂水」蒙陰縣婦聯黨組成員、婦兒工委服務中心主任類秀雲一行到四十里堡鎮調研督導美在農家工作</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/682e2d04.html alt=技術實踐——Python圖像處理進階：多種圖像變換算法實踐！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/153594655429837077dd27a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/682e2d04.html title=技術實踐——Python圖像處理進階：多種圖像變換算法實踐！>技術實踐——Python圖像處理進階：多種圖像變換算法實踐！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/923f27c8.html alt="學習經典著作 提升實踐能力" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/923f27c8.html title="學習經典著作 提升實踐能力">學習經典著作 提升實踐能力</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7c89ca21.html alt=中山東鳳文明實踐丨垃圾分類又有新玩法！一起去這個趣味遊園會逛逛↓ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RyxoCkN7Ut954e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7c89ca21.html title=中山東鳳文明實踐丨垃圾分類又有新玩法！一起去這個趣味遊園會逛逛↓>中山東鳳文明實踐丨垃圾分類又有新玩法！一起去這個趣味遊園會逛逛↓</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>