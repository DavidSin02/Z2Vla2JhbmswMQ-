<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>一個空格引發的“慘案“ | 极客快訊</title><meta property="og:title" content="一個空格引發的“慘案“ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="http://p1.pstatp.com/large/pgc-image/RWqt5nDG8tKhuw"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/335701a.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/335701a.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/335701a.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/335701a.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/335701a.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/335701a.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/335701a.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/335701a.html><meta property="article:published_time" content="2020-10-29T20:48:27+08:00"><meta property="article:modified_time" content="2020-10-29T20:48:27+08:00"><meta name=Keywords content><meta name=description content="一個空格引發的“慘案“"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/335701a.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一個空格引發的“慘案“</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><img alt=一個空格引發的“慘案“ onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/RWqt5nDG8tKhuw><p>作者 | 踐行精神自由</p><p>來源 | 互聯網全棧架構</p><p>責編 | 屠敏</p><p><strong>“案情”回顧（情景模擬）：</strong>小張是一名軟件工程師，<strong>工作兢兢業業、一絲不苟且精益求精，天性樂觀的他每天愉快地做著增刪改查的工作</strong>，對於這些看似簡單的CRUD，小張從來不會掉以輕心，他也篤定地堅信，自己向數據庫裡插入了什麼數據，就能按條件把這些數據查詢出來，畢竟，像MySQL這樣的數據庫，在全世界廣為流行，大行其道，不可能不嚴謹。</p><p>然而，意想不到的悲劇還是發生了。。。</p><p>小張做的項目與語言處理有點關係，他們把處理的結果也就是字符串保存到在數據庫裡面，後續需要按照條件把這些數據查詢出來，但需要對這些字符串做嚴格的區分，也就是說，如果查詢A字符串，不能把B字符串查詢出來，哪怕這兩個字符串只有一個空格的差異。<strong>對於這樣的需求，小張覺得太天經地義了，根本無需多言，像MySQL這樣的數據庫天生就是幹這樣的事，所以當時就自信滿滿地拍著胸脯保證一定如期開發完成。</strong></p><p>隨著工作的推進，小張猛然發現MySQL對於字符串的處理貌似不那麼嚴謹，特別是對於空格字符，比如這兩個字符串："Tom"和"Tom "，後面的字符串多了一個空格，然而，MySQL竟然把它們當成了相同的字符串。</p><p>我們來測試一下，看看具體的情況，先創建一個表：</p><pre><code>CREATE TABLE `white_space`(<br>`id` bigint(20)unsigned NOT AUTO_INCREMENT,<br>`name`varchar(128) NOT DEFAULT '',<br>PRIMARY KEY (`id`)<br>) ENGINE=InnoDBDEFAULT CHARSET=utf8</code></pre><p>然後向表裡插入兩條數據：</p><pre><code>INSERT INTO white_space(name) VALUES('Tom');<br>INSERT INTO white_space(name) VALUES('Tom ');</code></pre><p>注意，後面那條記錄在最後多了一個空格。假設我們需要查詢名字為Tom的記錄（沒有空格），SQL很簡單：</p><pre><code>SELECT * FROM white_space WHERE name = 'Tom';</code></pre><p>然而，讓小張大跌眼鏡的是，上面的SQL竟然返回兩條數據，也就是說，本來查找"Tom"（沒有空格），卻把"Tom "(有空格）也查詢出來了：</p><img alt=一個空格引發的“慘案“ onerror=errorimg.call(this); src=http://p9.pstatp.com/large/pgc-image/Rs8qmKA9jhi3Ed><p>這也太不嚴謹了，空格也是字符啊，為什麼就生生的把它忽略了呢？這樣的話，就滿足不了項目的需求了，而且，小張還發現，不管後面有多少個空格，都會被忽略。我們再插入一條記錄，名字是"Tom "，後面一共有10個空格：</p><pre><code>INSERT INTO white_space(name) VALUES('Tom ');<br></code></pre><p>再執行上面的查詢語句，這時仍然還是返回了三條記錄：</p><pre><code>SELECT * FROM white_space WHERE name = 'Tom';<br></code></pre><img alt=一個空格引發的“慘案“ onerror=errorimg.call(this); src=http://p9.pstatp.com/large/pgc-image/Rs8qmKYG8dNpCc><p>這簡直太不可理喻了！感覺MySQL在這裡完全無視空格的存在，但空格也是一個正正經經的字符啊，而且是一個非常常見的字符，咋就這麼沒有存在感呢。</p><p>當然，如果是前置空格，或者空格在中間是不會有這個問題的，比如數據庫裡保存的名字為" Tom"（最前面是一個空格），或者是"To m"，再按"Tom"（沒有空格）去查詢的話，是找不到這條記錄的。</p><p>這就麻煩了，當初可是拍著胸脯保證可以如期完成的，現在碰到這樣的問題，小張可真是有點慌了神，不知道該如何來解決，而且這也是非常不可思議的事情，強悍如斯、威武如斯、名聲震天響的MySQL竟然如此不嚴謹。幸虧空格不會說話，要不然它還不得罵街啊，作為一個名正言順的字符，就這樣生生地被忽略了，這也太不尊重人了。</p><p>事已至此，小張只能去尋找問題的解決方法，抱怨是沒有用的，經過一番辛勤探索和研究，小張終於找到了辦法，也就是加上BINARY關鍵字，像下面這樣：</p><pre><code>SELECT * FROM white_space WHERE BINARY name = 'Tom';</code></pre><p>這時候就會嚴格地進行匹配，只返回了一條記錄，如果要查詢包含空格的記錄，比如"Tom "(有空格），就會只返回有空格的這條記錄：</p><pre><code>SELECT * FROM white_space WHERE BINARY name = 'Tom ';</code></pre><p>完美！項目就是需要這樣的效果，字符串要進行嚴格的匹配與區分，現在加上BINARY關鍵字就徹底地解決了這個問題，小張不禁有些沾沾自喜，他也覺得MySQL確實太強大了，不管什麼樣的問題貌似都有辦法解決，怪不得它會風靡全世界，成為了萬千企業的首選。</p><p>然而，小張還沒有高興沒多久，新的問題就又出現了。BINARY是MySQL獨有的關鍵字，Oracle數據庫並不認識什麼BINARY，而項目需要適配不同的數據庫，主要包括MySQL和Oracle。公司有一套ORM來做這樣的適配，開發人員只要按照標準來寫SQL就可以了，但是，如果在SQL語句中加上BINARY，切換到Oracle數據庫就會出錯，這可怎麼辦？！當然，也可以判斷數據庫的類型，如果是MySQL數據庫，就加上BINARY關鍵字，否則就不加（Oracle數據庫可以嚴格區分後置空格），但是，這樣的改動也太大了，因為MySQL中的語句都完全忽略了後置空格的存在，比如GROUP BY：</p><pre><code>SELECT name,COUNT(*) FROM white_space GROUP BY name</code></pre><p>返回這樣的結果：</p><img alt=一個空格引發的“慘案“ onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/Rs8qmKv5l3CQGS><p>也是完全忽略了後置空格，當然，加上BINARY也是可以解決問題的。</p><p>這樣看來，只要涉及到需要嚴格區分字符串的地方，都需要做這樣的改動，而這樣的字段還有好幾個，改動實在太大了！</p><p>事到如今，小張依然還沒有找到完善的解決方案，開發的工期也一拖再拖，可以說是一樁不折不扣的“慘案”了。</p><p>親愛的讀者朋友，你有什麼好的解決方案嗎？歡迎後臺留言討論。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>一個</a></li><li><a>引發</a></li><li><a>慘案</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E9%81%8A%E6%88%B2/fa5858ca.html alt=一個外賣引發的騙局 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/321f00044998d7d44460 style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/fa5858ca.html title=一個外賣引發的騙局>一個外賣引發的騙局</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6eb8bbfb.html alt=一個問題引發的統計學派之爭 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RG2r5FA2oJUVhk style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6eb8bbfb.html title=一個問題引發的統計學派之爭>一個問題引發的統計學派之爭</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9a2ffd41.html alt=語音助手正在引發一個新的科技熱潮 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1535940841107c9de161be5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9a2ffd41.html title=語音助手正在引發一個新的科技熱潮>語音助手正在引發一個新的科技熱潮</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3f26d67.html alt=一個“砷”字引發的飼料“血案” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3f26d67.html title=一個“砷”字引發的飼料“血案”>一個“砷”字引發的飼料“血案”</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ac25d2d0.html alt=30分鐘教你搭建一個網站（一）：購買和配置服務器 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/5f26f1582a564e93bde33a7dd9448c3b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ac25d2d0.html title=30分鐘教你搭建一個網站（一）：購買和配置服務器>30分鐘教你搭建一個網站（一）：購買和配置服務器</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d8be5e94.html alt=不會買服務器？一個辦法讓你輕鬆搭網站 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/84d9c54578de46058796824f1bcb6a9b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d8be5e94.html title=不會買服務器？一個辦法讓你輕鬆搭網站>不會買服務器？一個辦法讓你輕鬆搭網站</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c811c5f7.html alt=使用服務器搭建一個網站 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/63a6cc0eb4d146e0890515500c0040ca style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c811c5f7.html title=使用服務器搭建一個網站>使用服務器搭建一個網站</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4b69aa7f.html alt=做一個小型網站，服務器需要什麼配置的呢？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4b69aa7f.html title=做一個小型網站，服務器需要什麼配置的呢？>做一個小型網站，服務器需要什麼配置的呢？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eee4b8ad.html alt=搭建一個網站，租服務器大概多少錢？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eee4b8ad.html title=搭建一個網站，租服務器大概多少錢？>搭建一個網站，租服務器大概多少錢？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/62d46b38.html alt=素描祕籍｜一個耳朵！9大知識點，360度全方位深度剖析講解示範！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/5e7b0005767168b2b87d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/62d46b38.html title=素描祕籍｜一個耳朵！9大知識點，360度全方位深度剖析講解示範！>素描祕籍｜一個耳朵！9大知識點，360度全方位深度剖析講解示範！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/647df9c2.html alt=一個男人每天24小時跟妻子在一起，久而久之會怎樣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8359cc22f03e478a8cdb889dcfea3f99 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/647df9c2.html title=一個男人每天24小時跟妻子在一起，久而久之會怎樣>一個男人每天24小時跟妻子在一起，久而久之會怎樣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5a86d7d9.html alt=每天一個好習慣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RKdGgquJFM6gnc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5a86d7d9.html title=每天一個好習慣>每天一個好習慣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/756b16fb.html alt=奶粉寄出一個月，家人遲遲收不到，物流信息也查詢不到，事發阜陽某韻達快遞網點 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/3fd8ec4e-64c1-446a-adfa-38088fb06c01 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/756b16fb.html title=奶粉寄出一個月，家人遲遲收不到，物流信息也查詢不到，事發阜陽某韻達快遞網點>奶粉寄出一個月，家人遲遲收不到，物流信息也查詢不到，事發阜陽某韻達快遞網點</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b29ee719.html alt=又一個走上不歸路的搬磚人 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/bf471da0a06441f88bce49b959234257 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b29ee719.html title=又一個走上不歸路的搬磚人>又一個走上不歸路的搬磚人</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3d6d5661.html alt=多收藏一個，就少求一次人—哪些日常必備神級網站，真正值得收藏 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/833949926ebf49b89c5fb4075a9cffdd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3d6d5661.html title=多收藏一個，就少求一次人—哪些日常必備神級網站，真正值得收藏>多收藏一個，就少求一次人—哪些日常必備神級網站，真正值得收藏</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>