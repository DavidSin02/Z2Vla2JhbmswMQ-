<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Goç™¼èµ·HTTP2.0è«‹æ±‚æµç¨‹åˆ†æ(ä¸­ç¯‡)â€”â€”æ•¸æ“šå¹€&æµæ§åˆ¶ | æå®¢å¿«è¨Š</title><meta property="og:title" content="Goç™¼èµ·HTTP2.0è«‹æ±‚æµç¨‹åˆ†æ(ä¸­ç¯‡)â€”â€”æ•¸æ“šå¹€&æµæ§åˆ¶ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/ca343b56966046c6b646b9debecaf505"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/33bf159.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/33bf159.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/33bf159.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/33bf159.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/33bf159.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/33bf159.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/33bf159.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/33bf159.html><meta property="article:published_time" content="2020-10-29T21:06:37+08:00"><meta property="article:modified_time" content="2020-10-29T21:06:37+08:00"><meta name=Keywords content><meta name=description content="Goç™¼èµ·HTTP2.0è«‹æ±‚æµç¨‹åˆ†æ(ä¸­ç¯‡)â€”â€”æ•¸æ“šå¹€&æµæ§åˆ¶"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/33bf159.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Goç™¼èµ·HTTP2.0è«‹æ±‚æµç¨‹åˆ†æ(ä¸­ç¯‡)â€”â€”æ•¸æ“šå¹€&æµæ§åˆ¶</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><blockquote class=pgc-blockquote-abstract><p>ä¾†è‡ªå…¬çœ¾è™Ÿï¼šæ–°ä¸–ç•Œé›œè²¨é‹ª</p></blockquote><h1 class=pgc-h-arrow-right>é–±è®€å»ºè­°</h1><p style=text-align:start>é€™æ˜¯HTTP2.0ç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œæ‰€ä»¥ç­†è€…æ¨è–¦é–±è®€é †åºå¦‚ä¸‹:</p><ol start=1><li><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6882255113369420299/?group_id=6882255113369420299" rel="noopener noreferrer" target=_blank>Goä¸­çš„HTTPè«‹æ±‚ä¹‹â€”â€”HTTP1.1è«‹æ±‚æµç¨‹åˆ†æ</a></li><li><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6875967557174559244/?group_id=6875967557174559244" rel="noopener noreferrer" target=_blank>Goç™¼èµ·HTTP2.0è«‹æ±‚æµç¨‹åˆ†æ(å‰ç¯‡)</a></li></ol><p style=text-align:start>æœ¬ç¯‡ä¸»è¦åˆ†ç‚ºä¸‰å€‹éƒ¨åˆ†ï¼šæ•¸æ“šå¹€ï¼Œæµæ§åˆ¶å™¨ä»¥åŠé€šéåˆ†ææºç¢¼é€æ­¥ç­è§£æµæ§åˆ¶ã€‚</p><p style=text-align:start>æœ¬æœ‰æ„å°‡é€™ä¸‰å€‹éƒ¨åˆ†æ‹†æˆä¸‰ç¯‡æ–‡ç« ï¼Œä½†å®ƒå€‘ä¹‹é–“åˆæœ‰è¯ç¹«ï¼Œæ‰€ä»¥æœ€å¾Œä¾èˆŠæ±ºå®šæ”¾åœ¨ä¸€ç¯‡æ–‡ç« è£¡é¢ã€‚ç”±æ–¼å…§å®¹è¼ƒå¤šï¼Œç­†è€…èªç‚ºåˆ†ä¸‰æ¬¡åˆ†åˆ¥é–±è®€ä¸‰å€‹éƒ¨åˆ†è¼ƒä½³ã€‚</p><h1 class=pgc-h-arrow-right>æ•¸æ“šå¹€</h1><p style=text-align:start>HTTP2é€šä¿¡çš„æœ€å°å–®ä½æ˜¯æ•¸æ“šå¹€ï¼Œæ¯ä¸€å€‹å¹€éƒ½åŒ…å«å…©éƒ¨åˆ†ï¼š<strong>å¹€é ­</strong>å’Œ<strong>Payload</strong>ã€‚ä¸åŒæ•¸æ“šæµçš„å¹€å¯ä»¥äº¤éŒ¯ç™¼é€(åŒä¸€å€‹æ•¸æ“šæµçš„å¹€å¿…é ˆé †åºç™¼é€)ï¼Œç„¶å¾Œå†æ ¹æ“šæ¯å€‹å¹€é ­çš„æ•¸æ“šæµæ¨™è­˜ç¬¦é‡æ–°çµ„è£ã€‚</p><p style=text-align:start>ç”±æ–¼Payloadä¸­ç‚ºæœ‰æ•ˆæ•¸æ“šï¼Œæ•…åƒ…å°å¹€é ­é€²è¡Œåˆ†ææè¿°ã€‚</p><h1 class=pgc-h-arrow-right>å¹€é ­</h1><p style=text-align:start><strong>å¹€é ­ç¸½é•·åº¦ç‚º9å€‹å­—ç¯€</strong>ï¼Œå¹·åŒ…å«å››å€‹éƒ¨åˆ†ï¼Œåˆ†åˆ¥æ˜¯ï¼š</p><ol start=1><li>Payloadçš„é•·åº¦ï¼Œä½”ç”¨ä¸‰å€‹å­—ç¯€ã€‚</li><li>æ•¸æ“šå¹€é¡å‹ï¼Œä½”ç”¨ä¸€å€‹å­—ç¯€ã€‚</li><li>æ•¸æ“šå¹€æ¨™è­˜ç¬¦ï¼Œä½”ç”¨ä¸€å€‹å­—ç¯€ã€‚</li><li>æ•¸æ“šæµIDï¼Œä½”ç”¨å››å€‹å­—ç¯€ã€‚</li></ol><p style=text-align:start>ç”¨åœ–è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><div class=pgc-img><img alt=Goç™¼èµ·HTTP2.0è«‹æ±‚æµç¨‹åˆ†æ(ä¸­ç¯‡)â€”â€”æ•¸æ“šå¹€&æµæ§åˆ¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ca343b56966046c6b646b9debecaf505><p class=pgc-img-caption></p></div><p style=text-align:start>æ•¸æ“šå¹€çš„æ ¼å¼å’Œå„éƒ¨åˆ†çš„å«ç¾©å·²ç¶“æ¸…æ¥šäº†ï¼Œ é‚£éº¼æˆ‘å€‘çœ‹çœ‹ä»£ç¢¼ä¸­æ€éº¼è®€å–ä¸€å€‹å¹€é ­ï¼š</p><pre><code>func http2readFrameHeader(buf []byte, r io.Reader) (http2FrameHeader, error) {	_, err := io.ReadFull(r, buf[:http2frameHeaderLen])	if err != nil {		return http2FrameHeader{}, err	}	return http2FrameHeader{		Length:   (uint32(buf[0])&lt;&lt;16 | uint32(buf[1])&lt;&lt;8 | uint32(buf[2])),		Type:     http2FrameType(buf[3]),		Flags:    http2Flags(buf[4]),		StreamID: binary.BigEndian.Uint32(buf[5:]) &amp; (1&lt;&lt;31 - 1),		valid:    true,	}, nil}</code></pre><p style=text-align:start>åœ¨ä¸Šé¢çš„ä»£ç¢¼ä¸­http2frameHeaderLenæ˜¯ä¸€å€‹å¸¸é‡ï¼Œå…¶å€¼ç‚º9ã€‚</p><p style=text-align:start>å¾io.Readerä¸­è®€å–9å€‹å­—ç¯€å¾Œï¼Œå°‡å‰ä¸‰å€‹å­—ç¯€å’Œå¾Œå››å€‹å­—ç¯€å‡è½‰ç‚ºuint32çš„é¡å‹ï¼Œå¾è€Œå¾—åˆ°Payloadé•·åº¦å’Œæ•¸æ“šæµIDã€‚å¦å¤–éœ€è¦ç†è§£çš„æ˜¯å¹€é ­çš„å‰ä¸‰å€‹å­—ç¯€å’Œå¾Œå››å€‹å­—ç¯€å­˜å„²æ ¼å¼ç‚ºå¤§ç«¯ï¼ˆå¤§å°ç«¯ç­†è€…å°±ä¸åœ¨é€™è£¡è§£é‡‹äº†ï¼Œè«‹å°šä¸ç­è§£çš„è®€è€…è‡ªè¡Œç™¾åº¦ï¼‰ã€‚</p><h1 class=pgc-h-arrow-right>æ•¸æ“šå¹€é¡å‹</h1><p style=text-align:start>æ ¹æ“šhttp://http2.github.io/http2-spec/#rfc.section.11.2æè¿°ï¼Œæ•¸æ“šå¹€é¡å‹ç¸½å…±æœ‰10å€‹ã€‚åœ¨goæºç¢¼ä¸­å‡æœ‰é«”ç¾ï¼š</p><pre><code>const (	http2FrameData         http2FrameType = 0x0	http2FrameHeaders      http2FrameType = 0x1	http2FramePriority     http2FrameType = 0x2	http2FrameRSTStream    http2FrameType = 0x3	http2FrameSettings     http2FrameType = 0x4	http2FramePushPromise  http2FrameType = 0x5	http2FramePing         http2FrameType = 0x6	http2FrameGoAway       http2FrameType = 0x7	http2FrameWindowUpdate http2FrameType = 0x8	http2FrameContinuation http2FrameType = 0x9)</code></pre><p style=text-align:start>http2FrameDataï¼šä¸»è¦ç”¨æ–¼ç™¼é€è«‹æ±‚bodyå’Œæ¥æ”¶éŸ¿æ‡‰çš„æ•¸æ“šå¹€ã€‚</p><p style=text-align:start>http2FrameHeadersï¼šä¸»è¦ç”¨æ–¼ç™¼é€è«‹æ±‚headerå’Œæ¥æ”¶éŸ¿æ‡‰headerçš„æ•¸æ“šå¹€ã€‚</p><p style=text-align:start>http2FrameSettingsï¼šä¸»è¦ç”¨æ–¼clientå’Œserveräº¤æµè¨­ç½®ç›¸é—œçš„æ•¸æ“šå¹€ã€‚</p><p style=text-align:start>http2FrameWindowUpdateï¼šä¸»è¦ç”¨æ–¼æµæ§åˆ¶çš„æ•¸æ“šå¹€ã€‚</p><p style=text-align:start>å…¶ä»–æ•¸æ“šå¹€é¡å‹å› ç‚ºæœ¬æ–‡ä¸æ¶‰åŠï¼Œæ•…ä¸åšæè¿°ã€‚</p><h1 class=pgc-h-arrow-right>æ•¸æ“šå¹€æ¨™è­˜ç¬¦</h1><p style=text-align:start>ç”±æ–¼æ•¸æ“šå¹€æ¨™è­˜ç¬¦ç¨®é¡è¼ƒå¤šï¼Œç­†è€…åœ¨é€™è£¡åƒ…ä»‹ç´¹å…¶ä¸­éƒ¨åˆ†æ¨™è­˜ç¬¦ï¼Œå…ˆçœ‹æºç¢¼ï¼š</p><pre><code>const (	// Data Frame	http2FlagDataEndStream http2Flags = 0x1    // Headers Frame	http2FlagHeadersEndStream  http2Flags = 0x1    // Settings Frame	http2FlagSettingsAck http2Flags = 0x1	// æ­¤è™•çœç•¥å®šç¾©å…¶ä»–æ•¸æ“šå¹€æ¨™è­˜ç¬¦çš„ä»£ç¢¼)</code></pre><p style=text-align:start>http2FlagDataEndStreamï¼šåœ¨å‰ç¯‡ä¸­æåˆ°ï¼Œèª¿ç”¨(*http2ClientConn).newStreamæ–¹æ³•æœƒå‰µå»ºä¸€å€‹æ•¸æ“šæµï¼Œé‚£é€™å€‹æ•¸æ“šæµä»€éº¼æ™‚å€™çµæŸå‘¢ï¼Œé€™å°±æ˜¯http2FlagDataEndStreamçš„ä½œç”¨ã€‚</p><p style=text-align:start>ç•¶clientæ”¶åˆ°æœ‰éŸ¿æ‡‰bodyçš„éŸ¿æ‡‰æ™‚ï¼ˆHEADè«‹æ±‚ç„¡éŸ¿æ‡‰bodyï¼Œ301ï¼Œ302ç­‰éŸ¿æ‡‰ä¹Ÿç„¡éŸ¿æ‡‰bodyï¼‰ï¼Œä¸€ç›´è®€åˆ°http2FrameDataæ•¸æ“šå¹€çš„æ¨™è­˜ç¬¦ç‚ºhttp2FlagDataEndStreamå‰‡æ„å‘³è‘—æœ¬æ¬¡è«‹æ±‚çµæŸå¯ä»¥é—œé–‰ç•¶å‰æ•¸æ“šæµã€‚</p><p style=text-align:start>http2FlagHeadersEndStreamï¼šå¦‚æœè®€åˆ°çš„http2FrameHeadersæ•¸æ“šå¹€æœ‰æ­¤æ¨™è­˜ç¬¦ä¹Ÿæ„å‘³è‘—æœ¬æ¬¡è«‹æ±‚çµæŸã€‚</p><p style=text-align:start>http2FlagSettingsAckï¼šè©²æ¨™ç¤ºç¬¦æ„å‘³è‘—å°æ–¹ç¢ºèªæ”¶åˆ°http2FrameSettingsæ•¸æ“šå¹€ã€‚</p><h1 class=pgc-h-arrow-right>æµæ§åˆ¶å™¨</h1><p style=text-align:start>æµæ§åˆ¶æ˜¯ä¸€ç¨®é˜»æ­¢ç™¼é€æ–¹å‘æ¥æ”¶æ–¹ç™¼é€å¤§é‡æ•¸æ“šçš„æ©Ÿåˆ¶ï¼Œä»¥å…è¶…å‡ºå¾Œè€…çš„éœ€æ±‚æˆ–è™•ç†èƒ½åŠ›ã€‚Goä¸­HTTP2é€šéhttp2flowçµæ§‹é«”é€²è¡Œæµæ§åˆ¶ï¼š</p><pre><code>type http2flow struct {	// n is the number of DATA bytes we're allowed to send.	// A flow is kept both on a conn and a per-stream.	n int32	// conn points to the shared connection-level flow that is	// shared by all streams on that conn. It is nil for the flow	// that's on the conn directly.	conn *http2flow}</code></pre><p style=text-align:start>å­—æ®µå«ç¾©è‹±æ–‡è¨»é‡‹å·²ç¶“æè¿°çš„å¾ˆæ¸…æ¥šäº†ï¼Œæ‰€ä»¥ç­†è€…ä¸å†ç¿»è­¯ã€‚ä¸‹é¢çœ‹ä¸€ä¸‹å’Œæµæ§åˆ¶æœ‰é—œçš„æ–¹æ³•ã€‚</p><h1 class=pgc-h-arrow-right>(*http2flow).available</h1><p style=text-align:start>æ­¤æ–¹æ³•è¿”å›ç•¶å‰æµæ§åˆ¶å¯ç™¼é€çš„æœ€å¤§å­—ç¯€æ•¸ï¼š</p><pre><code>func (f *http2flow) available() int32 {	n := f.n	if f.conn != nil &amp;&amp; f.conn.n &lt; n {		n = f.conn.n	}	return n}</code></pre><ul><li>å¦‚æœf.connç‚ºnilå‰‡æ„å‘³è‘—æ­¤æ§åˆ¶å™¨çš„æ§åˆ¶ç´šåˆ¥ç‚ºé€£æ¥ï¼Œé‚£éº¼å¯ç™¼é€çš„æœ€å¤§å­—ç¯€æ•¸å°±æ˜¯f.nã€‚</li><li>å¦‚æœf.connä¸ç‚ºnilå‰‡æ„å‘³è‘—æ­¤æ§åˆ¶å™¨çš„æ§åˆ¶ç´šåˆ¥ç‚ºæ•¸æ“šæµï¼Œä¸”ç•¶å‰æ•¸æ“šæµå¯ç™¼é€çš„æœ€å¤§å­—ç¯€æ•¸ä¸èƒ½è¶…éç•¶å‰é€£æ¥å¯ç™¼é€çš„æœ€å¤§å­—ç¯€æ•¸ã€‚</li></ul><h1 class=pgc-h-arrow-right>(*http2flow).take</h1><p style=text-align:start>æ­¤æ–¹æ³•ç”¨æ–¼æ¶ˆè€—ç•¶å‰æµæ§åˆ¶å™¨çš„å¯ç™¼é€å­—ç¯€æ•¸ï¼š</p><pre><code>func (f *http2flow) take(n int32) {	if n &gt; f.available() {		panic("internal error: took too much")	}	f.n -= n	if f.conn != nil {		f.conn.n -= n	}}</code></pre><p style=text-align:start>é€šéå¯¦éš›éœ€è¦å‚³éä¸€å€‹åƒæ•¸ï¼Œå‘ŠçŸ¥ç•¶å‰æµæ§åˆ¶å™¨æƒ³è¦ç™¼é€çš„æ•¸æ“šå¤§å°ã€‚å¦‚æœç™¼é€çš„å¤§å°è¶…éæµæ§åˆ¶å™¨å…è¨±çš„å¤§å°ï¼Œå‰‡panicï¼Œå¦‚æœæœªè¶…éæµæ§åˆ¶å™¨å…è¨±çš„å¤§å°ï¼Œå‰‡å°‡ç•¶å‰æ•¸æ“šæµå’Œç•¶å‰é€£æ¥çš„å¯ç™¼é€å­—ç¯€æ•¸-nã€‚</p><h1 class=pgc-h-arrow-right>(*http2flow).add</h1><p style=text-align:start>æœ‰æ¶ˆè€—å°±æœ‰æ–°å¢ï¼Œæ­¤æ–¹æ³•ç”¨æ–¼å¢åŠ æµæ§åˆ¶å™¨å¯ç™¼é€çš„æœ€å¤§å­—ç¯€æ•¸ï¼š</p><pre><code>func (f *http2flow) add(n int32) bool {	sum := f.n + n	if (sum &gt; n) == (f.n &gt; 0) {		f.n = sum		return true	}	return false}</code></pre><p style=text-align:start>ä¸Šé¢çš„ä»£ç¢¼å”¯ä¸€éœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œç•¶sumè¶…éint32æ­£æ•¸æœ€å¤§å€¼(2^31-1)æ™‚æœƒè¿”å›falseã€‚</p><p style=text-align:start><strong>å›é¡§</strong>ï¼šåœ¨å‰ç¯‡ä¸­æåˆ°çš„(*http2Transport).NewClientConnæ–¹æ³•å’Œ(*http2ClientConn).newStreamæ–¹æ³•å‡é€šé(*http2flow).addåˆå§‹åŒ–å¯ç™¼é€æ•¸æ“šçª—å£å¤§å°ã€‚</p><p style=text-align:start>æœ‰äº†å¹€å’Œæµæ§åˆ¶å™¨çš„åŸºæœ¬æ¦‚å¿µï¼Œä¸‹é¢æˆ‘å€‘çµåˆæºç¢¼ä¾†åˆ†æç¸½çµæµæ§åˆ¶çš„å…·é«”å¯¦ç¾ã€‚</p><h1 class=pgc-h-arrow-right>(*http2ClientConn).readLoop</h1><p style=text-align:start>å‰ç¯‡åˆ†æ(*http2Transport).newClientConnæ™‚æ­¢æ­¥æ–¼è®€å¾ªç’°ï¼Œé‚£éº¼ä»Šå¤©æˆ‘å€‘å°±å¾(*http2ClientConn).readLoopé–‹å§‹ã€‚</p><pre><code>func (cc *http2ClientConn) readLoop() {	rl := &amp;http2clientConnReadLoop{cc: cc}	defer rl.cleanup()	cc.readerErr = rl.run()	if ce, ok := cc.readerErr.(http2ConnectionError); ok {		cc.wmu.Lock()		cc.fr.WriteGoAway(0, http2ErrCode(ce), nil)		cc.wmu.Unlock()	}}</code></pre><p style=text-align:start>ç”±ä¸Šå¯çŸ¥ï¼ŒreadLoopçš„é‚è¼¯æ¯”è¼ƒç°¡å–®ï¼Œå…¶æ ¸å¿ƒé‚è¼¯åœ¨(*http2clientConnReadLoop).runæ–¹æ³•è£¡ã€‚</p><pre><code>func (rl *http2clientConnReadLoop) run() error {	cc := rl.cc	rl.closeWhenIdle = cc.t.disableKeepAlives() || cc.singleUse	gotReply := false // ever saw a HEADERS reply	gotSettings := false	for {		f, err := cc.fr.ReadFrame()    // æ­¤è™•çœç•¥ä»£ç¢¼		maybeIdle := false // whether frame might transition us to idle		switch f := f.(type) {		case *http2MetaHeadersFrame:			err = rl.processHeaders(f)			maybeIdle = true			gotReply = true		case *http2DataFrame:			err = rl.processData(f)			maybeIdle = true		case *http2GoAwayFrame:			err = rl.processGoAway(f)			maybeIdle = true		case *http2RSTStreamFrame:			err = rl.processResetStream(f)			maybeIdle = true		case *http2SettingsFrame:			err = rl.processSettings(f)		case *http2PushPromiseFrame:			err = rl.processPushPromise(f)		case *http2WindowUpdateFrame:			err = rl.processWindowUpdate(f)		case *http2PingFrame:			err = rl.processPing(f)		default:			cc.logf("Transport: unhandled response frame type %T", f)		}		if err != nil {			if http2VerboseLogs {				cc.vlogf("http2: Transport conn %p received error from processing frame %v: %v", cc, http2summarizeFrame(f), err)			}			return err		}		if rl.closeWhenIdle &amp;&amp; gotReply &amp;&amp; maybeIdle {			cc.closeIfIdle()		}	}}</code></pre><p style=text-align:start>ç”±ä¸Šå¯çŸ¥ï¼Œ(*http2clientConnReadLoop).runçš„æ ¸å¿ƒé‚è¼¯æ˜¯è®€å–æ•¸æ“šå¹€ç„¶å¾Œå°ä¸åŒçš„æ•¸æ“šå¹€é€²è¡Œä¸åŒçš„è™•ç†ã€‚</p><p style=text-align:start>cc.fr.ReadFrame()æœƒæ ¹æ“šå‰é¢ä»‹ç´¹çš„æ•¸æ“šå¹€æ ¼å¼è®€å‡ºæ•¸æ“šå¹€ã€‚</p><p style=text-align:start>å‰ç¯‡ä¸­æåˆ°ä½¿ç”¨äº†ä¸€å€‹æ”¯æŒh2å”è­°çš„åœ–ç‰‡é€²è¡Œåˆ†æï¼Œæœ¬ç¯‡ç¹¼çºŒè¤‡ç”¨è©²åœ–ç‰‡å°(*http2clientConnReadLoop).runæ–¹æ³•é€²è¡Œdebugã€‚</p><h1 class=pgc-h-arrow-right>æ”¶åˆ°http2FrameSettingsæ•¸æ“šå¹€</h1><p style=text-align:start>è®€å¾ªç’°æœƒæœ€å…ˆè®€åˆ°http2FrameSettingsæ•¸æ“šå¹€ã€‚è®€åˆ°è©²æ•¸æ“šå¹€å¾Œæœƒèª¿ç”¨(*http2clientConnReadLoop).processSettingsæ–¹æ³•ã€‚(*http2clientConnReadLoop).processSettingsä¸»è¦åŒ…å«3å€‹é‚è¼¯ã€‚</p><p style=text-align:start>1ã€åˆ¤æ–·æ˜¯å¦æ˜¯http2FrameSettingsçš„ackä¿¡æ¯ï¼Œå¦‚æœæ˜¯ç›´æ¥è¿”å›ï¼Œå¦å‰‡ç¹¼çºŒå¾Œé¢çš„æ­¥é©Ÿã€‚</p><pre><code>if f.IsAck() {  if cc.wantSettingsAck {    cc.wantSettingsAck = false    return nil  }  return http2ConnectionError(http2ErrCodeProtocol)}</code></pre><p style=text-align:start>2ã€è™•ç†ä¸åŒhttp2FrameSettingsçš„æ•¸æ“šå¹€ï¼Œä¸¦æ ¹æ“šserverå‚³éçš„ä¿¡æ¯ï¼Œä¿®æ”¹maxConcurrentStreamsç­‰çš„å€¼ã€‚</p><pre><code>err := f.ForeachSetting(func(s http2Setting) error {  switch s.ID {    case http2SettingMaxFrameSize:    cc.maxFrameSize = s.Val    case http2SettingMaxConcurrentStreams:    cc.maxConcurrentStreams = s.Val    case http2SettingMaxHeaderListSize:    cc.peerMaxHeaderListSize = uint64(s.Val)    case http2SettingInitialWindowSize:    if s.Val &gt; math.MaxInt32 {      return http2ConnectionError(http2ErrCodeFlowControl)    }    delta := int32(s.Val) - int32(cc.initialWindowSize)    for _, cs := range cc.streams {      cs.flow.add(delta)    }    cc.cond.Broadcast()    cc.initialWindowSize = s.Val    default:    // TODO(bradfitz): handle more settings? SETTINGS_HEADER_TABLE_SIZE probably.    cc.vlogf("Unhandled Setting: %v", s)  }  return nil})</code></pre><p style=text-align:start>ç•¶æ”¶åˆ°IDç‚ºhttp2SettingInitialWindowSizeçš„å¹€æ™‚ï¼Œæœƒèª¿æ•´ç•¶å‰é€£æ¥ä¸­æ‰€æœ‰æ•¸æ“šæµçš„å¯ç™¼é€æ•¸æ“šçª—å£å¤§å°ï¼Œä¸¦ä¿®æ”¹ç•¶å‰é€£æ¥çš„initialWindowSizeï¼ˆæ¯å€‹æ–°å‰µå»ºçš„æ•¸æ“šæµå‡æœƒä½¿ç”¨è©²å€¼åˆå§‹åŒ–å¯ç™¼é€æ•¸æ“šçª—å£å¤§å°ï¼‰ç‚ºs.Valã€‚</p><p style=text-align:start>3ã€ç™¼é€http2FrameSettingsçš„ackä¿¡æ¯çµ¦serverã€‚</p><pre><code>	cc.wmu.Lock()	defer cc.wmu.Unlock()	cc.fr.WriteSettingsAck()	cc.bw.Flush()	return cc.werr</code></pre><h1 class=pgc-h-arrow-right>æ”¶åˆ°http2WindowUpdateFrameæ•¸æ“šå¹€</h1><p style=text-align:start>åœ¨ç­†è€…debugçš„éç¨‹ä¸­ï¼Œè™•ç†å®Œhttp2FrameSettingsæ•¸æ“šå¹€å¾Œï¼Œç·Šæ¥è‘—å°±æ”¶åˆ°äº†http2WindowUpdateFrameæ•¸æ“šå¹€ã€‚æ”¶åˆ°è©²æ•¸æ“šå¹€å¾Œæœƒèª¿ç”¨(*http2clientConnReadLoop).processWindowUpdateæ–¹æ³•ï¼š</p><pre><code>func (rl *http2clientConnReadLoop) processWindowUpdate(f *http2WindowUpdateFrame) error {	cc := rl.cc	cs := cc.streamByID(f.StreamID, false)	if f.StreamID != 0 &amp;&amp; cs == nil {		return nil	}	cc.mu.Lock()	defer cc.mu.Unlock()	fl := &amp;cc.flow	if cs != nil {		fl = &amp;cs.flow	}	if !fl.add(int32(f.Increment)) {		return http2ConnectionError(http2ErrCodeFlowControl)	}	cc.cond.Broadcast()	return nil}</code></pre><p style=text-align:start>ä¸Šé¢çš„é‚è¼¯ä¸»è¦ç”¨æ–¼æ›´æ–°ç•¶å‰é€£æ¥å’Œæ•¸æ“šæµçš„å¯ç™¼é€æ•¸æ“šçª—å£å¤§å°ã€‚å¦‚æœhttp2WindowUpdateFrameå¹€ä¸­çš„StreamIDç‚º0ï¼Œå‰‡æ›´æ–°ç•¶å‰é€£æ¥çš„å¯ç™¼é€æ•¸æ“šçª—å£å¤§å°ï¼Œå¦å‰‡æ›´æ–°å°æ‡‰æ•¸æ“šæµå¯ç™¼é€æ•¸æ“šçª—å£å¤§å°ã€‚</p><p style=text-align:start><strong>æ³¨æ„</strong>ï¼šåœ¨debugçš„éç¨‹ï¼Œæ”¶åˆ°http2WindowUpdateFrameæ•¸æ“šå¹€å¾Œï¼Œåˆæ”¶åˆ°ä¸€æ¬¡http2FrameSettingsï¼Œä¸”è©²æ•¸æ“šå¹€æ¨™è­˜ç¬¦ç‚ºhttp2FlagSettingsAckã€‚</p><p style=text-align:start>ç­†è€…åœ¨é€™è£¡ç‰¹æ„æé†’ï¼Œé€™æ˜¯å› ç‚ºå‰ç¯‡ä¸­æåˆ°çš„(*http2Transport).NewClientConnæ–¹æ³•ï¼Œä¹Ÿå‘serverç™¼é€äº†http2FrameSettingsæ•¸æ“šå¹€å’Œhttp2WindowUpdateFrameæ•¸æ“šå¹€ã€‚</p><p style=text-align:start>å¦å¤–ï¼Œåœ¨è™•ç†http2FrameSettingså’Œhttp2WindowUpdateFrameéç¨‹ä¸­ï¼Œå‡å‡ºç¾äº†cc.cond.Broadcast()èª¿ç”¨ï¼Œè©²èª¿ç”¨ä¸»è¦ç”¨æ–¼å–šé†’å› ç‚ºä»¥ä¸‹å…©ç¨®æƒ…æ³è€ŒWaitçš„è«‹æ±‚ï¼š</p><ol start=1><li>å› ç•¶å‰é€£æ¥è™•ç†çš„æ•¸æ“šæµå·²ç¶“é”åˆ°maxConcurrentStreamsçš„ä¸Šé™ï¼ˆè©³è¦‹å‰ç¯‡ä¸­(*http2ClientConn).awaitOpenSlotForRequestæ–¹æ³•åˆ†æï¼‰ã€‚</li><li>å› ç™¼é€æ•¸æ“šæµå·²é”å¯ç™¼é€æ•¸æ“šçª—å£ä¸Šé™è€Œç­‰å¾…å¯ç™¼é€æ•¸æ“šçª—å£æ›´æ–°çš„è«‹æ±‚ï¼ˆå¾ŒçºŒæœƒä»‹ç´¹ï¼‰ã€‚</li></ol><h1 class=pgc-h-arrow-right>æ”¶åˆ°http2MetaHeadersFrameæ•¸æ“šå¹€</h1><p style=text-align:start>æ”¶åˆ°æ­¤æ•¸æ“šå¹€æ„å‘³è‘—æŸä¸€å€‹è«‹æ±‚å·²ç¶“é–‹å§‹æ¥æ”¶éŸ¿æ‡‰æ•¸æ“šã€‚æ­¤æ•¸æ“šå¹€å°æ‡‰çš„è™•ç†å‡½æ•¸ç‚º(*http2clientConnReadLoop).processHeadersï¼š</p><pre><code>func (rl *http2clientConnReadLoop) processHeaders(f *http2MetaHeadersFrame) error {	cc := rl.cc	cs := cc.streamByID(f.StreamID, false)	// æ­¤è™•çœç•¥ä»£ç¢¼	res, err := rl.handleResponse(cs, f)	if err != nil {		// æ­¤è™•çœç•¥ä»£ç¢¼		cs.resc &lt;- http2resAndError{err: err}		return nil // return nil from process* funcs to keep conn alive	}	if res == nil {		// (nil, nil) special case. See handleResponse docs.		return nil	}	cs.resTrailer = &amp;res.Trailer	cs.resc &lt;- http2resAndError{res: res}	return nil}</code></pre><p style=text-align:start>é¦–å…ˆæˆ‘å€‘å…ˆçœ‹cs.resc &lt;- http2resAndError{res: res}é€™ä¸€è¡Œä»£ç¢¼ï¼Œå‘æ•¸æ“šæµå¯«å…¥http2resAndErrorå³æœ¬æ¬¡è«‹æ±‚çš„éŸ¿æ‡‰ã€‚åœ¨(*http2ClientConn).roundTripæ–¹æ³•ä¸­æœ‰é€™æ¨£ä¸€è¡Œä»£ç¢¼readLoopResCh := cs.rescã€‚</p><p style=text-align:start><strong>å›é¡§</strong>ï¼šå‰ç¯‡(*http2ClientConn).roundTripæ–¹æ³•çš„ç¬¬7é»å’Œæœ¬éƒ¨åˆ†é—œè¯èµ·ä¾†å°±å¯ä»¥å½¢æˆä¸€å€‹å®Œæ•´çš„è«‹æ±‚éˆã€‚</p><p style=text-align:start>æ¥ä¸‹ä¾†æˆ‘å€‘å°rl.handleResponseæ–¹æ³•å±•é–‹åˆ†æã€‚</p><h1 class=pgc-h-arrow-right>(*http2clientConnReadLoop).handleResponse</h1><p style=text-align:start>(*http2clientConnReadLoop).handleResponseçš„ä¸»è¦ä½œç”¨æ˜¯æ§‹å»ºä¸€å€‹Responseè®Šé‡ï¼Œä¸‹é¢å°è©²å‡½æ•¸çš„é—œéµæ­¥é©Ÿé€²è¡Œæè¿°ã€‚</p><p style=text-align:start>1ã€æ§‹å»ºä¸€å€‹Responseè®Šé‡ã€‚</p><pre><code>header := make(Header)res := &amp;Response{  Proto:      "HTTP/2.0",  ProtoMajor: 2,  Header:     header,  StatusCode: statusCode,  Status:     status + " " + StatusText(statusCode),}</code></pre><p style=text-align:start>2ã€æ§‹å»ºheaderï¼ˆæœ¬ç¯‡ä¸å°headeré€²è¡Œå±•é–‹åˆ†æï¼‰ã€‚</p><pre><code>for _, hf := range f.RegularFields() {  key := CanonicalHeaderKey(hf.Name)  if key == "Trailer" {    t := res.Trailer    if t == nil {      t = make(Header)      res.Trailer = t    }    http2foreachHeaderElement(hf.Value, func(v string) {      t[CanonicalHeaderKey(v)] = nil    })  } else {    header[key] = append(header[key], hf.Value)  }}</code></pre><p style=text-align:start>3ã€è™•ç†éŸ¿æ‡‰bodyçš„ContentLengthã€‚</p><pre><code>streamEnded := f.StreamEnded()isHead := cs.req.Method == "HEAD"if !streamEnded || isHead {  res.ContentLength = -1  if clens := res.Header["Content-Length"]; len(clens) == 1 {    if clen64, err := strconv.ParseInt(clens[0], 10, 64); err == nil {      res.ContentLength = clen64    } else {      // TODO: care? unlike http/1, it won't mess up our framing, so it's      // more safe smuggling-wise to ignore.    }  } else if len(clens) &gt; 1 {    // TODO: care? unlike http/1, it won't mess up our framing, so it's    // more safe smuggling-wise to ignore.  }}</code></pre><p style=text-align:start>ç”±ä¸Šå¯çŸ¥ï¼Œç•¶å‰æ•¸æ“šæµæ²’æœ‰çµæŸæˆ–è€…æ˜¯HEADè«‹æ±‚æ‰è®€å–ContentLengthã€‚å¦‚æœheaderä¸­çš„ContentLengthä¸åˆæ³•å‰‡res.ContentLengthçš„å€¼ç‚º <strong>-1</strong>ã€‚</p><p style=text-align:start>4ã€æ§‹å»ºres.Bodyã€‚</p><pre><code>cs.bufPipe = http2pipe{b: &amp;http2dataBuffer{expected: res.ContentLength}}cs.bytesRemain = res.ContentLengthres.Body = http2transportResponseBody{cs}go cs.awaitRequestCancel(cs.req)if cs.requestedGzip &amp;&amp; res.Header.Get("Content-Encoding") == "gzip" {  res.Header.Del("Content-Encoding")  res.Header.Del("Content-Length")  res.ContentLength = -1  res.Body = &amp;http2gzipReader{body: res.Body}  res.Uncompressed = true}</code></pre><p style=text-align:start>æ ¹æ“šContent-Encodingçš„ç·¨ç¢¼æ–¹å¼ï¼Œæœƒæ§‹å»ºå…©ç¨®ä¸åŒçš„Bodyï¼š</p><ol start=1><li>égzipç·¨ç¢¼æ™‚ï¼Œæ§‹é€ çš„res.Bodyé¡å‹ç‚ºhttp2transportResponseBodyã€‚</li><li>gzipç·¨ç¢¼æ™‚ï¼Œæ§‹é€ çš„res.Bodyé¡å‹ç‚ºhttp2gzipReaderã€‚</li></ol><h1 class=pgc-h-arrow-right>æ”¶åˆ°http2DataFrameæ•¸æ“šå¹€</h1><p style=text-align:start>æ”¶åˆ°æ­¤æ•¸æ“šå¹€æ„å‘³è‘—æˆ‘å€‘é–‹å§‹æ¥æ”¶çœŸå¯¦çš„éŸ¿æ‡‰ï¼Œå³å¹³å¸¸é–‹ç™¼ä¸­éœ€è¦è™•ç†çš„æ¥­å‹™æ•¸æ“šã€‚æ­¤æ•¸æ“šå¹€å°æ‡‰çš„è™•ç†å‡½æ•¸ç‚º(*http2clientConnReadLoop).processDataã€‚</p><p style=text-align:start>å› ç‚ºserverç„¡æ³•åŠæ™‚çŸ¥é“æ•¸æ“šæµåœ¨clientç«¯çš„ç‹€æ…‹ï¼Œæ‰€ä»¥serverå¯èƒ½æœƒå‘clientä¸­ä¸€å€‹å·²ç¶“ä¸å­˜åœ¨çš„æ•¸æ“šæµç™¼é€æ•¸æ“šï¼š</p><pre><code>cc := rl.cccs := cc.streamByID(f.StreamID, f.StreamEnded())data := f.Data()if cs == nil {  cc.mu.Lock()  neverSent := cc.nextStreamID  cc.mu.Unlock() // æ­¤è™•çœç•¥ä»£ç¢¼  if f.Length &gt; 0 {    cc.mu.Lock()    cc.inflow.add(int32(f.Length))    cc.mu.Unlock()    cc.wmu.Lock()    cc.fr.WriteWindowUpdate(0, uint32(f.Length))    cc.bw.Flush()    cc.wmu.Unlock()  }  return nil}</code></pre><p style=text-align:start>æ¥æ”¶åˆ°çš„æ•¸æ“šå¹€åœ¨clientæ²’æœ‰å°æ‡‰çš„æ•¸æ“šæµè™•ç†æ™‚ï¼Œé€šéæµæ§åˆ¶å™¨ç‚ºç•¶å‰é€£æ¥å¯è®€çª—å£å¤§å°å¢åŠ f.Lengthï¼Œä¸¦ä¸”é€šéhttp2FrameWindowUpdateæ•¸æ“šå¹€å‘ŠçŸ¥serverå°‡ç•¶å‰é€£æ¥çš„å¯å¯«çª—å£å¤§å°å¢åŠ f.Lengthã€‚</p><p style=text-align:start>å¦‚æœclientæœ‰å°æ‡‰çš„æ•¸æ“šæµä¸”f.Lengthå¤§æ–¼0ï¼š</p><p style=text-align:start>1ã€å¦‚æœæ˜¯headè«‹æ±‚çµæŸç•¶å‰æ•¸æ“šæµä¸¦è¿”å›ã€‚</p><pre><code>if cs.req.Method == "HEAD" &amp;&amp; len(data) &gt; 0 {  cc.logf("protocol error: received DATA on a HEAD request")  rl.endStreamError(cs, http2StreamError{    StreamID: f.StreamID,    Code:     http2ErrCodeProtocol,  })  return nil}</code></pre><p style=text-align:start>2ã€æª¢æŸ¥ç•¶å‰æ•¸æ“šæµèƒ½å¦è™•ç†f.Lengthé•·åº¦çš„æ•¸æ“šã€‚</p><pre><code>cc.mu.Lock()if cs.inflow.available() &gt;= int32(f.Length) {  cs.inflow.take(int32(f.Length))} else {  cc.mu.Unlock()  return http2ConnectionError(http2ErrCodeFlowControl)}</code></pre><p style=text-align:start>ç”±ä¸Šå¯çŸ¥ç•¶å‰æ•¸æ“šæµå¦‚æœèƒ½å¤ è™•ç†è©²æ•¸æ“šï¼Œé€šéæµæ§åˆ¶å™¨èª¿ç”¨cs.inflow.takeæ¸›å°ç•¶å‰æ•¸æ“šæµå¯æ¥å—çª—å£å¤§å°ã€‚</p><p style=text-align:start>3ã€ç•¶å‰æ•¸æ“šæµè¢«é‡ç½®æˆ–è€…è¢«é—œé–‰å³cs.didResetç‚ºtrueæ™‚åˆæˆ–è€…æ•¸æ“šå¹€æœ‰å¡«å……æ•¸æ“šæ™‚éœ€è¦èª¿æ•´æµæ§åˆ¶çª—å£ã€‚</p><pre><code>var refund intif pad := int(f.Length) - len(data); pad &gt; 0 {  refund += pad}// Return len(data) now if the stream is already closed,// since data will never be read.didReset := cs.didResetif didReset {  refund += len(data)}if refund &gt; 0 {  cc.inflow.add(int32(refund))  cc.wmu.Lock()  cc.fr.WriteWindowUpdate(0, uint32(refund))  if !didReset {    cs.inflow.add(int32(refund))    cc.fr.WriteWindowUpdate(cs.ID, uint32(refund))  }  cc.bw.Flush()  cc.wmu.Unlock()}cc.mu.Unlock()</code></pre><ul><li>å¦‚æœæ•¸æ“šå¹€æœ‰å¡«å……æ•¸æ“šå‰‡è¨ˆç®—éœ€è¦è¿”é‚„çš„å¡«å……æ•¸æ“šé•·åº¦ã€‚</li><li>å¦‚æœæ•¸æ“šæµç„¡æ•ˆè©²æ•¸æ“šå¹€çš„é•·åº¦éœ€è¦å…¨éƒ¨è¿”é‚„ã€‚</li></ul><p style=text-align:start>æœ€å¾Œï¼Œæ ¹æ“šè¨ˆç®—çš„refundå¢åŠ ç•¶å‰é€£æ¥æˆ–è€…ç•¶å‰æ•¸æ“šæµçš„å¯æ¥å—çª—å£å¤§å°ï¼Œä¸¦ä¸”åŒæ™‚å‘ŠçŸ¥serverå¢åŠ ç•¶å‰é€£æ¥æˆ–è€…ç•¶å‰æ•¸æ“šæµçš„å¯å¯«çª—å£å¤§å°ã€‚</p><p style=text-align:start>4ã€æ•¸æ“šé•·åº¦å¤§æ–¼0ä¸”æ•¸æ“šæµæ­£å¸¸å‰‡å°‡æ•¸æ“šå¯«å…¥æ•¸æ“šæµç·©è¡å€ã€‚</p><pre><code>if len(data) &gt; 0 &amp;&amp; !didReset {  if _, err := cs.bufPipe.Write(data); err != nil {    rl.endStreamError(cs, err)    return err  }}</code></pre><p style=text-align:start><strong>å›é¡§</strong>ï¼šå‰é¢çš„(*http2clientConnReadLoop).handleResponseæ–¹æ³•ä¸­æœ‰é€™æ¨£ä¸€è¡Œä»£ç¢¼res.Body = http2transportResponseBody{cs}ï¼Œæ‰€ä»¥åœ¨æ¥­å‹™é–‹ç™¼æ™‚èƒ½å¤ é€šéResponseè®€å–åˆ°æ•¸æ“šæµä¸­çš„ç·©è¡æ•¸æ“šã€‚</p><h1 class=pgc-h-arrow-right>(http2transportResponseBody).Read</h1><p style=text-align:start>åœ¨å‰é¢çš„å…§å®¹è£¡ï¼Œå¦‚æœæ•¸æ“šæµç‹€æ…‹æ­£å¸¸ä¸”æ•¸æ“šå¹€æ²’æœ‰å¡«å……æ•¸æ“šå‰‡æ•¸æ“šæµå’Œé€£æ¥çš„å¯æ¥æ”¶çª—å£æœƒä¸€ç›´è®Šå°ï¼Œè€Œé€™éƒ¨åˆ†å…§å®¹å°±æ˜¯å¢åŠ æ•¸æ“šæµçš„å¯æ¥å—çª—å£å¤§å°ã€‚</p><p style=text-align:start>å› ç‚ºç¯‡å¹…å’Œä¸»æ—¨çš„å•é¡Œç­†è€…åƒ…åˆ†ææè¿°è©²æ–¹æ³•å…§å’Œæµæ§åˆ¶æœ‰é—œçš„éƒ¨åˆ†ã€‚</p><p style=text-align:start>1ã€è®€å–éŸ¿æ‡‰æ•¸æ“šå¾Œè¨ˆç®—ç•¶å‰é€£æ¥éœ€è¦å¢åŠ çš„å¯æ¥å—çª—å£å¤§å°ã€‚</p><pre><code>cc.mu.Lock()defer cc.mu.Unlock()var connAdd, streamAdd int32// Check the conn-level first, before the stream-level.if v := cc.inflow.available(); v &lt; http2transportDefaultConnFlow/2 {  connAdd = http2transportDefaultConnFlow - v  cc.inflow.add(connAdd)}</code></pre><p style=text-align:start>å¦‚æœç•¶å‰é€£æ¥å¯æ¥å—çª—å£çš„å¤§å°å·²ç¶“å°æ–¼http2transportDefaultConnFlowï¼ˆ1Gï¼‰çš„ä¸€åŠï¼Œå‰‡ç•¶å‰é€£æ¥å¯æ¥æ”¶çª—å£å¤§å°éœ€è¦å¢åŠ http2transportDefaultConnFlow - cc.inflow.available()ã€‚</p><p style=text-align:start><strong>å›é¡§</strong>ï¼šhttp2transportDefaultConnFlowåœ¨å‰ç¯‡(*http2Transport).NewClientConnæ–¹æ³•éƒ¨åˆ†æœ‰æåˆ°ï¼Œä¸”é€£æ¥å‰›å»ºç«‹æ™‚æœƒé€šéhttp2WindowUpdateFrameæ•¸æ“šå¹€å‘ŠçŸ¥serverç•¶å‰é€£æ¥å¯ç™¼é€çª—å£å¤§å°å¢åŠ http2transportDefaultConnFlowã€‚</p><p style=text-align:start>2ã€è®€å–éŸ¿æ‡‰æ•¸æ“šå¾Œè¨ˆç®—ç•¶å‰æ•¸æ“šæµéœ€è¦å¢åŠ çš„å¯æ¥å—çª—å£å¤§å°ã€‚</p><pre><code>if err == nil { // No need to refresh if the stream is over or failed.  // Consider any buffered body data (read from the conn but not  // consumed by the client) when computing flow control for this  // stream.  v := int(cs.inflow.available()) + cs.bufPipe.Len()  if v &lt; http2transportDefaultStreamFlow-http2transportDefaultStreamMinRefresh {    streamAdd = int32(http2transportDefaultStreamFlow - v)    cs.inflow.add(streamAdd)  }}</code></pre><p style=text-align:start>å¦‚æœç•¶å‰æ•¸æ“šæµå¯æ¥å—çª—å£å¤§å°åŠ ä¸Šç•¶å‰æ•¸æ“šæµç·©è¡å€å‰©é¤˜æœªè®€æ•¸æ“šçš„é•·åº¦å°æ–¼http2transportDefaultStreamFlow-http2transportDefaultStreamMinRefreshï¼ˆ4M-4KBï¼‰ï¼Œå‰‡ç•¶å‰æ•¸æ“šæµå¯æ¥å—çª—å£å¤§å°éœ€è¦å¢åŠ http2transportDefaultStreamFlow - vã€‚</p><p style=text-align:start><strong>å›é¡§</strong>ï¼šhttp2transportDefaultStreamFlowåœ¨å‰ç¯‡(*http2Transport).NewClientConnæ–¹æ³•å’Œ(*http2ClientConn).newStreamæ–¹æ³•ä¸­å‡æœ‰æåˆ°ã€‚</p><p style=text-align:start>é€£æ¥å‰›å»ºç«‹æ™‚ï¼Œç™¼é€http2FrameSettingsæ•¸æ“šå¹€ï¼Œå‘ŠçŸ¥serveræ¯å€‹æ•¸æ“šæµçš„å¯ç™¼é€çª—å£å¤§å°ç‚ºhttp2transportDefaultStreamFlowã€‚</p><p style=text-align:start>åœ¨newStreamæ™‚ï¼Œæ•¸æ“šæµé»˜èªçš„å¯æ¥æ”¶çª—å£å¤§å°ç‚ºhttp2transportDefaultStreamFlowã€‚</p><p style=text-align:start>3ã€å°‡é€£æ¥å’Œæ•¸æ“šæµåˆ†åˆ¥éœ€è¦å¢åŠ çš„çª—å£å¤§å°é€šéhttp2WindowUpdateFrameæ•¸æ“šå¹€å‘ŠçŸ¥serverã€‚</p><pre><code>if connAdd != 0 || streamAdd != 0 {  cc.wmu.Lock()  defer cc.wmu.Unlock()  if connAdd != 0 {    cc.fr.WriteWindowUpdate(0, http2mustUint31(connAdd))  }  if streamAdd != 0 {    cc.fr.WriteWindowUpdate(cs.ID, http2mustUint31(streamAdd))  }  cc.bw.Flush()}</code></pre><p style=text-align:start>ä»¥ä¸Šå°±æ˜¯serverå‘clientç™¼é€æ•¸æ“šçš„æµæ§åˆ¶é‚è¼¯ã€‚</p><h1 class=pgc-h-arrow-right>(*http2clientStream).writeRequestBody</h1><p style=text-align:start>å‰ç¯‡ä¸­(*http2ClientConn).roundTripæœªå°(*http2clientStream).writeRequestBodyé€²è¡Œåˆ†æï¼Œä¸‹é¢æˆ‘å€‘çœ‹çœ‹è©²æ–¹æ³•çš„æºç¢¼ï¼š</p><pre><code>func (cs *http2clientStream) writeRequestBody(body io.Reader, bodyCloser io.Closer) (err error) {	cc := cs.cc	sentEnd := false // whether we sent the final DATA frame w/ END_STREAM  // æ­¤è™•çœç•¥ä»£ç¢¼	req := cs.req	hasTrailers := req.Trailer != nil	remainLen := http2actualContentLength(req)	hasContentLen := remainLen != -1	var sawEOF bool	for !sawEOF {		n, err := body.Read(buf[:len(buf)-1])    // æ­¤è™•çœç•¥ä»£ç¢¼		remain := buf[:n]		for len(remain) &gt; 0 &amp;&amp; err == nil {			var allowed int32			allowed, err = cs.awaitFlowControl(len(remain))			switch {			case err == http2errStopReqBodyWrite:				return err			case err == http2errStopReqBodyWriteAndCancel:				cc.writeStreamReset(cs.ID, http2ErrCodeCancel, nil)				return err			case err != nil:				return err			}			cc.wmu.Lock()			data := remain[:allowed]			remain = remain[allowed:]			sentEnd = sawEOF &amp;&amp; len(remain) == 0 &amp;&amp; !hasTrailers			err = cc.fr.WriteData(cs.ID, sentEnd, data)			if err == nil {				err = cc.bw.Flush()			}			cc.wmu.Unlock()		}		if err != nil {			return err		}	}  // æ­¤è™•çœç•¥ä»£ç¢¼	return err}</code></pre><p style=text-align:start>ä¸Šé¢çš„é‚è¼¯å¯ç°¡å–®ç¸½çµç‚ºï¼šä¸åœçš„è®€å–è«‹æ±‚bodyç„¶å¾Œå°‡è®€å–çš„å…§å®¹é€šécc.fr.WriteDataè½‰ç‚ºhttp2FrameDataæ•¸æ“šå¹€ç™¼é€çµ¦serverï¼Œç›´åˆ°è«‹æ±‚bodyè®€å®Œç‚ºæ­¢ã€‚å…¶ä¸­å’Œæµæ§åˆ¶æœ‰é—œçš„æ–¹æ³•æ˜¯awaitFlowControlï¼Œä¸‹é¢æˆ‘å€‘å°è©²æ–¹æ³•é€²è¡Œåˆ†æã€‚</p><h1 class=pgc-h-arrow-right>(*http2clientStream).awaitFlowControl</h1><p style=text-align:start>æ­¤æ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯ç­‰å¾…ç•¶å‰æ•¸æ“šæµå¯å¯«çª—å£æœ‰å®¹é‡èƒ½å¤ å¯«å…¥æ•¸æ“šã€‚</p><pre><code>func (cs *http2clientStream) awaitFlowControl(maxBytes int) (taken int32, err error) {	cc := cs.cc	cc.mu.Lock()	defer cc.mu.Unlock()	for {		if cc.closed {			return 0, http2errClientConnClosed		}		if cs.stopReqBody != nil {			return 0, cs.stopReqBody		}		if err := cs.checkResetOrDone(); err != nil {			return 0, err		}		if a := cs.flow.available(); a &gt; 0 {			take := a			if int(take) &gt; maxBytes {				take = int32(maxBytes) // can't truncate int; take is int32			}			if take &gt; int32(cc.maxFrameSize) {				take = int32(cc.maxFrameSize)			}			cs.flow.take(take)			return take, nil		}		cc.cond.Wait()	}}</code></pre><p style=text-align:start>æ ¹æ“šæºç¢¼å¯ä»¥çŸ¥é“ï¼Œæ•¸æ“šæµè¢«é—œé–‰æˆ–è€…åœæ­¢ç™¼é€è«‹æ±‚bodyï¼Œå‰‡ç•¶å‰æ•¸æ“šæµç„¡æ³•å¯«å…¥æ•¸æ“šã€‚ç•¶æ•¸æ“šæµç‹€æ…‹æ­£å¸¸æ™‚ï¼Œåˆåˆ†ç‚ºå…©ç¨®æƒ…æ³ï¼š</p><ol start=1><li>ç•¶å‰æ•¸æ“šæµå¯å¯«çª—å£å‰©é¤˜å¯å¯«æ•¸æ“šå¤§æ–¼0ï¼Œå‰‡è¨ˆç®—å¯å¯«å­—ç¯€æ•¸ï¼Œä¸¦å°‡ç•¶å‰æ•¸æ“šæµå¯å¯«çª—å£å¤§å°æ¶ˆè€—takeã€‚</li><li>ç•¶å‰æ•¸æ“šæµå¯å¯«çª—å£å‰©é¤˜å¯å¯«æ•¸æ“šå°æ–¼ç­‰æ–¼0ï¼Œå‰‡æœƒä¸€ç›´ç­‰å¾…ç›´åˆ°è¢«å–šé†’ä¸¦é€²å…¥ä¸‹ä¸€æ¬¡æª¢æŸ¥ã€‚</li></ol><p style=text-align:start>ä¸Šé¢çš„ç¬¬äºŒç¨®æƒ…æ³åœ¨<strong>æ”¶åˆ°http2WindowUpdateFrameæ•¸æ“šå¹€</strong>é€™ä¸€ç¯€ä¸­æåˆ°éã€‚</p><p style=text-align:start>serverè®€å–ç•¶å‰æ•¸æ“šæµçš„æ•¸æ“šå¾Œæœƒå‘clientå°æ‡‰æ•¸æ“šæµç™¼é€http2WindowUpdateFrameæ•¸æ“šå¹€ï¼Œclientæ”¶åˆ°è©²æ•¸æ“šå¹€å¾Œæœƒå¢å¤§å°æ‡‰æ•¸æ“šæµå¯å¯«çª—å£ï¼Œä¸¦åŸ·è¡Œcc.cond.Broadcast()å–šé†’å› ç™¼é€æ•¸æ“šå·²é”æµæ§åˆ¶ä¸Šé™è€Œç­‰å¾…çš„æ•¸æ“šæµç¹¼çºŒç™¼é€æ•¸æ“šã€‚</p><p style=text-align:start>ä»¥ä¸Šå°±æ˜¯clientå‘serverç™¼é€æ•¸æ“šçš„æµæ§åˆ¶é‚è¼¯ã€‚</p><h1 class=pgc-h-arrow-right>ç¸½çµ</h1><ol start=1><li>å¹€é ­é•·åº¦ç‚º9å€‹å­—ç¯€ï¼Œå¹·åŒ…å«å››å€‹éƒ¨åˆ†ï¼šPayloadçš„é•·åº¦ã€å¹€é¡å‹ã€å¹€æ¨™è­˜ç¬¦å’Œæ•¸æ“šæµIDã€‚</li><li>æµæ§åˆ¶å¯åˆ†ç‚ºå…©å€‹æ­¥é©Ÿï¼šåˆå§‹æ™‚ï¼Œé€šéhttp2FrameSettingsæ•¸æ“šå¹€å’Œhttp2WindowUpdateFrameæ•¸æ“šå¹€å‘ŠçŸ¥å°æ–¹ç•¶å‰é€£æ¥è®€å¯«çª—å£å¤§å°ä»¥åŠé€£æ¥ä¸­æ•¸æ“šæµè®€å¯«çª—å£å¤§å°ã€‚åœ¨è®€å¯«æ•¸æ“šéç¨‹ä¸­ï¼Œé€šéç™¼é€http2WindowUpdateFrameæ•¸æ“šå¹€æ§åˆ¶å¦ä¸€ç«¯çš„å¯«çª—å£å¤§å°ã€‚</li></ol><h1 class=pgc-h-arrow-right>é å‘Š</h1><p style=text-align:start>å‰ç¯‡å’Œä¸­ç¯‡å·²ç¶“å®Œæˆï¼Œä¸‹ä¸€æœŸå°‡å°<strong>http2.0æ¨™é ­å£“ç¸®</strong>é€²è¡Œåˆ†æã€‚</p><p style=text-align:start>æœ€å¾Œï¼Œè¡·å¿ƒå¸Œæœ›æœ¬æ–‡èƒ½å¤ å°å„ä½è®€è€…æœ‰ä¸€å®šçš„å¹«åŠ©ã€‚</p><blockquote><p><span style="color:#6a737d;--tt-darkmode-color: #6A737D">æ³¨ï¼šå¯«æœ¬æ–‡æ™‚ï¼Œ ç­†è€…æ‰€ç”¨goç‰ˆæœ¬ç‚º: go1.14.2</span></p></blockquote></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Go</a></li><li><a>ç™¼èµ·</a></li><li><a>HTTP2.0</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/85697d72.html alt="æˆ‘ç”¨ Go ç”Ÿæˆçš„éš¨æ©Ÿæ•¸ç‚ºä»€éº¼ä¸éš¨æ©Ÿï¼Ÿéš¨æ©Ÿæ•¸æ˜¯æ€æ¨£ç”¢ç”Ÿçš„" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/47dfbe87bec844cf988f2e497c78641a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/85697d72.html title="æˆ‘ç”¨ Go ç”Ÿæˆçš„éš¨æ©Ÿæ•¸ç‚ºä»€éº¼ä¸éš¨æ©Ÿï¼Ÿéš¨æ©Ÿæ•¸æ˜¯æ€æ¨£ç”¢ç”Ÿçš„">æˆ‘ç”¨ Go ç”Ÿæˆçš„éš¨æ©Ÿæ•¸ç‚ºä»€éº¼ä¸éš¨æ©Ÿï¼Ÿéš¨æ©Ÿæ•¸æ˜¯æ€æ¨£ç”¢ç”Ÿçš„</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/317308ae.html alt="Go ä¹‹ç¦ªï¼šDaveå‘Šè¨´ä½ ç·¨å¯«ç°¡å–®ã€å¯è®€ã€å¯ç¶­è­·ä»£ç¢¼çš„åå€‹å·¥ç¨‹ç¶“é©—" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/35e73626e50e4835a1eacdc0f5f74a69 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/317308ae.html title="Go ä¹‹ç¦ªï¼šDaveå‘Šè¨´ä½ ç·¨å¯«ç°¡å–®ã€å¯è®€ã€å¯ç¶­è­·ä»£ç¢¼çš„åå€‹å·¥ç¨‹ç¶“é©—">Go ä¹‹ç¦ªï¼šDaveå‘Šè¨´ä½ ç·¨å¯«ç°¡å–®ã€å¯è®€ã€å¯ç¶­è­·ä»£ç¢¼çš„åå€‹å·¥ç¨‹ç¶“é©—</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7e187bc3.html alt=Goèªè¨€ä¹‹çˆ¶å¸¶ä½ é‡æ–°èªè­˜å­—ç¬¦ä¸²ã€å­—ç¯€ã€runeå’Œå­—ç¬¦ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/52e46ed353da4c058a36fb1153b3bf17 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7e187bc3.html title=Goèªè¨€ä¹‹çˆ¶å¸¶ä½ é‡æ–°èªè­˜å­—ç¬¦ä¸²ã€å­—ç¯€ã€runeå’Œå­—ç¬¦>Goèªè¨€ä¹‹çˆ¶å¸¶ä½ é‡æ–°èªè­˜å­—ç¬¦ä¸²ã€å­—ç¯€ã€runeå’Œå­—ç¬¦</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/288f86f6.html alt=Goèªè¨€å¯¦ç¾ï¼šå¸¸è¦‹æ’åºç®—æ³• class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/3a6d9a4e785e4fa097b0adf18620d616 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/288f86f6.html title=Goèªè¨€å¯¦ç¾ï¼šå¸¸è¦‹æ’åºç®—æ³•>Goèªè¨€å¯¦ç¾ï¼šå¸¸è¦‹æ’åºç®—æ³•</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/73f8e8da.html alt=Goèªè¨€å­¸ç¿’åŸºç¤-ç”Ÿæˆé€²ç¨‹ã€æ›¿æ›é€²ç¨‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0006f0b743b040789141c4474d31a24c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/73f8e8da.html title=Goèªè¨€å­¸ç¿’åŸºç¤-ç”Ÿæˆé€²ç¨‹ã€æ›¿æ›é€²ç¨‹>Goèªè¨€å­¸ç¿’åŸºç¤-ç”Ÿæˆé€²ç¨‹ã€æ›¿æ›é€²ç¨‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1e3e0993.html alt=å»¶å´‡é«˜é€Ÿèµ¤åŸæ”¯ç·šå‘å¹´åº•å®Œå·¥ç™¼èµ·è¡åˆº class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1e3e0993.html title=å»¶å´‡é«˜é€Ÿèµ¤åŸæ”¯ç·šå‘å¹´åº•å®Œå·¥ç™¼èµ·è¡åˆº>å»¶å´‡é«˜é€Ÿèµ¤åŸæ”¯ç·šå‘å¹´åº•å®Œå·¥ç™¼èµ·è¡åˆº</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6c6cd9fd.html alt=äºŒåˆä¸€çµæ§‹ç™¼èµ·ä¸€å ´æ°´é¾é ­é©å‘½! class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5894928532fc4b38b473fa513ffde661 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6c6cd9fd.html title=äºŒåˆä¸€çµæ§‹ç™¼èµ·ä¸€å ´æ°´é¾é ­é©å‘½!>äºŒåˆä¸€çµæ§‹ç™¼èµ·ä¸€å ´æ°´é¾é ­é©å‘½!</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4cc38087.html alt="Go å¦‚ä½•ç²å–ç•¶å‰åŸ·è¡Œæ–‡ä»¶æ‰€åœ¨çš„ç›®éŒ„ï¼Ÿ" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/4d316ba5638c47e391011bce4e28f6a8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4cc38087.html title="Go å¦‚ä½•ç²å–ç•¶å‰åŸ·è¡Œæ–‡ä»¶æ‰€åœ¨çš„ç›®éŒ„ï¼Ÿ">Go å¦‚ä½•ç²å–ç•¶å‰åŸ·è¡Œæ–‡ä»¶æ‰€åœ¨çš„ç›®éŒ„ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/190ae162.html alt="å¦‚ä½•åœ¨ Go ä¸­å¯«å‡ºé«˜æ•ˆçš„å–®å…ƒæ¸¬è©¦" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ed1aef2573fe45c582af69ef44638521 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/190ae162.html title="å¦‚ä½•åœ¨ Go ä¸­å¯«å‡ºé«˜æ•ˆçš„å–®å…ƒæ¸¬è©¦">å¦‚ä½•åœ¨ Go ä¸­å¯«å‡ºé«˜æ•ˆçš„å–®å…ƒæ¸¬è©¦</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2122bafb.html alt="å°æ¯”è‘—å­¸ Go èªè¨€-åŸºç¤ï¼šé¢å‘å°è±¡ç·¨ç¨‹ä¹‹æ¥å£" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2122bafb.html title="å°æ¯”è‘—å­¸ Go èªè¨€-åŸºç¤ï¼šé¢å‘å°è±¡ç·¨ç¨‹ä¹‹æ¥å£">å°æ¯”è‘—å­¸ Go èªè¨€-åŸºç¤ï¼šé¢å‘å°è±¡ç·¨ç¨‹ä¹‹æ¥å£</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/27147bdc.html alt=æ²’æŒæ¡é€™å€‹çŸ¥è­˜é»ï¼Œä½ çš„Goèªè¨€åŸºç¤æ˜¯ä¸ç´®å¯¦çš„ï¼šæ¥å£å¾ˆé‡è¦ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/2d906b089a5b448f9cc8c13c1031d4c0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/27147bdc.html title=æ²’æŒæ¡é€™å€‹çŸ¥è­˜é»ï¼Œä½ çš„Goèªè¨€åŸºç¤æ˜¯ä¸ç´®å¯¦çš„ï¼šæ¥å£å¾ˆé‡è¦>æ²’æŒæ¡é€™å€‹çŸ¥è­˜é»ï¼Œä½ çš„Goèªè¨€åŸºç¤æ˜¯ä¸ç´®å¯¦çš„ï¼šæ¥å£å¾ˆé‡è¦</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/4679c3e8.html alt=å­«ä¸­å±±ç™¼èµ·çš„è­·æ³•é‹å‹•ï¼Œå¤±æ•—çš„æ ¹æœ¬åŸå›  class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/633b6fbce1a647cfba0632b0166d373b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/4679c3e8.html title=å­«ä¸­å±±ç™¼èµ·çš„è­·æ³•é‹å‹•ï¼Œå¤±æ•—çš„æ ¹æœ¬åŸå› >å­«ä¸­å±±ç™¼èµ·çš„è­·æ³•é‹å‹•ï¼Œå¤±æ•—çš„æ ¹æœ¬åŸå› </a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/ee976482.html alt=é›…èŠ³ç‚ºä¹³è…ºç™Œå®£å‚³æœˆç™¼èµ·TitTokèˆè¹ˆæ´»å‹• class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/31807fe41bbc4c30815075ae18b4fdd6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/ee976482.html title=é›…èŠ³ç‚ºä¹³è…ºç™Œå®£å‚³æœˆç™¼èµ·TitTokèˆè¹ˆæ´»å‹•>é›…èŠ³ç‚ºä¹³è…ºç™Œå®£å‚³æœˆç™¼èµ·TitTokèˆè¹ˆæ´»å‹•</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/eacf2d8f.html alt=å•†å‹™éƒ¨ï¼šå°åº¦å°è¯é„°è‹¯äºŒç”²é…¸é…ç™¼èµ·åå‚¾éŠ·èª¿æŸ¥ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/eacf2d8f.html title=å•†å‹™éƒ¨ï¼šå°åº¦å°è¯é„°è‹¯äºŒç”²é…¸é…ç™¼èµ·åå‚¾éŠ·èª¿æŸ¥>å•†å‹™éƒ¨ï¼šå°åº¦å°è¯é„°è‹¯äºŒç”²é…¸é…ç™¼èµ·åå‚¾éŠ·èª¿æŸ¥</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/418eefbf.html alt=ã€Œç™¼èµ·è„«è²§æ”»å …ç¸½æ”»æˆ°ã€å°‹ç”¸ç¸£ï¼šç‰¹è‰²ä¸­è—¥ææˆç‚ºå¢æ”¶å¥½ç”¢æ¥­ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/418eefbf.html title=ã€Œç™¼èµ·è„«è²§æ”»å …ç¸½æ”»æˆ°ã€å°‹ç”¸ç¸£ï¼šç‰¹è‰²ä¸­è—¥ææˆç‚ºå¢æ”¶å¥½ç”¢æ¥­>ã€Œç™¼èµ·è„«è²§æ”»å …ç¸½æ”»æˆ°ã€å°‹ç”¸ç¸£ï¼šç‰¹è‰²ä¸­è—¥ææˆç‚ºå¢æ”¶å¥½ç”¢æ¥­</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>