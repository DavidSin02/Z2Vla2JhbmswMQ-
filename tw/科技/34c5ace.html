<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>2階段提交分佈式事務中間件Raincat | 极客快訊</title><meta property="og:title" content="2階段提交分佈式事務中間件Raincat - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/257680b8c2514d67861f1984e8e50cfe"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/34c5ace.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/34c5ace.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/34c5ace.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/34c5ace.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/34c5ace.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/34c5ace.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/34c5ace.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/34c5ace.html><meta property="article:published_time" content="2020-10-29T20:50:41+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:41+08:00"><meta name=Keywords content><meta name=description content="2階段提交分佈式事務中間件Raincat"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/34c5ace.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>2階段提交分佈式事務中間件Raincat</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>架構設計</p><div class=pgc-img><img alt=2階段提交分佈式事務中間件Raincat onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/257680b8c2514d67861f1984e8e50cfe><p class=pgc-img-caption></p></div><p>流程圖</p><div class=pgc-img><img alt=2階段提交分佈式事務中間件Raincat onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b7d2e30b10db4f14a388374e3b96d02d><p class=pgc-img-caption></p></div><p>流程圖原理詳解</p><div class=pgc-img><img alt=2階段提交分佈式事務中間件Raincat onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cee77c89003c492082be9a36b85d1ca0><p class=pgc-img-caption></p></div><p>首先用戶發起request請求進入consume端（也可以是controller層），controller層進入AOP切面，開啟分佈式事務</p><ul><li>會與txManager通信，創建事務組</li><li>發起業務方法調用point.proceed(),這一步是分佈式事務調用RPC方法的入口，會一個一個調用RPC方法</li><li>主線程調用provder1 提供的RPC方法，同樣會進入切面，此時，會啟動另一個線程去調用該RPC方法，當前線程wait</li></ul><pre>調用失敗，調用業務方法線程，會喚醒等待的主線程，並把異常信息返回，走的就是one fial rollback這條線，消費方獲取異常信息，自動回滾當前事務，分佈式事務結束。調用成功 業務線程，將喚醒主線程，並返回數據。業務線程同txManager 通信 將自己加入到當前事務組中，業務線程進入等待，等待txManager指令，commit or rollback 即 圖中的4,5,6</pre><ul><li>主線程繼續調用provider2提供的RPC方法 ，同樣會進入AOP切面，當前主線程等待，啟動一個業務線程去調用業務方法</li></ul><pre>調用失敗，調用業務方法線程，會喚醒等待的主線程，並把異常信息返回，走的就是two fial rollback這條線，消費方獲取異常信息，自動回滾當前事務，並與txManager進行通信（two TransactionGroup fail 這條線），txManager發起rollback指令（two fail rollback 這條線），通知provider1 rollback調用成功 業務線程，將喚醒主線程，並返回數據。業務線程同txManager 通信 將自己加入到當前事務組中，業務線程進入等待，等待txManager指令，commit or rollback 即 圖中的9,10,11</pre><ul><li>主線程point.proceed()方法成功執行，會向txManager發出commit請求，txManager接收請求後，會檢查各模塊的網絡通信等狀態，符合條件後，發出commit指令，即 14。通知各個模塊提交自己的事務。</li></ul><p>三階段提交最大的問題，在於當txManager發出commit指令後，業務方down機，或者網絡通信斷了。怎麼解決事務一致性的問題。我們這麼想，當txManager 發出commit指令的時候，其實業務方法都沒有任何異常，都是執行成功的，那麼數據就是需要提交的。那麼我們本地的補償機制正是為了該場景而考慮，如果down機，或者網絡異常。本地服務恢復後，會執行補償，達到數據的一致性。如果業務方是集群部署的話，會立刻執行補償，達到數據的一致性。</p><p>重要提醒，如果調用服務方是timeout，那麼會判斷當前事務不成功，這次分佈式事務統一不會執行。</p><p>快速開始：</p><h1><strong>Spring-Boot-Starter</strong></h1><p>導出</p><ul><li>首先引入rpc框架所支持的jar包,注意：版本號，根據你拉代碼自己打包上傳到私服一致</li><li>Dubbo</li></ul><pre>&lt;dependency&gt; &lt;groupId&gt;com.raincat&lt;/groupId&gt; &lt;artifactId&gt;raincat-spring-boot-starter-dubbo&lt;/artifactId&gt; &lt;version&gt;${your version}&lt;/version&gt; &lt;/dependency&gt;</pre><ul><li>SpringCloud</li></ul><pre>&lt;dependency&gt; &lt;groupId&gt;com.raincat&lt;/groupId&gt; &lt;artifactId&gt;raincat-spring-boot-starter-springcloud&lt;/artifactId&gt; &lt;version&gt;${your version}&lt;/version&gt; &lt;/dependency&gt;</pre><ul><li>Motan</li></ul><pre> &lt;dependency&gt; &lt;groupId&gt;com.raincat&lt;/groupId&gt; &lt;artifactId&gt;raincat-spring-boot-starter-motan&lt;/artifactId&gt; &lt;version&gt;${your version}&lt;/version&gt; &lt;/dependency&gt;</pre><ul><li>在你的 application.yml 中新增如下配置：</li></ul><pre>raincat: tx : txManagerUrl: http://localhost:8761 serializer: kroy nettySerializer: kroy compensation: true compensationCacheType : db txDbConfig : driverClassName : com.mysql.jdbc.Driver url : jdbc:mysql://10.4.4.202:3306/tx?useUnicode=true&amp;characterEncoding=utf8 username : root password : 123123 # repositorySupport : redis # txRedisConfig : # hostName : 192.168.1.68 # port : 6379 # password : # repositorySupport : zookeeper # tx-zookeeper-config : # host : 92.168.1.73:2181 # sessionTimeOut : 100000 # rootPath : /tx # repositorySupport : mongodb # tx-mongo-config : # mongoDbUrl : localost:27017 # mongoDbName : xiaoyu # mongoUserName : xiaoyu # mongoUserPwd : 123456 # repositorySupport : file # tx-file-config: # path : /consume # prefix : consume</pre><p>TxManager配置詳解</p><ul><li>application.properties 主要是配置tmManager的http服務端口，redis信息,netty相關信息 注意：因為現在tmManager 是自己向自己註冊，所以http端口（server.port）應該要與eureka的端口一致。</li></ul><p>server.port=8761 txManager 的http端口</p><p>tx.manager.netty.port=9998 對業務方提供的TCP 端口。</p><p>tx.manager.netty.serialize=kryo netty 序列化方式，注意應該要與業務方的序列化方式一致。</p><ul><li>bootstrap.yml 主要是配置eureka的相關屬性，比如renew時間，註冊地址等</li><li>部署集群配置： 1.修改application.properties中的 server.port 如： 第一份服務為 server.port=8761 tx.manager.netty.port=9998; 第二份服務為：server.port=8762 tx.manager.netty.port=9999; 2. 修改bootstrap.yml中的eureka:client:serviceUrl:defaultZone:http://localhost:8761/eureka/,http://localhost:8762/eureka/ 再依次啟動</li></ul><p>業務方配置詳解</p><pre> @TxTransaction 該註解為分佈式事務的切面（AOP point），如果業務方的service服務需要參與分佈式事務，則需要加上此註解</pre><p>applicationContext.xml 詳解：</p><pre> &lt;!-- Aspect 切面配置，是否開啟AOP切面--&gt; &lt;aop:aspectj-autoproxy expose-proxy="true"/&gt; &lt;!--掃描分佈式事務的包--&gt; &lt;context:component-scan base-package="com.raincat.*"/&gt; &lt;!--啟動類屬性配置--&gt; &lt;bean id="txTransactionBootstrap" class="com.raincat.core.bootstrap.TxTransactionBootstrap"&gt; &lt;property name="txManagerUrl" value="http://192.168.1.66:8761"/&gt; &lt;property name="serializer" value="kryo"/&gt; &lt;property name="nettySerializer" value="kryo"/&gt; &lt;property name="blockingQueueType" value="Linked"/&gt; &lt;property name="compensation" value="true"/&gt; &lt;property name="compensationCacheType" value="db"/&gt; &lt;property name="txDbConfig"&gt; &lt;bean class="com.raincat.common.config.TxDbConfig"&gt; &lt;property name="url" value="jdbc:mysql://192.168.1.78:3306/order?useUnicode=true&amp;characterEncoding=utf8"/&gt; &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"/&gt; &lt;property name="password" value="password"/&gt; &lt;property name="username" value="xiaoyu"/&gt; &lt;/bean&gt; &lt;/property&gt; &lt;/bean&gt;TxTransactionBootstrap 詳解（具體參見com.raincat.core.config.TxConfig）： &lt;!--這裡配置的TxManager http請求的IP:PORT (如果TxManager有改動，這裡要跟著改動)--&gt; &lt;property name="txManagerUrl" value="http://192.168.1.66:8761"/&gt; &lt;!-- 與txManager通信的序列化方式，spi擴展支持 kroy，hessian protostuff 推薦使用kroy--&gt; &lt;property name="nettySerializer" value="kryo"/&gt; &lt;!-- 線程池中的隊列類型 spi擴展支持 Linked Array SynchronousQueue--&gt; &lt;property name="blockingQueueType" value="Linked"/&gt; &lt;!--線程池中的拒絕策略 spi擴展支持 Abort Blocking CallerRuns Discarded Rejected--&gt; &lt;property name="rejectPolicy" value="Abort"/&gt; &lt;!--開啟本地補償（默認開啟）--&gt; &lt;property name="compensation" value="true"/&gt;  &lt;!--本地數據序列化方式 spi擴展支持 java kroy，hessian protostuff 推薦使用kroy--&gt; &lt;property name="serializer" value="kryo"/&gt;</pre><p>本地數據保存配置與詳解(spi擴展支持db，redis，zookeeper，mongodb，file),詳情配置請參照sample工程:</p><ol><li>本地數據存儲為數據庫（數據庫支持mysql，oracle ，sqlServer），當業務模塊為集群時，推薦使用 會自動創建表，表名稱為 tx_transaction_模塊名稱（applicationName）,每個模塊配置成一樣的補償方式，如果是用db進行存儲，請使用同一個庫來存儲。</li></ol><pre> &lt;!--配置補償類型為db--&gt; &lt;property name="compensationCacheType" value="db"/&gt; &lt;property name="txDbConfig"&gt; &lt;bean class="com.raincat.common.config.TxDbConfig"&gt; &lt;!--數據庫url--&gt; &lt;property name="url" value="jdbc:mysql://192.168.1.78:3306/order?useUnicode=true&amp;characterEncoding=utf8"/&gt; &lt;!--數據庫驅動名稱 --&gt;  &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"/&gt; &lt;property name="password" value="1234567"/&gt; &lt;property name="username" value="xiaoyu"/&gt; &lt;/bean&gt; &lt;/property&gt;</pre><ol><li>本地數據存儲為redis，當業務模塊為集群時，推薦使用。（更多配置請參考 com.happylifeplat.transaction.core.config.TxRedisConfig）</li></ol><pre> &lt;!--配置補償類型為reids--&gt; &lt;property name="compensationCacheType" value="redis"/&gt; &lt;property name="txRedisConfig"&gt; &lt;bean class="com.raincat.common.config.TxRedisConfig"&gt; &lt;!--redis host--&gt; &lt;property name="hostName" value="192.168.1.78"/&gt; &lt;!--redis port--&gt; &lt;property name="port" value="6379"/&gt; &lt;!--redis 密碼 （有密碼就配置，無密碼則不需要配置）--&gt; &lt;property name="password" value=""/&gt;  &lt;/bean&gt; &lt;/property&gt;</pre><ol><li>本地數據存儲為zookeeper，當業務模塊為集群時，推薦使用</li></ol><pre> &lt;!--配置補償類型為zookeeper--&gt; &lt;property name="compensationCacheType" value="zookeeper"/&gt; &lt;property name="txZookeeperConfig"&gt; &lt;bean class="com.raincat.common.config.TxZookeeperConfig"&gt; &lt;!--zookeeper host：port--&gt; &lt;property name="host" value="192.168.1.66:2181"/&gt; &lt;!--zookeeper session過期時間--&gt; &lt;property name="sessionTimeOut" value="2000"/&gt; &lt;!--zookeeper 根節點路徑--&gt; &lt;property name="rootPath" value="/tx"/&gt; &lt;/bean&gt; &lt;/property&gt;</pre><ol><li>本地數據存儲為mongodb，當業務模塊為單節點時，可以使用。會自動創建集合，集合名稱為 tx_transaction_模塊名稱（applicationName） 這裡mongdb連接方式採用3.4.0版本推薦使用的Sha1,不是CR模式，同時mongdb應該開啟權限認證，使用者需要注意</li></ol><pre> &lt;!--配置補償類型為mongodb--&gt; &lt;property name="compensationCacheType" value="mongodb"/&gt; &lt;property name="txMongoConfig"&gt; &lt;bean class="com.raincat.common.config.TxMongoConfig"&gt; &lt;!--mongodb url--&gt; &lt;property name="mongoDbUrl" value="192.168.1.78:27017"/&gt; &lt;!--mongodb 數據庫--&gt; &lt;property name="mongoDbName" value="happylife"/&gt; &lt;!--mongodb 用戶名--&gt; &lt;property name="mongoUserName" value="xiaoyu"/&gt; &lt;!--mongodb 密碼--&gt; &lt;property name="mongoUserPwd" value="123456"/&gt; &lt;/bean&gt; &lt;/property&gt;</pre><ol><li>本地數據存儲為file，當業務模塊為單節點時，可以使用。創建的文件名稱TX_ + prefix配置 + 模塊名稱</li></ol><pre> &lt;!--配置補償類型為file--&gt; &lt;property name="compensationCacheType" value="file"/&gt; &lt;property name="txFileConfig"&gt; &lt;bean class="com.raincat.common.config.TxFileConfig"&gt; &lt;!--指定文件路徑（可填可不填，不填時候，默認就是當前項目所在的路徑）--&gt; &lt;property name="path" value=""/&gt; &lt;!--指定文件前綴，生成文件名稱--&gt; &lt;property name="prefix" value="consume"/&gt; &lt;/bean&gt; &lt;/property&gt;</pre><h1><strong>dubbo用戶指南</strong></h1><p>導出</p><p>dubbo用戶指南(jar包的版本問題可以自己git源代碼，然後編譯上傳到自己公司的私服)</p><ul><li>配置並且啟動txManager,在aoolication.properties修改你的服務端口，redis配置，具體可以參考配置詳解</li><li>在你的dubbo服務端添加jar包，並在需要參與分佈式事務的方法上添加 @TxTransaction註解</li></ul><pre> &lt;dependency&gt; &lt;groupId&gt;com.raincat&lt;/groupId&gt; &lt;artifactId&gt;raincat-dubbo&lt;/artifactId&gt; &lt;version&gt;${your.version}&lt;/version&gt; &lt;/dependency&gt;</pre><ul><li>配置applicationContext.xml,如下所示，如有其他問題可以參考配置詳解</li></ul><pre>&lt;!-- Aspect 切面配置，是否開啟AOP切面--&gt; &lt;aop:aspectj-autoproxy expose-proxy="true"/&gt; &lt;!--掃描分佈式事務的包--&gt; &lt;context:component-scan base-package="com.raincat.*"/&gt; &lt;!--啟動類屬性配置--&gt; &lt;bean id="txTransactionBootstrap" class="com.raincat.core.bootstrap.TxTransactionBootstrap"&gt; &lt;!--這裡的url是txMangager的ip+端口--&gt; &lt;property name="txManagerUrl" value="http://192.168.1.66:8761"/&gt; &lt;property name="serializer" value="kryo"/&gt; &lt;property name="nettySerializer" value="kryo"/&gt; &lt;property name="blockingQueueType" value="Linked"/&gt; &lt;property name="compensation" value="true"/&gt; &lt;property name="compensationCacheType" value="db"/&gt; &lt;property name="txDbConfig"&gt; &lt;bean class="com.raincat.common.config.TxDbConfig"&gt; &lt;property name="url" value="jdbc:mysql://192.168.1.78:3306/order?useUnicode=true&amp;characterEncoding=utf8"/&gt; &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"/&gt; &lt;property name="password" value="password"/&gt; &lt;property name="username" value="xiaoyu"/&gt; &lt;/bean&gt; &lt;/property&gt; &lt;/bean&gt;</pre><ul><li>在dubbo的消費方，也是如上配置，配置好以後，啟動項目.</li></ul><p>快速體檢，運行dubbo-sample（ 使用者JDK必須為1.8）</p><p>步驟一：</p><p>配置txManaager, 修改application.properties中你自己的redis配置</p><p>啟動TxManagerApplication</p><p>注意：如果需要修改服務端口，則應該保證與eureka:client:serviceUrl:defaultZone中的端口一致</p><p>步驟二：</p><ol><li>引入依賴包（sample已經引入）</li></ol><pre>&lt;dependency&gt; &lt;groupId&gt;com.raincat&lt;/groupId&gt; &lt;artifactId&gt;raincat-dubbo&lt;/artifactId&gt; &lt;version&gt;${you.version}&lt;/version&gt; &lt;/dependency&gt;</pre><ol><li>執行 raincat-dubbo-sample 工程 sql文件 dubbo-sample.sql</li><li>在每個工程下的application.yml 中配置您的數據庫連接(只需要改ip和端口)</li><li>在工程下的spring-dubbo.xml 中配置您的zookeeper註冊中心</li><li>在每個工程下 applicationContext.xml中的TxDbConfig 配置您的補償數據庫連接，提供單獨的庫來存儲。</li><li>在需要做分佈式事務的接口上加上註解 @TxTransaction （sample已經加上）</li><li>依次啟動order模塊，stock 模塊 ,consume模塊</li><li>訪問http://localhost:8888/swagger-ui.html 進行測試體驗</li></ol><h1><strong>springcloud用戶指南</strong></h1><p>導出</p><p>springcloud用戶指南(jar包的版本問題可以自己git源代碼，然後編譯上傳到自己公司的私服)</p><ul><li>配置並且啟動txManager,在aoolication.properties修改你的服務端口，redis配置，具體可以參考配置詳解</li><li>在你的springcloud服務端添加jar包，並在需要參與分佈式事務的方法上添加 @TxTransaction註解</li></ul><pre>&lt;dependency&gt; &lt;groupId&gt;com.raincat&lt;/groupId&gt; &lt;artifactId&gt;raincat-springcloud&lt;/artifactId&gt; &lt;version&gt;${your.version}&lt;/version&gt;&lt;/dependency&gt;</pre><ul><li>配置applicationContext.xml,如下所示，如有其他問題可以參考配置詳解</li></ul><pre>&lt;!-- Aspect 切面配置，是否開啟AOP切面--&gt; &lt;aop:aspectj-autoproxy expose-proxy="true"/&gt; &lt;!--掃描分佈式事務的包--&gt; &lt;context:component-scan base-package="com.raincat.*"/&gt; &lt;!--啟動類屬性配置--&gt; &lt;bean id="txTransactionBootstrap" class="com.raincat.core.bootstrap.TxTransactionBootstrap"&gt; &lt;!--這裡的url是txMangager的ip+端口--&gt; &lt;property name="txManagerUrl" value="http://192.168.1.66:8761"/&gt; &lt;property name="serializer" value="kryo"/&gt; &lt;property name="nettySerializer" value="kryo"/&gt; &lt;property name="blockingQueueType" value="Linked"/&gt; &lt;property name="compensation" value="true"/&gt; &lt;property name="compensationCacheType" value="db"/&gt; &lt;property name="txDbConfig"&gt; &lt;bean class="com.raincat.common.config.TxDbConfig"&gt; &lt;property name="url" value="jdbc:mysql://192.168.1.78:3306/order?useUnicode=true&amp;characterEncoding=utf8"/&gt; &lt;property name="driverClassName" value="com.mysql.jdbc.Driver"/&gt; &lt;property name="password" value="password"/&gt; &lt;property name="username" value="xiaoyu"/&gt; &lt;/bean&gt; &lt;/property&gt; &lt;/bean&gt;</pre><ul><li>在springcloud的消費方，也是如上配置，配置好以後，啟動項目.</li></ul><p>快速體檢，運行springcloud-sample（ 使用者JDK必須為1.8）</p><p>步驟一：</p><pre>配置txManaager, 修改application.properties中你自己的redis配置 啟動TxManagerApplication</pre><p>注意：如果需要修改服務端口，則應該保證與eureka:client:serviceUrl:defaultZone中的端口一致</p><p>步驟二：</p><ul><li>引入依賴包（sample已經引入）</li></ul><pre> &lt;dependency&gt; &lt;groupId&gt;com.raincat&lt;/groupId&gt; &lt;artifactId&gt;raincat-springcloud&lt;/artifactId&gt; &lt;version&gt;${your.version}&lt;/version&gt; &lt;/dependency&gt;</pre><ul><li>執行 raincat-springcloud-sample 工程 sql文件 springcloud-sample.sql</li><li>在每個工程下 application.yml 中配置您的數據庫連接(只需要改ip和端口)</li><li>在每個工程下 applicationContext.xml中的TxDbConfig 配置您的補償數據庫連接，提供單獨的數據庫來存儲。</li><li>在需要做分佈式事務的接口上加上註解 @TxTransaction （sample已經加上）</li><li>依次啟動AliPayApplication，WechatApplication ,PayApplication</li><li>訪問http://localhost:8881/pay-service/swagger-ui.html 進行體驗測試</li></ul><h1><strong>啟動事務管理後臺（admin）</strong></h1><p>導出</p><p>raincat-admin 啟動教程</p><p>啟動前提：分佈式事務項目已經部署並且運行起來，用戶根據自己的RPC框架進行使用 dubbo 用戶 springcloud 用戶</p><ul><li>首先用戶使用的JDK必須是1.8+ 本地安裝了git ,maven ，執行以下命令</li></ul><pre>git clone https://github.com/yu199195/Raincat.gitmaven clean install</pre><ul><li>使用你的開發工具打開項目，比如idea Eclipse</li></ul><p>步驟一： 配置並且啟動transaction-admin</p><ul><li>在項目中的application.properties文件中，修改您的服務端口，redis配置等配置:</li></ul><pre>#admin項目的tomcat端口server.port=8888#admin項目的上下文server.context-path=/adminserver.address=0.0.0.0#admin項目的應用名稱spring.application.name=tx-transaction-admin# admin項目激活的類型，支持db，file，mongo，zookeeper，redis 下文會繼續講解spring.profiles.active=db# txManager redis 配置#集群配置#tx.redis.cluster=true#tx.redis.cluster.nodes=127.0.0.1:70001;127.0.1:7002#tx.redis.cluster.redirects=20#單機配置tx.redis.cluster=falsetx.redis.hostName=192.168.1.68#redis主機端口tx.redis.port=6379#tx.redis.password=happylifeplat01# admin管理後臺的用戶名，用戶可以自己更改tx.admin.userName=admin# admin管理後臺的密碼，用戶可以自己更改tx.admin.password=admin#採用二階段提交項目的應用名稱集合，這個必須要填寫recover.application.list=alipay-service,wechat-service,pay-service#事務補償最大重試次數recover.retry.max=10#事務補償的序列方式recover.serializer.support=kryo#dbSuport 採用db進行的補償方式的配置recover.db.driver=com.mysql.jdbc.Driverrecover.db.url=jdbc:mysql://192.168.1.68:3306/tx?useUnicode=true&amp;characterEncoding=utf8recover.db.username=xiaoyurecover.db.password=Wgj@555888#redis 採用redis進行補償方式的配置recover.redis.cluster=falserecover.redis.hostName=192.168.1.68recover.redis.port=6379recover.redis.password=#recover.redis.clusterUrl=127.0.0.1:70001;127.0.1:7002#mongo 採用mongo 進行補償方式的配置recover.mongo.url=192.168.1.68:27017recover.mongo.dbName=happyliferecover.mongo.userName=xiaoyurecover.mongo.password=123456#zookeeper 採用zookeeper進行補償的方式配置recover.zookeeper.host=192.168.1.132:2181recover.zookeeper.sessionTimeOut=200000</pre><p>配置解釋</p><ul><li>關於txManager的redis配置:其實就是在txManager項目中的redis配置，在這裡需要配置成一樣的； 注意，如果你的redis是集群模式請參考集群配置，並註釋掉單機redis配置，同理redis單機模式也一樣。</li><li>關於 recover.application.list配置：這裡需要配置每個參與二階段分佈式事務的系統模塊的applicationName，多個模塊用 "," 分隔，這裡必須要配置。</li><li>關於 recover.serializer.support 配置，這裡是指參與二階段分佈式事務系統中，配置事務補償信息的序列化方式。</li><li>關於 spring.profiles.active 配置 admin項目激活的類型，支持db，file，mongo，zookeeper， 這裡是指參與二階段分佈式事務系統中，配置事務補償信息存儲方式，如果您用db存儲，那這裡就配置成db，同時配置好 recover.db等信息。 其他方式同理。 注意，每個模塊請使用相同的序列化方式和存儲類型</li><li>關於 tx.admin 等配置。 這裡就是管理後臺登錄的用戶與密碼，用戶可以進行自定義更改。</li></ul><p>步驟二：修改 index.html</p><pre>&lt;!--href 修改成你的ip 端口--&gt;&lt;a id="serverIpAddress" style="display: none" href="http://192.168.1.132:8888/admin"&gt;</pre><p>步驟三: 運行 AdminApplication 中的main方法。</p><p>步驟四:在瀏覽器訪問 http://ip:prot/admin ,輸入用戶名，密碼登錄。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>階段</a></li><li><a>事務</a></li><li><a>中間</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/99094aa6.html alt=合同款收不到？警惕中間公司 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/69613a6e-4e57-4e06-937f-15334b7d453c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/99094aa6.html title=合同款收不到？警惕中間公司>合同款收不到？警惕中間公司</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0be408a4.html alt="MySQL 事務處理" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0be408a4.html title="MySQL 事務處理">MySQL 事務處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8a538d3c.html alt=MySQL——事務(Transaction)詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/29d4c92c9c2344838eb72ef948cf08fa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8a538d3c.html title=MySQL——事務(Transaction)詳解>MySQL——事務(Transaction)詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3269d080.html alt=MySQL數據庫的事務管理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/152203544367254a708f807 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3269d080.html title=MySQL數據庫的事務管理>MySQL數據庫的事務管理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8293e598.html alt=MySQl事務最全詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c61163c863114226b14bb3760da19e4d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8293e598.html title=MySQl事務最全詳解>MySQl事務最全詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/011d2da0.html alt=MySql併發與事務的處理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/f13d8a1e-5e60-4b48-90bc-3c26e312a208 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/011d2da0.html title=MySql併發與事務的處理>MySql併發與事務的處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4ab1dd0d.html alt=Mysql事務 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4ab1dd0d.html title=Mysql事務>Mysql事務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cb944fe7.html alt=Mysql事務詳解(一文讀懂數據庫事務) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/cb7ba6cbda8c44438d9d3d7c57bd25b9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cb944fe7.html title=Mysql事務詳解(一文讀懂數據庫事務)>Mysql事務詳解(一文讀懂數據庫事務)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e9d6f488.html alt="SQL Server中的事務（附有實例）" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/21e047bd6e3c41fba0beac7ef3f1ce4e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e9d6f488.html title="SQL Server中的事務（附有實例）">SQL Server中的事務（附有實例）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bb071e7e.html alt="SQL 事務機制-transaction" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3231427d97bf4a04b148360fea032241 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bb071e7e.html title="SQL 事務機制-transaction">SQL 事務機制-transaction</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/44c014a1.html alt=SpringBoot事務詳細簡介 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/44c014a1.html title=SpringBoot事務詳細簡介>SpringBoot事務詳細簡介</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/24b98634.html alt=SqlServer使用事務注意事項，高級程序員必背 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/24b98634.html title=SqlServer使用事務注意事項，高級程序員必背>SqlServer使用事務注意事項，高級程序員必背</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/090306a0.html alt="[Spring] 深入瞭解事務原理" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/a8c6dbd7c51741f5a76262e8e2c7a670 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/090306a0.html title="[Spring] 深入瞭解事務原理">[Spring] 深入瞭解事務原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fb2bc471.html alt="「譯」 Spring 的分佈式事務實現—使用和不使用 XA—第二部分" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fb2bc471.html title="「譯」 Spring 的分佈式事務實現—使用和不使用 XA—第二部分">「譯」 Spring 的分佈式事務實現—使用和不使用 XA—第二部分</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1678b1c4.html alt=（收藏）Spring事務專題：事務的基本概念，Mysql事務處理原理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/433259b5-1936-4cee-ab74-70aef36536ee style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1678b1c4.html title=（收藏）Spring事務專題：事務的基本概念，Mysql事務處理原理>（收藏）Spring事務專題：事務的基本概念，Mysql事務處理原理</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>