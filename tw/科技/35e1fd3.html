<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>運維工程師必備技能：交換機上啟動QOS | 极客快訊</title><meta property="og:title" content="運維工程師必備技能：交換機上啟動QOS - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/228b4f9753a44d7593432b6f8f2b8dcb"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/35e1fd3.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/35e1fd3.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/35e1fd3.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/35e1fd3.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/35e1fd3.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/35e1fd3.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/35e1fd3.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/35e1fd3.html><meta property="article:published_time" content="2020-10-29T21:05:53+08:00"><meta property="article:modified_time" content="2020-10-29T21:05:53+08:00"><meta name=Keywords content><meta name=description content="運維工程師必備技能：交換機上啟動QOS"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/35e1fd3.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>運維工程師必備技能：交換機上啟動QOS</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>可限速的交換機一般都在三層或者以上的交換機，自2008年之後新出的交換機型號二層設備就可以 做到QOS限速，精確度達到1Mbps，例如Cisco 2960系列交換機。在這之後的大多數國內的標準二層交換機都可以做多限速，精確度基本能達到1Mbps，比如中興的標準二層，H3C的標準二層都可以做 到。老式的CISCO標準二層交換機例如2950類的交換也可以做到限速，但是精確度只能達到10Mbps。2950G的交換和2950 為EI型 的交換沒有太大的限速區別，因為限速和有關係，2950 系列的交換IOS版本一般都是在9.0 左右，最新的2960系列交換機 IOS 版本在 12.2 左右，高版本的IOS 提供了更強的系統功能。</p><div class=pgc-img><img alt=運維工程師必備技能：交換機上啟動QOS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/228b4f9753a44d7593432b6f8f2b8dcb><p class=pgc-img-caption></p></div><p>下面針對一些限速的方法進行總結：</p><p>PC1接在Cisco3550 F0/1上，速率為1M;</p><p>PC1接在Cisco3550 F0/2上，速率為2M;</p><p>Cisco3550的G0/1為出口。</p><p>PC是直接接在三層交換機端口的，意思就是說限制的是三層交換機端口的上下行流量控制，同理，如果三層交換機端口不是接PC，而是一個二層交換機，那麼可以對下層的設備進行上聯限速。</p><p>注:每個接口每個方向只支持一個策略;一個策略可以用於多個接口。因此所有PC的下載速率的限制都應該定義。在同一個策略(在本例子當中為policy-map user-down)，而PC不同速率的區分是在Class-map分別定義。</p><p>1、在交換機上啟動QOS</p><p>Switch(config)#mls qos //在交換機上啟動QOS</p><p>2、分別定義PC1(10.10.1.1)和PC2(10.10.2.1)訪問控制列表</p><p>Switch(config)#access-list 10 permit 10.10.1.0 0.0.0.255 //控制pc1上行流量</p><p>Switch(config)#access-list 100 permit ip any 10.10.1.0 0.0.0.255 //控制pc1下行流量</p><p>Switch(config)#access-list 11 permit 10.10.2.0 0.0.0.255 //控制pc2上行流量</p><p>Switch(config)#access-list 111 permit any 10.10.2.0 0.0.0.255 //控制pc2下行流量</p><p>3、定義類，並和上面定義的訪問控制列表綁定</p><p>Switch(config)# class-map user1-up //定義PC1上行的類，並綁定訪問列表10</p><p>Switch(config-cmap)# match access-group 10</p><p>Switch(config-cmap)# exit</p><p>Switch(config)# class-map user2-up</p><p>Switch(config-cmap)# match access-group 11 //定義PC2上行的類，並綁定訪問列表10</p><p>Switch(config-cmap)# exit</p><p>Switch(config)# class-map user1-down</p><p>Switch(config-cmap)# match access-group 100 //定義PC1下行的類，並綁定訪問列表100</p><p>Switch(config-cmap)# exit</p><p>Switch(config)# class-map user2-down</p><p>Switch(config-cmap)# match access-group 111 //定義PC2下行的類，並綁定訪問列表111</p><p>Switch(config-cmap)# exit</p><p>4、定義策略，把上面定義的類綁定到該策略</p><p>Switch(config)# policy-map user1-up //定義PC1上行的速率為1M</p><p>Switch(config-pmap)# class user1-up</p><p>Switch(config-pmap-c)# trust dscp</p><p>Switch(config-pmap-c)# police 1024000 1024000 exceed-action drop</p><p>Switch(config)# policy-map user2-up //定義PC2上行的速率為2M</p><p>Switch(config-pmap)# class user2-up</p><p>Switch(config-pmap-c)# trust dscp</p><p>Switch(config-pmap-c)# police 2048000 1024000 exceed-action drop</p><p>Switch(config)# policy-map user-down //定義PC1下行的速率為1M</p><p>Switch(config-pmap)# class user1-down</p><p>Switch(config-pmap-c)# trust dscp</p><p>Switch(config-pmap-c)# police 1024000 1024000 exceed-action drop</p><p>Switch(config-pmap-c)# exit</p><p>Switch(config-pmap)# class user2-down //定義PC2下行的速率為2M</p><p>Switch(config-pmap-c)# trust dscp</p><p>Switch(config-pmap-c)# police 2048000 1024000 exceed-action drop</p><p>Switch(config-pmap-c)# exit</p><p>5、在接口上運用策略</p><p>Switch(config)# interface f0/1 //進入PC1端口上聯交換機端口配置模式</p><p>Switch(config-if)# service-policy input user1-up //綁定PC1上行策略為user1-up</p><p>Switch(config)# interface f0/2 //進入PC2端口上聯交換機端口配置模式</p><p>Switch(config-if)# service-policy input user2-up //綁定PC2上行策略為user2-up</p><p>Switch(config)# interface g0/1 //進入交換機上聯千兆端口配置模式</p><p>Switch(config-if)# service-policy input user-down //綁定交換機上聯端口策略為 user-down</p><p>利用三層交換中的strom-control（風暴控制）功能，該功能是基於端口控制單播\多播 \組播,可以精確到0.01%，但是一個近似值 。此方法是一個門限方式，限制監控時間為每秒，超過設置的門限便丟棄包，並且用戶是不知情的，以為是網絡終端，或者遠程無響應，顯然這種方式不能確保終端 用戶每時每刻的網絡暢通，所以本人認為此方法只適用於某些場合，或者和其它策略配合使用。</p><p>具體配置方法：</p><p>Switch(config)# interface f0/1 //進入交換機端口配置模式</p><p>Switch(config-if)# strom-control unicast/broadcast/multi level 10 //該port帶寬的10%</p><p>理解風暴控制</p><p>風暴控制防止交換機的端口被局域網中的廣播、多播或者一個物理端口上的單播風暴所破壞。局域網風暴發生在包在局域網中泛洪，建立的過多的流量並喪失了網絡性能。協議棧中的錯誤或者網絡配置上的錯誤可以導致風暴。</p><p>風暴控制(或者叫流量壓制)管理進棧的流量狀態，通過一段時間和對比測量帶有預先設定的壓制級別 門限值的方法來管理。門限值表現為該端口總的可用帶寬的百分比。交換機支持單獨的風暴控制門限給廣播、組播和單播。如果流量類型的門限值達到了，更多這種 類型的流量就會受到壓制，直到進棧流量下降到門限值級別以下。</p><p>注意：當組播的速度超出一組門限，所有的進站流量(廣播組播單播)都會被丟棄，直到級別下降到門限級別以下。只有stp的包會被轉發。當廣播和單播門限超出的時候，只有超出門限的流量會被封閉。</p><p>當風暴控制開啟了時，交換機監視通過接口的包來交換總線和決定這個包是單播，組播還是廣播。交換機監視廣播組播和單播的數目，每1秒鐘一次，並且當某種類型流量的門限值到達了，這種流量就會被丟棄了。這個門限以可被廣播使用的總的可用帶寬的百分比被指定。</p><p>以下是一個接口上的一段時間內的廣播流量的模型曲線圖。</p><p>這個例子也可被組播和單播流量套用。在這個例子中，廣播流量在T1-T2、T4-T5時間之間被轉發超過配置門限值所有的該種流量都在下一個時間被丟棄。因此廣播流量在T2和T5時間內是被封閉的。在下一個時斷，T3，如果廣播流量沒有超出限制，那麼它又被轉發了。</p><p>風暴控制的工作是風暴控制抑制級別和每秒鐘間隔控制的結合。一個更高的門限允許更多的包通過。如果把門限值設置成100%意味著將不會限制所有任何的流量。0%意味著所有的廣播組播和單播流量都會被封閉。</p><p>注意：因為包不會在統一時間間隔內到達，每秒鐘間隔間如果沒有流量會影響風暴控制。</p><p>交換機持續監視端口的流量，而且當利用級別降到門限以下，這種被丟棄類型的流量，又會被再次轉發。</p><p>你可以使用storm-control接口命令來設定門限值給每一種類型的流量。</p><p>默認的風暴控制配置：默認地，單播組播廣播的風暴控制都是在交換機上關閉的，意味著：壓制級別都是100%。</p><p>開啟風暴控制：你在接口開啟風暴控制，並輸入總可用帶寬的百分比來確定你要使用給該種流量；輸入100%會允許所有流量。然而，因為硬件的限制以及包大小的不同的會導致偏差，門限值百分比是一個近似值。</p><p>注意：風暴控制僅支持在物理端口下使用；它不支持以太通道下使用，儘管能敲進去。</p><p>以下例子在f0/17下把組播風暴級別限制在70.5%</p><p>Switch# configure terminal</p><p>Switch(config)# interface fastethernet0/17</p><p>Switch(config-if)# storm-control multicast level 70.5 //限制組播類型的包</p><p>Switch(config-if)# end</p><p>Switch# show storm-control fastethernet0/17 multicast</p><p>Interface Filter State Level Current</p><p>--------- ------------- ------- -------</p><p>Fa0/17 Forwarding 70.50% 0.00%</p><p>這個是關閉風暴控制</p><p>Switch# configure terminal</p><p>Switch(config)# interface fastethernet0/17</p><p>Switch(config-if)# no storm-control multicast level</p><p>Switch(config-if)# end</p><p>Switch# show storm-control fastethernet0/17 multicast</p><p>Interface Filter State Level Current</p><p>--------- ------------- ------- -------</p><p>CISCO 3550-QOS的-接口限速</p><p>Building configuration...</p><p>Current configuration : 3123 bytes</p><p>version 12.1</p><p>no service pad</p><p>service timestamps debug uptime</p><p>service timestamps log datetime localtime</p><p>no service password-encryption</p><p>hostname shangwu</p><p>enable secret 5 $1$PmhU$dlsphRGumA1simUEIA87j0</p><p>enable password</p><p>ip subnet-zero</p><p>mls qos</p><p>class-map match-all user1-up</p><p>match access-group 10</p><p>class-map match-all user1-down</p><p>match access-group 100</p><p>policy-map user1-up</p><p>class user1-up</p><p>police 800000 800000 exceed-action drop</p><p>trust dscp</p><p>spanning-tree extend system-id</p><p>interface FastEthernet0/1</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/2</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/3</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/4</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/5</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/6</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/7</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/8</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/9</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/10</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/11</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/12</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface FastEthernet0/13</p><p>no ip address</p><p>service-policy input user1-up</p><p>interface FastEthernet0/14</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/15</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/16</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/17</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/18</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/19</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/20</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/21</p><p>no ip address</p><p>duplex full</p><p>service-policy input user1-up</p><p>interface FastEthernet0/22</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/23</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>service-policy input user1-up</p><p>interface FastEthernet0/24</p><p>description wan interface</p><p>switchport mode access</p><p>no ip address</p><p>duplex full</p><p>speed 100</p><p>interface GigabitEthernet0/1</p><p>no ip address</p><p>interface GigabitEthernet0/2</p><p>no ip address</p><p>interface Vlan1</p><p>ip address ********255.255.255.0</p><p>ip default-gateway ********</p><p>ip classless</p><p>ip http server</p><p>logging trap debugging</p><p>logging source-interface FastEthernet0/24</p><p>logging ***********</p><p>access-list 10 permit *********.0 0.0.0.255</p><p>access-list 100 permit ip any ********.0 0.0.0.255</p><p>line con 0</p><p>exec-timeout 0 0</p><p>line vty 0 4</p><p>password</p><p>login</p><p>line vty 5 15</p><p>password</p><p>login</p><p>end</p><p>交換機的主機名、進入enable模式的密碼、遠程登陸的用戶名和密碼及設置、管理vlan的 IP地址、交換機的默認網關、交換機的端口、SNMP服務、交換機時間設置等。這些和之前的2950交換機都是一樣的， 2960交換機和2950相比增加了限速等功能，由於今後客戶新上架除了簽署了流量合同的其他都要在交換機的端口上做限速。</p><p>首先也是十分重要的一點就是，在交換機的配置沒有完成前，特別是VTP模式的配置（一般情況下VTP的初始模式因配置為transparent模式）沒有完成前禁止將交換機接入網絡，以免使網絡中的VLAN信息發生改變，因當使用console線對其進行配置。</p><p>在剛開始配置2950的時候由於還沒有設置密碼，處於安全方面的考慮不要將其接入網絡，因使用 console口對其進行配置。交換機剛加電啟動時所有的端口會進行自檢，開始時每個端口上的指示燈會呈琥珀色經過一段時間後熄滅。系統的指示等默認情況 下會亮在SYST和 STAT兩個燈上。</p><p>交換機啟動後使用console線對其進行設置。Console線使用的是串行接口，串行口與電 腦的串行口相連（如電腦沒有串行口可以使用轉接器連接），RJ-45的接頭和交換機的console口相連。線連好後在windows上點擊 開始→程序→附件→通訊→超級終端，在跳出新建連接對話框後在名稱一欄中填入想要新建的連接名稱，然後確定。接著所連接的COM口，在COM1屬性裡波特 率選擇"9600"，數據位選擇"8"，奇偶效驗選擇"無"，停止位選擇"1"，流量控制選擇"無"；或直接點擊"還原默認值"，確定進入2950配置界 面。</p><p>2950如第一次啟動會出現對話配置模式選項，選擇yes進入對話配置模式，選擇no進入CLI命令行界面。以下配置都在CLI模式下進行。</p><p>在CLI模式下交換機顯示：switch></p><p>在此輸入命令 switch> 用戶模式</p><p>switch>enable 進入特權模式</p><p>switch# configure terminal 進入配置模式</p><p>switch(config)# 配置模式</p><p>設置主機名 switch(config)#hostname <em>主機名 </em>一般情況下主機名的設置規則是switch後面跟交換機編號，如switch20、switch21等</p><p>設置enable密碼 switch(config)#enable secret <em>密碼</em> 設置密碼時使用secret命令，因為它比password命令有更好的安全性，密碼用Password Agent軟件隨機生成12位包含數字和大小寫字母的密碼</p><p>設置遠程登陸的 switch(config)# username <em>用戶名</em>privilege <em>權限</em> secret <em>密碼</em></p><p>用戶名、權限和密碼 在設置<em>權限</em>參數時一般填0(最低權限)，<em>用戶名</em>統一為netmaster，密碼用Password Agent軟件隨機生成12位包含數字和大小寫字母的密碼</p><p>對所設置的密碼 switch(config)# service password-encryption 進行加密</p><p>設置管理vlan和 switch(config)# interface vlan1 進入管理vlan的配置</p><p>默認網關 switch(config-if)# ip address <em>IP地址 子網掩碼 </em>設置管理vlan的IP，遠程登陸使用此IP</p><p>switch(config-if)#no shutdown 啟用管理vlan</p><p>switch(config-if)#exit 退出管理vlan的配置</p><p>switch(config)# ip default-gateway <em>IP地址 </em>設置默認網關</p><p>設置交換機端口 switch(config)# interface FastEthernet 0/1 進入交換機的1號端口</p><p>switch(config-if)# description uplink port 對端口進行描述，默認時交換機1號口為上連口</p><p>switch(config-if)# switchport mode trunk 將上連口設為trunk模式</p><p>switch(config-if)# speed 100 設置端口速率</p><p>switch(config-if)# duplex full 端口設為全雙工模式</p><p>switch(config-if) interface range fastEthernet 0/2 -24</p><p>進入端口2至端口24的配置</p><p>switch(config-if-range)#shutdown 關閉這些端口，到使用時再打開</p><p>設置SNMP服務 switch(config)#snmp-server community <em>字符串LgB96G0o</em> RO</p><p>命令允許讀訪問到任何提交community string為<em>字符串</em>的軟件，<em>字符串</em>設置要符合長度8位以上、需包含大小寫字母和數字</p><p>關閉http服務 switch(config)#no ip http server 由於開啟http服務在全全上存在隱患，因關閉</p><p>設置vty switch(config)#line vty 0 4 設置telnet為0至4共5條線路</p><p>switch24(config-line)# login local 使系統在遠程登錄時使用本地設置的用戶名和密碼進行驗證</p><p>設置timestamps switch(config)# service timestamps debug datetime</p><p>switch(config)# service timestamps log datetime 默認時debug/log為uptime，改為datetime</p><p>設置VTP模式 switch#vlan database 進入VTP的設置</p><p>switch (vlan)#vtp transparent 將VTP模式設置為transparent模式</p><p>設置交換機時間 switch#clock set <em>hh:mm:ss</em></p><p>保存交換機的設置 switch#copy running-config startup-config</p><p>查看交換機設置 switch#show running-config 查看交換機的配置</p><p>端口流量的限制</p><p>交換機端口流量的限制是用policy-map來實現的。</p><p>switch (config)#ip access-list standard <em>name</em> // 建立標準的命名訪問控制列表，<em>name</em>為ACL的名稱</p><p>Switch (config-std-nacl)# permit any // 匹配任何ip</p><p>Switch (config)#class-map <em>name </em>//設置QoS Class Map</p><p>Switch (config-cmap)#match access-group name <em>name </em>// 綁定ACL列表</p><p>Switch (config)#policy-map <em>name</em> // 設置策略名稱</p><p>Switch (config-pmap)#class <em>name</em> // 綁定class-map</p><p>Switch (config-pmap-c)#police <em>3000000 100000</em> exceed-action <em>drop</em> 定義策略正常速率為每秒3Mbit，允許超出的範圍是100KByte，超出範圍的數據包就<em>drop</em></p><p>Switch (config)#interface range fastEthernet 0/1 – 24 // 進入1－24端口，默認交換機除了上聯口外都要做限速</p><p>Switch (config-if)#service-policy input <em>name</em> //在端口上進的方向綁定策略</p><p>Switch (config) #mls qos //啟用mls qos使策略生效</p><p>端口綁定MAC地址</p><p>進入配置模式後用以下命令綁定：</p><p>Switch(config-if )switchport port-security mac-address MAC(主機的MAC地址)</p><p>解除綁定</p><p>Switch(config-if )no switchport port-security mac-address MAC(主機的MAC地址)</p><p>二層交換機如何限速？</p><p>使用cisco 2950 交換機，每個端口都是二層接入，如何限速？</p><p>使用service-policy可以進行端口限速：</p><p>可以先定義class，然後</p><p>Switch(config)# policy-map policy1</p><p>Switch(config-pmap)# class class1</p><p>Switch(config-pmap-c)# police 1000000 65536 exceed-action drop</p><p>然後在接口下配置：</p><p>Switch(config)# interface gigabitethernet0/17</p><p>Switch(config-if)# service-policy input plcmap1</p><p>可以限速，但是不精確。。。。。。</p><p>給個6500上的限速例子：</p><p>Mls qos aggregate-policer test 50000000 100000 conform-action transmit exceed-action drop</p><p>Mls qos</p><p>class-map match-any test_limite</p><p>match access-group name test_addr</p><p>policy-map rate-limit-uplink</p><p>class test_limite</p><p>police aggregate test</p><p>ip access-list extended test_addr</p><p>permit ip any x.x.x.x 0.0.0.255</p><p>inter g0/1</p><p>service-policy input rate-limit-uplink</p><p>總結:Cisco交換機端口限速常用配置，以前端口限速的工作都是由上級部門來做，最近由於分公司自己的內部客戶需求，我們要為其提供50M的帶寬.　為此我們可是煞費苦心作了兩天的測試，先來說說我們測試的設備連接情況：</p><p>思科3560端口0/47（模擬用戶）——————思科6509端口0/1、0/2（模擬局端，兩條路有上聯，熱備）。</p><p>測試方法在3560及6509上分別起ftp進行測速</p><p>重點來了，來說說6509上的命令吧：</p><p>mls qos aggregate-policer test 50000000 100000 conform-action transmit exceed-action drop</p><p>mls qos</p><p>class-map match-any test_limite</p><p>match access-group name test_addr</p><p>policy-map rate-limit-uplink</p><p>class test_limite</p><p>police aggregate test</p><p>ip access-list extended test_addr (因為上下行都引用策略一樣因此不單獨做acl)</p><p>permit ip any x.x.x.x 0.0.0.3 (分配給用戶的互聯網地址段A）</p><p>permit ip x.x.x.x 0.0.0.3 any</p><p>permit ip any x.x.x.x 0.0.0.3 (分配給用戶的互聯網地址段B）</p><p>permit ip x.x.x.x 0.0.0.3 any</p><p>inter f0/1</p><p>ip addre x.x.x.x 255.255.255.252</p><p>service-policy input test_uplink限制上傳</p><p>inter f0/2</p><p>ip addre x.x.x.x 255.255.255.252</p><p>service-policy input test_uplink限制上傳</p><p>inter g0/47</p><p>service-policy input rate-limit-uplink限制下載</p><p>經過測試，這個方案成功了！有幾點需要解釋一下，因為35和65只有在input方向才能引 用策略，所以同時對上行和下載作限速需要在上聯和下載兩方向的端口上做，其次，我們中間有很多彎路，說來給大家提個醒，開始我們用的測試設備性能很低，所 以始終測試不出理想的結果，很洩氣，無意中拿了最好的一臺電腦去測試，結果居然出人意料，後來又找了一臺高性能設備進行測試，結果非常理想，在此提醒大 家，低性能的設備在測試高帶寬的時候要特別注意。</p><p>華為的2層交換機，是直接進端口後，用line-rate對上下行進行限速，不過好像是要雙向做</p><p>下面是偶看到的 你試試看</p><p>access-list 2 permit any</p><p>mls qos</p><p>class-map match-all input-class</p><p>match access-group 2</p><p>class-map match-all output-class</p><p>match ip dscp 0</p><p>policy-map output-policy-2M</p><p>class output-class</p><p>police 2000000 200000 exceed-action drop</p><p>policy-map input-policy-2M</p><p>class input-class</p><p>police 2000000 200000 exceed-action drop</p><p>policy-map output-policy-5M</p><p>class output-class</p><p>police 5000000 500000 exceed-action drop</p><p>policy-map input-policy-5M</p><p>class input-class</p><p>police 5000000 500000 exceed-action drop</p><p>policy-map output-policy-10M</p><p>class output-class</p><p>police 10000000 1000000 exceed-action drop</p><p>policy-map input-policy-10M</p><p>class input-class</p><p>police 10000000 1000000 exceed-action drop</p><p>policy-map output-policy-20M</p><p>class output-class</p><p>police 20000000 1000000 exceed-action drop</p><p>policy-map input-policy-20M</p><p>class input-class</p><p>police 20000000 1000000 exceed-action drop</p><p>interface FastEthernet ?/?</p><p>service-policy input input-policy-5M</p><p>service-policy output output-policy-5M</p><p>系列智能以太網交換機</p><p>Cisco Catalyst 2960系列智能以太網交換機是一個全新的、固定配置的獨立設備系列，提供桌面快速以太網和千兆以太網連接，可為入門級企業、中型市場和分支機構網絡提供 增強LAN服務。Catalyst2960系列具有集成安全特性，包括網絡准入控制(NAC)、高級服務質量(QoS)和永續性，可為網絡邊緣提供智能服 務。</p><p>Cisco Catalyst 2960系列提供：為網絡邊緣提供了智能特性，如先進的訪問控制列表 (ACL)和增強安全特性雙介質上行鏈路端口提供了千兆以太網上行鏈路靈活性，可以使用銅纜或光纖上行鏈路端口—每個介質上行鏈路端口都有一個 10/100/1000以太網端口和一個小型可插拔(SFP)千兆以太網端口，在使用時其中一個端口激活，但不能同時使用這兩個端口。通過高級QoS、精 確速率限制、ACL和組播服務，實現了網絡控制和帶寬優化。通過多種驗證方法、數據加密技術和基於用戶、端口和MAC地址的網絡准入控制，實現了網絡安全 性，通過思科網絡助理，簡化了網絡配置、升級和故障診斷，使用Smartports自動配置特定應用</p><p>Cisco Catalyst 2960-24TT：24個10/100以太網端口和2個10/100/1000固定以太網上行鏈路端口；1機架單元(RU)</p><p>Cisco Catalyst 2960-48TT：48個10/100以太網端口和2個10/100/1000固定以太網上行鏈路端口；1 RU</p><p>Cisco Catalyst 2960-24TC：24個10/100以太網端口和2個雙介質上行鏈路端口；1 RU</p><p>Cisco Catalyst 2960-48TC：48個10/100以太網端口和2個雙介質上行鏈路端口；1 RU</p><p>Cisco Catalyst 2960G-24TC：20個10/100/1000以太網端口，其中4個為雙介質端口；1 RU</p><p>CiscoCatalyst2960系列軟件鏡像提供了一系列豐富的智能服務，包括高級QoS、 速率限制和ACL。SFP千兆以太網端口可安裝多種SFP收發器，包括Cisco1000BASE-SX、1000BASE-LX、1000BASE- BX、1000BASE-ZX、100BASE-FX、100BASE-LX10、100BASE-BX和粗波分多路複用 (CWDM) SFP收發器。</p><p>高級QoS:</p><p>提供了802.1p CoS和DSCP現場分類，可以利用源和目的地IP地址、源和目的地MAC地址或者第四層TCP/UDP端口號</p><p>進行基於單個分組的標記和重新分類。</p><p>所有端口上的思科控制平面和數據平面QoS ACL可以確保在單個分組的基礎上進行正確的標記。每個端口的4個輸出隊列讓用戶可以對堆疊中最多四種流量類型進行不同的管理。</p><p>SRR調度確保了用戶可以通過智能化地服務於輸入和輸出隊列，為數據流量提供不同的優先級。加權隊尾丟棄（WTD）可以在發生中斷之前，為輸入和輸出隊列提供擁塞避免功能。</p><p>嚴格優先級排序可以確保優先級最高的分組先於所有其他流量獲得服務。</p><p>高度精確的QoS功能不會對性能造成任何影響。</p><p>精確的速率限制:</p><p>思科CIR功能能夠以低達1Mbps的精確度保障帶寬。</p><p>速率限制基於源和目的地IP地址、源和目的地MAC地址、第四層TCP/UDP信息或者這些字段的任意組合，並利用QoS 、ACL（IP ACL或者MAC ACL）、級別圖和策略圖提供。</p><p>利用輸入策略控制和輸出整形，可以方便地管理來自於基站或者上行鏈路的異步上行和下行數據流。 每個快速以太網或者千兆以太網端口最多可以支持64個彙總或者單獨策略控制器。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>運維</a></li><li><a>師必備</a></li><li><a>交換</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/86f0532a.html alt=液壓工程師必備—液壓油口接頭/法蘭擰緊力矩表 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/39a20004da3d13465dab style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/86f0532a.html title=液壓工程師必備—液壓油口接頭/法蘭擰緊力矩表>液壓工程師必備—液壓油口接頭/法蘭擰緊力矩表</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5f3963dd.html alt=材料熱處理工程師必備的熱處理基礎知識（4） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/d699bf43cfab49e1b16fc74b02c33dbe style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5f3963dd.html title=材料熱處理工程師必備的熱處理基礎知識（4）>材料熱處理工程師必備的熱處理基礎知識（4）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0ef4a8fd.html alt=「網工進階」路由交換：鏈路聚合的配置，你都會嗎 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f5b7228828484a249973d030a8ae92a6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0ef4a8fd.html title=「網工進階」路由交換：鏈路聚合的配置，你都會嗎>「網工進階」路由交換：鏈路聚合的配置，你都會嗎</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/35ebbbc8.html alt=交換機鏈路帶寬不夠用怎麼辦？可以通過鏈路捆綁增加鏈路帶寬 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/8cfd610c006140cebf4355d60e84b06e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/35ebbbc8.html title=交換機鏈路帶寬不夠用怎麼辦？可以通過鏈路捆綁增加鏈路帶寬>交換機鏈路帶寬不夠用怎麼辦？可以通過鏈路捆綁增加鏈路帶寬</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4cd32872.html alt=交換機鏈路聚合最常用場景分析，記住一張表格即可 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/93898ffc9d7b4672b064a870525bab57 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4cd32872.html title=交換機鏈路聚合最常用場景分析，記住一張表格即可>交換機鏈路聚合最常用場景分析，記住一張表格即可</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/df522c73.html alt=交換機鏈路聚合配置詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/df522c73.html title=交換機鏈路聚合配置詳解>交換機鏈路聚合配置詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/87e62787.html alt=出色的總監理工程師必備的七種條件 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/1531038446609814acfc6f2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/87e62787.html title=出色的總監理工程師必備的七種條件>出色的總監理工程師必備的七種條件</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/523cf282.html alt=電子工程師必備基礎知識——二極管篇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/db35d86f1a90450eac2e0bade7545fd0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/523cf282.html title=電子工程師必備基礎知識——二極管篇>電子工程師必備基礎知識——二極管篇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eaad46d9.html alt=做了技術，別不知道運維工作到底是做什麼的？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1d32085c69b24be089a7ab915584c90c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eaad46d9.html title=做了技術，別不知道運維工作到底是做什麼的？>做了技術，別不知道運維工作到底是做什麼的？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0e08e2b3.html alt="國網安徽檢修公司蚌埠運維分部黨支部：主題黨日出實效 責任擔當幹精彩" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/S3HYy9AAIgYfJq style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0e08e2b3.html title="國網安徽檢修公司蚌埠運維分部黨支部：主題黨日出實效 責任擔當幹精彩">國網安徽檢修公司蚌埠運維分部黨支部：主題黨日出實效 責任擔當幹精彩</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7e08514c.html alt=國網湖北檢修鄂西北運維分部：孤島堅守38天，讓他們變成了全能戰士 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b5fd04edd5064f9ea782c13c87352e2f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7e08514c.html title=國網湖北檢修鄂西北運維分部：孤島堅守38天，讓他們變成了全能戰士>國網湖北檢修鄂西北運維分部：孤島堅守38天，讓他們變成了全能戰士</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/596af5ae.html alt=大唐吉林電力檢修運維新增二期熱網及其附屬設備維護輔助招標公告 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/596af5ae.html title=大唐吉林電力檢修運維新增二期熱網及其附屬設備維護輔助招標公告>大唐吉林電力檢修運維新增二期熱網及其附屬設備維護輔助招標公告</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/190ee7c6.html alt=大唐吉林電力檢修運維有限公司機組檢修前後試驗輔助服務招標公告 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/190ee7c6.html title=大唐吉林電力檢修運維有限公司機組檢修前後試驗輔助服務招標公告>大唐吉林電力檢修運維有限公司機組檢修前後試驗輔助服務招標公告</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b8ab92f1.html alt=運維工作到底都幹嘛？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bd5fe403147146b0a603984680a60ebc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b8ab92f1.html title=運維工作到底都幹嘛？>運維工作到底都幹嘛？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a5c56bd4.html alt=風電特別篇：聰敏的運維“會說話” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/SFASkq92xJvTJ7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a5c56bd4.html title=風電特別篇：聰敏的運維“會說話”>風電特別篇：聰敏的運維“會說話”</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>