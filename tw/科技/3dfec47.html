<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>自語之Mysql隱式提交和事務隔離級別的關係 | 极客快訊</title><meta property="og:title" content="自語之Mysql隱式提交和事務隔離級別的關係 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/dfic-imagehandler/e563bef1-a1b9-42e0-94e6-4cd3de1ed8b8"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3dfec47.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3dfec47.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3dfec47.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3dfec47.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3dfec47.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3dfec47.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3dfec47.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3dfec47.html><meta property="article:published_time" content="2020-10-29T20:50:42+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:42+08:00"><meta name=Keywords content><meta name=description content="自語之Mysql隱式提交和事務隔離級別的關係"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/3dfec47.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>自語之Mysql隱式提交和事務隔離級別的關係</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>前言</p><p>筆者自詡對Mysql的知識積累已經很不錯了，現在看來不過是對CRUD操作比較熟悉罷了。</p><p>用了那麼久的Mysql, 直到前幾日才知道隱式提交和事務隔離級別的聯繫(內幕)。</p><div class=pgc-img><img alt=自語之Mysql隱式提交和事務隔離級別的關係 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/e563bef1-a1b9-42e0-94e6-4cd3de1ed8b8><p class=pgc-img-caption></p></div><p>那麼，什麼是隱式提交？</p><ul><li>顧名思義, 就是偷偷的提交事務(手動狗頭)。</li><li>講道理在Mysql中, 開啟一個事務後, 需要使用commit關鍵字進行提交事務，這種提交方式叫做顯式提交。但是，我們在當前事務中輸入某些語句之後, 會造成當前事務悄悄的提交，那麼這種導致事務悄悄提交的情況, 我們稱為隱藏提交。</li><li>那麼, 觸發隱式提交的語句有哪些？</li><li class=ql-indent-1>使用create、alter、delete語句去修改數據庫、表、視圖、存儲過程等數據庫對象的時候，就會隱式提交當前事務。</li><li class=ql-indent-1>使用ALTER USER、CREATE USER、DROP USER、GRANT、RENAME USER、REVOKE、SET PASSWORD等語句, 也會觸發隱式提交。</li><li>當然有很多操作多會造成隱式提交, 經常使用的則是對數據庫表的增、刪、改操作。</li></ul><pre>delete ... fromupdate set frominsert into ....複製代碼</pre><p>事務併發帶來的問題</p><p>在筆者之前的知識體系中, 只是知道事務併發的概念，卻不知是Mysql為什麼會發生事務的併發。請原諒筆者, 到現在才知道事務的併發，是因為Mysql的C/S架構引起的…..</p><ul><li>事務併發誘因：</li><li>講道理, Mysql是一個C/S架構, 即客戶端/服務器架構。所以，在使用過程中, 肯定會出現多個客戶端訪問服務器的場景。其中，每一個客戶端向服務端發起訪問, 可以稱為建立一次數據庫連接(session會話)。而每一個連接都可以發起數據庫的事務。</li><li>所以，不同的數據庫連接之間的事務，有可能是併發執行的。</li></ul><p>我們都知道，一旦產生併發有可能會對共享數據的狀態，產生巨大的影響。</p><p>對於一次數據庫連接而言，當兩個事務同時操作同一種表的數據的時候, 可能會產生以下問題：</p><pre>create table X ( id int(10),	name varchar(10));insert into X values(1, '張三');複製代碼</pre><ul><li>骯讀/寫：一個事務能夠讀取/修改, 另一個事務<strong>未提交</strong>的數據。</li><li>不可重複讀：同一個事務內, 根據同一個條件對同一個行記錄進行查詢，但是搜出來的結果卻不一致。</li></ul><div class=pgc-img><img alt=自語之Mysql隱式提交和事務隔離級別的關係 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/22ee89439b2a48f4b6e98169ec29696c><p class=pgc-img-caption></p></div><ul><li><br></li><li>在數據庫連接1中, 事務T1根據查詢條件id = 1, 查詢行記錄name的值為張三, 且T1未提交。之後, 在另外一個數據庫連接中, 根據條件id = 1, 把行記錄name的值更新為李四。</li><li>緊接著, 事務T1根據查詢條件id = 1, 再次查詢行記錄name的值, 結果顯示為李四。這種情況, 稱為不可重複讀。</li><li class=ql-indent-1>注意：在上圖的右邊更新語句, 觸發了隱式提交。</li><li>幻讀：同一個事務內, 多次查詢相同的條件返回的結果集不一樣。</li></ul><div class=pgc-img><img alt=自語之Mysql隱式提交和事務隔離級別的關係 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e9e15890c96d460dadc936465381523d><p class=pgc-img-caption></p></div><ul><li><br></li><li class=ql-indent-1>在數據庫連接1中, 事務T1先根據查詢H的所有記錄, 這時返回結果為張三。之後, 另外一個事務T2對錶插入李四這條記錄。此時事務T1再次查詢H表的所有記錄, 返回的結果為張三和李四, 此時發生這種情況稱為幻讀。</li></ul><p>寫到這裡, 併發帶來的問題差不多描述完了。</p><p>那麼, 如何解決事務併發所帶來的問題呢？事務的隔離級別, 瞭解一下!</p><p>事務的隔離級別</p><p>如果, 在事務隔離性方面, 直接一杆子打死。要求，所有的併發事務都必須串行化執行(一個接一個, 即不允許併發), 那麼這樣做會造成執行效率過低。</p><div class=pgc-img><img alt=自語之Mysql隱式提交和事務隔離級別的關係 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/dfic-imagehandler/2348b504-0096-4119-82a2-1941e94fd188><p class=pgc-img-caption></p></div><p>所以, 在性能和隔離性方面, 我們需要一種折中的辦法, 即允許併發問題的出現(髒讀、不可重複讀、幻讀), 根據出現的問題, 設置隔離強度。</p><p>在SQL標準中,具有四種隔離級別, 分別是<strong>讀已提交</strong>、<strong>讀未提交</strong>、<strong>可重複讀</strong>、<strong>可串行化</strong>。</p><ul><li>READ UNCOMMITTED：可能發生髒讀、不可重讀讀、幻讀</li><li>READ COMMITTED：解決髒讀, 可能會發生不可重複讀、幻讀</li><li>REPEATABLE READ：解決髒讀、不可重複讀, 可能發生幻讀</li><li>SERIALIZABLE：串行化執行, 並不會發生併發問題。即, 解決髒讀, 不可重複讀、幻讀。</li></ul><p>上述的四種隔離級別, 是所有數據庫通用的標準。因為不同數據庫, 隔離級別的支持情況並不一樣。</p><div class=pgc-img><img alt=自語之Mysql隱式提交和事務隔離級別的關係 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/dfic-imagehandler/183bcb3e-3bef-4009-a7e3-81f69ae19e1f><p class=pgc-img-caption></p></div><p>但是, Mysq包含且支持四種上述的四種隔離級別。</p><p>唯一不同的是, Mysql在可重複讀(REPEATABLE READ)的隔離級別下, 是可以解決幻讀問題。所以, Mysql的默認隔離級別為可重複讀！</p><p>總結</p><ul><li>根據事務併發帶來的問題的嚴重性, 可以適度選擇相應的隔離級別來解決。</li><li>髒寫是併發事務帶來的最最最嚴重的問題, 所以四種隔離級別中, 直接禁止髒寫的出現。</li><li>在Mysql標準中的可重複讀, 是可以解決幻讀問題。</li><li>幻讀主要強調, 使用同一個條件多次進行查詢後, 返回之前查詢結果中, 沒有獲取到的記錄。</li><li>比如這種場景, 算不算幻讀？</li><li class=ql-indent-1>事務T1, 第一次查詢得到結果集合：A、B、C、D</li><li class=ql-indent-1>期間, 事務T2, 刪除了C、D記錄</li><li class=ql-indent-1>事務T2, 第二次查詢得到結果集合：A、B</li><li>其實, 上述情況屬於不可重複讀, 而不是幻讀。</li></ul></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>自語</a></li><li><a>Mysql</a></li><li><a>隱式</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/4ab1dd0d.html alt=Mysql事務 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4ab1dd0d.html title=Mysql事務>Mysql事務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cb944fe7.html alt=Mysql事務詳解(一文讀懂數據庫事務) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/cb7ba6cbda8c44438d9d3d7c57bd25b9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cb944fe7.html title=Mysql事務詳解(一文讀懂數據庫事務)>Mysql事務詳解(一文讀懂數據庫事務)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/33348acb.html alt=《深入精通Mysql（三）》深入底層Mysql各種鎖機制（面試必問） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/470f515e8fe44c6184b07227fdb51333 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/33348acb.html title=《深入精通Mysql（三）》深入底層Mysql各種鎖機制（面試必問）>《深入精通Mysql（三）》深入底層Mysql各種鎖機制（面試必問）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dbb4fd63.html alt="Mysql --09 Innodb核心特性——事務" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/47618d6931fd4518a4d78c0e13623b98 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dbb4fd63.html title="Mysql --09 Innodb核心特性——事務">Mysql --09 Innodb核心特性——事務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/32c88075.html alt="對Mysql中的read_only 只讀屬性做簡要說明" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/32c88075.html title="對Mysql中的read_only 只讀屬性做簡要說明">對Mysql中的read_only 只讀屬性做簡要說明</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/be37c386.html alt=設置Mysql表只讀，關鍵時刻或許能救你一命 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/dfic-imagehandler/b0665c8c-a980-4035-9d41-5a5e5e1cb34d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/be37c386.html title=設置Mysql表只讀，關鍵時刻或許能救你一命>設置Mysql表只讀，關鍵時刻或許能救你一命</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a9a04cdb.html alt=Mysql複製表結構新建數據表 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3fef358df48345bab6025c12654ccb4a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a9a04cdb.html title=Mysql複製表結構新建數據表>Mysql複製表結構新建數據表</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5fd9a137.html alt=孩子總是自言自語？父母別慌張，這是孩子的“假想朋友”在作怪 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/423808674e8f451ebff88fd445689562 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5fd9a137.html title=孩子總是自言自語？父母別慌張，這是孩子的“假想朋友”在作怪>孩子總是自言自語？父母別慌張，這是孩子的“假想朋友”在作怪</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/29290e3e.html alt=MATLAB與Mysql數據庫連接並數據交換(基於ODBC) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/68b7783707474a749700cf6cb9f205cf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/29290e3e.html title=MATLAB與Mysql數據庫連接並數據交換(基於ODBC)>MATLAB與Mysql數據庫連接並數據交換(基於ODBC)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5a2fd2e0.html alt=一分鐘告訴你：Mysql數據庫死鎖原因及解決、避免辦法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/33ef82b628ef49a8ab1a5dc3b5367cb1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5a2fd2e0.html title=一分鐘告訴你：Mysql數據庫死鎖原因及解決、避免辦法>一分鐘告訴你：Mysql數據庫死鎖原因及解決、避免辦法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1e03b0ea.html alt=Mysql知識總結 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/53ea00052344dfa26d44 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1e03b0ea.html title=Mysql知識總結>Mysql知識總結</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8b00b993.html alt=《深入精通Mysql（一）》Mysql整體架構和sql執行過程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3a03943b7e3c456fb535e18f902470e4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8b00b993.html title=《深入精通Mysql（一）》Mysql整體架構和sql執行過程>《深入精通Mysql（一）》Mysql整體架構和sql執行過程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c83ebf5.html alt=13個Mysql常見的錯誤碼講解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RXEA2kD6BnWmJG style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c83ebf5.html title=13個Mysql常見的錯誤碼講解>13個Mysql常見的錯誤碼講解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3c8e2bb.html alt=Mysql常見的錯誤碼，新手必看 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/062fb39a0ed64486bd9c5c93a57aaf4f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3c8e2bb.html title=Mysql常見的錯誤碼，新手必看>Mysql常見的錯誤碼，新手必看</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1b8a000.html alt=Mysql修改字段名、字段類型、添加刪除字段、修改表名、表註釋 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1b8a000.html title=Mysql修改字段名、字段類型、添加刪除字段、修改表名、表註釋>Mysql修改字段名、字段類型、添加刪除字段、修改表名、表註釋</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>