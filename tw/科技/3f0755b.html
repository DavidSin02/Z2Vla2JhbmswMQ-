<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>技術帖：Node.js各種異步模式是如何實現與數據庫交互？ | 极客快訊</title><meta property="og:title" content="技術帖：Node.js各種異步模式是如何實現與數據庫交互？ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/3202000408db3cf640af"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f0755b.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f0755b.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3f0755b.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f0755b.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f0755b.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3f0755b.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3f0755b.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f0755b.html><meta property="article:published_time" content="2020-10-29T20:50:33+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:33+08:00"><meta name=Keywords content><meta name=description content="技術帖：Node.js各種異步模式是如何實現與數據庫交互？"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/3f0755b.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>技術帖：Node.js各種異步模式是如何實現與數據庫交互？</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>與數據庫交互看起來是一個很簡單的事情，但由於Node.js的異步性質使得這一切並不是那麼簡單。通過Node.js編寫異步代碼有很多選擇，每個都需要進行不同編碼。在本系列中，我們將提供一些示例來說明如何利用各種異步模式獲取、使用和關閉連接。在這篇文章中，我們將探討異步編程與傳統編程的區別。</p><p><strong>try...catch...finally</strong></p><p>JavaScript有一個try…catch…finally語句，try…catch部分很容易：運行某些代碼並捕獲異常，以便它們得到適當處理。但為什麼我們需要finally？finally提供了一種允許你運行代碼清理的方法，無論異常在try還是catch塊中。清理代碼通常包括關閉文件處理和數據庫鏈接。</p><p>下面是例子：</p><p><img alt=技術帖：Node.js各種異步模式是如何實現與數據庫交互？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/3202000408db3cf640af></p><p>如果你在瀏覽器控制檯（或者Node.js）中運行，你會在控制到看到類似內容：</p><p><img alt=技術帖：Node.js各種異步模式是如何實現與數據庫交互？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/31fb00006b0d0eff0b98></p><p>請注意catch塊中引發的bar異常最終會作為未處理的異常，但在finally塊執行之前不會起作用。</p><p>如果我們在Node.js中運行的所有代碼都是異步，我們可以這樣做：</p><p>不幸的是，try…catch…finally對於異步代碼並不是非常有用—至少在異步函數可用之前，原因與Node.js中異步工作原理有關。</p><p><strong>異步</strong><strong>/</strong><strong>事件處理</strong></p><p>下面讓我們看看異步操作如何執行，例如執行HTTP請求和執行數據庫查詢。</p><p><img alt=技術帖：Node.js各種異步模式是如何實現與數據庫交互？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/321a00006b80a58d8d51></p><p>所有JavaScript代碼在主線程運行，異步API從主線程調用並傳遞迴調函數。根據類型不同，異步工作可能完全作為事件或者可能利用線程池。當異步工作完成時，回調函數被添加到回調對象，以便儘快在主線程上調用。</p><p>對於這種架構，在異步處理期間發生的錯誤會在完全不同的調用堆棧中帶回到主線程。你不能捕捉在不同調用堆棧中引發的錯誤—為時太晚！</p><p>下面是調用異步API的非常簡單的演示：</p><p>setTimeout(function() {</p><p>console.log('hello');</p><p>}, 2000);</p><p>console.log('world');</p><p>如果你在瀏覽器控制檯或Node.js中運行該腳本，則輸出是：</p><p>world</p><p>hello</p><p>在hello前兩秒看到world會讓異步編程新手感到驚訝。這裡的祕密是傳遞到setTimeout的回調函數，它會“回調”，或者當指定時間過去時在主線程執行。</p><p>回調函數可追溯到JavaScript的開始，JavaScript被設計為將生活帶到網絡的語言。JavaScript開發人員需要將代碼與事件關聯（例如加載頁面、點擊鼠標或者按鍵），隨著時間推移，下面這種DOM API被引入：</p><p>window.addEventListener('load', function() {</p><p>// do some work</p><p>});</p><p>上面的addEventListener方法將傳入的異步函數作為第二個參數，並將其添加到windows元素load event相關的偵聽器列表中。當該事件發生時，所有監聽器被添加到回調對象，並將儘快被調用。</p><p>為了讓回調正常工作，JavaScript中的函數需要重要的功能：它們需要是第一類對象，並需要關閉。</p><p><strong>函數作為第一類</strong><strong></strong></p><p>函數作為第一類對象的概念聽起來很複雜。大多數編程語言提供了聲明變量和創建命名代碼單元的方法，通常被稱為函數或過程。這兩種結構之間通常有明確的區別，例如，你可以聲明變量並將其傳遞給函數，但你不能將函數傳遞給函數。</p><p>另一方面，JavaScript允許函數可用作更標準數據類型（例如Number、String和Boolean）。函數可以被聲明，從函數傳遞到函數，並可在未來某個時候被調用。函數作為第一類對象是傳遞函數到另一函數的前提條件。</p><p>想象一下，當頁面加載以及當用戶點擊窗口時你想要執行相同的代碼，你可以這樣做：</p><p>window.addEventListener('load', function() {</p><p>// do some work</p><p>});</p><p>window.addEventListener('click', function() {</p><p>// do the same work here</p><p>});</p><p>上面代碼的問題在於我們需要維持做相同工作的兩個函數。然後，如果知道函數是第一類對象，我們可聲明單一的命名函數，並根據需要傳遞引用。</p><p>function doWork() {</p><p>// do some work</p><p>}</p><p>window.addEventListener('load', doWork);</p><p>window.addEventListener('click', doWork);</p><p>你可以看到，函數作為第一類對象是簡單而強大的JavaScript功能。</p><p><strong>函數提供閉合</strong></p><p>閉合的概念可能有點難理解，但它對異步/事件編程來說至關重要。簡單來說，閉合是指在其封閉範圍定義的變量的函數。</p><p>很多語言允許開發人員在函數中嵌套函數，子函數可引用父函數範圍中聲明的變量。使用其他語言的開發人員可能永遠不會想到，如果在父函數完成執行後運行時調用子函數會發生什麼？這根本不可能，但JavaScript並非如此！</p><p>請記住，JavaScript中的函數是第一類對象，所以與分配給變量的任何其他值一樣，它們可通過傳遞來逃避其父函數的限制。當發生這種情況時，原始封閉範圍（詞彙範圍）內對變量的引用仍將存在。那麼，在以後調用子函數時應該怎麼辦？</p><p>閉合確保子函數能夠訪問這些變量，只要運行時可能需要調用子函數。這些變量不會像平常那樣作為垃圾回收。</p><p>下面是示例：</p><p><img alt=技術帖：Node.js各種異步模式是如何實現與數據庫交互？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/31fb00006cb3cb53dec7></p><p>你可將此代碼複製並粘貼到具有.html擴展名的文件中，並在瀏覽器中打開。你會看到一個按鈕寫著“點擊我”，當窗口加載時，onLoad函數會將onClick函數註冊到按鈕的click事件。</p><p>請注意，onClick不會在onLoad內調用。相反，應用被傳遞到API，可在未來調用該函數。因為onClick是指onLoad函數中聲明的button變量，閉合可確保onClick在未來調用時可訪問button。</p><p>現在我們已經探討了JavaScript中異步編程相關的一些核心概念，下面讓我們將注意力轉移到Node.js中涉及的異步模式。</p><p><strong>常見異步模式</strong></p><p>目前，通過Node.js編寫異步代碼最常見（通用）模式是回調、異步模塊和promise。Node.js 7.6版本升級到8版本，其中引入了被稱為異步函數的異步處理新方法。</p><p>異步函數允許Javascript代碼異步編寫，且可異步執行。最重要的是，異步結構可按照你期望的方式運作。對於JavaScript來說，異步函數是重要變革，但promise以及異步處理仍然很重要。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>技術</a></li><li><a>Node</a></li><li><a>js</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/c382d8ba.html alt=Node.js錯誤處理模式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/512f67b59dea4ffc888df6a86064c804 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c382d8ba.html title=Node.js錯誤處理模式>Node.js錯誤處理模式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/247e1389.html alt="使用 Node.js 寫一個代碼生成器" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2cba7942e6784844bac56d6b44752c5c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/247e1389.html title="使用 Node.js 寫一個代碼生成器">使用 Node.js 寫一個代碼生成器</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/122da5e.html alt="Node.js 實現搶票小工具&短信通知提醒（上）「乾貨」" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/3e88283f-59ea-4552-ad5a-af642291fdd9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/122da5e.html title="Node.js 實現搶票小工具&短信通知提醒（上）「乾貨」">Node.js 實現搶票小工具&短信通知提醒（上）「乾貨」</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6ece3e8.html alt="Node.js 實現搶票小工具&短信通知提醒（下）「乾貨」" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/793cc204-c1e4-41d7-9b9e-810052752b26 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6ece3e8.html title="Node.js 實現搶票小工具&短信通知提醒（下）「乾貨」">Node.js 實現搶票小工具&短信通知提醒（下）「乾貨」</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ae8fa62.html alt=如何使用Node.js各種異步模式與數據庫交互 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/3202000408db3cf640af style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ae8fa62.html title=如何使用Node.js各種異步模式與數據庫交互>如何使用Node.js各種異步模式與數據庫交互</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2dbb2c8.html alt="Node.js 應用故障排查手冊 —— 冗餘配置傳遞引發的內存溢出" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e49bab5e69304add9032153d21d21229 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2dbb2c8.html title="Node.js 應用故障排查手冊 —— 冗餘配置傳遞引發的內存溢出">Node.js 應用故障排查手冊 —— 冗餘配置傳遞引發的內存溢出</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/93727dba.html alt="技術帖 | 3分鐘搞定各種測試分析技術" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/f055e0a4477240088de2abb7cd696cfa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/93727dba.html title="技術帖 | 3分鐘搞定各種測試分析技術">技術帖 | 3分鐘搞定各種測試分析技術</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2d0ddee5.html alt=建築房屋結構平衡技術要求，你都會知道嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/5e7d0001715d878ed66c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2d0ddee5.html title=建築房屋結構平衡技術要求，你都會知道嗎？>建築房屋結構平衡技術要求，你都會知道嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/47c8cac0.html alt=新《裝配式混凝土建築技術標準》有哪些改變？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1540524372015dc56ec3fb9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/47c8cac0.html title=新《裝配式混凝土建築技術標準》有哪些改變？>新《裝配式混凝土建築技術標準》有哪些改變？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b6c2fc2b.html alt=鈦合金精密鑄造技術發展現狀 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/SCynkUUBbHN8CF style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b6c2fc2b.html title=鈦合金精密鑄造技術發展現狀>鈦合金精密鑄造技術發展現狀</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d2e8af08.html alt=傾斜航攝技術小知識——航線設計篇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RS1ucOiDvLRlVt style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d2e8af08.html title=傾斜航攝技術小知識——航線設計篇>傾斜航攝技術小知識——航線設計篇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d597da51.html alt=黃河電力技術公司在龍羊峽進行無人機傾斜攝影測量 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1528429551298e033646798 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d597da51.html title=黃河電力技術公司在龍羊峽進行無人機傾斜攝影測量>黃河電力技術公司在龍羊峽進行無人機傾斜攝影測量</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cdb604f6.html alt=《雷神4：愛與雷》將採用“虛擬製作”技術 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/83a320a69b0f44e3baf7db07faac3c65 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cdb604f6.html title=《雷神4：愛與雷》將採用“虛擬製作”技術>《雷神4：愛與雷》將採用“虛擬製作”技術</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1cd5b6b6.html alt=虛擬現實技術在智能製造領域具有重要的應用價值 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3ed327880d3b4c5384619f21d6c81823 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1cd5b6b6.html title=虛擬現實技術在智能製造領域具有重要的應用價值>虛擬現實技術在智能製造領域具有重要的應用價值</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3a2b0c81.html alt="虛擬製造的基石：數值模擬技術 | 加快實現工業數字化" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/2f2c32f4bd734f9face045546d45a665 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3a2b0c81.html title="虛擬製造的基石：數值模擬技術 | 加快實現工業數字化">虛擬製造的基石：數值模擬技術 | 加快實現工業數字化</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>