<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>碼農生活 ：IC卡門卡模擬探祕 | 极客快訊</title><meta property="og:title" content="碼農生活 ：IC卡門卡模擬探祕 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/080eab7c5c7a43b5a5b268457fcc636f"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f0a49b2.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f0a49b2.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3f0a49b2.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f0a49b2.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f0a49b2.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3f0a49b2.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3f0a49b2.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3f0a49b2.html><meta property="article:published_time" content="2020-10-29T21:11:59+08:00"><meta property="article:modified_time" content="2020-10-29T21:11:59+08:00"><meta name=Keywords content><meta name=description content="碼農生活 ：IC卡門卡模擬探祕"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/3f0a49b2.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>碼農生活 ：IC卡門卡模擬探祕</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>本文作者：Hoki87</p><p><strong>免責聲明：本文涉及的技術僅供安全學習和教學用途，禁止非法使用！！！</strong></p><hr><p>前言</p><p>現在生活中少不了各種卡，公交卡、地鐵卡、銀行卡、門禁卡等，它們都是什麼卡？ID卡？IC卡？另外帶NFC功能的手機也能刷卡使用，筆者通過本文科普一下關於卡的知識，另外文中還有門卡模擬等一系列乾貨，值友們要看到最後哦！！！</p><p>ID和IC</p><p><strong>ID卡</strong>：全稱為身份識別卡（Identification Card），是一種不可寫入的感應卡，含固定的編號，主要有臺灣SYRIS的EM格式、美國HIDMOTOROLA等各類ID卡，</p><p><strong>IC卡</strong>：全稱集成電路卡（Integrated Circuit Card），又稱智能卡（Smart Card）。可讀寫，容量大，有加密功能，數據記錄可靠，使用更方便，如一卡通系統，消費系統等，目前主要有PHILIPS的Mifare系列卡</p><p><strong>主要區別</strong>：ID卡不可寫入數據，其記錄內容(卡號)只可由芯片生產廠一次性寫入，開發商只可讀出卡號加以利用,無法根據系統的實際需要制訂新的號碼管理制度；而IC卡不僅可由授權用戶讀出大量數據，而且亦可由授權用戶寫入大量數據(如新的卡號,用戶的權限,用戶資料等)，IC卡所記錄內容可反覆擦寫</p><p>IC卡由於其固有的信息安全、便於攜帶、比較完善的標準化等優點，在身份認證、銀行、電信、公共交通、車場管理等領域正得到越來越多的應用，例如二代身份證，銀行的電子錢包，電信的手機SIM卡，公共交通的公交卡、地鐵卡，用於收取停車費的停車卡、小區門禁卡等</p><p>接觸式和非接觸式IC卡</p><p>IC卡按結構分有：接觸式IC卡和非接觸式IC卡</p><p>接觸式IC卡，該類卡是通過IC卡讀寫設備的觸點與IC卡的觸點接觸後進行數據的讀寫</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/080eab7c5c7a43b5a5b268457fcc636f><p class=pgc-img-caption></p></div><p>接觸式IC卡和讀卡機</p><p>非接觸式IC卡，該類卡與卡設備無電路接觸，而是通過非接觸式的讀寫技術進行讀寫（例如RFID、NFC），其內嵌芯片除了CPU、邏輯單元、存儲單元外，增加了射頻收發電路。該類卡一般用在使用頻繁、信息量相對較少、可靠性要求較高的場合</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d35091f9690645938ae75d6c490e47ab><p class=pgc-img-caption></p></div><p>IC 白卡</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/05211603f18b417c888b234ddcebbe40><p class=pgc-img-caption></p></div><p>IC鑰匙扣</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e0322a53991342b89b14b0ea0bd6b10b><p class=pgc-img-caption></p></div><p>IC滴膠卡</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b0128104dcb34f3d8bc0eee668f7ba1f><p class=pgc-img-caption></p></div><p>IC手機貼</p><p>NFC是現在主流的非接觸式IC卡的讀卡技術，其全稱是近場通信（near field communication），是基於無線射頻識別RFID（Radio Frequency Identification）技術發展起來的一種近距離無線通信技術，與RFID一樣，NFC也是通過頻譜中無線頻率部分的電磁感應耦合方式傳遞，但兩者之間還是存在很大的區別。NFC的傳輸範圍比RFID小，RFID的傳輸範圍可以達到0~1m，但由於NFC採取了獨特的信號衰減技術，相對於RFID來說NFC具有成本低、帶寬高、能耗低等特點。</p><p>NFC技術主要特徵如下：</p><ul><li>用於近距離(10cm以內)安全通信的無線通信技術</li><li>射頻頻率：13.56MHz</li><li>射頻兼容：ISO 14443，ISO 15693，Felica標準</li><li>數據傳輸速度：106kbit/s，212 kbit/s，424kbit/s</li></ul><p>現在手機都包含NFC功能，其主板上嵌入了NFC模塊，具有三種功能模式：NFC手機作為識讀設備(讀寫器)、NFC手機作為被讀設備(卡模擬)、NFC手機之間的點對點通信應用</p><p>IC卡基礎知識</p><p>IC卡中最常見的是NXP Mifare系列卡，根據卡內使用芯片的不同，分為</p><ul><li>Mifare S50，簡稱M1卡，是最常見的卡，出廠固化UID，可存儲修改數據</li><li>Mifare UltraLight，簡稱M0卡，低成本卡，出廠固化UID，可存儲修改數據</li><li>Mifare UID Chinese magic card，簡稱UID卡，M1卡的變異版本，可修改UID，國外叫做中國魔術卡，可以用來完整克隆M1 S50卡的數據；但是現在新的讀卡系統通過檢測卡片對特殊指令的迴應，可以檢測出UID卡，因此可以來拒絕UID卡的訪問，來達到屏蔽複製卡的功能</li><li>針對UID卡被屏蔽的問題，另外還有變異版本FUID卡和CUID卡，FUID卡的UID只能修改一次，起防屏蔽作用，專門對付物業升級的防復卡和防復讀頭；CUID卡則是針對FUID卡做的優化，支持UID號重複擦寫，無需鎖卡自動起防屏蔽作用</li></ul><p>以標準M1卡為例，其容量為1K字節，總共分為16個扇區，每個扇區分為4個數據塊，每個數據塊16個字節</p><p>每個扇區中的塊按照0 ~ 3編號，第3個塊中包含KEYA（密鑰A）、控制位、KEYB（密鑰B），每個扇區可以通過它包含的密鑰A或者密鑰B單獨加密</p><p>0扇區0塊是特殊的數據塊，用於存放製造商代碼，包括芯片序列號UID，ATQA和SAK</p><p><strong>非加密卡和加密卡的區別</strong>就是，非加密卡中所有扇區的KEYA和KEYB數值都是默認值FFFFFFFFFFFF；而加密卡中，其中有扇區的KEYA和KEYB不等於FFFFFFFFFFFF，部分扇區加密的卡稱半加密卡，所有扇區都加密的卡稱全加密卡</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/3b28c01577fa4239b52c9a9f39d827dd><p class=pgc-img-caption></p></div><p>M1卡數據結構</p><p>IC卡讀寫</p><p>設備</p><p>如果想讀取IC卡中的數據，需要通過支持讀卡技術（RFID、NFC）的硬件設備支持了，比如pn532、acr122u、proxmark3等，筆者使用的是Proxmark3，忽略性價比因素，相比於其它傻瓜式設備，proxmark3的功能更全面些，可玩性也更高，另外集成NFC模塊的手機也支持IC卡片的讀取</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/348cbdbe51c341c2814ce4f3107511dd><p class=pgc-img-caption></p></div><p>Proxmark3</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/356649c37de84a03aa09db640a03b614><p class=pgc-img-caption></p></div><p>讀取IC卡</p><p>Proxmark3是由Jonathan Westhues設計並且開發的開源硬件，其主要用RFID的嗅探、讀取以及克隆等的操作</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ad5b01d4471d4636b0b1a644c1b9471f><p class=pgc-img-caption></p></div><p>官方固件更新記錄：最近更新2019/03/15</p><p>除了官方軟件，還有其它大神的軟件：Proxbrute、EMV、Iceman</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/baf772fdb3b44ea58011acf7afff8655><p class=pgc-img-caption></p></div><p>筆者用的是冰人（iceman）固件</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e667afff63eb4965b10f4de04cb30db2><p class=pgc-img-caption></p></div><p>冰人固件更新記錄：最近更新2019/03/06</p><p>讀卡方法：</p><p>用USB連接proxmark3後，安裝完驅動，可以在設備管理器中查看設備串口號</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7026a741751549afb767dd15996ccb58><p class=pgc-img-caption></p></div><p>串口識別COM4</p><p>打開PM3 Universal GUI軟件，選擇 COM4 連接proxmark3</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0ea2d9a12bb54ce6b7f61e66de83d200><p class=pgc-img-caption></p></div><p>查看Proxmark3的固件版本，發送指令：</p><ul><li>hw version</li></ul><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1b5126d3ebdb4545ab6565ae4ece3b23><p class=pgc-img-caption></p></div><p>已刷冰人固件</p><p>在IC卡感應位置放上IC卡</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4abe35f6337d4d52ae81c01af0bdf64a><p class=pgc-img-caption></p></div><p>然後讀取卡片信息，發送指令：</p><ul><li>hf 14a info</li></ul><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/028617a2a5204aebae40eab7ecad3c92><p class=pgc-img-caption></p></div><p>其實Proxmark3最重要的功能還支持獲取扇區的密鑰，從而獲取所有扇區的數據，這部分內容筆者本來有寫，而且是本文的主要內容，無奈值得買平臺對敏感信息審核比較嚴格，筆者第一次的文章提交未通過，只好把大部分違規內容給刪除了，關於Proxmark3獲取密鑰的方法，值友們可以搜索其它平臺，有類似方法介紹</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c7d09c1cff2e400facc14b20397316b6><p class=pgc-img-caption></p></div><p>在已知密鑰的情況下，通過密鑰將卡片數據讀出，保存在仿真器內存中，發送指令：</p><ul><li>hf mf ecfill A 1</li></ul><p>最後將仿真器內存中的卡片數據保存位文件TestData.eml，發送指令：</p><ul><li>hf mf esave 1 TestData</li></ul><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f9c2c266cd9848ed99745c1e3dea099a><p class=pgc-img-caption></p></div><p>打開TestData.eml文件，可以看到所有扇區的數據都成功讀取</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f29df71baf604df9a548591ab80c65b0><p class=pgc-img-caption></p></div><p>寫卡方法：</p><p><strong>寫UID卡：</strong></p><p>準備一張UID卡，讀取卡片信息，其中Answers to magic commands: Yes表示這張卡是中國魔術卡（UID卡）</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/45a13501debd4afda9950eb42f69aa49><p class=pgc-img-caption></p></div><p>寫數據到UID卡中，發送指令：</p><ul><li>hf mf cload TestData</li></ul><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/db4d263c31aa4bfbaabedaa611e5639c><p class=pgc-img-caption></p></div><p>讀出UID卡每個扇區中數據，以確認是否成功寫入，發送指令：</p><ul><li>hf mf cgetsc n</li></ul><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/dbb85baea0d44435ae394eb978b11530><p class=pgc-img-caption></p></div><p><strong>cload</strong>和<strong>cgetsc</strong>命令是專門針對UID卡的，換成其它類型卡比如CUID卡則無效</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a351d8b12bce4595af027600e8ccf386><p class=pgc-img-caption></p></div><p><strong>寫CUID卡：</strong></p><p>那麼寫CUID卡該如何操作呢？現在大部分門禁系統都加入了屏蔽系統，使用複製的UID卡會出現只能使用一次，下次刷卡無效的情況，而CUID卡防屏蔽解決了這個問題，所以筆者繼續研究如何寫CUID卡，寫CUID卡需要指令：</p><ul><li>hf mf wrbl blknum A/B KEYA/KEYB 000102030405060708090A0B0C0D0E0F</li></ul><p>麻煩的是該指令每次只寫1個塊的數據，而卡中總共64塊，所以需要執行64條指令，手動執行肯定比較耗時耗力，因此筆者寫了lua腳本（cuidwrite.lua）自動執行寫64塊的操作</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c48e741df29a4f3f8ba274820344deed><p class=pgc-img-caption></p></div><p>...</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e48535e7c61d499cad2f54c9624e9ea1><p class=pgc-img-caption></p></div><p>CUID寫操作腳本執行</p><p>讀取CUID卡片信息，其中Answers to magic commands: NO，只有UID卡才會返回YES</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4f8c2de55e8d456f9b9d1915be80a902><p class=pgc-img-caption></p></div><p>手機NFC讀寫卡</p><p>手機中安裝MCT（mifare classic tool），無需root，可讀取mifare系列IC卡的數據</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5a43022bfcd942ce83e3bed5e2047297><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/feb4a102bacc47f5afe877f5cde5a1ee><p class=pgc-img-caption></p></div><p>MCT讀取的數據</p><p>MCT寫卡需要數據和密鑰，可以只添加密鑰，然後利用密鑰直接讀取卡片數據</p><p>1）編輯/增加密鑰 ：新建密鑰文件TestKey，進入密鑰編輯頁面，將密鑰數據從電腦上覆制然後粘貼進來</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/4105f125773f479191589bc79e9050f7><p class=pgc-img-caption></p></div><p>2）讀取原卡數據：將原卡放在手機NFC感應區域，在MCT中選擇正確的密鑰TestKey，所有扇區數據就能成功讀取</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/912989aae9e245baa52ed80000288259><p class=pgc-img-caption></p></div><p>如果選擇不正確的密鑰，則無法讀取完整數據</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/171e22d1e09a45188a93f9ba87b37a52><p class=pgc-img-caption></p></div><p>3）保存數據至轉儲文件</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/28a94ca7251f44d8a682e4c71e7cd128><p class=pgc-img-caption></p></div><p>4）數據寫入新卡：準備一張空白UID卡，識別卡片後，選擇密鑰文件和轉儲文件，選擇扇區，等待寫入完成即可</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/74018b38a25d44cab732f720ef3db0de><p class=pgc-img-caption></p></div><p>這麼簡單就完事了，還是太天真？</p><p>重新讀取卡片數據確認，在MCT裡選擇比較轉儲功能，發現卡中0扇區0塊的數據與轉儲文件不同，這說明0扇區0塊的數據沒有成功寫入</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fc834ccccae640c6b14039edec4ec17c><p class=pgc-img-caption></p></div><p>後來筆者研究了下，原來需要在寫轉儲時勾選 “高級：使能廠商塊寫入”選項，勾上這個選項後另外單獨寫一次0扇區</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4cad62452f94424e8ba48631798f8e74><p class=pgc-img-caption></p></div><p>但是反覆嘗試了UID卡，這種方法也無法寫入0扇區；嘗試了CUID卡，這種方法可以寫入0扇區</p><p>注：MCT方式只能寫CUID卡，用MCT寫卡沒有Proxmark3穩定，有時會出現寫壞鎖死CUID卡的情況</p><p>IC卡模擬（手機、手環）</p><p>MIUI門卡</p><p>小米MIUI推出了門卡模擬的功能，不僅可以將卡數據寫入到手機中，而且手環也可以，當然需要寫特殊手段，但是為了安全考量，小米官方都不支持加密卡的模擬</p><p>筆者的小米MIX2板載NFC芯片是NXP 80T19</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7aa419fab07640e5b57f2ef1120ca924><p class=pgc-img-caption></p></div><p>NXP 80T19芯片其模擬的卡類型屬於NXP JCOP系列，Proxmark3的官方固件是不支持JCOP卡，後來筆者是刷了冰人固件才能正常識別MIX2模擬的門卡</p><p>NXP JCOP系列芯片卡是恩智浦NXP公司在高安全性的解決方案高性能產品。廣泛應用如銀行與金融，移動通信，公共交通，訪客訪問和網絡接入等領域。支持接觸式、非接觸式、支持接觸式與非接觸式讀寫，內含有一個JCOP版本操作系統，並提供40 k-80K字節EEPROM存儲器。NXP JCOP系列芯片卡出廠帶傳輸密鑰（Transport Key），需要經過初始化後，方可訪問卡片內置的COS系統，因為此類芯片卡的安全系列非常高。</p><p>小米MIUI推出的門卡功能有兩個模式：模擬實體門卡和添加虛擬門卡</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e4f665c004784822956738ea5fae0ee6><p class=pgc-img-caption></p></div><p>模擬實體門卡</p><p>這個功能是將實體卡中的數據讀取出來，然後通過手機模擬實體卡，將卡模擬到手機後，可以只帶手機在刷卡機處刷卡，無需再另外帶實體卡，輕便出行。可讀取的門卡包括普通白卡、鑰匙扣之類的IC卡</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3cdbf51bab154ab3ba72102babc3a54e><p class=pgc-img-caption></p></div><p>但是模擬的卡中不包括加密卡，如果卡被識別為加密卡，則會提示“加密卡不支持模擬”</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/854b605889db456098c746c85ffa4343><p class=pgc-img-caption></p></div><p>非加密卡，可以成功模擬，模擬過程中需要證件和密碼認證，這功能必須進行安全因素的考量</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0ee85cc2df9445838bff1b6bb60bc6aa><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/27b26c28ee084626af3f40ec017f0a7c><p class=pgc-img-caption></p></div><p>手機放在IC卡感應器</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cbab41e00cec4bac8f48e23e14e32a96><p class=pgc-img-caption></p></div><p>Proxmark3讀出的模擬門卡信息，UID與實體IC卡的相同</p><p>添加虛擬門卡</p><p>虛擬門卡可以根據場景開卡，選擇自定義空白卡，相當於由MIUI自動生成一張0扇區不可更改的IC卡，剩下的扇區數據可以隨意寫入。如果物業允許，在物業處開通虛擬門卡的權限即可，不過一般小區物業不會同意的</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0ce2d67aa5624842a0e0c6edf9eb8567><p class=pgc-img-caption></p></div><p>虛擬門卡開卡</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ff4bddc50aae4a5180f82e71781aa920><p class=pgc-img-caption></p></div><p>Proxmark3讀取到的虛擬門卡信息，UID由MIUI自動分配</p><p>模擬加密卡</p><p>現實中有個需求就是，想把手上的IC卡寫到手機中，虛擬門卡是因其UID是由MIUI自動分配的，且生成後不可更改，虛擬門卡沒條件開通門禁系統權限的條件下，只能選擇模擬實體卡的功能了，但是模擬實體卡有個問題，前文中也提到過，現在使用的IC卡基本都是加密卡，模擬實體卡功能又不支持加密卡，那就沒有辦法了嗎？</p><p>答案是肯定的，可以模擬加密卡，前方高能！！！真正的乾貨來了！！！</p><p>模擬加密卡的思路：獲取加密卡數據 --> 只寫UID信息到實體UID白卡中 --> 模擬UID白卡 --> 往模擬卡中寫入加密數據</p><p><strong>第一步：獲取加密卡數據</strong></p><p>用Proxmark3獲取加密卡的密鑰，然後讀取所有加密數據（內容違規，已刪</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1d7f2d55329646d2a8e7a9635b9ff4e0><p class=pgc-img-caption></p></div><p>）</p><p><strong>第二步：只寫UID信息到實體UID白卡中</strong></p><p>Proxmark3上更換一張UID空白卡，然後寫0扇區0塊數據</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4abe35f6337d4d52ae81c01af0bdf64a><p class=pgc-img-caption></p></div><p>發送指令：</p><ul><li>hf mf csetblk 0 7295B829760804000214F34CBDBE2F1D</li></ul><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d2c052fb20434c6fa2ac0ff2b6246f3c><p class=pgc-img-caption></p></div><p>只寫了0扇區0塊的UID卡，因為未寫加密數據，這張UID卡目前還是一張非加密卡</p><p><strong>第三步：模擬UID白卡</strong></p><p>手機上使用MIUI門卡的標準功能，模擬寫了0扇區0塊的UID卡</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0be56a32187f4eb2ba9c94137a22b5d9><p class=pgc-img-caption></p></div><p>這一步相當於已將加密卡的0扇區寫入到手機中</p><p><strong>第四步：往模擬卡中寫入加密數據</strong></p><p>手機切換到卡模式，然後放在Proxmark3感應區域</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5168f75a5a0a4501924416c6f7bbeda2><p class=pgc-img-caption></p></div><p>用Proxmark3往手機的模擬門卡里寫入加密數據，發送指令：</p><ul><li>hf mf restore 1 u 7295B829</li></ul><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8d5223b61e36417c9625131c35a6f37b><p class=pgc-img-caption></p></div><p>. . .</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/91f25e5cfc77476ab0647c0dd87f4ef1><p class=pgc-img-caption></p></div><p>1 ~ 63塊數據成功寫入</p><p>這一步寫入了1 ~ 63塊數據，但是0扇區0塊數據無法寫入，沒關係因為0扇區0塊數據已經在第三步中寫入了</p><p>至此，所有扇區數據已寫入到手機中，加密卡模擬成功完成</p><p>手機中可以設定刷卡方式設置，選擇默認快捷卡片，只要靠近讀卡器，手機自動喚醒切換到卡模式，並且首選默認快捷卡片</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/09522e93a146413a90b87a9b0cc4bb8c><p class=pgc-img-caption></p></div><p>筆者模擬了公司門禁卡、小區物業門禁卡，加上MI Pay綁定的信用卡用於刷公交地鐵，出行基本就不用帶一堆卡了，一個手機全搞定</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/9a6d8fef98e34210b9c829ff6abd8836><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f5d0657b867140d1b0361f70ad02bf5a><p class=pgc-img-caption></p></div><p>手環模擬</p><p>小米手環3 NFC版也可以通過相同方法模擬加密卡</p><div class=pgc-img><img alt="碼農生活 ：IC卡門卡模擬探祕" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c8a302c49ee9457ca7f1b7039a2d81e7><p class=pgc-img-caption></p></div><p>總結</p><p>關於模擬加密卡功能，科技方便生活，筆者只嘗試了小米系產品，另外華為系也有類似的門卡功能，等筆者手上有華為手機了另做嘗試，蘋果系則是要等iOS開方NFC權限，不知道紅年馬月了。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>碼農</a></li><li><a>IC卡</a></li><li><a>門卡</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/c8e6f65a.html alt=門卡消磁了怎麼辦 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/R6W36LADdP99Oo style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c8e6f65a.html title=門卡消磁了怎麼辦>門卡消磁了怎麼辦</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c1052881.html alt=碼農眼中的色彩和你有什麼不同？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/d8a04993d33840e7a63067d12af10dbc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c1052881.html title=碼農眼中的色彩和你有什麼不同？>碼農眼中的色彩和你有什麼不同？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/07044fea.html alt="IC卡、HID、CPU卡金屬讀卡器可用於門禁 梯控 通道" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/894b9f2d5a8940449c496f8581523394 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/07044fea.html title="IC卡、HID、CPU卡金屬讀卡器可用於門禁 梯控 通道">IC卡、HID、CPU卡金屬讀卡器可用於門禁 梯控 通道</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/12bd0879.html alt="ID卡、IC卡、身份證、CPU卡、T57卡、HID卡門禁 梯控 通道讀卡器" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/2cc8b39f7cb84f06884cbb34fec8bfc7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/12bd0879.html title="ID卡、IC卡、身份證、CPU卡、T57卡、HID卡門禁 梯控 通道讀卡器">ID卡、IC卡、身份證、CPU卡、T57卡、HID卡門禁 梯控 通道讀卡器</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>