<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>深入理解Linux磁盤文件系統之inode詳解 | 极客快訊</title><meta property="og:title" content="深入理解Linux磁盤文件系統之inode詳解 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/c6b8a86418a147d1a9606329d980b535"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3fdb565.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3fdb565.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3fdb565.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3fdb565.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3fdb565.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3fdb565.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/3fdb565.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/3fdb565.html><meta property="article:published_time" content="2020-10-29T21:07:20+08:00"><meta property="article:modified_time" content="2020-10-29T21:07:20+08:00"><meta name=Keywords content><meta name=description content="深入理解Linux磁盤文件系統之inode詳解"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/3fdb565.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>深入理解Linux磁盤文件系統之inode詳解</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>inode是什麼？</h1><blockquote><p>inode中文譯名為"索引節點"</p></blockquote><p>文件儲存在硬盤上，硬盤的最小存儲單位叫做"扇區"（Sector）。每個扇區儲存512字節（相當於0.5KB）。</p><p>操作系統讀取硬盤的時候，不會一個個扇區地讀取，這樣效率太低，而是一次性連續讀取多個扇區，即一次性讀取一個"塊"（block）。這種由多個扇區組成的"塊"，是文件存取的最小單位。"塊"的大小，最常見的是4KB，即連續八個 sector組成一個 block。</p><p>文件數據都儲存在"塊"中，那麼很顯然，我們還必須找到一個地方儲存文件的元信息，比如文件的創建者、文件的創建日期、文件的大小等等。這種儲存文件元信息的區域就叫做inode，中文譯名為"索引節點"。</p><h1>inode的內容</h1><p><strong>inode包含文件的元信息，具體來說有以下內容：</strong></p><blockquote><p>* 文件的字節數</p><p>* 文件擁有者的User ID</p><p>* 文件的Group ID</p><p>* 文件的讀、寫、執行權限</p><p>*文件的時間戳，共有三個：ctime指inode上一次變動的時間，mtime指文件內容上一次變動的時間，atime指文件上一次打開的時間。</p><p>* 鏈接數，即有多少文件名指向這個inode</p><p>* 文件數據block的位置</p></blockquote><p><strong>示例1：</strong></p><p>stat命令，查看某個文件的inode信息</p><pre>[root@localhost mytest]# stat a.txt </pre><div class=pgc-img><img alt=深入理解Linux磁盤文件系統之inode詳解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c6b8a86418a147d1a9606329d980b535><p class=pgc-img-caption></p></div><p>mtime ： modify time,修改文件內容的時間</p><p>即指文件內容上一次變動的時間。如：echo aa >> a.sh 或vim a.sh 修改內容</p><p>atime ： access time 訪問文件內容的時間</p><p>即指文件上一次查看文件的時間，如： cat a.sh</p><p>ctime指inode上一次文件屬性變動的時間，change time 。 比如： chmod +x a.sh</p><h1>inode的大小</h1><p>inode也會消耗硬盤空間，所以硬盤格式化的時候，操作系統自動將硬盤分成兩個區域。一個是數據區，存放文件數據；另一個是inode區（inode table），存放inode所包含的信息。</p><p>每個inode節點的大小，一般是128字節或256字節。inode節點的總數，在格式化時就給定，假定在一塊1GB的硬盤中，每個inode節點的大小為128字節，每1KB就設置一個inode，那麼inode table的大小就會達到128MB，佔整塊硬盤的12.8%。</p><h1>inode號碼</h1><p>每個inode都有一個號碼，操作系統用inode號碼來識別不同的文件。</p><p>Unix/Linux系統內部不使用文件名，而使用inode號碼來識別文件。對於系統來說，文件名只是inode號碼便於識別的別稱或者綽號。表面上，用戶通過文件名，打開文件。實際上，系統內部這個過程分成三步：首先，系統找到這個文件名對應的inode號碼；其次，通過inode號碼，獲取inode信息；最後，根據inode信息，找到文件數據所在的block，讀出數據。</p><p><strong>示例2</strong></p><p>使用ls -i命令，可以看到文件名對應的inode號碼</p><pre>[root@localhost mytest]# ls -i 或[root@localhost mytest]# ll -i</pre><div class=pgc-img><img alt=深入理解Linux磁盤文件系統之inode詳解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/54cee5d259a0454f91350222820cd08c><p class=pgc-img-caption></p></div><p><strong>示例3</strong></p><p>查看每個硬盤分區的inode總數和已經使用的數量，可以使用df命令</p><pre>[root@localhost mytest]# df -i</pre><div class=pgc-img><img alt=深入理解Linux磁盤文件系統之inode詳解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ce1b5481f1914748bd41db10e2254762><p class=pgc-img-caption></p></div><h1>目錄文件</h1><blockquote><p>Unix/Linux系統中，目錄（directory）也是一種文件。打開目錄，實際上就是打開目錄文件。</p></blockquote><p>目錄文件的結構非常簡單，就是一系列目錄項的列表。每個目錄項，由兩部分組成：所包含文件的文件名，以及該文件名對應的inode號碼。</p><pre>[root@localhost mytest]# ls -id /etc/</pre><div class=pgc-img><img alt=深入理解Linux磁盤文件系統之inode詳解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2d76aeeb6c2f47b795132aa3ec1c5b91><p class=pgc-img-caption></p></div><p><strong>示例4</strong></p><p>ls -i命令列出整個目錄文件，即文件名和inode號碼：</p><pre>[root@localhost mytest]# ls -id /etc/</pre><div class=pgc-img><img alt=深入理解Linux磁盤文件系統之inode詳解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e97a50361baf4a9197d12b64ce3a2062><p class=pgc-img-caption></p></div><h1>實戰</h1><blockquote><p>解決磁盤有空間但創建不了文件</p></blockquote><h1>場景</h1><blockquote><p>在一臺配置較低的Linux服務器（內存、硬盤比較小）的/data分區內創建文件時，系統提示磁盤空間不足，用df -h命令查看了一下磁盤使用情況，發現/data分區只使用了80%，還有1.9G的剩餘空間，但是無法創建新的文件。當時使用的是root用戶。服務器沒有被黑。</p></blockquote><pre>[root@localhost mytest]# df -h</pre><blockquote><p>文件系統 容量 已用 可用 已用% 掛載點</p><p>/dev/sda3 10G 8.0G 1.9G 80% /</p></blockquote><p><strong>常識： 只要權限夠，磁盤上有空間一定可以創建文件。 這個是錯的。</strong></p><p><strong>排查過程</strong></p><p><strong>第一步：</strong></p><pre>用df -i</pre><p>查看了一下/data所在的分區的索引節點(inode)，發現已經用滿(IUsed=100%)，導致系統無法創建新目錄和文件。</p><p><strong>問題原因：</strong></p><blockquote><p>/data/cache目錄中存在數量非常多的小字節緩存文件，佔用的Block不多，但是佔用了大量的inode。</p></blockquote><pre>[root@localhost mytest] # df -i </pre><blockquote><p>文件系統 Inode 已用(I) 可用(I) 已用(I)% 掛載點</p><p>/dev/sda3 5242880 5242880 0 100% /</p></blockquote><h1>解決方案</h1><p><strong>第一種方案：</strong></p><p>刪除/data/cache目錄中的部分文件，釋放出/data分區的一部分inode。</p><p><strong>第二種方案 :</strong></p><p>在/data備份好一些文件，然後刪除這些文件，釋放一些inode，然後創建一個文件夾/data/cache2。在cache2下掛載一個新分區： sda4 ，下次寫數據需要寫到新分區cache2目錄下。</p><p>inode分區完後，是不可以再增加的, inode總數是在格式化時定下來。</p><pre>[root@localhost mytest] # mkfs.ext4 -I 500000000000 /dev/sda1 #可以指定大小</pre><blockquote><p>參數：</p><p>[-i bytes-per-inode] [-I inode-size]</p></blockquote><div class=pgc-img><img alt=深入理解Linux磁盤文件系統之inode詳解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/dbfe8019947443b799e2ecdff783f3d4><p class=pgc-img-caption></p></div><h1>擴展</h1><p><strong>inode的特殊作用</strong></p><p>由於inode號碼與文件名分離，這種機制導致了一些Unix/Linux系統特有的現象。</p><blockquote><p>1. 有時，文件名包含特殊字符，無法正常刪除。這時，直接刪除inode節點，就能起到刪除文件的作用。</p><p>2. 移動文件或重命名文件，只是改變文件名，不影響inode號碼。</p><p>3. 打開一個文件以後，系統就以inode號碼來識別這個文件，不再考慮文件名。</p></blockquote><p>因此，通常來說，系統無法從inode號碼得知文件名。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Linux</a></li><li><a>磁盤</a></li><li><a>系統</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/789611b.html alt="Linux 的磁盤系統，和你瞭解的Windows差別很大" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/9529da833a0a4f1c891cd9fc6187e6ef style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/789611b.html title="Linux 的磁盤系統，和你瞭解的Windows差別很大">Linux 的磁盤系統，和你瞭解的Windows差別很大</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/41696f9.html alt="Linux系統 磁盤的基本介紹" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/565977bd-6a76-49e8-a8ca-3d4b08d14539 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/41696f9.html title="Linux系統 磁盤的基本介紹">Linux系統 磁盤的基本介紹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bcacd8fd.html alt=Linux系統——用戶、用戶組、權限和文件屬性 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bcacd8fd.html title=Linux系統——用戶、用戶組、權限和文件屬性>Linux系統——用戶、用戶組、權限和文件屬性</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6b48b90b.html alt=Linux系統常用命令大全 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6b48b90b.html title=Linux系統常用命令大全>Linux系統常用命令大全</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d39b51ac.html alt=Linux操作系統存儲子系統核心技術之硬盤與RAID class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/12a0a3d09fd54be3b2087a5d45b798b6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d39b51ac.html title=Linux操作系統存儲子系統核心技術之硬盤與RAID>Linux操作系統存儲子系統核心技術之硬盤與RAID</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/59993286.html alt="Linux 文件系統介紹" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/50a30000b2bb9135b878 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/59993286.html title="Linux 文件系統介紹">Linux 文件系統介紹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8024f20c.html alt="Linux 文件系統剖析" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7ea491ff1de847568632e723367af267 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8024f20c.html title="Linux 文件系統剖析">Linux 文件系統剖析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/13a20156.html alt=Linux文件系統101 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/184733a1b935442eaf00466d218e78af style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/13a20156.html title=Linux文件系統101>Linux文件系統101</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1d5836cb.html alt=Linux文件系統介紹：Ext、XFS、Btrfs等，選擇適合自己的文件系統 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/988b5ddedbeb42e8ae01b11a525ff754 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1d5836cb.html title=Linux文件系統介紹：Ext、XFS、Btrfs等，選擇適合自己的文件系統>Linux文件系統介紹：Ext、XFS、Btrfs等，選擇適合自己的文件系統</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/198ca4e7.html alt=Linux文件系統概念解釋 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/153dc1ea3f434fef9762d98d4d308380 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/198ca4e7.html title=Linux文件系統概念解釋>Linux文件系統概念解釋</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/11002b4c.html alt=Linux文件系統目錄標準介紹（FHS） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5fcf0579209e4a4794121746fe9b8ddc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/11002b4c.html title=Linux文件系統目錄標準介紹（FHS）>Linux文件系統目錄標準介紹（FHS）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b2909f2b.html alt=Linux文件系統與目錄結構 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b2909f2b.html title=Linux文件系統與目錄結構>Linux文件系統與目錄結構</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/10be8693.html alt=一篇文章講清Linux操作系統的目錄結構 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/64f85cc0fcc548d99f56bd2567c34511 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/10be8693.html title=一篇文章講清Linux操作系統的目錄結構>一篇文章講清Linux操作系統的目錄結構</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4717b88a.html alt=嵌入式開發之Linux系統中文件和目錄相關命令 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1d8b5c2d75ba4ed5a0cc99267cb18c73 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4717b88a.html title=嵌入式開發之Linux系統中文件和目錄相關命令>嵌入式開發之Linux系統中文件和目錄相關命令</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fd75dea8.html alt="系統瞭解 Linux 文件系統" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/3b15000077fa0e231516 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fd75dea8.html title="系統瞭解 Linux 文件系統">系統瞭解 Linux 文件系統</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>