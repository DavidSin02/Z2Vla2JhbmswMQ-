<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>æ¯é€±ä¸€å€‹ Python æ¨¡å¡Š | socket | æå®¢å¿«è¨Š</title><meta property="og:title" content="æ¯é€±ä¸€å€‹ Python æ¨¡å¡Š | socket - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/dfic-imagehandler/5276b6c4-ac34-470d-b72c-8f2e22a6ac3e"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4194d1c.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4194d1c.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4194d1c.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4194d1c.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4194d1c.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4194d1c.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4194d1c.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4194d1c.html><meta property="article:published_time" content="2020-10-29T21:04:30+08:00"><meta property="article:modified_time" content="2020-10-29T21:04:30+08:00"><meta name=Keywords content><meta name=description content="æ¯é€±ä¸€å€‹ Python æ¨¡å¡Š | socket"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/4194d1c.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>æ¯é€±ä¸€å€‹ Python æ¨¡å¡Š | socket</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div class=pgc-img><img alt="æ¯é€±ä¸€å€‹ Python æ¨¡å¡Š | socket" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/5276b6c4-ac34-470d-b72c-8f2e22a6ac3e><p class=pgc-img-caption></p></div><p>Socket æä¾›äº†æ¨™æº–çš„ BSD Socket APIï¼Œä»¥ä¾¿ä½¿ç”¨ BSD å¥—æ¥å­—æ¥å£é€šéç¶²çµ¡é€²è¡Œé€šä¿¡ã€‚å®ƒåŒ…æ‹¬ç”¨æ–¼è™•ç†å¯¦éš›æ•¸æ“šé€šé“çš„é¡ï¼Œé‚„åŒ…æ‹¬èˆ‡ç¶²çµ¡ç›¸é—œçš„åŠŸèƒ½ï¼Œä¾‹å¦‚å°‡æœå‹™å™¨çš„åç¨±è½‰æ›ç‚ºåœ°å€ä»¥åŠæ ¼å¼åŒ–è¦é€šéç¶²çµ¡ç™¼é€çš„æ•¸æ“šã€‚</p><p>å°‹å€ã€å”è­°æ—å’Œå¥—æ¥å­—é¡å‹</p><p>socket æ˜¯ç”±ç¨‹åºç”¨ä¾†å‚³éæ•¸æ“šæˆ–é€šéäº’è¯ç¶²é€šä¿¡çš„ä¿¡é“çš„ä¸€å€‹ç«¯é»ã€‚å¥—æ¥å­—æœ‰å…©å€‹ä¸»è¦å±¬æ€§ä¾†æ§åˆ¶å®ƒå€‘ç™¼é€æ•¸æ“šçš„æ–¹å¼ï¼š åœ°å€æ—æ§åˆ¶æ‰€ä½¿ç”¨çš„ OSI ç¶²çµ¡å±¤å”è­°ï¼Œ ä»¥åŠå¥—æ¥å­—é¡å‹æ§åˆ¶å‚³è¼¸å±¤å”è­°ã€‚</p><p>Python æ”¯æŒä¸‰ç¨®åœ°å€æ—ã€‚æœ€å¸¸è¦‹çš„æ˜¯ AF_INETï¼Œç”¨æ–¼ IPv4 ç¶²çµ¡å°‹å€ã€‚IPv4 åœ°å€é•·åº¦ç‚ºå››å€‹å­—ç¯€ï¼Œé€šå¸¸è¡¨ç¤ºç‚ºå››å€‹æ•¸å­—çš„åºåˆ—ï¼Œæ¯å…«å­—ç¯€ä¸€å€‹ï¼Œç”¨é»åˆ†éš”ï¼ˆä¾‹å¦‚ï¼Œ10.1.1.5å’Œ127.0.0.1ï¼‰ã€‚é€™äº›å€¼é€šå¸¸è¢«ç¨±ç‚º IP åœ°å€ã€‚</p><p>AF_INET6ç”¨æ–¼IPv6 ç¶²çµ¡å°‹å€ã€‚IPv6 æ˜¯ç¶²çµ¡å”è­°çš„ä¸‹ä¸€ä»£ç‰ˆæœ¬ï¼Œæ”¯æŒ IPv4 ä¸‹ä¸å¯ç”¨çš„ 128 ä½åœ°å€ï¼Œæµé‡æ•´å‹å’Œè·¯ç”±åŠŸèƒ½ã€‚IPv6 çš„æ¡ç”¨ç‡æŒçºŒå¢é•·ï¼Œç‰¹åˆ¥æ˜¯éš¨è‘—é›²è¨ˆç®—çš„ç™¼å±•ï¼Œä»¥åŠç”±æ–¼ç‰©è¯ç¶²é …ç›®è€Œæ·»åŠ åˆ°ç¶²çµ¡ä¸­çš„é¡å¤–è¨­å‚™çš„æ¿€å¢ã€‚</p><p>AF_UNIXæ˜¯ Unix åŸŸå¥—æ¥å­—ï¼ˆUDSï¼‰çš„åœ°å€æ—ï¼Œå®ƒæ˜¯ POSIX å…¼å®¹ç³»çµ±ä¸Šå¯ç”¨çš„é€²ç¨‹é–“é€šä¿¡å”è­°ã€‚UDS çš„å¯¦ç¾å…è¨±æ“ä½œç³»çµ±å°‡æ•¸æ“šç›´æ¥å¾ä¸€å€‹é€²ç¨‹å‚³éåˆ°å¦ä¸€å€‹é€²ç¨‹ï¼Œè€Œç„¡éœ€é€šéç¶²çµ¡å †æ£§ã€‚é€™æ¯”ä½¿ç”¨ AF_INET æ›´é«˜æ•ˆï¼Œä½†ç”±æ–¼æ–‡ä»¶ç³»çµ±ç”¨ä½œå°‹å€çš„å‘½åç©ºé–“ï¼Œå› æ­¤ UDS åƒ…é™æ–¼åŒä¸€ç³»çµ±ä¸Šçš„é€²ç¨‹ã€‚ä½¿ç”¨ UDS è€Œä¸æ˜¯å…¶ä»– IPC æ©Ÿåˆ¶ï¼ˆå¦‚å‘½åç®¡é“æˆ–å…±äº«å…§å­˜ï¼‰çš„å¸å¼•åŠ›åœ¨æ–¼ç·¨ç¨‹æ¥å£èˆ‡ IP ç¶²çµ¡ç›¸åŒï¼Œå› æ­¤æ‡‰ç”¨ç¨‹åºå¯ä»¥åœ¨å–®å€‹ä¸»æ©Ÿä¸Šé‹è¡Œæ™‚é«˜æ•ˆé€šä¿¡ã€‚</p><p>æ³¨æ„ï¼šAF_UNIXå¸¸é‡åƒ…å®šç¾©åœ¨æ”¯æŒ UDS çš„ç³»çµ±ä¸Šã€‚</p><p>å¥—æ¥å­—é¡å‹é€šå¸¸ç”¨ SOCK_DGRAM è™•ç†é¢å‘æ¶ˆæ¯çš„æ•¸æ“šå ±å‚³è¼¸ï¼Œç”¨ SOCK_STREAM è™•ç†é¢å‘å­—ç¯€æµçš„å‚³è¼¸ã€‚æ•¸æ“šå ±å¥—æ¥å­—é€šå¸¸èˆ‡ UDPï¼ˆç”¨æˆ¶æ•¸æ“šå ±å”è­°ï¼‰ç›¸é—œè¯ ï¼Œå®ƒå€‘æä¾›ä¸å¯é çš„å–®å€‹æ¶ˆæ¯å‚³éã€‚é¢å‘æµçš„å¥—æ¥å­—èˆ‡ TCPï¼ˆå‚³è¼¸æ§åˆ¶å”è­°ï¼‰ç›¸é—œè¯ ã€‚å®ƒå€‘åœ¨å®¢æˆ¶ç«¯å’Œæœå‹™å™¨ä¹‹é–“æä¾›å­—ç¯€æµï¼Œé€šéè¶…æ™‚ç®¡ç†ï¼Œé‡å‚³å’Œå…¶ä»–åŠŸèƒ½ç¢ºä¿æ¶ˆæ¯å‚³éæˆ–æ•…éšœé€šçŸ¥ã€‚</p><p>å¤§å¤šæ•¸æä¾›å¤§é‡æ•¸æ“šçš„æ‡‰ç”¨ç¨‹åºå”è­°ï¼ˆå¦‚ HTTPï¼‰éƒ½æ˜¯åŸºæ–¼ TCP æ§‹å»ºçš„ï¼Œå› ç‚ºå®ƒå¯ä»¥åœ¨è‡ªå‹•è™•ç†æ¶ˆæ¯æ’åºå’Œå‚³éæ™‚æ›´è¼•é¬†åœ°å‰µå»ºè¤‡é›œçš„æ‡‰ç”¨ç¨‹åºã€‚UDP é€šå¸¸ç”¨æ–¼æ¶ˆæ¯ä¸å¤ªé‡è¦çš„å”è­°ï¼ˆä¾‹å¦‚é€šé DNS æŸ¥æ‰¾åç¨±ï¼‰ï¼Œæˆ–è€…ç”¨æ–¼å¤šæ’­ï¼ˆå°‡ç›¸åŒæ•¸æ“šç™¼é€åˆ°å¤šå€‹ä¸»æ©Ÿï¼‰ã€‚UDP å’Œ TCP éƒ½å¯ä»¥èˆ‡ IPv4 æˆ– IPv6 å°‹å€ä¸€èµ·ä½¿ç”¨ã€‚</p><p>æ³¨æ„ï¼šPython çš„socketæ¨¡å¡Šé‚„æ”¯æŒå…¶ä»–å¥—æ¥å­—é¡å‹ï¼Œä½†ä¸å¤ªå¸¸ç”¨ï¼Œå› æ­¤é€™è£¡ä¸åšä»‹ç´¹ã€‚æœ‰é—œæ›´å¤šè©³ç´°ä¿¡æ¯ï¼Œè«‹åƒé–±æ¨™æº–åº«æ–‡æª”ã€‚</p><p>åœ¨ç¶²çµ¡ä¸ŠæŸ¥æ‰¾ä¸»æ©Ÿ</p><p>socket åŒ…å«èˆ‡ç¶²çµ¡åŸŸåæœå‹™æ¥å£ç›¸é—œçš„åŠŸèƒ½ï¼Œå› æ­¤ç¨‹åºå¯ä»¥å°‡æœå‹™å™¨ä¸»æ©Ÿåè½‰æ›ç‚ºå…¶æ•¸å­—ç¶²çµ¡åœ°å€ã€‚é›–ç„¶ç¨‹åºåœ¨ä½¿ç”¨å®ƒå€‘é€£æ¥æœå‹™å™¨ä¹‹å‰ä¸éœ€è¦é¡¯å¼è½‰æ›åœ°å€ï¼Œä½†åœ¨å ±éŒ¯æ™‚ï¼ŒåŒ…å«æ•¸å­—åœ°å€ä»¥åŠä½¿ç”¨çš„åç¨±æœƒå¾ˆæœ‰ç”¨ã€‚</p><p>è¦æŸ¥æ‰¾ç•¶å‰ä¸»æ©Ÿçš„æ­£å¼åç¨±ï¼Œå¯ä»¥ä½¿ç”¨ gethostname()ã€‚</p><pre>import socketprint(socket.gethostname())	# apu.hellfly.net</pre><p>è¿”å›çš„åç¨±å–æ±ºæ–¼ç•¶å‰ç³»çµ±çš„ç¶²çµ¡è¨­ç½®ï¼Œå¦‚æœä½æ–¼ä¸åŒçš„ç¶²çµ¡ï¼ˆä¾‹å¦‚é€£æ¥åˆ°ç„¡ç·š LAN çš„ç­†è¨˜æœ¬é›»è…¦ï¼‰ï¼Œå‰‡å¯èƒ½æœƒæ›´æ”¹ã€‚</p><p>ä½¿ç”¨ gethostbyname() å°‡æœå‹™å™¨åç¨±è½‰æ›ç‚ºå®ƒçš„æ•¸å­—åœ°å€ã€‚</p><pre>import socketHOSTS = [ 'apu', 'pymotw.com', 'www.python.org', 'nosuchname',]for host in HOSTS: try: print('{} : {}'.format(host, socket.gethostbyname(host))) except socket.error as msg: print('{} : {}'.format(host, msg)) # output# apu : 10.9.0.10# pymotw.com : 66.33.211.242# www.python.org : 151.101.32.223# nosuchname : [Errno 8] nodename nor servname provided, or not known</pre><p>å¦‚æœç•¶å‰ç³»çµ±çš„ DNS é…ç½®åœ¨æœç´¢ä¸­åŒ…å«ä¸€å€‹æˆ–å¤šå€‹åŸŸï¼Œå‰‡ name åƒæ•¸ä¸å¿…è¦æ˜¯å®Œæ•´çš„åç¨±ï¼ˆå³ï¼Œå®ƒä¸éœ€è¦åŒ…æ‹¬åŸŸåä»¥åŠåŸºæœ¬ä¸»æ©Ÿåï¼‰ã€‚å¦‚æœæ‰¾ä¸åˆ°è©²åç¨±ï¼Œå‰‡æœƒå¼•ç™¼ socket.error é¡å‹ç•°å¸¸ã€‚</p><p>è¦è¨ªå•æœå‹™å™¨çš„æ›´å¤šå‘½åä¿¡æ¯ï¼Œè«‹ä½¿ç”¨ gethostbyname_ex()ã€‚å®ƒè¿”å›æœå‹™å™¨çš„è¦ç¯„ä¸»æ©Ÿåï¼Œåˆ¥åä»¥åŠå¯ç”¨æ–¼è¨ªå•å®ƒçš„æ‰€æœ‰å¯ç”¨ IP åœ°å€ã€‚</p><pre>import socketHOSTS = [ 'apu', 'pymotw.com', 'www.python.org', 'nosuchname',]for host in HOSTS: print(host) try: name, aliases, addresses = socket.gethostbyname_ex(host) print(' Hostname:', name) print(' Aliases :', aliases) print(' Addresses:', addresses) except socket.error as msg: print('ERROR:', msg) print() # output# apu# Hostname: apu.hellfly.net# Aliases : ['apu']# Addresses: ['10.9.0.10']# # pymotw.com# Hostname: pymotw.com# Aliases : []# Addresses: ['66.33.211.242']# # www.python.org# Hostname: prod.python.map.fastlylb.net# Aliases : ['www.python.org', 'python.map.fastly.net']# Addresses: ['151.101.32.223']# # nosuchname# ERROR: [Errno 8] nodename nor servname provided, or not known</pre><p>æ“æœ‰æœå‹™å™¨çš„æ‰€æœ‰å·²çŸ¥ IP åœ°å€å¾Œï¼Œå®¢æˆ¶ç«¯å¯ä»¥å¯¦ç¾è‡ªå·±çš„è² è¼‰å‡è¡¡æˆ–æ•…éšœè½‰ç§»ç®—æ³•ã€‚</p><p>ä½¿ç”¨getfqdn() å°‡éƒ¨åˆ†åç¨±è½‰æ›ç‚ºä¸€å€‹å®Œæ•´çš„åŸŸåã€‚</p><pre>import socketfor host in ['apu', 'pymotw.com']: print('{:&gt;10} : {}'.format(host, socket.getfqdn(host))) # output# apu : apu.hellfly.net# pymotw.com : apache2-echo.catalina.dreamhost.com</pre><p>å¦‚æœè¼¸å…¥æ˜¯åˆ¥åï¼Œå‰‡è¿”å›çš„åç¨±ä¸ä¸€å®šèˆ‡è¼¸å…¥åƒæ•¸åŒ¹é…ï¼Œä¾‹å¦‚æ­¤è™•çš„ wwwã€‚</p><p>ç•¶æœå‹™å™¨åœ°å€å¯ç”¨æ™‚ï¼Œä½¿ç”¨gethostbyaddr() å°åç¨±åŸ·è¡Œâ€œåå‘â€æŸ¥æ‰¾ã€‚</p><pre>import sockethostname, aliases, addresses = socket.gethostbyaddr('10.9.0.10')print('Hostname :', hostname)	# Hostname : apu.hellfly.netprint('Aliases :', aliases)	# Aliases : ['apu']print('Addresses:', addresses)	# Addresses: ['10.9.0.10']</pre><p>è¿”å›å€¼æ˜¯ä¸€å€‹å…ƒçµ„ï¼ŒåŒ…å«å®Œæ•´ä¸»æ©Ÿåï¼Œåˆ¥åä»¥åŠèˆ‡è©²åç¨±é—œè¯çš„æ‰€æœ‰ IP åœ°å€ã€‚</p><p>æŸ¥æ‰¾æœå‹™ä¿¡æ¯</p><p>é™¤ IP åœ°å€å¤–ï¼Œæ¯å€‹å¥—æ¥å­—åœ°å€é‚„åŒ…æ‹¬ä¸€å€‹æ•´æ•¸ç«¯å£è™Ÿã€‚è¨±å¤šæ‡‰ç”¨ç¨‹åºå¯ä»¥åœ¨åŒä¸€ä¸»æ©Ÿä¸Šé‹è¡Œï¼Œç›£è½å–®å€‹ IP åœ°å€ï¼Œä½†ä¸€æ¬¡åªèƒ½æœ‰ä¸€å€‹å¥—æ¥å­—å¯ä»¥ä½¿ç”¨è©²åœ°å€çš„ç«¯å£ã€‚IP åœ°å€ï¼Œå”è­°å’Œç«¯å£è™Ÿçš„çµ„åˆå”¯ä¸€åœ°æ¨™è­˜é€šä¿¡ä¿¡é“ï¼Œä¸¦ç¢ºä¿é€šéå¥—æ¥å­—ç™¼é€çš„æ¶ˆæ¯åˆ°é”æ­£ç¢ºçš„ç›®çš„åœ°ã€‚</p><p>æŸäº›ç«¯å£è™Ÿæ˜¯ç‚ºç‰¹å®šå”è­°é å…ˆåˆ†é…çš„ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ SMTP çš„é›»å­éƒµä»¶æœå‹™å™¨ä¹‹é–“çš„é€šä¿¡ï¼Œä½¿ç”¨ TCP åœ¨ç«¯å£è™Ÿ 25 ä¸Šé€²è¡Œï¼Œè€Œ Web å®¢æˆ¶ç«¯å’Œæœå‹™å™¨ä½¿ç”¨ç«¯å£ 80 é€²è¡Œ HTTP é€šä¿¡ã€‚å¯ä»¥ä½¿ç”¨ getservbyname() æŸ¥æ‰¾å…·æœ‰æ¨™æº–åŒ–åç¨±çš„ç¶²çµ¡æœå‹™çš„ç«¯å£è™Ÿã€‚</p><pre>import socketfrom urllib.parse import urlparseURLS = [ 'http://www.python.org', 'https://www.mybank.com', 'ftp://prep.ai.mit.edu', 'gopher://gopher.micro.umn.edu', 'smtp://mail.example.com', 'imap://mail.example.com', 'imaps://mail.example.com', 'pop3://pop.example.com', 'pop3s://pop.example.com',]for url in URLS: parsed_url = urlparse(url) port = socket.getservbyname(parsed_url.scheme) print('{:&gt;6} : {}'.format(parsed_url.scheme, port)) # output# http : 80# https : 443# ftp : 21# gopher : 70# smtp : 25# imap : 143# imaps : 993# pop3 : 110# pop3s : 995</pre><p>é›–ç„¶æ¨™æº–åŒ–æœå‹™ä¸å¤ªå¯èƒ½æ”¹è®Šç«¯å£ï¼Œä½†æ˜¯åœ¨æœªä¾†æ·»åŠ æ–°æœå‹™æ™‚ï¼Œé€šéç³»çµ±èª¿ç”¨ä¾†æŸ¥æ‰¾è€Œä¸æ˜¯ç¡¬ç·¨ç¢¼æœƒæ›´éˆæ´»ã€‚</p><p>è¦åè½‰æœå‹™ç«¯å£æŸ¥æ‰¾ï¼Œä½¿ç”¨getservbyport()ã€‚</p><pre>import socketfrom urllib.parse import urlunparsefor port in [80, 443, 21, 70, 25, 143, 993, 110, 995]: url = '{}://example.com/'.format(socket.getservbyport(port)) print(url) # output# http://example.com/# https://example.com/# ftp://example.com/# gopher://example.com/# smtp://example.com/# imap://example.com/# imaps://example.com/# pop3://example.com/# pop3s://example.com/</pre><p>åå‘æŸ¥æ‰¾å°æ–¼å¾ä»»æ„åœ°å€æ§‹é€ æœå‹™çš„ URL éå¸¸æœ‰ç”¨ã€‚</p><p>å¯ä»¥ä½¿ç”¨ getprotobyname() æª¢ç´¢åˆ†é…çµ¦å‚³è¼¸å”è­°çš„ç·¨è™Ÿã€‚</p><pre>import socketdef get_constants(prefix): """Create a dictionary mapping socket module constants to their names. """ return { getattr(socket, n): n for n in dir(socket) if n.startswith(prefix) }protocols = get_constants('IPPROTO_')for name in ['icmp', 'udp', 'tcp']: proto_num = socket.getprotobyname(name) const_name = protocols[proto_num] print('{:&gt;4} -&gt; {:2d} (socket.{:&lt;12} = {:2d})'.format( name, proto_num, const_name, getattr(socket, const_name))) # output# icmp -&gt; 1 (socket.IPPROTO_ICMP = 1)# udp -&gt; 17 (socket.IPPROTO_UDP = 17)# tcp -&gt; 6 (socket.IPPROTO_TCP = 6)</pre><p>å”è­°è™Ÿçš„å€¼æ˜¯æ¨™æº–åŒ–çš„ï¼Œç”¨å‰ç¶´ IPPROTO_ å®šç¾©ç‚ºå¸¸é‡ã€‚</p><p>æŸ¥æ‰¾æœå‹™å™¨åœ°å€</p><p>getaddrinfo() å°‡æœå‹™çš„åŸºæœ¬åœ°å€è½‰æ›ç‚ºå…ƒçµ„åˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«å»ºç«‹é€£æ¥æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚æ¯å€‹å…ƒçµ„çš„å…§å®¹æœƒæœ‰æ‰€ä¸åŒï¼ŒåŒ…å«ä¸åŒçš„ç¶²çµ¡åœ°å€æ—æˆ–å”è­°ã€‚</p><pre>import socketdef get_constants(prefix): """Create a dictionary mapping socket module constants to their names. """ return { getattr(socket, n): n for n in dir(socket) if n.startswith(prefix) }families = get_constants('AF_')types = get_constants('SOCK_')protocols = get_constants('IPPROTO_')for response in socket.getaddrinfo('www.python.org', 'http'): # Unpack the response tuple family, socktype, proto, canonname, sockaddr = response print('Family :', families[family]) print('Type :', types[socktype]) print('Protocol :', protocols[proto]) print('Canonical name:', canonname) print('Socket address:', sockaddr) print() # output# Family : AF_INET# Type : SOCK_DGRAM# Protocol : IPPROTO_UDP# Canonical name:# Socket address: ('151.101.32.223', 80)# # Family : AF_INET# Type : SOCK_STREAM# Protocol : IPPROTO_TCP# Canonical name:# Socket address: ('151.101.32.223', 80)# # Family : AF_INET6# Type : SOCK_DGRAM# Protocol : IPPROTO_UDP# Canonical name:# Socket address: ('2a04:4e42:8::223', 80, 0, 0)# # Family : AF_INET6# Type : SOCK_STREAM# Protocol : IPPROTO_TCP# Canonical name:# Socket address: ('2a04:4e42:8::223', 80, 0, 0)</pre><p>è©²ç¨‹åºæ¼”ç¤ºç­å¦‚ä½•æŸ¥æ‰¾ www.python.org çš„é€£æ¥ä¿¡æ¯ã€‚</p><p>getaddrinfo()æ¡ç”¨å¹¾å€‹åƒæ•¸ä¾†éæ¿¾çµæœåˆ—è¡¨ã€‚hostå’Œportæ˜¯å¿…å‚³åƒæ•¸ã€‚å¯é¸çš„åƒæ•¸æ˜¯familyï¼Œ socktypeï¼Œprotoï¼Œå’Œflagsã€‚å¯é¸å€¼æ‡‰è©²æ˜¯0æˆ–ç”± socket å®šç¾©çš„å¸¸é‡ä¹‹ä¸€ã€‚</p><pre>import socketdef get_constants(prefix): """Create a dictionary mapping socket module constants to their names. """ return { getattr(socket, n): n for n in dir(socket) if n.startswith(prefix) }families = get_constants('AF_')types = get_constants('SOCK_')protocols = get_constants('IPPROTO_')responses = socket.getaddrinfo( host='www.python.org', port='http', family=socket.AF_INET, type=socket.SOCK_STREAM, proto=socket.IPPROTO_TCP, flags=socket.AI_CANONNAME,)for response in responses: # Unpack the response tuple family, socktype, proto, canonname, sockaddr = response print('Family :', families[family]) print('Type :', types[socktype]) print('Protocol :', protocols[proto]) print('Canonical name:', canonname) print('Socket address:', sockaddr) print() # output# Family : AF_INET# Type : SOCK_STREAM# Protocol : IPPROTO_TCP# Canonical name: prod.python.map.fastlylb.net# Socket address: ('151.101.32.223', 80)</pre><p>ç”±æ–¼flagsåŒ…å«AI_CANONNAMEï¼Œæœå‹™å™¨çš„è¦ç¯„åç¨±ï¼ˆå¯èƒ½èˆ‡ä¸»æ©Ÿå…·æœ‰åˆ¥åæ™‚ç”¨æ–¼æŸ¥æ‰¾çš„å€¼ä¸åŒï¼‰åŒ…å«åœ¨çµæœä¸­ã€‚å¦‚æœæ²’æœ‰è©²æ¨™èªŒï¼Œå‰‡è¦ç¯„åç¨±å°‡ä¿ç•™ç‚ºç©ºã€‚</p><p>IP åœ°å€è¡¨ç¤º</p><p>ç”¨ C ç·¨å¯«çš„ç¶²çµ¡ç¨‹åºä½¿ç”¨æ•¸æ“šé¡å‹å°‡ IP åœ°å€è¡¨ç¤ºç‚ºäºŒé€²åˆ¶å€¼ï¼ˆè€Œä¸æ˜¯é€šå¸¸åœ¨ Python ç¨‹åºä¸­çš„å­—ç¬¦ä¸²åœ°å€ï¼‰ã€‚è¦åœ¨ Python è¡¨ç¤ºå’Œ C è¡¨ç¤ºä¹‹é–“è½‰æ› IPv4 åœ°å€ï¼Œè«‹ä½¿ç”¨structsockaddrã€inet_aton() å’Œ inet_ntoa()ã€‚</p><pre>import binasciiimport socketimport structimport sysfor string_address in ['192.168.1.1', '127.0.0.1']: packed = socket.inet_aton(string_address) print('Original:', string_address) print('Packed :', binascii.hexlify(packed)) print('Unpacked:', socket.inet_ntoa(packed)) print() # output# Original: 192.168.1.1# Packed : b'c0a80101'# Unpacked: 192.168.1.1# # Original: 127.0.0.1# Packed : b'7f000001'# Unpacked: 127.0.0.1</pre><p>æ‰“åŒ…æ ¼å¼ä¸­çš„å››å€‹å­—ç¯€å¯ä»¥å‚³éçµ¦ C åº«ï¼Œé€šéç¶²çµ¡å®‰å…¨å‚³è¼¸ï¼Œæˆ–è€…ç·Šæ¹Šåœ°ä¿å­˜åˆ°æ•¸æ“šåº«ä¸­ã€‚</p><p>ç›¸é—œå‡½æ•¸ inet_pton() å’Œ inet_ntop() æ”¯æŒ IPv4 å’Œ IPv6ï¼Œæ ¹æ“šå‚³å…¥çš„åœ°å€æ—åƒæ•¸ç”Ÿæˆé©ç•¶çš„æ ¼å¼ã€‚</p><pre>import binasciiimport socketimport structimport sysstring_address = '2002:ac10:10a:1234:21e:52ff:fe74:40e'packed = socket.inet_pton(socket.AF_INET6, string_address)print('Original:', string_address)print('Packed :', binascii.hexlify(packed))print('Unpacked:', socket.inet_ntop(socket.AF_INET6, packed))# output# Original: 2002:ac10:10a:1234:21e:52ff:fe74:40e# Packed : b'2002ac10010a1234021e52fffe74040e'# Unpacked: 2002:ac10:10a:1234:21e:52ff:fe74:40e</pre><p>IPv6 åœ°å€å·²ç¶“æ˜¯åå…­é€²åˆ¶å€¼ï¼Œå› æ­¤å°‡æ‰“åŒ…ç‰ˆæœ¬è½‰æ›ç‚ºä¸€ç³»åˆ—åå…­é€²åˆ¶æ•¸å­—æœƒç”Ÿæˆé¡ä¼¼æ–¼åŸå§‹å€¼çš„å­—ç¬¦ä¸²ã€‚</p><p>TCP/IP å®¢æˆ¶ç«¯å’Œæœå‹™ç«¯</p><p>Sockets å¯ä»¥ä½œç‚ºæœå‹™ç«¯ä¸¦ç›£è½å‚³å…¥æ¶ˆæ¯ï¼Œæˆ–ä½œç‚ºå®¢æˆ¶ç«¯é€£æ¥å…¶ä»–æ‡‰ç”¨ç¨‹åºã€‚é€£æ¥ TCP/IP å¥—æ¥å­—çš„å…©ç«¯å¾Œï¼Œé€šä¿¡æ˜¯é›™å‘çš„ã€‚</p><p>æœå‹™ç«¯</p><p>æ­¤ç¤ºä¾‹ç¨‹åºåŸºæ–¼æ¨™æº–åº«æ–‡æª”ä¸­çš„ç¤ºä¾‹ç¨‹åºï¼Œæ¥æ”¶å‚³å…¥çš„æ¶ˆæ¯ä¸¦å°‡å®ƒå€‘å›é€çµ¦ç™¼é€æ–¹ã€‚å®ƒé¦–å…ˆå‰µå»ºä¸€å€‹ TCP/IP å¥—æ¥å­—ï¼Œç„¶å¾Œç”¨ bind() å°‡å¥—æ¥å­—èˆ‡æœå‹™å™¨åœ°å€ç›¸é—œè¯ã€‚åœ°å€æ˜¯localhostæŒ‡ç•¶å‰æœå‹™å™¨ï¼Œç«¯å£è™Ÿæ˜¯ 10000ã€‚</p><pre># socket_echo_server.pyimport socketimport sys# Create a TCP/IP socketsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# Bind the socket to the portserver_address = ('localhost', 10000)print('starting up on {} port {}'.format(*server_address))sock.bind(server_address)# Listen for incoming connectionssock.listen(1)while True: # Wait for a connection print('waiting for a connection') connection, client_address = sock.accept() try: print('connection from', client_address) # Receive the data in small chunks and retransmit it while True: data = connection.recv(16) print('received {!r}'.format(data)) if data: print('sending data back to the client') connection.sendall(data) else: print('no data from', client_address) break finally: # Clean up the connection connection.close()</pre><p>èª¿ç”¨listen()å°‡å¥—æ¥å­—ç½®æ–¼æœå‹™å™¨æ¨¡å¼ï¼Œä¸¦ç”¨ accept()ç­‰å¾…å‚³å…¥é€£æ¥ã€‚æ•´æ•¸åƒæ•¸è¡¨ç¤ºå¾Œè‡ºæ’éšŠçš„é€£æ¥æ•¸ï¼Œç•¶é€£æ¥æ•¸è¶…å‡ºæ™‚ï¼Œç³»çµ±æœƒæ‹’çµ•ã€‚æ­¤ç¤ºä¾‹åƒ…æœŸæœ›ä¸€æ¬¡ä½¿ç”¨ä¸€å€‹é€£æ¥ã€‚</p><p>accept()è¿”å›æœå‹™å™¨å’Œå®¢æˆ¶ç«¯ä¹‹é–“çš„é–‹æ”¾é€£æ¥ä»¥åŠå®¢æˆ¶ç«¯çš„åœ°å€ã€‚è©²é€£æ¥å¯¦éš›ä¸Šæ˜¯å¦ä¸€å€‹ç«¯å£ä¸Šçš„ä¸åŒå¥—æ¥å­—ï¼ˆç”±å…§æ ¸åˆ†é…ï¼‰ã€‚å¾é€£æ¥ä¸­ç”¨ recv() è®€å–æ•¸æ“šä¸¦ç”¨ sendall() å‚³è¼¸æ•¸æ“šã€‚</p><p>èˆ‡å®¢æˆ¶ç«¯é€šä¿¡å®Œæˆå¾Œï¼Œéœ€è¦ä½¿ç”¨ close() æ¸…ç†é€£æ¥ã€‚æ­¤ç¤ºä¾‹ä½¿ç”¨ try:finallyå¡Šä¾†ç¢ºä¿close()å§‹çµ‚èª¿ç”¨ï¼Œå³ä½¿å‡ºç¾éŒ¯èª¤ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>å®¢æˆ¶ç«¯</p><p>å®¢æˆ¶ç«¯ç¨‹åºçš„ socket è¨­ç½®èˆ‡æœå‹™ç«¯çš„ä¸åŒã€‚å®ƒä¸æ˜¯ç¶å®šåˆ°ç«¯å£ä¸¦ç›£è½ï¼Œè€Œæ˜¯ç”¨æ–¼connect()å°‡å¥—æ¥å­—ç›´æ¥é€£æ¥åˆ°é ç¨‹åœ°å€ã€‚</p><pre># socket_echo_client.pyimport socketimport sys# Create a TCP/IP socketsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# Connect the socket to the port where the server is listeningserver_address = ('localhost', 10000)print('connecting to {} port {}'.format(*server_address))sock.connect(server_address)try: # Send data message = b'This is the message. It will be repeated.' print('sending {!r}'.format(message)) sock.sendall(message) # Look for the response amount_received = 0 amount_expected = len(message) while amount_received &lt; amount_expected: data = sock.recv(16) amount_received += len(data) print('received {!r}'.format(data))finally: print('closing socket') sock.close()</pre><p>å»ºç«‹é€£æ¥å¾Œï¼Œæ•¸æ“šå¯ä»¥é€šé sendall() ç™¼é€ recv() æ¥æ”¶ã€‚ç™¼é€æ•´å€‹æ¶ˆæ¯ä¸¦æ”¶åˆ°åŒæ¨£çš„å›è¦†å¾Œï¼Œé—œé–‰å¥—æ¥å­—ä»¥é‡‹æ”¾ç«¯å£ã€‚</p><p>é‹è¡Œå®¢æˆ¶ç«¯å’Œæœå‹™ç«¯</p><p>å®¢æˆ¶ç«¯å’Œæœå‹™ç«¯æ‡‰è©²åœ¨å–®ç¨çš„çµ‚ç«¯çª—å£ä¸­é‹è¡Œï¼Œä»¥ä¾¿å®ƒå€‘å¯ä»¥ç›¸äº’é€šä¿¡ã€‚æœå‹™ç«¯è¼¸å‡ºé¡¯ç¤ºå‚³å…¥çš„é€£æ¥å’Œæ•¸æ“šï¼Œä»¥åŠç™¼é€å›å®¢æˆ¶ç«¯çš„éŸ¿æ‡‰ã€‚</p><pre>$ python3 socket_echo_server.pystarting up on localhost port 10000waiting for a connectionconnection from ('127.0.0.1', 65141)received b'This is the mess'sending data back to the clientreceived b'age. It will be'sending data back to the clientreceived b' repeated.'sending data back to the clientreceived b''no data from ('127.0.0.1', 65141)waiting for a connection</pre><p>å®¢æˆ¶ç«¯è¼¸å‡ºé¡¯ç¤ºå‚³å‡ºæ¶ˆæ¯å’Œä¾†è‡ªæœå‹™ç«¯çš„éŸ¿æ‡‰ã€‚</p><pre>$ python3 socket_echo_client.pyconnecting to localhost port 10000sending b'This is the message. It will be repeated.'received b'This is the mess'received b'age. It will be'received b' repeated.'closing socket</pre><p>ç°¡æ˜“å®¢æˆ¶ç«¯é€£æ¥</p><p>é€šéä½¿ç”¨ä¾¿æ·åŠŸèƒ½create_connection()é€£æ¥åˆ°æœå‹™ç«¯ï¼ŒTCP/IP å®¢æˆ¶ç«¯å¯ä»¥ç¯€çœä¸€äº›æ­¥é©Ÿ ã€‚è©²å‡½æ•¸æ¥å—ä¸€å€‹åƒæ•¸ï¼Œä¸€å€‹åŒ…å«æœå‹™å™¨åœ°å€çš„é›™å€¼å…ƒçµ„ï¼Œä¸¦æ´¾ç”Ÿå‡ºç”¨æ–¼é€£æ¥çš„æœ€ä½³åœ°å€ã€‚</p><pre>import socketimport sysdef get_constants(prefix): """Create a dictionary mapping socket module constants to their names. """ return { getattr(socket, n): n for n in dir(socket) if n.startswith(prefix) }families = get_constants('AF_')types = get_constants('SOCK_')protocols = get_constants('IPPROTO_')# Create a TCP/IP socketsock = socket.create_connection(('localhost', 10000))print('Family :', families[sock.family])print('Type :', types[sock.type])print('Protocol:', protocols[sock.proto])print()try: # Send data message = b'This is the message. It will be repeated.' print('sending {!r}'.format(message)) sock.sendall(message) amount_received = 0 amount_expected = len(message) while amount_received &lt; amount_expected: data = sock.recv(16) amount_received += len(data) print('received {!r}'.format(data))finally: print('closing socket') sock.close() # output# Family : AF_INET# Type : SOCK_STREAM# Protocol: IPPROTO_TCP# # sending b'This is the message. It will be repeated.'# received b'This is the mess'# received b'age. It will be'# received b' repeated.'# closing socket</pre><p>create_connection()ç”¨getaddrinfo() æ–¹æ³•ç²å¾—å¯é¸åƒæ•¸ï¼Œä¸¦socketä½¿ç”¨å‰µå»ºæˆåŠŸé€£æ¥çš„ç¬¬ä¸€å€‹é…ç½®è¿”å›å·²æ‰“é–‹çš„é€£æ¥åƒæ•¸ã€‚familyï¼Œtypeå’Œprotoå±¬æ€§å¯ä»¥ç”¨ä¾†æª¢æŸ¥è¿”å›çš„é¡å‹æ˜¯ socket é¡å‹ã€‚</p><p>é¸æ“‡ç›£è½åœ°å€</p><p>å°‡æœå‹™ç«¯ç¶å®šåˆ°æ­£ç¢ºçš„åœ°å€éå¸¸é‡è¦ï¼Œä»¥ä¾¿å®¢æˆ¶ç«¯å¯ä»¥èˆ‡ä¹‹é€šä¿¡ã€‚å‰é¢çš„ç¤ºä¾‹éƒ½ç”¨ 'localhost' ä½œç‚º IP åœ°å€ï¼Œä½†é€™æ¨£æœ‰ä¸€å€‹é™åˆ¶ï¼Œåªæœ‰åœ¨åŒä¸€æœå‹™å™¨ä¸Šé‹è¡Œçš„å®¢æˆ¶ç«¯æ‰èƒ½é€£æ¥ã€‚ä½¿ç”¨æœå‹™å™¨çš„å…¬å…±åœ°å€ï¼ˆä¾‹å¦‚ gethostname() çš„è¿”å›å€¼ï¼‰ä¾†å…è¨±å…¶ä»–ä¸»æ©Ÿé€²è¡Œé€£æ¥ã€‚ä¿®æ”¹ä¸Šé¢çš„ä¾‹å­ï¼Œè®“æœå‹™ç«¯ç›£è½é€šéå‘½ä»¤è¡Œåƒæ•¸æŒ‡å®šçš„åœ°å€ã€‚</p><pre># socket_echo_server_explicit.pyimport socketimport sys# Create a TCP/IP socketsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# Bind the socket to the address given on the command lineserver_name = sys.argv[1]server_address = (server_name, 10000)print('starting up on {} port {}'.format(*server_address))sock.bind(server_address)sock.listen(1)while True: print('waiting for a connection') connection, client_address = sock.accept() try: print('client connected:', client_address) while True: data = connection.recv(16) print('received {!r}'.format(data)) if data: connection.sendall(data) else: break finally: connection.close()</pre><p>å°å®¢æˆ¶ç«¯ç¨‹åºé€²è¡Œé¡ä¼¼çš„ä¿®æ”¹ã€‚</p><pre># socket_echo_client_explicit.pyimport socketimport sys# Create a TCP/IP socketsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# Connect the socket to the port on the server# given by the callerserver_address = (sys.argv[1], 10000)print('connecting to {} port {}'.format(*server_address))sock.connect(server_address)try: message = b'This is the message. It will be repeated.' print('sending {!r}'.format(message)) sock.sendall(message) amount_received = 0 amount_expected = len(message) while amount_received &lt; amount_expected: data = sock.recv(16) amount_received += len(data) print('received {!r}'.format(data))finally: sock.close()</pre><p>ä½¿ç”¨åƒæ•¸ hubert å•Ÿå‹•æœå‹™ç«¯ï¼Œ netstatå‘½ä»¤é¡¯ç¤ºå®ƒæ­£åœ¨ç›£è½æŒ‡å®šä¸»æ©Ÿçš„åœ°å€ã€‚</p><pre>$ host hubert.hellfly.nethubert.hellfly.net has address 10.9.0.6$ netstat -an | grep 10000Active Internet connections (including servers)Proto Recv-Q Send-Q Local Address Foreign Address (state)...tcp4 0 0 10.9.0.6.10000 *.* LISTEN...</pre><p>åœ¨å¦ä¸€è‡ºä¸»æ©Ÿä¸Šé‹è¡Œå®¢æˆ¶ç«¯ï¼Œhubert.hellfly.net ä½œç‚ºåƒæ•¸ï¼š</p><pre>$ hostnameapu$ python3 ./socket_echo_client_explicit.py hubert.hellfly.netconnecting to hubert.hellfly.net port 10000sending b'This is the message. It will be repeated.'received b'This is the mess'received b'age. It will be'received b' repeated.'</pre><p>æœå‹™ç«¯è¼¸å‡ºæ˜¯ï¼š</p><pre>$ python3 socket_echo_server_explicit.py hubert.hellfly.netstarting up on hubert.hellfly.net port 10000waiting for a connectionclient connected: ('10.9.0.10', 33139)received b''waiting for a connectionclient connected: ('10.9.0.10', 33140)received b'This is the mess'received b'age. It will be'received b' repeated.'received b''waiting for a connection</pre><p>è¨±å¤šæœå‹™ç«¯å…·æœ‰å¤šå€‹ç¶²çµ¡æ¥å£ï¼Œå› æ­¤ä¹Ÿæœƒæœ‰å¤šå€‹ IP åœ°å€é€£æ¥ã€‚ç‚ºæ¯å€‹ IP åœ°å€é‹è¡Œæœå‹™ç«¯è‚¯å®šæ˜¯ä¸æ˜æ™ºçš„ï¼Œå¯ä»¥ä½¿ç”¨ç‰¹æ®Šåœ°å€INADDR_ANY åŒæ™‚ç›£è½æ‰€æœ‰åœ°å€ã€‚å„˜ç®¡ socket ç‚º INADDR_ANY å®šç¾©äº†ä¸€å€‹å¸¸é‡ï¼Œä½†å®ƒæ˜¯ä¸€å€‹æ•´æ•¸ï¼Œå¿…é ˆå…ˆå°‡å…¶è½‰æ›ç‚ºé»ç¬¦è™Ÿåˆ†éš”çš„å­—ç¬¦ä¸²åœ°å€æ‰èƒ½å‚³éçµ¦ bind()ã€‚ä½œç‚ºæ›´æ–¹ä¾¿çš„æ–¹å¼ï¼Œä½¿ç”¨â€œ 0.0.0.0â€æˆ–ç©ºå­—ç¬¦ä¸²ï¼ˆ''ï¼‰å°±å¯ä»¥äº†ï¼Œè€Œä¸æ˜¯é€²è¡Œè½‰æ›ã€‚</p><pre>import socketimport sys# Create a TCP/IP socketsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# Bind the socket to the address given on the command lineserver_address = ('', 10000)sock.bind(server_address)print('starting up on {} port {}'.format(*sock.getsockname()))sock.listen(1)while True: print('waiting for a connection') connection, client_address = sock.accept() try: print('client connected:', client_address) while True: data = connection.recv(16) print('received {!r}'.format(data)) if data: connection.sendall(data) else: break finally: connection.close()</pre><p>è¦æŸ¥çœ‹å¥—æ¥å­—ä½¿ç”¨çš„å¯¦éš›åœ°å€ï¼Œå¯ä»¥ä½¿ç”¨ getsockname() æ–¹æ³•ã€‚å•Ÿå‹•æœå‹™å¾Œï¼Œå†æ¬¡é‹è¡Œ netstat æœƒé¡¯ç¤ºå®ƒæ­£åœ¨ç›£è½ä»»ä½•åœ°å€ä¸Šçš„å‚³å…¥é€£æ¥ã€‚</p><pre>$ netstat -anActive Internet connections (including servers)Proto Recv-Q Send-Q Local Address Foreign Address (state)...tcp4 0 0 *.10000 *.* LISTEN...</pre><p>ç”¨æˆ¶æ•¸æ“šå ±å®¢æˆ¶ç«¯å’Œæœå‹™ç«¯</p><p>ç”¨æˆ¶æ•¸æ“šå ±å”è­°ï¼ˆUDPï¼‰èˆ‡ TCP/IP çš„å·¥ä½œæ–¹å¼ä¸åŒã€‚TCP æ˜¯é¢å‘å­—ç¯€æµçš„ï¼Œæ‰€æœ‰æ•¸æ“šä»¥æ­£ç¢ºçš„é †åºå‚³è¼¸ï¼ŒUDP æ˜¯é¢å‘æ¶ˆæ¯çš„å”è­°ã€‚UDP ä¸éœ€è¦é•·é€£æ¥ï¼Œå› æ­¤è¨­ç½® UDP å¥—æ¥å­—æ›´ç°¡å–®ä¸€äº›ã€‚å¦ä¸€æ–¹é¢ï¼ŒUDP æ¶ˆæ¯å¿…é ˆé©åˆå–®å€‹æ•¸æ“šå ±ï¼ˆå°æ–¼ IPv4ï¼Œé€™æ„å‘³è‘—å®ƒå€‘åªèƒ½å®¹ç´ 65,507 å€‹å­—ç¯€ï¼Œå› ç‚º 65,535 å­—ç¯€çš„æ•¸æ“šåŒ…ä¹ŸåŒ…å«é ­ä¿¡æ¯ï¼‰ä¸¦ä¸”ä¸èƒ½ä¿è­‰å‚³é€èˆ‡ TCP ä¸€æ¨£å¯é ã€‚</p><p>æœå‹™ç«¯</p><p>ç”±æ–¼æ²’æœ‰é€£æ¥æœ¬èº«ï¼Œæœå‹™å™¨ä¸éœ€è¦ç›£è½å’Œæ¥æ”¶é€£æ¥ã€‚å®ƒåªéœ€è¦ bind() åœ°å€å’Œç«¯å£ï¼Œç„¶å¾Œç­‰å¾…å–®å€‹æ¶ˆæ¯ã€‚</p><pre># socket_echo_server_dgram.py import socketimport sys# Create a UDP socketsock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)# Bind the socket to the portserver_address = ('localhost', 10000)print('starting up on {} port {}'.format(*server_address))sock.bind(server_address)while True: print('\nwaiting to receive message') data, address = sock.recvfrom(4096) print('received {} bytes from {}'.format(len(data), address)) print(data) if data: sent = sock.sendto(data, address) print('sent {} bytes back to {}'.format(sent, address))</pre><p>ä½¿ç”¨ recvfrom() å¾å¥—æ¥å­—è®€å–æ¶ˆæ¯ï¼Œç„¶å¾ŒæŒ‰ç…§å®¢æˆ¶ç«¯åœ°å€è¿”å›æ•¸æ“šã€‚</p><p>å®¢æˆ¶ç«¯</p><p>UDP å®¢æˆ¶ç«¯èˆ‡æœå‹™ç«¯é¡ä¼¼ï¼Œä½†ä¸éœ€è¦ bind()ã€‚å®ƒç”¨ sendto()å°‡æ¶ˆæ¯ç›´æ¥ç™¼é€åˆ°æœå‹™ç®—ï¼Œä¸¦ç”¨ recvfrom()æ¥æ”¶éŸ¿æ‡‰ã€‚</p><pre># socket_echo_client_dgram.py import socketimport sys# Create a UDP socketsock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)server_address = ('localhost', 10000)message = b'This is the message. It will be repeated.'try: # Send data print('sending {!r}'.format(message)) sent = sock.sendto(message, server_address) # Receive response print('waiting to receive') data, server = sock.recvfrom(4096) print('received {!r}'.format(data))finally: print('closing socket') sock.close()</pre><p>é‹è¡Œå®¢æˆ¶ç«¯å’Œæœå‹™ç«¯</p><p>é‹è¡Œæœå‹™ç«¯æœƒç”¢ç”Ÿï¼š</p><pre>$ python3 socket_echo_server_dgram.pystarting up on localhost port 10000waiting to receive messagereceived 42 bytes from ('127.0.0.1', 57870)b'This is the message. It will be repeated.'sent 42 bytes back to ('127.0.0.1', 57870)waiting to receive message</pre><p>å®¢æˆ¶ç«¯è¼¸å‡ºæ˜¯ï¼š</p><pre>$ python3 socket_echo_client_dgram.pysending b'This is the message. It will be repeated.'waiting to receivereceived b'This is the message. It will be repeated.'closing socket</pre><p>Unix åŸŸå¥—æ¥å­—</p><p>å¾ç¨‹åºå“¡çš„è§’åº¦ä¾†çœ‹ï¼Œä½¿ç”¨ Unix åŸŸå¥—æ¥å­—å’Œ TCP/IP å¥—æ¥å­—æœ‰å…©å€‹æœ¬è³ªå€åˆ¥ã€‚é¦–å…ˆï¼Œå¥—æ¥å­—çš„åœ°å€æ˜¯æ–‡ä»¶ç³»çµ±ä¸Šçš„è·¯å¾‘ï¼Œè€Œä¸æ˜¯åŒ…å«æœå‹™å™¨åç¨±å’Œç«¯å£çš„å…ƒçµ„ã€‚å…¶æ¬¡ï¼Œåœ¨å¥—æ¥å­—é—œé–‰å¾Œï¼Œåœ¨æ–‡ä»¶ç³»çµ±ä¸­å‰µå»ºçš„è¡¨ç¤ºå¥—æ¥å­—çš„ç¯€é»ä»ç„¶å­˜åœ¨ï¼Œä¸¦ä¸”æ¯æ¬¡æœå‹™ç«¯å•Ÿå‹•æ™‚éƒ½éœ€è¦åˆªé™¤ã€‚é€šéåœ¨è¨­ç½®éƒ¨åˆ†é€²è¡Œä¸€äº›æ›´æ”¹ï¼Œä½¿ä¹‹å‰çš„æœå‹™ç«¯ç¨‹åºæ”¯æŒ UDSã€‚</p><p>å‰µå»º socket æ™‚ä½¿ç”¨åœ°å€æ— AF_UNIXã€‚ç¶å®šå¥—æ¥å­—å’Œç®¡ç†å‚³å…¥é€£æ¥æ–¹å¼èˆ‡ TCP/IP å¥—æ¥å­—ç›¸åŒã€‚</p><pre># socket_echo_server_uds.py import socketimport sysimport osserver_address = './uds_socket'# Make sure the socket does not already existtry: os.unlink(server_address)except OSError: if os.path.exists(server_address): raise# Create a UDS socketsock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)# Bind the socket to the addressprint('starting up on {}'.format(server_address))sock.bind(server_address)# Listen for incoming connectionssock.listen(1)while True: # Wait for a connection print('waiting for a connection') connection, client_address = sock.accept() try: print('connection from', client_address) # Receive the data in small chunks and retransmit it while True: data = connection.recv(16) print('received {!r}'.format(data)) if data: print('sending data back to the client') connection.sendall(data) else: print('no data from', client_address) break finally: # Clean up the connection connection.close()</pre><p>é‚„éœ€è¦ä¿®æ”¹å®¢æˆ¶ç«¯è¨­ç½®ä»¥ä½¿ç”¨ UDSã€‚å®ƒæ‡‰è©²å‡å®šå¥—æ¥å­—çš„æ–‡ä»¶ç³»çµ±ç¯€é»å­˜åœ¨ï¼Œå› ç‚ºæœå‹™ç«¯é€šéç¶å®šåˆ°è©²åœ°å€ä¾†å‰µå»ºå®ƒã€‚ç™¼é€å’Œæ¥æ”¶æ•¸æ“šåœ¨ UDS å®¢æˆ¶ç«¯ä¸­çš„å·¥ä½œæ–¹å¼èˆ‡ä¹‹å‰çš„ TCP/IP å®¢æˆ¶ç«¯ç›¸åŒã€‚</p><pre># socket_echo_client_uds.py import socketimport sys# Create a UDS socketsock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)# Connect the socket to the port where the server is listeningserver_address = './uds_socket'print('connecting to {}'.format(server_address))try: sock.connect(server_address)except socket.error as msg: print(msg) sys.exit(1)try: # Send data message = b'This is the message. It will be repeated.' print('sending {!r}'.format(message)) sock.sendall(message) amount_received = 0 amount_expected = len(message) while amount_received &lt; amount_expected: data = sock.recv(16) amount_received += len(data) print('received {!r}'.format(data))finally: print('closing socket') sock.close()</pre><p>ç¨‹åºè¼¸å‡ºå¤§è‡´ç›¸åŒï¼Œä¸¦å°åœ°å€ä¿¡æ¯é€²è¡Œé©ç•¶æ›´æ–°ã€‚æœå‹™ç«¯é¡¯ç¤ºæ”¶åˆ°çš„æ¶ˆæ¯ä¸¦å°‡å…¶ç™¼é€å›å®¢æˆ¶ç«¯ã€‚</p><pre>$ python3 socket_echo_server_uds.pystarting up on ./uds_socketwaiting for a connectionconnection fromreceived b'This is the mess'sending data back to the clientreceived b'age. It will be'sending data back to the clientreceived b' repeated.'sending data back to the clientreceived b''no data fromwaiting for a connection</pre><p>å®¢æˆ¶ç«¯ä¸€æ¬¡æ€§ç™¼é€æ¶ˆæ¯ï¼Œä¸¦ä»¥éå¢æ–¹å¼æ¥æ”¶éƒ¨åˆ†æ¶ˆæ¯ã€‚</p><pre>$ python3 socket_echo_client_uds.pyconnecting to ./uds_socketsending b'This is the message. It will be repeated.'received b'This is the mess'received b'age. It will be'received b' repeated.'closing socket</pre><p>æ¬Šé™</p><p>ç”±æ–¼ UDS å¥—æ¥å­—ç”±æ–‡ä»¶ç³»çµ±ä¸Šçš„ç¯€é»è¡¨ç¤ºï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨æ¨™æº–æ–‡ä»¶ç³»çµ±æ¬Šé™ä¾†æ§åˆ¶æœå‹™ç«¯çš„è¨ªå•ã€‚</p><pre>$ ls -l ./uds_socketsrwxr-xr-x 1 dhellmann dhellmann 0 Aug 21 11:19 uds_socket$ sudo chown root ./uds_socket$ ls -l ./uds_socketsrwxr-xr-x 1 root dhellmann 0 Aug 21 11:19 uds_socket</pre><p>ä»¥érootç”¨æˆ¶é‹è¡Œå®¢æˆ¶ç«¯æœƒå°è‡´éŒ¯èª¤ï¼Œå› ç‚ºè©²é€²ç¨‹ç„¡æ¬Šæ‰“é–‹å¥—æ¥å­—ã€‚</p><pre>$ python3 socket_echo_client_uds.pyconnecting to ./uds_socket[Errno 13] Permission denied</pre><p>çˆ¶å­é€²ç¨‹ä¹‹é–“çš„é€šä¿¡</p><p>ç‚ºäº†åœ¨ Unix ä¸‹é€²è¡Œé€²ç¨‹é–“é€šä¿¡ï¼Œé€šé socketpair() å‡½æ•¸ä¾†è¨­ç½® UDS å¥—æ¥å­—å¾ˆæœ‰ç”¨ã€‚å®ƒå‰µå»ºäº†ä¸€å°é€£æ¥çš„å¥—æ¥å­—ï¼Œç•¶å­é€²ç¨‹è¢«å‰µå»ºå¾Œï¼Œåœ¨çˆ¶é€²ç¨‹å’Œå­é€²ç¨‹ä¹‹é–“é€²è¡Œé€šä¿¡ã€‚</p><pre>import socketimport osparent, child = socket.socketpair()pid = os.fork()if pid: print('in parent, sending message') child.close() parent.sendall(b'ping') response = parent.recv(1024) print('response from child:', response) parent.close()else: print('in child, waiting for message') parent.close() message = child.recv(1024) print('message from parent:', message) child.sendall(b'pong') child.close() # output# in parent, sending message# in child, waiting for message# message from parent: b'ping'# response from child: b'pong'</pre><p>é»˜èªæƒ…æ³ä¸‹ï¼Œæœƒå‰µå»ºä¸€å€‹ UDS å¥—æ¥å­—ï¼Œä½†ä¹Ÿå¯ä»¥å‚³éåœ°å€æ—ï¼Œå¥—æ¥å­—é¡å‹ç”šè‡³å”è­°é¸é …ä¾†æ§åˆ¶å¥—æ¥å­—çš„å‰µå»ºæ–¹å¼ã€‚</p><p>çµ„æ’­</p><p>é»å°é»é€£æ¥å¯ä»¥è™•ç†å¤§é‡é€šä¿¡éœ€æ±‚ï¼Œä½†éš¨è‘—ç›´æ¥é€£æ¥æ•¸é‡çš„å¢åŠ ï¼ŒåŒæ™‚çµ¦å¤šå€‹æ¥æ”¶è€…å‚³éç›¸åŒçš„ä¿¡æ¯è®Šå¾—å…·æœ‰æŒ‘æˆ°æ€§ã€‚åˆ†åˆ¥å‘æ¯å€‹æ¥æ”¶è€…ç™¼é€æ¶ˆæ¯æœƒæ¶ˆè€—é¡å¤–çš„è™•ç†æ™‚é–“å’Œå¸¶å¯¬ï¼Œé€™å°æ–¼è«¸å¦‚æµå¼è¦–é »æˆ–éŸ³é »ä¹‹é¡çš„æ‡‰ç”¨ä¾†èªªå¯èƒ½æ˜¯å€‹å•é¡Œã€‚ä½¿ç”¨çµ„æ’­ä¸€æ¬¡å‘å¤šå€‹ç«¯é»å‚³éæ¶ˆæ¯å¯ä»¥ä½¿æ•ˆç‡æ›´é«˜ã€‚</p><p>çµ„æ’­æ¶ˆæ¯é€šé UDP ç™¼é€ï¼Œå› ç‚º TCP æ˜¯ä¸€å°ä¸€çš„é€šä¿¡ç³»çµ±ã€‚çµ„æ’­åœ°å€ï¼ˆç¨±ç‚º çµ„æ’­çµ„ï¼‰æ˜¯ç‚ºçµ„æ’­æµé‡ä¿ç•™çš„å¸¸è¦ IPv4 åœ°å€ç¯„åœï¼ˆ224.0.0.0åˆ°230.255.255.255ï¼‰çš„å­é›†ã€‚é€™äº›åœ°å€ç”±ç¶²çµ¡è·¯ç”±å™¨å’Œäº¤æ›æ©Ÿå°ˆé–€è™•ç†ï¼Œå› æ­¤ç™¼é€åˆ°è©²çµ„çš„éƒµä»¶å¯ä»¥é€šé Internet åˆ†ç™¼çµ¦å·²åŠ å…¥è©²çµ„çš„æ‰€æœ‰æ”¶ä»¶äººã€‚</p><p>æ³¨æ„ï¼šæŸäº›è¨—ç®¡äº¤æ›æ©Ÿå’Œè·¯ç”±å™¨é»˜èªç¦ç”¨çµ„æ’­æµé‡ã€‚å¦‚æœåœ¨ä½¿ç”¨ç¤ºä¾‹ç¨‹åºæ™‚é‡åˆ°å•é¡Œï¼Œè«‹æª¢æŸ¥ç¶²çµ¡ç¡¬ä»¶è¨­ç½®ã€‚</p><p>ç™¼é€çµ„æ’­æ¶ˆæ¯</p><p>ä¿®æ”¹ä¸Šé¢çš„å®¢æˆ¶ç«¯ç¨‹åºä½¿å…¶å‘çµ„æ’­çµ„ç™¼é€æ¶ˆæ¯ï¼Œç„¶å¾Œå ±å‘Šå®ƒæ”¶åˆ°çš„æ‰€æœ‰éŸ¿æ‡‰ã€‚ç”±æ–¼ç„¡æ³•çŸ¥é“é æœŸæœƒæœ‰å¤šå°‘éŸ¿æ‡‰ï¼Œå› æ­¤å®ƒæœƒä½¿ç”¨å¥—æ¥å­—çš„è¶…æ™‚å€¼ä¾†é¿å…åœ¨ç­‰å¾…ç­”æ¡ˆæ™‚ç„¡é™æœŸåœ°é˜»å¡ã€‚</p><p>å¥—æ¥å­—é‚„éœ€è¦é…ç½®æ¶ˆæ¯çš„ç”Ÿå­˜æ™‚é–“å€¼ï¼ˆTTLï¼‰ã€‚TTL æ§åˆ¶æ¥æ”¶æ•¸æ“šåŒ…çš„ç¶²çµ¡æ•¸é‡ã€‚ä½¿ç”¨IP_MULTICAST_TTL å’Œ setsockopt() è¨­ç½® TTLã€‚é»˜èªå€¼1è¡¨ç¤ºè·¯ç”±å™¨ä¸æœƒå°‡æ•¸æ“šåŒ…è½‰ç™¼åˆ°ç•¶å‰ç¶²æ®µä¹‹å¤–ã€‚è©²å€¼æœ€å¤§å¯é” 255ï¼Œä¸¦ä¸”æ‡‰æ‰“åŒ…ç‚ºå–®å€‹å­—ç¯€ã€‚</p><pre># socket_multicast_sender.py import socketimport structimport sysmessage = b'very important data'multicast_group = ('224.3.29.71', 10000)# Create the datagram socketsock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)# Set a timeout so the socket does not block# indefinitely when trying to receive data.sock.settimeout(0.2)# Set the time-to-live for messages to 1 so they do not# go past the local network segment.ttl = struct.pack('b', 1)sock.setsockopt(socket.IPPROTO_IP, socket.IP_MULTICAST_TTL, ttl)try: # Send data to the multicast group print('sending {!r}'.format(message)) sent = sock.sendto(message, multicast_group) # Look for responses from all recipients while True: print('waiting to receive') try: data, server = sock.recvfrom(16) except socket.timeout: print('timed out, no more responses') break else: print('received {!r} from {}'.format(data, server))finally: print('closing socket') sock.close()</pre><p>ç™¼ä»¶äººçš„å…¶é¤˜éƒ¨åˆ†çœ‹èµ·ä¾†åƒ UDP å®¢æˆ¶ç«¯ï¼Œé™¤äº†å®ƒéœ€è¦å¤šå€‹éŸ¿æ‡‰ï¼Œå› æ­¤ä½¿ç”¨å¾ªç’°èª¿ç”¨ recvfrom() ç›´åˆ°è¶…æ™‚ã€‚</p><p>æ¥æ”¶çµ„æ’­æ¶ˆæ¯</p><p>å»ºç«‹çµ„æ’­æ¥æ”¶å™¨çš„ç¬¬ä¸€æ­¥æ˜¯å‰µå»º UDP å¥—æ¥å­—ã€‚å‰µå»ºå¸¸è¦å¥—æ¥å­—ä¸¦ç¶å®šåˆ°ç«¯å£å¾Œï¼Œå¯ä»¥ä½¿ç”¨setsockopt()æ›´æ”¹IP_ADD_MEMBERSHIPé¸é …å°‡å…¶æ·»åŠ åˆ°çµ„æ’­çµ„ã€‚é¸é …å€¼æ˜¯çµ„æ’­çµ„åœ°å€çš„ 8 å­—ç¯€æ‰“åŒ…è¡¨ç¤ºï¼Œå¾Œè·Ÿæœå‹™ç«¯ç›£è½æµé‡çš„ç¶²çµ¡æ¥å£ï¼Œç”±å…¶ IP åœ°å€æ¨™è­˜ã€‚åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œæ¥æ”¶ç«¯ä½¿ç”¨ INADDR_ANY æ‰€æœ‰æ¥å£ã€‚</p><pre># socket_multicast_receiver.py import socketimport structimport sysmulticast_group = '224.3.29.71'server_address = ('', 10000)# Create the socketsock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)# Bind to the server addresssock.bind(server_address)# Tell the operating system to add the socket to# the multicast group on all interfaces.group = socket.inet_aton(multicast_group)mreq = struct.pack('4sL', group, socket.INADDR_ANY)sock.setsockopt(socket.IPPROTO_IP, socket.IP_ADD_MEMBERSHIP, mreq)# Receive/respond loopwhile True: print('\nwaiting to receive message') data, address = sock.recvfrom(1024) print('received {} bytes from {}'.format(len(data), address)) print(data) print('sending acknowledgement to', address) sock.sendto(b'ack', address)</pre><p>æ¥æ”¶å™¨çš„ä¸»å¾ªç’°å°±åƒå¸¸è¦çš„ UDP æœå‹™ç«¯ä¸€æ¨£ã€‚</p><p>ç¤ºä¾‹è¼¸å‡º</p><p>æ­¤ç¤ºä¾‹é¡¯ç¤ºåœ¨å…©å€‹ä¸åŒä¸»æ©Ÿä¸Šé‹è¡Œçš„çµ„æ’­æ¥æ”¶å™¨ã€‚Aåœ°å€192.168.1.13å’ŒBåœ°å€ 192.168.1.14ã€‚</p><pre>[A]$ python3 socket_multicast_receiver.pywaiting to receive messagereceived 19 bytes from ('192.168.1.14', 62650)b'very important data'sending acknowledgement to ('192.168.1.14', 62650)waiting to receive message[B]$ python3 source/socket/socket_multicast_receiver.pywaiting to receive messagereceived 19 bytes from ('192.168.1.14', 64288)b'very important data'sending acknowledgement to ('192.168.1.14', 64288)waiting to receive message</pre><p>ç™¼ä»¶äººæ­£åœ¨ä¸»æ©Ÿä¸Šé‹è¡ŒBã€‚</p><pre>[B]$ python3 socket_multicast_sender.pysending b'very important data'waiting to receivereceived b'ack' from ('192.168.1.14', 10000)waiting to receivereceived b'ack' from ('192.168.1.13', 10000)waiting to receivetimed out, no more responsesclosing socket</pre><p>æ¶ˆæ¯è¢«é«®é€ä¸€æ¬¡ï¼Œä¸¦ä¸”æ¥æ”¶åˆ°å…©å€‹å‚³å‡ºæ¶ˆæ¯çš„ç¢ºèªï¼Œåˆ†åˆ¥ä¾†è‡ªä¸»æ©ŸAå’ŒBã€‚</p><p>ç™¼é€äºŒé€²åˆ¶æ•¸æ“š</p><p>å¥—æ¥å­—å‚³è¼¸å­—ç¯€æµã€‚é€™äº›å­—ç¯€å¯ä»¥åŒ…å«ç·¨ç¢¼ç‚ºå­—ç¯€çš„æ–‡æœ¬æ¶ˆæ¯ï¼Œå¦‚å‰é¢ç¤ºä¾‹ä¸­æ‰€ç¤ºï¼Œæˆ–è€…å®ƒå€‘ä¹Ÿå¯ä»¥æ˜¯ç”± struct æ‰“åŒ…åˆ°ç·©è¡å€ä¸­çš„äºŒé€²åˆ¶æ•¸æ“šã€‚</p><p>æ­¤å®¢æˆ¶ç«¯ç¨‹åºå°‡æ•´æ•¸ï¼Œå…©å€‹å­—ç¬¦çš„å­—ç¬¦ä¸²å’Œæµ®é»å€¼ï¼Œç·¨ç¢¼ç‚ºå¯å‚³éåˆ°å¥—æ¥å­—ä»¥é€²è¡Œå‚³è¼¸çš„å­—ç¯€åºåˆ—ã€‚</p><pre># socket_binary_client.py import binasciiimport socketimport structimport sys# Create a TCP/IP socketsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)server_address = ('localhost', 10000)sock.connect(server_address)values = (1, b'ab', 2.7)packer = struct.Struct('I 2s f')packed_data = packer.pack(*values)print('values =', values)try: # Send data print('sending {!r}'.format(binascii.hexlify(packed_data))) sock.sendall(packed_data)finally: print('closing socket') sock.close()</pre><p>åœ¨å…©å€‹ç³»çµ±ä¹‹é–“ç™¼é€å¤šå­—ç¯€äºŒé€²åˆ¶æ•¸æ“šæ™‚ï¼Œé‡è¦çš„æ˜¯è¦ç¢ºä¿é€£æ¥çš„å…©ç«¯éƒ½çŸ¥é“å­—ç¯€çš„é †åºï¼Œä»¥åŠå¦‚ä½•å°‡å®ƒå€‘è§£å£“å›åŸä¾†çš„çµæ§‹ã€‚æœå‹™ç«¯ç¨‹åºä½¿ç”¨ç›¸åŒçš„ Structèªªæ˜ç¬¦ä¾†è§£å£“ç¸®æ¥æ”¶çš„å­—ç¯€ï¼Œä»¥ä¾¿æŒ‰æ­£ç¢ºçš„é †åºé‚„åŸå®ƒå€‘ã€‚</p><pre># socket_binary_server.py import binasciiimport socketimport structimport sys# Create a TCP/IP socketsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)server_address = ('localhost', 10000)sock.bind(server_address)sock.listen(1)unpacker = struct.Struct('I 2s f')while True: print('\nwaiting for a connection') connection, client_address = sock.accept() try: data = connection.recv(unpacker.size) print('received {!r}'.format(binascii.hexlify(data))) unpacked_data = unpacker.unpack(data) print('unpacked:', unpacked_data) finally: connection.close()</pre><p>é‹è¡Œå®¢æˆ¶ç«¯æœƒç”¢ç”Ÿï¼š</p><pre>$ python3 source/socket/socket_binary_client.pyvalues = (1, b'ab', 2.7)sending b'0100000061620000cdcc2c40'closing socket</pre><p>æœå‹™ç«¯é¡¯ç¤ºå®ƒæ”¶åˆ°çš„å€¼ï¼š</p><pre>$ python3 socket_binary_server.pywaiting for a connectionreceived b'0100000061620000cdcc2c40'unpacked: (1, b'ab', 2.700000047683716)waiting for a connection</pre><p>æµ®é»å€¼åœ¨æ‰“åŒ…å’Œè§£åŒ…æ™‚æœƒä¸Ÿå¤±ä¸€äº›ç²¾åº¦ï¼Œå¦å‰‡æ•¸æ“šæœƒæŒ‰é æœŸå‚³è¼¸ã€‚è¦è¨˜ä½çš„ä¸€ä»¶äº‹æ˜¯ï¼Œå–æ±ºæ–¼æ•´æ•¸çš„å€¼ï¼Œå°‡å…¶è½‰æ›ç‚ºæ–‡æœ¬ç„¶å¾Œå‚³è¼¸è€Œä¸ä½¿ç”¨ struct å¯èƒ½æ›´é«˜æ•ˆã€‚æ•´æ•¸1åœ¨è¡¨ç¤ºç‚ºå­—ç¬¦ä¸²æ™‚ä½¿ç”¨ä¸€å€‹å­—ç¯€ï¼Œä½†åœ¨æ‰“åŒ…åˆ°çµæ§‹ä¸­æ™‚ä½¿ç”¨å››å€‹å­—ç¯€ã€‚</p><p>éé˜»å¡é€šä¿¡å’Œè¶…æ™‚</p><p>é»˜èªæƒ…æ³ä¸‹ï¼Œé…ç½® socket ä¾†ç™¼é€å’Œæ¥æ”¶æ•¸æ“šï¼Œç•¶å¥—æ¥å­—æº–å‚™å°±ç·’æ™‚æœƒé˜»å¡ç¨‹åºåŸ·è¡Œã€‚èª¿ç”¨send()ç­‰å¾…ç·©è¡å€ç©ºé–“å¯ç”¨æ–¼å‚³å‡ºæ•¸æ“šï¼Œèª¿ç”¨recv()ç­‰å¾…å…¶ä»–ç¨‹åºç™¼é€å¯è®€å–çš„æ•¸æ“šã€‚é€™ç¨®å½¢å¼çš„ I/O æ“ä½œå¾ˆå®¹æ˜“ç†è§£ï¼Œä½†å¦‚æœå…©å€‹ç¨‹åºæœ€çµ‚éƒ½åœ¨ç­‰å¾…å¦ä¸€å€‹ç™¼é€æˆ–æ¥æ”¶æ•¸æ“šï¼Œå‰‡å¯èƒ½å°è‡´ç¨‹åºä½æ•ˆï¼Œç”šè‡³æ­»é–ã€‚</p><p>æœ‰å¹¾ç¨®æ–¹æ³•å¯ä»¥è§£æ±ºé€™ç¨®æƒ…æ³ã€‚ä¸€ç¨®æ˜¯ä½¿ç”¨å–®ç¨çš„ç·šç¨‹åˆ†åˆ¥èˆ‡æ¯å€‹å¥—æ¥å­—é€²è¡Œé€šä¿¡ã€‚ä½†æ˜¯ï¼Œé€™å¯èƒ½æœƒå¼•å…¥å…¶ä»–è¤‡é›œçš„å•é¡Œï¼Œå³ç·šç¨‹ä¹‹é–“çš„é€šä¿¡ã€‚å¦ä¸€å€‹é¸æ“‡æ˜¯å°‡å¥—æ¥å­—æ›´æ”¹ç‚ºä¸é˜»å¡çš„ï¼Œå¦‚æœå°šæœªæº–å‚™å¥½è™•ç†æ“ä½œï¼Œå‰‡ç«‹å³è¿”å›ã€‚ä½¿ç”¨setblocking()æ–¹æ³•æ›´æ”¹å¥—æ¥å­—çš„é˜»æ­¢æ¨™èªŒã€‚é»˜èªå€¼ç‚º1ï¼Œè¡¨ç¤ºé˜»æ­¢ã€‚0è¡¨ç¤ºä¸é˜»å¡ã€‚å¦‚æœå¥—æ¥å­—å·²é—œé–‰é˜»å¡ä¸¦ä¸”å°šæœªæº–å‚™å¥½ï¼Œå‰‡æœƒå¼•ç™¼ socket.error éŒ¯èª¤ã€‚</p><p>å¦ä¸€å€‹è§£æ±ºæ–¹æ¡ˆæ˜¯ç‚ºå¥—æ¥å­—æ“ä½œè¨­ç½®è¶…æ™‚æ™‚é–“ï¼Œèª¿ç”¨ settimeout() å‡½æ•¸ï¼Œåƒæ•¸æ˜¯ä¸€å€‹æµ®é»å€¼ï¼Œè¡¨ç¤ºåœ¨ç¢ºå®šå¥—æ¥å­—æœªæº–å‚™å¥½ä¹‹å‰è¦é˜»å¡çš„ç§’æ•¸ã€‚è¶…æ™‚åˆ°æœŸæ™‚ï¼Œå¼•ç™¼ timeout ç•°å¸¸ã€‚</p><p>ç›¸é—œæ–‡æª”ï¼š</p><p>https://pymotw.com/3/socket/index.html</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>æ¯é€±</a></li><li><a>ä¸€å€‹</a></li><li><a>Python</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E9%81%8A%E6%88%B2/d444313.html alt=æ¯é€±ç©ä¸€å€‹ï¼Œå¤§é€£é€™5å€‹ç‰¹è‰²å°é®å¤ ä½ æ–‡è—æ•´å€‹å¤å¤©~ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=http://p1.pstatp.com/large/pgc-image/15317522366386c66354dc0 style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/d444313.html title=æ¯é€±ç©ä¸€å€‹ï¼Œå¤§é€£é€™5å€‹ç‰¹è‰²å°é®å¤ ä½ æ–‡è—æ•´å€‹å¤å¤©~>æ¯é€±ç©ä¸€å€‹ï¼Œå¤§é€£é€™5å€‹ç‰¹è‰²å°é®å¤ ä½ æ–‡è—æ•´å€‹å¤å¤©~</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ac25d2d0.html alt=30åˆ†é˜æ•™ä½ æ­å»ºä¸€å€‹ç¶²ç«™ï¼ˆä¸€ï¼‰ï¼šè³¼è²·å’Œé…ç½®æœå‹™å™¨ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/5f26f1582a564e93bde33a7dd9448c3b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ac25d2d0.html title=30åˆ†é˜æ•™ä½ æ­å»ºä¸€å€‹ç¶²ç«™ï¼ˆä¸€ï¼‰ï¼šè³¼è²·å’Œé…ç½®æœå‹™å™¨>30åˆ†é˜æ•™ä½ æ­å»ºä¸€å€‹ç¶²ç«™ï¼ˆä¸€ï¼‰ï¼šè³¼è²·å’Œé…ç½®æœå‹™å™¨</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d8be5e94.html alt=ä¸æœƒè²·æœå‹™å™¨ï¼Ÿä¸€å€‹è¾¦æ³•è®“ä½ è¼•é¬†æ­ç¶²ç«™ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/84d9c54578de46058796824f1bcb6a9b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d8be5e94.html title=ä¸æœƒè²·æœå‹™å™¨ï¼Ÿä¸€å€‹è¾¦æ³•è®“ä½ è¼•é¬†æ­ç¶²ç«™>ä¸æœƒè²·æœå‹™å™¨ï¼Ÿä¸€å€‹è¾¦æ³•è®“ä½ è¼•é¬†æ­ç¶²ç«™</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c811c5f7.html alt=ä½¿ç”¨æœå‹™å™¨æ­å»ºä¸€å€‹ç¶²ç«™ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/63a6cc0eb4d146e0890515500c0040ca style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c811c5f7.html title=ä½¿ç”¨æœå‹™å™¨æ­å»ºä¸€å€‹ç¶²ç«™>ä½¿ç”¨æœå‹™å™¨æ­å»ºä¸€å€‹ç¶²ç«™</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4b69aa7f.html alt=åšä¸€å€‹å°å‹ç¶²ç«™ï¼Œæœå‹™å™¨éœ€è¦ä»€éº¼é…ç½®çš„å‘¢ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4b69aa7f.html title=åšä¸€å€‹å°å‹ç¶²ç«™ï¼Œæœå‹™å™¨éœ€è¦ä»€éº¼é…ç½®çš„å‘¢ï¼Ÿ>åšä¸€å€‹å°å‹ç¶²ç«™ï¼Œæœå‹™å™¨éœ€è¦ä»€éº¼é…ç½®çš„å‘¢ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eee4b8ad.html alt=æ­å»ºä¸€å€‹ç¶²ç«™ï¼Œç§Ÿæœå‹™å™¨å¤§æ¦‚å¤šå°‘éŒ¢ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eee4b8ad.html title=æ­å»ºä¸€å€‹ç¶²ç«™ï¼Œç§Ÿæœå‹™å™¨å¤§æ¦‚å¤šå°‘éŒ¢ï¼Ÿ>æ­å»ºä¸€å€‹ç¶²ç«™ï¼Œç§Ÿæœå‹™å™¨å¤§æ¦‚å¤šå°‘éŒ¢ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/62d46b38.html alt=ç´ æç¥•ç±ï½œä¸€å€‹è€³æœµï¼9å¤§çŸ¥è­˜é»ï¼Œ360åº¦å…¨æ–¹ä½æ·±åº¦å‰–æè¬›è§£ç¤ºç¯„ï¼ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/5e7b0005767168b2b87d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/62d46b38.html title=ç´ æç¥•ç±ï½œä¸€å€‹è€³æœµï¼9å¤§çŸ¥è­˜é»ï¼Œ360åº¦å…¨æ–¹ä½æ·±åº¦å‰–æè¬›è§£ç¤ºç¯„ï¼>ç´ æç¥•ç±ï½œä¸€å€‹è€³æœµï¼9å¤§çŸ¥è­˜é»ï¼Œ360åº¦å…¨æ–¹ä½æ·±åº¦å‰–æè¬›è§£ç¤ºç¯„ï¼</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/647df9c2.html alt=ä¸€å€‹ç”·äººæ¯å¤©24å°æ™‚è·Ÿå¦»å­åœ¨ä¸€èµ·ï¼Œä¹…è€Œä¹…ä¹‹æœƒæ€æ¨£ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8359cc22f03e478a8cdb889dcfea3f99 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/647df9c2.html title=ä¸€å€‹ç”·äººæ¯å¤©24å°æ™‚è·Ÿå¦»å­åœ¨ä¸€èµ·ï¼Œä¹…è€Œä¹…ä¹‹æœƒæ€æ¨£>ä¸€å€‹ç”·äººæ¯å¤©24å°æ™‚è·Ÿå¦»å­åœ¨ä¸€èµ·ï¼Œä¹…è€Œä¹…ä¹‹æœƒæ€æ¨£</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5a86d7d9.html alt=æ¯å¤©ä¸€å€‹å¥½ç¿’æ…£ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RKdGgquJFM6gnc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5a86d7d9.html title=æ¯å¤©ä¸€å€‹å¥½ç¿’æ…£>æ¯å¤©ä¸€å€‹å¥½ç¿’æ…£</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/756b16fb.html alt=å¥¶ç²‰å¯„å‡ºä¸€å€‹æœˆï¼Œå®¶äººé²é²æ”¶ä¸åˆ°ï¼Œç‰©æµä¿¡æ¯ä¹ŸæŸ¥è©¢ä¸åˆ°ï¼Œäº‹ç™¼é˜œé™½æŸéŸ»é”å¿«éç¶²é» class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/3fd8ec4e-64c1-446a-adfa-38088fb06c01 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/756b16fb.html title=å¥¶ç²‰å¯„å‡ºä¸€å€‹æœˆï¼Œå®¶äººé²é²æ”¶ä¸åˆ°ï¼Œç‰©æµä¿¡æ¯ä¹ŸæŸ¥è©¢ä¸åˆ°ï¼Œäº‹ç™¼é˜œé™½æŸéŸ»é”å¿«éç¶²é»>å¥¶ç²‰å¯„å‡ºä¸€å€‹æœˆï¼Œå®¶äººé²é²æ”¶ä¸åˆ°ï¼Œç‰©æµä¿¡æ¯ä¹ŸæŸ¥è©¢ä¸åˆ°ï¼Œäº‹ç™¼é˜œé™½æŸéŸ»é”å¿«éç¶²é»</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b29ee719.html alt=åˆä¸€å€‹èµ°ä¸Šä¸æ­¸è·¯çš„æ¬ç£šäºº class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/bf471da0a06441f88bce49b959234257 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b29ee719.html title=åˆä¸€å€‹èµ°ä¸Šä¸æ­¸è·¯çš„æ¬ç£šäºº>åˆä¸€å€‹èµ°ä¸Šä¸æ­¸è·¯çš„æ¬ç£šäºº</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/91eece92.html alt="åªéœ€ 45 ç§’ï¼ŒPython çµ¦æ•…å®®ç•«ä¸€çµ„æ‰‹ç¹ªåœ–ï¼" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/df1bd890ffee4a439e9f5142ae42c102 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/91eece92.html title="åªéœ€ 45 ç§’ï¼ŒPython çµ¦æ•…å®®ç•«ä¸€çµ„æ‰‹ç¹ªåœ–ï¼">åªéœ€ 45 ç§’ï¼ŒPython çµ¦æ•…å®®ç•«ä¸€çµ„æ‰‹ç¹ªåœ–ï¼</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8aab963e.html alt=Pythonæ‰‹ç¹ªåœ–ç­è§£ä¸€ä¸‹ï¼ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/746c9e6e214b48b2a0215fc9e151cdc8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8aab963e.html title=Pythonæ‰‹ç¹ªåœ–ç­è§£ä¸€ä¸‹ï¼>Pythonæ‰‹ç¹ªåœ–ç­è§£ä¸€ä¸‹ï¼</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3d6d5661.html alt=å¤šæ”¶è—ä¸€å€‹ï¼Œå°±å°‘æ±‚ä¸€æ¬¡äººâ€”å“ªäº›æ—¥å¸¸å¿…å‚™ç¥ç´šç¶²ç«™ï¼ŒçœŸæ­£å€¼å¾—æ”¶è— class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/833949926ebf49b89c5fb4075a9cffdd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3d6d5661.html title=å¤šæ”¶è—ä¸€å€‹ï¼Œå°±å°‘æ±‚ä¸€æ¬¡äººâ€”å“ªäº›æ—¥å¸¸å¿…å‚™ç¥ç´šç¶²ç«™ï¼ŒçœŸæ­£å€¼å¾—æ”¶è—>å¤šæ”¶è—ä¸€å€‹ï¼Œå°±å°‘æ±‚ä¸€æ¬¡äººâ€”å“ªäº›æ—¥å¸¸å¿…å‚™ç¥ç´šç¶²ç«™ï¼ŒçœŸæ­£å€¼å¾—æ”¶è—</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cfd854c6.html alt=æ•…å®®ä¸‹é›ªäº†ï¼æˆ‘ç”¨Pythonçµ¦å®ƒç•«äº†ä¸€çµ„æ‰‹ç¹ªåœ–ï¼Œåƒ…ç”¨45ç§’ï¼ˆé™„ä»£ç¢¼ï¼‰ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/774d2f0a372f48c589ec84dd3a164dd9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cfd854c6.html title=æ•…å®®ä¸‹é›ªäº†ï¼æˆ‘ç”¨Pythonçµ¦å®ƒç•«äº†ä¸€çµ„æ‰‹ç¹ªåœ–ï¼Œåƒ…ç”¨45ç§’ï¼ˆé™„ä»£ç¢¼ï¼‰>æ•…å®®ä¸‹é›ªäº†ï¼æˆ‘ç”¨Pythonçµ¦å®ƒç•«äº†ä¸€çµ„æ‰‹ç¹ªåœ–ï¼Œåƒ…ç”¨45ç§’ï¼ˆé™„ä»£ç¢¼ï¼‰</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>