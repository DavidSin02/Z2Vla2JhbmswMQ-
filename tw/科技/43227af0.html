<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃 | 极客快訊</title><meta property="og:title" content="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/RzRJaGZHUGczH5"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/43227af0.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/43227af0.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/43227af0.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/43227af0.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/43227af0.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/43227af0.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/43227af0.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/43227af0.html><meta property="article:published_time" content="2020-11-14T21:00:22+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:22+08:00"><meta name=Keywords content><meta name=description content="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/43227af0.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzRJaGZHUGczH5><p>作者 | Haor.L</p><p>責編 | 王曉曼</p><p>出品 | CSDN博客</p><p>筆者最近參加了校內的一場物聯網開發競賽，從零開始，<strong>踩坑無數，感覺很多時候事情都不像預料的一樣發展</strong>，離開了美好的IDE，太多事情要在板子上一步步摸索。<strong>運行失敗還好，運行成功但BUG了，簡直不知道從何查起</strong>。</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzRJaHX9AGpgCF><p>但認識了M5Stack簡單的線上系統，學習了MQTT，HTTP等數據傳輸方式，入門Arduino和MIrcopython等開發語言，接觸ESP32的板子，感受最深的一點就是，<strong>物聯網的准入門檻並沒有那麼高，成本也沒有那麼高</strong>，但這還是一片混沌未開的區域，進場者真的可以大有所為，<strong>起碼方便自己的日常生活是綽綽有餘的。</strong></p><p>總的來說，這次物聯網入坑，<strong>值得！</strong></p><p><strong>閱讀本文後你將收穫：</strong></p><ul><li>瞭解M5STACK這款新興的片上系統<br></li><li><p>瞭解這款板子的開發環境如何配置</p></li><li><p>掌握ONENET數據傳輸</p></li><li><p>掌握HTTP的GET方法</p></li><li>會搭建筆者前幾天做的項目雛形：健康碼追蹤系統<br></li></ul><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RT4Gwk56bt5iOJ><p><strong>開發準備</strong></p><p>本博客作為學習物聯網開發的筆記，也簡單的將自己的片上系統作為例程寫出來。</p><ul><li>ESP-IDF工具鏈配置：<strong>樂鑫文檔</strong><br></li><li>UIflow<strong>在線IDE</strong></li><li>M5STACK的<strong>官方開發文檔</strong>(<strong>很全，如果你也打算使用M5STACK系列的開發板，強烈建議從此入門</strong>)</li><li>本博客項目的代碼倉庫（歡迎賞星）：<strong>https://github.com/haoruilee/M5Stack_Healthy_code_tracer</strong><br></li></ul><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RT7S2kzFTfre26><p><strong>M5STACK簡介</strong></p><p>M5STACK是一款對初學者非常友好的ESP32開發板，可以用Micropython和C編程，也可以用很簡單的拖拽式編程，擁有龐大的官方文檔，只是國內只在最近開始流行，油管和B站上都有官方的教學視頻，也在常常更新，很有創造力的一個產品。</p><p>結構上主要分為Core和Unit，Core作為核心控件，Unit作為傳感器採集數據。</p><p>下圖圖就是筆者自己做的產品雛形，中間的小屏幕是Core，作為主控,周圍有GPS和RFID,攝像頭等單元用來採集數據。</p><p>設計雛形：</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzRJaJ98L9dslf><p>由於所有的M5產品都預設了樂高塊，所有你可以把他們拼在樂高模組上，油管上還有不少人用它做樂高機器人，確實是很有創意的一款產品，顏值也不錯，所以筆者選擇它用來開發。</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTJXJ1kBqzfCnu><p><strong>環境配置</strong></p><p><strong>UIFlow環境</strong></p><p>在線編程地址：<strong>UIFlow</strong></p><p>前幾天GIthub發佈了遠程編譯器Codespace,可以看出遠程編譯確實是大勢所趨。</p><p>這裡不得不說UIFlow把物聯網的門檻大大降低了，筆者配置ESP-IDF用了將近一天，而使用UIFlow可以免去一切環境配置的痛苦。</p><p>支持拖拽編程，可視化UI設計，自帶例程，確實是良心產品。</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzRJaLW3Itg7uv><p><strong>ESP-IDF環境</strong></p><p><strong>方法一</strong></p><p>筆者配置ESP-IDF工具鏈時，一開始是使用Windows系統的<strong>工具安裝器。</strong></p><p>ESP-IDF 工具安裝器可在“開始”菜單中，創建一個打開ESP-IDF 命令提示符窗口的快捷方式。本快捷方式可以打開 Windows 命令提示符（即 cmd.exe），並運行 export.bat 腳本以設置各環境變量（比如 PATH，IDF_PATH 等）。</p><p>（不得不說，這個安裝器的健壯性非常差！！）</p><p><strong>安裝心得：上網技巧+把系統的PATH重新檢查一遍，有些卸載殘餘的PATH會導致玄學問題！</strong></p><p><strong>方法二（更推薦）</strong></p><p>宇宙第一VS code中有插件 ESPRESSIF</p><p>可以更清楚每時每刻在幹什麼，也更清楚出了BUG去哪裡修補。</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzRJaNtHAhhK0a><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTJXJ7YR5xGDl><p><strong>感知模塊</strong></p><p>M5開發了很多環境傳感器，包括溫溼度，人體感應，RFID，攝像頭等等，在<strong>官方開發文檔</strong>上也都給出了相關例程和GIthub的源碼鏈接。</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RzRJbEVB7i1Xik><p>筆者自己的項目使用的是RFID、GPS和Camera模塊，其中除了Camera只能用ESP-IDF編程，其他單元都支持在UIFlow上在線編程，再加上，Micropython確實比C++舒服太多。</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTJXJ7uHXU5GZc><p><strong>網絡連接</strong></p><p><strong>Wi-Fi鏈接</strong></p><p>M5Stack已經自己預置了Wi-Fi鏈接，開機就是，不過在Mircopython裡寫起來也很簡單，下面是一個範例：</p><pre><pre>import network<br>SSID="YOUR-WIFI-NAME"<br>PASSWORD="YOUR-WIFI-PASSWORD"<br>wlan=None<br>s=None<br><br>def connectWifi(ssid,passwd):<br>'''<br>連接指定wifi<br>'''<br>global wlan<br>wlan=network.WLAN(network.STA_IF)<br>wlan.active(True)<br>wlan.disconnect<br>wlan.connect(ssid,passwd)<br>while(wlan.ifconfig[0]=='0.0.0.0'):<br>time.sleep(1)<br>return True<br></pre></pre><p>使用Mircoython的Wi-Fi模塊，connect(ssid，password)，就可以進入可愛的Wi-Fi連接界面了，M5GO的封裝還是不錯的。</p><p><strong>NB-IOT</strong></p><p>IOT模組需要額外配一張NB卡，某寶20就可以拿下一年500M流量，不過筆者沒有繼續嘗試，已經有可愛的M5GO和穩定的Wi-Fi，就沒探索用3G進行通訊。</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTLSNam5ZxLDlM><p><strong>HTTP通訊</strong></p><p>接下來介紹物聯網的精髓，“聯網”，採集到了數據，那數據上報和傳輸是重中之重。</p><p>筆者覺得HTTP是最好理解，好入門的通訊協議，這裡也先介紹這種方法。</p><p>建議參考視頻：<strong>B站：接入中國移動ONENET平臺</strong></p><p>筆者嘗試過諸如阿里雲和一些外國的平臺，最後發現都不如中國移動專門為物聯網開發的ONENET，一來穩定，不用擔心服務商跑路，而來阿里雲顯得太過臃腫，對入門者很不友好，最終選擇了ONENET，他的HTTP封裝好了很好看的數據流模板，如：</p><ul><li><p>位置信息可視化：</p></li></ul><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/RzRJbFsASrOdmM><ul><li><p>自動折線圖</p></li></ul><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzRJbGQIXVuWxU><p><strong>POST上傳數據</strong><strong>創建流模板</strong></p><p>首先需要創建一個數據流模板，用於接收傳過來的數據：</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzRJbGw5LHXVeE><p><strong>發送請求</strong></p><p>請求方式：POST</p><p>URL:http://api.heclouds.com/devices/device_id/datapoints</p><p>其中，device_id：需要替換為設備ID</p><p>注意：ONENET默認post的數據叫Datastreams，參數配置見表：</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/RzRJbHYFXVLLaz><p>請求實例：</p><pre>{<br>"datastreams": [{<br>"id": "temperature",<br>"datapoints": [{<br>"at": "2013-04-22T00:35:43",<br>"value": "bacd"<br>},<br>{<br>"at": "2013-04-22T00:55:43",<br>"value": 84<br>}<br>]<br>},<br>{<br>"id": "key",<br>"datapoints": [{<br>"at": "2013-04-22T00:35:43",<br>"value": {<br>"x": 123,<br>"y": 123.994<br>}<br>},<br>{<br>"at": "2013-04-22T00:35:43",<br>"value": 23.001<br>}<br>]<br>}<br>]<br>}<br></pre><p>使用ONENET的<strong>模擬API調用</strong>可以快速熟悉數據的模式：</p><p>其中，URL的device_id,和下面的API_key換成自己設備的，可以在<strong>設備列表</strong>找到，就可以往自己設備的數據流模板傳一個值為3的value。</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RzRJbul6jSXmHR><p><strong>Micropython用HTTP</strong>UIFlow裡自帶了HTTP模塊，但是很玄學，<strong>很難用！</strong></p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzRJbwP1PJ4i4F><p>這裡筆者用Micropython自己寫了一份HTTP的傳輸：</p><pre>def http_put_data(data):<br>#post data into onenet<br>url='http://api.heclouds.com/devices/'+DEVICE_ID+'/datapoints'<br>values={'datastreams':[{"id":"temperature","datapoints":[{"value":data}]}]}<br>jdata = json.dumps(values)<br>r=urequests.post(url,data=jdata,headers={"api-key":API_KEY})<br>return r<br></pre><p>親測還是很好用的，可能是UIFlow自己的json封裝比較奇怪？</p><p><strong>使用模組交互的數據傳輸</strong></p><p>既然M5STACK可以同時使用多個模組，那麼自然也就可以使用模組來控制數據傳輸：</p><p>如：使用RFID卡，控制POST：</p><pre>rfid0 = unit.get(unit.RFID, unit.PORTA)<br><br>while(True):<br>if rfid0.isCardOn:<br>rsp = http_put_data(12)<br>emoji0.show_map([[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,1,1,1,1,1,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]], 0xff0000)<br>else:<br>#wlan.disconnect<br>#wlan.active(False)<br>emoji0.show_map([[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0]], 0xff0000)<br>wait(1)<br></pre><p><strong>第一行的rfid0 = unit.get(unit.RFID, unit.PORTA)是指定從PORTA讀取RFID的射頻信息</strong></p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTRIuPNI7JPB03><p><strong>使用HTTP的GET獲取b站信息</strong></p><p>有POST就要有GET，這裡介紹一個B站大佬“<strong>正負加減</strong>”的例程，獲取自己的粉絲數，裡面講解也很細緻,大佬也是老Geek了,關注不虧！<strong>UIFlow的GET結構：</strong>核心思想是知道<strong>哪個key是follow</strong>，可以在F5審查源代碼找到：</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RzRJbxOGYSihWs><p>此處的URL是</p><pre>http://api.bilibili.com/x/relation/stat?vmid=99566555<br></pre><p>UP和DOWN是控制RGB等的函數。</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzRJby1Bq5vkRn><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTRIuPaahjHjS><p><strong>我的片上系統設計全過程</strong></p><p><strong>設計初衷</strong>在疫情管控最嚴格的的時候，經常能看到觸目驚心的“<strong>尋找x月x日乘坐xxxx的乘客</strong>”，如果能追尋乘坐公共交通者的足跡，會給疫情管控帶來很大便利。<strong>設計方法</strong></p><p>筆者希望結合GPS，RFID和攝像頭功能，做個車載的識別信息-上報信息的小系統。</p><p>具體涉及到二維碼識別，RFID識別，GPS獲取和HTTP上報。</p><p>然而，這個設計一開始就遇到了難題。網上購買的測溫槍，他的藍牙數據我無法解包，好像是和<strong>騰訊連連</strong>有自己的相關配置。</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RzRJcmdEliYo36><p>騰訊連連界面：</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RzRJcnREhzsSk5><p>既然騰訊連連已經寫到那麼好了，那就不搶他的飯碗了。</p><p>既然沒辦法解析內容，那下面筆者將用ENV單元採集的環境溫度代替乘客溫度進行收發。</p><p><strong>分模塊實現</strong><strong>RFID控制塊</strong>首先聲明RFID模塊的串口：</p><pre>rfid0 = unit.get(unit.RFID, unit.PORTA)<br></pre><p>該段指從A口串入RFID模組</p><p>【注：M5STACK使用顏色標明瞭A,B,C三個Grove口，見下圖】</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzRJco9BOmAhmT><p>上圖中RFID的串口是紅色，就對應到M5GO左側的紅色接口：</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RzRJcpK8z8UTOV><p><strong>GRIVE HUB</strong><strong>由於筆者同時還需要使用紅色串口的ENV單元，因此額外購買了GROVE HUB</strong>：</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/RzRJcqB66D8FLd><p>這樣就有兩個A口了。</p><p>訪問設置時不需要加以區分,都從PORTA引入：</p><pre>rfid0 = unit.get(unit.RFID, unit.PORTA)<br>env0 = unit.get(unit.ENV, unit.PORTA)<br></pre><p>使用Emoji模塊做可視化：</p><p>筆者使用循環判斷是否有卡片接近，無則顯示待機Emoji，有則顯示✅</p><pre> #循環判斷是否有卡片接近<br>while(True):<br>#熄滅RGB燈<br>rgb.setBrightness(0)<br>#清空Emoji顯示<br>emoji0.show_map([[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]], 0x000000)<br>#判斷是否有卡片接近<br>if rfid0.isCardOn:<br>#有卡片接近顯示對號<br>emoji0.show_map([[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,1],[0,0,0,0,0,1,1],[1,0,0,0,1,1,0],[0,1,1,1,1,0,0],[0,0,1,1,0,0,0]], 0x33ff33)<br>#發送RFID讀取到的卡片ID<br>rsp_RFID = http_put_RFID((str(rfid0.readUid)))<br>#完成後指示燈變綠<br>rgb.setColorAll(0x33ff33)<br>rgb.setBrightness(10)<br>else:<br>#可選是否斷開wifi<br>#wlan.disconnect<br>#wlan.active(False)<br>#等待卡片接近時，Emoji展示"。。。"<br>emoji0.show_map([[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,1,0,1,0,1,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]], 0x000000)<br>wait(1)<br></pre><p>這裡的Emoji模塊是先在UIFlow裡敲好，再進Micropython裡查看的。</p><p><strong>HTTP傳輸塊</strong></p><p>HTTP傳輸在上文已經講了不少，這裡優先介紹GPS的傳輸：</p><p><strong>GPS的命令也是要加“value:”的，形如value:{“lon”:lon,“lat”:lat}，這個地方一開始把筆者坑的不輕</strong><strong>！</strong></p><pre>def http_put_location(lon,lat):<br>'''<br>傳輸地理位置數據點至ONENET平臺的location數據流<br>lon:longitude,經度<br>lat: latitude,緯度<br>url：http的post地址<br>values:請參考https://open.iot.10086.cn/doc/multiprotocol/ 文檔中的"HTTP協議上傳數據點模塊，配置json格式信息"<br>API_KEY:設備發送HTTP請求的證書，請參考https://open.iot.10086.cn/doc/multiprotocol/book/develop/http/api/api-usage.html 文檔中的"鑑權說明"<br>'''<br>url='http://api.heclouds.com/devices/YOUR-DEVICE-ID/datapoints'<br>values={'datastreams':[{"id":"location","datapoints":[{"value":{"lon":lon,"lat":lat}}]}]}<br>jdata = json.dumps(values)<br>r=urequests.post(url,data=jdata,headers={"api-key":API_KEY})<br>return r<br></pre><p>這裡請把YOUR-DEVICE-ID替換為自己的數據流中設備編號，參考<strong>ONENET手冊。</strong><strong>Wi-Fi連接塊</strong></p><p>UIflow裡封裝了很好的Wi-Fi-connect：</p><pre>wifiCfg.doConnect(SSID, PASSWORD)<br></pre><p>如果你的Micropython裡沒有一鍵Wi-Fi連接，筆者自己也實現了一個：</p><pre>def connectWifi(ssid,passwd):<br>'''<br>如果您的Micropython不攜帶WifiCfg.doconnect，請參考本函數<br>函數作用：連接至名稱為SSID，密碼為passwd的wifi<br>'''<br>global wlan<br>wlan=network.WLAN(network.STA_IF)<br>wlan.active(True)<br>wlan.disconnect<br>wlan.connect(ssid,passwd)<br>while(wlan.ifconfig[0]=='0.0.0.0'):<br>time.sleep(1)<br>return True<br></pre><p><strong>二維碼識別塊</strong></p><ul><li>本部分使用ESP-IDF編程<br></li><li><p>使用的攝像頭是M5CAMERA</p></li><li>屬性是OV2640<br></li></ul><p>參考<strong>官方例程</strong>：</p><pre>//拍攝<br>camera_fb_t* esp_camera_fb_get<br>{<br>if (s_state == ) {<br>return ;<br>}<br>if(!I2S0.conf.rx_start) {<br>if(s_state-&gt;config.fb_count &gt; 1) {<br>ESP_LOGD(TAG, "i2s_run");<br>}<br>if (i2s_run != 0) {<br>return ;<br>}<br>}<br>if(s_state-&gt;config.fb_count == 1) {<br>xSemaphoreTake(s_state-&gt;frame_ready, portMAX_DELAY);<br>}<br>if(s_state-&gt;config.fb_count == 1) {<br>return (camera_fb_t*)s_state-&gt;fb;<br>}<br>camera_fb_int_t * fb = ;<br>if(s_state-&gt;fb_out) {<br>xQueueReceive(s_state-&gt;fb_out, &amp;fb, portMAX_DELAY);<br>}<br>return (camera_fb_t*)fb;<br>}<br><br>//二維碼識別<br>void qr_recoginze(void *pdata) {<br><br>camera_fb_t *camera_config = pdata;<br><br>if(pdata==)<br>{<br>ESP_LOGI(TAG,"Camera Size err");<br>return;<br>}<br><br>struct quirc *q;<br>struct quirc_data qd;<br>uint8_t *image;<br>q = quirc_new;<br><br>if (!q) {<br>printf("can't create quirc object\r\n");<br>vTaskDelete ;<br>}<br>//printf("begin to quirc_resize\r\n");<br><br>if (quirc_resize(q, camera_config-&gt;width, camera_config-&gt;height)&lt; 0)<br>{<br>printf("quirc_resize err\r\n");<br>quirc_destroy(q);<br>vTaskDelete ;<br>}<br><br>image = quirc_begin(q, , );<br>memcpy(image, camera_config-&gt;buf, camera_config-&gt;len);<br>quirc_end(q);<br><br>int id_count = quirc_count(q);<br>if (id_count == 0) {<br>quirc_destroy(q);<br>return;<br>}<br><br>struct quirc_code code;<br>quirc_extract(q, 0, &amp;code);<br>quirc_decode(&amp;code, &amp;qd);<br>dump_info(q);<br>quirc_destroy(q);<br>}<br></pre><p>這裡依賴了太多官方庫…建議去代碼倉庫翻一翻。</p><p><strong>K210的二維碼識別</strong>上文是ESP32類型的開發板識別代碼，可以看到非常繁瑣，<strong>改起來簡直要了老命</strong>…使用Micropython的話，代碼就變的可愛多了~</p><p>【此部分使用Maxipy編程】</p><pre> import sensor<br>import image<br>import lcd<br>import time<br><br>clock = time.clock<br>lcd.init<br>sensor.reset<br>sensor.set_pixformat(sensor.RGB565)<br>sensor.set_framesize(sensor.QVGA)<br>sensor.set_vflip(1)<br>sensor.run(1)<br>sensor.skip_frames(30)<br>while True:<br>clock.tick<br>img = sensor.snapshot<br>res = img.find_qrcodes<br>fps =clock.fps<br>if len(res) &gt; 0:<br>img.draw_string(2,2, res[0].payload, color=(0,128,0), scale=2)<br>print(res[0].payload)<br>lcd.display(img)<br></pre><p>這裡<strong>Maxipy的官方文檔</strong>還給出了修正圖像的方法：<strong>如果使用了鏡頭，畫面會有扭曲，需要矯正畫面使用 lens_corr 函數來矯正，比如 2.8mm， img.lens_corr(1.8)</strong></p><p>（沒事翻一翻這個Maxipy的文檔還是很有啟發的，大概兩小時就能通讀一遍）</p><p><strong>GPS傳輸塊</strong></p><p>室內經常沒有信號（實測室外也很少有…）因此在傳遞GPS的時候筆者額外設計了防止無信號的代碼。</p><p>GPS的http傳輸函數已經在上文講了，此處和RFID卡片控制進行結合：</p><pre>if rfid0.isCardOn:<br>#有卡片接近顯示對號<br>emoji0.show_map([[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,1],[0,0,0,0,0,1,1],[1,0,0,0,1,1,0],[0,1,1,1,1,0,0],[0,0,1,1,0,0,0]], 0x33ff33)<br>#發送RFID讀取到的卡片ID<br>rsp_RFID = http_put_RFID((str(rfid0.readUid)))<br>#防止測試時無信號<br>if str(gps0.pos_quality) != "1" and str(gps0.pos_quality) != "6":<br>lon=116.39137751349433<br>lat=39.8969585128568<br>else:<br>#默認北京<br>lon=gps0.longitude<br>lat=gps0.latitude<br>try:<br>rsp_LOCATION=http_put_location(float(lon),float(lat))<br>except:<br>emoji0.show_map([[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,1],[0,0,0,0,0,1,1],[1,0,0,0,1,1,0],[0,1,1,1,1,0,0],[0,0,1,1,0,0,0]], 0xff0000)<br>#傳輸溫度<br>rsp = http_put_data(env0.temperature)<br>#完成後指示燈變綠<br>rgb.setColorAll(0x33ff33)<br>rgb.setBrightness(10)<br>else:<br>#可選是否斷開wifi<br>#wlan.disconnect<br>#wlan.active(False)<br>#等待卡片接近時，Emoji展示"。。。"<br>emoji0.show_map([[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,1,0,1,0,1,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]], 0x000000)<br>wait(1)<br></pre><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTYlVXmICmMrFE><p><strong>後記</strong></p><p>參賽時間倉促，沒能完全搞明白每個引腳的用途，沒有好好觸摸一遍C和開發板，沒有用NB-IOT通訊。沒有做藍牙通訊解包…還是有很多遺憾的，還好設備還在，可以繼續探索物聯網的神奇。</p><p><strong>成果效果：</strong></p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RzRJdZd2Ril03g><p>版權聲明：本文為CSDN博主「Haor.L」的原創文章，遵循CC 4.0 BY-SA版權協議，轉載請附上原文出處鏈接及本聲明。</p><p>原文鏈接：https://blog.csdn.net/weixin_46233323/article/details/106054434」</p><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/R69FpRH4d90a7d><img alt="零基礎物聯網開發，踩坑無數，得到這份寶典 | 原力計劃" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/Ryq1trhHccKmPg><pre><pre><p>☞程序員在家辦公沒顯示屏，我被領導鄙視了</p><p>☞Get！讀懂數據科學和機器學習，看這文就夠了</p><p>☞深度剖析數據庫國產化遷移之路</p><p>☞Go遠超Python，機器學習人才極度稀缺，全球16,655位程序員告訴你這些真相</p><p>☞我佛了！用KNN實現驗證碼識別，又 Get 到一招</p><p>☞超級賬本Hyperledger Fabric中的Protobuf到底是什麼？</p></pre></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>零基</a></li><li><a>物聯網</a></li><li><a>開發</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/a5e4b2c0.html alt=3種可靠的物聯網開發編程語言 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/cce65901deaf454780f300428a24b79c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a5e4b2c0.html title=3種可靠的物聯網開發編程語言>3種可靠的物聯網開發編程語言</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0f256292.html alt="C# 物聯網開發API接口系列（1）" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e4a95c1a212f4ff9afcb589e5d0f95cb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0f256292.html title="C# 物聯網開發API接口系列（1）">C# 物聯網開發API接口系列（1）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1d4b3a99.html alt=人人在談的物聯網，入門開發是真難 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/e521a539-76b3-49aa-b7eb-06ac2d0507fd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1d4b3a99.html title=人人在談的物聯網，入門開發是真難>人人在談的物聯網，入門開發是真難</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f9ecb742.html alt=人人在談的物聯網，入門開發真難 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/Rbk076A59amtF9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f9ecb742.html title=人人在談的物聯網，入門開發真難>人人在談的物聯網，入門開發真難</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c3c9a01e.html alt=影響物聯網開發成本的5個主要因素 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5f6473765f874fc399db6d68d4f9ff7c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c3c9a01e.html title=影響物聯網開發成本的5個主要因素>影響物聯網開發成本的5個主要因素</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7a4eaa47.html alt=找到了！物聯網開發“祕笈”原來在這 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1e857b0ac044412c85d68c045686d46a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7a4eaa47.html title=找到了！物聯網開發“祕笈”原來在這>找到了！物聯網開發“祕笈”原來在這</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cd1413e3.html alt=智能物聯網APP開發，物聯網項目開發 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/4dad31b993124ee884d65a7e8c7b471b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cd1413e3.html title=智能物聯網APP開發，物聯網項目開發>智能物聯網APP開發，物聯網項目開發</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a827bd2c.html alt=為何以及如何增加物聯網開發的多樣性 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/ddd8c83833744481a721427512c6b0c1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a827bd2c.html title=為何以及如何增加物聯網開發的多樣性>為何以及如何增加物聯網開發的多樣性</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4bfef84e.html alt=物聯網之——基於塗鴉平臺開發智能設備(一) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/a1894e6f92464924a2b79e6322d185ff style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4bfef84e.html title=物聯網之——基於塗鴉平臺開發智能設備(一)>物聯網之——基於塗鴉平臺開發智能設備(一)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b4b5bebc.html alt=物聯網方案開發的那些事兒 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/035e3e707eba48779b05c3eab305cc5d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b4b5bebc.html title=物聯網方案開發的那些事兒>物聯網方案開發的那些事兒</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/035d57d2.html alt="物聯網硬件產品開發方法 如何將想法長期轉變為可行的產品做準備" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f417c7ac795c4112a98a78bca7131e53 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/035d57d2.html title="物聯網硬件產品開發方法 如何將想法長期轉變為可行的產品做準備">物聯網硬件產品開發方法 如何將想法長期轉變為可行的產品做準備</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/749947bc.html alt=物聯網開發中加強安全性的4種最佳方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/749947bc.html title=物聯網開發中加強安全性的4種最佳方法>物聯網開發中加強安全性的4種最佳方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3e3cc3c6.html alt=物聯網開發之ZigBee，實現智能家居 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/eea45cbc4df24af5a8a9871a0abc5db9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3e3cc3c6.html title=物聯網開發之ZigBee，實現智能家居>物聯網開發之ZigBee，實現智能家居</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7dc97f07.html alt=物聯網開發接口API雲服務器IIS部署及域名解析定向 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/2149450612d7407fbefcec8e9b5709d9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7dc97f07.html title=物聯網開發接口API雲服務器IIS部署及域名解析定向>物聯網開發接口API雲服務器IIS部署及域名解析定向</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4016c284.html alt=物聯網開發的特色以及重要性，讓生活變的更有科技感！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b77232641acd4916bbbdbd52c8a07e13 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4016c284.html title=物聯網開發的特色以及重要性，讓生活變的更有科技感！>物聯網開發的特色以及重要性，讓生活變的更有科技感！</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>