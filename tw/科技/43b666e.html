<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Mysql進階-存儲過程 | 极客快訊</title><meta property="og:title" content="Mysql進階-存儲過程 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/15379551361751db25328d2"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/43b666e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/43b666e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/43b666e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/43b666e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/43b666e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/43b666e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/43b666e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/43b666e.html><meta property="article:published_time" content="2020-10-29T20:51:12+08:00"><meta property="article:modified_time" content="2020-10-29T20:51:12+08:00"><meta name=Keywords content><meta name=description content="Mysql進階-存儲過程"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/43b666e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Mysql進階-存儲過程</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>測試環境</h1><p>mysql-5.7.20 -log , win10</p><h1>為什麼需要存儲過程</h1><p>一組可編程的函數，是為了完成特定功能的SQL語句集，經編譯創建並保存在數據庫中，用戶可通過指定存儲過程的名字並給定參數(需要時)來調用執行。</p><p>優勢：</p><p>①將重複性很高的一些操作，封裝到一個存儲過程中，簡化了對這些SQL的調用</p><p>②批量處理：SQL+循環，減少流量，也就是“跑批”</p><p>③統一接口，確保數據的安全</p><h1>創建存儲過程</h1><pre>CREATE [DEFINER = { user | CURRENT_USER }]　PROCEDURE sp_name ([proc_parameter[,...]]) [characteristic ...] routine_bodyproc_parameter: [ IN | OUT | INOUT ] param_name typecharacteristic: COMMENT 'string' | LANGUAGE SQL | [NOT] DETERMINISTIC | { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA } | SQL SECURITY { DEFINER | INVOKER }routine_body:　　Valid SQL routine statement[begin_label:] BEGIN　　[statement_list]　　　　……END [end_label]</pre><div class=pgc-img><img alt=Mysql進階-存儲過程 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15379551361751db25328d2><p class=pgc-img-caption>測試表</p></div><div class=pgc-img><img alt=Mysql進階-存儲過程 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15379551748824803249250><p class=pgc-img-caption>創建存儲過程並執行</p></div><pre>IN輸入參數類型，OUT輸出參數類型，而INOUT既是輸入類型又是輸出類型，所謂的IN輸入參數類型就是把要傳遞的參數輸入到存儲過程的內部以便編寫存儲過程流程語句時可以使用。上述演示過的例子就是這種類型。關鍵字OUT則是指明相應參數用來從存儲過程傳出的一個值,也可以理解為存儲過程的返回值，而對於INOUT則是兩者結合體</pre><p>默認情況下，存儲過程和默認數據庫相關聯，如果想指定存儲過程創建在某個特定的數據庫下，那麼在過程名前面加數據庫名做前綴；</p><p>在定義過程時，使用DELIMITER $$ 命令將語句的結束符號從分號 ; 臨時改為兩個$$，使得過程體中使用的分號被直接傳遞到服務器，而不會被客戶端（如mysql）解釋。</p><p><strong>下面演示OUT參數，創建一個存儲過程，用來輸出level的最大值，最小值和平均值</strong></p><div class=pgc-img><img alt=Mysql進階-存儲過程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1538013897735e05072dae9><p class=pgc-img-caption>OUT參數示例</p></div><h1>存儲體過程</h1><p>存儲過程體包含了在過程調用時必須執行的語句，例如：dml、ddl語句，if-then-else和while-do語句、聲明變量的declare語句等</p><p>過程體格式：以begin開始，以end結束(可嵌套)</p><pre>BEGIN　　BEGIN　　　　BEGIN　　　　　　statements; 　　　　END　　ENDEND</pre><p>每個嵌套塊及其中的每條語句，必須以分號結束，表示過程體結束的begin-end塊(又叫做複合語句compound statement)，則不需要分號。</p><h1>為語句塊貼標籤</h1><pre>[begin_label:] BEGIN　　[statement_list]END [end_label]sh示例label1: BEGIN　　label2: BEGIN　　　　label3: BEGIN　　　　　　statements; 　　　　END label3 ;　　END label2;END label1標籤的作用：①增強代碼的可讀性②在某些語句(例如:leave和iterate語句)，需要用到標籤</pre><h1><strong>刪除存儲過程</strong></h1><p>DROP PROCEDURE [IF EXISTS] 存儲過程名稱;</p><h1><strong>查看存儲過程的狀態</strong></h1><p>SHOW PROCEDURE STATUS [LIKE 'pattern']</p><div class=pgc-img><img alt=Mysql進階-存儲過程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15380144021579bdad31993><p class=pgc-img-caption></p></div><h1><strong>查看存儲過程的創建語句</strong></h1><p>SHOW CREATE PROCEDURE 存儲過程名;</p><div class=pgc-img><img alt=Mysql進階-存儲過程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15380144939801a449e6b32><p class=pgc-img-caption></p></div><h1><strong>存儲過程的流程控制語句</strong></h1><p>1.<strong>IF 條件語句</strong></p><pre>IF 條件表達式1 THEN 條件表達式1為true執行[ELSEIF 條件表達式2 THEN 條件表達式2為true執行 ] [ELSE 全部條件為false時執行] END IF；</pre><p>2.<strong>多分支條件語句</strong></p><pre>CASE 表達式1 WHEN 值1 THEN 表達式=值1時執行命令 [WHEN 值N THEN 表達式=值N時執行該語句] [ELSE 上述值以外執行該語句]END CASE </pre><p>3.<strong>repeat 循環控制語句</strong></p><pre>REPEAT  直至條件表達式為True時執行的語句UNTIL 條件表達式 END REPEAT;</pre><p>4.<strong>while循環控制語句</strong></p><pre>WHILE 條件表達式 DO  系列語句END WHILE</pre><h1><strong>使用DECLARE定義局部變量</strong></h1><pre>DECLARE 變量名[,變量名2...] 數據類型(type) [DEFAULT value];-- 定義變量num，數據類型為INT型，默認值為10DECLARE num INT DEFAULT 10 ; </pre><p>DECLARE關鍵字是用來聲明變量的；變量名即變量的名稱，這裡可以同時定義多個變量；type參數用來指定變量的類型；DEFAULT value子句將變量默認值設置為value，沒有使用DEFAULT子句時，默認值為NULL。聲明後，我們就可以在存儲過程使用該變量，設置變量值可以使用以下語法：</p><pre>SET 變量名1 = expr [, 變量名2 = expr] ... </pre><p>其中，SET關鍵字是用來為變量賦值的；expr參數是賦值表達式或某個值。一個SET語句可以同時為多個變量賦值，各個變量的賦值語句之間用逗號隔開。除了這種賦值方式，前面我們還提到過使用SELECT…INTO語句為變量賦值，那也是可行的。</p><h1>其他變量定義</h1><p>1.用戶變量：以”@”開始，形式為”@變量名”，用戶變量跟mysql客戶端是綁定的，設置的變量，只對當前用戶使用的客戶端生效，聲明或者定義用戶變量使用set語句，如 set @var 若沒有指定GLOBAL 或SESSION ，那麼默認將會定義用戶變量。</p><pre>mysql&gt; SET @@global.sort_buffer_size=value</pre><p>2.全局變量：定義時，以如下兩種形式出現，set GLOBAL 變量名 或者 set @@global.name，對所有客戶端生效。只有具有super權限才可以設置全局變量。</p><pre>mysql&gt; SET GLOBAL sort_buffer_size=value;</pre><p>3.會話變量：只對連接的客戶端有效。</p><pre>mysql&gt; SET SESSION sort_buffer_size=value;</pre></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Mysql</a></li><li><a>進階</a></li><li><a>存儲</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/4ab1dd0d.html alt=Mysql事務 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4ab1dd0d.html title=Mysql事務>Mysql事務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cb944fe7.html alt=Mysql事務詳解(一文讀懂數據庫事務) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/cb7ba6cbda8c44438d9d3d7c57bd25b9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cb944fe7.html title=Mysql事務詳解(一文讀懂數據庫事務)>Mysql事務詳解(一文讀懂數據庫事務)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/33348acb.html alt=《深入精通Mysql（三）》深入底層Mysql各種鎖機制（面試必問） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/470f515e8fe44c6184b07227fdb51333 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/33348acb.html title=《深入精通Mysql（三）》深入底層Mysql各種鎖機制（面試必問）>《深入精通Mysql（三）》深入底層Mysql各種鎖機制（面試必問）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dbb4fd63.html alt="Mysql --09 Innodb核心特性——事務" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/47618d6931fd4518a4d78c0e13623b98 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dbb4fd63.html title="Mysql --09 Innodb核心特性——事務">Mysql --09 Innodb核心特性——事務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4e632b6e.html alt=PHP進階教程-PHP的協程怎麼玩？這一篇帶你搞定swoole協程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a646cf102cf74b4a953855ebedbc7d29 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4e632b6e.html title=PHP進階教程-PHP的協程怎麼玩？這一篇帶你搞定swoole協程>PHP進階教程-PHP的協程怎麼玩？這一篇帶你搞定swoole協程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cd56e2f3.html alt=PHP進階教程-PHP還能玩多線程？看我怎麼用多線程實現CC攻擊器。 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/cce9b3fb23ce41b88311823510e419da style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cd56e2f3.html title=PHP進階教程-PHP還能玩多線程？看我怎麼用多線程實現CC攻擊器。>PHP進階教程-PHP還能玩多線程？看我怎麼用多線程實現CC攻擊器。</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/637cf111.html alt=PHP進階教程-phper需要知道常駐內存中的上下文是什麼東西 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/bc66832213514f2996f2e48c9e9cc747 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/637cf111.html title=PHP進階教程-phper需要知道常駐內存中的上下文是什麼東西>PHP進階教程-phper需要知道常駐內存中的上下文是什麼東西</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e3b6719c.html alt=PHP進階教程-一文理解和實現現代PHP框架裡的IOC容器 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/423ce7eefc5d433f86a14589b1ba0043 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e3b6719c.html title=PHP進階教程-一文理解和實現現代PHP框架裡的IOC容器>PHP進階教程-一文理解和實現現代PHP框架裡的IOC容器</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fe9184d7.html alt=PHP進階教程-實現一個簡單的MySQL連接池 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/aa2df096a4274ba1b5c8540bcb5b5c73 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fe9184d7.html title=PHP進階教程-實現一個簡單的MySQL連接池>PHP進階教程-實現一個簡單的MySQL連接池</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/45c31c17.html alt=PHP進階教程-設計模式之建造者模式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ef25f91086df41eca76e35ff3434b003 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/45c31c17.html title=PHP進階教程-設計模式之建造者模式>PHP進階教程-設計模式之建造者模式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b034084e.html alt=PHP進階教程-設計模式之橋接模式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3719c139b93342fe9e5526fa59ca1c89 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b034084e.html title=PHP進階教程-設計模式之橋接模式>PHP進階教程-設計模式之橋接模式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a89954da.html alt=PHP進階教程-設計模式之組合模式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6f2acee37d624649ac7a592bfe5b29af style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a89954da.html title=PHP進階教程-設計模式之組合模式>PHP進階教程-設計模式之組合模式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/baec5ab6.html alt=PHP進階教程-設計模式之裝飾器模式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8cbbfcfedd544572a62adc6df84d2e60 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/baec5ab6.html title=PHP進階教程-設計模式之裝飾器模式>PHP進階教程-設計模式之裝飾器模式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0e65b3f7.html alt=分佈式存儲Ceph可靠性的量化分析 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/c4bbbd3f6cdc4f2ab77a1580836190f5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0e65b3f7.html title=分佈式存儲Ceph可靠性的量化分析>分佈式存儲Ceph可靠性的量化分析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5590a998.html alt=用戶數據安全存儲，華為雲空間這些功能大顯身手 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/887465ccc97d4682a73e7ff408e38d54 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5590a998.html title=用戶數據安全存儲，華為雲空間這些功能大顯身手>用戶數據安全存儲，華為雲空間這些功能大顯身手</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>