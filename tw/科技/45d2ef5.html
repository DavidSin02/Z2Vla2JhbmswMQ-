<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ALIENTEK 阿波羅 STM32F767 開發板資料連載第九章 外部中斷實驗 | 极客快訊</title><meta property="og:title" content="ALIENTEK 阿波羅 STM32F767 開發板資料連載第九章 外部中斷實驗 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/9d1edd66723f4966b44d3cab502c055f"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/45d2ef5.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/45d2ef5.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/45d2ef5.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/45d2ef5.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/45d2ef5.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/45d2ef5.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/45d2ef5.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/45d2ef5.html><meta property="article:published_time" content="2020-10-29T20:50:02+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:02+08:00"><meta name=Keywords content><meta name=description content="ALIENTEK 阿波羅 STM32F767 開發板資料連載第九章 外部中斷實驗"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/45d2ef5.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ALIENTEK 阿波羅 STM32F767 開發板資料連載第九章 外部中斷實驗</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><strong>1）實驗平臺：</strong>alientek 阿波羅 STM32F767 開發板<br><strong>2）摘自《STM32F7 開發指南(HAL 庫版)》關注官方微信號公眾號，獲取更多資料：正點原子</strong><br></p><div class=pgc-img><img alt="ALIENTEK 阿波羅 STM32F767 開發板資料連載第九章 外部中斷實驗" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9d1edd66723f4966b44d3cab502c055f><p class=pgc-img-caption></p></div><p><strong>第九章 外部中斷實驗</strong></p><p>這一章，我們將向大家介紹如何使用 STM32F7 的外部輸入中斷。在前面幾章的學習中，</p><p>我們掌握了 STM32F7 的 IO 口最基本的操作。本章我們將介紹如何將 STM32F7 的 IO 口作為外</p><p>部中斷輸入，在本章中，我們將以中斷的方式，實現我們在第七章所實現的功能。本章分為如</p><p>下幾個部分：</p><p>9.1 STM32F7 外部中斷簡介</p><p>9.2 硬件設計</p><p>9.3 軟件設計</p><p>9.4 下載驗證</p><p>9.5 STM32CubeMX 配置外部中斷</p><p><strong>9.1 STM32F7 外部中斷簡介</strong></p><p>STM32F7 的 IO 口在第六章有詳細介紹，而中斷優先級分組管理在前面也有詳細的闡述。</p><p>這裡我們將介紹 STM32F7 外部 IO 口的中斷功能，通過中斷的功能，達到第八章實驗的效果，</p><p>即：通過板載的 4 個按鍵，控制板載的兩個 LED 的亮滅。</p><p>這裡我們首先講解 STM32F7 IO 口中斷的一些基礎概念。STM32F7 的每個 IO 都可以作為</p><p>外部中斷的中斷輸入口，這點也是 STM32F7 的強大之處。STM32F7 的中斷控制器支持 22 個外</p><p>部中斷/事件請求。每個中斷設有狀態位，每個中斷/事件都有獨立的觸發和屏蔽設置。STM32F7</p><p>的 23 個外部中斷為：</p><p>EXTI 線 0~15：對應外部 IO 口的輸入中斷。</p><p>EXTI 線 16：連接到 PVD 輸出。</p><p>EXTI 線 17：連接到 RTC 鬧鐘事件。</p><p>EXTI 線 18：連接到 USB OTG FS 喚醒事件。</p><p>EXTI 線 19：連接到以太網喚醒事件。</p><p>EXTI 線 20：連接到 USB OTG HS(在 FS 中配置)喚醒事件。</p><p>EXTI 線 21：連接到 RTC 入侵和時間戳事件。</p><p>EXTI 線 22：連接到 RTC 喚醒事件。</p><p>EXTI 線 23：連接到 LPTIM1 異步事件。</p><p>從上面可以看出，中斷線 0-15 對應外部 IO 口的輸入中斷，一共是 16 個外部中斷線。</p><p>STM32F7 供 IO 口使用的中斷線只有 16 個，但是 STM32F7 的 IO 口卻遠遠不止 16 個，那麼</p><p>STM32F7 是怎麼把 16 箇中斷線和 IO 口一一對應起來的呢？於是 STM32 就這樣設計，GPIO</p><p>的引腳 GPIOx.0~GPIOx.15(x=A,B,C,D,E，F,G,H,I)分別對應中斷線 0~15。這樣每個中斷線對應</p><p>了最多 9 個 IO 口，以線 0 為例：它對應了 GPIOA.0、GPIOB.0、GPIOC.0、GPIOD.0、GPIOE.0、</p><p>GPIOF.0、GPIOG.0,GPIOH.0,GPIOI.0。而中斷線每次只能連接到 1 個 IO 口上，這樣就需要通</p><p>過配置來決定對應的中斷線配置到哪個 GPIO 上了。下面我們看看 GPIO 跟中斷線的映射關係</p><p>圖：</p><div class=pgc-img><img alt="ALIENTEK 阿波羅 STM32F767 開發板資料連載第九章 外部中斷實驗" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/317c93308b3e4b06b2a3d8c68ea95b2a><p class=pgc-img-caption>圖 9.1.1 GPIO 和中斷線的映射關係圖</p></div><p><br></p><p>GPIO 和中斷線映射關係是在寄存器 SYSCFG_EXTICR1~ SYSCFG_EXTICR4 中配置的。</p><p>所以我們要配置外部中斷，還需要打開 SYSCFG 時鐘。</p><p>接下來我們來看看使用 HAL 庫配置外部中斷的一般步驟。HAL 中外部中斷相關配置函數</p><p>和定義在文件 stm32f7xx_hal_exti.h 和 stm32f7xx_hal_exti.c 文件中。</p><p><strong>1) 使能 IO 口時鐘。</strong></p><p>首先，我們要使用 IO 口作為中斷輸入，所以我們要使能相應的 IO 口時鐘，具體的操作方</p><p>法跟我們按鍵實驗是一致的，這裡就不做過多講解。</p><p><strong>2) 設置 IO 口模式，觸發條件，開啟 SYSCFG 時鐘，設置 IO 口與中斷線的映射關係。</strong></p><p>該步驟如果我們使用標準庫那麼需要多個函數分部實現。而當我們使用 HAL 庫的時候，</p><p>則都是在函數 HAL_GPIO_Init 中一次性完成的。例如我們要設置 PA0 鏈接中斷線 0，並且為上</p><p>升沿觸發，代碼為：GPIO_InitTypeDef GPIO_Initure;</p><p>GPIO_Initure.Pin=GPIO_PIN_0;</p><p>//PA0</p><p>GPIO_Initure.Mode=GPIO_MODE_IT_RISING; //外部中斷，上升沿觸發</p><p>GPIO_Initure.Pull=GPIO_PULLDOWN;</p><p>//默認下拉</p><p>HAL_GPIO_Init(GPIOA,&GPIO_Initure);</p><p>當我們調用 HAL_GPIO_Init 設置 IO 的 Mode 值為 GPIO_MODE_IT_RISING（外部中斷上</p><p>升 沿 觸 發 ）， GPIO_MODE_IT_FALLING （ 外 部 中 斷 下 降 沿 觸 發 ） 或 者</p><p>GPIO_MODE_IT_RISING_FALLING（外部中斷雙邊沿觸發）的時候，該函數內部會通過判斷</p><p>Mode 的值來開啟 SYSCFG 時鐘，並且設置 IO 口和中斷線的映射關係。</p><p>因為我們這裡初始化的是 PA0，根據圖 9.1.1 可知，調用該函數後中斷線 0 會自動連接到</p><p>PA0。如果某個時間，我們又同樣的方式初始化了 PB0，那麼 PA0 與中斷線的鏈接將被清除，</p><p>而直接鏈接 PB0 到中斷線 0。</p><p><strong>3) 配置中斷優先級（NVIC），並使能中斷。</strong></p><p>我們設置好中斷線和 GPIO 映射關係，然後又設置好了中斷的觸發模式等初始化參數。既</p><p>然是外部中斷，涉及到中斷我們當然還要設置 NVIC 中斷優先級。這個在前面已經講解過，這</p><p>裡我們就接著上面的範例， 設置中斷線 0 的中斷優先級並使能外部中斷 0 的方法為：</p><p>HAL_NVIC_SetPriority(EXTI0_IRQn,2,1); //搶佔優先級為 2，子優先級為 1</p><p>HAL_NVIC_EnableIRQ(EXTI0_IRQn); //使能中斷線 2</p><p>上面這段代碼相信大家都不陌生，我們在前面的串口實驗的時候講解過，這裡不再講解。</p><p><strong>4) 編寫中斷服務函數。</strong></p><p>我們配置完中斷優先級之後，接著要做的就是編寫中斷服務函數。中斷服務函數的名字是</p><p>在 HAL 庫中事先有定義的。這裡需要說明一下，STM32F7 的 IO 口外部中斷函數只有 7 個，分</p><p>別為：</p><p>void EXTI0_IRQHandler();</p><p>void EXTI1_IRQHandler();</p><p>void EXTI2_IRQHandler();</p><p>void EXTI3_IRQHandler();</p><p>void EXTI4_IRQHandler();</p><p>void EXTI9_5_IRQHandler();</p><p>void EXTI15_10_IRQHandler();</p><p>中斷線 0-4 每個中斷線對應一箇中斷函數，中斷線 5-9 共用中斷函數 EXTI9_5_IRQHandler，中</p><p>斷線 10-15 共用中斷函數 EXTI15_10_IRQHandler。一般情況下，我們可以把中斷控制邏輯直接</p><p>編寫在中斷服務函數中，但是 HAL 庫把中斷處理過程進行了簡單封裝，請看下面步驟 5 講解。</p><p><strong>5） 編寫中斷處理回調函數 HAL_GPIO_EXTI_Callback</strong></p><p>在使用 HAL 庫的時候，我們也可以跟使用標準庫一樣，在中斷服務函數中編寫控制邏輯。</p><p>但 是 HAL 庫 為 了 用 戶 使 用 方 便 ， 它 提 供 了 一 個 中 斷 通 用 入 口 函 數</p><p>HAL_GPIO_EXTI_IRQHandler，在該函數內部直接調用回調函數 HAL_GPIO_EXTI_Callback。</p><p>我們可以看看 HAL_GPIO_EXTI_IRQHandler 函數定義：</p><p>void HAL_GPIO_EXTI_IRQHandler(uint16_t GPIO_Pin)</p><p>{</p><p>if(__HAL_GPIO_EXTI_GET_IT(GPIO_Pin) != RESET)</p><p>{</p><p>__HAL_GPIO_EXTI_CLEAR_IT(GPIO_Pin);</p><p><strong>HAL_GPIO_EXTI_Callback(GPIO_Pin);</strong></p><p>}</p><p>}</p><p>該函數實現的作用非常簡單，通過入口參數 GPIO_Pin 判斷中斷來自哪個 IO 口，然後清除</p><p>相應的中斷標誌位，最後調用回調函數 HAL_GPIO_EXTI_Callback()實現控制邏輯。所以我們</p><p>編寫中斷控制邏輯將跟串口實驗類似，在所有的外部中斷服務函數中直接調用外部中斷共用處</p><p>理函數 HAL_GPIO_EXTI_IRQHandler，然後在回調函數 HAL_GPIO_EXTI_Callback 中通過判</p><p>斷中斷是來自哪個 IO 口編寫相應的中斷服務控制邏輯。</p><p>講到這裡，相信大家對 STM32 的 IO 口外部中斷已經有了一定的瞭解。下面我們再總結一</p><p>下配置 IO 口外部中斷的一般步驟：</p><p>1）使能 IO 口時鐘。</p><p>2）調用函數 HAL_GPIO_Init 設置 IO 口模式，觸發條件，使能 SYSCFG 時鐘以及設置 IO</p><p>口與中斷線的映射關係。</p><p>3）配置中斷優先級（NVIC），並使能中斷。</p><p>4）在中斷服務函數中調用外部中斷共用入口函數 HAL_GPIO_EXTI_IRQHandler。</p><p>5）編寫外部中斷回調函數 HAL_GPIO_EXTI_Callback 實現控制邏輯。</p><p>通過以上幾個步驟的設置，我們就可以正常使用外部中斷了。</p><p>本章，我們要實現同第七章差不多的功能，但是這裡我們使用的是中斷來檢測按鍵，還是</p><p>KEY_UP 控制 DS0，DS1 互斥點亮；KEY2 控制 DS0，按一次亮，再按一次滅；KEY1 控制 DS1，</p><p>效果同 KEY2；KEY0 則同時控制 DS0 和 DS1，按一次，他們的狀態就翻轉一次。</p><p><strong>9.2 硬件設計</strong></p><p>本實驗用到的硬件資源和第七章實驗的一模一樣，不再多做介紹了。</p><p><strong>9.3 軟件設計</strong></p><p>我們直接打開我們的光盤的實驗 3 外部中斷實驗工程，可以看到相比上一個工程，我們的</p><p>HARDWARE 目錄下面增加了 exti.c 文件，並且包含了頭文件 exti.h。extic.c 文件代碼如下：</p><p>//外部中斷初始化</p><p>void EXTI_Init(void)</p><p>{</p><p>GPIO_InitTypeDef GPIO_Initure;</p><p>__HAL_RCC_GPIOA_CLK_ENABLE();</p><p>//開啟 GPIOA 時鐘</p><p>__HAL_RCC_GPIOC_CLK_ENABLE(); //開啟 GPIOC 時鐘</p><p>__HAL_RCC_GPIOH_CLK_ENABLE();</p><p>//開啟 GPIOH 時鐘</p><p>GPIO_Initure.Pin=GPIO_PIN_0; //PA0</p><p>GPIO_Initure.Mode=GPIO_MODE_IT_RISING; //上升沿觸發</p><p>GPIO_Initure.Pull=GPIO_PULLDOWN;</p><p>//下拉</p><p>HAL_GPIO_Init(GPIOA,&GPIO_Initure);</p><p>GPIO_Initure.Pin=GPIO_PIN_13; //PC13</p><p>GPIO_Initure.Mode=GPIO_MODE_IT_FALLING; //下降沿觸發</p><p>GPIO_Initure.Pull=GPIO_PULLUP;</p><p>//上拉</p><p>HAL_GPIO_Init(GPIOC,&GPIO_Initure);</p><p>GPIO_Initure.Pin=GPIO_PIN_2|GPIO_PIN_3; //PH2,3 下降沿觸發，上拉</p><p>HAL_GPIO_Init(GPIOH,&GPIO_Initure);</p><p>//中斷線 0</p><p>HAL_NVIC_SetPriority(EXTI0_IRQn,2,0); //搶佔優先級為 2，子優先級為 0</p><p>HAL_NVIC_EnableIRQ(EXTI0_IRQn);</p><p>//使能中斷線 0</p><p>//中斷線 2</p><p>HAL_NVIC_SetPriority(EXTI2_IRQn,2,1); //搶佔優先級為 2，子優先級為 1</p><p>HAL_NVIC_EnableIRQ(EXTI2_IRQn);</p><p>//使能中斷線 2</p><p>//中斷線 3</p><p>HAL_NVIC_SetPriority(EXTI3_IRQn,2,2); //搶佔優先級為 2，子優先級為 2</p><p>HAL_NVIC_EnableIRQ(EXTI3_IRQn);</p><p>//使能中斷線 2</p><p>//中斷線 13</p><p>HAL_NVIC_SetPriority(EXTI15_10_IRQn,2,3); //搶佔優先級為 3，子優先級為 3</p><p>HAL_NVIC_EnableIRQ(EXTI15_10_IRQn); //使能中斷線 13</p><p>}</p><p>//中斷服務函數</p><p>void EXTI0_IRQHandler(void)</p><p>{</p><p>HAL_GPIO_EXTI_IRQHandler(GPIO_PIN_0); //調用中斷處理公用函數</p><p>}</p><p>void EXTI2_IRQHandler(void)</p><p>{</p><p>HAL_GPIO_EXTI_IRQHandler(GPIO_PIN_2); //調用中斷處理公用函數</p><p>}</p><p>void EXTI3_IRQHandler(void)</p><p>{</p><p>HAL_GPIO_EXTI_IRQHandler(GPIO_PIN_3); //調用中斷處理公用函數</p><p>}</p><p>void EXTI15_10_IRQHandler(void)</p><p>{</p><p>HAL_GPIO_EXTI_IRQHandler(GPIO_PIN_13); //調用中斷處理公用函數</p><p>}</p><p>//中斷服務程序中需要做的事情</p><p>//在 HAL 庫中所有的外部中斷服務函數都會調用此函數</p><p>//GPIO_Pin:中斷引腳號</p><p>void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin)</p><p>{</p><p>static u8 led0sta=1,led1sta=1;</p><p>delay_ms(50); //消抖</p><p>switch(GPIO_Pin)</p><p>{</p><p>case GPIO_PIN_0:</p><p>if(WK_UP==1)</p><p>//控制 LED0,LED1 互斥點亮</p><p>{</p><p>led1sta=!led1sta;</p><p>led0sta=!led1sta;</p><p>LED1(led1sta);</p><p>LED0(led0sta);</p><p>}</p><p>break;</p><p>case GPIO_PIN_2:</p><p>if(KEY1==0) //控制 LED1 翻轉</p><p>{</p><p>led1sta=!led1sta;</p><p>LED1(led1sta);</p><p>};</p><p>break;</p><p>case GPIO_PIN_3:</p><p>if(KEY0==0)</p><p>//同時控制 LED0,LED1 翻轉</p><p>{</p><p>led1sta=!led1sta;</p><p>led0sta=!led0sta;</p><p>LED1(led1sta);</p><p>LED0(led0sta);</p><p>}</p><p>break;</p><p>case GPIO_PIN_13:</p><p>if(KEY2==0)</p><p>//控制 LED0 翻轉</p><p>{</p><p>led0sta=!led0sta;</p><p>LED0(led0sta);</p><p>}</p><p>break;</p><p>}</p><p>}</p><p>exti.c 文件總共包含 6 個函數。外部中斷初始化函數 void EXTIX_Init 用來配置 IO 口外部中</p><p>斷相關步驟並使能中斷，另一個函數 HAL_GPIO_EXTI_Callback 是外部中斷共用回調函數，用</p><p>來處理所有外部中斷真正的控制邏輯。其他 4 個都是中斷服務函數。</p><p>void EXTI0_IRQHandler(void)是外部中斷 0 的服務函數，負責 KEY_UP 按鍵的中斷檢測；</p><p>void EXTI2_IRQHandler(void)是外部中斷 2 的服務函數，負責 KEY2 按鍵的中斷檢測；</p><p>void EXTI3_IRQHandler(void)是外部中斷 3 的服務函數，負責 KEY1 按鍵的中斷檢測；</p><p>void EXTI4_IRQHandler(void)是外部中斷 4 的服務函數，負責 KEY0 按鍵的中斷檢測；</p><p>下面我們分別介紹這幾個函數。</p><p>首先是外部中斷初始化函數 void EXTIX_Init(void)，該函數內部主要做了兩件事情。先是</p><p>調用 IO 口初始化函數 HAL_GPIO_Init 來初始化 IO 口，該函數的配置含義請看 9.1 小節中關於</p><p>HAL_GPIO_Init 函數講解，然後設置中斷優先級並使能中斷線。</p><p>接下來我們看看外部中斷服務函數，一共 4 個。所有的中斷服務函數內部都只調用了同樣</p><p>一個函數 HAL_GPIO_EXTI_IRQHandler，該函數是外部中斷共用入口函數，函數內部會進行中</p><p>斷標誌位清零， 並且調用中斷處理共用回調函數 HAL_GPIO_EXTI_Callback。這在 9.1 小節我</p><p>們也有詳細的講解。</p><p>最後是外部中斷回調函數 HAL_GPIO_EXTI_Callback，該函數用來編寫真正的外部中斷控</p><p>制邏輯。該函數有一個入口參數就是 IO 口序號。所以我們在該函數內部，一般通過判斷 IO 口</p><p>序號值來確定中斷是來自哪個 IO 口，也就是哪個中斷線，然後編寫相應的控制邏輯。所以在</p><p>該函數內部，我們通過 switch 語句判斷 IO 口來源，例如是來自 GPIO_PIN_0，那麼一定是來自</p><p>PA0，因為中斷線一次只能連接一個 IO 口，而四個 IO 口中序號為 0 的 IO 口只有 PA0，所以中</p><p>斷線 0 一定是連接 PA0，也就是外部中斷由 PA0 觸發。在回調函數內部，我們僅僅只是編寫了</p><p>簡單的測試邏輯，通過不同的中斷來源來控制 DS0 和 DS1 的狀態。</p><p>接下來我們看看主函數，main 函數代碼如下：</p><p>int main(void)</p><p>{</p><p>Cache_Enable(); //打開 L1-Cache</p><p>HAL_Init();</p><p>//初始化 HAL 庫</p><p>Stm32_Clock_Init(432,25,2,9); //設置時鐘,216Mhz</p><p>delay_init(216);</p><p>//延時初始化</p><p>uart_init(115200);</p><p>//串口初始化</p><p>LED_Init(); //初始化 LED</p><p>EXTI_Init();</p><p>//外部中斷初始化</p><p>while(1)</p><p>{</p><p>printf("OK\r\n");</p><p>//打印 OK 提示程序運行</p><p>delay_ms(1000); //每隔 1s 打印一次</p><p>}</p><p>}</p><p>該部分代碼很簡單，先進行各項初始化之後，在 while 死循環中不停的打印字符串到串口。</p><p>當有某個外部按鍵按下之後，會觸發中斷服務函數做出相應的反應。</p><p><strong>9.4 下載驗證</strong></p><p>在編譯成功之後，我們就可以下載代碼到阿波羅 STM32 開發板上，實際驗證一下我們的</p><p>程序是否正確。下載代碼後，在串口調試助手裡面可以看到如圖 9.4.1 所示信息：</p><div class=pgc-img><img alt="ALIENTEK 阿波羅 STM32F767 開發板資料連載第九章 外部中斷實驗" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7a3de7a56ac04a53a7818a3ff51a1656><p class=pgc-img-caption>圖 9.4.1 串口收到的數據</p></div><p><br></p><p>從圖 9.4.1 可以看出，程序已經在運行了，此時可以通過按下 KEY0、KEY1、KEY2 和</p><p>KEY_UP 來觀察 DS0、DS1 是否跟著按鍵的變化而變化。</p><p><strong>9.5 STM32CubeMX 配置外部中斷</strong></p><p>本小節我們將教會大家用 STM32CubeMX 配置外部中斷相關的初始化代碼。關於</p><p>STM32CubeMX 的配置，從本小節開始，我們對於每個實驗只講解實驗相關關鍵配置部分，如</p><p>果大家不知道具體怎麼進入相關界面，請仔細看看前面幾個章節實驗。</p><p>對於外部中斷的配置，首先在 MCU 引腳配置圖界面選擇相應的 GPIO 設置其模式為外部</p><p>中斷模式。這裡以 PH3 為例，如下圖 9.5.1:</p><div class=pgc-img><img alt="ALIENTEK 阿波羅 STM32F767 開發板資料連載第九章 外部中斷實驗" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/50242a0025a145a983fbb4ac8340e4a6><p class=pgc-img-caption>圖 9.5.1 PH3 引腳配置</p></div><p><br></p><p>使用同樣的方法依次配置 PC13 和 PH2/PH3，然後我們打開依次點擊 Configuration->GPIO</p><p>進入 GPIO 詳細配置界面 Pin Configuration，界面會列出 4 個 IO 口的配置信息。我們選中 PA0，</p><p>看看此時 IO 口配置信息詳情如下圖 9.5.2 所示：</p><div class=pgc-img><img alt="ALIENTEK 阿波羅 STM32F767 開發板資料連載第九章 外部中斷實驗" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/23aa7273072d42c98da691d38f1a32a0><p class=pgc-img-caption>圖 9.5.2 GPIO 配置詳情界面</p></div><p>從上圖界面可以看出，當我們配置 IO 口作為外部中斷觸發引腳之後，其詳細配置界面便</p><p>只有三個選項。第一個選項 GPIO mode 用來設置外部中斷觸發方法，上升沿觸發還是下降沿觸</p><p>發還是雙邊沿觸發。第二個選項 GPIO Pull-up/Pull-down 用來設置是默認上拉還是下拉。這兩個</p><p>參數根據我們前面講解的外部中斷知識就很好理解了。這裡除了設置 PA0 為上升沿觸發默認下</p><p>拉外，其他 IO 口都設置為下降沿觸發默認上拉。</p><p>配置好 IO 口信息之後，接下來就需要配置 NVIC 中斷優先級設置。依次點擊</p><p>Configuration->NVIC，進入 NVIC 配置界面。在界面可以看到有四個外部中斷線可配置，這是</p><p>因為我們前面開啟了四個 IO 口的外部中斷（對應 4 個外部中斷線）。我們按照實驗講解，依次</p><p>配置四個中斷線的 NVIC 即可，配置完成後如下圖 9.5.3 所示：</p><div class=pgc-img><img alt="ALIENTEK 阿波羅 STM32F767 開發板資料連載第九章 外部中斷實驗" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6331a180eb9b4f3fb8459641064483e3><p class=pgc-img-caption>圖 9.5.3 NVIC 配置界面</p></div><p><br></p><p>最後生成工程，為了篇幅考慮，這裡我們就不再列出生成的關鍵代碼。在 main.c 中生成的</p><p>函數 MX_GPIO_Init 和我們實驗工程中 exti.c 文件中的函數 EXTI_Init 內容一致，在</p><p>stm32f7xx_it.c 中生成了 4 箇中斷服務函數，和 exti.c 文件中的中斷服務函數內容一致。當然，</p><p>回調函數 HAL_GPIO_EXTI_Callback 的內容軟件是無法自動生成的，需要我們自己編寫。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>ALIENTEK</a></li><li><a>阿波羅</a></li><li><a>STM32F767</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/24fcab2.html alt="ALIENTEK 阿波羅 STM32F767 開發板資料連載第十二章 定時器中斷" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/9d1edd66723f4966b44d3cab502c055f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/24fcab2.html title="ALIENTEK 阿波羅 STM32F767 開發板資料連載第十二章 定時器中斷">ALIENTEK 阿波羅 STM32F767 開發板資料連載第十二章 定時器中斷</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7313a774.html alt="阿波羅 STM32F767 開發板資料連載第五十九章 T9 拼音輸入法實驗" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/9d1edd66723f4966b44d3cab502c055f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7313a774.html title="阿波羅 STM32F767 開發板資料連載第五十九章 T9 拼音輸入法實驗">阿波羅 STM32F767 開發板資料連載第五十九章 T9 拼音輸入法實驗</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/962453a.html alt=舉還是不舉？與渣男阿波羅朝夕相處的小花有自己的選擇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b599514b0c7047f4913b78037d0867db style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/962453a.html title=舉還是不舉？與渣男阿波羅朝夕相處的小花有自己的選擇>舉還是不舉？與渣男阿波羅朝夕相處的小花有自己的選擇</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/3fea7ec.html alt=月球上跳一跳很危險嗎？阿波羅宇航員親口承認，跳了一下差點沒命 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=http://p3.pstatp.com/large/pgc-image/10a496a6b500434a85e410d1b5373104 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/3fea7ec.html title=月球上跳一跳很危險嗎？阿波羅宇航員親口承認，跳了一下差點沒命>月球上跳一跳很危險嗎？阿波羅宇航員親口承認，跳了一下差點沒命</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/c383660.html alt=如何從月球回到地球？快來看阿波羅11號獨家回收過程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=http://p9.pstatp.com/large/pgc-image/f327b2dd56354f43bae69237ae7ee024 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/c383660.html title=如何從月球回到地球？快來看阿波羅11號獨家回收過程>如何從月球回到地球？快來看阿波羅11號獨家回收過程</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/02c4a25.html alt=登上月球的代價——阿波羅1號慘劇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=http://p1.pstatp.com/large/pgc-image/def04402a97941dca954a03a2155b76e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/02c4a25.html title=登上月球的代價——阿波羅1號慘劇>登上月球的代價——阿波羅1號慘劇</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/7cbc1fc.html alt=阿波羅1號慘劇，讓人類登上月球的一課 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=http://p1.pstatp.com/large/pgc-image/def04402a97941dca954a03a2155b76e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/7cbc1fc.html title=阿波羅1號慘劇，讓人類登上月球的一課>阿波羅1號慘劇，讓人類登上月球的一課</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>