<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 | 极客快訊</title><meta property="og:title" content="基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/65496848269146df9857d51db5055e30"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/474b520.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/474b520.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/474b520.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/474b520.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/474b520.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/474b520.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/474b520.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/474b520.html><meta property="article:published_time" content="2020-10-29T20:50:42+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:42+08:00"><meta name=Keywords content><meta name=description content="基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/474b520.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>概述</h1><p>昨天分享過PG的3個事務隔離級別，有些朋友可能理解的不是很透徹，所以簡單弄了一個實驗來幫助大家理解下。</p><hr><h1>實驗--測試隔離級別</h1><pre>postgres=# \h beginCommand: BEGINDescription: start a transaction blockSyntax:BEGIN [ WORK | TRANSACTION ] [ transaction_mode [, ...] ]where transaction_mode is one of: ISOLATION LEVEL { SERIALIZABLE | REPEATABLE READ | READ COMMITTED | READ UNCOMMITTED } READ WRITE | READ ONLY [ NOT ] DEFERRABLE</pre><div class=pgc-img><img alt=基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/65496848269146df9857d51db5055e30><p class=pgc-img-caption></p></div><hr><h1><strong>1、讀未提交</strong></h1><p>表示可以讀到其他會話未提交的數據（postgresql不支持）。</p><hr><h1><strong>2、讀已提交</strong></h1><p>表示可以讀到其他會話已提交的數據。</p><p><strong>2.1、創建一張表為test，插入一條記錄</strong></p><pre>postgres=# create table test(a int, b varchar(128));CREATE TABLEpostgres=# insert into test values(1, 'hello');INSERT 0 1</pre><div class=pgc-img><img alt=基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/18e16d80d84c46b585e23f24dfdf4539><p class=pgc-img-caption></p></div><p><strong>2.2、在會話1中打開事務進行查詢</strong></p><pre>postgres=# begin;BEGINpostgres=# select * from test; a | b ---+------- 1 | hello(1 row)</pre><div class=pgc-img><img alt=基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4757bc6a7f0841cf829b3ef00eb3a8e7><p class=pgc-img-caption></p></div><p><strong>2.3、在會話2中打開事務進行更新</strong></p><pre>postgres=# begin;BEGINpostgres=# update test set b='hwb';UPDATE 1</pre><div class=pgc-img><img alt=基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f26cbc78fb144072bcee6aaa78c13ac2><p class=pgc-img-caption></p></div><p><strong>2.4、查詢會話1</strong></p><p>此時在會話2中還沒有關閉事務，在會話1中進行查詢</p><pre>postgres=# select * from test;</pre><div class=pgc-img><img alt=基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/467f76b1c12c4b55beb4a1d13ac70361><p class=pgc-img-caption></p></div><p><strong>2.5、會話2提交</strong></p><p>發現會話1中的記錄並沒有進行改變。當提交會話2中的事務，在會話1中進行查詢值已經改變</p><pre>--會話2postgres=# commit;--會話1postgres=# select * from test; a | b ---+----- 1 | hwb(1 row)</pre><hr><h1>3、可重複讀</h1><p>表示在一個事務中，執行同一條SQL，讀到的是同樣的數據（即使被讀的數據可能已經被其他會話修改並提交）。</p><p><strong>3.1、設置事務級別</strong></p><p>在會話1中打開可重複讀事務，進行查詢</p><pre>postgres=# begin transaction isolation level repeatable read;postgres=# select * from test;</pre><div class=pgc-img><img alt=基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/defb4137d463413ea90ca0c7cb86b303><p class=pgc-img-caption></p></div><p><strong>3.2、在會話2中進行更新操作</strong></p><p>先在會話2更新不提交，然後在會話1中進行查詢，發現會話1中的記錄沒有因為會話2的提交而變化</p><pre>--會話2postgres=# update test set b='hwb2';--會話1postgres=# select * from test; a | b ---+----- 1 | hwb(1 row)</pre><div class=pgc-img><img alt=基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f98045687c9a49999cc802a38a0ca69c><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e1aca946d2e9407d90cdb15f82ec4404><p class=pgc-img-caption></p></div><p><strong>3.3、會話1提交</strong></p><p>在會話1中進行提交，再查詢，發現會話1中的記錄變化了</p><pre>postgres=# commit;postgres=# select * from test;</pre><div class=pgc-img><img alt=基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/14fe5da748a649eb93b92ce6a8451a02><p class=pgc-img-caption></p></div><hr><h1>4、串行化</h1><p>表示並行事務模擬串行執行，違反串行執行規則的事務，將回滾。</p><p><strong>4.1、設置事務級別</strong></p><pre>--在會話 1中打開事務串行postgres=# begin transaction isolation level serializable;--在會話2中打開事務串行postgres=# begin transaction isolation level serializable;</pre><p><strong>4.2、在會話1中進行插入操作</strong></p><pre>postgres=# insert into test select * from test; postgres=# select * from test;</pre><div class=pgc-img><img alt=基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/88bce1e26bdc464da291390a56e99621><p class=pgc-img-caption></p></div><p><strong>4.3、在會話2中進行插入操作</strong></p><pre>postgres=# insert into test select * from test; postgres=# select * from test;</pre><div class=pgc-img><img alt=基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d7178788ba6a4b93b8a1ec21e36d433c><p class=pgc-img-caption></p></div><p><strong>4.4、提交會話1中的事務，能夠正常提交，會話1進行查詢能夠查到插入的記錄，會話2查詢不到</strong></p><pre>postgres=# end;postgres=# select * from test;</pre><div class=pgc-img><img alt=基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/74fe434fd39841fba3a35657fb39cf93><p class=pgc-img-caption></p></div><p><strong>4.5、當提交會話2的事務時會報錯</strong></p><pre>postgres=# end;</pre><div class=pgc-img><img alt=基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1cfb23bd51fd43c088a4a2f84d587ec4><p class=pgc-img-caption></p></div><hr><p>建議大家花個10分鐘做一下實驗，這樣理解起來就很清晰了，後面會分享更多devops和DBA方面的內容，感興趣的朋友可以關注一下~</p><div class=pgc-img><img alt=基於PG實驗理解3種事務隔離級別--讀已提交、可重複讀、串行化 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15a6b4a4320042aca08bf79fc11da0fc><p class=pgc-img-caption></p></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>PG</a></li><li><a>實驗</a></li><li><a>種事務</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/07ed115b.html alt=化工常見實驗儀器及表徵儀器原理動畫 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1c6f9ee6148943499d7bc3d62aefe0ea style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/07ed115b.html title=化工常見實驗儀器及表徵儀器原理動畫>化工常見實驗儀器及表徵儀器原理動畫</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/83377bc0.html alt="專題2.7 實驗：探究彈力與彈簧伸長量的關係及驗證平行四邊形定則" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15397434180389d5f41ed0d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/83377bc0.html title="專題2.7 實驗：探究彈力與彈簧伸長量的關係及驗證平行四邊形定則">專題2.7 實驗：探究彈力與彈簧伸長量的關係及驗證平行四邊形定則</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/824cf75e.html alt=小丘學堂：高考物理必考實驗精細精講探究彈力和彈簧伸長的關係 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7a66b1829e1b4a479be8a8c88237b67d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/824cf75e.html title=小丘學堂：高考物理必考實驗精細精講探究彈力和彈簧伸長的關係>小丘學堂：高考物理必考實驗精細精講探究彈力和彈簧伸長的關係</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b72b4b5e.html alt=高考物理新一輪複習！實驗2《探究彈力和彈簧伸長的關係》 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/6fdbe7a30f954135bf83c5dbbdbbec01 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b72b4b5e.html title=高考物理新一輪複習！實驗2《探究彈力和彈簧伸長的關係》>高考物理新一輪複習！實驗2《探究彈力和彈簧伸長的關係》</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4b9570de.html alt=滅火劑強度實驗和壓力實驗 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e59a792f11194cc6b46c7115a6b73a0e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4b9570de.html title=滅火劑強度實驗和壓力實驗>滅火劑強度實驗和壓力實驗</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/897d701f.html alt=實驗室裡的四堂魔法課 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15390555139978916324eb8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/897d701f.html title=實驗室裡的四堂魔法課>實驗室裡的四堂魔法課</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/553bf9d8.html alt=常德芷蘭實驗學校到湖師大附屬德山學校訪問交流 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/SCt323ZCymgMIw style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/553bf9d8.html title=常德芷蘭實驗學校到湖師大附屬德山學校訪問交流>常德芷蘭實驗學校到湖師大附屬德山學校訪問交流</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/25f4b0ff.html alt=最慘的實驗人——瀝青滴落實驗 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ec176356bc9744578d530016cee40e43 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/25f4b0ff.html title=最慘的實驗人——瀝青滴落實驗>最慘的實驗人——瀝青滴落實驗</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1fcbf5ea.html alt=歷史上最無聊的實驗，前後持續100年，只為不到一秒的滴落 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/755a4fcbf03346f0858c54a5b7928ed3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1fcbf5ea.html title=歷史上最無聊的實驗，前後持續100年，只為不到一秒的滴落>歷史上最無聊的實驗，前後持續100年，只為不到一秒的滴落</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7522a9b6.html alt=這個實驗，讓人類等了一百年 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/82a860a9d16a4246981c66589357e4b5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7522a9b6.html title=這個實驗，讓人類等了一百年>這個實驗，讓人類等了一百年</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/561efef7.html alt=西藏ASgamma實驗發現迄今最高能量宇宙伽瑪射線 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RV7mC8g9tbj1Hl style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/561efef7.html title=西藏ASgamma實驗發現迄今最高能量宇宙伽瑪射線>西藏ASgamma實驗發現迄今最高能量宇宙伽瑪射線</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a3cbc9ea.html alt=進行百年的瀝青滴落實驗，如此大費干戈，究竟是為了證明什麼？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/9729abe48f9c47919432f44bf48e02e2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a3cbc9ea.html title=進行百年的瀝青滴落實驗，如此大費干戈，究竟是為了證明什麼？>進行百年的瀝青滴落實驗，如此大費干戈，究竟是為了證明什麼？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/651f532a.html alt="“魔鬼”拆解實驗 吉利繽瑞200T發動機測試-杭州華力汽修學校" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e3955bbffa78404587a1a606c58d1ce3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/651f532a.html title="“魔鬼”拆解實驗 吉利繽瑞200T發動機測試-杭州華力汽修學校">“魔鬼”拆解實驗 吉利繽瑞200T發動機測試-杭州華力汽修學校</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3fb2cfc3.html alt=Trunk鏈路的配置、以太網通道的作用及實驗（全程操作、可跟做） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/50b4e6180226429e9f435ce142bdad10 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3fb2cfc3.html title=Trunk鏈路的配置、以太網通道的作用及實驗（全程操作、可跟做）>Trunk鏈路的配置、以太網通道的作用及實驗（全程操作、可跟做）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0ccea4e4.html alt="可能是史上最無聊的實驗   瀝青滴落" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/66bd00002a5637387a7e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0ccea4e4.html title="可能是史上最無聊的實驗   瀝青滴落">可能是史上最無聊的實驗 瀝青滴落</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>