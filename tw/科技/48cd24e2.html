<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>USB的傳輸，編碼，數據格式，掌握usb的必備知識 | 极客快訊</title><meta property="og:title" content="USB的傳輸，編碼，數據格式，掌握usb的必備知識 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/dfic-imagehandler/ca8e6769-0e93-49dd-8016-ed6a6a27abde"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/48cd24e2.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/48cd24e2.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/48cd24e2.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/48cd24e2.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/48cd24e2.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/48cd24e2.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/48cd24e2.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/48cd24e2.html><meta property="article:published_time" content="2020-11-14T21:03:08+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:08+08:00"><meta name=Keywords content><meta name=description content="USB的傳輸，編碼，數據格式，掌握usb的必備知識"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/48cd24e2.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>USB的傳輸，編碼，數據格式，掌握usb的必備知識</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p class=ql-align-justify>1、端點：位於USB設備或主機上的一個數據緩衝區，用來存放和發送USB的各種數據，每一個端點都有惟一的確定地址，有不同的傳輸特性（如輸入端點、輸出端點、配置端點、批量傳輸端點）</p><p class=ql-align-justify>2、幀：時間概念，在USB中，一幀就是1MS，它是一個獨立的單元，包含了一系列總線動作，USB將1幀分為好幾份，每一份中是一個USB的傳輸動作。</p><p class=ql-align-justify>3、上行、下行：設備到主機為上行，主機到設備為下行</p><p class=ql-align-justify><strong>下面以一問一答的形式開始學習吧。</strong></p><p class=ql-align-justify>問題一：USB的傳輸線結構是如何的呢？</p><p class=ql-align-justify>答案一：一條 USB的傳輸線分別由地線、電源線、D+、D-四條線構成，D+和D-是差分輸入線，它使用的是3.3V的電壓（注意哦，與CMOS的5V電平不同），而 電源線和地線可向設備提供5V電壓，最大電流為500MA（可以在編程中設置的，至於硬件的實現機制，就不要管它了）。</p><p class=ql-align-justify>問題二：數據是如何在USB傳輸線裡面傳送的</p><p class=ql-align-justify>答案二：數據在USB線裡傳送是由低位到高位發送的。</p><p class=ql-align-justify>問題三：USB的編碼方案？</p><p class=ql-align-justify>答案三：USB 採用不歸零取反來傳輸數據，當傳輸線上的差分數據輸入0時就取反，輸入1時就保持原值，為了確保信號發送的準確性，當在USB總線上發送一個包時，傳輸設 備就要進行位插入***作（即在數據流中每連續6個1後就插入一個0），從而強迫NRZI碼發生變化。這個瞭解就行了，這些是由專門硬件處理的。</p><div class=pgc-img><img alt=USB的傳輸，編碼，數據格式，掌握usb的必備知識 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/ca8e6769-0e93-49dd-8016-ed6a6a27abde><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>問題四：USB的數據格式是怎麼樣的呢？</p><p class=ql-align-justify>答案四：和其他的一樣，USB數據是由二進制數字串構成的，首先數字串構成域（有七種），域再構成包，包再構成事務（IN、OUT、SETUP），事務最後構成傳輸（中斷傳輸、並行傳輸、批量傳輸和控制傳輸）。下面簡單介紹一下域、包、事務、傳輸，請注意他們之間的關係。</p><p class=ql-align-justify>（一）域：是USB數據最小的單位，由若干位組成（至於是多少位由具體的域決定），域可分為七個類型：</p><p class=ql-align-justify>1、同步域（SYNC），八位，值固定為0000 0001，用於本地時鐘與輸入同步</p><p class=ql-align-justify>2、標識域（PID），由四位標識符+四位標識符反碼構成，表明包的類型和格式，這是一個很重要的部分，這裡可以計算出，USB的標識碼有16種，具體分類請看問題五。</p><p class=ql-align-justify>3、地址域（ADDR）：七位地址，代表了設備在主機上的地址，地址000 0000被命名為零地址，是任何一個設備第一次連接到主機時，在被主機配置、枚舉前的默認地址，由此可以知道為什麼一個USB主機只能接127個設備的原因。</p><p class=ql-align-justify>4、端點域（ENDP），四位，由此可知一個USB設備有的端點數量最大為16個。</p><p class=ql-align-justify>5、幀號域（FRAM），11位，每一個幀都有一個特定的幀號，幀號域最大容量0x800，對於同步傳輸有重要意義（同步傳輸為四種傳輸類型之一，請看下面）。</p><p class=ql-align-justify>6、數據域（DATA）：長度為0~1023字節，在不同的傳輸類型中，數據域的長度各不相同，但必須為整數個字節的長度</p><p class=ql-align-justify>7、校驗域（CRC）：對令牌包和數據包（對於包的分類請看下面）中非PID域進行校驗的一種方法，CRC校驗在通訊中應用很泛，是一種很好的校驗方法，至於具體的校驗方法這裡就不多說，請查閱相關資料，只須注意CRC碼的除法是模2運算，不同於10進制中的除法。</p><div class=pgc-img><img alt=USB的傳輸，編碼，數據格式，掌握usb的必備知識 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/526f2d35-9349-495b-9343-905ab838cae6><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>（二）包：由域構成的包有四種類型，分別是令牌包、數據包、握手包和特殊包，前面三種是重要的包，不同的包的域結構不同，介紹如下</p><p class=ql-align-justify>1、令牌包：可分為輸入包、輸出包、設置包和幀起始包（注意這裡的輸入包是用於設置輸入命令的，輸出包是用來設置輸出命令的，而不是放據數的）</p><p class=ql-align-justify>其中輸入包、輸出包和設置包的格式都是一樣的：</p><p class=ql-align-justify>SYNC+PID+ADDR+ENDP+CRC5（五位的校驗碼）</p><p class=ql-align-justify>（上面的縮寫解釋請看上面域的介紹，PID碼的具體定義請看問題五）</p><p class=ql-align-justify>幀起始包的格式：</p><p class=ql-align-justify>SYNC+PID+11位FRAM+CRC5（五位的校驗碼）</p><p class=ql-align-justify>2、數據包： 分為DATA0包和DATA1包，當USB發送數據的時候，當一次發送的數據長度大於相應端點的容量時，就需要把數據包分為好幾個包，分批發 送，DATA0包和DATA1包交替發送，即如果第一個數據包是DATA0，那第二個數據包就DATA1。但也有例外情況，在同步傳輸中（四類傳輸類型中 之一），所有的數據包都是為DATA0，格式如下：</p><p class=ql-align-justify>SYNC+PID+0~1023字節+CRC16</p><p class=ql-align-justify>3、握手包：結構最為簡單的包，格式如下</p><p class=ql-align-justify>SYNC+PID</p><p class=ql-align-justify>（註上面每種包都有不同類型的，USB1.1共定義了十種包，具體請見問題五）</p><p class=ql-align-justify>（三）事務：分別有IN事務、OUT事務和SETUP事務三大事務，每一種事務都由令牌包、數據包、握手包三個階段構成，這裡用階段的意思是因為這些包的發送是有一定的時間先後順序的，事務的三個階段如下：</p><p class=ql-align-justify>1、令牌包階段：啟動一個輸入、輸出或設置的事務</p><p class=ql-align-justify>2、數據包階段：按輸入、輸出發送相應的數據</p><p class=ql-align-justify>3、握手包階段：返回數據接收情況，在同步傳輸的IN和OUT事務中沒有這個階段，這是比較特殊的。</p><p class=ql-align-justify>事務的三種類型如下（以下按三個階段來說明一個事務）：</p><p class=ql-align-justify>1、 IN事務：</p><p class=ql-align-justify>令牌包階段——主機發送一個PID為IN的輸入包給設備，通知設備要往主機發送數據；</p><p class=ql-align-justify>數據包階段——設備根據情況會作出三種反應（要注意：數據包階段也不總是傳送數據的，根據傳輸情況還會提前進入握手包階段）</p><p class=ql-align-justify>1） 設備端點正常，設備往入主機裡面發出數據包（DATA0與DATA1交替）；</p><p class=ql-align-justify>2） 設備正在忙，無法往主機發出數據包就發送NAK無效包，IN事務提前結束，到了下一個IN事務才繼續；</p><p class=ql-align-justify>3） 相應設備端點被禁止，發送錯誤包STALL包，事務也就提前結束了，總線進入空閒狀態。</p><p class=ql-align-justify>握手包階段——主機正確接收到數據之後就會向設備發送ACK包。</p><p class=ql-align-justify>2、 OUT事務：</p><p class=ql-align-justify>令牌包階段——主機發送一個PID為OUT的輸出包給設備，通知設備要接收數據；</p><p class=ql-align-justify>數據包階段——比較簡單，就是主機會設備送數據，DATA0與DATA1交替</p><p class=ql-align-justify>握手包階段——設備根據情況會作出三種反應</p><p class=ql-align-justify>1）設備端點接收正確，設備往入主機返回ACK，通知主機可以發送新的數據，如果數據包發生了CRC校驗錯誤，將不返回任何握手信息；</p><p class=ql-align-justify>2） 設備正在忙，無法往主機發出數據包就發送NAK無效包，通知主機再次發送數據；</p><p class=ql-align-justify>3） 相應設備端點被禁止，發送錯誤包STALL包，事務提前結束，總線直接進入空閒狀態。</p><p class=ql-align-justify>3、SETUP事務：</p><p class=ql-align-justify>令牌包階段——主機發送一個PID為SETUP的輸出包給設備，通知設備要接收數據；</p><p class=ql-align-justify>數據包階段——比較簡單，就是主機會設備送數據，注意，這裡只有一個固定為8個字節的DATA0包，這8個字節的內容就是標準的USB設備請求命令（共有11條，具體請看問題七）</p><p class=ql-align-justify>握手包階段——設備接收到主機的命令信息後，返回ACK，此後總線進入空閒狀態，並準備下一個傳輸（在SETUP事務後通常是一個IN或OUT事務構成的傳輸）</p><p class=ql-align-justify>（四）傳輸：</p><p class=ql-align-justify>傳輸由OUT、IN、SETUP事務其中的事務構成，傳輸有四種類型，中斷傳輸、批量傳輸、同步傳輸、控制傳輸，其中中斷傳輸和批量轉輸的結構一樣，同步傳輸有最簡單的結構，而控制傳輸是最重要的也是最複雜的傳輸。</p><p class=ql-align-justify>1、中斷傳輸：由OUT事務和IN事務構成，用於鍵盤、鼠標等HID設備的數據傳輸中</p><p class=ql-align-justify>2、批量傳輸：由OUT事務和IN事務構成，用於大容量數據傳輸，沒有固定的傳輸速率，也不佔用帶寬，當總線忙時，USB會優先進行其他類型的數據傳輸，而暫時停止批量轉輸。如U盤</p><p class=ql-align-justify>3、同步傳輸：由OUT事務和IN事務構成，有兩個特殊地方，第一，在同步傳輸的IN和OUT事務中是沒有返回包階段的；第二，在數據包階段所有的數據包都為DATA0，如視頻音頻傳輸</p><p class=ql-align-justify>4、控制傳輸：最重要的也是最複雜的傳輸，控制傳輸由三個階段構成（初始設置階段、可選數據階段、狀態信息步驟），每一個階段可以看成一個的傳輸，也就是說控制傳輸其實是由三個傳輸構成的，用來於</p><p class=ql-align-justify>USB設備初次加接到主機之後，主機通過控制傳輸來交換信息，設備地址和讀取設備的描述符，使得主機識別設備，並安裝相應的驅動程序，這是每一個USB開發者都要關心的問題。</p><p class=ql-align-justify>1、初始設置步驟：就是一個由SET事務構成的傳輸</p><p class=ql-align-justify>2、可選數據步驟：就是一個由IN或OUT事務構成的傳輸，這個步驟是可選的，要看初始設置步驟有沒有要求讀/寫數據（由SET事務的數據包階段發送的標準請求命令決定）</p><p class=ql-align-justify>3、 狀態信息步驟：顧名思義，這個步驟就是要獲取狀態信息，由IN或OUT事務構成構成的傳輸，但是要注意這裡的IN和OUT事務和之前的INT和OUT事務有兩點不同：</p><p class=ql-align-justify>1） 傳輸方向相反，通常IN表示設備往主機送數據，OUT表示主機往設備送數據；在這裡，IN表示主機往設備送數據，而OUT表示設備往主機送數據，這是為了和可選數據步驟相結合；</p><p class=ql-align-justify>2） 在這個步驟裡，數據包階段的數據包都是0長度的，即SYNC+PID+CRC16</p><p class=ql-align-justify>除了以上兩點有區別外，其他的一樣，這裡就不多說</p><div class=pgc-img><img alt=USB的傳輸，編碼，數據格式，掌握usb的必備知識 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6e4ac39c11bc4e7c804ae2b3aa9884bf><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>（思考：這些傳輸模式在實際***作中應如何通過什麼方式去設置？）</p><p class=ql-align-justify>問題五：標識碼有哪些？</p><p class=ql-align-justify>答案五：如同前 面所說的標識碼由四位數據組成，因此可以表示十六種標識碼，在USB1.1規範裡面，只用了十種標識碼，USB2.0使用了十六種標識碼，標識碼的作用是 用來說明包的屬性的，標識碼是和包聯繫在一起的，首先簡單介紹一下數據包的類型，數據包分為令牌包、數據、握手包和特殊包四種（具體分類請看問題七），標 識碼分別有以下十六種：</p><p class=ql-align-justify>令牌包 :</p><p class=ql-align-justify>0x01 輸出(OUT）啟動一個方向為主機到設備的傳輸，幷包含了設備地址和標號</p><p class=ql-align-justify>0x09 輸入 (IN) 啟動一個方向為設備到主機的傳輸，幷包含了設備地址和標號</p><p class=ql-align-justify>0x05 幀起始（SOF）表示一個幀的開始，並且包含了相應的幀號</p><p class=ql-align-justify>0x0d 設置（SETUP）啟動一個控制傳輸，用於主機對設備的初始化</p><p class=ql-align-justify>數據包 :</p><p class=ql-align-justify>0x03 偶數據包（DATA0），</p><p class=ql-align-justify>0x0b 奇數據包（DATA1）</p><p class=ql-align-justify>握手包:</p><p class=ql-align-justify>0x02 確認接收到無誤的數據包（ACK）</p><p class=ql-align-justify>0x0a 無效，接收（發送）端正在忙而無法接收（發送）信息</p><p class=ql-align-justify>0x0e 錯誤，端點被禁止或不支持控制管道請求</p><p class=ql-align-justify>特殊包 0x0C 前導，用於啟動下行端口的低速設備的數據傳輸</p><p class=ql-align-justify>問題六：USB主機是如何識別USB設備的？</p><p class=ql-align-justify>答案六：當USB設備插上主機時，主機就通過一系列的動作來對設備進行枚舉配置（配置是屬於枚舉的一個態，態表示暫時的狀態），這這些態如下：</p><p class=ql-align-justify>1、接入態（Attached）：設備接入主機後，主機通過檢測信號線上的電平變化來發現設備的接入；</p><p class=ql-align-justify>2、供電態（Powered）：就是給設備供電，分為設備接入時的默認供電值，配置階段後的供電值（按數據中要求的最大值，可通過編程設置）</p><p class=ql-align-justify>3、缺省態（Default）：USB在被配置之前，通過缺省地址0與主機進行通信；</p><p class=ql-align-justify>4、地址態（Address）：經過了配置，USB設備被複位後，就可以按主機分配給它的唯一地址來與主機通信，這種狀態就是地址態；</p><p class=ql-align-justify>5、配置態（Configured）：通過各種標準的USB請求命令來獲取設備的各種信息，並對設備的某此信息進行改變或設置。</p><p class=ql-align-justify>6、掛起態（Suspended）：總線供電設備在3ms內沒有總線***作，即USB總線處於空閒狀態的話，該設備就要自動進入掛起狀態，在進入掛起狀態後，總的電流功耗不超過280UA。</p><p class=ql-align-justify>問題七：剛才在答案四提到的標準的USB設備請求命令究竟是什麼？</p><p class=ql-align-justify>答案七：標準的 USB設備請求命令是用在控制傳輸中的“初始設置步驟”裡的數據包階段（即DATA0，由八個字節構成），請看回問答四的內容。標準USB設備請求命令共 有11個，大小都是8個字節，具有相同的結構，由5個字段構成（字段是標準請求命令的數據部分），結構如下（括號中的數字表示字節數，首字母bm,b,w 分別表示位圖、字節，雙字節）：</p><p class=ql-align-justify>bmRequestType(1)+bRequest（1）+wvalue（2）+wIndex（2）+wLength（2）</p><p class=ql-align-justify>各字段的意義如下：</p><p class=ql-align-justify>1、bmRequestType：D7D6D5D4D3D2D1D0</p><p class=ql-align-justify>D7=0主機到設備</p><p class=ql-align-justify>=1設備到主機；</p><p class=ql-align-justify>D6D5=00標準請求命令</p><p class=ql-align-justify>=01 類請求命令</p><p class=ql-align-justify>=10用戶定義的命令</p><p class=ql-align-justify>=11保留值</p><p class=ql-align-justify>D4D3D2D1D0=00000 接收者為設備</p><p class=ql-align-justify>=00001 接收者為設備</p><p class=ql-align-justify>=00010 接收者為端點</p><p class=ql-align-justify>=00011 接收者為其他接收者</p><p class=ql-align-justify>=其他 其他值保留</p><p class=ql-align-justify>2、 bRequest：請求命令代碼，在標準的USB命令中，每一個命令都定義了編號，編號的值就為字段的值，編號與命令名稱如下（要注意這裡的命令代碼要與 其他字段結合使用，可以說命令代碼是標準請求命令代碼的核心，正是因為這些命令代碼而決定了11個USB標準請求命令）：</p><p class=ql-align-justify>0） 0 GET_STATUS：用來返回特定接收者的狀態</p><p class=ql-align-justify>1） 1 CLEAR_FEATURE：用來清除或禁止接收者的某些特性</p><p class=ql-align-justify>2） 3 SET_FEATURE：用來啟用或激活命令接收者的某些特性</p><p class=ql-align-justify>3） 5 SET_ADDRESS：用來給設備分配地址</p><p class=ql-align-justify>4） 6 GET_DEscriptOR：用於主機獲取設備的特定描述符</p><p class=ql-align-justify>5） 7 SET_DEscriptOR：修改設備中有關的描述符，或者增加新的描述符</p><p class=ql-align-justify>6） 8 GET_CONFIGURATION：用於主機獲取設備當前設備的配置值（注同上面的不同）</p><p class=ql-align-justify>7） 9 SET_CONFIGURATION：用於主機指示設備採用的要求的配置</p><p class=ql-align-justify>8） 10 GET_INTERFACE：用於獲取當前某個接口描述符編號</p><p class=ql-align-justify>9） 11 SET_INTERFACE：用於主機要求設備用某個描述符來描述接口</p><p class=ql-align-justify>10） 12 SYNCH_FRAME：用於設備設置和報告一個端點的同步幀</p><p class=ql-align-justify>以上的11個命令要說得明白真的有一匹布那麼長，請各位去看書吧，這裡就不多說了，控制傳輸是USB的重心，而這11個命令是控制傳輸的重心，所以這11個命令是重中之重，這個搞明白了，USB就算是入門了。</p><p class=ql-align-justify>問題八：在標準的USB請求命令中，經常會看到Descriptor，這是什麼來的呢？</p><p class=ql-align-justify>回答 八：Descriptor即描述符，是一個完整的數據結構，可以通過C語言等編程實現，並存儲在USB設備中，用於描述一個USB設備的所有屬性，USB 主機是通過一系列命令來要求設備發送這些信息的。它的作用就是通過如問答節中的命令***作來給主機傳遞信息，從而讓主機知道設備具有什麼功能、屬於哪一 類設備、要佔用多少帶寬、使用哪類傳輸方式及數據量的大小，只有主機確定了這些信息之後，設備才能真正開始工作，所以描述符也是十分重要的部分，要好好掌 握。標準的描述符有5種，USB為這些描述符定義了編號：</p><p class=ql-align-justify>1——設備描述符</p><p class=ql-align-justify>2——配置描述符</p><p class=ql-align-justify>3——字符描述符</p><p class=ql-align-justify>4——接口描述符</p><p class=ql-align-justify>5——端點描述符</p><p class=ql-align-justify>上面的描述符之間有一定的關係，一個設備只有一個設備描述符，而一個設備描述符可以包含多個配置描述符，而一個配置描述符可以包含多個接口描述符，一個接口使用了幾個端點，就有幾個端點描述符。這間描述符是用一定的字段構成的，分別如下說明：</p><p class=ql-align-justify>1、設備描述符</p><p class=ql-align-justify>struct _DEVICE_DEscriptOR_STRUCT</p><p class=ql-align-justify>{</p><p class=ql-align-justify>BYTE bLength; //設備描述符的字節數大小，為0x12</p><p class=ql-align-justify>BYTE bDescriptorType; //描述符類型編號，為0x01</p><p class=ql-align-justify>WORD bcdUSB; //USB版本號</p><p class=ql-align-justify>BYTE bDeviceClass; //USB分配的設備類代碼，0x01~0xfe為標準設備類，0xff為廠商自定義類型</p><p class=ql-align-justify>//0x00不是在設備描述符中定義的，如HID</p><p class=ql-align-justify>BYTE bDeviceSubClass; //usb分配的子類代碼，同上，值由USB規定和分配的</p><p class=ql-align-justify>BYTE bDeviceProtocl; //USB分配的設備協議代碼，同上</p><p class=ql-align-justify>BYTE bMaxPacketSize0; //端點0的最大包的大小</p><p class=ql-align-justify>WORD idVendor; //廠商編號</p><p class=ql-align-justify>WORD idProduct; //產品編號</p><p class=ql-align-justify>WORD bcdDevice; //設備出廠編號</p><p class=ql-align-justify>BYTE iManufacturer; //描述廠商字符串的索引</p><p class=ql-align-justify>BYTE iProduct; //描述產品字符串的索引</p><p class=ql-align-justify>BYTE iSerialNumber; //描述設備序列號字符串的索引</p><p class=ql-align-justify>BYTE bNumConfiguration; //可能的配置數量</p><p class=ql-align-justify>}</p><p class=ql-align-justify>2、配置描述符</p><p class=ql-align-justify>struct _CONFIGURATION_DEscriptOR_STRUCT</p><p class=ql-align-justify>{</p><p class=ql-align-justify>BYTE bLength; //設備描述符的字節數大小，為0x12</p><p class=ql-align-justify>BYTE bDescriptorType; //描述符類型編號，為0x01</p><p class=ql-align-justify>WORD wTotalLength; //配置所返回的所有數量的大小</p><p class=ql-align-justify>BYTE bNumInterface; //此配置所支持的接口數量</p><p class=ql-align-justify>BYTE bConfigurationVale; //Set_Configuration命令需要的參數值</p><p class=ql-align-justify>BYTE iConfiguration; //描述該配置的字符串的索引值</p><p class=ql-align-justify>BYTE bmAttribute; //供電模式的選擇</p><p class=ql-align-justify>BYTE MaxPower; //設備從總線提取的最大電流</p><p class=ql-align-justify>}</p><p class=ql-align-justify>3、字符描述符</p><p class=ql-align-justify>struct _STRING_DEscriptOR_STRUCT</p><p class=ql-align-justify>{</p><p class=ql-align-justify>BYTE bLength; //設備描述符的字節數大小，為0x12</p><p class=ql-align-justify>BYTE bDescriptorType; //描述符類型編號，為0x01</p><p class=ql-align-justify>BYTE SomeDescriptor[36]; //UNICODE編碼的字符串</p><p class=ql-align-justify>}</p><p class=ql-align-justify>4、接口描述符</p><p class=ql-align-justify>struct _INTERFACE_DEscriptOR_STRUCT</p><p class=ql-align-justify>{</p><p class=ql-align-justify>BYTE bLength; //設備描述符的字節數大小，為0x12</p><p class=ql-align-justify>BYTE bDescriptorType; //描述符類型編號，為0x01</p><p class=ql-align-justify>BYTE bInterfaceNunber; //接口的編號</p><p class=ql-align-justify>BYTE bAlternateSetting;//備用的接口描述符編號</p><p class=ql-align-justify>BYTE bNumEndpoints; //該接口使用端點數，不包括端點0</p><p class=ql-align-justify>BYTE bInterfaceClass; //接口類型</p><p class=ql-align-justify>BYTE bInterfaceSubClass;//接口子類型</p><p class=ql-align-justify>BYTE bInterfaceProtocol;//接口所遵循的協議</p><p class=ql-align-justify>BYTE iInterface; //描述該接口的字符串索引值</p><p class=ql-align-justify>}</p><p class=ql-align-justify>5、端點描述符</p><p class=ql-align-justify>struct _ENDPOIN_DEscriptOR_STRUCT</p><p class=ql-align-justify>{</p><p class=ql-align-justify>BYTE bLength; //設備描述符的字節數大小，為0x12</p><p class=ql-align-justify>BYTE bDescriptorType; //描述符類型編號，為0x01</p><p class=ql-align-justify>BYTE bEndpointAddress; //端點地址及輸入輸出屬性</p><p class=ql-align-justify>BYTE bmAttribute; //端點的傳輸類型屬性</p><p class=ql-align-justify>WORD wMaxPacketSize; //端點收、發的最大包的大小</p><p class=ql-align-justify>BYTE bInterval; //主機查詢端點的時間間隔</p><p class=ql-align-justify>}</p><p class=ql-align-justify>在搞明白了上面的八個問題之後，就可以進入USB的下一步學習了</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>USB</a></li><li><a>傳輸</a></li><li><a>編碼</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/4509295e.html alt="USB 3.2傳輸速度可達20Gbps" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/3c79000212d7943d01f3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4509295e.html title="USB 3.2傳輸速度可達20Gbps">USB 3.2傳輸速度可達20Gbps</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/02402c9e.html alt=「乾貨」藍牙耳機編碼（SBC、AAC、aptX）都有啥區別？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/feb0ab00-bb82-4c38-9e77-e3570f56137d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/02402c9e.html title=「乾貨」藍牙耳機編碼（SBC、AAC、aptX）都有啥區別？>「乾貨」藍牙耳機編碼（SBC、AAC、aptX）都有啥區別？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4e49d1f3.html alt=信息編碼：數字和文字是如何誕生的？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1f3d0677443e48bfbb2435b71f6da199 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4e49d1f3.html title=信息編碼：數字和文字是如何誕生的？>信息編碼：數字和文字是如何誕生的？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/17054f8d.html alt=詳解CD編碼格式（16bit/44.1kHz）合理性之量化篇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/6f23d12bac3843e2b09628221846ce0f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/17054f8d.html title=詳解CD編碼格式（16bit/44.1kHz）合理性之量化篇>詳解CD編碼格式（16bit/44.1kHz）合理性之量化篇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f3070f16.html alt=買這個編碼格式的藍牙設備，又便宜又好用！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/8d5cc4a5-5d5b-4a34-adbd-cb74f8d4db2b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f3070f16.html title=買這個編碼格式的藍牙設備，又便宜又好用！>買這個編碼格式的藍牙設備，又便宜又好用！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8775ee99.html alt=音頻壓縮編碼的基本原理詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1d62465bab4542babd5647386c272c82 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8775ee99.html title=音頻壓縮編碼的基本原理詳解>音頻壓縮編碼的基本原理詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/53140375.html alt=信息編碼與數字化 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/8bea8e2d5bad49659ffd74924fc6f08b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/53140375.html title=信息編碼與數字化>信息編碼與數字化</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ed5abbe2.html alt=很多程序員編碼時都戴耳機？他們在聽什麼？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0710e96976d448dc8a7fde6c55312565 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ed5abbe2.html title=很多程序員編碼時都戴耳機？他們在聽什麼？>很多程序員編碼時都戴耳機？他們在聽什麼？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/22525cee.html alt=數字音視頻壓縮編碼標準及H.265的編碼優勢 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/558a023201a84604894ebc359d178ed2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/22525cee.html title=數字音視頻壓縮編碼標準及H.265的編碼優勢>數字音視頻壓縮編碼標準及H.265的編碼優勢</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f4df1c1a.html alt="有一種音頻編碼技術叫MQA，聲音質感優於TIDAL HiFi（CD等級）" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/6383bc881ccf4674aa3074a767f7f743 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f4df1c1a.html title="有一種音頻編碼技術叫MQA，聲音質感優於TIDAL HiFi（CD等級）">有一種音頻編碼技術叫MQA，聲音質感優於TIDAL HiFi（CD等級）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/28bd155e.html alt=淺析數字音頻文件的編碼格式和音效增強軟件 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/30adf5c07c804a709a57bba20dfe7ea4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/28bd155e.html title=淺析數字音頻文件的編碼格式和音效增強軟件>淺析數字音頻文件的編碼格式和音效增強軟件</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c84544ec.html alt=詳解CD編碼格式（16bit/44.1kHz）合理性之採樣篇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5dc880024dac477f8aed432054712f82 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c84544ec.html title=詳解CD編碼格式（16bit/44.1kHz）合理性之採樣篇>詳解CD編碼格式（16bit/44.1kHz）合理性之採樣篇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fcc2ad9e.html alt=音頻編碼實戰 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/aacf5cab-b987-443f-815e-236f984fb2d0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fcc2ad9e.html title=音頻編碼實戰>音頻編碼實戰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/90a419ee.html alt=音頻編碼格式彙總 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/90a419ee.html title=音頻編碼格式彙總>音頻編碼格式彙總</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e8e457d9.html alt=網線傳輸距離是90米，如果超過90米怎麼辦？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/cf79d6c70d954d18a843c7900e4258fe style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e8e457d9.html title=網線傳輸距離是90米，如果超過90米怎麼辦？>網線傳輸距離是90米，如果超過90米怎麼辦？</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>