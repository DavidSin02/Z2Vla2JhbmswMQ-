<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Python開發常見問題彙總 | 极客快訊</title><meta property="og:title" content="Python開發常見問題彙總 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/1525506011510ee699a3e91"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4d9fe5d5.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4d9fe5d5.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4d9fe5d5.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4d9fe5d5.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4d9fe5d5.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4d9fe5d5.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4d9fe5d5.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4d9fe5d5.html><meta property="article:published_time" content="2020-11-14T21:05:10+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:10+08:00"><meta name=Keywords content><meta name=description content="Python開發常見問題彙總"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/4d9fe5d5.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Python開發常見問題彙總</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>文章目錄</h1><ul class=list-paddingleft-2><li><p>libs和擴展FAQ</p></li><li><p>我如何在Python中生成隨機數字？</p></li><li><p>Python中是否有任何數據庫包的接口？</p></li><li><p>你如何在Python中實現持久化對象？</p></li><li><p>為什麼cPickle這麼慢？</p></li><li><p>如果我的程序崩潰，打開一個bsddb（或anydbm）數據庫，它會被損壞。怎麼來的？</p></li><li><p>我試圖打開Berkeley DB文件，但bsddb產生bsddb.error：（22，'無效參數'）。幫幫我！我怎樣才能恢復我的數據？</p></li><li><p>Python有什麼WWW工具？</p></li><li><p>我如何模仿CGI表單提交（METHOD = POST）？</p></li><li><p>我應該使用什麼模塊來幫助生成HTML？</p></li><li><p>我如何從Python腳本發送郵件？</p></li><li><p>如何避免在套接字的connect（）方法中阻塞？</p></li></ul><ul class=list-paddingleft-2><li><p>我如何刪除文件？（和其他文件問題...）</p></li><li><p>我如何複製文件？</p></li><li><p>如何讀取（或寫入）二進制數據？</p></li><li><p>我似乎無法使用os.popen（）創建的管道上使用os.read（）; 為什麼？</p></li><li><p>如何運行管道連接到輸入和輸出的子進程？</p></li><li><p>我如何訪問串行（RS232）端口？</p></li><li><p>為什麼不關閉sys.stdout（stdin，stderr）真的關閉它？</p></li></ul><ul class=list-paddingleft-2><li><p>我如何使用線程編程？</p></li><li><p>我的線索似乎沒有運行：為什麼？</p></li><li><p>我如何在一堆工作線程中打包工作？</p></li><li><p>什麼樣的全球價值變異是線程安全的？</p></li><li><p>我們不能擺脫全球解釋器鎖嗎？</p></li></ul><ul class=list-paddingleft-2><li><p>我如何測試Python程序或組件？</p></li><li><p>如何從文檔字符串創建文檔？</p></li><li><p>我怎樣一次獲得一個按鍵？</p></li><li><p>我如何找到一個模塊或應用程序來執行任務X？</p></li><li><p>math.py（socket.py，regex.py等）源文件在哪裡？</p></li><li><p>我如何在Unix上創建一個Python腳本可執行文件？</p></li><li><p>是否有Python的curses / termcap包？</p></li><li><p>在Python中是否有和C的onexit（）等價的東西？</p></li><li><p>為什麼我的信號處理程序不工作？</p></li><li><p>一般圖書館問題</p></li><li><p>常見任務</p></li><li><p>主題</p></li><li><p>輸入和輸出</p></li><li><p>網絡/互聯網編程</p></li><li><p>數據庫</p></li><li><p>數學和數字</p></li></ul><p><img alt=Python開發常見問題彙總 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1525506011510ee699a3e91></p><ul class=list-paddingleft-2></ul><h1>一般lib庫問題</h1><p>我如何找到一個模塊或應用程序來執行任務X？</p><p>檢查庫參考以查看是否有相關的標準庫模塊。（最終你會了解標準庫中的內容，並且可以跳過這一步。）</p><p>對於第三方軟件包，請搜索Python軟件包索引或嘗試使用Google或其他網絡搜索引擎。搜索“Python”加上一兩個關鍵字的關鍵詞通常會找到一些有用的東西。</p><p>math.py（socket.py，regex.py等）源文件在哪裡？</p><p>如果您找不到某個模塊的源文件，它可能是以C，C ++或其他編譯語言實現的內置或動態加載的模塊。在這種情況下，您可能沒有源文件，或者它可能類似於 <code>mathmodule.c</code>C源代碼目錄中的某處（不在Python路徑中）。</p><p>Python中至少有三種模塊：</p><ol class=list-paddingleft-2><li><p>以Python（.py）編寫的模塊;</p></li><li><p>以C語言編寫並動態加載的模塊（.dll，.pyd，.so，.sl等）;</p></li><li><p>以C語言編寫並與口譯員聯繫的模塊; 要獲得這些列表，請鍵入：</p><pre>import sysprint sys.builtin_module_names</pre></li></ol><p>我如何在Unix上創建一個Python腳本可執行文件？</p><p>您需要做兩件事：腳本文件的模式必須是可執行的，第一行必須以<code>#!</code>Python解釋器的路徑開頭。</p><p>第一個是通過執行或可能。<code>chmod +x scriptfile</code><code>chmod 755 scriptfile</code></p><p>第二個可以通過多種方式完成。最直接的方法是寫</p><pre>#!/usr/local/bin/python</pre><p>作為文件的第一行，在您的平臺上使用Python解釋器安裝位置的路徑名。</p><p>如果您希望腳本獨立於Python解釋器所在的位置，則可以使用<strong>env</strong>程序。幾乎所有的Unix變體都支持以下內容，假設Python解釋器位於用戶的目錄中 <code>PATH</code>：</p><pre>#!/usr/bin/env python</pre><p>不要為CGI腳本執行此操作。該<code>PATH</code> CGI腳本的變量通常非常小，因此您需要使用解釋器的實際絕對路徑名。</p><p>有時候，用戶的環境太滿了，以致<strong>/ usr / bin / env</strong> 程序失敗; 或者根本沒有env計劃。在這種情況下，你可以嘗試下面的黑客（由於Alex Rezinsky）：</p><pre>#! /bin/sh""":"exec python $0 ${1+"$@"}"""</pre><p>小小的缺點是它定義了腳本的__doc__字符串。但是，您可以通過添加來修復該問題</p><pre>__doc__ = """...Whatever..."""</pre><p>是否有Python的curses / termcap包？</p><p>對於Unix變體，標準Python源代碼發行在模塊子目錄中帶有一個curses模塊，儘管它並未默認編譯。（請注意，這在Windows發行版中不可用 - Windows沒有curses模塊。）</p><p>該<code>curses</code>模塊支持基本的curses功能以及來自ncurses和SYSV curses的許多附加功能，如顏色，替代字符集支持，打擊墊和鼠標支持。這意味著該模塊與只有BSD詛咒的操作系統不兼容，但似乎沒有任何屬於此類別的當前維護的操作系統。</p><p>對於Windows：使用consolelib模塊。</p><p>在Python中是否有和C的onexit（）等價的東西？</p><p>該<code>atexit</code>模塊提供了一個類似於C的寄存器功能 <code>onexit()</code>。</p><p>為什麼我的信號處理程序不工作？</p><p>最常見的問題是信號處理程序是用錯誤的參數列表聲明的。它被稱為</p><pre>handler(signum, frame)</pre><p>所以應該用兩個參數聲明：</p><pre>def handler(signum, frame):...</pre><h1>常見任務</h1><p>我如何測試Python程序或組件？</p><p>Python帶有兩個測試框架。該<code>doctest</code>模塊在模塊的文檔字符串中找到示例並運行它們，將輸出與文檔字符串中給出的預期輸出進行比較。</p><p>該<code>unittest</code>模塊是一個基於Java和Smalltalk測試框架的發燒友測試框架。</p><p>為了使測試更容易，您應該在程序中使用良好的模塊化設計。你的程序幾乎應該具有封裝在函數或類方法中的所有功能 - 而且這有時會讓程序運行得更快（因為局部變量訪問比全局訪問更快），這有令人驚訝和令人愉快的效果。此外，程序應該避免依賴變異的全局變量，因為這使得測試更加困難。</p><p>你的程序的“全局主邏輯”可能就像</p><pre>if __name__ == "__main__":main_logic()</pre><p>在程序主模塊的底部。</p><p>一旦你的程序被組織為一個易處理的函數和類行為集合，你應該編寫測試函數來行使這些行為。可以將一系列測試自動化的測試套件與每個模塊相關聯。這聽起來像很多工作，但由於Python非常簡潔靈活，所以它非常簡單。通過將測試函數與“生產代碼”並行編寫，您可以使編碼變得更愉快和更有趣，因為這樣可以更容易地發現錯誤，甚至更早地設計缺陷。</p><p>不打算成為程序主模塊的“支持模塊”可能包括模塊的自檢。</p><pre>if __name__ == "__main__":self_test()</pre><p>即使通過使用Python中實現的“假”接口，當外部接口不可用時，甚至可以測試與複雜外部接口交互的程序。</p><p>如何從文檔字符串創建文檔？</p><p>該<code>pydoc</code>模塊可以從您的Python源代碼中的文檔字符串創建HTML。純粹從docstrings創建API文檔的替代方法是epydoc。 獅身人面像還可以包含文檔字符串內容。</p><p>我怎樣一次獲得一個按鍵？</p><p>對於Unix變體，有幾種解決方案。使用curses來做這件事很簡單，但curses是一個相當大的模塊來學習。這是一個沒有詛咒的解決方案：</p><pre>import termios, fcntl, sys, osfd = sys.stdin.fileno()oldterm = termios.tcgetattr(fd)newattr = termios.tcgetattr(fd)newattr[3] = newattr[3] &amp; ~termios.ICANON &amp; ~termios.ECHOtermios.tcsetattr(fd, termios.TCSANOW, newattr)oldflags = fcntl.fcntl(fd, fcntl.F_GETFL)fcntl.fcntl(fd, fcntl.F_SETFL, oldflags | os.O_NONBLOCK)try:while 1:try:c = sys.stdin.read(1)print "Got character", repr(c)except IOError: passfinally:termios.tcsetattr(fd, termios.TCSAFLUSH, oldterm)fcntl.fcntl(fd, fcntl.F_SETFL, oldflags)</pre><p>你需要這個<code>termios</code>和這個<code>fcntl</code>模塊才能工作，我只在Linux上試過，儘管它可以在其他地方工作。在此代碼中，一次讀取和打印一個字符。</p><p><code>termios.tcsetattr()</code>關閉stdin的回顯並禁用規範模式。 <code>fcntl.fnctl()</code>用於獲取stdin的文件描述符標誌並將其修改為非阻止模式。由於讀取標準輸入時，它是空的結果是 <code>IOError</code>，這個錯誤被捕獲並被忽略。</p><hr><p>線程</p><p>我如何使用線程編程？</p><p>一定要使用<code>threading</code>模塊而不是<code>thread</code>模塊。該<code>threading</code>模塊在<code>thread</code>模塊提供的低級基元之上構建方便的抽象。</p><p>Aahz從他的線程教程中獲得了一些有用的幻燈片，請參閱 http://www.pythoncraft.com/OSCON2001/。</p><p>我的線索似乎沒有運行：為什麼？</p><p>一旦主線程退出，所有線程都會被終止。你的主線程運行得太快，給線程沒時間做任何工作。</p><p>一個簡單的解決方法是在程序結束時添加一段睡眠時間，以便所有線程完成足夠長的時間：</p><pre>import threading, timedef thread_task(name, n):for i in range(n): print name, ifor i in range(10):T = threading.Thread(target=thread_task, args=(str(i), i))T.start()time.sleep(10) # &lt;----------------------------!</pre><p>但現在（在許多平臺上）線程並不是平行運行，而是按順序運行，每次只運行一個線程！原因是OS線程調度程序在上一個線程被阻塞之前不會啟動新線程。</p><p>一個簡單的解決方法是在運行函數的開始處添加一個微小的睡眠：</p><pre>def thread_task(name, n):time.sleep(0.001) # &lt;---------------------!for i in range(n): print name, ifor i in range(10):T = threading.Thread(target=thread_task, args=(str(i), i))T.start()time.sleep(10)</pre><p>與其試圖猜測一個好的延遲值<code>time.sleep()</code>，最好是使用某種信號量機制。一個想法是使用該 <code>Queue</code>模塊創建隊列對象，讓每個線程在完成時將一個令牌附加到隊列中，並讓主線程從隊列中讀取與線程一樣多的令牌。</p><p>我如何在一堆工作線程中打包工作？</p><p>使用該<code>Queue</code>模塊創建一個包含作業列表的隊列。本 <code>Queue</code>類維護對象的列表，並有一個<code>.put(obj)</code> ，增加了項目的隊列和方法<code>.get()</code>，以回報他們的方法。課程將負責確保每個作業僅發送一次所需的鎖定。</p><p>這是一個簡單的例子：</p><pre>import threading, Queue, time# The worker thread gets jobs off the queue. When the queue is empty, it# assumes there will be no more work and exits.# (Realistically workers will run until terminated.)def worker():print 'Running worker'time.sleep(0.1)while True:try:arg = q.get(block=False)except Queue.Empty:print 'Worker', threading.currentThread(),print 'queue empty'breakelse:print 'Worker', threading.currentThread(),print 'running with argument', argtime.sleep(0.5)# Create queueq = Queue.Queue()# Start a pool of 5 workersfor i in range(5):t = threading.Thread(target=worker, name='worker %i' % (i+1))t.start()# Begin adding work to the queuefor i in range(50):q.put(i)# Give threads time to runprint 'Main thread sleeping'time.sleep(5)</pre><p>運行時，這將產生以下輸出：</p><pre>Running workerRunning workerRunning workerRunning workerRunning workerMain thread sleepingWorker &lt;Thread(worker 1, started)&gt; running with argument 0Worker &lt;Thread(worker 2, started)&gt; running with argument 1Worker &lt;Thread(worker 3, started)&gt; running with argument 2Worker &lt;Thread(worker 4, started)&gt; running with argument 3Worker &lt;Thread(worker 5, started)&gt; running with argument 4Worker &lt;Thread(worker 1, started)&gt; running with argument 5...</pre><p>有關更多詳細信息，請參閱模塊的文檔; 該<code>Queue</code> 課程提供了一個有特色的界面。</p><p>什麼樣的全球價值變異是線程安全的？</p><p>一個全局解釋鎖（GIL）在內部使用，以確保只有一個線程在Python虛擬機在運行時間。通常，Python提供僅在字節碼指令之間在線程之間切換; 它的切換頻率可以通過設置<code>sys.setcheckinterval()</code>。因此，從Python程序的角度來看，每個字節碼指令以及從每條指令到達的所有C實現代碼都是原子。</p><p>從理論上講，這意味著一個確切的會計需要精確理解PVM字節碼的實現。實際上，這意味著對“看起來像原子”的內置數據類型（ints，lists，dicts等）的共享變量的操作確實是這樣。</p><p>例如，以下操作都是原子的（L，L1，L2是列表，D，D1，D2是字符串，x，y是對象，i，j是整數）：</p><pre>L.append(x)L1.extend(L2)x = L[i]x = L.pop()L1[i:j] = L2L.sort()x = yx.field = yD[x] = yD1.update(D2)D.keys()</pre><p>這些不是：</p><pre>i = i+1L.append(L[-1])L[i] = L[j]D[x] = D[x] + 1</pre><p><code>__del__()</code>當引用計數達到零時，替換其他對象的操作可能會調用那些其他對象的 方法，這可能會影響事物。對於詞典和列表的大量更新尤其如此。如有疑問，請使用互斥體！</p><p>我們不能擺脫全球解釋器鎖嗎？</p><p>在全局解釋鎖（GIL）往往被視為一個障礙Python的高端多處理器服務器計算機的部署，因為一個多線程的Python程序有效地只使用一個CPU，由於堅持認為（幾乎）所有的Python代碼只能在GIL舉行時運行。</p><p>在Python 1.5的時代，Greg Stein實際上實現了一個全面的補丁集（“免費線程”補丁），它們刪除了GIL，並用細粒度鎖定代替它。不幸的是，即使在Windows上（鎖定效率非常高），這個運行普通Python代碼的速度比使用GIL的解釋器慢兩倍。在Linux上，性能損失更加嚴重，因為pthread鎖定效率不高。</p><p>從那時起，擺脫GIL的想法偶爾會出現，但沒有人找到解決預期放緩的方法，而不使用線程的用戶如果他們的代碼以一半的速度運行就不會很高興。格雷格的免費線程補丁集還沒有保持最新的Python版本。</p><p>這並不意味著你不能在多CPU機器上很好地使用Python！你只需要在多個進程而不是多個線程之間進行創新 。明智地使用C擴展也將有所幫助; 如果您使用C擴展來執行耗時的任務，那麼擴展可以釋放GIL，而執行的線程位於C代碼中，並允許其他線程完成一些工作。</p><p>有人認為，GIL應該是一個每個解釋者國家的鎖而不是真正的全球性鎖; 口譯員將無法共享對象。不幸的是，這也不可能發生。這將是一項巨大的工作，因為許多對象實現目前具有全局狀態。例如，小的整數和短的字符串被緩存; 這些緩存將不得不轉移到解釋器狀態。其他對象類型有自己的空閒列表; 這些免費名單將不得不轉移到口譯員的狀態。等等。</p><p>我懷疑它甚至可以在有限的時間內完成，因為第三方擴展存在同樣的問題。很可能第三方擴展的寫入速度比將其轉換為將其全部狀態存儲在解釋器狀態中的速度更快。</p><p>最後，一旦你有多個口譯員沒有分享任何狀態，你在單獨的過程中運行每個口譯員所獲得的成果是什麼？</p><h1>輸入和輸出</h1><p>我如何刪除文件？（和其他文件問題...）</p><p>使用<code>os.remove(filename)</code>或<code>os.unlink(filename)</code>; 有關文檔，請參閱<code>os</code>模塊。這兩個功能是相同的; <code>unlink()</code>只是這個函數的Unix系統調用的名稱。</p><p>要刪除目錄，請使用<code>os.rmdir()</code>; 使用<code>os.mkdir()</code>來創建一個。 <code>os.makedirs(path)</code>將創建任何<code>path</code>不存在的中間目錄。<code>os.removedirs(path)</code>只要它們是空的，就會刪除中間目錄; 如果要刪除整個目錄樹及其內容，請使用<code>shutil.rmtree()</code>。</p><p>要重命名文件，請使用。<code>os.rename(old_path, new_path)</code></p><p>截斷文件，使用打開它並使用 ; 偏移量默認為當前搜索位置。還有用於打開的文件，其中 fd是文件描述符（一個小整數）。<code>f = open(filename, "r+")</code><code>f.truncate(offset)</code><code>os.ftruncate(fd,offset)</code><code>os.open()</code></p><p>該<code>shutil</code>模塊還包含了一些功能上的文件，包括工作<code>copyfile()</code>，<code>copytree()</code>和 <code>rmtree()</code>。</p><p>我如何複製文件？</p><p>該<code>shutil</code>模塊包含一個<code>copyfile()</code>功能。請注意，在MacOS 9上，它不會複製資源分支和Finder信息。</p><p>如何讀取（或寫入）二進制數據？</p><p>要讀取或寫入複雜的二進制數據格式，最好使用該<code>struct</code> 模塊。它允許你獲取一個包含二進制數據（通常是數字）的字符串並將其轉換為Python對象; 反之亦然。</p><p>例如，下面的代碼從文件中讀取兩個2字節整數和一個大端格式的4字節整數：</p><pre>import structf = open(filename, "rb") # Open in binary mode for portabilitys = f.read(8)x, y, z = struct.unpack("&gt;hhl", s)</pre><p>格式字符串中的'>'強制大端數據; 字母'h'讀取一個“短整數”（2個字節），'l'從字符串中讀取一個“長整數”（4個字節）。</p><p>對於更規則的數據（例如，整數或浮點數的同類列表），您也可以使用該<code>array</code>模塊。</p><p>我似乎無法使用os.popen（）創建的管道上使用os.read（）; 為什麼？</p><p><code>os.read()</code>是一個低級函數，它接受一個文件描述符，一個代表打開文件的小整數。 <code>os.popen()</code>創建一個高級文件對象，內置<code>open()</code>函數返回的是相同的類型。因此，要從創建的管道p讀取n個字節，您需要使用。<code>os.popen()</code><code>p.read(n)</code></p><p>如何運行管道連接到輸入和輸出的子進程？</p><p>使用該<code>popen2</code>模塊。例如：</p><pre>import popen2fromchild, tochild = popen2.popen2("command")tochild.write("input\n")tochild.flush()output = fromchild.readline()</pre><p>警告：一般來說，這樣做是不明智的，因為當孩子被阻止等待你的輸入時，你可以很容易地導致你的進程被阻塞的地方等待孩子輸出的死鎖。這可能是由於父母期望孩子輸出的文本比它更多，或者由於沒有刷新而導致數據卡在stdio緩衝區中。Python父級當然可以在它讀取任何輸出之前顯式地清除它發送給子級的數據，但是如果子級是一個幼稚的C程序，它可能已被寫入從不顯式刷新其輸出，即使它是交互式的，因為沖刷通常是自動的。</p><p>請注意，如果您用於<code>popen3()</code>讀取標準輸出和標準錯誤，則也可能發生死鎖。如果其中一個對於內部緩衝區來說太大（增加緩衝區的大小並沒有幫助），<code>read()</code>而另一個首先出現，則也會出現死鎖。</p><p>注意popen2中的錯誤：除非程序調用<code>wait()</code>或<code>waitpid()</code>完成的子進程永遠不會被刪除，並且由於子進程的數量限制，最終對popen2的調用將失敗。<code>os.waitpid()</code>使用該<code>os.WNOHANG</code>選項調用 可以防止這種情況; 在<code>popen2</code>再次打電話之前，插入這樣一個電話的好地方是。</p><p>在許多情況下，您真正需要的是通過命令運行一些數據並將結果返回。除非數據量非常大，否則最簡單的方法是將其寫入臨時文件並使用該臨時文件作為輸入運行命令。標準模塊<code>tempfile</code>導出一個 <code>mktemp()</code>函數來生成唯一的臨時文件名。</p><pre>import tempfileimport osclass Popen3:""" This is a deadlock-safe version of popen that returns an object with errorlevel, out (a string) and err (a string). (capturestderr may not work under windows.) Example: print Popen3('grep spam','\n\nhere spam\n\n').out """def __init__(self,command,input=None,capturestderr=None):outfile=tempfile.mktemp()command="( %s ) &gt; %s" % (command,outfile)if input:infile=tempfile.mktemp()open(infile,"w").write(input)command=command+" &lt;"+infileif capturestderr:errfile=tempfile.mktemp()command=command+" 2&gt;"+errfileself.errorlevel=os.system(command) &gt;&gt; 8self.out=open(outfile,"r").read()os.remove(outfile)if input:os.remove(infile)if capturestderr:self.err=open(errfile,"r").read()os.remove(errfile)</pre><p>請注意，許多交互式程序（例如vi）不能很好地用管道代替標準輸入和輸出。您將不得不使用偽ttys（“ptys”）而不是管道。或者你可以使用一個Python接口來Don Libes的“expect”庫。一個可以接口的Python擴展稱為“expy”，可從http://expectpy.sourceforge.net獲得。像預期一樣工作的純Python解決方案就是一個好的方面。</p><p>我如何訪問串行（RS232）端口？</p><p>對於Win32，POSIX（Linux，BSD等），Jython：</p><blockquote>http://pyserial.sourceforge.net</blockquote><p>對於Unix，請參閱Mitch Chapman的Usenet帖子：</p><blockquote>https://groups.google.com/groups?selm=34A04430.CF9@ohioee.com</blockquote><p>為什麼不關閉sys.stdout（stdin，stderr）真的關閉它？</p><p>Python文件對象是C流頂層的一個高層抽象層，它反過來是低層C文件描述符之上的一箇中等抽象層。</p><p>對於通過內置<code>file</code> 構造函數在Python中創建的大多數文件對象，<code>f.close()</code>將Python文件對象標記為從Python的角度關閉，並且還安排關閉底層的C流。這也會在<code>f</code>析構函數中自動發生，當它<code>f</code>變成垃圾時。</p><p>但是，標準輸入，輸出和錯誤是由Python的特殊處理，因為特殊的身份也由C.運行給他們<code>sys.stdout.close()</code>標記了Python級別的文件對象被關閉，但並沒有關閉關聯的C流。</p><p>要關閉其中一個三層的底層C流，首先應確定這就是您真正想要做的事情（例如，您可能會混淆擴展模塊嘗試執行I / O操作）。如果是，請使用os.close：</p><pre>os.close(0) # close C's stdin streamos.close(1) # close C's stdout streamos.close(2) # close C's stderr stream</pre><p>網絡/ Internet編程</p><p>Python有什麼WWW工具？</p><p>請參閱“ 庫參考手冊”中標題為“ Internet協議和支持”和“ Internet數據處理”的章節。Python有很多模塊可以幫助你構建服務器端和客戶端的Web系統。</p><p>Paul Boddie在https://wiki.python.org/moin/WebProgramming上維護了可用框架的摘要 。</p><p>Cameron Laird在http://phaseit.net/claird/comp.lang.python/web_python上維護一組有關Python網絡技術的有用網頁 。</p><p>我如何模仿CGI表單提交（METHOD = POST）？</p><p>我想檢索作為發佈表單結果的網頁。有沒有現成的代碼可以讓我輕鬆做到這一點？</p><p>是。以下是一個使用httplib的簡單示例：</p><pre>#!/usr/local/bin/pythonimport httplib, sys, time# build the query stringqs = "First=Josephine&amp;MI=Q&amp;Last=Public"# connect and send the server a pathhttpobj = httplib.HTTP('www.some-server.out-there', 80)httpobj.putrequest('POST', '/cgi-bin/some-cgi-script')# now generate the rest of the HTTP headers...httpobj.putheader('Accept', '*/*')httpobj.putheader('Connection', 'Keep-Alive')httpobj.putheader('Content-type', 'application/x-www-form-urlencoded')httpobj.putheader('Content-length', '%d' % len(qs))httpobj.endheaders()httpobj.send(qs)# find out what the server said in response...reply, msg, hdrs = httpobj.getreply()if reply != 200:sys.stdout.write(httpobj.getfile().read())</pre><p>請注意，通常對於百分比編碼的POST操作，查詢字符串必須使用引號<code>urllib.urlencode()</code>。例如，發送 ：<code>name=Guy Steele, Jr.</code></p><pre>&gt;&gt;&gt; import urllib&gt;&gt;&gt; urllib.urlencode({'name': 'Guy Steele, Jr.'})'name=Guy+Steele%2C+Jr.'</pre><p>我應該使用什麼模塊來幫助生成HTML？</p><p>您可以在Web Programming wiki頁面上找到有用鏈接的集合。</p><p>我如何從Python腳本發送郵件？</p><p>使用標準庫模塊<code>smtplib</code>。</p><p>這是一個使用它的非常簡單的交互式郵件發件人。這種方法適用於任何支持SMTP偵聽器的主機。</p><pre>import sys, smtplibfromaddr = raw_input("From: ")toaddrs = raw_input("To: ").split(',')print "Enter message, end with ^D:"msg = ''while True:line = sys.stdin.readline()if not line:breakmsg += line# The actual mail sendserver = smtplib.SMTP('localhost')server.sendmail(fromaddr, toaddrs, msg)server.quit()</pre><p>只有Unix的選擇使用sendmail。sendmail程序的位置因系統而異; 有時候<code>/usr/lib/sendmail</code>，有時候是這樣 <code>/usr/sbin/sendmail</code>。sendmail手冊頁將幫助你。以下是一些示例代碼：</p><pre>import osSENDMAIL = "/usr/sbin/sendmail" # sendmail locationp = os.popen("%s -t -i" % SENDMAIL, "w")p.write("To: receiver@example.com\n")p.write("Subject: test\n")p.write("\n") # blank line separating headers from bodyp.write("Some text\n")p.write("some more text\n")sts = p.close()if sts != 0:print "Sendmail exit status", sts</pre><p>如何避免在套接字的connect（）方法中阻塞？</p><p>選擇模塊通常用於幫助套接字上的異步I / O。</p><p>為防止TCP連接阻塞，可以將套接字設置為非阻塞模式。然後，當您執行此操作時<code>connect()</code>，您將立即連接（不太可能）或獲取包含錯誤編號的異常<code>.errno</code>。 <code>errno.EINPROGRESS</code>表示連接正在進行中，但尚未完成。不同的操作系統將返回不同的值，所以你將不得不檢查系統上返回的內容。</p><p>您可以使用該<code>connect_ex()</code>方法避免創建異常。它只會返回錯誤值。要進行輪詢，您可以<code>connect_ex()</code>稍後再調用- 0或<code>errno.EISCONN</code>指示您已連接 - 或者您可以傳遞此套接字以選擇是否可寫。</p><h1>數據庫</h1><p>Python中是否有任何數據庫包的接口？</p><p>是。</p><p>Python 2.3包含<code>bsddb</code>提供BerkeleyDB庫接口的包。接口的基於磁盤的散列如<code>DBM</code> 和<code>GDBM</code>中還包含標準Python。</p><p>支持大多數關係數據庫可用。有關詳細信息，請參閱 DatabaseProgramming wiki頁面。</p><p>你如何在Python中實現持久化對象？</p><p>該<code>pickle</code>庫模塊來解決這個非常普遍的方式（雖然你仍然不能存放東西像打開的文件，套接字或窗口），和 <code>shelve</code>庫模塊使用泡菜和（g）DBM創建一個包含任意Python對象持久化映射。為了獲得更好的性能，您可以使用該<code>cPickle</code>模塊。</p><p>一個更尷尬的做法是用泡菜的小妹妹元帥。該<code>marshal</code>模塊提供了非常快速的方法來將非圓形的基本Python類型存儲到文件和字符串中，然後再返回。雖然編組不會做像商店實例或正確處理共享引用的花哨事物，但確實運行得非常快。例如，加載一個半兆字節的數據可能不到三分之一秒。這經常會讓更復雜和更普遍的事情發生，比如在pickle / shelve中使用gdbm。</p><p>為什麼cPickle這麼慢？</p><p>默認情況下<code>pickle</code>使用相對較舊和較慢的格式以實現向後兼容。但是，您可以指定更快的其他協議版本：</p><pre>largeString = 'z' * (100 * 1024)myPickle = cPickle.dumps(largeString, protocol=1)</pre><p>如果我的程序在打開bsddb（或anydbm）數據庫時崩潰，它會被破壞。怎麼來的？</p><p>使用bsddb模塊打開數據庫（通常由anydbm模塊打開，因為它將優先使用bsddb）必須使用<code>.close()</code>數據庫的方法顯式關閉。底層庫緩存需要轉換為磁盤形式並寫入的數據庫內容。</p><p>如果您在程序崩潰之前初始化了一個新的bsddb數據庫但沒有寫入任何內容，那麼您通常會得到一個零長度的文件，並在下次打開該文件時遇到異常。</p><p>我試圖打開Berkeley DB文件，但是bsddb產生bsddb.error：（22，'無效參數'）。幫幫我！我怎樣才能恢復我的數據？</p><p>不要驚慌！您的數據可能完好無損。導致錯誤的最常見原因是您試圖使用較新版本的Berkeley DB庫打開早期的Berkeley DB文件。</p><p>現在許多Linux系統都有三種版本的Berkeley DB可用。如果要從版本1遷移到較新版本，請使用db_dump185轉儲數據庫的純文本版本。如果要從版本2遷移到版本3，請使用db2_dump創建數據庫的純文本版本。無論哪種情況，都可以使用db_load為計算機上安裝的最新版本創建新的本地數據庫。如果安裝了Berkeley DB版本3，則應該可以使用db2_load創建本地版本2數據庫。</p><p>您應該遠離Berkeley DB版本1文件，因為散列文件代碼包含可能破壞數據的已知錯誤。</p><h1>數學和數字</h1><p>我如何在Python中生成隨機數字？</p><p>標準模塊<code>random</code>實現一個隨機數發生器。用法很簡單：</p><pre>import randomrandom.random()</pre><p>這會返回[0，1）範圍內的隨機浮點數。</p><p>此模塊中還有許多其他專用發生器，例如：</p><ul class=list-paddingleft-2><li><p><code>randrange(a, b)</code> 在[a，b）範圍內選擇一個整數。</p></li><li><p><code>uniform(a, b)</code> 在[a，b）範圍內選擇一個浮點數。</p></li><li><p><code>normalvariate(mean, sdev)</code> 採樣法線（高斯）分佈。</p></li></ul><p>一些高級函數直接對序列進行操作，例如：</p><ul class=list-paddingleft-2><li><p><code>choice(S)</code> 從給定的序列中選擇隨機元素</p></li><li><p><code>shuffle(L)</code> 在原地洗牌，即隨機排列</p></li></ul><p>還有一個<code>Random</code>類可以實例化來創建獨立的多個隨機數生成器。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Python</a></li><li><a>開發常見</a></li><li><a>問題</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/2f87337a.html alt=收不到交警便民通知？可能是這裡出了問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bdf88511c83f431c9f75609d9e44d585 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2f87337a.html title=收不到交警便民通知？可能是這裡出了問題>收不到交警便民通知？可能是這裡出了問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8db1a012.html alt=問題408:在變壓器送電前後怎樣檢測差動保護裝置？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e7912ea051664f678d2616da1c042a37 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8db1a012.html title=問題408:在變壓器送電前後怎樣檢測差動保護裝置？>問題408:在變壓器送電前後怎樣檢測差動保護裝置？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/91eece92.html alt="只需 45 秒，Python 給故宮畫一組手繪圖！" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/df1bd890ffee4a439e9f5142ae42c102 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/91eece92.html title="只需 45 秒，Python 給故宮畫一組手繪圖！">只需 45 秒，Python 給故宮畫一組手繪圖！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8aab963e.html alt=Python手繪圖瞭解一下！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/746c9e6e214b48b2a0215fc9e151cdc8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8aab963e.html title=Python手繪圖瞭解一下！>Python手繪圖瞭解一下！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cfd854c6.html alt=故宮下雪了！我用Python給它畫了一組手繪圖，僅用45秒（附代碼） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/774d2f0a372f48c589ec84dd3a164dd9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cfd854c6.html title=故宮下雪了！我用Python給它畫了一組手繪圖，僅用45秒（附代碼）>故宮下雪了！我用Python給它畫了一組手繪圖，僅用45秒（附代碼）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b433c17e.html alt="四十、Python模塊random: 偽隨機數據生成與隨機元素抽取" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/25f231d6-c1ce-4cf8-8988-5da509a0c26a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b433c17e.html title="四十、Python模塊random: 偽隨機數據生成與隨機元素抽取">四十、Python模塊random: 偽隨機數據生成與隨機元素抽取</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/84e317ac.html alt=檢測虛設問題，應當採取強有力的措施加以解決 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/115bad769be144f19346317e77eed4b3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/84e317ac.html title=檢測虛設問題，應當採取強有力的措施加以解決>檢測虛設問題，應當採取強有力的措施加以解決</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dfdb3278.html alt=南通中海問題多多？！竟遭市住建局通報批評 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RZ6gaqQHcJXxWV style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dfdb3278.html title=南通中海問題多多？！竟遭市住建局通報批評>南通中海問題多多？！竟遭市住建局通報批評</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3afc3600.html alt="歡居改造家 一篇看懂，砌牆需要注意的問題有哪些，再也不怕被坑" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/fe51a7bcc26445fa95824ca74c172f17 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3afc3600.html title="歡居改造家 一篇看懂，砌牆需要注意的問題有哪些，再也不怕被坑">歡居改造家 一篇看懂，砌牆需要注意的問題有哪些，再也不怕被坑</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/97268c50.html alt=蛋糕製作中的十一個常見問題及原因 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/2658ec69-8ea5-490e-a30a-08c8ed990c73 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/97268c50.html title=蛋糕製作中的十一個常見問題及原因>蛋糕製作中的十一個常見問題及原因</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7245dc43.html alt=別說我沒提醒你！螺栓連接有問題，趕緊測一下扭矩！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/35dce4fcbaa64306ab138cc84d150d4e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7245dc43.html title=別說我沒提醒你！螺栓連接有問題，趕緊測一下扭矩！>別說我沒提醒你！螺栓連接有問題，趕緊測一下扭矩！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/56faa63d.html alt=航空發動機軸承問題解析：慎重選用軸承遊隙和​防止軸承打滑 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/fa005c54189c4c61bf01b5c6f8afe285 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/56faa63d.html title=航空發動機軸承問題解析：慎重選用軸承遊隙和​防止軸承打滑>航空發動機軸承問題解析：慎重選用軸承遊隙和​防止軸承打滑</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7deecdbb.html alt=定製文件櫃需要注意哪些問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/931a82db62a14175b712856354243b2e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7deecdbb.html title=定製文件櫃需要注意哪些問題>定製文件櫃需要注意哪些問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/25ca0d4f.html alt=有些暗傷，破解與和解，從來都不是問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b5e2b6f988c141fdbd859d5f5e943129 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/25ca0d4f.html title=有些暗傷，破解與和解，從來都不是問題>有些暗傷，破解與和解，從來都不是問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/04486eba.html alt=Python爬蟲使用selenium爬取群成員信息（全自動實現自動登陸） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/e11e69f643584941aaa2b71ee6ed3d7f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/04486eba.html title=Python爬蟲使用selenium爬取群成員信息（全自動實現自動登陸）>Python爬蟲使用selenium爬取群成員信息（全自動實現自動登陸）</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>