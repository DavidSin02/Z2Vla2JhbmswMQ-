<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>萬字詳文講解視頻和視頻幀基礎知識，關於視頻和幀看這篇就夠了 | 极客快訊</title><meta property="og:title" content="萬字詳文講解視頻和視頻幀基礎知識，關於視頻和幀看這篇就夠了 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/6cef7e799c9840bcaabf4c9eeae857ca"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4e1133f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4e1133f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4e1133f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4e1133f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4e1133f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4e1133f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/4e1133f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/4e1133f.html><meta property="article:published_time" content="2020-10-29T21:06:37+08:00"><meta property="article:modified_time" content="2020-10-29T21:06:37+08:00"><meta name=Keywords content><meta name=description content="萬字詳文講解視頻和視頻幀基礎知識，關於視頻和幀看這篇就夠了"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/4e1133f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>萬字詳文講解視頻和視頻幀基礎知識，關於視頻和幀看這篇就夠了</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>寫在前面</h1><p>從18年12月接手在基於x86平臺的邊緣計算設備上進行取流解碼的工作至今，已有數月。筆者還記得當初對流媒體、視頻、幀、圖像等概念完全雲裡霧裡，慢慢跟著項目一步步學習走過來，受益良多，以這篇文章勵志作為後續繼續學習的里程碑吧！</p><p>本文將介紹的是：</p><ol start=1><li>視頻的基礎知識。包括：<strong>視頻協議和格式</strong>、<strong>視頻流</strong>。</li><li>視頻幀的基礎知識。包括：<strong>YUV幀格式</strong>、<strong>常見的幀名詞（幀率fps、分辨率、碼率）</strong>、<strong>“奇怪”的幀名詞（1080p和1080i）</strong>、<strong>視頻編解碼而衍生的幀名詞（GOP、I\B\P幀）</strong>。</li></ol><hr><h1 class=pgc-h-arrow-right><strong>修改記錄</strong></h1><p>2019年4月8日首次完成該文章，內容包括：</p><ol start=1><li>視頻協議、格式、播放原理等基礎內容；</li><li>YUV格式、fps、分辨率、GOP和I/B/P幀等視頻幀相關的基礎知識；</li><li>提到了H264等視頻壓縮技術。</li></ol><p>2019年9月7日進行二次修改，修改內容如下：</p><ol start=1><li>第一章節增加視頻流介紹，刪除了播放原理介紹；</li><li>第二章增加了YUV採樣和存儲格式的示意圖，場、1080p和1080i的介紹；刪除了YUV的顏色值域（Color Range）介紹；</li><li>刪除了原第三章的內容，這塊會在後續中出專文介紹。</li></ol><hr><h1 class=pgc-h-arrow-right><strong>I. 視頻的基礎知識</strong></h1><p>相信所有人對視頻一定不陌生，平時也一定經常在各大視頻網站（如騰訊視頻、嗶哩嗶哩）瀏覽，甚至偶爾也會把視頻緩存到本地，保存成.mkv，.avi文件之類啦。前者是我們常說的『網絡流媒體』，後者是『本地視頻文件』。提到這裡，兩個問題來了：</p><ol start=1><li>本地視頻文件常見有MP4、MKV、AVI等，這些都是什麼？有什麼區別？</li><li>在騰訊視頻、嗶哩嗶哩網上看的視頻，與本地播放的MP4、MKV、AVI文件，有什麼區別？</li></ol><p>介紹第一個問題之前，必須引入一個名詞『<strong>視頻封裝格式</strong>』，簡稱『<strong>視頻格式</strong>』，也稱為『<strong>容器</strong>』。有的說法還要區分是視頻文件格式和視頻封裝格式，本文統一稱『<strong>視頻封裝格式</strong>』。</p><h1 class=pgc-h-arrow-right><strong>視頻格式</strong></h1><p><strong>問題1：本地視頻文件常見有MP4、MKV、AVI等，這些都是什麼？有什麼區別？</strong></p><p>首先，MP4、AVI、MKV都是本地視頻文件的後綴，在windows系統下，用於提示操作系統應該採用哪個應用程序打開。而在流媒體領域，這些都被稱為『<strong>視頻封裝格式</strong>』，因為除了音視頻流之外，它們還包含了一些輔助信息以及組織視音頻的方式。不同格式的視頻在不同平臺上用戶體驗不同，很大原因在於對視音頻的組織方式帶來的差異。筆者以為百度百科上的解釋蠻通俗易懂的（維基百科的說法不夠直白）：</p><blockquote><p><span style="color:#646464;--tt-darkmode-color: #646464">視頻格式是視頻播放軟件為了能夠播放視頻文件而賦予視頻文件的一種識別符號。</span></p></blockquote><p>簡言之，視頻格式規定了和播放器的通信協議。</p><p>其次，筆者最近準備開始深入研究MP4、AVI、MKV等內部原理，主要是對視音頻的組織方式，比如在播放視頻的時候，我們可以選擇國語、粵語、英語等各種語言，這就意味著這段視音頻中包括了多個音頻流。【給自己留個坑吧。】</p><p>最後，筆者推薦一篇非常棒的博客：視頻文件格式知多少，彙總的非常全。</p><p><strong>問題1引申：對要做視音頻處理的開發們來說，接觸MP4、MKV、AVI等各種格式視音頻文件時，有什麼需要注意的嗎？</strong></p><p>視音頻處理可以延展出很多領域，包括解碼、編碼、過濾、增強處理等等。筆者目前只在解碼領域探索，答案是：<strong>對於解碼而言，沒有區別</strong>。其他領域暫不清楚。</p><p>『視頻封裝格式』，是在編碼的視音頻基礎上進行一次“包裝”，添加與播放相關的協議數據（<em>這個是筆者的認知，如有表述不準確，歡迎批評指正</em>）。目前主流開源的框架，在“解包裝”工作上做的已經非常成熟了，如<span style="background-color:#f6f6f6;--tt-darkmode-bgcolor: #1B1B1B">FFMpeg</span>，提供了用於打開視音頻的API，開發人員無需關注具體視頻格式，直接可以取出視音頻流做處理。</p><p>接下來，介紹第二個問題，筆者再引入名詞『<strong>視頻協議</strong>』，也有說法認為『<strong>視頻協議</strong>』也屬於『<strong>視頻封裝格式</strong>』。</p><h1 class=pgc-h-arrow-right><strong>視頻協議</strong></h1><p><strong>問題2：在騰訊視頻、嗶哩嗶哩網上看的視頻，與本地播放的MP4、MKV、AVI文件，有什麼區別？</strong></p><p>『<strong>視頻協議</strong>』是針對網絡流媒體而言的，也就是只有在有網絡時通過瀏覽器或者移動端APP才能看到的視頻，目前常見的協議有RTSP、RTMP、HLS、HTTP等。筆者短暫地接觸過GStreamer開發，在連接到RSTP視頻時，發現除了視音頻流和metadata之外，還攜帶了播放的信令。</p><p>也有文章會把『視頻協議』歸入『視頻封裝格式』。筆者看來，這麼分類也有其道理：『視頻協議』和『視頻封裝格式』都同時攜帶了視音頻和metadata，以及協議/格式需要的其他信息。以<span style="background-color:#f6f6f6;--tt-darkmode-bgcolor: #1B1B1B">FFMpeg</span>為例，並不區分視頻格式和視頻協議；但是<span style="background-color:#f6f6f6;--tt-darkmode-bgcolor: #1B1B1B">GStreamer</span>的話，還是需要指定『視頻協議』，但是不區分『視頻封裝格式』。</p><p>剝開『視頻封裝格式』和『視頻協議』的外殼，接下來了解視音頻流本身，這才是流媒體領域中真正的主角。本文僅介紹視頻流。</p><h1 class=pgc-h-arrow-right><strong>視頻流</strong></h1><p>就視頻流而言，相信大家平時一定經常聽到類似“h264碼流”、“yuv流”、“編碼流”、“解碼流”，“原始流”、“裸流”，“壓縮後的流”或者“未壓縮的流”等等。歸納而言，提到『<strong>視頻流</strong>』的時候，一定只有兩種形式：</p><ul><li>經過壓縮算法壓縮的流數據，稱為『<strong>編碼流</strong>』，又因為目前壓縮/編碼算法以H264為主，因此也常常稱為『<strong>H264碼流</strong>』。</li><li>未經壓縮的流數據，是解碼後的流數據，稱為『<strong>原始流</strong>』，可以想象視頻是由一幅一幅在時間上連續的“圖像”組成的，而因為視頻內部的“圖像”是『YUV』（後文將介紹），因此也常常稱為『<strong>YUV流</strong>』。</li></ul><p>總結出現的名稱，“h264碼流”、“編碼流”、“壓縮後的流”是壓縮/編碼後的視頻流；而“yuv流”、“解碼流”、“未壓縮的流”則是未經壓縮/編碼的視頻流。“裸流”是一個具有歧義的詞，是上下文內容，既可以是前者，也可以是後者。</p><p>因此，如果以後閱讀任何流媒體相關的文章時，看到『<strong>視頻流</strong>』都應該搞清楚，這究竟是編碼/壓縮的，還是沒有。在生活中，接觸到的視頻文件絕大部分都是編碼/壓縮後的；在網絡傳輸場景中，絕大部分也是編碼/壓縮後的。只有在視頻播放時，觀眾觀賞到的時一幀幀被『轉碼』為『RGB』的解碼後視頻流。</p><p>編碼/壓縮在流媒體領域是一項非常重要的技術：從『H264碼流』到『YUV流』的過程稱為<strong>解碼</strong>，反之稱為<strong>編碼</strong>。</p><hr><h1 class=pgc-h-arrow-right><strong>II. 幀</strong></h1><p>流媒體領域，『<strong>流</strong>』很重要，『<strong>流</strong>』的基本元素『<strong>幀</strong>』同樣重要。原因在於：對於<strong>視頻編碼/壓縮</strong>而言，它的核心是採用儘量小的空間存儲一組時間上連續的幀數據；而對於<strong>視頻解碼</strong>而言，就是把被編碼/壓縮後的一組幀數據儘量恢復成原來的樣子。能夠被100%恢復的編碼/壓縮算法稱為<strong>無損壓縮</strong>，反之稱為<strong>有損壓縮</strong>（雖然無損壓縮是最理想的，但是在很多實際場景中為了追求高壓縮率，比如為了減小網絡帶寬壓力，常常不得不選擇有損壓縮）。由此可見，『<strong>幀</strong>』是視頻流媒體領域的核心。接下來，一起來認識什麼是『<strong>幀</strong>』。</p><p>『幀』，可以聯想成我們平時看到的一幅幅“圖像”，只不過我們平時接觸的圖片是『RGB』格式的，而視頻幀通常是『YUV』格式的。既然提到了『RGB』和『YUV』，那麼就來了解下幀的格式『YUV』，引出第一個問題：</p><p><strong>問題3：幀為什麼採用『YUV』格式？『YUV』是什麼？</strong></p><p>為此，筆者曾經花了很久去了解顏色空間、電視成像的發展史等，整理結論如下：</p><ol start=1><li><strong>在達到最大壓縮率的情況下，能夠保證對人眼感知的失真度最小。</strong>『YUV』的三通道中，其中"Y"表示明亮度（Lumina nce或Luma），也就是灰階值；而"U"和"V"表示的則是色度（Chrominance或Chroma）。有一堆科學家研究發現，人眼對UV的敏感度最低，因此可以極大比例地壓縮UV兩個通道的數值。見視頻編解碼學習一 yuv格式。</li><li><strong>為了向前兼容黑白電視</strong>。這個就涉及歷史原因了，筆者非常推薦零基礎入門音視頻開發。歷史上在制定視頻幀格式時，是有人提出過用RGB的，最終決定用YUV的真正原因其實是這個（見影像使用YUV格式，為什麼不用RGB呢?。</li></ol><p>接下來解釋『YUV』是什麼，筆者以為，『YUV』是一種廣義的概念，在視頻領域，當提到『YUV』的時候，往往是以下幾個意思：</p><ol start=1><li><strong>顏色空間</strong></li></ol><p>“Y”表示明亮度（Luminance、Luma），“U”和“V”則是色度（Chrominance）、濃度（Chroma）。這裡表示的是<strong>色彩空間的基</strong>，即類似XYZ座標系的一種色標表示基準，也就是說每一種顏色可以通過三維向量&lt;y^i^,u^i^,v^i^>來表示。與其類似的還有RGB顏色空間、HSV顏色空間等。下圖來自How does the YUV color coding work?</p><div class=pgc-img><img alt=萬字詳文講解視頻和視頻幀基礎知識，關於視頻和幀看這篇就夠了 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6cef7e799c9840bcaabf4c9eeae857ca><p class=pgc-img-caption>圖1. YUV座標軸示意圖</p></div><p>隨著通信行業的發展，實際應用之多之複雜，導致『YUV』衍生出了一個大家族。接觸視頻領域的一定聽說過<strong>YCbCr</strong>，甚至還有<strong>YPbPr</strong>、<strong>YIQ</strong>等。它們有的已經被時代淘汰，有的現在還在使用。之所以出現『YUV』大家族，完全是因為實際電路系統之間的差異，導致要從『YUV』轉到『RGB』空間，實際對應的轉化係數是有些許差異的，於是各個部門開始制定各種規範，才有了我們現在看到的『YUV』大家族。</p><p><strong>YCbCr</strong>是專門針對數字電路而誕生的；<strong>YPbPr</strong>則是模擬電路。但是，現在是數字時代，所以為了模擬電路而生的<strong>YPbPr</strong>已經逐漸被淘汰了，而<strong>YCbCr</strong>還一直髮揮著作用。因此現在，<strong>YCbCr</strong>有時也會被簡單地稱為/認為『YUV』。</p><p><strong>2. 採樣率</strong></p><p>讀者可能聽說過“<strong>YUV444</strong>”，“<strong>YUV422</strong>”，“<strong>YUV420</strong>”，到這裡可能會納悶：“YUV不是顏色空間嗎？為什麼後面還會跟著一串數字？” 因為當你看到YUV後面跟著一串數字的時候，『YUV』已經不再是顏色空間的基本含義了，而是意味著在原始『YUV流』上的採樣。<br>在以前流媒體剛剛興起時，還沒有什麼4G/5G，當時為了減小網絡傳輸的帶寬的壓力，可謂做了種種努力。除了編碼/壓縮之外，YUV採樣率也是一種。<br><strong>444</strong>，<strong>422</strong>和<strong>420</strong>是三種『YUV』（在數字電路中指代YCbCr）的採樣，三位數分別代表Y\U\V（數字電路中為Y\Cb\Cr，本段後同）通道的抽樣比。所以可以理解，<strong>444</strong>是全採樣；而<strong>422</strong>是對Y進行全採樣，對U\V分別進行1/2均勻採樣。有趣的問題來了，<strong>420</strong>難道是完全丟棄了V通道/分量數據嘛？答案是否定的。<br>首先，必須要搞明白一個問題，一幀圖像是由一個個像素組成的矩形，譬如4x4的尺寸的圖像，就是由16個像素點組成的。在平時接觸的『RGB』圖像中，每個像素必然至少由R\G\B這三個通道組成的（有的圖像還有\alpha分量），每個分量的取值一般都是[0,255]，也就是[2^0，2^8]，因此經常說一個像素佔用3字節（如果還有其他分量，比如RGBA，就另當別論）。『YUV』圖像同理，它的每個像素是由Y\U\V組成的。<br>接下來，從整張圖像宏觀考慮採樣問題。還是以4X4的圖像為例，<strong>444</strong>的如下圖2-1，這個是形象化成圖像的樣子，實際在機器內存儲並不是這樣，具體可以參見博客《圖像原始格式一探究竟》。<strong>422</strong>和<strong>420</strong>分別如下圖2-2和2-3。</p><div class=pgc-img><img alt=萬字詳文講解視頻和視頻幀基礎知識，關於視頻和幀看這篇就夠了 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/7b69861186f345e6ac78955bf181e2f3><p class=pgc-img-caption>圖2-1. YUV444採樣示意圖</p></div><p>​圖2-1對應<strong>YUV444</strong>採樣，即全採樣，圖示中可以看出每個像素中的Y\U\V通道都保留下來了，一般來說<strong>YUV444</strong>太大了，因此很少使用。</p><div class=pgc-img><img alt=萬字詳文講解視頻和視頻幀基礎知識，關於視頻和幀看這篇就夠了 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/f12b0c0fab0c4fd6824ed1f775ac7e11><p class=pgc-img-caption>​圖2-2. YUV422採樣示意圖</p></div><p>圖2-2對應<strong>YUV422</strong>採樣，這種採樣方式是：每個掃描線或者說每行相鄰2個像素，只取1個像素的U\V分量。此外，可以計算出來，每個像素佔用的大小為原來的2/3，因此說<strong>YUV422</strong>是<strong>YUV444</strong>的2/3大小。</p><p>這個時候就有一個問題，在『YUV』轉『RGB』時，被抽走了U\V分量的像素要怎麼辦呢？<strong>做法很簡單，就是相鄰2個像素的Y分量公用保留著的U\V分量。</strong></p><div class=pgc-img><img alt=萬字詳文講解視頻和視頻幀基礎知識，關於視頻和幀看這篇就夠了 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/35f4ce5826794efba415a93d759707cc><p class=pgc-img-caption>​圖2-2. YUV422採樣示意圖</p></div><p>圖2-3對應<strong>YUV420</strong>採樣，這種採樣方式是：隔行進行<strong>YUV422</strong>每行採樣的辦法，即相鄰2個像素只取1個像素的U\V分量；下一行丟棄所有的U\V分量。此外，可以計算出來，每個像素佔用的大小為原來的1/2，因此說<strong>YUV420</strong>是<strong>YUV444</strong>的1/2大小。恢復U\V分量的辦法同<strong>YUV422</strong>，只不過這裡是2X2的矩陣共享保留著的U\V分量。</p><p>這種設計辦法真的很巧妙！前文提到的<strong>"人眼對UV的敏感度最低，因此可以極大比例地壓縮UV兩個通道的數值"</strong>，且對於圖像而言，相鄰的區域像素的色彩、飽和度一般非常接近，因此這種以2X2矩陣為基本單位，只保留1組U\V分量合情合理。</p><p><strong>3. 編碼/存儲格式</strong></p><p>大家肯定還聽說過<strong>YV12</strong>、<strong>YU12</strong>、<strong>NV12</strong>、<strong>NV21</strong>吧，看到這裡是不是又納悶：“後面的數字怎麼變成2個了？而且前面的英文字母還變了？”<br>以上統稱為『<strong>視頻的存儲格式</strong>』，也就是說，計算機是如何存儲一幀視頻的。<br>首先，『<strong>視頻的存儲格式</strong>』總分為兩大類：『<strong>打包格式（packed）</strong>』和『<strong>平面格式（planar）</strong>』。前者又被稱作『<strong>緊湊格式（packed）</strong>』。其實除此之外還有『<strong>半平面模式（Semi-Planar）</strong>』，估計是使用的比較少，因此在很多文章中常被忽略。<br>筆者很感興趣，為什麼會出現『<strong>打包格式</strong>』和『<strong>平面格式</strong>』兩大派系，網上搜了很多資料也沒找到原因，博客【音視頻基礎】：I420、YV12、NV12、NV21等常見的YUV420存儲格式提到了需要約定存儲格式，但也沒提到為什麼會分成這兩種。要麼就是派系之爭，類似貝葉斯學派和頻率學派；要麼就是實際應用中逐漸衍生出這兩大格式。時至今日，這兩個格式還在被使用，因此對於多媒體開發者們都有必要了解。<br>『<strong>打包格式</strong>』是把Y\U\V分量交叉存儲，『<strong>平面格式</strong>』則是把Y\U\V嚴格分開存儲，『<strong>半平面模式</strong>』介於兩者之間，Y分量分開存儲，U\V交叉存儲。<br>以下圖為例說明『<strong>打包格式</strong>』、『<strong>平面格式</strong>』和『<strong>半平面模式</strong>』應該是非常清楚的，圖摘自博客YUV格式初探：</p><p><br></p><div class=pgc-img><img alt=萬字詳文講解視頻和視頻幀基礎知識，關於視頻和幀看這篇就夠了 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/675407e1ef114e7eb40da9f094e0c553><p class=pgc-img-caption>​圖3-1. YUV420P存儲示意圖</p></div><div class=pgc-img><img alt=萬字詳文講解視頻和視頻幀基礎知識，關於視頻和幀看這篇就夠了 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cd36cc3bb6b14035a743c9d7ba6e48b1><p class=pgc-img-caption>​圖3-2. YUV420SP存儲示意圖</p></div><div class=pgc-img><img alt=萬字詳文講解視頻和視頻幀基礎知識，關於視頻和幀看這篇就夠了 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/70b8a16639a243c1ba4746d6a587af9c><p class=pgc-img-caption>​圖3-3. YUV420Packet存儲示意圖</p></div><p>但是關於上圖的『打包格式』，筆者是是有一點疑惑的，大多數的說法是”Y\U\V通道交叉存儲，相鄰的像素儘量打包在一起“，圖3-3中U1後面跟著的是U2而不是V1，而且Y\U\V的排列方式似乎也不完全是交叉？筆者嘗試在網上搜索『打包格式』更多的例子，沒有找到特別好的資料，【這裡給自己挖一個坑吧】。</p><p><br></p><p>接下來，我們繼續瞭解一些幀相關的概念。</p><p><strong>常見的幀名詞</strong></p><ol start=1><li><strong>幀率（FPS）</strong><br>『幀率』，FPS，全稱Frames Per Second。指每秒傳輸的幀數，或者每秒顯示的幀數，一般來說，『幀率』影響畫面流暢度，且成正比：幀率越大，畫面越流暢；幀率越小，畫面越有跳動感。一個較權威的說法：<br>當視頻幀率不低於24fps時，人眼才會覺得視頻時連貫的，稱為“視覺暫留”現象。<br>因此，才有說法：儘管『幀率』越高越流暢，但在很多實際應用場景中24fps就可以了。</li><li><strong>分辨率（Resolution）</strong><br>『分辨率』，也常被俗稱為『圖像的尺寸』或者『圖像的大小』。指一幀圖像包含的像素的多少，常見有1280x720（720P），1920X1080（1080P）等規格。『分辨率』影響圖像大小，且與之成正比：『分辨率』越高，圖像越大；反之，圖像越小。</li><li><strong>碼率（BPS）</strong><br>『碼率』，BPS，全稱Bits Per Second。指每秒傳送的數據位數，常見單位KBPS（千位每秒）和MBPS（兆位每秒）。筆者認為這個概念真正要理解起來還是需要好好說明的，網上一說：“『碼率』與體積成正比：碼率越大，體積越大；碼率越小，體積越小”；另一說：“『碼率』越大，說明單位時間內取樣率越大，數據流精度就越高，這樣表現出來的的效果就是：視頻畫面更清晰畫質更高”；還有說法是：”『碼率』就是『失真度』“。但是筆者有一段時間就是不理解，每秒傳輸的數據越大，為什麼必然就對應畫面更清晰？還有體積怎麼理解呢？且看下文”<strong>三者之間的關係</strong>“。</li></ol><p><strong>『幀率』『分辨率』和『碼率』三者之間的關係</strong><br>最理想的情況是畫面越清晰、越流暢是最好的。但在實際應用中，還需要結合硬件的處理能力、實際帶寬條件選擇。高『幀率』高『分辨率』，也就意味著高『碼率』，也意味著需要高帶寬和強大的硬件能力進行編解碼和圖像處理。所以『幀率』和『分辨率』應該視情況而定。<br>要說三者之間的關係，其實就是對於『碼率』的理解。在<strong>碼率（BPS）</strong>概念中提到了幾段摘自網上的說法，說的都太模糊了，筆者直到閱讀了文章Video Bitrate Vs. Frame Rate，才真的理解了『碼率』。<br>首先，這些說法都沒有交代一個前提：<strong>『幀率』、『分辨率』和『壓縮率』都會影響『碼率』</strong>。Video Bitrate Vs. Frame Rate](https://www.techwalla.com/articles/video-bitrate-vs-frame-rate)文章在一開始就明確指出：</p><blockquote><p><span style="color:#646464;--tt-darkmode-color: #646464">Bitrate serves as a more general indicator of quality, with higher resolutions, higher frame rates and lower compression all leading to an increased bitrate.<br>『碼率』是更廣泛的（視頻）質量指標：更高的『分辨率』，更高的『幀率』和更低的『壓縮率』，都會導致『碼率』增加。</span></p></blockquote><p>文章後面又特別強調『分辨率』和『壓縮率』對『碼率』的影響：<strong>高分辨率意味著圖片可以包括更多的細節，低壓縮率意味著圖片壓縮損失越少，即失真越少，越清晰。</strong>那為什麼不特地討論『幀率』呢？筆者認為原因有二：一個是『幀率』的影響非常直觀，每秒幀數增加必然導致數據量增加；另一個是實際應用場景中『幀率』是相對固定的，我們觀看的一般視頻都在25-30fps之間，現在一些高幀視頻是60fps，可見視頻『幀率』在實際場景中被討論的很少。</p><p><br></p><p><strong>奇怪的幀名詞：1080p和1080i、場</strong></p><p>筆者僅僅出於覺得有趣才放上來的，<strong>1080p和1080i、場</strong>都是相對比較“老”的概念了，在還是CRT電視的時代，顯示器顯示畫面都是靠電子槍一行一行掃描畫面才能產生一副完整的圖像，這就被稱作『<strong>場</strong>』，後來這個名詞也不常使用了，被取代它的是『<strong>幀</strong>』。【科技在進步，過時的概念、應用都會被新興的替換，所以真的要不斷學習緊跟時代啊！】</p><p><strong>1080p</strong>和<strong>1080i</strong>也是『<strong>場</strong>』同一時期的概念：</p><ul><li><strong>${數字}i</strong>的字母”<strong>i</strong>“表示Interlace，代表隔行掃描，比如奇數『<strong>場</strong>』只掃描奇數行，後一『<strong>場</strong>』即偶數『<strong>場</strong>』只掃描偶數行。這在過去是非常有用的，當時網絡條件差，帶寬受限，隔行掃描可以很大程度上減少傳輸的數據，又不至於影響觀眾觀看體驗。</li><li><strong>${數字}p</strong>的字母”<strong>p</strong>“表示Progressive，即逐行掃描，也就是一『<strong>場</strong>』把全部畫面掃描完整。這是後來才提出的概念，這也代表時代進步，帶寬條件上來了。</li></ul><p>既然都是老概念了，那為什麼還要再提呢？借用文章1080P和1080i是什麼意思？第一段來說：</p><blockquote><p><span style="color:#646464;--tt-darkmode-color: #646464">進入液晶時代的如今，隔行和逐行其實已經沒有太大的意義了，現在的電視或者是顯示器都屬於固定像素設備，像素點同時發光，並不需要掃描，但是硬要說的話可以認為現在的顯示設備都是逐行掃描的，但也並不是說1080P和1080i等就可以淘汰了，畢竟還涉及到攝像機的格式，不過普通觀眾也不會關心是用什麼攝像機拍的，只關心呈現出來的樣貌就好了。</span></p></blockquote><p><br></p><p>視頻『幀』和編解碼密切相關，因此還有不少『幀』的概念是和視頻編解碼相關的。</p><p><strong>視頻編解碼而衍生的幀名詞</strong></p><ol start=1><li><strong>I幀、P幀、B幀和IDR幀</strong><br>但凡接觸過一點視頻編解碼的讀者，一定見過I\P\B幀，至於IDR可能見的少一些。下面，簡單解釋每種類型：</li></ol><ul><li><strong>I幀</strong>，英文全寫<strong>Intra Picture</strong>，又稱<strong>幀內編碼幀</strong>，俗稱<strong>關鍵幀</strong>。一般來說<strong>I幀</strong>不需要依賴前後幀信息，可獨立進行解碼。有數據表明，僅<strong>I幀</strong>的壓縮率，可以達到7，這裡其實可以把I幀的壓縮等同於單獨壓縮一幅圖片。至於說<strong>I幀</strong>的壓縮只壓縮了空間上的冗餘信息，放在後續編碼相關的系列文章中會詳述。【這裡再挖一個坑，免得自己忘記了】</li><li><strong>P幀</strong>，英文全寫<strong>predictive-frame</strong>，又稱<strong>前向預測編碼幀</strong>，也有<strong>幀間預測編碼幀</strong>。顧名思義，<strong>P幀</strong>需要依賴前面的<strong>I幀</strong>或者<strong>P幀</strong>才能進行編解碼，因為一般來說，<strong>P幀</strong>存儲的是當前幀畫面與前一幀（前一幀可能是<strong>I幀</strong>也可能是<strong>P幀</strong>）的差別，較專業的說法是<strong>壓縮了時間冗餘信息，或者說提取了運動特性</strong>。<strong>P幀</strong>的壓縮率約在20左右，幾乎所有的H264編碼流都帶有大量的<strong>P幀</strong>。</li><li><strong>B幀</strong>，英文全寫<strong>bi-directional interpolatedprediction frame</strong>，又稱 <strong>雙向預測內插編碼幀</strong>，簡稱<strong>雙向預測編碼幀</strong>。<strong>B幀</strong>非常特殊，它存儲的是本幀與前後幀的差別，因此帶有B幀的視頻在解碼時的邏輯會更復雜些，CPU開銷會更大。因此，不是所有的視頻都帶有<strong>B幀</strong>，筆者目前還沒有接觸過帶<strong>B幀</strong>的視頻。【找到帶B幀視頻一定要珍藏起來好好研究！】不過，<strong>B幀</strong>的壓縮率能夠達到50甚至更高，在壓縮率指標上還是很客觀的。</li><li><strong>IDR幀</strong>，英文全寫<strong>Instantaneous Decoding Refresh</strong>，翻譯過來是<strong>即時解碼刷新</strong>。聽上去，這類幀並不是名詞概念，倒像是個動詞？<strong>IDR幀</strong>是一種特殊的<strong>I幀</strong>，它是為了服務於編解碼而提出的概念，<strong>IDR幀的作用是立刻刷新,使錯誤不致傳播,從IDR幀開始,重新算一個新的序列開始編碼</strong>（摘自博客H264中I幀和IDR幀的區別）。</li></ul><p><strong>I/P/B幀</strong>，並不是依據視頻幀數據內部的元素的不同來區分的，從解碼後的幀本身而言，它們沒有任何區別。僅僅是在編碼時，對幀處理的方式不同而已。</p><ol start=1><li><strong>GOP</strong><br>英文全稱<strong>Group Of Pictures</strong>，一般來說，指的就是兩個<strong>I幀</strong>之間的間隔，嚴格來說，是兩個<strong>IDR幀</strong>之間的間隔。筆者對<strong>GOP</strong>研究的不多，對於網上的說法：“<strong>GOP</strong>在一定程度上會影響視頻畫面質量 - 在碼率相同的情況下，GOP越大，意味著P\B幀越多，也就更容易獲取較好的圖像質量”這個說法存疑。【這裡留個坑待填】</li><li><strong>PTS、DTS</strong><br>筆者是在對視頻文件硬做解碼的時候，發現實際解碼輸出的fps是硬解的能力上限，比如一個24fps的視頻文件，在用硬件解碼時，能夠達到100+，當時接到一個需求是：“需要控制視頻文件的解碼率，讓它和文件的fps保持一致”。後來查閱了大量的資料，進而瞭解了<strong>DTS</strong>和<strong>PTS</strong>的概念：</li></ol><ul><li><strong>DTS</strong>，英文全稱<strong>Decoding Time Stamp</strong>，即解碼時間戳，這個時間戳的意義在於告訴解碼器該在什麼時候解碼這一幀的數據。</li><li><strong>PTS</strong>，英文全稱<strong>Presentation Time Stamp</strong>，即顯示時間戳，這個時間戳用來告訴播放器該在什麼時候顯示這一幀的數據。</li></ul><p>這個概念在做視音頻同步的時候特別重要，尤其是<strong>PTS</strong>，目前常見的視音頻同步的三種策略“同步到音頻的<strong>PTS</strong>”、“同步到視頻的<strong>PTS</strong>”和“同步到系統/外部時鐘”，都是基於<strong>PTS</strong>完成的。</p><hr><h1 class=pgc-h-arrow-right><strong>寫在後面</strong></h1><p>儘管每個概念網上都可以搜到一大堆的資料，但是筆者從一個多媒體開發小白走過來，覺得能有相對系統入門的綜合性介紹就會更好了！本文每個地方，都是基於筆者自己的理解，而不是簡單地從網上“複製粘貼”過來的，希望能夠對大家有所幫助！當然，文章中有不嚴謹的地方，歡迎留言告知；或者有什麼有趣的話題探討，也歡迎私信留言！</p><p>最後，筆者目前在騰訊優圖的邊緣計算開發小團隊，目前我們正在計劃開源一款能夠適配設備（以邊緣設備為主）視覺AI計算落地應用框架-RapidAIoT，內容包括視頻取流、AI計算、消息結果上報下發中間件。也歡迎大家諮詢瞭解。</p><p><br>本文轉自：小北的技術筆記，更多幹貨盡在騰訊技術工程</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>萬字</a></li><li><a>詳文講</a></li><li><a>解視頻</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/46ff8566.html alt=輸入主題就能生成萬字文章？解密狗屁不通文章生成器！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/c2383ec46acf4ed5aec149441b42dea8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/46ff8566.html title=輸入主題就能生成萬字文章？解密狗屁不通文章生成器！>輸入主題就能生成萬字文章？解密狗屁不通文章生成器！</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/f9b87e08.html alt=《一人之下》五毒職業大型萬字百科——超級長篇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/0f6178fc014e4e4f995ef6e9d058ebbf style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/f9b87e08.html title=《一人之下》五毒職業大型萬字百科——超級長篇>《一人之下》五毒職業大型萬字百科——超級長篇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/74c701b.html alt="5萬字、97 張圖總結操作系統核心知識點(上)" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/98a0e3ef45ee4fc4b806e816919b54f0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/74c701b.html title="5萬字、97 張圖總結操作系統核心知識點(上)">5萬字、97 張圖總結操作系統核心知識點(上)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/aafa7dc.html alt="5萬字、97 張圖總結操作系統核心知識點(下)" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c3b64f421acc45b2a147aa814c139b48 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/aafa7dc.html title="5萬字、97 張圖總結操作系統核心知識點(下)">5萬字、97 張圖總結操作系統核心知識點(下)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/aa4d5f0.html alt=1.5萬字，全網最詳細的網賺資料免費分享，助你輕鬆月入萬元 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/7d818d45-d099-4b8f-a007-4c5cf175b758 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/aa4d5f0.html title=1.5萬字，全網最詳細的網賺資料免費分享，助你輕鬆月入萬元>1.5萬字，全網最詳細的網賺資料免費分享，助你輕鬆月入萬元</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/57c1134.html alt=金斯伯格萬字訃告：讀完能瞭解，為什麼恨她的右翼，也必須尊重她 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/b96fa93378184bd588101c8b580559f0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/57c1134.html title=金斯伯格萬字訃告：讀完能瞭解，為什麼恨她的右翼，也必須尊重她>金斯伯格萬字訃告：讀完能瞭解，為什麼恨她的右翼，也必須尊重她</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f2ab15c.html alt=萬字圖文！記錄首鋼京唐2座5576高爐建設歷程！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8cf4c6e90c03415b81b66d9ff6fc1e69 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f2ab15c.html title=萬字圖文！記錄首鋼京唐2座5576高爐建設歷程！>萬字圖文！記錄首鋼京唐2座5576高爐建設歷程！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e17653c.html alt=拇指大“小抄”藏10萬字，鹽水泡答案衣，高考作弊黑科技瞭解一下 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3d4e5c52a52346e5b2e8f33695aa6f9f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e17653c.html title=拇指大“小抄”藏10萬字，鹽水泡答案衣，高考作弊黑科技瞭解一下>拇指大“小抄”藏10萬字，鹽水泡答案衣，高考作弊黑科技瞭解一下</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6e29ba0.html alt=硬核科普：萬字百圖解讀水陸兩棲飛機的前世今生和關鍵技術 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/cffc90002f98491da8758eb60da334dd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6e29ba0.html title=硬核科普：萬字百圖解讀水陸兩棲飛機的前世今生和關鍵技術>硬核科普：萬字百圖解讀水陸兩棲飛機的前世今生和關鍵技術</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f8112cb.html alt=萬字詳文徹底弄懂TCP協議：從三次握手和四次揮手說起 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/4b1546669f144ee4b07bce69320d4431 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f8112cb.html title=萬字詳文徹底弄懂TCP協議：從三次握手和四次揮手說起>萬字詳文徹底弄懂TCP協議：從三次握手和四次揮手說起</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>