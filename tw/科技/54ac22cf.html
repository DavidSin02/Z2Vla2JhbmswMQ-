<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>存儲過程和函數及變量的使用 | 极客快訊</title><meta property="og:title" content="存儲過程和函數及變量的使用 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/08397a69eddb4b9eb5295e40b654561d"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/54ac22cf.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/54ac22cf.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/54ac22cf.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/54ac22cf.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/54ac22cf.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/54ac22cf.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/54ac22cf.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/54ac22cf.html><meta property="article:published_time" content="2020-11-14T21:02:06+08:00"><meta property="article:modified_time" content="2020-11-14T21:02:06+08:00"><meta name=Keywords content><meta name=description content="存儲過程和函數及變量的使用"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/54ac22cf.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>存儲過程和函數及變量的使用</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><div class=pgc-img><img alt=存儲過程和函數及變量的使用 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/08397a69eddb4b9eb5295e40b654561d><p class=pgc-img-caption></p></div><p>存儲過程和函數是在數據庫中定義一些SQL語句的集合，然後直接調用這些存儲過程和函數來執行已經定義好的SQL語句。存儲過程和函數可以避免開發人員重複的編寫相同的SQL語句。而且，存儲過程和函數是在mysql服務器中存儲和執行的，可以減少客戶端和服務器端的數據傳輸。</p><p>一．創建存儲過程和函數</p><p>1. 創建存儲過程</p><p>mysql中創建存儲過程的基本形式：</p><p><strong>create procedure sp_name([proc_parameter[,…]]) [characteristic…] routine_body;</strong></p><p>sp_name:參數是存儲過程的名稱；</p><p>proc_parameter:表示存儲過程的參數列表；</p><p>characteristic：參數指定存儲過程的特性；</p><p>routine_body:參數是SQL代碼的內容，可以用begin…end來標誌SQL代碼的開始和結束；</p><p>proc_parameter中每個參數由3部分組成。這3部分分別是輸入輸出類型、參數名稱和參數類型。</p><p>[in|out|inout] param_name type</p><p>in:表示輸入參數</p><p>out:表示輸出參數</p><p>inout:表示既可以是輸入也可以是輸出</p><p>param_name:參數是存儲過程的參數名稱</p><p>type：參數指定存儲過程的參數類型，該類型可以是mysql數據庫的任意數據類型。</p><p>characteristic參數有多個取值。取值說明：</p><p>language SQL：說明routine_body部分是由SQL語言的語句組成，這也是數據庫系統默認的語言。</p><p>[not] deterministic：指明存儲過程的執行結果是否是確定的。</p><p>deterministic：表示結果是確定的，每次執行存儲過程時，相同的輸入會得到相同的輸出。</p><p>not deterministic：表示結果是非確定的，相同的輸入可能得到不同的輸出。默認情況下，結果也是非確定的。</p><p>{contains sql|no sql|reads sql data|modifies sql data}：指明子程序使用SQL語句的限制。</p><p>contains SQL：表示子程序包含SQL語句，但不包含讀或者寫數據的語句；</p><p>no SQL：表示子程序中不包含SQL語句；</p><p>reads SQL data：表示子程序中包含讀數據的語句；</p><p>modifies sql data：表示子程序中包含寫數據的語句。默認情況下，系統會指定為contains SQL。</p><p>SQL security{definer|invoker}：指明誰有權限來執行。</p><p>definer：表示只有定義者自己才能執行；</p><p>invoker：表示調用者可以執行。默認情況下，系統指定的權限是definer。</p><p>comment ‘string’：註釋信息。</p><p>注：創建存儲過程時，系統默認指定contains SQL，表示存儲過程中使用SQL語句，最好設置為no SQL。而且，存儲過程中最好在comment部分對存儲過程進行簡單的註釋，以便以後再閱讀存儲過程的代碼是更加方便。</p><p>示例：下面創建一個名為num_from_employee的存儲過程。</p><p><strong>delimiter &&</strong></p><p><strong>create procedure num_from_employee(in emp_id int,out count_num int)</strong></p><p><strong>reads sql data</strong></p><p><strong>begin</strong></p><p><strong>select count(*) into count_num</strong></p><p><strong>from employee</strong></p><p><strong>where d_id=emp_id;</strong></p><p><strong>end &&</strong></p><p>注：代碼執行完畢，沒報錯就表示存儲過程創建成功；</p><p>說明：mysq中默認的語句結束符為分號（;）。存儲過程中的SQL語句需要分號來結束。為避免衝突，首先用”delimiter &&”將mysql的技術符設置為&&。最後再用”delimiter;”來將結束符恢復成分號。</p><p>創建存儲函數</p><p>mysql中創建存儲函數的語法：</p><p><strong>create function sp_name([func_parameter[,…]])</strong></p><p><strong>returns type</strong></p><p><strong>[characteristic…] routine_body</strong></p><p>sp_name:參數是函數的名稱；</p><p>func_parameter:表示存儲函數的參數列表；</p><p>returns type:指返回值類型；</p><p>characteristic:參數指定存儲函數的特性，該參數的取值與存儲過程中取值是一樣的。</p><p>routine_body:參數是SQL代碼的內容，可以用begin…end來標誌SQL代碼的開始和結束。</p><p>func_parameter:可以由多個參數組成，其中每個參數由參數名稱和參數類型組成，形式：param_name type</p><p>其中，param_name 是存儲函數的參數名稱；</p><p>type：參數是指定存儲函數的參數類型；</p><p>示例：下面創建一個名為name_from_employee的存儲函數</p><p><strong>create function name_from_employee(emp_id int)</strong></p><p><strong>returns varchar(20)</strong></p><p><strong>begin</strong></p><p><strong>return (select name from employee where num=emp_id);</strong></p><p><strong>end</strong></p><p>存儲函數的名稱：name_from_employee;</p><p>函數的參數：emp_id;</p><p>返回值是varchar類型;</p><p>2. 變量的使用</p><p>在存儲過程和函數中，可以定義和使用變量。可以使用declare關鍵字定義變量，然後賦值。變量的作用範圍是begin…and程序段中。</p><p>(1) 定義變量</p><p>使用declare關鍵字定義變量。語法：</p><p>declare var_name[,…] type [default value]</p><p>declare：聲明變量；</p><p>var_name：參數是變量的名稱（可以同時定義多個變量）；</p><p>type：指定變量的類型；</p><p>default value：子句將變量默認值設置為value，未使用default value時，默認值為null；</p><p>示例：declare my_sql int default 10;</p><p>(2) 為變量賦值</p><p>mysql中set關鍵字為變量賦值。語法：</p><p><strong>set var_name = expr[,var_name=expr]…</strong></p><p>set：為變量賦值；</p><p>var_name：參數是變量的名稱；</p><p>expr：參數是賦值表達式；</p><p>注：一個set語句可以同時為多個變量賦值，各個變量的賦值語句之間用逗號(,)隔開。</p><p>示例：為變量my_sql賦值為30；</p><p>set my_sql=30;</p><p>mysql中還可以用select…into…語句為變量賦值。語法：</p><p><strong>select col_name[,…] into var_name[,…] from table_name where condition</strong></p><p>col_name：參數表示查詢的字段名稱；</p><p>var_char：參數是變量的名稱；</p><p>table_name：參數指表的名稱；</p><p>condition：參數指查詢條件；</p><p>示例：下面從employee表中查詢id為2的記錄。將該記錄的d_id值賦給my_sql變量。</p><p><strong>select d_id into my_sql from employee where id=2;</strong></p><div class=pgc-img><img alt=存儲過程和函數及變量的使用 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/dce6a2719a62448c856d96ead459dab9><p class=pgc-img-caption></p></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>存儲</a></li><li><a>過程</a></li><li><a>函數</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/2220c570.html alt=MySQL4：存儲過程和函數 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/76effc620ed9444989eb59971db26ce3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2220c570.html title=MySQL4：存儲過程和函數>MySQL4：存儲過程和函數</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/96841b37.html alt="oracle 存儲過程的基本語法" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e3861a9225844b2daea40adfbe66ff10 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/96841b37.html title="oracle 存儲過程的基本語法">oracle 存儲過程的基本語法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fbc594e1.html alt=合金凝固過程微觀組織相場法研究 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/815da49f86474de38004007ee7edc7a5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fbc594e1.html title=合金凝固過程微觀組織相場法研究>合金凝固過程微觀組織相場法研究</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fb52eed9.html alt=鋼結構施工過程中，為什麼H型鋼樑翼緣要避免開孔 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c7617005bf7449efacd678a2fc77917e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fb52eed9.html title=鋼結構施工過程中，為什麼H型鋼樑翼緣要避免開孔>鋼結構施工過程中，為什麼H型鋼樑翼緣要避免開孔</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e087ca41.html alt=偏導數和函數的梯度 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/9d20a1e4cbff42a094d57df057fe9597 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e087ca41.html title=偏導數和函數的梯度>偏導數和函數的梯度</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5fc113b1.html alt=梯度原理：梯度在每一點上都指向函數增長最快的方向 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/cdb8db41d5024f38a2e490e66baebdb4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5fc113b1.html title=梯度原理：梯度在每一點上都指向函數增長最快的方向>梯度原理：梯度在每一點上都指向函數增長最快的方向</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e7798a22.html alt=機組停運操作過程步驟 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/53ef0002c8b15a5051c9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e7798a22.html title=機組停運操作過程步驟>機組停運操作過程步驟</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b8d8afb7.html alt=裝修過程中選擇礦棉吸音板的優勢和注意事項介紹 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RLaLWeTJ8TBdtS style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b8d8afb7.html title=裝修過程中選擇礦棉吸音板的優勢和注意事項介紹>裝修過程中選擇礦棉吸音板的優勢和注意事項介紹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d616c72c.html alt="中基協洪磊：完善過程信用管理 為私募股權基金營造更好展業空間" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d616c72c.html title="中基協洪磊：完善過程信用管理 為私募股權基金營造更好展業空間">中基協洪磊：完善過程信用管理 為私募股權基金營造更好展業空間</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bdd041e0.html alt="洪磊：完善過程信用管理 為私募股權基金營造更好展業空間" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RC14TUiH4M1j7I style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bdd041e0.html title="洪磊：完善過程信用管理 為私募股權基金營造更好展業空間">洪磊：完善過程信用管理 為私募股權基金營造更好展業空間</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/820826d1.html alt="洪磊：完善過程信用管理 為私募股權基金營造更好展業空間｜財富管理" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RC8uE9EFb8wU97 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/820826d1.html title="洪磊：完善過程信用管理 為私募股權基金營造更好展業空間｜財富管理">洪磊：完善過程信用管理 為私募股權基金營造更好展業空間｜財富管理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/25d2deec.html alt=中基協：強化過程自律，落實信義義務，建設更加高效的私募行業 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/25d2deec.html title=中基協：強化過程自律，落實信義義務，建設更加高效的私募行業>中基協：強化過程自律，落實信義義務，建設更加高效的私募行業</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/408d3387.html alt=EXCEL:VLOOKUP函數綜合運用，實現供應商每月數據自動查詢 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/03e79d133c994f9f8a386b20b04b3da1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/408d3387.html title=EXCEL:VLOOKUP函數綜合運用，實現供應商每月數據自動查詢>EXCEL:VLOOKUP函數綜合運用，實現供應商每月數據自動查詢</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/526a98f3.html alt=Excel條件求和函數那麼多，高手一直都在用這一個，而你卻沒聽過 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b2fd76f54f9b46c8bd79500ba4dac2fa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/526a98f3.html title=Excel條件求和函數那麼多，高手一直都在用這一個，而你卻沒聽過>Excel條件求和函數那麼多，高手一直都在用這一個，而你卻沒聽過</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2664a94c.html alt=excel中的DSUM函數——條件求和原來如此簡單 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0dc7aeaa9b61467e86dbaeae6dfeaaa4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2664a94c.html title=excel中的DSUM函數——條件求和原來如此簡單>excel中的DSUM函數——條件求和原來如此簡單</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>