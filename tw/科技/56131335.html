<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>彈性動效的應用及原理 | 极客快訊</title><meta property="og:title" content="彈性動效的應用及原理 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/6951317fac52440fb5381037c174d590"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/56131335.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/56131335.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/56131335.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/56131335.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/56131335.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/56131335.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/56131335.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/56131335.html><meta property="article:published_time" content="2020-11-14T21:07:15+08:00"><meta property="article:modified_time" content="2020-11-14T21:07:15+08:00"><meta name=Keywords content><meta name=description content="彈性動效的應用及原理"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/56131335.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>彈性動效的應用及原理</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>彈性是動態設計領域中一種常見的表達方式。不同於影視特效、動畫 CG 等設計輸出即為最終產物的生產環境，UI 動效始終面臨著動效還原帶來的種種問題，彈性動效的還原就是其中之一。</p><p>當設計師完成彈性動效的設計，與工程師進行交接時，雙方會發現參數無法對齊 —— 在設計工具中調節效果的參數與在工程開發環境下設定效果的參數無論是名稱還是數量都存在差異。</p><p>基於以上背景，我們通過研究一些常見原型設計工具的彈性模擬系統，深入彈性系統的動力學原理，與主流平臺的彈性動效實現原理進行匹配，解決了從設計工具到工程實現的彈性動效還原問題。</p><p><br></p><h1 class=pgc-h-arrow-right>在原型工具中設計彈性動效</h1><p><strong>Origami Studio</strong></p><p>大多數情況下，我們會優先選擇使用 Origami Studio（以下簡稱 Origami）進行高保真原型設計。想要在 Origami 中實現彈性動效，需要使用 Pop Animation Patch 來控制動畫進度（Progress），下面是 Origami 中一個簡單的彈性動效片段示例：</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6951317fac52440fb5381037c174d590><p class=pgc-img-caption></p></div><p>可以通過修改 Pop Animation 中的 Bounciness 與 Speed 來調節彈性的表現，這是兩個易於理解的參數：Bounciness 的值越大，動效越“彈”；Speed 的值越大，動效結束的越“快”。</p><p>在 Origami 的 Patch 列表中，位於第 1 個的 Patch：Bouncy Converter 負責將 Pop Animation 的參數 Bounciness 和 Speed 轉換為 Friction（摩擦）與 Tension（張力）。</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9d40d4f9e4bd4335b92ed6278e7ee26a><p class=pgc-img-caption></p></div><p><br></p><p><strong>Principle</strong></p><p>以友好易用被 UI 設計師、交互設計師甚至產品經理所鍾情的 Principle，在定義彈性動效時，將其歸類為一種特殊的曲線 —— Spring，與 Ease In、Ease Out 同級別。不同的是這條特殊的彈性「曲線」既不是通過 2 點座標來定義，也不能調節相應的時長。Principle 中的 Spring 曲線通過修改 Friction 與 Tension 來調節彈性的表現，通過 Principle 提供的曲線可視化預覽，我們可以容易的理解這兩個參數的作用：Friction 的值越大，動效越“彈”；Tension 的值越大，動效結束的越“快”。</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/556fbe7cdcae471fad0e0daa7b509fce><p class=pgc-img-caption></p></div><p><br></p><p><strong>其他</strong></p><p>同樣使用 Friction 與 Tension 參數調節彈性表現的還有 ProtoPie Studio、Flinto 等原型工具，而其效果也和 Principle 中的表現一致。</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bf6e5200068f4cf2921dc2d893c66375><p class=pgc-img-caption>ProtoPie Studio</p></div><p><br></p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/de4d3ead3b05499093daec2dc2ecf5b5><p class=pgc-img-caption>Flinto</p></div><p><br></p><h1 class=pgc-h-arrow-right>在主流平臺實現彈性動效</h1><p><strong>iOS</strong></p><p>相對於將視覺風格從擬物改為扁平，iOS 7 對動效的調整方向剛好相反，採用了更加貼近真實的設計方案，這其中最重要的元素就是廣泛應用自然的彈性動效。然而你可能會產生疑惑，因為並沒有在 iOS 系統中見到“廣泛”的彈性動效。這是因為 iOS 系統動效使用最多的，恰恰是一種沒有彈性的彈性動效，即應用了彈性系統中的臨界阻尼，其主要特徵是：物體受彈力的作用最快的恢復到平衡位置。</p><p>從 iOS 7 開始到目前為止，在系統內的任何一個場景：頁面間的切換，彈窗的出現與消失，鍵盤的抬起與落下，文件夾的展開與收起 等等，都使用了處於臨界阻尼狀態的彈性動效。同時 Apple 也提供了使用這種動效的 API：UIView.animateWithDuration:usingSpringWithDamping:initialSpringVelocity</p><pre><code>+ (void)animateWithDuration:(NSTimeInterval)duration                       delay:(NSTimeInterval)delay      usingSpringWithDamping:(CGFloat)dampingRatio       initialSpringVelocity:(CGFloat)velocity                     options:(UIViewAnimationOptions)options                  animations:(void (^)(void))animations                  completion:(void (^)(BOOL finished))completion;</code></pre><p>該 API 與普通的 UIView 動畫相比有兩個特別的參數：dampingRatio 和 velocity。文檔中對這兩個參數的解釋：該 API 與普通的 UIView 動畫相比有兩個特別的參數：dampingRatio 和 velocity。文檔中對這兩個參數的解釋：</p><ul class=list-paddingleft-2><li>dampingRatio：與彈性動效靜止時的阻尼比。值為 1 時將得到平穩減速沒有彈性的效果（即臨界阻尼狀態），值越接近 0 震盪（彈性）程度越大。</li><li>velocity：彈性動效的初始速度。為了平滑的開始動效，請把這個值與之前附著的視圖的速度匹配。</li></ul><p>而在此方法中，控制效果表現快慢的是 duration 。</p><blockquote class=js_blockquote_wrap><p>* 注：iOS 系統常用的臨界阻尼效果，參數為：duration: 0.5, dampingRatio: 1</p></blockquote><p>到了 iOS 9，Apple 在 Core Animation 中增加了彈性動效的 API：CASpringAnimation，這個 API 與 iOS 7 提供的用 UIViewSpring 有什麼區別呢？</p><p>從實現的效果來看，二者並無分別，因為 UIView Animation 本質上是對 Core Animation 的封裝，其意義在於面向開發者更加友好。以 CASpringAnimation 為例，它提供了 4 個參數來定義彈性動效：damping、initialVelocity、mass 和 stiffness。這四個參數更接近彈性動效的動力學參數，所以可以使用更貼近真實的調配方式來定義彈性效果的表現。</p><p>既然 UIView Animation 是對 Core Animation 的封裝，那麼同為彈性動效的定義方式，UIViewSpring 與 CASpringAnimation 之間應該可以互相轉換。</p><p>關於 UIViewSpring 與 CASpringAnimation 之間參數的關係在 iOS 10 的 提供的新 API</p><p>UIViewPropertyAnimator 的參數中提到：</p><blockquote class=js_blockquote_wrap><p>The damping ratio for the spring is computed from the formula damping / (2 * sqrt (stiffness * mass)).</p><p><br></p><p>—— UISpringTimingParameters</p></blockquote><p>全新的 UIViewPropertyAnimator API 相比 UIViewSpring 和 CASpringAnimation 更加強大，也同時兼容這兩個舊 API 的參數定義格式，建議優先考慮使用新 API，具體使用方法不再贅述。</p><p><br></p><p><strong>Android</strong></p><p>在 2017 Google I/O 大會上，Android 平臺終於有了官方支持的彈性動效實現方案 —— 基於物理的彈性動效 SpringAnimation。雖然發佈的晚，但是由於這個 API 被包含在支持庫中，所以的兼容性得到了很好的保障（支持庫更新到 v28.0.0，能夠兼容到 API 14；最新的 API 已被包含在 Android X 中，兼容性得到了更好的保證）。</p><pre><code>findViewById&lt;View&gt;(R.id.imageView).also { img -&gt;    SpringAnimation(img, DynamicAnimation.TRANSLATION_X).apply {    …    spring.dampingRatio = SpringForce.DAMPING_RATIO_LOW_BOUNCY    spring.stiffness = SpringForce.STIFFNESS_LOW    setStartVelocity(velocity)    }}</code></pre><p>SpringAnimation 提供了 3 個參數來定義彈性動效：dampingRatio、stiffness 和 setStartVelocity。</p><p>文檔中對這 3 個參數進行了細緻的解釋與演示：</p><ul class=list-paddingleft-2><li>setStartVelocity：起始速度用於定義在動畫開始時動畫屬性更改的速度。</li></ul><ul class=list-paddingleft-2><li>dampingRatio：阻尼比用於描述彈簧振動逐漸衰減的狀況。通過使用阻尼比，您可以定義振動從一次彈跳到下一次彈跳所衰減的速度有多快。以下列出了可使彈簧彈力衰減的四種不同方式：</li></ul><ul class=list-paddingleft-2><ul class=list-paddingleft-2><li>當阻尼比大於 1 時，會出現過阻尼現象。它會使對象快速地返回到靜止位置。</li></ul></ul><ul class=list-paddingleft-2><ul class=list-paddingleft-2><li>當阻尼比等於 1 時，會出現臨界阻尼現象。這會使對象在最短時間內返回到靜止位置。</li></ul></ul><ul class=list-paddingleft-2><ul class=list-paddingleft-2><li>當阻尼比小於 1 時，會出現欠阻尼現象。這會使對象多次經過並越過靜止位置，然後逐漸到達靜止位置。</li></ul></ul><ul class=list-paddingleft-2><ul class=list-paddingleft-2><li>當阻尼比等於零時，便會出現無阻尼現象。這會使對象永遠振動下去。</li></ul></ul><ul class=list-paddingleft-2><li>stiffness：剛度定義了用於衡量彈簧強度的彈簧常量。不在靜止位置的堅硬彈簧可對所連接的對象施加更大的力。</li></ul><p><br></p><p><strong>Web</strong></p><p>在 W3C 與 ecma 制定的 Web 標準中與動效相關的內容僅有：CSS animation，而其中並不包含定義彈性動效的方法。但 Web 領域最具魅力與價值的地方就在於各種豐富的、充滿創造力的庫，關於定義彈性動效，應用較為廣泛的庫有：animejs 等。在 animejs 中定義彈性動效需要 4 個參數：springPhysicsEasing</p><pre><code>easing: 'spring(mass, stiffness, damping, velocity)'</code></pre><p><br></p><h1 class=pgc-h-arrow-right>從設計到實現的差異</h1><p><strong>設計工具</strong></p><p>將上述的信息歸類整理，首先看各種原型設計工具之間是能夠達成一致的，基本都支持 Friction 和 Tension 參數的輸出，分別定義彈性的程度與效果的快慢，整理如下：</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2c956d891a974260801cc0e3ab4fc547><p class=pgc-img-caption></p></div><p><strong>開發平臺</strong></p><p>而在開發平臺上，彈性效果的實現則有共同點也有差異點，我們先看這張表：</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/37d5b844e0ed403db318494754957084><p class=pgc-img-caption></p></div><p>先看共同點：初始速度，該參數在所有 API 中的定義相同，是由外部因素對彈性動效產生的影響參數，其目的是保證對象從之前的運動狀態平滑的過渡到彈性動效。值默認為 0。</p><p>再看其他共同特徵，如 iOS UIViewSpring 與 Android SpringAnimation 中定義彈性程度的參數都是 dampingRatio，且都沒有定義對象質量的參數。根據從 UISpringTimingParameters 的參數描述中獲取到的公式，得出的 dampingRatio 與 damping 之間的關係：</p><p><br></p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/136124f2ff3049acbb8ca711228e2c03><p class=pgc-img-caption></p></div><p><br></p><p>在 Android SpringAnimation 中，已知 dampingRatio 和 stiffness，僅差 mass 的值即可得出 damping，而在 iOS CASpringAnimation 的參數描述中，mass 的默認值為 1。這裡我們進行了大膽的假設在 Android SpringAnimation 中，mass 缺省值為 1。使用假設的 mass，定義 dampingRatio 與 stiffness 的值，帶入到公式求得 damping，再將求出的 damping，與定義的 stiffness、假設的 mass = 1 帶入到 iOS CASpringAnimation 中，進行實現的效果對比。令人驚喜的是，兩端的效果表現完全一致，那麼假設驗證成立：在 Android SpringAnimation 中，mass 缺省值為 1（這個結論也與 Material Design 的設計原則相吻合）。以同樣的方法我們也可以假設 iOS UIViewSpring 中 mass 也是使用缺省值 1，但在 iOS UIViewSpring 中定義效果快慢的參數並不是 stiffness，從值的類型來看也不屬於同一種，所以目前還無法驗證這個假設。</p><p>除去 duration 未明確關係的 iOS UIViewSpring，其他的開發平臺 API 已經能夠達成一致關係，或相同，或可以互相轉換。</p><p><br></p><p><strong>差異</strong></p><p>儘管在設計工具和開發平臺中，我們通過查閱概念定義與嘗試驗證得到了用於定義彈性強度與效果快慢的參數，但設計工具是使用 Friction 和 Tension 來表示，而開發平臺則使用 damping 和 stiffness 來表示。為了尋找這些參數之間的關係，我們更深入的去了解了彈性系統的動力學原理。</p><p><br></p><h1 class=pgc-h-arrow-right>彈性系統原理</h1><p><strong>什麼是彈性系統[1]</strong></p><p>通過設定剛度（Stiffness）、質量（Mass）、阻尼（Damping）彈性體特徵屬性，為目標對象定義彈性，使對象表現出：被恢復力（F）驅動，受阻尼影響，從起始值向目標值（系統平衡位置） 運動的過程。此運動系統被稱為阻尼諧振子系統，遵守胡克定律[2]。</p><p><br></p><p><strong>質量（Mass）</strong></p><p>彈性系統的受力對象，會對彈性系統產生慣性影響。質量越大，振盪的幅度越大，恢復到平衡位置的速度越慢。</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/96302ab86489493a920998681e1b21d5><p class=pgc-img-caption></p></div><p><br></p><p><strong>阻尼（Damping）</strong></p><p>是一個純數，無真實的物理意義，用於描述系統在受到擾動後振盪及衰減的情形。阻尼越大，彈性運動的振盪次數越少、振盪幅度越小。</p><p><br></p><p><strong>阻尼比（Damping Ratio）[3]</strong></p><p>表示阻尼相對於臨界阻尼的比值。</p><p>· 無阻尼：阻尼比 -> 0，系統處於永遠振盪的狀態；</p><p>· 欠阻尼：阻尼比 &lt; 1，對象進行指數遞減的振盪運動；</p><p>· 過阻尼：阻尼比 > 1，對象進行無振盪的減速運動；</p><p>· 臨界阻尼：阻尼比 = 1，對象以最短時間結束運動。</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/804d8a8c64e141ad825abd6c0a97c724><p class=pgc-img-caption></p></div><p><br></p><p><strong>剛度（Stiffness）[4]</strong></p><p>是物體抵抗施加的力而形變的程度。在彈性系統中，剛度越大，抵抗變形的能力越強，恢復到平衡位置的速度就越快。</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/4b476e8e1e21488b91113a621d81149e><p class=pgc-img-caption></p></div><p><strong>摩擦力（Friction）</strong></p><p>常見的一種造成彈性系統能量損耗的力，摩擦力的方向始終與對象運動的方向相反。摩擦力越大，彈性系統的能量損耗越快，振盪次數越少，振盪幅度越小。</p><p><br></p><p><strong>張力（Tension）[5]</strong></p><p>是由一伸展的弦對施力者所做的反作用力，張力越大，反作用力越強，弦恢復原狀的速度就越快。</p><p><br></p><h1 class=pgc-h-arrow-right>結論與成果</h1><p>從彈性系統原理中我們認識到 Friction 與 Damping 的特徵接近，Stiffness 與 Tension 的特徵接近，再次進行假設並驗證：開發平臺中的 damping 是否等同於設計工具中的 friction；開發平臺中的 stiffness 是否等同於設計工具中的 tension。最終通過將設計工具參數直接按照假設的對應關係進行驗證，並結合之前的部分結論，最終得出：</p><pre><code>damping = frictionstiffness = tension[default]mass = 1dampingRatio = damping / (2 * sqrt (mass * stiffness))[default]velocity = 0</code></pre><p><br></p><p><strong>應用</strong></p><p>根據結論，設計師在交付彈性動效時，可以按照下面的方法提供參數：</p><p><strong>Origami</strong></p><p>設定 Pop Animation 參數為</p><ul class=list-paddingleft-2><li>Bounciness = 5</li></ul><ul class=list-paddingleft-2><li>Speed = 10</li></ul><p>使用 Bouncy Converter 得到</p><ul class=list-paddingleft-2><li>Friction = 27.0487</li></ul><ul class=list-paddingleft-2><li>Tension = 299.61884</li></ul><p>則：</p><ul class=list-paddingleft-2><li>damping = 27.05</li></ul><ul class=list-paddingleft-2><li>stiffness = 299.62</li></ul><ul class=list-paddingleft-2><li>mass = 1</li></ul><ul class=list-paddingleft-2><li>velocity = 0</li></ul><ul class=list-paddingleft-2><li>dampingRatio = 0.78</li></ul><p>For Android</p><pre><code>SpringAnimation(object, DynamicAnimation.[property]).apply {…spring.dampingRatio = 0.78fspring.stiffness = 299.62fsetStartVelocity(0f)}</code></pre><p>For iOS</p><pre><code>let spring = CASpringAnimation(keyPath:[property])spring.stiffness = 299.62spring.damping = 27.05spring.mass = 1spring.initialVelocity = 0</code></pre><p><br></p><p><strong>Principle</strong></p><p>設定 Spring 曲線參數為</p><ul class=list-paddingleft-2><li>Tension = 381.47</li></ul><ul class=list-paddingleft-2><li>Friction = 20.17</li></ul><p>則：</p><ul class=list-paddingleft-2><li>damping = 20.17</li></ul><ul class=list-paddingleft-2><li>stiffness = 381.47</li></ul><ul class=list-paddingleft-2><li>mass = 1</li></ul><ul class=list-paddingleft-2><li>velocity = 0</li></ul><ul class=list-paddingleft-2><li>dampingRatio = 0.52</li></ul><p>For Android</p><pre><code>SpringAnimation(object, DynamicAnimation.[property]).apply {…spring.dampingRatio = 0.52fspring.stiffness = 381.47fsetStartVelocity(0f)}</code></pre><p>For iOS</p><pre><code>let spring = CASpringAnimation(keyPath:[property])spring.stiffness = 381.47spring.damping = 20.17spring.mass = 1spring.initialVelocity = 0</code></pre><p><br></p><p><strong>UIViewSpring 的 duration 參數</strong></p><p>上述的結論中並不包含關於 iOS UIViewSpring 的 duration 參數的相關信息，我們繼續進行深入研究。</p><p>首先這次 Apple 並沒有像 dampingRatio 一樣在文檔中提供 duration 與其他參數直接的轉換關係，也僅有 iOS UIViewSpring API 唯一一個是以 duration 定義彈性動效的效果快慢，從開發平臺能獲取到的信息就有限了。</p><p>在設計工具中，確實有能夠支持以 duration 和 dampingRatio 定義彈性動效的，其中有我們熟悉的 Flinto 和以開源的 Framer.js 構建的原型設計工具 Framer Studio。</p><p>Framer Studio 可以默認使用 time 與 damping 定義彈性動效，在彈性動效的代碼區域，右鍵菜單可以看到 Copy Animation 中包含 2 個選項，複製 Damping and Duration 的值，可以看到在 Framer Studio 中用於定義彈性動效的默認方法中：time 對應的是 duration，damping 對應的是 dampingRatio。</p><p>同時 Framer Studio 也支持使用 Friction 與 Tension 來定義彈性動效，在相應的代碼區域仍舊可以右鍵 Copy Animation，也就是 Framer Studio 實現了 dampingRatio、duration 與 Friction、Tension 參數之間的互相轉換。</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f6e9ece6d7784af0bb27b91f8e54968a><p class=pgc-img-caption></p></div><p>得益於 Framer.js [7] 項目是開源的，我們在 Github 上，找到了關於兩套參數互相轉換的參數，其中具有關鍵意義的已知 Friction 與 Tension，轉換 duration 的方法詳情如下：</p><pre><code># Tries to compute the duration of a spring,# but can't for certain velocities and if dampingRatio &gt;= 1# In those cases it will return nullepsilon =  0.001computeDuration = (tension, friction, velocity = 0, mass = 1) -&gt;dampingRatio = computeDampingRatio(tension, friction)undampedFrequency = Math.sqrt(tension / mass)    # This is basically duration extracted out of the envelope functionsif dampingRatio &lt; 1a = Math.sqrt(1 - Math.pow(dampingRatio, 2))b = velocity / (a * undampedFrequency)c = dampingRatio / ad = - ((b - c) / epsilon)if d &lt;= 0return nullduration = Math.log(d) / (dampingRatio * undampedFrequency)elsereturn nullreturn duration</code></pre><p>引用自：SpringCurveValueConverter.coffee host with ❤️Github</p><p><br></p><p><strong>轉換器</strong></p><p>從 Framer.js 開源項目中獲取到了 dampingRatio、duration 與 Friction、Tension 互相轉換的方法，而從 Origami [6] 的開源項目中我們也獲取到了將 Bouncy Converter：將 Pop Animation 的 Bounciness 和 Speed 轉換為 Friction 與 Tension。由此為了方便使用，我們開發了一個簡單的 Web 轉換器，通過選擇各種原型工具或開發平臺的定義彈性動效的參數，能夠獲取到任意平臺的彈性動效還原代碼參考。</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0a68e1d29bb54f4e862d881abfb06265><p class=pgc-img-caption></p></div><p>在圖中可以看到我們也提供了 CSS 版本的關鍵幀動畫代碼參考，我們對關鍵幀的輸出進行了平滑處理，在體積、性能與效果之間得到了良好的平衡關係。</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2e0008b3dfca4ba9b5ea2a9ce6934444><p class=pgc-img-caption></p></div><p><strong>Origami Patch</strong></p><p>強大的自定義能力是我們選擇優先使用 Origami Studio 的一個原因，在已知公式的情況下，我們可以模擬出各個平臺 API 定義彈性動效的參數組合來設計動效：</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/40d2f281999d472b837b5835245d6687><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>插值模擬</h1><p><strong>自定義動態插值器</strong></p><p>在打通了彈性動效參數的從設計工具到 iOS UIViewSpring、iOS CASpringAnimation、Android SpringAnimation、CSS Keyframe 之間的參數轉換後，彈性動效的還原問題已經能在絕大多數場景解決了，但由於 Android 的彈性動效 API 需要引入支持庫，而在一些特殊情況下可能無法引入，這時候我們可以選擇一種降級方案：使用自定義插值器模擬彈性動效。</p><p>在 Android 開發中，插值器其實就是設計師常說的動效曲線，用於描述在定義時間內值的變化規律。理論上你可以利用此特性定義出任何動畫形式，而我們想要定義彈性動效，首先需要的就是用於描述彈性運動的函數公式。</p><p>再次感嘆開源的偉大，在 Juraj Novák 的 Interpolator 項目中，提供了一個以 factor 為調整彈性程度參數的彈性運動描述函數。</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/835f8de2ff16462abb1d4eec499c3730><p class=pgc-img-caption></p></div><p>所以根據這個函數我們可以在 Android 中自定義插值器：</p><pre><code>import android.view.animation.BaseInterpolator;public class SpringInterpolator extends BaseInterpolator{private float mFactor;public SpringInterpolator() {this.mFactor = 0.5f;    }public SpringInterpolator(float mFactor) {this.mFactor = mFactor;    }@Overridepublic float getInterpolation(float input) {if (input == 0.0f || input == 1.0f)return input;else {float value = (float) (Math.pow(2, -10 * input) * Math.sin((input - mFactor / 4.0d) * (2.0d * Math.PI) / mFactor) + 1);return value;        }    }}</code></pre><p>在 Android 的插值動效中，描述動效快慢的參數統一為 duration，我們可以利用來自 Framer.js 的轉換方法得出一個 duration 參數。但為了還原效果，我們還需要知道 factor 與 Friction 和 Tension 之間的關係。遺憾的是我們並沒有查閱到相關資料，也沒能夠通過假設證明，最終我們選擇了使用使用數學辦法進行從 Friction、Tension 到 factor、duration 的轉換。</p><p>首先我們將 iOS UIViewSpring 中的 duration 直接賦予到 Android SpringInterpolator 動畫，用於描述效果的快慢。</p><p>由於彈性運動是一個衰減過程，所以我們可以把運動過程中達到的最大值當作是與彈性程度相關的量。在遵循胡克定律的條件下，當兩個彈性運動的最大值相同，且運動快慢也相同的時候，可以近似的認為二者的彈性效果是相同的。於是在已知 Friction 和 Tension 的情況下，求出當前彈性動效的最大值，再對 Android SpringInterpolator 進行不同 factor 的最大值的遍歷與匹配，最終得出一個近似效果對應的 factor 值。由於需要大量的重複計算，且沒有通用公式，此方法僅被應用在 Web 轉換器中。</p><p><br></p><p><strong>自定義 XML 插值器</strong></p><p>在一些極端情況下，Android 無法使用動態方法定義動畫，必須使用 XML 時，我們也可以利用 XML 定義插值器，但此時的靈活性就就更低了，因為需要把彈性效果，畫出來。</p><p>插值器是定義在點 (0, 0) 到點(1, 1) 區域內的一段連續曲線，Android 支持使用路徑信息的形式來描述插值器，那麼關鍵點就在於如何輸出符合效果的路徑信息。</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/99f8fcfc18b14a06b822fa80b751a0fc><p class=pgc-img-caption></p></div><p>使用工具（如 D3.js）按照彈性系統的運動學公式生成 SVG，將起點和終點限制在 1*1 px 的畫布內，同時注意調整座標軸，畫布座標軸以左上角為原點 (0, 0)，插值座標軸卻是以左下角為原點 (0, 0)。</p><div class=pgc-img><img alt=彈性動效的應用及原理 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/970606da538d4499a22e2a441efaeb85><p class=pgc-img-caption></p></div><p>把輸出的路徑信息從SVG中拷貝到自定義 XML 插值器的 pathData 中，我們就得到了一個效果固定的自定義 XML 彈性插值器：</p><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;pathInterpolator xmlns:android="http://schemas.android.com/apk/res/android"android:pathData="M-0,0 C0.0748570523,0.246566772 0.0748570523,1.15869141 0.261230469,1.15869141 C0.324264526,1.15869141 0.363204714,1.03922335 0.477279663,1 C0.590576172,0.961044312 0.687408447,1.03922335 1,1"/&gt;</code></pre><p><br></p><h1 class=pgc-h-arrow-right>總結</h1><p>在經歷了複雜的研究與驗證過程，我們知道了：設計工具中的參數是能夠與開發平臺的參數對齊的，只是換了種叫法 —— Friction 就是 Damping，Tension 就是 Stiffness；大膽假設有的時候是憑直覺，但直覺背後可能存在著一些潛在因素的影響——在沒有定義 Mass 的時候，使用的是缺省值 1；雖然很艱難，但是我們終究還是在 Android 的全場景還原了彈性動效；開源的力量是偉大的，再次感謝開源社區。</p><p><br></p><p><strong>附錄</strong></p><p>1. 諧振子系統：https://en.wikipedia.org/wiki/Harmonic_oscillator</p><p>2. 胡克定律：https://en.wikipedia.org/wiki/Hooke%27s_law</p><p>3. 阻尼比：https://en.wikipedia.org/wiki/Damping_ratio</p><p>4. 剛度：https://en.wikipedia.org/wiki/Stiffness</p><p>5. 張力：https://en.wikipedia.org/wiki/Tension_(physics)</p><p>6. ReboundJS：http://facebook.github.io/rebound/</p><p>7. FramerJS：https://github.com/koenbok/Framer</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>彈性</a></li><li><a>動效</a></li><li><a>應用</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/1606e357.html alt=注塑機賺屬應用的——彈性拉桿螺母 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/31f90005743c29dc7b36 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1606e357.html title=注塑機賺屬應用的——彈性拉桿螺母>注塑機賺屬應用的——彈性拉桿螺母</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5e4be374.html alt=鈦及鈦合金鑄件的應用領域​ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/Rca7hqUCttQBq0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5e4be374.html title=鈦及鈦合金鑄件的應用領域​>鈦及鈦合金鑄件的應用領域​</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/958c038a.html alt=鑄造鋁合金應用現狀及未來前景分析 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8dcaa42ff9a64e2cad814e4e025fc52c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/958c038a.html title=鑄造鋁合金應用現狀及未來前景分析>鑄造鋁合金應用現狀及未來前景分析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/16133b9e.html alt=深度語義模型以及在淘寶搜索中的應用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/48529b82dc7c4f048fc3e45d586717e6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/16133b9e.html title=深度語義模型以及在淘寶搜索中的應用>深度語義模型以及在淘寶搜索中的應用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/657370c9.html alt=從起源講到應用，幾乎所有齒輪知識都在這裡了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/6a14e31844e14b5aace5360ee6f8601a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/657370c9.html title=從起源講到應用，幾乎所有齒輪知識都在這裡了>從起源講到應用，幾乎所有齒輪知識都在這裡了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fc32dcc9.html alt=牛常用飼料添加劑的種類與應用！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/57c1b1c2-20c8-4927-8161-242643381796 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fc32dcc9.html title=牛常用飼料添加劑的種類與應用！>牛常用飼料添加劑的種類與應用！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ca3b7208.html alt=如何判斷彈性工作制對一家公司有害還是有利？拿成績說話 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/novel-images/130c80fb8dd039e1d0b1ec8e32d03fea style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ca3b7208.html title=如何判斷彈性工作制對一家公司有害還是有利？拿成績說話>如何判斷彈性工作制對一家公司有害還是有利？拿成績說話</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/39d00baa.html alt=「初中物理」彈性形變和非彈性形變有什麼區別 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/ff4a64b3-b99e-4667-9d4e-d9d6109b76a0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/39d00baa.html title=「初中物理」彈性形變和非彈性形變有什麼區別>「初中物理」彈性形變和非彈性形變有什麼區別</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0472b2d5.html alt=什麼是彈性工作制 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/9a911ef1dc5a49089d446334b804157b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0472b2d5.html title=什麼是彈性工作制>什麼是彈性工作制</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/75f10997.html alt=企業永久實行彈性工作制，是否應該全面推行？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6bf86d1f40f04e0abdbc103c5ebd852c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/75f10997.html title=企業永久實行彈性工作制，是否應該全面推行？>企業永久實行彈性工作制，是否應該全面推行？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c6e5f450.html alt=卡簧和彈性擋圈，到底該怎麼選？（一） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f4c66ec54a5d477f8870f2aae6bb4141 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c6e5f450.html title=卡簧和彈性擋圈，到底該怎麼選？（一）>卡簧和彈性擋圈，到底該怎麼選？（一）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7ce12767.html alt=如何正確利用杆底的彈性角？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/403a00004d9132c02145 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7ce12767.html title=如何正確利用杆底的彈性角？>如何正確利用杆底的彈性角？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8f5aa405.html alt=彈性應力吸收帶路用性能及施工特性研究 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2d8a8282d8a842f5bb3c6e69f4fd3a89 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8f5aa405.html title=彈性應力吸收帶路用性能及施工特性研究>彈性應力吸收帶路用性能及施工特性研究</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3653a502.html alt=彈性纖維知識盤點，你還不趕緊收藏！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e245315c19684d9fbaf0296c15b526a8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3653a502.html title=彈性纖維知識盤點，你還不趕緊收藏！>彈性纖維知識盤點，你還不趕緊收藏！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a73cf80a.html alt="自動化彈性伸縮如何支持百萬級核心錯峰混部 | 架構沙龍回顧" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/61d58d713ab649708f7796af3bc5f21b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a73cf80a.html title="自動化彈性伸縮如何支持百萬級核心錯峰混部 | 架構沙龍回顧">自動化彈性伸縮如何支持百萬級核心錯峰混部 | 架構沙龍回顧</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>