<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Googleå®˜æ–¹MVP+Dagger2æ¶æ§‹è©³è§£ | æå®¢å¿«è¨Š</title><meta property="og:title" content="Googleå®˜æ–¹MVP+Dagger2æ¶æ§‹è©³è§£ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/d46de2bbbe8a4c669aab49adf79e1104"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5978ffaa.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5978ffaa.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5978ffaa.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5978ffaa.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5978ffaa.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5978ffaa.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5978ffaa.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5978ffaa.html><meta property="article:published_time" content="2020-10-29T21:12:37+08:00"><meta property="article:modified_time" content="2020-10-29T21:12:37+08:00"><meta name=Keywords content><meta name=description content="Googleå®˜æ–¹MVP+Dagger2æ¶æ§‹è©³è§£"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/5978ffaa.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Googleå®˜æ–¹MVP+Dagger2æ¶æ§‹è©³è§£</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>1 å‰è¨€</h1><p>å‰æ®µæ™‚é–“åˆ†äº«äº†ä¸€ç¯‡æ–‡ç« ï¼š<strong>googleå®˜æ–¹æ¶æ§‹MVPè§£æèˆ‡å¯¦æˆ°</strong> ï¼Œé‡å°é€™æ˜¯å°googleå®˜æ–¹ç¤ºä¾‹æ¶æ§‹ï¼ˆgooglesamples/<strong>android-architecture</strong>ï¼‰çš„ä¸€å€‹åˆ†æ”¯todo-mvp/ çš„é …ç›®è§£æèˆ‡å¯¦éš›é‹ç”¨</p><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ§‹è©³è§£ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d46de2bbbe8a4c669aab49adf79e1104><p class=pgc-img-caption></p></div><p>googleå®˜æ–¹ç¤ºä¾‹æ¶æ§‹é …ç›®</p><p><br></p><p>åœ¨æˆ‘çš„å‰ä¸€ç¯‡æ–‡ç« åˆ†äº«çš„æ™‚å€™ï¼Œç•¶æ™‚todo-mvp-dagger/ é€™å€‹åˆ†æ”¯ä¹Ÿé‚„æ²’æœ‰é–‹ç™¼å®Œç•¢ã€‚æœ€è¿‘çš„é …ç›®ä¸­ä¹Ÿåœ¨ç”¨åˆ°Dagger2 ä½œç‚ºä¾è³´æ³¨å…¥ï¼Œæ‰€ä»¥é€šéé€™å€‹é …ç›®ä¸€èµ·ä¾†å­¸ç¿’ä¸‹ï¼Œmvp+Dagger2 çš„å¯¦ç¾å§ã€‚</p><h1 class=pgc-h-arrow-right>2 Dagger2åŸºç¤</h1><blockquote><p>ä»¥ä¸‹Dagger2åŸºç¤éƒ¨åˆ†ä¸»è¦æ˜¯å°åƒè€ƒè³‡æ–™è£¡é¢çš„å¹¾ç¯‡å¤–æ–‡éˆæ¥çš„çŸ¥è­˜é»çš„æ•´åˆï¼Œæ‰€ä»¥ç¿»è­¯çš„èªå¥å¯èƒ½æœ‰äº›ç”Ÿç¡¬ï¼Œåœ¨é©ç•¶çš„åœ°æ–¹æœƒå‡ºç¾è‹±æ–‡åŸæ–‡ã€‚ åŸæ–‡ç« éˆæ¥ï¼ˆ70%ä¾†è‡ªæ–¼ä¸‹é¢çš„åŸæ–‡ï¼Œåšå‡ºäº†é©ç•¶ä¿®æ”¹ï¼‰ï¼š Dependency Injection with Dagger 2</p></blockquote><h3 class=pgc-h-arrow-right>2.1 ä»€éº¼æ˜¯Dagger2</h3><p>é¢å‘å°è±¡ç·¨ç¨‹ç¶“å¸¸éœ€è¦è™•ç†å„ç¨®ä¾è³´é—œä¿‚ã€‚å®‰å“é–‹ç™¼ä¹Ÿä¸ä¾‹å¤–ï¼Œæ¯”å¦‚èªªç¶²çµ¡è¨ªå•ä¸­ä½¿ç”¨Retrofitï¼ŒGsonï¼Œæœ¬åœ°å­˜å„²ä¸­ä½¿ç”¨shared preferenceã€‚ç„¡ä¸€ä¾‹å¤–ï¼Œæˆ‘å€‘éƒ½éƒ½éœ€è¦åœ¨ä½¿ç”¨å®ƒå€‘çš„åœ°æ–¹é€²è¡Œå¯¦ä¾‹å°è±¡æ§‹å»ºï¼Œå°è±¡ä¹‹é–“å¯èƒ½é‚„å­˜åœ¨è‘—å„ç¨®å„æ¨£çš„ä¾è³´é—œä¿‚ã€‚</p><p>ä¾è³´æ³¨å…¥ï¼ˆDependency Injectionï¼Œç°¡ç¨±DIï¼‰æ˜¯ç”¨æ–¼å‰Šæ¸›è¨ˆç®—æ©Ÿç¨‹åºçš„è€¦åˆå•é¡Œçš„ä¸€å€‹æ³•å‰‡ã€‚å°è±¡åœ¨è¢«å‰µå»ºçš„æ™‚å€™ï¼Œç”±ä¸€å€‹èª¿æ§ç³»çµ±å…§æ‰€æœ‰å°è±¡çš„å¤–ç•Œå¯¦é«”å°‡å…¶æ‰€ä¾è³´çš„å°è±¡çš„å¼•ç”¨å‚³éçµ¦å®ƒã€‚ä¹Ÿå¯ä»¥èªªï¼Œä¾è³´è¢«æ³¨å…¥åˆ°å°è±¡ä¸­ã€‚</p><p>åœ¨J2EEå¾Œè‡ºé–‹ç™¼ä¸­ï¼Œç•¶å‰æ¯”è¼ƒçŸ¥åçš„ä¾è³´æ³¨å…¥æ¡†æ¶æœ‰ï¼šPico Containerã€Avalon ã€Springã€JBossã€HiveMindã€EJBç­‰ã€‚</p><p>Dagger2 ï¼ˆA fast dependency injector for Android and Java. http://google.github.io/daggerï¼‰æ­£æ˜¯ä¸€å€‹å®‰å“å’ŒJavaçš„ä¾è³´æ³¨å…¥æ¡†æ¶ï¼Œä½¿ç”¨ä»£ç¢¼è‡ªå‹•ç”Ÿæˆå‰µå»ºä¾è³´é—œä¿‚éœ€è¦çš„ä»£ç¢¼ã€‚æ¸›å°‘å¾ˆå¤šæ¨¡æ¿åŒ–çš„ä»£ç¢¼ï¼Œæ›´æ˜“æ–¼æ¸¬è©¦ï¼Œé™ä½è€¦åˆï¼Œå‰µå»ºå¯è¤‡ç”¨å¯äº’æ›çš„æ¨¡å¡Šã€‚</p><h3 class=pgc-h-arrow-right>2.2 Dagger2çš„å„ªé»</h3><ul><li><strong>å…¨å±€å°è±¡å¯¦ä¾‹çš„ç°¡å–®è¨ªå•æ–¹å¼</strong><br>å’ŒButterKnife åº«å®šç¾©äº†viewï¼Œäº‹ä»¶è™•ç†ä»¥åŠè³‡æºçš„å¼•ç”¨ä¸€æ¨£ï¼ŒDagger2 æä¾›å…¨å±€å°è±¡å¼•ç”¨çš„ç°¡æ˜“è¨ªå•æ–¹å¼ã€‚è²æ˜ç­å–®ä¾‹çš„å¯¦ä¾‹éƒ½å¯ä»¥ä½¿ç”¨@injecté€²è¡Œè¨ªå•ã€‚æ¯”å¦‚ä¸‹é¢çš„MyTwitterApiClient å’ŒSharedPreferences çš„å¯¦ä¾‹ï¼š</li></ul><pre><code>public class MainActivity extends Activity {   @Inject MyTwitterApiClient mTwitterApiClient;   @Inject SharedPreferences sharedPreferences;   public void onCreate(Bundle savedInstance) {       // assign singleton instances to fields       InjectorClass.inject(this);   } </code></pre><ul><li><strong>è¤‡é›œçš„ä¾è³´é—œä¿‚åªéœ€è¦ç°¡å–®çš„é…ç½®</strong><br>Dagger2 æœƒé€šéä¾è³´é—œä¿‚ä¸¦ä¸”ç”Ÿæˆæ˜“æ‡‚æ˜“åˆ†æçš„ä»£ç¢¼ã€‚ä»¥å‰é€šéæ‰‹å¯«çš„å¤§é‡æ¨¡æ¿ä»£ç¢¼ä¸­çš„å°è±¡å¼•ç”¨å°‡æœƒç”±å®ƒçµ¦ä½ å‰µå»ºä¸¦å‚³éåˆ°ç›¸æ‡‰å°è±¡ä¸­ã€‚å› æ­¤ä½ å¯ä»¥æ›´å¤šçš„é—œæ³¨æ¨¡å¡Šä¸­æ§‹å»ºçš„å…§å®¹è€Œä¸æ˜¯æ¨¡å¡Šä¸­çš„å°è±¡å¯¦ä¾‹çš„å‰µå»ºé †åºã€‚</li><li><strong>è®“å–®å…ƒæ¸¬è©¦å’Œé›†æˆæ¸¬è©¦æ›´åŠ æ–¹ä¾¿</strong><br>å› ç‚ºä¾è³´é—œä¿‚å·²ç¶“ç‚ºæˆ‘å€‘ç¨ç«‹å‡ºä¾†ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥è¼•é¬†çš„æŠ½å–å‡ºä¸åŒçš„æ¨¡å¡Šé€²è¡Œæ¸¬è©¦ã€‚ä¾è³´çš„æ³¨å…¥å’Œé…ç½®ç¨ç«‹æ–¼çµ„ä»¶ä¹‹å¤–ã€‚å› ç‚ºå°è±¡æ˜¯åœ¨ä¸€å€‹ç¨ç«‹ã€ä¸è€¦åˆçš„åœ°æ–¹åˆå§‹åŒ–ï¼Œæ‰€ä»¥ç•¶æ³¨å…¥æŠ½è±¡æ–¹æ³•çš„æ™‚å€™ï¼Œæˆ‘å€‘åªéœ€è¦ä¿®æ”¹å°è±¡çš„å¯¦ç¾æ–¹æ³•ï¼Œè€Œä¸ç”¨å¤§æ”¹ä»£ç¢¼åº«ã€‚ä¾è³´å¯ä»¥æ³¨å…¥åˆ°ä¸€å€‹çµ„ä»¶ä¸­ï¼šæˆ‘å€‘å¯ä»¥æ³¨å…¥é€™äº›ä¾è³´çš„æ¨¡æ“¬å¯¦ç¾ï¼Œé€™æ¨£ä½¿å¾—æ¸¬è©¦æ›´åŠ ç°¡å–®ã€‚</li><li><strong>ä½œç”¨åŸŸå¯¦ä¾‹ï¼ˆScoped instancesï¼‰</strong><br>æˆ‘å€‘ä¸åƒ…å¯ä»¥è¼•é¬†çš„ç®¡ç†å…¨å±€å¯¦ä¾‹å°è±¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Dagger2ä¸­çš„scopeå®šç¾©ä¸åŒçš„ä½œç”¨åŸŸã€‚ï¼ˆæ¯”å¦‚æ ¹æ“šuser sessionï¼Œactivityçš„ç”Ÿå‘½é€±æœŸï¼‰</li></ul><h3 class=pgc-h-arrow-right>2.3 Dagger2çš„å¼•ç”¨</h3><ul><li>åœ¨æ•´å€‹é …ç›®çš„build.gradleä¸­åŠ å…¥ï¼š</li></ul><pre><code> dependencies {     // other classpath definitions here     classpath 'com.neenbedankt.gradle.plugins:android-apt:1.8' }</code></pre><ul><li>åœ¨app/build.gradleä¸­åˆ†åˆ¥åŠ å…¥ï¼š</li></ul><pre><code>// add after applying plugin: 'com.android.application'  apply plugin: 'com.neenbedankt.android-apt'</code></pre><pre><code>dependencies {    // apt command comes from the android-apt plugin    apt 'com.google.dagger:dagger-compiler:2.2'    compile 'com.google.dagger:dagger:2.2'    provided 'javax.annotation:jsr250-api:1.0'}</code></pre><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯providedä»£è¡¨ç·¨è­¯æ™‚éœ€è¦çš„ä¾è³´ï¼ŒDaggerçš„ç·¨è­¯å™¨ç”Ÿæˆä¾è³´é—œä¿‚çš„ä»£ç¢¼ï¼Œä¸¦åœ¨ç·¨è­¯æ™‚æ·»åŠ åˆ°IDE çš„class pathä¸­ï¼Œåªåƒèˆ‡ç·¨è­¯ï¼Œä¸¦ä¸æœƒæ‰“åŒ…åˆ°æœ€çµ‚çš„apkä¸­ã€‚aptæ˜¯ç”±android-aptæ’ä»¶æä¾›ï¼Œå®ƒä¸¦ä¸æœƒæ·»åŠ é€™äº›é¡åˆ°class pathä¸­ï¼Œé€™äº›é¡åªç”¨æ–¼è¨»è§£è§£æï¼Œç·¨å¯«ä»£ç¢¼çš„æ™‚å€™æ‡‰ç•¶é¿å…ä½¿ç”¨é€™äº›é¡ã€‚</p></blockquote><h3 class=pgc-h-arrow-right>2.4 Dagger2çš„ä½¿ç”¨ï¼Œä¾è³´æ³¨å…¥æµç¨‹</h3><p>Dagger2 ä¸­ä½¿ç”¨äº†å¾ˆå¤šè¨»è§£ï¼Œæ¥ä¸‹ä¾†ä¸€æ­¥ä¸€æ­¥çš„åˆ†æDagger2çš„ä½¿ç”¨ï¼Œå…ˆä¾†ä¸€å¼µè¡¨å’Œä¸€å¼µåœ–æŠŠDagger2ä¸­çš„è¨»è§£è¬›è§£ä¸€ä¸‹ã€‚å¦‚æœæœ‰é»ä¸æ¸…æ™°ï¼Œè«‹æ¥è‘—å¾€ä¸‹çœ‹ï¼Œç„¶å¾Œå†å›ä¾†çœ‹ä¸€éã€‚</p><p>è¨»è§£ ç”¨æ³• @Module Modulesé¡è£¡é¢çš„æ–¹æ³•å°ˆé–€æä¾›ä¾è³´ï¼Œæ‰€ä»¥æˆ‘å€‘å®šç¾©ä¸€å€‹é¡ï¼Œç”¨@Moduleè¨»è§£ï¼Œé€™æ¨£Daggeråœ¨æ§‹é€ é¡çš„å¯¦ä¾‹çš„æ™‚å€™ï¼Œå°±çŸ¥é“å¾å“ªè£¡å»æ‰¾åˆ°éœ€è¦çš„ ä¾è³´ã€‚modulesçš„ä¸€å€‹é‡è¦ç‰¹å¾µæ˜¯å®ƒå€‘è¨­è¨ˆç‚ºåˆ†å€ä¸¦çµ„åˆåœ¨ä¸€èµ·ï¼ˆæ¯”å¦‚èªªï¼Œåœ¨æˆ‘å€‘çš„appä¸­å¯ä»¥æœ‰å¤šå€‹çµ„æˆåœ¨ä¸€èµ·çš„modules) @Provide åœ¨modulesä¸­ï¼Œæˆ‘å€‘å®šç¾©çš„æ–¹æ³•æ˜¯ç”¨é€™å€‹è¨»è§£ï¼Œä»¥æ­¤ä¾†å‘Šè¨´Daggeræˆ‘å€‘æƒ³è¦æ§‹é€ å°è±¡ä¸¦æä¾›é€™äº›ä¾è³´ã€‚ @Singleton ç•¶å‰æä¾›çš„å°è±¡å°‡æ˜¯å–®ä¾‹æ¨¡å¼ ,ä¸€èˆ¬é…åˆ@Providesä¸€èµ·å‡ºç¾ @Component ç”¨æ–¼æ¥å£ï¼Œé€™å€‹æ¥å£è¢«Dagger2ç”¨æ–¼ç”Ÿæˆç”¨æ–¼æ¨¡å¡Šæ³¨å…¥çš„ä»£ç¢¼ @Inject åœ¨éœ€è¦ä¾è³´çš„åœ°æ–¹ä½¿ç”¨é€™å€‹è¨»è§£ã€‚ï¼ˆä½ ç”¨å®ƒå‘Šè¨´Daggeré€™å€‹ æ§‹é€ æ–¹æ³•ï¼Œæˆå“¡è®Šé‡æˆ–è€…å‡½æ•¸æ–¹æ³•éœ€è¦ä¾è³´æ³¨å…¥ã€‚é€™æ¨£ï¼ŒDaggerå°±æœƒæ§‹é€ ä¸€å€‹é€™å€‹é¡çš„å¯¦ä¾‹ä¸¦æ»¿è¶³ä»–å€‘çš„ä¾è³´ã€‚ï¼‰ @Scope Scopeså¯æ˜¯éå¸¸çš„æœ‰ç”¨ï¼ŒDagger2å¯ä»¥é€šéè‡ªå®šç¾©è¨»è§£é™å®šè¨»è§£ä½œç”¨åŸŸã€‚</p><p><strong>æ²’çœ‹æ‡‚ï¼Ÿæ¥è‘—å¾€ä¸‹çœ‹</strong></p><p>çœ‹çœ‹Dagger2 çš„æµç¨‹ï¼š</p><p><br></p><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ§‹è©³è§£ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/90971247a2bc4fb890359232d7e66547><p class=pgc-img-caption></p></div><p>Dagger2 æµç¨‹</p><p>é¦–å…ˆçœ‹çœ‹ä¸‹é¢é€™æ®µä»£ç¢¼ï¼Œæˆ‘å€‘éœ€è¦ä½¿ç”¨Okhttpï¼ŒRetrofitå’ŒGsonåšä¸€å€‹Twitter å®¢æˆ¶ç«¯çš„ç¶²çµ¡è¨ªå•ï¼Œå¦‚æœæˆ‘å€‘éœ€è¦åœ¨onCreateä¸­åŠ è¼‰ï¼Œæˆ‘å€‘å¯èƒ½æœƒé€™æ¨£åˆå§‹åŒ–ã€‚</p><pre><code>public class MainActivity extends Activity {OkHttpClient client = new OkHttpClient();// Enable caching for OkHttpint cacheSize = 10 * 1024 * 1024; // 10 MiBCache cache = new Cache(getApplication().getCacheDir(), cacheSize);client.setCache(cache);// Used for caching authentication tokensSharedPreferences sharedPrefeences = PreferenceManager.getDefaultSharedPreferences(this);// Instantiate GsonGson gson = new GsonBuilder().create();GsonConverterFactory converterFactory = GsonConverterFactory.create(Gson);// Build RetrofitRetrofit retrofit = new Retrofit.Builder()                                .baseUrl("https://api.github.com")                                .addConverterFactory(converterFactory)                                .client(client)  // custom client                                .build();public void onCreate(Bundle savedInstance) {    retrofit.xxx();    sharedPrefeences.xxx();    gson.xxx() } } </code></pre><p><strong>å¦‚æœæˆ‘å€‘ä½¿ç”¨Dagger2å®Œæˆä¸Šè¿°éç¨‹å‘¢ï¼Ÿ</strong></p><p>é¦–å…ˆæˆ‘å€‘è¦å‰µå»ºå¹¾å€‹Daggeræ¨¡å¡Šï¼ˆModuleï¼‰ï¼Œæˆ‘å€‘çš„ç¬¬ä¸€å€‹Daggeræ¨¡å¡Šï¼ˆModuleï¼‰AppModule.java(ä½¿ç”¨@Moduleé€²è¡Œé¡è¨»è§£)ï¼Œå°‡æœƒæä¾›Application çš„contextå¼•ç”¨ã€‚æˆ‘å€‘ä½¿ç”¨@Providesè¨»è§£å‘Šè¨´Dagger providesApplication()é€™å€‹æ–¹æ³•æ˜¯Applicationçš„å¯¦ä¾‹çš„æä¾›è€…ã€‚ä½¿ç”¨@Singletonè¨»è§£å‘Šè¨´Daggeræ•´å€‹ç”Ÿå‘½é€±æœŸä¸­åªæœƒè¢«åˆå§‹åŒ–ä¸€æ¬¡ã€‚</p><pre><code>@Modulepublic class AppModule {    Application mApplication;    public AppModule(Application application) {        mApplication = application;    }    @Provides    @Singleton    Application providesApplication() {        return mApplication;    }}</code></pre><p>å’Œä¸Šé¢é¡ä¼¼æ§‹å»ºç¬¬äºŒå€‹æ¨¡å¡Šï¼ˆModuleï¼‰ï¼Œä¸‹é¢é€™æ®µä»£ç¢¼æˆ‘å€‘é€²è¡Œäº†Gsonï¼ŒCacheï¼ŒOkHttpClientä»¥åŠRetrofit çš„å¯¦ä¾‹åŒ–ï¼Œé€™äº›æ–¹æ³•çš„è¿”å›é¡å‹éƒ½æœƒåœ¨å®šç¾©åˆ°<strong>ä¾è³´é—œä¿‚ï¼ˆä¾è³´è¡¨ dependency graphï¼‰</strong>ä¸­ã€‚åœ¨é€™è£¡æˆ‘å€‘éœ€è¦é—œæ³¨çš„æ˜¯ä¸‰å€‹è¨»è§£çš„@Module,@Provides,@Singletonçš„å®šç¾©ä½ç½®ã€‚</p><pre><code>@Modulepublic class NetModule {    String mBaseUrl;    // Constructor needs one parameter to instantiate.      public NetModule(String baseUrl) {        this.mBaseUrl = baseUrl;    }    // Dagger will only look for methods annotated with @Provides    @Provides    @Singleton    // Application reference must come from AppModule.class    SharedPreferences providesSharedPreferences(Application application) {        return PreferenceManager.getDefaultSharedPreferences(application);    }    @Provides    @Singleton    Cache provideOkHttpCache(Application application) {         int cacheSize = 10 * 1024 * 1024; // 10 MiB        Cache cache = new Cache(application.getCacheDir(), cacheSize);        return cache;    }   @Provides    @Singleton   Gson provideGson() {         GsonBuilder gsonBuilder = new GsonBuilder();       gsonBuilder.setFieldNamingPolicy(FieldNamingPolicy.LOWER_CASE_WITH_UNDERSCORES);       return gsonBuilder.create();   }   @Provides   @Singleton   OkHttpClient provideOkHttpClient(Cache cache) {      OkHttpClient client = new OkHttpClient();      client.setCache(cache);      return client;   }   @Provides   @Singleton   Retrofit provideRetrofit(Gson gson, OkHttpClient okHttpClient) {      Retrofit retrofit = new Retrofit.Builder()                .addConverterFactory(GsonConverterFactory.create(gson))                .baseUrl(mBaseUrl)                .client(okHttpClient)                .build();        return retrofit;    }}</code></pre><p>å¯ä»¥çœ‹åˆ°æˆ‘å€‘é€šé@Moduleæ¨™è¨»é¡ï¼Œ@Provideå’Œ@Singletonæ¨™è¨»æ–¹æ³•å®Œæˆäº†é€™äº›å°è±¡å¯¦ä¾‹çš„å‰µå»ºã€‚é‚£éº¼æˆ‘å€‘æ€éº¼ç²å–é€™äº›å°è±¡å¯¦ä¾‹å‘¢ï¼Ÿ</p><p>Dagger2é€šé@injectè¨»è§£æä¾›äº†å¯¦ä¾‹çš„ç²å–,é€šéèª¿ç”¨@injectæœƒè®“Dagger2 åœ¨<strong>ä¾è³´é—œä¿‚ï¼ˆä¾è³´è¡¨ dependency graphï¼‰</strong>ä¸­æ‰¾åˆ°å°æ‡‰çš„å¯¦ä¾‹å°è±¡ä¸¦è³¦å€¼çµ¦è©²å­—æ®µã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­å°±æœƒè¿”å›MyTwitterApiClient,SharedPreferencesçš„å¯¦ä¾‹å°è±¡ã€‚</p><pre><code>public class MainActivity extends Activity {   @Inject MyTwitterApiClient mTwitterApiClient;   @Inject SharedPreferences sharedPreferences;  public void onCreate(Bundle savedInstance) {       // assign singleton instances to fields       InjectorClass.inject(this);   } </code></pre><p>ä¸Šé¢çš„Moduleé¡éƒ½æœƒéœ€è¦ä¸€å€‹contextï¼Œæœ‰çš„æ™‚å€™æ˜¯Activity contextï¼Œæœ‰çš„æ™‚å€™æ˜¯Application contextï¼Œæ‰€ä»¥ä¸Šé¢å®Œæˆäº†æä¾› å’Œä½¿ç”¨å¯¦ä¾‹ ã€‚</p><p>å¯ä»¥çœ‹åˆ°ä¸Šé¢é€šéInjectorClass.inject(this)æŠŠç•¶å‰activityå°è±¡æ³¨å…¥åˆ°InjectorClassï¼Œé‚£éº¼InjectorClassæ˜¯ä»€éº¼å‘¢?æ­£æ˜¯é€™å€‹é—œè¯éç¨‹ã€‚</p><p>åœ¨Dagger2 ä¸­ ï¼Œæ³¨å…¥é¡ï¼ˆinjector classï¼‰è¢«ç¨±ä½œçµ„ä»¶ï¼ˆComponentï¼‰ï¼Œæˆ‘å€‘é€šéinjectæ–¹æ³•å‚³éactivityï¼Œserviceæˆ–è€…fragmentå°è±¡åˆ°æ³¨å…¥é¡componentä¸­ã€‚æ¯”å¦‚ä¸‹é¢é€™å€‹é¡ã€‚æˆ‘å€‘é€šé@Componentè¨»è§£ç•¶å‰é¡ï¼Œä¸¦ä¸”æŠŠä¹‹å‰çš„å…©å€‹æ¨¡å¡ŠAppModule.class, NetModule.classä¹Ÿæ·»åŠ åˆ°componentä¸­ã€‚ï¼ˆ<strong>Componentså¾æ ¹æœ¬ä¸Šä¾†èªªå°±æ˜¯ä¸€å€‹æ³¨å…¥å™¨ï¼Œä¹Ÿå¯ä»¥èªªæ˜¯@Injectå’Œ@Moduleçš„æ©‹æ¨‘ã€‚</strong>ï¼‰</p><pre><code>@Singleton@Component(modules={AppModule.class, NetModule.class})public interface NetComponent {   void inject(MainActivity activity);   // void inject(MyFragment fragment);   // void inject(MyService service);}</code></pre><p>åˆ°é€™è£¡æˆ‘å€‘å°±æŠŠDagger2 çš„å¤§è‡´æµç¨‹æ¢³ç†äº†ä¸€éã€‚</p><blockquote><p>æä¾›ï¼ˆ@Moduleï¼‰&lt;->é—œè¯ï¼ˆ@Componentï¼‰&lt;->ä½¿ç”¨ï¼ˆ@Injectï¼‰</p></blockquote><blockquote><p>ä¾è³´æ³¨å…¥ï¼Œé€™è®“æˆ‘æƒ³èµ·äº†å°æ™‚å€™æœ€æ€•çš„æ‰“é‡ã€‚å°±å¥½åƒæ‰“é‡éç¨‹ä¸€æ¨£ï¼Œæˆ‘å€‘æœ‰äº†è—¥ç‰©ï¼ˆæä¾›çš„å¯¦ä¾‹ï¼‰ï¼Œä½ çš„èº«é«”ç”Ÿç—…äº†éœ€è¦è—¥ç‰©ï¼ˆä½¿ç”¨é€™å€‹å¯¦ä¾‹ï¼‰ï¼Œæˆ‘å€‘éœ€è¦æ³¨å°„å™¨æŠŠè—¥ç‰©æ³¨å…¥ä½ çš„èº«é«”è£¡é¢ã€‚ï¼ˆé—œè¯é€™å€‹å¯¦ä¾‹ï¼‰ é‚£éº¼ä½ å°±æœƒå¥½å¥‡é€™å€‹è¨»è§£é¡æ˜¯æ€éº¼å®Œæˆæ•´å€‹æ³¨å…¥çš„å‘¢ï¼Ÿ(ä¹Ÿå°±æ˜¯èªªé€™å€‹é—œè¯éç¨‹)</p></blockquote><p>Dagger2ä¸­å¾ˆé‡è¦çš„ä¸€é»å°±æ˜¯å®ƒæœƒç‚º@Componentè¨»è§£çš„é¡ç”Ÿæˆä»£ç¢¼ã€‚å®ƒæœƒåœ¨é¡çš„å‰é¢æ·»åŠ ä¸ŠDaggerå‰ç¶´ï¼ˆæ¯”å¦‚ä¸Šé¢çš„é¡å°±æœƒç”ŸæˆDaggerNetComponent .javaï¼‰,ä¹Ÿå°±æ˜¯é€™å€‹é¡è² è²¬åˆå§‹åŒ–<strong>ä¾è³´é—œä¿‚ï¼ˆä¾è³´è¡¨ dependency graphï¼‰</strong>ä¸­çš„å¯¦ä¾‹ï¼Œä½µç‚ºè¨»è§£äº†@Inject çš„å­—æ®µåŸ·è¡Œæ³¨å…¥æ“ä½œã€‚æ¥è‘—å¾€ä¸‹çœ‹ã€‚</p><h3 class=pgc-h-arrow-right>2.5 åˆå§‹åŒ–çµ„ä»¶ï¼ˆInstantiating the componentï¼‰</h3><p>åˆå§‹åŒ–çµ„ä»¶æ“ä½œæ‡‰ç•¶åœ¨Applicationä¸­é€²è¡Œæ“ä½œï¼Œå› ç‚ºé€™äº›å¯¦ä¾‹åœ¨æ•´å€‹applicationç”Ÿå‘½é€±æœŸä¸­åªæœƒè¢«å¯¦ä¾‹åŒ–ä¸€æ¬¡ã€‚</p><pre><code>public class MyApp extends Application {    private NetComponent mNetComponent;    @Override    public void onCreate() {        super.onCreate();        // Dagger%COMPONENT_NAME%        mNetComponent = DaggerNetComponent.builder()                // list of modules that are part of this component need to be created here too                .appModule(new AppModule(this)) // This also corresponds to the name of your module: %component_name%Module                .netModule(new NetModule("https://api.github.com"))                .build();        // If a Dagger 2 component does not have any constructor arguments for any of its modules,        // then we can use .create() as a shortcut instead:        //  mAppComponent = com.codepath.dagger.components.DaggerNetComponent.create();    }    public NetComponent getNetComponent() {       return mNetComponent;    }}</code></pre><p>å¯ä»¥çœ‹åˆ°çš„æ˜¯æˆ‘å€‘ç›´æ¥ä½¿ç”¨NetComponentç”Ÿæˆçš„é¡DaggerNetComponentä¸¦ä¸”ç”Ÿæˆçš„æ–¹æ³•appModuleå’ŒnetModuleå®Œæˆäº†å…©å€‹å°æ‡‰moduleçš„åˆå§‹åŒ–ã€‚</p><blockquote><p>å› ç‚ºé€™è£¡æˆ‘å€‘ç¹¼æ‰¿äº†Applicationä¸¦ä½œå‡ºäº†ä¿®æ”¹ï¼Œæ‰€ä»¥éœ€è¦åœ¨AndroidManifest.xmlä¸­ä½œå‡ºä¿®æ”¹å¦‚ä¸‹ã€‚</p></blockquote><pre><code>&lt;application      android:allowBackup="true"      android:name=".MyApp"&gt;</code></pre><p>åœ¨activityä¸­ï¼Œæˆ‘å€‘éœ€è¦ç²å–componentä¸¦ä¸”èª¿ç”¨inject()æ–¹æ³•ã€‚æ³¨æ„éœ€è¦å°‡ç²å–çš„Applicationå¼·åˆ¶è½‰æ›ç‚ºMyAppã€‚é€™ä¹Ÿå®Œæˆäº†ä¸Šé¢InjectorClass.inject(this);ä»£ç¢¼çš„æ›¿æ›ã€‚</p><pre><code>public class MyActivity extends Activity {  @Inject OkHttpClient mOkHttpClient;  @Inject SharedPreferences sharedPreferences;  public void onCreate(Bundle savedInstance) {        // assign singleton instances to fields        // We need to cast to `MyApp` in order to get the right method        ((MyApp) getApplication()).getNetComponent().inject(this);    } </code></pre><blockquote><p>åˆ°é€™è£¡å°±å®Œæˆäº†æ•´å€‹Dagger2çš„ä¾è³´æ³¨å…¥æµç¨‹.</p></blockquote><h4 class=pgc-h-arrow-right>Dagger2çš„ä½¿ç”¨é‚„æœ‰ä¸€äº›æ³¨æ„é»ã€‚ä¸‹é¢é€²è¡Œè¬›è§£ã€‚åŒ…æ‹¬ä¸‹é¢çš„é™å®šé¡å‹ï¼Œä½œç”¨åŸŸï¼Œçµ„å»ºä¾è³´ï¼Œä»¥åŠå­çµ„ä»¶ã€‚</h4><h3 class=pgc-h-arrow-right>2.6 é™å®šé¡å‹ï¼ˆQualified typesï¼‰</h3><p><br></p><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ§‹è©³è§£ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e9ed79a0b06f46069aa3dd5d95f83081><p class=pgc-img-caption></p></div><p>Dagger ä¿®é£¾ç¬¦</p><p><br>å¦‚æœå°æ–¼ä¸åŒçš„å°è±¡æœ‰åŒæ¨£çš„è¿”å›é¡å‹ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨@Namedä¿®é£¾ç¬¦è¨»è§£ã€‚ä½ éœ€è¦åœ¨æä¾›å–®ä¾‹çš„åœ°æ–¹(@Providesè¨»è§£)å’Œæ³¨å…¥çš„åœ°æ–¹ï¼ˆ@Injectè¨»è§£ï¼‰éƒ½ä½¿ç”¨@Namedè¨»è§£ã€‚<br>æ¯”å¦‚ï¼Œå°æ–¼åŒæ¨£çš„è¿”å›OkHttpClient ï¼Œé€™è£¡æä¾›ä¸åŒçš„æ–¹æ³•ï¼Œå’Œjavaä¸­å¤šæ…‹ä¸€æ¨£ï¼Œåªä¸éé€™è£¡éœ€è¦é¡å¤–é€šé@Namedè¨»è§£ä¾†æ¨™è¨»ï¼š</p><p><br></p><pre><code>@Provides @Named("cached")@SingletonOkHttpClient provideOkHttpClient(Cache cache) {    OkHttpClient client = new OkHttpClient();    client.setCache(cache);    return client;}@Provides @Named("non_cached") @SingletonOkHttpClient provideOkHttpClient() {    OkHttpClient client = new OkHttpClient();    return client;}</code></pre><pre><code>@Inject @Named("cached") OkHttpClient client;@Inject @Named("non_cached") OkHttpClient client2;</code></pre><p>å¦‚ä¸‹ï¼Œ@Namedæ˜¯åœ¨Daggerä¸­é å…ˆå®šç¾©å¥½çš„ä¿®é£¾ç¬¦ï¼Œä½ ä¹Ÿå¯ä»¥å‰µå»ºè‡ªå·±çš„ä¿®é£¾ç¬¦è¨»è§£ã€‚é—œæ–¼è‡ªå®šç¾©è¨»è§£ï¼Œæˆ‘ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ã€è­¯ã€‘å¾javaè¨»è§£åˆ†æButterKnifeå·¥ä½œæµç¨‹æœ‰æ‰€æåŠã€‚</p><pre><code>@Qualifier@Documented@Retention(RUNTIME)public @interface DefaultPreferences {}</code></pre><h3 class=pgc-h-arrow-right>2.7 ä½œç”¨åŸŸï¼ˆScopesï¼‰</h3><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ§‹è©³è§£ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/110d321a3ccd446d91328d25f57018a1><p class=pgc-img-caption></p></div><p>dagger ä½œç”¨åŸŸ</p><p>Scopeså¯æ˜¯éå¸¸çš„æœ‰ç”¨ï¼ŒDagger2å¯ä»¥é€šéè‡ªå®šç¾©è¨»è§£é™å®šè¨»è§£ä½œç”¨åŸŸã€‚@Singletonæ˜¯è¢«Daggeré å…ˆå®šç¾©çš„ä½œç”¨åŸŸè¨»è§£ï¼ˆ scope annotation ï¼‰ã€‚æ²’æœ‰æŒ‡å®šä½œç”¨åŸŸçš„@Providesæ–¹æ³•å°‡æœƒåœ¨æ¯æ¬¡æ³¨å…¥çš„æ™‚å€™éƒ½å‰µå»ºæ–°çš„å°è±¡ã€‚åŒæ¨£çš„ï¼Œä½ ä¹Ÿå¯ä»¥å®šç¾©è‡ªå·±çš„Scopeè¨»è§£ã€‚</p><pre><code>@Scope@Documented@Retention(value=RUNTIME)public @interface MyActivityScope</code></pre><blockquote><p>ä½ å¯ä»¥åœ¨å®˜æ–¹æ–‡æª”ä¸­æ‰¾åˆ°é€™æ¨£ä¸€æ®µæ–‡å­—</p></blockquote><pre><code>/** * In Dagger, an unscoped component cannot depend on a scoped component. As * {@link edu.com.app.injection.component.ApplicationComponent} is a scoped component ({@code @Singleton}, we create a custom * scope to be used by all fragment components. Additionally, a component with a specific scope * cannot have a sub component with the same scope. */</code></pre><p>ä¹Ÿå°±æ˜¯èªªä¸€å€‹æ²’æœ‰scopeçš„çµ„ä»¶componentä¸å¯ä»¥ä»¥ä¾†ä¸€å€‹æœ‰scopeçš„çµ„ä»¶componentã€‚å­çµ„ä»¶å’Œçˆ¶çµ„ä»¶çš„scopeä¸èƒ½ç›¸åŒã€‚æˆ‘å€‘é€šå¸¸çš„ApplicationComponentéƒ½æœƒä½¿ç”¨Singletonè¨»è§£ï¼Œä¹Ÿå°±æœƒæ˜¯èªªæˆ‘å€‘å¦‚æœè‡ªå®šç¾©componentå¿…é ˆæœ‰è‡ªå·±çš„scopeã€‚åœ¨ä¸‹é¢çµ„ä»¶ä¾è³´ä¸­æœƒå†æ¬¡æåŠã€‚</p><h3 class=pgc-h-arrow-right>2.8 çµ„ä»¶ä¾è³´ï¼ˆComponent Dependenciesï¼‰</h3><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ§‹è©³è§£ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/41f2ae070e8540b0b0e9095742cb2a17><p class=pgc-img-caption></p></div><p>dagger ä¾è³´</p><p><br></p><p>ä¸Šé¢çš„ä¾‹å­æˆ‘å€‘å‰µå»ºäº†applicationçš„å…¨å±€å–®ä¾‹.å¦‚æœæˆ‘å€‘æƒ³åœ¨å…§å­˜ä¸­ç¸½æ˜¯æ“æœ‰å¤šå€‹çµ„ä»¶ï¼ˆä¾‹å¦‚åœ¨activityå’Œfragmentç”Ÿå‘½é€±æœŸï¼Œç”¨æˆ¶ç™»éŒ„è¨»å†Šå‰µå»ºçš„componentï¼‰ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨çµ„ä»¶ä¾è³´ï¼ˆComponent Dependenciesï¼‰ï¼Œä½¿ç”¨çµ„ä»¶ä¾è³´æœ‰ä¸‹é¢å¹¾å€‹è€ƒæ…®é»ï¼š</p><ul><li>å…©å€‹ä¾è³´çš„çµ„ä»¶ä¸èƒ½å…±äº«ä½œç”¨åŸŸï¼Œæ¯”å¦‚å…©å€‹çµ„ä»¶ä¸èƒ½å…±äº«@Singletonä½œç”¨åŸŸã€‚é€™å€‹é™åˆ¶ç”¢ç”Ÿçš„åŸå› çœ‹é€™è£¡ã€‚ä¾è³´çš„çµ„ä»¶éœ€è¦å®šç¾©è‡ªå·±çš„ä½œç”¨åŸŸã€‚</li><li>å„˜ç®¡Dagger2 æœ‰å‰µå»ºä½œç”¨åŸŸå¯¦ä¾‹çš„èƒ½åŠ›ï¼Œä½ ä¹Ÿéœ€è¦å‰µå»ºå’Œåˆªé™¤å¼•ç”¨ä¾†æ»¿è¶³è¡Œç‚ºçš„ä¸€è‡´æ€§ã€‚Dagger2 ä¸æœƒçŸ¥é“ä»»ä½•åº•å±¤çš„å¯¦ç¾ã€‚å¯ä»¥çœ‹çœ‹Stack Overflow çš„é€™å€‹ è¨è«–</li><li>ç•¶å‰µå»ºä¾è³´çµ„ä»¶çš„æ™‚å€™ï¼Œçˆ¶çµ„ä»¶éœ€è¦é¡¯ç¤ºçš„æš´éœ²å°è±¡çµ¦å­çµ„ä»¶ã€‚æ¯”å¦‚å­çµ„ä»¶éœ€è¦çŸ¥é“Retrofit å°è±¡ï¼Œä¹Ÿå°±éœ€è¦é¡¯ç¤ºçš„æš´éœ²å‡ºä¾†ã€‚</li></ul><pre><code>@Singleton@Component(modules={AppModule.class, NetModule.class})public interface NetComponent {//ä¾è³´æ–¼ç•¶å‰componentçš„componentæœƒå¾—åˆ°Retrofitå¯¦ä¾‹ï¼Œé€™è£¡çš„æ–¹æ³•åä¸å›ºå®š    Retrofit retrofit();}</code></pre><p>é€™è£¡åƒè€ƒæˆ‘è‡ªå·±é …ç›®çš„ActivityComponentï¼Œä¾è³´æ–¼ApplicationComponentï¼Œæ‰€ä»¥é€™è£¡æˆ‘å€‘æœƒè‡ªå®šç¾©ScopePerActivityã€‚ä¹Ÿå¯ä»¥çœ‹åˆ°çš„æ˜¯@ActivityContextæœƒåœ¨componentå’Œmoduleä¸­å¾—åˆ°ä½¿ç”¨ã€‚åƒè€ƒä¸‹é¢ä¸‰æ®µä»£ç¢¼ã€‚</p><pre><code>@PerActivity@Component(dependencies = ApplicationComponent.class, modules = ActivityModule.class)public interface ActivityComponent {    void inject(MainActivity mainActivity);  //......    void inject(SettingsFragment settingsFragment);}</code></pre><pre><code>@Documented@Scope@Retention(RetentionPolicy.RUNTIME)public @interface PerActivity {}</code></pre><pre><code>@Modulepublic class ActivityModule {    private Activity mActivity;    public ActivityModule(Activity activity) {        mActivity = activity;    }    @Provides    Activity provideActivity() {        return mActivity;    }    @Provides    @ActivityContext    Context providesContext() {        return mActivity;    }}</code></pre><h3 class=pgc-h-arrow-right>2.9 å­çµ„ä»¶ï¼ˆSubcomponentsï¼‰</h3><p><br></p><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ§‹è©³è§£ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/245b1dd07c014b649cd028e0a9d557fd><p class=pgc-img-caption></p></div><p>dagger å­çµ„ä»¶</p><p><br>é™¤äº†ä¾è³´é—œä¿‚ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å­çµ„ä»¶é€²è¡Œ<strong>å°è±¡é—œä¿‚ï¼ˆå°è±¡è¡¨/åœ– object graphï¼‰</strong>ç¹¼æ‰¿ã€‚å’Œçµ„ä»¶ä¹‹é–“æ·»åŠ ä¾è³´é—œä¿‚ä¸€æ¨£ï¼Œå­çµ„ä»¶ä¹Ÿæœ‰è‡ªå·±çš„ç”Ÿå‘½é€±æœŸï¼Œä¹Ÿæœƒåœ¨æ‰€æœ‰å°å…¶æ‡‰ç”¨ä¸åœ¨çš„æ™‚å€™è¢«åƒåœ¾å›æ”¶ï¼Œä¹Ÿæœ‰åŒæ¨£çš„ä½œç”¨åŸŸé™åˆ¶ã€‚å€åˆ¥æ–¼çµ„ä»¶ä¾è³´çš„ä¸åŒé»ä¸»è¦æ˜¯ï¼š</p><p><br></p><ul><li>éœ€è¦åœ¨çˆ¶çµ„ä»¶çš„æ¥å£ä¸­è²æ˜ï¼ˆåœ¨æ¥å£ä¸­å®šç¾©çš„æ–¹æ³•å°æ–¼ç”Ÿæˆçš„å°è±¡æ˜¯å¯è¨ªå•çš„ã€‚ï¼‰ã€‚</li><li>èƒ½å¤ ç²å–çˆ¶çµ„ä»¶çš„æ‰€æœ‰å…ƒç´ ï¼ˆä¸åƒ…åƒ…æ˜¯åœ¨æ¥å£ä¸­è²æ˜çš„å…ƒç´ ï¼‰ã€‚<br>æ¯”å¦‚ä¸‹é¢é€™æ®µä»£ç¢¼ï¼š</li></ul><pre><code>@Modulepublic class MyActivityModule {    private final MyActivity activity;    public MyActivityModule(MyActivity activity) { this.activity = activity; }    @Provides @MyActivityScope @Named("my_list")    public ArrayAdapter providesMyListAdapter() {        return new ArrayAdapter&lt;String&gt;(activity, android.R.layout.my_list);    }    ...}@MyActivityScope@Subcomponent(modules={ MyActivityModule.class })public interface MyActivitySubComponent {    @Named("my_list") ArrayAdapter myListAdapter();}@Singleton@Component(modules={ ... })public interface MyApplicationComponent {    MyActivitySubComponent newMyActivitySubcomponent(MyActivityModule activityModule);}</code></pre><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå­çµ„ä»¶çš„å¯¦ä¾‹åœ¨æ¯æ¬¡æˆ‘å€‘èª¿ç”¨newMyActivitySubcomponent()çš„æ™‚å€™éƒ½æœƒè¢«å‰µå»ºã€‚ä½¿ç”¨å­æ¨¡å¡Šå»æ³¨å…¥ä¸€å€‹activityï¼š</p><pre><code>public class MyActivity extends Activity {  @Inject ArrayAdapter arrayAdapter;  public void onCreate(Bundle savedInstance) {        // assign singleton instances to fields        // We need to cast to `MyApp` in order to get the right method        ((MyApp) getApplication()).getApplicationComponent())            .newMyActivitySubcomponent(new MyActivityModule(this))            .inject(this);    } }</code></pre><blockquote><p>æœ€å¾Œå†ä¾†æ¢³ç†ä¸€ä¸‹Dagger2 ä¸­çš„ä¸€äº›æ³¨æ„é»ï¼š</p></blockquote><ul><li>Componentså¾æ ¹æœ¬ä¸Šä¾†èªªå°±æ˜¯ä¸€å€‹æ³¨å…¥å™¨ï¼Œä¹Ÿå¯ä»¥èªªæ˜¯@Injectå’Œ@Moduleçš„æ©‹æ¨‘ã€‚ Componentså¯ä»¥æä¾›æ‰€æœ‰å®šç¾©äº†çš„é¡å‹çš„å¯¦ä¾‹ï¼Œæ¯”å¦‚ï¼šæˆ‘å€‘å¿…é ˆç”¨@Componentè¨»è§£ä¸€å€‹æ¥å£ç„¶å¾Œåˆ—å‡ºæ‰€æœ‰çš„@Modulesçµ„æˆè©²çµ„ä»¶ï¼Œå¦‚ æœç¼ºå¤±äº†ä»»ä½•ä¸€å¡Šéƒ½æœƒåœ¨ç·¨è­¯çš„æ™‚å€™å ±éŒ¯ã€‚@Componentæ¥å£å®šç¾©äº†å°è±¡æä¾›è€…ï¼ˆmoduleï¼‰å’Œå°è±¡ä¹‹é–“çš„è¯ç¹«ï¼Œä¹Ÿè¡¨è¿°äº†ä¸€ç¨®ä¾è³´é—œä¿‚ã€‚</li><li>ç”±æ–¼Dagger2ä½¿ç”¨ç”Ÿæˆçš„ä»£ç¢¼å»è¨ªå•å­—æ®µï¼Œæ‰€ä»¥å­—æ®µä½¿ç”¨äº†Dagger2 æ˜¯ä¸å…è¨±æ¨™è¨»ç‚ºprivateçš„ã€‚</li><li>Dagger2 åŸºæ–¼JSR 330ï¼ˆç‚ºäº†æœ€å¤§ç¨‹åº¦çš„æé«˜ä»£ç¢¼çš„è¤‡ç”¨æ€§ã€æ¸¬è©¦æ€§å’Œç¶­è­·æ€§ï¼Œjavaçš„ä¾è³´æ³¨å…¥ç‚ºæ³¨å…¥é¡ä¸­çš„ä½¿ç”¨å®šç¾©äº†ä¸€æ•´å¥—è¨»è§£ï¼ˆå’Œæ¥å£ï¼‰æ¨™æº–ã€‚Dagger1å’ŒDagger2ï¼ˆé‚„æœ‰Guiceï¼‰éƒ½æ˜¯åŸºæ–¼é€™å¥—æ¨™æº–ï¼Œçµ¦ç¨‹åºå¸¶ä¾†äº†ç©©å®šæ€§å’Œæ¨™æº–çš„ä¾è³´æ³¨å…¥æ–¹æ³•ã€‚ï¼‰</li><li>ä½¿ç”¨@injectè¨»è§£è¡¨ç¤ºä¾è³´é—œä¿‚å¯ä»¥ç”¨æ–¼ä¸‰å€‹åœ°æ–¹ã€‚æ§‹é€ å‡½æ•¸ï¼Œå­—æ®µæˆ–è€…æ–¹æ³•ä¸­ï¼‰ã€‚</li><li>Dagger2æœƒåœ¨ç·¨è­¯æ™‚é€šéaptç”Ÿæˆä»£ç¢¼é€²è¡Œæ³¨å…¥ã€‚</li></ul><p>ä»¥å¾Œçš„é–‹ç™¼ä¸­ï¼Œé‚£éº¼å¤šéœ€è¦ä½¿ç”¨å¯¦ä¾‹çš„åœ°æ–¹ï¼Œåªéœ€è¦ç°¡ç°¡å–®å–®åœ°ä¾†ä¸€å€‹@injectï¼Œè€Œä¸éœ€è¦é—œå¿ƒæ˜¯å¦‚ä½•æ³¨å…¥çš„ã€‚Dagger2è®“ä½ æ„›ä¸é‡‹æ‰‹ã€‚ é‚£éº¼æ¥ä¸‹ä¾†æˆ‘å€‘åˆ†æå®˜æ–¹æ¶æ§‹Dagger2 åˆæ˜¯æ€éº¼ä½¿ç”¨çš„å§ï¼Ÿ</p><hr><h1 class=pgc-h-arrow-right>3 googleå®˜æ–¹MVPæ¶æ§‹å›é¡§</h1><p><br></p><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ§‹è©³è§£ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9d9ff10e0e7f45818079dde365a89bbc><p class=pgc-img-caption></p></div><p><br>ä¸Šä¸€ç¯‡æ–‡ç« <strong>googleå®˜æ–¹æ¶æ§‹MVPè§£æèˆ‡å¯¦æˆ°</strong> ä¸­ï¼Œæˆ‘å€‘åˆ†æåˆ°æ•´å€‹é …ç›®æ˜¯æŒ‰ç…§åŠŸèƒ½æ¨¡å¡Šé€²è¡ŒåŠƒåˆ†ï¼ˆaddedittaskï¼Œstatisticsï¼Œtaskdetailï¼Œtaskså››å€‹æ¨¡å¡Šï¼‰ä¸¦ä¸”å°‡æ•¸æ“šå’Œå·¥å…·é¡åˆ†åˆ¥æå–åˆ°dataå’ŒutilåŒ…ä¸­ã€‚æˆ‘å€‘å°taskdetialæ¨¡å¡Šé€²è¡Œäº†åˆ†æã€‚é€™è£¡æå–ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„çµè«–</p><p><br></p><blockquote><p><strong>3.1</strong> å®˜æ–¹MVPå¯¦ä¾‹ï¼Œé€šéå”è­°é¡XXXContractä¾†å°Viewå’ŒPresenterçš„æ¥å£é€²è¡Œå…§éƒ¨ç¹¼æ‰¿ã€‚æ˜¯å°BaseViewå’ŒBasePresenterçš„é€²ä¸€æ­¥å°è£ï¼Œæ‰€ä»¥æˆ‘å€‘å¯¦ç¾çš„Viewå’ŒPresenterä¹Ÿåªéœ€è¦ç¹¼æ‰¿XXXContractä¸­çš„å°æ‡‰å…§éƒ¨æ¥å£å°±è¡Œã€‚é€™ä¹Ÿæ˜¯ä¸€å€‹éå¸¸ä¸éŒ¯çš„æ–¹å¼ç®¡ç†MVPä¸­çš„viewå’Œpresenterã€‚(ä¾·é™åœ¨æ–¼XXXContract ä»¥æ¥å£çš„å½¢å¼é€²è¡Œæä¾›ï¼Œæ‰€ä»¥å®ƒçš„å…§éƒ¨é¡viewå’Œpresenteréƒ½ä¸èƒ½åšä¸€äº›å…¬å…±åˆå§‹åŒ–æ“ä½œï¼Œåªèƒ½ä»¥æ¥å£å½¢å¼æä¾›çµ¦å­é¡å¯¦ç¾ã€‚)</p><p><br></p></blockquote><blockquote><p><strong>3.2</strong> activityçš„ä½œç”¨ä¸»è¦æ˜¯å‰µå»ºMVPä¸­Viewï¼ˆé€™è£¡æ˜¯ç›¸æ‡‰çš„fragmentï¼‰ï¼Œä»¥åŠå‰µå»ºpresenterï¼Œä¸¦æŠŠviewå’Œpresenterç¶å®šã€‚ï¼ˆåœ¨å¯¦éš›é–‹ç™¼ä¸­å¯ä»¥éˆæ´»é‹ç”¨ï¼Œactivityï¼Œfragmentä»¥åŠè‡ªå®šç¾©viewéƒ½å¯ä»¥ä½œç‚ºMVPä¸­çš„viewä½¿ç”¨ã€‚ï¼‰</p><p><br></p></blockquote><blockquote><p><strong>3.3</strong> åœ¨presenterçš„å¯¦ç¾é¡çš„æ§‹é€ å‡½æ•¸ä¸­ï¼Œé€šéviewçš„setPresenterï¼Œè®“viewç²å¾—äº†presenterå¯¦ä¾‹ã€‚é€™æ¨£viewä¸­å°±å¯ä»¥å°Presenterä¸­çš„æ–¹æ³•é€²è¡Œæ“ä½œäº†ã€‚</p><p><br></p></blockquote><blockquote><p><strong>3.4</strong> åœ¨presenterçš„å¯¦ç¾é¡ä¸­ï¼Œå¯ä»¥å°Modelæ•¸æ“š(é€™è£¡çš„TaskRespository)é€²è¡Œæ“ä½œã€‚å¯¦ä¾‹ä¸­ï¼Œæ•¸æ“šçš„ç²å–ã€å­˜å„²ã€æ•¸æ“šç‹€æ…‹è®ŠåŒ–éƒ½æ˜¯modelå±¤çš„ä»»å‹™ï¼Œpresenteræœƒæ ¹æ“šéœ€è¦èª¿ç”¨è©²å±¤çš„æ•¸æ“šè™•ç†é‚è¼¯ä¸¦åœ¨éœ€è¦æ™‚å°‡å›èª¿å‚³å…¥ã€‚é€™æ¨£modelã€presenterã€viewéƒ½åªè™•ç†å„è‡ªçš„ä»»å‹™ï¼Œæ­¤ç¨®å¯¦ç¾ç¢ºå¯¦æ˜¯å–®ä¸€è·è²¬æœ€å¥½çš„è©®é‡‹ã€‚</p><p><br></p></blockquote><hr><h1 class=pgc-h-arrow-right>4 Googleå®˜æ–¹æ¶æ§‹MVP+Dagger2æ¶æ§‹è©³è§£</h1><h3 class=pgc-h-arrow-right>4.1 å°æ¯”</h3><p>é€™è£¡æˆ‘å€‘æ¥è‘—MVPé …ç›®è¬›è§£MVP+Dagger2é …ç›®ï¼Œä¹Ÿæ˜¯å°taskdetialæ¨¡å¡Šåšå‡ºåˆ†æã€‚</p><p><br></p><div class=pgc-img><img alt=Googleå®˜æ–¹MVP+Dagger2æ¶æ§‹è©³è§£ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fe544df3ddd04fc2a4f17e16709deaed><p class=pgc-img-caption></p></div><p>é€šéä¸Šåœ–æˆ‘å€‘å¯ä»¥çœ‹åˆ°ï¼Œé€™è£¡æ·»åŠ äº†å››å€‹å€‹é¡æ–‡ä»¶ï¼Œåˆ†åˆ¥æ˜¯å…¨å±€çš„ApplicationModuleå’ŒToDoApplicationã€‚ä»¥åŠå°æ‡‰XXXæ¨¡å¡Šä¸­çš„XXXComponentå’ŒXXXPresenterModuleã€‚å…¶ä»–æ¨¡å¡Šä¹Ÿé¡ä¼¼ã€‚</p><h3 class=pgc-h-arrow-right>4.2 åˆ†æ</h3><ul><li>é¦–å…ˆçœ‹çœ‹ToDoApplication,æä¾›äº†TasksRepositoryComponentçš„åˆå§‹åŒ–ã€‚</li></ul><pre><code>public class ToDoApplication extends Application {    private TasksRepositoryComponent mRepositoryComponent;    @Override    public void onCreate() {        super.onCreate();        mRepositoryComponent = DaggerTasksRepositoryComponent.builder()                .applicationModule(new ApplicationModule((getApplicationContext())))                .tasksRepositoryModule(new TasksRepositoryModule()).build();    }    public TasksRepositoryComponent getTasksRepositoryComponent() {        return mRepositoryComponent;    }}</code></pre><p>DaggerTasksRepositoryComponent æ˜¯ç”±Dagger2ç”Ÿæˆçš„ä»£ç¢¼ã€‚æˆ‘å€‘é€šéå®ƒä¾†åˆå§‹åŒ–TasksRepositoryComponentã€‚ä¸¦ä¸”å¯ä»¥çœ‹åˆ°çš„æ˜¯ApplicationModuleå’ŒTasksRepositoryModuleä¹Ÿåœ¨é€™è£¡é€²è¡Œäº†ä¸€æ¬¡æ€§åˆå§‹åŒ–ã€‚TasksRepositoryéœ€è¦èªªæ˜çš„æ˜¯æ•´å€‹æ•¸æ“šmodelå±¤çš„æ ¸å¿ƒã€‚</p><ul><li>ä¾†çœ‹çœ‹ApplicationModule</li></ul><pre><code>@Modulepublic final class ApplicationModule {    private final Context mContext;    ApplicationModule(Context context) {        mContext = context;    }    @Provides    Context provideContext() {        return mContext;    }}</code></pre><p>å¯ä»¥çœ‹åˆ°çš„æ˜¯é€™è£¡éœ€è¦çš„æ˜¯ä¸€å€‹application context çš„å¯¦ä¾‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘åœ¨ä¸Šé¢ToDoApplicationçš„onCreateä¸­åˆå§‹åŒ–çš„æ™‚å€™å‚³å…¥çš„getApplicationContext()ã€‚å®ƒæœ€çµ‚æœƒæä¾›ä¸€å€‹é€šéprovideContext()æ–¹æ³•æä¾›ä¸€å€‹Contextå¯¦ä¾‹ã€‚</p><ul><li>ä¾†çœ‹çœ‹TasksRepositoryModule</li></ul><pre><code>@Modulepublic class TasksRepositoryModule {    @Singleton    @Provides    @Local    TasksDataSource provideTasksLocalDataSource(Context context) {        return new TasksLocalDataSource(context);    }    @Singleton    @Provides    @Remote    TasksDataSource provideTasksRemoteDataSource() {        return new FakeTasksRemoteDataSource();    }}</code></pre><p>é€™æ˜¯ç”¨æ–¼mockæ¸¬è©¦çš„ä¸€å€‹é¡ï¼Œè£¡é¢çš„å…©å€‹æ–¹æ³•åˆ†åˆ¥è¡¨ç¤ºæœ¬åœ°æ•¸æ“šå’Œé ç¨‹æ•¸æ“šï¼Œæœ€çµ‚è¿”å›çš„éƒ½æ˜¯TasksDataSourceã€‚mockæ¸¬è©¦å°±æ˜¯åœ¨æ¸¬è©¦éç¨‹ä¸­ï¼Œå°æ–¼æŸäº›ä¸å®¹æ˜“æ§‹é€ æˆ–è€…ä¸å®¹æ˜“ç²å–çš„å°è±¡ï¼Œç”¨ä¸€å€‹è™›æ“¬çš„å°è±¡ä¾†å‰µå»ºä»¥ä¾¿æ¸¬è©¦çš„æ¸¬è©¦æ–¹æ³•ã€‚é€™è£¡å°æ–¼æ•¸æ“šå°è±¡ç›´æ¥åœ¨é€™è£¡é€²è¡Œåˆå§‹åŒ–ï¼Œè€Œä¸æ˜¯åœ¨æ‰€æœ‰çš„ç”¨åˆ°è©²æ•¸æ“šçš„åœ°æ–¹newä¸€éã€‚é€™ä¹Ÿå°±é«”ç¾äº†Dagger2çš„å¼•å…¥å°æ¸¬è©¦æ˜¯ä¸€å€‹æ¥µå¤§çš„ä¾¿åˆ©ã€‚</p><ul><li>ç¾åœ¨å›åˆ°æ•´å€‹æ‡‰ç”¨çš„æ ¸å¿ƒTasksRepositoryComponent,ä¹Ÿå°±æ˜¯åœ¨ToDoApplicationä¸­åˆå§‹åŒ–çš„æ ¸å¿ƒé¡ã€‚</li></ul><pre><code>@Singleton@Component(modules = {TasksRepositoryModule.class, ApplicationModule.class})public interface TasksRepositoryComponent {    TasksRepository getTasksRepository();}</code></pre><p>å¯ä»¥çœ‹åˆ°é€™è£¡Dagger2å…è¨±æˆ‘å€‘ç‚ºComponentä½¿ç”¨@Singletonä¾†ä¿æŒå–®ä¾‹æ¨¡å¼ï¼Œä½†æ˜¯æˆ‘å€‘åœ¨ToDoApplicationä¹Ÿå†æ¬¡é€²è¡Œäº†å–®ä¾‹å‰µå»ºï¼Œé€™æ˜¯å¿…è¦çš„ä¸€æ­¥ã€‚åŒæ™‚é€™è£¡å®šç¾©çš„TasksRepositoryModule.classå’ŒApplicationModule.class ä¹Ÿæ˜¯åœ¨ToDoApplicationé€²è¡Œåˆå§‹åŒ–å‰µå»ºçš„ã€‚ éƒ½èªªComponentå°±æ˜¯ä¸€å€‹æ³¨å…¥å™¨ï¼Œä¹Ÿå¯ä»¥èªªæ˜¯@Injectå’Œ@Moduleçš„æ©‹æ¨‘ã€‚ é‚£éº¼éˆæ¥äº†@Moduleï¼Œæˆ‘å€‘çœ‹çœ‹æ˜¯å¦‚ä½•éˆæ¥@Injectçš„å§ï¼Ÿ</p><ul><li>ç¾åœ¨é€²å…¥å°æ‡‰æ¨¡å¡Štaskdetailæ¨¡å¡Šï¼Œé¦–å…ˆçœ‹çœ‹TaskDetailComponent.</li></ul><pre><code>@FragmentScoped@Component(dependencies = TasksRepositoryComponent.class, modules = TaskDetailPresenterModule.class)public interface TaskDetailComponent {        void inject(TaskDetailActivity taskDetailActivity);}</code></pre><pre><code>@Documented@Scope@Retention(RetentionPolicy.RUNTIME)public @interface FragmentScoped {}</code></pre><p>é€™ä¹Ÿå°±æ˜¯æˆ‘å€‘æä¾›æ³¨å…¥injectæ–¹æ³•çš„åœ°æ–¹ã€‚å¾è¨»è§£ä¸­å¯ä»¥çœ‹åˆ°ä¾è³´æ–¼TasksRepositoryComponent.classæ‰€ä»¥å…¶ä¸­çš„TaskRespositoryå°æ–¼ç•¶å‰componentæ˜¯å¯ç”¨çš„ã€‚</p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯åœ¨Daggerä¸­ï¼Œä¸€å€‹æ²’æœ‰ä½œç”¨åŸŸï¼ˆunscoped ï¼‰çš„çµ„ä»¶ä¸å¯ä»¥ä¾è³´æœ‰ä½œç”¨åŸŸçš„çµ„ä»¶ã€‚æ¯”å¦‚é€™è£¡çš„TasksRepositoryComponentä½œç”¨åŸŸç‚º@Singletonã€‚æ‰€ä»¥æˆ‘å€‘åœ¨é€™è£¡è‡ªå®šç¾©äº†ä¸€å€‹ç”±æ‰€æœ‰fragmentä½¿ç”¨çš„FragmentScopedã€‚å¦å¤–ï¼Œçµ„ä»¶æœ‰ç¢ºå®šä½œç”¨åŸŸï¼Œé‚£éº¼ä¾è³´å®ƒçš„çµ„ä»¶ä¸èƒ½æœ‰ç›¸åŒçš„ä½œç”¨åŸŸã€‚</p></blockquote><ul><li>æ¥ä¸‹ä¾†çœ‹çœ‹TaskDetailComponentä¸­å®šç¾©çš„æ¨¡å¡ŠTaskDetailPresenterModule.class</li></ul><pre><code>@Modulepublic class TaskDetailPresenterModule {    private final TaskDetailContract.View mView;    private final String mTaskId;    public TaskDetailPresenterModule(TaskDetailContract.View view, String taskId) {        mView = view;        mTaskId = taskId;    }    @Provides    TaskDetailContract.View provideTaskDetailContractView() {        return mView;    }    @Provides    String provideTaskId() {        return mTaskId;    }}</code></pre><p>ä¸»è¦æ˜¯æä¾›MVPä¸­ç›¸æ‡‰æ¨¡å¡Šçš„Viewçš„è¿”å›ï¼Œé€™åœ¨ä¸Šé¢ä¸€ç¯€ä¸­æåˆ°éï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°è¿”å›é¡å‹æ˜¯TaskDetailContract.View ã€‚ä¹Ÿæ˜¯åœ¨é€™è£¡å®ŒæˆMVPæ¨¡å¼ä¸­é‡è¦çš„ä¸€ç’°ï¼Œä¹Ÿå°±æ˜¯Presenterå’ŒViewçš„å¯¦ä¾‹çš„ç²å–ï¼Œä¸ç„¶Presenteræ€éº¼å‘Šè¨´Viewæ€éº¼æ›´æ–°Viewå‘¢ï¼</p><ul><li>æ¥ä¸‹ä¾†çœ‹çœ‹Presenterçš„å‰µå»ºã€‚åœ¨ä¸Šä¸€ç¯€ä¸­æˆ‘å€‘å°±çŸ¥é“äº†Presenterç”±TaskDetailActivityé€²è¡Œå‰µå»ºã€‚å¯¦éš›ä¸Šçš„MVPä¸­çš„Viewæ˜¯TaskDetailFragmentã€‚å› ç‚ºé€™è£¡æ˜¯é€šéview.setPresenteræ–¹å¼å®Œæˆpresenterå’Œviewçš„éˆæ¥ã€‚æ‰€ä»¥é€™è£¡ä¸å†è´…è¿°Viewä¸­çš„ç´°ç¯€ã€‚</li></ul><pre><code>public class TaskDetailActivity extends AppCompatActivity {    @Inject TaskDetailPresenter mTaskDetailPresenter;    @Override    protected void onCreate(Bundle savedInstanceState) {       ......        if (taskDetailFragment == null) {            taskDetailFragment = TaskDetailFragment.newInstance(taskId);            ActivityUtils.addFragmentToActivity(getSupportFragmentManager(),                    taskDetailFragment, R.id.contentFrame);        }        // Create the presenter        DaggerTaskDetailComponent.builder()                .taskDetailPresenterModule(new TaskDetailPresenterModule(taskDetailFragment, taskId))                .tasksRepositoryComponent(((ToDoApplication) getApplication())                .getTasksRepositoryComponent()).build()                .inject(this);    }......}</code></pre><ul><li>çœ‹çœ‹TaskDetailPresenter</li></ul><pre><code>final class TaskDetailPresenter implements TaskDetailContract.Presenter {    private TasksRepository mTasksRepository;//Model    private TaskDetailContract.View mTaskDetailView;//View    /**     * Dagger strictly enforces that arguments not marked with {@code @Nullable} are not injected     * with {@code @Nullable} values.     */    @Nullable String mTaskId;    /**     * Dagger strictly enforces that arguments not marked with {@code @Nullable} are not injected     * with {@code @Nullable} values.     */    @Inject    TaskDetailPresenter(@Nullable String taskId,            TasksRepository tasksRepository,            TaskDetailContract.View taskDetailView) {        mTasksRepository = tasksRepository;        mTaskDetailView = taskDetailView;        mTaskId = taskId;    }    /**     * Method injection is used here to safely reference {@code this} after the object is created.     * For more information, see Java Concurrency in Practice.     */    @Inject    void setupListeners() {        mTaskDetailView.setPresenter(this);    }...Presenterä¸­çš„æ“ä½œ...}</code></pre><p>é™¤äº†Presenterä¸­çš„æ“ä½œï¼Œé€™è£¡ä¸»è¦å°±æ˜¯æœ‰ä¸€å€‹@injectæ¨™è¨»çš„æ–¹æ³•ï¼Œæ§‹é€ å‡½æ•¸ï¼Œé‚„æœ‰å­—æ®µã€‚åˆ°é€™è£¡ä¹Ÿå°±å®Œæˆäº†MVPä¸­Dagger2 çš„ä½¿ç”¨ ã€‚é‚„åœ¨ç­‰ä»€éº¼ï¼Ÿè¶•å¿«å°‡å®ƒç”¨åˆ°ä½ çš„é …ç›®ä¸­å§ï¼</p><hr><h1 class=pgc-h-arrow-right>5 Dagger2æ·»åŠ æ­¥é©Ÿï¼š</h1><p>é€™è£¡å†æ¬¡ç¸½çµä¸€ä¸‹Dagger2æ·»åŠ æ­¥é©Ÿã€‚</p><ul><li>step 1ï¼šæ·»åŠ android-apt, dagger 2, dagger2-compilerä»¥åŠjavax annotationåˆ°build.gradle.(æ³¨æ„ä»–å€‘ä¸éƒ½æ˜¯compileçš„å½¢å¼)</li><li>step 2ï¼šæ·»åŠ æ¨¡å¡Šï¼ˆmoduleï¼‰,ApplicationModuleå°‡æœƒæ³¨å…¥Application Context åˆ°éœ€è¦çš„é¡ä¸­ã€‚</li><li>step 3ï¼šæ·»åŠ çµ„ä»¶Component, Dagger2 å°‡æœƒç‚ºä½ å‰µå»ºçš„æ‰€æœ‰componentç”Ÿæˆä»£ç¢¼ã€‚ä½¿ç”¨æ–‡ä»¶åDaggerï¼ˆComponentï¼‰çš„å½¢å¼ã€‚Componentå¯ä»¥æ“æœ‰å¤šå€‹moduleã€‚ï¼ˆæ¯”å¦‚DaggerTaskDetailComponentæ“æœ‰TaskDetailPresenterModuleæ¨¡å¡Šï¼‰</li><li>step 4: ç¹¼æ‰¿android.app.Applicationé¡ï¼Œä¸¦ä¸”åœ¨AndroidManifest.xmlä¸­è²æ˜ä½¿ç”¨çš„applicationé¡ã€‚åœ¨å®ƒçš„onCreate()æ–¹æ³•ä¸­æ§‹å»ºä¸»è¦çµ„ä»¶ï¼ˆmain componentï¼‰</li></ul><pre><code>       mRepositoryComponent = DaggerTasksRepositoryComponent.builder()                .applicationModule(new ApplicationModule((getApplicationContext())))                .tasksRepositoryModule(new TasksRepositoryModule()).build();</code></pre><ul><li>step 5: æ·»åŠ è¨»å…¥æ–¹æ³•ï¼ˆinjectï¼‰åˆ°Component æ¥å£ä¸­ï¼Œä½ éœ€è¦ç‚ºæ¯ä¸€å€‹åƒèˆ‡åˆ°ä¾è³´æ³¨å…¥çš„é¡æ·»åŠ inject()æ–¹æ³•ã€‚(æ³¨æ„åœ¨dagger2ä¸­ï¼šç‚ºçˆ¶é¡æ³¨å…¥çš„ä¾è³´ä¸¦ä¸æœƒç‚ºå­é¡æ³¨å…¥ä¾è³´é—œä¿‚ï¼Œç‚ºå­é¡æ³¨å…¥çš„ä¾è³´é—œä¿‚å‰‡å¯ä»¥ç‚ºçˆ¶é¡æ³¨å…¥ä¾è³´é—œä¿‚)åƒè€ƒä¸Šé¢çš„TaskDetailPresenteræ–¹æ³•ã€‚</li><li>step 6: æ³¨å…¥ä¾è³´ï¼Œç”¨injectï¼Œæ›¿æ›ä½ æ–°å»ºå°è±¡å¯¦ä¾‹çš„åœ°æ–¹ã€‚æŠŠé€™äº›æ–°å»ºå¯¦ä¾‹çš„åœ°æ–¹ç§»åˆ°Modulesä¸­ä¸¦ä¸”æ·»åŠ @Providesæ¨™è¨»ã€‚å¯ä»¥åƒè€ƒä¸Šé¢çš„ ApplicationModule.java,åœ¨ä½¿ç”¨@Injectï¼Œè«‹ç¢ºä¿èª¿ç”¨Component.inject()æ–¹æ³•ã€‚å¯ä»¥åƒè€ƒä¸Šé¢çš„TaskDetailActivity.</li><li>step 7: (å¯é¸ï¼Œæ¨è–¦)å°‡getApplicationComponent()ç§»åˆ°çˆ¶é¡ä¸­ï¼ˆä¸€èˆ¬æ˜¯æŒ‡BaseActivityï¼‰</li></ul><p>å¯¦è¸å‡ºçœŸçŸ¥ï¼Œé‚„æ˜¯å¸Œæœ›ä½ å¯ä»¥è¦ªæ‰‹å¯«å¯«ï¼Œç„¶å¾Œå†å›éé ­ä¾†çœ‹é€™ç¯‡æ–‡ç« ã€‚</p><p><br>é—œæ³¨å°ç·¨ä¸è¿·è·¯ï¼Œå¾ŒçºŒé‚„æœƒæ›´æ–°æ›´å¤šç²¾å½©å…§å®¹å“¦</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Google</a></li><li><a>MVP</a></li><li><a>Dagger2</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/48af3dac.html alt="Google Docså¯åœ¨æ–‡æœ¬ç·¨è¼¯æ¨¡å¼ä¸‹å¯¦æ™‚çµ±è¨ˆå·²è¼¸å…¥å­—æ•¸äº†" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RbeYEyZD0kyYtf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/48af3dac.html title="Google Docså¯åœ¨æ–‡æœ¬ç·¨è¼¯æ¨¡å¼ä¸‹å¯¦æ™‚çµ±è¨ˆå·²è¼¸å…¥å­—æ•¸äº†">Google Docså¯åœ¨æ–‡æœ¬ç·¨è¼¯æ¨¡å¼ä¸‹å¯¦æ™‚çµ±è¨ˆå·²è¼¸å…¥å­—æ•¸äº†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c208a1c5.html alt="Google Assistantçš„â€œå¿«ç…§â€æ–°å¢ç”Ÿæ—¥æé†’å’Œèœè­œæ¨è–¦ç­‰åŠŸèƒ½" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/S8ukJ4W3GGfnNM style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c208a1c5.html title="Google Assistantçš„â€œå¿«ç…§â€æ–°å¢ç”Ÿæ—¥æé†’å’Œèœè­œæ¨è–¦ç­‰åŠŸèƒ½">Google Assistantçš„â€œå¿«ç…§â€æ–°å¢ç”Ÿæ—¥æé†’å’Œèœè­œæ¨è–¦ç­‰åŠŸèƒ½</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/aae99eac.html alt=â€œåƒé›â€ç©å®¶æ™’å‡ºMVPæˆ°ç¸¾â€œå­¤ç¨æ±‚æ•—â€ï¼ŸæŠ±æ­‰ï¼Œå·²è¢«åé¥‹çµ¦å…‰å­ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f02e4573584a42278fe0d0f655327c26 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/aae99eac.html title=â€œåƒé›â€ç©å®¶æ™’å‡ºMVPæˆ°ç¸¾â€œå­¤ç¨æ±‚æ•—â€ï¼ŸæŠ±æ­‰ï¼Œå·²è¢«åé¥‹çµ¦å…‰å­>â€œåƒé›â€ç©å®¶æ™’å‡ºMVPæˆ°ç¸¾â€œå­¤ç¨æ±‚æ•—â€ï¼ŸæŠ±æ­‰ï¼Œå·²è¢«åé¥‹çµ¦å…‰å­</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b8ab9576.html alt=Googleæ­£åœ¨å°‡Androidæ‰‹æ©Ÿè®Šæˆåœ°éœ‡å„€ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/39fd28d956754ee5832878a2fa038408 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b8ab9576.html title=Googleæ­£åœ¨å°‡Androidæ‰‹æ©Ÿè®Šæˆåœ°éœ‡å„€>Googleæ­£åœ¨å°‡Androidæ‰‹æ©Ÿè®Šæˆåœ°éœ‡å„€</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6272038d.html alt="å¦‚ä½•åœ¨Google Adsä¸­è¨­ç½®çµæ§‹åŒ–ä»£ç¢¼æ®µæ“´å±•" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/140621b1d9d64cac8c095003de160fdf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6272038d.html title="å¦‚ä½•åœ¨Google Adsä¸­è¨­ç½®çµæ§‹åŒ–ä»£ç¢¼æ®µæ“´å±•">å¦‚ä½•åœ¨Google Adsä¸­è¨­ç½®çµæ§‹åŒ–ä»£ç¢¼æ®µæ“´å±•</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/07d6738b.html alt=Googleä»£ç¢¼å¯©æŸ¥è€…æŒ‡å—(äº”)ï¼šå¦‚ä½•æ’°å¯«CRè©•è«– class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/07d6738b.html title=Googleä»£ç¢¼å¯©æŸ¥è€…æŒ‡å—(äº”)ï¼šå¦‚ä½•æ’°å¯«CRè©•è«–>Googleä»£ç¢¼å¯©æŸ¥è€…æŒ‡å—(äº”)ï¼šå¦‚ä½•æ’°å¯«CRè©•è«–</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/690031e4.html alt=Googleä»£ç¢¼å¯©æŸ¥è€…æŒ‡å—(å…­)ï¼šè™•ç†CRæ‹–å»¶ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/690031e4.html title=Googleä»£ç¢¼å¯©æŸ¥è€…æŒ‡å—(å…­)ï¼šè™•ç†CRæ‹–å»¶>Googleä»£ç¢¼å¯©æŸ¥è€…æŒ‡å—(å…­)ï¼šè™•ç†CRæ‹–å»¶</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/04760a1c.html alt=ã€Œä¸–ç•Œç›ƒé»å°‡Â·å­—æ¯å“¥ã€æ–°ç§‘MVPè¦ç•¶çœ¾æ˜Ÿä¹‹é¦– class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/214a89ca7e9d422786ed16e46e77be52 style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/04760a1c.html title=ã€Œä¸–ç•Œç›ƒé»å°‡Â·å­—æ¯å“¥ã€æ–°ç§‘MVPè¦ç•¶çœ¾æ˜Ÿä¹‹é¦–>ã€Œä¸–ç•Œç›ƒé»å°‡Â·å­—æ¯å“¥ã€æ–°ç§‘MVPè¦ç•¶çœ¾æ˜Ÿä¹‹é¦–</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/a6e0fdf4.html alt="å°è©±å°¼åŸºÂ·å¸•ç‘ªï¼šåœ¨Google Brainå·¥ä½œæ˜¯ä¸€ç¨®æ€æ¨£çš„é«”é©—ï¼Ÿ" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3042df995c564a71a2f8397aef525d7a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/a6e0fdf4.html title="å°è©±å°¼åŸºÂ·å¸•ç‘ªï¼šåœ¨Google Brainå·¥ä½œæ˜¯ä¸€ç¨®æ€æ¨£çš„é«”é©—ï¼Ÿ">å°è©±å°¼åŸºÂ·å¸•ç‘ªï¼šåœ¨Google Brainå·¥ä½œæ˜¯ä¸€ç¨®æ€æ¨£çš„é«”é©—ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/93db9060.html alt=ç‰©æµè¯ç›Ÿç‰ˆâ€œç‹è€…æ¦®è€€â€ï¼ŒMVPèŠ±è½èª°å®¶ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15308696479286228322a89 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/93db9060.html title=ç‰©æµè¯ç›Ÿç‰ˆâ€œç‹è€…æ¦®è€€â€ï¼ŒMVPèŠ±è½èª°å®¶ï¼Ÿ>ç‰©æµè¯ç›Ÿç‰ˆâ€œç‹è€…æ¦®è€€â€ï¼ŒMVPèŠ±è½èª°å®¶ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/623dc459.html alt=å¦‚ä½•é€²è¡ŒMVPé©—è­‰ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/93a7820379584b5dbf55387bfd601ca2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/623dc459.html title=å¦‚ä½•é€²è¡ŒMVPé©—è­‰ï¼Ÿ>å¦‚ä½•é€²è¡ŒMVPé©—è­‰ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a7a452fc.html alt=Appå¦‚ä½•æ§‹å»ºå’Œé©—è­‰MVPï¼ˆæœ€å°å¯è¡Œæ€§ç”¢å“ï¼‰ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e395d61ec2ee4c2db11babf4f8430550 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a7a452fc.html title=Appå¦‚ä½•æ§‹å»ºå’Œé©—è­‰MVPï¼ˆæœ€å°å¯è¡Œæ€§ç”¢å“ï¼‰ï¼Ÿ>Appå¦‚ä½•æ§‹å»ºå’Œé©—è­‰MVPï¼ˆæœ€å°å¯è¡Œæ€§ç”¢å“ï¼‰ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6ba74998.html alt=ä½¿ç”¨MVPç­–ç•¥å¿«é€Ÿé©—è­‰æˆ‘å€‘çš„ç”¢å“åœ¨å¸‚å ´æ˜¯å¦æœ‰éœ€æ±‚ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/c56abd6b15074515869402cf45843565 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6ba74998.html title=ä½¿ç”¨MVPç­–ç•¥å¿«é€Ÿé©—è­‰æˆ‘å€‘çš„ç”¢å“åœ¨å¸‚å ´æ˜¯å¦æœ‰éœ€æ±‚>ä½¿ç”¨MVPç­–ç•¥å¿«é€Ÿé©—è­‰æˆ‘å€‘çš„ç”¢å“åœ¨å¸‚å ´æ˜¯å¦æœ‰éœ€æ±‚</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bd2c2742.html alt="Googleæ¨å‡ºæ›´åŠ çœŸå¯¦çš„æ–‡æœ¬åˆ°èªéŸ³æœå‹™ç”±DeepMind AIæä¾›æ”¯æŒ" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bd2c2742.html title="Googleæ¨å‡ºæ›´åŠ çœŸå¯¦çš„æ–‡æœ¬åˆ°èªéŸ³æœå‹™ç”±DeepMind AIæä¾›æ”¯æŒ">Googleæ¨å‡ºæ›´åŠ çœŸå¯¦çš„æ–‡æœ¬åˆ°èªéŸ³æœå‹™ç”±DeepMind AIæä¾›æ”¯æŒ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dce5711.html alt=Googleå”ä½œå¹³è‡ºä¸­å‡ºç¾æƒ¡æ„è»Ÿä»¶ï¼Œç”¨æ–¼ç«Šå–ä»–äººæ•æ„Ÿä¿¡æ¯ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/face24f89f3143b99b382ec72374da6f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dce5711.html title=Googleå”ä½œå¹³è‡ºä¸­å‡ºç¾æƒ¡æ„è»Ÿä»¶ï¼Œç”¨æ–¼ç«Šå–ä»–äººæ•æ„Ÿä¿¡æ¯>Googleå”ä½œå¹³è‡ºä¸­å‡ºç¾æƒ¡æ„è»Ÿä»¶ï¼Œç”¨æ–¼ç«Šå–ä»–äººæ•æ„Ÿä¿¡æ¯</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>