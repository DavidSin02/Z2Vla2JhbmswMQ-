<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ | æå®¢å¿«è¨Š</title><meta property="og:title" content="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/RiGWAV4Aw9MAi3"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5aa9b023.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5aa9b023.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5aa9b023.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5aa9b023.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5aa9b023.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5aa9b023.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5aa9b023.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5aa9b023.html><meta property="article:published_time" content="2020-10-29T21:09:45+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:45+08:00"><meta name=Keywords content><meta name=description content="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/5aa9b023.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><img alt="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/RiGWAV4Aw9MAi3><p>ä½œè€… | æµ·æ˜Ÿ</p><p>ä¾†æº | JavaKeeperï¼ˆIDï¼šJavaKeeperï¼‰</p><p><strong>Keeperå°è®€</strong>ï¼šå‰å¹¾å¤©èµ·èº«å»â€œå¤–é‚Šâ€çœ‹äº†çœ‹ï¼Œé˜¿é‡Œå¥åº·çš„ä¸€å€‹é¢è©¦å®˜ä¸€ç›´åœ¨å•æˆ‘é€™å€‹å•é¡Œï¼Œå›ç­”çš„ä¸€èˆ¬ï¼Œç”¨äº†å…©å¤©æ™‚é–“æ•´ç†ï¼Œå¸Œæœ›å¤§å®¶ä¹Ÿèƒ½çœŸæ­£ç†è§£äº†ã€‚</p><img alt="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RT4Gwk56bt5iOJ><p><strong>å‰è¨€</strong></p><p>å¾ªç’°ä¾è³´å•é¡Œï¼Œç®—æ˜¯ä¸€é“çˆ›å¤§è¡—çš„é¢è©¦é¡Œäº†ï¼Œè§£æ¯’ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆä¾†å›é¡§å…©å€‹çŸ¥è­˜é»ï¼š</p><p>åˆå­¸ Spring çš„æ™‚å€™ï¼Œæˆ‘å€‘å°±çŸ¥é“ IOCï¼Œæ§åˆ¶åè½‰éº¼ï¼Œå®ƒå°‡åŸæœ¬åœ¨ç¨‹åºä¸­æ‰‹å‹•å‰µå»ºå°è±¡çš„æ§åˆ¶æ¬Šï¼Œäº¤ç”± Spring æ¡†æ¶ä¾†ç®¡ç†ï¼Œä¸éœ€è¦æˆ‘å€‘æ‰‹å‹•å»å„ç¨® new XXXã€‚</p><p>å„˜ç®¡æ˜¯ Spring ç®¡ç†ï¼Œä¸ä¹Ÿå¾—å‰µå»ºå°è±¡å—ï¼Œ Java å°è±¡çš„å‰µå»ºæ­¥é©Ÿå¾ˆå¤šï¼Œå¯ä»¥ new XXXã€åºåˆ—åŒ–ã€clone ç­‰ç­‰ï¼Œ åªæ˜¯ Spring æ˜¯é€šéåå°„ + å·¥å» çš„æ–¹å¼å‰µå»ºå°è±¡ä¸¦æ”¾åœ¨å®¹å™¨çš„ï¼Œå‰µå»ºå¥½çš„å°è±¡æˆ‘å€‘ä¸€èˆ¬é‚„æœƒå°å°è±¡å±¬æ€§é€²è¡Œè³¦å€¼ï¼Œæ‰å»ä½¿ç”¨ï¼Œå¯ä»¥ç†è§£æ˜¯åˆ†äº†å…©å€‹æ­¥é©Ÿã€‚</p><p>å¥½äº†ï¼Œå°é€™å…©å€‹æ­¥é©Ÿæœ‰å€‹å°è±¡å°±è¡Œï¼Œæ¥è‘—æˆ‘å€‘é€²å…¥å¾ªç’°ä¾è³´ï¼Œå…ˆèªªä¸‹å¾ªç’°ä¾è³´çš„æ¦‚å¿µã€‚</p><p>æ‰€è¬‚çš„å¾ªç’°ä¾è³´æ˜¯æŒ‡ï¼ŒA ä¾è³´ Bï¼ŒB åˆä¾è³´ Aï¼Œå®ƒå€‘ä¹‹é–“å½¢æˆäº†å¾ªç’°ä¾è³´ã€‚æˆ–è€…æ˜¯ A ä¾è³´ Bï¼ŒB ä¾è³´ Cï¼ŒC åˆä¾è³´ Aï¼Œå½¢æˆäº†å¾ªç’°ä¾è³´ã€‚æ›´æˆ–è€…æ˜¯è‡ªå·±ä¾è³´è‡ªå·±ã€‚å®ƒå€‘ä¹‹é–“çš„ä¾è³´é—œä¿‚å¦‚ä¸‹ï¼š</p><img alt="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/S9o5jNS6sXa4uU><p>é€™è£¡ä»¥å…©å€‹é¡ç›´æ¥ç›¸äº’ä¾è³´ç‚ºä¾‹ï¼Œä»–å€‘çš„å¯¦ç¾ä»£ç¢¼å¯èƒ½å¦‚ä¸‹ï¼š</p><pre><div><pre><p>public class BeanB {</p><p>private BeanA beanA;</p><p>public void <strong class=highlight-text toutiao-origin=span>setBeanA</strong>(BeanA beanA) {</p><p>this.beanA = beanA;</p><p>}</p><p>}</p><p>public class BeanA {</p><p>private BeanB beanB;</p><p>public void <strong class=highlight-text toutiao-origin=span>setBeanB</strong>(BeanB beanB) {</p><p>this.beanB = beanB;</p><p>}</p><p>}</p></pre></div></pre><p>é…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼ˆç”¨è¨»è§£æ–¹å¼æ³¨å…¥åŒç†ï¼Œåªæ˜¯ç‚ºäº†æ–¹ä¾¿ç†è§£ï¼Œç”¨äº†é…ç½®æ–‡ä»¶ï¼‰ï¼š</p><pre><div><pre><p>&lt;bean id="beanA" class="priv.starfish.BeanA"&gt;</p><p>&lt;property name="beanB" ref="beanB"/&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean id="beanB" class="priv.starfish.BeanB"&gt;</p><p>&lt;property name="beanA" ref="beanA"/&gt;</p><p>&lt;/bean&gt;</p></pre></div></pre><p>Spring å•Ÿå‹•å¾Œï¼Œè®€å–å¦‚ä¸Šçš„é…ç½®æ–‡ä»¶ï¼ŒæœƒæŒ‰é †åºå…ˆå¯¦ä¾‹åŒ– Aï¼Œä½†æ˜¯å‰µå»ºçš„æ™‚å€™åˆç™¼ç¾å®ƒä¾è³´äº† Bï¼Œæ¥è‘—å°±å»å¯¦ä¾‹åŒ– B ï¼ŒåŒæ¨£åˆç™¼ç¾å®ƒä¾è³´äº† A ï¼Œé€™å°¼ç‘ªå’‹æ•´ï¼Ÿç„¡é™å¾ªç’°å‘€ã€‚</p><p>Spring â€œè‚¯å®šâ€ä¸æœƒè®“é€™ç¨®äº‹æƒ…ç™¼ç”Ÿçš„ï¼Œå¦‚å‰è¨€æˆ‘å€‘èªªçš„ Spring å¯¦ä¾‹åŒ–å°è±¡åˆ†å…©æ­¥ï¼Œç¬¬ä¸€æ­¥æœƒå…ˆå‰µå»ºä¸€å€‹åŸå§‹å°è±¡ï¼Œåªæ˜¯æ²’æœ‰è¨­ç½®å±¬æ€§ï¼Œå¯ä»¥ç†è§£ç‚º"åŠæˆå“"â€”â€” å®˜æ–¹å« A å°è±¡çš„æ—©æœŸå¼•ç”¨ï¼ˆEarlyBeanReferenceï¼‰ï¼Œæ‰€ä»¥ç•¶å¯¦ä¾‹åŒ– B çš„æ™‚å€™ç™¼ç¾ä¾è³´äº† Aï¼Œ B å°±æœƒæŠŠé€™å€‹â€œåŠæˆå“â€è¨­ç½®é€²å»å…ˆå®Œæˆå¯¦ä¾‹åŒ–ï¼Œæ—¢ç„¶ B å®Œæˆäº†å¯¦ä¾‹åŒ–ï¼Œæ‰€ä»¥ A å°±å¯ä»¥ç²å¾— B çš„å¼•ç”¨ï¼Œä¹Ÿå®Œæˆå¯¦ä¾‹åŒ–äº†ï¼Œé€™å…¶å¯¦å°±æ˜¯ Spring è§£æ±ºå¾ªç’°ä¾è³´çš„æ€æƒ³ã€‚</p><p>ä¸ç†è§£æ²’é—œä¿‚ï¼Œå…ˆæœ‰å€‹å¤§æ¦‚çš„å°è±¡ï¼Œç„¶å¾Œæˆ‘å€‘å¾æºç¢¼ä¾†çœ‹ä¸‹ Spring å…·é«”æ˜¯æ€éº¼è§£æ±ºçš„ã€‚</p><img alt="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RT7S2kzFTfre26><p></p><h1 toutiao-origin=h2>æºç¢¼è§£æ¯’</h1><blockquote><p>ä»£ç¢¼ç‰ˆæœ¬ï¼š5.0.16.RELEASE</p></blockquote><p>åœ¨ Spring IOC å®¹å™¨è®€å– Bean é…ç½®å‰µå»º Bean å¯¦ä¾‹ä¹‹å‰, å¿…é ˆå°å®ƒé€²è¡Œå¯¦ä¾‹åŒ–ã€‚åªæœ‰åœ¨å®¹å™¨å¯¦ä¾‹åŒ–å¾Œï¼Œæ‰å¯ä»¥å¾ IOC å®¹å™¨è£¡ç²å– Bean å¯¦ä¾‹ä¸¦ç”¨ï¼Œå¾ªç’°ä¾è³´å•é¡Œä¹Ÿå°±æ˜¯ç™¼ç”Ÿåœ¨å¯¦ä¾‹åŒ– Bean çš„éç¨‹ä¸­çš„ï¼Œæ‰€ä»¥æˆ‘å€‘å…ˆå›é¡§ä¸‹ç²å– Bean çš„éç¨‹ã€‚</p><p></p><h2 toutiao-origin=h3><strong>ç²å– Bean æµç¨‹</strong></h2><p>Spring IOC å®¹å™¨ä¸­ç²å– bean å¯¦ä¾‹çš„ç°¡åŒ–ç‰ˆæµç¨‹å¦‚ä¸‹ï¼ˆæ’é™¤äº†å„ç¨®åŒ…è£å’Œæª¢æŸ¥çš„éç¨‹ï¼‰</p><img alt="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/S9o5jNsDOKJHqz><p>å¤§æ¦‚çš„æµç¨‹é †åºï¼ˆå¯ä»¥çµåˆè‘—æºç¢¼çœ‹ä¸‹ï¼Œæˆ‘å°±ä¸è²¼äº†ï¼‰ï¼š</p><ol><li><p>æµç¨‹å¾ getBean æ–¹æ³•é–‹å§‹ï¼ŒgetBean æ˜¯å€‹ç©ºæ®¼æ–¹æ³•ï¼Œæ‰€æœ‰é‚è¼¯ç›´æ¥åˆ° doGetBean æ–¹æ³•ä¸­ã€‚</p></li><li><p>transformedBeanName å°‡ name è½‰æ›ç‚ºçœŸæ­£çš„ beanNameï¼ˆname å¯èƒ½æ˜¯ FactoryBean ä»¥ & å­—ç¬¦é–‹é ­æˆ–è€…æœ‰åˆ¥åçš„æƒ…æ³ï¼Œæ‰€ä»¥éœ€è¦è½‰åŒ–ä¸‹ï¼‰ã€‚</p></li><li><p>ç„¶å¾Œé€šé getSingleton(beanName) æ–¹æ³•å˜—è©¦å¾ç·©å­˜ä¸­æŸ¥æ‰¾æ˜¯ä¸æ˜¯æœ‰è©²å¯¦ä¾‹ sharedInstanceï¼ˆå–®ä¾‹åœ¨ Spring çš„åŒä¸€å®¹å™¨åªæœƒè¢«å‰µå»ºä¸€æ¬¡ï¼Œå¾ŒçºŒå†ç²å– beanï¼Œå°±ç›´æ¥å¾ç·©å­˜ç²å–å³å¯ï¼‰ã€‚</p></li><li><p>å¦‚æœæœ‰çš„è©±ï¼ŒsharedInstance å¯èƒ½æ˜¯å®Œå…¨å¯¦ä¾‹åŒ–å¥½çš„ beanï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€å€‹åŸå§‹çš„ beanï¼Œæ‰€ä»¥å†ç¶“ getObjectForBeanInstance è™•ç†å³å¯è¿”å›ã€‚</p></li><li><p>ç•¶ç„¶ sharedInstance ä¹Ÿå¯èƒ½æ˜¯ ï¼Œé€™æ™‚å€™å°±æœƒåŸ·è¡Œå‰µå»º bean çš„é‚è¼¯ï¼Œå°‡çµæœè¿”å›ã€‚</p></li></ol><p>ç¬¬ä¸‰æ­¥çš„æ™‚å€™æˆ‘å€‘æåˆ°äº†ä¸€å€‹ç·©å­˜çš„æ¦‚å¿µï¼Œé€™å€‹å°±æ˜¯ Spring ç‚ºäº†è§£æ±ºå–®ä¾‹çš„å¾ªç’°ä¾è³´å•é¡Œè€Œè¨­è¨ˆçš„ä¸‰ç´šç·©å­˜ï¼š</p><pre><div><pre><p>/** Cache of singleton objects: bean name --&gt; bean instance */</p><p>private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;&gt;(256);</p><p>/** Cache of singleton factories: bean name --&gt; ObjectFactory */</p><p>private final Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = new HashMap&lt;&gt;(16);</p><p>/** Cache of early singleton objects: bean name --&gt; bean instance */</p><p>private final Map&lt;String, Object&gt; earlySingletonObjects = new HashMap&lt;&gt;(16);</p></pre></div></pre><p>é€™ä¸‰ç´šç·©å­˜çš„ä½œç”¨åˆ†åˆ¥æ˜¯ï¼š</p><ul><li><p>singletonObjectsï¼šå®Œæˆåˆå§‹åŒ–çš„å–®ä¾‹å°è±¡çš„ cacheï¼Œé€™è£¡çš„ bean ç¶“æ­·é å¯¦ä¾‹åŒ–->å±¬æ€§å¡«å……->åˆå§‹åŒ– ä»¥åŠå„ç¨®å¾Œç½®è™•ç†ï¼ˆä¸€ç´šç·©å­˜ï¼‰ã€‚</p></li><li><p>earlySingletonObjectsï¼šå­˜æ”¾åŸå§‹çš„ bean å°è±¡ï¼ˆå®Œæˆå¯¦ä¾‹åŒ–ä½†æ˜¯å°šæœªå¡«å……å±¬æ€§å’Œåˆå§‹åŒ–ï¼‰ï¼Œåƒ…åƒ…èƒ½ä½œç‚ºæŒ‡é‡æå‰æ›å…‰ï¼Œè¢«å…¶ä»– bean æ‰€å¼•ç”¨ï¼Œç”¨æ–¼è§£æ±ºå¾ªç’°ä¾è³´çš„ ï¼ˆäºŒç´šç·©å­˜ï¼‰ã€‚</p></li><li><p>singletonFactoriesï¼šåœ¨ bean å¯¦ä¾‹åŒ–å®Œä¹‹å¾Œï¼Œå±¬æ€§å¡«å……ä»¥åŠåˆå§‹åŒ–ä¹‹å‰ï¼Œå¦‚æœå…è¨±æå‰æ›å…‰ï¼ŒSpring æœƒå°‡å¯¦ä¾‹åŒ–å¾Œçš„ bean æå‰æ›å…‰ï¼Œä¹Ÿå°±æ˜¯æŠŠè©² bean è½‰æ›æˆ beanFactory ä¸¦åŠ å…¥åˆ° singletonFactoriesï¼ˆä¸‰ç´šç·©å­˜ï¼‰ã€‚</p></li></ul><p>æˆ‘å€‘é¦–å…ˆå¾ç·©å­˜ä¸­è©¦è‘—ç²å– beanï¼Œå°±æ˜¯å¾é€™ä¸‰ç´šç·©å­˜ä¸­æŸ¥æ‰¾ï¼š</p><pre><div><pre><p>protected Object getSingleton(String beanName, boolean allowEarlyReference) {</p><p>// å¾ singletonObjects ç²å–å¯¦ä¾‹ï¼ŒsingletonObjects ä¸­çš„å¯¦ä¾‹éƒ½æ˜¯æº–å‚™å¥½çš„ bean å¯¦ä¾‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨</p><p>Object singletonObject = this.singletonObjects.get(beanName);</p><p>//isSingletonCurrentlyInCreation åˆ¤æ–·ç•¶å‰å–®ä¾‹beanæ˜¯å¦æ­£åœ¨å‰µå»ºä¸­</p><p>if (singletonObject ==  &amp;&amp; isSingletonCurrentlyInCreation(beanName)) {</p><p>synchronized (this.singletonObjects) {</p><p>// ä¸€ç´šç·©å­˜æ²’æœ‰ï¼Œå°±å»äºŒç´šç·©å­˜æ‰¾</p><p>singletonObject = this.earlySingletonObjects.get(beanName);</p><p>if (singletonObject ==  &amp;&amp; allowEarlyReference) {</p><p>// äºŒç´šç·©å­˜ä¹Ÿæ²’æœ‰ï¼Œå°±å»ä¸‰ç´šç·©å­˜æ‰¾</p><p>ObjectFactory&lt;?&gt; singletonFactory = this.singletonFactories.get(beanName);</p><p>if (singletonFactory != ) {</p><p>// ä¸‰ç´šç·©å­˜æœ‰çš„è©±ï¼Œå°±æŠŠä»–ç§»å‹•åˆ°äºŒç´šç·©å­˜,.getObject å¾ŒçºŒæœƒè¬›åˆ°</p><p>singletonObject = singletonFactory.getObject;</p><p>this.earlySingletonObjects.put(beanName, singletonObject);</p><p>this.singletonFactories.remove(beanName);</p><p>}</p><p>}</p><p>}</p><p>}</p><p>return singletonObject;</p><p>}</p></pre></div></pre><p>å¦‚æœç·©å­˜æ²’æœ‰çš„è©±ï¼Œæˆ‘å€‘å°±è¦å‰µå»ºäº†ï¼Œæ¥è‘—æˆ‘å€‘ä»¥å–®ä¾‹å°è±¡ç‚ºä¾‹ï¼Œå†çœ‹ä¸‹å‰µå»º bean çš„é‚è¼¯ï¼ˆå¤§æ‹¬è™Ÿè¡¨ç¤ºå…§éƒ¨é¡èª¿ç”¨æ–¹æ³•ï¼‰ï¼š</p><img alt="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/S9o5jOVA7vGz4K><p>1ã€å‰µå»º bean å¾ä»¥ä¸‹ä»£ç¢¼é–‹å§‹ï¼Œä¸€å€‹åŒ¿åå…§éƒ¨é¡æ–¹æ³•åƒæ•¸ï¼ˆç¸½è¦ºå¾— Lambda çš„æ–¹å¼å¯è®€æ€§ä¸å¦‚å…§éƒ¨é¡å¥½ç†è§£ï¼‰ã€‚</p><pre><div><pre><p>if (mbd.isSingleton) {</p><p>sharedInstance = getSingleton(beanName,  -&gt; {</p><p>try {</p><p>return createBean(beanName, mbd, args);</p><p>}</p><p>catch (BeansException ex) {</p><p>destroySingleton(beanName);</p><p>throw ex;</p><p>}</p><p>});</p><p>bean = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);</p><p>}</p></pre></div></pre><p>getSingleton æ–¹æ³•å…§éƒ¨ä¸»è¦æœ‰å…©å€‹æ–¹æ³•ï¼š</p><pre><div><pre><p>public Object getSingleton(String beanName, ObjectFactory&lt;?&gt; singletonFactory) {</p><p>// å‰µå»º singletonObject</p><p>singletonObject = singletonFactory.getObject;</p><p>// å°‡ singletonObject æ”¾å…¥ç·©å­˜</p><p>addSingleton(beanName, singletonObject);</p><p>}</p></pre></div></pre><p>2ã€getObject åŒ¿åå…§éƒ¨é¡çš„å¯¦ç¾çœŸæ­£èª¿ç”¨çš„åˆæ˜¯ createBean(beanName, mbd, args)ã€‚</p><p>3ã€å¾€è£¡èµ°ï¼Œä¸»è¦çš„å¯¦ç¾é‚è¼¯åœ¨ doCreateBeanæ–¹æ³•ï¼Œå…ˆé€šé createBeanInstance å‰µå»ºä¸€å€‹åŸå§‹ bean å°è±¡ã€‚</p><p>4ã€æ¥è‘— addSingletonFactory æ·»åŠ  bean å·¥å» å°è±¡åˆ° singletonFactories ç·©å­˜ï¼ˆä¸‰ç´šç·©å­˜ï¼‰ã€‚</p><p>5ã€é€šé populateBean æ–¹æ³•å‘åŸå§‹ bean å°è±¡ä¸­å¡«å……å±¬æ€§ï¼Œä¸¦è§£æä¾è³´ï¼Œå‡è¨­é€™æ™‚å€™å‰µå»º A ä¹‹å¾Œå¡«å……å±¬æ€§æ™‚ç™¼ç¾ä¾è³´ Bï¼Œç„¶å¾Œå‰µå»ºä¾è³´å°è±¡ B çš„æ™‚å€™åˆç™¼ç¾ä¾è³´ Aï¼Œé‚„æ˜¯åŒæ¨£çš„æµç¨‹ï¼Œåˆå» getBean(A)ï¼Œé€™å€‹æ™‚å€™ä¸‰ç´šç·©å­˜å·²ç¶“æœ‰äº† beanA çš„â€œåŠæˆå“â€ï¼Œé€™æ™‚å°±å¯ä»¥æŠŠ A å°è±¡çš„åŸå§‹å¼•ç”¨æ³¨å…¥ B å°è±¡ï¼ˆä¸¦å°‡å…¶ç§»å‹•åˆ°äºŒç´šç·©å­˜ï¼‰ä¾†è§£æ±ºå¾ªç’°ä¾è³´å•é¡Œã€‚é€™æ™‚å€™ getObject æ–¹æ³•å°±ç®—åŸ·è¡ŒçµæŸäº†ï¼Œè¿”å›å®Œå…¨å¯¦ä¾‹åŒ–çš„ beanã€‚</p><p>6ã€æœ€å¾Œèª¿ç”¨ addSingleton æŠŠå®Œå…¨å¯¦ä¾‹åŒ–å¥½çš„ bean å°è±¡æ”¾å…¥ singletonObjects ç·©å­˜ï¼ˆä¸€ç´šç·©å­˜ï¼‰ä¸­ï¼Œæ‰“å®Œæ”¶å·¥ã€‚</p><p></p><h2 toutiao-origin=h3><strong>Spring è§£æ±ºå¾ªç’°ä¾è³´</strong></h2><p>å»ºè­°æ­é…è‘—â€œæºç¢¼â€çœ‹ä¸‹é‚Šçš„é‚è¼¯åœ–ï¼Œæ›´å¥½ä¸‹é£¯ã€‚</p><img alt="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/S9o5jPO8NyCje3><p>æµç¨‹å…¶å¯¦ä¸Šé‚Šéƒ½å·²ç¶“èªªéäº†ï¼Œçµåˆè‘—ä¸Šåœ–æˆ‘å€‘å†çœ‹ä¸‹å…·é«”ç´°ç¯€ï¼Œç”¨å¤§ç™½è©±å†æ‹ä¸€æ‹ï¼š</p><ol><li><p>Spring å‰µå»º bean ä¸»è¦åˆ†ç‚ºå…©å€‹æ­¥é©Ÿï¼Œå‰µå»ºåŸå§‹ bean å°è±¡ï¼Œæ¥è‘—å»å¡«å……å°è±¡å±¬æ€§å’Œåˆå§‹åŒ–ã€‚</p></li><li><p>æ¯æ¬¡å‰µå»º bean ä¹‹å‰ï¼Œæˆ‘å€‘éƒ½æœƒå¾ç·©å­˜ä¸­æŸ¥ä¸‹æœ‰æ²’æœ‰è©² beanï¼Œå› ç‚ºæ˜¯å–®ä¾‹ï¼Œåªèƒ½æœ‰ä¸€å€‹ã€‚</p></li><li><p>ç•¶æˆ‘å€‘å‰µå»º beanA çš„åŸå§‹å°è±¡å¾Œï¼Œä¸¦æŠŠå®ƒæ”¾åˆ°ä¸‰ç´šç·©å­˜ä¸­ï¼Œæ¥ä¸‹ä¾†å°±è©²å¡«å……å°è±¡å±¬æ€§äº†ï¼Œé€™æ™‚å€™ç™¼ç¾ä¾è³´äº† beanBï¼Œæ¥è‘—å°±åˆå»å‰µå»º beanBï¼ŒåŒæ¨£çš„æµç¨‹ï¼Œå‰µå»ºå®Œ beanB å¡«å……å±¬æ€§æ™‚åˆç™¼ç¾å®ƒä¾è³´äº† beanAï¼Œåˆæ˜¯åŒæ¨£çš„æµç¨‹ï¼Œä¸åŒçš„æ˜¯ï¼Œé€™æ™‚å€™å¯ä»¥åœ¨ä¸‰ç´šç·©å­˜ä¸­æŸ¥åˆ°å‰›æ”¾é€²å»çš„åŸå§‹å°è±¡ beanAï¼Œæ‰€ä»¥ä¸éœ€è¦ç¹¼çºŒå‰µå»ºï¼Œç”¨å®ƒæ³¨å…¥ beanBï¼Œå®Œæˆ beanB çš„å‰µå»ºã€‚</p></li><li><p>æ—¢ç„¶ beanB å‰µå»ºå¥½äº†ï¼Œæ‰€ä»¥ beanA å°±å¯ä»¥å®Œæˆå¡«å……å±¬æ€§çš„æ­¥é©Ÿäº†ï¼Œæ¥è‘—åŸ·è¡Œå‰©ä¸‹çš„é‚è¼¯ï¼Œé–‰ç’°å®Œæˆã€‚</p></li></ol><p>é€™å°±æ˜¯å–®ä¾‹æ¨¡å¼ä¸‹ Spring è§£æ±ºå¾ªç’°ä¾è³´çš„æµç¨‹äº†ã€‚</p><p>ä½†æ˜¯é€™å€‹åœ°æ–¹ï¼Œä¸ç®¡æ˜¯èª°çœ‹æºç¢¼éƒ½æœƒæœ‰å€‹å°ç–‘æƒ‘ï¼Œç‚ºä»€éº¼éœ€è¦ä¸‰ç´šç·©å­˜å‘¢ï¼Œæˆ‘è¶•è…³äºŒç´šä»–ä¹Ÿå¤ äº†å‘€ï¼Ÿ</p><p>é©å‘½å°šæœªæˆåŠŸï¼ŒåŒå¿—ä»éœ€åŠªåŠ›ï¼</p><p>è·Ÿæºç¢¼çš„æ™‚å€™ï¼Œç™¼ç¾åœ¨å‰µå»º beanB éœ€è¦å¼•ç”¨ beanA é€™å€‹â€œåŠæˆå“â€çš„æ™‚å€™ï¼Œå°±æœƒè§¸ç™¼"å‰æœŸå¼•ç”¨"ï¼Œå³å¦‚ä¸‹ä»£ç¢¼ï¼š</p><pre><div><pre><p>ObjectFactory&lt;?&gt; singletonFactory = this.singletonFactories.get(beanName);</p><p>if (singletonFactory != ) {</p><p>// ä¸‰ç´šç·©å­˜æœ‰çš„è©±ï¼Œå°±æŠŠä»–ç§»å‹•åˆ°äºŒç´šç·©å­˜</p><p>singletonObject = singletonFactory.getObject;</p><p>this.earlySingletonObjects.put(beanName, singletonObject);</p><p>this.singletonFactories.remove(beanName);</p><p>}</p></pre></div></pre><p>singletonFactory.getObject æ˜¯ä¸€å€‹æ¥å£æ–¹æ³•ï¼Œé€™è£¡å…·é«”çš„å¯¦ç¾æ–¹æ³•åœ¨ï¼š</p><pre><div><pre><p>protected Object getEarlyBeanReference(String beanName, RootBeanDefinition mbd, Object bean) {</p><p>Object exposedObject = bean;</p><p>if (!mbd.isSynthetic &amp;&amp; hasInstantiationAwareBeanPostProcessors) {</p><p>for (BeanPostProcessor bp : getBeanPostProcessors) {</p><p>if (bp instanceof SmartInstantiationAwareBeanPostProcessor) {</p><p>SmartInstantiationAwareBeanPostProcessor ibp = (SmartInstantiationAwareBeanPostProcessor) bp;</p><p>// é€™éº¼ä¸€å¤§æ®µå°±é€™å¥è©±æ˜¯æ ¸å¿ƒï¼Œä¹Ÿå°±æ˜¯ç•¶beanè¦é€²è¡Œæå‰æ›å…‰æ™‚ï¼Œ</p><p>// çµ¦ä¸€å€‹æ©Ÿæœƒï¼Œé€šéé‡å¯«å¾Œç½®è™•ç†å™¨çš„getEarlyBeanReferenceæ–¹æ³•ï¼Œä¾†è‡ªå®šç¾©æ“ä½œbean</p><p>// å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæå‰æ›å…‰äº†ï¼Œä½†æ˜¯æ²’æœ‰è¢«æå‰å¼•ç”¨ï¼Œå‰‡è©²å¾Œç½®è™•ç†å™¨ä¸¦ä¸ç”Ÿæ•ˆ!!!</p><p>// é€™ä¹Ÿæ­£å¼ä¸‰ç´šç·©å­˜å­˜åœ¨çš„æ„ç¾©ï¼Œå¦å‰‡äºŒç´šç·©å­˜å°±å¯ä»¥è§£æ±ºå¾ªç’°ä¾è³´çš„å•é¡Œ</p><p>exposedObject = ibp.getEarlyBeanReference(exposedObject, beanName);</p><p>}</p><p>}</p><p>}</p><p>return exposedObject;</p><p>}</p></pre></div></pre><p>é€™å€‹æ–¹æ³•å°±æ˜¯ Spring ç‚ºä»€éº¼ä½¿ç”¨ä¸‰ç´šç·©å­˜ï¼Œè€Œä¸æ˜¯äºŒç´šç·©å­˜çš„åŸå› ï¼Œå®ƒçš„ç›®çš„æ˜¯ç‚ºäº†å¾Œç½®è™•ç†ï¼Œå¦‚æœæ²’æœ‰ AOP å¾Œç½®è™•ç†ï¼Œå°±ä¸æœƒèµ°é€² if èªå¥ï¼Œç›´æ¥è¿”å›äº† exposedObject ï¼Œç›¸ç•¶æ–¼å•¥éƒ½æ²’å¹¹ï¼ŒäºŒç´šç·©å­˜å°±å¤ ç”¨äº†ã€‚</p><p>æ‰€ä»¥åˆå¾—å‡ºçµè«–ï¼Œé€™å€‹ä¸‰ç´šç·©å­˜æ‡‰è©²å’Œ AOP æœ‰é—œä¿‚ï¼Œç¹¼çºŒã€‚</p><p>åœ¨ Spring çš„æºç¢¼ä¸­getEarlyBeanReference æ˜¯ SmartInstantiationAwareBeanPostProcessor æ¥å£çš„é»˜èªæ–¹æ³•ï¼ŒçœŸæ­£å¯¦ç¾é€™å€‹æ–¹æ³•çš„åªæœ‰**AbstractAutoProxyCreator** é€™å€‹é¡ï¼Œç”¨æ–¼æå‰æ›å…‰çš„ AOP ä»£ç†ã€‚</p><pre><div><pre><p>@Override</p><p>public Object getEarlyBeanReference(Object bean, String beanName) throws BeansException {</p><p>Object cacheKey = getCacheKey(bean.getClass, beanName);</p><p>this.earlyProxyReferences.put(cacheKey, bean);</p><p>// å°beané€²è¡Œæå‰Spring AOPä»£ç†</p><p>return wrapIfNecessary(bean, beanName, cacheKey);</p><p>}</p></pre></div></pre><p>é€™éº¼èªªæœ‰é»å¹¹ï¼Œä¾†å€‹å° demo å§ï¼Œæˆ‘å€‘éƒ½çŸ¥é“ Spring AOPã€äº‹å‹™ç­‰éƒ½æ˜¯é€šéä»£ç†å°è±¡ä¾†å¯¦ç¾çš„ï¼Œè€Œäº‹å‹™çš„ä»£ç†å°è±¡æ˜¯ç”±è‡ªå‹•ä»£ç†å‰µå»ºå™¨ä¾†è‡ªå‹•å®Œæˆçš„ã€‚ä¹Ÿå°±æ˜¯èªª Spring æœ€çµ‚çµ¦æˆ‘å€‘æ”¾é€²å®¹å™¨è£¡é¢çš„æ˜¯ä¸€å€‹ä»£ç†å°è±¡ï¼Œè€ŒéåŸå§‹å°è±¡ï¼Œå‡è¨­æˆ‘å€‘æœ‰å¦‚ä¸‹ä¸€æ®µæ¥­å‹™ä»£ç¢¼ï¼š</p><pre><div><pre><p>@Service</p><p>public class HelloServiceImpl implements HelloService {</p><p>@Autowired</p><p>private HelloService helloService;</p><p>@Override</p><p>@Transactional</p><p>public Object hello {</p><p>return "Hello JavaKeeper";</p><p>}</p><p>}</p></pre></div></pre><p>æ­¤ Service é¡ä½¿ç”¨åˆ°äº†äº‹å‹™ï¼Œæ‰€ä»¥æœ€çµ‚æœƒç”Ÿæˆä¸€å€‹ JDK å‹•æ…‹ä»£ç†å°è±¡ Proxyã€‚å‰›å¥½å®ƒåˆå­˜åœ¨è‡ªå·±å¼•ç”¨è‡ªå·±çš„å¾ªç’°ä¾è³´ï¼Œå®Œç¾ç¬¦åˆæˆ‘å€‘çš„å ´æ™¯éœ€æ±‚ã€‚</p><p>æˆ‘å€‘å†è‡ªå®šç¾©ä¸€å€‹å¾Œç½®è™•ç†ï¼Œä¾†çœ‹ä¸‹æ•ˆæœï¼š</p><pre><div><pre><p>@Component</p><p>public class HelloProcessor implements SmartInstantiationAwareBeanPostProcessor {</p><p>@Override</p><p>public Object getEarlyBeanReference(Object bean, String beanName) throws BeansException {</p><p>System.out.println("æå‰æ›å…‰äº†ï¼š"+beanName);</p><p>return bean;</p><p>}</p><p>}</p></pre></div></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œèª¿ç”¨æ–¹æ³•æ£§ä¸­æœ‰æˆ‘å€‘è‡ªå·±å¯¦ç¾çš„ HelloProcessorï¼Œèªªæ˜é€™å€‹ bean æœƒé€šé AOP ä»£ç†è™•ç†ã€‚</p><img alt="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/S9o5nd9DDx4KUe><p>å†å¾æºç¢¼çœ‹ä¸‹é€™å€‹è‡ªå·±å¾ªç’°è‡ªå·±çš„ bean çš„å‰µå»ºæµç¨‹ï¼š</p><pre><div><pre><p>protected Object doCreateBean( ... ){</p><p>...</p><p>boolean earlySingletonExposure = (mbd.isSingleton &amp;&amp; this.allowCircularReferences &amp;&amp; isSingletonCurrentlyInCreation(beanName));</p><p>// éœ€è¦æå‰æš´éœ²ï¼ˆæ”¯æŒå¾ªç’°ä¾è³´ï¼‰ï¼Œå°±è¨»å†Šä¸€å€‹ObjectFactoryåˆ°ä¸‰ç´šç·©å­˜</p><p>if (earlySingletonExposure) { </p><p>// æ·»åŠ  bean å·¥å» å°è±¡åˆ° singletonFactories ç·©å­˜ä¸­ï¼Œä¸¦ç²å–åŸå§‹å°è±¡çš„æ—©æœŸå¼•ç”¨</p><p>//åŒ¿åå…§éƒ¨æ–¹æ³• getEarlyBeanReference å°±æ˜¯å¾Œç½®è™•ç†å™¨ </p><p>// SmartInstantiationAwareBeanPostProcessor çš„ä¸€å€‹æ–¹æ³•ï¼Œ</p><p>// å®ƒçš„åŠŸæ•ˆç‚ºï¼šä¿è­‰è‡ªå·±è¢«å¾ªç’°ä¾è³´çš„æ™‚å€™ï¼Œå³ä½¿è¢«åˆ¥çš„Bean @Autowireé€²å»çš„ä¹Ÿæ˜¯ä»£ç†å°è±¡</p><p>addSingletonFactory(beanName,  -&gt; getEarlyBeanReference(beanName, mbd, bean));</p><p>}</p><p>// æ­¤è™•æ³¨æ„ï¼šå¦‚æœæ­¤è™•è‡ªå·±è¢«å¾ªç’°ä¾è³´äº† é‚£å®ƒæœƒèµ°ä¸Šé¢çš„getEarlyBeanReferenceï¼Œå¾è€Œå‰µå»ºä¸€å€‹ä»£ç†å°è±¡å¾ ä¸‰ç´šç·©å­˜è½‰ç§»åˆ°äºŒç´šç·©å­˜è£¡</p><p>// æ³¨æ„æ­¤æ™‚å€™å°è±¡é‚„åœ¨äºŒç´šç·©å­˜è£¡ï¼Œä¸¦æ²’æœ‰åœ¨ä¸€ç´šç·©å­˜ã€‚ä¸¦ä¸”æ­¤æ™‚å¾ŒçºŒçš„é€™å…©æ­¥æ“ä½œé‚„æ˜¯ç”¨çš„ exposedObjectï¼Œå®ƒä»èˆŠæ˜¯åŸå§‹å°è±¡~~~</p><p>populateBean(beanName, mbd, instanceWrapper);</p><p>exposedObject = initializeBean(beanName, exposedObject, mbd);</p><p>// å› ç‚ºäº‹å‹™çš„AOPè‡ªå‹•ä»£ç†å‰µå»ºå™¨åœ¨getEarlyBeanReference å‰µå»ºä»£ç†å¾Œï¼ŒinitializeBean å°±ä¸æœƒå†é‡è¤‡å‰µå»ºäº†ï¼ŒäºŒé¸ä¸€çš„ï¼‰</p><p>// æ‰€ä»¥ç¶“éé€™å…©å¤§æ­¥å¾Œï¼ŒexposedObject é‚„æ˜¯åŸå§‹å°è±¡ï¼Œé€šé getEarlyBeanReference å‰µå»ºçš„ä»£ç†å°è±¡é‚„åœ¨ä¸‰ç´šç·©å­˜å‘¢</p><p>...</p><p>// å¾ªç’°ä¾è³´æ ¡é©—</p><p>if (earlySingletonExposure) {</p><p>// æ³¨æ„æ­¤è™•ç¬¬äºŒå€‹åƒæ•¸å‚³çš„falseï¼Œè¡¨ç¤ºä¸å»ä¸‰ç´šç·©å­˜è£¡å†å»èª¿ç”¨ä¸€æ¬¡getObjectæ–¹æ³•äº†~~~ï¼Œæ­¤æ™‚ä»£ç†å°è±¡é‚„åœ¨äºŒç´šç·©å­˜ï¼Œæ‰€ä»¥é€™è£¡æ‹¿å‡ºä¾†çš„å°±æ˜¯å€‹ ä»£ç†å°è±¡</p><p>// æœ€å¾Œè³¦å€¼çµ¦exposedObject ç„¶å¾Œreturnå‡ºå»ï¼Œé€²è€Œæœ€çµ‚è¢«addSingletonæ·»åŠ é€²ä¸€ç´šç·©å­˜è£¡é¢å» </p><p>// é€™æ¨£å°±ä¿è­‰äº†æˆ‘å€‘å®¹å™¨è£¡ æœ€çµ‚å¯¦éš›ä¸Šæ˜¯ä»£ç†å°è±¡ï¼Œè€ŒéåŸå§‹å°è±¡~~~~~</p><p>Object earlySingletonReference = getSingleton(beanName, false);</p><p>if (earlySingletonReference != ) {</p><p>if (exposedObject == bean) { </p><p>exposedObject = earlySingletonReference;</p><p>}</p><p>}</p><p>...</p><p>}</p><p>}</p></pre></div></pre><p></p><h2 toutiao-origin=h4>è‡ªæˆ‘è§£æƒ‘ï¼š</h2><p>å•ï¼šé‚„æ˜¯ä¸å¤ªæ‡‚ï¼Œç‚ºä»€éº¼é€™éº¼è¨­è¨ˆå‘¢ï¼Œå³ä½¿æœ‰ä»£ç†ï¼Œåœ¨äºŒç´šç·©å­˜ä»£ç†ä¹Ÿå¯ä»¥å§ | ç‚ºä»€éº¼è¦ä½¿ç”¨ä¸‰ç´šç·©å­˜å‘¢ï¼Ÿ</p><p>æˆ‘å€‘å†ä¾†çœ‹ä¸‹ç›¸é—œä»£ç¢¼ï¼Œå‡è¨­æˆ‘å€‘ç¾åœ¨æ˜¯äºŒç´šç·©å­˜æ¶æ§‹ï¼Œå‰µå»º A çš„æ™‚å€™ï¼Œæˆ‘å€‘ä¸çŸ¥é“æœ‰æ²’æœ‰å¾ªç’°ä¾è³´ï¼Œæ‰€ä»¥æ”¾å…¥äºŒç´šç·©å­˜æå‰æš´éœ²ï¼Œæ¥è‘—å‰µå»º Bï¼Œä¹Ÿæ˜¯æ”¾å…¥äºŒç´šç·©å­˜ï¼Œé€™æ™‚å€™ç™¼ç¾åˆå¾ªç’°ä¾è³´äº† Aï¼Œå°±å»äºŒç´šç·©å­˜æ‰¾ï¼Œæ˜¯æœ‰ï¼Œä½†æ˜¯å¦‚æœæ­¤æ™‚é‚„æœ‰ AOP ä»£ç†å‘¢ï¼Œæˆ‘å€‘è¦çš„æ˜¯ä»£ç†å°è±¡å¯ä¸æ˜¯åŸå§‹å°è±¡ï¼Œé€™æ€éº¼è¾¦ï¼Œåªèƒ½æ”¹é‚è¼¯ï¼Œåœ¨ç¬¬ä¸€æ­¥çš„æ™‚å€™ï¼Œä¸ç®¡3721ï¼Œæ‰€æœ‰ Bean çµ±çµ±å»å®Œæˆ AOP ä»£ç†ï¼Œå¦‚æœæ˜¯é€™æ¨£çš„è©±ï¼Œå°±ä¸éœ€è¦ä¸‰ç´šç·©å­˜äº†ï¼Œä½†æ˜¯é€™æ¨£ä¸åƒ…æ²’æœ‰å¿…è¦ï¼Œè€Œä¸”é•èƒŒäº† Spring åœ¨çµåˆ AOP è·Ÿ Bean çš„ç”Ÿå‘½é€±æœŸçš„è¨­è¨ˆã€‚</p><p>æ‰€ä»¥ Spring â€œå¤šæ­¤ä¸€èˆ‰â€çš„å°‡å¯¦ä¾‹å…ˆå°è£åˆ° ObjectFactory ä¸­ï¼ˆä¸‰ç´šç·©å­˜ï¼‰ï¼Œä¸»è¦é—œéµé»åœ¨ getObject æ–¹æ³•ä¸¦éç›´æ¥è¿”å›å¯¦ä¾‹ï¼Œè€Œæ˜¯å°å¯¦ä¾‹åˆä½¿ç”¨ SmartInstantiationAwareBeanPostProcessor çš„ getEarlyBeanReference æ–¹æ³•å° bean é€²è¡Œè™•ç†ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œç•¶ Spring ä¸­å­˜åœ¨è©²å¾Œç½®è™•ç†å™¨ï¼Œæ‰€æœ‰çš„å–®ä¾‹ bean åœ¨å¯¦ä¾‹åŒ–å¾Œéƒ½æœƒè¢«é€²è¡Œæå‰æ›å…‰åˆ°ä¸‰ç´šç·©å­˜ä¸­ï¼Œä½†æ˜¯ä¸¦ä¸æ˜¯æ‰€æœ‰çš„ bean éƒ½å­˜åœ¨å¾ªç’°ä¾è³´ï¼Œä¹Ÿå°±æ˜¯ä¸‰ç´šç·©å­˜åˆ°äºŒç´šç·©å­˜çš„æ­¥é©Ÿä¸ä¸€å®šéƒ½æœƒè¢«åŸ·è¡Œï¼Œæœ‰å¯èƒ½æ›å…‰å¾Œç›´æ¥å‰µå»ºå®Œæˆï¼Œæ²’è¢«æå‰å¼•ç”¨éï¼Œå°±ç›´æ¥è¢«åŠ å…¥åˆ°ä¸€ç´šç·©å­˜ä¸­ã€‚å› æ­¤å¯ä»¥ç¢ºä¿åªæœ‰æå‰æ›å…‰ä¸”è¢«å¼•ç”¨çš„ bean æ‰æœƒé€²è¡Œè©²å¾Œç½®è™•ç†ã€‚</p><pre><div><pre><p>protected Object getSingleton(String beanName, boolean allowEarlyReference) {</p><p>Object singletonObject = this.singletonObjects.get(beanName);</p><p>if (singletonObject ==  &amp;&amp; isSingletonCurrentlyInCreation(beanName)) {</p><p>synchronized (this.singletonObjects) {</p><p>singletonObject = this.earlySingletonObjects.get(beanName);</p><p>if (singletonObject ==  &amp;&amp; allowEarlyReference) {</p><p>// ä¸‰ç´šç·©å­˜ç²å–ï¼Œkey=beanName value=objectFactoryï¼ŒobjectFactoryä¸­å­˜å„² //getObjectæ–¹æ³•ç”¨æ–¼ç²å–æå‰æ›å…‰çš„å¯¦ä¾‹</p><p>ObjectFactory&lt;?&gt; singletonFactory = this.singletonFactories.get(beanName);</p><p>if (singletonFactory != ) {</p><p>// ä¸‰ç´šç·©å­˜æœ‰çš„è©±ï¼Œå°±æŠŠä»–ç§»å‹•åˆ°äºŒç´šç·©å­˜</p><p>singletonObject = singletonFactory.getObject;</p><p>this.earlySingletonObjects.put(beanName, singletonObject);</p><p>this.singletonFactories.remove(beanName);</p><p>}</p><p>}</p><p>}</p><p>}</p><p>return singletonObject;</p><p>}</p><p>boolean earlySingletonExposure = (mbd.isSingleton &amp;&amp; this.allowCircularReferences &amp;&amp;</p><p>isSingletonCurrentlyInCreation(beanName));</p><p>if (earlySingletonExposure) {</p><p>if (logger.isDebugEnabled) {</p><p>logger.debug("Eagerly caching bean '" + beanName +</p><p>"' to allow for resolving potential circular references");</p><p>}</p><p>// æ·»åŠ  bean å·¥å» å°è±¡åˆ° singletonFactories ç·©å­˜ä¸­ï¼Œä¸¦ç²å–åŸå§‹å°è±¡çš„æ—©æœŸå¼•ç”¨</p><p>//åŒ¿åå…§éƒ¨æ–¹æ³• getEarlyBeanReference å°±æ˜¯å¾Œç½®è™•ç†å™¨</p><p>// SmartInstantiationAwareBeanPostProcessor çš„ä¸€å€‹æ–¹æ³•ï¼Œ</p><p>// å®ƒçš„åŠŸæ•ˆç‚ºï¼šä¿è­‰è‡ªå·±è¢«å¾ªç’°ä¾è³´çš„æ™‚å€™ï¼Œå³ä½¿è¢«åˆ¥çš„Bean @Autowireé€²å»çš„ä¹Ÿæ˜¯ä»£ç†å°è±¡~~~~ AOPè‡ªå‹•ä»£ç†å‰µå»ºå™¨æ­¤æ–¹æ³•è£¡æœƒå‰µå»ºçš„ä»£ç†å°è±¡~~~</p><p>addSingletonFactory(beanName,  -&gt; getEarlyBeanReference(beanName, mbd, bean));</p><p>}</p></pre></div></pre><p>å†å•ï¼šAOP ä»£ç†å°è±¡æå‰æ”¾å…¥äº†ä¸‰ç´šç·©å­˜ï¼Œæ²’æœ‰ç¶“éå±¬æ€§å¡«å……å’Œåˆå§‹åŒ–ï¼Œé€™å€‹ä»£ç†åˆæ˜¯å¦‚ä½•ä¿è­‰ä¾è³´å±¬æ€§çš„æ³¨å…¥çš„å‘¢ï¼Ÿ</p><p>é€™å€‹åˆæ¶‰åŠåˆ°äº† Spring ä¸­å‹•æ…‹ä»£ç†çš„å¯¦ç¾ï¼Œä¸ç®¡æ˜¯cglibä»£ç†é‚„æ˜¯jdkå‹•æ…‹ä»£ç†ç”Ÿæˆçš„ä»£ç†é¡ï¼Œä»£ç†æ™‚ï¼Œæœƒå°‡ç›®æ¨™å°è±¡ target ä¿å­˜åœ¨æœ€å¾Œç”Ÿæˆçš„ä»£ç† $proxy ä¸­ï¼Œç•¶èª¿ç”¨ $proxy æ–¹æ³•æ™‚æœƒå›èª¿ h.invokeï¼Œè€Œ h.invoke åˆæœƒå›èª¿ç›®æ¨™å°è±¡ target çš„åŸå§‹æ–¹æ³•ã€‚æ‰€æœ‰ï¼Œå…¶å¯¦åœ¨ AOP å‹•æ…‹ä»£ç†æ™‚ï¼ŒåŸå§‹ bean å·²ç¶“è¢«ä¿å­˜åœ¨ æå‰æ›å…‰ä»£ç†ä¸­äº†ï¼Œä¹‹å¾Œ åŸå§‹ bean ç¹¼çºŒå®Œæˆå±¬æ€§å¡«å……å’Œåˆå§‹åŒ–æ“ä½œã€‚å› ç‚º AOP ä»£ç†$proxyä¸­ä¿å­˜è‘— traget ä¹Ÿå°±æ˜¯æ˜¯ åŸå§‹bean çš„å¼•ç”¨ï¼Œå› æ­¤å¾ŒçºŒ åŸå§‹bean çš„å®Œå–„ï¼Œä¹Ÿå°±ç›¸ç•¶æ–¼Spring AOPä¸­çš„ target çš„å®Œå–„ï¼Œé€™æ¨£å°±ä¿è­‰äº† AOP çš„å±¬æ€§å¡«å……èˆ‡åˆå§‹åŒ–äº†ï¼</p><p></p><h2 toutiao-origin=h3>éå–®ä¾‹å¾ªç’°ä¾è³´</h2><p>çœ‹å®Œäº†å–®ä¾‹æ¨¡å¼çš„å¾ªç’°ä¾è³´ï¼Œæˆ‘å€‘å†çœ‹ä¸‹éå–®ä¾‹çš„æƒ…æ³ï¼Œå‡è¨­æˆ‘å€‘çš„é…ç½®æ–‡ä»¶æ˜¯é€™æ¨£çš„ï¼š</p><pre><div><pre><p>&lt;bean id="beanA" class="priv.starfish.BeanA" scope="prototype"&gt;</p><p>&lt;property name="beanB" ref="beanB"/&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean id="beanB" class="priv.starfish.BeanB" scope="prototype"&gt;</p><p>&lt;property name="beanA" ref="beanA"/&gt;</p><p>&lt;/bean&gt;</p></pre></div></pre><p>å•Ÿå‹• Springï¼Œçµæœå¦‚ä¸‹ï¼š</p><pre><div><pre><p>Error creating bean with name 'beanA' defined in class path resource [applicationContext.xml]: Cannot resolve reference to bean 'beanB' while setting bean property 'beanB';</p><p>Error creating bean with name 'beanB' defined in class path resource [applicationContext.xml]: Cannot resolve reference to bean 'beanA' while setting bean property 'beanA';</p><p>Caused by: org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'beanA': Requested bean is currently in creation: Is there an unresolvable circular reference?</p></pre></div></pre><p>å°æ–¼ prototype ä½œç”¨åŸŸçš„ beanï¼ŒSpring å®¹å™¨ç„¡æ³•å®Œæˆä¾è³´æ³¨å…¥ï¼Œå› ç‚º Spring å®¹å™¨ä¸é€²è¡Œç·©å­˜ prototype ä½œç”¨åŸŸçš„ bean ï¼Œå› æ­¤ç„¡æ³•æå‰æš´éœ²ä¸€å€‹å‰µå»ºä¸­çš„bean ã€‚</p><p>åŸå› ä¹ŸæŒºå¥½ç†è§£çš„ï¼ŒåŸå‹æ¨¡å¼æ¯æ¬¡è«‹æ±‚éƒ½æœƒå‰µå»ºä¸€å€‹å¯¦ä¾‹å°è±¡ï¼Œå³ä½¿åŠ äº†ç·©å­˜ï¼Œå¾ªç’°å¼•ç”¨å¤ªå¤šçš„è©±ï¼Œå°±æ¯”è¼ƒéº»ç…©äº†å°±ï¼Œæ‰€ä»¥ Spring ä¸æ”¯æŒé€™ç¨®æ–¹å¼ï¼Œç›´æ¥æ‹‹å‡ºç•°å¸¸ï¼š</p><pre><div><pre><p>if (isPrototypeCurrentlyInCreation(beanName)) {</p><p>throw new BeanCurrentlyInCreationException(beanName);</p><p>}</p></pre></div></pre><p></p><h2 toutiao-origin=h3>æ§‹é€ å™¨å¾ªç’°ä¾è³´</h2><p>ä¸Šæ–‡æˆ‘å€‘è¬›çš„æ˜¯é€šé Setter æ–¹æ³•æ³¨å…¥çš„å–®ä¾‹ bean çš„å¾ªç’°ä¾è³´å•é¡Œï¼Œç”¨ Spring çš„å°å¤¥ä¼´ä¹Ÿéƒ½çŸ¥é“ï¼Œä¾è³´æ³¨å…¥çš„æ–¹å¼é‚„æœ‰æ§‹é€ å™¨æ³¨å…¥ã€å·¥å» æ–¹æ³•æ³¨å…¥çš„æ–¹å¼ï¼ˆå¾ˆå°‘ä½¿ç”¨ï¼‰ï¼Œé‚£å¦‚æœæ§‹é€ å™¨æ³¨å…¥æ–¹å¼ä¹Ÿæœ‰å¾ªç’°ä¾è³´ï¼Œå¯ä»¥æä¸ï¼Ÿ</p><p>æˆ‘å€‘å†æ”¹ä¸‹ä»£ç¢¼å’Œé…ç½®æ–‡ä»¶ã€‚</p><pre><div><pre><p>public class BeanA {</p><p>private BeanB beanB;</p><p>public <strong class=highlight-text toutiao-origin=span>BeanA</strong>(BeanB beanB) {</p><p>this.beanB = beanB;</p><p>}</p><p>}</p><p>public class BeanB {</p><p>private BeanA beanA;</p><p>public <strong class=highlight-text toutiao-origin=span>BeanB</strong>(BeanA beanA) {</p><p>this.beanA = beanA;</p><p>}</p><p>}</p></pre></div></pre><pre><div><pre><p>&lt;bean id="beanA" class="priv.starfish.BeanA"&gt;</p><p>&lt;constructor-arg ref="beanB"/&gt;</p><p>&lt;/bean&gt;</p><p>&lt;bean id="beanB" class="priv.starfish.BeanB"&gt;</p><p>&lt;constructor-arg ref="beanA"/&gt;</p><p>&lt;/bean&gt;</p></pre></div></pre><p>åŸ·è¡Œçµæœï¼Œåˆæ˜¯ç•°å¸¸</p><img alt="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/S9o5ndtA3mcWV8><p>çœ‹çœ‹å®˜æ–¹çµ¦å‡ºçš„èªªæ³•ï¼š</p><blockquote><p>Circular dependencies</p><p>If you use predominantly constructor injection, it is possible to create an unresolvable circular dependency scenario.</p><p>For example: Class A requires an instance of class B through constructor injection, and class B requires an instance of class A through constructor injection. If you configure beans for classes A and B to be injected into each other, the Spring IoC container detects this circular reference at runtime, and throws a BeanCurrentlyInCreationException.</p><p>One possible solution is to edit the source code of some classes to be configured by setters rather than constructors. Alternatively, avoid constructor injection and use setter injection only. In other words, although it is not recommended, you can configure circular dependencies with setter injection.</p><p>Unlike the typical case (with no circular dependencies), a circular dependency between bean A and bean B forces one of the beans to be injected into the other prior to being fully initialized itself (a classic chicken-and-egg scenario).</p></blockquote><p>å¤§æ¦‚æ„æ€æ˜¯ï¼š</p><p>å¦‚æœæ‚¨ä¸»è¦ä½¿ç”¨æ§‹é€ å™¨æ³¨å…¥ï¼Œå¾ªç’°ä¾è³´å ´æ™¯æ˜¯ç„¡æ³•è§£æ±ºçš„ã€‚å»ºè­°ä½ ç”¨ setter æ³¨å…¥æ–¹å¼ä»£æ›¿æ§‹é€ å™¨æ³¨å…¥</p><p>å…¶å¯¦ä¹Ÿä¸æ˜¯èªªåªè¦æ˜¯æ§‹é€ å™¨æ³¨å…¥å°±æœƒæœ‰å¾ªç’°ä¾è³´å•é¡Œï¼ŒSpring åœ¨å‰µå»º Bean çš„æ™‚å€™é»˜èªæ˜¯æŒ‰ç…§è‡ªç„¶æ’åºä¾†é€²è¡Œå‰µå»ºçš„ï¼Œæˆ‘å€‘æš«ä¸”æŠŠå…ˆå‰µå»ºçš„ bean å«ä¸» beanï¼Œä¸Šæ–‡çš„ A å³ä¸» beanï¼Œåªè¦ä¸» bean æ³¨å…¥ä¾è³´ bean çš„æ–¹å¼æ˜¯ setter æ–¹å¼ï¼Œä¾è³´ bean çš„æ³¨å…¥æ–¹å¼ç„¡æ‰€è¬‚ï¼Œéƒ½å¯ä»¥è§£æ±ºï¼Œåä¹‹äº¦ç„¶</p><p>æ‰€ä»¥ä¸Šæ–‡æˆ‘å€‘ AB å¾ªç’°ä¾è³´å•é¡Œï¼Œåªè¦ A çš„æ³¨å…¥æ–¹å¼æ˜¯ setter ï¼Œå°±ä¸æœƒæœ‰å¾ªç’°ä¾è³´å•é¡Œã€‚</p><p>é¢è©¦å®˜å•ï¼šç‚ºä»€éº¼å‘¢ï¼Ÿ</p><p>Spring è§£æ±ºå¾ªç’°ä¾è³´ä¾é çš„æ˜¯ Bean çš„â€œä¸­é–“æ…‹â€é€™å€‹æ¦‚å¿µï¼Œè€Œé€™å€‹ä¸­é–“æ…‹æŒ‡çš„æ˜¯å·²ç¶“å¯¦ä¾‹åŒ–ï¼Œä½†é‚„æ²’åˆå§‹åŒ–çš„ç‹€æ…‹ã€‚å¯¦ä¾‹åŒ–çš„éç¨‹åˆæ˜¯é€šéæ§‹é€ å™¨å‰µå»ºçš„ï¼Œå¦‚æœ A é‚„æ²’å‰µå»ºå¥½å‡ºä¾†ï¼Œæ€éº¼å¯èƒ½æå‰æ›å…‰ï¼Œæ‰€ä»¥æ§‹é€ å™¨çš„å¾ªç’°ä¾è³´ç„¡æ³•è§£æ±ºï¼Œæˆ‘ä¸€ç›´èªç‚ºæ‡‰è©²å…ˆæœ‰é›æ‰èƒ½æœ‰è›‹ã€‚</p><img alt="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTJXJ1kBqzfCnu><p></p><h1 toutiao-origin=h2>å°ç¸½çµ | é¢è©¦é€™éº¼ç­”</h1><p></p><h2 toutiao-origin=h4>B ä¸­æå‰æ³¨å…¥äº†ä¸€å€‹æ²’æœ‰ç¶“éåˆå§‹åŒ–çš„ A é¡å‹å°è±¡ä¸æœƒæœ‰å•é¡Œå—ï¼Ÿ</h2><p>é›–ç„¶åœ¨å‰µå»º B æ™‚æœƒæå‰çµ¦ B æ³¨å…¥äº†ä¸€å€‹é‚„æœªåˆå§‹åŒ–çš„ A å°è±¡ï¼Œä½†æ˜¯åœ¨å‰µå»º A çš„æµç¨‹ä¸­ä¸€ç›´ä½¿ç”¨çš„æ˜¯æ³¨å…¥åˆ° B ä¸­çš„ A å°è±¡çš„å¼•ç”¨ï¼Œä¹‹å¾Œæœƒæ ¹æ“šé€™å€‹å¼•ç”¨å° A é€²è¡Œåˆå§‹åŒ–ï¼Œæ‰€ä»¥é€™æ˜¯æ²’æœ‰å•é¡Œçš„ã€‚</p><p></p><h2 toutiao-origin=h4>Spring æ˜¯å¦‚ä½•è§£æ±ºçš„å¾ªç’°ä¾è³´ï¼Ÿ</h2><p>Spring ç‚ºäº†è§£æ±ºå–®ä¾‹çš„å¾ªç’°ä¾è³´å•é¡Œï¼Œä½¿ç”¨äº†ä¸‰ç´šç·©å­˜ã€‚å…¶ä¸­ä¸€ç´šç·©å­˜ç‚ºå–®ä¾‹æ± ï¼ˆsingletonObjectsï¼‰ï¼ŒäºŒç´šç·©å­˜ç‚ºæå‰æ›å…‰å°è±¡ï¼ˆearlySingletonObjectsï¼‰ï¼Œä¸‰ç´šç·©å­˜ç‚ºæå‰æ›å…‰å°è±¡å·¥å» ï¼ˆsingletonFactoriesï¼‰ã€‚</p><p>å‡è¨­Aã€Bå¾ªç’°å¼•ç”¨ï¼Œå¯¦ä¾‹åŒ– A çš„æ™‚å€™å°±å°‡å…¶æ”¾å…¥ä¸‰ç´šç·©å­˜ä¸­ï¼Œæ¥è‘—å¡«å……å±¬æ€§çš„æ™‚å€™ï¼Œç™¼ç¾ä¾è³´äº† Bï¼ŒåŒæ¨£çš„æµç¨‹ä¹Ÿæ˜¯å¯¦ä¾‹åŒ–å¾Œæ”¾å…¥ä¸‰ç´šç·©å­˜ï¼Œæ¥è‘—å»å¡«å……å±¬æ€§æ™‚åˆç™¼ç¾è‡ªå·±ä¾è³´ Aï¼Œé€™æ™‚å€™å¾ç·©å­˜ä¸­æŸ¥æ‰¾åˆ°æ—©æœŸæš´éœ²çš„ Aï¼Œæ²’æœ‰ AOP ä»£ç†çš„è©±ï¼Œç›´æ¥å°‡ A çš„åŸå§‹å°è±¡æ³¨å…¥ Bï¼Œå®Œæˆ B çš„åˆå§‹åŒ–å¾Œï¼Œé€²è¡Œå±¬æ€§å¡«å……å’Œåˆå§‹åŒ–ï¼Œé€™æ™‚å€™ B å®Œæˆå¾Œï¼Œå°±å»å®Œæˆå‰©ä¸‹çš„ A çš„æ­¥é©Ÿï¼Œå¦‚æœæœ‰ AOP ä»£ç†ï¼Œå°±é€²è¡Œ AOP è™•ç†ç²å–ä»£ç†å¾Œçš„å°è±¡ Aï¼Œæ³¨å…¥ Bï¼Œèµ°å‰©ä¸‹çš„æµç¨‹ã€‚</p><p></p><h2 toutiao-origin=h4>ç‚ºä»€éº¼è¦ä½¿ç”¨ä¸‰ç´šç·©å­˜å‘¢ï¼ŸäºŒç´šç·©å­˜èƒ½è§£æ±ºå¾ªç’°ä¾è³´å—ï¼Ÿ</h2><p>å¦‚æœæ²’æœ‰ AOP ä»£ç†ï¼ŒäºŒç´šç·©å­˜å¯ä»¥è§£æ±ºå•é¡Œï¼Œä½†æ˜¯æœ‰ AOP ä»£ç†çš„æƒ…æ³ä¸‹ï¼Œåªç”¨äºŒç´šç·©å­˜å°±æ„å‘³è‘—æ‰€æœ‰ Bean åœ¨å¯¦ä¾‹åŒ–å¾Œå°±è¦å®Œæˆ AOP ä»£ç†ï¼Œé€™æ¨£é•èƒŒäº† Spring è¨­è¨ˆçš„åŸå‰‡ï¼ŒSpring åœ¨è¨­è¨ˆä¹‹åˆå°±æ˜¯é€šé AnnotationAwareAspectJAutoProxyCreator é€™å€‹å¾Œç½®è™•ç†å™¨ä¾†åœ¨ Bean ç”Ÿå‘½é€±æœŸçš„æœ€å¾Œä¸€æ­¥ä¾†å®Œæˆ AOP ä»£ç†ï¼Œè€Œä¸æ˜¯åœ¨å¯¦ä¾‹åŒ–å¾Œå°±ç«‹é¦¬é€²è¡Œ AOP ä»£ç†ã€‚</p><p></p><h2 toutiao-origin=h3>åƒè€ƒèˆ‡æ„Ÿè¬ï¼š</h2><p>ã€ŠSpring æºç¢¼æ·±åº¦è§£æã€‹- éƒä½³è‘—</p><p>https://developer.aliyun.com/article/766880</p><p>http://www.tianxiaobo.com/2018/06/08/Spring-IOC-å®¹å™¨æºç¢¼åˆ†æ-å¾ªç’°ä¾è³´çš„è§£æ±ºè¾¦æ³•</p><p>https://cloud.tencent.com/developer/article/1497692</p><p>https://blog.csdn.net/chaitoudaren/article/details/105060882</p><img alt="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/R69FpRH4d90a7d><img alt="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/S9fvQrwFxdO6Si><pre><div><div><div><div><div><div><img alt="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/S3V0kpbJ0CLyq7></div></div><p><strong toutiao-origin=span>é»åˆ†äº«</strong></p></div><div><div><div><div><img alt="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/S3Y8EjO3S3jH6O></div></div></div><div><div><div><img alt="çˆ›äº†å¤§è¡—çš„ Spring å¾ªç’°ä¾è³´å•é¡Œï¼Œä½ ä»¥ç‚ºè‡ªå·±å°±çœŸæœƒäº†å—ï¼Ÿ" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/S3V0kpwDUoK9Jv></div></div></div></div></div></div></div></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>çˆ›äº†</a></li><li><a>Spring</a></li><li><a>å¾ªç’°</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/32c82df2.html alt=ç†±æ°´é‹çˆæˆ¿å¾ªç’°æ°´æ³µé¸å‹å»ºè­° class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/32c82df2.html title=ç†±æ°´é‹çˆæˆ¿å¾ªç’°æ°´æ³µé¸å‹å»ºè­°>ç†±æ°´é‹çˆæˆ¿å¾ªç’°æ°´æ³µé¸å‹å»ºè­°</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/000afa08.html alt="Spring Boot 2.xåŸºç¤æ•™ç¨‹ï¼šSwaggeræ¥å£åˆ†é¡èˆ‡å„å…ƒç´ æ’åºå•é¡Œè©³è§£" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/daa2cfd29ec34306a4be6f3f257b824b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/000afa08.html title="Spring Boot 2.xåŸºç¤æ•™ç¨‹ï¼šSwaggeræ¥å£åˆ†é¡èˆ‡å„å…ƒç´ æ’åºå•é¡Œè©³è§£">Spring Boot 2.xåŸºç¤æ•™ç¨‹ï¼šSwaggeræ¥å£åˆ†é¡èˆ‡å„å…ƒç´ æ’åºå•é¡Œè©³è§£</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6cfd4e0e.html alt="Spring æ ¸å¿ƒçŸ¥è­˜è¬›è§£ï¼Œå¤ªç°¡å–®å•¦" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6cfd4e0e.html title="Spring æ ¸å¿ƒçŸ¥è­˜è¬›è§£ï¼Œå¤ªç°¡å–®å•¦">Spring æ ¸å¿ƒçŸ¥è­˜è¬›è§£ï¼Œå¤ªç°¡å–®å•¦</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/090306a0.html alt="[Spring] æ·±å…¥ç­è§£äº‹å‹™åŸç†" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/a8c6dbd7c51741f5a76262e8e2c7a670 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/090306a0.html title="[Spring] æ·±å…¥ç­è§£äº‹å‹™åŸç†">[Spring] æ·±å…¥ç­è§£äº‹å‹™åŸç†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fb2bc471.html alt="ã€Œè­¯ã€ Spring çš„åˆ†ä½ˆå¼äº‹å‹™å¯¦ç¾â€”ä½¿ç”¨å’Œä¸ä½¿ç”¨ XAâ€”ç¬¬äºŒéƒ¨åˆ†" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fb2bc471.html title="ã€Œè­¯ã€ Spring çš„åˆ†ä½ˆå¼äº‹å‹™å¯¦ç¾â€”ä½¿ç”¨å’Œä¸ä½¿ç”¨ XAâ€”ç¬¬äºŒéƒ¨åˆ†">ã€Œè­¯ã€ Spring çš„åˆ†ä½ˆå¼äº‹å‹™å¯¦ç¾â€”ä½¿ç”¨å’Œä¸ä½¿ç”¨ XAâ€”ç¬¬äºŒéƒ¨åˆ†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1678b1c4.html alt=ï¼ˆæ”¶è—ï¼‰Springäº‹å‹™å°ˆé¡Œï¼šäº‹å‹™çš„åŸºæœ¬æ¦‚å¿µï¼ŒMysqläº‹å‹™è™•ç†åŸç† class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/433259b5-1936-4cee-ab74-70aef36536ee style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1678b1c4.html title=ï¼ˆæ”¶è—ï¼‰Springäº‹å‹™å°ˆé¡Œï¼šäº‹å‹™çš„åŸºæœ¬æ¦‚å¿µï¼ŒMysqläº‹å‹™è™•ç†åŸç†>ï¼ˆæ”¶è—ï¼‰Springäº‹å‹™å°ˆé¡Œï¼šäº‹å‹™çš„åŸºæœ¬æ¦‚å¿µï¼ŒMysqläº‹å‹™è™•ç†åŸç†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d3c48fcc.html alt=Springè²æ˜å¼äº‹å‹™è™•ç†çš„å¯¦ç¾åŸç†ï¼Œä¾†è‡ªé¢è©¦å®˜çš„çª®è¿½æ‹·å• class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d3c48fcc.html title=Springè²æ˜å¼äº‹å‹™è™•ç†çš„å¯¦ç¾åŸç†ï¼Œä¾†è‡ªé¢è©¦å®˜çš„çª®è¿½æ‹·å•>Springè²æ˜å¼äº‹å‹™è™•ç†çš„å¯¦ç¾åŸç†ï¼Œä¾†è‡ªé¢è©¦å®˜çš„çª®è¿½æ‹·å•</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/48532629.html alt=å¾ªç’°â½”é¤Šæ®–æŒ‡æ¨™-æº¶è§£æ°§ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/56d1472f673a48fcb736dca88bf7b39c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/48532629.html title=å¾ªç’°â½”é¤Šæ®–æŒ‡æ¨™-æº¶è§£æ°§>å¾ªç’°â½”é¤Šæ®–æŒ‡æ¨™-æº¶è§£æ°§</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1d9a5540.html alt=å¾ªç’°æµåŒ–åºŠé‹çˆè€ç£¨è€ç«ææ–™éƒ½æœ‰å“ªäº›ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/85eb71ea22e548ff81c68a4c0216f09a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1d9a5540.html title=å¾ªç’°æµåŒ–åºŠé‹çˆè€ç£¨è€ç«ææ–™éƒ½æœ‰å“ªäº›ï¼Ÿ>å¾ªç’°æµåŒ–åºŠé‹çˆè€ç£¨è€ç«ææ–™éƒ½æœ‰å“ªäº›ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f833cb1e.html alt="æŠ€è¡“ | æ·ºè«‡å¾ªç’°æµåŒ–åºŠé‹çˆå¤§ä¿®æ™‚çš„é˜²ç£¨è™•ç†" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f833cb1e.html title="æŠ€è¡“ | æ·ºè«‡å¾ªç’°æµåŒ–åºŠé‹çˆå¤§ä¿®æ™‚çš„é˜²ç£¨è™•ç†">æŠ€è¡“ | æ·ºè«‡å¾ªç’°æµåŒ–åºŠé‹çˆå¤§ä¿®æ™‚çš„é˜²ç£¨è™•ç†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/80eda0c9.html alt=å·¥æ¥­å¾ªç’°å†·å»æ°´è™•ç†ï¼ˆä¸‰ï¼‰ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a8094522823a4a4fab20b39b9c4a062c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/80eda0c9.html title=å·¥æ¥­å¾ªç’°å†·å»æ°´è™•ç†ï¼ˆä¸‰ï¼‰>å·¥æ¥­å¾ªç’°å†·å»æ°´è™•ç†ï¼ˆä¸‰ï¼‰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/41882779.html alt=ä»€éº¼æ˜¯ç†±æ°´é‹çˆå¾ªç’°æ•…éšœï¼Ÿ-èµ¤å³°é‹çˆæ¸…æ´—å…¬å¸ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2e06e4d3087d4032ab0d9dfb3d7d2e89 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/41882779.html title=ä»€éº¼æ˜¯ç†±æ°´é‹çˆå¾ªç’°æ•…éšœï¼Ÿ-èµ¤å³°é‹çˆæ¸…æ´—å…¬å¸>ä»€éº¼æ˜¯ç†±æ°´é‹çˆå¾ªç’°æ•…éšœï¼Ÿ-èµ¤å³°é‹çˆæ¸…æ´—å…¬å¸</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b7061034.html alt=å¾ªç’°æµåŒ–åºŠé‹çˆ1000å•ï¼ˆå››ï¼‰å„ªåŒ–è©¦é©—ç¯‡1å¾ªç’°æµåŒ–åºŠé‹çˆå†·æ…‹è©¦é©— class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3cfade6d49b044d199d262c3b6d40f1a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b7061034.html title=å¾ªç’°æµåŒ–åºŠé‹çˆ1000å•ï¼ˆå››ï¼‰å„ªåŒ–è©¦é©—ç¯‡1å¾ªç’°æµåŒ–åºŠé‹çˆå†·æ…‹è©¦é©—>å¾ªç’°æµåŒ–åºŠé‹çˆ1000å•ï¼ˆå››ï¼‰å„ªåŒ–è©¦é©—ç¯‡1å¾ªç’°æµåŒ–åºŠé‹çˆå†·æ…‹è©¦é©—</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/90f40400.html alt="æŒªå¨å°é®æ”¹é€ æ–¹æ¡ˆï¼šæ™¯è§€å¾ªç’°the landscape loop" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/435200015e999fea9af2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/90f40400.html title="æŒªå¨å°é®æ”¹é€ æ–¹æ¡ˆï¼šæ™¯è§€å¾ªç’°the landscape loop">æŒªå¨å°é®æ”¹é€ æ–¹æ¡ˆï¼šæ™¯è§€å¾ªç’°the landscape loop</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6a83bdbe.html alt=ç‡ƒæ–™é›»æ± æ°«æ°£å¾ªç’°è¨­è¨ˆæ–¹æ¡ˆæ¢è¨ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/c98d4743f6e749ff993165fcb3fe7ed8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6a83bdbe.html title=ç‡ƒæ–™é›»æ± æ°«æ°£å¾ªç’°è¨­è¨ˆæ–¹æ¡ˆæ¢è¨>ç‡ƒæ–™é›»æ± æ°«æ°£å¾ªç’°è¨­è¨ˆæ–¹æ¡ˆæ¢è¨</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>