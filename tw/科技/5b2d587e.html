<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>5分鐘瞭解阿里時序時空數據庫 | 极客快訊</title><meta property="og:title" content="5分鐘瞭解阿里時序時空數據庫 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5b2d587e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5b2d587e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5b2d587e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5b2d587e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5b2d587e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5b2d587e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5b2d587e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5b2d587e.html><meta property="article:published_time" content="2020-11-14T21:04:01+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:01+08:00"><meta name=Keywords content><meta name=description content="5分鐘瞭解阿里時序時空數據庫"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/5b2d587e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>5分鐘瞭解阿里時序時空數據庫</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>簡介</h1><p>時序時空數據庫（Time Series & Spatial Temporal Database，簡稱 TSDB）是一種高性能、低成本、穩定可靠的在線時序時空數據庫服務，提供高效讀寫、高壓縮比存儲、時序數據插值及聚合計算等服務，廣泛應用於物聯網（IoT）設備監控系統、企業能源管理系統（EMS）、生產安全監控系統和電力檢測系統等行業場景；除此以外，還提供時空場景的查詢和分析的能力。</p><h1>三個數據庫</h1><p>時序時空數據庫文檔最近經過幾次大的變動，有點亂，看的時候注意一下。</p><p><strong>時序數據庫TSDB版</strong></p><p>經過阿里集團大規模驗證的時序數據庫，支持分佈式集群架構水平擴展，支持千萬物聯網設備接入，基於自研壓縮算法，具備高效壓縮比。</p><pre>- 針對時序數據優化，包括存儲模型，多值數據模型，時序數據壓縮、聚合、採樣，高效壓縮算法，列存，邊緣一體化；- 具備高性能，內存優先數據處理，分佈式MPP SQL並行計算，動態schema，實時流式數據計算引擎，海量時間線自適應索引；- 高可擴展，數據動態分區，水平擴展，動態彈性擴容，動態升降配規格；高可靠性，自動集群控制，線程級讀寫分離，多層數據備份，分級存儲；- 瞄準的是大規模指標數據，事件數據場景</pre><p>協議兼容OpenTSDB，但後面內核實現是阿里自研的。但還是完全可以把它當作OpenTSDB的阿里雲版，參見 相比OpenTSDB優勢</p><p><strong>InfluxDB®</strong></p><p>不僅僅是一個數據庫，更是一個監控系統，圍繞採集，可視化，分析服務，事件和指標存儲和計算系統；走的是tick生態，瞄準指標，事件，trace，日誌，實時分析場景。</p><p>InfluxDB®剛上線不久，現在還處在公測階段。寫入速度經測試，每次500條數據，每秒可以執行26次左右，平均速度達到1萬/s，增加每次寫入數據條數應該還能提高速度。另外，請求地址是外網，如果使用vpc網絡速度應該還會加快不少。</p><p>注意：InfluxDB在阿里雲上有時間線限制(數據庫級別最高1萬)，時間線的定義參見後面簡介。</p><p><strong>時空數據庫</strong></p><p>時空數據庫能夠存儲、管理包括時間序列以及空間地理位置相關的數據。時空數據是一種高維數據，具有時空數據模型、時空索引和時空算子，完全兼容SQL及SQL/MM標準，支持時空數據同業務數據一體化存儲、無縫銜接，易於集成使用。</p><p>時空數據庫主要是空間相關的場景，比如熱力圖，店鋪選址等等。</p><h1>時序數據庫簡介(主要是InfluxDB)</h1><p>時序數據庫英文全稱為 Time Series Database，提供高效存取時序數據和統計分析功能的數據管理系統。主要的時序數據庫包括OpenTSDB、Druid、InfluxDB以及Beringei這四個。本人主要了解一點OpenTSDB和InfluxDB，不過時序數據庫有很多共性。</p><p><strong>基本名詞</strong></p><p>measurement:</p><pre>tag，field和time列的容器對InfluxDB: measurement在概念上類似於傳統DB的table（表格） 從原理上講更像SQL中表的概念，這和其他很多時序數據庫有些不同對其他時序DB: Measurement與Metric等同</pre><p>field(數值列):</p><pre>TSDB For InfluxDB®中不能沒有field。注意:field是沒有索引的在某種程度上，可以把field理解為k/v表的value</pre><p>tag(維度列):</p><pre>tag不是必須要有的字段tag是被索引的，這意味著以tag作為過濾條件的查詢會更快在某種程度上，可以把field理解為k/v表的key</pre><p>timestamp(時間戳):</p><pre>默認使用服務器的本地時間戳時間戳是UNIX時間戳,單位:納秒最小的有效時間戳是-9223372036854775806或1677-09-21T00:12:43.145224194Z最大的有效時間戳是9223372036854775806或2262-04-11T23:47:16.854775806Z</pre><p>point（數據點）:</p><pre>由時間線（series）中包含的field組成。每個數據點由它的時間線和時間戳（timestamp）唯一標識您不能在同一時間線存儲多個有相同時間戳的數據點</pre><p><strong>Series(時間線)</strong></p><p>Series是InfluxDB中最重要的概念，時序數據的時間線就是:一個數據源採集的一個指標隨著時間的流逝而源源不斷地吐出數據這樣形成的一條數據線稱之為時間線。</p><p>下圖中有兩個數據源，每個數據源會採集兩種指標:</p><pre>Series由Measurement和Tags組合而成，Tags組合用來唯一標識Measurement就是說:1. Measurement不同，就是不同的時間線2. Measurement相同，Tags不同也是不同的時間線</pre><p><strong>retention policy（保留策略，簡稱RP）</strong></p><p>一個保留策略描述了:</p><pre> 1.InfluxDB保存數據的時間（DURATION） 2.以及存儲在集群中數據的副本數量（REPLICATION） 3.指定ShardGroup Duration注:複本係數（replication factors）不適用於單節點實例。autogen:無限的存儲時間並且複製係數設為1</pre><p>RP創建語句如下:</p><pre>CREATE RETENTION POLICY ON &lt;retention_policy_name&gt; ON &lt;database_name&gt;DURATION &lt;duration&gt; REPLICATION &lt;n&gt; [SHARD DURATION &lt;duration&gt; ] [DEFAULT]實例:CREATE RETENTION POLICY "one_day_only" ON "water_database"DURATION 1d REPLICATION 1 SHARD DURATION 1h DEFAULT</pre><p>寫入時指定rp進行寫入:</p><pre>% 如果沒有指定任何RP，則使用默認的RPcurl -X POST 'http://localhost:8086/write?db=mydb&amp;rp=six_month_rollup' --data-binary 'disk,host=server01 value=442221834240i 1435362189575692182'</pre><p><strong>Shard Group</strong></p><p>Shard Group是InfluxDB中一個重要的邏輯概念:</p><pre>Shard Group會包含多個Shard，每個Shard Group只存儲指定時間段的數據不同Shard Group對應的時間段不會重合</pre><p>每個Shard Group對應多長時間是通過Retention Policy中字段”SHARD DURATION”指定的:</p><pre>如果沒有指定，也可以通過Retention Duration（數據過期時間）計算出來，兩者的對應關係為:Retention Duration SHARD DURATION&lt;2 days 1h&gt;=2days and &lt;=6month 1day&gt;6month 7day</pre><p>Shard:</p><pre>類似於HBase中Region，Kudu中Tablet的概念1. Shard是InfluxDB的存儲引擎實現，具體稱之為TSM(Time Sort Merge Tree) Engine 負責數據的編碼存儲、讀寫服務等。TSM類似於LSM，因此Shard和HBase Region一樣包含Cache、WAL以及Data File等各個組件， 也會有flush、compaction等這類數據操作2. Shard Group對數據按時間進行了分區 InfluxDB採用了Hash分區的方法將落到同一個Shard Group中的數據再次進行了一次分區 InfluxDB是根據hash(Series)將數據映射到不同的Shard,而非根據Measurement進行hash映射</pre><h1>InfluxQL</h1><p><strong>行協議</strong></p><p>格式:</p><pre>&lt;measurement&gt;[,&lt;tag_key&gt;=&lt;tag_value&gt;[,&lt;tag_key&gt;=&lt;tag_value&gt;]]  &lt;field_key&gt;=&lt;field_value&gt;[,&lt;field_key&gt;=&lt;field_value&gt;] [&lt;timestamp&gt;]</pre><p>以下是符合格式的數據寫入TSDB For InfluxDB®的示例：</p><pre>1. cpu,host=serverA,region=us_west value=0.642. payment,device=mobile,product=Notepad,method=credit billed=33,licenses=3i 14340674671002932303. stock,symbol=AAPL bid=127.46,ask=127.484. temperature,machine=unit42,type=assembly external=25,internal=37 1434067467000000000</pre><p><strong>登錄</strong></p><pre>// 登錄$&gt; influx -ssl -username &lt;賬號名稱&gt; -password &lt;密碼&gt; -host &lt;網絡地址&gt; -port 3242// 創建用戶&gt; create user gordon with password '1QAZ2wsx'// 賦值權限grant all privileges to gordon// 創建數據庫create database testdb</pre><p><strong>基本QL</strong></p><pre>1. # 顯示時間線show series2. # 顯示度量show measurements3. # 顯示Tag的Keyshow tag keys4. # 顯示數據字段的Keyshow field keys</pre><p>查詢:</p><pre>1. select * from metrics2. show tag keys from metrics3. show field keys from metrics# 查看自定度量的數據, 裡面的相關字段，官方建議使用“雙引號”標註出來select * from "CPU" order by time desc# 查看指定的Field和Tagselect "load1","role" from "CPU" order by time desc# 只查看Fieldselect *::field from "CPU"# 查詢指定Tag的數據，注意，Where子句的字符串值要使用“單引號”，字符串值# 如果沒有使用引號或者使用了雙引號，都不會有任何值的返回select * from "CPU" where role = 'FrontServer'# 查詢Field中，load1 &gt; 20 的所有數據select * from "CPU" where "load1" &gt; 20</pre><p>插入:</p><pre>INSERT weather,location=us-midwest temperature=82 1465839830100400200</pre><p>基本運算:</p><pre># 執行基本的運算select ("load1" * 2) + 0.5 from "CPU"// SELECT語句支持使用基本的數學運算符，例如，+、-、/、*和()等等。SELECT field_key1 + field_key2 AS "field_key_sum" FROM "measurement_name" WHERE time &lt; now() - 15mSELECT (key1 + key2) - (key3 + key4) AS "some_calculation" FROM "measurement_name" WHERE time &lt; now() - 15m// 使用聚合函數計算百分比:SELECT (sum(field_key1) / sum(field_key2)) * 100 AS "calculated_percentage" FROM "measurement_name" WHERE time &lt; now() - 15m GROUP BY time(1m)</pre><p>作者：新溪</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>分鐘</a></li><li><a>瞭解</a></li><li><a>時序</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/07652935.html alt=5分鐘瞭解一體化汙水泵站的組成結構 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/030f4fd112f64efd9a7a00343c3538e0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/07652935.html title=5分鐘瞭解一體化汙水泵站的組成結構>5分鐘瞭解一體化汙水泵站的組成結構</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/77709181.html alt=3分鐘瞭解介電晶體 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/79b8c99af2b24d828783a2e1711be44d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/77709181.html title=3分鐘瞭解介電晶體>3分鐘瞭解介電晶體</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/aa9f97d5.html alt=打破這3種流言，2分鐘快速瞭解，剎車卡鉗的冷知識 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/50debabb268f48c0ad9a00dbc2fc70f4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/aa9f97d5.html title=打破這3種流言，2分鐘快速瞭解，剎車卡鉗的冷知識>打破這3種流言，2分鐘快速瞭解，剎車卡鉗的冷知識</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/be548441.html alt=5分鐘瞭解鋅鋼護欄 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f3c22c84f8594aa5b3864164cb3e0723 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/be548441.html title=5分鐘瞭解鋅鋼護欄>5分鐘瞭解鋅鋼護欄</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9256d4da.html alt=5分鐘帶你瞭解大型鑄鋼件廠家 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/57591f0e80c24951b4aed0bfd14ef69f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9256d4da.html title=5分鐘帶你瞭解大型鑄鋼件廠家>5分鐘帶你瞭解大型鑄鋼件廠家</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5384224b.html alt=1分鐘帶你瞭解我國軍銜等級是如何排名的！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1520386972629a629eb30b5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5384224b.html title=1分鐘帶你瞭解我國軍銜等級是如何排名的！>1分鐘帶你瞭解我國軍銜等級是如何排名的！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7e9a1503.html alt=2分鐘，讓你瞭解石膏牆體材料在裝配式建築中的應用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/48159910a3224caa86d2f54b047cf945 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7e9a1503.html title=2分鐘，讓你瞭解石膏牆體材料在裝配式建築中的應用>2分鐘，讓你瞭解石膏牆體材料在裝配式建築中的應用</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/9406022b.html alt=3分鐘讓你瞭解數學系苦批的4年 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5624e6b303bd404c9a8a2dd2a59b5fa0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/9406022b.html title=3分鐘讓你瞭解數學系苦批的4年>3分鐘讓你瞭解數學系苦批的4年</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/1d84d9d0.html alt=1分鐘瞭解鍼灸鬆解的基本操作，解決你85%的疼痛小病 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/f24bb33eee8e4839ada53b80f309ebff style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/1d84d9d0.html title=1分鐘瞭解鍼灸鬆解的基本操作，解決你85%的疼痛小病>1分鐘瞭解鍼灸鬆解的基本操作，解決你85%的疼痛小病</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/26a99129.html alt=什麼是引力？2分鐘帶你快速瞭解下 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/679cf7bcec644726b93b72f5902383f3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/26a99129.html title=什麼是引力？2分鐘帶你快速瞭解下>什麼是引力？2分鐘帶你快速瞭解下</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/54d3018a.html alt=3分鐘瞭解中國古代農業文明，做個“略懂”考古學的人 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/30c9b9aa1501422eb18ba621d2a0b7f0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/54d3018a.html title=3分鐘瞭解中國古代農業文明，做個“略懂”考古學的人>3分鐘瞭解中國古代農業文明，做個“略懂”考古學的人</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d1988f01.html alt=​10分鐘瞭解鋼筋網片的材質及用途 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/df343e568a9047acbe6ecebb7e5db2dd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d1988f01.html title=​10分鐘瞭解鋼筋網片的材質及用途>​10分鐘瞭解鋼筋網片的材質及用途</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/071319e1.html alt=5分鐘瞭解——我國鋼號表示方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15353035817911481b8ac5a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/071319e1.html title=5分鐘瞭解——我國鋼號表示方法>5分鐘瞭解——我國鋼號表示方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fc2f880b.html alt=3分鐘瞭解高功率半導體激光器的關鍵技術 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15342943681192a7fc3ed5a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fc2f880b.html title=3分鐘瞭解高功率半導體激光器的關鍵技術>3分鐘瞭解高功率半導體激光器的關鍵技術</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f986b5e.html alt=1分鐘課堂，瞭解相機的“寬容度”和“動態範圍” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1540951704370db735e3958 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f986b5e.html title=1分鐘課堂，瞭解相機的“寬容度”和“動態範圍”>1分鐘課堂，瞭解相機的“寬容度”和“動態範圍”</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>