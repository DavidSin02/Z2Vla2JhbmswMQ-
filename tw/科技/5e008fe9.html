<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 | 极客快訊</title><meta property="og:title" content="Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/7872f862899e449b82762f48acd09ec2"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5e008fe9.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5e008fe9.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5e008fe9.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5e008fe9.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5e008fe9.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5e008fe9.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5e008fe9.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5e008fe9.html><meta property="article:published_time" content="2020-10-29T21:08:52+08:00"><meta property="article:modified_time" content="2020-10-29T21:08:52+08:00"><meta name=Keywords content><meta name=description content="Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/5e008fe9.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>關於2048，我看到很多大神，比如醫生，郭神，所以我也研究了一段時間，還好是研究了一套邏輯，這是一整套的2048遊戲從設計到邏輯再到編寫的全部過程，小夥伴們看仔細咯，剛好今天是禮拜天，一天應該了一把這篇博客發表了，其實2048開發起來還是有點難度的，並且他的邏輯挺強的，我也是看了很多的資料偷學的，很適合來鍛鍊自己的邏輯性</p><p>我們首先先來選擇開發環境，這裡我們就以Eclipse為IDE，新建一個工程——Game2048</p><div class=pgc-img><img alt=Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7872f862899e449b82762f48acd09ec2><p class=pgc-img-caption></p></div><h1>一.Score分數</h1><p>既然是2048遊戲，我們也就做一個簡單的，他有一個分數，然後就是一個遊戲的佈局，我們也做一個簡單的4*4的遊戲，大概的設計圖就是這樣</p><div class=pgc-img><img alt=Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/abdd3946946e4a7e8a8d46cf73d6ea0e><p class=pgc-img-caption></p></div><h1>二.遊戲類：GameView</h1><p>因為我們的遊戲所使用到的佈局就是GridLayout，所以我們新建一個GameView繼承自GridLayout，然後通過算法動態添加方塊，並且監聽手勢進行操作，這個重寫的GridLayout就是遊戲的佈局了</p><p>&lt;com.lgl.game2048.GameView</p><p>android:id="@+id/game_view"</p><p>android:layout_width="match_parent"</p><p>android:layout_height="0dp"</p><p>android:layout_weight="1" /></p><h1>三.實現交互邏輯</h1><p>我們這裡鐵定是手勢操作啦，這裡我們就得區分手勢是往上，往下，往左，往右，的手勢，這時候，我們就需要用到手勢監聽——OnTouchListener了，也為了確保是實時監聽，我們直接在initView的初始方法中處理</p><p>我們其實只要知道兩點，用戶手指按下的座標點和手指離開的座標點，然後進行比對，就能識別出用戶的意圖了</p><p>其實關於MotionEvent的幾個方法，大家估計都見怪不怪了，因為用的太多了</p><p>// 初始化</p><p>private void initView() {</p><p>// 識別手勢</p><p>setOnTouchListener(new OnTouchListener() {</p><p>// 起始點和偏移點</p><p>private float startX, startY, offsetX, offsetY;</p><p>@Override</p><p>public boolean onTouch(View v, MotionEvent event) {</p><p>/**</p><p>* 交互邏輯 :我們其實只要知道兩點，用戶手指按下的座標點和手指離開的座標點，然後進行比對，就能識別出用戶的意圖了</p><p>*/</p><p>switch (event.getAction()) {</p><p>// 手指按下</p><p>case MotionEvent.ACTION_DOWN:</p><p>// 記錄按下的x,y座標</p><p>startX = event.getX();</p><p>startY = event.getY();</p><p>break;</p><p>// 手指離開</p><p>case MotionEvent.ACTION_UP:</p><p>// 手指離開之後計算偏移量(離開的位置-按下的位置在進行判斷是往哪個方向移動)</p><p>offsetX = event.getX() - startX;</p><p>offsetY = event.getY() - startY;</p><p>// 開始識別方向</p><p>// offsetX 的絕對值大於offsetY的絕對值 說明在水平方向</p><p>if (Math.abs(offsetX) > Math.abs(offsetY)) {</p><p>// (直接&lt;0 會有些許誤差，我們可以 &lt;-5)</p><p>if (offsetX &lt; -5) {</p><p>// 左</p><p>System.out.println("左");</p><p>} else if (offsetX > 5) {</p><p>// 右</p><p>System.out.println("右");</p><p>}</p><p>// 開始計算垂直方向上下的滑動</p><p>} else {</p><p>if (offsetY &lt; -5) {</p><p>// 上</p><p>System.out.println("上");</p><p>} else if (offsetY > 5) {</p><p>// 下</p><p>System.out.println("下");</p><p>}</p><p>}</p><p>break;</p><p>}</p><p>return true;</p><p>}</p><p>});</p><p>}</p><p>上面的邏輯是不是非常的簡單，然後我們操作一下，看log</p><div class=pgc-img><img alt=Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/da2de7afc9bc4af5bf81270f3664a7c4><p class=pgc-img-caption></p></div><p>現在手勢識別也是很精準了，當然，我們的代碼設計也不能太過臃腫，所以，我們的操作邏輯就不在裡面編寫了，我們分別實現四個方向的方法</p><p>// 左</p><p>private void isLeft() {</p><p>}</p><p>// 右</p><p>private void isRight() {</p><p>}</p><p>// 上</p><p>private void isTop() {</p><p>}</p><p>// 下</p><p>private void isButtom() {</p><p>}</p><p>然後把輸出語句替換掉，監聽到哪個方向就執行哪個方法</p><p>//System.out.println("上，下，左，右");</p><p>private void isXXX() {</p><p>}</p><h1>四.實現方塊類CardView</h1><p>我們可以把這一個個卡片看作是一個對象，我們每次操作，他都要進行實例化</p><p>首先，我們新建一個類CardView繼承自FrameLayout，再裡面我們要考慮三點</p><p>>1.卡片</p><p>>2.卡片上的數字</p><p>>卡片相同的比較</p><p>package com.lgl.game2048;</p><p>import android.content.Context;</p><p>import android.widget.FrameLayout;</p><p>import android.widget.TextView;</p><p>public class CardView extends FrameLayout {</p><p>// 卡片數量</p><p>private int num = 0;</p><p>// 卡片文字</p><p>private TextView tv_num;</p><p>public CardView(Context context) {</p><p>super(context);</p><p>// 初始化TextView</p><p>tv_num = new TextView(getContext());</p><p>// 卡片文字大小</p><p>tv_num.setTextSize(20);</p><p>// 佈局控制器，填充滿整個父容器</p><p>LayoutParams lp = new LayoutParams(-1, -1);</p><p>addView(tv_num, lp);</p><p>setNum(0);</p><p>}</p><p>public int getNum() {</p><p>return num;</p><p>}</p><p>public void setNum(int num) {</p><p>this.num = num;</p><p>// 要呈現出來的文字（這裡要注意是String類型的）</p><p>tv_num.setText(num + "");</p><p>}</p><p>// 兩卡片相同的比較方法</p><p>public boolean equals(CardView card) {</p><p>return getNum() == card.getNum();</p><p>}</p><p>}</p><h1>五.動態分配方塊的寬高以及添加方塊</h1><p><strong>1.動態分配方塊的寬高</strong></p><p>寫到這裡，就有一個梗了，還是Android的老毛病，屏幕的適配問題，所以我們隊卡牌的寬高是不能做限定的，也就是說我們要去根據手機屏幕動態分配卡片的width和height，在這裡我們就得用到我之前一篇博客</p><p>[Android繪圖機制（一）——自定義View的基礎屬性和方法](http://blog.csdn.net/qq_26787115/article/details/50457413)</p><p>中提到的一個方法了</p><p>@Override</p><p>protected void onSizeChanged(int w, int h, int oldw, int oldh) {</p><p>// TODO Auto-generated method stub</p><p>super.onSizeChanged(w, h, oldw, oldh);</p><p>他負責我們的View在父容器的位置，所以我們動態分配高寬也是在他這裡面完成，首先，位置發生改變之後，我們得到的位置是一個確定數，但是為了防止用戶是橫放這手機，這就蛋疼了，所以我們得進行一個設置了</p><p>我們打開AndroidManifest.xml的activity標籤中加入</p><p>//禁止屏幕橫屏</p><p>android:screenOrientation="portrait"</p><p>好的，現在可以計算了</p><p>寬高求最小值 因為考慮到，我們的方陣他是正方形的，而手機屏幕是長方形的，這樣，我們的正方形要設置變長就得求長方形的寬，也就是最小值了</p><p>並且我們也不需要他填滿寬度，我們需要一點空隙，所以我們減去10個像素</p><div class=pgc-img><img alt=Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cccc9f254a924cbc82a8489bc774a03b><p class=pgc-img-caption></p></div><p>再讓他除以4，通過這種方式，我們就可以動態平分這個寬度了</p><p>int cardWidth = (Math.min(w, h)-10)/4;</p><p><strong>2.添加方塊</strong></p><p><strong>-1.添加卡片</strong></p><p>// 添加卡片,參數為卡片的寬高，因為他是正方形，所以寬高都是cardWidth</p><p>private void addCard(int cardWidth, int cardHeight) {</p><p>// 創建方塊</p><p>CardView c;</p><p>// 循環添加</p><p>for (int i = 0; i &lt; 4; i++) {</p><p>for (int j = 0; j &lt; 4; j++) {</p><p>c = new CardView(getContext());</p><p>// num為隨機數</p><p>c.setNum(2);</p><p>addView(c, cardWidth, cardHeight);</p><p>}</p><p>}</p><p>}</p><p>好的，我們來運行一下（換個AS2.0的模擬器感覺萌萌噠）</p><div class=pgc-img><img alt=Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/401f0face39842f9b42ebeb17850dcb2><p class=pgc-img-caption></p></div><p><strong>-2.方塊換行</strong></p><p>你會發現，並沒有4*4，而且一排沒有換行，我們回到GameView的initView()方法中添加</p><p>//換行</p><p>setColumnCount(4);</p><p>現在再看看</p><div class=pgc-img><img alt=Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/63575f2ed5e0426bac816d44bbb416b8><p class=pgc-img-caption></p></div><p><strong>-3.文字居中</strong></p><p>現在我們調整一下，讓文字居中，在CardView中</p><p>//文字居中</p><p>tv_num.setGravity(Gravity.CENTER);</p><div class=pgc-img><img alt=Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e45998b1be0f4214be3a6223ec69f579><p class=pgc-img-caption></p></div><p>現在是不是好看多了</p><p><strong>-4.方塊顏色</strong></p><p>```</p><p>//設置文字背景(暗卡其色)</p><p>tv_num.setBackgroundColor(0xffBDB76A);</p><p>```</p><div class=pgc-img><img alt=Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d1d0ebd95c3e4ef2953371a45ff2159f><p class=pgc-img-caption></p></div><p><strong>-5.方塊間距</strong></p><p>既然是方塊間隔，我們還是回到CardView裡面，還記得我們設置的LayoutParams嗎？你可能想到了吧，我們用Margins</p><p>//設置間距</p><p>lp.setMargins(10, 10, 0, 0);</p><div class=pgc-img><img alt=Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d31f5b596b2b4f11970c371f61523d6d><p class=pgc-img-caption></p></div><p><strong>-6.記憶方塊</strong></p><p>我們所操作之後，會有新生成的卡片，為了不重合，我們得做一個記憶功能</p><p>// 記錄卡片的二維數組</p><p>private CardView[][] cards = new CardView[4][4];</p><p>然後在addCard()方法中</p><p>//記憶</p><p>cards[j][i] = c;</p><h1>六.隨機數</h1><p>我們先來思考一下這個隨機數的邏輯，我們玩2048的時候，是不是開始新遊戲的時候會隨機出現兩個方塊，而這兩個方塊，他是隨機出現在4*4的任意位置的，所以，我們確定下來，一開始是兩個方塊的隨機出現，再接下來，我們會發現，他有時候是兩個2，但是有時候是一個2，一個4，這個4出現的機率有點小，而且我們作為遊戲規則制定者，這個也是我們控制的，這裡，我不想他出現的很容易，所以我這裡的邏輯就設置成1-9，這樣4出現的概率會小很多，好了，基本確定了，我們就開始寫代碼了，我們寫一個方法，在此之前，我們要對之前的代碼進行調整一下，在CardView中setNum方法中，我們默認為0就佔一格，</p><p>// 要呈現出來的文字（這裡要注意是String類型的）</p><p>if (num &lt;= 0) {</p><p>tv_num.setText("");</p><p>} else {</p><p>tv_num.setText(num + "");</p><p>}</p><p>然後把剛才的文字設置換成0</p><p>// c.setNum(2);</p><p>c.setNum(0);</p><p>然後我們就可以添加隨機數了，我們新建一個方法addRandom();</p><p>// 隨機數</p><p>private void addRandom() {</p><p>// 我們新建一個lsit存放空的方塊，操作之前清空</p><p>point.clear();</p><p>// 對所有的位置進行遍歷</p><p>for (int i = 0; i &lt; 4; i++) {</p><p>for (int j = 0; j &lt; 4; j++) {</p><p>// 空方塊才可以添加數字，有值我們就不添加</p><p>if (cards[j][i].getNum() &lt;= 0) {</p><p>point.add(new Point(j, i));</p><p>}</p><p>}</p><p>}</p><p>// for循環走完之後我們要取方塊</p><p>Point p = point.remove((int) (Math.random() * point.size()));</p><p>// 我們用Math.random()返回一個0-1的數，當大於0.1的時候是2否則就是4，也就是4出現的概率為十分之一</p><p>cards[p.x][p.y].setNum(Math.random() > 0.1 ? 2 : 4);</p><p>}</p><p>這個時候我們就可以開始遊戲了，為了方便等下我們需要重新開始遊戲，我們就新建一個startGame()方法，讓他在onSizeChanged()調用</p><p>// 開啟遊戲</p><p>private void startGame() {</p><p>// 既然是開始遊戲，我們就要對所有的值進行清理</p><p>for (int i = 0; i &lt; 4; i++) {</p><p>for (int j = 0; j &lt; 4; j++) {</p><p>cards[j][i].setNum(0);</p><p>}</p><p>}</p><p>// 重新添加隨機數</p><p>addRandom();</p><p>// 我們要添加兩個</p><p>addRandom();</p><p>}</p><p>好的，我們現在運行一下啊</p><div class=pgc-img><img alt=Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/146872a8714144f196b4043e0c0dc467><p class=pgc-img-caption></p></div><p>這正是我們要的效果，每次進入遊戲隨機生成兩個方塊，他會出現在不同的位置，而且會出現2和4，4的概率小很多</p><p><strong>七.實現方塊滑動，遞加邏輯</strong></p><p>好的，終於到了核心的東西了，這次我們就要用到之前所寫的上下左右方向方法了</p><p>// 左</p><p>private void isLeft() {</p><p>/**</p><p>* 這裡的邏輯有三種情況 1.左邊為空，直接左滑到最後一格 2.左邊碰到的第一個數是相等的，就相加 3.左邊碰到的第一個數是不相等的，靠在旁邊</p><p>*/</p><p>for (int i = 0; i &lt; 4; i++) {</p><p>for (int j = 0; j &lt; 4; j++) {</p><p>// 往左滑是一行一行去遍歷的</p><p>for (int j2 = j + 1; j2 &lt; 4; j2++) {</p><p>// 如果說遍歷到值</p><p>if (cards[j2][i].getNum() > 0) {</p><p>// 如果當前位置上為0,就放在這個位置上去</p><p>if (cards[j][i].getNum() &lt;= 0) {</p><p>cards[j][i].setNum(cards[j2][i].getNum());</p><p>// 把原來位置上的數字清除</p><p>cards[j2][i].setNum(0);</p><p>// 讓圖形繼續遍歷</p><p>j--;</p><p>// 有值，並且還相同</p><p>} else if (cards[j][i].equals(cards[j2][i])) {</p><p>// 合併,這裡做了一個很巧妙的寫法，我們相加，其實2048方塊上的數字都是雙倍的，所以我們只要原數據*2就可以了</p><p>cards[j][i].setNum(cards[j][i].getNum() * 2);</p><p>// 把原來位置上的數字清除</p><p>cards[j2][i].setNum(0);</p><p>}</p><p>break;</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><p>// 右</p><p>private void isRight() {</p><p>/**</p><p>* 這裡的邏輯有三種情況 1.左邊為空，直接左滑到最後一格 2.左邊碰到的第一個數是相等的，就相加 3.左邊碰到的第一個數是不相等的，靠在旁邊</p><p>*/</p><p>for (int i = 0; i &lt; 4; i++) {</p><p>for (int j = 3; j >= 0; j--) {</p><p>// 往左滑是一行一行去遍歷的</p><p>for (int j2 = j - 1; j2 >= 0; j2--) {</p><p>// 如果說遍歷到值</p><p>if (cards[j2][i].getNum() > 0) {</p><p>// 如果當前位置上為0,就放在這個位置上去</p><p>if (cards[j][i].getNum() &lt;= 0) {</p><p>cards[j][i].setNum(cards[j2][i].getNum());</p><p>// 把原來位置上的數字清除</p><p>cards[j2][i].setNum(0);</p><p>// 讓圖形繼續遍歷</p><p>j++;</p><p>// 有值，並且還相同</p><p>} else if (cards[j][i].equals(cards[j2][i])) {</p><p>// 合併,這裡做了一個很巧妙的寫法，我們相加，其實2048方塊上的數字都是雙倍的，所以我們只要原數據*2就可以了</p><p>cards[j][i].setNum(cards[j][i].getNum() * 2);</p><p>// 把原來位置上的數字清除</p><p>cards[j2][i].setNum(0);</p><p>}</p><p>break;</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><p>// 上</p><p>private void isTop() {</p><p>/**</p><p>* 這裡的邏輯有三種情況 1.左邊為空，直接左滑到最後一格 2.左邊碰到的第一個數是相等的，就相加 3.左邊碰到的第一個數是不相等的，靠在旁邊</p><p>*/</p><p>for (int j = 0; j &lt; 4; j++) {</p><p>for (int i = 0; i &lt; 4; i++) {</p><p>// 往左滑是一行一行去遍歷的</p><p>for (int i2 = i + 1; i2 &lt; 4; i2++) {</p><p>// 如果說遍歷到值</p><p>if (cards[j][i2].getNum() > 0) {</p><p>// 如果當前位置上為0,就放在這個位置上去</p><p>if (cards[j][i].getNum() &lt;= 0) {</p><p>cards[j][i].setNum(cards[j][i2].getNum());</p><p>// 把原來位置上的數字清除</p><p>cards[j][i2].setNum(0);</p><p>// 讓圖形繼續遍歷</p><p>i--;</p><p>// 有值，並且還相同</p><p>} else if (cards[j][i].equals(cards[j][i2])) {</p><p>// 合併,這裡做了一個很巧妙的寫法，我們相加，其實2048方塊上的數字都是雙倍的，所以我們只要原數據*2就可以了</p><p>cards[j][i].setNum(cards[j][i].getNum() * 2);</p><p>// 把原來位置上的數字清除</p><p>cards[j][i2].setNum(0);</p><p>}</p><p>break;</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><p>// 下</p><p>private void isButtom() {</p><p>/**</p><p>* 這裡的邏輯有三種情況 1.左邊為空，直接左滑到最後一格 2.左邊碰到的第一個數是相等的，就相加 3.左邊碰到的第一個數是不相等的，靠在旁邊</p><p>*/</p><p>for (int j = 0; j &lt; 4; j++) {</p><p>for (int i = 3; i >= 0; i--) {</p><p>// 往左滑是一行一行去遍歷的</p><p>for (int i2 = i - 1; i2 >= 0; i2--) {</p><p>// 如果說遍歷到值</p><p>if (cards[j][i2].getNum() > 0) {</p><p>// 如果當前位置上為0,就放在這個位置上去</p><p>if (cards[j][i].getNum() &lt;= 0) {</p><p>cards[j][i].setNum(cards[j][i2].getNum());</p><p>// 把原來位置上的數字清除</p><p>cards[j][i2].setNum(0);</p><p>// 讓圖形繼續遍歷</p><p>i++;</p><p>// 有值，並且還相同</p><p>} else if (cards[j][i].equals(cards[j][i2])) {</p><p>// 合併,這裡做了一個很巧妙的寫法，我們相加，其實2048方塊上的數字都是雙倍的，所以我們只要原數據*2就可以了</p><p>cards[j][i].setNum(cards[j][i].getNum() * 2);</p><p>// 把原來位置上的數字清除</p><p>cards[j][i2].setNum(0);</p><p>}</p><p>break;</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><p>四個方法的邏輯都是大同小異的，不過邏輯性還是很強的，大家可以適當的去研究一下然後我們多增加幾個方塊先來模擬下效果</p><div class=pgc-img><img alt=Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c86504398c3f47ed921092b6101f75d6><p class=pgc-img-caption></p></div><h1>八.計分</h1><p>方塊的邏輯差不多寫完了，我們先來就在MainActivity裡面來實現我們的Score計分</p><p><strong>MainActivity</strong></p><p>package com.lgl.game2048;</p><p>import android.app.Activity;</p><p>import android.os.Bundle;</p><p>import android.widget.TextView;</p><p>public class MainActivity extends Activity {</p><p>private TextView tv_score;</p><p>//外界可以訪問的實例</p><p>private static MainActivity mainActivity = null;</p><p>//積分器</p><p>private int score = 0;</p><p>public MainActivity() {</p><p>mainActivity = this;</p><p>}</p><p>@Override</p><p>protected void onCreate(Bundle savedInstanceState) {</p><p>super.onCreate(savedInstanceState);</p><p>setContentView(R.layout.activity_main);</p><p>tv_score = (TextView) findViewById(R.id.tv_score);</p><p>}</p><p>public static MainActivity getMainActivity() {</p><p>return mainActivity;</p><p>}</p><p>public static void setMainActivity(MainActivity mainActivity) {</p><p>MainActivity.mainActivity = mainActivity;</p><p>}</p><p>//清除分數</p><p>public void clearScore(){</p><p>score = 0;</p><p>showScore();</p><p>}</p><p>//分數</p><p>public void showScore(){</p><p>tv_score.setText("分數:"+score);</p><p>}</p><p>public void addScore(int s){</p><p>score += s;</p><p>showScore();</p><p>}</p><p>}</p><p>這是我們計分的過程，我們思考一下在什麼時候計分呢？想想就知道在滑動的時候倆值相加的時候開始計分，所以我們在四個滑動方法有值的判斷句中添加</p><p>//開始計分</p><p>MainActivity.getMainActivity().addScore(cards[j][i].getNum());</p><p>同時，我們在開始遊戲的時候要清零，所以我們在startGame方法中要添加</p><p>//計分清零</p><p>MainActivity.getMainActivity().clearScore();</p><h1>九.滑動後增加方塊</h1><p>我們默認進來是兩個方塊，但是滑動之後我們應該也要隨機增加方塊才能達到遊戲的邏輯，你說是吧！</p><p>所以，只要你滑動了，我們就要添加，一直到gameover結束為止，那我們依然在那四個方向方法裡寫</p><p>private void isxx(){</p><p>// 加個判斷是否可以添加</p><p>boolean isAdd = false;</p><p>for(....){</p><p>for(....){</p><p>for(....){</p><p>if(....){</p><p>if(....){</p><p>....</p><p>// 可以添加</p><p>isAdd = true;</p><p>}else if(....){</p><p>....</p><p>// 可以添加</p><p>isAdd = true;</p><p>}</p><p>}</p><p>}</p><p>}</p><p>}</p><p>// 開始進行判斷</p><p>if (isAdd) {</p><p>// 如果可以合併，我們添加隨機數</p><p>addRandom();</p><p>}</p><p>}</p><p>好的，我們現在來運行一下</p><div class=pgc-img><img alt=Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/46e1d767a3cd48ec8e58c93ee01ecb82><p class=pgc-img-caption></p></div><p>遊戲現在大體上是OK的了</p><h1>十.遊戲結束</h1><p>遊戲有始有終，我們現在就來判斷遊戲結束，遊戲結束有兩個前提</p><p>1.16個格子都是滿的</p><p>2.上下左右相鄰的格子都不相同</p><p>這樣的話我們就可以寫一個endGame方法，然後讓他在每次增加方塊的時候調用了</p><p>// 遊戲結束</p><p>private void endGame() {</p><p>// 在每次添加新的方塊的時候判斷一下</p><p>// 是否結束？</p><p>boolean isEnd = true;</p><p>ALL: // 標籤，讓break跳出整個循環</p><p>for (int i = 0; i &lt; 4; i++) {</p><p>for (int j = 0; j &lt; 4; j++) {</p><p>// 等於0的話遊戲沒有結束,或者上下左右還是有相同的數</p><p>if (cards[j][i].getNum() == 0</p><p>// 左</p><p>|| (j > 0 && cards[j][i].equals(cards[j - 1][i]))</p><p>// 右</p><p>|| (j &lt; 3) && cards[j][i].equals(cards[j + 1][i])</p><p>// 上</p><p>|| (i > 0 && cards[j][i].equals(cards[j][i - 1]))</p><p>// 下</p><p>|| (i &lt; 3 && cards[j][i].equals(cards[j][i + 1]))) {</p><p>// 說明遊戲沒有結束</p><p>isEnd = false;</p><p>break ALL;</p><p>}</p><p>}</p><p>}</p><p>if (isEnd) {</p><p>// 當isEnd = true的時候遊戲結束</p><p>new AlertDialog.Builder(getContext())</p><p>.setTitle("Sorry，遊戲結束！")</p><p>.setMessage("是否重新開始？")</p><p>.setPositiveButton("是",</p><p>new DialogInterface.OnClickListener() {</p><p>@Override</p><p>public void onClick(DialogInterface dialog,</p><p>int which) {</p><p>// 重新開始</p><p>startGame();</p><p>}</p><p>})</p><p>.setNegativeButton("否",</p><p>new DialogInterface.OnClickListener() {</p><p>@Override</p><p>public void onClick(DialogInterface dialog,</p><p>int which) {</p><p>}</p><p>}).show();</p><p>}</p><p>}</p><p>好的，現在我們可以來檢測一下了</p><div class=pgc-img><img alt=Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a42d79b6117a4428839779f8299de35a><p class=pgc-img-caption></p></div><h1>十一.優化之色塊</h1><p>我們的數字每個數字代表一種顏色，這裡我就簡單的寫點顏色，你們要是喜歡可以自己想改什麼就改什麼</p><p>在CardView中setnum方法裡</p><p>switch (num) {</p><p>case 0:</p><p>tv_num.setBackgroundColor(0xffBDB76A);</p><p>break;</p><p>case 2:</p><p>tv_num.setBackgroundColor(0xffeee4da);</p><p>break;</p><p>case 4:</p><p>tv_num.setBackgroundColor(0xffede0c8);</p><p>break;</p><p>case 8:</p><p>tv_num.setBackgroundColor(0xfff2b179);</p><p>break;</p><p>case 16:</p><p>tv_num.setBackgroundColor(0xfff59563);</p><p>break;</p><p>case 32:</p><p>tv_num.setBackgroundColor(0xfff67c5f);</p><p>break;</p><p>case 64:</p><p>tv_num.setBackgroundColor(0xfff65e3b);</p><p>break;</p><p>case 128:</p><p>tv_num.setBackgroundColor(0xffedcf72);</p><p>break;</p><p>case 256:</p><p>tv_num.setBackgroundColor(0xffedcc61);</p><p>break;</p><p>case 512:</p><p>tv_num.setBackgroundColor(0xffedc850);</p><p>break;</p><p>case 1024:</p><p>tv_num.setBackgroundColor(0xffedc53f);</p><p>break;</p><p>case 2048:</p><p>tv_num.setBackgroundColor(0xffedc22e);</p><p>break;</p><p>default:</p><p>tv_num.setBackgroundColor(0xff3c3a32);</p><p>break;</p><p>}</p><p>我們運行下</p><div class=pgc-img><img alt=Android遊戲2048方塊的設計實現，編寫，加上色彩，分數等功能 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4229ae6fbd354505ae64166f52b6cedd><p class=pgc-img-caption></p></div><p>Demo下載地址：http://download.csdn.net/detail/qq_26787115/9409068</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Android</a></li><li><a>遊戲</a></li><li><a>2048</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/75735682.html alt=不愧是騰訊！光靠遊戲一天血賺4.6億人民幣，你貢獻了多少？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/cc290697431a45ef916ee0c90f6ad0f6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/75735682.html title=不愧是騰訊！光靠遊戲一天血賺4.6億人民幣，你貢獻了多少？>不愧是騰訊！光靠遊戲一天血賺4.6億人民幣，你貢獻了多少？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/53b9bc9f.html alt=遊戲中讓女生瞬間“變軟”的4個行為，只要你敢做，她秒變乖乖女 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/55e72a47e1d1440dbd8309d0733d0879 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/53b9bc9f.html title=遊戲中讓女生瞬間“變軟”的4個行為，只要你敢做，她秒變乖乖女>遊戲中讓女生瞬間“變軟”的4個行為，只要你敢做，她秒變乖乖女</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1adf2386.html alt=熱血傳奇：遊戲衰落原因之一，永遠化不了的裝備 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/cf98bb665d4948c8aa1b2e266a6f8b29 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1adf2386.html title=熱血傳奇：遊戲衰落原因之一，永遠化不了的裝備>熱血傳奇：遊戲衰落原因之一，永遠化不了的裝備</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c1058aa2.html alt="Android Q下ANGLE圖形引擎性能測試  「農步祥」" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RXTy8D7HmsBWr1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c1058aa2.html title="Android Q下ANGLE圖形引擎性能測試  「農步祥」">Android Q下ANGLE圖形引擎性能測試 「農步祥」</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/26ad8f76.html alt="他改變了遊戲 創造了PS5的設計師馬克·賽爾尼是何方神聖？" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c1fc408121824536a65eeab130c7a3f7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/26ad8f76.html title="他改變了遊戲 創造了PS5的設計師馬克·賽爾尼是何方神聖？">他改變了遊戲 創造了PS5的設計師馬克·賽爾尼是何方神聖？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d0dc47b9.html alt=為了3D遊戲粉絲的超級街頭霸王4圖形講座後篇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/260f5287d04e49cfa88ba282876dcf0a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d0dc47b9.html title=為了3D遊戲粉絲的超級街頭霸王4圖形講座後篇>為了3D遊戲粉絲的超級街頭霸王4圖形講座後篇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7eb8afcd.html alt=遊戲引擎編程需要哪些基本數學知識？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3f6ca97249fa468db6982c44a024979d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7eb8afcd.html title=遊戲引擎編程需要哪些基本數學知識？>遊戲引擎編程需要哪些基本數學知識？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0ac13623.html alt="Android 11加入新功能：長期不用的APP自動關閉敏感權限" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/Rx4J9h84rlZBze style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0ac13623.html title="Android 11加入新功能：長期不用的APP自動關閉敏感權限">Android 11加入新功能：長期不用的APP自動關閉敏感權限</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/192b9f57.html alt="Android版Firefox 81將引入可自動關閉舊標籤頁的選項" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/SA9N6CXIS75NYa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/192b9f57.html title="Android版Firefox 81將引入可自動關閉舊標籤頁的選項">Android版Firefox 81將引入可自動關閉舊標籤頁的選項</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e3073c3d.html alt="Android端Firefox 81可定時關閉不使用的標籤頁" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/S9x6jJb18axAim style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e3073c3d.html title="Android端Firefox 81可定時關閉不使用的標籤頁">Android端Firefox 81可定時關閉不使用的標籤頁</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/53a48ea9.html alt=你所不知道的直線修正，FPS遊戲不容忽視的環節 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1530612252762fde73796f0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/53a48ea9.html title=你所不知道的直線修正，FPS遊戲不容忽視的環節>你所不知道的直線修正，FPS遊戲不容忽視的環節</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/355ed5a4.html alt=在Android中的工具欄中添加菜單 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a3572ad9d9fb487d8927f703f18179a0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/355ed5a4.html title=在Android中的工具欄中添加菜單>在Android中的工具欄中添加菜單</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b37aac89.html alt=【學習筆記】Android開發之kotlin語言（一） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ee3f9c8348ae4de58a5f62922d2042e1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b37aac89.html title=【學習筆記】Android開發之kotlin語言（一）>【學習筆記】Android開發之kotlin語言（一）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/514f2fe0.html alt=Android進階之路之網絡編程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/R6GseWQ6pTbxvr style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/514f2fe0.html title=Android進階之路之網絡編程>Android進階之路之網絡編程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d258b9eb.html alt="徹底凍結Android 應用後臺活動 讓他們不耗電、不聯網、不啟動" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/e4fd87bc-b2e5-40e2-841d-2e3dc5f9a2b9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d258b9eb.html title="徹底凍結Android 應用後臺活動 讓他們不耗電、不聯網、不啟動">徹底凍結Android 應用後臺活動 讓他們不耗電、不聯網、不啟動</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>