<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>好文推薦：微服務網關實戰—Spring Cloud Gateway | 极客快訊</title><meta property="og:title" content="好文推薦：微服務網關實戰—Spring Cloud Gateway - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/b94fdab501d3430ca916d7786df2d235"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ef5650a.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ef5650a.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5ef5650a.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ef5650a.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ef5650a.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5ef5650a.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5ef5650a.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ef5650a.html><meta property="article:published_time" content="2020-11-14T21:03:16+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:16+08:00"><meta name=Keywords content><meta name=description content="好文推薦：微服務網關實戰—Spring Cloud Gateway"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/5ef5650a.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>好文推薦：微服務網關實戰—Spring Cloud Gateway</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>作者：博雲BoCloud|</p><h1>前言</h1><div class=pgc-img><img alt="好文推薦：微服務網關實戰—Spring Cloud Gateway" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b94fdab501d3430ca916d7786df2d235><p class=pgc-img-caption></p></div><p>作為Netflix Zuul的替代者，Spring Cloud Gateway是一款非常實用的微服務網關，在Spring Cloud微服務架構體系中發揮非常大的作用。本文對Spring Cloud Gateway常見使用場景進行了梳理，希望對微服務開發人員提供一些幫助。</p><p>微服務網關SpringCloudGateway</p><h1>1.概述</h1><p>Spring cloud gateway是spring官方基於Spring 5.0、Spring Boot2.0和Project Reactor等技術開發的網關，Spring Cloud Gateway旨在為微服務架構提供簡單、有效和統一的API路由管理方式，Spring Cloud Gateway作為Spring Cloud生態系統中的網關，目標是替代Netflix Zuul，其不僅提供統一的路由方式，並且還基於Filer鏈的方式提供了網關基本的功能，例如：安全、監控/埋點、限流等。</p><h1>2.核心概念</h1><p>網關提供API全託管服務，豐富的API管理功能，輔助企業管理大規模的API，以降低管理成本和安全風險，包括協議適配、協議轉發、安全策略、防刷、流量、監控日誌等貢呢。一般來說網關對外暴露的URL或者接口信息，我們統稱為路由信息。如果研發過網關中間件或者使用過Zuul的人，會知道網關的核心是Filter以及Filter Chain（Filter責任鏈）。Sprig Cloud Gateway也具有路由和Filter的概念。下面介紹一下Spring Cloud Gateway中幾個重要的概念。</p><p>路由。路由是網關最基礎的部分，路由信息有一個ID、一個目的URL、一組斷言和一組Filter組成。如果斷言路由為真，則說明請求的URL和配置匹配</p><p>斷言。Java8中的斷言函數。Spring Cloud Gateway中的斷言函數輸入類型是Spring5.0框架中的ServerWebExchange。Spring Cloud Gateway中的斷言函數允許開發者去定義匹配來自於http request中的任何信息，比如請求頭和參數等。</p><p>過濾器。一個標準的Spring webFilter。Spring cloud gateway中的filter分為兩種類型的Filter，分別是Gateway Filter和Global Filter。過濾器Filter將會對請求和響應進行修改處理</p><p>Spring cloudGateway發出請求。然後再由Gateway Handler Mapping中找到與請求相匹配的路由，將其發送到Gateway web handler。Handler再通過指定的過濾器鏈將請求發送到我們實際的服務執行業務邏輯，然後返回。</p><h1>快速入門</h1><p>以Spring Boot框架開發為例，啟動一個Gateway服務模塊（以Consul作為註冊中心），一個後端服務模塊。client端請求經gateway服務把請求路由到後端服務。</p><p>前提條件：</p><ul><li>Consul：版本1.5.0。</li><li>Spring bot：版本2.1.5。</li><li>Spring cloud：版本Greenwich.SR1。</li><li>Redis：版本5.0.5。</li></ul><p>1.微服務開發</p><p>這裡以使用Spring Boot框架開發微服務為例，啟動一個服務並註冊到Consul。</p><p>引入依賴：</p><pre>&lt;dependency&gt;&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;&lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;&lt;/dependency&gt;</pre><p>註冊服務到Consul，配置文件配置如下：</p><pre>spring:application:name: service-consumercloud:consul: host: 127.0.0.1 port: 8500 discovery: service-name: service-consumer</pre><p>如下定義RestController，發佈HTTP接口。</p><pre>@RestController@RequestMapping("/user")public class UserController {@Resourceprivate UserService userService;@GetMapping(value = "/info")public User info() { return userService.info();}</pre><p>}</p><blockquote><p>注：此為服務端配置，經Gateway把請求路由轉發到該服務上。</p></blockquote><p>2.網關配置</p><p>創建一個Gateway服務，引入以下依賴：</p><pre>&lt;dependency&gt;&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;&lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;&lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;&lt;/dependency&gt;</pre><p>啟動類配置如下：</p><pre>@SpringBootApplication@EnableDiscoveryClientpublic class GatewayApplication {public static void main(String[] args) { SpringApplication.run(GatewayApplication.class, args);}</pre><p>}</p><p>Spring Cloud Gateway對client端請求起到路由功能，主要配置如下：</p><pre>server:port: 8098spring:application:name: service-gatewaycloud:gateway: discovery: locator: enabled: true  lower-case-service-id: true consul: host: 127.0.0.1 #註冊gateway網關到consul port: 8500 discovery: service-name: service-gateway</pre><p>此時使用http://localhost:8089/service-consumer/user/info訪問服務，網關即可對服務進行路由轉發，把請求轉發到具體後端服務上。此時，url中使用的url前綴service-consumer，是後端服務在Consul註冊的服務名稱轉為小寫字母以後的字符串。</p><h1>最佳實踐</h1><p><strong>01 Gateway網關配置</strong></p><p>本文第二部分開發規範中定義了網關進行路由轉發的配置，除了上述配置方式還可以使用下面的方式進行配置：</p><pre>gateway: discovery: locator: enabled: true lower-case-service-id: true routes: - id: service_consumer uri: lb://service-consumer predicates: - Path= /consumer/** filters: - StripPrefix=1</pre><p>在上面的配置中，配置了一個Path的predicat,將以/consumer/**開頭的請求都會轉發到uri為lb://service-consumer的地址上，lb://service-consumer（註冊中心中服務的名稱）即service-consumer服務的負載均衡地址，並用StripPrefix的filter 在轉發之前將/consumer去掉。同時將spring.cloud.gateway.discovery.locator.enabled改為false，如果不改的話，之前的http://localhost:8081/service-consumer/user/info這樣的請求地址也能正常訪問，因為這時為每個服務創建了2個router。</p><p>本文第二部分和本節一共講述了兩種配置方式，兩種配置都可以實現請求路由轉發的功能。參數spring.cloud.gateway.discovery.locator.enabled為true，表明Gateway開啟服務註冊和發現的功能，並且Spring Cloud Gateway自動根據服務發現為每一個服務創建了一個router，這個router將以服務名開頭的請求路徑轉發到對應的服務。spring.cloud.gateway.discovery.locator.lowerCaseServiceId是將請求路徑上的服務名配置為小寫（因為服務註冊的時候，向註冊中心註冊時將服務名轉成大寫的了）。</p><pre>gateway: discovery: locator: enabled: true lower-case-service-id: true</pre><p><strong>02 Gateway跨域訪問</strong></p><p>Spring Cloud Gateway還針對跨域訪問做了設計，可以使用以下配置解決跨域訪問問題：</p><pre>spring:cloud:gateway: globalcors: corsConfigurations: '[/**]': allowedOrigins: "https://docs.spring.io" allowedMethods: - GET allowHeaders: - Content-Type</pre><p>在上面的示例中，允許來自https://docs.spring.io的get請求進行訪問,並且表明服務器允許請求頭中攜帶字段Content-Type。</p><p><strong>03 Gateway 過濾器</strong></p><p>Spring Cloud Gateway的filter生命週期不像Zuul那麼豐富，它只有兩個：“pre”和“post”：</p><p>pre:這種過濾器在請求被路由之前調用。可以利用這個過濾器實現身份驗證、在集群中選擇請求的微服務、記錄調試的信息。</p><p>post：這種過濾器在路由到服務器之後執行。這種過濾器可用來為響應添加HTTP Header、統計信息和指標、響應從微服務發送給客戶端等。</p><p>Spring Cloud gateway的filter分為兩種：GatewayFilter和Globalfilter。GlobalFilter會應用到所有的路由上，而Gatewayfilter將應用到單個路由或者一個分組的路由上。</p><p>利用Gatewayfilter可以修改請求的http的請求或者是響應，或者根據請求或者響應做一些特殊的限制。更多時候可以利用Gatewayfilter做一些具體的路由配置。</p><p>下面的配置是AddRequestParameter Gatewayfilter的相關配置。</p><pre>spring:application:name: service-gatewaycloud:gateway: discovery: locator: enabled: true routes: - id: parameter_route uri: http://localhost:8504/user/info filters: - AddRequestParameter=foo, bar predicates: - Method=GET</pre><p>上述配置中指定了轉發的地址，設置所有的GET方法都會自動添加foo=bar,當請求符合上述路由條件時，即可在後端服務上接收到Gateway網關添加的參數。</p><p>另外再介紹一種比較常用的filter，即StripPrefix gateway filter。</p><p>配置如下：</p><pre>spring:cloud:gateway: routes: - id: stripprefixfilter uri: lb://service-consumer predicates: - Path=/consumer/** filters: - StripPrefix=1</pre><p>當client端使用http://localhost:8098/consumer/user/info路徑進行請求時，如果根據上述進行配置Gateway會將請求轉換為http://localhost:8098/service-consumer/user/info。以此作為前端請求的最終目的地。</p><p><strong>04 Gateway請求匹配</strong></p><p>Gateway網關可以根據不同的方式進行匹配進而把請求分發到不同的後端服務上。</p><p>通過header進行匹配，把請求分發到不同的服務上，配置如下：</p><pre>spring:cloud:gateway: routes: - id: header_route uri: http://baidu.com predicates: - Header=X-Request-Id, \d+</pre><p>通過curl測試：curl http://localhost:8080 -H "X-Request-Id:666666",返回頁面代碼證明匹配成功。</p><p>如果是以Host進行匹配，配置如下：</p><pre>spring:cloud:gateway: routes: - id: host_route uri: http://baidu.com predicates: - Host=**.baidu.com</pre><p>通過curl http://localhost:8098 -H "Host: www.baidu.com"進行測試，返回頁面代碼即轉發成功。</p><p>可以通過POST、GET、PUT、DELTE等不同的方式進行路由：</p><pre>spring:cloud:gateway: routes: - id: method_route uri: http://baidu.com predicates: - Method=GET</pre><p>通過 curl http://localhost:8098 進行測試，返回頁面代碼即表示成功。</p><p>上述是單個匹配進行路由，如果把多個匹配合在一起進行路由，必須滿足所有的路有條件才會進行路由轉發。</p><p><strong>05 Gateway熔斷</strong></p><p>Spring Cloud Gateway也可以利用Hystrix的熔斷特性，在流量過大時進行服務降級，同時項目中必須加上Hystrix的依賴。</p><pre>&lt;dependency&gt;&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;&lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;&lt;/dependency&gt; </pre><p>配置後，Gateway將使用fallbackcmd作為名稱生成HystrixCommand對象進行熔斷處理。如果想添加熔斷後的回調內容，需要添加以下配置：</p><pre>spring:cloud:gateway: routes: - id: hystrix_route uri: lb://consumer-service predicates: - Path=/consumer/** filters: - name: Hystrix args: name: fallbackcmd fallbackUri: forward:/fallback - StripPrefix=1hystrix: command:fallbackcmd: execution: isolation: thread: timeoutInMilliseconds: 5000 #超時時間，若不設置超時時間則有可能無法觸發熔斷</pre><p>上述配置中給出了熔斷之後返回路徑，因此，在Gateway服務模塊添加/fallback路徑，以作為服務熔斷時的返回路徑。</p><pre>@RestControllerpublic class GatewayController {@RequestMapping(value = "/fallback")public String fallback(){ return "fallback nothing";}</pre><p>}</p><p>fallbackUri: forward:/fallback配置了 fallback 時要會調的路徑，當調用 Hystrix 的 fallback 被調用時，請求將轉發到/fallback這個 URI，並以此路徑的返回值作為返回結果。</p><p><strong>06 Gateway重試路由器</strong></p><p>通過簡單的配置，Spring Cloud Gateway就可以支持請求重試功能。</p><pre>spring:cloud:gateway: routes: - id: header_route uri: http://localhost:8504/user/info predicates: - Path=/user/** filters: - name: Retry args: retries: 3 status: 503 - StripPrefix=1</pre><p>Retry GatewayFilter通過四個參數來控制重試機制，參數說明如下：</p><ul><li>retries：重試次數，默認值是 3 次。</li><li>statuses：HTTP 的狀態返回碼，取值請參考：org.springframework.http.HttpStatus。</li><li>methods：指定哪些方法的請求需要進行重試邏輯，默認值是 GET 方法，取值參考：org.springframework.http.HttpMethod。</li><li>series：一些列的狀態碼配置，取值參考：org.springframework.http.HttpStatus.Series。符合的某段狀態碼才會進行重試邏輯，默認值是 SERVER_ERROR，值是 5，也就是 5XX(5 開頭的狀態碼)，共有5個值。</li></ul><p>使用上述配置進行測試，當後臺服務不可用時，會在控制檯看到請求三次的日誌，證明此配置有效。</p><p><strong>07 Gateway 限流操作</strong></p><p>Spring Cloud Gateway本身集成了限流操作，Gateway限流需要使用Redis，pom文件中添加Redis依賴：</p><pre>&lt;dependency&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-starter-data-redis-reactive&lt;/artifactId&gt;&lt;/dependency&gt;</pre><p>配置文件中配置如下：</p><pre>spring:cloud:gateway: routes: - id: rate_limit_route uri: lb://service-consumer predicates: - Path=/user/** filters: - name: RequestRateLimiter args: key-resolver: "#{@hostAddrKeyResolver}" redis-rate-limiter.replenishRate: 1 redis-rate-limiter.burstCapacity: 3 - StripPrefix=1consul: host: 127.0.0.1 port: 8500 discovery: service-name: service-gateway instance-id: service-gateway-233redis:host: localhostport: 6379</pre><p>在上面的配置問價中，配置了Redis的信息，並配置了RequestRateLimiter的限流過濾器，該過濾器需要配置三個參數：</p><ul><li>BurstCapacity：令牌桶的總容量。</li><li>replenishRate：令牌通每秒填充平均速率。</li><li>Key-resolver：用於限流的解析器的Bean對象的名字。它使用SpEL表達式#{@beanName}從Spring容器中獲取bean對象。</li></ul><blockquote><p>注意：filter下的name必須是RequestRateLimiter。</p></blockquote><p>Key-resolver參數後面的bean需要自己實現，然後注入到Spring容器中。KeyResolver需要實現resolve方法，比如根據ip進行限流，則需要用hostAddress去判斷。實現完KeyResolver之後，需要將這個類的Bean註冊到Ioc容器中。還可以根據uri限流，同hostname限流是一樣的。例如以ip限流為例，在gateway模塊中添加以下實現：</p><pre>public class HostAddrKeyResolver implements KeyResolver {@Overridepublic Mono&lt;String&gt; resolve(ServerWebExchange exchange) { return Mono.just(exchange.getRequest().getRemoteAddress().getAddress().getHostAddress());}public HostAddrKeyResolver hostAddrKeyResolver() { return new HostAddrKeyResolver();}</pre><p>}</p><p>把該類注入到spring容器中：</p><pre>@SpringBootApplication@EnableDiscoveryClientpublic class GatewayApplication {public static void main(String[] args) { SpringApplication.run(GatewayApplication.class, args);}@Beanpublic HostAddrKeyResolver hostAddrKeyResolver(){ return new HostAddrKeyResolver();}</pre><p>}</p><p>基於上述配置，可以對請求基於ip的訪問進行限流。</p><p><strong>08 自定義Gatewayfilter</strong></p><p>Spring Cloud Gateway內置了過濾器，能夠滿足很多場景的需求。當然，也可以自定義過濾器。在Spring Cloud Gateway自定義過濾器，過濾器需要實現GatewayFilter和Ordered這兩個接口。</p><p>下面的例子實現了Gatewayfilter，它可以以log日誌的形式記錄每次請求耗費的時間，具體實現如下：</p><pre>public class RequestTimeFilter implements GatewayFilter, Ordered {private static final Log log = LogFactory.getLog(GatewayFilter.class);private static final String REQUEST_TIME_BEGIN = "requestTimeBegin";@Overridepublic Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) { exchange.getAttributes().put(REQUEST_TIME_BEGIN, System.currentTimeMillis()); return chain.filter(exchange).then( Mono.fromRunnable(() -&gt; { Long startTime = exchange.getAttribute(REQUEST_TIME_BEGIN); if (startTime != null) { log.info("請求路徑："+exchange.getRequest().getURI().getRawPath() + "消耗時間: " + (System.currentTimeMillis() - startTime) + "ms"); } }) );}@Overridepublic int getOrder() { return 0;}</pre><p>}</p><p>上述代碼中定義了自己實現的過濾器。Ordered的int getOrder（）方法是來給過濾器定優先級的，值越大優先級越低。還有一個filter(ServerWebExchange exchange, GatewayFilterChain chain)方法，在該方法中，先記錄了請求的開始時間，並保存在ServerWebExchange中，此處是一個“pre”類型的過濾器。然後再chain.filter()的內部類中的run()方法中相當於"post"過濾器，在此處打印了請求所消耗的時間。</p><p>接下來將該過濾器註冊到router中，代碼如下。</p><pre>@Beanpublic RouteLocator customerRouteLocator(RouteLocatorBuilder builder) { return builder.routes() .route(r -&gt; r.path("/user/**") .filters(f -&gt; f.filter(new RequestTimeFilter()) .addResponseHeader("X-Response-Default-Foo", "Default-Bar")) .uri("http://localhost:8504/user/info") .order(0) .id("customer_filter_router") ) .build();</pre><p>}</p><p>除了上述代碼的方式配置我們自定義的過濾器的方式之外，也可以在application.yml文件中直接配置，這裡不再贅述。</p><p>啟動程序，通過curl http://localhost:8098/user/info控制檯會打印出請求消耗時間，日誌如下：</p><pre>....2019-05-22 15:13:31.221 INFO 19780 --- [ctor-http-nio-4] o.s.cloud.gateway.filter.GatewayFilter : 請求路徑：/user/info消耗時間: 54ms...2019-05-22 16:46:23.785 INFO 29928 --- [ctor-http-nio-1] o.s.cloud.gateway.filter.GatewayFilter : 請求路徑：/user/info3消耗時間: 5ms....</pre><p><strong>09 自定義GlobalFilter</strong></p><p>Spring Cloud Gateway根據作用範圍分為GatewayFilter和GlobalFilter，二者區別如下：</p><p>GatewayFilter : 需要通過spring.cloud.routes.filters 配置在具體路由下，只作用在當前路由上或通過spring.cloud.default-filters配置在全局，作用在所有路由上。</p><p>GlobalFilter:全局過濾器，不需要在配置文件中配置，作用在所有的路由上，最終通過GatewayFilterAdapter包裝成GatewayFilterChain可識別的過濾器，它為請求業務以及路由的URI轉換為真實業務服務的請求地址的核心過濾器，不需要配置，系統初始化時加載，並作用在每個路由上。</p><p>在上一小節中定義的是Gatewayfilter，下面實現的是Globalfilter：</p><pre>public class TokenFilter implements GlobalFilter, Ordered {Logger logger= LoggerFactory.getLogger( TokenFilter.class );@Overridepublic Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) { String token = exchange.getRequest().getQueryParams().getFirst("token"); if (token == null || token.isEmpty()) { logger.info( "token 為空，無法進行訪問." ); exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED); return exchange.getResponse().setComplete(); } return chain.filter(exchange);}@Overridepublic int getOrder() { return 0;}</pre><p>}</p><p>上述代碼實現了Globalfilter，具體邏輯是判斷請求中是否含參數token，如果沒有，則校驗不通過，對所有請求都有效。如果含有token則轉發到具體後端服務上，如果沒有則校驗不通過。</p><p>通過curl http://localhost:8098/user/info進行訪問，因為路徑中不含有參數token，則無法通過校驗，打印日誌如下：</p><pre>2019-05-22 15:27:11.078 INFO 5956 --- [ctor-http-nio-1] com.song.gateway.TokenFilter : token 為空，無法進行訪問....</pre><p>通過curl http://localhost:8098/user/info?token=123進行訪問時，則可以獲取到後端服務返回結果。</p><h1><strong>最後</strong></h1><p>如果覺得本文對您有幫助的話，記得<strong>關注、轉發</strong>哦，我會為大家持續提供原創乾貨。需要資料，請<strong>關注、轉發，</strong>私信“資料”面試+微服務+springboot資料免費贈送。</p><p><strong>原文：http://www.dockone.io/article/8900</strong></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>好文</a></li><li><a>推薦</a></li><li><a>網關</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/75293feb.html alt=好文推薦｜你真的會審評普洱茶嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/42c556fb50c24bc5a1f3dd3fa32919de style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/75293feb.html title=好文推薦｜你真的會審評普洱茶嗎？>好文推薦｜你真的會審評普洱茶嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6a18e42f.html alt=好文推薦：終於有人把Elasticsearch原理講透了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2dad09ec37d34565b9a3a057fdf9c0c8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6a18e42f.html title=好文推薦：終於有人把Elasticsearch原理講透了>好文推薦：終於有人把Elasticsearch原理講透了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e55aaf9b.html alt="論文推薦 | 袁修孝：航攝影像密集匹配的研究進展與展望" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/R6Ieh75DBRtmcY style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e55aaf9b.html title="論文推薦 | 袁修孝：航攝影像密集匹配的研究進展與展望">論文推薦 | 袁修孝：航攝影像密集匹配的研究進展與展望</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4653cf8e.html alt=論文推薦｜王濤：國產機載大視場三線陣CCD相機GNSS偏心矢量和IMU視軸偏心角標定技術 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/R6Ieh75DBRtmcY style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4653cf8e.html title=論文推薦｜王濤：國產機載大視場三線陣CCD相機GNSS偏心矢量和IMU視軸偏心角標定技術>論文推薦｜王濤：國產機載大視場三線陣CCD相機GNSS偏心矢量和IMU視軸偏心角標定技術</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/43600b7e.html alt=推薦10個值得一去的國外神器網站！登錄無需任何手段，實用又有趣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8716c57443b84bf39d12f7181c19e5d7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/43600b7e.html title=推薦10個值得一去的國外神器網站！登錄無需任何手段，實用又有趣>推薦10個值得一去的國外神器網站！登錄無需任何手段，實用又有趣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c4bdc082.html alt=化學老師推薦：按元素歸類的初中化學方程式集合！考前複習好資料 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e672e532fceb4bde92dc10ca986250ad style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c4bdc082.html title=化學老師推薦：按元素歸類的初中化學方程式集合！考前複習好資料>化學老師推薦：按元素歸類的初中化學方程式集合！考前複習好資料</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5718fd72.html alt="論文推薦 | 閆廣峰：L1範數探測粗差失效的觀測量識別方法" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/R6W0QpMHySg0Qb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5718fd72.html title="論文推薦 | 閆廣峰：L1範數探測粗差失效的觀測量識別方法">論文推薦 | 閆廣峰：L1範數探測粗差失效的觀測量識別方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1fb68281.html alt=新品推薦｜你要的三防漆新品來啦 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/0d18e71454334714a9ab8ac0e0e8d019 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1fb68281.html title=新品推薦｜你要的三防漆新品來啦>新品推薦｜你要的三防漆新品來啦</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d2c7df1e.html alt=「論文推薦」左建平教授談岩層移動研究進展及重點 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RmTmvrAHAwNOUb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d2c7df1e.html title=「論文推薦」左建平教授談岩層移動研究進展及重點>「論文推薦」左建平教授談岩層移動研究進展及重點</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/811e0e2a.html alt=中科地信推薦丨這些地質動圖，帶你看盡地球板塊變化理解地質構造 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/1622aa4e323b417592715cfb657cdede style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/811e0e2a.html title=中科地信推薦丨這些地質動圖，帶你看盡地球板塊變化理解地質構造>中科地信推薦丨這些地質動圖，帶你看盡地球板塊變化理解地質構造</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6d77a0e0.html alt=「論文推薦」郭廣禮等：無井式煤炭地下氣化岩層及地表移動與控制 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ReafrDd7EHXniF style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6d77a0e0.html title=「論文推薦」郭廣禮等：無井式煤炭地下氣化岩層及地表移動與控制>「論文推薦」郭廣禮等：無井式煤炭地下氣化岩層及地表移動與控制</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/52d575a2.html alt=如何在轉轉輕鬆賣出二手物品？吐血推薦這幾條實戰經驗 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/c54abd15210f441ebd596b09560bbeca style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/52d575a2.html title=如何在轉轉輕鬆賣出二手物品？吐血推薦這幾條實戰經驗>如何在轉轉輕鬆賣出二手物品？吐血推薦這幾條實戰經驗</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a262c260.html alt=6.28今日競彩推薦 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a262c260.html title=6.28今日競彩推薦>6.28今日競彩推薦</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d29327f0.html alt=螺栓擰緊力矩及標準，軸承小白推薦 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/9b23578e-89f1-4726-84a3-1d7bf909d4b8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d29327f0.html title=螺栓擰緊力矩及標準，軸承小白推薦>螺栓擰緊力矩及標準，軸承小白推薦</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a677af22.html alt="文件櫃尺寸一般是多少 文件櫃廠家推薦" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/RBVyEQ2EzlJKba style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a677af22.html title="文件櫃尺寸一般是多少 文件櫃廠家推薦">文件櫃尺寸一般是多少 文件櫃廠家推薦</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>