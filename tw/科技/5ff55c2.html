<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>寫一個java工具從數據庫生成實體類 | 极客快訊</title><meta property="og:title" content="寫一個java工具從數據庫生成實體類 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ff55c2.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ff55c2.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5ff55c2.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ff55c2.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ff55c2.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5ff55c2.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/5ff55c2.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/5ff55c2.html><meta property="article:published_time" content="2020-10-29T20:59:31+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:31+08:00"><meta name=Keywords content><meta name=description content="寫一個java工具從數據庫生成實體類"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/5ff55c2.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>寫一個java工具從數據庫生成實體類</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p><strong>開始寫之前的說明</strong></p><p>​ 這只是一個簡單的解析數據庫建表語句之後，根據解析結果生成java文件的一個簡單工具。寫的原因有兩個。</p><p>​ 1：項目中沒有人寫實體類的註釋，字段的註釋，現有的工具也沒法根據數據庫的註釋自動添加到class文件上。</p><p>​ 2：自己寫一個也似乎不是很難。</p><p>​ 所以就自己寫了一個。</p><p>這裡在生成java文件的時候用的是<strong>freemarker</strong>。用了<strong>jdbc</strong>作為執行sql的工具。</p><p>這個項目已經放在github上了，地址：https://github.com/hjx601496320/entityMaker 。</p><p><strong>用到的依賴：</strong></p><pre>&lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.freemarker&lt;/groupId&gt; &lt;artifactId&gt;freemarker&lt;/artifactId&gt; &lt;version&gt;2.3.28&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.45&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.mchange&lt;/groupId&gt; &lt;artifactId&gt;c3p0&lt;/artifactId&gt; &lt;version&gt;0.9.5.2&lt;/version&gt;&lt;/dependency&gt;</pre><p><strong>獲取數據庫中的所有的表名稱</strong></p><p>想要根據數據庫中的建表語句來創建java文件首先要先知道數據庫中都有那些表。so，開始。</p><p><strong>配置數據庫的相關信息</strong></p><p>在獲取數據庫鏈接前，我們先寫一個文件用來保存數據庫鏈接的各種信息。</p><p>新建文件<strong>config.xml</strong></p><pre>&lt;xml&gt; &lt;jdbc.url&gt;&lt;/jdbc.url&gt; &lt;jdbc.username&gt;&lt;/jdbc.username&gt; &lt;jdbc.password&gt;&lt;/jdbc.password&gt;&lt;/xml&gt;</pre><p><strong>jdbc.url</strong>：鏈接數據庫的url。例如：jdbc:mysql://127.0.0.1:3306/demo?useSSL=true</p><p><strong>jdbc.username</strong>：數據庫的用戶名。</p><p><strong>jdbc.password</strong>：數據庫的密碼。</p><p>這樣就配置好了。</p><p><strong>寫一個工具類讀取xml：XmlUtils.java</strong></p><pre>import org.w3c.dom.Document;import javax.xml.parsers.DocumentBuilder;import javax.xml.parsers.DocumentBuilderFactory;import java.io.ByteArrayInputStream;import java.io.InputStream;import java.util.Scanner;/** * 讀取xml */public class XmlUtils { /** * 讀取 Document * * @param xmlPath * @return */ public static Document getConfigDocument(String xmlPath) { try { InputStream resourceAsStream = Thread.currentThread().getContextClassLoader().getResourceAsStream(xmlPath); Scanner scanner = new Scanner(resourceAsStream); StringBuilder stringBuilder = new StringBuilder(); while (scanner.hasNextLine()) { stringBuilder.append(scanner.nextLine()).append("\n"); } DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance(); DocumentBuilder documentBuilde = documentBuilderFactory.newDocumentBuilder(); Document document = documentBuilde.parse(new ByteArrayInputStream(stringBuilder.toString().getBytes())); return document; } catch (Exception e) { e.printStackTrace(); return null; } }}</pre><p><strong>打開數據庫鏈接</strong></p><pre>//獲取數據庫配置信息Document configXml = XmlUtils.getConfigDocument(CONFIG_PATH);Element element = configXml.getDocumentElement();String jdbcUrl = element.getElementsByTagName("jdbc.url").item(0).getTextContent();String username = element.getElementsByTagName("jdbc.username").item(0).getTextContent();String password = element.getElementsByTagName("jdbc.password").item(0).getTextContent();//打開數據庫鏈接Connection conn = (Connection) DriverManager.getConnection(jdbcUrl, username, password);</pre><p>獲取到鏈接之後，下一步就是要讀取數據庫中的表數據了。</p><p><strong>獲取數據庫中的表</strong></p><pre>Statement statement = connection.createStatement();ResultSet resultSet = statement.executeQuery("SHOW TABLES;");while (resultSet.next()) { //這裡就獲取到了數據庫中的所有的表的名稱了。 String tableName = resultSet.getString(1);}</pre><p>這裡拿到表名稱後就可以依次得到建表語句，並解析建表語句了。</p><p>這裡之所以使用解析建表語句的方法是因為這樣可以比較完整的得到註釋信息。用另一種方法的時候表的註釋一直獲取不到（另一種方法我忘記怎麼說了～）。</p><p><strong>得到建表語句</strong></p><p>這裡就是拼接sql，然後執行就好了。下面是代碼：</p><pre>Statement statement = connection.createStatement();ResultSet resultSet = statement.executeQuery("show CREATE TABLE 表名稱");while (resultSet.next()) { //這裡就得到了表的建表語句 String createTableSql = resultSet.getString(2);}</pre><p>做到這一步，我們就完整的得到了數據庫中的所有的建表語句了。接下來就是要分析建表語句並且用來生成實體類了。</p><p><strong>建表語句分析</strong></p><p><strong>建表sql</strong></p><p>下面是執行 sql <strong>show create table user</strong> 的結果：</p><pre>CREATE TABLE `user` (  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '用戶id',  `name` varchar(225) DEFAULT NULL COMMENT '用戶名',  `create_date` datetime DEFAULT NULL,  `status` int(11) DEFAULT NULL,  `age` int(11) DEFAULT NULL COMMENT '年齡',  `mark` varchar(225) DEFAULT NULL,  PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=2104778081 DEFAULT CHARSET=latin1 COMMENT='用戶表' </pre><p>這裡可以看出，要創建的實體類的名稱就在第一行的<strong>CREATE TABLE</strong> 後的兩個<strong>`</strong>符號中間，這樣我們就可以通過正則將表的名稱取出來，然後轉換成為我們需要的class名稱。首先我們先寫一個通過正則提取數據的方法，下面是代碼：</p><p><strong>正則代碼</strong></p><pre> /** * 根據正則查找 * * @param sql * @param pattern * @param group * @return */ static String getByPattern(String sql, String pattern, int group) { Pattern compile = Pattern.compile(pattern); Matcher matcher = compile.matcher(sql); while (matcher.find()) { return matcher.group(group); } return null; }</pre><p>現在開始從建表語句中提取table的名稱（雖然在獲得數據庫所有表的時候就已經知道了，但是在寫一次也沒有什麼問題不是嗎 ~~~），下面是代碼：</p><p><strong>獲取表的名稱</strong></p><pre> /** * 獲得表的名稱 * * @param sql * @return */ public static String getTableName(String sql) { return getByPattern(sql, "CREATE TABLE `(.*)`", 1); }</pre><p>這裡就已經將表的名稱取出來了。</p><p>接下來是獲取表上的註釋，這裡我們取表的註釋。下面是代碼：</p><p><strong>提取表註釋</strong></p><pre> public static String getTableComment(String sql) { return getByPattern(sql, "\\) .* COMMENT='(.*)'", 1); }</pre><p>現在開始獲取id信息。</p><p><strong>獲取id</strong></p><p>獲取id依然是使用正則就好了，代碼如下：</p><pre>public static String getId(String sql) { return getByPattern(sql, "PRIMARY KEY \\(`(.*)`\\)", 1);}</pre><p>因為原本語句中有一對括號，所以在這裡對外面的括號做了轉義處理。接下來開始提取數據庫中的字段，字段類型，字段註釋。</p><p><strong>字段，字段類型，字段註釋</strong></p><p><strong>先取出來建表語句中的和字段相關的sql</strong></p><p>2019年01月21日，修改：</p><p>沒想到有的表裡沒有id，就導致下面的代碼執行後出錯了，修改一下結束的判斷。</p><pre> /** * 獲取建表語句中和字段相關的sql * * @param sql * @return */ public static List&lt;String&gt; getColumnSqls(String sql) { List&lt;String&gt; lines = new ArrayList&lt;&gt;(); Scanner scanner = new Scanner(sql); boolean start = false; while (scanner.hasNextLine()) { String nextLine = scanner.nextLine(); if (nextLine.indexOf("CREATE TABLE") != -1) { start = true; continue; } //沒想到有的表沒有id /(ㄒoㄒ)/~~ if (nextLine.indexOf("PRIMARY KEY") != -1 || nextLine.indexOf("ENGINE=") != -1) { start = false; continue; } if (start) { lines.add(nextLine); } } return lines; }</pre><p>這裡的運行結果是：</p><pre> `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '用戶id',  `name` varchar(225) DEFAULT NULL COMMENT '用戶名',  `create_date` datetime DEFAULT NULL,  `status` int(11) DEFAULT NULL,  `age` int(11) DEFAULT NULL COMMENT '年齡',  `mark` varchar(225) DEFAULT NULL, </pre><p>這也就取到了table中所有的字段相關信息了，接下來我們來獲取字段名稱：</p><p><strong>獲取列名，註釋，數據類型</strong></p><pre>List&lt;String&gt; columns = SqlUtils.getColumnSqls(sql);for (String oneLine : columns) { System.out.println(oneLine); String columnName = SqlUtils.getByPattern(oneLine, "`(.*)`", 1); String comment = SqlUtils.getByPattern(oneLine, "COMMENT '(.*)'", 1); String columnType = SqlUtils.getByPattern(oneLine, "`" + columnName + "` ([A-Za-z]*)", 1); System.out.printf("名稱：%-20s 類型：%-20s 註釋：%-20s \n", columnName, columnType, comment);}</pre><p>輸出結果：</p><pre> `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '用戶id', 名稱：id 類型：int 註釋：用戶id  `name` varchar(225) DEFAULT NULL COMMENT '用戶名', 名稱：name 類型：varchar 註釋：用戶名  `create_date` datetime DEFAULT NULL, 名稱：create_date 類型：datetime 註釋：null  `status` int(11) DEFAULT NULL, 名稱：status 類型：int 註釋：null  `age` int(11) DEFAULT NULL COMMENT '年齡', 名稱：age 類型：int 註釋：年齡  `mark` varchar(225) DEFAULT NULL, 名稱：mark 類型：varchar 註釋：null</pre><p>到了這，我就就已經從建表語句裡拿到了所有需要的數據了，下面就開始使用這些數據來生成java文件了。</p><p><strong>根據上面獲取的數據開始創建java文件</strong></p><p>終於開始要創建java文件了。</p><p>但是～在創建java文件的時候要先吧之前獲取的數稍微處理一下，將sql中的格式轉換為java中的格式。比如屬性名稱，數據類型，class名稱之類的，現在開始～</p><p><strong>將表名稱轉換為合適的class名稱</strong></p><p>就是首字母大寫，駝峰式的命名規範。例如將<strong>user_log</strong>或者<strong>USER_LOG</strong>轉換為UserLog。</p><p>我們可以這麼寫：</p><pre> /** * 類名稱轉換 * * @param tableName * @return */ public static String entityName(String tableName) { String lowerCaseName = tableName.toLowerCase(); StringBuilder newName = new StringBuilder(); char[] chars = lowerCaseName.toCharArray(); boolean change = false; for (int i = 0; i &lt; chars.length; i++) { char aChar = chars[i]; if (aChar == '_' &amp;&amp; !change) { change = true; continue; } //首字母大寫 if (i == 0) { aChar = Character.toUpperCase(aChar); } if (change) { aChar = Character.toUpperCase(aChar); change = false; } newName.append(aChar); } return newName.toString(); }</pre><p>這樣就得到了我們需要的class的名稱了。</p><p><strong>將字段名稱轉換為java中的屬性名稱</strong></p><p>這裡就是將上一步操作的首字母大寫去掉就好了，下面是代碼：</p><pre> /** * 屬性名稱轉換 * * @param name * @return */ public static String fieldName(String name) { name = name.toLowerCase(); StringBuilder newName = new StringBuilder(); char[] chars = name.toCharArray(); boolean change = false; for (int i = 0; i &lt; chars.length; i++) { char aChar = chars[i]; if (aChar == '_' &amp;&amp; !change) { change = true; continue; } if (change) { aChar = Character.toUpperCase(aChar); change = false; } newName.append(aChar); } return newName.toString(); }</pre><p>接下來是將sql中的數據類型轉換為java中的數據類型。</p><p><strong>sql數據類型轉換</strong></p><p>這裡用map做了一個映射，有自己特定要求的可以自己修改。</p><pre>public class ColumnFieldTypeMapping { private Map&lt;String, Class&gt; sqlFieldTypeMapping = new HashMap&lt;&gt;(); { sqlFieldTypeMapping.put("VARCHAR", String.class); sqlFieldTypeMapping.put("CHAR", String.class); sqlFieldTypeMapping.put("TEXT", String.class); sqlFieldTypeMapping.put("MEDIUMTEXT", String.class); sqlFieldTypeMapping.put("LONGTEXT", String.class); sqlFieldTypeMapping.put("TINYTEXT", String.class); sqlFieldTypeMapping.put("BIT", Boolean.class); sqlFieldTypeMapping.put("INT", int.class); sqlFieldTypeMapping.put("BIGINT", long.class); sqlFieldTypeMapping.put("DOUBLE", double.class); sqlFieldTypeMapping.put("TINYINT", int.class); sqlFieldTypeMapping.put("FLOAT", float.class); sqlFieldTypeMapping.put("DECIMAL", BigDecimal.class); sqlFieldTypeMapping.put("INT UNSIGNED", int.class); sqlFieldTypeMapping.put("BIGINT UNSIGNED", int.class); sqlFieldTypeMapping.put("DECIMAL UNSIGNED", BigDecimal.class); sqlFieldTypeMapping.put("DATETIME", Date.class); sqlFieldTypeMapping.put("TIME", Date.class); sqlFieldTypeMapping.put("DATE", Date.class); sqlFieldTypeMapping.put("TIMESTAMP", Date.class); } /** * 根據sql數據類型獲取Java數據類型 * * @param columnType * @return */ public Class getFieldType(String columnType) { Class aClass = sqlFieldTypeMapping.get(columnType); if (aClass == null) { return sqlFieldTypeMapping.get(columnType.toUpperCase()); } return null; }}</pre><p>寫到這裡，所有參與生成java文件的信息就已經獲取完成了。</p><p>這時候我們需要把他們組裝起來，用來放進freemarker中來解析並生成java文件中的內容。</p><p><strong>組裝參數</strong></p><p>這裡可能我以後用這個代碼幹別的事情所以我建了兩個類，一個是<strong>ClassModel.java</strong>，一個是<strong>EntityModel.java</strong>。</p><p>EntityModel繼承了ClassModel。我們主要用的是<strong>EntityModel.java</strong>。下面是代碼：</p><pre>import java.util.*;/** * 用於生成java Entity文件的類 */public class ClassModel { /** * java 中不需要引包的類型 */ private static List&lt;Class&gt; baseClass = Arrays.asList( int.class, double.class, float.class, long.class, short.class, byte.class, char.class, boolean.class, String.class ); /** * 類註釋 */ private String classDoc; /** * 類名 */ private String className; /** * 類 包名 */ private String packageName; /** * K:屬性名稱 * V:屬性類型 */ private Map&lt;String, Class&gt; fields = new HashMap&lt;&gt;(); /** * 屬性的註釋 */ private Map&lt;String, String&gt; fieldDoc = new HashMap&lt;&gt;(); ; private List&lt;Class&gt; imports = new ArrayList&lt;&gt;(); /** * 添加需要導入的包 * * @param importClass */ public void addImport(Class importClass) { if (baseClass.indexOf(importClass) != -1) { return; } if (imports.indexOf(importClass) == -1) { imports.add(importClass); } } /** * 添加屬性 * * @param fieldName 屬性名稱 * @param fieldClass 屬性類型 */ public void addfield(String fieldName, Class fieldClass) { if (!fields.containsKey(fieldName)) { fields.put(fieldName, fieldClass); } } /** * 添加屬性註釋 * * @param fieldName 屬性名稱 * @param fieldDoc 屬性註釋 */ public void addfieldDoc(String fieldName, String fieldDoc) { if (!this.fieldDoc.containsKey(fieldName)) { this.fieldDoc.put(fieldName, fieldDoc); } } public List&lt;Class&gt; getImports() { return imports; } public void setImports(List&lt;Class&gt; imports) { this.imports = imports; } public String getClassDoc() { return classDoc; } public void setClassDoc(String classDoc) { this.classDoc = classDoc; } public String getClassName() { return className; } public void setClassName(String className) { this.className = className; } public String getPackageName() { return packageName; } public void setPackageName(String packageName) { this.packageName = packageName; } public Map&lt;String, Class&gt; getFields() { return fields; } public void setFields(Map&lt;String, Class&gt; fields) { this.fields = fields; } public Map&lt;String, String&gt; getFieldDoc() { return fieldDoc; } public void setFieldDoc(Map&lt;String, String&gt; fieldDoc) { this.fieldDoc = fieldDoc; } @Override public String toString() { final StringBuilder sb = new StringBuilder("{"); sb.append(" \"classDoc\"=\"").append(classDoc).append('\"'); sb.append(", \"className\"=\"").append(className).append('\"'); sb.append(", \"packageName\"=\"").append(packageName).append('\"'); sb.append(", \"fields\"=").append(fields); sb.append(", \"fieldDoc\"=").append(fieldDoc); sb.append(", \"imports\"=").append(imports); sb.append('}'); return sb.toString(); }}import java.util.ArrayList;import java.util.HashMap;import java.util.List;import java.util.Map;/** * 數據庫映射 */public class EntityModel extends ClassModel { /** * 數據庫名稱 */ private String tableName; /** * 數據庫中的Id字段名稱 */ private List&lt;String&gt; idColumnNames = new ArrayList&lt;&gt;(); /** * 類屬性名對應數據庫字段映射 * key: class 屬性名稱 * value：數據庫字段名 */ private Map&lt;String, String&gt; fieldSqlName = new HashMap&lt;&gt;(); /** * 添加class 屬性映射和 數據庫 字段映射 * * @param fieldName * @param sqlName */ public void addfieldSqlName(String fieldName, String sqlName) { if (!fieldSqlName.containsKey(fieldName)) { fieldSqlName.put(fieldName, sqlName); } } /** * 添加id字段名 * * @param idColumnName */ public void addIdColumnName(String idColumnName) { idColumnNames.add(idColumnName); } public String getTableName() { return tableName; } public void setTableName(String tableName) { this.tableName = tableName; } public Map&lt;String, String&gt; getFieldSqlName() { return fieldSqlName; } public void setFieldSqlName(Map&lt;String, String&gt; fieldSqlName) { this.fieldSqlName = fieldSqlName; } public List&lt;String&gt; getIdColumnNames() { return idColumnNames; } public void setIdColumnNames(List&lt;String&gt; idColumnNames) { this.idColumnNames = idColumnNames; }}</pre><p>在這裡將從數據庫中得到的數據都組裝好，就可以使用freemarker來生成Java文件的內容了。下面是代碼：</p><pre>/** * 根據建表語句組裝EntityModel * * @param createTableSql * @return */EntityModel makeModelBySql(String createTableSql) { Formatter formatter = new Formatter(); EntityModel model = new EntityModel(); String tableComment = SqlUtils.getTableComment(createTableSql); String tableName = SqlUtils.getTableName(createTableSql); String id = SqlUtils.getId(createTableSql); model.addIdColumnName(id); model.setClassName(NameConvert.entityName(tableName)); model.setTableName(tableName); //註釋是null的時候用數據庫表名作為註釋 model.setClassDoc(tableComment == null ? tableName : tableComment); List&lt;String&gt; line = SqlUtils.getColumnSqls(createTableSql); for (String oneLine : line) { String columnName = SqlUtils.getByPattern(oneLine, "`(.*)`", 1); String comment = SqlUtils.getByPattern(oneLine, "COMMENT '(.*)'", 1); String columnType = SqlUtils.getByPattern(oneLine, "`" + columnName + "` ([A-Za-z]*)", 1); String fieldName = NameConvert.fieldName(columnName); Class fieldClass = columnFieldTypeMapping.getFieldType(columnType); if (fieldClass == null) { formatter.format("table:%s columnName:%s sql類型:%s 沒有映射類型", tableName, columnName, columnType); throw new UnsupportedOperationException(formatter.toString()); } model.addfield(fieldName, fieldClass); //字段註釋是null的時候用數據庫字段名作為註釋 model.addfieldDoc(fieldName, comment == null ? columnName : comment); model.addfieldSqlName(fieldName, columnName); model.addImport(fieldClass); } return model;}</pre><p>這樣一個我們需要的參數就組裝好了。現在開始編寫freemarker用的代碼。</p><p><strong>freemarker工具類</strong></p><p>用來加載freemarker模板和處理模板中的參數。<strong>FreeMarkerUtils.java</strong>,代碼如下：</p><pre>import freemarker.cache.StringTemplateLoader;import freemarker.template.Configuration;import freemarker.template.DefaultObjectWrapper;import freemarker.template.Template;import java.io.StringWriter;import java.io.Writer;import java.util.Locale;import java.util.Scanner;public class FreeMarkerUtils { /** * freemarker工具， * * @param subjectParams * @param templetPath * @return * @throws Exception */ public static String getJavaClass(Object subjectParams, String templetPath) throws Exception { StringTemplateLoader loader = new StringTemplateLoader(); Scanner scanner = new Scanner(Thread.currentThread().getContextClassLoader().getResourceAsStream(templetPath)); StringBuilder builder = new StringBuilder(); while (scanner.hasNext()) { builder.append(scanner.nextLine()).append("\n"); } String name = System.currentTimeMillis() + ""; loader.putTemplate(name, builder.toString()); //第一步：實例化Freemarker的配置類 Configuration conf = new Configuration(); conf.setObjectWrapper(new DefaultObjectWrapper()); conf.setLocale(Locale.CHINA); conf.setDefaultEncoding("utf-8"); conf.setTemplateLoader(loader); //處理空值為空字符串 conf.setClassicCompatible(true); Template template = conf.getTemplate(name); Writer out = new StringWriter(2048); template.process(subjectParams, out); String javaClass = out.toString(); return javaClass; }}</pre><p>現在有了工具類之後，還不能立即開始生成java文件，因為還要繼續設置java的package和生成文件的路徑，這時候我們可以修改之前寫的<strong>config.xml</strong></p><p><strong>修改config.xml</strong></p><pre>&lt;xml&gt; &lt;jdbc.url&gt;&lt;/jdbc.url&gt; &lt;jdbc.username&gt;&lt;/jdbc.username&gt; &lt;jdbc.password&gt;&lt;/jdbc.password&gt; &lt;basePath&gt;/home/hjx/work/demo/src/main/java&lt;/basePath&gt; &lt;entityPackage&gt;top.hejiaxuan.demo.entity&lt;/entityPackage&gt;&lt;/xml&gt;</pre><p>這裡添加了兩個參數：<strong>basePath</strong>和<strong>entityPackage</strong>。一個是要生成java的文件的路徑，一個是java文件的包名。</p><p>然後我們再寫一個寫出文件的工具類<strong>FileUtils.java</strong></p><p><strong>編寫FileUtils.java</strong></p><pre>import java.io.*;public class FileUtils { /** * 寫入文件 * * @param path 文件路徑 * @param content 文件內容 */ public static void write(String path, String content) { File file = new File(path); File parentFile = file.getParentFile(); try { if (!parentFile.exists()) { parentFile.mkdirs(); } if (!file.exists()) { file.createNewFile(); } FileWriter fileWriter = new FileWriter(file); fileWriter.write(content); fileWriter.close(); } catch (FileNotFoundException e) { e.printStackTrace(); } catch (IOException e) { e.printStackTrace(); } }}</pre><p>這樣就萬事具備，就差生成文件啦。下面就開始啦～～～</p><p><strong>開始生成java文件</strong></p><p>在生成文件前，我們還需要把<strong>basePath</strong>，<strong>entityPackage</strong>從配置文件裡取出來，這一步我就不寫了～～</p><pre>static final String DOT = ".";static final String FILE_TYPE = ".java";static final String ENTITY_TEMPLET_PATH = "EntityTemp.ftl";/** * 用於生成一個類文件 * * @param entityModel * @return */boolean makeOneClass(EntityModel entityModel) { entityModel.setPackageName(entityPackage); String filePath = basePath + "/" + entityPackage.replace(DOT, "/") + "/" + entityModel.getClassName() + FILE_TYPE; try { String javaClassString = FreeMarkerUtils.getJavaClass(entityModel, ENTITY_TEMPLET_PATH); FileUtils.write(filePath, javaClassString); return true; } catch (Exception e) { e.printStackTrace(); } return false;}</pre><p>好啦～～～大功告成。</p><p><strong>額～～～</strong></p><p>好像少點啥～～～</p><p>模板文件沒有放出來～～～</p><p>編寫<strong>EntityTemp.ftl</strong></p><pre>package ${packageName};&lt;#--導入的包--&gt;&lt;#list imports as import&gt;import ${import.name};&lt;/#list&gt;&lt;#--類名--&gt;&lt;#if classDoc?length gt 0&gt;/** * ${classDoc} * @author hejiaxuan */&lt;/#if&gt;public class ${className} {&lt;#--屬性名稱--&gt;&lt;#list fields?keys as key&gt; &lt;#assign fieldDocStr = fieldDoc[key]&gt; &lt;#if fieldDocStr?length gt 0&gt; /**${fieldDocStr}*/ &lt;/#if&gt; &lt;#if idColumnNames?seq_contains(fieldSqlName[key])&gt; &lt;/#if&gt; private ${fields[key].simpleName} ${key};&lt;/#list&gt;&lt;#list fields?keys as key&gt; &lt;#assign fieldClass = fields[key].simpleName&gt;&lt;#--setter--&gt; public void set${key?cap_first}(${fieldClass} ${key}) { this.${key} = ${key}; }&lt;#--getter--&gt; public ${fieldClass} &lt;#if fieldClass="boolean"&gt;is&lt;#else&gt;get&lt;/#if&gt;${key?cap_first}() { return this.${key}; }&lt;/#list&gt; @Override public String toString() { final StringBuilder sb = new StringBuilder("[");&lt;#list fields?keys as key&gt; sb.append("${key}:").append(${key}).append("; ");&lt;/#list&gt; sb.append("]"); return sb.toString(); }}</pre></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>一個</a></li><li><a>java</a></li><li><a>數據庫</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/ac25d2d0.html alt=30分鐘教你搭建一個網站（一）：購買和配置服務器 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/5f26f1582a564e93bde33a7dd9448c3b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ac25d2d0.html title=30分鐘教你搭建一個網站（一）：購買和配置服務器>30分鐘教你搭建一個網站（一）：購買和配置服務器</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d8be5e94.html alt=不會買服務器？一個辦法讓你輕鬆搭網站 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/84d9c54578de46058796824f1bcb6a9b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d8be5e94.html title=不會買服務器？一個辦法讓你輕鬆搭網站>不會買服務器？一個辦法讓你輕鬆搭網站</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c811c5f7.html alt=使用服務器搭建一個網站 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/63a6cc0eb4d146e0890515500c0040ca style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c811c5f7.html title=使用服務器搭建一個網站>使用服務器搭建一個網站</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4b69aa7f.html alt=做一個小型網站，服務器需要什麼配置的呢？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4b69aa7f.html title=做一個小型網站，服務器需要什麼配置的呢？>做一個小型網站，服務器需要什麼配置的呢？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eee4b8ad.html alt=搭建一個網站，租服務器大概多少錢？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eee4b8ad.html title=搭建一個網站，租服務器大概多少錢？>搭建一個網站，租服務器大概多少錢？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/62d46b38.html alt=素描祕籍｜一個耳朵！9大知識點，360度全方位深度剖析講解示範！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/5e7b0005767168b2b87d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/62d46b38.html title=素描祕籍｜一個耳朵！9大知識點，360度全方位深度剖析講解示範！>素描祕籍｜一個耳朵！9大知識點，360度全方位深度剖析講解示範！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/647df9c2.html alt=一個男人每天24小時跟妻子在一起，久而久之會怎樣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8359cc22f03e478a8cdb889dcfea3f99 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/647df9c2.html title=一個男人每天24小時跟妻子在一起，久而久之會怎樣>一個男人每天24小時跟妻子在一起，久而久之會怎樣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5a86d7d9.html alt=每天一個好習慣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RKdGgquJFM6gnc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5a86d7d9.html title=每天一個好習慣>每天一個好習慣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/756b16fb.html alt=奶粉寄出一個月，家人遲遲收不到，物流信息也查詢不到，事發阜陽某韻達快遞網點 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/3fd8ec4e-64c1-446a-adfa-38088fb06c01 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/756b16fb.html title=奶粉寄出一個月，家人遲遲收不到，物流信息也查詢不到，事發阜陽某韻達快遞網點>奶粉寄出一個月，家人遲遲收不到，物流信息也查詢不到，事發阜陽某韻達快遞網點</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b29ee719.html alt=又一個走上不歸路的搬磚人 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/bf471da0a06441f88bce49b959234257 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b29ee719.html title=又一個走上不歸路的搬磚人>又一個走上不歸路的搬磚人</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3d6d5661.html alt=多收藏一個，就少求一次人—哪些日常必備神級網站，真正值得收藏 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/833949926ebf49b89c5fb4075a9cffdd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3d6d5661.html title=多收藏一個，就少求一次人—哪些日常必備神級網站，真正值得收藏>多收藏一個，就少求一次人—哪些日常必備神級網站，真正值得收藏</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/917424fc.html alt=一個三年級小孩掌握腦王速記法之數字編碼後倒背如流圓周率1萬位 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/5b430002414bdad7cc1f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/917424fc.html title=一個三年級小孩掌握腦王速記法之數字編碼後倒背如流圓周率1萬位>一個三年級小孩掌握腦王速記法之數字編碼後倒背如流圓周率1萬位</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/25157041.html alt=聖胡安（波多黎各）：一個很不美國的美國城市 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/d049f3231cda4890ae11c23b2c8f8f70 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/25157041.html title=聖胡安（波多黎各）：一個很不美國的美國城市>聖胡安（波多黎各）：一個很不美國的美國城市</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d2ca7396.html alt=人工智能的下一個春天：情緒和情感計算 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ReV1j945oIOAmo style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d2ca7396.html title=人工智能的下一個春天：情緒和情感計算>人工智能的下一個春天：情緒和情感計算</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f649e4a6.html alt=舊廠房孵化新科技——一個國家級高新區的“雙創”見聞 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f649e4a6.html title=舊廠房孵化新科技——一個國家級高新區的“雙創”見聞>舊廠房孵化新科技——一個國家級高新區的“雙創”見聞</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>