<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>我和面試官之間關於操作系統的一場對弈 | 原力計劃 | 极客快訊</title><meta property="og:title" content="我和面試官之間關於操作系統的一場對弈 | 原力計劃 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/RsXICPz1mtDzK4"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/60ab937.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/60ab937.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/60ab937.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/60ab937.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/60ab937.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/60ab937.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/60ab937.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/60ab937.html><meta property="article:published_time" content="2020-10-29T20:59:05+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:05+08:00"><meta name=Keywords content><meta name=description content="我和面試官之間關於操作系統的一場對弈 | 原力計劃"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/60ab937.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>我和面試官之間關於操作系統的一場對弈 | 原力計劃</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><img alt="我和麵試官之間關於操作系統的一場對弈 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RsXICPz1mtDzK4><p>作者 | Guide哥</p><p>責編 | 伍杏玲</p><p>出品 | CSDN博客</p><p>大家好，我是 Guide 哥！很多讀者抱怨計算操作系統的知識點比較繁雜，自己也沒有多少耐心去看，但是面試的時候又經常會遇到。所以，我帶著我整理好的操作系統的常見問題來啦！這篇文章總結了一些我覺得比較重要的操作系統相關的問題比如進程管理、內存管理、虛擬內存等等。</p><p>文章形式通過大部分比較喜歡的面試官和求職者之間的對話形式展開。另外，Guide 哥也只是在大學的時候學習過操作系統，不過基本都忘了，為了寫這篇文章這段時間看了很多相關的書籍和博客。如果文中有任何需要補充和完善的地方，你都可以在評論區指出。如果覺得內容不錯的話，不要忘記點個在看哦！</p><p>我個人覺得學好操作系統還是非常有用的，具體可以看我昨天在星球分享的一段話：</p><img alt="我和麵試官之間關於操作系統的一場對弈 | 原力計劃" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RxAiS6K7dnxdd9><p>這篇文章只是對一些操作系統比較重要概念的一個概覽，深入學習的話，建議大家還是老老實實地去看書。另外， 這篇文章的很多內容參考了《現代操作系統》第三版這本書，非常感謝。</p><img alt="我和麵試官之間關於操作系統的一場對弈 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RT4Gwk56bt5iOJ><p><strong>操作系統基礎</strong></p><p><strong>1.1 什麼是操作系統？</strong></p><p>👨‍💻面試官 ：先來個簡單問題吧！什麼是操作系統？</p><p>🙋 我 ：我通過以下四點向您介紹一下什麼是操作系統吧！</p><ol><li><p>操作系統（Operating System，簡稱 OS）是管理計算機硬件與軟件資源的程序，是計算機系統的內核與基石；</p></li><li><p>操作系統本質上是運行在計算機上的軟件程序；</p></li><li><p>操作系統為用戶提供一個與系統交互的操作界面；</p></li><li><p>操作系統分內核與外殼（我們可以把外殼理解成圍繞著內核的應用程序，而內核就是能操作硬件的程序）。</p></li></ol><p>關於內核多插一嘴：內核負責管理系統的進程、內存、設備驅動程序、文件和網絡系統等等，決定著系統的性能和穩定性。是連接應用程序和硬件的橋樑。</p><p>內核就是操作系統背後黑盒的核心。</p><img alt="我和麵試官之間關於操作系統的一場對弈 | 原力計劃" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/RxAiS7aIUlb9k5><p><strong>1.2 系統調用</strong></p><p>👨‍💻面試官 ：什麼是系統調用呢？能不能詳細介紹一下。</p><p>🙋 我 ：介紹系統調用之前，我們先來了解一下用戶態和系統態。</p><p>根據進程訪問資源的特點，我們可以把進程在系統上的運行分為兩個級別：</p><ol><li><p>用戶態(user mode) : 用戶態運行的進程或可以直接讀取用戶程序的數據。</p></li><li><p>系統態(kernel mode):可以簡單的理解系統態運行的進程或程序幾乎可以訪問計算機的任何資源，不受限制。</p></li></ol><p>說了用戶態和系統態之後，那麼什麼是系統調用呢？</p><p>我們運行的程序基本都是運行在用戶態，如果我們調用操作系統提供的系統態級別的子功能咋辦呢？那就需要系統調用了！</p><p>也就是說在我們運行的用戶程序中，凡是與系統態級別的資源有關的操作（如文件管理、進程控制、內存管理等)，都必須通過系統調用方式向操作系統提出服務請求，並由操作系統代為完成。</p><p>這些系統調用按功能大致可分為如下幾類：</p><ol><li><p>設備管理。完成設備的請求或釋放，以及設備啟動等功能。</p></li><li><p>文件管理。完成文件的讀、寫、創建及刪除等功能。</p></li><li><p>進程控制。完成進程的創建、撤銷、阻塞及喚醒等功能。</p></li><li><p>進程通信。完成進程之間的消息傳遞或信號傳遞等功能。</p></li><li><p>內存管理。完成內存的分配、回收以及獲取作業佔用內存區大小及地址等功能。</p></li></ol><img alt="我和麵試官之間關於操作系統的一場對弈 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RT7S2kzFTfre26><p><strong>進程和線程</strong></p><p><strong>2.1 進程和線程的區別</strong></p><p>👨‍💻面試官: 好的！我明白了！那你再說一下：進程和線程的區別。</p><p>🙋 我：好的！下圖是 Java 內存區域，我們從 JVM 的角度來說一下線程和進程之間的關係吧！</p><p>如果你對 Java 內存區域 (運行時數據區) 這部分知識不太瞭解的話可以閱讀一下這篇文章：《可能是把 Java 內存區域講的最清楚的一篇文章》</p><img alt="我和麵試官之間關於操作系統的一場對弈 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RxAiSav5RMiO3K><p>從上圖可以看出：一個進程中可以有多個線程，多個線程共享進程的堆和方法區 (JDK1.8 之後的元空間)資源，但是每個線程有自己的程序計數器、虛擬機棧 和 本地方法棧。</p><p>總結：線程是進程劃分成的更小的運行單位,一個進程在其執行的過程中可以產生多個線程。線程和進程最大的不同在於基本上各進程是獨立的，而各線程則不一定，因為同一進程中的線程極有可能會相互影響。線程執行開銷小，但不利於資源的管理和保護；而進程正相反。</p><p><strong>2.2 進程有哪幾種狀態?</strong></p><p>👨‍💻面試官 ：那你再說說進程有哪幾種狀態?</p><p>🙋 我 ：我們一般把進程大致分為 5 種狀態，這一點和線程很像！</p><ol><li><p>創建狀態(new) ：進程正在被創建，尚未到就緒狀態。</p></li><li><p>就緒狀態(ready) ：進程已處於準備運行狀態，即進程獲得了除了處理器之外的一切所需資源，一旦得到處理器資源(處理器分配的時間片)即可運行。</p></li><li><p>運行狀態(running) ：進程正在處理器上上運行(單核 CPU 下任意時刻只有一個進程處於運行狀態)。</p></li><li><p>阻塞狀態(waiting) ：又稱為等待狀態，進程正在等待某一事件而暫停運行如等待某資源為可用或等待 IO 操作完成。即使處理器空閒，該進程也不能運行。</p></li><li><p>結束狀態(terminated) ：進程正在從系統中消失。可能是進程正常結束或其他原因中斷退出運行。</p></li></ol><img alt="我和麵試官之間關於操作系統的一場對弈 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RxAiSbWHYN5ShH><p><strong>2.3 進程間的通信方式</strong></p><p>👨‍💻面試官 ：進程間的通信常見的的有哪幾種方式呢?</p><p>🙋 我 ：大概有 7 種常見的進程間的通信方式。</p><p>下面這部分總結參考了:《進程間通信 IPC (InterProcess Communication)》 這篇文章，推薦閱讀，總結的非常不錯。</p><ol><li><p>管道/匿名管道(Pipes) ：用於具有親緣關係的父子進程間或者兄弟進程之間的通信。</p></li><li><p>有名管道(Names Pipes) : 匿名管道由於沒有名字，只能用於親緣關係的進程間通信。為了克服這個缺點，提出了有名管道。有名管道嚴格遵循先進先出(first in first out)。有名管道以磁盤文件的方式存在，可以實現本機任意兩個進程通信。</p></li><li><p>信號(Signal) ：信號是一種比較複雜的通信方式，用於通知接收進程某個事件已經發生；</p></li><li><p>消息隊列(Message Queuing) ：消息隊列是消息的鏈表,具有特定的格式,存放在內存中並由消息隊列標識符標識。管道和消息隊列的通信數據都是先進先出的原則。與管道（無名管道：只存在於內存中的文件；命名管道：存在於實際的磁盤介質或者文件系統）不同的是消息隊列存放在內核中，只有在內核重啟(即，操作系統重啟)或者顯示地刪除一個消息隊列時，該消息隊列才會被真正的刪除。消息隊列可以實現消息的隨機查詢,消息不一定要以先進先出的次序讀取,也可以按消息的類型讀取.比 FIFO 更有優勢。消息隊列克服了信號承載信息量少，管道只能承載無格式字 節流以及緩衝區大小受限等缺。</p></li><li><p>信號量(Semaphores) ：信號量是一個計數器，用於多進程對共享數據的訪問，信號量的意圖在於進程間同步。這種通信方式主要用於解決與同步相關的問題並避免競爭條件。</p></li><li><p>共享內存(Shared memory) ：使得多個進程可以訪問同一塊內存空間，不同進程可以及時看到對方進程中對共享內存中數據的更新。這種方式需要依靠某種同步操作，如互斥鎖和信號量等。可以說這是最有用的進程間通信方式。</p></li><li><p>套接字(Sockets) : 此方法主要用於在客戶端和服務器之間通過網絡進行通信。套接字是支持 TCP/IP 的網絡通信的基本操作單元，可以看做是不同主機之間的進程進行雙向通信的端點，簡單的說就是通信的兩方的一種約定，用套接字中的相關函數來完成通信過程。</p></li></ol><p><strong>2.4 線程間的同步的方式</strong></p><p>👨‍💻面試官 ：那線程間的同步的方式有哪些呢?</p><p>🙋 我 ：線程同步是兩個或多個共享關鍵資源的線程的併發執行。應該同步線程以避免關鍵的資源使用衝突。操作系統一般有下面三種線程同步的方式：</p><ol><li><p>互斥量(Mutex)：採用互斥對象機制，只有擁有互斥對象的線程才有訪問公共資源的權限。因為互斥對象只有一個，所以可以保證公共資源不會被多個線程同時訪問。比如 Java 中的 synchronized 關鍵詞和各種 Lock 都是這種機制。</p></li><li><p>信號量(Semphares) ：它允許同一時刻多個線程訪問同一資源，但是需要控制同一時刻訪問此資源的最大線程數量。</p></li><li><p>事件(Event) :Wait/Notify：通過通知操作的方式來保持多線程同步，還可以方便的實現多線程優先級的比較操。</p></li></ol><p><strong>2.5 進程的調度算法</strong></p><p>👨‍💻面試官 ：你知道操作系統中進程的調度算法有哪些嗎?</p><p>🙋 我 ：嗯嗯！這個我們大學的時候學過，是一個很重要的知識點！</p><p>為了確定首先執行哪個進程以及最後執行哪個進程以實現最大 CPU 利用率，計算機科學家已經定義了一些算法，它們是：</p><ul><li><p><strong>先到先服務(FCFS)調度算法</strong>: 從就緒隊列中選擇一個最先進入該隊列的進程為之分配資源，使它立即執行並一直執行到完成或發生某事件而被阻塞放棄佔用 CPU 時再重新調度。</p></li><li><p><strong>短作業優先(SJF)的調度算法</strong>: 從就緒隊列中選出一個估計運行時間最短的進程為之分配資源，使它立即執行並一直執行到完成或發生某事件而被阻塞放棄佔用 CPU 時再重新調度。</p></li><li><p><strong>時間片輪轉調度算法</strong>: 時間片輪轉調度是一種最古老，最簡單，最公平且使用最廣的算法，又稱 RR(Round robin)調度。每個進程被分配一個時間段，稱作它的時間片，即該進程允許運行的時間。</p></li><li><p><strong>多級反饋隊列調度算法</strong>：前面介紹的幾種進程調度的算法都有一定的侷限性。如短進程優先的調度算法，僅照顧了短進程而忽略了長進程 。多級反饋隊列調度算法既能使高優先級的作業得到響應又能使短作業（進程）迅速完成。，因而它是目前被公認的一種較好的進程調度算法，UNIX 操作系統採取的便是這種調度算法。</p></li><li><p><strong>優先級調度</strong>：為每個流程分配優先級，首先執行具有最高優先級的進程，依此類推。具有相同優先級的進程以 FCFS 方式執行。可以根據內存要求，時間要求或任何其他資源要求來確定優先級。</p></li></ul><img alt="我和麵試官之間關於操作系統的一場對弈 | 原力計劃" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RTJXJ1kBqzfCnu><p><strong>操作系統內存管理基礎</strong></p><p><strong>3.1 內存管理介紹</strong></p><p>👨‍💻 面試官: 操作系統的內存管理主要是做什麼？</p><p>🙋 我：操作系統的內存管理主要負責內存的分配與回收（malloc 函數：申請內存，free 函數：釋放內存），另外地址轉換也就是將邏輯地址轉換成相應的物理地址等功能也是操作系統內存管理做的事情。</p><p><strong>3.2 常見的幾種內存管理機制</strong></p><p>👨‍💻 面試官: 操作系統的內存管理機制瞭解嗎？內存管理有哪幾種方式?</p><p>🙋 我：這個在學習操作系統的時候有了解過。</p><p>簡單分為連續分配管理方式和非連續分配管理方式這兩種。連續分配管理方式是指為一個用戶程序分配一個連續的內存空間，常見的如 塊式管理 。同樣地，非連續分配管理方式允許一個程序使用的內存分佈在離散或者說不相鄰的內存中，常見的如頁式管理 和 段式管理。</p><ol><li><p><strong>塊式管理</strong>：遠古時代的計算機操系統的內存管理方式。將內存分為幾個固定大小的塊，每個塊中只包含一個進程。如果程序運行需要內存的話，操作系統就分配給它一塊，如果程序運行只需要很小的空間的話，分配的這塊內存很大一部分幾乎被浪費了。這些在每個塊中未被利用的空間，我們稱之為碎片。</p></li><li><p><strong>頁式管理</strong>：把主存分為大小相等且固定的一頁一頁的形式，頁較小，相對相比於塊式管理的劃分力度更大，提高了內存利用率，減少了碎片。頁式管理通過頁表對應邏輯地址和物理地址。</p></li><li><p><strong>段式管理 </strong>：頁式管理雖然提高了內存利用率，但是頁式管理其中的頁實際並無任何實際意義。段式管理把主存分為一段段的，每一段的空間又要比一頁的空間小很多 。但是，最重要的是段是有實際意義的，每個段定義了一組邏輯信息，例如,有主程序段 MAIN、子程序段 X、數據段 D 及棧段 S 等。段式管理通過段表對應邏輯地址和物理地址。</p></li></ol><p>👨‍💻面試官 ：回答的還不錯！不過漏掉了一個很重要的 段頁式管理機制 。段頁式管理機制結合了段式管理和頁式管理的優點。簡單來說段頁式管理機制就是把主存先分成若干段，每個段又分成若干頁，也就是說 段頁式管理機制 中段與段之間以及段的內部的都是離散的。</p><p>🙋 我 ：謝謝面試官！剛剛把這個給忘記了～</p><p><strong>3.3 快表和多級頁表</strong></p><p>👨‍💻面試官 ：頁表管理機制中有兩個很重要的概念：快表和多級頁表，這兩個東西分別解決了頁表管理中很重要的兩個問題。你給我簡單介紹一下吧！</p><p>🙋 我 ：在分頁內存管理中，很重要的兩點是：</p><p>虛擬地址到物理地址的轉換要快。</p><p>解決虛擬地址空間大，頁表也會很大的問題。</p><p><strong>快表</strong></p><p>為了解決虛擬地址到物理地址的轉換速度，操作系統在 頁表方案 基礎之上引入了 快表 來加速虛擬地址到物理地址的轉換。我們可以把塊表理解為一種特殊的高速緩衝存儲器（Cache），其中的內容是頁表的一部分或者全部內容。作為頁表的 Cache，它的作用與頁表相似，但是提高了訪問速率。由於採用頁表做地址轉換，讀寫內存數據時 CPU 要訪問兩次主存。有了快表，有時只要訪問一次高速緩衝存儲器，一次主存，這樣可加速查找並提高指令執行速度。</p><p>使用快表之後的地址轉換流程是這樣的：</p><ol><li><p>根據虛擬地址中的頁號查快表；</p></li><li><p>如果該頁在快表中，直接從快表中讀取相應的物理地址；</p></li><li><p>如果該頁不在快表中，就訪問內存中的頁表，再從頁表中得到物理地址，同時將頁表中的該映射表項添加到快表中；</p></li><li><p>當快表填滿後，又要登記新頁時，就按照一定的淘汰策略淘汰掉快表中的一個頁。</p></li></ol><p>看完了之後你會發現快表和我們平時經常在我們開發的系統使用的緩存（比如 Redis）很像，的確是這樣的，操作系統中的很多思想、很多經典的算法，你都可以在我們日常開發使用的各種工具或者框架中找到它們的影子。</p><p><strong>多級頁表</strong></p><p>引入多級頁表的主要目的是為了避免把全部頁表一直放在內存中佔用過多空間，特別是那些根本就不需要的頁表就不需要保留在內存中。多級頁表屬於時間換空間的典型場景，具體可以查看下面這篇文章</p><p>多級頁表如何節約內存：https://www.polarxiong.com/archives/多級頁表如何節約內存.html</p><p><strong>總結</strong></p><p>為了提高內存的空間性能，提出了多級頁表的概念；但是提到空間性能是以浪費時間性能為基礎的，因此為了補充損失的時間性能，提出了快表（即 TLB）的概念。不論是快表還是多級頁表實際上都利用到了程序的局部性原理，局部性原理在後面的虛擬內存這部分會介紹到。</p><p><strong>3.4 分頁機制和分段機制的共同點和區別</strong></p><p>👨‍💻面試官 ：分頁機制和分段機制有哪些共同點和區別呢？</p><p>🙋 我 ：</p><p><strong>共同點 ：</strong></p><ol><li><p>分頁機制和分段機制都是為了提高內存利用率，較少內存碎片。</p></li><li><p>頁和段都是離散存儲的，所以兩者都是離散分配內存的方式。但是，每個頁和段中的內存是連續的。</p></li></ol><p><strong>區別 ：</strong></p><ol><li><p>頁的大小是固定的，由操作系統決定；而段的大小不固定，取決於我們當前運行的程序。</p></li><li><p>分頁僅僅是為了滿足操作系統內存管理的需求，而段是邏輯信息的單位，在程序中可以體現為代碼段，數據段，能夠更好滿足用戶的需要。</p></li></ol><p><strong>3.5 邏輯(虛擬)地址和物理地址</strong></p><p>👨‍💻面試官 ：你剛剛還提到了邏輯地址和物理地址這兩個概念，我不太清楚，你能為我解釋一下不？</p><p>🙋 我：em…好的嘛！我們編程一般只有可能和邏輯地址打交道，比如在 C 語言中，指針裡面存儲的數值就可以理解成為內存裡的一個地址，這個地址也就是我們說的邏輯地址，邏輯地址由操作系統決定。物理地址指的是真實物理內存中地址，更具體一點來說就是內存地址寄存器中的地址。物理地址是內存單元真正的地址。</p><p><strong>3.6 CPU 尋址瞭解嗎?為什麼需要虛擬地址空間?</strong></p><p>👨‍💻面試官 ：CPU 尋址瞭解嗎?為什麼需要虛擬地址空間?</p><p>🙋 我 ：這部分我真不清楚！</p><p>於是面試完之後我默默去查閱了相關文檔！留下了沒有技術的淚水。</p><p>這部分內容參考了 Microsoft 官網的介紹，地址：https://msdn.microsoft.com/zh-cn/library/windows/hardware/hh439648(v=vs.85).aspx</p><p>現代處理器使用的是一種稱為 虛擬尋址(Virtual Addressing) 的尋址方式。使用虛擬尋址，CPU 需要將虛擬地址翻譯成物理地址，這樣才能訪問到真實的物理內存。實際上完成虛擬地址轉換為物理地址轉換的硬件是 CPU 中含有一個被稱為 內存管理單元（Memory Management Unit, MMU） 的硬件。如下圖所示：</p><img alt="我和麵試官之間關於操作系統的一場對弈 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RxAiSc86J9Mclz><p><strong>為什麼要有虛擬地址空間呢？</strong></p><p>先從沒有虛擬地址空間的時候說起吧！沒有虛擬地址空間的時候，程序都是直接訪問和操作的都是物理內存 。但是這樣有什麼問題呢？</p><ol><li><p>用戶程序可以訪問任意內存，尋址內存的每個字節，這樣就很容易（有意或者無意）破壞操作系統，造成操作系統崩潰。</p></li><li><p>想要同時運行多個程序特別困難，比如你想同時運行一個微信和一個 QQ 音樂都不行。為什麼呢？舉個簡單的例子：微信在運行的時候給內存地址 1xxx 賦值後，QQ 音樂也同樣給內存地址 1xxx 賦值，那麼 QQ 音樂對內存的賦值就會覆蓋微信之前所賦的值，這就造成了微信這個程序就會崩潰。</p></li></ol><p>總結來說：如果直接把物理地址暴露出來的話會帶來嚴重問題，比如可能對操作系統造成傷害以及給同時運行多個程序造成困難。</p><p>通過虛擬地址訪問內存有以下優勢：</p><ul><li><p>程序可以使用一系列相鄰的虛擬地址來訪問物理內存中不相鄰的大內存緩衝區。</p></li><li><p>程序可以使用一系列虛擬地址來訪問大於可用物理內存的內存緩衝區。當物理內存的供應量變小時，內存管理器會將物理內存頁（通常大小為 4 KB）保存到磁盤文件。數據或代碼頁會根據需要在物理內存與磁盤之間移動。</p></li><li><p>不同進程使用的虛擬地址彼此隔離。一個進程中的代碼無法更改正在由另一進程或操作系統使用的物理內存。</p></li></ul><img alt="我和麵試官之間關於操作系統的一場對弈 | 原力計劃" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RTJXJ7YR5xGDl><p><strong>虛擬內存</strong></p><p><strong>4.1 什麼是虛擬內存(Virtual Memory)?</strong></p><p>👨‍💻面試官 ：再問你一個常識性的問題！什麼是虛擬內存(Virtual Memory)?</p><p>🙋 我 ：這個在我們平時使用電腦特別是 Windows 系統的時候太常見了。很多時候我們使用點開了很多佔內存的軟件，這些軟件佔用的內存可能已經遠遠超出了我們電腦本身具有的物理內存。為什麼可以這樣呢？正是因為 虛擬內存 的存在，通過 虛擬內存 可以讓程序可以擁有超過系統物理內存大小的可用內存空間。另外，虛擬內存為每個進程提供了一個一致的、私有的地址空間，它讓每個進程產生了一種自己在獨享主存的錯覺（每個進程擁有一片連續完整的內存空間）。這樣會更加有效地管理內存並減少出錯。</p><p>虛擬內存是計算機系統內存管理的一種技術，我們可以手動設置自己電腦的虛擬內存。不要單純認為虛擬內存只是“使用硬盤空間來擴展內存“的技術。虛擬內存的重要意義是它定義了一個連續的虛擬地址空間，並且 把內存擴展到硬盤空間。推薦閱讀：《虛擬內存的那點事兒》</p><p>維基百科中有幾句話是這樣介紹虛擬內存的。</p><p><em>虛擬內存：使得應用程序認為它擁有連續的可用的內存（一個連續完整的地址空間），而實際上，它通常是被分隔成多個物理內存碎片，還有部分暫時存儲在外部磁盤存儲器上，在需要時進行數據交換。與沒有使用虛擬內存技術的系統相比，使用這種技術的系統使得大型程序的編寫變得更容易，對真正的物理內存（例如 RAM）的使用也更有效率。目前，大多數操作系統都使用了虛擬內存，如 Windows 家族的“虛擬內存”；Linux 的“交換空間”等。From:https://zh.wikipedia.org/wiki/虛擬內存</em></p><p><strong>4.2 局部性原理</strong></p><p>👨‍💻面試官 ：要想更好地理解虛擬內存技術，必須要知道計算機中著名的局部性原理。另外，局部性原理既適用於程序結構，也適用於數據結構，是非常重要的一個概念。</p><p>🙋 我 ：局部性原理是虛擬內存技術的基礎，正是因為程序運行具有局部性原理，才可以只裝入部分程序到內存就開始運行。</p><p>以下內容摘自《計算機操作系統教程》 第 4 章存儲器管理。</p><p>早在 1968 年的時候，就有人指出我們的程序在執行的時候往往呈現局部性規律，也就是說在某個較短的時間段內，程序執行侷限於某一小部分，程序訪問的存儲空間也侷限於某個區域。</p><p>局部性原理表現在以下兩個方面：</p><p><strong>時間局部性</strong>：如果程序中的某條指令一旦執行，不久以後該指令可能再次執行；如果某數據被訪問過，不久以後該數據可能再次被訪問。產生時間局部性的典型原因，是由於在程序中存在著大量的循環操作。</p><p><strong>空間局部性</strong>：一旦程序訪問了某個存儲單元，在不久之後，其附近的存儲單元也將被訪問，即程序在一段時間內所訪問的地址，可能集中在一定的範圍之內，這是因為指令通常是順序存放、順序執行的，數據也一般是以向量、數組、表等形式簇聚存儲的。</p><p>時間局部性是通過將近來使用的指令和數據保存到高速緩存存儲器中，並使用高速緩存的層次結構實現。空間局部性通常是使用較大的高速緩存，並將預取機制集成到高速緩存控制邏輯中實現。虛擬內存技術實際上就是建立了 “內存一外存”的兩級存儲器的結構，利用局部性原理實現髙速緩存。</p><p><strong>4.3 虛擬存儲器</strong></p><p>👨‍💻面試官 ：都說了虛擬內存了。你再講講虛擬存儲器把！</p><p>🙋 我 ：</p><p>這部分內容來自：王道考研操作系統知識點整理。</p><p>基於局部性原理，在程序裝入時，可以將程序的一部分裝入內存，而將其他部分留在外存，就可以啟動程序執行。由於外存往往比內存大很多，所以我們運行的軟件的內存大小實際上是可以比計算機系統實際的內存大小大的。在程序執行過程中，當所訪問的信息不在內存時，由操作系統將所需要的部分調入內存，然後繼續執行程序。另一方面，操作系統將內存中暫時不使用的內容換到外存上，從而騰出空間存放將要調入內存的信息。這樣，計算機好像為用戶提供了一個比實際內存大的多的存儲器——虛擬存儲器。</p><p>實際上，我覺得虛擬內存同樣是一種時間換空間的策略，你用 CPU 的計算時間，頁的調入調出花費的時間，換來了一個虛擬的更大的空間來支持程序的運行。不得不感嘆，程序世界幾乎不是時間換空間就是空間換時間。</p><p><strong>4.4 虛擬內存的技術實現</strong></p><p>👨‍💻面試官 ：虛擬內存技術的實現呢？</p><p>🙋 我 ：虛擬內存的實現需要建立在離散分配的內存管理方式的基礎上。虛擬內存的實現有以下三種方式：</p><ol><li><p><strong>請求分頁存儲管理</strong>：建立在分頁管理之上，為了支持虛擬存儲器功能而增加了請求調頁功能和頁面置換功能。請求分頁是目前最常用的一種實現虛擬存儲器的方法。請求分頁存儲管理系統中，在作業開始運行之前，僅裝入當前要執行的部分段即可運行。假如在作業運行的過程中發現要訪問的頁面不在內存，則由處理器通知操作系統按照對應的頁面置換算法將相應的頁面調入到主存，同時操作系統也可以將暫時不用的頁面置換到外存中。</p></li><li><p><strong>請求分段存儲管理</strong>：建立在分段存儲管理之上，增加了請求調段功能、分段置換功能。請求分段儲存管理方式就如同請求分頁儲存管理方式一樣，在作業開始運行之前，僅裝入當前要執行的部分段即可運行；在執行過程中，可使用請求調入中斷動態裝入要訪問但又不在內存的程序段；當內存空間已滿，而又需要裝入新的段時，根據置換功能適當調出某個段，以便騰出空間而裝入新的段。</p></li><li><p><strong>請求段頁式存儲管理</strong></p></li></ol><p>這裡多說一下？很多人容易搞混請求分頁與分頁存儲管理，兩者有何不同呢？</p><p>請求分頁存儲管理建立在分頁管理之上。他們的根本區別是是否將程序全部所需的全部地址空間都裝入主存，這也是請求分頁存儲管理可以提供虛擬內存的原因，我們在上面已經分析過了。</p><p>它們之間的根本區別在於是否將一作業的全部地址空間同時裝入主存。請求分頁存儲管理不要求將作業全部地址空間同時裝入主存。基於這一點，請求分頁存儲管理可以提供虛存，而分頁存儲管理卻不能提供虛存。</p><p>不管是上面那種實現方式，我們一般都需要：</p><ol><li><p>一定容量的內存和外存：在載入程序的時候，只需要將程序的一部分裝入內存，而將其他部分留在外存，然後程序就可以執行了；</p></li><li><p><strong>缺頁中斷</strong>：如果需執行的指令或訪問的數據尚未在內存（稱為缺頁或缺段），則由處理器通知操作系統將相應的頁面或段調入到內存，然後繼續執行程序；</p></li><li><p><strong>虛擬地址空間</strong>：邏輯地址到物理地址的變換。</p></li></ol><p><strong>4.5 頁面置換算法</strong></p><p>👨‍💻面試官 ：虛擬內存管理很重要的一個概念就是頁面置換算法。那你說一下 頁面置換算法的作用?常見的頁面置換算法有哪些?</p><p>🙋 我 ：</p><p>這個題目經常作為筆試題出現，網上已經給出了很不錯的回答，我這裡只是總結整理了一下。</p><p>地址映射過程中，若在頁面中發現所要訪問的頁面不在內存中，則發生缺頁中斷。</p><p>缺頁中斷就是要訪問的頁不在主存，需要操作系統將其調入主存後再進行訪問。在這個時候，被內存映射的文件實際上成了一個分頁交換文件。</p><p>當發生缺頁中斷時，如果當前內存中並沒有空閒的頁面，操作系統就必須在內存選擇一個頁面將其移出內存，以便為即將調入的頁面讓出空間。用來選擇淘汰哪一頁的規則叫做頁面置換算法，我們可以把頁面置換算法看成是淘汰頁面的規則。</p><ul><li><p><strong>OPT 頁面置換算法（最佳頁面置換算法）</strong>：最佳(Optimal, OPT)置換算法所選擇的被淘汰頁面將是以後永不使用的，或者是在最長時間內不再被訪問的頁面,這樣可以保證獲得最低的缺頁率。但由於人們目前無法預知進程在內存下的若千頁面中哪個是未來最長時間內不再被訪問的，因而該算法無法實現。一般作為衡量其他置換算法的方法。</p></li><li><p><strong>FIFO（First In First Out） 頁面置換算法（先進先出頁面置換算法）</strong>: 總是淘汰最先進入內存的頁面，即選擇在內存中駐留時間最久的頁面進行淘汰。</p></li><li><p><strong>LRU （Least Currently Used）頁面置換算法（最近最久未使用頁面置換算法） </strong>：LRU算法賦予每個頁面一個訪問字段，用來記錄一個頁面自上次被訪問以來所經歷的時間 T，當須淘汰一個頁面時，選擇現有頁面中其 T 值最大的，即最近最久未使用的頁面予以淘汰。</p></li><li><p><strong>LFU （Least Frequently Used）頁面置換算法（最少使用頁面置換算法）</strong>: 該置換算法選擇在之前時期使用最少的頁面作為淘汰頁。</p></li></ul><p>參考：</p><p>《計算機操作系統—湯小丹》第四版</p><p>《深入理解計算機系統》</p><p>https://zh.wikipedia.org/wiki/輸入輸出內存管理單元</p><p>https://baike.baidu.com/item/快表/19781679</p><p>https://www.jianshu.com/p/1d47ed0b46d5</p><p>https://www.studytonight.com/operating-system</p><p>https://www.geeksforgeeks.org/interprocess-communication-methods/</p><p>https://juejin.im/post/59f8691b51882534af254317</p><p>王道考研操作系統知識點整理：https://wizardforcel.gitbooks.io/wangdaokaoyan-os/content/13.html</p><p>版權聲明：本文為CSDN博主「Guide哥」的原創文章，遵循 CC 4.0 BY-SA 版權協議，轉載請附上原文出處鏈接及本聲明。</p><p>原文鏈接：https://blog.csdn.net/qq_34337272/java/article/details/105291118</p><img alt="我和麵試官之間關於操作系統的一場對弈 | 原力計劃" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RwgKJKloConPT><p>☞阿里雲加碼 2000 億，再“出征”新基建！</p><p>☞看似毫不相干，哲學與機器學習竟有如此大的交集？</p><p>☞文科出身敲出 Instagram，被小札“擠”走，建新冠追蹤網站，這個程序員有點牛！</p><p>☞降低預測過程計算成本，這些NLP模型壓縮方法要知道</p><p>☞這些常見的分佈式存儲系統，你是否都瞭解？</p><p>☞京東智聯云云原生實踐，告訴你何為監控和日誌的黃金法則</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>面試</a></li><li><a>官之間關</a></li><li><a>系統</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/7b21f9a.html alt="面試妥了！操作系統 59 個核心概念詳解" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/Rsk5YoD5fxO5Nt style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7b21f9a.html title="面試妥了！操作系統 59 個核心概念詳解">面試妥了！操作系統 59 個核心概念詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/031eafc4.html alt=電廠直流系統調試方案 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/5e8200036f19e04c25bf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/031eafc4.html title=電廠直流系統調試方案>電廠直流系統調試方案</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fc3b4b2c.html alt=一文讀懂智能客服：發展歷程、系統搭建、市場推廣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RbYMTZ55OrJUgU style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fc3b4b2c.html title=一文讀懂智能客服：發展歷程、系統搭建、市場推廣>一文讀懂智能客服：發展歷程、系統搭建、市場推廣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/51410370.html alt=生活垃圾焚燒發電及蒸汽系統優化改造項目公告 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RcblrbTDBokV23 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/51410370.html title=生活垃圾焚燒發電及蒸汽系統優化改造項目公告>生活垃圾焚燒發電及蒸汽系統優化改造項目公告</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b4913b56.html alt=電驅動橋系統或加快電氣化進程，多個案例共同說明問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1539571595921bc5b27eff6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b4913b56.html title=電驅動橋系統或加快電氣化進程，多個案例共同說明問題>電驅動橋系統或加快電氣化進程，多個案例共同說明問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/677306ff.html alt=面試總結：關於MySQL事務的10個問題常見面試問答 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/1669c986-315c-4339-a5a0-a918a47f2e57 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/677306ff.html title=面試總結：關於MySQL事務的10個問題常見面試問答>面試總結：關於MySQL事務的10個問題常見面試問答</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9a7b7719.html alt=基於混沌系統的偽隨機數發生器設計 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9a7b7719.html title=基於混沌系統的偽隨機數發生器設計>基於混沌系統的偽隨機數發生器設計</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/99558abe.html alt=win10系統打印機打印不了顯示已暫停的解決方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/10d0de369d4746c7a0c220ff59bd2470 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/99558abe.html title=win10系統打印機打印不了顯示已暫停的解決方法>win10系統打印機打印不了顯示已暫停的解決方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2564328d.html alt=虛設投資交易系統吸引投資 成都破獲一特大團夥詐騙案 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2564328d.html title=虛設投資交易系統吸引投資 成都破獲一特大團夥詐騙案>虛設投資交易系統吸引投資 成都破獲一特大團夥詐騙案</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e4b6c065.html alt=全球定位系統（GPS），不只是導航 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/S7sY2h8G8GOmul style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e4b6c065.html title=全球定位系統（GPS），不只是導航>全球定位系統（GPS），不只是導航</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f75e014c.html alt=謹記！短線王者交易系統，學會極大概率提高買入與賣出的時機！掌握終身獲益無窮！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RL8KN4P57T39Db style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f75e014c.html title=謹記！短線王者交易系統，學會極大概率提高買入與賣出的時機！掌握終身獲益無窮！>謹記！短線王者交易系統，學會極大概率提高買入與賣出的時機！掌握終身獲益無窮！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0ad4f2c9.html alt="焦爐系統停電 —— 應急操作" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8ca2e135770644bfb97620aad1b362c0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0ad4f2c9.html title="焦爐系統停電 —— 應急操作">焦爐系統停電 —— 應急操作</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/75270289.html alt=win10系統如何使用返回桌面快捷鍵 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/822a8f5c52e1461a94e116d0e24871f0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/75270289.html title=win10系統如何使用返回桌面快捷鍵>win10系統如何使用返回桌面快捷鍵</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a435b80f.html alt=從操作系統（Windows）的角度討論中斷和異常機制 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/95371ea9a81e4e32b3cf7591d4dbbc83 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a435b80f.html title=從操作系統（Windows）的角度討論中斷和異常機制>從操作系統（Windows）的角度討論中斷和異常機制</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/093fe492.html alt=企業標準-管路系統裝配工藝規範 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ab245e924a004753b625eeb6495dd2ca style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/093fe492.html title=企業標準-管路系統裝配工藝規範>企業標準-管路系統裝配工藝規範</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>