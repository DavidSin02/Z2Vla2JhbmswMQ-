<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1) | 极客快訊</title><meta property="og:title" content="小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1) - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/1521117426381513b95aedc"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/61a225cc.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/61a225cc.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/61a225cc.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/61a225cc.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/61a225cc.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/61a225cc.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/61a225cc.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/61a225cc.html><meta property="article:published_time" content="2020-10-29T21:09:31+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:31+08:00"><meta name=Keywords content><meta name=description content="小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1)"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/61a225cc.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1)</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p><img alt="小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1)" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1521117426381513b95aedc></p><p>TWI總線可以認為是I2C總線，ATmega328p的TWI總線是一個簡單強大的通訊接口，使用兩根線就可以了，分別是時鐘線SCL和數據線SDA。關於TWI的一些術語就不在這裡講了，自己可以去百度一下，大把的資料。</p><p><img alt="小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1)" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/152120154302797c64c268e></p><p class=pgc-img-caption>TWI總線配置圖</p><p>我們主要來看它涉及到的寄存器。</p><p>1.TWBR ：TWI比特率寄存器</p><p><img alt="小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1)" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1521201747349d58945c266></p><p>TWBR 為比特率發生器分頻因子。比特率發生器是一個分頻器，在主機模式下產生SCL時鐘頻率。就是一個8位的，這個沒啥說的。</p><p>2.TWCR ：TWI控制寄存器</p><p><img alt="小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1)" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1521202041074bf24b4accf></p><p>該寄存器用來使能TWI，通過施加START到總線上來啟動主機訪問，產生接收器應答，產生STOP狀態，以及在寫入數據到TWDR寄存器時控制總線的暫停等一些列活動。<br></p><p>bit 7：TWI中斷標誌，當TWI完成當前的工作，希望應用程序介入時TWINT置位。若SREG的I標誌及其TWCR寄存器的TWIE標誌也置位，則MCU執行TWI中斷。</p><p>bit 6：使能TWI應答。TWEA標誌控制應答脈衝的產生，若TWEA置位，則會出現如下條件時接口發生ACK脈衝：</p><ul class=list-paddingleft-2><li><p>設備從機地址被接收</p></li><li><p>TWAR的TWGCE置位時接收到廣播呼叫</p></li><li><p>在主機模式或者從機模式下接收到一個字節的數據</p></li></ul><p>將TWEA清零可以是器件暫時脫離總線，置位後器件重新恢復地址識別。</p><p>bit 5：TWI START狀態標誌。當cpu希望自己成為總線上的主機時需要置位該位。TWI硬件檢測總線是不是可用，若總線空閒時，接口就在總線上產生START狀態，若總線忙，接口就一直等待，直達檢測到一個STOP狀態然後產生START以聲明自己希望成為主機，發送START之後軟件必須清零TWSTA。</p><p>bit 4：TWI STOP狀態標誌。在主機模式下，如果該位置位，則TWI接口將在總線上產生STOP狀態，然後該位自動清零。在從機模式下，置位該位可以使接口從錯位狀態恢復到未被尋址的狀態。</p><p>bit 3：TWI寫碰撞標誌。當TWINT為低時，寫數據寄存器TWDR將置位該位。當TWINT為高時，每一次對TWDR的寫訪問都將更新此標誌。</p><p>bit 2：TWI使能。該位用於使能TWI操作與激活TWI接口，當該位置位，TWI引腳將I/O引腳切換到SCL與SDA引腳。如果該位清零，TWI接口將被關閉，所有的TWI傳輸將被終止。</p><p>bit 1：保留位</p><p>bit 0：使能TWI中斷。當SREG的I位和TWIE置位時，只要TWINT為1，TWI中斷就激活。</p><p>3.TWSR ：TWI 狀態寄存器</p><p><img alt="小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1)" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15212040956608bfda957a0></p><p>bit 7~3：TWI狀態位。這5位用來反映TWI邏輯和總線的狀態，從TWSR讀出的值包含5位狀態值和2位預分頻值。</p><p>我們來看一下這5位對應的值，發送模式的狀態情況，見下表：</p><p><img alt="小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1)" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15212048354591e34b2788d></p><p>即當這5位的值為：0x08，表示START信號發送了，就這個意思。</p><p>bit 1~0：TWI預分頻位。可讀寫，用於控制比特率的預分頻因子。見下表：</p><p><img alt="小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1)" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1521204340160512bb32e09></p><p>4.TWDR ：TWI 數據寄存器</p><p><img alt="小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1)" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/15212050580614ef0603a9d></p><p>在發送模式下，該寄存器包含了要發送的字節，在接收模式下，該寄存器包含了接收到的數據。當TWI接口沒有進行移位工作（TWINT置位）時，這個寄存器使可以寫的。</p><p>bit 7~0：根據不同的狀態，存放的要發的下一個字節數據或者是接收到的數據。</p><p>5.TWAR – TWI 從機地址寄存器</p><p><img alt="小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1)" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1521205355388a958fca289></p><p>bit7~1：從機地址。工作在從機模式的時候，TWI講根據這個地址進行響應。主機模式不需要此地址。</p><p>bit 0：控制到底是讀還是寫。</p><p>6.TWAMR ：TWI 從機地址掩碼寄存器</p><p><img alt="小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1)" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15212054641803271406993></p><p>關於寄存器就先說這麼多了。</p><p>再來看兩個表：<br></p><p><img alt="小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1)" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1521206333410b0aa6a506b></p><p class=pgc-img-caption>典型數據傳輸中應用程序與 TWI 的接口</p><p><img alt="小5帶你飛(13)—AVR(ATmega 328P)單片機TWI總線的原理和使用(1)" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15212062366247006d6539a></p><p class=pgc-img-caption>彙編與 C 語言例程</p><p>我們寫程序的時候，就可以根據這個表來自己弄了。</p><p>下一個教程我們再來寫相關的程序。</p><p>更多內容請關注頭條號：小5嵌入式</p><div id=yddTopBorderlr><br></div><br></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>13</a></li><li><a>AVR</a></li><li><a>ATmega</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/ec879ab.html alt="小5帶你飛(12)—AVR(ATmega 328P)單片機定時器的原理和使用(3)" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/152000399777825495a6a03 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ec879ab.html title="小5帶你飛(12)—AVR(ATmega 328P)單片機定時器的原理和使用(3)">小5帶你飛(12)—AVR(ATmega 328P)單片機定時器的原理和使用(3)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f44ab8f6.html alt=詳解13項鋼筋安裝質量標準及通病防治 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/fd3ff534941a487884c7a67361337cfb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f44ab8f6.html title=詳解13項鋼筋安裝質量標準及通病防治>詳解13項鋼筋安裝質量標準及通病防治</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/168e1143.html alt=13條跨市公交暫停運營！包括中山到珠海、順德、江門公交 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RoNS9itD0dzfEc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/168e1143.html title=13條跨市公交暫停運營！包括中山到珠海、順德、江門公交>13條跨市公交暫停運營！包括中山到珠海、順德、江門公交</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2ec9413d.html alt="意大利暫停與13個國家的航班往來 或延長國家緊急狀態時間" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2ec9413d.html title="意大利暫停與13個國家的航班往來 或延長國家緊急狀態時間">意大利暫停與13個國家的航班往來 或延長國家緊急狀態時間</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5182b1b5.html alt="13歲女兒大吼：'媽，求你別來接我了'，刺痛了底層家庭的暗傷" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b58752174f9d4caa87e7f22be2e71eb0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5182b1b5.html title="13歲女兒大吼：'媽，求你別來接我了'，刺痛了底層家庭的暗傷">13歲女兒大吼：'媽，求你別來接我了'，刺痛了底層家庭的暗傷</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f4009781.html alt="13個項目落戶雲南嵩明 總投資逾269億元" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f4009781.html title="13個項目落戶雲南嵩明 總投資逾269億元">13個項目落戶雲南嵩明 總投資逾269億元</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/03cd9d5d.html alt="嵩明縣13個大項目集中籤約 總投資269億元" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RNRXdbMGOalWDD style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/03cd9d5d.html title="嵩明縣13個大項目集中籤約 總投資269億元">嵩明縣13個大項目集中籤約 總投資269億元</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/29c75da2.html alt="嵩明縣13個項目集中籤約 協議投資總額269.56億" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/29c75da2.html title="嵩明縣13個項目集中籤約 協議投資總額269.56億">嵩明縣13個項目集中籤約 協議投資總額269.56億</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7e1d816d.html alt="MM-13動定滑輪組模型3D圖紙 Solidworks設計" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f9af83c7a9e14994a92c50ff5523f15e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7e1d816d.html title="MM-13動定滑輪組模型3D圖紙 Solidworks設計">MM-13動定滑輪組模型3D圖紙 Solidworks設計</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0eb437db.html alt="河南新鄉抽檢13批次聚氯乙烯（PVC）電纜料產品 均合格" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RJAgq8NE5slG2N style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0eb437db.html title="河南新鄉抽檢13批次聚氯乙烯（PVC）電纜料產品 均合格">河南新鄉抽檢13批次聚氯乙烯（PVC）電纜料產品 均合格</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/057e05ae.html alt="戴爾刷新XPS 13筆記本/變形本產品線 採用英特爾11代Tiger Lake處理器" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/S9UFb4BGN6tjTi style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/057e05ae.html title="戴爾刷新XPS 13筆記本/變形本產品線 採用英特爾11代Tiger Lake處理器">戴爾刷新XPS 13筆記本/變形本產品線 採用英特爾11代Tiger Lake處理器</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c1f996bf.html alt=念如｜香雲紗染整—13道工序鍛造貴比黃金傳統香雲紗 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8021388f0107499cb02422867454e4a6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c1f996bf.html title=念如｜香雲紗染整—13道工序鍛造貴比黃金傳統香雲紗>念如｜香雲紗染整—13道工序鍛造貴比黃金傳統香雲紗</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c381d62a.html alt=13億人口大國終於等到了？首艘國產航母年底海試，明年正式交付 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/1512f2ec-d152-499d-b3ad-cc865bb1f63f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c381d62a.html title=13億人口大國終於等到了？首艘國產航母年底海試，明年正式交付>13億人口大國終於等到了？首艘國產航母年底海試，明年正式交付</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/81bc4268.html alt="iOS 13:如何在iPhone和iPad上自動關閉Safari選項卡" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6495d9080b3040579967edc23809457e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/81bc4268.html title="iOS 13:如何在iPhone和iPad上自動關閉Safari選項卡">iOS 13:如何在iPhone和iPad上自動關閉Safari選項卡</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9477b506.html alt="iOS 13現自動關閉程序Bug，解決辦法來了" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/33da1a471b1a48a69ec772c8b483d70c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9477b506.html title="iOS 13現自動關閉程序Bug，解決辦法來了">iOS 13現自動關閉程序Bug，解決辦法來了</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>