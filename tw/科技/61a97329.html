<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>禍害阿里雲宕機3小時的IO HANG究竟是什麼？ | 极客快訊</title><meta property="og:title" content="禍害阿里雲宕機3小時的IO HANG究竟是什麼？ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/RK1IFLn80SX5dl"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/61a97329.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/61a97329.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/61a97329.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/61a97329.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/61a97329.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/61a97329.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/61a97329.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/61a97329.html><meta property="article:published_time" content="2020-11-14T21:05:13+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:13+08:00"><meta name=Keywords content><meta name=description content="禍害阿里雲宕機3小時的IO HANG究竟是什麼？"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/61a97329.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>禍害阿里雲宕機3小時的IO HANG究竟是什麼？</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><strong>本文來自微信公號“CSDN”（ID：CSDNnews），作者 | 王知無， 責編| 郭 芮。</strong></p><p>2019年3月3日凌晨，微博炸鍋，有網友反映說阿里雲疑似出現宕機，華北很多互聯網公司受到暴擊傷害，APP、網站全部癱瘓，我自己的朋友圈和微信群裡也有好友反饋，剛剛從被窩被叫起來去修Bug，結果發現服務器登不上去了......</p><p>凌晨2點37分，阿里雲官方迴應稱：華北2地域可用區C部分ECS服務器等實例出現IO HANG，經緊急排查處理後逐步恢復，此外將根據協議儘快賠償。並已經全面排查其他地域及可用區，未發現此類情況。</p><p><strong>IO HANG</strong></p><p>那麼問題來了，IO HANG是個什麼鬼？簡單的說，就是服務器磁盤讀寫過慢，導致線程和進程掛起。大量讀寫線程/進程掛起導致服務器宕機......</p><p>阿里雲有大量的類似RDS、HybridDB數據庫，支持海量數據在線事務（OLTP）和在線分析（OLAP），需要大量的IO讀寫，而Linux的IO性能將直接影響SQL的執行速度，嚴重情況下將導致服務器卡死和宕機。</p><p>如何監控自己服務器的IO情況呢？本文將帶大家詳細瞭解這些常用的命令。</p><p><strong>如何監控自己服務器的IO情況？</strong></p><p>常用的命令包括：top，iostat和iotop。那麼他們都有什麼區別，以及如何使用呢？我們一一分解。</p><p>我本機安裝的是CentOS-7的虛擬機，內核信息為：</p><p><strong>top命令</strong></p><p>top命令提供了實時的對系統處理器的狀態監視。它將顯示系統中CPU最"敏感"的任務列表，該命令可以按CPU使用、內存使用和執行時間對任務進行排序，而且該命令的很多特性都可以通過交互式命令。</p><p>在Linux下，輸入`top` ：</p><img alt="禍害阿里雲宕機3小時的IO HANG究竟是什麼？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RK1IFLn80SX5dl><p>Tasks、Cpus、Mem和Swap分別代表了進程信息、CPU信息和內存信息。各個列表示的指標意義如下 ：</p><p>PID進程id</p><p>USER進程所有者用戶名</p><p>PR 優先級</p><p>NI nice值</p><p>VIRT進程使用的虛擬內存總量</p><p>RES進程使用的未被換出的物理內存大小</p><p>SHR共享內存大小</p><p>S 進程狀態S=睡眠T=跟蹤R=運行Z=殭屍進程D=不可中斷的睡眠進程</p><p>CPUcpu時間統計</p><p>MEM 物理內存佔比</p><p>COMMAND命令行命令名</p><p>top常用的交互式命令使用格式：</p><p>top [-] [d] [p] [q] [c] [C] [S] [s] [n]</p><p>參數說明：</p><p>d：指定每兩次屏幕信息刷新之間的時間間隔，當然用戶可以使用s交互命令來改變之；</p><p>p：通過指定監控進程ID來僅僅監控某個進程的狀態；</p><p>q：該選項將使top沒有任何延遲的進行刷新。如果調用程序有超級用戶權限，那麼top將以儘可能高的優先級運行；</p><p>S：指定累計模式；</p><p>s：使top命令在安全模式中運行，這將去除交互命令所帶來的潛在危險；</p><p>i：使top不顯示任何閒置或者僵死進程；</p><p>c：顯示整個命令行而不只是顯示命令名。</p><p>通過top命令，我們即可查到當前服務器的進程佔用CPU和內存情況。</p><p><strong>iostat命令</strong></p><p>iostat主要用於監控系統設備的IO負載情況，iostat首次運行時顯示自系統啟動開始的各項統計信息，之後運行iostat將顯示自上次運行該命令以後的統計信息。用戶可以通過指定統計的次數和時間來獲得所需的統計信息。</p><p>基本使用：</p><p>$iostat -d -k 2</p><p>參數說明：</p><p>-d：顯示設備（磁盤）使用狀態；</p><p>-k：某些使用block為單位的列強制使用Kilobytes為單位；</p><p>2：數據顯示每隔2秒刷新一次。</p><img alt="禍害阿里雲宕機3小時的IO HANG究竟是什麼？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RK1IFM07GPYpgh><p>如果提示沒有iostat命令需要使用yum安裝，安裝命令如下：</p><p>`yum install sysstat`</p><p>參數解釋如下：</p><p>tps：該設備每秒的傳輸次數，一次傳輸意思是“一次I/O請求”，多個邏輯請求可能會被合併為“一次I/O請求”；</p><p>kB_read/s：每秒從設備（drive expressed）讀取的數據量；kB_wrtn/s：每秒向設備（drive expressed）寫入的數據量；</p><p>kB_read：讀取的總數據量；</p><p>kB_wrtn：寫入的總數量數據量，這些單位都為Kilobytes。</p><p>上面的例子中，我們可以看到磁盤sda以及它的各個分區的統計數據，當時瞬時統計的磁盤總TPS是1.88，下面是各個分區的TPS（因為是瞬間值，所以總TPS並不嚴格等於各個分區TPS的總和）。</p><p>在實際業務中，我們經常使用的命令是：</p><p>iostat -xdm</p><p>例如：iostat -xdm 2，2代表2秒鐘刷新一次。</p><img alt="禍害阿里雲宕機3小時的IO HANG究竟是什麼？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RK1IFMB9CbBlzA><p>我們可以看到，%util這個參數即代表磁盤繁忙程度。100%表示磁盤繁忙, 0%表示磁盤空閒。但是我們需要注意，磁盤繁忙程度並不意味著磁盤讀寫速度大小。</p><p>iostat是系統級別的監控指令，iostat給我們的展示結果揭示了我們當前服務器磁盤的繁忙程度，雖然有一定的指導意義，但是不能精確到進程級別，這時候我們就需要iotop了。</p><p><strong>iotop命令</strong></p><p>我們上文講到top命令，顧名思義，iotop代表io版本的top命令，使用起來簡單粗暴，直接在命令行敲下：iotop。</p><img alt="禍害阿里雲宕機3小時的IO HANG究竟是什麼？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RK1IFMO8FvecLL><p>iotop命令可以按進程統計IO狀況,我們可以指導當前系統哪些進程在佔用IO,百分比是多少，佔用IO的進程是在讀，還是在寫，讀寫量是多少等信息。然後我們可以定位到具體的進程，查看進程詳情。</p><p>同樣個iotop命令有一個很像的命令叫做pidstat，參數很多。</p><p>例如：`pidstat -d` ：</p><img alt="禍害阿里雲宕機3小時的IO HANG究竟是什麼？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/RK1IFUR5mi4sF4><p>我們同樣可以看到每個進程的讀寫情況，然後定位到具體的線程去查看問題。</p><p><strong>總結</strong></p><p>在生產實踐中，實時監控我們的服務器IO情況至關重要，尤其是數據庫所在的服務器，它直接關係到我們的程序的讀寫速度、SQL的執行情況等。</p><p>服務器IO的情況是我們選擇服務器的重要考慮因素之一。IO變差，輕則寫入服務讀寫響應緩慢，重則導致大量進程長時間掛起，數據庫擁堵卡死，服務器嚴重卡頓，甚至宕機。</p><p>作者：王知無，阿里巴巴高級大數據開發工程師，先後在京東，阿里等大型互聯網公司從事大數據平臺、實時計算和離線計算中間件和業務平臺開發。自媒體人，業餘講師，希望為更多的互聯網開發人員提供最新和最熱的大數據方向的技術動態，技術前沿研究。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>禍害</a></li><li><a>雲宕機</a></li><li><a>小時</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/647df9c2.html alt=一個男人每天24小時跟妻子在一起，久而久之會怎樣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8359cc22f03e478a8cdb889dcfea3f99 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/647df9c2.html title=一個男人每天24小時跟妻子在一起，久而久之會怎樣>一個男人每天24小時跟妻子在一起，久而久之會怎樣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b2ce4128.html alt=如何每天只睡6小時，還能保持一整天精力充沛？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/3c6693fa-1de9-462a-a935-50eee17e8302 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b2ce4128.html title=如何每天只睡6小時，還能保持一整天精力充沛？>如何每天只睡6小時，還能保持一整天精力充沛？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ab1d5af1.html alt=僅29.7小時！重慶5月日照時數創近22年最少 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RRBMpxa9H1j7lO style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ab1d5af1.html title=僅29.7小時！重慶5月日照時數創近22年最少>僅29.7小時！重慶5月日照時數創近22年最少</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2438d5f5.html alt=平均日照總數21.4小時！重慶10月來竟然只晒這麼點太陽 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2438d5f5.html title=平均日照總數21.4小時！重慶10月來竟然只晒這麼點太陽>平均日照總數21.4小時！重慶10月來竟然只晒這麼點太陽</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c36f59cf.html alt=日照總和24.1小時！上個月錯過的太陽，這個月晒回來 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c36f59cf.html title=日照總和24.1小時！上個月錯過的太陽，這個月晒回來>日照總和24.1小時！上個月錯過的太陽，這個月晒回來</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/76eb9f23.html alt="耗費24小時，整理有關 HashMap 面試會問的一切，收藏吧" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d68d445d73e945c4b16fe36e61d3bb6a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/76eb9f23.html title="耗費24小時，整理有關 HashMap 面試會問的一切，收藏吧">耗費24小時，整理有關 HashMap 面試會問的一切，收藏吧</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f0da33ff.html alt=3小時內完成應急處置，24小時內實施修復！——《成都市檢查井蓋管理辦法》2月1日起施行！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/56830004edeca5521281 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f0da33ff.html title=3小時內完成應急處置，24小時內實施修復！——《成都市檢查井蓋管理辦法》2月1日起施行！>3小時內完成應急處置，24小時內實施修復！——《成都市檢查井蓋管理辦法》2月1日起施行！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/561106ca.html alt="72小時驚心動魄 四川西昌市經久鄉森林火災緊急救援回放" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/Rv04ys8I4ZqWsT style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/561106ca.html title="72小時驚心動魄 四川西昌市經久鄉森林火災緊急救援回放">72小時驚心動魄 四川西昌市經久鄉森林火災緊急救援回放</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/32d2692e.html alt=想精確計算年、月、日、小時、分、秒？就用這幾個函數（上） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1c02bf736a8746c6870d395305ebb5ed style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/32d2692e.html title=想精確計算年、月、日、小時、分、秒？就用這幾個函數（上）>想精確計算年、月、日、小時、分、秒？就用這幾個函數（上）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1d90cfae.html alt=一天只有24小時，如何才能提高時間回報率？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/6fa08d2160b14a029f7b6d6089586714 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1d90cfae.html title=一天只有24小時，如何才能提高時間回報率？>一天只有24小時，如何才能提高時間回報率？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1b10b25c.html alt=分享：四個8小時外的掙外快的路子，一天80一個月2400+ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/16901899-f72c-4cdd-a575-bf26465aef28 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1b10b25c.html title=分享：四個8小時外的掙外快的路子，一天80一個月2400+>分享：四個8小時外的掙外快的路子，一天80一個月2400+</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/84fa977d.html alt=這臺玉米收穫機抗倒伏，1小時可以收15畝玉米 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15319062233112bbfa9fd83 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/84fa977d.html title=這臺玉米收穫機抗倒伏，1小時可以收15畝玉米>這臺玉米收穫機抗倒伏，1小時可以收15畝玉米</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eeac1c91.html alt="10小時分工協作 9小時文字校對 成都醫生完成12130字世衛新型冠狀病毒肺炎指南翻譯" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/Rp50MXI61AzDTq style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eeac1c91.html title="10小時分工協作 9小時文字校對 成都醫生完成12130字世衛新型冠狀病毒肺炎指南翻譯">10小時分工協作 9小時文字校對 成都醫生完成12130字世衛新型冠狀病毒肺炎指南翻譯</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/56293bdd.html alt=崩潰！亞馬遜宕機3小時，大量賣家單量腰斬 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/dd6ef64ca133469b811fcd466e0ca03e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/56293bdd.html title=崩潰！亞馬遜宕機3小時，大量賣家單量腰斬>崩潰！亞馬遜宕機3小時，大量賣家單量腰斬</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5094df2b.html alt=微盟“宕機”36小時：員工因個人原因破壞數據庫，目前仍未徹底恢復 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/RrWKqk37tw0K09 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5094df2b.html title=微盟“宕機”36小時：員工因個人原因破壞數據庫，目前仍未徹底恢復>微盟“宕機”36小時：員工因個人原因破壞數據庫，目前仍未徹底恢復</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>