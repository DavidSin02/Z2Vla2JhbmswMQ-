<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>分佈式系統的彈性設計 | 极客快訊</title><meta property="og:title" content="分佈式系統的彈性設計 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/15242108962176a11c172b3"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/63c65503.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/63c65503.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/63c65503.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/63c65503.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/63c65503.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/63c65503.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/63c65503.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/63c65503.html><meta property="article:published_time" content="2020-11-14T21:07:15+08:00"><meta property="article:modified_time" content="2020-11-14T21:07:15+08:00"><meta name=Keywords content><meta name=description content="分佈式系統的彈性設計"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/63c65503.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>分佈式系統的彈性設計</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>在討論分佈式系統的彈性之前，讓我們快速回顧一些基本術語：</p><p>彈性Resiliency：任何系統從困難中恢復的能力，(banq注：彈性也就是適應能力)。</p><p>分佈式系統：一些網絡組件通過傳遞消息來完成一個共同目標。</p><p>可用性：任何系統在任何時間點保持正常運行的可能性。</p><p>故障與故障：故障Fault是您的系統中是不正確的內部狀態。系統中一些常見的故障例子包括：</p><p>1.存儲層緩慢</p><p>2.應用程序中的內存洩露</p><p>3.被阻塞的線程</p><p>4.依賴性故障</p><p>5.在系統中傳播壞數據（通常是因為輸入數據沒有足夠的驗證）</p><p>失敗Failure是系統無法執行其預期工作。</p><p>失敗意味著系統正常運行時間和可用性的損失。故障如果不被封裝，會導致在系統中傳播，從而導致失敗。</p><p>當故障Fault轉為失敗Failure時就意味著系統發生了故障：</p><p>彈性就是為了防止故障Fault轉化為失敗Failure</p><p>我們為什麼關心繫統的彈性？</p><p>系統的彈性與其正常運行時間和可用性成正比。系統越有彈性，服務用戶的可用性越高。</p><p>如果不具有彈性能力，可能會以多種方式影響公司各個方面。</p><p>分佈式系統的彈性設計很難</p><p>我們都明白'可用'至關重要。為了保證可用性，我們需要從零開始建立彈性，以便我們系統中的故障自動恢復。</p><p>但是在具有多個分佈式系統的複雜微服務架構中建立彈性是很困難的。這些困難是：</p><p>1.網絡不可靠</p><p>2.依賴性總是失敗</p><p>3.用戶行為是不可預測的</p><p>雖然構建彈性很難，但並非不可能。遵循一些構建分佈式系統的模式可以幫助我們在整個服務中實現較高的正常運行時間。我們將討論未來的一些模式：</p><p>模式[0] = nocode</p><p>編寫可靠且安全的應用程序的最佳方式是不寫任何代碼 - 無需寫入和部署</p><p>- Kelsey Hightower</p><p>你寫的代碼中最有彈性的代碼是你從未寫過的代碼。</p><p>你寫的代碼越少，破碎的因素就會越低。</p><p>模式[1] =超時</p><p>停止堵塞住一直等待答案，就要設置超時。</p><p>我們來考慮這個場景：</p><p>你有一個健康的服務'A'依賴於服務'B'。但是服務'B'因為受到影響並且速度很慢。</p><p>默認的Go HTTP客戶端是沒有HTTP超時。這會導致應用程序洩漏go-routines（處理每個請求Go產生一個go-routine）。當您的下游服務緩慢/失敗時，go-routine會永久等待下游服務的回覆。為了避免這個問題，為我們的應用程序中的每個集成點添加超時非常重要。</p><p>如果您的任何下游服務在規定時間內例如1ms沒有回覆，那麼你就可以認為是超時，實現快速失敗fail fast。</p><p>應用程序超時有下面方式的好處：</p><p>1.防止級聯失敗</p><p>級聯失效是非常迅速地將故障傳播到系統其他部分的失敗。</p><p>超時有助於我們通過快速失敗來防止這些故障。當下遊服務出現故障或速度較慢（違反SLA）時，那就不要永遠在傻等響應，儘早提前失敗，還能挽救你的系統以及依賴於你係統的系統。</p><p>2.提供故障隔離</p><p>故障隔離是將故障僅隔離在系統或子系統的某個部位。</p><p>超時能不讓其他系統問題成為你的系統的問題，從而實現失敗隔離。</p><p>應該如何設置超時？</p><p>超時必須基於您的依賴關係提供的SLA。比如可能是99.9％。</p><p>模式[2] =重試</p><p>如果發生一次失敗，請重試</p><p>重試可以幫助減少恢復時間。</p><p>處理間歇性故障時，它們非常有效。</p><p>重試請求也可以設置超時，重試與超時可以一起工作良好。</p><p>立即重試可能並不總是有用</p><p>依賴上的失敗需要花費時間來恢復，在這種情況下，重試可能會導致</p><p>用戶的等待時間延長。為了避免這些漫長的等待時間，我們可能會儘可能排隊並重試這些請求。</p><p>冪等性很重要，維基百科說：</p><p>冪等性是某些操作的屬性，它們可以多次使用，而不會改變第一次使用</p><p>應用程序的情況和結果。</p><p>考慮一個場景，其中某個服務器的請求已處理，但未能回覆結果。在這種情況下，客戶端會嘗試重試相同的操作。如果操作不是冪等的，它將導致整個系統的狀態不一致。</p><p>模式[3] =回退</p><p>優雅地回退</p><p>當系統出現故障時，他們可以選擇使用其他機制來實現降級響應，而不是</p><p>完全失敗。</p><p>地圖服務的案例:使用谷歌地圖服務來計算我們的客戶從他們的取貨位置到目的地的路線路線、估算票價等。我們有一個地圖服務，它是我們調用谷歌的所有API接口。最初，我們曾經因為谷歌地圖api服務放緩而導致預訂創建失敗。我們的系統對延遲時間的增加不具有容錯性。</p><p>我們的解決方案是回退到一個近似路線，當延遲事件啟動時，地圖服務的系統以這種方式降級模式工作。</p><p>在上述情景中的回退有助於我們防止整個系統發生災難性故障，這些災難性故障可能會影響我們的關鍵訂票流程。</p><p>在所有集成點上考慮回退非常重要。</p><p>模式[4] =斷路器</p><p>斷路器以保護您的微服務調用依賴</p><p>每個家庭中都使用保險絲或電閘/斷路器以防止房屋因為用電量突然激增而被燒燬的。</p><p>相同的概念可以應用於分佈式系統，當您知道系統不健康並且出現故障並允許其恢復時，應該停止對下游服務進行調用。</p><p>典型斷路器（CB）上的狀態轉換如下所示：</p><p><img alt=分佈式系統的彈性設計 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15242108962176a11c172b3></p><p>最初當系統健康時，CB處於關閉狀態。在這種狀態下，它會調用下游服務。當一定數量的請求失敗發生時，CB斷開電路並進入打開狀態。在此狀態下，CB停止向失敗的下游服務提出請求。經過一定的睡眠 閾值後，CB通過進入半開狀態嘗試重置。如果此狀態下的下一個請求成功，它將進入關閉狀態。如果此通話失敗，則保持打開狀態。</p><p>Netflix的 Hystrix是這種模式的流行實現。</p><p>集成點需要斷路器，有助於防止級聯故障。您還可以為斷路器添加一個後備電源，以便在斷路狀態下使用它。</p><p>您還需要很好的度量/監控來檢測各個集成點上的各種狀態轉換。Hystrix具有</p><p>幫助您可視化狀態轉換的儀表板。</p><p>模式[5] =彈性測試</p><p>模擬系統中的各種故障條件非常重要。例如：模擬各種網絡故障，網絡中的延遲，依賴性緩慢或死亡等。確定各種故障模式後，通過在其周圍創建某種測試線束來對其進行編碼。這些測試可幫助您對代碼的每次更改都執行一些失敗模式。</p><p>注入故障</p><p>將故障注入到系統中是一種有目的地引發故障以測試彈性的技術。</p><p>Netflix採用了Chaos Monkey，Latency monkey等工具來支持這種方法。</p><p>結論是：</p><p>雖然遵循這些模式可以幫助我們實現彈性，但這並非銀彈。但是使用這些模式可以提高系統的正常運行時間/可用性。</p><p>要有彈性，我們必須：</p><p>針對失敗的可能設計我們的系統</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>系統</a></li><li><a>彈性</a></li><li><a>設計</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/370458ba.html alt=空調系統設計參考筆記 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1533630283425a391ec3790 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/370458ba.html title=空調系統設計參考筆記>空調系統設計參考筆記</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2dbcb8ee.html alt=真空系統設計（電子束焊接） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/a010120044454f3ca15dfc7a195079f0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2dbcb8ee.html title=真空系統設計（電子束焊接）>真空系統設計（電子束焊接）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/00125706.html alt=雲原生時代｜分佈式系統設計知識圖譜（內含22個知識點） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/4bb0cbf6ee294a2c8fbe4e046c504798 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/00125706.html title=雲原生時代｜分佈式系統設計知識圖譜（內含22個知識點）>雲原生時代｜分佈式系統設計知識圖譜（內含22個知識點）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7782e8cb.html alt=真空系統設計（冷凝捕集器的計算） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ea50b57b59424e3c95a6d064809458fd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7782e8cb.html title=真空系統設計（冷凝捕集器的計算）>真空系統設計（冷凝捕集器的計算）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dd0cc902.html alt=真空系統設計（電離真空規） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e2a388898d394e8eac94261b26fb66c5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dd0cc902.html title=真空系統設計（電離真空規）>真空系統設計（電離真空規）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7ec7c325.html alt=PLC控制系統設計的基本內容和一般步驟 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/33e70b70238e44ddb21c2c26958a71a1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7ec7c325.html title=PLC控制系統設計的基本內容和一般步驟>PLC控制系統設計的基本內容和一般步驟</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6d04923f.html alt=「分享」可編程控制器控制系統設計的基本步驟，你還知道哪些？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/49ce3ce367f44139b7385596fc0df095 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6d04923f.html title=「分享」可編程控制器控制系統設計的基本步驟，你還知道哪些？>「分享」可編程控制器控制系統設計的基本步驟，你還知道哪些？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4298e49a.html alt=塑膠模具設計-冷卻系統設計標準 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0a9de70b9fb2407ca083e5287a43737e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4298e49a.html title=塑膠模具設計-冷卻系統設計標準>塑膠模具設計-冷卻系統設計標準</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4a5ee88d.html alt=如何設計一套合格的電氣控制系統？這裡告訴你 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5814958ad74443478bad251925072e7f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4a5ee88d.html title=如何設計一套合格的電氣控制系統？這裡告訴你>如何設計一套合格的電氣控制系統？這裡告訴你</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/46290de7.html alt=樓宇智能系統設計圖紙的基本要求 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/29e34facd5dc4dbcae84fa19ad318cf5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/46290de7.html title=樓宇智能系統設計圖紙的基本要求>樓宇智能系統設計圖紙的基本要求</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/33e2706e.html alt=液壓系統集成塊功用及設計原則 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/57e7568720264b4f858c274cb05dd789 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/33e2706e.html title=液壓系統集成塊功用及設計原則>液壓系統集成塊功用及設計原則</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fa5417e0.html alt=真空系統設計（真空規） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/78449d33c3554cc2b78aa0141931ac4c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fa5417e0.html title=真空系統設計（真空規）>真空系統設計（真空規）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/57bd493d.html alt=真空系統設計（速度） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/aad28bdadfdd4864a7c406853801aa8c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/57bd493d.html title=真空系統設計（速度）>真空系統設計（速度）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3c7d78cb.html alt="軟件系統設計重要原則 （第1部分）" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3c7d78cb.html title="軟件系統設計重要原則 （第1部分）">軟件系統設計重要原則 （第1部分）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c904bdf7.html alt=電驅動常用冷卻系統設計 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/785a842536a64e6a98fa19a2c8a7066e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c904bdf7.html title=電驅動常用冷卻系統設計>電驅動常用冷卻系統設計</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>