<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>grain是一個組件式的RPC框架，靈活且適合與任何框架整合 | 极客快訊</title><meta property="og:title" content="grain是一個組件式的RPC框架，靈活且適合與任何框架整合 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/22f4dc351f4e4534a2e6d8aea99154d4"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6a29c81f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6a29c81f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6a29c81f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6a29c81f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6a29c81f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6a29c81f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6a29c81f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6a29c81f.html><meta property="article:published_time" content="2020-10-29T21:09:13+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:13+08:00"><meta name=Keywords content><meta name=description content="grain是一個組件式的RPC框架，靈活且適合與任何框架整合"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/6a29c81f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>grain是一個組件式的RPC框架，靈活且適合與任何框架整合</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>grain是一個極簡的、組件式的RPC框架，靈活且適合漸進學習，可與任何框架整合。同時包含（系統通用多線程模型與消息通訊、多對多關係的分佈式鎖、基於Servlet的HTTP框架、基於系統通用多線程模型的Websocket框架、支持行級鎖的多線程鎖）等組件，按需選擇組件，不綁架開發者。</p><p>grain架構圖及其依賴關係（深顏色的是核心組件強烈推薦）</p><div class=pgc-img><img alt=grain是一個組件式的RPC框架，靈活且適合與任何框架整合 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/22f4dc351f4e4534a2e6d8aea99154d4><p class=pgc-img-caption></p></div><p>核心組件介紹</p><hr><p>1、thread（系統通用多線程模型）</p><p>介紹：完美抽象了客觀事物，包含：1、活躍於線程之間的活物，進入動作、離開動作、輪訓動作（例如：人可以在線程間切換），2、處理完即銷燬的非活物，處理動作（例如：各類消息包處理後即可銷燬）。3、優秀的多線程輪訓機制，隊列機制（生產者與消費者），服務器掌握絕對的控制權。</p><div class=pgc-img><img alt=grain是一個組件式的RPC框架，靈活且適合與任何框架整合 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d9ddc107302648b98126ce47d71a5a0e><p class=pgc-img-caption></p></div><p>使用場景：rpc、distributedlock、threadwebsocket，都是基於此係統通用多線程模型。任何需要多線程的業務都可以使用：例如MMORPG、即時通訊等。</p><p>示例代碼：</p><p>1、啟動示例，創建10條線程，每條線程3個優先級，每次輪訓間隔100毫秒，通過ILog實現類的對象打印日誌，鎖定線程0條。</p><pre>AsyncThreadManager.init(100, 10, 3, 0, ILog實現類的對象);AsyncThreadManager.start();</pre><p>2、將活物加入線程1、優先級1的進入隊列（之後會觸發進入動作、之後不斷觸發輪訓動作）</p><pre>AsyncThreadManager.addCycle(ICycle實現類的對象, 1, 1);</pre><p>3、將活物加入線程1、優先級1的離開隊列（之後會觸發離開動作）</p><pre>AsyncThreadManager.removeCycle(ICycle實現類的對象, 1, 1);</pre><p>4、將非活物加入線程1、優先級1的處理隊列（之後會觸發處理動作，處理完即銷燬）</p><pre>AsyncThreadManager.addHandle(IHandle實現類的對象, 1, 1);</pre><hr><p>2、threadmsg（系統通用多線程模型與消息通訊）。</p><p>介紹：支持與系統通用多線程模型、系統通用多線程模型之間進行消息通訊。可以進行消息配置、消息註冊、消息分發、消息回調。</p><p>使用場景：需要系統通用多線程模型的場景，一般都需要進行消息通訊。可以一直跟thread綁定使用。</p><p>示例代碼：</p><p>1、初始化，通過ILog實現類的對象打印日誌</p><pre>MsgManager.init(true, Ilog日誌);</pre><p>2、設置所有關注createuser消息的處理函數在線程1、優先級1進行處理（如果不設置，則隨機線程隨機優先級處理）</p><pre>ThreadMsgManager.addMapping("createuser", new int[] { 1, 1 });</pre><p>3、註冊關注某消息及對應處理函數（第2步消息設置歸屬哪個線程，對應處理函數就在哪個線程回調）</p><pre>MsgManager.addMsgListener(IMsgListener實現類對象);</pre><p>4、派發createuser消息，攜帶數據111與額外數據222（第3步所有關注此消息的處理函數，進行回調）</p><pre>ThreadMsgManager.dispatchThreadMsg("createuser", 111, 222);</pre><hr><p>3、rpc（支持多對多關係的RPC框架，含：RPC客戶端與RPC服務器）。</p><p>介紹：基於Mina網絡層及Protobuf序列化開發的RPC通訊框架，相比7層HTTP通訊，4層TCP通訊消息包更小、傳輸速度更快、隊列化處理消息包、消息包與線程可一一映射配置化，支持多對多關係、斷線重連等。</p><div class=pgc-img><img alt=grain是一個組件式的RPC框架，靈活且適合與任何框架整合 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b48c54a44ef74780b5551689ca5c4cd4><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=grain是一個組件式的RPC框架，靈活且適合與任何框架整合 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/abe478ccb7054ff7901f38f85e0aeb7c><p class=pgc-img-caption></p></div><p>使用場景：生產環境內部網絡的服務器之間進行消息通訊。</p><p>示例代碼：</p><p>1、RPC客戶端（啟動類test.RPCClientTest.java，直接啟動即可連接下面的RPC服務器）</p><p>>>>>>>RPC客戶端Demo</p><p>2、RPC服務器（啟動類test.RPCServerTest.java，直接啟動即可接受上面的RPC客戶端連接請求）</p><p>>>>>>>RPC服務器Demo</p><p>3、RPC方式獲取數據示例</p><pre>//創建消息包RPCTestC.Builder builder = RPCTestC.newBuilder();builder.setName("RPC服務器你好啊");TcpPacket pt = new TcpPacket("TEST_RPC_C", builder.build());//RPC遠程調用，返回結果TcpPacket ptReturn = WaitLockManager.lock(session, pt);</pre><hr><p>4、distributedlock（支持多對多關係的分佈式鎖，含：分佈式鎖客戶端與分佈式鎖服務器）。</p><p>介紹：去中心化，支持行級鎖（鎖某類型的單鍵值）。不同類型互不影響，相同類型不同鍵值互不影響。僅當類型與鍵值都相等時會進行分佈式阻塞。</p><p>注意：如果一臺服務器已經承擔了分佈式鎖服務器的角色，就不要用該服務器承擔別的角色，因為這臺服務器的大多數線程都會不時進行線程阻塞，等待鎖客戶端釋放鎖。</p><div class=pgc-img><img alt=grain是一個組件式的RPC框架，靈活且適合與任何框架整合 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/90418570aa4346b3990a5f8e5d3a0861><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=grain是一個組件式的RPC框架，靈活且適合與任何框架整合 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b50d36b27fc345d08d160e191b93600d><p class=pgc-img-caption></p></div><p>使用場景：在無中心化的服務器集群中，有很大的意義。不用依賴數據庫Mysql，即可保障服務器集群業務的原子性，又大幅度提高服務器集群性能，減少錯誤的數據庫提交。</p><p>獲取方式</p><p>轉發文章+關注，然後私住回覆【GRA】，即可免費獲得下載地址</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>框架</a></li><li><a>grain</a></li><li><a>一個</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/ac25d2d0.html alt=30分鐘教你搭建一個網站（一）：購買和配置服務器 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/5f26f1582a564e93bde33a7dd9448c3b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ac25d2d0.html title=30分鐘教你搭建一個網站（一）：購買和配置服務器>30分鐘教你搭建一個網站（一）：購買和配置服務器</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d8be5e94.html alt=不會買服務器？一個辦法讓你輕鬆搭網站 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/84d9c54578de46058796824f1bcb6a9b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d8be5e94.html title=不會買服務器？一個辦法讓你輕鬆搭網站>不會買服務器？一個辦法讓你輕鬆搭網站</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c811c5f7.html alt=使用服務器搭建一個網站 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/63a6cc0eb4d146e0890515500c0040ca style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c811c5f7.html title=使用服務器搭建一個網站>使用服務器搭建一個網站</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4b69aa7f.html alt=做一個小型網站，服務器需要什麼配置的呢？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4b69aa7f.html title=做一個小型網站，服務器需要什麼配置的呢？>做一個小型網站，服務器需要什麼配置的呢？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eee4b8ad.html alt=搭建一個網站，租服務器大概多少錢？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eee4b8ad.html title=搭建一個網站，租服務器大概多少錢？>搭建一個網站，租服務器大概多少錢？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/62d46b38.html alt=素描祕籍｜一個耳朵！9大知識點，360度全方位深度剖析講解示範！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/5e7b0005767168b2b87d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/62d46b38.html title=素描祕籍｜一個耳朵！9大知識點，360度全方位深度剖析講解示範！>素描祕籍｜一個耳朵！9大知識點，360度全方位深度剖析講解示範！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/647df9c2.html alt=一個男人每天24小時跟妻子在一起，久而久之會怎樣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8359cc22f03e478a8cdb889dcfea3f99 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/647df9c2.html title=一個男人每天24小時跟妻子在一起，久而久之會怎樣>一個男人每天24小時跟妻子在一起，久而久之會怎樣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5a86d7d9.html alt=每天一個好習慣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RKdGgquJFM6gnc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5a86d7d9.html title=每天一個好習慣>每天一個好習慣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/756b16fb.html alt=奶粉寄出一個月，家人遲遲收不到，物流信息也查詢不到，事發阜陽某韻達快遞網點 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/3fd8ec4e-64c1-446a-adfa-38088fb06c01 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/756b16fb.html title=奶粉寄出一個月，家人遲遲收不到，物流信息也查詢不到，事發阜陽某韻達快遞網點>奶粉寄出一個月，家人遲遲收不到，物流信息也查詢不到，事發阜陽某韻達快遞網點</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b29ee719.html alt=又一個走上不歸路的搬磚人 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/bf471da0a06441f88bce49b959234257 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b29ee719.html title=又一個走上不歸路的搬磚人>又一個走上不歸路的搬磚人</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3d6d5661.html alt=多收藏一個，就少求一次人—哪些日常必備神級網站，真正值得收藏 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/833949926ebf49b89c5fb4075a9cffdd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3d6d5661.html title=多收藏一個，就少求一次人—哪些日常必備神級網站，真正值得收藏>多收藏一個，就少求一次人—哪些日常必備神級網站，真正值得收藏</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/917424fc.html alt=一個三年級小孩掌握腦王速記法之數字編碼後倒背如流圓周率1萬位 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/5b430002414bdad7cc1f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/917424fc.html title=一個三年級小孩掌握腦王速記法之數字編碼後倒背如流圓周率1萬位>一個三年級小孩掌握腦王速記法之數字編碼後倒背如流圓周率1萬位</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/25157041.html alt=聖胡安（波多黎各）：一個很不美國的美國城市 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/d049f3231cda4890ae11c23b2c8f8f70 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/25157041.html title=聖胡安（波多黎各）：一個很不美國的美國城市>聖胡安（波多黎各）：一個很不美國的美國城市</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d2ca7396.html alt=人工智能的下一個春天：情緒和情感計算 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ReV1j945oIOAmo style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d2ca7396.html title=人工智能的下一個春天：情緒和情感計算>人工智能的下一個春天：情緒和情感計算</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f649e4a6.html alt=舊廠房孵化新科技——一個國家級高新區的“雙創”見聞 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f649e4a6.html title=舊廠房孵化新科技——一個國家級高新區的“雙創”見聞>舊廠房孵化新科技——一個國家級高新區的“雙創”見聞</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>