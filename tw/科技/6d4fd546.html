<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>陌陌風控系統靜態規則引擎aswan | 极客快訊</title><meta property="og:title" content="陌陌風控系統靜態規則引擎aswan - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/e8e319cad81c459285c50afa9c16bfa2"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6d4fd546.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6d4fd546.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6d4fd546.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6d4fd546.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6d4fd546.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6d4fd546.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/6d4fd546.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/6d4fd546.html><meta property="article:published_time" content="2020-11-14T20:59:54+08:00"><meta property="article:modified_time" content="2020-11-14T20:59:54+08:00"><meta name=Keywords content><meta name=description content="陌陌風控系統靜態規則引擎aswan"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/6d4fd546.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>陌陌風控系統靜態規則引擎aswan</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>陌陌風控系統靜態規則引擎，零基礎簡易便捷的配置多種複雜規則，實時高效管控用戶異常行為。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=陌陌風控系統靜態規則引擎aswan onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e8e319cad81c459285c50afa9c16bfa2><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p>【名詞解釋】</p><p>策略原子：基於用戶行為數據進行異常判斷的基礎元素，如設備黑名單、手機號黑名單等</p><p>管控原子：用戶命中策略原子後對應的管控措施，如短信驗證碼、滑動驗證碼等；</p><p>規則：基於不同業務點建立的規則ID，由多條策略原子+管控原子構成；</p><p>錯誤提示碼：用於前端規則命中後的提示，便於運營人員排查問題，解決問題。</p><p>【方案設計簡介】</p><p>規則配置：用於不同業務點的規則配置；</p><p>策略配置：用於設置策略原子及策略原子；</p><p>數據源配置：基於業務數據而設置的數據來源key，用於風控策略的運算；</p><p>數據統計：用戶命中規則的數據統計與展示；</p><p>【使用說明】</p><p>當一個業務需要接入風控系統進行管控時，通過以下步驟進行配置</p><p>1. 建立該業務數據源，業務方需要向此數據源推送業務相關數據；</p><p>2. 建立該業務所需要的策略原子，部分策略原子需要依賴該業務數據源；</p><p>3. 新建規則配置，設置策略名稱、權重、策略原子組、管控原子、提示語，完成規則配置；</p><p>4. 業務方調用此配置，進行業務風控；</p><p>快速啟動</p><ol><li>本項目依賴redis, mysql, mongodb，因此需準備環境並更改配置項</li></ol><pre> # 為了簡單可以使用docker安裝 # docker安裝文檔地址(以ubuntu為例): https://docs.docker.com/install/linux/docker-ce/ubuntu/ mongo: docker run -d --name mongo -v $HOME/docker_volumes/mongodb:/data/db -p 27017:27017 mongo:latest mysql: docker run -d --name mysql -e MYSQL_ROOT_PASSWORD=root -v $HOME/docker_volumes/mysql:/var/lib/mysql -v $HOME/docker_volumes/conf/mysql:/etc/mysql/conf.d -p 3306:3306 mysql:5.6 redis: docker run -d --name redis -p 6379:6379 -v $HOME/docker_volumes/redis:/var/lib/redis redis:latest</pre><ol><li>在mysql中創建risk_control庫</li></ol><pre> docker exec -it mysql mysql -h 127.0.0.1 -u root -p # 後續需輸入密碼 若以上述方式安裝mysql，密碼為root. CREATE DATABASE risk_control CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci; # 創建數據庫時指定編碼格式，規避亂碼問題(注意: 此編碼格式在mysql低版本上可能有兼容性問題)</pre><ol><li>安裝所需依賴，本項目基於python2.7進行開發，可運行pip install -r requirements.txt安裝依賴包</li><li>初始化django運行所需的表並創建賬戶，並可以預生成一些數據(可選)</li></ol><pre> # 在www目錄下 python manage.py makemigrations &amp;&amp; python manage.py migrate # 創建管理員賬戶 此處詳見 其它操作--增加用戶 python manage.py createsuperuser # 後續 依次輸入用戶名、密碼、郵箱 即可創建一個管理員賬號 # 如果希望對系統有一個直觀的感受，可以使用如下指令來預注入一些數據 python manage.py init_risk_data</pre><ol><li>啟動服務</li></ol><pre> # 在aswan下以nohup的方式啟動服務進程、管理後臺、攔截日誌消費進程 bash start.sh</pre><p>後臺介紹</p><ol><li>名單管理</li><li>為名單型策略提供基礎的數據管理功能。</li><li>名單數據的維度包括：用戶ID、IP、設備號、支付賬號、手機號。後續也可以根據自己的需求擴充其他的維度。</li><li>名單包含三個類型：黑、白、灰名單</li><li>名單必須屬於某個項目(用於確定名單的範圍)，可以在名單管理-名單項目管理中添加項目。</li></ol><ol><li>名單型策略</li><li>描述符為**{參數名:單選,假設是“用戶ID”} {操作碼：在/不在} {XX項目:單選，可選全局} 的 {維度：單選}{方向：黑/白/灰名單}**</li><li>示例：用戶ID 在 初始項目 的 用戶黑名單 中</li></ol><div class=pgc-img><img alt=陌陌風控系統靜態規則引擎aswan onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f2f548ce02524485815f4756c2ec4270><p class=pgc-img-caption></p></div><ol><li><br></li><li>布爾型策略</li><li>不傳閾值的布爾型，描述符為 {參數名:單選，假設是"賬號ID"} {操作碼：是/不是} {內置函數：異常用戶} 示例：賬號ID是異常用戶</li><li>傳閾值的布爾型，描述符為 {參數名:單選，假設是"賬號ID"} {操作碼：大於/小於/等於/不等於} {內置函數：歷史登錄次數} {閾值：170} 示例：賬號ID歷史登錄次數大於100</li><li><br></li><li>內置函數是什麼？就是自定義的一些邏輯判斷函數，只需要滿足要求返回布爾值即可。比如註冊時間是否在某個範圍以內，當前設備是否是常用設備。</li><li>時段頻控型策略</li><li>描述符為 同一 {計數維度:單選，假設是“設備”} 在 {時段：時間跨度} 內限制 {閾值：整數N} 次 某動作 示例：同一設備一天內限制操作10次. 可是我怎麼知道當前已經有多少次呢？這就需要上報，上報後將計數 詳見第9條 數據源管理</li></ol><div class=pgc-img><img alt=陌陌風控系統靜態規則引擎aswan onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/ee5f364f82144d59b51008b85c23b757><p class=pgc-img-caption></p></div><ol><li><br></li><li>限用戶數型策略</li><li>描述符為 同一 {計數維度:單選，假設是“設備”} 在 {時段：時間跨度} 內限制 {閾值：整數N} 個用戶</li><li>示例：同一設備當天限10個用戶 此策略同樣需要上報的數據，且由於與用戶相關，因此上報數據中必須包含user_id字段(在數據源中需配置) 詳見第9條 數據源管理</li><li><br></li><li>規則管理</li><li>管控原子：命中某條策略後的管控動作，比如攔截... 把上面2--5中所述的策略原子按照優先級組合起來，由上向下執行，直到命中某條策略，則返回對應策略的管控原子。此模塊更多是重交互，完成策略的配置、組合、權重等等</li></ol><div class=pgc-img><img alt=陌陌風控系統靜態規則引擎aswan onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/4638e8f4c6014685bcd88101ba8feed0><p class=pgc-img-caption></p></div><ol><li><br></li><li>日誌管理</li><li>所有命中策略的日誌均在此展示，也會包含審計相關的日誌，下一期會基於此日誌，開放攔截溯源功能。</li></ol><div class=pgc-img><img alt=陌陌風控系統靜態規則引擎aswan onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/4638e8f4c6014685bcd88101ba8feed0><p class=pgc-img-caption></p></div><ol><li>權限配置</li><li>供權限設置使用，精確限定某個用戶能看哪些頁面的數據。 詳見 其它 -- 權限管理。</li><li>數據源配置</li><li>示例策略：同一設備一天內限制登錄1000次 那麼每次登陸就需要上報一條數據，系統會分類計數，並分類存儲。 存儲的名字叫啥？就是此處要配置的數據源。對於此策略，只需要配置數據源，命名為login_uid, 字段包含uid, uid類型是string。然後程序就能根據uid為維度計數，並自動計算指定時間窗口內是否超出指定閾值。</li><li>重要：由於邏輯必然依賴時間信息，為通用且必需字段，timestamp為默認隱含字段，類型是時間戳(精確到秒，整數)</li></ol><p>調用樣例</p><ol><li>調用查詢服務</li><li>假設存在id為1的規則，則可以通過如下方式查詢是否命中策略</li></ol><pre>curl 127.0.0.1:50000/query/ -X POST -d '{"rule_id": "1", "user_id": "10000"}' -H "Content-Type:application/json"</pre><ol><li>調用上報服務</li><li>假設存在名稱為test的數據源, 且數據源含有的數據是: {"ip": "string", "user_id": "string", "uid": "string"}</li></ol><pre>curl 127.0.0.1:50000/report/ -X POST -d '{"source_name": "test", "user_id": "10000", "ip": "127.0.0.1", "uid": "abcabc112333222", "timestamp": 1559049606}' -H "Content-Type:application/json"</pre><ol><li>關於服務拆分</li><li>開源樣例中，為了簡化安裝部署，查詢和上報揉進了一個服務。實際場景中，顯然讀寫應該分離。</li><li>1.可以直接此方式部署2份，域名不同，一份用於查詢(上報接口不被訪問)，一份用於上報(查詢接口不被訪問)，流量分發在nginx層完成</li><li>2.risk_server.py中修改配置URL_2_HANDLERS，選擇您需要的服務接口部署</li></ol><p>內置函數的擴展</p><ol><li>不帶閾值的內置函數擴展</li><li>以是否異常用戶內置函數為例</li><li>代碼見 aswan/buildin_funcs/sample.py 中的 is_abnormal 方法</li><li>帶閾值的內置函數布爾型策略擴展</li><li>以歷史登錄次數內置函數為例</li><li>代碼見 aswan/buildin_funcs/sample.py 中的 user_login_count 方法</li><li>注意：閾值計算不包含在內置函數中進行，控制流詳見 aswan/buildin_funcs/base.py</li></ol><p>其它</p><p>增加用戶</p><p>考慮到企業用戶大多數為域賬戶登錄，因此推薦使用LDAP認證模塊直接集成。但考慮到大家的場景不一樣，因此也可以手動增加用戶，樣例代碼如下:</p><pre># coding=utf-8from django.contrib.auth.models import Userusername = 'username'password = 'password'email = 'email@momo.com'first_name = '測'last_name = '試'# 普通用戶User.objects.create_user(username=username, password=password, email=email, first_name=first_name, last_name=last_name)# 管理員賬戶User.objects.create_superuser(username=username, password=password, email=email, first_name=first_name, last_name=last_name)</pre><p>添加完成後，讓用戶登錄，然後管理員配置權限即可。</p><p>權限管理</p><p>目前的權限模型包含如下元素，可在對應的頁面進行配置。</p><p>元素名稱元素含義配置方式注uri風控管理後臺的一個獨立uri開發時自動產生此處uri為相對路徑，例如: /permissions/groups/uri組多個相互關聯的uri可以被放置到一個uri組中/permissions/uri_groups/-權限組多個uri組可以被分配到一個權限組中/permissions/groups/-用戶用戶即為獨立的個人/員工/permissions/users/1. 本系統在界面上不提供添加用戶的功能；2. 用戶可以被分配到某個權限組中，也可以直接配置uri組管理員即為系統的擁有者，默認擁有所有權限手動配置-</p><p>配置相關</p><p>目前Django部分的配置均存放於 www/settings 目錄，非Django部分的配置均位於 config 目錄下。</p><p>為了在不同環境加載不同的配置，我們使用了RISK_ENV這個環境變量，系統在運行時會自動通過這個環境變量的值加載對應的配置文件。</p><p>為了方便項目啟動，在未設置這個值時，系統默認會加載 develop 環境的配置。而在執行測試時(python manage.py test)時，RISK_ENV的值必須是 test 。</p><p>git地址：https://github.com/momosecurity/aswan</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>陌風</a></li><li><a>控系</a></li><li><a>統靜態</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/41dd0692.html alt=京東基於Spark的風控系統架構實踐和技術細節「轉」 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7805ea687b1a4e1d8317b4457dd2c4c2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/41dd0692.html title=京東基於Spark的風控系統架構實踐和技術細節「轉」>京東基於Spark的風控系統架構實踐和技術細節「轉」</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3af2148b.html alt=2020年中國數控系統產業全景圖譜 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9e1f227d810742c99ab2aff61520bac5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3af2148b.html title=2020年中國數控系統產業全景圖譜>2020年中國數控系統產業全景圖譜</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/66bc550.html alt=銀行視頻監控系統設計及施工方案編制 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3e1735e2b8d646d98ce461a0c435862e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/66bc550.html title=銀行視頻監控系統設計及施工方案編制>銀行視頻監控系統設計及施工方案編制</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a2ef7de.html alt=塑料擠出機溫控系統常見故障及原因分析 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8b7983a3c0ba4079bfe0839ece51ad37 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a2ef7de.html title=塑料擠出機溫控系統常見故障及原因分析>塑料擠出機溫控系統常見故障及原因分析</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>