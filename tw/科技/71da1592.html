<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Hadoopä¹‹HDFS | æå®¢å¿«è¨Š</title><meta property="og:title" content="Hadoopä¹‹HDFS - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/1cea562f356248cc81e9df66fdf8b0a1"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/71da1592.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/71da1592.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/71da1592.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/71da1592.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/71da1592.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/71da1592.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/71da1592.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/71da1592.html><meta property="article:published_time" content="2020-11-14T21:03:23+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:23+08:00"><meta name=Keywords content><meta name=description content="Hadoopä¹‹HDFS"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/71da1592.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Hadoopä¹‹HDFS</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right><strong><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">HDFSé‡è¦æ¦‚å¿µ</span></strong></h1><ul><li><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">å…¸å‹çš„Master/Slaveæ¶æ§‹<br>HDFSå¾€å¾€æ˜¯ç”±ä¸€å€‹NameNodeï¼ˆHAæ¶æ§‹æœƒæœ‰å…©å€‹NameNodeï¼Œè¯é‚¦æ©Ÿåˆ¶ï¼‰å’Œå¤šå€‹DataNodeçµ„æˆ</span></li><li><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">åˆ†å¡Šå­˜å„²ï¼ˆBlockæ©Ÿåˆ¶ï¼‰<br>HDFSä¸­çš„æ–‡ä»¶åœ¨ç‰©ç†ä¸Šæ˜¯åˆ†å¡Šå­˜å„²ï¼Œå¡Šçš„å¤§å°å¯èª¿æ•´ï¼Œ2.xç‰ˆæœ¬blockå¤§å°é»˜èªæ˜¯128Mã€‚ç•¶æ–‡ä»¶å¤§æ–¼128Mï¼Œå°‡æ–‡ä»¶åˆ‡ç‰‡å­˜å„²</span></li><li><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">å‘½åç©ºé–“(NameSpace)<br>HDFSæ”¯æŒå‚³çµ±çš„å±¤æ¬¡å‹æ–‡ä»¶çµ„ç¹”çµæ§‹ã€‚ç”¨æˆ¶å¯ä»¥å‰µå»ºç›®éŒ„ï¼Œå¯ä»¥å‰µå»ºã€åˆªé™¤ã€ç§»å‹•ã€é‡å‘½åæ–‡ä»¶<br>NameNode è¤‡è£½ç¶­è­·æ–‡ä»¶ç³»çµ±çš„åå­—ç©ºé–“ï¼Œä»»ä½•å°æ–‡ä»¶ç³»çµ±åå­—ç©ºé–“æˆ–å±¬æ€§çš„ä¿®æ”¹</span><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">éƒ½è­·</span><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">è¢«NameNodeè¨˜éŒ„ä¸‹ä¾†<br>HDFSæä¾›çµ¦å®¢æˆ¶ä¸€å€‹å–®ä¸€æŠ½è±¡çš„ç›®éŒ„æ¨¹ï¼Œå› ç‚ºæ•¸æ“šéƒ½å­˜æ”¾åœ¨DataNodeä¸­ï¼Œä¸æœƒå»é¡¯ç¤ºå­˜æ”¾åˆ°å“ªå€‹DataNode,æ˜¯æŠŠå¤šå€‹DataNodeæŠ½è±¡æˆä¸€å€‹ç›®éŒ„æ¨¹ï¼Œå®¢æˆ¶ç«¯è¨ªå•å½¢å¼ï¼šhdfs://namenode:namenodeçš„port/test/input å³ hdfs://linux121:9000/test/input</span></li><li><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">NameNodeçš„å…ƒæ•¸æ“šç®¡ç†<br>ç›®éŒ„çµæ§‹ã€æ–‡ä»¶åˆ†å¡Šä½ç½®ä¿¡æ¯å«åšå…ƒæ•¸æ“šï¼ŒNameNodeçš„å…ƒæ•¸æ“šè¨˜éŒ„æ¯å€‹æ–‡ä»¶æ‰€å­˜æ”¾çš„blockä¿¡æ¯ï¼ˆblockçš„IDåŠæ‰€åœ¨çš„DataNodeç¯€é»çš„ä¿¡æ¯ï¼‰</span></li><li><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">DataNodeæ•¸æ“šå„²å­˜<br>æ–‡ä»¶å­˜æ”¾åœ¨Blockä¸­ï¼Œè€ŒBlockçš„å…·é«”ç®¡ç†ç”±DataNodeç¯€é»æ‰¿æ“”ï¼Œä¸€å€‹Blockæœƒæœ‰å¤šå€‹DataNodeå­˜å„²ï¼ŒDataNodeæœƒå®šæ™‚ç›¸é—œNameNodeå½™å ±è‡ªå·±æŒæœ‰çš„Blockçš„ä¿¡æ¯</span></li><li><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">å‰¯æœ¬æ©Ÿåˆ¶<br>ç‚ºäº†å®¹éŒ¯ï¼Œæ–‡ä»¶æ‰€æœ‰çš„blockéƒ½æœ‰å‰¯æœ¬ï¼Œå¤§å°å’Œæ•¸é‡éƒ½å¯ä»¥é…ç½®ï¼Œå‰¯æœ¬ä¸æ˜¯ä»¥æŸå€‹æ–‡ä»¶è€Œæ˜¯ä»¥æ•´å€‹blockå‚™ä»½ã€‚å‰¯æœ¬çš„é»˜èªæ•¸é‡æ˜¯3å€‹</span></li><li><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">ä¸€æ¬¡å¯«å…¥ï¼Œå¤šæ¬¡è®€å‡º<br>HDFSé©åˆä¸€èµ·å¯«å…¥ï¼Œå¤šæ¬¡è®€å‡ºï¼Œä¸æ”¯æŒéš¨æ©Ÿä¿®æ”¹ï¼Œæ”¯æŒè¿½åŠ å¯«å…¥æ“ä½œã€‚ä¸é©åˆåšç¶²ç›¤</span></li></ul><h1 class=pgc-h-arrow-right><strong><span style="color:#3e3e3e;--tt-darkmode-color: #A3A3A3">HDFSæ¶æ§‹</span></strong></h1><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1cea562f356248cc81e9df66fdf8b0a1><p class=pgc-img-caption>HDFSæ¶æ§‹åœ–.png</p></div><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/045e34d9b838472ba11659c7ce9d6134><p class=pgc-img-caption>HDFSæ¶æ§‹ä¸­æ–‡ç‰ˆæœ¬.png</p></div><ul><li>å®¢æˆ¶ç«¯ ä¸Šå‚³æ–‡ä»¶åˆ°HDFSçš„æ™‚å€™ï¼ŒClientè² è²¬æ–‡ä»¶çš„åˆ‡åˆ†Blockï¼Œç„¶å¾Œé€²è¡Œä¸Šå‚³ å‘DataNodeè² è²¬ä¸Šå‚³ä¸‹è¼‰æ–‡ä»¶ èˆ‡NameNodeäº¤äº’ï¼Œç²å–æ–‡ä»¶Blockä½ç½®ä¿¡æ¯</li><li>NameNode ç¶­è­·ç®¡ç†HDFSçš„åç¨±ç©ºé–“ï¼ˆNameSpaceï¼‰ ç¶­è­·å‰¯æœ¬ç­–ç•¥ è¨˜éŒ„æ–‡ä»¶å¡Šï¼ˆBlockï¼‰çš„æ˜ å°„ä¿¡æ¯ è™•ç†å®¢æˆ¶ç«¯çš„è®€å¯«è«‹æ±‚</li><li>DataNode å¯¦éš›å­˜å„²Blockæ•¸æ“š è² è²¬Blockè®€å¯«æ•¸æ“š è¤‡è£½ï¼ˆå‰¯æœ¬ï¼‰</li></ul><h1 class=pgc-h-arrow-right><strong>Shellå‘½ä»¤è¡Œæ“ä½œHDFS</strong></h1><p>æŸ¥çœ‹æŸå€‹å‘½ä»¤çš„å…·é«”ç”¨æ³•ï¼Œå¦‚catçš„ç”¨æ³•</p><pre><code>hadoopÂ fsÂ -helpÂ cat</code></pre><p>æŸ¥çœ‹æŸå€‹ç›®éŒ„ä¸‹é¢çš„æ–‡ä»¶,ä¾‹å¦‚æ ¹ç›®éŒ„(æŸ¥çœ‹çš„æ˜¯HDFSçš„æ ¹ç›®éŒ„)</p><pre><code>hdfsÂ dfsÂ -lsÂ /</code></pre><p>å‰µå»ºä¸€å€‹ç›®éŒ„,åœ¨æ ¹ç›®éŒ„ä¸‹é¢å‰µå»ºä¸€å€‹lgå’Œè‡ªå·±bigdata</p><pre><code>hadoopÂ fsÂ -mkdirÂ -pÂ /lagou/bigdata</code></pre><p>å¾æœ¬åœ°ç§»å‹•(å‰ªåˆ‡ç²˜è²¼)å€‹æ–‡ä»¶åˆ°æœå‹™å™¨</p><pre><code>hadoopÂ fsÂ -moveFromLocalÂ ./test.txtÂ /lagou/bigdata</code></pre><p>æŸ¥çœ‹ä¸€å€‹æ–‡ä»¶å…§å®¹</p><pre><code>Â hadoopÂ fsÂ -catÂ /lagou/bigdata/test.txt</code></pre><p>è¿½åŠ å¯«å…¥</p><pre><code>#ç”Ÿç”¢ä¸€å€‹hdfs.txtçš„æ–‡ä»¶ï¼Œéš¨ä¾¿å¯«é»å…§å®¹vimÂ hdfs.tx#åŸ·è¡Œè¿½åŠ å¯«å…¥Â hadoopÂ fsÂ -appendToFileÂ ./hdfs.txÂ /lagou/bigdata/test.txt</code></pre><p>ä¿®æ”¹æ–‡ä»¶æ¬Šé™</p><pre><code>hadoopÂ fsÂ -chmodÂ 777Â /lagou/bigdata/test.txt</code></pre><p>ä¿®æ”¹ç”¨æˆ¶çµ„</p><pre><code>hadoopÂ fsÂ -chownÂ root:rootÂ /lagou/bigdata/test.txt</code></pre><p>å¾æœ¬åœ°ç§»å‹•(è¤‡è£½ç²˜è²¼)å€‹æ–‡ä»¶åˆ°æœå‹™å™¨</p><pre><code>hadoopÂ fsÂ -copyFromLocalÂ ./test.txtÂ /lagou/bigdatahadoopÂ fsÂ -putÂ ./test.txtÂ /lagou/bigdata</code></pre><p>å¾HDFSç§»å‹•ï¼ˆè¤‡è£½ç²˜è²¼ï¼‰åˆ°æœ¬åœ°</p><pre><code>hadoopÂ fsÂ -corpToLocalÂ /lagou/bigdata/test.txtÂ ./hadoopÂ fsÂ -getÂ /lagou/bigdata/test.txtÂ ./</code></pre><p>åˆªé™¤ç©ºæ–‡ä»¶å¤¾</p><pre><code>hadoopÂ fsÂ -rmdirÂ /test</code></pre><p>é¡¯ç¤ºä¸€å€‹æ–‡ä»¶çš„æœ«å°¾</p><pre><code>hadoopÂ fsÂ -tailÂ /lagou/bigdata/test.txt</code></pre><p>çµ±è¨ˆæ–‡ä»¶å¤¾å¤§å°ä¿¡æ¯</p><pre><code>hadoopÂ fsÂ -duÂ -sÂ -hÂ /lagou/bigdataÂ </code></pre><p>çµ±è¨ˆæ–‡ä»¶å¤§å°ä¿¡æ¯</p><pre><code>hadoopÂ fsÂ -duÂ -sÂ -hÂ /lagou/bigdata/test.txt</code></pre><p>è¨­ç½®HDFSå‰¯æœ¬æ•¸é‡</p><pre><code>hadoopÂ fsÂ -setrepÂ 10Â /test/input/test2.txt</code></pre><p><strong>é€™è£¡è¨­ç½®å‰¯æœ¬æ•¸é‡åªæ˜¯è¨˜éŒ„åœ¨NameNodeè£¡é¢ï¼Œå…·é«”æœ‰æ²’æœ‰åå€‹å‰¯æœ¬éœ€è¦çœ‹æœ‰å¤šå°‘å€‹DataNodeï¼Œå› ç‚ºç›®å‰åªæœ‰3è‡ºæ©Ÿå™¨ï¼Œæœ€æœ‰ä¹Ÿå°±ä¸‰å€‹å‰¯æœ¬ï¼Œåªæœ‰ç¯€é»æ•¸å¢åŠ åˆ°10è‡ºçš„æ™‚å€™ï¼Œå‰¯æœ¬æ•¸é‡æ‰æœƒé”åˆ°10å€‹ã€‚æ‰€ä»¥ï¼Œæ–‡ä»¶çœŸæ­£çš„å‰¯æœ¬æ•¸é‡å–æ±ºæ–¼DataNodeæ•¸é‡</strong></p><h1 class=pgc-h-arrow-right><strong>ä½¿ç”¨Ideaéˆæ¥HDFS</strong></h1><p>å°å…¥pom.xml</p><pre><code>&lt;dependencies&gt;    &lt;dependency&gt;        &lt;groupId&gt;junit&lt;/groupId&gt;        &lt;artifactId&gt;junit&lt;/artifactId&gt;        &lt;version&gt;RELEASE&lt;/version&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;        &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;        &lt;version&gt;2.8.2&lt;/version&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;        &lt;artifactId&gt;hadoop-common&lt;/artifactId&gt;        &lt;version&gt;2.9.2&lt;/version&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;        &lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;        &lt;version&gt;2.9.2&lt;/version&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;        &lt;artifactId&gt;hadoop-hdfs&lt;/artifactId&gt;        &lt;version&gt;2.9.2&lt;/version&gt;    &lt;/dependency&gt;&lt;/dependencies&gt;</code></pre><p>ä»£ç¢¼ï¼š</p><pre><code>packageÂ com.hhb.hdfs;importÂ org.apache.hadoop.conf.Configuration;importÂ org.apache.hadoop.fs.*;importÂ org.apache.hadoop.fs.permission.FsPermission;importÂ org.apache.hadoop.io.IOUtils;importÂ org.junit.After;importÂ org.junit.Before;importÂ org.junit.Test;importÂ java.io.File;importÂ java.io.FileInputStream;importÂ java.io.FileOutputStream;importÂ java.io.IOException;importÂ java.net.URI;importÂ java.net.URISyntaxException;/**Â *Â @Date:Â 2020-07-02Â 14:47Â *Â @Description:Â */publicÂ classÂ HdfsClientÂ {Â Â Â Â privateÂ FileSystemÂ fileSystemÂ =Â null;Â Â Â Â privateÂ ConfigurationÂ configurationÂ =Â null;Â Â Â Â @BeforeÂ Â Â Â publicÂ voidÂ init()Â throwsÂ URISyntaxException,Â IOException,Â InterruptedExceptionÂ {Â Â Â Â Â Â Â Â //Â 1.Â ç²å–Hadoopé›†ç¾¤configurationå°è±¡Â Â Â Â Â Â Â Â configurationÂ =Â newÂ Configuration();Â Â Â Â Â Â Â Â //è¨­ç½®å®¢æˆ¶ç«¯è¨ªå•datanodeä½¿ç”¨hostnameä¾†é€²è¡Œè¨ªå•Â Â Â Â Â Â Â Â configuration.set("dfs.client.use.datanode.hostname",Â "true");Â Â Â Â Â Â Â Â //Â è¨­ç½®å‰¯æœ¬æ•¸é‡,ç”Ÿæ•ˆçš„å„ªå…ˆç´šï¼Œä»£ç¢¼è£¡çš„Â Â &gt;Â Â é…ç½®æ–‡ä»¶Â &gt;Â hadoop-hdfs.jarÂ è£¡çš„é»˜èªhdfs-default.xmlé…ç½®//Â Â Â Â Â Â Â Â configuration.set("dfs.replication",Â "2");Â Â Â Â Â Â Â Â //Â 2.Â æ ¹æ“šconfigurationå°è±¡ç²å–FileSystemå°è±¡Â Â Â Â Â Â Â Â fileSystemÂ =Â FileSystem.get(newÂ URI("hdfs://linux121:9000"),Â configuration,Â "root");Â Â Â Â }Â Â Â Â @AfterÂ Â Â Â publicÂ voidÂ destroy()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â fileSystem.close();Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â å‰µå»ºç›®éŒ„Â Â Â Â Â *Â Â Â Â Â *Â @throwsÂ URISyntaxExceptionÂ Â Â Â Â *Â @throwsÂ IOExceptionÂ Â Â Â Â *Â @throwsÂ InterruptedExceptionÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ testMkdirs()Â throwsÂ URISyntaxException,Â IOException,Â InterruptedExceptionÂ {//Â Â Â Â Â Â Â Â //Â 1.Â ç²å–Hadoopé›†ç¾¤configurationå°è±¡//Â Â Â Â Â Â Â Â ConfigurationÂ configurationÂ =Â newÂ Configuration();//Â Â Â Â Â Â Â Â configuration.set("fs.defaultFs",Â "hdfs://linux121:9000");//Â Â Â Â Â Â Â Â //Â 2.Â æ ¹æ“šconfigurationå°è±¡ç²å–FileSystemå°è±¡//Â Â Â Â Â Â Â Â FileSystemÂ fileSystemÂ =Â FileSystem.get(newÂ URI("hdfs://linux121:9000"),Â configuration,Â "root");Â Â Â Â Â Â Â Â //Â 3.Â ä½¿ç”¨FileSystemå°è±¡å‰µå»ºä¸€å€‹æ¸¬è©¦ç›®éŒ„Â Â Â Â Â Â Â Â booleanÂ mkdirsÂ =Â fileSystem.mkdirs(newÂ Path("/api_test"));Â Â Â Â Â Â Â Â System.err.println(mkdirs);Â Â Â Â Â Â Â Â //Â 4.Â é‡‹æ”¾FileSystemå°è±¡//Â Â Â Â Â Â Â Â fileSystem.close();Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â å‰µå»ºç›®éŒ„Â Â Â Â Â *Â Â Â Â Â *Â @throwsÂ IOExceptionÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ testMkdirs2()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â //Â 1.Â ç²å–Hadoopé›†ç¾¤configurationå°è±¡//Â Â Â Â Â Â Â Â ConfigurationÂ configurationÂ =Â newÂ Configuration();//Â Â Â Â Â Â Â Â configuration.set("fs.defaultFS",Â "hdfs://linux121:9000");//Â Â Â Â Â Â Â Â //Â 2.Â æ ¹æ“šconfigurationå°è±¡ç²å–FileSystemå°è±¡//Â Â Â Â Â Â Â Â FileSystemÂ fileSystemÂ =Â FileSystem.get(configuration);Â Â Â Â Â Â Â Â //Â 3.Â ä½¿ç”¨FileSystemå°è±¡å‰µå»ºä¸€å€‹æ¸¬è©¦ç›®éŒ„Â Â Â Â Â Â Â Â booleanÂ mkdirsÂ =Â fileSystem.mkdirs(newÂ Path("/api_test"));Â Â Â Â Â Â Â Â System.err.println(mkdirs);Â Â Â Â Â Â Â Â //Â 4.Â é‡‹æ”¾FileSystemå°è±¡//Â Â Â Â Â Â Â Â fileSystem.close();Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â ä¸Šå‚³æ–‡ä»¶Â Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ copyFromLocalToHDFS()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â fileSystem.copyFromLocalFile(newÂ Path("/Users/baiwang/Desktop/yarn-site.xml"),Â newÂ Path("/api_test"));Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â ä¸‹è¼‰æ–‡ä»¶Â Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ copyFromHDFSToLocal()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â //Â ç¬¬ä¸€å€‹åƒæ•¸ï¼šè¡¨ç¤ºæ˜¯å¦åˆªé™¤æºæ–‡ä»¶Â Â Â Â Â Â Â Â fileSystem.copyToLocalFile(true,Â newÂ Path("/api_test/yarn-site.xml"),Â newÂ Path("/Users/baiwang/Desktop/"));Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â åˆªé™¤æ–‡ä»¶Â Â Â Â Â *Â Â Â Â Â *Â @throwsÂ IOExceptionÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ deleteFile()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â //ç¬¬äºŒå€‹åƒæ•¸è¡¨ç¤ºæ˜¯å¦éæ­¸åˆªé™¤Â Â Â Â Â Â Â Â fileSystem.delete(newÂ Path("/api_test"),Â true);Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â éæ­·HDFSçš„æ ¹ç›®éŒ„ï¼Œå¾—åˆ°æ–‡ä»¶ä»¥åŠæ–‡ä»¶å¤¾ä¿¡æ¯ï¼šåç¨±ï¼Œæ¬Šé™ï¼Œé•·åº¦Â Â Â Â Â *Â Â Â Â Â *Â @throwsÂ IOExceptionÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ listsFile()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â //ç¬¬äºŒå€‹åƒæ•¸è¡¨ç¤ºæ˜¯å¦éæ­¸ï¼Œè©²æ–¹æ³•è¿”å›çš„ä¸€å€‹è¿­ä»£å™¨ï¼Œè£¡é¢å­˜æ”¾çš„æ˜¯æ–‡ä»¶ç‹€æ…‹ä¿¡æ¯Â Â Â Â Â Â Â Â RemoteIterator&lt;LocatedFileStatus&gt;Â remoteIteratorÂ =Â fileSystem.listFiles(newÂ Path("/"),Â true);Â Â Â Â Â Â Â Â whileÂ (remoteIterator.hasNext())Â {Â Â Â Â Â Â Â Â Â Â Â Â LocatedFileStatusÂ fileStatusÂ =Â remoteIterator.next();Â Â Â Â Â Â Â Â Â Â Â Â //æ–‡ä»¶åç¨±Â Â Â Â Â Â Â Â Â Â Â Â StringÂ nameÂ =Â fileStatus.getPath().getName();Â Â Â Â Â Â Â Â Â Â Â Â //æ–‡ä»¶å¤§å°Â Â Â Â Â Â Â Â Â Â Â Â longÂ lenÂ =Â fileStatus.getLen();Â Â Â Â Â Â Â Â Â Â Â Â //ç²å–æ¬Šé™Â Â Â Â Â Â Â Â Â Â Â Â FsPermissionÂ permissionÂ =Â fileStatus.getPermission();Â Â Â Â Â Â Â Â Â Â Â Â //ç²å–åˆ†çµ„ä¿¡æ¯Â Â Â Â Â Â Â Â Â Â Â Â StringÂ groupÂ =Â fileStatus.getGroup();Â Â Â Â Â Â Â Â Â Â Â Â //ç²å–æ‰€å±¬ç”¨æˆ¶Â Â Â Â Â Â Â Â Â Â Â Â StringÂ ownerÂ =Â fileStatus.getOwner();Â Â Â Â Â Â Â Â Â Â Â Â System.err.println(nameÂ +Â "\t"Â +Â lenÂ +Â "\t"Â +Â permissionÂ +Â "\t"Â +Â groupÂ +Â "\t"Â +Â owner);Â Â Â Â Â Â Â Â Â Â Â Â //å¡Šä¿¡æ¯Â Â Â Â Â Â Â Â Â Â Â Â BlockLocation[]Â blockLocationsÂ =Â fileStatus.getBlockLocations();Â Â Â Â Â Â Â Â Â Â Â Â forÂ (BlockLocationÂ blockLocationÂ :Â blockLocations)Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â String[]Â hostsÂ =Â blockLocation.getHosts();Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â forÂ (StringÂ hostÂ :Â hosts)Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â System.err.println("ä¸»æ©Ÿåç¨±ï¼š"Â +Â host);Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â Â Â Â Â System.err.println("============");Â Â Â Â Â Â Â Â }Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â åˆ¤è®€æ˜¯æ–‡ä»¶é‚„æ˜¯æ–‡ä»¶å¤¾Â Â Â Â Â *Â Â Â Â Â *Â @throwsÂ IOExceptionÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ isFile()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â FileStatus[]Â fileStatusesÂ =Â fileSystem.listStatus(newÂ Path("/"));Â Â Â Â Â Â Â Â forÂ (FileStatusÂ fileStatusÂ :Â fileStatuses)Â {Â Â Â Â Â Â Â Â Â Â Â Â booleanÂ fileÂ =Â fileStatus.isFile();Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (file)Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â System.err.println("æ–‡ä»¶ï¼š"Â +Â fileStatus.getPath().getName());Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â System.err.println("æ–‡ä»¶å¤¾ï¼š"Â +Â fileStatus.getPath().getName());Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â }Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â ä½¿ç”¨IOæµæ“ä½œHDFSÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ uploadFileIO()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â //1.Â ç²å–æœ¬åœ°è¼¸å…¥æµÂ Â Â Â Â Â Â Â FileInputStreamÂ fileInputStreamÂ =Â newÂ FileInputStream(newÂ File("/Users/baiwang/Desktop/yarn-site.xml"));Â Â Â Â Â Â Â Â //2.Â ç²å–å¯«æ•¸æ“šçš„è¼¸å‡ºæµÂ Â Â Â Â Â Â Â FSDataOutputStreamÂ fsDataOutputStreamÂ =Â fileSystem.create(newÂ Path("/lagou.txt"));Â Â Â Â Â Â Â Â //3.Â è¼¸å…¥æµæ•¸æ“šæ‹·è²åˆ°è¼¸å‡ºæµ,copyBytesæ–¹æ³•è£¡æœ‰é»˜èªæ‹·è²å€¼å¤§å°ï¼ˆ4096ï¼‰ï¼Œä¹Ÿæœ‰æ˜¯å¦é—œé–‰æµçš„æ“ä½œï¼ˆtrueï¼‰Â Â Â Â Â Â Â Â IOUtils.copyBytes(fileInputStream,Â fsDataOutputStream,Â configuration);Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â ä½¿ç”¨IOæµä¸‹è¼‰æ–‡ä»¶Â Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ downLoadFileIO()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â //1.Â ç²å–HDFSè¼¸å…¥æµÂ Â Â Â Â Â Â Â FSDataInputStreamÂ fsDataInputStreamÂ =Â fileSystem.open(newÂ Path("/lagou.txt"));Â Â Â Â Â Â Â Â //2.Â ç²å–å¯«æ•¸æ“šçš„è¼¸å‡ºæµÂ Â Â Â Â Â Â Â FileOutputStreamÂ fileOutputStreamÂ =Â newÂ FileOutputStream(newÂ File("/Users/baiwang/Desktop/hhb.xml"));Â Â Â Â Â Â Â Â //3.Â è¼¸å…¥æµæ•¸æ“šæ‹·è²åˆ°è¼¸å‡ºæµ,copyBytesæ–¹æ³•è£¡æœ‰é»˜èªæ‹·è²å€¼å¤§å°ï¼ˆ4096ï¼‰ï¼Œä¹Ÿæœ‰æ˜¯å¦é—œé–‰æµçš„æ“ä½œï¼ˆtrueï¼‰Â Â Â Â Â Â Â Â IOUtils.copyBytes(fsDataInputStream,Â fileOutputStream,Â configuration);Â Â Â Â }Â Â Â Â /**Â Â Â Â Â *Â seekÂ å®šä½è®€å–,ä½¿ç”¨IOæµæŠŠlagou.txtÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ seekReadFile()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â //ç²å–HDFSè¼¸å…¥æµÂ Â Â Â Â Â Â Â FSDataInputStreamÂ fsDataInputStreamÂ =Â fileSystem.open(newÂ Path("/lagou.txt"));Â Â Â Â Â Â Â Â //å°‡è¼¸å…¥æµè¤‡è£½åˆ°æ§åˆ¶æª¯ä¸­ï¼Œfalseè¡¨ç¤ºä¸æœƒè‡ªå‹•é—œé–‰æµÂ Â Â Â Â Â Â Â IOUtils.copyBytes(fsDataInputStream,Â System.out,Â 4096,Â false);Â Â Â Â Â Â Â Â //å°‡è¼¸å…¥æµè¤‡è£½åˆ°æ§åˆ¶æª¯ä¸­ã€‚éŠæ¨™åœ¨æœ€å¾Œçš„ä½ç½®ï¼Œç¾åœ¨å°‡éŠæ¨™æŒ‡å‘æœ€å‰é¢Â Â Â Â Â Â Â Â fsDataInputStream.seek(0);Â Â Â Â Â Â Â Â //å°‡è¼¸å…¥æµè¤‡è£½åˆ°æ§åˆ¶æª¯ä¸­ï¼Œfalseè¡¨ç¤ºä¸æœƒè‡ªå‹•é—œé–‰æµÂ Â Â Â Â Â Â Â IOUtils.copyBytes(fsDataInputStream,Â System.out,Â 4096,Â false);Â Â Â Â Â Â Â Â //é—œé–‰è¼¸å…¥æµÂ Â Â Â Â Â Â Â fsDataInputStream.close();Â Â Â Â }Â Â Â Â Â Â /**Â Â Â Â Â *Â é©—è­‰ä¸Šå‚³æ–‡ä»¶æ˜¯ä»¥packetç‚ºå–®ä½Â Â Â Â Â *Â ç¾è±¡ï¼šÂ Â Â Â Â *Â ç•¶Â hhb.xmlÂ ä¸­ç„¡ä¿¡æ¯ï¼Œä¸è¼¸å‡º===Â Â Â Â Â *Â ç•¶Â hhb.xmlÂ ä¸­ä¿¡æ¯å¤§æ–¼0KBï¼Œå°æ–¼64KBï¼Œè¼¸å‡ºå…©å€‹Â ===Â Â Â Â Â *Â ç•¶Â hhb.xmlÂ ä¸­ä¿¡æ¯å¤§æ–¼64KBï¼Œå°æ–¼128KBï¼Œè¼¸å‡ºä¸‰å€‹Â ===Â Â Â Â Â *Â åŸå› ï¼šÂ Â Â Â Â *Â ç•¶hhb.xmlä¸­ç„¡ä¿¡æ¯çš„æ™‚å€™ï¼Œä¸æœƒèˆ‡NameNodeäº¤äº’ï¼Œæ‰€ä»¥ä¸æœƒè¼¸å‡ºï¼Œç•¶ç”¢ç”Ÿäº¤äº’çš„æ™‚å€™ï¼Œå°±æœƒå…ˆè¼¸å‡ºä¸€å€‹====ã€‚Â Â Â Â Â *Â ç„¶å¾Œæ¯æ¬¡ä¸Šå‚³64KBï¼Œæ‰€å°æ–¼64KBçš„æ™‚å€™æœƒè¼¸å‡ºå…©å€‹ã€‚ä¸€å€‹æ˜¯å»ºç«‹éˆæ¥æ™‚å€™çš„è¼¸å‡ºï¼Œä¸€å€‹æ˜¯ä¸Šå‚³æ•¸æ“šçš„è¼¸å‡ºÂ Â Â Â Â *Â Â Â Â Â *Â @throwsÂ IOExceptionÂ Â Â Â Â */Â Â Â Â @TestÂ Â Â Â publicÂ voidÂ testUploadFile()Â throwsÂ IOExceptionÂ {Â Â Â Â Â Â Â Â FileInputStreamÂ fileInputStreamÂ =Â newÂ FileInputStream(newÂ File("/Users/baiwang/Desktop/hhb.xml"));Â Â Â Â Â Â Â Â FSDataOutputStreamÂ fsDataOutputStreamÂ =Â fileSystem.create(newÂ Path("/lagou.txt"),Â ()Â -&gt;Â {Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â System.err.println("===");Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â Â Â Â Â Â Â Â );Â Â Â Â Â Â Â Â IOUtils.copyBytes(fileInputStream,Â fsDataOutputStream,Â configuration);Â Â Â Â }}</code></pre><p>å•é¡Œï¼šä¸Šå‚³æ–‡ä»¶çš„æ™‚å€™å ±éŒ¯ï¼Œå¦‚åœ–</p><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c2e70326b89948a5824f6e5b9d7e9f3c><p class=pgc-img-caption>Clientä¸Šå‚³æ–‡ä»¶å ±éŒ¯.png</p></div><p>åŸå› ï¼šå®¢æˆ¶ç«¯å‰µå»ºæ–‡ä»¶å…ˆè¨ªå•NameNodeæœå‹™å™¨é€²è¡Œå‰µå»ºæ–‡ä»¶Metaä¿¡æ¯ï¼Œä»¥åŠæ–‡ä»¶æ¨¹ï¼Œæ­¤æ™‚è¨ªå•çš„çš„NameNodeçš„IPï¼ŒNameNodeæœå‹™å™¨å‰µå»ºæ–‡ä»¶æˆåŠŸå¾Œï¼Œæœƒè¿”å›å°æ‡‰dataNodeçš„æœå‹™å™¨ç¯€é»ï¼Œä½†æ­¤æ™‚çš„ç¯€é»ä¿¡æ¯ä¸­çš„ipæ˜¯èˆ‡NameNodeåœ¨åŒä¸€ç¶²çµ¡ä¸‹çš„å…§ç¶²IPï¼Œå®¢æˆ¶ç«¯æ˜¯ç„¡æ³•è¨ªå•ï¼Œä¹Ÿå°±ç„¡æ³•å¯«å…¥<br>è§£æ±ºï¼šåœ¨å®¢æˆ¶ç«¯ä¸­ï¼Œæˆ–è€…æœå‹™å™¨ç«¯etc/hadoop/hdfs-site.xmlä¸­é…ç½®</p><pre><code>conf.set("dfs.client.use.datanode.hostname","true");//è¨­ç½®å®¢æˆ¶ç«¯è¨ªå•datanodeä½¿ç”¨hostnameä¾†é€²è¡Œè¨ªå•</code></pre><p>ä½¿ç”¨æ­¤é…ç½®æœå‹™ç«¯è¿”å›çš„å°±æ˜¯åœ¨NameNodeçš„æ§åˆ¶æª¯ä¸­ç›¸æ‡‰çš„DataNodeå°æ‡‰çš„HttpAddress</p><h1 class=pgc-h-arrow-right><strong>HDFSè®€å¯«è§£æ</strong></h1><h1 class=pgc-h-arrow-right><strong>HDFSè®€æ•¸æ“šæµç¨‹</strong></h1><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/883560f48ff8473491477ab0ea703392><p class=pgc-img-caption>HDFSè®€æ•¸æ“šæµç¨‹.png</p></div><ol start=1><li>å®¢æˆ¶ç«¯é€šéDistributed FileSystemå‘NameNodeè«‹æ±‚ä¸‹è¼‰æ–‡ä»¶ï¼ŒNameNodeé€šéæŸ¥è©¢å…ƒæ•¸æ“šæ‰¾åˆ°æ–‡ä»¶å¡Šæ‰€åœ¨çš„DataNodeåœ°å€ã€‚NameNodeè¿”å›çš„æ•¸æ“šï¼šç›®æ¨™æ–‡ä»¶çš„å¡Šä¿¡æ¯ä»¥åŠæ‰€åœ¨ç¯€é»çš„ä¿¡æ¯ï¼ŒNameNodeæ˜¯åˆ†æ‰¹è¿”å›çµ¦çš„å®¢æˆ¶ç«¯ï¼Œå®¢æˆ¶ç«¯è®€å–å®Œå¾Œç²å–ä¸‹ä¸€æ‰¹ã€‚</li><li>å®¢æˆ¶ç«¯æŒ‘é¸ä¸€æ¢DataNodeï¼ˆç‰©ç†è·é›¢ï¼Œå°±è¿‘åŸå‰‡ï¼Œç„¶å¾Œéš¨æ©Ÿï¼‰æœå‹™å™¨ï¼Œè«‹æ±‚è®€å–æ•¸æ“šã€‚</li><li>DataNodeé–‹å§‹å‚³è¼¸æ•¸æ“šçµ¦å®¢æˆ¶ç«¯ï¼Œï¼ˆå¾ç£ç›¤è£¡é¢è®€å–æ•¸æ“šè¼¸å…¥æµï¼Œä»¥Packetç‚ºå–®ä½ä¾†åšæ ¡é©—ï¼ŒPacketå¤§å°ç‚º64Kbï¼‰</li><li>å®¢æˆ¶ç«¯ä»¥Packetç‚ºå–®ä½æ¥æ”¶ï¼Œç¾åœ¨æœ¬åœ°ç·©å­˜ï¼Œç„¶å¾Œå¯«å…¥ç›®æ¨™æ–‡ä»¶</li></ol><h1 class=pgc-h-arrow-right><strong>HDFSå¯«æ•¸æ“šçš„æµç¨‹</strong></h1><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/297400de865e4e4bae42494ea7513eb7><p class=pgc-img-caption>HDFSå¯«æ•¸æ“šçš„æµç¨‹.png</p></div><ol start=1><li>å®¢æˆ¶ç«¯é€šéDistributed FileSystemæ¨¡å¡Šå‘NameNodeè«‹æ±‚ä¸Šå‚³æ–‡ä»¶ï¼ŒNameNodeæª¢æŸ¥ç›®æ¨™æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œç›®æ¨™æ–‡ä»¶å¤¾æ˜¯å¦å­˜åœ¨ã€‚</li><li>NameNodeè¿”å›æ˜¯å¦å¯ä»¥ä¸Šå‚³</li><li>å®¢æˆ¶ç«¯è«‹æ±‚ç¬¬ä¸€å€‹Blockä¸Šå‚³åˆ°é‚£å¹¾å€‹DataNodeæœå‹™å™¨ä¸Š</li><li>NameNodeè¿”å›3å€‹DataNodeç¯€é»ï¼Œåˆ†åˆ¥ç‚ºdn1ã€dn2ã€dn3.</li><li>å®¢æˆ¶ç«¯é€šéFSDataOutputStreamæ¨¡å¡Šè«‹æ±‚dn1ä¸Šå‚³æ•¸æ“šï¼Œdn1æ”¶åˆ°è«‹æ±‚æœƒç¹¼çºŒèª¿ç”¨dn2ï¼Œç„¶å¾Œdn2èª¿ç”¨dn3ï¼Œå°‡é€™å€‹é€šä¿¡ç®¡é“å»ºç«‹å®Œæˆã€‚</li><li>dn1ã€dn2ã€dn3é€ç´šæ‡‰ç­”å®¢æˆ¶ç«¯</li><li>å®¢æˆ¶ç«¯é–‹å§‹å¾€dn1ä¸Šå‚³ç¬¬ä¸€å€‹blockï¼ˆå…ˆå¾ç£ç›¤è®€å–æ•¸æ“šæ”¾åˆ°ä¸€å€‹æœ¬åœ°å…§å­˜ç·©å­˜ï¼‰ï¼Œä»¥Packetç‚ºå–®ä½ï¼Œdn1æ”¶åˆ°ä¸€å€‹Packetå°±æœƒå‚³çµ¦dn2ï¼Œdn2å‚³çµ¦dn3ï¼Œdn1æ²’å‚³ä¸€å€‹packetæœƒæ”¾å…¥åˆ°ç¢ºèªéšŠåˆ—ç­‰å¾…ç¢ºèª,ç­‰å¾…dn2ã€dn3ç¢ºèªæ•¸æ“šå‚³è¼¸å®Œæˆ</li><li>ç•¶ä¸€å€‹Blockå‚³è¼¸å®Œæˆä¹‹å¾Œï¼Œå®¢æˆ¶ç«¯å†æ¬¡è«‹æ±‚NameNodeä¸Šå‚³ç¬¬äºŒå€‹blockçš„æœå‹™å™¨ï¼ˆé‡è¤‡åŸ·è¡Œ3-7ï¼‰</li></ol><p><strong>ä¸€é‚Šå¯«å…¥ï¼Œä¸€é‚Šå¯¦ç¾å‰¯æœ¬åŒæ­¥ï¼Œé€™æ¨£é›–ç„¶ä¸Šå‚³æ•¸æ“šæ¯”è¼ƒæ…¢ï¼Œä½†æ˜¯ä¿è­‰äº†æ•¸æ“šçš„å®‰å…¨</strong></p><h1 class=pgc-h-arrow-right><strong>NNèˆ‡2NN</strong></h1><h1 class=pgc-h-arrow-right><strong>HDFSå…ƒæ•¸æ“šç®¡ç†æ©Ÿåˆ¶</strong></h1><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/5e7af16492bd4106923a48cd47621f2a><p class=pgc-img-caption>å…ƒæ•¸æ“šç®¡ç†æµç¨‹åœ–.png</p></div><ul><li>ç¬¬ä¸€éšæ®µï¼šNameNodeå•Ÿå‹• ç¬¬ä¸€æ¬¡å•Ÿå‹•NameNodeæ ¼å¼åŒ–å¾Œï¼Œå‰µå»ºfsImagesï¼ˆç”Ÿæˆæ…¢ï¼Œæ¢å¾©å¿«ï¼‰å’ŒEditsï¼ˆç”Ÿæˆå¿«ï¼Œæ¢å¾©æ…¢ï¼‰æ–‡ä»¶ï¼Œå¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡å•Ÿå‹•ï¼Œç›´æ¥åŠ è¼‰ç·¨è¼¯æ—¥èªŒå’Œé¡åƒæ–‡ä»¶åˆ°å…§å­˜ã€‚ å®¢æˆ¶ç«¯å°å…ƒæ•¸æ“šé€²è¡Œå¢åˆªæ”¹çš„è«‹æ±‚ NameNodeè¨˜éŒ„æ“ä½œæ—¥èªŒï¼Œæ›´æ–°æ»¾å‹•æ—¥èªŒ NameNodeåœ¨å…§å­˜ä¸­å°æ•¸æ“šé€²è¡Œå¢åˆªæ”¹ã€‚</li><li>ç¬¬äºŒéšæ®µï¼šSecondary NameNodeï¼ˆè¼”åŠ©NameNodeç¶­è­·å…ƒæ•¸æ“šç®¡ç†ï¼‰å·¥ä½œ 2nnè©¢å•nnæ˜¯å¦éœ€è¦CheckPointï¼Œç›´æ¥å¸¶å›nnæ˜¯å¦åŸ·è¡Œæª¢å¯Ÿé»æ“ä½œçµæœ 2nnè«‹æ±‚åŸ·è¡ŒCheckPointã€‚ nnæ»¾å‹•æ­£åœ¨å¯«çš„Editsæ—¥èªŒ å°‡æ»¾å‹•å‰çš„ç·¨è¼¯æ—¥èªŒå’Œé¡åƒæ–‡ä»¶æ‹·è²åˆ°2nn 2nnåŠ è¼‰ç·¨è¼¯æ—¥èªŒå’Œé¡åƒæ–‡ä»¶åˆ°å…§å­˜ä½µåˆä¸¦ ç”Ÿç”¢æ–°çš„é¡åƒæ–‡ä»¶fsimage.chkpoint æ‹·è²fsimage.chpointåˆ°nn nnå°‡fsimage.chpoint é‡æ–°å‘½åç‚ºfsimage</li></ul><p>checkPointè§¸ç™¼æ™‚æ©Ÿ</p><ol start=1><li>åˆ°å®šæ™‚æ™‚é–“</li><li>Editsç·¨è¼¯æ–‡ä»¶æ»¿ã€‚<br>Fsimageã€editså­˜æ”¾è·¯å¾‘ï¼š</li></ol><pre><code>/opt/lagou/servers/hadoop-2.9.2/data/tmp/dfs/name/current</code></pre><h1 class=pgc-h-arrow-right><strong>FsImage èˆ‡Edits æ–‡ä»¶è§£æ</strong></h1><p>NameNodeåœ¨åŸ·è¡Œæ ¼å¼åŒ–ä¹‹å¾Œï¼Œæœƒåœ¨/opt/lg/servers/hadoop-2.9.2/data/tmp/dfs/name/currentç›®éŒ„ä¸‹ç”Ÿæˆæ–‡ä»¶ï¼š</p><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6a48fd6b710d42dda0c02b4c2b4226c7><p class=pgc-img-caption>FsImageèˆ‡Editesæ–‡ä»¶è§£æ.png</p></div><ul><li>FsImageæ–‡ä»¶ï¼šæ˜¯NameNodeä¸­å…ƒæ•¸æ“šçš„é¡åƒï¼Œä¸€èˆ¬è¢«ç¨±ç‚ºæª¢æŸ¥é»ï¼ŒåŒ…å«HDFSæ–‡ä»¶ç³»çµ±æ‰€æœ‰ç›®éŒ„åŠæ–‡ä»¶ç›¸é—œä¿¡æ¯ï¼ˆBlockæ•¸é‡ã€å‰¯æœ¬æ•¸é‡ã€æ¬Šé™ï¼‰</li><li>Editsæ–‡ä»¶ï¼šå­˜å„²çš„æ˜¯å®¢æˆ¶ç«¯å°HDFSçš„å¢åˆªæ”¹æ“ä½œ</li><li>*.md5æ–‡ä»¶ï¼š æ ¡é©—æ–‡ä»¶ã€‚</li><li>seen_txidä¿å­˜çš„æ˜¯ä¸€å€‹æ•¸å­—ï¼Œå°æ‡‰è‘—æœ€å¾Œä¸€å€‹Editsæ–‡ä»¶åçš„æ•¸å­—</li><li>VERSIONï¼šè¨˜éŒ„namenodeçš„ä¸€äº›ç‰ˆæœ¬è™Ÿä¿¡æ¯ï¼Œæ¯”å¦‚custerIDï¼ŒnamespaceId</li></ul><p>NameNodeå•Ÿå‹•æ™‚æœƒå°‡FsImageåŠ è¼‰åˆ°å…§å­˜ä¸­ï¼ŒåŒæ™‚å°‡ä¹‹å‰æ²’æœ‰åˆä½µåˆ°å…ƒæ•¸æ“šçš„Editsæ–‡ä»¶åŠ è¼‰ï¼Œé›†åˆå…©å€‹æ–‡ä»¶çš„å…ƒæ•¸æ“šï¼Œé€™æ¨£ä¿è­‰äº†å…§å­˜ä¸­çš„å…ƒæ•¸æ“šæ˜¯æœ€æ–°æœ€å…¨çš„ï¼Œ</p><h1 class=pgc-h-arrow-right><strong>æŸ¥çœ‹FsImageæ–‡ä»¶å…§å®¹</strong></h1><pre><code>##Â hdfsÂ oivÂ -pÂ æ–‡ä»¶é¡å‹ï¼ˆå°±æ˜¯fsimageè½‰æˆä»€éº¼é¡å‹ï¼‰-iÂ é¡åƒæ–‡ä»¶Â -oÂ è¼¸å‡ºè·¯å¾‘cdÂ /opt/lagou/servers/hadoop-2.9.2/data/tmp/dfs/name/currenthdfsÂ oivÂ -pÂ XMLÂ -iÂ fsimage_0000000000000000505Â -oÂ /opt/hhb.xml</code></pre><p>hhb.xmlæ–‡ä»¶å…§å®¹</p><pre><code>&lt;?xmlÂ version="1.0"Â encoding="utf-8"?&gt;&lt;fsimage&gt;Â Â &lt;version&gt;Â Â Â Â &lt;layoutVersion&gt;-63&lt;/layoutVersion&gt;Â Â Â Â &lt;onDiskVersion&gt;1&lt;/onDiskVersion&gt;Â Â Â Â &lt;oivRevision&gt;826afbeae31ca687bc2f8471dc841b66ed2c6704&lt;/oivRevision&gt;Â Â &lt;/version&gt;Â Â Â Â &lt;NameSection&gt;Â Â Â Â &lt;namespaceId&gt;853376951&lt;/namespaceId&gt;Â Â Â Â &lt;genstampV1&gt;1000&lt;/genstampV1&gt;Â Â Â Â &lt;genstampV2&gt;1045&lt;/genstampV2&gt;Â Â Â Â &lt;genstampV1Limit&gt;0&lt;/genstampV1Limit&gt;Â Â Â Â &lt;lastAllocatedBlockId&gt;1073741867&lt;/lastAllocatedBlockId&gt;Â Â Â Â &lt;txid&gt;505&lt;/txid&gt;Â Â &lt;/NameSection&gt;Â Â Â Â &lt;INodeSection&gt;Â Â Â Â &lt;lastInodeId&gt;16473&lt;/lastInodeId&gt;Â Â Â Â &lt;numInodes&gt;38&lt;/numInodes&gt;Â Â Â Â &lt;inode&gt;Â Â Â Â Â Â &lt;id&gt;16385&lt;/id&gt;Â Â Â Â Â Â &lt;type&gt;DIRECTORY&lt;/type&gt;Â Â Â Â Â Â &lt;name/&gt;Â Â Â Â Â Â &lt;mtime&gt;1593694994111&lt;/mtime&gt;Â Â Â Â Â Â &lt;permission&gt;root:supergroup:0777&lt;/permission&gt;Â Â Â Â Â Â &lt;nsquota&gt;9223372036854775807&lt;/nsquota&gt;Â Â Â Â Â Â &lt;dsquota&gt;-1&lt;/dsquota&gt;Â Â Â Â &lt;/inode&gt;Â Â Â Â Â Â &lt;inode&gt;Â Â Â Â Â Â &lt;id&gt;16386&lt;/id&gt;Â Â Â Â Â Â &lt;type&gt;DIRECTORY&lt;/type&gt;Â Â Â Â Â Â &lt;name&gt;test&lt;/name&gt;Â Â Â Â Â Â &lt;mtime&gt;1593598825098&lt;/mtime&gt;Â Â Â Â Â Â &lt;permission&gt;root:supergroup:0777&lt;/permission&gt;Â Â Â Â Â Â &lt;nsquota&gt;-1&lt;/nsquota&gt;Â Â Â Â Â Â &lt;dsquota&gt;-1&lt;/dsquota&gt;Â Â Â Â &lt;/inode&gt;Â Â Â Â Â Â ã€‚ã€‚ã€‚Â Â &lt;/INodeSection&gt;Â Â Â Â &lt;INodeReferenceSection/&gt;Â Â &lt;SnapshotSection&gt;Â Â Â Â &lt;snapshotCounter&gt;0&lt;/snapshotCounter&gt;Â Â Â Â &lt;numSnapshots&gt;0&lt;/numSnapshots&gt;Â Â &lt;/SnapshotSection&gt;Â Â Â Â &lt;INodeDirectorySection&gt;Â Â Â Â &lt;directory&gt;Â Â Â Â Â Â &lt;parent&gt;16385&lt;/parent&gt;Â Â Â Â Â Â &lt;child&gt;16471&lt;/child&gt;Â Â Â Â Â Â &lt;child&gt;16448&lt;/child&gt;Â Â Â Â Â Â &lt;child&gt;16473&lt;/child&gt;Â Â Â Â &lt;/directory&gt;Â Â Â &lt;/INodeDirectorySection&gt;Â Â Â Â &lt;FileUnderConstructionSection/&gt;Â Â Â Â &lt;SecretManagerSection&gt;Â Â Â Â &lt;currentId&gt;0&lt;/currentId&gt;Â Â Â Â &lt;tokenSequenceNumber&gt;0&lt;/tokenSequenceNumber&gt;Â Â Â Â &lt;numDelegationKeys&gt;0&lt;/numDelegationKeys&gt;Â Â Â Â &lt;numTokens&gt;0&lt;/numTokens&gt;Â Â &lt;/SecretManagerSection&gt;Â Â &lt;CacheManagerSection&gt;Â Â Â Â &lt;nextDirectiveId&gt;1&lt;/nextDirectiveId&gt;Â Â Â Â &lt;numDirectives&gt;0&lt;/numDirectives&gt;Â Â Â Â &lt;numPools&gt;0&lt;/numPools&gt;Â Â &lt;/CacheManagerSection&gt;Â &lt;/fsimage&gt;</code></pre><p><strong>Fsimageè£¡é¢æ˜¯ä¸è¨˜éŒ„blockæ‰€åœ¨çš„ç¯€é»ä¿¡æ¯çš„ï¼Œæ˜¯åœ¨é›†ç¾¤å•Ÿå‹•æ™‚ï¼ŒNameNodeè¦æ±‚DataNodeä¸Šå ±æ•¸æ“šå¡Šä¿¡æ¯ï¼Œä¸¦é–“éš”ä¸€æ®µæ™‚é–“å†æ¬¡ä¸Šå ±ï¼Œé€™éº¼åšçš„ç†ç”±æ˜¯å› ç‚ºå¦‚æœFsImageè£¡è¨˜éŒ„äº†DataNodeä¿¡æ¯ï¼Œä½†æ˜¯DataNodeæ›äº†ï¼ŒNameNodeæ‹¿è‘—æ­·å²çš„FsimageåŠ è¼‰åˆ°å…§å®¹ï¼Œè¨˜éŒ„çš„æ˜¯æ­·å²æ•¸æ“šï¼Œæœƒå°è‡´æ•¸æ“šä¸ä¸€è‡´ã€‚</strong></p><h1 class=pgc-h-arrow-right><strong>æŸ¥çœ‹Editsæ–‡ä»¶å…§å®¹</strong></h1><pre><code>##Â hdfsÂ oevÂ -pÂ æ–‡ä»¶é¡å‹ï¼ˆå°±æ˜¯editsè½‰æˆä»€éº¼é¡å‹ï¼‰-iÂ ç·¨è¼¯æ—¥èªŒÂ -oÂ è¼¸å‡ºè·¯å¾‘cdÂ /opt/lagou/servers/hadoop-2.9.2/data/tmp/dfs/name/currenthdfsÂ oivÂ -pÂ XMLÂ -iÂ fsimage_0000000000000000505Â -oÂ /opt/hhb.xml</code></pre><p>hhb2.xmlæ–‡ä»¶å…§å®¹</p><pre><code>&lt;?xmlÂ version="1.0"Â encoding="UTF-8"?&gt;&lt;EDITS&gt;Â Â &lt;EDITS_VERSION&gt;-63&lt;/EDITS_VERSION&gt;Â Â &lt;RECORD&gt;Â Â Â Â &lt;OPCODE&gt;OP_START_LOG_SEGMENT&lt;/OPCODE&gt;Â Â Â Â &lt;DATA&gt;Â Â Â Â Â Â &lt;TXID&gt;414&lt;/TXID&gt;Â Â Â Â &lt;/DATA&gt;Â Â &lt;/RECORD&gt;Â Â &lt;RECORD&gt;Â Â Â Â &lt;OPCODE&gt;OP_SET_GENSTAMP_V2&lt;/OPCODE&gt;Â Â Â Â &lt;DATA&gt;Â Â Â Â Â Â &lt;TXID&gt;415&lt;/TXID&gt;Â Â Â Â Â Â &lt;GENSTAMPV2&gt;1044&lt;/GENSTAMPV2&gt;Â Â Â Â &lt;/DATA&gt;Â Â &lt;/RECORD&gt;Â Â &lt;RECORD&gt;Â Â Â Â &lt;OPCODE&gt;OP_REASSIGN_LEASE&lt;/OPCODE&gt;Â Â Â Â &lt;DATA&gt;Â Â Â Â Â Â &lt;TXID&gt;416&lt;/TXID&gt;Â Â Â Â Â Â &lt;LEASEHOLDER&gt;DFSClient_NONMAPREDUCE_-968919369_1&lt;/LEASEHOLDER&gt;Â Â Â Â Â Â &lt;PATH&gt;/api_test&lt;/PATH&gt;Â Â Â Â Â Â &lt;NEWHOLDER&gt;HDFS_NameNode-2020-07-02Â 20:31:54,840+0800&lt;/NEWHOLDER&gt;Â Â Â Â &lt;/DATA&gt;Â Â &lt;/RECORD&gt;Â Â &lt;RECORD&gt;Â Â Â Â &lt;OPCODE&gt;OP_CLOSE&lt;/OPCODE&gt;Â Â Â Â &lt;DATA&gt;Â Â Â Â Â Â &lt;TXID&gt;417&lt;/TXID&gt;Â Â Â Â Â Â &lt;LENGTH&gt;0&lt;/LENGTH&gt;Â Â Â Â Â Â &lt;INODEID&gt;0&lt;/INODEID&gt;Â Â Â Â Â Â &lt;PATH&gt;/api_test&lt;/PATH&gt;Â Â Â Â Â Â &lt;REPLICATION&gt;3&lt;/REPLICATION&gt;Â Â Â Â Â Â &lt;MTIME&gt;1593693116738&lt;/MTIME&gt;Â Â Â Â Â Â &lt;ATIME&gt;1593689482882&lt;/ATIME&gt;Â Â Â Â Â Â &lt;BLOCKSIZE&gt;134217728&lt;/BLOCKSIZE&gt;Â Â Â Â Â Â &lt;CLIENT_NAME&gt;&lt;/CLIENT_NAME&gt;Â Â Â Â Â Â &lt;CLIENT_MACHINE&gt;&lt;/CLIENT_MACHINE&gt;Â Â Â Â Â Â &lt;OVERWRITE&gt;false&lt;/OVERWRITE&gt;Â Â Â Â Â Â &lt;PERMISSION_STATUS&gt;Â Â Â Â Â Â Â Â &lt;USERNAME&gt;root&lt;/USERNAME&gt;Â Â Â Â Â Â Â Â &lt;GROUPNAME&gt;supergroup&lt;/GROUPNAME&gt;Â Â Â Â Â Â Â Â &lt;MODE&gt;420&lt;/MODE&gt;Â Â Â Â Â Â &lt;/PERMISSION_STATUS&gt;Â Â Â Â &lt;/DATA&gt;Â Â &lt;/RECORD&gt;Â Â &lt;RECORD&gt;Â Â Â Â &lt;OPCODE&gt;OP_TIMES&lt;/OPCODE&gt;Â Â Â Â &lt;DATA&gt;Â Â Â Â Â Â &lt;TXID&gt;418&lt;/TXID&gt;Â Â Â Â Â Â &lt;LENGTH&gt;0&lt;/LENGTH&gt;Â Â Â Â Â Â &lt;PATH&gt;/lagou.txt&lt;/PATH&gt;Â Â Â Â Â Â &lt;MTIME&gt;-1&lt;/MTIME&gt;Â Â Â Â Â Â &lt;ATIME&gt;1593693390155&lt;/ATIME&gt;Â Â Â Â &lt;/DATA&gt;Â Â &lt;/RECORD&gt;Â Â &lt;RECORD&gt;Â Â Â Â &lt;OPCODE&gt;OP_TIMES&lt;/OPCODE&gt;Â Â Â Â &lt;DATA&gt;Â Â Â Â Â Â &lt;TXID&gt;419&lt;/TXID&gt;Â Â Â Â Â Â &lt;LENGTH&gt;0&lt;/LENGTH&gt;Â Â Â Â Â Â &lt;PATH&gt;/yarn-site.xml&lt;/PATH&gt;Â Â Â Â Â Â &lt;MTIME&gt;-1&lt;/MTIME&gt;Â Â Â Â Â Â &lt;ATIME&gt;1593693395993&lt;/ATIME&gt;Â Â Â Â &lt;/DATA&gt;Â Â &lt;/RECORD&gt;Â Â &lt;RECORD&gt;Â Â Â Â &lt;OPCODE&gt;OP_END_LOG_SEGMENT&lt;/OPCODE&gt;Â Â Â Â &lt;DATA&gt;Â Â Â Â Â Â &lt;TXID&gt;420&lt;/TXID&gt;Â Â Â Â &lt;/DATA&gt;Â Â &lt;/RECORD&gt;&lt;/EDITS&gt;</code></pre><h1 class=pgc-h-arrow-right><strong>CheckPointçš„é€±æœŸ</strong></h1><p>hdfs-default.xml</p><pre><code>&lt;!--Â å®šæ™‚ä¸€å°æ™‚Â --&gt;&lt;property&gt;Â Â Â Â &lt;name&gt;dfs.namenode.checkpoint.period&lt;/name&gt;Â Â Â Â &lt;value&gt;3600&lt;/value&gt;&lt;/property&gt;&lt;!--Â ä¸€åˆ†é˜æª¢æŸ¥ä¸€æ¬¡æ“ä½œæ¬¡æ•¸ï¼Œç•¶æ“ä½œæ¬¡æ•¸é”åˆ°1ç™¾è¬æ™‚ï¼ŒSecondaryNameNodeåŸ·è¡Œä¸€æ¬¡Â --&gt;&lt;property&gt;Â Â Â Â &lt;name&gt;dfs.namenode.checkpoint.txns&lt;/name&gt;Â Â Â Â &lt;value&gt;1000000&lt;/value&gt;Â Â Â Â &lt;description&gt;æ“ä½œå‹•ä½œæ¬¡æ•¸&lt;/description&gt;&lt;/property&gt;&lt;property&gt;Â Â Â Â &lt;name&gt;dfs.namenode.checkpoint.check.period&lt;/name&gt;Â Â Â Â &lt;value&gt;60&lt;/value&gt;Â Â Â Â &lt;description&gt;Â 1åˆ†é˜æª¢æŸ¥ä¸€æ¬¡æ“ä½œæ¬¡æ•¸&lt;/description&gt;&lt;/propertyÂ &gt;</code></pre><h1 class=pgc-h-arrow-right><strong>NameNodeæ•…éšœè™•ç†</strong></h1><p>NameNodeæ•…éšœå¾Œï¼ŒHDFSé›†ç¾¤å°±ç„¡æ³•æ­£å¸¸å·¥ä½œï¼Œå› ç‚ºHDFSæ–‡ä»¶ç³»çµ±çš„å…ƒæ•¸æ“šéœ€è¦NameNodeä¾†ç®¡ç†ä¸¦èˆ‡Clientäº¤äº’ï¼Œå¦‚æœå…ƒæ•¸æ“šæå£å’Œä¸Ÿå¤±ä¹Ÿæœƒæœ‰åŒæ¨£çš„å•é¡Œ</p><p>å¦‚æœå…ƒæ•¸æ“šä¸Ÿå¤±å¦‚ä½•æ¢å¾©ï¼Ÿ</p><ol start=1><li>å°‡2NNçš„å…ƒæ•¸æ“šæ‹·è²åˆ°NN ä½†æ˜¯é€™ç¨®æƒ…æ³æœƒå­˜åœ¨å…ƒæ•¸æ“šä¸Ÿå¤±</li><li>æ­å»ºHDFSçš„HAï¼ˆé«˜å¯ç”¨é›†ç¾¤ï¼‰ï¼Œè§£æ±ºNNçš„å–®é»æ•…éšœå•é¡Œï¼è—‰åŠ©zkå¯¦ç¾HAï¼Œä¸€å€‹æ˜¯Activeçš„NameNodeï¼Œä¸€å€‹æ˜¯Standbyçš„NameNode</li></ol><h1 class=pgc-h-arrow-right><strong>Hadoopçš„é™é¡èˆ‡æ­¸æª”ä»¥åŠé›†ç¾¤å®‰å…¨æ¨¡å¼</strong></h1><h1 class=pgc-h-arrow-right><strong>é«˜ç´šå‘½ä»¤</strong></h1><ul><li>HDFSæ–‡ä»¶é™é¡ HDFSæ–‡ä»¶çš„é™é¡é…ç½®å…è¨±æˆ‘å€‘ä»¥æ–‡ä»¶å¤§å°æˆ–è€…æ–‡ä»¶å€‹æ•¸ä¾†é™åˆ¶æˆ‘å€‘åœ¨æŸå€‹ç›®éŒ„ä¸‹ä¸Šå‚³æ–‡ä»¶æ•¸é‡æˆ–è€…æ–‡ä»¶å…§å®¹ã€‚ä»¥ä¾¿æˆ‘å€‘é”åˆ°é¡ä¼¼ç™¾åº¦ç¶²ç›¤é™åˆ¶æ¯å€‹ç”¨æˆ¶ä¸Šå‚³çš„æœ€å¤§æ–‡ä»¶é‡</li></ul><ol start=1><li>æ•¸é‡é™åˆ¶</li></ol><pre><code>#Â å°hhbæ–‡ä»¶å¤¾ä¸Šå‚³æ•¸é‡é™åˆ¶ï¼Œè¨­ç½®ç‚º2ï¼Œå¯¦éš›é™åˆ¶ç‚º2-1hdfsÂ dfsadminÂ -setQuotaÂ 2Â Â /hhb#Â ä¸Šå‚³æ–‡ä»¶ã€‚æˆåŠŸhdfsÂ dfsÂ -copyFromLocalÂ /root/wc.txtÂ /hhb/#Â å†æ¬¡ä¸Šå‚³ï¼Œå ±éŒ¯ï¼ŒéŒ¯èª¤ï¼šcopyFromLocal:Â TheÂ NameSpaceÂ quotaÂ (directoriesÂ andÂ files)Â ofÂ directoryÂ /hhbÂ isÂ exceeded:Â quota=2Â fileÂ count=3hdfsÂ dfsÂ -copyFromLocalÂ /root/wc.txtÂ /hhb/hhh.txt#Â æ¸…é™¤é™é¡,å†æ¬¡ä¸Šå‚³ï¼ŒæˆåŠŸhdfsÂ dfsadminÂ -clrQuotaÂ /hhb</code></pre><ol start=2><li>ç©ºé–“å¤§å°é™åˆ¶</li></ol><pre><code>#Â å°hhbæ–‡ä»¶å¤¾ä¸Šå‚³ç©ºé–“é™åˆ¶ï¼Œè¨­ç½®ç‚º4KBhdfsÂ dfsadminÂ -setSpaceQuotaÂ 4KÂ /hhb#Â ä¸Šå‚³æ–‡ä»¶å ±éŒ¯ï¼šput:Â TheÂ DiskSpaceÂ quotaÂ ofÂ /hhbÂ isÂ exceeded:Â quotaÂ =Â 4096Â BÂ =Â 4Â KBÂ butÂ diskspaceÂ consumedÂ =Â 402653646Â BÂ =Â 384.00Â MBhdfsÂ dfsÂ -putÂ /opt/lagou/software/hadoop-2.9.2.tar.gzÂ /hhb/#Â æ¸…é™¤é™åˆ¶ç©ºé–“å¤§å°,å†æ¬¡ä¸Šå‚³ï¼Œä¸Šå‚³æˆåŠŸhdfsÂ dfsadminÂ -clrSpaceQuotaÂ /hhb</code></pre><ul><li>HDFSå®‰å…¨æ¨¡å¼ HDFSé›†ç¾¤å•Ÿå‹•æ™‚éœ€è¦åŠ è¼‰FsImageå’ŒEditsæ–‡ä»¶ï¼Œè€Œé€™å…©å€‹æ–‡ä»¶éƒ½æ²’æœ‰è¨˜éŒ„Blockå°æ‡‰çš„DataNodeä¿¡æ¯ï¼Œå¦‚æœclientè«‹æ±‚ä¸‹è¼‰æ–‡ä»¶ï¼Œé›†ç¾¤æ˜¯ä¸èƒ½å·¥ä½œçš„ <strong>å®‰å…¨æ¨¡å¼</strong>æ˜¯HDFSæ‰€è™•çš„ä¸€ç¨®ç‰¹æ®Šç‹€æ…‹ï¼Œåœ¨é€™ç¨®ç‹€æ…‹ä¸‹ï¼Œæ–‡ä»¶ç³»çµ±<strong>åªæ¥å—è®€æ•¸æ“šè«‹æ±‚ï¼Œè€Œä¸æ¥å—åˆªé™¤ã€ä¿®æ”¹ç­‰è®Šæ›´è«‹æ±‚</strong>ï¼Œåœ¨NameNodeä¸»ç¯€é»å•Ÿå‹•æ™‚ï¼ŒHDFSé¦–å…ˆé€²å…¥å®‰å…¨æ¨¡å¼ï¼ŒDataNodeåœ¨å•Ÿå‹•æ™‚æœƒå‘NameNodeå½™å ±å¯ç”¨çš„Blockç­‰ç‹€æ…‹ï¼Œç•¶æ•´å€‹ç³»çµ±é”åˆ°å®‰å…¨æ¨™æº–æ™‚ï¼ŒHDFSè‡ªå‹•é›¢é–‹å®‰å…¨æ¨¡å¼ï¼Œå¦‚æœHDFSè™•æ–¼å®‰å…¨æ¨¡å¼ä¸‹ï¼Œå‰‡æ–‡ä»¶Blockä¸èƒ½é€²è¡Œä»»ä½•çš„å‰¯æœ¬è¤‡è£½æ“ä½œï¼Œå› æ­¤é”åˆ°æœ€å°å‰¯æœ¬æ•¸é‡æ˜¯è¦æ±‚åŸºæ–¼DataNodeå•Ÿå‹•æ™‚çš„ç‹€æ…‹ä¾†åˆ¤å®šçš„ï¼Œå•Ÿå‹•æ™‚ä¸æœƒåšä»»ä½•æƒ¡å¾·è¤‡è£½ï¼ˆå¾è€Œé”åˆ°æœ€å°å‰¯æœ¬æ•¸é‡è¦æ±‚ï¼‰ï¼ŒHDFSé›†ç¾¤å‰›å•Ÿå‹•çš„æ™‚å€™ï¼Œé»˜èª30æ™‚é–“æ™‚è™•æ–¼å®‰å…¨æœŸçš„ï¼Œåªæœ‰éäº†30å¾Œï¼Œé›†ç¾¤è„«é›¢å®‰å…¨æœŸï¼Œç„¶å¾Œæ‰å¯ä»¥å°é›†ç¾¤é€²è¡Œéæ“ä½œã€‚</li></ul><pre><code>##Â é€²å…¥å®‰å…¨æ¨¡å¼hdfsÂ dfsadminÂ -safemodeÂ enter##Â é€€å‡ºå®‰å…¨æ¨¡å¼hdfsÂ dfsadminÂ -safemodeÂ leave #åœ¨é é¢çš„Summaryæ¨¡å¡Šçš„ç¬¬äºŒè¡Œå¯ä»¥çœ‹è¦‹ç•¶å‰é›†ç¾¤è™•æ–¼ä¸è™•æ–¼å®‰å…¨æ¨¡å¼ </code></pre><ul><li>Hadoopæ­¸æª”æŠ€è¡“</li></ul><p><strong>ä¸»è¦è§£æ±ºHDFSé›†ç¾¤å­˜åœ¨å¤§é‡å°æ–‡ä»¶çš„å•é¡Œã€‚</strong></p><p>ç”±æ–¼å¤§é‡çš„å°æ–‡ä»¶æœƒä½”ç”¨NameNodeçš„å…§å­˜ï¼Œå› æ­¤å­˜å„²å¤§é‡å°æ–‡ä»¶æœƒé€ æˆNameNodeå…§å­˜è³‡æºçš„æµªè²»ã€‚</p><p>Hadoopå­˜æª”æ–‡ä»¶HARæ–‡ä»¶ï¼Œæ˜¯ä¸€å€‹é«˜æ•ˆçš„æ–‡ä»¶å­˜æª”å·¥å…·ï¼ŒHARæ–‡ä»¶æ˜¯ç”±ä¸€çµ„æ–‡ä»¶é€šéarchiveå·¥å…·å‰µå»ºè€Œä¾†ï¼Œåœ¨æ¸›å°‘äº†NameNodeçš„å…§å­˜ä½¿ç”¨çš„åŒæ™‚ï¼Œå¯ä»¥å°æ–‡ä»¶é€²è¡Œé€æ˜é˜²å•ï¼Œé€šä¿—ä¾†èªªå°±æ˜¯HARæ–‡ä»¶å°NameNodeä¾†èªªæ˜¯ä¸€å€‹æ–‡ä»¶æ¸›å°‘äº†å…§å­˜çš„æµªè²»ï¼Œå°æ–¼å¯¦éš›æ“ä½œé‚„æ˜¯ä¸€å€‹å€‹ç¨ç«‹çš„æ–‡ä»¶ã€‚<br></p><div class=pgc-img><img alt=Hadoopä¹‹HDFS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/09c2836e66f244e8b3137f71ddedf618><p class=pgc-img-caption>HARæ–‡ä»¶æ­¸æª”.png</p></div><p>ç›®å‰hhbç›®éŒ„ä¸‹æœ‰å…©å€‹å°æ–‡ä»¶,åŸ·è¡Œå‘½ä»¤</p><pre><code>hadoopÂ archiveÂ -archiveNameÂ hhb.harÂ -pÂ /hhbÂ /hhbhar</code></pre><p>åœ¨hhbharç›®éŒ„ä¸‹å°±æœƒæœ‰hhb.haræ–‡ä»¶,å±•ç¤ºhhb.haræ–‡ä»¶å…§å®¹</p><pre><code>hdfsÂ dfsÂ -lsÂ -RÂ /hhbhar/hhb.harÂ </code></pre><p>å…§å®¹ï¼š</p><pre><code>-rw-r--r--Â Â Â 3Â rootÂ supergroupÂ Â Â Â Â Â Â Â Â Â 0Â 2020-07-04Â 14:37Â /hhbhar/hhb.har/_SUCCESS-rw-r--r--Â Â Â 3Â rootÂ supergroupÂ Â Â Â Â Â Â Â 188Â 2020-07-04Â 14:37Â /hhbhar/hhb.har/_index-rw-r--r--Â Â Â 3Â rootÂ supergroupÂ Â Â Â Â Â Â Â Â 23Â 2020-07-04Â 14:37Â /hhbhar/hhb.har/_masterindex-rw-r--r--Â Â Â 3Â rootÂ supergroupÂ Â Â Â Â Â Â Â 154Â 2020-07-04Â 14:37Â /hhbhar/hhb.har/part-0</code></pre><p>åœ¨hhbharç›®éŒ„ä¸‹å°±æœƒæœ‰hhb.haræ–‡ä»¶,å±•ç¤ºhhb.haræ–‡ä»¶å…§å®¹</p><pre><code>Â hdfsÂ dfsÂ -lsÂ -RÂ har:///hhbhar/hhb.har</code></pre><p>å…§å®¹ï¼š</p><pre><code>-rw-r--r--Â Â Â 3Â rootÂ supergroupÂ Â Â Â Â Â Â Â Â 77Â 2020-07-04Â 14:11Â har:///hhbhar/hhb.har/hhh.txt-rw-r--r--Â Â Â 3Â rootÂ supergroupÂ Â Â Â Â Â Â Â Â 77Â 2020-07-04Â 14:09Â har:///hhbhar/hhb.har/wc.txt</code></pre><p>å°‡/hhbæ–‡ä»¶å¤¾ä¸‹é¢çš„å…§å®¹åˆªé™¤ï¼Œç„¶å¾Œå°‡hhb.harå…§å®¹è§£å£“éå»</p><pre><code>hdfsÂ dfsÂ -rmÂ /hhb/*hdfsÂ dfsÂ -lsÂ /hhbhdfsÂ dfsÂ -cpÂ har:///hhbhar/hhb.har/*Â /hhb/hdfsÂ dfsÂ -lsÂ /hhb</code></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Hadoop</a></li><li><a>HDFS</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/161b2693.html alt="HDFS ä½œç‚ºåˆ†ä½ˆå¼æ–‡ä»¶ç®¡ç†ç³»çµ±ï¼Œå¸¶ä½ ç­è§£Hadoopçš„åŸºç¤" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f360780b4e864e2f9d2b66bfee88366f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/161b2693.html title="HDFS ä½œç‚ºåˆ†ä½ˆå¼æ–‡ä»¶ç®¡ç†ç³»çµ±ï¼Œå¸¶ä½ ç­è§£Hadoopçš„åŸºç¤">HDFS ä½œç‚ºåˆ†ä½ˆå¼æ–‡ä»¶ç®¡ç†ç³»çµ±ï¼Œå¸¶ä½ ç­è§£Hadoopçš„åŸºç¤</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5b9be76b.html alt=Hadoopåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±æ¶æ§‹å’Œè¨­è¨ˆåŸç† class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/c200950907404ad4bfb1d0172e71b4ef style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5b9be76b.html title=Hadoopåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±æ¶æ§‹å’Œè¨­è¨ˆåŸç†>Hadoopåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±æ¶æ§‹å’Œè¨­è¨ˆåŸç†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7963f320.html alt=åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±HDFS class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/5c0384a2fdf14a1f9c53757ff8fedaeb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7963f320.html title=åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±HDFS>åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±HDFS</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1e7f6bbc.html alt=åªçŸ¥é“HDFSå’ŒGFSï¼Ÿä½ å…¶å¯¦ä¸¦ä¸æ‡‚åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ± class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/d7aca794643c45b6b15489b271e39355 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1e7f6bbc.html title=åªçŸ¥é“HDFSå’ŒGFSï¼Ÿä½ å…¶å¯¦ä¸¦ä¸æ‡‚åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±>åªçŸ¥é“HDFSå’ŒGFSï¼Ÿä½ å…¶å¯¦ä¸¦ä¸æ‡‚åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cd1b81d8.html alt=æ·ºæHDFSæ¶æ§‹å’Œè¨­è¨ˆ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5ab2c36d649e4f21b0ceacc2d36d0d49 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cd1b81d8.html title=æ·ºæHDFSæ¶æ§‹å’Œè¨­è¨ˆ>æ·ºæHDFSæ¶æ§‹å’Œè¨­è¨ˆ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bd6e9ab.html alt="EB ç´š HDFS é›†ç¾¤ç£å¸¶å­˜å„²è³‡æºæ± çš„å»ºè¨­å¯¦è¸" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3e250f81cde3466b83907cf56dfc18a6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bd6e9ab.html title="EB ç´š HDFS é›†ç¾¤ç£å¸¶å­˜å„²è³‡æºæ± çš„å»ºè¨­å¯¦è¸">EB ç´š HDFS é›†ç¾¤ç£å¸¶å­˜å„²è³‡æºæ± çš„å»ºè¨­å¯¦è¸</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>