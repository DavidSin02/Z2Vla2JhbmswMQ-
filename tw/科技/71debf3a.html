<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>如何從請求、傳輸、渲染3個方面提升Web前端性能 | 极客快訊</title><meta property="og:title" content="如何從請求、傳輸、渲染3個方面提升Web前端性能 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/ec3175fa2700484eac030574b8369e79"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/71debf3a.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/71debf3a.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/71debf3a.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/71debf3a.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/71debf3a.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/71debf3a.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/71debf3a.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/71debf3a.html><meta property="article:published_time" content="2020-11-14T21:05:14+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:14+08:00"><meta name=Keywords content><meta name=description content="如何從請求、傳輸、渲染3個方面提升Web前端性能"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/71debf3a.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>如何從請求、傳輸、渲染3個方面提升Web前端性能</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>什麼是WEB前端呢？就是用戶電腦的瀏覽器所做的一切事情。我們來看看用戶訪問網站，瀏覽器都做了哪些事情：</p><p>輸入網址 –> 解析域名 -> 請求頁面 -> 解析頁面併發送頁面中的資源請求 -> 渲染資源 -> 輸出頁面 -> 監聽用戶操作 -> 重新渲染。</p><p>通過上面的路徑可以看出瀏覽器分為請求、傳輸、渲染三部分來實現用戶的訪問，本文就從這三個部分來淺析如何提升WEB前端性能。</p><h2 class=pgc-h-arrow-right>一、請求</h2><p>瀏覽器為了減少請求傳輸，實現了自己的緩存機制。瀏覽器緩存就是把一個已經請求過的Web資源拷貝一份副本存儲在瀏覽器中，當再次請求相同的URL時，先去查看緩存，如果有本地緩存，瀏覽器緩存機制會根據驗證機制（Etag）和過期機制(Last-Modified)進行判斷是使用緩存，還是從服務器傳輸資源文件。具體流程如下圖所示：</p><div class=pgc-img><img alt=如何從請求、傳輸、渲染3個方面提升Web前端性能 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ec3175fa2700484eac030574b8369e79><p class=pgc-img-caption></p></div><p>瀏覽器的請求有些是併發的，有些是阻塞的，比如：圖片、CSS、接口的請求是併發；JS文件是阻塞的。請求JS的時候，瀏覽器會中斷渲染進程，等待JS文件加載解析完畢，再重新渲染。所以要把JS文件放在頁面的最後。</p><p>JS也可以通過兩種方式由阻塞改成並行：一種是通過創建script標籤，插入DOM中；另一種是在Script標籤中增加async屬性。</p><p>每種瀏覽器對同一域名併發的數量有限制，IE6/7是2，IE9是10，其他常見的瀏覽器是6，所以減少資源請求數量和使用多域名配置資源文件，能大大提高網站性能。</p><p>減少資源請求數量的方法，大致有以下幾種：</p><p>1、通過打包工具，合併資源，減少資源數量。就是開發版本是很多個資源文件，部署的時候，按類合併成幾個文件來輸出。在實現模塊管理的同時，實現統一輸出。</p><p>2、CSS中，使用css sprite減少圖片請求數量。</p><p>3、通過延遲加載技術，在用戶無感知的情況下請求資源。</p><p>4、通過服務器配置，實現一次請求，返回多個資源文件，如淘寶CDN那樣。</p><p>除了減少請求數量，也可以使用CDN鏡像，來減少網絡節點，實現快速響應。使用了CDN的請求，會根據用戶所處的地理位置，找尋最近的CDN節點，如果請求是新的，則從資源服務器拷貝到節點，然後再返回給客戶端。如果請求已經存在，則直接從節點返回客戶端。</p><p>通過上面我們瞭解的緩存機制，如果我們部署上線的時候，是需要刷新緩存的。普通緩存通過強刷就能改過來，而CDN緩存則需要通過改變URL來實現。同時我們不可能要求用戶按著Ctrl來刷新，所以通過打包工具，在部署的時候，統一更改URL是最有效的方式。而不常變更的庫文件，比如echart、jquery，則不建議更改。</p><h2 class=pgc-h-arrow-right>二、傳輸</h2><p>從服務器往客戶端傳輸，可以開啟gzip壓縮來提高傳輸效率。</p><p>Gzip有從1-10的十個等級。越高壓縮的越小，但壓縮使用的服務器硬件資源就越多。根據實踐，等級為5的時候最均衡，此時壓縮效果是100k可以壓縮成20k。</p><h2 class=pgc-h-arrow-right>三、渲染</h2><p>瀏覽器在加載了html後，就會一邊解析，一邊根據解析出來的結果進行資源請求，並生成DOM樹。而加載完畢的CSS，則被渲染引擎根據生成好的DOM樹，來生成渲染樹。等所有資源解析完畢計算好layout後，向瀏覽器界面繪製。隨著用戶操作，JS會修改DOM節點或樣式，重新繪製和重新排列。重新繪製指的是繪製DOM節點對應的渲染節點，重新排列是指重新計算這些節點在瀏覽器界面的位置。很顯然，重排是非常耗性能的。我們要做的是減少重排的次數。</p><p>生成DOM樹的時候，我們可以通過減少DOM節點來優化性能。最初都是用table佈局，節點深度和數量相當複雜，性能很差。同樣CSS作為層疊樣式表，層級也不可太深，不然遍歷的成本很高。另外CSS的expression屬性相當耗性能，能不用則不用。動畫效果能用CSS寫的就不用JS寫，渲染引擎不一樣，性能損耗也不一樣。</p><p>上面說的是解析渲染的過程，我們再接著說說用戶交互操作的過程。用戶操作就會導致重繪和重排，重排一定會引起重繪，而重繪不一定會引起重排。到底怎樣會引起重排呢？簡單的定義，DOM結構的變化，以及DOM樣式中幾何屬性的變化，就會導致重排。幾何屬性顧名思義，就是寬、高、邊框、外補丁、內補丁等俗稱盒模型的屬性。同時還有offset之類的邊距屬性。</p><p>重排是最耗能的，減少重排的方法有：</p><p>1、如果需要多次改變DOM，則先在內存中改變，最後一次性的插入到DOM中。</p><p>2、同上一條，如果多次改變樣式，合成一條，再插入DOM中。</p><p>3、由於position的值為absoute和fixed時候，是脫離文檔流的，操作此類DOM節點，不會引起整頁重排。所以動畫元素設置position使其脫離文檔流。</p><p>4、當DOM節點的display等於none的時候，是不會存在於渲染樹的，所以如果有比較複雜的操作，先使其display等於none，等待所有操作完畢後，再將display設成block，這樣就只重排兩次。</p><p>5、獲取會導致重排的屬性值時，存入變量，再次使用時就不會再次重排。獲取這些屬性會導致重排：offsetTop、offsetLeft、offsetWidth、offsetHeight、scrollTop、scrollLeft、scrollWidth、scrollHeight、clientTop、clientLeft、clientWidth、clientHeight</p><p>以上就是瀏覽器如何把資源變成肉眼所見的頁面的，除了上述根據瀏覽器流程而總結出來的性能優化，我們還需要看看javascript作為程序，需要的優化。先來看看javascript的垃圾回收機制。</p><p>Javascript的引擎會在固定的時間間隔，將不再使用的局部變量註銷掉，釋放其所佔的內存。而閉包的存在，將使引用一直存在，無法被釋放掉。全局變量的生命週期直至瀏覽器卸載頁面才會結束。所以一般來講，內存溢出就是由於全局變量的不釋放和閉包引起。為了防止內存溢出，我們可以做的方法有:</p><p>1、業務代碼放在匿名立即執行函數裡面，執行完畢會立即釋放掉。</p><p>2、少用全局變量，同時用完的變量手動註銷掉。</p><p>3、使用回調來代替閉包訪問內部屬性</p><p>4、當不可避免使用閉包時，慎重的對待其中的細節。不用的時候註銷掉。</p><p>5、通過瀏覽器自帶的工具profiles，來檢查內存活動情況。如果是波浪型的，說明正常。如果是傾斜式漸進上漲的，說明有內存不會被釋放，需要檢查相應的函數。</p><p>最後再說一點，函數裡返回異步取的值，經常有人這麼：</p><pre><code>Var getList = function(){ $.ajax().then(function(data){Return data;}) };Var users = getList();</code></pre><p>毫無疑問，由於函數內的返回是異步的，所以返回只能是undefined，而不是想要的data。於是為了實現返回data，就把ajax的async屬性設置成了false，由異步改為同步，來獲取到data。然而最大的問題來了，同步是會中斷渲染進程的，也就是請求返回的等待中，整個頁面是卡死的，用戶操作也不會有響應。這個問題真正的解決方案是返回promise對象，而不是把異步改成同步。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>請求</a></li><li><a>傳輸</a></li><li><a>Web</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/a2871b0c.html alt="可用於企業的 7 個最佳開源 Web 服務器！" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1531874286737ba179830a5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a2871b0c.html title="可用於企業的 7 個最佳開源 Web 服務器！">可用於企業的 7 個最佳開源 Web 服務器！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e8e457d9.html alt=網線傳輸距離是90米，如果超過90米怎麼辦？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/cf79d6c70d954d18a843c7900e4258fe style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e8e457d9.html title=網線傳輸距離是90米，如果超過90米怎麼辦？>網線傳輸距離是90米，如果超過90米怎麼辦？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b5c7fc0d.html alt=你不知道的網絡傳輸介質介紹 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e241ef4dbe8b489eb65b03c8c6dfb329 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b5c7fc0d.html title=你不知道的網絡傳輸介質介紹>你不知道的網絡傳輸介質介紹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/76584b4d.html alt=傳輸介質——雙絞線、光纖和無線傳輸 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e64da26aafc2427fa3804d049e1e6049 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/76584b4d.html title=傳輸介質——雙絞線、光纖和無線傳輸>傳輸介質——雙絞線、光纖和無線傳輸</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a7ea099c.html alt="5G 之光通信篇：光通信，信息傳輸的終極方案" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5ec65536f73f4d0eb7702b8caad5bea1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a7ea099c.html title="5G 之光通信篇：光通信，信息傳輸的終極方案">5G 之光通信篇：光通信，信息傳輸的終極方案</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e0f9daff.html alt=Web技術整體架構 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15314704812092ac6479d59 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e0f9daff.html title=Web技術整體架構>Web技術整體架構</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9879b4d6.html alt=萬字長文系列：Web前端百度面經（含答案）第二章 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3faa5af7bf4f40f7831eb1f3c4270933 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9879b4d6.html title=萬字長文系列：Web前端百度面經（含答案）第二章>萬字長文系列：Web前端百度面經（含答案）第二章</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/69e4d8dd.html alt=中科院在有機半導體自旋傳輸研究中取得新進展 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/Rng1grH61vpi8u style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/69e4d8dd.html title=中科院在有機半導體自旋傳輸研究中取得新進展>中科院在有機半導體自旋傳輸研究中取得新進展</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/25e69eeb.html alt="如何在 Web 服務器文檔根目錄上設置只讀文件權限" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/25e69eeb.html title="如何在 Web 服務器文檔根目錄上設置只讀文件權限">如何在 Web 服務器文檔根目錄上設置只讀文件權限</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2ad808b4.html alt=信號的正交分解和差分傳輸的區別 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/97076c8a98bb4cc7866c2f1663cafb7d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2ad808b4.html title=信號的正交分解和差分傳輸的區別>信號的正交分解和差分傳輸的區別</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eb7f5fde.html alt=無源光網絡傳輸（PON）弱電系統傳輸方案 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d0608d360ba74c6b818cf2dcfacac777 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eb7f5fde.html title=無源光網絡傳輸（PON）弱電系統傳輸方案>無源光網絡傳輸（PON）弱電系統傳輸方案</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3c0555f7.html alt=超強跨平臺文件傳輸工具，開源且免費 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/af5e5e47e89043f1a52e50d2f51c930d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3c0555f7.html title=超強跨平臺文件傳輸工具，開源且免費>超強跨平臺文件傳輸工具，開源且免費</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9a56a9fa.html alt=Mac上非常好用的免費的文件傳輸工具 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5b30dd7b0e7b4e7fbfd35ea1513ab128 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9a56a9fa.html title=Mac上非常好用的免費的文件傳輸工具>Mac上非常好用的免費的文件傳輸工具</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3b1e2995.html alt=Mac好用的各類型文件傳輸軟件合集 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5dd556954c7b4b5b91cff169626c9677 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3b1e2995.html title=Mac好用的各類型文件傳輸軟件合集>Mac好用的各類型文件傳輸軟件合集</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f2fc4f75.html alt=iPhone文件傳輸管理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/a7c23988b0904b069fa6f5b3cca52d60 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f2fc4f75.html title=iPhone文件傳輸管理>iPhone文件傳輸管理</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>