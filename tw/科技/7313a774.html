<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>阿波羅 STM32F767 開發板資料連載第五十九章 T9 拼音輸入法實驗 | 极客快訊</title><meta property="og:title" content="阿波羅 STM32F767 開發板資料連載第五十九章 T9 拼音輸入法實驗 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/9d1edd66723f4966b44d3cab502c055f"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7313a774.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7313a774.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7313a774.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7313a774.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7313a774.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7313a774.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7313a774.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7313a774.html><meta property="article:published_time" content="2020-11-14T21:03:32+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:32+08:00"><meta name=Keywords content><meta name=description content="阿波羅 STM32F767 開發板資料連載第五十九章 T9 拼音輸入法實驗"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/7313a774.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>阿波羅 STM32F767 開發板資料連載第五十九章 T9 拼音輸入法實驗</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><strong>1）實驗平臺：</strong>alientek 阿波羅 STM32F767 開發板<br><strong>2）摘自《STM32F7 開發指南(HAL 庫版)》關注官方微信號公眾號，獲取更多資料：正點原子</strong><br></p><div class=pgc-img><img alt="阿波羅 STM32F767 開發板資料連載第五十九章 T9 拼音輸入法實驗" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9d1edd66723f4966b44d3cab502c055f><p class=pgc-img-caption></p></div><p><strong>第五十九章 T9 拼音輸入法實驗</strong></p><p>上一章，我們在 ALIENTEK 阿波羅 STM32 開發板上實現了手寫識別輸入，但是該方法只</p><p>能輸入數字或者字母，不能輸入漢字。本章，我們將給大家介紹如何在ALIENTEK阿波羅 STM32</p><p>開發板上實現一個簡單的 T9 中文拼音輸入法。本章分為如下幾個部：</p><p>59.1 拼音輸入法簡介</p><p>59.2 硬件設計</p><p>59.3 軟件設計</p><p>59.4 下載驗證</p><p><strong>59.1 拼音輸入法簡介</strong></p><p>在計算機上漢字的輸入法有很多種，比如拼音輸入法、五筆輸入法、筆畫輸入法、區位輸</p><p>入法等。其中，又以拼音輸入法用的最多。拼音輸入法又可以分為很多類，比如全拼輸入、雙</p><p>拼輸入等。</p><p>而在手機上，用的最多的應該算是 T9 拼音輸入法了，T9 輸入法全名為智能輸入法，字庫</p><p>容量九千多字，支持十多種語言。T9 輸入法是由美國特捷通訊（Tegic Communications）軟件</p><p>公司開發的，該輸入法解決了小型掌上設備的文字輸入問題，已經成為全球手機文字輸入的標</p><p>準之一。</p><p>一般，手機拼音輸入鍵盤如圖 59.1.1 所示：</p><div class=pgc-img><img alt="阿波羅 STM32F767 開發板資料連載第五十九章 T9 拼音輸入法實驗" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9511fbbaff98462cb10aa0f9cfae5cf1><p class=pgc-img-caption></p></div><p><br></p><p>圖 59.1.1 手機拼音輸入鍵盤</p><p>在這個鍵盤上，我們對比下傳統的輸入法和 T9 輸入法，輸入“中國”兩個字需要的按鍵</p><p>次數。傳統的方法，先按 4 次 9，輸入字母 z，再按 2 次 4，輸入字母 h，再按 3 次 6，輸入字</p><p>母 o，再按 2 次 6，輸入字母 n，最後按 1 次 4，輸入字母 g。這樣，輸入“中”字，要按鍵 12</p><p>次，接著同樣的方法，輸入“國”字，需要按 6 次，總共就是 18 次按鍵。</p><p>如果是 T9，我們輸入“中”字，只需要輸入：9、4、6、6、4，即可實現輸入“中”字，</p><p>在選擇中字之後，T9 會聯想出一系列同中字組合的詞，如：文、國、斷、山等。這樣輸入“國”</p><p>字，我們直接選擇即可，所以輸入“國”字按鍵 0 次，這樣 T9 總共只需要 5 次按鍵。</p><p>這就是 T9 智能輸入法的優越之處。正因為 T9 輸入法高效便捷的輸入方式得到了眾多手機</p><p>廠商的採用，以至於 T9 成為了使用頻率最高知名度最大的手機輸入法。</p><p>本章，我們實現的 T9 拼音輸入法，沒有真正的 T9 那麼強大，我們這裡僅實現輸入部分，</p><p>不支持詞組聯想。</p><p>本章，我們主要通過一個和數字串對應的拼音索引表來實現 T9 拼音輸入，我們先將漢語</p><p>拼音所有可能的組合全部列出來，如下所示：</p><pre><code>const u8 PY_mb_space []={""};const u8 PY_mb_a []={"啊阿醃吖錒厑嗄錒呵醃"};const u8 PY_mb_ai []={"愛埃挨哎唉哀皚癌藹矮艾礙隘捱噯嗌嬡璦曖砹鎄靄"};const u8 PY_mb_an []={"安俺按暗岸案鞍氨諳胺垵揞犴庵桉銨鵪黯"};……此處省略 N 多組合const u8 PY_mb_zu []={"足租祖詛阻組卒族俎菹鏃"};const u8 PY_mb_zuan []={"鑽攥纂纘躦"};const u8 PY_mb_zui []={"最罪嘴醉蕞觜"};const u8 PY_mb_zun []={"尊遵樽鱒撙"};const u8 PY_mb_zuo []={"左佐做作坐座昨撮唑柞阼琢嘬怍胙祚砟酢"};</code></pre><p>這裡我們只列出了部分組合，我們將這些組合稱之為碼錶，然後將這些碼錶和其對應的數</p><p>字串對應起來，組成一個拼音索引表，如下所示：</p><pre><code>const py_index py_index3[]={{"" ,"",(u8*)PY_mb_space},{"2","a",(u8*)PY_mb_a},{"3","e",(u8*)PY_mb_e},{"6","o",(u8*)PY_mb_o},{"24","ai",(u8*)PY_mb_ai},{"26","an",(u8*)PY_mb_an},……此處省略 N 多組合{"94664","zhong",(u8*)PY_mb_zhong},{"94824","zhuai",(u8*)PY_mb_zhuai},{"94826","zhuan",(u8*)PY_mb_zhuan},{"248264","chuang",(u8*)PY_mb_chuang},{"748264","shuang",(u8*)PY_mb_shuang},{"948264","zhuang",(u8*)PY_mb_zhuang},}</code></pre><p>其中 py_index 是一個結構體，定義如下：</p><p>typedef struct</p><p>{</p><p>u8 *py_input;</p><p>//輸入的字符串</p><p>u8 *py;</p><p>//對應的拼音</p><p>u8 *pymb; //碼錶</p><p>}py_index;</p><p>其中 py_input，即與拼音對應的數字串，比如“94824”。py，即與 py_input 數字串對應的</p><p>拼音，如果 py_input=“94824”，那麼 py 就是“zhuai”。最後 pymb，就是我們前面說到的碼錶。</p><p>注意，一個數字串可以對應多個拼音，也可以對應多個碼錶。</p><p>在有了這個拼音索引表（py_index3）之後，我們只需要將輸入的數字串和 py_index3 索引</p><p>表裡面所有成員的 py_input 對比，將所有完全匹配的情況記錄下來，用戶要輸入的漢字就被確</p><p>定了，然後由用戶選擇可能的拼音組成（假設有多個匹配的項目），再選擇對應的漢字，即完成</p><p>一次漢字輸入。</p><p>當然還可能是找遍了索引表，也沒有發現一個完全符合要求的成員，那麼我們會統計匹配</p><p>數最多的情況，作為最佳結果，反饋給用戶。比如，用戶輸入“323”，找不到完全匹配的情況，</p><p>那麼我們就將能和“32”匹配的結果返回給用戶。這樣，用戶還是可以得到輸入結果，同時還</p><p>可以知道輸入有問題，提示用戶需要檢查輸入是否正確。</p><p>以上，就是我們的 T9 拼音輸入法原理，關於拼音輸入法，我們就介紹到這裡。</p><p>最後，我們看看一個完整的 T9 拼音輸入步驟（過程）：</p><p><strong>1） 輸入拼音數字串</strong></p><p>本章，我們用到的 T9 拼音輸入法的核心思想就是對比用戶輸入的拼音數字串，所以必</p><p>須先由用戶輸入拼音數字串。</p><p><strong>2） 在拼音索引表裡面查找和輸入字符串匹配的項，並記錄</strong></p><p>在得到用戶輸入的拼音數字串之後，在拼音索引表裡面查找所有匹配的項目，如果有</p><p>完全匹配的項目，就全部記錄下來，如果沒有完全匹配的項目，則記錄匹配情況最好的一</p><p>個項目。</p><p><strong>3） 顯示匹配清單裡面所有可能的漢字，供用戶選擇.</strong></p><p>將匹配項目的拼音和對應的漢字顯示出來，供用戶選擇。如果有多個匹配項（一個數</p><p>字串對應多個拼音的情況），則用戶還可以選擇拼音。</p><p><strong>4） 用戶選擇匹配項，並選擇對應的漢字.</strong></p><p>用戶對匹配的拼音和漢字進行選擇，選中其真正想輸入的拼音和漢字，實現一次拼音</p><p>輸入。</p><p>以上 4 個步驟，就可以實現一個簡單的 T9 漢字拼音輸入法。</p><p><strong>59.2 硬件設計</strong></p><p>本章實驗功能簡介：開機的時候先檢測字庫，然後顯示提示信息和繪製拼音輸入表，之後</p><p>進入等待輸入狀態。此時用戶可以通過屏幕上的拼音輸入表輸入拼音數字串（通過 DEL 可以實</p><p>現退格），然後程序自動檢測與之對應的拼音和漢字，並顯示在屏幕上（同時輸出到串口）。</p><p>如果有多個匹配的拼音，則通過 KEY_UP 和 KEY1 進行選擇。按鍵 KEY0 用於清除一次輸入，</p><p>按鍵 KEY2 用於觸摸屏校準。</p><p>本實驗用到的資源如下：</p><p>1） 指示燈 DS0</p><p>2） 四個按鍵（KEY0/KEY1/KEY2/KEY_UP）</p><p>3） 串口</p><p>4） LCD 模塊（含觸摸屏）</p><p>5） SPI FLASH</p><p>這些用到的硬件，我們在之前都已經介紹過，這裡就不再介紹了。</p><p><strong>59.3 軟件設計</strong></p><p>打開本章實驗工程可以看到，我們在根目錄文件夾下新建了一個 T9INPUT 的文件夾。在</p><p>該文件夾下面新建了 pyinput.c、pyinput.h 和 pymb.h 三個文件，然後在工程裡面新建一個</p><p>T9INPUT 的組，將 pyinput.c 加入到該組下面。最後，將 T9INPUT 文件夾加入頭文件包含路徑。</p><p>打開 pyinput.c，代碼如下：</p><pre><code>//拼音輸入法pyinput t9={get_pymb,   0,};//比較兩個字符串的匹配情況//返回值:0xff,表示完全匹配.// 其他,匹配的字符數u8 str_match(u8*str1,u8*str2){u8 i=0;while(1){if(*str1!=*str2)break; //部分匹配if(*str1=='\0'){i=0XFF;break;} //完全匹配i++; str1++; str2++;}return i;//兩個字符串相等}//獲取匹配的拼音碼錶//*strin,輸入的字符串,形如:"726"//**matchlist,輸出的匹配表.//返回值:[7],0,表示完全匹配；1，表示部分匹配（僅在沒有完全匹配的時候才會出現）// [6:0],完全匹配的時候，表示完全匹配的拼音個數// 部分匹配的時候，表示有效匹配的位數 u8 get_matched_pymb(u8 *strin,py_index **matchlist){py_index *bestmatch=0;//最佳匹配u16 pyindex_len=0;u16 i=0;u8 temp,mcnt=0,bmcnt=0;bestmatch=(py_index*)&amp;py_index3[0];//默認為 a 的匹配pyindex_len=sizeof(py_index3)/sizeof(py_index3[0]);//得到 py 索引表的大小.for(i=0;i&lt;pyindex_len;i++){temp=str_match(strin,(u8*)py_index3[i].py_input);if(temp){if(temp==0XFF)matchlist[mcnt++]=(py_index*)&amp;py_index3[i];else if(temp&gt;bmcnt)//找最佳匹配{bmcnt=temp; bestmatch=(py_index*)&amp;py_index3[i];//最好的匹配. } }}  if(mcnt==0&amp;&amp;bmcnt)//沒有完全匹配的結果,但是有部分匹配的結果{matchlist[0]=bestmatch;mcnt=bmcnt|0X80; //返回部分匹配的有效位數}return mcnt;//返回匹配的個數}//得到拼音碼錶.//str:輸入字符串//返回值:匹配個數.u8 get_pymb(u8* str){return get_matched_pymb(str,t9.pymb);}//串口測試用void test_py(u8 *inputstr){……代碼省略}</code></pre><p>這裡總共就 4 個函數，其中 get_matched_pymb，是核心，該函數實現將用戶輸入拼音數字</p><p>串同拼音索引表裡面的各個項對比，找出匹配結果，並將完全匹配的項目存放在 matchlist裡面，</p><p>同時記錄匹配數。對於那些沒有完全匹配的輸入串，則查找與其最佳匹配的項目，並將匹配的</p><p>長度返回。函數 test_py（代碼省略）用於給 usmart 調用，實現串口測試，該函數可有可無，只</p><p>是在串口測試的時候才用到，如果不使用的話，可以去掉，本章，我們將其加入 usmart 控制，</p><p>大家可以通過該函數實現串口調試拼音輸入法。</p><p>其他兩個函數，也比較簡單了，我們這裡就不細說了。打開 pyinput.h，代碼如下：</p><pre><code>#ifndef __PYINPUT_H#define __PYINPUT_H#include "sys.h"//拼音碼錶與拼音的對應表typedef struct{ u8 *py_input;//輸入的字符串 u8 *py; //對應的拼音 u8 *pymb; //碼錶}py_index;#define MAX_MATCH_PYMB 10 //最大匹配數//拼音輸入法typedef struct{ u8(*getpymb)(u8 *instr); //字符串到碼錶獲取函數 py_index *pymb[MAX_MATCH_PYMB]; //碼錶存放位置}pyinput;extern pyinput t9;u8 str_match(u8*str1,u8*str2);u8 get_matched_pymb(u8 *strin,py_index **matchlist);u8 get_pymb(u8* str);void test_py(u8 *inputstr); #endif</code></pre><p>pymb.h 裡面完全就是我們前面介紹的拼音碼錶，該文件很大，裡面存儲了所有我們可以輸</p><p>入的漢字，此部分代碼就不貼出來了，請大家參考光盤本例程的源碼。</p><p>最後，我們看看主函數代碼：</p><pre><code>const u8* kbd_tbl[9]={"←","2","3","4","5","6","7","8","9",};//數字表const u8* kbs_tbl[9]={"DEL","abc","def","ghi","jkl","mno","pqrs","tuv","wxyz",};//字符表u16 kbdxsize; //虛擬鍵盤按鍵寬度u16 kbdysize; //虛擬鍵盤按鍵高度//加載鍵盤界面//x,y:界面起始座標void py_load_ui(u16 x,u16 y){……//此處省略部分代碼 }//按鍵狀態設置//x,y:鍵盤座標//key:鍵值（0~8）//sta:狀態，0，鬆開；1，按下；void py_key_staset(u16 x,u16 y,u8 keyx,u8 sta){ u16 i=keyx/3,j=keyx%3;if(keyx&gt;8)return;if(sta)LCD_Fill(x+j*kbdxsize+1,y+i*kbdysize+1,x+j*kbdxsize+kbdxsize-1,y+i*kbdysize+kbdysize-1,GREEN);else LCD_Fill(x+j*kbdxsize+1,y+i*kbdysize+1,x+j*kbdxsize+kbdxsize-1,y+i*kbdysize+kbdysize-1,WHITE); Show_Str_Mid(x+j*kbdxsize,y+4+kbdysize*i,(u8*)kbd_tbl[keyx],16,kbdxsize);Show_Str_Mid(x+j*kbdxsize,y+kbdysize/2+kbdysize*i,(u8*)kbs_tbl[keyx],16,kbdxsize);}//得到觸摸屏的輸入//x,y:鍵盤座標//返回值：按鍵鍵值（1~9 有效；0,無效）u8 py_get_keynum(u16 x,u16 y){u16 i,j; u8 key=0;static u8 key_x=0;//0,沒有任何按鍵按下；1~9，1~9 號按鍵按下tp_dev.scan(0); if(tp_dev.sta&amp;TP_PRES_DOWN) //觸摸屏被按下  {for(i=0;i&lt;3;i++){for(j=0;j&lt;3;j++){if(tp_dev.x[0]&lt;(x+j*kbdxsize+kbdxsize)&amp;&amp;tp_dev.x[0]&gt;(x+j*kbdxsize)&amp;&amp;tp_dev.y[0]&lt;(y+i*kbdysize+kbdysize)&amp;&amp;tp_dev.y[0]&gt;(y+i*kbdysize)){key=i*3+j+1; break;}}if(key){ if(key_x==key)key=0;else {py_key_staset(x,y,key_x-1,0);key_x=key;py_key_staset(x,y,key_x-1,1);}break;}} }else if(key_x){ py_key_staset(x,y,key_x-1,0); key_x=0;} return key; } //顯示結果.//index:0,表示沒有一個匹配的結果.清空之前的顯示// 其他,索引號void py_show_result(u8 index){LCD_ShowNum(30+144,125,index,1,16); //顯示當前的索引LCD_Fill(30+40,125,30+40+48,130+16,WHITE); //清除之前的顯示LCD_Fill(30+40,145,lcddev.width,145+48,WHITE); //清除之前的顯示 if(index){Show_Str(30+40,125,200,16,t9.pymb[index-1]-&gt;py,16,0); //顯示拼音Show_Str(30+40,145,lcddev.width-70,48,t9.pymb[index-1]-&gt;pymb,16,0);//顯示漢字printf("\r\n 拼音:%s\r\n",t9.pymb[index-1]-&gt;py); //串口輸出拼音printf("結果:%s\r\n",t9.pymb[index-1]-&gt;pymb); //串口輸出結果} }int main(void){ u8 i=0,result_num,cur_index,key,inputstr[7];//最大輸入 6 個字符+結束符u8 inputlen; //輸入長度  Cache_Enable(); //打開 L1-Cache HAL_Init(); //初始化 HAL 庫 Stm32_Clock_Init(432,25,2,9); //設置時鐘,216Mhz  delay_init(216); //延時初始化uart_init(115200); //串口初始化usmart_dev.init(108); //初始化 USMART LED_Init(); //初始化 LED KEY_Init(); //初始化按鍵 SDRAM_Init(); //初始化 SDRAM LCD_Init(); //初始化 LCD W25QXX_Init(); //初始化 W25Q256 tp_dev.init(); //初始化觸摸屏 my_mem_init(SRAMIN); //初始化內部內存池 my_mem_init(SRAMEX); //初始化外部 SDRAM 內存池 my_mem_init(SRAMDTCM); //初始化內部 DTCM 內存池 RESTART:POINT_COLOR=RED; while(font_init()) //檢查字庫{ LCD_ShowString(60,50,200,16,16,"Font Error!");delay_ms(200); LCD_Fill(60,50,240,66,WHITE);//清除顯示 } ……//此處省略部分代碼if(lcddev.id==0X5310){kbdxsize=86;kbdysize=43;}//根據 LCD 分辨率設置按鍵大小else if(lcddev.id==0X5510){kbdxsize=140;kbdysize=70;}else {kbdxsize=60;kbdysize=40;}py_load_ui(30,195);memset(inputstr,0,7); //全部清零inputlen=0; //輸入長度為 0result_num=0; //總匹配數清零cur_index=0;while(1){i++;delay_ms(10);key=py_get_keynum(30,195);if(key){if(key==1)//刪除  {if(inputlen)inputlen--;inputstr[inputlen]='\0';//添加結束符}else {inputstr[inputlen]=key+'0';//輸入字符if(inputlen&lt;7)inputlen++;}if(inputstr[0]!=NULL){key=t9.getpymb(inputstr); //得到匹配的結果數if(key)//有部分匹配/完全匹配的結果{result_num=key&amp;0X7F; //總匹配結果cur_index=1; //當前為第一個索引if(key&amp;0X80) //是部分匹配{inputlen=key&amp;0X7F; //有效匹配位數inputstr[inputlen]='\0';//不匹配的位數去掉if(inputlen&gt;1)result_num=t9.getpymb(inputstr);//重新獲取完全匹配字符數} }else //沒有任何匹配{ inputlen--;inputstr[inputlen]='\0';}}else{cur_index=0;result_num=0;}LCD_Fill(30+40,105,30+40+48,110+16,WHITE); //清除之前的顯示LCD_ShowNum(30+144,105,result_num,1,16); //顯示匹配的結果數Show_Str(30+40,105,200,16,inputstr,16,0); //顯示有效的數字串py_show_result(cur_index); //顯示第 cur_index 的匹配結果}key=KEY_Scan(0);if(key==KEY2_PRES&amp;&amp;tp_dev.touchtype==0)//KEY2 按下,且是電阻屏{ tp_dev.adjust();LCD_Clear(WHITE);goto RESTART;  }if(result_num) //存在匹配的結果{switch(key){case WKUP_PRES://上翻if(cur_index&lt;result_num)cur_index++;else cur_index=1;py_show_result(cur_index); //顯示第 cur_index 的匹配結果break;case KEY1_PRES://下翻 if(cur_index&gt;1)cur_index--;else cur_index=result_num;py_show_result(cur_index); //顯示第 cur_index 的匹配結果break;case KEY0_PRES://清除輸入LCD_Fill(30+40,145,lcddev.width-1,145+48,WHITE);//清除之前顯示 goto RESTART; } }if(i==30){i=0;LED0_Toggle;} } }</code></pre><p>此部分代碼除 main 函數外還有 4 個函數。首先，py_load_ui，該函數用於加載輸入鍵盤，</p><p>在 LCD 上面顯示我們輸入拼音數字串的虛擬鍵盤。py_key_staset，該函數用與設置虛擬鍵盤某</p><p>個按鍵的狀態（按下/鬆開）。py_get_keynum，該函數用於得到觸摸屏當前按下的按鍵鍵值，通</p><p>過該函數實現拼音數字串的獲取。最後，py_show_result，該函數用於顯示輸入串的匹配結果，</p><p>並將結果打印到串口。</p><p>在 main 函數裡面，實現了我們在 59.2 節所說的功能，這裡我們並沒有實現漢字選擇功能，</p><p>但是有本例程作為基礎，再實現漢字選擇功能就比較簡單了，大家自行實現即可。注意：kbdxsize</p><p>和 kbdysize 代表虛擬鍵盤按鍵寬度和高度，程序根據 LCD 分辨率不同而自動設置這兩個參數，</p><p>以達到較好的輸入效果。</p><p>最後，我們將 test_py 函數加入 USMART 控制，以便大家串口調試。</p><p>至此，本實驗的軟件設計部分結束。</p><p><strong>59.4 下載驗證</strong></p><p>在代碼編譯成功之後，我們下載代碼到 ALIENTEK 阿波羅 STM32 開發板上，得到，如圖</p><p>59.4.1 所示：</p><div class=pgc-img><img alt="阿波羅 STM32F767 開發板資料連載第五十九章 T9 拼音輸入法實驗" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/78c73114e49549e9a6fe8272851d4413><p class=pgc-img-caption></p></div><p>圖 59.4.1 漢字輸入法界面</p><p>此時，我們在虛擬鍵盤上輸入拼音數字串，即可實現拼音輸入，如圖 59.4.2 所示：</p><div class=pgc-img><img alt="阿波羅 STM32F767 開發板資料連載第五十九章 T9 拼音輸入法實驗" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d12557c698eb4f12a955230dc15277e8><p class=pgc-img-caption></p></div><p><br></p><p>圖 59.4.2 實現拼音輸入</p><p>如果發現輸入錯了，可以通過屏幕上的 DEL 按鈕，來退格。如果有多個匹配的情況（匹配</p><p>值大於 1），則可以通過 KEY_UP 和 KEY1 來選擇拼音。通過按下 KEY0，可以清除當前輸入，</p><p>通過按下 KEY2，可以實現觸摸屏校準（僅限電阻屏，電容屏無需校準）。</p><p>我們還可以通過 USMART 調用 test_py 來實現輸入法調試，如圖 59.4.3 所示：</p><div class=pgc-img><img alt="阿波羅 STM32F767 開發板資料連載第五十九章 T9 拼音輸入法實驗" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5082d461387048b185beb35c98a45bda><p class=pgc-img-caption></p></div><p>圖 59.4.3 USMART 調試 T9 拼音輸入法</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>第五十九章</a></li><li><a>阿波羅</a></li><li><a>STM32F767</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/45d2ef5.html alt="ALIENTEK 阿波羅 STM32F767 開發板資料連載第九章 外部中斷實驗" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/9d1edd66723f4966b44d3cab502c055f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/45d2ef5.html title="ALIENTEK 阿波羅 STM32F767 開發板資料連載第九章 外部中斷實驗">ALIENTEK 阿波羅 STM32F767 開發板資料連載第九章 外部中斷實驗</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/24fcab2.html alt="ALIENTEK 阿波羅 STM32F767 開發板資料連載第十二章 定時器中斷" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/9d1edd66723f4966b44d3cab502c055f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/24fcab2.html title="ALIENTEK 阿波羅 STM32F767 開發板資料連載第十二章 定時器中斷">ALIENTEK 阿波羅 STM32F767 開發板資料連載第十二章 定時器中斷</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/962453a.html alt=舉還是不舉？與渣男阿波羅朝夕相處的小花有自己的選擇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b599514b0c7047f4913b78037d0867db style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/962453a.html title=舉還是不舉？與渣男阿波羅朝夕相處的小花有自己的選擇>舉還是不舉？與渣男阿波羅朝夕相處的小花有自己的選擇</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/3fea7ec.html alt=月球上跳一跳很危險嗎？阿波羅宇航員親口承認，跳了一下差點沒命 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=http://p3.pstatp.com/large/pgc-image/10a496a6b500434a85e410d1b5373104 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/3fea7ec.html title=月球上跳一跳很危險嗎？阿波羅宇航員親口承認，跳了一下差點沒命>月球上跳一跳很危險嗎？阿波羅宇航員親口承認，跳了一下差點沒命</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/c383660.html alt=如何從月球回到地球？快來看阿波羅11號獨家回收過程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=http://p9.pstatp.com/large/pgc-image/f327b2dd56354f43bae69237ae7ee024 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/c383660.html title=如何從月球回到地球？快來看阿波羅11號獨家回收過程>如何從月球回到地球？快來看阿波羅11號獨家回收過程</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/02c4a25.html alt=登上月球的代價——阿波羅1號慘劇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=http://p1.pstatp.com/large/pgc-image/def04402a97941dca954a03a2155b76e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/02c4a25.html title=登上月球的代價——阿波羅1號慘劇>登上月球的代價——阿波羅1號慘劇</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/7cbc1fc.html alt=阿波羅1號慘劇，讓人類登上月球的一課 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=http://p1.pstatp.com/large/pgc-image/def04402a97941dca954a03a2155b76e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/7cbc1fc.html title=阿波羅1號慘劇，讓人類登上月球的一課>阿波羅1號慘劇，讓人類登上月球的一課</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>