<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>程序員的一次失誤，在 45 分鐘裡搞垮了一家上市公司 | 极客快訊</title><meta property="og:title" content="程序員的一次失誤，在 45 分鐘裡搞垮了一家上市公司 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="http://p1.pstatp.com/large/pgc-image/RupKXl2WLPhUP"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/748e9e2.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/748e9e2.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/748e9e2.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/748e9e2.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/748e9e2.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/748e9e2.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/748e9e2.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/748e9e2.html><meta property="article:published_time" content="2020-10-29T20:48:27+08:00"><meta property="article:modified_time" content="2020-10-29T20:48:27+08:00"><meta name=Keywords content><meta name=description content="程序員的一次失誤，在 45 分鐘裡搞垮了一家上市公司"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/748e9e2.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>程序員的一次失誤，在 45 分鐘裡搞垮了一家上市公司</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>如果有人告訴你，45 分鐘就能搞垮一家大公司，你可能會覺得有點荒謬。但工程師 Doug Seven 卻真的親歷過這樣的事情。</p><p>8 年前，因為一次失敗的部署，Knight Capital Group 在僅僅 45 分鐘內就造成了 4.6 億美元的虧損。</p><p>這是一個真實的故事。</p><p>儘管 Doug Seven 並不是事件的參與者，但他在後來的會議中不斷提及 DevOps、代碼配置和持續交付的主題，希望讓開發人員意識到部署的重要性。</p><p>究竟是怎麼回事？Doug Seven 在博客中分享了這個故事。</p><img alt="程序員的一次失誤，在 45 分鐘裡搞垮了一家上市公司" onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/RupKXl2WLPhUP><p><strong>故事背景</strong></p><p>這個故事的主角是一家名為 Knight Capital Group 的美國全球金融服務公司，它從事做市、電子執行、機構銷售和交易。</p><p>2012 年，Knight 是美國最大的股票交易商，在紐約證交所和納斯達克的市場份額約為 17%。Knight 電子交易集團（ETG）平均每日交易量超過 33 億筆，每日交易額超過 210 億美元。</p><p>種種數據表明，當時公司的運營和財務狀況非常優秀。</p><p>2012 年 7 月 31 日，Knight 擁有約 3.65 億美元的資產。</p><p>當時，紐約證交所正計劃於 2012 年 8 月 1 日推出一項新的零售流動性計劃。</p><p>為了準備這次活動，Knight 更新了他們的路由器 SMARS。這個路由器負責將訂單發送到市場上執行。SMARS 的核心功能之一是接收 Knight 交易平臺其他組件的訂單（父訂單），然後發送一個或多個子訂單執行。換言之，SMARS 將從交易平臺收到大量訂單，並將它們分成多個較小的訂單，以便找到股票數量相匹配的買家或者賣家。父訂單越大，生成的子訂單越多。</p><p>在 SMARS 中，有一段老舊的代碼，名為「Power Peg」，它已經 8 年沒被用到過了，而此次更新的目的正是要換掉這段代碼。更新的代碼重新調整了用於激活 Power Peg 功能的舊標誌的功能。</p><p>代碼經過了徹底的測試，並且還進行了一系列的驗證。所有的一切都看起來很完美，找不到出錯的理由。</p><p><strong>死灰復燃的舊代碼</strong></p><p>2012 年 7 月 27 日至 2012 年 7 月 31 日期間，Knight 的開發人員每天手動將新的軟件部署到公司的 8 臺服務器上。這就是 SEC 文件中關於手動部署過程的內容。如果 SEC 文件中有關於部署的內容，那麼就可能出現了嚴重的錯誤。</p><p>然而，在新代碼的部署過程中，Knight 的一名技術人員忘記將新代碼複製到所有 8 臺 SMARS 計算機服務器中——他漏掉了其中一臺服務器。</p><p>沒有第二個技術人員來審查這個部署。</p><p>Knight 的所有人都沒有意識到，Power Peg 代碼並沒有從第 8 個服務器上刪除，也沒有添加新的 RLP 代碼。Knight 沒有書面流程要求這樣的審查。</p><p>2012 年 8 月 1 日，在美國東部時間上午 9:30，市場開盤。Knight 開始代表客戶處理訂單。</p><p>具有正確 SMARS 部署的 7 臺服務器開始正確處理這些訂單。然而，發送到第 8 臺服務器的命令觸發了可支持的重新利用標誌，並從死地中恢復了舊的 Power Peg 代碼。</p><p><strong>殺手代碼如殭屍般的攻擊</strong></p><p>Power Peg 代碼用於在執行子訂單時，根據父訂單計算購買或者出售的股份。Power Peg 將指示系統在完成父訂單後停止傳送子訂單。</p><p>也就是說，Power Peg 會跟蹤子訂單，並在父訂單完成後停止它們。</p><p>2005 年，Knight 將這種累計跟蹤功能移到了代碼執行的早期階段，從而從 Power Peg 中刪除了計數跟蹤。</p><p>當激活第 8 臺服務器上的 Power Peg 標誌時，Power Peg 功能開始路由子訂單以供執行。但由於沒有根據父訂單跟蹤共享量，造成了一個永無止境的循環。</p><p><strong>地獄 45 分鐘</strong></p><p>想象一下，如果你有一個系統，它能夠向市場發送自動化的、高速的訂單，且沒有任何跟蹤程序來檢查是否執行了足夠的訂單，會發生什麼？沒有比這更糟糕的事了。</p><p>上午 9:30 開市時，人們很快就知道出了問題。到上午 9 點 31 分，華爾街的許多人都清楚發生了一些嚴重的事情。市場上充斥著非正常交易量的股票訂單。</p><p>到上午 9 點 32 分，華爾街的人們都在想，為什麼訂單還沒有停下來，為什麼沒有人按下任何系統的關閉開關？結果他們發現，並沒有關閉開關。在交易的前 45 分鐘裡，Knight 的交易量佔了總交易量的 50% 以上，這使得某些股票的市值上漲了 10% 以上。因此，其他股票因錯誤的交易而貶值。</p><p>更糟糕的是，Knight 的系統在當天早些時候開始自動發送電子郵件。早在上午 8:01，SMAR 已經處理了符合上市前交易條件的訂單。郵件消息引用 SMARS，並將錯誤識別為「Power Peg disabled」。</p><p>在上午 8:01 到 9:30 之間，Knight 工作人員也收到了 97 封郵件。可惜的是，這些電子郵件不是作為系統警報設計的，因此沒有人立即查看它們。</p><p>在 Knight 經歷的 45 分鐘內，他們嘗試了幾種反制措施，試圖阻止錯誤的交易。由於沒有終止開關，所以他們只能在實時交易環境中嘗試診斷問題。</p><p>每分鐘，系統上約有 800 萬股股票被交易。他們無法確定是什麼導致了錯誤的命令，所以他們從正確部署的服務器上卸載了新代碼。</p><p>換句話說，他們刪除了工作代碼，留下了損壞的代碼。</p><p>這更加放大了問題。最開始，僅在部署不正確的服務器上，額外的父命令激活了 Power Peg 代碼。現在，問題蔓延到了所有服務器上。最後，他們終於停止了系統，但此時已經進行了 45 分鐘的交易。</p><p>在開盤的前 45 分鐘，市場收到並處理了 212 份父訂單。因此，SMARS 向市場發送了數以百萬計的子訂單，產生了 400 萬筆交易，而其中 154 只股票的交易量超過了 3.97 億股。這意味著，Knight 資本集團在 45 分鐘內造成了 4.6 億美元的虧損。</p><p>然而，Knight 只有 3.65 億美元的資產。</p><p>45 分鐘後，美國股市最大的交易商、紐約證交所和納斯達克的主要做市商 Knight 破產，4 個月後被 Getco LLC 收購。</p><p><strong>軟件發佈必須可重複、可靠</strong></p><p>所有開發和運營團隊都應該從這次事件中吸取教訓。僅僅構建優秀的軟件並對其進行測試是不夠的，你還必須確保它被正確地交付給市場，這樣你的客戶才能獲得你所交付的價值。</p><p>部署 SMARS 的工程師並不是此事唯一的責任人，Knight 設置的流程和他們所面臨的風險並不匹配。此外，他們的流程天生就容易出錯。任何時候，如果你的部署過程依賴於人主動閱讀和遵循說明，那麼都將面臨風險。人是會犯錯的。錯誤可能出現在指令中，也可能出現在指令的解釋中，或出現在指令的執行中。</p><p>部署需要自動化，並且可重複，儘可能避免潛在的人為錯誤。如果 Knight 實現了自動化部署系統，將配置、部署和測試全部自動化，那麼這次錯誤本可以避免。</p><p>即使沒有實施完整的連續交付過程，你仍然需要遵守的幾個連續交付原則：</p><ul><li><p>軟件發佈應該是一個可重複、可靠的過程。</p></li><li><p>儘可能地自動化。</p></li></ul><p>via：https://dougseven.com/2014/04/17/knightmare-a-devops-cautionary-tale/</p><p>雷鋒網雷鋒網雷鋒網</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>失誤</a></li><li><a>45</a></li><li><a>分鐘裡</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/91eece92.html alt="只需 45 秒，Python 給故宮畫一組手繪圖！" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/df1bd890ffee4a439e9f5142ae42c102 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/91eece92.html title="只需 45 秒，Python 給故宮畫一組手繪圖！">只需 45 秒，Python 給故宮畫一組手繪圖！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9850d5c6.html alt="45天日照時數僅37小時 寧波“跨年連陰雨”何時終結" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RFEYDIbGLkZjYc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9850d5c6.html title="45天日照時數僅37小時 寧波“跨年連陰雨”何時終結">45天日照時數僅37小時 寧波“跨年連陰雨”何時終結</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3a5b2e05.html alt=把地球45億年壓縮成一天24小時，瞬間看懂大陸板塊移動（動圖） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/24d46742304946ed942ed97be5c69f72 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3a5b2e05.html title=把地球45億年壓縮成一天24小時，瞬間看懂大陸板塊移動（動圖）>把地球45億年壓縮成一天24小時，瞬間看懂大陸板塊移動（動圖）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ada95e57.html alt=施工工藝標準45條！結構、裝修、水電安裝都有了！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/8b11b30274f34b54879d887930a81605 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ada95e57.html title=施工工藝標準45條！結構、裝修、水電安裝都有了！>施工工藝標準45條！結構、裝修、水電安裝都有了！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/34501a8d.html alt=好消息！湖北45人入選第五批國家級非遺代表性項目代表性傳承人 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/34501a8d.html title=好消息！湖北45人入選第五批國家級非遺代表性項目代表性傳承人>好消息！湖北45人入選第五批國家級非遺代表性項目代表性傳承人</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/36fdd331.html alt=胃食管反流病，45個問題超全大彙總 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/1524623474597a7c82308e0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/36fdd331.html title=胃食管反流病，45個問題超全大彙總>胃食管反流病，45個問題超全大彙總</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7512a355.html alt=“45度讓路法”有溫度也應看到“實度” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/fd70131515544be788cd63ad46abd13a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7512a355.html title=“45度讓路法”有溫度也應看到“實度”>“45度讓路法”有溫度也應看到“實度”</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a49d3221.html alt=約45歲精神障礙男子在安徽安慶被救助，口音為懷寧縣人，其他信息無從得知，盼您提供家屬線索 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/2ecc0002153e84d1904d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a49d3221.html title=約45歲精神障礙男子在安徽安慶被救助，口音為懷寧縣人，其他信息無從得知，盼您提供家屬線索>約45歲精神障礙男子在安徽安慶被救助，口音為懷寧縣人，其他信息無從得知，盼您提供家屬線索</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/481faf41.html alt=45種液壓元件工作原理動圖演示 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/f3c2830684794fd1ad0daf9088e07feb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/481faf41.html title=45種液壓元件工作原理動圖演示>45種液壓元件工作原理動圖演示</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5b47882f.html alt=3200萬美元！恭喜艾弗森，不用破產了，45歲生日收穫厚禮 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/21cc9b47e9f04974bb5e575092ca7f65 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5b47882f.html title=3200萬美元！恭喜艾弗森，不用破產了，45歲生日收穫厚禮>3200萬美元！恭喜艾弗森，不用破產了，45歲生日收穫厚禮</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/14f84765.html alt=花園新能源總投資45億的高性能銅箔項目開工奠基 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/614200055b8c955a8b41 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/14f84765.html title=花園新能源總投資45億的高性能銅箔項目開工奠基>花園新能源總投資45億的高性能銅箔項目開工奠基</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/565e4bc3.html alt=45張電工常用電動機控制電路圖 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/4a77b0cb805d4357b9470ae9b60e6fbb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/565e4bc3.html title=45張電工常用電動機控制電路圖>45張電工常用電動機控制電路圖</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cef630be.html alt=這45個電機常識你一定要掌握 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/b9bb2a6c64b74451b94771b6356ac920 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cef630be.html title=這45個電機常識你一定要掌握>這45個電機常識你一定要掌握</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eae656b4.html alt="T-45'蒼鷹'教練機在CVN-78'福特'號航空母艦上進行起降測試" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/075d04ec56da4c708633b24e7304d9ce style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eae656b4.html title="T-45'蒼鷹'教練機在CVN-78'福特'號航空母艦上進行起降測試">T-45'蒼鷹'教練機在CVN-78'福特'號航空母艦上進行起降測試</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/98513109.html alt=立案處罰45家單位！安徽今年首批省生態環保專項督察結束進駐 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/SF6E2NVIWahwo style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/98513109.html title=立案處罰45家單位！安徽今年首批省生態環保專項督察結束進駐>立案處罰45家單位！安徽今年首批省生態環保專項督察結束進駐</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>