<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>è¶…è©³ç´°sharding-jdbcåˆ†åº«åˆ†è¡¨å¯¦ç¾ï¼ŒåŠåŸç†åˆ†æ | æå®¢å¿«è¨Š</title><meta property="og:title" content="è¶…è©³ç´°sharding-jdbcåˆ†åº«åˆ†è¡¨å¯¦ç¾ï¼ŒåŠåŸç†åˆ†æ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/d0c843f1033e4e00b52839371049731b"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/77ec56f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/77ec56f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/77ec56f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/77ec56f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/77ec56f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/77ec56f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/77ec56f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/77ec56f.html><meta property="article:published_time" content="2020-10-29T21:06:50+08:00"><meta property="article:modified_time" content="2020-10-29T21:06:50+08:00"><meta name=Keywords content><meta name=description content="è¶…è©³ç´°sharding-jdbcåˆ†åº«åˆ†è¡¨å¯¦ç¾ï¼ŒåŠåŸç†åˆ†æ"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/77ec56f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>è¶…è©³ç´°sharding-jdbcåˆ†åº«åˆ†è¡¨å¯¦ç¾ï¼ŒåŠåŸç†åˆ†æ</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>èƒŒæ™¯</h1><p>å‚³çµ±æ‡‰ç”¨é€šå¸¸å°‡æ•¸æ“šé›†ä¸­å­˜å„²åœ¨å–®ä¸€çš„æ•¸æ“šç¯€é»ä¸­ï¼Œå·²ç¶“è¶Šä¾†è¶Šä¸èƒ½æ»¿è¶³ç¾ä»£äº’è¯ç¶²çš„æµ·é‡æ•¸æ“šå ´æ™¯ã€‚éš¨è‘—ç”¨æ–¼ç”¨æˆ¶çš„å¢é•·ï¼Œå°ä½µç™¼æ€§èƒ½è¦æ±‚è¶Šä¾†è¶Šé«˜ï¼Œç³»çµ±å¾Œè‡ºæœå‹™å¯ä»¥å¾ˆå®¹æ˜“çš„é€²è¡Œæ“´å®¹ï¼ˆè² è¼‰å‡è¡¡ç­‰ï¼‰ï¼Œé€™æ¨£æœ€çµ‚çš„ç“¶é ¸å°±æ˜¯æ•¸æ“šåº«äº†ï¼Œå–®ä¸€çš„æ•¸æ“šç¯€é»æˆ–è€…ç°¡å–®çš„ä¸»å¾çµæ§‹æ˜¯é›£ä»¥æ‰¿å—çš„ã€‚â€ƒâ€ƒå„˜ç®¡ç›®å‰å·²ç¶“æœ‰ nosql/newsql èƒ½å¤ æ”¯æ’æµ·é‡çš„æ•¸æ“šï¼Œä½†æ˜¯å…¶å°å‚³çµ± sql æ˜¯ä¸å…¼å®¹çš„ï¼Œè€Œä¸”ç”Ÿæ…‹åœˆé ä¸å¤ªå®Œå–„ï¼Œé—œä¿‚å‹æ•¸æ“šåº«çš„åœ°ä½é‚„æ˜¯ç„¡æ³•æ’¼å‹•çš„ã€‚â€ƒâ€ƒç”±æ­¤ç”¢ç”Ÿäº†æ•¸æ“šåˆ†ç‰‡çš„æ¦‚å¿µã€‚æŒ‰ç…§æŸå€‹åˆ†ç‰‡ç¶­åº¦å°‡å­˜æ”¾åœ¨å–®ä¸€æ•¸æ“šåº«ä¸­çš„æ•¸æ“šåˆ†æ•£åœ°å­˜æ”¾è‡³å¤šå€‹æ•¸æ“šåº«æˆ–è¡¨ä¸­ä»¥æå‡æ€§èƒ½ã€‚æ•¸æ“šåˆ†ç‰‡çš„æ‹†åˆ†æ–¹å¼åˆ†ç‚ºï¼šå‚ç›´åˆ†ç‰‡å’Œæ°´å¹³åˆ†ç‰‡å…©ç¨®ã€‚</p><h1 class=pgc-h-arrow-right>å‚ç›´åˆ†ç‰‡</h1><p>æŒ‰ç…§æ¥­å‹™é‚è¼¯æ‹†åˆ†çš„æ–¹å¼ç¨±ç‚ºå‚ç›´åˆ†ç‰‡ï¼Œåˆç¨±ç‚ºç¸±å‘æ‹†åˆ†ã€‚æ ¸å¿ƒç†å¿µå°±æ˜¯å°ˆåº«å°ˆç”¨ã€‚å°‡ä¸€å€‹å¤§çš„æ•¸æ“šåº«æŒ‰ç…§æ¥­å‹™é‚è¼¯åˆ†é¡ï¼Œæ‹†åˆ†ç‚ºå¤šå€‹å°çš„æ•¸æ“šåº«ï¼Œæ¯å€‹æ¥­å‹™é‚è¼¯ä½¿ç”¨å„è‡ªçš„æ•¸æ“šåº«ï¼Œå¾è€Œå°‡å£“åŠ›åˆ†æ•£åˆ°ä¸åŒçš„æ•¸æ“šåº«ä¸­ã€‚å‚ç›´åˆ†ç‰‡å¾€å¾€éœ€è¦å°æ¶æ§‹å’Œè¨­è¨ˆé€²è¡Œèª¿æ•´ï¼Œé¡ä¼¼å¾®æœå‹™çš„æ¦‚å¿µã€‚ä½†æ˜¯å‚ç›´æ‹†åˆ†åªèƒ½å±¬æ–¼ä¸€å€‹æ²»æ¨™ä¸æ²»æœ¬çš„è¾¦æ³•ï¼Œéš¨è‘—æ¥­å‹™é‡é€²ä¸€æ­¥åŠ å¤§ï¼Œè¶…éäº†å–®å€‹è¡¨èƒ½æ‰¿å—çš„é–¾å€¼ï¼Œé‚„æ˜¯æœƒå‡ºç¾æ€§èƒ½å•é¡Œã€‚ç„¶å¾Œå°±éœ€è¦æ°´å¹³åˆ†ç‰‡ä¾†é€²ä¸€æ­¥è™•ç†äº†ã€‚</p><div class=pgc-img><img alt=è¶…è©³ç´°sharding-jdbcåˆ†åº«åˆ†è¡¨å¯¦ç¾ï¼ŒåŠåŸç†åˆ†æ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d0c843f1033e4e00b52839371049731b><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>æ°´å¹³åˆ†ç‰‡</h1><p>æ°´å¹³åˆ†ç‰‡åˆç¨±æ©«å‘åˆ†ç‰‡ã€‚ç›¸å°æ–¼å‚ç›´åˆ†ç‰‡ï¼Œä¸æ ¹æ“šæ¥­å‹™é‚è¼¯åˆ†ï¼Œè€Œæ˜¯é€šéæŸå€‹ï¼ˆå¹¾å€‹ï¼‰å­—æ®µï¼Œæ ¹æ“šæŸç¨®è¦å‰‡å°‡æ•¸æ“šåˆ†æ•£åˆ°å¤šå€‹åº«æˆ–è¡¨ä¸­ï¼Œæ¯å€‹åˆ†ç‰‡åƒ…åŒ…å«æ•¸æ“šçš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚æ ¹æ“šç”¨æˆ¶ä¸»éµåˆ†ç‰‡ï¼Œå° 2 å–é¤˜ç‚º 0 çš„æ”¾å…¥ 0 åº«ï¼ˆæˆ–è¡¨ï¼‰ï¼Œç‚º 1 çš„æ”¾å…¥ 1 åº«ï¼ˆæˆ–è¡¨ï¼‰ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class=pgc-img><img alt=è¶…è©³ç´°sharding-jdbcåˆ†åº«åˆ†è¡¨å¯¦ç¾ï¼ŒåŠåŸç†åˆ†æ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e02b335c6e71439f86c639b20645f5e2><p class=pgc-img-caption></p></div><p>å¾ç†è«–ä¸Šä¾†èªªæ°´å¹³åˆ†ç‰‡æ˜¯å¯ä»¥ç„¡é™æ‹“å±•çš„ï¼Œå±¬æ–¼åˆ†åº«åˆ†è¡¨çš„æ¨™æº–è§£æ±ºè¾¦æ³•ã€‚ä½†æ˜¯æœ‰åˆ©å°±æœƒæœ‰å¼Šï¼Œé›–ç„¶åˆ†ç‰‡è§£æ±ºäº†æ€§èƒ½å•é¡Œï¼Œä½†æ˜¯åˆ†ä½ˆå¼çš„æ¶æ§‹é å¼•å…¥äº†æ–°çš„å•é¡Œã€‚é¦–å…ˆé¢å°çš„å°±æ˜¯æ•¸æ“šåº«çš„é‹ç¶­ç®¡ç†æ›´åŠ è¤‡é›œï¼Œä¹‹å‰åªæ˜¯å–®åº«æœ‰é™çš„å¹¾å¼µè¡¨ï¼Œç¾åœ¨æ•¸æ“šè¢«åˆ†æ•£åˆ°äº†å¤šåº«å¤šè¡¨ä¸­ï¼Œé›£ä»¥é‹ç¶­ã€‚å…¶æ¬¡å°±æ˜¯å¾ˆå¤šä¹‹å‰èƒ½å¤ æ­£å¸¸é‹è¡Œçš„ sql èªå¥ï¼Œåœ¨æ°´å¹³åˆ†ç‰‡å¾Œç„¡æ³•æ­£å¸¸é‹è¡Œï¼Œæ¯”å¦‚åˆ†é ã€æ’åºã€èšåˆåˆ†çµ„ç­‰æ“ä½œã€‚â€ƒæœ€å¾Œå°±æ˜¯åˆ†ä½ˆå¼äº‹å‹™ã€‚è·¨åº«äº‹å‹™ç›®å‰ä»»ç„¶æ˜¯ä¸€å€‹è¼ƒç‚ºæ£˜æ‰‹çš„äº‹æƒ…ã€‚ä¸»è¦æœ‰å…©ç¨®è§£æ±ºè¾¦æ³•ï¼šåŸºæ–¼ XA çš„åˆ†ä½ˆå¼äº‹å‹™å’Œæœ€çµ‚ä¸€è‡´æ€§çš„æŸ”æ€§äº‹å‹™ã€‚</p><h1 class=pgc-h-arrow-right>å¯¦æˆ°</h1><p>ç­è§£äº†åˆ†åº«åˆ†è¡¨çš„æ¦‚å¿µä¸‹é¢å°±æ˜¯å¯¦æˆ°äº†ï¼Œæœ€åˆæ˜¯è€ƒæ…®ä½¿ç”¨ Mycat çš„ï¼Œä½†æœ€çµ‚æ²’æœ‰é‡‡ç”¨çš„åŸå› ä¸»è¦æ˜¯ä»¥ä¸‹å…©é»ï¼š</p><li>Mycat è¼ƒç‚ºæ··äº‚ï¼Œæ²’æœ‰æ˜ç¢ºçš„é–‹ç™¼è¨ˆåŠƒå’Œå®Œå–„çš„æ–‡æª”ï¼ˆæ–‡æª”æ˜¯ä¸€æœ¬æ›¸ï¼‰ã€‚è€Œä¸”é¦–é çœ‹è‘—åƒæ˜¯ 90 å¹´ä»£çš„é é¢ã€‚</li><li>æœ€é—œéµçš„ä¸€é»ï¼ŒMycat å·²ç¶“å¾ˆä¹…æ²’æœ‰æ›´æ–°äº†ï¼Œè‡ªå¾ 17 å¹´ç™¼ä½ˆäº†æœ€å¾Œä¸€å€‹ç‰ˆæœ¬å°±å†æ²’æœ‰å‹•éœäº†ï¼ˆå®˜ç¶²èªªçš„æ˜¯ç±Œå‚™ 2.0 ä¸­ï¼‰ â€ƒâ€ƒåœ¨æŸ¥æ‰¾è³‡æ–™çš„éç¨‹ä¸­ç­è§£åˆ°å™¹å™¹çš„ä¸€æ¬¾é–‹æºåˆ†åº«åˆ†è¡¨ç”¢å“â€“sharding-jdbc.ç›®å‰å·²ç¶“é·ç§»åˆ° apache å­µåŒ–ä¸­å¿ƒï¼Œé¦–é ä¹Ÿç›¸æ‡‰çš„æ›äº†ï¼Œç¾åœ¨çš„å®˜ç¶²é¦–é ,åŒæ™‚ä¹Ÿæ”¹åäº†ï¼šShardingSphereã€‚ç›®å‰æœ€æ–°çš„ç™¼ä½ˆç‰ˆæœ¬æ˜¯ 3.1ï¼Œæœ‰ä»¥ä¸‹ä¸‰å€‹ç”¢å“ï¼š</li><li>Sharding-JDBCã€‚ShardingSphere å°±æ˜¯åœ¨æ­¤åŸºç¤ä¸Šç™¼å±•ä¾†çš„ã€‚åƒ…æ”¯æŒ javaï¼Œå±¬æ–¼è¼•é‡ç´š java æ¡†æ¶ï¼Œåœ¨ java çš„ JDBC å±¤æé«˜é¡å¤–æœå‹™ï¼Œç›¸ç•¶æ–¼åŠ å¼·ç‰ˆ JDBC é©…å‹•ï¼Œå› æ­¤å¯ä»¥èˆ‡ä»»ä½•ä¸Šå±¤ ORM æ¡†æ¶é…åˆä½¿ç”¨ï¼Œæ”¯æŒä»»æ„çš„æ•¸æ“šåº«é€£æ¥æ± ï¼Œæ”¯æŒä»»æ„å¯¦ç¾ JDBC è¦ç¯„çš„æ•¸æ“šåº«ã€‚æœ¬ç¯‡ä»£ç¢¼å°±æ˜¯åŸºæ–¼ Shardingâ€”JDBCã€‚</li><li>Sharding-Proxy:è·Ÿ MyCat ä¸€æ¨£å±¬æ–¼æ•¸æ“šåº«ä»£ç†ï¼Œå°ä»£ç¢¼é€æ˜ï¼Œç›®å‰åƒ…æ”¯æŒ MySQL æ•¸æ“šåº«ã€‚</li><li>Sharding-Sidecar:è¦åŠƒä¸­çš„ç”¢å“ï¼Œå®šä½ç‚ºé›²åŸç”Ÿæ•¸æ“šåº«ä»£ç†ã€‚â€ƒâ€ƒä¸‹é¢é–‹å§‹åŸºæ–¼ Spring-boot çš„å¯¦æˆ°ã€‚ç¸½é«”å¦‚ä¸‹ï¼š</li><li>åˆ†åº«åˆ†è¡¨ä½¿ç”¨</li><li>å»£æ’­è¡¨ä½¿ç”¨</li><li>é»˜èªåº«ä½¿ç”¨ ï¼ˆPSï¼šå®˜æ–¹ä¹Ÿæœ‰ä½¿ç”¨ç¤ºä¾‹ï¼šhttps://github.com/apache/incubator-shardingsphere-exampleï¼‰</li><h1 class=pgc-h-arrow-right>å»ºç«‹æ•¸æ“šè¡¨</h1><p>æœ¬ä¾‹ä¸­å…±ç”¨åˆ°ä¸‰å€‹åº«å››å€‹è¡¨,å¦‚ä¸‹ï¼š</p><ul><li>ds0:</li></ul><p>user(åˆ†åº«ä¸åˆ†è¡¨)</p><p>order(åˆ†åº«åˆ†è¡¨)</p><p>order(åˆ†åº«åˆ†è¡¨)</p><p>order_item(åˆ†åº«åˆ†è¡¨)</p><p>dictionary(å»£æ’­è¡¨ï¼Œä¸åˆ†åº«ä¸åˆ†è¡¨åœ¨ï¼Œåœ¨æ‰€æœ‰åº«ä¸­éƒ½æœ‰ç›¸åŒçš„æ•¸æ“š)</p><ul><li>ds1:(åŒä¸Š)</li></ul><p>user</p><p>order</p><p>order_item</p><p>dictionary</p><ul><li>ds2:(é»˜èªæ•¸æ“šåº«ï¼Œé™¤ä¸Šé¢çš„è¡¨å¤–å…¶ä»–çš„è¡¨)</li></ul><p>other_table</p><p>å»ºè¡¨èªå¥åœ¨æ­¤ï¼šhttps://github.com/FleyX/demo-project/tree/master/spring-boot/sjdemo/init</p><h1 class=pgc-h-arrow-right>POM ä¾è³´</h1><pre><code>&lt;!--é€™è£¡æœ‰å€‹å¤§å‘ï¼Œç‰ˆæœ¬éé«˜ä½¿ç”¨xaäº‹å‹™æœƒå ±éŒ¯æœªæŒ‡å®šæ•¸æ“šåº«ï¼Œåƒè¦‹:https://github.com/apache/incubator-shardingsphere/issues/1842--&gt;&lt;dependency&gt;         &lt;groupId&gt;mysql&lt;/groupId&gt;         &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;         &lt;version&gt;5.1.24&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;         &lt;groupId&gt;io.shardingsphere&lt;/groupId&gt;         &lt;artifactId&gt;sharding-jdbc-spring-boot-starter&lt;/artifactId&gt;         &lt;version&gt;3.1.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;          &lt;groupId&gt;com.alibaba&lt;/groupId&gt;          &lt;artifactId&gt;druid&lt;/artifactId&gt;          &lt;version&gt;1.1.14&lt;/version&gt;&lt;/dependency&gt;&lt;!--  --&gt;&lt;dependency&gt;          &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;          &lt;artifactId&gt;lombok&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt;          &lt;groupId&gt;com.alibaba&lt;/groupId&gt;          &lt;artifactId&gt;fastjson&lt;/artifactId&gt;          &lt;version&gt;1.2.56&lt;/version&gt;&lt;/dependency&gt;&lt;!--xaåˆ†ä½ˆå¼äº‹å‹™--&gt;&lt;dependency&gt;          &lt;groupId&gt;io.shardingsphere&lt;/groupId&gt;          &lt;artifactId&gt;sharding-transaction-2pc-xa&lt;/artifactId&gt;          &lt;version&gt;3.1.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt;          &lt;groupId&gt;io.shardingsphere&lt;/groupId&gt;          &lt;artifactId&gt;sharding-transaction-spring-boot-starter&lt;/artifactId&gt;             &lt;version&gt;3.1.0&lt;/version&gt;&lt;/dependency&gt;</code></pre><h1 class=pgc-h-arrow-right>yaml é…ç½®</h1><pre><code># application.ymlspring:  profiles:    active: shardingmybatis:  mapper-locations: classpath:mapper/*.xml  type-aliases-package: com.fanxb.sjdemo.entity  # é–‹å•Ÿmybatis sqlæ‰“å°  configuration:    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl</code></pre><p>é€™è£¡æ˜¯é—œéµï¼Œåˆ†åº«åˆ†è¡¨é…ç½®ã€‚éœ€è¦å°‡æ‰€æœ‰çš„è¡¨åˆ—å‡ºï¼ˆåŒ…å«å»£æ’­è¡¨ï¼‰ï¼Œæœªåˆ—å‡ºçš„è¡¨å°‡ä½¿ç”¨é»˜èªåº«ã€‚éœ€çµ¦æ‰€æœ‰é…ç½®äº†åˆ†åº«åˆ†è¡¨çš„æ•¸æ“šè¡¨åŠ ä¸Šä¸€å€‹ userId å­—æ®µï¼Œå› ç‚ºè¦æ ¹æ“š userId ä¾†åˆ¤æ–·å¯«å…¥åˆ°å“ªå€‹åº«ä¸­ï¼Œå¦å‰‡è¿´å‘æ‰€æœ‰åº«æ’å…¥ã€‚</p><pre><code>sharding:  jdbc:    datasource:      # é…ç½®æ•¸æ“šæº      names: ds0,ds1,ds2      ds0:        type: com.alibaba.druid.pool.DruidDataSource        driver-class-name: com.mysql.jdbc.Driver        url: jdbc:mysql://10.82.27.177:3306/ds0        username: root        password: 123456      ds1:        type: com.alibaba.druid.pool.DruidDataSource        driver-class-name: com.mysql.jdbc.Driver        url: jdbc:mysql://10.82.27.177:3306/ds1        username: root        password: 123456      ds2:        type: com.alibaba.druid.pool.DruidDataSource        driver-class-name: com.mysql.jdbc.Driver        url: jdbc:mysql://10.82.27.177:3306/ds2        username: root        password: 123456    config:      sharding:        # é»˜èªæ•¸æ“šæºï¼Œå¯ä»¥å°‡ä¸åˆ†åº«åˆ†è¡¨çš„æ•¸æ“šè¡¨æ”¾åœ¨é€™è£¡(æ­¤è™•çš„è¡¨éœ€èˆ‡å·²ç¶“åˆ†åº«åˆ†è¡¨çš„è¡¨å®Œå…¨æ²’æœ‰é—œè¯ï¼Œä¸æœƒç”¢ç”Ÿè¯è¡¨æŸ¥è©¢æ“ä½œï¼Œå› ç‚ºè·¨åº«é€£è¡¨æŸ¥è©¢æ˜¯æ²’è¾¦æ³•å¯¦ç¾çš„)        # 3.1.0ç‰ˆæœ¬ä¸­dqlæŸ¥è©¢å­˜åœ¨bugï¼Œä¸ä½¿ç”¨é»˜èªåº«.æœƒåœ¨ä¸‹å€‹ç‰ˆæœ¬ä¸­ä¿®å¾©        default-data-source-name: ds2        # é»˜èªåˆ†åº«ç­–ç•¥,æ ¹æ“šuserIdå°2å–é¤˜ç¢ºå®šåº«        default-database-strategy:          inline:            sharding-column: userId            algorithm-expression: ds$-&gt;{userId % 2}        # é…ç½®è¡¨ç­–ç•¥        tables:          # å…¬å…±è¡¨(æ¯”å¦‚å­—å…¸è¡¨,è§’è‰²è¡¨ï¼Œæ¬Šé™è¡¨ç­‰),ä¸åˆ†åº«åˆ†è¡¨,æ•¸æ“šå°‡ç™¼é€åˆ°æ‰€æœ‰åº«ä¸­,æ–¹ä¾¿è¯è¡¨æŸ¥è©¢          dictionary:            # é…ç½®ä¸»éµï¼Œä»¥ä¾¿sharding-jdbcç”Ÿæˆä¸»éµ            key-generator-column-name: dictionaryId            actual-data-nodes: ds$-&gt;{0..1}.dictionary          # user å·²ç¶“æ ¹æ“šuserIdåˆ†åº«ï¼Œå› æ­¤userè¡¨ä¸é€²è¡Œåˆ†è¡¨          user:            key-generator-column-name: userId            actual-data-nodes: ds$-&gt;{0..1}.user          order:            key-generator-column-name: orderId            actual-data-nodes: ds$-&gt;{0..1}.order$-&gt;{0..1}            table-strategy:              inline:                # è¨­ç½®åˆ†ç‰‡éµï¼Œç›¸åŒåˆ†ç‰‡éµçš„é€£è¡¨æŸ¥è©¢ä¸æœƒå‡ºç¾ç¬›å¡å…’ç©                sharding-column: orderId                # è¨­ç½®åˆ†è¡¨è¦å‰‡,æ ¹æ“šè¨‚å–®idå°2å–é¤˜åˆ†å…©å€‹è¡¨                algorithm-expression: order$-&gt;{orderId%2}          order_item:            key-generator-column-name: orderItemId            actual-data-nodes: ds$-&gt;{0..1}.order_item$-&gt;{0..1}            table-strategy:              inline:                sharding-column: orderId                # è¨­ç½®åˆ†è¡¨è¦å‰‡,æ ¹æ“šè¨‚å–®idå°2å–é¤˜åˆ†å…©å€‹è¡¨                algorithm-expression: order_item$-&gt;{orderId%2}      # æ‰“å°sqlè§£æéç¨‹      props:        sql.show: true</code></pre><p>åˆ°é€™è£¡å°±ç®—é…ç½®å®Œç•¢äº†ï¼Œå‰©ä¸‹çš„éç¨‹å’Œæ™®é€š spring boot+mybatis é …ç›®ä¸€æ¨£ï¼Œä¸å†è´…è¿°ã€‚</p><p>äº‹å‹™è™•ç†</p><p>â€ƒâ€ƒé»˜èªä½¿ç”¨çš„æ˜¯æœ¬åœ°äº‹å‹™ï¼Œä½†æ˜¯å¦‚æœæ¥­å‹™é‚è¼¯æ‹‹å‡ºéŒ¯èª¤ï¼Œé‚„æ˜¯æœƒå°æ‰€æœ‰çš„åº«é€²è¡Œå›é€€æ“ä½œçš„ï¼Œåªæ˜¯å¦‚æœå‡ºç¾æ–·é›»æ–·ç¶²çš„æƒ…æ³æœƒå°è‡´æ•¸æ“šä¸ä¸€è‡´ã€‚è©³è¦‹ï¼šå®˜æ–¹æ–‡æª”. å¯é€šé@ShardingTransactionType(TransactionType.XA)è¨»è§£ï¼Œåˆ‡æ›ç‚º XA äº‹å‹™æˆ–è€…æŸ”æ€§äº‹å‹™ï¼ˆç¤ºä¾‹ä¸­æœªé…ç½®ï¼Œåˆ‡æ›ç‚ºæŸ”æ€§äº‹å‹™æœƒå ±éŒ¯ï¼‰ã€‚</p><h2 class=pgc-h-arrow-right>æ¸¬è©¦</h2><p>é‹è¡Œcom.fanxb.sjdemo.MainTestæŸ¥çœ‹æ¸¬è©¦çµæœã€‚</p><p><br></p><blockquote><p>å°ˆæ³¨æ–¼æŠ€è¡“ç†±é»å¤§æ•¸æ“šï¼Œäººå·¥æ™ºèƒ½ï¼ŒJAVAã€Pythonã€ C ã€GOã€Javascriptç­‰èªè¨€æœ€æ–°å‰è¨€æŠ€è¡“ï¼ŒåŠæ¥­å‹™ç—›é»å•é¡Œåˆ†æï¼Œè«‹é—œæ³¨ã€ç·¨ç¨‹æˆ‘æœ€æ‡‚ã€‘å…±åŒäº¤æµå­¸ç¿’ã€‚</p></blockquote></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>è¶…è©³ç´°</a></li><li><a>sharding</a></li><li><a>jdbc</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/a62a3dde.html alt=è¶…è©³ç´°æ’ç·šæ•™ç¨‹ï¼Œä¸æœƒæ’ç·šçš„å¿«ä¾†å­¸ç¿’è‡¨æ‘¹ï¼Œå­¸æœƒæ’ç·šå¾ˆç°¡å–®ï¼Œæ”¶è— class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ea4c696b1fc84db7bbf4b14ec19001fd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a62a3dde.html title=è¶…è©³ç´°æ’ç·šæ•™ç¨‹ï¼Œä¸æœƒæ’ç·šçš„å¿«ä¾†å­¸ç¿’è‡¨æ‘¹ï¼Œå­¸æœƒæ’ç·šå¾ˆç°¡å–®ï¼Œæ”¶è—>è¶…è©³ç´°æ’ç·šæ•™ç¨‹ï¼Œä¸æœƒæ’ç·šçš„å¿«ä¾†å­¸ç¿’è‡¨æ‘¹ï¼Œå­¸æœƒæ’ç·šå¾ˆç°¡å–®ï¼Œæ”¶è—</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a93ac160.html alt=è¶…è©³ç´°çš„ç´ æé ­åƒçµæ§‹è§£æ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/153397416564989f4872ceb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a93ac160.html title=è¶…è©³ç´°çš„ç´ æé ­åƒçµæ§‹è§£æ>è¶…è©³ç´°çš„ç´ æé ­åƒçµæ§‹è§£æ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7b7d17b0.html alt=ï¼ˆä¹¾è²¨ï¼‰è¶…è©³ç´°çš„æ°´å½©ç¹ªç•«æ•™ç¨‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/dff999e4a4ba4847acecfb6ce2153739 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7b7d17b0.html title=ï¼ˆä¹¾è²¨ï¼‰è¶…è©³ç´°çš„æ°´å½©ç¹ªç•«æ•™ç¨‹>ï¼ˆä¹¾è²¨ï¼‰è¶…è©³ç´°çš„æ°´å½©ç¹ªç•«æ•™ç¨‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/74e62337.html alt=æ•™ä½ å­¸é‰¤é‡ï¼šè¶…è©³ç´°çš„é‰¤é‡æ›ç·šæ–¹æ³• class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/593f0003a21cfa1fab35 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/74e62337.html title=æ•™ä½ å­¸é‰¤é‡ï¼šè¶…è©³ç´°çš„é‰¤é‡æ›ç·šæ–¹æ³•>æ•™ä½ å­¸é‰¤é‡ï¼šè¶…è©³ç´°çš„é‰¤é‡æ›ç·šæ–¹æ³•</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9d6c7107.html alt=ã€è¶…è©³ç´°ã€‘ç¶œåˆä½ˆç·šå¸¸ç”¨è¡“èª class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ef74026782434fedbd769ebea5e7b6d3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9d6c7107.html title=ã€è¶…è©³ç´°ã€‘ç¶œåˆä½ˆç·šå¸¸ç”¨è¡“èª>ã€è¶…è©³ç´°ã€‘ç¶œåˆä½ˆç·šå¸¸ç”¨è¡“èª</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6e1619f8.html alt=æ­å§†å®šå¾‹ï½œè¶…è©³ç´°çš„çŸ¥è­˜é»æ’¥å’Œç¿’é¡Œæ¼”ç·´ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1543798018270d304f1be33 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6e1619f8.html title=æ­å§†å®šå¾‹ï½œè¶…è©³ç´°çš„çŸ¥è­˜é»æ’¥å’Œç¿’é¡Œæ¼”ç·´>æ­å§†å®šå¾‹ï½œè¶…è©³ç´°çš„çŸ¥è­˜é»æ’¥å’Œç¿’é¡Œæ¼”ç·´</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c971ce30.html alt=è¶…è©³ç´°ï¼æ­å§†å®šå¾‹çš„æ˜“éŒ¯æ˜“æ··å°ˆé¡Œè¬›è§£+å°ˆé¡Œè¨“ç·´ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3091862292d74e0fa3e5458e82bffaca style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c971ce30.html title=è¶…è©³ç´°ï¼æ­å§†å®šå¾‹çš„æ˜“éŒ¯æ˜“æ··å°ˆé¡Œè¬›è§£+å°ˆé¡Œè¨“ç·´>è¶…è©³ç´°ï¼æ­å§†å®šå¾‹çš„æ˜“éŒ¯æ˜“æ··å°ˆé¡Œè¬›è§£+å°ˆé¡Œè¨“ç·´</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a5bfc206.html alt=è¶…è©³ç´°â”‚é–‹é—œé›»æºé«˜é »è®Šå£“å™¨è£½ä½œå…¨éç¨‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/3129ee862f2f4ea99943d3e6e6db5f10 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a5bfc206.html title=è¶…è©³ç´°â”‚é–‹é—œé›»æºé«˜é »è®Šå£“å™¨è£½ä½œå…¨éç¨‹>è¶…è©³ç´°â”‚é–‹é—œé›»æºé«˜é »è®Šå£“å™¨è£½ä½œå…¨éç¨‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/445e93fb.html alt=è¶…è©³ç´°ã€Œæ°£ç®¡æ’ç®¡ã€æ­¥é©Ÿæ•™ç¨‹ï¼Œæ–°æ‰‹å…¥é–€å°±çœ‹é€™å€‹ï¼ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7922456dd2e547d69cb8444a4e20d023 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/445e93fb.html title=è¶…è©³ç´°ã€Œæ°£ç®¡æ’ç®¡ã€æ­¥é©Ÿæ•™ç¨‹ï¼Œæ–°æ‰‹å…¥é–€å°±çœ‹é€™å€‹ï¼>è¶…è©³ç´°ã€Œæ°£ç®¡æ’ç®¡ã€æ­¥é©Ÿæ•™ç¨‹ï¼Œæ–°æ‰‹å…¥é–€å°±çœ‹é€™å€‹ï¼</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0cb2d685.html alt=æ‘©æ‰˜è»Šå¼•æ“æ‹†è£ï¼Œè¶…è©³ç´°DIYè¨˜éŒ„æ±½ç¼¸é ­çµ„è£ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/dfdb27e5636b4bd18b76fdb430815375 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0cb2d685.html title=æ‘©æ‰˜è»Šå¼•æ“æ‹†è£ï¼Œè¶…è©³ç´°DIYè¨˜éŒ„æ±½ç¼¸é ­çµ„è£>æ‘©æ‰˜è»Šå¼•æ“æ‹†è£ï¼Œè¶…è©³ç´°DIYè¨˜éŒ„æ±½ç¼¸é ­çµ„è£</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/79fa408e.html alt=è¶…è©³ç´°çš„å¸¸ç”¨æœƒè¨ˆåˆ†éŒ„ï¼Œå»ºè­°æ”¶è— class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1b4bf8b685024465ac8f03c7f51119dc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/79fa408e.html title=è¶…è©³ç´°çš„å¸¸ç”¨æœƒè¨ˆåˆ†éŒ„ï¼Œå»ºè­°æ”¶è—>è¶…è©³ç´°çš„å¸¸ç”¨æœƒè¨ˆåˆ†éŒ„ï¼Œå»ºè­°æ”¶è—</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fa573f50.html alt=è¶…è©³ç´°çš„ç„Šæ¥æ“ä½œæ­¥é©Ÿï¼ˆç„Šæ¥åŸ¹è¨“æ•™å­¸æ­¥é©Ÿï¼‰ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/d2fc5ff13fee46708cad937a82b92a5c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fa573f50.html title=è¶…è©³ç´°çš„ç„Šæ¥æ“ä½œæ­¥é©Ÿï¼ˆç„Šæ¥åŸ¹è¨“æ•™å­¸æ­¥é©Ÿï¼‰>è¶…è©³ç´°çš„ç„Šæ¥æ“ä½œæ­¥é©Ÿï¼ˆç„Šæ¥åŸ¹è¨“æ•™å­¸æ­¥é©Ÿï¼‰</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/2e789f3f.html alt=è¶…è©³ç´°ï¼åœ¨ç€‹é™½å†ä¹Ÿä¸æ€•è¿·è·¯äº†ï¼Œé€™æ¢å¾®ä¿¡æ¯”åœ°åœ–é‚„ç®¡ç”¨ï¼ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/65c7000dd2a9b2176289 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/2e789f3f.html title=è¶…è©³ç´°ï¼åœ¨ç€‹é™½å†ä¹Ÿä¸æ€•è¿·è·¯äº†ï¼Œé€™æ¢å¾®ä¿¡æ¯”åœ°åœ–é‚„ç®¡ç”¨ï¼>è¶…è©³ç´°ï¼åœ¨ç€‹é™½å†ä¹Ÿä¸æ€•è¿·è·¯äº†ï¼Œé€™æ¢å¾®ä¿¡æ¯”åœ°åœ–é‚„ç®¡ç”¨ï¼</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/8b3fd85f.html alt=ä¸€ä»½è¶…è©³ç´°çš„æ®ºèŸ²åŠ‘è³‡æ–™ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1531455292862a06bc560bc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/8b3fd85f.html title=ä¸€ä»½è¶…è©³ç´°çš„æ®ºèŸ²åŠ‘è³‡æ–™>ä¸€ä»½è¶…è©³ç´°çš„æ®ºèŸ²åŠ‘è³‡æ–™</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/919b5c59.html alt=è¶…è©³ç´°çš„é‹¼ç­‹ç›´èºç´‹é€£æ¥ä¸‰ç¶­æŠ€è¡“äº¤åº• class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/2e17168258e74865b86d9ded650b9860 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/919b5c59.html title=è¶…è©³ç´°çš„é‹¼ç­‹ç›´èºç´‹é€£æ¥ä¸‰ç¶­æŠ€è¡“äº¤åº•>è¶…è©³ç´°çš„é‹¼ç­‹ç›´èºç´‹é€£æ¥ä¸‰ç¶­æŠ€è¡“äº¤åº•</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>