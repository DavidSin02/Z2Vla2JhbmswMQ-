<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>PHP 線程，進程和併發 | 极客快訊</title><meta property="og:title" content="PHP 線程，進程和併發 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/7a700a857098411d884a928d6b5f5e01"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/77f5407e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/77f5407e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/77f5407e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/77f5407e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/77f5407e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/77f5407e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/77f5407e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/77f5407e.html><meta property="article:published_time" content="2020-11-14T21:06:37+08:00"><meta property="article:modified_time" content="2020-11-14T21:06:37+08:00"><meta name=Keywords content><meta name=description content="PHP 線程，進程和併發"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/77f5407e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>PHP 線程，進程和併發</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>進程</p><p>進程是什麼？進程是正在執行的程序；進程是正在計算機上執行的程序實例；進程是能分配給處理器並由處理器執行的實體。 進程一般會包括指令集和系統資源集，這裡的指令集是指程序代碼，這裡的系統資源集是指I/O、CPU、內存等。 綜合起來，我們也可以理解進程是具有一定獨立功能的程序在關於某個數據集合上的一次運行活動， 進程是系統進行資源分配和調度的一個獨立單位。</p><p>在進程執行時，進程都可以被唯一的表示，由以下一些元素組成：</p><p>進程描述符：進程的唯一標識符，用來和其它進程區分。在Linux中叫進程ID，在系統調用fork期間生成，只是我們通過getpid返回的不是其pid字段，而是其線程組號tgid。</p><p>進程狀態：我們常說的掛起、運行等狀態，其表示的是當前的狀態。</p><p>優先級：進程間的執行調度相關，相對於其它進程而言。</p><p>程序計數器：程序中即將被執行的下一條指令的地址，該地址是內核術中或用戶內存空間中的內存地址。</p><p>內存指針：包括程序代碼和進程相關數據的指針，還有和其它進程共享內存塊的指針。</p><p>上下文數據：進程執行時處理器的寄存器的數據。</p><p>I/O狀態信息：包括顯式的I/O請求、分配給進程的I/O設備等</p><p>記賬信息：可能包括處理器時間總和、使用的時鐘數總和、時間限制等</p><p>以上的這些元素都會放在一個叫做進程控制塊的數據結構中。進程控制塊是操作系統能夠支持多進程和提供多處理的結構。 當操作系統做進程切換時，它會執行兩步操作，一是中斷當前處理器中的進程，二是執行下一個進程。 不管是中斷還是執行，進程控制塊中的程序計數器、上下文數據和進程狀態都會發生變化。 當進程中斷時，操作系統會把程序計數器和處理器寄存器（對應進程控制塊中的上下文數據）保存到進程控制塊中的相應位置， 進程狀態也會有所變化，可能進入阻塞狀態，也有可能進入就緒態。 當執行下一個進程時，操作系統按規則將下一個進程設置為運行態，並加載即將要執行進程的程序上下文數據和程序計數器等。</p><p>線程</p><p>進程有兩個特性部分：資源所有權和調度執行。 資源所有權是指進程包括了進程運行所需要的內存空間、I/O等資源。 調度執行是指進程執行過程中間的執行路徑，或者說程序的指令執行流。 這兩個特性部分是可以分開的，分開後，擁有資料所有權的通常稱為進程，擁有執行代碼的可分派部分的被稱之為線程或輕量級進程。</p><p>線程有“執行的線索”的意思在裡面，而進程在多線程環境中被定義為資源所有者，其還是會存儲進程的進程控制塊。 線程的結構與進程不同，每個線程包括：</p><p>線程狀態： 線程當前的狀態。</p><p>一個執行棧</p><p>私有的數據區： 用於每個線程局部變量的靜態存儲空間</p><p>寄存器集： 存儲處理器的一些狀態</p><p>每個進程都有一個進程控制塊和用戶地址空間，每個線程都有一個獨立的棧和獨立的控制塊，都有自己一個獨立執行上下文。 其結構如圖8.1所示。</p><div class=pgc-img><img alt="PHP 線程，進程和併發" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7a700a857098411d884a928d6b5f5e01><p class=pgc-img-caption></p></div><p>圖8.1 進程模型圖</p><p>線程在執行過程中與進程有一些不同。每個獨立的線程有一個程序運行的入口、順序執行序列和程序的出口。 但是線程不能夠獨立執行，必須依存在於進程之中，由進程提供多個線程執行控制。 從邏輯角度來看，多線程的意義在於一個進程中，有多個執行部分可以同時執行。 此時，進程本身不是基本運行單位，而是線程的容器。</p><p>線程較之進程，其優勢在於一個快，不管是創建新的線程還是終止一個線程；不管是線程間的切換還是線程間共享數據或通信，其速度與進程相比都有較大的優勢。</p><p>併發及並行</p><p>併發又稱共行，是指能處理多個同時性活動的能力，併發事件之間不一定要同一時刻發生。 比如，現代計算機系統可在同一段時間內以進程的形式將多個程序加載到存儲器中，並藉由處理器的時分複用， 以在一個處理器上表現出同時運行的感覺。</p><p>並行是指同時發生的兩個併發事件，具有併發的含義，而併發則不一定並行。</p><p>併發和並行的區別就是一個處理器同時處理多個任務和多個處理器或者是多核的處理器同時處理多個不同的任務。 前者是邏輯上的同時發生（simultaneous），而後者是物理上的同時發生。</p><p>PHP的各種併發模型</p><p>既然有兩種模型，那麼PHP使用的是哪一種呢？答案是都支持，也就是說PHP支持多線程的模型， 在多線程情況下通常要解決資源共享和隔離的問題。PHP本身是線程安全的。</p><p>具體來說是那種模型需要看使用的是哪個SAPI，比如說在Apache中，那麼就可能使用多線程模型， 也可能使用多進程模型。而php-fpm使用的就是多進程模型。</p><p>目前比較推薦的方式是使用php-fpm的模型，因為這個模型對於PHP來說有諸多的優勢：</p><p>內存釋放簡單，使用多進程模型時進程可以容易通過退出的方式來釋放內存， 由於PHP有非常多的擴展，稍有不慎就可能導致內存洩露，fpm通過進程退出方式 簡單除暴的解決了問題。</p><p>容災能力強，同樣的問題，擴展或者php可能會出現段錯誤，如果是單進程多線程模型， 那麼整個PHP就掛掉了。這會影響服務，多進程的話，某個進程死掉了也不會影響整體的服務。</p><p>多進程有多進程的優勢，多線程也有多線程的優勢，比如HHVM它選擇的是多線程模型。 多線程模型最大的好處是信息共享和通信方便，因為在同一個進程空間內，可以直接使用指針。</p><p>比如opcode cache工具，在PHP裡，apc以及opcache等等使用的是共享內存來共享opcode， 那麼在HHVM中則不需要走共享內存，共享內存還有個問題是存儲複雜的數據結構不方便， 因為指針的問題，多線程情況下C/C++中的數據結構是可以共享的。這對效率提升也是有幫助的。</p><p>多進程和多線程還有一個明顯的模型區別：在處理請求時的邏輯。</p><p>在多進程情況下，由於跨進程是不好傳遞fd連接的。那麼多進程通常採用在父進程中listen()， 然後各個子進程accept()的方式來實現負載均衡。這樣的模型下可能會有驚群的問題。</p><p>而多線程模型下，可以採用一個獨立線程接受請求然後派發到各個worker線程的方式。</p><p>鏈接：https://www.jianshu.com/p/2b3e2a065aa3</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>PHP</a></li><li><a>線程</a></li><li><a>進程</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/4c41a9dd.html alt=一文讀懂什麼是進程、線程、協程（建議收藏） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/6ba8b142-925e-418e-b20c-71e8f3c20663 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4c41a9dd.html title=一文讀懂什麼是進程、線程、協程（建議收藏）>一文讀懂什麼是進程、線程、協程（建議收藏）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ab6b08d6.html alt=併發最基本要理解的進程、線程、協程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3f756a3627164d4f93883dd7c0e0bac5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ab6b08d6.html title=併發最基本要理解的進程、線程、協程>併發最基本要理解的進程、線程、協程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/79e23cb7.html alt=如何理解：程序、進程、線程、併發、並行、高併發？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/b101e22357854a56abf29c0745b5d9c9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/79e23cb7.html title=如何理解：程序、進程、線程、併發、並行、高併發？>如何理解：程序、進程、線程、併發、並行、高併發？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cf2fb099.html alt=看一遍就懂進程線程、同步異步、阻塞非阻塞、併發並（建議收藏） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/12861a08-8f52-48c2-9b25-46df51894677 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cf2fb099.html title=看一遍就懂進程線程、同步異步、阻塞非阻塞、併發並（建議收藏）>看一遍就懂進程線程、同步異步、阻塞非阻塞、併發並（建議收藏）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c40a49b9.html alt=線程與進程的區別以及對多線程併發的理解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/813488ac38be43b29140e4917ff1e0b5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c40a49b9.html title=線程與進程的區別以及對多線程併發的理解>線程與進程的區別以及對多線程併發的理解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3f2bf674.html alt=進程、線程、協程的選擇與文件併發操作 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/622e63700f544942809d9a374757630e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3f2bf674.html title=進程、線程、協程的選擇與文件併發操作>進程、線程、協程的選擇與文件併發操作</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5fc01cfc.html alt=進程、線程的概念、區別和聯繫；併發、並行概念、區別和聯繫 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5fc01cfc.html title=進程、線程的概念、區別和聯繫；併發、並行概念、區別和聯繫>進程、線程的概念、區別和聯繫；併發、並行概念、區別和聯繫</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6b8a6681.html alt=進程與線程的區別和併發編程要素 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6b8a6681.html title=進程與線程的區別和併發編程要素>進程與線程的區別和併發編程要素</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d0b69a5b.html alt=高併發和高性能系統中進程、線程、協程、隊列（如何調度的） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f41e7ed497b44b618a1df64c6aaa2295 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d0b69a5b.html title=高併發和高性能系統中進程、線程、協程、隊列（如何調度的）>高併發和高性能系統中進程、線程、協程、隊列（如何調度的）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b97e222b.html alt=進程、線程、並行與併發 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5e04293de8fb49f19388e78a9812cce4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b97e222b.html title=進程、線程、並行與併發>進程、線程、並行與併發</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9911d0f.html alt=程序，進程，線程與併發和並行設計實現 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/165d54ca-9361-4365-9d4b-12a56bebfc33 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9911d0f.html title=程序，進程，線程與併發和並行設計實現>程序，進程，線程與併發和並行設計實現</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/399bf08.html alt="線程，進程，協程， 併發，並行，同步，異步概念解析" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/41ca5e6e9b914e628478b8262ae96e43 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/399bf08.html title="線程，進程，協程， 併發，並行，同步，異步概念解析">線程，進程，協程， 併發，並行，同步，異步概念解析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b3994691.html alt=世界發展進程中的耀眼篇章 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RCLmM9dF1KnwoT style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b3994691.html title=世界發展進程中的耀眼篇章>世界發展進程中的耀眼篇章</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a198e2d8.html alt="PHP 超級全局變量—教程大全" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/39b600034ed511258ffb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a198e2d8.html title="PHP 超級全局變量—教程大全">PHP 超級全局變量—教程大全</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f7cd733c.html alt=PHP基礎及實例 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/786c159d-c845-451f-b199-fbd90c81925a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f7cd733c.html title=PHP基礎及實例>PHP基礎及實例</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>