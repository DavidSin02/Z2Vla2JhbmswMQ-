<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>彩票數據收集！學會利用python庫爬取雙色球歷史數據 | 极客快訊</title><meta property="og:title" content="彩票數據收集！學會利用python庫爬取雙色球歷史數據 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/1539455922015041c78142e"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/791b724.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/791b724.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/791b724.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/791b724.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/791b724.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/791b724.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/791b724.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/791b724.html><meta property="article:published_time" content="2020-10-29T20:59:17+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:17+08:00"><meta name=Keywords content><meta name=description content="彩票數據收集！學會利用python庫爬取雙色球歷史數據"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/791b724.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>彩票數據收集！學會利用python庫爬取雙色球歷史數據</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1539455922015041c78142e><p class=pgc-img-caption></p></div><hr><h1><strong>閱讀建議</strong></h1><p>你可能感興趣的關鍵詞：python3、爬蟲、彩票數據</p><p>閱讀時長：15分鐘</p><p>建議閱讀方式：閱讀+收藏+動手實踐</p><hr><h1><strong>前言</strong></h1><p>首先聲明，這個爬取的意義不會太大，因為目前很多網站都有下載按鈕可以直接下載從2003-02-23到最新的全部數據：</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15394536518334ac447d602><p class=pgc-img-caption></p></div><p>但是通過這次爬取，你可以熟悉python3、網頁解析庫的使用、正則的使用，以及linux相關的知識，當以後有爬取其他數據需求的時候，就能夠用得上啦~</p><p>在我的博客文章《用Python爬取雙色球開獎信息（升級版）》中介紹了簡單的urllib+re正則的方式來提取每天的雙色球數據，當然這是有用的，雖然數據量少，但是可以用來做一些比如“<strong>買了股票自動比對中獎情況然後推送</strong>”這一類程序或網頁。</p><p>但這種爬取方式仍然存在問題：容易被網站的反爬蟲或者反作弊發現。也就是說，你爬取這些接口，那邊的服務器系統會有日誌的，並且有自動處理程序，甚至會有機器學習的程序。儘管這種數據沒有什麼敏感性，根本不會來封你的IP，不過也要養成良好的爬蟲習慣，至少——在爬取的時候加個header，不要被一句簡單的awk命令就給篩選出來安排得明明白白了（我在實習的時候經常一句awk就篩出那些刷金幣刷花接口的萌新同學，儘管大佬們提供了svm機器學習模型來自動處理）。</p><p>注意到有的網站提供了大量的歷史開獎數據，比如500彩票網雙色球歷史數據、中彩網雙色球歷史數據，我們可以都爬下來，然後自行對比使用，一個可能的用途是<strong>用機器學習去預測走勢</strong>（雖然國內的雙色球……em……每天停售後兩個小時才開獎……），用來玩玩吧。</p><h1><strong>運行環境</strong></h1><p>解釋器：python3.5.2</p><p>IDE：Pycharm 2016.3.2</p><p>瀏覽器：Chrome</p><h1><strong>爬取500雙色球的歷史數據</strong></h1><p>500彩票網的網頁比較規矩，沒有什麼花裡胡哨的東西。</p><p><strong>1、進入網頁，查看接口</strong></p><p>用Chrome瀏覽器進入500雙色球歷史數據網頁（http://datachart.500.com/ssq/history/history.shtml），然後右鍵→檢查，翻到Network→XHR的一欄。</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1539454105917f03193d169><p class=pgc-img-caption></p></div><p>網頁上隨便選擇期數，點擊查看，就能看到網頁異步獲取數據的接口了：</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1539454175711b2b4e18575><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1539454175889cf9c408562><p class=pgc-img-caption></p></div><p>點進去看一看，非常簡單的get請求：</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/153945417589124579ba072><p class=pgc-img-caption></p></div><p>翻看一下Response，竟然直接返回的HTML而不是JSON……</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1539454175520c2857638cd><p class=pgc-img-caption></p></div><p><strong>2、分析數據</strong></p><p>這就比較煩了，需要解析html了，首先分析一下彩票數據html的數據結構：</p><pre>&lt;tbody id="tdata"&gt;	&lt;tr class="t_tr1"&gt;		&lt;!--&lt;td&gt;2&lt;/td&gt;--&gt;		&lt;td&gt;18092&lt;/td&gt;		&lt;td class="t_cfont2"&gt;06&lt;/td&gt;		&lt;td class="t_cfont2"&gt;10&lt;/td&gt;		&lt;td class="t_cfont2"&gt;16&lt;/td&gt;		&lt;td class="t_cfont2"&gt;19&lt;/td&gt;		&lt;td class="t_cfont2"&gt;24&lt;/td&gt;		&lt;td class="t_cfont2"&gt;33&lt;/td&gt;		&lt;td class="t_cfont4"&gt;16&lt;/td&gt;		&lt;td class="t_cfont4"&gt; &lt;/td&gt;		&lt;td&gt;921,043,817&lt;/td&gt;		&lt;td&gt;1&lt;/td&gt;		&lt;td&gt;10,000,000&lt;/td&gt;		&lt;td&gt;95&lt;/td&gt;		&lt;td&gt;269,198&lt;/td&gt;		&lt;td&gt;318,819,890&lt;/td&gt;		&lt;td&gt;2018-08-09&lt;/td&gt;	&lt;/tr&gt;	&lt;tr class="t_tr1"&gt;		&lt;!--&lt;td&gt;2&lt;/td&gt;--&gt;		&lt;td&gt;18091&lt;/td&gt;		&lt;td class="t_cfont2"&gt;06&lt;/td&gt;		&lt;td class="t_cfont2"&gt;11&lt;/td&gt;		&lt;td class="t_cfont2"&gt;13&lt;/td&gt;		&lt;td class="t_cfont2"&gt;17&lt;/td&gt;		&lt;td class="t_cfont2"&gt;25&lt;/td&gt;		&lt;td class="t_cfont2"&gt;32&lt;/td&gt;		&lt;td class="t_cfont4"&gt;07&lt;/td&gt;		&lt;td class="t_cfont4"&gt; &lt;/td&gt;		&lt;td&gt;854,322,188&lt;/td&gt;		&lt;td&gt;4&lt;/td&gt;		&lt;td&gt;8,999,907&lt;/td&gt;		&lt;td&gt;81&lt;/td&gt;		&lt;td&gt;246,907&lt;/td&gt;		&lt;td&gt;315,853,082&lt;/td&gt;		&lt;td&gt;2018-08-07&lt;/td&gt;	&lt;/tr&gt;&lt;/tbody&gt;</pre><p>非常完整標準的表格結構，這裡要注意幾個細節：</p><p>（1）中間有一欄是&nbsp，也就是空格，這一欄的體現是一個名為<strong>快樂星期天</strong>的屬性。快樂星期天是指開出兩個藍球，第一個正常開，該中啥中啥；第二個藍號中了，並且前面紅號任意中5個，就能得到固定的3000元獎金。</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1539454175522608963f460><p class=pgc-img-caption></p></div><p>這裡由於只是一個活動，不清楚以後是否會用，而且快樂星期天數據格式有：空格（&nbsp，unicode顯示為a0）；0；1個數字；3個逗號分隔的數字，因此可以考慮把這個屬性變為用“-”連接的字符串，如果以後有需要可以自行處理，如果不需要可以直接略過整個屬性。</p><p>（2）數字採用了銀行的那種逗號分隔的格式，這是方便瀏覽的格式；同時我們想做的也是用逗號分隔，這會產生歧義，並且我們需要的是存儲使用而不是觀看，所以需要在採集的時候把逗號去掉。</p><p>（3）多測幾次數據，會發現500沒有對數據進行分頁，這對爬取來說非常有利。</p><p><strong>3、開始爬取</strong></p><p>那麼，這次我們使用python強大的庫吧，這裡使用的是用於請求數據的requests以及用於解析HTML的HTMLParser。</p><p>requests的用法非常簡單，注意編碼格式不要中文亂碼即可：</p><pre>def getHtml(url, method='get', headers={}, params={}): if method == 'get': html = requests.get(url, headers=headers, params=params) html.encoding = 'utf-8' #html.apparent_encoding else: html = requests.post(url, headers=headers, data=params) html.encoding = 'utf-8' return html.text</pre><p>header和params都是這樣的字典：</p><pre>headers:{ "Host": "datachart.500.com", "Connection": "keep-alive", "Accept": "*/*", "X-Requested-With": "XMLHttpRequest", "User-Agent": "Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62." "0.3202.94 Safari/537.36", "Referer": "http://datachart.500.com/ssq/history/history.shtml", "Accept-Encoding": "gzip, deflate", "Accept-Language":"zh-CN,zh;q=0.9", "Cookie":"ck_RegFromUrl=http%3A//www.500.com/; sdc_session=1533916356798; _jzqy=1.1528606472.1533916357.1." "jzqsr=baidu.-; _jzqckmp=1; seo_key=baidu%7C%7Chttps://www.baidu.com/link?url=MQcB3-er5rK249eCQNw" "G8A4N-hontstLi8HIy9E7H_q&amp;wd=&amp;eqid=fec80b7400019715000000035b6db4d7; bdshare_firstime=15339164028" "59; WT_FPC=id=undefined:lv=1533916553308:ss=1533916402791; _qzja=1.190448226.1533829920533.15338" "29920534.1533916402865.1533916409059.1533916553371.0.0.0.5.2; _qzjc=1; _jzqa=1.20620370185900751" "00.1533829921.1533829921.1533916357.2; _jzqc=1; Hm_lvt_4f816d475bb0b9ed640ae412d6b42cab=15338299" "21,1533916357; Hm_lpvt_4f816d475bb0b9ed640ae412d6b42cab=1533916554; __utma=63332592.612539621.15" "33916358.1533916358.1533916358.1; __utmc=63332592; __utmz=63332592.1533916358.1.1.utmcsr=baidu|u" "tmccn=(organic)|utmcmd=organic; CLICKSTRN_ID=123.98.36.94-1533829945.911636::415C872F9F26292A610C" "843E6BD7FEB2; motion_id=1533920615560_0.37147948464863223",}params:{ 'start':'1', 'end':'18092'}</pre><p>start和end就是那個get請求的URL攜帶的參數啦，就是彩票期數。Cookie可以直接加在header裡面發送，也可以單獨地作為參數：</p><pre>requests.get(url, headers=headers, cookies=cookies, params=params)</pre><p>前面提到，爬下來是一個網頁，需要解析，我們構建一個HTMLParser的處理類：</p><pre>class Parser500ssq(HTMLParser): flag_tbody = False # 定義一些變量 flag_tr = False flag_td = False linedata = [] result = []  def handle_starttag(self, tag, attrs): # 匹配開始標籤 if (str(tag).startswith("tbody")): # 比如匹配tbody  for k,v in attrs: # 遍歷tbody標籤中的屬性 if k == 'id' and v == 'tdata': # 如果匹配到指定屬性 self.flag_tbody = True # 設置一個flag，表明匹配到了開始工作啦 return elif (self.flag_tbody == True):  if (str(tag).startswith("tr")): self.flag_tr = True if (str(tag).startswith("td")): self.flag_td = True  def handle_endtag(self, tag): # 匹配結束標籤  if (self.flag_tbody == True): # 如果在tbody標籤裡面 if (str(tag).startswith("tr")): # 如果是&lt;/tr&gt;，說明行結束了，提交一波數據 self.result.append(self.linedata) self.linedata = [] self.flag_tr = False elif (str(tag).startswith("td")): # 如果是&lt;/td&gt;，說明一個屬性結束了，關掉flag  self.flag_td = False elif (str(tag).startswith("tbody")): self.flag_tbody = False  def handle_data(self, data): # 處理&lt;xx&gt;data&lt;/xx&gt;裡面的數據 if (self.flag_td == True): # 如果是在處理&lt;td&gt;內的數據 if 'a0' in data: self.linedata.append("-".join(data.replace(u'a0', u'').split(","))) # 空格特殊處理 else: self.linedata.append("".join(data.split(","))) # 數字去掉逗號''' def handle_startendtag(self, tag, attrs): # 匹配開始和結束標籤，用不到 print('&lt;%s/&gt;' % tag)  def handle_comment(self, data): # 匹配&lt;!--&gt;comment&lt;--!&gt;這樣的註釋，用不到 print('&lt;!--', data, '--&gt;')  def handle_entityref(self, name): # 匹配特殊字符，比如&amp;nbps，用不到 print('&amp;%s;' % name)  def handle_charref(self, name): # 匹配特殊字符串，比如，用不到 print('%s;' % name)'''</pre><p>思路很簡單，匹配到了開始符就設置flag，然後就開始收集數據，匹配到了結束符就存一波數據，這樣數據就會被以列表的結構存在result裡面。那麼我們簡單定義一個處理函數，就能夠把它打入文件保存了。用feed給這個parser類喂數據，用with...as的結構來寫文件：</p><pre>def parse500ssq(html,datapath): print("start grabbing...") parser = Parser500ssq() parser.feed(html) print(parser.result) with open(BASEPATH + datapath, 'w') as f: for line in parser.result: print(line) f.write(",".join(line)) f.write("\n") print("finished.")</pre><p>得到的結果是這樣的：</p><pre>['18092', '06', '10', '16', '19', '24', '33', '16', '', '921043817', '1', '10000000', '95', '269198', '318819890', '2018-08-09']['11025', '08', '25', '26', '31', '32', '33', '09', '0', '310916704', '4', '8040679', '80', '228050', '335345846', '2011-03-06']['06050', '02', '06', '12', '15', '25', '31', '07', '09-14-05', '138448657', '1', '5000000', '39', '148511', '94915860', '2006-05-02']['03001', '10', '11', '12', '13', '26', '28', '11', '10', '2097070', '0', '0', '1', '898744', '10307806', '2003-02-23']</pre><h1><strong>爬取中彩網雙色球的歷史數據</strong></h1><p><strong>1、進入網頁，查看接口</strong></p><p>進入中彩網雙色球往期查詢頁面（http://www.zhcw.com/kj/qg/ssq/wqcx/），相同的方法，隨便選擇期數，點擊查詢，觀察XHR。</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1539454175593c269a62979><p class=pgc-img-caption></p></div><p>然而XHR沒有任何變化……</p><p>檢查查詢按鈕的HTML，是一個調用js函數search()的input元素：</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1539454175664ab7406c064><p class=pgc-img-caption></p></div><p>網頁上右鍵，查看網頁源代碼，ctrl+f搜索search()，竟然沒搜到……</p><p>仔細觀察發現是加載了一個iframe：</p><pre>&lt;iframe src="http://kaijiang.zhcw.com/lishishuju/jsp/ssqInfoList.jsp?czId=1" id="frmdetail" name="frmdetail" width="100%" frameborder="0" onload="this.height = 20+document.getElementById('frmdetail').contentDocument.body.offsetHeight; delNode('loading');"&gt;&lt;/iframe&gt;</pre><p>進入這個網址，是一個純淨的數據表HTML，賽高~</p><p>再次點擊查詢，觀察XHR，仍然沒有數據……</p><p>調整到All，原來它是直接跳轉的網頁而不是異步刷新數據：</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1539454175810b1e8d5c8a2><p class=pgc-img-caption></p></div><p>那麼，又要解析html了………………</p><p><strong>2、分析數據</strong></p><p>仍然是標準的html表格：</p><pre>&lt;tbody&gt;	&lt;tr&gt;		&lt;td&gt;1&lt;/td&gt;		&lt;td&gt;2018-08-09&lt;/td&gt;		&lt;td&gt;2018092&lt;/td&gt;		&lt;td class="kaiHao"&gt;06 10 16 19 24 33 &lt;span&gt;16&lt;/span&gt;&lt;/td&gt;		&lt;td&gt;318,819,890&lt;/td&gt;		&lt;td&gt;1&lt;/td&gt;		&lt;td&gt;10,000,000&lt;/td&gt;		&lt;td&gt;95&lt;/td&gt;		&lt;td&gt;269,198&lt;/td&gt;		&lt;td&gt;882&lt;/td&gt;		&lt;td&gt;3,000&lt;/td&gt;		&lt;td&gt;921,043,817&lt;/td&gt;	&lt;/tr&gt;	 	&lt;tr&gt;		&lt;td&gt;2&lt;/td&gt;		&lt;td&gt;2018-08-07&lt;/td&gt;		&lt;td&gt;2018091&lt;/td&gt;		&lt;td class="kaiHao"&gt;06 11 13 17 25 32 &lt;span&gt;07&lt;/span&gt;&lt;/td&gt;		&lt;td&gt;315,853,082&lt;/td&gt;		&lt;td&gt;4&lt;/td&gt;		&lt;td&gt;8,999,907&lt;/td&gt;		&lt;td&gt;81&lt;/td&gt;		&lt;td&gt;246,907&lt;/td&gt;		&lt;td&gt;1107&lt;/td&gt;		&lt;td&gt;3,000&lt;/td&gt;		&lt;td&gt;854,322,188&lt;/td&gt;	&lt;/tr&gt;&lt;/tbody&gt;</pre><p>這裡要注意：</p><p>（1）設計了分頁，所以表面上是三個參數：</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1539454324489bb72cc3cef><p class=pgc-img-caption></p></div><p>實際上還有一個參數：</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1539454336897294f59cd5a><p class=pgc-img-caption></p></div><p>（2）藍球是在span標籤裡面的，而不是td</p><p>（3）數字依然有逗號分隔</p><p><strong>3、開始爬取</strong></p><p>首先需要處理翻頁的問題，觀察到下一頁翻到最後尾頁是相同的，沒有價值，我們可以比對上一頁和尾頁，如果上一頁和尾頁的差距在一頁以上，就說明沒爬完，需要進行翻頁。</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/153945417591071f1b10470><p class=pgc-img-caption></p></div><p>舉個例子，當前頁數為1，上一頁為0，尾頁為2，一共有2頁。那麼當上一頁為0的時候，所在頁為1，需要翻頁；上一頁為1的時候，和尾頁差距為1，這時候所在頁為2，已經爬取完了。而翻頁的方式僅僅需要修改提交請求的參數，很容易寫出這樣的代碼：</p><pre>class ParserZhcwssq(HTMLParser): flag_tbody = False flag_tr = False flag_td = False flag_ballnum = False flag_nextpage = False linedata = [] result = [] url_nextpage = []  def reset_attr(self): self.flag_tbody = False self.flag_tr = False self.flag_td = False self.flag_ballnum = False self.flag_nextpage = False self.linedata = [] self.result = [] self.url_nextpage = []  def handle_starttag(self, tag, attrs): # start tag if (str(tag).startswith("tbody")): self.flag_tbody = True elif (self.flag_tbody == True): if (str(tag).startswith("tr")): self.flag_tr = True elif (str(tag).startswith("td")): self.flag_td = True for k,v in attrs: if k == 'class' and v == "kaiHao": self.flag_ballnum = True elif self.flag_nextpage == True and str(tag).startswith("a"): self.url_nextpage.append(attrs[0][1].split("PageNum=")[1])  def handle_endtag(self, tag): # end tag if (self.flag_tbody == True): if (str(tag).startswith("tr")): self.result.append(self.linedata) self.linedata = [] self.flag_tr = False elif (str(tag).startswith("td")): self.flag_td = False self.flag_ballnum = False elif (str(tag).startswith("tbody")): self.flag_tbody = False  def handle_data(self, data): # &lt;xx&gt;data&lt;/xx&gt; if (self.flag_td == True): if self.flag_ballnum == True: self.linedata.extend(data.rstrip().split(" ")) else: self.linedata.append("".join(data.split(",")))  def handle_comment(self, data): # &lt;!--&gt;comment&lt;--!&gt; if(data.strip() == '分頁條'): self.flag_nextpage = True def parseZhcwssq(html,datapath,htmlurl,method,headers,params): print("start grabbing...") parser = ParserZhcwssq() wmode = 'w' while(1): parser.feed(html) print(parser.result) with open(BASEPATH + datapath, wmode) as f: for line in parser.result: f.write(",".join(line)) f.write("\n") if int(parser.url_nextpage[1]) != int(parser.url_nextpage[3]) - 1: print("grabbing nextpage...") wmode = 'a' params['currentPageNum'] = parser.url_nextpage[2].strip() html = getHtml(htmlurl, method, headers,params) parser.reset_attr() else: print("finished.") break</pre><p>爬取結果：</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1539454176073ec8bf2cf3c><p class=pgc-img-caption></p></div><h1><strong>總結</strong></h1><p>1、這次爬取的結果已經上傳到github（BEWINDOWEB）上的lotterydata上面了，可以下載來直接使用。</p><p>2、完整的爬取代碼上傳到了github（BEWINDOWEB）上的lotteryhistorygrabber，可以下載來學習和實踐。</p><p>3、數據格式：</p><p><strong>lot_500_ssq.txt：</strong></p><p>期號，紅球1，紅球2，紅球3，紅球4，紅球5，紅球6，藍球，快樂星期天，獎金獎池（元），</p><p>一等獎注數，一等獎獎金（元），二等獎注數，二等獎獎金（元），總投注額（元），開獎日期</p><p><strong>lot_zhcw_ssq.txt：</strong></p><p>序號，開獎日期，期號，紅球1，紅球2，紅球3，紅球4，紅球5，紅球6，藍球，銷售額，</p><p>一等獎注數，一等獎獎金（元），二等獎注數，二等獎獎金（元），三等獎注數，三等獎獎金（元），獎池（元）</p><p>4、這次的爬取總的來說還是十分簡單，沒有涉及到任何異步加載延遲、複雜的iframe結構、登錄cookie/session、js雙重加密、服務器反爬蟲封IP等等問題，但是可以當做一次基本練習，爬下來的數據也是很有價值的。更加複雜爬蟲的推薦使用scrapy+splash等專業爬蟲平臺來構建項目。</p><p>talk is cheep，立刻動手，開始編寫屬於你的爬蟲吧~</p><h1><strong>擴展閱讀</strong></h1><p>私信“爬取雙色球”可以得到以下內容：</p><p>（1）本人博客的<strong>完整版文章鏈接</strong></p><ul><li>《用Python簡單爬取雙色球開獎信息》</li><li>《用Python爬取雙色球開獎信息（升級版）》</li><li>《5分鐘學會利用python庫爬取雙色球歷史數據》</li></ul><p>（2）爬取的結果<strong>lotterydata</strong>、完整的爬取代碼<strong>lotteryhistorygrabber</strong></p><hr><h1>交流與福利</h1><p>由於很多小夥伴希望及時交流，我建立了兩個交流群，歡迎加入。</p><p>工作日工作繁忙不常在線，我一定盡力及時回覆，沒有得到回覆的小夥伴可以在群裡問一問其他的大佬。</p><p>初次建立，長期招募JavaWeb和機器學習方向的大佬管理員~</p><p><strong>選擇感興趣的群加入</strong></p><p>（1）JavaWeb群：747111145</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1539507593601cd7a8e2124><p class=pgc-img-caption></p></div><p>（2）機器學習交流群：779749708</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15395075671712a53d7c9b7><p class=pgc-img-caption></p></div><p><strong>加入群你可以得到什麼</strong></p><p>（1）日常關注的福利，比如雲服務器打折等活動，我會及時分享</p><p>（2）內推資源福利</p><p>（3）學習資料</p><p>（4）解決實踐過程中遇到的困難與疑惑</p><div class=pgc-img><img alt=彩票數據收集！學會利用python庫爬取雙色球歷史數據 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1538637338587f6433a6b05><p class=pgc-img-caption></p></div><p>重大發現！</p><p><strong>關注</strong>三顆豆子分裂中的同學<strong>剛買了彩票就中獎</strong>！</p><p><strong>點贊評論</strong>三顆豆子分裂中文章的同學<strong>剛寫完代碼就跑通</strong>！</p><p><strong>收藏轉發</strong>三顆豆子分裂中文章的同學<strong>剛轉身就遇到了真愛</strong>！</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>數據</a></li><li><a>學會</a></li><li><a>python</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/7e6598f8.html alt="python數據處理，pandas也有Excel Vlookup 模糊查找功能" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/88d28d52-213f-4bc2-a199-4c80bc66275a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7e6598f8.html title="python數據處理，pandas也有Excel Vlookup 模糊查找功能">python數據處理，pandas也有Excel Vlookup 模糊查找功能</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8644b6bb.html alt=掌握這個分析方法，數據分析就學會了一半 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/34234bf92bfa482c8241feaa96545880 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8644b6bb.html title=掌握這個分析方法，數據分析就學會了一半>掌握這個分析方法，數據分析就學會了一半</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/fa653cd.html alt=python數據分析和挖掘｜對樣本數據做質量分析，去除異常值 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=http://p1.pstatp.com/large/pgc-image/4ad0a3ada9be4394b48c8dade9651235 style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/fa653cd.html title=python數據分析和挖掘｜對樣本數據做質量分析，去除異常值>python數據分析和挖掘｜對樣本數據做質量分析，去除異常值</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8eedec90.html alt=你也能學會的4種觀耳辨病法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/43850003731f879455c8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8eedec90.html title=你也能學會的4種觀耳辨病法>你也能學會的4種觀耳辨病法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f8c3b92d.html alt=python安全開發軍規之四：使用安全的隨機數生成器 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bbda123b84db44148aca9d3e26ddf119 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f8c3b92d.html title=python安全開發軍規之四：使用安全的隨機數生成器>python安全開發軍規之四：使用安全的隨機數生成器</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e27caade.html alt=python基礎知識，多態實例講解以及多態的作用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/2506d9fe7f6641a6a12c35a35a9335db style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e27caade.html title=python基礎知識，多態實例講解以及多態的作用>python基礎知識，多態實例講解以及多態的作用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c56ee116.html alt=小猿圈python學習-三大特性之多態 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ad0e8e3777854337abeb7c779ad79a04 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c56ee116.html title=小猿圈python學習-三大特性之多態>小猿圈python學習-三大特性之多態</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bf5b8ead.html alt=看不懂電路圖？學會這10大原則7大步驟，輕鬆搞定 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f91ccf0b47e24eee9a573cfd7216bc5f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bf5b8ead.html title=看不懂電路圖？學會這10大原則7大步驟，輕鬆搞定>看不懂電路圖？學會這10大原則7大步驟，輕鬆搞定</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/825374f3.html alt=零基礎學電工，先要學會這些最基本的電路圖 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/d609d2de3c2f4e429b575c42a3f8cf64 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/825374f3.html title=零基礎學電工，先要學會這些最基本的電路圖>零基礎學電工，先要學會這些最基本的電路圖</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/862c99dd.html alt=數據告訴你，為什麼要在上升趨勢買入和下降趨勢賣出 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3e507bb24abc482fb28df1121a7ee097 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/862c99dd.html title=數據告訴你，為什麼要在上升趨勢買入和下降趨勢賣出>數據告訴你，為什麼要在上升趨勢買入和下降趨勢賣出</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1f742b21.html alt="數據科學家常犯的 10 個編程錯誤" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1f742b21.html title="數據科學家常犯的 10 個編程錯誤">數據科學家常犯的 10 個編程錯誤</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d5773fc2.html alt=數據科學家常遇到的10個錯誤 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/59f660bac8b541888e71459b604ba733 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d5773fc2.html title=數據科學家常遇到的10個錯誤>數據科學家常遇到的10個錯誤</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/32e171a3.html alt=5個必須學會的Excel求和公式，可直接套用，省時省力！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1535450928204b2d8afb96c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/32e171a3.html title=5個必須學會的Excel求和公式，可直接套用，省時省力！>5個必須學會的Excel求和公式，可直接套用，省時省力！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5ff7d77e.html alt=WORD表格的數據老闆讓增加合計，同事用計算器計算，我3秒鐘搞定 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f120ed2c1ed549e39bfa60bb3a86d591 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5ff7d77e.html title=WORD表格的數據老闆讓增加合計，同事用計算器計算，我3秒鐘搞定>WORD表格的數據老闆讓增加合計，同事用計算器計算，我3秒鐘搞定</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cea55527.html alt="多列數據合併一列，還在用數據透視就out了，用=號只要三步完成" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/7aa6ee1b961f467e8090ed56f45c110f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cea55527.html title="多列數據合併一列，還在用數據透視就out了，用=號只要三步完成">多列數據合併一列，還在用數據透視就out了，用=號只要三步完成</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>