<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>詳解MYSQL數據庫的存儲過程和函數語法總結 | 极客快訊</title><meta property="og:title" content="詳解MYSQL數據庫的存儲過程和函數語法總結 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/dd9b4bb507e84ad78bf1ed764e5fd570"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7d88fb80.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7d88fb80.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7d88fb80.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7d88fb80.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7d88fb80.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7d88fb80.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7d88fb80.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7d88fb80.html><meta property="article:published_time" content="2020-11-14T21:02:06+08:00"><meta property="article:modified_time" content="2020-11-14T21:02:06+08:00"><meta name=Keywords content><meta name=description content="詳解MYSQL數據庫的存儲過程和函數語法總結"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/7d88fb80.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>詳解MYSQL數據庫的存儲過程和函數語法總結</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1><strong>什麼是存儲過程</strong></h1><p>簡單的說，就是<strong>一組SQL語句集，功能強大，可以實現一些比較複雜的邏輯功能，</strong>類似於JAVA語言中的方法；</p><p>ps:存儲過程跟觸發器有點類似，都是一組SQL集，但是存儲過程是主動調用的，且功能比觸發器更加強大，觸發器是某件事觸發後自動調用；</p><hr><h1><strong>存儲過程特性</strong></h1><ol><li>有輸入輸出參數，可以聲明變量，有if/else, case,while等控制語句，通過編寫存儲過程，可以實現複雜的邏輯功能；</li><li>函數的普遍特性：模塊化，封裝，代碼複用；</li><li>速度快，只有首次執行需經過編譯和優化步驟，後續被調用可以直接執行，省去以上步驟；</li></ol><hr><h1><strong>MySQL存儲過程的創建</strong></h1><p><strong>1、語法</strong></p><p>CREATE PROCEDURE sp_name ([proc_parameter[,...]]) [characteristic ...] routine_body</p><p>CREATE PROCEDURE 過程名([[IN|OUT|INOUT] 參數名 數據類型[,[IN|OUT|INOUT] 參數名 數據類型…]]) [特性 ...] 過程體</p><pre>DELIMITER // CREATE PROCEDURE myproc(OUT s int) BEGIN SELECT COUNT(*) INTO s FROM students; END //DELIMITER ;</pre><p>MySQL默認以";"為分隔符，如果沒有聲明<span>分割符</span>，則編譯器會把存儲過程當成SQL語句進行處理，因此編譯過程會報錯，所以要事先用“DELIMITER //”聲明當前段分隔符，讓編譯器把兩個"//"之間的內容當做存儲過程的代碼，不會執行這些代碼；“DELIMITER ;”的意為把分隔符還原。</p><p><strong>2、參數</strong></p><p>存儲過程根據需要可能會有輸入、輸出、輸入輸出參數，如果有多個參數用","分割開。MySQL存儲過程的參數用在存儲過程的定義，共有三種參數類型,IN,OUT,INOUT:</p><ul><li>IN參數的值必須在調用存儲過程時指定，在存儲過程中修改該參數的值不能被返回，為默認值</li><li>OUT:該值可在存儲過程內部被改變，並可返回</li><li>INOUT:調用時指定，並且可被改變和返回</li></ul><p>其中，sp_name參數是存儲過程的名稱；proc_parameter表示存儲過程的參數列表； characteristic參數指定存儲過程的特性；routine_body參數是SQL代碼的內容，可以用BEGIN…END來標誌SQL代碼的開始和結束。</p><p>技巧：創建存儲過程時，系統默認指定CONTAINS SQL，表示存儲過程中使用了SQL語句。但是，如果存儲過程中沒有使用SQL語句，最好設置為NO SQL。而且，存儲過程中最好在COMMENT部分對存儲過程進行簡單的註釋，以便以後在閱讀存儲過程的代碼時更加方便。</p><hr><h1>存儲過程實例</h1><p>下面創建一個名為num_from_employee的存儲過程。</p><div class=pgc-img><img alt=詳解MYSQL數據庫的存儲過程和函數語法總結 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/dd9b4bb507e84ad78bf1ed764e5fd570><p class=pgc-img-caption></p></div><p>上述存儲過程名稱為num_from_employee；輸入變量為emp_id；輸出變量為count_num。SELECT語句從employee表查詢d_id值等於emp_id的記錄，並用COUNT(*)計算d_id值相同的記錄的條數，最後將計算結果存入count_num中。執行結果如下：</p><div class=pgc-img><img alt=詳解MYSQL數據庫的存儲過程和函數語法總結 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/449b0d3d4a9a4bf5a750fe0094059946><p class=pgc-img-caption></p></div><p>執行完畢後，沒有報出任何出錯信息就表示存儲函數已經創建成功。以後就可以調用這個存儲過程，數據庫中會執行存儲過程中的SQL語句。</p><p>說明：MySQL中默認的語句結束符為分號（;）。存儲過程中的SQL語句需要分號來 結束。為了避免衝突，首先用"DELIMITER &&"將MySQL的結束符設置為&&。最後再用"DELIMITER ;"來將結束符恢復成分號。這與創建觸發器時是一樣的。</p><hr><h1><strong>函數</strong></h1><p>在MySQL中，創建存儲函數的基本形式如下：</p><pre>CREATE FUNCTION sp_name ([func_parameter[,...]]) RETURNS type [characteristic ...] routine_body</pre><p>其中，sp_name參數是存儲函數的名稱；func_parameter表示存儲函數的參數列表；RETURNS type指定返回值的類型；characteristic參數指定存儲函數的特性，該參數的取值與存儲過程中的取值是一樣的；routine_body參數是SQL代碼的內容，可以用BEGIN…END來標誌SQL代碼的開始和結束。</p><p>func_parameter可以由多個參數組成，其中每個參數由參數名稱和參數類型組成，其形式如下：param_name type</p><p>其中，param_name參數是存儲函數的參數名稱；type參數指定存儲函數的參數類型，該類型可以是MySQL數據庫的任意數據類型。</p><hr><h1>函數實例</h1><p>下面創建一個名為name_from_employee的存儲函數。</p><div class=pgc-img><img alt=詳解MYSQL數據庫的存儲過程和函數語法總結 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d07e445e6f224849b418ce31efb29e94><p class=pgc-img-caption></p></div><p>上述存儲函數的名稱為name_from_employee；該函數的參數為emp_id；返回值是VARCHAR類型。SELECT語句從employee表查詢num值等於emp_id的記錄，並將該記錄的name字段的值返回。執行結果如下：</p><div class=pgc-img><img alt=詳解MYSQL數據庫的存儲過程和函數語法總結 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d99bac306a91418c949baa19da6625b0><p class=pgc-img-caption></p></div><p>結果顯示，存儲函數已經創建成功。該函數的使用和MySQL內部函數的使用方法一樣。</p><hr><h1><strong>變量的使用</strong></h1><p>在存儲過程和函數中，可以定義和使用變量。用戶可以使用DECLARE關鍵字來定義變量。然後可以為變量賦值。這些變量的作用範圍是BEGIN…END程序段中。</p><p><strong>1、定義變量</strong></p><p>MySQL中可以使用DECLARE關鍵字來定義變量。定義變量的基本語法如下：</p><pre>DECLARE var_name[,...] type [DEFAULT value]</pre><p>其中， DECLARE關鍵字是用來聲明變量的；var_name參數是變量的名稱，這裡可以同時定義多個變量；type參數用來指定變量的類型；DEFAULT value子句將變量默認值設置為value，沒有使用DEFAULT子句時，默認值為NULL。</p><p>下面定義變量my_sql，數據類型為INT型，默認值為10。</p><pre>DECLARE my_sql INT DEFAULT 10 ;</pre><p><strong>2、為變量賦值</strong></p><p>MySQL中可以使用SET關鍵字來為變量賦值。SET語句的基本語法如下：</p><pre>SET var_name = expr [, var_name = expr] ...</pre><p>其中，SET關鍵字是用來為變量賦值的；var_name參數是變量的名稱；expr參數是賦值表達式。一個SET語句可以同時為多個變量賦值，各個變量的賦值語句之間用逗號隔開。</p><p>下面為變量my_sql賦值為30。</p><pre>SET my_sql = 30 ;</pre><p>MySQL中還可以使用SELECT…INTO語句為變量賦值。其基本語法如下：</p><pre>SELECT col_name[,…] INTO var_name[,…] FROM table_name WEHRE condition</pre><p>其中，col_name參數表示查詢的字段名稱；var_name參數是變量的名稱；table_name參數指表的名稱；condition參數指查詢條件。</p><p>下面從employee表中查詢id為2的記錄，將該記錄的d_id值賦給變量my_sql。</p><pre>SELECT d_id INTO my_sql FROM employee WEHRE id=2 ;</pre><hr><h1><strong>MySQL存儲過程寫法總結</strong></h1><p><strong>1、創建無參存儲過程。</strong></p><pre>create procedure product()begin select * from user;end;</pre><p>一條簡單的存儲過程創建語句，此時調用的語句為：</p><pre>call procedure();</pre><p><strong>2、創建有參存儲過程</strong></p><p>有參的存儲包括兩種參數，</p><p>一個是傳入參數;</p><p>一個是傳出參數;</p><p>例如一個存儲過程：</p><pre>create procedure procedure2(out p1 decimal(8,2),out p2 decimal(8,2),in p3 int)beginselect sum(uid) into p1 from user where order_name = p3;select avg(uid) into p2 from user ;end ;</pre><p>從上面sql語句可以看出，p1和p2是用來檢索並且傳出去的值，而p3則是必須有調用這傳入的具體值。</p><p>具體調用過程：</p><blockquote><p>call product(); //無參</p><p>call procedure2(@userSum,@userAvg,201708); //有參</p></blockquote><p>當用完後，可以直接查詢userSum和userAvg的值：</p><blockquote><p>select @userSum, @userAvg;</p></blockquote><p>結果如下：</p><div class=pgc-img><img alt=詳解MYSQL數據庫的存儲過程和函數語法總結 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8b964d733102411e94abea56f00e0106><p class=pgc-img-caption></p></div><p><strong>3、刪除存儲過程</strong></p><p>語法：drop procedure procedure_name;</p><hr><p>後面會分享更多devops和DBA方面的內容，感興趣的朋友可以關注一下~</p><div class=pgc-img><img alt=詳解MYSQL數據庫的存儲過程和函數語法總結 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/162b4bed6b444c1d9e90d8435a46b673><p class=pgc-img-caption></p></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>詳解</a></li><li><a>MYSQL</a></li><li><a>數據庫</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/dc1a27dd.html alt="詳解Oracle 數據庫啟動過程" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/1538236609349861be8e044 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dc1a27dd.html title="詳解Oracle 數據庫啟動過程">詳解Oracle 數據庫啟動過程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/221f2be8.html alt=詳解時序數據庫InfluxDB｜一個不為人知的數據庫 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b9d6b2f37d7f4707abb3475a03068a89 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/221f2be8.html title=詳解時序數據庫InfluxDB｜一個不為人知的數據庫>詳解時序數據庫InfluxDB｜一個不為人知的數據庫</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/077e0bea.html alt=詳解Oracle數據庫並行操作常見等待事件及腳本 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/a74be2b271974acd9738271ee46baaf4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/077e0bea.html title=詳解Oracle數據庫並行操作常見等待事件及腳本>詳解Oracle數據庫並行操作常見等待事件及腳本</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f8b2a960.html alt="思路方法詳解 高三數學複習難點突破 圓錐曲線中的定點、定值問題" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/afd28158b4384f5eaa05c44c3104e24f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f8b2a960.html title="思路方法詳解 高三數學複習難點突破 圓錐曲線中的定點、定值問題">思路方法詳解 高三數學複習難點突破 圓錐曲線中的定點、定值問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/17054f8d.html alt=詳解CD編碼格式（16bit/44.1kHz）合理性之量化篇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/6f23d12bac3843e2b09628221846ce0f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/17054f8d.html title=詳解CD編碼格式（16bit/44.1kHz）合理性之量化篇>詳解CD編碼格式（16bit/44.1kHz）合理性之量化篇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c84544ec.html alt=詳解CD編碼格式（16bit/44.1kHz）合理性之採樣篇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5dc880024dac477f8aed432054712f82 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c84544ec.html title=詳解CD編碼格式（16bit/44.1kHz）合理性之採樣篇>詳解CD編碼格式（16bit/44.1kHz）合理性之採樣篇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/feaa3a52.html alt=詳解音頻編解碼的原理、演進和應用選型等 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c0abba2ccef04296b442c6457cc98f49 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/feaa3a52.html title=詳解音頻編解碼的原理、演進和應用選型等>詳解音頻編解碼的原理、演進和應用選型等</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3269d080.html alt=MySQL數據庫的事務管理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/152203544367254a708f807 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3269d080.html title=MySQL數據庫的事務管理>MySQL數據庫的事務管理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8293e598.html alt=MySQl事務最全詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c61163c863114226b14bb3760da19e4d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8293e598.html title=MySQl事務最全詳解>MySQl事務最全詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cb944fe7.html alt=Mysql事務詳解(一文讀懂數據庫事務) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/cb7ba6cbda8c44438d9d3d7c57bd25b9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cb944fe7.html title=Mysql事務詳解(一文讀懂數據庫事務)>Mysql事務詳解(一文讀懂數據庫事務)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ad3f3a1e.html alt="數據庫技術：MySQL 基礎和 SQL 入門，單表、約束和事務" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/107897c16ae7461caa62dd375b631afe style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ad3f3a1e.html title="數據庫技術：MySQL 基礎和 SQL 入門，單表、約束和事務">數據庫技術：MySQL 基礎和 SQL 入門，單表、約束和事務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8ff1c7a8.html alt=解讀數據庫：深入分析MySQL中事務以及MVCC的實現原理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/dfic-imagehandler/8f370516-d41a-4803-84ba-2c01e4637c8b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8ff1c7a8.html title=解讀數據庫：深入分析MySQL中事務以及MVCC的實現原理>解讀數據庫：深入分析MySQL中事務以及MVCC的實現原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b8bda645.html alt=「Java」隨機數詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b471807e699b44c2b1dedc580ea3f3af style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b8bda645.html title=「Java」隨機數詳解>「Java」隨機數詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f44ab8f6.html alt=詳解13項鋼筋安裝質量標準及通病防治 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/fd3ff534941a487884c7a67361337cfb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f44ab8f6.html title=詳解13項鋼筋安裝質量標準及通病防治>詳解13項鋼筋安裝質量標準及通病防治</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/464b2d9e.html alt=史上最全電路圖詳解！老電工都收藏了！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1533138404073909636bf43 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/464b2d9e.html title=史上最全電路圖詳解！老電工都收藏了！>史上最全電路圖詳解！老電工都收藏了！</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>