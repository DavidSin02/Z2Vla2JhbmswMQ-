<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹å‚³æˆçµ¦ä½ é«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€ | æå®¢å¿«è¨Š</title><meta property="og:title" content="ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹å‚³æˆçµ¦ä½ é«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/a7dcdb95c4b747339ad1c7a02b1dee51"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7f83992.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7f83992.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7f83992.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7f83992.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7f83992.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7f83992.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/7f83992.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/7f83992.html><meta property="article:published_time" content="2020-10-29T21:08:06+08:00"><meta property="article:modified_time" content="2020-10-29T21:08:06+08:00"><meta name=Keywords content><meta name=description content="ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹å‚³æˆçµ¦ä½ é«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/7f83992.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹å‚³æˆçµ¦ä½ é«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><blockquote>å…¨æ–‡å…±<strong>10788</strong>å­—ï¼Œé è¨ˆå­¸ç¿’æ™‚é•·<strong>20</strong>åˆ†é˜æˆ–æ›´é•·</blockquote><div class=pgc-img><img alt=ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹å‚³æˆçµ¦ä½ é«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a7dcdb95c4b747339ad1c7a02b1dee51><p class=pgc-img-caption>åœ–ç‰‡ä¾†æºï¼šunsplash.com/@lucassankey</p></div><p class=ql-align-justify>äººèˆ‡ä¸–ç•Œè¬ç‰©çš„äº’å‹•æœƒç”¢ç”Ÿå¤§é‡çš„æ™‚ç©ºæ•¸æ“šã€‚é‚£éº¼ï¼Œç•¶æˆ‘å€‘éœ€è¦éš¨æ™‚èª¿ç”¨éå»çš„æ•¸æ“šæ™‚ï¼Œæ”¹æ€éº¼è¾¦ï¼Ÿå°¤å…¶æ˜¯é¢å°å„ç¨®æµ·é‡ã€å¤šç¶­åº¦çš„æ•¸æ“šåº«ï¼Œå¦‚æœæ²’æœ‰é«˜æ•ˆçš„æœç´¢æ–¹æ³•ï¼Œæˆ‘å€‘åªèƒ½æœ›æ´‹èˆˆå˜†ã€æŸæ‰‹ç„¡ç­–ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>åˆ¥æ“”å¿ƒï¼Œæœ¬æ–‡å°‡ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹ä¾†å‚³æˆé«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€ï¼</p><p class=ql-align-justify><br></p><div class=pgc-img><img alt=ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹å‚³æˆçµ¦ä½ é«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12eec69480594db79a5c2452d716e5ea><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>å°è±¡æ•¸æ“šåˆ†é¡</strong></p><p class=ql-align-justify><br></p><p class=ql-align-justify>å°è±¡æ•¸æ“šå¯åˆ†ç‚ºå…©ç¨®é¡å‹ï¼šéœæ…‹æ•¸æ“šï¼ˆç›¸å°éœæ…‹ï¼Œä¾‹å¦‚å»ºç¯‰ï¼‰å’Œå‹•æ…‹æ•¸æ“šï¼ˆä¾‹å¦‚äººçš„æ´»å‹•å’Œç‰©è¯ç¶²å‚³æ„Ÿå™¨çš„æ´»å‹•ï¼‰ã€‚</p><p class=ql-align-justify><br></p><div class=pgc-img><img alt=ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹å‚³æˆçµ¦ä½ é«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12eec69480594db79a5c2452d716e5ea><p class=pgc-img-caption></p></div><p><strong>æŒ‰ç ”ç©¶éœ€æ±‚åˆ†é¡çš„ç´¢å¼•</strong></p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ™‚ç©ºå¿«ç…§æœç´¢</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æœ‰äº›å°è±¡ä»¥ç›¸å°è¼ƒä½çš„é »ç‡ç”Ÿæˆæ•¸æ“šã€‚ä¾‹å¦‚ï¼Œå»ºç¯‰ç‰©å’Œé“è·¯ç­‰æƒ°æ€§ç‰©é«”å¯èƒ½åœ¨æ•¸å¹´å…§ä¸æœƒç™¼ç”Ÿä»»ä½•è®ŠåŒ–ã€‚å¦‚æœå°‡ç‚ºé€™äº›å°è±¡ç”Ÿæˆçš„æ•¸æ“šå¯«å…¥æ•¸æ“šåº«ï¼Œä¸¦æŒ‰æ™‚é–“ç¯„åœæŸ¥è©¢æ•¸æ“šï¼ˆä¾‹å¦‚ï¼ŒæŸ¥è©¢æ—¥æœŸç‚º2017-07-01è‡³2017-07-02ï¼‰ï¼Œå‰‡å¯èƒ½æ‰¾ä¸åˆ°èˆ‡é€™äº›å°è±¡ç›¸é—œçš„ä»»ä½•æ•¸æ“šã€‚åŸå› å¾ˆç°¡å–®ï¼Œåœ¨é€™æ®µæ™‚é–“å…§æ•¸æ“šåº«æ ¹æœ¬æ²’æœ‰ç›¸é—œæ•¸æ“šè¼¸å…¥ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ™‚ç©ºè¡Œç‚ºæ•¸æ“šæœç´¢</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ™‚ç©ºè¡Œç‚ºæ•¸æ“šæ˜¯æŒ‡å¾äººçš„æ´»å‹•ç­‰å‹•æ…‹å°è±¡ä¸­ç²å–æ•¸æ“šã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä¾‹å¦‚ï¼Œåˆ†æç‰¹å®šåœ°å€ç‰¹å®šæ™‚é–“æ®µå…§æŸä¸€äººç¾¤çš„ç‰¹å¾µï¼Œæˆ–è€…åˆ†æå¤§å­¸å‘¨é‚Šäººç¾¤åœ¨å·¥ä½œæ—¥å’Œé€±æœ«æ§‹æˆçš„å·®ç•°ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ™‚ç©ºå¿«ç…§ä¸å±¬æ–¼æœ¬æ–‡çš„è¨è«–ç¯„åœã€‚ç¾åœ¨ï¼Œæˆ‘å€‘çœ‹çœ‹å¦‚ä½•æœç´¢æ™‚ç©ºè¡Œç‚ºæ•¸æ“šã€‚</p><p class=ql-align-justify><br></p><div class=pgc-img><img alt=ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹å‚³æˆçµ¦ä½ é«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12eec69480594db79a5c2452d716e5ea><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>æ•¸æ“šçµæ§‹</strong></p><div class=pgc-img><img alt=ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹å‚³æˆçµ¦ä½ é«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e9aafdcbf51f428a8ca1c8f3bfb86ec5><p class=pgc-img-caption>åœ–ç‰‡ä¾†æºï¼šunsplash.com/@dekubaum</p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>æ™‚ç©ºè¡Œç‚ºæ•¸æ“šåŒ…å«ä¸‰å€‹å±¬æ€§ï¼šæ™‚é–“ã€ç©ºé–“å’Œå°è±¡ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>éçµæ§‹åŒ–ç´¢å¼•ï¼š</p><pre>create table test(  id int8,  crt_time timestamp, -- Time  pos geometry, -- Location  obj jsonb -- Object description );</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>é™¤äº†æ‡‰ç”¨æ–¼JSONï¼Œçµæ§‹åŒ–æ•¸æ“šé‚„å¯ä»¥ç”¨æ–¼å°è±¡æè¿°ã€‚ä¾‹å¦‚ï¼š</p><pre>create table test(  id int8,  crt_time timestamp, -- Time  pos geometry, -- Location  c1 int, -- Some property examples  c2 int,  c3 text,  c4 float8,  c5 int,  c6 date,  c7 text,  c8 int,  c9 int,  c10 int );</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>æ™‚ç©ºè¡Œç‚ºæ•¸æ“šçš„SQLæŸ¥è©¢å¯¦ä¾‹</p><pre>select * from test  where  pos &lt;-&gt; ? &lt; ?  and crt_time between ? and ?  and ( (c1 = ? and c2 between ? and ?) or c10=?)  ...  ;</pre><p class=ql-align-justify><br></p><p class=ql-align-center><br></p><div class=pgc-img><img alt=ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹å‚³æˆçµ¦ä½ é«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12eec69480594db79a5c2452d716e5ea><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>å„ªåŒ–æ–¹æ³•</strong></p><p class=ql-align-justify><br></p><p class=ql-align-justify>è€ƒæ…®é‹ç”¨ä»¥ä¸‹çŸ¥è­˜ï¼š</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ™‚é–“åºåˆ—BRINç´¢å¼•</p><p class=ql-align-justify><br></p><p class=ql-align-justify>crt_timeå­—æ®µæ˜¯ä¸€å€‹æ™‚é–“åºåˆ—å­—æ®µï¼Œè¡¨ç¤ºç”Ÿæˆæ•¸æ“šçš„æ™‚é–“ã€‚åœ¨PostgreSQLå †å­˜å„²ä¸­ï¼Œå­˜å„²å’Œè©²å­—æ®µçš„å€¼å…·æœ‰å¾ˆå¼·çš„ç·šæ€§ç›¸é—œæ€§ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>å› æ­¤ï¼ŒBRINç´¢å¼•å¾ˆåˆé©ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä½¿ç”¨BRINç´¢å¼•ä¾†ä»£æ›¿åˆ†å€è¡¨é€²è¡ŒTPC-Hæ¸¬è©¦ã€‚å¤§ç¯„åœæœç´¢çš„æ€§èƒ½ç”šè‡³å„ªæ–¼ä½¿ç”¨åˆ†å€è¡¨æ™‚çš„åŠŸèƒ½ã€‚</p><pre>create index idx_test_1 on test using brin(crt_time);</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>ç©ºé–“ç´¢å¼•</p><p class=ql-align-justify><br></p><p class=ql-align-justify>é¡¯ç„¶ï¼Œç©ºé–“æª¢ç´¢éœ€è¦ç©ºé–“ç´¢å¼•ã€‚PostgreSQLä¸­å¯ä»¥ä½¿ç”¨ä¸‰ç¨®æ–¹æ³•å¯¦ç¾ç©ºé–“æª¢ç´¢ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>1. å¹¾ä½•é¡å‹çš„GISTç´¢å¼•</strong></p><pre>create index idx_test_2 on test using gist(pos);</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>è©²ç´¢å¼•æ”¯æŒç©ºé–“KNNæœç´¢å’Œç©ºé–“ä½ç½®ç¢ºå®šç­‰åŠŸèƒ½ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>2. å¹¾ä½•é¡å‹çš„ä¸»ç´¢å¼•</strong></p><pre>create index idx_test_2 on test using spgist(pos);</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>è©²ç´¢å¼•æ”¯æŒç©ºé–“KNNæœç´¢å’Œç©ºé–“ä½ç½®ç¢ºå®šç­‰åŠŸèƒ½ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>3. Geohashå’ŒB-treeç´¢å¼•</strong>ï¼ˆå°‡ç¶“åº¦å’Œç·¯åº¦è½‰æ›ç‚ºGeohashä½µç‚ºhashå€¼å‰µå»ºB-treeç´¢å¼•ï¼‰ã€‚åªéœ€ä½¿ç”¨è¡¨é”å¼ç´¢å¼•ã€‚</p><pre>create index idx_test_3 on test using btree( ST_GeoHash(pos,15) );</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>æ­¤ç´¢å¼•æ”¯æŒå‰ç¶´æœç´¢ï¼ˆå…¶èƒ½è½å¯¦ç·¨ç¢¼åœ°ç†ä¿¡æ¯ç¶²æ ¼ä¸­åŒ…å«çš„é—œä¿‚ï¼‰ã€‚å®ƒå±¬æ–¼æœ‰æç´¢å¼•ï¼Œéœ€è¦äºŒæ¬¡éæ¿¾ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>GiSTå’ŒSPGiSTç©ºé–“ç´¢å¼•èƒ½å¤ æ‰¾åˆ°æº–ç¢ºçš„åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œå„ªæ–¼GEOHASHç´¢å¼•ã€‚ä½†æ˜¯ï¼ŒæŸ¥è©¢ä¿¡æ¯æ™‚éœ€è¦ç‰¹åˆ¥æ³¨æ„ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>GIN ç´¢å¼•</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ­¤ç´¢å¼•é¡å‹çš„ç›®æ¨™æ˜¯å°è±¡å±¬æ€§å­—æ®µJSONBæˆ–å¤šå€‹çµæ§‹åŒ–å°è±¡å±¬æ€§å­—æ®µã€‚åªéœ€ä½¿ç”¨GINç´¢å¼•ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä¾‹å¦‚ï¼š</p><pre>create extension btree_gin;</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>éçµæ§‹åŒ–ç´¢å¼•ï¼š</p><pre>create index idx_test_4 on test using gin( obj );</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>çµæ§‹åŒ–ç´¢å¼•ï¼š</p><pre>create index idx_test_4 on test using gin( c1,c2,c3,c4,c5,c6,c7,c8,c9 );</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>BitmapAndå’ŒBitmapOr</p><p class=ql-align-justify><br></p><p class=ql-align-justify>åœ¨ä¸Šä¸€ç¯€ä¸­ï¼Œæ ¹æ“šæ•¸æ“šé¡å‹å’ŒæŸ¥è©¢éœ€æ±‚å¯ä»¥ç‚ºä¸åŒçš„æŸ¥è©¢ç¶­åº¦é¸æ“‡ç›¸æ‡‰çš„ç´¢å¼•ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä½†æ˜¯ï¼Œå¯ä»¥åŒæ™‚ä½¿ç”¨é€™äº›ç´¢å¼•å—? PostgreSQLç‚ºå¤šå€‹ç´¢å¼•æä¾›bitmapAndåŠbitmapOræ¥å£ã€‚å®ƒå€‘å¯ä»¥çµ„åˆå¤šå€‹ç´¢å¼•ï¼Œæ¸›å°‘éœ€è¦æƒæçš„æ•¸æ“šåº«æ•¸é‡ã€‚</p><pre>Heap, one square = one page: +---------------------------------------------+ |c____u_____X___u___X_________u___cXcc______u_| +---------------------------------------------+ Rows marked c match customers pkey condition. Rows marked u match username condition. Rows marked X match both conditions. Bitmap scan from customers_pkey: +---------------------------------------------+ |100000000001000000010000000000000111100000000| bitmap 1 +---------------------------------------------+ One bit per heap page, in the same order as the heap Bits 1 when condition matches, 0 if not Bitmap scan from ix_cust_username: +---------------------------------------------+ |000001000001000100010000000001000010000000010| bitmap 2 +---------------------------------------------+ Once the bitmaps are created a bitwise AND is performed on them: +---------------------------------------------+ |100000000001000000010000000000000111100000000| bitmap 1 |000001000001000100010000000001000010000000010| bitmap 2  &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; |000000000001000000010000000000000010000000000| Combined bitmap +-----------+-------+--------------+----------+  | | |  v v v Used to scan the heap only for matching pages: +---------------------------------------------+ |___________X_______X______________X__________| +---------------------------------------------+ The bitmap heap scan then seeks to the start of each page and reads the page: +---------------------------------------------+ |___________X_______X______________X__________| +---------------------------------------------+ seek-------&gt;^seek--&gt;^seek---------&gt;^  | | |  ------------------------  only these pages read</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>ä¾‹å¦‚ï¼š</p><pre>select * from test where  c1 ...  and crt_time between ? and ?  and test-&gt;&gt; c1 in (?, ? ...);</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>æ ¹æ“šçµ±è¨ˆæ•¸æ“šè‡ªå‹•ä½¿ç”¨é©ç•¶çš„ç´¢å¼•ã€‚å¦‚æœéœ€è¦ï¼ŒbitmapAndå’ŒbitmapOrå°‡åœ¨å¤šå€‹ç´¢å¼•ä¸Šè‡ªå‹•åŸ·è¡Œåˆä½µæƒæã€‚è·³éä¸éœ€è¦æƒæçš„é é¢ï¼Œé‡æ–°æª¢æŸ¥å‘½ä¸­çš„é é¢ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>å †è¡¨å­˜å„²åˆ†ç´šå’Œåˆ†å€</p><p class=ql-align-justify><br></p><p class=ql-align-justify>å­˜å„²å¯ä»¥åˆ†ç‚ºä¸€ç´šåˆ†å€æˆ–å¤šç´šåˆ†å€ï¼š</p><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>1. å–®ä¸€åˆ†å€</strong></p><p class=ql-align-justify>ä¾‹å¦‚ï¼ŒæŒ‰æ™‚é–“åŠƒåˆ†ã€‚</p><pre>create table test(  id int8,  crt_time timestamp, -- Time  pos geometry, -- Location  obj jsonb -- Object description ) PARTITION BY range (crt_time) ; create table test_201701 PARTITION OF test for values FROM ( 2017-01-01 ) TO ( 2017-02-01 ); ......</pre><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>2. å¤šå±¤åˆ†å€</strong></p><p class=ql-align-justify>ä¾‹å¦‚ï¼Œå…ˆæŒ‰æ™‚é–“åˆ†å€ï¼Œç„¶å¾ŒæŒ‰GeohashåŠƒåˆ†ã€‚</p><pre>create table test_201701 PARTITION OF test for values FROM ( 2017-01-01 ) TO ( 2017-02-01 ) partition by range(st_geohash(pos,15)); ... create table test_201701_prefix1 PARTITION OF test for values FROM ( xxxx1 ) TO ( xxxx2 ); -- Generate BOX (GRID) on a map, find corresponding boundaries and use -- boundaries as partitioning conditions</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>ä½¿ç”¨åˆ†å€æ™‚ï¼Œå¦‚æœæŸ¥è©¢æ¢ä»¶åŒ…æ‹¬åˆ†å€éµï¼ˆå¦‚æ™‚é–“å’Œç©ºé–“ç¯„åœï¼‰ï¼Œç›¸æ‡‰çš„åˆ†å€å°‡è‡ªå‹•å®šä½ï¼Œé€™å³ç‚ºéœ€è¦æƒæçš„æ•¸æ“šé‡ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>å‰µå»ºé¢å‘å°è±¡å±¬æ€§çš„GINç´¢å¼•ï¼Œä»¥å¯¦ç¾é«˜æ•ˆæŸ¥è©¢ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ç´¢å¼•åˆ†ç´šèˆ‡åˆ†å€</p><p class=ql-align-justify><br></p><p class=ql-align-justify>èˆ‡æ•¸æ“šä¸€æ¨£ï¼Œç´¢å¼•åœ¨ä¸ä½¿ç”¨åˆ†å€è¡¨çš„æƒ…æ³ä¸‹ä¹Ÿæ”¯æŒåˆ†å€é‚è¼¯ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ç©ºé–“ç´¢å¼•+æ™‚é–“åˆ†å€</p><pre>create index idx_20170101 on tbl using gist (pos) where crt_time between 2017-01-01 and 2017-01-02 ; ... create index idx_20170102 on tbl using gist (pos) where crt_time between 2017-01-02 and 2017-01-03 ; ...</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>é€šéä½¿ç”¨å‰è¿°åˆ†å€ç´¢å¼•ï¼Œå¯ä»¥åœ¨è¼¸å…¥æ™‚é–“ç¯„åœå¾Œå¿«é€Ÿå®šä½ç›®æ¨™æ•¸æ“šï¼ŒåŸ·è¡Œç©ºé–“æœç´¢ã€‚</p><pre>select * from tbl  where crt_time between 2017-01-01 and 2017-01-02 -- Time  and (pos &lt;-&gt; ?) &lt; ? -- Distance to a point to be searched for  and ? -- Other conditions  order by pos &lt;-&gt; ? -- Sort by distance  limit ?; -- Number of results to be returned</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>å¯ä»¥ä½¿ç”¨æ›´å¤šçš„ç´¢å¼•åˆ†å€ï¼Œæ¯”å¦‚ç”¨ä½œæœç´¢æ¢ä»¶å’Œå•†åº—é¡å‹çš„ç¶­åº¦ï¼ˆå°è±¡å±¬æ€§ï¼‰ï¼ˆå‡è¨­å®ƒæ˜¯å¯æšèˆ‰çš„æˆ–åœ¨ç¯„åœç›¸å°è¼ƒå°çš„æƒ…æ³ä¸‹ï¼‰ã€‚</p><pre>create index idx_20170101_mod0 on tbl using gist (pos) where crt_time between 2017-01-01 and 2017-01-02 and dtype=0; ... create index idx_20170101_mod1 on tbl using gist (pos) where crt_time between 2017-01-01 and 2017-01-02 and dtype=1; ...</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>é€šéä½¿ç”¨å‰é¢çš„åˆ†å€ç´¢å¼•ï¼Œåœ¨è¼¸å…¥æ™‚é–“ç¯„åœæˆ–ç‰¹å®šæ¢ä»¶ä»¥åŸ·è¡Œç©ºé–“æœç´¢å¾Œï¼Œå¯ä»¥å¿«é€Ÿå®šä½ç›®æ¨™æ•¸æ“šã€‚</p><pre>select * from tbl  where crt_time between 2017-01-01 and 2017-01-02 -- Time  and (pos &lt;-&gt; ?) &lt; ? -- Distance to a point to be searched for  and dtype=0 -- Object condition  and ? -- Other conditions  order by pos &lt;-&gt; ? -- Sort by distance  limit ?; -- Number of results to be returned</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>è«‹æ³¨æ„ï¼Œå‰é¢çš„SQLæŸ¥è©¢å¯ä»¥å¯¦ç¾æœ€ä½³æ€§èƒ½å„ªåŒ–ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ç´¢å¼•çµ„ç¹”å½¢å¼ï¼ˆæˆ–ç´¢å¼•çµæ§‹ï¼‰å¯ä»¥ç”±é‚è¼¯åˆ†å€é‡æ–°æ§‹é€ ï¼Œå¯ä»¥ç”¨ä¸Šè¿°é¡ä¼¼çš„ç´¢å¼•å‰µå»ºæ–¹æ³•è¦†è“‹æ‰€æœ‰æ¢ä»¶ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>CTIDç›¸äº¤é™£åˆ—é€£æ¥æƒæ</p><p class=ql-align-justify><br></p><p class=ql-align-justify>å¦‚å‰æ‰€è¿°ï¼ŒBitmapAndå’ŒBitmapOråˆä½µæƒææ˜¯åœ¨å¤šå€‹ç´¢å¼•æˆ–GINç´¢å¼•ä¸­è‡ªå‹•åŸ·è¡Œçš„ã€‚äº‹å¯¦ä¸Šï¼Œé€™ç¨®æƒæä¹Ÿå¯ä»¥åœ¨SQLä¸­é¡¯å¼åŸ·è¡Œã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ¯å€‹æ¢ä»¶æ»²é€å°æ‡‰çš„CTIDã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä½¿ç”¨Intersectæˆ–Unionç”Ÿæˆæ»¿è¶³ç¸½é«”éœ€æ±‚çš„CTIDã€‚ï¼ˆIntersectå°æ‡‰æ–¼â€œandâ€æ¢ä»¶ï¼›unionå°æ‡‰æ–¼â€œorâ€æ¢ä»¶ã€‚ï¼‰</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ç”Ÿæˆä¸€å€‹ctidæ•¸çµ„ã€‚</p><p class=ql-align-justify><br></p><div class=pgc-img><img alt=ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹å‚³æˆçµ¦ä½ é«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12eec69480594db79a5c2452d716e5ea><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>ç¤ºä¾‹</strong></p><div class=pgc-img><img alt=ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹å‚³æˆçµ¦ä½ é«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e465a19e0be74ec5a830bb3d44552fcb><p class=pgc-img-caption>åœ–ç‰‡ä¾†æºï¼šunsplash.com/@markusspiske</p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>1. å‰µå»ºå°è±¡æè¦æ•¸æ“šè¡¨</p><pre>postgres=# create table tbl (id int, info text, crt_time timestamp, pos point, c1 int , c2 int, c3 int ); CREATE TABLE</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>2. å°‡5000è¬æ¢æ¸¬è©¦æ•¸æ“šå¯«å…¥è¡¨ä¸­</p><pre>postgres=# insert into tbl select generate_series(1,50000000), md5(random()::text), clock_timestamp(), point(180-random()*180, 90-random()*90), random()*10000, random()*5000, random()*1000; INSERT 0 50000000</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>3. å‰µå»ºå°è±¡ç´¢å¼•</p><pre>postgres=# create index idx_tbl_1 on tbl using gin (info, c1, c2, c3); CREATE INDEX</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>4. å‰µå»ºæ™‚é–“ç´¢å¼•</p><pre>postgres=# create index idx_tbl_2 on tbl using btree (crt_time); CREATE INDEX</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>5. å‰µå»ºç©ºé–“ç´¢å¼•</p><pre>postgres=# create index idx_tbl_3 on tbl using gist (pos); CREATE INDEX</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>6. ç”Ÿæˆæ•¸æ“šä½ˆå±€ä»¥æ–¹ä¾¿å¾ŒçºŒæŸ¥è©¢</p><pre>postgres=# select min(crt_time),max(crt_time),count(*) from tbl;  min | max | count ----------------------------+----------------------------+----------  2017-07-22 17:59:34.136497 | 2017-07-22 18:01:27.233688 | 50000000 (1 row)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>7. å‰µå»ºä¸€å€‹æ¥µé™KNNæŸ¥è©¢å‡½æ•¸</p><pre>create or replace function ff(point, float8, int) returns setof tid as $declare  v_rec record;  v_limit int := $3; begin  set local enable_seqscan=off; -- Force index that exits when scanned rows reach a specific number  for v_rec in  select *,  (pos &lt;-&gt; $1) as dist,  ctid  from tbl  order by pos &lt;-&gt; $1  loop  if v_limit &lt;=0 then  -- raise notice "Sufficient data obtained"  return;  end if;  if v_rec.dist &gt; $2 then  -- raise notice "All matching points returned"  return;  else  return next v_rec.ctid;  end if;  v_limit := v_limit -1;  end loop; end; $ language plpgsql strict volatile; postgres=# select * from ff(point (100,100) ,100,100) ;  ff -------------  (407383,11)  (640740,9)  (26073,51)  (642750,34) ... (100 rows) Time: 1.061 ms</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>8. CTIDåˆä½µæª¢ç´¢</p><p class=ql-align-justify><br></p><p class=ql-align-justify>é¡¯ç¤ºç¬¦åˆä»¥ä¸‹æ¢ä»¶çš„è¨˜éŒ„</p><pre>( c1 in (1,2,3,4,100,200,99,88,77,66,55)  or c2 &lt; 10 )  and pos &lt;-&gt; point (0,0) &lt; 5  and crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40 ;</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>é¦–å…ˆï¼Œåˆ†åˆ¥æŸ¥çœ‹æ¯å€‹æ¢ä»¶ï¼Œæ‰¾åŒ¹é…ä¸€å€‹æ¢ä»¶çš„è¨˜éŒ„æ•¸é‡ï¼Œä»¥åŠåœ¨ç´¢å¼•æƒæä¸Šæ‰€èŠ±æ™‚é•·ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>1. 54,907æ¢è¨˜éŒ„</strong></p><pre>postgres=# explain (analyze,verbose,timing,costs,buffers) select * from tbl where c1 in (1,2,3,4,100,200,99,88,77,66,55);  QUERY PLAN -------------------------------------------------------------------------------------------------------------------------------  Bitmap Heap Scan on postgres.tbl (cost=820.07..65393.94 rows=54151 width=73) (actual time=23.842..91.911 rows=54907 loops=1)  Output: id, info, crt_time, pos, c1, c2, c3  Recheck Cond: (tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[]))  Heap Blocks: exact=52778  Buffers: shared hit=52866  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..806.54 rows=54151 width=0) (actual time=14.264..14.264 rows=54907 loops=1)  Index Cond: (tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[]))  Buffers: shared hit=88  Planning time: 0.105 ms  Execution time: 94.606 ms (10 rows)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>2. 95,147æ¢è¨˜éŒ„</strong></p><pre>postgres=# explain (analyze,verbose,timing,costs,buffers) select * from tbl where c2&lt;10;  QUERY PLAN ---------------------------------------------------------------------------------------------------------------------------------  Bitmap Heap Scan on postgres.tbl (cost=835.73..112379.10 rows=99785 width=73) (actual time=69.243..179.388 rows=95147 loops=1)  Output: id, info, crt_time, pos, c1, c2, c3  Recheck Cond: (tbl.c2 &lt; 10)  Heap Blocks: exact=88681  Buffers: shared hit=88734  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..810.79 rows=99785 width=0) (actual time=53.612..53.612 rows=95147 loops=1)  Index Cond: (tbl.c2 &lt; 10)  Buffers: shared hit=53  Planning time: 0.094 ms  Execution time: 186.201 ms (10 rows)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>3. 149930æ¢è¨˜éŒ„</strong>ï¼ˆç‚ºå¿«é€Ÿç²å¾—çµæœï¼ŒPostgreSQLä½¿ç”¨ä½åœ–é€²è¡Œåˆä½µæƒæï¼‰</p><pre>postgres=# explain (analyze,verbose,timing,costs,buffers) select * from tbl where c1 in (1,2,3,4,100,200,99,88,77,66,55) or c2 &lt;10;  QUERY PLAN ------------------------------------------------------------------------------------------------------------------------------------  Bitmap Heap Scan on postgres.tbl (cost=1694.23..166303.58 rows=153828 width=73) (actual time=98.988..266.852 rows=149930 loops=1)  Output: id, info, crt_time, pos, c1, c2, c3  Recheck Cond: ((tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[])) OR (tbl.c2 &lt; 10))  Heap Blocks: exact=134424  Buffers: shared hit=134565  -&gt; BitmapOr (cost=1694.23..1694.23 rows=153936 width=0) (actual time=73.763..73.763 rows=0 loops=1)  Buffers: shared hit=141  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..806.54 rows=54151 width=0) (actual time=16.733..16.733 rows=54907 loops=1)  Index Cond: (tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[]))  Buffers: shared hit=88  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..810.79 rows=99785 width=0) (actual time=57.029..57.029 rows=95147 loops=1)  Index Cond: (tbl.c2 &lt; 10)  Buffers: shared hit=53  Planning time: 0.149 ms  Execution time: 274.548 ms (15 rows)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>4. 60,687æ¢è¨˜éŒ„</strong>ï¼ˆå³ä½¿é‹ç”¨å‡ºè‰²çš„KNNæ€§èƒ½å„ªåŒ–ï¼Œä»ç„¶éœ€è¦è€—è²»195æ¯«ç§’ï¼‰ã€‚</p><pre>postgres=# explain (analyze,verbose,timing,costs,buffers) select * from ff(point (0,0) ,5,1000000);  QUERY PLAN ----------------------------------------------------------------------------------------------------------------------  Function Scan on postgres.ff (cost=0.25..10.25 rows=1000 width=6) (actual time=188.563..192.114 rows=60687 loops=1)  Output: ff  Function Call: ff( (0,0) ::point, 5 ::double precision, 1000000)  Buffers: shared hit=61296  Planning time: 0.029 ms  Execution time: 195.097 ms (6 rows)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>è®“æˆ‘å€‘çœ‹çœ‹ä¸ä½¿ç”¨KNNå„ªåŒ–éœ€è¦å¤šé•·æ™‚é–“ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>çµæœéå¸¸ä»¤äººé©šè¨â€”â€”æ¥µé™å„ªåŒ–æ€§èƒ½æé«˜äº†ä¸€å€‹æ•¸é‡ç´šã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>5. 2,640,751æ¢è¨˜éŒ„</strong></p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä½¿ç”¨æ‰€æœ‰ç´¢å¼•é€å€‹æƒææ•¸æ“šæ¢ä»¶ï¼Œå¾—åˆ°ctidä¸¦åŸ·è¡Œctidæƒæã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ç¾åœ¨ï¼Œè®“æˆ‘å€‘ä¾†åˆ†è§£é€™å€‹éç¨‹ï¼š</p><p class=ql-align-justify><br></p><p class=ql-align-justify>é¦–å…ˆï¼Œè®“æˆ‘å€‘çœ‹çœ‹æ™‚é–“å’Œå°è±¡å±¬æ€§çš„åˆä½µæŸ¥è©¢ï¼Œæˆæœéå¸¸é©šäººã€‚ä½¿ç”¨ä½åœ–BitmapOræ™‚ï¼ŒæŸ¥è©¢å¯ä»¥è·³éå¤§å¤šæ•¸æ•¸æ“šå¡Šï¼Œä¸¦ä¸”æƒææ™‚é–“æ¯”å–®ç´¢å¼•æƒæè¦çŸ­ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ³¨æ„ï¼Œåœ¨æ­¤æ­¥é©Ÿä¸­è¨˜éŒ„çš„æ•¸é‡æ¸›å°‘åˆ°7,847æ¢ã€‚</p><p class=ql-align-justify><br></p><pre>postgres=# explain (analyze,verbose,timing,costs,buffers) select ctid from tbl  where crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40  and (  c1 in (1,2,3,4,100,200,99,88,77,66,55)  or  c2 &lt; 10  );  QUERY PLAN -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------  Bitmap Heap Scan on postgres.tbl (cost=35025.85..44822.94 rows=7576 width=6) (actual time=205.577..214.821 rows=7847 loops=1)  Output: ctid  Recheck Cond: (((tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[])) OR (tbl.c2 &lt; 10)) AND (tbl.crt_time &gt;= 2017-07-22 17:59:34 ::timestamp without time zone) AND (tbl.crt_time &lt;= 2017-07-22 17:59:40 ::timestamp without time zone))  Heap Blocks: exact=6983  Buffers: shared hit=14343  -&gt; BitmapAnd (cost=35025.85..35025.85 rows=7581 width=0) (actual time=204.048..204.048 rows=0 loops=1)  Buffers: shared hit=7360  -&gt; BitmapOr (cost=1621.11..1621.11 rows=153936 width=0) (actual time=70.279..70.279 rows=0 loops=1)  Buffers: shared hit=141  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..806.54 rows=54151 width=0) (actual time=15.860..15.860 rows=54907 loops=1)  Index Cond: (tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[]))  Buffers: shared hit=88  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..810.79 rows=99785 width=0) (actual time=54.418..54.418 rows=95147 loops=1)  Index Cond: (tbl.c2 &lt; 10)  Buffers: shared hit=53  -&gt; Bitmap Index Scan on idx_tbl_2 (cost=0.00..33402.60 rows=2462443 width=0) (actual time=127.101..127.101 rows=2640751 loops=1)  Index Cond: ((tbl.crt_time &gt;= 2017-07-22 17:59:34 ::timestamp without time zone) AND (tbl.crt_time &lt;= 2017-07-22 17:59:40 ::timestamp without time zone))  Buffers: shared hit=7219  Planning time: 0.203 ms  Execution time: 216.697 ms (20 rows)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>ç„¶å¾Œï¼Œçœ‹KNNçš„æƒææ™‚é–“ï¼š</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ³¨æ„ï¼Œ60,687æ¢è¨˜éŒ„æ»¿è¶³KNNè·é›¢æ¢ä»¶ï¼Œæ‰€ä»¥æ¥ä¸‹ä¾†å°‡è§£é‡‹CTIDåˆä½µæƒæèˆ‡åŸå§‹æƒæä¹‹é–“çš„æ€§èƒ½æ¯”è¼ƒã€‚</p><p class=ql-align-justify><br></p><pre>postgres=# explain (analyze,verbose,timing,costs,buffers) select * from ff(point (0,0) ,5,1000000);  QUERY PLAN ----------------------------------------------------------------------------------------------------------------------  Function Scan on postgres.ff (cost=0.25..10.25 rows=1000 width=6) (actual time=188.563..192.114 rows=60687 loops=1)  Output: ff  Function Call: ff( (0,0) ::point, 5 ::double precision, 1000000)  Buffers: shared hit=61296  Planning time: 0.029 ms  Execution time: 195.097 ms (6 rows)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>æœ€å¾Œï¼Œå°‡é€™äº›ç‰‡æ®µåˆä½µåˆ°ctidä¸­ã€‚</p><p class=ql-align-justify><br></p><pre>select * from ff(point (0,0) ,5,1000000)  intersect select ctid from tbl  where crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40  and (  c1 in (1,2,3,4,100,200,99,88,77,66,55)  or  c2 &lt; 10  );  ff ------------  (1394,8)  (3892,50)  (6124,45)  (7235,8)  (7607,45)  (11540,8)  (13397,31)  (14266,36)  (18149,7)  (19256,44)  (24671,62)  (26525,64)  (30235,48) (13 rows) Time: 463.012 ms</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>å–å¾—æœ€çµ‚ç´€éŒ„ã€‚</p><p class=ql-align-justify><br></p><pre>select * from tbl where ctid = any ( array( -- array start select * from ff(point (0,0) ,5,1000000) intersect select ctid from tbl  where crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40  and (  c1 in (1,2,3,4,100,200,99,88,77,66,55)  or  c2 &lt; 10  ) ) -- array end );  id | info | crt_time | pos | c1 | c2 | c3 ---------+----------------------------------+----------------------------+----------------------------------------+------+------+-----  104558 | c4699c933d4e2d2a10d828c4ff0b3362 | 2017-07-22 17:59:34.362508 | (4.20534582808614,2.43749532848597) | 99 | 4858 | 543  291950 | 1c2901689ab1eb7653d8ad972f7aa376 | 2017-07-22 17:59:34.776808 | (2.5384977646172,1.09820357523859) | 3 | 2131 | 360  459345 | 9e46548f29d914019ce53a589be8ebac | 2017-07-22 17:59:35.148699 | (0.715781506150961,3.1486327573657) | 1 | 1276 | 8  542633 | c422d6137f9111d5c2dc723b40c7023f | 2017-07-22 17:59:35.334278 | (0.0631888210773468,2.2334903664887) | 4968 | 3 | 245  570570 | fc57bfc6b7781d89b17c90417bd306f7 | 2017-07-22 17:59:35.39653 | (3.14926156774163,1.04107855819166) | 88 | 2560 | 561  865508 | 34509c7f7640afaf288a5e1d38199701 | 2017-07-22 17:59:36.052573 | (3.12869547866285,2.34822122845799) | 2 | 65 | 875  1004806 | afe9f88cbebf615a7ae5f41180c4b33f | 2017-07-22 17:59:36.362027 | (1.13972157239914,3.28763140831143) | 3 | 1639 | 208  1069986 | 6b9f27bfde993fb0bae3336ac010af7a | 2017-07-22 17:59:36.507775 | (4.51995821669698,2.08761331625283) | 2 | 200 | 355  1361182 | 7c4c1c208c2b2b21f00772c43955d238 | 2017-07-22 17:59:37.155127 | (1.7334086727351,2.18367457855493) | 9742 | 0 | 232  1444244 | 41bf6f8e4b89458c13fb408a7db05284 | 2017-07-22 17:59:37.339594 | (0.52773853763938,2.16670122463256) | 1 | 2470 | 820  1850387 | 6e0011c6db76075edd2aa7f81ec94129 | 2017-07-22 17:59:38.243091 | (0.0168232340365648,0.420973123982549) | 100 | 4395 | 321  1989439 | 6211907ac254a4a3ca54f90822a2095e | 2017-07-22 17:59:38.551637 | (0.0274275150150061,0.490507003851235) | 1850 | 5 | 74  2267673 | 898fdd54dcc5b14c27cf1c8b9afe2471 | 2017-07-22 17:59:39.170035 | (0.394239127635956,2.86229319870472) | 2892 | 6 | 917 (13 rows) Time: 462.715 ms</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>éç¨‹èŠ±è²»462æ¯«ç§’ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>9. æ¸¬è©¦åŸå§‹SQLæŸ¥è©¢çš„æ€§èƒ½: PostgreSQL Multi-Index BitmapAnd and BitmapOrè·³éæƒæ</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ç›´æ¥ç·¨å¯«SQLæŸ¥è©¢ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¤šCTIDæƒæã€‚</p><pre>postgres=# explain (analyze,verbose,timing,costs,buffers) select * from tbl  where  crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40  and (  c1 in (1,2,3,4,100,200,99,88,77,66,55)  or  c2 &lt; 10  )  and  pos &lt;-&gt; point (0,0) &lt; 5;  Bitmap Heap Scan on postgres.tbl (cost=35022.06..44857.06 rows=2525 width=73) (actual time=205.542..214.547 rows=13 loops=1)  Output: id, info, crt_time, pos, c1, c2, c3  Recheck Cond: (((tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[])) OR (tbl.c2 &lt; 10)) AND (tbl.crt_time &gt;= 2017-07-22 17:59:34 ::timestamp without time zone) AND (tbl.crt_time &lt;= 2017-07-22 17:59:40 ::timestamp without time zone))  Filter: ((tbl.pos &lt;-&gt; (0,0) ::point) &lt; 5 ::double precision)  Rows Removed by Filter: 7834  Heap Blocks: exact=6983  Buffers: shared hit=14343  -&gt; BitmapAnd (cost=35022.06..35022.06 rows=7581 width=0) (actual time=203.620..203.620 rows=0 loops=1)  Buffers: shared hit=7360  -&gt; BitmapOr (cost=1618.58..1618.58 rows=153936 width=0) (actual time=71.660..71.660 rows=0 loops=1)  Buffers: shared hit=141  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..806.54 rows=54151 width=0) (actual time=14.861..14.861 rows=54907 loops=1)  Index Cond: (tbl.c1 = ANY ( {1,2,3,4,100,200,99,88,77,66,55} ::integer[]))  Buffers: shared hit=88  -&gt; Bitmap Index Scan on idx_tbl_1 (cost=0.00..810.79 rows=99785 width=0) (actual time=56.797..56.797 rows=95147 loops=1)  Index Cond: (tbl.c2 &lt; 10)  Buffers: shared hit=53  -&gt; Bitmap Index Scan on idx_tbl_2 (cost=0.00..33402.60 rows=2462443 width=0) (actual time=125.255..125.255 rows=2640751 loops=1)  Index Cond: ((tbl.crt_time &gt;= 2017-07-22 17:59:34 ::timestamp without time zone) AND (tbl.crt_time &lt;= 2017-07-22 17:59:40 ::timestamp without time zone))  Buffers: shared hit=7219  Planning time: 0.160 ms  Execution time: 216.797 ms (22 rows)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>æ€§èƒ½å¦‚é æœŸçš„é‚£æ¨£å¥½ï¼Œä¹‹å‰è§£é‡‹éåŸå› ã€‚KNNæ¢ä»¶ä»¥å¤–çš„æ¢ä»¶å·²ç¶“å°‡çµæœæ”¶æ–‚åˆ°7,000æ¢è¨˜éŒ„ï¼Œå› æ­¤æ²’æœ‰å¿…è¦ä½¿ç”¨åŒ…å«KNNæ¢ä»¶çš„ç´¢å¼•ã€‚ï¼ˆå³ä½¿ä½¿ç”¨KNNç´¢å¼•ä¹Ÿéœ€è¦195æ¯«ç§’ï¼Œå› ç‚ºæœ‰60,687æ¢è¨˜éŒ„æ»¿è¶³KNNæ¢ä»¶ã€‚ï¼‰</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ ¡é©—çµæœï¼š</p><pre>select * from tbl  where  crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40  and (  c1 in (1,2,3,4,100,200,99,88,77,66,55)  or  c2 &lt; 10  )  and  pos &lt;-&gt; point (0,0) &lt; 5;  id | info | crt_time | pos | c1 | c2 | c3 ---------+----------------------------------+----------------------------+----------------------------------------+------+------+-----  104558 | c4699c933d4e2d2a10d828c4ff0b3362 | 2017-07-22 17:59:34.362508 | (4.20534582808614,2.43749532848597) | 99 | 4858 | 543  291950 | 1c2901689ab1eb7653d8ad972f7aa376 | 2017-07-22 17:59:34.776808 | (2.5384977646172,1.09820357523859) | 3 | 2131 | 360  459345 | 9e46548f29d914019ce53a589be8ebac | 2017-07-22 17:59:35.148699 | (0.715781506150961,3.1486327573657) | 1 | 1276 | 8  542633 | c422d6137f9111d5c2dc723b40c7023f | 2017-07-22 17:59:35.334278 | (0.0631888210773468,2.2334903664887) | 4968 | 3 | 245  570570 | fc57bfc6b7781d89b17c90417bd306f7 | 2017-07-22 17:59:35.39653 | (3.14926156774163,1.04107855819166) | 88 | 2560 | 561  865508 | 34509c7f7640afaf288a5e1d38199701 | 2017-07-22 17:59:36.052573 | (3.12869547866285,2.34822122845799) | 2 | 65 | 875  1004806 | afe9f88cbebf615a7ae5f41180c4b33f | 2017-07-22 17:59:36.362027 | (1.13972157239914,3.28763140831143) | 3 | 1639 | 208  1069986 | 6b9f27bfde993fb0bae3336ac010af7a | 2017-07-22 17:59:36.507775 | (4.51995821669698,2.08761331625283) | 2 | 200 | 355  1361182 | 7c4c1c208c2b2b21f00772c43955d238 | 2017-07-22 17:59:37.155127 | (1.7334086727351,2.18367457855493) | 9742 | 0 | 232  1444244 | 41bf6f8e4b89458c13fb408a7db05284 | 2017-07-22 17:59:37.339594 | (0.52773853763938,2.16670122463256) | 1 | 2470 | 820  1850387 | 6e0011c6db76075edd2aa7f81ec94129 | 2017-07-22 17:59:38.243091 | (0.0168232340365648,0.420973123982549) | 100 | 4395 | 321  1989439 | 6211907ac254a4a3ca54f90822a2095e | 2017-07-22 17:59:38.551637 | (0.0274275150150061,0.490507003851235) | 1850 | 5 | 74  2267673 | 898fdd54dcc5b14c27cf1c8b9afe2471 | 2017-07-22 17:59:39.170035 | (0.394239127635956,2.86229319870472) | 2892 | 6 | 917 (13 rows)</pre><p class=ql-align-justify><br></p><div class=pgc-img><img alt=ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹å‚³æˆçµ¦ä½ é«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12eec69480594db79a5c2452d716e5ea><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>åˆ†å€ç´¢å¼•ç¤ºä¾‹</strong></p><p class=ql-align-justify><br></p><p class=ql-align-justify>å‡è¨­å‰é¢çš„æŸ¥è©¢æ¢ä»¶ä¿æŒä¸è®Šï¼Œä½¿ç”¨åˆ†å€ç´¢å¼•ä¾†æ¸¬è©¦æ€§èƒ½ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>é€™æ˜¯ç‚ºäº†æ¼”ç¤ºåˆ†å€ç´¢å¼•çš„æ¥µç«¯æ•ˆæœã€‚åœ¨å¯¦éš›å ´æ™¯ä¸­ï¼Œé›†åˆç´šåˆ¥å¯èƒ½æ²’æœ‰é‚£éº¼é«˜ï¼ˆä¾‹å¦‚æŒ‰å¤©é›†åˆæˆ–æŒ‰IDæ•£åˆ—é›†åˆï¼‰ã€‚åªè¦é›†åˆæ˜¯å¯èƒ½çš„ï¼Œå°±å¯ä»¥å±•ç¾å‡ºè‰²çš„æ€§èƒ½ã€‚</p><pre>postgres=# create index idx_tbl_4 on tbl using gist (pos) where crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40  and (  c1 in (1,2,3,4,100,200,99,88,77,66,55)  or  c2 &lt; 10  ) ; CREATE INDEX Time: 8359.330 ms (00:08.359)</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>é‡æ§‹æ¥µå€¼KNNå„ªåŒ–å‡½æ•¸</p><pre>create or replace function ff(point, float8, int) returns setof record as $declare  v_rec record;  v_limit int := $3; begin  set local enable_seqscan=off; -- Force index that exits when scanned rows reach a specific number  for v_rec in  select *,  (pos &lt;-&gt; $1) as dist  from tbl  where  crt_time between 2017-07-22 17:59:34 and 2017-07-22 17:59:40  and (  c1 in (1,2,3,4,100,200,99,88,77,66,55)  or  c2 &lt; 10  )  order by pos &lt;-&gt; $1  loop  if v_limit &lt;=0 then  -- raise notice "Sufficient data obtained"  return;  end if;  if v_rec.dist &gt; $2 then  -- raise notice "All matching points returned"  return;  else  return next v_rec;  end if;  v_limit := v_limit -1;  end loop; end; $ language plpgsql strict volatile;</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>æŸ¥è©¢æ€§èƒ½ï¼š</p><pre>postgres=# select * from ff(point (0,0) , 5, 10000000) as t(id int, info text, crt_time timestamp, pos point, c1 int, c2 int, c3 int, dist float8);  id | info | crt_time | pos | c1 | c2 | c3 | dist ---------+----------------------------------+----------------------------+----------------------------------------+------+------+-----+-------------------  1850387 | 6e0011c6db76075edd2aa7f81ec94129 | 2017-07-22 17:59:38.243091 | (0.0168232340365648,0.420973123982549) | 100 | 4395 | 321 | 0.421309141034319  1989439 | 6211907ac254a4a3ca54f90822a2095e | 2017-07-22 17:59:38.551637 | (0.0274275150150061,0.490507003851235) | 1850 | 5 | 74 | 0.49127323294376  1444244 | 41bf6f8e4b89458c13fb408a7db05284 | 2017-07-22 17:59:37.339594 | (0.52773853763938,2.16670122463256) | 1 | 2470 | 820 | 2.23004532710301  542633 | c422d6137f9111d5c2dc723b40c7023f | 2017-07-22 17:59:35.334278 | (0.0631888210773468,2.2334903664887) | 4968 | 3 | 245 | 2.23438404136508  291950 | 1c2901689ab1eb7653d8ad972f7aa376 | 2017-07-22 17:59:34.776808 | (2.5384977646172,1.09820357523859) | 3 | 2131 | 360 | 2.76586731309247  1361182 | 7c4c1c208c2b2b21f00772c43955d238 | 2017-07-22 17:59:37.155127 | (1.7334086727351,2.18367457855493) | 9742 | 0 | 232 | 2.78803520274409  2267673 | 898fdd54dcc5b14c27cf1c8b9afe2471 | 2017-07-22 17:59:39.170035 | (0.394239127635956,2.86229319870472) | 2892 | 6 | 917 | 2.88931598221975  459345 | 9e46548f29d914019ce53a589be8ebac | 2017-07-22 17:59:35.148699 | (0.715781506150961,3.1486327573657) | 1 | 1276 | 8 | 3.22896754478952  570570 | fc57bfc6b7781d89b17c90417bd306f7 | 2017-07-22 17:59:35.39653 | (3.14926156774163,1.04107855819166) | 88 | 2560 | 561 | 3.31688000783581  1004806 | afe9f88cbebf615a7ae5f41180c4b33f | 2017-07-22 17:59:36.362027 | (1.13972157239914,3.28763140831143) | 3 | 1639 | 208 | 3.47958123047986  865508 | 34509c7f7640afaf288a5e1d38199701 | 2017-07-22 17:59:36.052573 | (3.12869547866285,2.34822122845799) | 2 | 65 | 875 | 3.91188935630676  104558 | c4699c933d4e2d2a10d828c4ff0b3362 | 2017-07-22 17:59:34.362508 | (4.20534582808614,2.43749532848597) | 99 | 4858 | 543 | 4.86069100130757  1069986 | 6b9f27bfde993fb0bae3336ac010af7a | 2017-07-22 17:59:36.507775 | (4.51995821669698,2.08761331625283) | 2 | 200 | 355 | 4.97877009299311 (13 rows) Time: 0.592 ms</pre><p class=ql-align-justify><br></p><p class=ql-align-justify>å¤ªæ£’äº†ï¼æŸ¥è©¢æ™‚é–“å¾200æ¯«ç§’æ¸›å°‘åˆ°1æ¯«ç§’ä»¥å…§ã€‚</p><p class=ql-align-justify><br></p><div class=pgc-img><img alt=ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹å‚³æˆçµ¦ä½ é«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/12eec69480594db79a5c2452d716e5ea><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>å„ªåŒ–æ–¹æ³•ç¶œè¿°</strong></p><p class=ql-align-justify><br></p><p class=ql-align-justify>å„ªåŒ–æ–¹æ³•å›é¡§ï¼š</p><p class=ql-align-justify><br></p><p class=ql-align-justify>1. ç‚ºä¸åŒçš„æ•¸æ“šé¡å‹æ§‹å»ºä¸åŒçš„ç´¢å¼•ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ä¾‹å¦‚ï¼Œå°ç©ºé–“ä½¿ç”¨GiSTæˆ–SP-GiSTç´¢å¼•ï¼Œå°æ™‚é–“ä½¿ç”¨Bæ¨¹æˆ–BRINç´¢å¼•ï¼Œå°å¤šå€‹å°è±¡å±¬æ€§ä½¿ç”¨GINç´¢å¼•ã€‚ç´¢å¼•çš„ç›®çš„æ˜¯ç¸®å°æ•¸æ“šæƒæçš„ç¯„åœã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>2. æ–¹æ³•äº”æåˆ°æ•¸æ“šåˆ†å€ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ•¸æ“šåˆ†å€çš„ç›®çš„æ˜¯æœ‰æ„åœ°çµ„ç¹”æ•¸æ“šï¼Œé€™æ„å‘³è‘—æœ‰æ„åœ°çµ„ç¹”æ•¸æ“šä»¥æ»¿è¶³æœç´¢éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ™‚é–“æ˜¯å¿…éœ€çš„æŸ¥è©¢æ¢ä»¶æˆ–å…¬å…±æŸ¥è©¢æ¢ä»¶ï¼Œé‚£éº¼å¯ä»¥æŒ‰æ™‚é–“ï¼ˆåˆ†å€ï¼‰åˆ†å‰²æ•¸æ“šï¼Œä»¥æ¸›å°‘éœ€è¦æƒæçš„æ•¸æ“šé‡ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>3. æ–¹æ³•å…­æè¿°äº†ç´¢å¼•åˆ†å€ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>ç›®çš„é¡ä¼¼æ–¼æ–¹æ³•äº”ã€‚æ–¹æ³•äº”å’Œæ–¹æ³•å…­çš„å€åˆ¥åœ¨æ–¼åˆ†å€åœ¨ç´¢å¼•ç´šåˆ¥ä½¿ç”¨ï¼Œå› æ­¤ç•¶åŸ·è¡Œç´¢å¼•æƒææ™‚ï¼Œæ•¸æ“šå‘½ä¸­ç‡æœƒç›´æ¥æé«˜ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>4.æ–¹æ³•ä¸ƒä¸­çš„ctidåˆä½µæƒæé¡ä¼¼æ–¼PostgreSQLä¸­çš„å¤šç´¢å¼•bitmapAndæˆ–bitmapOræƒæã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>bitmapAnd/bitmapOrè·³éä¸éœ€è¦æƒæçš„å¡Šï¼Œæ–¹æ³•ä¸ƒä¸­çš„ctidåˆä½µæƒæè·³éä¸éœ€è¦æƒæçš„è¡Œã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>åˆä½µå¾å¤šå€‹ç´¢å¼•æƒæç²å¾—çš„ctidã€‚è·³éä¸éœ€è¦æƒæçš„è¡Œæ•¸ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>å¦‚æœç•¶å…¶ä»–æ¢ä»¶ç‚ºâ€œANDâ€æ™‚ï¼Œéæ¿¾æ¢ä»¶å¯ä»¥é¡¯è‘—æ¸›å°‘ctidï¼ˆè¨˜éŒ„ï¼‰ï¼Œå‰‡æ²’æœ‰å¿…è¦ä½¿ç”¨ctidåˆä½µæƒæã€‚ç›¸åï¼Œä½¿ç”¨FILTERä½œç‚ºå¦ä¸€å€‹æ¢ä»¶ã€‚ï¼ˆé€™å°‡ç•¥å¾®å¢åŠ CPUé–‹éŠ·ã€‚ï¼‰</p><p class=ql-align-justify><br></p><p class=ql-align-justify>5. æœ€å¥½çš„åŠŸå¤«ç¸½æ˜¯ä»¥æœ€å¤§çš„éˆæ´»æ€§ã€è‡ªç”±å’Œå°æ¯ä¸€å€‹å‹•ä½œçš„ç„¡é™æƒ³è±¡ç‚ºç‰¹å¾µã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>PostgreSQLå¯¦ç¾å¤šç´¢å¼•BitmapAndæˆ–BitmapOræƒæï¼Œé¡¯è‘—æé«˜äº†å¤šç¨®æ¢ä»¶ï¼ˆç´¢å¼•ï¼‰ä¸‹çš„æ•¸æ“šå‘½ä¸­ç‡ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ­¤å¤–ï¼ŒPostgreSQLå…·æœ‰å‡ºè‰²çš„CBOä¼°è¨ˆæ©Ÿåˆ¶ï¼Œå®ƒå…è¨±PostgreSQLä¸ç¸½æ˜¯ä½¿ç”¨ä½åœ–åˆä½µæƒæçš„æ‰€æœ‰ç´¢å¼•ã€‚é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼åœ¨â€œæ¸¬è©¦åŸå§‹SQLæŸ¥è©¢çš„æ€§èƒ½â€”â€”PostgreSQLå¤šç´¢å¼•BitmapAndä½åœ–æˆ–è·³éæƒæâ€ä¸€ç¯€ä¸­æè¿°çš„æ€§èƒ½æ›´å¥½ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>6. å¦‚ä½•å¯¦ç¾æ¥µç«¯å„ªåŒ–</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æ¡ç”¨æ–¹æ³•äº”æˆ–å…­ï¼Œä¸¦ä½¿ç”¨å¯ä¿®å¾©çš„æ¢ä»¶ä½œç‚ºåˆ†å€éµä¾†åˆ†å€æ•¸æ“šæˆ–ç´¢å¼•ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>å°æ–¼å…¶ä»–æ¢ä»¶ï¼Œå¯ä»¥ä½¿ç”¨PostgreSQLä¸­çš„å¤šç´¢å¼•BitmapAndæˆ–BitmapOræƒæä¾†æé«˜å¤šæ¢ä»¶ï¼ˆç´¢å¼•ï¼‰çš„æ•¸æ“šå‘½ä¸­ç‡ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>æˆ‘å€‘å¯ä»¥çœ‹åˆ°ï¼ŒæŒ‰ç…§æ™‚é–“ã€ç©ºé–“å’Œå°è±¡å±¬æ€§å¾5,000è¬æ•¸æ“šå¡Šä¸­é€²è¡Œå¤šç¶­æª¢ç´¢æ‰€éœ€çš„æ™‚é–“æ¸›å°‘åˆ°äº†0.592æ¯«ç§’ã€‚</p><p class=ql-align-justify><br></p><p class=ql-align-justify>7. å°æ–¼ç©ºé–“æ•¸æ“šï¼Œé™¤äº†ä½¿ç”¨GiSTç´¢å¼•ï¼Œæˆ‘å€‘é‚„å¯ä»¥ä½¿ç”¨BRINç´¢å¼•ï¼Œé€™é™ä½äº†æˆæœ¬ã€‚æœ‰æ¢ç†åœ°çµ„ç¹”æ•¸æ“šå¾Œï¼Œæœƒä½¿æ¿¾æ³¢æ€§èƒ½è‰¯å¥½ã€‚</p><p class=ql-align-justify><br></p><div class=pgc-img><img alt=ç”¨è©³ç´°çš„ä»£ç¢¼ï¼Œæ‰‹æŠŠæ‰‹å‚³æˆçµ¦ä½ é«˜æ•ˆæœç´¢æ³•çš„çµ•æŠ€ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fb8e52a4a8b948939d158b49ce53b8a2><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>ç•™è¨€ é»è´Š é—œæ³¨</strong></p><p class=ql-align-center><strong>æˆ‘å€‘ä¸€èµ·åˆ†äº«AIå­¸ç¿’èˆ‡ç™¼å±•çš„ä¹¾è²¨</strong></p><p>ç·¨è­¯çµ„ï¼šæç¾å°¼ã€é¤˜æ›¸æ•</p><p>ç›¸é—œéˆæ¥ï¼š</p><p>https://dzone.com/articles/efficient-search-on-massive-data-with-multidimensi</p><p>å¦‚éœ€è½‰è¼‰ï¼Œè«‹å¾Œè‡ºç•™è¨€ï¼Œéµå®ˆè½‰è¼‰è¦ç¯„</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>è©³ç´°</a></li><li><a>ä»£ç¢¼</a></li><li><a>å‚³æˆçµ¦</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/cae5a51a.html alt=ã€Œæ–½å·¥æŠ€å·§ã€è©³ç´°ç­è§£å…‰çºœã€çµ‚ç«¯ç›’ã€å°¾çº–çš„æ¥æ³•å’Œå…‰çº–å„ç¨®æ¥å£ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/decf8edb02a34404b92b86681378575f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cae5a51a.html title=ã€Œæ–½å·¥æŠ€å·§ã€è©³ç´°ç­è§£å…‰çºœã€çµ‚ç«¯ç›’ã€å°¾çº–çš„æ¥æ³•å’Œå…‰çº–å„ç¨®æ¥å£>ã€Œæ–½å·¥æŠ€å·§ã€è©³ç´°ç­è§£å…‰çºœã€çµ‚ç«¯ç›’ã€å°¾çº–çš„æ¥æ³•å’Œå…‰çº–å„ç¨®æ¥å£</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/47bcd6a6.html alt=è©³ç´°ç­è§£å…‰çºœã€çµ‚ç«¯ç›’ã€å°¾çº–çš„æ¥æ³•å’Œå…‰çº–å„ç¨®æ¥å£ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/dcdae811e636496d948cf5a745f470fc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/47bcd6a6.html title=è©³ç´°ç­è§£å…‰çºœã€çµ‚ç«¯ç›’ã€å°¾çº–çš„æ¥æ³•å’Œå…‰çº–å„ç¨®æ¥å£>è©³ç´°ç­è§£å…‰çºœã€çµ‚ç«¯ç›’ã€å°¾çº–çš„æ¥æ³•å’Œå…‰çº–å„ç¨®æ¥å£</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e145517c.html alt=è©³ç´°è§£æè®Šå£“å™¨å¦‚ä½•æ¥åœ°ï¼Ÿæ¥åœ°çš„ä¸»è¦ä½œç”¨æ˜¯ä»€éº¼ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/dfic-imagehandler/ab7c98a3-daad-418d-8b72-e584bca53b42 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e145517c.html title=è©³ç´°è§£æè®Šå£“å™¨å¦‚ä½•æ¥åœ°ï¼Ÿæ¥åœ°çš„ä¸»è¦ä½œç”¨æ˜¯ä»€éº¼ï¼Ÿ>è©³ç´°è§£æè®Šå£“å™¨å¦‚ä½•æ¥åœ°ï¼Ÿæ¥åœ°çš„ä¸»è¦ä½œç”¨æ˜¯ä»€éº¼ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c36f4ae6.html alt=æ‰‹æ¨å…¬å¼ï¼šLSTMå–®å…ƒæ¢¯åº¦çš„è©³ç´°çš„æ•¸å­¸æ¨å° class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/68dcd30ac0c0469a9bb85ea2bc9f3e8c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c36f4ae6.html title=æ‰‹æ¨å…¬å¼ï¼šLSTMå–®å…ƒæ¢¯åº¦çš„è©³ç´°çš„æ•¸å­¸æ¨å°>æ‰‹æ¨å…¬å¼ï¼šLSTMå–®å…ƒæ¢¯åº¦çš„è©³ç´°çš„æ•¸å­¸æ¨å°</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ab2d9a76.html alt=é½’è¼ªçš„å‰ä¸–ä»Šç”Ÿï¼Œä½ ç­è§£é½’è¼ªå—ï¼Œè©³ç´°è¬›è§£é½’è¼ªä¹¾è²¨çŸ¥è­˜å¤§å…¨ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/8efc9a2a67ca4b86816d4ccc86ebeddb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ab2d9a76.html title=é½’è¼ªçš„å‰ä¸–ä»Šç”Ÿï¼Œä½ ç­è§£é½’è¼ªå—ï¼Œè©³ç´°è¬›è§£é½’è¼ªä¹¾è²¨çŸ¥è­˜å¤§å…¨>é½’è¼ªçš„å‰ä¸–ä»Šç”Ÿï¼Œä½ ç­è§£é½’è¼ªå—ï¼Œè©³ç´°è¬›è§£é½’è¼ªä¹¾è²¨çŸ¥è­˜å¤§å…¨</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/44c014a1.html alt=SpringBootäº‹å‹™è©³ç´°ç°¡ä»‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/44c014a1.html title=SpringBootäº‹å‹™è©³ç´°ç°¡ä»‹>SpringBootäº‹å‹™è©³ç´°ç°¡ä»‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8f75e8bc.html alt=å°ç±³CC9è©³ç´°é…ç½®æ›å…‰ï¼Œé™¤ä¸€å„„åƒç´ å¤–é‚„æœ‰é€™äº› class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/945b634aba484be4b4695eb29ee43be4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8f75e8bc.html title=å°ç±³CC9è©³ç´°é…ç½®æ›å…‰ï¼Œé™¤ä¸€å„„åƒç´ å¤–é‚„æœ‰é€™äº›>å°ç±³CC9è©³ç´°é…ç½®æ›å…‰ï¼Œé™¤ä¸€å„„åƒç´ å¤–é‚„æœ‰é€™äº›</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e71fb88c.html alt=å’Œéºµã€æ‰éºµæŠ€å·§ï¼Œè¦–é »è©³ç´°è¬›è§£ï¼Œ10å¹´å’Œéºµç¶“é©—ï¼Œå…¨éƒ¨å‘Šè¨´ä½  class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/8cd49cb368f1488b8c4a65a3fe556d75 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e71fb88c.html title=å’Œéºµã€æ‰éºµæŠ€å·§ï¼Œè¦–é »è©³ç´°è¬›è§£ï¼Œ10å¹´å’Œéºµç¶“é©—ï¼Œå…¨éƒ¨å‘Šè¨´ä½ >å’Œéºµã€æ‰éºµæŠ€å·§ï¼Œè¦–é »è©³ç´°è¬›è§£ï¼Œ10å¹´å’Œéºµç¶“é©—ï¼Œå…¨éƒ¨å‘Šè¨´ä½ </a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a4050af4.html alt=ç£šç‰†ç”¨ç£šæ•¸é‡æœ€è©³ç´°çš„è¨ˆç®—æ–¹æ³•ï¼Œè¶•ç·Šæ”¶äº†å§ï¼ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15389175813757a3d0f3b61 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a4050af4.html title=ç£šç‰†ç”¨ç£šæ•¸é‡æœ€è©³ç´°çš„è¨ˆç®—æ–¹æ³•ï¼Œè¶•ç·Šæ”¶äº†å§ï¼>ç£šç‰†ç”¨ç£šæ•¸é‡æœ€è©³ç´°çš„è¨ˆç®—æ–¹æ³•ï¼Œè¶•ç·Šæ”¶äº†å§ï¼</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bcc93b8c.html alt=è©³ç´°åœ–è§£åœ°çƒè‡ªè½‰èˆ‡å…¬è½‰çš„é»ƒèµ¤äº¤è§’å¦‚ä½•å½¢æˆå››å­£æ›´æ› class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6acd8115d8fe4cf1b1b1bbce7e353cea style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bcc93b8c.html title=è©³ç´°åœ–è§£åœ°çƒè‡ªè½‰èˆ‡å…¬è½‰çš„é»ƒèµ¤äº¤è§’å¦‚ä½•å½¢æˆå››å­£æ›´æ›>è©³ç´°åœ–è§£åœ°çƒè‡ªè½‰èˆ‡å…¬è½‰çš„é»ƒèµ¤äº¤è§’å¦‚ä½•å½¢æˆå››å­£æ›´æ›</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2c21f6c7.html alt=é–‹é—œç«™ã€é…é›»å®¤å·¥ç¨‹è©³ç´°è¬›è§£ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/aafe3cdc82ec496a9a5feb3ed29355b9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2c21f6c7.html title=é–‹é—œç«™ã€é…é›»å®¤å·¥ç¨‹è©³ç´°è¬›è§£>é–‹é—œç«™ã€é…é›»å®¤å·¥ç¨‹è©³ç´°è¬›è§£</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/882f16a4.html alt=é˜¿é‡ŒJavaå¯¦ç¿’äº”é¢è©³ç´°é¢ç¶“ï¼Œå·²æ‹¿offerï¼ï¼ˆé™„å¸¶é¢è©¦é¡Œè§£ç­”ï¼‰ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/edaf055d-b7a3-43d4-9a68-c18f27a83d2d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/882f16a4.html title=é˜¿é‡ŒJavaå¯¦ç¿’äº”é¢è©³ç´°é¢ç¶“ï¼Œå·²æ‹¿offerï¼ï¼ˆé™„å¸¶é¢è©¦é¡Œè§£ç­”ï¼‰>é˜¿é‡ŒJavaå¯¦ç¿’äº”é¢è©³ç´°é¢ç¶“ï¼Œå·²æ‹¿offerï¼ï¼ˆé™„å¸¶é¢è©¦é¡Œè§£ç­”ï¼‰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e00f2825.html alt=é½’è¼ªæ³µçš„å·¥ä½œåŸç†åŠåŸºæœ¬çŸ¥è­˜æœ¬æ–‡è©³ç´°è¬›è§£ï¼Œå€¼å¾—æ”¶è—å­¸ç¿’ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/4379a3d5556d4946993e223cb0f120c1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e00f2825.html title=é½’è¼ªæ³µçš„å·¥ä½œåŸç†åŠåŸºæœ¬çŸ¥è­˜æœ¬æ–‡è©³ç´°è¬›è§£ï¼Œå€¼å¾—æ”¶è—å­¸ç¿’>é½’è¼ªæ³µçš„å·¥ä½œåŸç†åŠåŸºæœ¬çŸ¥è­˜æœ¬æ–‡è©³ç´°è¬›è§£ï¼Œå€¼å¾—æ”¶è—å­¸ç¿’</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4482b7d0.html alt=åŸºåº•ç¯€çš„è©³ç´°è§£å‰– class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/d6f56a9b58944e24a146f659e40add50 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4482b7d0.html title=åŸºåº•ç¯€çš„è©³ç´°è§£å‰–>åŸºåº•ç¯€çš„è©³ç´°è§£å‰–</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c9ad6a3e.html alt=ï¼ˆ1-2æˆ‘å€‘çš„ç¬¬ä¸€æ®µPHPä»£ç¢¼ï¼‰phpåŸºç¤phpå­¸ç¿’åŸºç¤å¯¦ä¾‹ä»£ç¢¼æ“ä½œæ•™ç¨‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b707f4e4acce41bda439262a966603f8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c9ad6a3e.html title=ï¼ˆ1-2æˆ‘å€‘çš„ç¬¬ä¸€æ®µPHPä»£ç¢¼ï¼‰phpåŸºç¤phpå­¸ç¿’åŸºç¤å¯¦ä¾‹ä»£ç¢¼æ“ä½œæ•™ç¨‹>ï¼ˆ1-2æˆ‘å€‘çš„ç¬¬ä¸€æ®µPHPä»£ç¢¼ï¼‰phpåŸºç¤phpå­¸ç¿’åŸºç¤å¯¦ä¾‹ä»£ç¢¼æ“ä½œæ•™ç¨‹</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>