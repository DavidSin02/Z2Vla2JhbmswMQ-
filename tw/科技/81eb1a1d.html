<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>區塊鏈研究實驗室｜減少智能合約代碼複雜性並提高可維護性 | 极客快訊</title><meta property="og:title" content="區塊鏈研究實驗室｜減少智能合約代碼複雜性並提高可維護性 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/7087a95e358c43079138036c9e6c423d"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/81eb1a1d.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/81eb1a1d.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/81eb1a1d.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/81eb1a1d.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/81eb1a1d.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/81eb1a1d.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/81eb1a1d.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/81eb1a1d.html><meta property="article:published_time" content="2020-11-14T21:05:50+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:50+08:00"><meta name=Keywords content><meta name=description content="區塊鏈研究實驗室｜減少智能合約代碼複雜性並提高可維護性"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/81eb1a1d.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>區塊鏈研究實驗室｜減少智能合約代碼複雜性並提高可維護性</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>在本文中，我將分享一些示例，說明消除特殊情況如何減少代碼複雜性並提高可維護性。</p><p><strong>特殊最大值</strong></p><p>常見的特殊情況是使用0表示“無最大值”。這種特殊情況通常很容易消除。</p><p><strong>Special Expirations</strong></p><p>看下面的代碼<strong></strong></p><div class=pgc-img><img alt=區塊鏈研究實驗室｜減少智能合約代碼複雜性並提高可維護性 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7087a95e358c43079138036c9e6c423d><p class=pgc-img-caption></p></div><p>在這段代碼中，0是一種特殊情況，表示“沒有過期”。這種特殊情況是不直觀的，它增加了require語句的複雜性。</p><p>然而，真正的危險是團隊中的一個新開發人員忽略了這個微妙之處，無法處理expiration==0的特殊情況。這很容易導致資金損失或其他嚴重問題。</p><p>這樣代碼就更簡單更明顯了：</p><div class=pgc-img><img alt=區塊鏈研究實驗室｜減少智能合約代碼複雜性並提高可維護性 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f027ba020a984f87a4455aa9675d0329><p class=pgc-img-caption></p></div><p>這裡，我使用的是uint256允許的最大值的expiration，而不是0，當涉及到時間戳時，expiration實際上是無限的。</p><p><strong>特殊最大以太幣數量</strong></p><p>這是一個非常相似的示例，但這次涉及以太幣：</p><div class=pgc-img><img alt=區塊鏈研究實驗室｜減少智能合約代碼複雜性並提高可維護性 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c3c13719a0ec492a97bdb243df720f01><p class=pgc-img-caption></p></div><p>同樣，我們有一個非直觀的特例，我們可以通過使用一個有效的無限值來解決這個問題：</p><div class=pgc-img><img alt=區塊鏈研究實驗室｜減少智能合約代碼複雜性並提高可維護性 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/716fe4f1fe2a4afca8687ca8d1a415f2><p class=pgc-img-caption></p></div><p><strong>2256-1是最大值</strong></p><p>注意，同樣的技巧可以概括為令牌數量或任何值。由於Solidity不能表示大於2256-1的值，因此它始終可以與uint256進行比較，成為“有效無限”值</p><p><strong>解決gas成本問題</strong></p><p>通常，在gas成本方面需要進行權衡。人們最終將默認值設為0的一個典型原因是存儲非零值會耗費大量gas。</p><p>如果存儲成本對於您的用例而言是很高的，請考慮以下技巧：</p><div class=pgc-img><img alt=區塊鏈研究實驗室｜減少智能合約代碼複雜性並提高可維護性 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/05b0d42963fb4d5ca95ffceae6acd16f><p class=pgc-img-caption></p></div><p>在此代碼中，寫入存儲的_expiration值默認情況下為0，與以前的特殊含義相同。但是，我介紹了一個輔助函數expiration（），它將0轉換為不太特殊的值2256-1。這意味著我的其餘代碼無需處理這種特殊情況。</p><p>考慮將此技術與自定義的linter規則配對使用，以確保您不會在expiration（）函數之外的任何地方直接讀取_expiration。</p><p><strong>特殊地址</strong></p><p>關於地址，我經常看到兩種特殊情況：</p><ol><li>地址0通常是不允許的。</li><li>不允許使用特定地址（通常是特權角色）。</li></ol><p><strong>特別地址0</strong></p><p>這是一些熟悉的代碼，其中使用0作為特殊情況：</p><div class=pgc-img><img alt=區塊鏈研究實驗室｜減少智能合約代碼複雜性並提高可維護性 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/259298d04cc945feae2e49b164d4af3f><p class=pgc-img-caption></p></div><p>禁止使用地址0通常是為了保護用戶不受錯誤的影響。將令牌發送到地址0通常不會比將它們發送到地址1更糟糕，但0是默認值，因此更可能由於有錯誤的工具或庫而意外傳入。</p><p>我個人不喜歡這種地址0的支票，但這很少有問題。與前面的示例不同，如果開發人員在維護代碼時忘記了這種特殊情況，那麼一切都不會中斷。</p><p><strong>特殊角色地址</strong></p><p>這段代碼比上一段要麻煩得多：</p><div class=pgc-img><img alt=區塊鏈研究實驗室｜減少智能合約代碼複雜性並提高可維護性 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/eed4693f1d5c4b1698bb52641c20e4f6><p class=pgc-img-caption></p></div><p>當我看到這樣的代碼時，我的直接問題是為什麼所有者地址無法接收令牌。這樣的檢查通常是為了將安全控制措施放在適當的位置，但通常無法解決Sybil攻擊，因為系統中的多個地址由同一個人控制。</p><p>在這個特定的例子中，所有者可以簡單地接收具有不同地址的令牌。如果這違反了合同的安全性假設，那就有問題了。</p><p>像這樣的特殊情況是一種代碼氣息，但這並不意味著它們總是應該被消除。要做的重要事情是記錄為什麼需要這種特殊情況，並考慮替代方案。</p><p><strong>總結</strong></p><ol><li>特殊情況會導致代碼複雜性，從而導致錯誤。</li><li>在可能的情況下，完全消除特殊情況。</li><li>2256-1是最大值的良好替代品。</li><li>地址0的特殊情況通常可以。</li><li>其他特定地址的特殊情況是代碼氣味。</li><li>如果決定在代碼中使用具有特殊意義的值，請嘗試隔離用於處理這些值的代碼。</li></ol></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>區塊</a></li><li><a>實驗室</a></li><li><a>減少</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E5%AD%B8/3bdc3c03.html alt="區塊鏈研究實驗室 |分片：需要多少分片數量才能足夠安全？" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/522afc53bf32420a84ceb1e2bbb2afa3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/3bdc3c03.html title="區塊鏈研究實驗室 |分片：需要多少分片數量才能足夠安全？">區塊鏈研究實驗室 |分片：需要多少分片數量才能足夠安全？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0a06ff55.html alt=區塊鏈上的隨機性：概述與構造 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RJjGCjxAt6MQlC style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0a06ff55.html title=區塊鏈上的隨機性：概述與構造>區塊鏈上的隨機性：概述與構造</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/15f60fea.html alt=此地無人生還：區塊鏈隨機數的原罪與救贖 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/153820081912869d8e48468 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/15f60fea.html title=此地無人生還：區塊鏈隨機數的原罪與救贖>此地無人生還：區塊鏈隨機數的原罪與救贖</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8582e44e.html alt="計算機實驗室之樹莓派：課程 7 屏幕02" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/fa8f776ea6c84f08b0fbfaad451371e0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8582e44e.html title="計算機實驗室之樹莓派：課程 7 屏幕02">計算機實驗室之樹莓派：課程 7 屏幕02</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a382d16d.html alt="區塊鏈入門：為什麼 DApp 經常會遭遇隨機數攻擊？| 火星技術帖" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RivR6n1AU5yy8h style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a382d16d.html title="區塊鏈入門：為什麼 DApp 經常會遭遇隨機數攻擊？| 火星技術帖">區塊鏈入門：為什麼 DApp 經常會遭遇隨機數攻擊？| 火星技術帖</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dbe0144c.html alt=如何減少焊接機器人出現焊接件變形的情況？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3a62de9fde6c4a09ac0950d5f16dea0a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dbe0144c.html title=如何減少焊接機器人出現焊接件變形的情況？>如何減少焊接機器人出現焊接件變形的情況？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6c1fb1a7.html alt=如何減少焊接應力與變形 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/4ad80004022e2df51fe5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6c1fb1a7.html title=如何減少焊接應力與變形>如何減少焊接應力與變形</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f7d22843.html alt=日照時數減少！莫斯科經歷20年來“最暗”開年 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f7d22843.html title=日照時數減少！莫斯科經歷20年來“最暗”開年>日照時數減少！莫斯科經歷20年來“最暗”開年</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a937a7c6.html alt="「牛車實驗室」側部撞擊同樣危害巨大 盤點2019拆解車型車門結構" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/S0MkSpqIps36mf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a937a7c6.html title="「牛車實驗室」側部撞擊同樣危害巨大 盤點2019拆解車型車門結構">「牛車實驗室」側部撞擊同樣危害巨大 盤點2019拆解車型車門結構</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/751f8a92.html alt="「牛車實驗室」車門的正確關閉方式很有講究 細看內部構造讓你恍然大悟" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RxX58RgAGbzd5D style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/751f8a92.html title="「牛車實驗室」車門的正確關閉方式很有講究 細看內部構造讓你恍然大悟">「牛車實驗室」車門的正確關閉方式很有講究 細看內部構造讓你恍然大悟</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0724f87f.html alt="實驗室 for 工業鋅鎳合金廢水/次亞磷廢水/硝態氮廢水" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5c40a316c38245d0b7e727af93ee571f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0724f87f.html title="實驗室 for 工業鋅鎳合金廢水/次亞磷廢水/硝態氮廢水">實驗室 for 工業鋅鎳合金廢水/次亞磷廢水/硝態氮廢水</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/db935439.html alt="CMF實驗室 | 鎳合金" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/523606d1d81447dbb93a21e4d5ee767e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/db935439.html title="CMF實驗室 | 鎳合金">CMF實驗室 | 鎳合金</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/476788b3.html alt="「牛車實驗室」夾層玻璃/鋼化玻璃 汽車玻璃還有這麼多種類？" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/Rx4HY0w8tJ7YKW style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/476788b3.html title="「牛車實驗室」夾層玻璃/鋼化玻璃 汽車玻璃還有這麼多種類？">「牛車實驗室」夾層玻璃/鋼化玻璃 汽車玻璃還有這麼多種類？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f3079eb0.html alt=P3和P4生物實驗室必備防護裝備來了！感染去世的劉智明院長最擔心的問題，解決了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/42d64513f1ed4fc28b893efacf1d3d8c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f3079eb0.html title=P3和P4生物實驗室必備防護裝備來了！感染去世的劉智明院長最擔心的問題，解決了>P3和P4生物實驗室必備防護裝備來了！感染去世的劉智明院長最擔心的問題，解決了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f3ef1b57.html alt=清華-泰嶽區塊鏈，公益培訓第10堂內容-區塊鏈整體結構解析1 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/bb90db89a11643b7a657bcdb3f60a8bb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f3ef1b57.html title=清華-泰嶽區塊鏈，公益培訓第10堂內容-區塊鏈整體結構解析1>清華-泰嶽區塊鏈，公益培訓第10堂內容-區塊鏈整體結構解析1</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>