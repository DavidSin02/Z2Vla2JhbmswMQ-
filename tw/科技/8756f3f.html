<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>以太網接口TCP/IP協議介紹，說的很容易懂了 | 极客快訊</title><meta property="og:title" content="以太網接口TCP/IP協議介紹，說的很容易懂了 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/d073c29b03984e3aa025b70cd50cc493"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8756f3f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8756f3f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8756f3f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8756f3f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8756f3f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8756f3f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8756f3f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8756f3f.html><meta property="article:published_time" content="2020-10-29T20:50:28+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:28+08:00"><meta name=Keywords content><meta name=description content="以太網接口TCP/IP協議介紹，說的很容易懂了"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/8756f3f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>以太網接口TCP/IP協議介紹，說的很容易懂了</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><strong>TCP/IP協議</strong>，或稱為<strong>TCP/IP協議棧</strong>，或互聯網協議系列。</p><p><strong>TCP/IP協議棧</strong>(按<em>TCP/IP參考模型</em>劃分)</p><div class=pgc-img><img alt=以太網接口TCP/IP協議介紹，說的很容易懂了 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d073c29b03984e3aa025b70cd50cc493><p class=pgc-img-caption></p></div><p style=text-align:start>包含了一系列構成互聯網基礎的網絡協議。這些協議最早發源於美國國防部的DARPA互聯網項目。TCP/IP字面上代表了兩個協議:TCP傳輸控制協議和IP互聯網協議。</p><p style=text-align:start>時間回放到1983年1月1日，在這天，互聯網的前身Arpanet中，TCP/IP協議取代了舊的網絡核心協議NCP(Network Core Protocol)，從而成為今天的互聯網的基石。最早的的TCP/IP由Vinton Cerf和Robert Kahn兩位開發，慢慢地通過競爭戰勝了其它一些網絡協議的方案，比如國際標準化組織ISO的OSI模型。TCP/IP的蓬勃發展發生在上世紀的90年代中期。當時一些重要而可靠的工具的出世，例如頁面描述語言HTML和瀏覽器Mosaic，導致了互聯網應用的飛速發展。</p><p style=text-align:start>隨著互聯網的發展，目前流行的IPv4協議(IP Version 4，IP版本四)已經接近它的功能上限。IPv4最致命的兩個缺陷在與:</p><ul><li>地址只有32位，IP地址空間有限;</li><li>不支持服務等級(Quality of Service, Qos)的想法，無法管理帶寬和優先級，故而不能很好的支持現今越來越多的實時的語音和視頻應用。因此IPv6 (IP Version 6, IP版本六) 浮出海面，用以取代IPv4。</li></ul><p style=text-align:start>TCP/IP成功的另一個因素在與對為數眾多的底層協議的支持。這些底層協議對應與OSI模型 中的第一層(物理層)和第二層(數據鏈路層)。每層的所有協議幾乎都有一半數量的支持TCP/IP，例如: 以太網(Ethernet)，令牌環(Token Ring)，光纖數據分佈接口(FDDI)，端對端協議( PPP)，X.25，幀中繼(Frame Relay)，ATM，Sonet, SDH等。</p><h1 class=pgc-h-arrow-right>分享一個在騰訊課堂上tcp/ip的訓練營的視頻。</h1><p style=text-align:start><strong>主要內容：<br>1. 如何實現單機百萬連接；<br>2. 如何優化三次握手、四次揮手；<br>3. 如何優化TCP的傳輸速率；<br>4. nginx零拷貝技術的實現；<br>5. epoll原理剖析和麵試必問的問題。</strong></p><div class=pgc-img><img alt=以太網接口TCP/IP協議介紹，說的很容易懂了 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/331cb102879446778c65967263f0e682><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>需要了解學習的朋友可以後臺私信【tcp/ip】獲取鏈接及文檔資料</h1><div class=pgc-img><img alt=以太網接口TCP/IP協議介紹，說的很容易懂了 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b932410811b44a848a3cd3aa80db661b><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>3、協議拆封</h1><div class=pgc-img><img alt=以太網接口TCP/IP協議介紹，說的很容易懂了 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fc819eee590640f7825b2e8fb9a33d35><p class=pgc-img-caption></p></div><p><strong>目錄</strong></p><h1 class=pgc-h-arrow-right>TCP/IP協議棧組成</h1><p style=text-align:start>整個通信網絡的任務，可以劃分成不同的功能塊，即抽象成所謂的 ” 層” 。用於互聯網的協議可以比照TCP/IP參考模型進行分類。TCP/IP協議棧起始於第三層協議IP(互聯網協議) 。所有這些協議都在相應的RFC文檔中討論及標準化。重要的協議在相應的RFC文檔中均標記了狀態: “必須“ (required) ，“推薦“ (recommended) ，“可選“ (elective) 。其它的協議還可能有“ 試驗“(experimental) 或“ 歷史“(historic) 的狀態。</p><p style=text-align:start></p><h1 class=pgc-h-arrow-right>必須協議</h1><p style=text-align:start>所有的TCP/IP應用都必須實現IP和ICMP。對於一個路由器(router) 而言，有這兩個協議就可以運作了，雖然從應用的角度來看，這樣一個路由器 意義不大。實際的路由器一般還需要運行許多“推薦“使用的協議，以及一些其它的協議。</p><p style=text-align:start>在幾乎所有連接到互聯網上的計算機上都存在的IPv4 協議出生在1981年，今天的版本和最早的版本並沒有多少改變。升級版IPv6 的工作始於1995年，目的在與取代IPv4。ICMP 協議主要用於收集有關網絡的信息查找錯誤等工作。</p><p style=text-align:start></p><h1 class=pgc-h-arrow-right>推薦協議</h1><p style=text-align:start>每一個應用層(TCP/IP參考模型 的最高層) 一般都會使用到兩個傳輸層協議之一: 面向連接的TCP傳輸控制協議和無連接的包傳輸的UDP用戶數據報文協議 。 其它的一些推薦協議有:</p><ul><li>TELNET (Teletype over the Network, 網絡電傳) ，通過一個終端(terminal)登陸到網絡(運行在TCP協議上)。</li><li>FTP (File Transfer Protocol, 文件傳輸協議) ，由名知義(運行在TCP協議上) 。</li><li>SMTP (Simple Mail Transfer Protocol，簡單郵件傳輸協議) ，用來發送電子郵件(運行在TCP協議上) 。</li><li>DNS (Domain Name Service，域名服務) ，用於完成地址查找，郵件轉發等工作(運行在TCP和UDP協議上) 。</li><li>ECHO (Echo Protocol, 回覆協議) ，用於查錯及測量應答時間(運行在TCP和UDP協議上) 。</li><li>NTP (Network Time Protocol，網絡時間協議) ，用於網絡同步(運行在UDP協議上) 。</li><li>SNMP (Simple Network Management Protocol, 簡單網絡管理協議) ，用於網絡信息的收集和網絡管理。</li><li>BOOTP (Boot Protocol，啟動協議) ，應用於無盤設備(運行在UDP協議上)。</li></ul><p style=text-align:start></p><h1 class=pgc-h-arrow-right>可選協議</h1><p style=text-align:start>最常用的一些有</p><ul><li>支持萬維網WWW的超文本傳輸協議HTTP，</li><li>動態配置IP地址的DHCP(Dynamic Host Configuration Protocol,動態主機配置協議)，</li><li>收郵件用的POP3 (Post Office Protocol, version 3, 郵局協議) ，</li><li>用於加密安全登陸用的SSH (Secure Shell，用於替代安全性差的TELNET) ，</li><li>用於動態解析以太網硬件地址的ARP (Address Resolution Protocol，地址解析協議) 。</li></ul><p style=text-align:start></p><h1 class=pgc-h-arrow-right>範例: 不同計算機運行的不同協議</h1><ul><li>一個簡單的路由器上可能會實現ARP, IP, ICMP, UDP, SNMP, RIP。</li><li>WWW用戶端使用ARP, IP, ICMP, UDP, TCP, DNS, HTTP, FTP。</li><li>一臺用戶電腦上還會運行如TELNET, SMTP, POP3, SNMP, ECHO, DHCP, SSH, NTP。</li><li>無盤設備可能會在固件比如ROM中實現了ARP, IP, ICMP, UDP, BOOT, TFTP (均為面向數據報的協議，實現起來相對簡單)。</li></ul><p style=text-align:start>TCP/IP基礎講座-1：1層，2層，3層？</p><p style=text-align:start>讀過關於網絡的課程的，都知道ISO-OSI 7層協議這個名詞，許多書籍都會具體的畫出呢幅圖，然後標註上物理層，數據鏈路層，網絡層等等.背的大家要死.但是卻又不知道具體這些層次幹嗎用的了？</p><p style=text-align:start>其實在互聯網中，由於實際使用的是TCP/IP模型，也就是DOD模型(現在不知道沒關係，後面會說).所以7層模型在現實網絡環境中只是一個理論上，學究派的東西.這個模型中，我們真正關心的是下面的3層.</p><p style=text-align:start>1.物理層 .哦.是的.這個名詞還算容易瞭解.網卡還有那些網線構成了這一層.那些在網線中傳播的二進制數據流是這層的具體表象.也就是說，這一層上面沒有什麼協議(不是很精確的說法，但是你可以這麼理解).有的都是電流而已.我們把兩臺機器用網線連起來.或者用HUB把機器都連起來，這些工作就是物理層的工作.</p><p style=text-align:start>有2個設備屬於物理層的，一個是中繼器，一個是HUB.大家知道.物理上面的連線距離一長就會產生電信號的衰減.為了重新加強這個信號，我們就需要在一定距離之後加上一個信號放大器，這就是中繼器(repeater)</p><p style=text-align:start>恩...這個比較容易理解.repeater就是連接在2根網線之間的麼.沒有做任何處理.所以只是一個物理設備.屬於1層的.</p><p style=text-align:start>那麼集線器(HUB) 呢？這個怎麼會是在1層？？？似乎非常難以理解.</p><p style=text-align:start>當我說出HUB的本質，大家就能夠清楚瞭解了</p><p style=text-align:start>HUB的本質其實只是一個多口中繼器(MULTI PORT REPEATER) .啊...這樣大家能夠理解了.HUB不叫多口中繼器其實只是為了銷售上面的策略.它的本質就是連接多根網線的一個物理設備.也是不對經過的電信號做任何邏輯處理的.</p><p style=text-align:start><strong>2.數據鏈路層</strong></p><p style=text-align:start>哦~這個名詞有些彆扭了.DATA LINK層.英文似乎更加容易理解.</p><p style=text-align:start>這個層面上面的東西不再是電信號了.而是DATA了.對，既然是DATA就有了邏輯關係了.這個層面上面的基本單位是幀(Frame) .這層和物理層的接觸是最緊密的.它是把從網線上面傳輸的電流轉換成0和1的組合.</p><p style=text-align:start>物理層只是網卡對網線發出或者接受各種電平信號，那就是說物理層是無法判別電流的來源和目標的.那麼把電流打成0和1的幀之後.裡面就有邏輯數據了.有了數據，就可以判別數據從何而來，到何處去.所以也就可以真正的形成LINK.</p><p style=text-align:start>既然可以判別地址，那麼地址是按照什麼來判別的呢？</p><p style=text-align:start>那就是最重要的概念之一:MAC地址</p><p style=text-align:start>大家肯定都聽說過我們的網卡都有MAC地址</p><p style=text-align:start>有些人可能也知道MAC地址都是唯一的.</p><p style=text-align:start>對.MAC地址是全球唯一的.也就是說你的網卡雖然便宜.但是它也是世界上獨一無二的.</p><p style=text-align:start>有些人說他可以改MAC.那就不是唯一了.對.雖然可以更改，那只是欺騙上層對封包裡面的MAC地址進行改寫.你網卡真正的MAC地址是固化的.無法修改的.</p><p style=text-align:start>我們有了MAC地址了.這樣就可以有針對性對所有連接在一起的計算機進行通訊了.是的.我們終於可以在一個局域網內通訊了.</p><p style=text-align:start>但是有個問題我們前面沒有提到.就是既然物理層傳輸的是電信號.那麼如果我有2臺機器一起發電信號，信號豈不是混亂了麼？</p><p style=text-align:start>非常正確.這個問題在網絡裡面成為"碰撞"，所以協議裡面規定了如果你需要往外發數據，一定需要先看看電纜裡面有沒有別的信號.如果沒有，那就可以發.如果2者同時發送，檢測到碰撞之後2者分別等待一個隨機時間，然後重複.這個就是重要的"碰撞檢測 ".</p><p style=text-align:start>哈.看來問題解決了.不是麼.現在整個網絡可以正常運行了.</p><p style=text-align:start>確實如此.但是如果連接在網絡上的計算機越來越多，那麼碰撞的現象會越來越頻繁.這樣效率一定很低了.恩.這裡還有一個重要概念"衝突域 ".在同一個物理上連接的網絡上的所有設備是屬於同一個衝突域的.</p><p style=text-align:start>接著就需要引入我們的2層設備來分割衝突域了.</p><p style=text-align:start>網橋(Bridge) 就是連接2個不同的物理網絡的.主要功能是在2個網絡之間轉發Frame.因為從實際中我們可以知道.其實很多時候並非整個網絡都在相互通訊.最多相互通訊的一組計算機我們可以分在一個小的衝突域內.這樣分割以後可以減少衝突域，也就相對的減少了衝突的機會.而之間使用網橋來橋接，由於網橋兩邊的通訊不是非常頻繁，所以使用網橋來為2邊作為"代言人".這樣任意一個小網絡裡面產生衝突的機會就少了.</p><p style=text-align:start>交換機(Switch)是我們最熟悉的設備了，交換機的本質其實就是一個多口網橋(Multi port Bridge) .同理可得.交換機的每個口後面都是一個衝突域.我們都說交換機比HUB快，就是因為交換機分割了所有的衝突域.</p><p style=text-align:start>由於現在交換機非常便宜.所以一般我們都是直接在交換機的口上接計算機.這樣每臺計算機都是一個獨立的衝突域.這樣碰撞的問題就沒有了.所以速度是比HUB快.</p><p style=text-align:start>而前面說過.2層設備主要是個轉發的功能.交換機的主要功能就是轉發包.而不是讓所有的衝突域直接物理連接.所以交換機有CPU，有內存，可以對frame進行處理等等.這些也是交換機和HUB的區別.</p><p style=text-align:start>3.網絡層</p><p style=text-align:start>我們前面的一些技術就可以構建出局域網了.有了網絡層以後.數據才能夠真正的在整個世界間傳送</p><p style=text-align:start>由於倫納德?博薩卡(Leonard Bosack)和姍蒂?雷納(Sandy Lerner)為了解決他們之間的通信問題(關於路由器發明的版本有很多.你聽到的別的說法可能比這個說法更準確，但是誰知道呢.呵呵).路由器被髮明用來解決"信息孤島"問題.而且如果是由SWITCH來構建整個網絡，那麼整個網絡將會有"中心節點"，這樣也不符合ARPANET的初衷.所以我們有了這一層.(這樣說可能會感覺本末倒置，但是先這麼理解吧.)</p><p style=text-align:start>這一層的基本單元是包(Packet) .所有的包都有一個IP頭.啊.聽起來很熟悉不是麼.IP就是用來在這層上面標識包的來源和目的地址的.</p><p style=text-align:start>這層的一個主要概念就是"路由 "，也就是和switch一樣，把包轉發到其他的地方.不過有個不同的地方，switch只有知道具體的MAC在哪裡的情況下才能夠發送給指定的計算機，而路由則不需要知道最終IP所在的計算機在哪個位置，只要知道哪個途徑可以過去就可以工作.</p><p style=text-align:start>這3層構建了整個網絡的基礎.由於TCP/IP模型將最下面2層合併成為一層，所以在TCP/IP裡面總共這2層也是整個構架最基礎的內容.而網絡方面要做的工作也都是針對於這2層做的.</p><p style=text-align:start><strong>2: TCP/IP.真實世界的模型</strong></p><p style=text-align:start>上一講裡面我們說過OSI 7層模型只是一個理論模型,而實際中只需要保證7層的功能能夠實現,實際分層無需按照7層來分.而且如果真的分7層.那麼數據處理的速度便要慢許多.</p><p style=text-align:start>在實際應用中.使用最多的便是DoD模型.也成為TCP/IP協議簇</p><p style=text-align:start>DoD模型(Department Of Defanse Model 美國國防部模型) 顧名思義,是美國國防部設計的一個網絡模型.最早用於ARPANET.這些話可能在許多教材的第一章就會講了.但是一般教材對於DoD模型與OSI模型對應關係都沒有講到.或者很多是模糊或者錯誤的.</p><p style=text-align:start>在這裡我就要描述一下2者對應關係.OSI模型有7層我們已經知道了,而DoD模型則只有4層.下面是對應關係</p><p style=text-align:start>OSI DoD</p><p style=text-align:start>7.Application ┐</p><p style=text-align:start>6.Presentation |-> 4. Application/Process</p><p style=text-align:start>5.Session ┘</p><p style=text-align:start>4.Transport ---> 3. Host to Host</p><p style=text-align:start>3.Network ---> 2. Internet</p><p style=text-align:start>2.Data Link ┬-> 1. Network Access</p><p style=text-align:start>1.Physical ┘</p><p style=text-align:start>由於我不會製表符.所以圖有些難看.其實就是OSI的1.2層對應DoD的第1層</p><p style=text-align:start>OSI的5.6.7對應DoD的第4層</p><p style=text-align:start>其實這個還是比較容易記憶的</p><p style=text-align:start>由於物理層和數據鏈路層非常密切.所以分為一個.然後上面依次對應,最上面的一大塊稱為應用層(處理層)</p><p style=text-align:start>現在我們有了一個可用的實際模型了.不過一般我們在描述某個設備或者協議的時候.還是會使用OSI的模型,比如我們在討論SWITCH的時候,就會說它是一個2層的設備.而路由器是一個3層的設備,還會有一些特殊的設備,比如3層交換機,4層交換機.這些都是使用OSI模型進行分類的.這點大家不要搞混淆了.</p><p style=text-align:start>我們一直聽說TCP或者UDP.還有什麼SMTP.POP3.這些協議到底是在哪一層定義的呢?接下來的一張圖會給大家一個非常清晰的概念了(不能算是圖拉 :D ).</p><p style=text-align:start>4. APPLICATION</p><p style=text-align:start>HTTP,FTP,telnet,SNMP,SMTP,POP3,DNS 等等</p><p style=text-align:start>3.Host to Host</p><p style=text-align:start>TCP,UDP</p><p style=text-align:start>2.internet</p><p style=text-align:start>ICMP,ARP,RARP,IP</p><p style=text-align:start>1.Network Access</p><p style=text-align:start>Ethernet,FastEthernet,Token Ring 等等</p><p style=text-align:start>恩...這下清楚了.讓我們從下至上來看看</p><p style=text-align:start>首先是最下層的.包括了以太網,快速以太網,還有現在的千M以太網等等的協議,這些協議規定了線纜的絞數.連接方式等等物理層的東西.還有底層使用MAC通訊的方式等等.</p><p style=text-align:start>接下來是IP.ARP這些.IP在OSI模型的時候也說過.通過IP地址.我們在轉發包的時候無需知道具體目標機的位置.而路由器自然會根據路由表來轉發.最後一站一站的慢慢傳遞.達到最終目標.而ARP協議就是在IP和MAC之間轉換用的.</p><p style=text-align:start>我在上一章提過,由於有了路由器,IP,整個網絡才真正能夠覆蓋全球.所以這一層叫做internet大家也應該容易記憶了.</p><p style=text-align:start>WOW.TCP,UDP是我們聽說最多的了.他是屬於控制網絡連接的.在OSI稱為Transport.傳輸層.在DoD內是Host to Host 端對端.意思其實是一樣的.就是在在2臺計算機之間構建出一個虛擬的通訊通道來.</p><p style=text-align:start>最上面一層就無窮無盡了.所有的最終應用層的東西都在這裡,你甚至可以定義你自己的協議類型.這些都是完全可以的.因為本身這一層就是提供給開發人員自行發揮的.只是上面列舉的都經過標準化了.</p><p style=text-align:start>TCP包頭結構</p><p style=text-align:start>源端口 16位</p><p style=text-align:start>目標端口 16位</p><p style=text-align:start>序列號 32位</p><p style=text-align:start>迴應序號 32位</p><p style=text-align:start>TCP頭長度 4位</p><p style=text-align:start>reserved 6位</p><p style=text-align:start>控制代碼 6位</p><p style=text-align:start>窗口大小 16位</p><p style=text-align:start>偏移量 16位</p><p style=text-align:start>校驗和 16位</p><p style=text-align:start>選項 32位(可選)</p><p style=text-align:start>這樣我們得出了TCP包頭的最小大小.就是20字節.</p><p style=text-align:start>UDP包頭結構</p><p style=text-align:start>源端口 16位</p><p style=text-align:start>目的端口 16位</p><p style=text-align:start>長度 16位</p><p style=text-align:start>校驗和 16位</p><p style=text-align:start>恩...UDP的包小很多.確實如此.因為UDP是非可靠連接.設計初衷就是儘可能快的將數據包發送出去.所以UDP協議顯得非常精簡.</p><p style=text-align:start>有一個問題,似乎這些頭裡面怎麼沒有IP地址啊.沒有IP地址這些包往哪裡發送呢?</p><p style=text-align:start>對.你觀察的很仔細.TCP和UDP的頭裡面確實沒有任何IP信息.我們回頭想一下TCP和UDP是屬於DoD的哪一層的? 對了!是第3層. 而IP則位於模型的第二層.也就是他們兩者雖然有聯繫.但是不屬於同一層.</p><p style=text-align:start>模型的一個重要規則就是.當發送端發送一個數據,上一層將數據傳往下一層的時候.上一層的包就成為了下一層包的數據部分.</p><p style=text-align:start>而到接受端接受到數據.下一層將本層的頭部信息去掉後交給上一層去處理.</p><p style=text-align:start><strong>那麼我們來看看實際例子</strong>:</p><p style=text-align:start>假使我們通過SMTP協議發送數據AAA到另外一段.那麼數據先會被加上SMTP的頭.成為[SMTP]AAA.往下發送到TCP層.成為[TCP][SMTP]AAA.再往下送到internet層[IP][TCP][SMTP]AAA.然後成為[MAC][IP][TCP][SMTP]AAA</p><p style=text-align:start>這樣通過enternet或者FastEnternet發送到路由器.路由器得到後替換自己的MAC地址上去.傳到下一級的路由器.這樣經過長途跋涉.最終這個數據流到達目標機.</p><p style=text-align:start>目標機先從下面一層開始.去掉MAC,成為[IP][TCP][SMTP]AAA往上到IP層,恩,比對後是發送給我這個IP的.去掉,成為[TCP][SMTP]AAA.TCP接到了查看校驗和,沒錯.往上[SMTP]AAA.最後SMTP協議去解釋.得到了AAA.</p><p style=text-align:start>萬里長征終於結束.我們也將AAA發送到了目標機.大家也應該明白了為何TCP包頭和UDP包頭裡面沒有IP地址那?因為IP位於他們下面一層.TCP和UDP的包頭信息是作為IP包的數據段來傳送的.</p><p style=text-align:start>IP層可不管那許多.他只管他那層的協議,也就是管把從上面層來的數據加上自己的頭,傳到下面一層.把從下面一層來的數據去掉頭.傳到上面一層.</p><p style=text-align:start>每層都是這麼幹的.完美的契合完成了數據包的最終旅程.</p><p style=text-align:start><strong>TCP/IP的通訊協議</strong></p><p style=text-align:start>　　這部分簡要介紹一下TCP/IP的內部結構。TCP/IP協議組之所以流行，部分原因是因為它可以用在各種各樣的信道和底層協議（例如T1和X.25、以太網以及RS-232串行接口）之上。確切地說，TCP/IP協議是一組包括TCP協議和IP協議，UDP（User Datagram Protocol）協議、ICMP（Internet Control Message Protocol）協議和其他一些協議的協議組。</p><p style=text-align:start>TCP/IP整體構架概述</p><p style=text-align:start>　　TCP/IP協議並不完全符合OSI的七層參考模型。傳統的開放式系統互連參考模型，是一種通信協議的7層抽象的參考模型,其中每一層執行某一特定任務。該模型的目的是使各種硬件在相同的層次上相互通信。這7層是:物理層、數據鏈路層、網路層、傳輸層、話路層、表示層和應用層。而TCP/IP通訊協議採用了4層的層級結構，每一層都呼叫它的下一層所提供的網絡來完成自己的需求。這4層分別為：</p><p style=text-align:start>　　應用層：應用程序間溝通的層，如簡單電子郵件傳輸（SMTP）、文件傳輸協議（FTP）、網絡遠程訪問協議（Telnet）等。</p><p style=text-align:start>　　傳輸層：在此層中，它提供了節點間的數據傳送服務，如傳輸控制協議（TCP）、用戶數據報協議（UDP）等，TCP和UDP給數據包加入傳輸數據並把它傳輸到下一層中，這一層負責傳送數據，並且確定數據已被送達並接收。</p><p style=text-align:start>　　互連網絡層：負責提供基本的數據封包傳送功能，讓每一塊數據包都能夠到達目的主機（但不檢查是否被正確接收），如網絡協議（IP）。</p><p style=text-align:start>　　網絡接口層：對實際的網絡媒體的管理，定義如何使用實際網絡（如Ethernet、Serial Line等）來傳送數據。</p><p style=text-align:start>TCP/IP中的協議</p><p style=text-align:start>　　以下簡單介紹TCP/IP中的協議都具備什麼樣的功能，都是如何工作的：</p><p style=text-align:start>　　1． IP</p><p style=text-align:start>　　網絡協議IP是TCP/IP的心臟，也是網絡層中最重要的協議。</p><p style=text-align:start>　　IP層接收由更低層（網絡接口層例如以太網設備驅動程序）發來的數據包，並把該數據包發送到更高層---TCP或UDP層；相反，IP層也把從TCP或UDP層接收來的數據包傳送到更低層。IP數據包是不可靠的，因為IP並沒有做任何事情來確認數據包是按順序發送的或者沒有被破壞。IP數據包中含有發送它的主機的地址（源地址）和接收它的主機的地址（目的地址）。</p><p style=text-align:start>　　高層的TCP和UDP服務在接收數據包時，通常假設包中的源地址是有效的。也可以這樣說，IP地址形成了許多服務的認證基礎，這些服務相信數據包是從一個有效的主機發送來的。IP確認包含一個選項，叫做IP source routing，可以用來指定一條源地址和目的地址之間的直接路徑。對於一些TCP和UDP的服務來說，使用了該選項的IP包好像是從路徑上的最後一個系統傳遞過來的，而不是來自於它的真實地點。這個選項是為了測試而存在的，說明了它可以被用來欺騙系統來進行平常是被禁止的連接。那麼，許多依靠IP源地址做確認的服務將產生問題並且會被非法入侵。</p><p style=text-align:start>　　2. TCP</p><p style=text-align:start>　　如果IP數據包中有已經封好的TCP數據包，那麼IP將把它們向‘上’傳送到TCP層。TCP將包排序並進行錯誤檢查，同時實現虛電路間的連接。TCP數據包中包括序號和確認，所以未按照順序收到的包可以被排序，而損壞的包可以被重傳。</p><p style=text-align:start>　　TCP將它的信息送到更高層的應用程序，例如Telnet的服務程序和客戶程序。應用程序輪流將信息送回TCP層，TCP層便將它們向下傳送到IP層，設備驅動程序和物理介質，最後到接收方。</p><p style=text-align:start>　　面向連接的服務（例如Telnet、FTP、rlogin、X Windows和SMTP）需要高度的可靠性，所以它們使用了TCP。DNS在某些情況下使用TCP（發送和接收域名數據庫），但使用UDP傳送有關單個主機的信息。</p><p style=text-align:start>　　3.UDP</p><p style=text-align:start>　　UDP與TCP位於同一層，但對於數據包的順序錯誤或重複。因此，UDP不被應用於那些使用虛電路的面向連接的服務，UDP主要用於那些面向查詢---應答的服務，例如NFS。相對於FTP或Telnet，這些服務需要交換的信息量較小。使用UDP的服務包括NTP（網絡時間協議）和DNS（DNS也使用TCP）。</p><p style=text-align:start>　　欺騙UDP包比欺騙TCP包更容易，因為UDP沒有建立初始化連接（也可以稱為握手）（因為在兩個系統間沒有虛電路），也就是說，與UDP相關的服務面臨著更大的危險。</p><p style=text-align:start>　　4.ICMP</p><p style=text-align:start>　　ICMP與IP位於同一層，它被用來傳送IP的可控制信息。它主要是用來提供有關通向目的地址的路徑信息。ICMP的‘Redirect’信息通知主機通向其他系統的更準確的路徑，而‘Unreachable’信息則指出路徑有問題。另外，如果路徑不可用了，ICMP可以使TCP連接‘體面地’終止。PING是最常用的基於ICMP的服務。</p><p style=text-align:start>　　5. TCP和UDP的端口結構</p><p style=text-align:start>　　TCP和UDP服務通常有一個客戶/服務器的關係，例如，一個Telnet服務進程開始在系統上處於空閒狀態，等待著連接。用戶使用Telnet客戶程序與服務進程建立一個連接。客戶程序向服務進程寫入信息，服務進程讀出信息併發出響應，客戶程序讀出響應並向用戶報告。因而，這個連接是雙工的，可以用來進行讀寫。</p><p style=text-align:start>　　兩個系統間的多種Telnet連接是如何相互確認並協調一致呢？TCP或UDP連接唯一地使用每個信息中的如下四項進行確認：</p><p style=text-align:start>　　源IP地址　　發送包的IP地址。</p><p style=text-align:start>　　目的IP地址　接收包的IP地址。</p><p style=text-align:start>　　源端口　　　源系統上的連接的端口。</p><p style=text-align:start>　　目的端口　　目的系統上的連接的端口。</p><p style=text-align:start>　　端口是一個軟件結構，被客戶程序或服務進程用來發送和接收信息。一個端口對應一個16比特的數。服務進程通常使用一個固定的端口，例如，SMTP使用25、Xwindows使用6000。這些端口號是‘廣為人知’的，因為在建立與特定的主機或服務的連接時，需要這些地址和目的地址進行通訊。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>TCP</a></li><li><a>IP</a></li><li><a>協議</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/1bd1e17.html alt=一文讀懂TCP/IP協議工作原理和工作流程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/ea27784370b9441090baaf9c8cf57977 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1bd1e17.html title=一文讀懂TCP/IP協議工作原理和工作流程>一文讀懂TCP/IP協議工作原理和工作流程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/13955a3.html alt="TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/8f291e6a61fa4b45a91b81f2589002c5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/13955a3.html title="TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）">TCP/IP 結構模型/Internet 協議（IP）/傳輸控制協議（TCP）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c8da7b9.html alt=TCP/IP協議分為哪四層，具體作用是什麼？http與tcp區別 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/250b6d508b7a4694baa0371a1f53a17c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c8da7b9.html title=TCP/IP協議分為哪四層，具體作用是什麼？http與tcp區別>TCP/IP協議分為哪四層，具體作用是什麼？http與tcp區別</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3364d34.html alt=TCP/IP協議是網絡協議中的核心協議，含三次握手，四次分手 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/fc06324c0dfc4990bb88bbf41769b159 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3364d34.html title=TCP/IP協議是網絡協議中的核心協議，含三次握手，四次分手>TCP/IP協議是網絡協議中的核心協議，含三次握手，四次分手</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7302fb0.html alt=TCP/IP協議：傳輸層協議 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5bccccba9b1243d3afefcee4cc0d04ed style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7302fb0.html title=TCP/IP協議：傳輸層協議>TCP/IP協議：傳輸層協議</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a660d731.html alt=網絡基本概念-TCP/IP架構及各層網絡協議 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/7f834ac140184ca6a079de4d0d3e515c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a660d731.html title=網絡基本概念-TCP/IP架構及各層網絡協議>網絡基本概念-TCP/IP架構及各層網絡協議</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/024d3fc2.html alt=TCP/IP報文格式，康康就知道了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/73eecbbd2b0c4f93ad75a83ff43ace41 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/024d3fc2.html title=TCP/IP報文格式，康康就知道了>TCP/IP報文格式，康康就知道了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ce824d7f.html alt=淺談TCP協議（建立與斷開連接） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/4112ca2d63f04cddae0aadca168ea063 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ce824d7f.html title=淺談TCP協議（建立與斷開連接）>淺談TCP協議（建立與斷開連接）</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/0365df13.html alt=TCP與IP的對比，TCP的報文頭介紹，TCP的三次握手和TCP的安全機制 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f1fd0df30c1c4366be12eef1be8b593b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/0365df13.html title=TCP與IP的對比，TCP的報文頭介紹，TCP的三次握手和TCP的安全機制>TCP與IP的對比，TCP的報文頭介紹，TCP的三次握手和TCP的安全機制</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/f51b5ddc.html alt=TCP/IP-運輸層-你需要知道的運輸層概念 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/a47a604cc4e34358a5357f9e7af4f2da style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/f51b5ddc.html title=TCP/IP-運輸層-你需要知道的運輸層概念>TCP/IP-運輸層-你需要知道的運輸層概念</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a2afccb6.html alt="TCP/IP 門禁控制器通訊不上故障排查方法" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a2afccb6.html title="TCP/IP 門禁控制器通訊不上故障排查方法">TCP/IP 門禁控制器通訊不上故障排查方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2eb6f16c.html alt="一文讀懂 TCP/IP 網絡模型" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c7aa7812af5c4f46b1cfc94a150dc976 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2eb6f16c.html title="一文讀懂 TCP/IP 網絡模型">一文讀懂 TCP/IP 網絡模型</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5351d79a.html alt=學習TCP/IP協議之前，你應該先理解OSI開放式互聯參考模型，功倍 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/d7d062cd949b4d148ab7f6a0b6af23b4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5351d79a.html title=學習TCP/IP協議之前，你應該先理解OSI開放式互聯參考模型，功倍>學習TCP/IP協議之前，你應該先理解OSI開放式互聯參考模型，功倍</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d3de5499.html alt=說說TCP/IP參考模型與OSI七層模型的關係 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ac183e86a25c4c249fa89a3bd6cbeeb6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d3de5499.html title=說說TCP/IP參考模型與OSI七層模型的關係>說說TCP/IP參考模型與OSI七層模型的關係</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/48b15feb.html alt=TCP/IP參考模型 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1e7063fc1fad41fdb324668595754ef6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/48b15feb.html title=TCP/IP參考模型>TCP/IP參考模型</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>