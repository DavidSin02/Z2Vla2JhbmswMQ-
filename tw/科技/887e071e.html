<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>使用 freetype 顯示一行文字 | 极客快訊</title><meta property="og:title" content="使用 freetype 顯示一行文字 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p9.pstatp.com/large/dfic-imagehandler/8ecdb087-8fc1-4a53-872e-feca7a4b65d0"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/887e071e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/887e071e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/887e071e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/887e071e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/887e071e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/887e071e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/887e071e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/887e071e.html><meta property="article:published_time" content="2020-11-14T21:05:00+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:00+08:00"><meta name=Keywords content><meta name=description content="使用 freetype 顯示一行文字"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/887e071e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>使用 freetype 顯示一行文字</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><br></p><div class=pgc-img><img alt="使用 freetype 顯示一行文字" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/dfic-imagehandler/8ecdb087-8fc1-4a53-872e-feca7a4b65d0><p class=pgc-img-caption></p></div><blockquote class=pgc-blockquote-abstract><p>來源：百問網</p><p style=text-align:justify>作者：韋東山</p><p style=text-align:justify>本文字數：2208，閱讀時長：4分鐘</p></blockquote><p>使用 GIT 下載所有源碼後，本節源碼位於如下目錄：</p><blockquote class=pgc-blockquote-abstract><p>01_all_series_quickstart\</p><p>04_嵌入式 Linux 應用開發基礎知識\source\10_freetype\</p><p>04_show_line\show_line.c</p></blockquote><p>本節的目的：在 LCD 上指定一個左上角座標(x, y)，把一行文字顯示出來。下圖中，文字的外框用虛線表示，外框的左上角座標就是(x, y)。</p><div class=pgc-img><img alt="使用 freetype 顯示一行文字" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c8f0fea77a414ca5945d0288428d71f3><p class=pgc-img-caption>圖1</p></div><h1 class=pgc-h-arrow-right>1、笛卡爾座標系</h1><ul><li>在 LCD 的座標系中，原點在屏幕的左上角。對於笛卡爾座標系，原點在左下角。freetype 使用笛卡爾座標系，在顯示時需要轉換為 LCD 座標系。</li><li>從下圖可知，X 方向座標值是一樣的。</li><li>在 Y 方向座標值需要換算，假設 LCD 的高度是 V。</li><li>在 LCD 座標系中座標是(x, y)，那麼它在笛卡爾座標系中的座標值為(x, V-y)。</li><li>反過來也是一樣的，在笛卡爾座標系中座標是(x, y)，那麼它在 LCD 座標系中座標值為(x, V-y)。</li></ul><div class=pgc-img><img alt="使用 freetype 顯示一行文字" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fd985cdf7c15495596c1b389dffe165a><p class=pgc-img-caption>圖2</p></div><h1 class=pgc-h-arrow-right>2、每個字符的大小可能不同</h1><p>在使用 FT_Set_Pixel_Sizes 函數設置字體大小時，這只是“期望值”。比如“百問網 www.100ask.net”，如果把“.”顯示得跟其他漢字一樣大，不好看。</p><p>所以在顯示一行文字時，後面文字的位置會受到前面文字的影響。</p><p>幸好，freetype 幫我們考慮到了這些影響。</p><p>對於 freetype 字體的尺寸(freetype Metrics)，需要參考下圖這個文檔：</p><div class=pgc-img><img alt="使用 freetype 顯示一行文字" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9b51516073d34b2ab5655efead7168b3><p class=pgc-img-caption>圖3</p></div><p>上述文檔中列出了一個圖，摘錄如下：</p><div class=pgc-img><img alt="使用 freetype 顯示一行文字" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/19b2e0e928c44e5a94e0632252d84dfc><p class=pgc-img-caption>圖4</p></div><ul><li>在顯示一行文字時，這些文字會基於同一個基線來繪製位圖：baseline。</li><li>在 baseline 上，每一個字符都有它的原點(origin)，比如上圖中 baseline 左邊的黑色圓點就是字母“g”的原點。當前 origin 加上 advance 就可以得到下一個字符的 origin，比如上圖中 baseline 右邊的黑色圓點。在顯示一行中多個文件字時，後一個文字的原點依賴於前一個文字的原點及 advance。</li><li>字符的位圖是有可能越過 baseline 的，比如上圖中字母“g”在 baseline 下方還有圖像。</li><li>上圖中紅色方框內就是字母“g”所點據的位圖，它的四個角落不一定與原點重合。</li><li>上圖中那些 xMin、xMax、yMin、yMax 如何獲得？可以使用 FT_Glyph_Get_CBox 函數獲得一個字體的這些參數，將會保存在一個 FT_BBox 結構體中，以後想計算一行文字的外框時要用到這些信息：</li></ul><div class=pgc-img><img alt="使用 freetype 顯示一行文字" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4278347de2be4236952d7ba457b3e681><p class=pgc-img-caption>圖5</p></div><h1 class=pgc-h-arrow-right>3、怎麼在指定位置顯示一行文字</h1><ul><li>要顯示一行文字時，每一個字符都有自己外框：xMin、xMax、yMin、yMax。把這些字符的 xMin、yMin中的最小值取出來，把這些字符的 xMax、yMax 中的最大值取出來，就可以確定這行文字的外框了。</li><li>要想在指定位置(x, y)顯示一行文字，步驟如下圖所示：</li></ul><div class=pgc-img><img alt="使用 freetype 顯示一行文字" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9df2a99bd3ef4d86b623dbd41cbebb11><p class=pgc-img-caption>圖6</p></div><p>① 先指定第 1 個字符的原點 pen 座標為(0, 0)，計算出它的外框</p><p>② 再計算右邊字符的原點，也計算出它的外框</p><p>把所有字符都處理完後就可以得到一行文字的整體外框：假設外框左上角座標為(x', y')。</p><p>③ 想在(x, y)處顯示這行文字，調整一下 pen 座標即可</p><p>怎麼調整？</p><p>pen 為(0, 0)時對應左上角(x', y')；</p><p>那麼左上角為(x, y)時就可以算出 pen 為(x-x', y-y')。</p><p><br></p><h1 class=pgc-h-arrow-right>4、freetype 的幾個重要數據結構</h1><p>要想形象地理解程序，需要先介紹一下 freetype 中幾個數據結構：</p><p><strong>1. FT_Library</strong></p><p>對應 freetype 庫，使用 freetype 之前要先調用以下代碼：</p><pre><code>FT_Library library; /* 對應 freetype 庫 */error = FT_Init_FreeType( &amp;library ); /* 初始化 freetype 庫 */</code></pre><p><strong>2. FT_Face</strong></p><p>它對應一個矢量字體文件，在源碼中使用 FT_New_Face 函數打開字體文件後，就可以得到一個 face。</p><p>為什麼稱之為 face？</p><p>估計是文字都是寫在二維平面上的吧，正對著人臉？不用管原因了，總之認為它對應一個字體文件就可以。</p><p>代碼如下：</p><pre><code>error = FT_New_Face(library, font_file, 0, &amp;face ); /* 加載字體文件 */</code></pre><p><strong>3. FT_GlyphSlot</strong></p><p>插槽？用來保存字符的處理結果：比如轉換後的 glyph、位圖，如下圖：</p><div class=pgc-img><img alt="使用 freetype 顯示一行文字" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/8f397b821c084d2696a1fd4735a4c983><p class=pgc-img-caption>圖7</p></div><p>一個 face 中有很多字符，生成一個字符的點陣位圖時，位圖保存在哪裡？保存在插槽中：face->glyph。</p><p>生成第 1 個字符位圖時，它保存在 face->glyph 中；生成第 2 個字符位圖時，也會保存在 face->glyph中，會覆蓋第 1 個字符的位圖。</p><p>代碼如下：</p><pre><code>FT_GlyphSlot slot = face-&gt;glyph; /* 插槽: 字體的處理結果保存在這裡 */</code></pre><p><strong>4. FT_Glyph</strong></p><p>字體文件中保存有字符的原始關鍵點信息，使用 freetype 的函數可以放大、縮小、旋轉，這些新的關鍵點保存在插槽中(注意：位圖也是保存在插槽中)。</p><p>新的關鍵點使用 FT_Glyph 來表示，可以使用這樣的代碼從 slot 中獲得 glyph：</p><pre><code>error = FT_Get_Glyph(slot , &amp;glyph);</code></pre><p><strong>5. FT_BBox</strong></p><p>FT_BBox 結構體定義如下，它表示一個字符的外框，即新 glyph 的外框：</p><div class=pgc-img><img alt="使用 freetype 顯示一行文字" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f466a011bdef4c5ea8527b07de1627a3><p class=pgc-img-caption>圖8</p></div><p>可以使用以下代碼從 glyph 中獲得這些信息：</p><pre><code>FT_Glyph_Get_CBox(glyph, FT_GLYPH_BBOX_TRUNCATE, &amp;bbox );</code></pre><p>針對上述流程，示例代碼如下：</p><div class=pgc-img><img alt="使用 freetype 顯示一行文字" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2f87ae0ca5f04e4c943ec438f484aa32><p class=pgc-img-caption>圖9</p></div><p style=text-align:center><br></p><p style=text-align:center><strong><a class=pgc-link data-content=mp data-source=innerLink href="https://www.toutiao.com/i6852662053107302919/?group_id=6852662053107302919" rel="noopener noreferrer" target=_blank>「新品首發」STM32MP157開發板火爆預售！首批僅300套</a></strong></p><p><br></p><h1 class=pgc-h-arrow-right>點擊“瞭解更多”閱讀更多相關章節</h1></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>freetype</a></li><li><a>顯示</a></li><li><a>一行</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/684036f8.html alt="使用 freetype 顯示單個文字" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/dfic-imagehandler/ec645347-4f84-4e97-8a0c-6bd59c588704 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/684036f8.html title="使用 freetype 顯示單個文字">使用 freetype 顯示單個文字</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a7a79cef.html alt=先漲後降、顯示發貨卻遲遲收不到……12315可快速維權 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a7a79cef.html title=先漲後降、顯示發貨卻遲遲收不到……12315可快速維權>先漲後降、顯示發貨卻遲遲收不到……12315可快速維權</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/855ca88e.html alt=鍋爐顯示溫度很低，循環泵也在轉，為啥會開鍋？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ad414456b47d4a8f99c93b4d3ade4a76 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/855ca88e.html title=鍋爐顯示溫度很低，循環泵也在轉，為啥會開鍋？>鍋爐顯示溫度很低，循環泵也在轉，為啥會開鍋？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ed293021.html alt=高速收費口顯示屏將顯示通行費金額，上海正開展實車測試驗證 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/Rwn2VsT6uGZlfH style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ed293021.html title=高速收費口顯示屏將顯示通行費金額，上海正開展實車測試驗證>高速收費口顯示屏將顯示通行費金額，上海正開展實車測試驗證</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bfc06696.html alt=2018中國顯示學術會議行程即將開啟，會務組溫馨提示 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15369954349373c6f6b1355 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bfc06696.html title=2018中國顯示學術會議行程即將開啟，會務組溫馨提示>2018中國顯示學術會議行程即將開啟，會務組溫馨提示</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0baa18cd.html alt=Excel中超實用的功能：組合和分級顯示，讓你的數據按等級顯示 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f24737f2f0164116ad98ee06a4bc0892 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0baa18cd.html title=Excel中超實用的功能：組合和分級顯示，讓你的數據按等級顯示>Excel中超實用的功能：組合和分級顯示，讓你的數據按等級顯示</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1d9e4826.html alt=Excel分組顯示 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/2eef2b5ea40648a39b74ea21b43c1562 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1d9e4826.html title=Excel分組顯示>Excel分組顯示</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1886613c.html alt=ISVE2019：交互顯示巨頭鴻合、視源將同臺競技 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/b090fb64ac2f43a5883f7239c7d25dbf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1886613c.html title=ISVE2019：交互顯示巨頭鴻合、視源將同臺競技>ISVE2019：交互顯示巨頭鴻合、視源將同臺競技</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4f743fe2.html alt=“顯示軍團”齊聚光谷！2017中國智能顯示創新大會今日舉行 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/4e6700037c5f5a4ab2ac style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4f743fe2.html title=“顯示軍團”齊聚光谷！2017中國智能顯示創新大會今日舉行>“顯示軍團”齊聚光谷！2017中國智能顯示創新大會今日舉行</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d2c1cd6c.html alt=「乾貨」ABAQUS顯示組的鎖定與後處理局部透明化 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15382071002492b1cf838d5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d2c1cd6c.html title=「乾貨」ABAQUS顯示組的鎖定與後處理局部透明化>「乾貨」ABAQUS顯示組的鎖定與後處理局部透明化</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c0592cac.html alt=一分鐘瞭解新型顯示的未來…… class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f008035275e146c285db6754e82bda45 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c0592cac.html title=一分鐘瞭解新型顯示的未來……>一分鐘瞭解新型顯示的未來……</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/28bb1001.html alt="傳聞華為成立顯示驅動部門 進軍屏幕領域" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/86b79cc4e0984b898df04ccc0df18306 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/28bb1001.html title="傳聞華為成立顯示驅動部門 進軍屏幕領域">傳聞華為成立顯示驅動部門 進軍屏幕領域</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0f6d007f.html alt=數據顯示，這幾組“情商”低的表現可得小心了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/aaa6491f8e334aa1a7dd2a3904f423c7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0f6d007f.html title=數據顯示，這幾組“情商”低的表現可得小心了>數據顯示，這幾組“情商”低的表現可得小心了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b0d8af1b.html alt="智能顯示創新大會“顯示軍團”齊聚江城 帶來130億元重大項目簽約" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/4e69000101a033ef548c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b0d8af1b.html title="智能顯示創新大會“顯示軍團”齊聚江城 帶來130億元重大項目簽約">智能顯示創新大會“顯示軍團”齊聚江城 帶來130億元重大項目簽約</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1d9154e2.html alt="更絢麗的顯示效果：vivo X30系列已適配愛奇藝HDR" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/4cf3a27f38bf4e77afe7ca9f26184d31 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1d9154e2.html title="更絢麗的顯示效果：vivo X30系列已適配愛奇藝HDR">更絢麗的顯示效果：vivo X30系列已適配愛奇藝HDR</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>