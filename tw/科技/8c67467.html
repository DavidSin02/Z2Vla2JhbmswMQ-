<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件 | 极客快訊</title><meta property="og:title" content="GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/371ad575b55b44229e1db4afbdfa29f8"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8c67467.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8c67467.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8c67467.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8c67467.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8c67467.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8c67467.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8c67467.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8c67467.html><meta property="article:published_time" content="2020-10-29T21:01:13+08:00"><meta property="article:modified_time" content="2020-10-29T21:01:13+08:00"><meta name=Keywords content><meta name=description content="GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/8c67467.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>近期360互聯網安全中心監控到一款GarrantyDecrypt勒索病毒的新變種開始在國內傳播。該勒索病毒通過RSA結合salsa20對文件進行加密，被加密的文件後綴會被修改為NOSTRO，加密過程也非常規範，密鑰使用完成會被馬上銷燬，加密文件實行"一次一密"。該勒索病毒也是我們見到的最喪心病狂的勒索病毒之一——<strong>不區分文件類型，加密幾乎所有類型的文件</strong>。根據360互聯網安全中心的監測，該勒索病毒主要通過爆破遠程桌面弱口令，登錄遠程後手動投毒進行傳播。</p><p>樣本分析</p><p><strong>前期準備</strong></p><p>該勒索病毒在加密文件之前，會先做下面4項準備：</p><p>1. 判斷當前進程權限，如果權限較低，則重新提權啟動。</p><p>2. 判斷當前系統語言環境，避開斯拉夫語系的環境。這一點和之前很多勒索病毒一樣(例如Hermes、Locky等勒索病毒)，都避開了俄羅斯、烏克蘭、哈薩克斯坦幾個地區。</p><p>3. 刪除系統卷影，破壞Windows系統的系統恢復功能。</p><p>4. 結束系統中運行的一些挖礦程序，由這點也可以看出：<strong>勒索病毒和挖礦攻擊的目標經常是重疊的</strong>。</p><div class=pgc-img><img alt=GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/371ad575b55b44229e1db4afbdfa29f8><p class=pgc-img-caption>圖1. 前期準備</p></div><p><strong>密鑰處理</strong></p><p>該勒索病毒採用的微軟提供的Crypto系列函數，隨機生成一對當前客戶端使用的RSA密鑰對，在獲取到該密鑰對後，立即銷燬了內存中密鑰對。</p><div class=pgc-img><img alt=GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/518f247974454ad2a86bbf6e9f8e9f05><p class=pgc-img-caption>圖2. RSA密鑰對</p></div><p>在獲取到RSA密鑰對後，又對私鑰進行了一些處理，之後使用樣本內嵌的作者的RSA公鑰對這個處理後的密鑰進行了加密，最後連同生成的RSA公鑰一併寫入到%appdata%/_uninstalling_.png文件中。</p><div class=pgc-img><img alt=GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0b0b8e74825b483784cb741571eca553><p class=pgc-img-caption>圖3. 密鑰處理</p></div><p><strong>文件加密</strong></p><p>在處理好密鑰數據後，該勒索病毒創建了兩個線程來加密文件：其中一個線程用來遍歷網絡資源文件，而另一個線程用來遍歷本地文件。</p><div class=pgc-img><img alt=GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1831e747f528491ba30b82971ba32d31><p class=pgc-img-caption>圖4. 加密文件線程</p></div><p>常見的勒索病毒，通常會指定一個文件類型的範圍，只對範圍內的文件進行加密。而該勒索病毒則沒有做這個判斷——它會將所有類型的普通文件都進行加密。排除列表只包括5個目錄和病毒自己產生的一些文件，同時還排除了一些被佔用的和系統屬性的文件：</p><p>· // Windows</p><p>· // Program Files</p><p>· // Program Files(x86)</p><p>· // $Recycle.bin</p><p>· // System Volume Information</p><p>· .NOSTRO</p><p>· #RECOVERY_FILES#.txt</p><p>· _uninstalling_.png</p><div class=pgc-img><img alt=GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b9f43be683f64c86b8d58d079654b855><p class=pgc-img-caption>圖5. 排除在外的目錄和文件</p></div><p>該勒索病毒製造者在加密文件這塊做的也非常用心，每次加密一個文件之前，都會使用CryptGenRandom接口生成一個隨機數做為密鑰，這樣就保證了一個文件一個密鑰。同時在加密文件後該勒索病毒會立即銷燬內存中的密鑰信息，避免用戶在中毒後通過從內存中dump出密鑰信息來解密文件。</p><div class=pgc-img><img alt=GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9bcb833dd2f44ce5a6d0abc50881d3ca><p class=pgc-img-caption>圖6. 獲取隨機數</p></div><p>此外，在這一階段，勒索病毒還會檢查被加密文件的擴展名，如果擴展名在指定的列表範圍內，則會對其進行全文加密，否則在後續的加密過程中只會進行一輪的加密循環——即只加密文件的頭部1024字節內容。該邏輯我們認為是作者希望在保證勒索病毒破壞力的前提下，儘可能的對加密速度進行優化，這一點在文件加密算法的選擇上也得到了印證。</p><div class=pgc-img><img alt=GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/ed3cc06f4de545699e3fb0fba1c0ebf9><p class=pgc-img-caption>圖7. 判斷文件是否需要被全文加密</p></div><p>而當前，該勒索病毒所定義的"需要被全文加密"的文件擴展名，則僅有".txt"一個。即，只有.txt文件需要被全文加密，其他擴展名的文件則均只加密前1024個字節的內容：</p><div class=pgc-img><img alt=GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5859335d173141149ce3f0fb1fde54e1><p class=pgc-img-caption>圖8. 需要被全文加密的文件擴展名列表</p></div><p>該勒索病毒在加密文件時，是用CryptGenRandom函數產生的隨機數作為salsa20加密算法的密鑰來加密文件。並在加密完文件後，將0xD3ADBE3F標記和被用RSA加密後的文件加密密鑰添加到被加密文件的末尾。</p><div class=pgc-img><img alt=GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/66a4e32bd981448da1719056ce7e21f9><p class=pgc-img-caption>圖9. 加密文件</p></div><p>以下是被加密文件末尾的格式。有4個字節是寫入的標記0xD3ADBE3F，最末尾的48個字節是寫入的被RSA加密的當前文件的加密密鑰。</p><div class=pgc-img><img alt=GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e0137f905a4340e6bb573ccd6f06789d><p class=pgc-img-caption>圖10. 被加密文件格式</p></div><p><strong>收尾</strong></p><p>在完成一個文件夾的加密之後，會在這個文件夾下創建#RECOVERY_FILES#.txt文件，留下勒索信息，要求用戶聯繫對方。</p><div class=pgc-img><img alt=GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f33118377a8c494f9ca83a59b5e86a58><p class=pgc-img-caption>圖11. 勒索信息</p></div><p>總結：</p><p>針對服務器的勒索病毒攻擊依然是當下勒索病毒的一個主要方向，企業需要加強自身的信息安全管理能力——尤其是弱口令、漏洞、文件共享和遠程桌面的管理，以應對勒索病毒的威脅，在此我們給各位管理員一些建議：</p><p>1. 多臺機器，不要使用相同的賬號和口令</p><p>2. 登錄口令要有足夠的長度和複雜性，並定期更換登錄口令</p><p>3. 重要資料的共享文件夾應設置訪問權限控制，並進行定期備份</p><p>4. 定期檢測系統和軟件中的安全漏洞，及時打上補丁。</p><p>5. 定期到服務器檢查是否存在異常。查看範圍包括：</p><p>a) 是否有新增賬戶</p><p>b) Guest是否被啟用</p><p>c) Windows系統日誌是否存在異常</p><p>d) 殺毒軟件是否存在異常攔截情況</p><div class=pgc-img><img alt=GarrantyDecrypt勒索病毒最新變種“無差別攻擊”全部文件 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c073ba891af84762b519be174c55b0af><p class=pgc-img-caption></p></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>GarrantyDecrypt</a></li><li><a>變種</a></li><li><a>無差別</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/e92223a3.html alt=趣說百“科”：DFMA的變種——可維護設計 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/4eae4f606c9749448d8e131e7eff565c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e92223a3.html title=趣說百“科”：DFMA的變種——可維護設計>趣說百“科”：DFMA的變種——可維護設計</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/f55fbc57.html alt=美國警察開啟“無差別攻擊”，國外記者也遭殃，多國官員抗議暴行 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8f307452a24d4ad7a84700eb36c16481 style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/f55fbc57.html title=美國警察開啟“無差別攻擊”，國外記者也遭殃，多國官員抗議暴行>美國警察開啟“無差別攻擊”，國外記者也遭殃，多國官員抗議暴行</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>