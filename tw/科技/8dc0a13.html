<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>SpringBoot整合MyBatisPlus配置動態數據源（文末有驚喜） | 极客快訊</title><meta property="og:title" content="SpringBoot整合MyBatisPlus配置動態數據源（文末有驚喜） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/ebfc1edc673a4121ab43dae6314cb425"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8dc0a13.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8dc0a13.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8dc0a13.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8dc0a13.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8dc0a13.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8dc0a13.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8dc0a13.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8dc0a13.html><meta property="article:published_time" content="2020-10-29T20:58:17+08:00"><meta property="article:modified_time" content="2020-10-29T20:58:17+08:00"><meta name=Keywords content><meta name=description content="SpringBoot整合MyBatisPlus配置動態數據源（文末有驚喜）"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/8dc0a13.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>SpringBoot整合MyBatisPlus配置動態數據源（文末有驚喜）</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p><strong>MybatisPlus特性</strong></p><div class=pgc-img><img alt=SpringBoot整合MyBatisPlus配置動態數據源（文末有驚喜） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ebfc1edc673a4121ab43dae6314cb425></div><ul><li><strong>無侵入</strong>：只做增強不做改變，引入它不會對現有工程產生影響，如絲般順滑</li><li><strong>損耗小</strong>：啟動即會自動注入基本 CURD，性能基本無損耗，直接面向對象操作</li><li><strong>強大的 CRUD 操作</strong>：內置通用 Mapper、通用 Service，僅僅通過少量配置即可實現單表大部分 CRUD 操作，更有強大的條件構造器，滿足各類使用需求</li><li><strong>支持 Lambda 形式調用</strong>：通過 Lambda 表達式，方便的編寫各類查詢條件，無需再擔心字段寫錯</li><li><strong>支持多種數據庫</strong>：支持 MySQL、MariaDB、Oracle、DB2、H2、HSQL、SQLite、Postgre、SQLServer2005、SQLServer 等多種數據庫</li><li><strong>支持主鍵自動生成</strong>：支持多達 4 種主鍵策略（內含分佈式唯一 ID 生成器 - Sequence），可自由配置，完美解決主鍵問題</li><li><strong>支持 XML 熱加載</strong>：Mapper 對應的 XML 支持熱加載，對於簡單的 CRUD 操作，甚至可以無 XML 啟動</li><li><strong>支持 ActiveRecord 模式</strong>：支持 ActiveRecord 形式調用，實體類只需繼承 Model 類即可進行強大的 CRUD 操作</li><li><strong>支持自定義全局通用操作</strong>：支持全局通用方法注入（ Write once, use anywhere ）</li><li><strong>支持關鍵詞自動轉義</strong>：支持數據庫關鍵詞（order、key......）自動轉義，還可自定義關鍵詞</li><li><strong>內置代碼生成器</strong>：採用代碼或者 Maven 插件可快速生成 Mapper 、 Model 、 Service 、 Controller 層代碼，支持模板引擎，更有超多自定義配置等您來使用</li><li><strong>內置分頁插件</strong>：基於 MyBatis 物理分頁，開發者無需關心具體操作，配置好插件之後，寫分頁等同於普通 List 查詢</li><li><strong>內置性能分析插件</strong>：可輸出 Sql 語句以及其執行時間，建議開發測試時啟用該功能，能快速揪出慢查詢</li><li><strong>內置全局攔截插件</strong>：提供全表 delete 、 update 操作智能分析阻斷，也可自定義攔截規則，預防誤操作</li><li><strong>內置 Sql 注入剝離器</strong>：支持 Sql 注入剝離，有效預防 Sql 注入攻擊</li></ul><p><strong>快速開始</strong></p><p>初始化測試數據表：</p><p>DROP TABLE IF EXISTS user;</p><p>CREATE TABLE user</p><p>(</p><p>id BIGINT(20) NOT NULL COMMENT '主鍵ID',</p><p>name VARCHAR(30) NULL DEFAULT NULL COMMENT '姓名',</p><p>age INT(11) NULL DEFAULT NULL COMMENT '年齡',</p><p>email VARCHAR(50) NULL DEFAULT NULL COMMENT '郵箱',</p><p>PRIMARY KEY (id)</p><p>);</p><p>DELETE FROM user;</p><p>INSERT INTO user (id, name, age, email) VALUES</p><p>(1, 'Jone', 18, 'test1@baomidou.com'),</p><p>(2, 'Jack', 20, 'test2@baomidou.com'),</p><p>(3, 'Tom', 28, 'test3@baomidou.com'),</p><p>(4, 'Sandy', 21, 'test4@baomidou.com'),</p><p>(5, 'Billie', 24, 'test5@baomidou.com');</p><p><strong>父工程依賴</strong></p><p>該工程用於依賴管理，pom如下：</p><p>&lt;properties></p><p>&lt;project.build.sourceEncoding>UTF-8&lt;/project.build.sourceEncoding></p><p>&lt;project.reporting.outputEncoding>UTF-8&lt;/project.reporting.outputEncoding></p><p>&lt;java.version>1.8&lt;/java.version></p><p>&lt;spring-cloud.version>Finchley.RELEASE&lt;/spring-cloud.version></p><p>&lt;mybatis-plus-version>3.1.1&lt;/mybatis-plus-version></p><p>&lt;mysql-driver-version>5.1.47&lt;/mysql-driver-version></p><p>&lt;druid-version>1.1.10&lt;/druid-version></p><p>&lt;/properties></p><p>&lt;dependencyManagement></p><p>&lt;dependencies></p><p>&lt;dependency></p><p>&lt;groupId>org.springframework.boot&lt;/groupId></p><p>&lt;artifactId>spring-boot-dependencies&lt;/artifactId></p><p>&lt;version>2.1.5.RELEASE&lt;/version></p><p>&lt;type>pom&lt;/type></p><p>&lt;scope>import&lt;/scope></p><p>&lt;/dependency></p><p>&lt;/dependencies></p><p>&lt;/dependencyManagement></p><p><strong>創建MyBaitsPlus工程</strong></p><p>依賴如下：</p><p>&lt;dependencies></p><p>&lt;dependency></p><p>&lt;groupId>org.springframework.boot&lt;/groupId></p><p>&lt;artifactId>spring-boot-starter&lt;/artifactId></p><p>&lt;/dependency></p><p>&lt;dependency></p><p>&lt;groupId>org.springframework.boot&lt;/groupId></p><p>&lt;artifactId>spring-boot-starter-web&lt;/artifactId></p><p>&lt;/dependency></p><p>&lt;dependency></p><p>&lt;groupId>org.springframework.boot&lt;/groupId></p><p>&lt;artifactId>spring-boot-starter-test&lt;/artifactId></p><p>&lt;scope>test&lt;/scope></p><p>&lt;/dependency></p><p>&lt;!-- mybatis plus --></p><p>&lt;dependency></p><p>&lt;groupId>com.baomidou&lt;/groupId></p><p>&lt;artifactId>mybatis-plus-boot-starter&lt;/artifactId></p><p>&lt;version>${mybatis-plus-version}&lt;/version></p><p>&lt;/dependency></p><p>&lt;!-- mysql --></p><p>&lt;dependency></p><p>&lt;groupId>mysql&lt;/groupId></p><p>&lt;artifactId>mysql-connector-java&lt;/artifactId></p><p>&lt;version>${mysql-driver-version}&lt;/version></p><p>&lt;/dependency></p><p>&lt;!-- druid數據連接池 --></p><p>&lt;dependency></p><p>&lt;groupId>com.alibaba&lt;/groupId></p><p>&lt;artifactId>druid-spring-boot-starter&lt;/artifactId></p><p>&lt;version>${druid-version}&lt;/version></p><p>&lt;/dependency></p><p>&lt;dependency></p><p>&lt;groupId>org.projectlombok&lt;/groupId></p><p>&lt;artifactId>lombok&lt;/artifactId></p><p>&lt;optional>true&lt;/optional></p><p>&lt;/dependency></p><p>&lt;dependency></p><p>&lt;groupId>log4j&lt;/groupId></p><p>&lt;artifactId>log4j&lt;/artifactId></p><p>&lt;version>1.2.17&lt;/version></p><p>&lt;/dependency></p><p>&lt;/dependencies></p><p><strong>properties配置</strong></p><p>在這裡配置數據庫連接，以及數據連接池與mybatisplus的配置等</p><p>server.port=8080</p><p>spring.application.name=mybatis</p><p>spring.datasource.type=com.alibaba.druid.pool.DruidDataSource</p><p>spring.datasource.driver-class-name=com.mysql.jdbc.Driver</p><p>spring.datasource.url=jdbc:mysql://localhost:3306/mybatis?useSSL=false&characterEncoding=utf8</p><p>spring.datasource.username=root</p><p>spring.datasource.password=root</p><p>spring.datasource.druid.initial-size=5</p><p>spring.datasource.druid.min-idle=5</p><p>spring.datasource.druid.maxActive=20</p><p>spring.datasource.druid.maxWait=60000</p><p>spring.datasource.druid.timeBetweenEvictionRunsMillis=60000</p><p>spring.datasource.druid.minEvictableIdleTimeMillis=300000</p><p>spring.datasource.druid.validationQuery=SELECT 1 FROM DUAL</p><p>spring.datasource.druid.testWhileIdle=true</p><p>spring.datasource.druid.testOnBorrow=false</p><p>spring.datasource.druid.testOnReturn=false</p><p>spring.datasource.druid.poolPreparedStatements=true</p><p>spring.datasource.druid.maxPoolPreparedStatementPerConnectionSize=20</p><p>spring.datasource.druid.filters=stat,slf4j</p><p>spring.datasource.druid.connectionProperties=druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000</p><p>spring.datasource.druid.web-stat-filter.enabled=true</p><p>spring.datasource.druid.web-stat-filter.url-pattern=/*</p><p>spring.datasource.druid.web-stat-filter.exclusions=*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*</p><p>spring.datasource.druid.stat-view-servlet.url-pattern=/druid/*</p><p>spring.datasource.druid.stat-view-servlet.allow=127.0.0.1,192.168.163.1</p><p>spring.datasource.druid.stat-view-servlet.deny=192.168.1.73</p><p>spring.datasource.druid.stat-view-servlet.reset-enable=false</p><p>#Druid 管理賬號</p><p>spring.datasource.druid.stat-view-servlet.login-username=admin</p><p>#Druid 管理密碼</p><p>spring.datasource.druid.stat-view-servlet.login-password=123456</p><p>#com.simple.spring.boot.mapper 該包打印DEBUG級別日誌</p><p>logging.level.com.simple.spring.boot.mapper=debug</p><p>#mybatis plus mapper文件路徑</p><p>mybatis-plus.mapperLocations=classpath:/mybatis/mapper/*.xml</p><p>#mybaits plus 實體類路徑</p><p>mybatis-plus.typeAliasesPackage=com.simple.spring.**.entities</p><p>mybatis-plus.typeEnumsPackage=</p><p>#數據庫相關配置</p><p>#主鍵類型 AUTO:"數據庫ID自增", INPUT:"用戶輸入ID",ID_WORKER:"全局唯一ID (數字類型唯一ID)", UUID:"全局唯一ID UUID";</p><p>mybatis-plus.global-config.db-config.id-type=UUID</p><p>#字段策略 IGNORED:"忽略判斷",NOT_NULL:"非 NULL 判斷"),NOT_EMPTY:"非空判斷"</p><p>mybatis-plus.global-config.db-config.field-strategy=not_empty</p><p>#駝峰下劃線轉換</p><p>mybatis-plus.global-config.db-config.column-underline=true</p><p>#數據庫大寫下劃線轉換</p><p>#capital-mode: true</p><p>#邏輯刪除配置</p><p>mybatis-plus.global-config.db-config.logic-delete-value=0</p><p>mybatis-plus.global-config.db-config.logic-not-delete-value= 1</p><p>#mybatis-plus.global-config.db-config.db-type= sqlserver</p><p>#刷新mapper 調試神器</p><p>mybatis-plus.global-config.refresh=true</p><p># 原生配置</p><p>mybatis-plus.configuration.map-underscore-to-camel-case=true</p><p>mybatis-plus.configuration.cache-enabled=false</p><p>mybatis-plus.configuration.call-setters-on-nulls =true</p><p><strong>常規增刪改查實現</strong></p><p>創建實體類：</p><p>**</p><p>* 實體類</p><p>* @author: SimpleWu</p><p>* @date: 2019/5/25</p><p>*/</p><p>@Data</p><p>public class User {</p><p>private Long id;</p><p>private String name;</p><p>private Integer age;</p><p>private String email;</p><p>}</p><p>該lombok插件省去getset方法。</p><p>創建UserMapper接口，並且實現BaseMapper&lt;User>這裡我們指定實體類為user可直接使用接口中的方法。</p><ul><li>查詢所有數據</li></ul><p>public List&lt;User> getList(){</p><p>return userMapper.selectList(null);</p><p>}</p><ul><li>查詢數據帶查詢條件</li></ul><p>public List&lt;User> getListQuery(){</p><p>User user = new User();</p><p>user.setName("SimpleWu");</p><p>Wrapper&lt;User> wrapper = new QueryWrapper&lt;>(user);</p><p>return userMapper.selectList(wrapper);</p><p>}</p><ul><li>查詢帶分頁</li></ul><p>public IPage&lt;User> page(){</p><p>int currentPage = 1 ; //當前頁</p><p>int pageSize = 2 ;//每頁大小</p><p>IPage&lt;User> page = new Page(currentPage,pageSize);</p><p>page = userMapper.selectPage(page,null);</p><p>return page;</p><p>}</p><ul><li>根據實體類新增數據</li></ul><p>@Transactional//本地事務開啟</p><p>public int insert(){</p><p>User user = new User();</p><p>user.setId(6l);</p><p>user.setName("SimpleWu");</p><p>user.setAge(100);</p><p>user.setEmail("SimpleWu@gmail.com");</p><p>return userMapper.insert(user);</p><p>}</p><ul><li>根據主鍵刪除數據</li></ul><p>@Transactional//本地事務開啟</p><p>public int deleteById(){</p><p>int userId = 6;</p><p>return userMapper.deleteById(userId);</p><p>}</p><ul><li>根據ID更新數據</li></ul><p>@Transactional//本地事務開啟</p><p>public int updateById(){</p><p>User user = new User();</p><p>user.setId(5l);</p><p>user.setName("update");</p><p>user.setAge(100);</p><p>user.setEmail("update@email.com");</p><p>return userMapper.updateById(user);</p><p>}</p><ul><li>條件構造器</li><li>UpdateWrapper 用於增刪改構造條件</li><li>QueryWrapper 用於查詢構造條件</li></ul><p>Transactional//本地事務開啟</p><p>public int updateWrapperUser(){</p><p>User user = new User();</p><p>user.setId(5l);</p><p>user.setName("update");</p><p>user.setAge(100);</p><p>user.setEmail("update@email.com");</p><p>User updateWrapperUser = new User();</p><p>updateWrapperUser.setId(1l);</p><p>/**</p><p>* 修改 UpdateWrapper</p><p>* 查詢 QueryWrapper</p><p>*/</p><p>Wrapper&lt;User> wrapper = new UpdateWrapper&lt;>(updateWrapperUser);</p><p>return userMapper.update(user,wrapper);</p><p>}</p><ul><li>Mapper接口綁定Mapper文件</li><li>properites中配置既可</li></ul><p>#掃描mybatis/mapper下面的所有xml</p><p>mybatis-plus.mapperLocations=classpath:/mybatis/mapper/*.xml</p><ul><li>UserMapper接口測試</li></ul><p>public interface UserMapper extends BaseMapper&lt;User> {</p><p>Map&lt;String,Object> queryUser(@Param("USER_ID") String userId);</p><p>}</p><p>UserMapper.xml，如下：</p><p>&lt;select id="queryUser" resultType="java.util.HashMap" parameterType="java.lang.String"></p><p>SELECT</p><p>ID,</p><p>NAME</p><p>FROM</p><p>USER</p><p>WHERE ID = #{USER_ID}</p><p>&lt;/select></p><p>執行SQL：</p><p>public Map&lt;String,Object> myMapper(){</p><p>return userMapper.queryUser("2");</p><p>}</p><p>在SpringBoot中使用MybatisPlus分頁需要注入Bean，並且在啟動類上使用@MapperScan("com.simple.spring.boot.mapper")掃描mapper文件路徑如下：</p><p>@SpringBootApplication</p><p>@MapperScan("com.simple.spring.boot.mapper")</p><p>public class MybatisPlusApplication {</p><p>/**</p><p>* 分頁插件註冊</p><p>* @return</p><p>*/</p><p>@Bean</p><p>public PaginationInterceptor paginationInterceptor() {</p><p>return new PaginationInterceptor();</p><p>}</p><p>public static void main(String[] args) {</p><p>SpringApplication.run(MybatisPlusApplication.class, args);</p><p>}</p><p>}</p><p>使用MyBatisPlus可以為我們減少很多很多的代碼，不過需要編寫實體類，有失必有得。</p><p><strong>配置動態數據源</strong></p><p>dynamic-datasource-spring-boot-starter 是一個基於springboot的快速集成多數據源的啟動器。</p><p><strong>優勢</strong></p><p>網上關於動態數據源的切換的文檔有很多，核心只有兩種。</p><ol><li>構建多套環境，優勢是方便控制也容易集成一些簡單的分佈式事務，缺點是非動態同時代碼量較多,配置難度大。</li><li>基於spring提供原生的 AbstractRoutingDataSource ，參考一些文檔自己實現切換。</li></ol><p>如果你的數據源較少，場景不復雜，選擇以上任意一種都可以。如果你需要更多特性，請嘗試本動態數據源。</p><ol><li>數據源分組，適用於多種場景 純粹多庫 讀寫分離 一主多從 混合模式。</li><li>簡單集成Druid數據源監控多數據源，簡單集成Mybatis-Plus簡化單表，簡單集成P6sy格式化sql，簡單集成Jndi數據源。</li><li>簡化Druid和HikariCp配置，提供全局參數配置。</li><li>提供自定義數據源來源(默認使用yml或properties配置)。</li><li>項目啟動後能動態增減數據源。</li><li>使用spel動態參數解析數據源，如從session，header和參數中獲取數據源。（多租戶架構神器）</li><li>多層數據源嵌套切換。（一個業務ServiceA調用ServiceB，ServiceB調用ServiceC，每個Service都是不同的數據源）</li><li>使用正則匹配或spel表達式來切換數據源（實驗性功能）。</li></ol><p><strong>劣勢</strong></p><p>不能使用多數據源事務（同一個數據源下能使用事務），網上其他方案也都不能提供。</p><p>如果你需要使用到分佈式事務，那麼你的架構應該到了微服務化的時候了。</p><p>如果呼聲強烈，項目達到800 star，作者考慮集成分佈式事務。</p><p>PS: 如果您只是幾個數據庫但是有強烈的需求分佈式事務，建議還是使用傳統方式自己構建多套環境集成atomic這類，網上百度很多。</p><p><strong>約定</strong></p><ol><li>本框架只做 <strong>切換數據源</strong> 這件核心的事情，並<strong>不限制你的具體操作</strong>，切換了數據源可以做任何CRUD。</li><li>配置文件所有以下劃線 _ 分割的數據源 <strong>首部</strong> 即為組的名稱，相同組名稱的數據源會放在一個組下。</li><li>切換數據源即可是組名，也可是具體數據源名稱，切換時默認採用負載均衡機制切換。</li><li>默認的數據源名稱為 <strong>master</strong> ，你可以通過spring.datasource.dynamic.primary修改。</li><li>方法上的註解優先於類上註解。</li></ol><p><strong>建議</strong></p><p>強烈建議在 <strong>主從模式</strong> 下遵循普遍的規則，以便他人能更輕易理解你的代碼。</p><p>主數據庫 <strong>建議</strong> 只執行 INSERT UPDATE DELETE 操作。</p><p>從數據庫 <strong>建議</strong> 只執行 SELECT 操作。</p><p><strong>快速開始</strong></p><p>加入依賴：</p><p>&lt;!-- 動態數據源 --></p><p>&lt;dependency></p><p>&lt;groupId>com.baomidou&lt;/groupId></p><p>&lt;artifactId>dynamic-datasource-spring-boot-starter&lt;/artifactId></p><p>&lt;version>2.5.4&lt;/version></p><p>&lt;/dependency></p><p>註釋掉原來的數據庫配置，加入：</p><p>#設置默認的數據源或者數據源組,默認值即為master</p><p>spring.datasource.dynamic.primary=master</p><p>#主庫配置</p><p>spring.datasource.dynamic.datasource.master.username=root</p><p>spring.datasource.dynamic.datasource.master.password=root</p><p>spring.datasource.dynamic.datasource.master.driver-class-name=com.mysql.jdbc.Driver</p><p>spring.datasource.dynamic.datasource.master.url=jdbc:mysql://localhost:3306/mybatis?useSSL=false&characterEncoding=utf8</p><p>#從庫配置</p><p>spring.datasource.dynamic.datasource.slave_1.username=root</p><p>spring.datasource.dynamic.datasource.slave_1.password=root</p><p>spring.datasource.dynamic.datasource.slave_1.driver-class-name=com.mysql.jdbc.Driver</p><p>spring.datasource.dynamic.datasource.slave_1.url=jdbc:mysql://localhost:3307/mybatis?useSSL=false&characterEncoding=utf8</p><p>使用 <strong>@DS</strong> 切換數據源。</p><p>@DS("master")</p><p>public List&lt;User> getListQuery(){</p><p>User user = new User();</p><p>user.setName("SimpleWu");</p><p>Wrapper&lt;User> wrapper = new QueryWrapper&lt;>(user);</p><p>return userMapper.selectList(wrapper);</p><p>}</p><p>@DS("slave_1")</p><p>public IPage&lt;User> page(){</p><p>int currentPage = 1 ; //當前頁</p><p>int pageSize = 2 ;//每頁大小</p><p>IPage&lt;User> page = new Page(currentPage,pageSize);</p><p>page = userMapper.selectPage(page,null);</p><p>return page;</p><p>}</p><p><strong>@DS</strong> 可以註解在方法上和類上，<strong>同時存在方法註解優先於類上註解</strong>。</p><p>註解在service實現或mapper接口方法上，但強烈不建議同時在service和mapper註解。 (可能會有問題)</p><p>如果不加入主鍵則使用默認數據源。</p><p>DruidDataSourceAutoConfigure會注入一個DataSourceWrapper，其會在原生的spring.datasource下找url,username,password等。而我們動態數據源的配置路徑是變化的,所以需要排除：</p><p>spring:</p><p>autoconfigure:</p><p>exclude: com.alibaba.druid.spring.boot.autoconfigure.DruidDataSourceAutoConfigure</p><p>或者在類上排除：</p><p>@SpringBootApplication(exclude = DruidDataSourceAutoConfigure.class)</p><p>然後更換properties配置信息：</p><p>#公共配置 Druid登錄賬號 密碼</p><p>spring.datasource.druid.stat-view-servlet.login-username=admin</p><p>spring.datasource.druid.stat-view-servlet.login-password=123456</p><p>spring.datasource.dynamic.druid.initial-size=5</p><p>spring.datasource.dynamic.druid.min-idle=5</p><p>spring.datasource.dynamic.druid.maxActive=20</p><p>spring.datasource.dynamic.druid.maxWait=60000</p><p>spring.datasource.dynamic.druid.timeBetweenEvictionRunsMillis=60000</p><p>spring.datasource.dynamic.druid.minEvictableIdleTimeMillis=300000</p><p>spring.datasource.dynamic.druid.validationQuery=SELECT 1 FROM DUAL</p><p>spring.datasource.dynamic.druid.testWhileIdle=true</p><p>spring.datasource.dynamic.druid.testOnBorrow=false</p><p>spring.datasource.dynamic.druid.testOnReturn=false</p><p>spring.datasource.dynamic.druid.poolPreparedStatements=true</p><p>spring.datasource.dynamic.druid.maxPoolPreparedStatementPerConnectionSize=20</p><p>spring.datasource.dynamic.druid.filters=stat,slf4j</p><p>spring.datasource.dynamic.druid.connectionProperties=druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000</p><p>spring.datasource.dynamic.druid.web-stat-filter.enabled=true</p><p>spring.datasource.dynamic.druid.web-stat-filter.url-pattern=/*</p><p>spring.datasource.dynamic.druid.web-stat-filter.exclusions=*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*</p><p>spring.datasource.dynamic.druid.stat-view-servlet.url-pattern=/druid/*</p><p>spring.datasource.dynamic.druid.stat-view-servlet.allow=127.0.0.1,192.168.163.1</p><p>spring.datasource.dynamic.druid.stat-view-servlet.deny=192.168.1.73</p><p>spring.datasource.dynamic.druid.stat-view-servlet.reset-enable=false</p><p>本篇代碼案例地址：</p><p>https://github.com/450255266/open-doubi</p><p>作者：SimpleWu</p><p>出處：https://www.cnblogs.com/SimpleWu/p/10930388.html</p><h1><strong>最後，小編給大家分享一份Java學習從入門到精通的全套學習資料</strong></h1><h1><strong>轉發此文，關注並私信小編“學習”馬上免費領取</strong></h1><div class=pgc-img><img alt=SpringBoot整合MyBatisPlus配置動態數據源（文末有驚喜） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/6e80367ad0b94f70b707c9208e8e3c57></div><h1><strong>當然還有一些其他的資料：</strong></h1><div class=pgc-img><img alt=SpringBoot整合MyBatisPlus配置動態數據源（文末有驚喜） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/038e479916b144c0a920e736b2351d14></div><div class=pgc-img><img alt=SpringBoot整合MyBatisPlus配置動態數據源（文末有驚喜） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/574575c14a5544ad8c395b63e790ec62></div><div class=pgc-img><img alt=SpringBoot整合MyBatisPlus配置動態數據源（文末有驚喜） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8130aa61c5ed451d8a8a375770e130b9></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>文末</a></li><li><a>SpringBoot</a></li><li><a>MyBatisPlus</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/44c014a1.html alt=SpringBoot事務詳細簡介 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/44c014a1.html title=SpringBoot事務詳細簡介>SpringBoot事務詳細簡介</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5e6fcbbb.html alt=家長問：幾年級學奧數更合適？文末有福利，拿走不謝 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c396f06d8f254d5a9e69869b4ba5b179 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5e6fcbbb.html title=家長問：幾年級學奧數更合適？文末有福利，拿走不謝>家長問：幾年級學奧數更合適？文末有福利，拿走不謝</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a21b0013.html alt=SpringBoot切面Aop的demo簡單講解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ec7dea99ced1417b940a9ffe67dc81aa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a21b0013.html title=SpringBoot切面Aop的demo簡單講解>SpringBoot切面Aop的demo簡單講解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/341006dc.html alt="SpringBoot系列（14）：Spring AOP裝逼指南之實現操作日誌記錄" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/7bc702acb84d4284b4df028da09900db style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/341006dc.html title="SpringBoot系列（14）：Spring AOP裝逼指南之實現操作日誌記錄">SpringBoot系列（14）：Spring AOP裝逼指南之實現操作日誌記錄</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9a2fafc2.html alt=走！一起去鼓浪嶼上發個呆吧~文末有福利！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/Rj3dTyCIxrgNCP style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9a2fafc2.html title=走！一起去鼓浪嶼上發個呆吧~文末有福利！>走！一起去鼓浪嶼上發個呆吧~文末有福利！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/283402cd.html alt=PS教程：提取線稿如此簡單？三種方法總有一種適合你，文末有福利 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/17e9599ddeab48f99bcbd7fb52e01dcb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/283402cd.html title=PS教程：提取線稿如此簡單？三種方法總有一種適合你，文末有福利>PS教程：提取線稿如此簡單？三種方法總有一種適合你，文末有福利</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4dcbf00d.html alt=如何來實現SpringBoot應用的JPA數據持久化和熱插拔 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/dc38450079574dd685472184b5fa06f8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4dcbf00d.html title=如何來實現SpringBoot應用的JPA數據持久化和熱插拔>如何來實現SpringBoot應用的JPA數據持久化和熱插拔</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/c7605a0b.html alt=29個漢字基本筆畫名稱兒歌和偏旁部首表，建議收藏！——文末下載 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/74bd6237c40145619d5408059714b136 style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/c7605a0b.html title=29個漢字基本筆畫名稱兒歌和偏旁部首表，建議收藏！——文末下載>29個漢字基本筆畫名稱兒歌和偏旁部首表，建議收藏！——文末下載</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/94795bf1.html alt=春節剛剛回來的你，還記得這樣的年會嘛？（一定要看到文末） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/0a376c17eaf44eed915d84319ce7ea19 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/94795bf1.html title=春節剛剛回來的你，還記得這樣的年會嘛？（一定要看到文末）>春節剛剛回來的你，還記得這樣的年會嘛？（一定要看到文末）</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/6a1912a3.html alt=上古薦書│《閱微草堂筆記全譯》《子不語全譯》（文末福利，轉發贈書） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/R69RgyjHTfNMiM style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/6a1912a3.html title=上古薦書│《閱微草堂筆記全譯》《子不語全譯》（文末福利，轉發贈書）>上古薦書│《閱微草堂筆記全譯》《子不語全譯》（文末福利，轉發贈書）</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/dec1c5f8.html alt=「冬病夏治」8.6（週一）三伏天灸第四貼，來啦！（文末附：當天呼吸科、心血管科健康講座及義診介紹） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/15333096868540640a202f0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/dec1c5f8.html title=「冬病夏治」8.6（週一）三伏天灸第四貼，來啦！（文末附：當天呼吸科、心血管科健康講座及義診介紹）>「冬病夏治」8.6（週一）三伏天灸第四貼，來啦！（文末附：當天呼吸科、心血管科健康講座及義診介紹）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/410360c9.html alt=SpringBoot項目使用TrueLicense生成和驗證 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c258f6f3636b44dfb9c72c23d2fc50ef style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/410360c9.html title=SpringBoot項目使用TrueLicense生成和驗證>SpringBoot項目使用TrueLicense生成和驗證</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/91277652.html alt=綜合典藏：全面快速入門Redis數據庫(文末有更多資料） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/94a1c0a72fcf432bb4711317aadcc8c5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/91277652.html title=綜合典藏：全面快速入門Redis數據庫(文末有更多資料）>綜合典藏：全面快速入門Redis數據庫(文末有更多資料）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/269b289.html alt="SpringBoot 錯誤處理" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/6b6ae6511a1c40aaadbd9708256a2dde style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/269b289.html title="SpringBoot 錯誤處理">SpringBoot 錯誤處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fcb600f.html alt=SpringBoot自定義錯誤頁面 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/17a417ace8b24067bdb1d528e6bc6be2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fcb600f.html title=SpringBoot自定義錯誤頁面>SpringBoot自定義錯誤頁面</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>