<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>「深度」AB測試中的因果推斷——隨機化分流 | 极客快訊</title><meta property="og:title" content="「深度」AB測試中的因果推斷——隨機化分流 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/S4byE9H87x3cmx"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8e428a4.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8e428a4.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8e428a4.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8e428a4.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8e428a4.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8e428a4.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8e428a4.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8e428a4.html><meta property="article:published_time" content="2020-10-29T21:01:04+08:00"><meta property="article:modified_time" content="2020-10-29T21:01:04+08:00"><meta name=Keywords content><meta name=description content="「深度」AB測試中的因果推斷——隨機化分流"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/8e428a4.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>「深度」AB測試中的因果推斷——隨機化分流</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><blockquote class=pgc-blockquote-abstract toutiao-origin=blockquote><p>編輯導語：在進行關鍵的產品決策時，我們會用到A/B測試，那到底怎麼應用和推算這個模型？本文作者詳細的介紹了在統計推斷中對A/B模型的應用。</p></blockquote><img alt=「深度」AB測試中的因果推斷——隨機化分流 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/S4byE9H87x3cmx><p>上一篇文章“「深度」A/B測試中的因果推斷——潛在結果模型”中我們介紹了用於A/B測試因果推斷的潛在結果模型，現在我們來看看在統計推斷中如何應用這個模型，對試驗的因果效果進行估計。</p><p></p><h1 toutiao-origin=h2>一、分流機制</h1><p>前面我們說過，對於因果效果的估計，我們需要比較多個個體的實際觀測到的潛在結果，其中一部分個體和另外一部分分別接受不同的處理，觀測到不同的潛在結果。</p><p>假如我們有兩個用戶參與這個霧霾小試驗：小強和小明，觀測到如下的結果。</p><p>表面上來看，小強不戴口罩咳嗽 100 分鐘，小明戴口罩也是咳嗽 100 分鐘，我們也許就簡單地得出一個結論：霧霾時戴口罩沒有用，咳嗽不會少。</p><p>但是真實情況可能是：小強對霧霾的抵抗力比小明好很多，所以他不戴口罩咳嗽 100 分鐘，戴口罩只咳嗽 10 分鐘；而身體較弱的小明不戴口罩會咳嗽 200 分鐘，戴口罩咳嗽 100 分鐘。</p><p>那麼真實的因果效果應該是戴口罩少咳嗽 100 分鐘左右，我們從數據表面得出的戴口罩無用的結論是錯誤的。</p><p>上面給出的是一個只有兩個個體的簡單例子，如果參與試驗的個體很多，同樣可能出現這樣的狀況。</p><p></p><h2 toutiao-origin=h3>1. 問題出在哪裡？</h2><p>顯然，個體之間是存在差異的，如果我們把抵抗力強的分派在一組，把抵抗力差的分派到另外一組，然後進行對比，結果就會和真實情況偏差很大，從而得出錯誤的結論。</p><p>問題的關鍵在於參與試驗的用戶進行分組的方法，也就是哪些用戶觀測到戴口罩的潛在結果，哪些用戶觀測到不戴口罩的潛在結果，這是對試驗比較的結果影響很大的重要因素。</p><p>我們把這個分組的過程稱為<strong>用戶分流/分派機制 (assignment mechanism)</strong>。</p><p>也就是說，多個個體參與試驗並不足以保證我們進行有效的因果推斷，我們必須掌握個體的分流機制這個關鍵信息或者對其進行有計劃的控制。</p><p>分流機制和因果效果的定義沒有關係，但是它是潛在結果模型應用過程中的關鍵一步，是決定效果估計準確性的重要因素。</p><p>我們通常需要在試驗設計中選擇一個好的分流方案，以使得因果效果的估計接近於它的定義，並且儘可能提升試驗的統計功效。</p><p>因果效果是通過潛在結果（只能觀測到其中一個）的比較來定義的，和實際接受到的處理無關。</p><p>但是，因為我們只能觀測到一半的潛在結果，無法得知個體的因果效果，在評估因果效果時就存在一個因果推斷的困難：數據缺失問題，個體沒有接受到的處理所對應的潛在結果的數據是缺失的。</p><p>因此，解決問題的關鍵就是缺失數據的處理機制，在因果推斷中就是分流機制。</p><p>哪些個體應該接受哪些處理，或者說哪些潛在結果應該被觀測到？分流機制的這些分派決定是非常關鍵的。</p><p>我們再看看有 4 個用戶參與霧霾小試驗的例子，這次試驗增加了用戶小芳和小剛，小芳和小強在一組，不戴口罩；小剛和小明在一組，戴口罩。</p><p>觀測到數據如下：</p><img alt=「深度」AB測試中的因果推斷——隨機化分流 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/S4nvJPV5sVJqzg><p>這次從數據上看：不戴口罩咳嗽 150 分鐘（平均）、戴口罩咳嗽 55 分鐘（平均）、結論是戴口罩可以減少咳嗽時間 95 分鐘（平均）。</p><p>和真實的個體因果效果對比我們可以看出，這個估計結果是很準確的。</p><p>這次試驗為什麼可以推斷出正確的結論呢？</p><p>因為我們增加了試驗用戶小芳和小剛，而小芳的霧霾抵抗力和小明接近（相同），小剛的抵抗力和小強接近（相同）；</p><p>從而解決了數據缺失的問題：你可以把小芳的結果看作是小明沒有觀測到的不戴口罩情況下的潛在結果，把小剛的結果看作是小強沒有觀測到的戴口罩情況下的潛在結果。</p><p>這裡分流的關鍵在於把用戶屬性（抵抗力）差不多的小強 vs 小剛，以及小明 vs 小芳，分派到兩個不同的組，接受不同的處理。</p><p>如果反過來，把屬性差不多的用戶都放在同一個組，那麼數據缺失問題還是沒有得到解決，試驗結論和上面兩個用戶情況下的試驗一樣依然是錯的。</p><p>從這兩個例子我們可以看出：<strong>我們不能脫離個體的分流機制而僅僅由個體觀測到的潛在結果來進行因果推斷</strong>。</p><p>有效的推斷要求我們必須考慮這個問題：為什麼這些用戶接受這個處理，另外的用戶接受另一個處理？</p><p></p><h1 toutiao-origin=h2>二、隨機化試驗</h1><p>採用隨機化分流方式的試驗設計就是隨機化試驗 (Randomized Experiments)，它是我們在 A/B 測試中進行統計推斷的基礎。傳統的隨機化試驗主要有三種類型：</p><ol><li>伯努利（Bernoulli）隨機化試驗</li><li>完全隨機化試驗（Completely Randomized Experiments）</li><li>分層隨機化試驗（Stratified Randomized Experiments）</li></ol><p>最簡單的 Bernoulli 試驗以類似於拋硬幣的方式來決定每一個個體的分派；</p><p>完全隨機化試驗中每個 treatment 分派到的個體數量是固定的，但個體的分派是隨機的；分層隨機化則是在完全隨機化的基礎上，先通過協變量對總體進行分層，然後在層內隨機化分派。</p><p>不同的隨機化試驗類型（隨機化分流方式）導致不同的分派概率分佈。</p><p>以完全隨機化試驗為例，其個體概率如下：</p><p>根據這個概率分佈，我們就可以對總體的平均因果效果進行統計推斷和估計了。</p><p></p><h2 toutiao-origin=h3>平均因果效果的估計</h2><p>讓我們先從數學上正式地定義平均因果效果（Average Causal Effect），它是我們試驗和分析的最終目標。</p><p>首先把總體中所有的個體編號為 <strong>i = 1, …, N</strong>，N 是總體的容量。</p><p>每個個體可接受一組處理中的一個，我們用 Ti 來表示個體 i 可接受的處理的集合。</p><p>大多數情況下，這個集合對所有個體都是相同的。</p><p>在我們的小試驗中，Ti 包括兩個處理水平：0 表示不戴口罩（control 組），1 表示戴口罩（treatment 組）。</p><p>每個個體可接受的處理水平都有一個對應的潛在效果，Yi（0）和 Yi（1）、Yi（1）和 Yi（0） 的比較（通常是差值），就是個體 i 的因果效果了。</p><p>個體的因果效果我們是無法直接得知的，也不是我們的關注重點。</p><p>我們通常關心的是總體中所有個體的因果效果的平均值，即平均因果效果。</p><p>其中</p><p>分別是所有個體不戴口罩（0）的平均潛在結果，和所有個體戴口罩（1）的平均潛在結果。</p><p>ACE 就是我們試驗分析的目標，它等於“戴口罩（1）的平均潛在結果 ——不戴口罩（0）的平均潛在結果”。</p><p>我們前面已經說過，每個個體的兩個潛在結果只能觀測到其中一個，另外一個是不知道的，所以Yi（0）和Yi（1） 裡面有一半是沒有觀測值的，我們不能由 ACE 的定義公式直接計算出它的值。</p><p>對 ACE 的一個很自然的估計量就是“treatment 組觀測到的平均潛在結果—control 組觀測到的平均潛在結果”</p><p>假設參與試驗的 N 個用戶中有 Nt 個分派到 treatment 組，Nc 個在 control 組，那麼 treatment 組和 control 組的平均潛在結果分別是</p><p>我們需要評估一下這個估計量的準確性，最基本的衡量標準就是它是否 ACE 的無偏估計，即該估計量的期望是否等於 ACE。</p><p>令指示變量 Wi 表示個體 i 被分派的處理（取值 0 或 1），估計量可改寫為：</p><p>其期望值：</p><p>如果分派機制 W 是完全隨機化分派，那麼隨機變量 Wi 的期望：</p><p>因此可得：</p><p>可知，在完全隨機化試驗中，我們根據直觀得到的簡單估計量是 ACE 的無偏估計，是基本可用的。</p><p>從上面的推斷過程可以看出，個體的完全隨機化分派機制在其中扮演了非常重要的角色，正是由於隨機變量 Wi 的概率分佈的特點，使得 ACE 的這個簡單估計量是無偏估計。</p><p>現在我們來看看這個 ACE 估計量的精確性，也就是其抽樣方差。</p><p>根據隨機變量 Wi 的概率分佈的特點，通過類似的方法，可得到 ACE 估計量的方差為：</p><p>其中</p><p>分別是潛在結果 Yi（0）和 Yi（1）的樣本方差，而</p><p>則是個體因果效果 Yi(1) – Yi(0) 的樣本方差。</p><p>如果總體中的個體因果效果為常量（例如，戴口罩的效果對所有人都是少咳嗽 100 分鐘），那麼該項為 0，我們得到：</p><p>以觀測到的組內樣本方差近似代替總體的樣本方差可得到一個方差估計量：</p><p>結合平均因果效果的估計量和抽樣方差估計量可得到假設檢驗統計量為：</p><p>是不是看起來很眼熟？嗯，其實就是我們常用的獨立雙樣本情況下的 z 檢驗量的計算公式：</p><p>大家現在是不是對隱藏在這個公式裡的因果效果有所理解了？！</p><p>作者：祁永輝，微信：yonghuishuo，微信公眾號：AB試驗，熱雲數據AB測試事業部增長顧問，專注於AB試驗（A/Btest）相關知識分享</p><p>本文由 @祁永輝 原創發佈於人人都是產品經理。未經許可，禁止轉載</p><p>題圖來自Unsplash，基於CC0協議</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>AB</a></li><li><a>測試</a></li><li><a>推斷</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/6d1c2a0c.html alt=塑料扯斷伸長率的概念及測試要點 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/6fe0ba07-c929-4046-9216-7f6d5eaa1716 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6d1c2a0c.html title=塑料扯斷伸長率的概念及測試要點>塑料扯斷伸長率的概念及測試要點</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ebbbc375.html alt=時間繼電器測試儀的使用方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1205bf787f1f4de6a5f1e73e7737887b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ebbbc375.html title=時間繼電器測試儀的使用方法>時間繼電器測試儀的使用方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bee6be40.html alt=河北省邯鄲市計量測試所大力實施專業技能提升行動 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bee6be40.html title=河北省邯鄲市計量測試所大力實施專業技能提升行動>河北省邯鄲市計量測試所大力實施專業技能提升行動</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9b084990.html alt=介質損耗測試儀的操作方法與注意事項 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/1a746168-e5df-4643-9117-3f1fb4faf100 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9b084990.html title=介質損耗測試儀的操作方法與注意事項>介質損耗測試儀的操作方法與注意事項</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d38b572e.html alt=有關於射頻測試設備：電纜/天線分析儀 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/0e79c2e668d84f09be994180e66f90c8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d38b572e.html title=有關於射頻測試設備：電纜/天線分析儀>有關於射頻測試設備：電纜/天線分析儀</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e0f90fbd.html alt=透氣性、透氣度測試知多少？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/dfic-imagehandler/45ac8fb9-3365-4327-901d-b21b7cd9cbbf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e0f90fbd.html title=透氣性、透氣度測試知多少？>透氣性、透氣度測試知多少？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/26e2bf51.html alt=振動測試中需要了解的27個常識 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/523bd012e455466f857587d9314c3084 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/26e2bf51.html title=振動測試中需要了解的27個常識>振動測試中需要了解的27個常識</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/72951256.html alt=現場密度測試方法——灌砂法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/4e780002be67a3fa5bad style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/72951256.html title=現場密度測試方法——灌砂法>現場密度測試方法——灌砂法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d260a748.html alt=測試開發專題：spring-boot統一異常捕獲 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/135918e30e2f4a2ea248b539eb383688 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d260a748.html title=測試開發專題：spring-boot統一異常捕獲>測試開發專題：spring-boot統一異常捕獲</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/01e5dc8b.html alt=汽車別再測試油箱警示後跑多遠，油箱球閥故障很危險 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1527412810099aa43fbd71b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/01e5dc8b.html title=汽車別再測試油箱警示後跑多遠，油箱球閥故障很危險>汽車別再測試油箱警示後跑多遠，油箱球閥故障很危險</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c6a66288.html alt=性能測試的分類、流程及工具介紹 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c6a66288.html title=性能測試的分類、流程及工具介紹>性能測試的分類、流程及工具介紹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3eeb035b.html alt=懸索橋的“原始指紋測試” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2157b4b13e4b4f42820eb641677f2c23 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3eeb035b.html title=懸索橋的“原始指紋測試”>懸索橋的“原始指紋測試”</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cffb680d.html alt=軟件測試必備之數據庫知識 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/1adc8d8adfcd4b239442f447cebf7731 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cffb680d.html title=軟件測試必備之數據庫知識>軟件測試必備之數據庫知識</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/63a90cc1.html alt=重要提醒：別讓你的UI自動化測試技術落後別人一個時代 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/c9173ecb95284123b89717ae657af26d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/63a90cc1.html title=重要提醒：別讓你的UI自動化測試技術落後別人一個時代>重要提醒：別讓你的UI自動化測試技術落後別人一個時代</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7e539424.html alt=時鐘測試儀是如何校準的 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/fadd9ef687ec4d4f9df7047e1c255709 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7e539424.html title=時鐘測試儀是如何校準的>時鐘測試儀是如何校準的</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>