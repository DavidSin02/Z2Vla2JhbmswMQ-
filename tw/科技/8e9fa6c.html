<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>自己成為一個證書頒發機構（CA） | 极客快訊</title><meta property="og:title" content="自己成為一個證書頒發機構（CA） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/9199292a7be0459db3261f769711bb98"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8e9fa6c.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8e9fa6c.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8e9fa6c.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8e9fa6c.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8e9fa6c.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8e9fa6c.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8e9fa6c.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8e9fa6c.html><meta property="article:published_time" content="2020-10-29T21:04:13+08:00"><meta property="article:modified_time" content="2020-10-29T21:04:13+08:00"><meta name=Keywords content><meta name=description content="自己成為一個證書頒發機構（CA）"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/8e9fa6c.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>自己成為一個證書頒發機構（CA）</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><div class=pgc-img><img alt=自己成為一個證書頒發機構（CA） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9199292a7be0459db3261f769711bb98><p class=pgc-img-caption></p></div><blockquote><p>為你的微服務架構或者集成測試創建一個簡單的內部 CA。</p><p>-- Moshe Zadka（作者）</p></blockquote><p>傳輸層安全（ TLS ）模型（有時也稱它的舊名稱 SSL）基於 證書頒發機構 (certificate authoritie)（CA）的概念。這些機構受到瀏覽器和操作系統的信任，從而簽名服務器的的證書以用於驗證其所有權。</p><p>但是，對於內部網絡，微服務架構或集成測試，有時候本地 CA更有用：一個只在內部受信任的 CA，然後簽名本地服務器的證書。</p><p>這對集成測試特別有意義。獲取證書可能會帶來負擔，因為這會佔用服務器幾分鐘。但是在代碼中使用“忽略證書”可能會被引入到生產環境，從而導致安全災難。</p><p>CA 證書與常規服務器證書沒有太大區別。重要的是它被本地代碼信任。例如，在 Python requests 庫中，可以通過將 REQUESTS_CA_BUNDLE 變量設置為包含此證書的目錄來完成。</p><p>在為集成測試創建證書的例子中，不需要長期的證書：如果你的集成測試需要超過一天，那麼你應該已經測試失敗了。</p><p>因此，計算昨天和明天作為有效期間隔：</p><pre>&gt;&gt;&gt; import datetime&gt;&gt;&gt; one_day = datetime.timedelta(days=1)&gt;&gt;&gt; today = datetime.date.today()&gt;&gt;&gt; yesterday = today - one_day&gt;&gt;&gt; tomorrow = today - one_day</pre><p>現在你已準備好創建一個簡單的 CA 證書。你需要生成私鑰，創建公鑰，設置 CA 的“參數”，然後自簽名證書：CA 證書總是自簽名的。最後，導出證書文件以及私鑰文件。</p><pre>from cryptography.hazmat.primitives.asymmetric import rsafrom cryptography.hazmat.primitives import hashes, serializationfrom cryptography import x509from cryptography.x509.oid import NameOIDprivate_key = rsa.generate_private_key( public_exponent=65537, key_size=2048, backend=default_backend())public_key = private_key.public_key()builder = x509.CertificateBuilder()builder = builder.subject_name(x509.Name([ x509.NameAttribute(NameOID.COMMON_NAME, 'Simple Test CA'),]))builder = builder.issuer_name(x509.Name([ x509.NameAttribute(NameOID.COMMON_NAME, 'Simple Test CA'),]))builder = builder.not_valid_before(yesterday)builder = builder.not_valid_after(tomorrow)builder = builder.serial_number(x509.random_serial_number())builder = builder.public_key(public_key)builder = builder.add_extension( x509.BasicConstraints(ca=True, path_length=None), critical=True)certificate = builder.sign( private_key=private_key, algorithm=hashes.SHA256(), backend=default_backend())private_bytes = private_key.private_bytes( encoding=serialization.Encoding.PEM, format=serialization.PrivateFormat.TraditionalOpenSSL, encryption_algorithm=serialization.NoEncrption())public_bytes = certificate.public_bytes( encoding=serialization.Encoding.PEM)with open("ca.pem", "wb") as fout: fout.write(private_bytes + public_bytes)with open("ca.crt", "wb") as fout: fout.write(public_bytes)</pre><p>通常，真正的 CA 會需要 證書籤名請求 （CSR）來簽名證書。但是，當你是自己的 CA 時，你可以制定自己的規則！可以徑直簽名你想要的內容。</p><p>繼續集成測試的例子，你可以創建私鑰並立即簽名相應的公鑰。注意 COMMON_NAME 需要是 https URL 中的“服務器名稱”。如果你已配置名稱查詢，你需要服務器能響應對 service.test.local 的請求。</p><pre>service_private_key = rsa.generate_private_key( public_exponent=65537, key_size=2048, backend=default_backend())service_public_key = service_private_key.public_key()builder = x509.CertificateBuilder()builder = builder.subject_name(x509.Name([ x509.NameAttribute(NameOID.COMMON_NAME, 'service.test.local')]))builder = builder.not_valid_before(yesterday)builder = builder.not_valid_after(tomorrow)builder = builder.public_key(public_key)certificate = builder.sign( private_key=private_key, algorithm=hashes.SHA256(), backend=default_backend())private_bytes = service_private_key.private_bytes( encoding=serialization.Encoding.PEM, format=serialization.PrivateFormat.TraditionalOpenSSL, encryption_algorithm=serialization.NoEncrption())public_bytes = certificate.public_bytes( encoding=serialization.Encoding.PEM)with open("service.pem", "wb") as fout: fout.write(private_bytes + public_bytes)</pre><p>現在 service.pem 文件有一個私鑰和一個“有效”的證書：它已由本地的 CA 簽名。該文件的格式可以給 Nginx、HAProxy 或大多數其他 HTTPS 服務器使用。</p><p>通過將此邏輯用在測試腳本中，只要客戶端配置信任該 CA，那麼就可以輕鬆創建看起來真實的 HTTPS 服務器。</p><hr><p>via: https://opensource.com/article/19/4/certificate-authority</p><p>作者： Moshe Zadka 選題： lujun9972 譯者： geekpi 校對： wxy</p><p>本文由 LCTT 原創編譯， Linux中國 榮譽推出</p><h1 class=ql-align-center>點擊“瞭解更多”可訪問文內鏈接</h1></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>成為</a></li><li><a>一個</a></li><li><a>證書</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/87a79e50.html alt=9個方法，讓你成為一個內心強大的人 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/dfic-imagehandler/2a4aef05-6ae9-4191-8dc1-5f29c1cea32e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/87a79e50.html title=9個方法，讓你成為一個內心強大的人>9個方法，讓你成為一個內心強大的人</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eef2650d.html alt=如何成為一個內心強大的人 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/9d3421253d004006ae34cf0bc37b5bb9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eef2650d.html title=如何成為一個內心強大的人>如何成為一個內心強大的人</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9f128e99.html alt=努力成為一個有院子的人 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7756d4b81f20402f92d809f6d24776b4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9f128e99.html title=努力成為一個有院子的人>努力成為一個有院子的人</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a3385bc6.html alt=努力成為一個有院子的人！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/517bb4380edf4407929d44b5161ffa9a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a3385bc6.html title=努力成為一個有院子的人！>努力成為一個有院子的人！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/30efef68.html alt="文案：努力成為一個簡單 溫柔且有力量的人" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/bb695afb9a76405d95b6b30c2838c2f1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/30efef68.html title="文案：努力成為一個簡單 溫柔且有力量的人">文案：努力成為一個簡單 溫柔且有力量的人</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ff762205.html alt=努力成為一個會做飯的人，吃好三餐，過好四季 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/8634fcbd-9ddd-46fa-ae91-461c7af70afd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ff762205.html title=努力成為一個會做飯的人，吃好三餐，過好四季>努力成為一個會做飯的人，吃好三餐，過好四季</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/653e9945.html alt=禁忌背後：師生戀何以成為一個問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/653e9945.html title=禁忌背後：師生戀何以成為一個問題>禁忌背後：師生戀何以成為一個問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/2f73c858.html alt=崇禮，能否成為又一個“達沃斯” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RGaOeO866iMjIQ style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/2f73c858.html title=崇禮，能否成為又一個“達沃斯”>崇禮，能否成為又一個“達沃斯”</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/670013e2.html alt=如何成為一個自律的人，自律從哪些方面做起 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/dfic-imagehandler/29bb92aa-4799-4fbe-82f2-67f90e33c3c7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/670013e2.html title=如何成為一個自律的人，自律從哪些方面做起>如何成為一個自律的人，自律從哪些方面做起</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/9ea53204.html alt=孩子的突發奇想，正是一個個成為“天才”的機會，別用這幾種回答 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f01a129fe20a43fc9f7d20386ba2733a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/9ea53204.html title=孩子的突發奇想，正是一個個成為“天才”的機會，別用這幾種回答>孩子的突發奇想，正是一個個成為“天才”的機會，別用這幾種回答</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/13fa594.html alt=孔雀石能否成下一個綠松石，成為瘋狂的石頭 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/cb027678c94941a89e57d75f7cb85206 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/13fa594.html title=孔雀石能否成下一個綠松石，成為瘋狂的石頭>孔雀石能否成下一個綠松石，成為瘋狂的石頭</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/3adb53e.html alt=為什麼新抗原疫苗可能成為下一個重大的癌症免疫治療突破口？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RHiuvXPFaHihpN style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/3adb53e.html title=為什麼新抗原疫苗可能成為下一個重大的癌症免疫治療突破口？>為什麼新抗原疫苗可能成為下一個重大的癌症免疫治療突破口？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2855247.html alt=想要成為一個合格的導演需要具備哪些技術素養 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1535967785537ce84590e4e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2855247.html title=想要成為一個合格的導演需要具備哪些技術素養>想要成為一個合格的導演需要具備哪些技術素養</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/e45f00f.html alt="天籟梵音 甜美清心｜成為一個素食主義者對於冥想來說有幫助嗎？" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=http://p1.pstatp.com/large/3a010001a81809ac6eb2 style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/e45f00f.html title="天籟梵音 甜美清心｜成為一個素食主義者對於冥想來說有幫助嗎？">天籟梵音 甜美清心｜成為一個素食主義者對於冥想來說有幫助嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c37b69f8.html alt=服務器成為了當今網絡時代的寵兒，如何選擇網站適合獨立服務器？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/2308cb41360841aa8df684a5bc19c92c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c37b69f8.html title=服務器成為了當今網絡時代的寵兒，如何選擇網站適合獨立服務器？>服務器成為了當今網絡時代的寵兒，如何選擇網站適合獨立服務器？</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>