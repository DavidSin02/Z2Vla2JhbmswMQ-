<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>åŸºæ–¼CDCæŠ€è¡“çš„ElasticSearchç´¢å¼•åŒæ­¥æ©Ÿåˆ¶ | æå®¢å¿«è¨Š</title><meta property="og:title" content="åŸºæ–¼CDCæŠ€è¡“çš„ElasticSearchç´¢å¼•åŒæ­¥æ©Ÿåˆ¶ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/SDAIrbpCGdpuDg"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8fa148e0.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8fa148e0.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8fa148e0.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8fa148e0.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8fa148e0.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8fa148e0.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/8fa148e0.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/8fa148e0.html><meta property="article:published_time" content="2020-10-29T21:09:58+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:58+08:00"><meta name=Keywords content><meta name=description content="åŸºæ–¼CDCæŠ€è¡“çš„ElasticSearchç´¢å¼•åŒæ­¥æ©Ÿåˆ¶"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/8fa148e0.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>åŸºæ–¼CDCæŠ€è¡“çš„ElasticSearchç´¢å¼•åŒæ­¥æ©Ÿåˆ¶</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>Flink å¾å…¥é–€åˆ°ç²¾é€š ç³»åˆ—æ–‡ç« </p><p></p><h1 toutiao-origin=h3>æ¦‚è¿°</h1><p>ElasticSearchä½œç‚ºä¸€å€‹åŸºæ–¼Luceneçš„æœç´¢å¼•æ“è¢«å»£æ³›æ‡‰ç”¨æ–¼å„ç¨®æ‡‰ç”¨ç³»çµ±ï¼Œæ¯”å¦‚é›»å•†ã€æ–°èé¡ã€è«®è©¢é¡ç¶²ç«™ã€‚åœ¨ä½¿ç”¨ElasticSearché–‹ç™¼æ‡‰ç”¨çš„éç¨‹ä¸­ï¼Œä¸€å€‹éå¸¸é‡è¦çš„éç¨‹æ˜¯å°‡æ•¸æ“šå°å…¥åˆ°ElasticSearchç´¢å¼•ä¸­å»ºç«‹æ–‡æª”ã€‚åœ¨ä¸€é–‹å§‹ç³»çµ±è¦æ¨¡æ¯”è¼ƒå°æ™‚ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨logstashä¾†åŒæ­¥ç´¢å¼•ã€‚logstashçš„å¥½è™•æ˜¯é–‹æ–¹é‡å°‘ï¼Œåªè¦é€²è¡Œç·¨å¯«ç°¡å–®çš„ç´¢å¼•æ¨¡æ¿å’ŒåŒæ­¥sqlï¼Œå°±èƒ½å¿«é€Ÿæ­å»ºç´¢å¼•åŒæ­¥ç¨‹åºã€‚ä½†æ˜¯éš¨è‘—æ‡‰ç”¨æ•¸æ“šè¦æ¨¡çš„è®Šå¤§ï¼Œç´¢å¼•è®ŠåŒ–è®Šå¾—éå¸¸é »ç¹ã€‚logstashçš„ç¼ºé»ä¹Ÿéš¨è‘—æš´éœ²ï¼ŒåŒ…æ‹¬ï¼š</p><p>ï¼ˆ1ï¼‰ä¸æ”¯æŒåˆªé™¤ï¼Œåªèƒ½é€šéä¿®æ”¹å­—æ®µå±¬æ€§è»Ÿåˆªé™¤ï¼Œéš¨è‘—æ‡‰ç”¨ä½¿ç”¨æ™‚é–“çš„å¢é•·ï¼ŒElasticSearchä¸­æœƒç•™å­˜å¤§é‡çš„ç„¡ç”¨æ•¸æ“šï¼Œæ‹–æ…¢æœç´¢é€Ÿåº¦ã€‚ï¼ˆ2ï¼‰sqlåˆ†é æ•ˆç‡ä½ï¼ŒsqlæŸ¥è©¢æ…¢ã€‚logstashçš„åˆ†é é‚è¼¯æ˜¯å…ˆæœ‰ä¸€å€‹å¤§çš„å­æŸ¥è©¢ï¼Œç„¶å¾Œå†å¾å­æŸ¥è©¢ä¸­åˆ†é ç²å–æ•¸æ“šï¼Œå› æ­¤æ•ˆç‡ä½ä¸‹ï¼Œç•¶æ•¸æ“šåº«æ•¸æ“šé‡å¤§æ™‚ï¼Œä¸€å€‹åˆ†é æŸ¥è©¢å°±éœ€è¦å¹¾ç™¾ç§’ã€‚åŒæ­¥å¹¾åƒè¬æ•¸æ“šå¯èƒ½éœ€è¦1å¤©æ™‚é–“ã€‚</p><p>å› æ­¤æˆ‘å€‘æ±ºå®šæ”¾æ£„ä½¿ç”¨logstashï¼Œè€Œæ”¹ç”¨ä½¿ç”¨canalä¾†æ­å»ºåŸºæ–¼CDCæŠ€è¡“çš„ElasticSearchç´¢å¼•åŒæ­¥æ©Ÿåˆ¶ã€‚</p><p></p><h1 toutiao-origin=h3><strong toutiao-origin=h1>ç³»çµ±æ¶æ§‹è¨­è¨ˆ</strong></h1><img alt=åŸºæ–¼CDCæŠ€è¡“çš„ElasticSearchç´¢å¼•åŒæ­¥æ©Ÿåˆ¶ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/SDAIrbpCGdpuDg><p>å¦‚åœ–æ‰€ç¤ºï¼Œç´¢å¼•åŒæ­¥ç³»çµ±ç”±å¹¾å€‹éƒ¨åˆ†çµ„æˆï¼Œä¸‹é¢åˆ†é»ä»‹ç´¹ã€‚</p><p>ï¼ˆ1ï¼‰æ•¸æ“šåº«</p><p>åŸå§‹æ•¸æ“šæ•¸æ“šåº«</p><p>ï¼ˆ2ï¼‰Canal</p><p>Canalæ˜¯é˜¿é‡Œé›²é–‹æºçš„MySqlæ•¸æ“šåº«å¢é‡æ•¸æ“šè¨‚é–±å’Œæ¶ˆè²»å·¥å…·ã€‚å®ƒçš„å¯¦ç¾åŸç†æ˜¯å°‡è‡ªå·±å½è£ç‚ºä¸€å€‹MySQL slaveï¼Œå‘MySql ma sterç™¼é€dumpå”è­°ï¼›MySQL masteræ”¶åˆ°dumpè«‹æ±‚ï¼Œé–‹å§‹æ¨é€binary logçµ¦slaveï¼Œcanalè§£æbinary logå°è±¡ã€‚</p><p>ï¼ˆ3ï¼‰Canal Client</p><p>Canal Clientæ˜¯è‡ªå·±å¯¦ç¾çš„ç¨‹åºï¼Œé€šéå¾Canal Serverä¸­ç²å–ç¶“éCanalè§£æä¹‹å¾Œçš„æ•¸æ“šåº«binlogæ—¥èªŒï¼Œåšç›¸æ‡‰çš„æ¥­å‹™é‚è¼¯è™•ç†ã€‚åœ¨æœ¬æ–‡ä»‹ç´¹çš„åŸºæ–¼CDCçš„ç´¢å¼•åŒæ­¥ç³»çµ±ä¸­ï¼ŒCanal Clientè¨‚é–±æœç´¢ç›¸é—œçš„æ•¸æ“šåº«è¡¨çš„binlogæ—¥èªŒï¼Œå¦‚æœè·Ÿæ•¸æ“šæœç´¢ç›¸é—œçš„æ•¸æ“šç™¼ç”Ÿè®ŠåŒ–æ™‚ï¼Œå°±å‘Rabbitç™¼ä¸€æ¢æ¶ˆæ¯ï¼Œè¡¨æ˜æ•¸æ“šç™¼ç”Ÿè®ŠåŒ–äº†ï¼Œé€šçŸ¥åŒæ­¥Workerå¾MySQLåŒæ­¥æ•¸æ“šåˆ°ESã€‚</p><p>ï¼ˆ4ï¼‰RabbitMQ</p><p>æ¶ˆæ¯éšŠåˆ—ï¼Œä¹Ÿå¯ä»¥é¸ç”¨Kafakaç­‰å…¶ä»–æ¶ˆæ¯éšŠåˆ—ï¼Œæ ¹æ“šå…·é«”æ¥­å‹™ç¢ºå®šã€‚</p><p>ï¼ˆ5ï¼‰ç´¢å¼•åŒæ­¥Worker</p><p>Workerå¾æ¶ˆæ¯éšŠåˆ—ä¸­æ¶ˆè²»æ•¸æ“šï¼Œæ ¹æ“šæ¶ˆæ¯å¾MySQLç²å–ç›¸æ‡‰çš„æ•¸æ“šä¸¦åŒæ­¥åˆ°ElasticSearchä¸­ã€‚</p><p></p><h1 toutiao-origin=h3><strong toutiao-origin=h1>Canal Clientå¯¦ç¾</strong></h1><p>Canal Clientå¾Canal Serverä¸­ç²å–binlogæ—¥èªŒï¼Œä¸¦æ ¹æ“šæ¥­å‹™éœ€æ±‚é€²è¡Œè™•ç†ã€‚ä»¥ä¸‹é€šéä¸€äº›é—œéµä»£ç¢¼ä»‹ç´¹Canal Clientçš„å¯¦ç¾ã€‚</p><p>ï¼ˆ1ï¼‰åœ¨pomä¸­æ·»åŠ Canal clientçš„ä¾è³´ã€‚</p><pre><code>&lt;dependency&gt;<br>&lt;groupId&gt;com.alibaba.otter&lt;/groupId&gt;<br>&lt;artifactId&gt;canal.client&lt;/artifactId&gt;<br>&lt;version&gt;1.1.0&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre><p>ï¼ˆ2ï¼‰åˆå§‹åŒ–Canalé€£æ¥</p><p>CanalConfigåŒ…å«äº†Canalçš„é…ç½®ä¿¡æ¯ã€‚CanalConnectorç‚ºcanal-clientåŒ…ä¸­çš„é¡ï¼Œæˆ‘å€‘é€šéé€™å€‹é¡ä¾†é€£æ¥serverï¼Œç²å–binlogï¼Œé—œé–‰serverã€‚è©²æœå‹™åŸºæ–¼SpringBootã€‚å› æ­¤initæœƒåœ¨CanalClientInitializer beanè¢«å‰µå»ºæ™‚è¢«èª¿ç”¨ï¼ŒpreDestoryæœƒåœ¨æœå‹™é—œé–‰ï¼ŒCanClientInitializerè¢«éŠ·ç‡¬æ™‚è¢«èª¿ç”¨ã€‚</p><pre><code>@Component<br>@Slf4j<br>public class CanalClientInitializer {<br><br><br>CanalConfig canalConfig;<br><br>CanalConnector connector;<br><br>CanalDataProcessor canalDataProcessor;<br><br><br>public CanalClientInitializer(@Autowired CanalConfig canalConfig, @Autowired CanalDataProcessor canalDataProcessor) {<br>this.canalConfig = canalConfig;<br>this.canalDataProcessor = canalDataProcessor;<br>}<br><br><br>@PostConstruct<br>public void init throws InterruptedException {<br>connector = CanalConnectors.newSingleConnector(new InetSocketAddress(canalConfig.getIp, canalConfig.getPort), canalConfig.getDestination, "", "");<br>//å»ºç«‹é€£æ¥<br>connector.connect;<br>//è¨‚é–±ç›¸é—œçš„è¡¨<br>connector.subscribe(canalConfig.getSyncTable);<br>canalDataProcessor.process(connector);<br>}<br><br><br>@PreDestroy<br>public void<strong class=highlight-text toutiao-origin=span>preDestroy</strong> {<br>log.info("stop the canal client");<br>canalDataProcessor.stopProcess;<br>}<br><br>}<br></code></pre><p>ï¼ˆ3ï¼‰CanalDataProcessorç²å–ä¸¦è™•ç†binlog</p><pre><code>@Component<br>@Slf4j<br>public class CanalDataProcessor {<br><br><br>boolean isRunning;<br><br>RabbitTemplate rabbitTemplate;<br><br>TableChangeProcessor tableChangeProcessor;<br><br>public CanalDataProcessor(@Autowired RabbitTemplate rabbitTemplate, @Autowired TableChangeProcessor processor) {<br>this.rabbitTemplate = rabbitTemplate;<br>this.tableChangeProcessor = processor;<br>}<br><br>@Async<br>public void process(CanalConnector connector) throws InterruptedException {<br>isRunning = true;<br>while (isRunning) {<br>try {<br>//ç²å–æ¶ˆæ¯<br>Message message = connector.getWithoutAck(100, 10L, TimeUnit.SECONDS);<br>//æ¥­å‹™è™•ç†é‚è¼¯<br>processMessage(message);<br>//æ¶ˆæ¯è¢«æˆåŠŸåŸ·è¡Œï¼Œå‘Canal Serverç™¼é€ackæ¶ˆæ¯é€šçŸ¥serverè©²messageå·²ç¶“è¢«è™•ç†å®Œæˆ<br>connector.ack(message.getId);<br>} catch (Exception e) {<br>log.error("wtf", e);<br>//ç•¶æ¶ˆæ¯æ²’è¢«æˆåŠŸè™•ç†å®Œæˆæ™‚é€²è¡Œå›æ»¾ï¼Œä¸‹æ¬¡èƒ½å¤ é‡æ–°ç²å–è©²Message<br>connector.rollback;<br>Thread.sleep(1000);<br>}<br>}<br>connector.disconnect;<br>}<br><br><br>public void<strong class=highlight-text toutiao-origin=span>stopProcess</strong> {<br>isRunning = false;<br>}<br><br><br>private void processMessage(Message message) {<br>for(Entry entry : message.getEntries) {<br>try {<br>tableChangeProcessor.process(entry);<br>} catch (Exception e) {<br>log.error("wtf", e);<br>continue;<br>}<br>}<br>}<br>}<br></code></pre><p>ï¼ˆ4ï¼‰TableChangeProcessor</p><p>TableChangeProcessorä¸­ç‚ºå…·é«”çš„æ¥­å‹™é‚è¼¯ï¼Œè™•ç†Messageï¼Œç²å–è·Ÿæœç´¢ç›¸é—œçš„æ•¸æ“šè®ŠåŒ–ï¼Œç™¼é€ç›¸æ‡‰çš„æ¶ˆæ¯åˆ°æ¶ˆæ¯éšŠåˆ—ä¸­ã€‚æ³¨æ„é» ï¼ˆ1ï¼‰å¿½ç•¥æœç´¢ç„¡é—œçš„æ•¸æ“šå­—æ®µè®ŠåŒ–ï¼Œé¿å…ä¸å¿…è¦çš„ç´¢å¼•æ›´æ–°ï¼Œé™ä½æœå‹™å™¨å£“åŠ›ã€‚å¦‚Productsè¡¨ä¸­æœ‰ä¸€å€‹product_weightè¡¨ç¤ºå•†å“é‡é‡ç™¼ç”Ÿäº†è®ŠåŒ–ï¼Œä½†å…¶å¯¦å•†å“é‡é‡è·Ÿæœç´¢ç„¡é—œï¼Œé‚£å°±ä¸è¦é—œå¿ƒé€™å€‹è®ŠåŒ–ã€‚</p><p>ï¼ˆ2ï¼‰å°æ–¼æœç´¢ä¸­ä¸æœƒå‡ºç¾çš„æ•¸æ“šï¼Œä¸è¦å¯«å…¥åˆ°ESä¸­ï¼Œæ¯”å¦‚é›»å•†å•†å“ä¸­çš„ä¸‹æ¶å•†å“ï¼Œå¦å¤–ï¼Œå¦‚æœå•†å“è¢«ä¸‹æ¶ï¼Œå‰‡è¦é€²è¡Œç›£è½é€šçŸ¥ç´¢å¼•åŒæ­¥Workerå¾esä¸­åˆªé™¤ç´¢å¼•æ–‡æª”ã€‚é€™æ¨£èƒ½å¤ é™ä½ESä¸­ç¸½çš„ç´¢å¼•æ–‡æª”æ•¸é‡ï¼Œæå‡æœç´¢æ•ˆç‡ã€‚</p><p>ï¼ˆ3ï¼‰è¦è€ƒæ…®Rabbitæ›æ‰æˆ–è€…éšŠåˆ—å¯«æ»¿ï¼Œæ¶ˆæ¯ç„¡æ³•å¯«å…¥çš„æƒ…æ³ï¼›é¦–å…ˆæ‡‰è©²åœ¨Rabbitç™¼é€æ¶ˆæ¯æ™‚æ·»åŠ é‡è©¦ï¼Œå…¶æ¬¡æ‡‰è©²åœ¨é‡è©¦å¹¾æ¬¡é‚„æ˜¯å¤±æ•—çš„æƒ…æ³ä¸‹æ‹‹å‡ºç•°å¸¸ï¼Œcanalæ¶ˆæ¯æµå›æ»¾ï¼Œä¸‹æ¬¡é‚„æ˜¯èƒ½å¤ ç²å–åˆ°é€™å€‹æ•¸æ“šè®ŠåŒ–çš„Canalæ¶ˆæ¯ï¼Œé¿å…æ•¸æ“šè®Šå‹•çš„ä¸Ÿå¤±ã€‚</p><p>ï¼ˆ4ï¼‰æ³¨æ„ç›®å‰Canalåªæ”¯æŒå–®Clientã€‚å¦‚æœè¦å¯¦ç¾é«˜å¯ç”¨ï¼Œå‰‡éœ€è¦ä¾è³´æ–¼ZooKeeperï¼Œä¸€å€‹Clientä½œç‚ºå·¥ä½œClientï¼Œå…¶é¤˜Clientä½œç‚ºå†·å‚™ï¼Œç•¶å·¥ä½œClientæ›æ‰æ™‚ï¼Œå†·å‚™Clientç›£è½åˆ°ZooKeeperæ•¸æ“šè®ŠåŒ–ï¼Œæ¶ä½”é–æˆç‚ºå·¥ä½œClientã€‚</p><p></p><h1 toutiao-origin=h3><strong toutiao-origin=h1>Canal Workerå¯¦ç¾</strong></h1><p>ç´¢å¼•åŒæ­¥Workerå¾æ¶ˆæ¯éšŠåˆ—ä¸­ç²å–Canal Clientç™¼é€çš„è·Ÿæœç´¢ç›¸é—œçš„æ•¸æ“šåº«è®ŠåŒ–æ¶ˆæ¯ã€‚èˆ‰å€‹ä¾‹å­ï¼Œæ¯”å¦‚å•†å“è¡¨ä¸­è·Ÿæœç´¢ç›¸é—œçš„å­—æ®µç™¼ç”Ÿäº†è®ŠåŒ–ï¼ŒCanal Clientæœƒç™¼é€ä»¥ä¸‹ä¸€æ¢æ•¸æ“šï¼š</p><pre><code>{<br>"change_id": "694212527059369984",<br>"change_type": 1, //å•†å“ç™¼ç”Ÿè®ŠåŒ–<br>"change_time": "1600741397"<br>}<br></code></pre><p>åœ¨Workerä¸­ç›£è½éšŠåˆ—æ¶ˆæ¯ï¼š</p><pre><code>@Component<br>@Slf4j<br>public class ProductChangeQueueListener {<br><br>@Autowired<br>@Qualifier("snake")<br>ObjectMapper om;<br><br>@Autowired<br>ChangeEventHandlerFactory changeEventHandlerFactory;<br><br>@RabbitListener(queues = RabbitConfig.PRODUCT_QUEUE_NAME, containerFactory = "customRabbitListenerContainerFactory")<br>public void onChange(Message message) {<br><br>ChangeEvent event = parse(message);<br>if(event == ) {<br>return;<br>}<br><br>changeEventHandlerFactory.handle(event);<br>}<br><br>private ChangeEvent parse(Message message) {<br>ChangeEvent event = ;<br>try {<br>event = om.readValue(new String(message.getBody), ChangeEvent.class);<br>} catch (Exception e) {<br>log.error("åŒæ­¥å¤±æ•—ï¼Œè§£æå¤±æ•—", e);<br>}<br>return event;<br>}<br><br><br>}<br></code></pre><p>ChangeEventHandlerFactoryç‚ºäº‹ä»¶è™•ç†å™¨çš„å·¥å» é¡ã€‚ä»¥ä¸‹ç‚ºä¸€å€‹äº‹ä»¶è™•ç†å™¨çš„å¯¦ç¾ã€‚å®ƒç›£è½changeTypeç‚ºCHANGE_TYPE_OUT_PRODUCTçš„äº‹ä»¶ï¼Œå¾æ•¸æ“šåº«ä¸­ç²å–åˆ°è®Šå‹•çš„æ•¸æ“šï¼Œæ§‹å»ºESçš„IndexRequestï¼Œä¸¦å°‡Requestå­˜å…¥åˆ°RequestBulkBufferä¸­ï¼Œç­‰å¾…æ‰¹é‡åŒæ­¥åˆ°ESä¸­ã€‚æœ‰äº›åŒå­¸å¯èƒ½æœƒæœ‰ç–‘å•ï¼Œç‚ºä½•ä¸ç›´æ¥å¾Canalä¸­ç²å–æ•¸æ“šï¼Œä¸»è¦åŸå› æ˜¯Canalä¸­åªåŒ…å«äº†å–®è¡¨æ•¸æ“šï¼Œä½†æ˜¯ç´¢å¼•æ–‡æª”å¯èƒ½åŒ…å«äº†å¤šè¡¨çš„æ•¸æ“šï¼Œå› æ­¤é‚„éœ€è¦å¾MySQLç²å–æ•¸æ“šã€‚å¦‚æœç´¢å¼•æ–‡æª”ä¸­åªåŒ…å«å–®è¡¨æ•¸æ“šï¼Œå¯ä»¥è€ƒæ…®åœ¨ChangeEventä¸­åŒ…å«ä¿®æ”¹ä¹‹å¾Œçš„æ•¸æ“šï¼Œç´¢å¼•åŒæ­¥Wokerå°±ä¸ç”¨å†å¾MySqlä¸­å†ç²å–ä¸€éæ•¸æ“šï¼Œæå‡Workerå·¥ä½œæ•ˆç‡ã€‚</p><pre><code>@Component<br>@Slf4j<br>public class OutProductEventHandler implements ChangeEventHandler {<br><br>@Autowired<br>ProductDao productDao;<br><br>@Autowired<br>RequestBulkBuffer buffer;<br><br><br>@Autowired<br>OutProductChangeRequestBuilder builder;<br><br>@Override<br>@Retryable<br>public boolean handle(ChangeEvent changeEvent) {<br>if (!match(changeEvent)) {<br>return false;<br>}<br><br>Tuple dataTuple = productDao.getProductWithStore(changeEvent.getChangeId);<br>if (dataTuple == ) {<br>return true;<br>}<br>Product product = dataTuple.get(QProduct.product);<br>Store store = dataTuple.get(QStore.store);<br><br>IndexRequest request = ;<br>try {<br>request = builder.convertToUpdateQuery(getTimestampNow, product, store);<br>} catch (Exception e) {<br>log.error("wtf", e);<br>}<br>if (request == ) {<br>return true;<br>}<br>buffer.add(request);<br>return true;<br><br>}<br><br>@Override<br>public boolean match(ChangeEvent changeEvent) {<br>return ChangeEvent.CHANGE_TYPE_OUT_PRODUCT == changeEvent.getChangeType;<br>}<br>}<br></code></pre><p>åœ¨ä¸Šé¢çš„OutProductEventHandleré¡ä¸­ï¼Œæˆ‘å€‘ä¸¦ä¸ç›´æ¥åœ¨è©²é¡ä¸­ä½¿ç”¨RestHighLevelClientå°‡æ–‡æª”æ›´æ–°åˆ°ESç´¢å¼•ï¼Œè€Œæ˜¯å°‡IndexRequestæš«å­˜åˆ°RequestBulkBufferä¸­ã€‚RestBulkBufferä½¿ç”¨CircularFifoBufferä½œç‚ºå­˜å„²æ•¸æ“šçµæ§‹ã€‚</p><pre><code>@Component<br>public class RequestBulkBuffer {<br><br>CircularFifoBuffer buffer;<br><br>public RequestBulkBuffer(CircularFifoBuffer buffer) {<br>this.buffer = buffer;<br>}<br><br><br>public void add(DocWriteRequest&lt;?&gt; request) {<br>buffer.add(request);<br>}<br><br>}<br></code></pre><p>CircularFifoBufferæ˜¯ä¸€å€‹ç¶“éæ”¹é€ çš„ç’°å½¢éšŠåˆ—å¯¦ç¾ã€‚å…è¨±å¤šç·šç¨‹å¯«ï¼Œåœ¨æˆ‘å€‘é€™å€‹æ‡‰ç”¨å ´æ™¯ä¸­åªæ”¯æŒä¹Ÿåªéœ€æ”¯æŒå–®ç·šç¨‹è®€->è™•ç†->ç§»é™¤è™•ç†å®Œçš„æ•¸æ“šã€‚ç•¶ç’°å½¢éšŠåˆ—ç·©å­˜æ»¿æ™‚ï¼Œè—‰åŠ©æ–¼semaphoreï¼Œå¯«å…¥ç·šç¨‹å°‡æœƒè¢«é˜»å¡ï¼Œåœ¨å¾Œé¢çš„Workerå¦‚ä½•é˜²æ­¢æ•¸æ“šä¸Ÿå¤±ä¸­ï¼Œæˆ‘å€‘ä¾†é—¡è¿°ç‚ºä»€éº¼è¦é€™éº¼åšã€‚</p><pre><code>/**<br>* å…è¨±å¤šç·šç¨‹å¯«<br>* åªå…è¨±å–®ç·šç¨‹-&gt;è®€-&gt;è™•ç†-&gt;ç§»é™¤<br>*/<br>public class CircularFifoBuffer {<br><br>private Logger logger = LoggerFactory.getLogger(CircularFifoBuffer.class.getName);<br><br><br>private transient Object elements;<br><br>private transient int start = 0;<br>private transient int end = 0;<br><br>private transient boolean full = false;<br><br>private final int maxElements;<br><br>private ReentrantLock addLock;<br><br>private Semaphore semaphore;<br><br>public CircularFifoBuffer(int size) {<br>if (size &lt;= 0) {<br>throw new IllegalArgumentException("The size must be greater than 0");<br>}<br>elements = new Object[size];<br>maxElements = elements.length;<br>addLock = new ReentrantLock;<br>semaphore = new Semaphore(size);<br>}<br><br><br>public int<strong class=highlight-text toutiao-origin=span>size</strong> {<br>int size = 0;<br><br>if (end &lt; start) {<br>size = maxElements - start + end;<br>} else if (end == start) {<br>size = (full ? maxElements : 0);<br>} else {<br>size = end - start;<br>}<br><br>return size;<br>}<br><br>public boolean<strong class=highlight-text toutiao-origin=span>isEmpty</strong> {<br>return size == 0;<br>}<br><br>public boolean<strong class=highlight-text toutiao-origin=span>isFull</strong> {<br>return size == maxElements;<br>}<br><br>public int<strong class=highlight-text toutiao-origin=span>maxSize</strong> {<br>return maxElements;<br>}<br><br>public void<strong class=highlight-text toutiao-origin=span>clear</strong> {<br>full = false;<br>start = 0;<br>end = 0;<br>Arrays.fill(elements, );<br>}<br><br>public boolean add(Object element) {<br>if ( == element) {<br>throw new PointerException("Attempted to add object to buffer");<br>}<br><br>addLock.lock;<br>try {<br>semaphore.acquire;<br>} catch (Exception e) {<br>logger.error("RingBuffer", "ç·šç¨‹é€€å‡ºï¼Œæ·»åŠ å¤±æ•—");<br>return false;<br>}<br><br>elements[end++] = element;<br><br><br>if (end &gt;= maxElements) {<br>end = 0;<br>}<br><br>if (end == start) {<br>full = true;<br>}<br><br>addLock.unlock;<br><br>return true;<br><br>}<br><br>public Object<strong class=highlight-text toutiao-origin=span>get</strong> {<br>if (isEmpty) {<br>return ;<br>}<br><br>return elements[start];<br>}<br><br><br>public Object<strong class=highlight-text toutiao-origin=span>remove</strong> {<br>if (isEmpty) {<br>return ;<br>}<br><br>Object element = elements[start];<br>if( != element) {<br>elements[start++] = ;<br>if (start &gt;= maxElements) {<br>start = 0;<br>}<br>full = false;<br>semaphore.release;<br>}<br>return element;<br>}<br><br><br>/**<br>* @param size the max size of elements will return<br>*/<br>public Object get(int size) {<br>int queueSize = size;<br>if (queueSize == 0) { //empty<br>return new Object[0];<br>}<br>int realFetchSize = queueSize &gt;= size ? size : queueSize;<br>if (end &gt; start) {<br>return Arrays.copyOfRange(elements, start, start + realFetchSize);<br>} else {<br>if (maxElements - start &gt;= realFetchSize) {<br>return Arrays.copyOfRange(elements, start, start + realFetchSize);<br>} else {<br>return ArrayUtils.addAll(<br>Arrays.copyOfRange(elements, start, maxElements),<br>Arrays.copyOfRange(elements, 0, realFetchSize - (maxElements - start))<br>);<br>}<br>}<br>}<br><br><br>public Object<strong class=highlight-text toutiao-origin=span>getAll</strong> {<br>return get(size);<br>}<br><br><br><br>public Object remove(int size) {<br>if(isEmpty) {<br>return new Object[0];<br>}<br>int queueSize = size;<br>int realFetchSize = queueSize &gt;= size ? size : queueSize;<br>Object  retArr = new Object[realFetchSize];<br>for(int i=0;i&lt;realFetchSize;i++) {<br>retArr[i] = remove;<br>}<br><br>return retArr;<br>}<br><br>}<br></code></pre><p>ä¸‹é¢é€™å€‹é¡ç‚ºç·©å­˜çš„æ¶ˆè²»è€…ï¼Œå®ƒå¾ªç’°å¾bufferä¸­ç²å–ä¸€å®šæ•¸æ“šçš„æ•¸æ“šï¼Œä¸¦ä½¿ç”¨RestHighLevelClientå°‡æ•¸æ“šæ‰¹é‡åŒæ­¥åˆ°ESã€‚åœ¨Workerå•Ÿå‹•æ™‚ï¼Œæœƒå‰µå»ºä¸€å€‹ç·šç¨‹èª¿ç”¨startConsumeï¼Œåœ¨æœå‹™é—œé–‰æ™‚è©²ç·šç¨‹çµæŸã€‚</p><pre><code>@Slf4j<br>public class RequestBulkConsumer {<br>private static final int DEFAULT_BULK_SIZE = 2000;<br><br>private CircularFifoBuffer buffer;<br>private EsBulkRequestService service;<br><br>private boolean isRunning = false;<br>private int bulkSize = DEFAULT_BULK_SIZE;<br><br>public RequestBulkConsumer(CircularFifoBuffer buffer, RestHighLevelClient client) {<br>this.buffer = buffer;<br>this.service = new EsBulkRequestService(client);<br>}<br><br>public void setBulkSize(int size) {<br>this.bulkSize = size;<br>}<br><br>public int<strong class=highlight-text toutiao-origin=span>getBulkSize</strong> {<br>return bulkSize;<br>}<br><br>public boolean<strong class=highlight-text toutiao-origin=span>isRunning</strong> {<br>return isRunning;<br>}<br><br><br>public void<strong class=highlight-text toutiao-origin=span>startConsume</strong> {<br>if(isRunning) {<br>return;<br>}<br>isRunning = true;<br>while(true) {<br>if(!isRunning) {<br>break;<br>}<br><br>Object  items = buffer.get(bulkSize);<br>if(items.length == 0) {<br>try {<br>Thread.sleep(1000);<br>} catch (InterruptedException e) {<br>break;<br>}<br>} else {<br>List&lt;DocWriteRequest&lt;?&gt;&gt; requests = convert(items);<br>try {<br>BulkResponse response = service.request(requests);<br>processResponse(response);<br>buffer.remove(items.length);<br>if (items.length &lt; bulkSize) {<br>Thread.sleep(3000);<br>}<br>} catch (InterruptedException e) {<br>break;<br>} catch (IOException e) {<br>log.error("wtf", e);<br>} catch (Exception e) {<br>log.error("wtf", e);<br>buffer.remove(items.length);<br>}<br>}<br>}<br>}<br><br><br>private List&lt;DocWriteRequest&lt;?&gt;&gt; convert(Object [] items) {<br>return Stream.of(items)<br>.map(i -&gt; {<br>if(i instanceof DocWriteRequest) {<br>return (DocWriteRequest&lt;?&gt;) i;<br>} else {<br>return ;<br>}<br>})<br>.filter(Objects::non)<br>.collect(Collectors.toList);<br>}<br><br>public void<strong class=highlight-text toutiao-origin=span>stop</strong> {<br>isRunning = false;<br>}<br><br><br>private void processResponse(BulkResponse bulkResponse) {<br>BulkItemResponse  itemResponseArr = bulkResponse.getItems;<br>for(BulkItemResponse resp : itemResponseArr) {<br>DocWriteResponse docWriteResponse = resp.getResponse;<br>if(docWriteResponse instanceof IndexResponse) {<br>IndexResponse indexResponse = (IndexResponse) docWriteResponse;<br>if(indexResponse.getResult != Result.CREATED &amp;&amp; indexResponse.getResult != Result.UPDATED) {<br>if(indexResponse.status == RestStatus.CONFLICT) {<br>continue;<br>} else {<br>log.error("ç´¢å¼•æ›´æ–°å¤±æ•—: {}, {}", indexResponse.getId, resp.getFailureMessage);<br>}<br>}<br>} else if(docWriteResponse instanceof DeleteResponse) {<br>DeleteResponse deleteResponse = (DeleteResponse) docWriteResponse;<br>if(deleteResponse.getResult != Result.DELETED) {<br>log.error("ç´¢å¼•åˆªé™¤å¤±æ•—: {}, {}", deleteResponse.getId, resp.getFailureMessage);<br>}<br>}<br>}<br>}<br>}<br><br></code></pre><p>ä»¥ä¸‹ç‚ºWorkerçš„ä¸»è¦å¹¾å€‹é¡çš„ä»£ç¢¼ã€‚åœ¨ç´¢å¼•åŒæ­¥ç³»çµ±ä¸­ï¼Œé«˜å¯ç”¨ä¸¦ä¸æ˜¯æœ€é‡è¦çš„ï¼Œå› ç‚ºæˆ‘å€‘çš„æœç´¢æœ¬èº«æ˜¯ä¸€å€‹æº–å¯¦æ™‚ç³»çµ±ï¼Œåªéœ€è¦ä¿è­‰æœ€çµ‚ä¸€è‡´æ€§å°±å¯ä»¥äº†ï¼Œæˆ‘å€‘ä¸»è¦éœ€è¦é¿å…çš„æ˜¯æ•¸æ“šè®Šæ›´çš„ä¸Ÿå¤±ã€‚ä»¥ä¸‹èªªæ˜åœ¨Workerä¸­æ˜¯å¦‚ä½•é¿å…æ•¸æ“šä¸Ÿå¤±çš„ã€‚</p><p></p><h1 toutiao-origin=h3><strong toutiao-origin=h1>é¿å…æ•¸æ“šä¸Ÿå¤±</strong></h1><p>ï¼ˆ1ï¼‰å¦‚æœRabbitæ›æ‰ï¼Œæ²’é—œä¿‚ï¼ŒCanal Clienté‚£é‚Šåœ¨Rabbitæ›æ‰æœŸé–“ç„¡æ³•æ¶ˆè²»binlogï¼Œæœƒç­‰å¾…Rabbité‡å•Ÿä¹‹å¾Œå†è™•ç†æ•¸æ“šè®ŠåŒ–ã€‚Workeråªè¦èƒ½åšåˆ°Rabbité‡å•Ÿä¹‹å¾Œé‡é€£å°±è¡Œã€‚</p><p>ï¼ˆ2ï¼‰å¦‚æœMySQLæ›æ‰ï¼Œå‰‡Workerç„¡æ³•å¾æ•¸æ“šåº«ä¸­ç²å–æ•¸æ“šï¼Œå‰‡æ¶ˆæ¯è™•ç†å¤±æ•—ï¼Œæ¶ˆæ¯æœƒå †ç©åœ¨Rabbitä¸­ã€‚ç­‰MySQLé‡æ–°ä¸Šç·šä¹‹å¾Œï¼Œæ¶ˆæ¯é‡æ–°é–‹å§‹è™•ç†ï¼Œæ•¸æ“šä¹Ÿä¸æœƒä¸Ÿå¤±ã€‚</p><p>ï¼ˆ3ï¼‰å¦‚æœESæ›æ‰ï¼Œå‰‡æ‰¹é‡è™•ç†ç·šç¨‹æ¶ˆè²»bufferä¸­çš„æ•¸æ“šæ™‚æœƒå¤±æ•—ï¼Œbufferæœƒè¢«ç”Ÿç”¢è€…å¡«æ»¿ï¼Œç”±æ–¼CircularFifoBufferåœ¨è¢«å¡«æ»¿æ™‚ä½¿ç”¨äº†ä¿¡è™Ÿé‡é˜»å¡ç”Ÿç”¢è€…ç·šç¨‹ï¼Œæ¶ˆæ¯åˆæœƒè¢«å †ç©åœ¨Rabbitä¸­ï¼Œç­‰å¾…ESé‡æ–°ä¸Šç·šä¹‹å¾Œï¼Œæ¶ˆæ¯é‡æ–°é–‹å§‹è™•ç†ï¼Œæ•¸æ“šä¹Ÿä¸æœƒä¸Ÿå¤±ã€‚</p><p>ï¼ˆ4ï¼‰å¦‚æœRabbitéšŠåˆ—è¢«å¯«æ»¿ï¼Œemmmï¼Œè¨­ç½®å¥½åœ¨å…§å­˜è¢«ä½”æ»¿æ™‚å°‡æ¶ˆæ¯å¯«å…¥ç¡¬ç›¤ç„¶å¾Œæä¸€å€‹å¤§ä¸€é»çš„ç¡¬ç›¤å§ï¼ŒRabbité»˜èªæ‡‰è©²å°±æ˜¯é€™éº¼åšçš„ã€‚ç„¶å¾Œåšå¥½é è­¦ï¼Œç•¶æ¶ˆæ¯é”åˆ°ä¸€å®šé‡æ™‚æŠ“ç·Šè™•ç†ï¼Œä¸€èˆ¬ä¾†èªªå¯èƒ½æ€§ä¸æ˜¯å¾ˆå¤§ã€‚</p><p>ï¼ˆ5ï¼‰ç‰ˆæœ¬è¡çªï¼Œå¦‚æœå•†å“è¡¨ä¸­æŸä¸€æ¢æ•¸æ“šå¦‚å•†å“Aåœ¨åŒä¸€ç§’å…§è®ŠåŒ–äº†å…©æ¬¡ï¼Œæ¶ˆæ¯éšŠåˆ—ä¸­æœ‰é€£çºŒå…©æ¢æ¶ˆæ¯ï¼Œåˆç”±æ–¼é€™å…©æ¢æ¶ˆæ¯å¯èƒ½åœ¨å…©å€‹ç·šç¨‹ä¸­è¢«æ¶ˆè²»ï¼Œç”±æ–¼ç¶²çµ¡ï¼Œè¨ˆç®—æ©Ÿæ€§èƒ½ç­‰åŸå› ï¼Œå…ˆè®Šçš„æ•¸æ“šå¾Œè¢«å¯«å…¥ESä¸­ï¼Œå°è‡´ESä¸­æ•¸æ“šå’ŒMySqlæ•¸æ“šä¸ä¸€è‡´ã€‚å› æ­¤æˆ‘å€‘åœ¨æ›´æ–°ç´¢å¼•æ™‚ä½¿ç”¨ESçš„å¤–éƒ¨ç‰ˆæœ¬è™Ÿã€‚ä½¿ç”¨å¾MySQLä¸­å–æ•¸æ“šæ™‚çš„æ™‚é–“æˆ³ä½œç‚ºç‰ˆæœ¬è™Ÿï¼Œåªæœ‰ç•¶æ™‚é–“æˆ³æ¯”ç•¶å‰ç‰ˆæœ¬è™Ÿå¤§æˆ–ç›¸ç­‰æ™‚æ‰èƒ½è®Šæ›´æ–‡æª”ï¼Œå¦å‰‡ESæœƒå ±ç‰ˆæœ¬è¡çªéŒ¯èª¤ã€‚</p><pre><code> private IndexRequest convertToUpdateQuery(Long timestamp, OutStoreProduct outStoreProduct) throws JsonProcessingException {<br>IndexRequest indexRequest = new IndexRequest(indexName, "doc", outStoreProduct.getId);<br>if(StringUtils.isEmpty(outStoreProduct.getTooEbaoProductId)) {<br>log.error("å•†å“ {} çš„ebaoProductIdç‚ºç©ºï¼Œç„¡æ³•åŒæ­¥", outStoreProduct.getId);<br>return ;<br>}<br>indexRequest.source(om.writeValueAsString(outStoreProduct), XContentType.JSON)<br>.versionType(VersionType.EXTERNAL_GTE)<br>.version(timestamp)<br>.routing(outStoreProduct.getTooEbaoProductId);<br>return indexRequest;<br>}<br></code></pre><p></p><h1 toutiao-origin=h3><strong toutiao-origin=h1>é—œæ–¼å…¨é‡åŒæ­¥</strong></h1><p>ä»¥ä¸Šåªæ˜¯å¯¦ç¾äº†å¢é‡åŒæ­¥ï¼Œåœ¨ç´¢å¼•åˆå§‹åŒ–æ™‚ï¼Œæˆ‘å€‘éœ€è¦åšå…¨é‡åŒæ­¥æ“ä½œï¼Œå°‡æ•¸æ“šå¾æ•¸æ“šåº«åˆå§‹åŒ–åˆ°ESç´¢å¼•ä¸­ã€‚æˆ‘å€‘å¯ä»¥åœ¨Workerä¸­å¯«ä¸€å€‹æ¥å£ï¼Œè©²æ¥å£å¯¦ç¾é‚è¼¯åˆ†æ‰¹å°‡æ•¸æ“šåŒæ­¥ä»»å‹™ç™¼åˆ°æ¶ˆæ¯éšŠåˆ—ä¸­ï¼Œå…¶å®ƒworkeræ”¶åˆ°æ¶ˆæ¯å¾Œå®Œæˆå°æ‡‰ä»»å‹™ã€‚æ¯”å¦‚æˆ‘å€‘å¯ä»¥ç™¼ä½ˆæ¯ä¸€å€‹é–€åº—çš„æ•¸æ“šåŒæ­¥ä»»å‹™ï¼Œworkeræ¯æ”¶åˆ°ä¸€å€‹æ¶ˆæ¯ï¼ŒåŒæ­¥ä¸€å€‹é–€åº—çš„æ•¸æ“šã€‚</p><p></p><h1 toutiao-origin=h3><strong toutiao-origin=h1>ç¸½çµ</strong></h1><p>ç¶œä¸Šï¼Œæœ¬ç³»çµ±æ˜¯ä¸€å€‹è¿‘å¯¦æ™‚çš„èƒ½å¤ ä¿è­‰ESå’ŒMySQLæ•¸æ“šä¸€è‡´æ€§çš„é«˜æ•ˆç´¢å¼•åŒæ­¥ç³»çµ±ã€‚</p><blockquote><p>ä½œè€…ï¼šTango2100 éˆæ¥ï¼šhttps://juejin.im/post/6875591758802059278</p></blockquote><pre><br><div><img alt=åŸºæ–¼CDCæŠ€è¡“çš„ElasticSearchç´¢å¼•åŒæ­¥æ©Ÿåˆ¶ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/RdIEj9hARSR1DD></div><br><div><ul><li><p>åŸºæ–¼ Apache Flink çš„å¯¦æ™‚ç›£æ§å‘Šè­¦ç³»çµ±</p></li><li><p>é—œæ–¼æ•¸æ“šä¸­è‡ºçš„æ·±åº¦æ€è€ƒèˆ‡ç¸½çµï¼ˆä¹¾ä¹¾è²¨ï¼‰</p></li><li><p>æ—¥èªŒæ”¶é›†Agentï¼Œé™°æš—æ½®æº¼çš„åœ°åº•ä¸–ç•Œ</p></li><li><p>2020 ç¹¼çºŒè¸è¸å¯¦å¯¦çš„åšå¥½è‡ªå·±</p></li></ul></div></pre><img alt=åŸºæ–¼CDCæŠ€è¡“çš„ElasticSearchç´¢å¼•åŒæ­¥æ©Ÿåˆ¶ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/S0FUMtl41NrEMK><img alt=åŸºæ–¼CDCæŠ€è¡“çš„ElasticSearchç´¢å¼•åŒæ­¥æ©Ÿåˆ¶ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/S0FUNTDJBxRdKz><pre><div><div><div><div><div><p>å…¬çœ¾è™Ÿ(<strong class=highlight-text toutiao-origin=span>zhisheng</strong>)è£¡å›è¦† é¢ç¶“ã€ClickHouseã€ESã€Flinkã€<strong class=highlight-text toutiao-origin=span>Springã€Javaã€Kafkaã€ç›£æ§ </strong>ç­‰é—œéµå­—å¯ä»¥æŸ¥çœ‹æ›´å¤šé—œéµå­—å°æ‡‰çš„æ–‡ç« ã€‚</p></div></div></div></div></div></pre><pre><div><div><div><div><div><div><div><div><div><div><div><div><div><div><p><strong toutiao-origin=span>ğŸ‘‡</strong></p></div></div></div></div></div></div></div></div></div></div></div></div></div></div></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>CDC</a></li><li><a>æŠ€è¡“</a></li><li><a>ElasticSearch</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/93727dba.html alt="æŠ€è¡“å¸– | 3åˆ†é˜æå®šå„ç¨®æ¸¬è©¦åˆ†ææŠ€è¡“" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/f055e0a4477240088de2abb7cd696cfa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/93727dba.html title="æŠ€è¡“å¸– | 3åˆ†é˜æå®šå„ç¨®æ¸¬è©¦åˆ†ææŠ€è¡“">æŠ€è¡“å¸– | 3åˆ†é˜æå®šå„ç¨®æ¸¬è©¦åˆ†ææŠ€è¡“</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2d0ddee5.html alt=å»ºç¯‰æˆ¿å±‹çµæ§‹å¹³è¡¡æŠ€è¡“è¦æ±‚ï¼Œä½ éƒ½æœƒçŸ¥é“å—ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/5e7d0001715d878ed66c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2d0ddee5.html title=å»ºç¯‰æˆ¿å±‹çµæ§‹å¹³è¡¡æŠ€è¡“è¦æ±‚ï¼Œä½ éƒ½æœƒçŸ¥é“å—ï¼Ÿ>å»ºç¯‰æˆ¿å±‹çµæ§‹å¹³è¡¡æŠ€è¡“è¦æ±‚ï¼Œä½ éƒ½æœƒçŸ¥é“å—ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/47c8cac0.html alt=æ–°ã€Šè£é…å¼æ··å‡åœŸå»ºç¯‰æŠ€è¡“æ¨™æº–ã€‹æœ‰å“ªäº›æ”¹è®Šï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1540524372015dc56ec3fb9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/47c8cac0.html title=æ–°ã€Šè£é…å¼æ··å‡åœŸå»ºç¯‰æŠ€è¡“æ¨™æº–ã€‹æœ‰å“ªäº›æ”¹è®Šï¼Ÿ>æ–°ã€Šè£é…å¼æ··å‡åœŸå»ºç¯‰æŠ€è¡“æ¨™æº–ã€‹æœ‰å“ªäº›æ”¹è®Šï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b6c2fc2b.html alt=éˆ¦åˆé‡‘ç²¾å¯†é‘„é€ æŠ€è¡“ç™¼å±•ç¾ç‹€ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/SCynkUUBbHN8CF style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b6c2fc2b.html title=éˆ¦åˆé‡‘ç²¾å¯†é‘„é€ æŠ€è¡“ç™¼å±•ç¾ç‹€>éˆ¦åˆé‡‘ç²¾å¯†é‘„é€ æŠ€è¡“ç™¼å±•ç¾ç‹€</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d2e8af08.html alt=å‚¾æ–œèˆªæ”æŠ€è¡“å°çŸ¥è­˜â€”â€”èˆªç·šè¨­è¨ˆç¯‡ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RS1ucOiDvLRlVt style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d2e8af08.html title=å‚¾æ–œèˆªæ”æŠ€è¡“å°çŸ¥è­˜â€”â€”èˆªç·šè¨­è¨ˆç¯‡>å‚¾æ–œèˆªæ”æŠ€è¡“å°çŸ¥è­˜â€”â€”èˆªç·šè¨­è¨ˆç¯‡</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d597da51.html alt=é»ƒæ²³é›»åŠ›æŠ€è¡“å…¬å¸åœ¨é¾ç¾Šå³½é€²è¡Œç„¡äººæ©Ÿå‚¾æ–œæ”å½±æ¸¬é‡ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1528429551298e033646798 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d597da51.html title=é»ƒæ²³é›»åŠ›æŠ€è¡“å…¬å¸åœ¨é¾ç¾Šå³½é€²è¡Œç„¡äººæ©Ÿå‚¾æ–œæ”å½±æ¸¬é‡>é»ƒæ²³é›»åŠ›æŠ€è¡“å…¬å¸åœ¨é¾ç¾Šå³½é€²è¡Œç„¡äººæ©Ÿå‚¾æ–œæ”å½±æ¸¬é‡</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cdb604f6.html alt=ã€Šé›·ç¥4ï¼šæ„›èˆ‡é›·ã€‹å°‡æ¡ç”¨â€œè™›æ“¬è£½ä½œâ€æŠ€è¡“ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/83a320a69b0f44e3baf7db07faac3c65 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cdb604f6.html title=ã€Šé›·ç¥4ï¼šæ„›èˆ‡é›·ã€‹å°‡æ¡ç”¨â€œè™›æ“¬è£½ä½œâ€æŠ€è¡“>ã€Šé›·ç¥4ï¼šæ„›èˆ‡é›·ã€‹å°‡æ¡ç”¨â€œè™›æ“¬è£½ä½œâ€æŠ€è¡“</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1cd5b6b6.html alt=è™›æ“¬ç¾å¯¦æŠ€è¡“åœ¨æ™ºèƒ½è£½é€ é ˜åŸŸå…·æœ‰é‡è¦çš„æ‡‰ç”¨åƒ¹å€¼ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3ed327880d3b4c5384619f21d6c81823 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1cd5b6b6.html title=è™›æ“¬ç¾å¯¦æŠ€è¡“åœ¨æ™ºèƒ½è£½é€ é ˜åŸŸå…·æœ‰é‡è¦çš„æ‡‰ç”¨åƒ¹å€¼>è™›æ“¬ç¾å¯¦æŠ€è¡“åœ¨æ™ºèƒ½è£½é€ é ˜åŸŸå…·æœ‰é‡è¦çš„æ‡‰ç”¨åƒ¹å€¼</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3a2b0c81.html alt="è™›æ“¬è£½é€ çš„åŸºçŸ³ï¼šæ•¸å€¼æ¨¡æ“¬æŠ€è¡“ | åŠ å¿«å¯¦ç¾å·¥æ¥­æ•¸å­—åŒ–" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/2f2c32f4bd734f9face045546d45a665 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3a2b0c81.html title="è™›æ“¬è£½é€ çš„åŸºçŸ³ï¼šæ•¸å€¼æ¨¡æ“¬æŠ€è¡“ | åŠ å¿«å¯¦ç¾å·¥æ¥­æ•¸å­—åŒ–">è™›æ“¬è£½é€ çš„åŸºçŸ³ï¼šæ•¸å€¼æ¨¡æ“¬æŠ€è¡“ | åŠ å¿«å¯¦ç¾å·¥æ¥­æ•¸å­—åŒ–</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ee69f5ac.html alt=åŸºæ–¼æ©Ÿå™¨è¦–è¦ºæŠ€è¡“å¿«é€Ÿæº–ç¢ºåœ°ç¢ºå®šæ”¶ç©«å¾Œå¹¹å¤§è±†ç¨®å­çš„å“è³ª class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/519b968bf69146fda9bf55f89779d373 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ee69f5ac.html title=åŸºæ–¼æ©Ÿå™¨è¦–è¦ºæŠ€è¡“å¿«é€Ÿæº–ç¢ºåœ°ç¢ºå®šæ”¶ç©«å¾Œå¹¹å¤§è±†ç¨®å­çš„å“è³ª>åŸºæ–¼æ©Ÿå™¨è¦–è¦ºæŠ€è¡“å¿«é€Ÿæº–ç¢ºåœ°ç¢ºå®šæ”¶ç©«å¾Œå¹¹å¤§è±†ç¨®å­çš„å“è³ª</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e203d547.html alt=å’Œä½ ä¸€èµ·çš„è»è¨“ï¼Œä¸‹é›¨ä¹Ÿç”œèœœï½œå››å·è¨—æ™®ä¿¡æ¯æŠ€è¡“è·æ¥­å­¸é™¢è»è¨“è¨˜ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/4cd61c2a490f48ebb0aa74d30ec8766b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e203d547.html title=å’Œä½ ä¸€èµ·çš„è»è¨“ï¼Œä¸‹é›¨ä¹Ÿç”œèœœï½œå››å·è¨—æ™®ä¿¡æ¯æŠ€è¡“è·æ¥­å­¸é™¢è»è¨“è¨˜>å’Œä½ ä¸€èµ·çš„è»è¨“ï¼Œä¸‹é›¨ä¹Ÿç”œèœœï½œå››å·è¨—æ™®ä¿¡æ¯æŠ€è¡“è·æ¥­å­¸é™¢è»è¨“è¨˜</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/916c8d26.html alt=é‹çˆå°ˆæ¥­æŠ€è¡“å•ç­”100æ¢ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/916c8d26.html title=é‹çˆå°ˆæ¥­æŠ€è¡“å•ç­”100æ¢>é‹çˆå°ˆæ¥­æŠ€è¡“å•ç­”100æ¢</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0efa050d.html alt=ã€ŒæŠ€è¡“ã€å·®é€Ÿå™¨ç¸½æˆçµæ§‹èˆ‡æ€§èƒ½åƒæ•¸åˆ†æ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/fa9c698160c045c8a64c08dac6018a30 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0efa050d.html title=ã€ŒæŠ€è¡“ã€å·®é€Ÿå™¨ç¸½æˆçµæ§‹èˆ‡æ€§èƒ½åƒæ•¸åˆ†æ>ã€ŒæŠ€è¡“ã€å·®é€Ÿå™¨ç¸½æˆçµæ§‹èˆ‡æ€§èƒ½åƒæ•¸åˆ†æ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4db7ced8.html alt="æŠ€è¡“ | æ°´æ³¥ç£¨ä¸»æ¸›é€Ÿæ©Ÿé«˜é€Ÿè»¸è»¸æ‰¿æ›´æ›" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/a1cfa2b9a4e74251a6b1114ba246a08f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4db7ced8.html title="æŠ€è¡“ | æ°´æ³¥ç£¨ä¸»æ¸›é€Ÿæ©Ÿé«˜é€Ÿè»¸è»¸æ‰¿æ›´æ›">æŠ€è¡“ | æ°´æ³¥ç£¨ä¸»æ¸›é€Ÿæ©Ÿé«˜é€Ÿè»¸è»¸æ‰¿æ›´æ›</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/592a3506.html alt=é‹çˆæŠ€è¡“å•ç­”å·¡æª¢å¿…çœ‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/9e74752d-8d81-484a-9349-961881c64498 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/592a3506.html title=é‹çˆæŠ€è¡“å•ç­”å·¡æª¢å¿…çœ‹>é‹çˆæŠ€è¡“å•ç­”å·¡æª¢å¿…çœ‹</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>