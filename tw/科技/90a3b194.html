<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Springï¼šAOP é¢å‘åˆ‡é¢ç·¨ç¨‹ | æå®¢å¿«è¨Š</title><meta property="og:title" content="Springï¼šAOP é¢å‘åˆ‡é¢ç·¨ç¨‹ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/2e916acf35c540c59694eae279114599"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90a3b194.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90a3b194.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/90a3b194.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90a3b194.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90a3b194.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/90a3b194.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/90a3b194.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/90a3b194.html><meta property="article:published_time" content="2020-11-14T21:04:29+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:29+08:00"><meta name=Keywords content><meta name=description content="Springï¼šAOP é¢å‘åˆ‡é¢ç·¨ç¨‹"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/90a3b194.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Springï¼šAOP é¢å‘åˆ‡é¢ç·¨ç¨‹</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div class=pgc-img><img alt="Springï¼šAOP é¢å‘åˆ‡é¢ç·¨ç¨‹" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2e916acf35c540c59694eae279114599><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>è½‰è³¬æ¡ˆä¾‹</h1><p>éœ€æ±‚ï¼šä½¿ç”¨ spring æ¡†æ¶æ•´åˆ DBUtils æŠ€è¡“ï¼Œå¯¦ç¾ç”¨æˆ¶è½‰è³¬åŠŸèƒ½</p><h1 class=pgc-h-arrow-right><strong>åŸºç¤åŠŸèƒ½</strong></h1><p>æ­¥é©Ÿåˆ†æï¼š</p><ol start=1><li>å‰µå»º java é …ç›®ï¼Œå°å…¥åº§æ¨™</li><li>ç·¨å¯« Account å¯¦é«”é¡</li><li>ç·¨å¯« AccountDao æ¥å£å’Œå¯¦ç¾é¡</li><li>ç·¨å¯« AccountService æ¥å£å’Œå¯¦ç¾é¡</li><li>ç·¨å¯« spring æ ¸å¿ƒé…ç½®æ–‡ä»¶</li><li>ç·¨å¯«æ¸¬è©¦ä»£ç¢¼</li></ol><h1 class=pgc-h-arrow-right><strong>å‰µå»º java é …ç›®ï¼Œå°å…¥åº§æ¨™</strong></h1><pre><code>&lt;dependencies&gt;    &lt;dependency&gt;        &lt;groupId&gt;mysql&lt;/groupId&gt;        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;        &lt;version&gt;5.1.47&lt;/version&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;        &lt;artifactId&gt;druid&lt;/artifactId&gt;        &lt;version&gt;1.1.15&lt;/version&gt;    &lt;/dependency&gt;â€‹    &lt;dependency&gt;        &lt;groupId&gt;commons-dbutils&lt;/groupId&gt;        &lt;artifactId&gt;commons-dbutils&lt;/artifactId&gt;        &lt;version&gt;1.6&lt;/version&gt;    &lt;/dependency&gt;â€‹    &lt;dependency&gt;        &lt;groupId&gt;org.springframework&lt;/groupId&gt;        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;        &lt;version&gt;5.1.5.RELEASE&lt;/version&gt;    &lt;/dependency&gt;â€‹    &lt;dependency&gt;        &lt;groupId&gt;org.springframework&lt;/groupId&gt;        &lt;artifactId&gt;spring-test&lt;/artifactId&gt;        &lt;version&gt;5.1.5.RELEASE&lt;/version&gt;    &lt;/dependency&gt;â€‹    &lt;dependency&gt;        &lt;groupId&gt;junit&lt;/groupId&gt;        &lt;artifactId&gt;junit&lt;/artifactId&gt;        &lt;version&gt;4.12&lt;/version&gt;    &lt;/dependency&gt;â€‹    &lt;dependency&gt;        &lt;groupId&gt;org.aspectj&lt;/groupId&gt;        &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;        &lt;version&gt;1.8.13&lt;/version&gt;    &lt;/dependency&gt;&lt;/dependencies&gt;</code></pre><h1 class=pgc-h-arrow-right><strong>ç·¨å¯« AccountDao æ¥å£å’Œå¯¦ç¾é¡</strong></h1><pre><code>public interface AccountDao {    /**     * è½‰å‡ºæ“ä½œ     * @param outUser     * @param money     */    void out(String outUser,Double money);â€‹    /**     * è½‰å…¥æ“ä½œ     * @param inUser     * @param money     */    void in(String inUser,Double money);}@Repository("AccountDao")public class AccountDaoImpl implements AccountDao {    @Autowired    private QueryRunner queryRunner;â€‹    @Override    public void out(String outUser, Double money) {        String sql = "update account set money = money - ? where name = ?";        try {            queryRunner.update(sql, money, outUser);        } catch (SQLException throwables) {            throwables.printStackTrace();        }    }â€‹    @Override    public void in(String inUser, Double money) {        String sql = "update account set money = money + ? where name = ?";        try {            queryRunner.update(sql, money, inUser);        } catch (SQLException throwables) {            throwables.printStackTrace();        }    }}</code></pre><h1 class=pgc-h-arrow-right><strong>ç·¨å¯« AccountService æ¥å£å’Œå¯¦ç¾é¡</strong></h1><pre><code>public interface AccountService {        /**         * è½‰è³¬æ–¹æ³•         */        void transfer(String outUser,String inUser,Double money);}@Service("accountService")public class AccountServiceImpl implements AccountService {    @Autowired    private AccountDao accountDao;    /**     * è½‰è³¬æ–¹æ³•     */    @Override    public void transfer(String outUser, String inUser, Double money) {        // ç·¨å¯«äº†äº‹å‹™ç›¸é—œä»£ç¢¼        // èª¿ç”¨äº†æ¸›éŒ¢æ–¹æ³•        accountDao.out(outUser,money);        // æ¨¡æ“¬å‡ºéŒ¯        // int i= 1/0;        // èª¿ç”¨äº†åŠ éŒ¢æ–¹æ³•        accountDao.in(inUser,money);    }}</code></pre><h1 class=pgc-h-arrow-right><strong>ç·¨å¯« spring æ ¸å¿ƒé…ç½®æ–‡ä»¶</strong></h1><pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans"       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"       xmlns:context="http://www.springframework.org/schema/context"       xmlns:aop="http://www.springframework.org/schema/aop"       xsi:schemaLocation="       	http://www.springframework.org/schema/beans		http://www.springframework.org/schema/beans/spring-beans.xsd       	http://www.springframework.org/schema/context		http://www.springframework.org/schema/context/spring-context.xsd		http://www.springframework.org/schema/aop		http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;    &lt;!-- é–‹å•Ÿè¨»è§£æƒæ --&gt;    &lt;context:component-scan base-package="com.renda"/&gt;    &lt;!-- å¼•å…¥ properties --&gt;    &lt;context:property-placeholder location="classpath:jdbc.properties"/&gt;    &lt;!-- é…ç½® DataSource --&gt;    &lt;bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource"&gt;        &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;        &lt;property name="url" value="${jdbc.url}"/&gt;        &lt;property name="username" value="${jdbc.username}"/&gt;        &lt;property name="password" value="${jdbc.password}"/&gt;    &lt;/bean&gt;    &lt;!-- é…ç½® queryRunner --&gt;    &lt;bean id="queryRunner" class="org.apache.commons.dbutils.QueryRunner"&gt;        &lt;constructor-arg name="ds" ref="dataSource"/&gt;    &lt;/bean&gt;&lt;/beans&gt;</code></pre><h1 class=pgc-h-arrow-right><strong>ç·¨å¯«æ¸¬è©¦ä»£ç¢¼</strong></h1><pre><code>@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration({"classpath:applicationContext.xml"})public class AccountServiceTest {    @Autowired    private AccountService accountService;    @Test    public void testTransfer() {        accountService.transfer("tom", "jerry", 100d);    }}</code></pre><h1 class=pgc-h-arrow-right><strong>å•é¡Œåˆ†æ</strong></h1><p>ä¸Šé¢çš„ä»£ç¢¼äº‹å‹™åœ¨ Dao å±¤ï¼Œè½‰å‡ºè½‰å…¥æ“ä½œéƒ½æ˜¯ä¸€å€‹ç¨ç«‹çš„äº‹å‹™ï¼Œä½†å¯¦éš›é–‹ç™¼ï¼Œæ‡‰è©²æŠŠæ¥­å‹™é‚è¼¯æ§åˆ¶åœ¨ä¸€å€‹äº‹å‹™ä¸­ï¼Œæ‰€ä»¥æ‡‰è©²å°‡äº‹å‹™æŒªåˆ° Service å±¤ã€‚</p><h1 class=pgc-h-arrow-right><strong>å‚³çµ±äº‹å‹™</strong></h1><p>æ­¥é©Ÿåˆ†æï¼š</p><ol start=1><li>ç·¨å¯«ç·šç¨‹ç¶å®šå·¥å…·é¡</li><li>ç·¨å¯«äº‹å‹™ç®¡ç†å™¨</li><li>ä¿®æ”¹ service å±¤ä»£ç¢¼</li><li>ä¿®æ”¹ dao å±¤ä»£ç¢¼</li></ol><h1 class=pgc-h-arrow-right><strong>ç·¨å¯«ç·šç¨‹ç¶å®šå·¥å…·é¡</strong></h1><pre><code>@Componentpublic class ConnectionUtils {    @Autowired    private DataSource dataSource;â€‹    private ThreadLocal&lt;Connection&gt; threadLocal = new ThreadLocal&lt;&gt;();â€‹    /**     * ç²å–ç•¶å‰ç·šç¨‹ä¸Šç¶å®šé€£æ¥ï¼šå¦‚æœç²å–åˆ°çš„é€£æ¥ç‚ºç©ºï¼Œé‚£éº¼å°±è¦å¾æ•¸æ“šæºä¸­ç²å–é€£æ¥ï¼Œä¸¦ä¸”æ”¾åˆ° ThreadLocal ä¸­ï¼ˆç¶å®šåˆ°ç•¶å‰ç·šç¨‹ï¼‰     */    public Connection getThreadConnection() {        // 1.å…ˆå¾ ThreadLocal ä¸Šç²å–é€£æ¥        Connection connection = threadLocal.get();        // 2.åˆ¤æ–·ç•¶å‰ç·šç¨‹ä¸­æ˜¯å¦æ˜¯æœ‰ Connection        if(connection == null){            // 3.å¾æ•¸æ“šæºä¸­ç²å–ä¸€å€‹é€£æ¥ï¼Œä¸¦ä¸”å­˜å…¥ ThreadLocal ä¸­            try {                // ä¸ç‚º null                connection = dataSource.getConnection();                threadLocal.set(connection);            } catch (SQLException e) {                e.printStackTrace();            }        }        return  connection;    }â€‹    /**     * è§£é™¤ç•¶å‰ç·šç¨‹çš„é€£æ¥ç¶å®š     */    public void  removeThreadConnection(){        threadLocal.remove();    }}</code></pre><h1 class=pgc-h-arrow-right><strong>ç·¨å¯«äº‹å‹™ç®¡ç†å™¨</strong></h1><pre><code>@Component("transactionManager")public class TransactionManager {    @Autowired    private ConnectionUtils connectionUtils;â€‹    /**     * é–‹å•Ÿäº‹å‹™     */    public void beginTransaction(){        // ç²å– connection å°è±¡        Connection connection = connectionUtils.getThreadConnection();        try {            // é–‹å•Ÿäº†ä¸€å€‹æ‰‹å‹•äº‹å‹™            connection.setAutoCommit(false);        } catch (SQLException e) {            e.printStackTrace();        }    }â€‹    /**     * æäº¤äº‹å‹™     */    public void commit(){        Connection connection = connectionUtils.getThreadConnection();        try {            connection.commit();        } catch (SQLException e) {            e.printStackTrace();        }    }â€‹    /**     * å›æ»¾äº‹å‹™     */    public void rollback(){        Connection connection = connectionUtils.getThreadConnection();        try {            connection.rollback();        } catch (SQLException e) {            e.printStackTrace();        }    }â€‹    /**     * é‡‹æ”¾è³‡æº     */    public void release(){        // å°‡æ‰‹å‹•äº‹å‹™æ”¹å›æˆè‡ªå‹•æäº¤äº‹å‹™        Connection connection = connectionUtils.getThreadConnection();        try {            connection.setAutoCommit(true);            // å°‡é€£æ¥æ­¸é‚„åˆ°é€£æ¥æ±             connectionUtils.getThreadConnection().close();            // è§£é™¤ç·šç¨‹ç¶å®š            connectionUtils.removeThreadConnection();        } catch (SQLException e) {            e.printStackTrace();        }    }}</code></pre><h1 class=pgc-h-arrow-right><strong>ä¿®æ”¹ service å±¤ä»£ç¢¼</strong></h1><pre><code>@Service("accountService")public class AccountServiceImpl implements AccountService {    @Autowired    private AccountDao accountDao;    @Autowired    private TransactionManager transactionManager;    @Override    public void transfer(String outUser, String inUser, Double money) {        try {            // 1.é–‹å•Ÿäº‹å‹™            transactionManager.beginTransaction();            // 2.æ¥­å‹™æ“ä½œ            // ç·¨å¯«äº†äº‹å‹™ç›¸é—œä»£ç¢¼            // èª¿ç”¨äº†æ¸›éŒ¢æ–¹æ³•            accountDao.out(outUser, money);            // æ¨¡æ“¬å‡ºéŒ¯            // int i= 1/0;            // èª¿ç”¨äº†åŠ éŒ¢æ–¹æ³•            accountDao.in(inUser, money);            // 3.æäº¤äº‹å‹™            transactionManager.commit();        } catch (Exception e) {            // 4.å›æ»¾äº‹å‹™            transactionManager.rollback();            e.printStackTrace();        } finally {            // 5.é‡‹æ”¾è³‡æº            transactionManager.release();        }    }}</code></pre><h1 class=pgc-h-arrow-right><strong>ä¿®æ”¹ Dao å±¤ä»£ç¢¼</strong></h1><pre><code>@Repository("AccountDao")public class AccountDaoImpl implements AccountDao {    @Autowired    private QueryRunner queryRunner;    @Autowired    private ConnectionUtils connectionUtils;    /**     * è½‰å‡ºæ“ä½œ     */    @Override    public void out(String outUser, Double money) {        String sql = "update account set money = money - ? where name = ?";        try {            queryRunner.update(connectionUtils.getThreadConnection(), sql, money, outUser);        } catch (SQLException throwables) {            throwables.printStackTrace();        }    }    /**     * è½‰å…¥æ“ä½œ     */    @Override    public void in(String inUser, Double money) {        String sql = "update account set money = money + ? where name = ?";        try {            queryRunner.update(connectionUtils.getThreadConnection(), sql, money, inUser);        } catch (SQLException throwables) {            throwables.printStackTrace();        }    }}</code></pre><h1 class=pgc-h-arrow-right><strong>å•é¡Œåˆ†æ</strong></h1><p>ä¸Šé¢ä»£ç¢¼ï¼Œé€šéå°æ¥­å‹™å±¤æ”¹é€ ï¼Œå·²ç¶“å¯ä»¥å¯¦ç¾äº‹å‹™æ§åˆ¶äº†ï¼Œä½†æ˜¯ç”±æ–¼æ·»åŠ äº†äº‹å‹™æ§åˆ¶ï¼Œä¹Ÿç”¢ç”Ÿäº†ä¸€å€‹æ–°çš„å•é¡Œï¼š æ¥­å‹™å±¤æ–¹æ³•è®Šå¾—è‡ƒè…«äº†ï¼Œè£¡é¢å……æ–¥è‘—å¾ˆå¤šé‡è¤‡ä»£ç¢¼ã€‚ä¸¦ä¸”æ¥­å‹™å±¤æ–¹æ³•å’Œäº‹å‹™æ§åˆ¶æ–¹æ³•è€¦åˆäº†ï¼Œé•èƒŒäº†é¢å‘å°è±¡çš„é–‹ç™¼æ€æƒ³ã€‚</p><p><br></p><h1 class=pgc-h-arrow-right><strong>Proxy å„ªåŒ–è½‰è³¬æ¡ˆä¾‹</strong></h1><p>å¯ä»¥å°‡æ¥­å‹™ä»£ç¢¼å’Œäº‹å‹™ä»£ç¢¼é€²è¡Œæ‹†åˆ†ï¼Œé€šéå‹•æ…‹ä»£ç†çš„æ–¹å¼ï¼Œå°æ¥­å‹™æ–¹æ³•é€²è¡Œäº‹å‹™çš„å¢å¼·ã€‚é€™æ¨£å°±ä¸æœƒå°æ¥­å‹™å±¤ç”¢ç”Ÿå½±éŸ¿ï¼Œè§£æ±ºäº†è€¦åˆæ€§çš„å•é¡Œã€‚</p><p>å¸¸ç”¨çš„å‹•æ…‹ä»£ç†æŠ€è¡“ï¼š</p><ul><li>JDK ä»£ç†ï¼ŒåŸºæ–¼æ¥å£çš„å‹•æ…‹ä»£ç†æŠ€è¡“ - åˆ©ç”¨æ””æˆªå™¨ï¼ˆå¿…é ˆå¯¦ç¾ invocationHandlerï¼‰åŠ ä¸Šåå°„æ©Ÿåˆ¶ç”Ÿæˆä¸€å€‹ä»£ç†æ¥å£çš„åŒ¿åé¡ï¼Œåœ¨èª¿ç”¨å…·é«”æ–¹æ³•å‰èª¿ç”¨ InvokeHandler ä¾†è™•ç†ï¼Œå¾è€Œå¯¦ç¾æ–¹æ³•å¢å¼·</li><li>CGLIB ä»£ç†ï¼ŒåŸºæ–¼çˆ¶é¡çš„å‹•æ…‹ä»£ç†æŠ€è¡“ - å‹•æ…‹ç”Ÿæˆä¸€å€‹è¦ä»£ç†çš„å­é¡ï¼Œå­é¡é‡å¯«è¦ä»£ç†çš„é¡çš„æ‰€æœ‰ä¸æ˜¯ final çš„æ–¹æ³•ï¼›åœ¨å­é¡ä¸­æ¡ç”¨æ–¹æ³•æ””æˆªæŠ€è¡“æ””æˆªæ‰€æœ‰çš„çˆ¶é¡æ–¹æ³•çš„èª¿ç”¨ï¼Œé †å‹¢ç¹”å…¥æ©«åˆ‡é‚è¼¯ï¼Œå°æ–¹æ³•é€²è¡Œå¢å¼·</li></ul><h1 class=pgc-h-arrow-right><strong>JDK å‹•æ…‹ä»£ç†æ–¹å¼</strong></h1><p>å»æ‰ AccountServiceImpl çš„äº‹å‹™æ§åˆ¶ä»£ç¢¼</p><pre><code>@Service("accountService")public class AccountServiceImpl implements AccountService {    @Autowired    private AccountDao accountDao;    @Override    public void transfer(String outUser, String inUser, Double money) {        accountDao.out(outUser, money);        // æ¨¡æ“¬å‡ºéŒ¯        int i= 1/0;        accountDao.in(inUser, money);    }}</code></pre><p>JDK å·¥å» é¡</p><pre><code>@Componentpublic class JDKProxyFactory {    @Autowired    private AccountService accountService;    @Autowired    private TransactionManager transactionManager;    /**     * æ¡ç”¨ JDK å‹•æ…‹ä»£ç†æŠ€è¡“ä¾†ç”Ÿæˆç›®æ¨™é¡çš„ä»£ç†å°è±¡     * ClassLoader loader : é¡åŠ è¼‰å™¨ï¼šè—‰åŠ©è¢«ä»£ç†å°è±¡ç²å–åˆ°é¡åŠ è¼‰å™¨     * Class&lt;?&gt;[] interfaces ï¼š è¢«ä»£ç†é¡æ‰€éœ€è¦å¯¦ç¾çš„å…¨éƒ¨æ¥å£     * InvocationHandler h ï¼š ç•¶ä»£ç†å°è±¡èª¿ç”¨æ¥å£ä¸­çš„ä»»æ„æ–¹æ³•æ™‚ï¼Œé‚£éº¼éƒ½æœƒåŸ·è¡Œ InvocationHandler ä¸­ invoke æ–¹æ³•     */    public AccountService createAccountServiceJdkProxy() {        return (AccountService) Proxy.newProxyInstance(                accountService.getClass().getClassLoader(),                accountService.getClass().getInterfaces(),                new InvocationHandler() {                    /**                     * @param proxy ç•¶å‰çš„ä»£ç†å°è±¡å¼•ç”¨                     * @param method è¢«èª¿ç”¨çš„ç›®æ¨™æ–¹æ³•çš„å¼•ç”¨                     * @param args è¢«èª¿ç”¨çš„ç›®æ¨™æ–¹æ³•æ‰€ç”¨åˆ°çš„åƒæ•¸                     */                    @Override                    public Object invoke(Object proxy, Method method, Object[] args) {                        try {                            if ("transfer".equalsIgnoreCase(method.getName())) {                                System.out.println("JDK Proxy: Pre-Enhance ...");                                transactionManager.beginTransaction();                                method.invoke(accountService, args);                                System.out.println("JDK Proxy: Post-Enhance ...");                                transactionManager.commit();                            } else {                                method.invoke(accountService, args);                            }                        } catch (Exception e) {                            transactionManager.rollback();                            e.printStackTrace();                        } finally {                            transactionManager.release();                        }                        return null;                    }                });    }}</code></pre><p>æ¸¬è©¦ä»£ç¢¼</p><pre><code>@Autowiredprivate JDKProxyFactory jdkProxyFactory;@Testpublic void testTransferProxyJDK(){    // ç•¶å‰è¿”å›çš„å¯¦éš›ä¸Šæ˜¯ AccountService çš„ä»£ç†å°è±¡ proxy    AccountService accountServiceJDKProxy = jdkProxyFactory.createAccountServiceJDKProxy();    // ä»£ç†å°è±¡ proxy èª¿ç”¨æ¥å£ä¸­çš„ä»»æ„æ–¹æ³•æ™‚ï¼Œéƒ½æœƒåŸ·è¡Œåº•å±¤çš„ invoke æ–¹æ³•    accountServiceJDKProxy.transfer("tom", "jerry", 100d);}</code></pre><h1 class=pgc-h-arrow-right><strong>CGLIB å‹•æ…‹ä»£ç†æ–¹å¼</strong></h1><p>CGLIB å·¥å» é¡</p><pre><code>@Componentpublic class CglibProxyFactory {    @Autowired    private AccountService accountService;    @Autowired    private TransactionManager transactionManager;    /**     * ç·¨å¯« cglib å°æ‡‰çš„ API ä¾†ç”Ÿæˆä»£ç†å°è±¡é€²è¡Œè¿”å›     * åƒæ•¸ 1 ï¼š ç›®æ¨™é¡çš„å­—ç¯€ç¢¼å°è±¡     * åƒæ•¸ 2ï¼š  å‹•ä½œé¡ï¼Œç•¶ä»£ç†å°è±¡èª¿ç”¨ç›®æ¨™å°è±¡ä¸­åŸæ–¹æ³•æ™‚ï¼Œé‚£éº¼æœƒåŸ·è¡Œ intercept æ–¹æ³•     */    public AccountService createAccountServiceCglibProxy() {        return (AccountService) Enhancer.create(accountService.getClass(), new MethodInterceptor() {            /**             * @param o ä»£è¡¨ç”Ÿæˆçš„ä»£ç†å°è±¡             * @param method èª¿ç”¨ç›®æ¨™æ–¹æ³•çš„å¼•ç”¨             * @param objects æ–¹æ³•å…¥åƒ             * @param methodProxy ä»£ç†æ–¹æ³•             */            @Override            public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) {                try {                    System.out.println("CGLIB Proxy: Pre-Enhance ...");                    // æ‰‹å‹•é–‹å•Ÿäº‹å‹™ï¼šèª¿ç”¨äº‹å‹™ç®¡ç†å™¨é¡ä¸­çš„é–‹å•Ÿäº‹å‹™æ–¹æ³•                    transactionManager.beginTransaction();                    method.invoke(accountService, objects);                    System.out.println("CGLIB Proxy: Post-Enhance ...");                    transactionManager.commit();                } catch (Exception e) {                    // æ‰‹å‹•å›æ»¾äº‹å‹™                    transactionManager.rollback();                    e.printStackTrace();                } finally {                    // æ‰‹å‹•é‡‹æ”¾è³‡æº                    transactionManager.release();                }                return null;            }        });    }}</code></pre><p>æ¸¬è©¦ä»£ç¢¼</p><pre><code>@Autowiredprivate CglibProxyFactory cglibProxyFactory;@Testpublic void testTransferProxyCglib(){    AccountService accountServiceCglibProxy = cglibProxyFactory.createAccountServiceCglibProxy();    accountServiceCglibProxy.transfer("tom","jerry",100d);}</code></pre><h1 class=pgc-h-arrow-right><br></h1><h1 class=pgc-h-arrow-right><strong>åˆè­˜ AOP</strong></h1><h1 class=pgc-h-arrow-right><strong>ä»€éº¼æ˜¯ AOP</strong></h1><p>AOP ç‚º Aspect Oriented Programming çš„ç¸®å¯«ï¼Œæ„æ€ç‚ºé¢å‘åˆ‡é¢ç·¨ç¨‹ã€‚</p><p>AOP æ˜¯ OOPï¼ˆé¢å‘å°è±¡ç·¨ç¨‹ï¼‰ çš„å»¶çºŒï¼Œæ˜¯è»Ÿä»¶é–‹ç™¼ä¸­çš„ä¸€å€‹ç†±é»ï¼Œä¹Ÿæ˜¯ Spring æ¡†æ¶ä¸­çš„ä¸€å€‹é‡è¦å…§å®¹ï¼Œåˆ©ç”¨ AOP å¯ä»¥å°æ¥­å‹™é‚è¼¯çš„å„å€‹éƒ¨åˆ†é€²è¡Œéš”é›¢ï¼Œå¾è€Œä½¿å¾—æ¥­å‹™é‚è¼¯å„éƒ¨åˆ†ä¹‹é–“çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹åºçš„å¯é‡ç”¨æ€§ï¼ŒåŒæ™‚æé«˜äº†é–‹ç™¼çš„æ•ˆç‡ã€‚</p><p>å„ªå‹¢ï¼š</p><ol start=1><li>åœ¨ç¨‹åºé‹è¡ŒæœŸé–“ï¼Œåœ¨ä¸ä¿®æ”¹æºç¢¼çš„æƒ…æ³ä¸‹å°æ–¹æ³•é€²è¡ŒåŠŸèƒ½å¢å¼·</li><li>é‚è¼¯æ¸…æ™°ï¼Œé–‹ç™¼æ ¸å¿ƒæ¥­å‹™çš„æ™‚å€™ï¼Œä¸å¿…é—œæ³¨å¢å¼·æ¥­å‹™çš„ä»£ç¢¼</li><li>æ¸›å°‘é‡è¤‡ä»£ç¢¼ï¼Œæé«˜é–‹ç™¼æ•ˆç‡ï¼Œä¾¿æ–¼å¾ŒæœŸç¶­è­·</li></ol><h1 class=pgc-h-arrow-right><strong>AOP åº•å±¤å¯¦ç¾</strong></h1><p>å¯¦éš›ä¸Šï¼ŒAOP çš„åº•å±¤æ˜¯é€šé Spring æä¾›çš„çš„å‹•æ…‹ä»£ç†æŠ€è¡“å¯¦ç¾çš„ã€‚åœ¨é‹è¡ŒæœŸé–“ï¼ŒSpring é€šéå‹•æ…‹ä»£ç†æŠ€è¡“å‹•æ…‹çš„ç”Ÿæˆä»£ç†å°è±¡ï¼Œä»£ç†å°è±¡æ–¹æ³•åŸ·è¡Œæ™‚é€²è¡Œå¢å¼·åŠŸèƒ½çš„ä»‹å…¥ï¼Œåœ¨å»èª¿ç”¨ç›®æ¨™å°è±¡çš„æ–¹æ³•ï¼Œå¾è€Œå®ŒæˆåŠŸèƒ½çš„å¢å¼·ã€‚</p><h1 class=pgc-h-arrow-right><strong>AOP ç›¸é—œè¡“èª</strong></h1><p>Spring çš„ AOP å¯¦ç¾åº•å±¤å°±æ˜¯å°ä¸Šé¢çš„å‹•æ…‹ä»£ç†çš„ä»£ç¢¼é€²è¡Œäº†å°è£ï¼Œå°è£å¾Œæˆ‘å€‘åªéœ€è¦å°éœ€è¦é—œæ³¨çš„éƒ¨åˆ†é€²è¡Œä»£ç¢¼ç·¨å¯«ï¼Œä¸¦é€šéé…ç½®çš„æ–¹å¼å®ŒæˆæŒ‡å®šç›®æ¨™çš„æ–¹æ³•å¢å¼·ã€‚</p><p>åœ¨æ­£å¼è¬›è§£ AOP çš„æ“ä½œä¹‹å‰ï¼Œæˆ‘å€‘å¿…é ˆç†è§£ AOP çš„ç›¸é—œè¡“èªï¼Œå¸¸ç”¨çš„è¡“èªå¦‚ä¸‹ï¼š</p><pre><code>* Targetï¼ˆç›®æ¨™å°è±¡ï¼‰ï¼šä»£ç†çš„ç›®æ¨™å°è±¡ï¼›è¢«ä»£ç†é¡* Proxyï¼ˆä»£ç†ï¼‰ï¼šä¸€å€‹é¡è¢« AOP ç¹”å…¥å¢å¼·å¾Œï¼Œå°±ç”¢ç”Ÿä¸€å€‹çµæœä»£ç†é¡ï¼›ç”Ÿæˆä»£ç†å°è±¡* Joinpointï¼ˆé€£æ¥é»ï¼‰ï¼šæ‰€è¬‚é€£æ¥é»æ˜¯æŒ‡é‚£äº›å¯ä»¥è¢«æ””æˆªåˆ°çš„é»ï¼›åœ¨ spring ä¸­ï¼Œé€™äº›é»æŒ‡çš„æ˜¯æ–¹æ³•ï¼Œå› ç‚º spring åªæ”¯æŒæ–¹æ³•é¡å‹çš„é€£æ¥é»ï¼›å¯ä»¥è¢«æ””æˆªå¢å¼·çš„æ–¹æ³•* Pointcutï¼ˆåˆ‡å…¥é»ï¼‰ï¼šæ‰€è¬‚åˆ‡å…¥é»æ˜¯æŒ‡æˆ‘å€‘è¦å°å“ªäº› Joinpoint é€²è¡Œæ””æˆªçš„å®šç¾©ï¼›å³çœŸæ­£è¢«æ””æˆªå¢å¼·çš„æ–¹æ³•* Adviceï¼ˆé€šçŸ¥/ å¢å¼·ï¼‰ï¼šæ‰€è¬‚é€šçŸ¥æ˜¯æŒ‡æ””æˆªåˆ° Joinpoint ä¹‹å¾Œæ‰€è¦åšçš„äº‹æƒ…å°±æ˜¯é€šçŸ¥åˆ†é¡ï¼šå‰ç½®é€šçŸ¥ã€å¾Œç½®é€šçŸ¥ã€ç•°å¸¸é€šçŸ¥ã€æœ€çµ‚é€šçŸ¥ã€ç’°ç¹é€šçŸ¥ - ä¸€ç¨®å¯ä»¥é€šéä»£ç¢¼çš„æ–¹å¼ä¾†æ‰‹å‹•æ§åˆ¶çš„é¡å‹ï¼›å³å¢å¼·çš„æ¥­å‹™é‚è¼¯* Aspectï¼ˆåˆ‡é¢ï¼‰ï¼šæ˜¯åˆ‡å…¥é»å’Œé€šçŸ¥ï¼ˆå¼•ä»‹ï¼‰çš„çµåˆ* Weavingï¼ˆç¹”å…¥ï¼‰ï¼šæ˜¯æŒ‡æŠŠå¢å¼·æ‡‰ç”¨åˆ°ç›®æ¨™å°è±¡ä¾†å‰µå»ºæ–°çš„ä»£ç†å°è±¡çš„éç¨‹ã€‚Spring æ¡ç”¨å‹•æ…‹ä»£ç†ç¹”å…¥ï¼Œè€Œ AspectJ æ¡ç”¨ç·¨è­¯æœŸç¹”å…¥å’Œé¡è£è¼‰æœŸç¹”å…¥</code></pre><h1 class=pgc-h-arrow-right><strong>AOP é–‹ç™¼æ˜ç¢ºäº‹é …</strong></h1><h1 class=pgc-h-arrow-right><strong>é–‹ç™¼éšæ®µ</strong></h1><ol start=1><li>ç·¨å¯«æ ¸å¿ƒæ¥­å‹™ä»£ç¢¼ï¼ˆç›®æ¨™é¡çš„ç›®æ¨™æ–¹æ³•ï¼‰ åˆ‡å…¥é»</li><li>æŠŠå…¬ç”¨ä»£ç¢¼æŠ½å–å‡ºä¾†ï¼Œè£½ä½œæˆé€šçŸ¥ï¼ˆå¢å¼·åŠŸèƒ½æ–¹æ³•ï¼‰ é€šçŸ¥</li><li>åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè²æ˜åˆ‡å…¥é»èˆ‡é€šçŸ¥é–“çš„é—œä¿‚ï¼Œå³åˆ‡é¢</li></ol><h1 class=pgc-h-arrow-right><strong>é‹è¡Œéšæ®µï¼ˆSpring æ¡†æ¶è‡ªå‹•å®Œæˆï¼‰</strong></h1><p>Spring æ¡†æ¶ç›£æ§åˆ‡å…¥é»æ–¹æ³•çš„åŸ·è¡Œã€‚ä¸€æ—¦ç›£æ§åˆ°åˆ‡å…¥é»æ–¹æ³•è¢«é‹è¡Œï¼Œä½¿ç”¨ä»£ç†æ©Ÿåˆ¶ï¼Œå‹•æ…‹å‰µå»ºç›®æ¨™å°è±¡çš„ä»£ç†å°è±¡ï¼Œæ ¹æ“šé€šçŸ¥é¡åˆ¥ï¼Œåœ¨ä»£ç†å°è±¡çš„å°æ‡‰ä½ç½®ï¼Œå°‡é€šçŸ¥å°æ‡‰çš„åŠŸèƒ½ç¹”å…¥ï¼Œå®Œæˆå®Œæ•´çš„ä»£ç¢¼é‚è¼¯é‹è¡Œã€‚</p><h1 class=pgc-h-arrow-right><strong>åº•å±¤ä»£ç†å¯¦ç¾</strong></h1><p>åœ¨ Spring ä¸­ï¼Œæ¡†æ¶æœƒæ ¹æ“šç›®æ¨™é¡æ˜¯å¦å¯¦ç¾äº†æ¥å£ä¾†æ±ºå®šæ¡ç”¨å“ªç¨®å‹•æ…‹ä»£ç†çš„æ–¹å¼ï¼š</p><ul><li>ç•¶ bean å¯¦ç¾æ¥å£æ™‚ï¼Œæœƒç”¨ JDK ä»£ç†æ¨¡å¼</li><li>ç•¶ bean æ²’æœ‰å¯¦ç¾æ¥å£ï¼Œç”¨ cglib å¯¦ç¾ï¼ˆ å¯ä»¥å¼·åˆ¶ä½¿ç”¨ cglibï¼ˆåœ¨ spring é…ç½®ä¸­åŠ å…¥ &lt;aop:aspectj-autoproxy proxy-target-class=â€trueâ€/>ï¼‰</li></ul><h1 class=pgc-h-arrow-right><strong>å°çµ</strong></h1><pre><code>* aop - é¢å‘åˆ‡é¢ç·¨ç¨‹* aop åº•å±¤å¯¦ç¾ï¼šåŸºæ–¼ JDK çš„å‹•æ…‹ä»£ç†å’ŒåŸºæ–¼ Cglib çš„å‹•æ…‹ä»£ç†* aop çš„é‡é»æ¦‚å¿µï¼š    Pointcutï¼ˆåˆ‡å…¥é»ï¼‰ï¼šçœŸæ­£è¢«å¢å¼·çš„æ–¹æ³•    Adviceï¼ˆé€šçŸ¥/ å¢å¼·ï¼‰ï¼šå°è£å¢å¼·æ¥­å‹™é‚è¼¯çš„æ–¹æ³•    Aspectï¼ˆåˆ‡é¢ï¼‰ï¼šåˆ‡é» + é€šçŸ¥    Weavingï¼ˆç¹”å…¥ï¼‰ï¼šå°‡åˆ‡é»èˆ‡é€šçŸ¥çµåˆï¼Œç”¢ç”Ÿä»£ç†å°è±¡çš„éç¨‹</code></pre><p><br></p><h1 class=pgc-h-arrow-right><strong>åŸºæ–¼ XML çš„ AOP é–‹ç™¼</strong></h1><h1 class=pgc-h-arrow-right><strong>å¿«é€Ÿå…¥é–€</strong></h1><p>å¿«é€Ÿå…¥é–€ï¼š</p><ol start=1><li>å‰µå»º java é …ç›®ï¼Œå°å…¥ AOP ç›¸é—œåº§æ¨™</li><li>å‰µå»ºç›®æ¨™æ¥å£å’Œç›®æ¨™å¯¦ç¾é¡ï¼ˆå®šç¾©åˆ‡å…¥é»ï¼‰</li><li>å‰µå»ºé€šçŸ¥é¡åŠæ–¹æ³•ï¼ˆå®šç¾©é€šçŸ¥ï¼‰</li><li>å°‡ç›®æ¨™é¡å’Œé€šçŸ¥é¡å°è±¡å‰µå»ºæ¬Šäº¤çµ¦ spring</li><li>åœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­é…ç½®ç¹”å…¥é—œä¿‚ï¼ŒåŠåˆ‡é¢</li><li>ç·¨å¯«æ¸¬è©¦ä»£ç¢¼</li></ol><h1 class=pgc-h-arrow-right><strong>å‰µå»º java é …ç›®ï¼Œå°å…¥ AOP ç›¸é—œåº§æ¨™</strong></h1><pre><code>&lt;properties&gt;    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;    &lt;maven.compiler.encoding&gt;UTF-8&lt;/maven.compiler.encoding&gt;    &lt;java.version&gt;1.11&lt;/java.version&gt;    &lt;maven.compiler.source&gt;1.11&lt;/maven.compiler.source&gt;    &lt;maven.compiler.target&gt;1.11&lt;/maven.compiler.target&gt;&lt;/properties&gt;&lt;dependencies&gt;    &lt;!-- å°å…¥ spring çš„ context åº§æ¨™ï¼Œcontext ä¾è³´ aop --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.springframework&lt;/groupId&gt;        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;        &lt;version&gt;5.1.5.RELEASE&lt;/version&gt;    &lt;/dependency&gt;    &lt;!-- aspectj çš„ç¹”å…¥ï¼ˆåˆ‡é»è¡¨é”å¼éœ€è¦ç”¨åˆ°è©² jar åŒ…ï¼‰ --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.aspectj&lt;/groupId&gt;        &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;        &lt;version&gt;1.8.13&lt;/version&gt;    &lt;/dependency&gt;    &lt;!-- spring æ•´åˆ junit --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.springframework&lt;/groupId&gt;        &lt;artifactId&gt;spring-test&lt;/artifactId&gt;        &lt;version&gt;5.1.5.RELEASE&lt;/version&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;junit&lt;/groupId&gt;        &lt;artifactId&gt;junit&lt;/artifactId&gt;        &lt;version&gt;4.12&lt;/version&gt;    &lt;/dependency&gt;&lt;/dependencies&gt;</code></pre><h1 class=pgc-h-arrow-right><strong>å‰µå»ºç›®æ¨™æ¥å£å’Œç›®æ¨™å¯¦ç¾é¡</strong></h1><pre><code>public interface AccountService {    /**     * ç›®æ¨™æ–¹æ³•ï¼šï¼ˆåˆ‡å…¥é»ï¼šè¦é€²è¡Œæ””æˆªå¢å¼·çš„æ–¹æ³•ï¼‰     */    void transfer();}public class AccountServiceImpl implements AccountService {    @Override    public void transfer() {        System.out.println("è½‰è³¬æ–¹æ³•åŸ·è¡Œäº†....");        //int i = 1/0;    }}</code></pre><h1 class=pgc-h-arrow-right><strong>å‰µå»ºé€šçŸ¥é¡</strong></h1><pre><code>public class MyAdvice {    public void before(){        System.out.println("å‰ç½®é€šçŸ¥åŸ·è¡Œäº†....");    }}</code></pre><h1 class=pgc-h-arrow-right><strong>å°‡ç›®æ¨™é¡å’Œé€šçŸ¥é¡å°è±¡å‰µå»ºæ¬Šäº¤çµ¦ spring</strong></h1><pre><code>&lt;!-- ç›®æ¨™é¡äº¤çµ¦ IOC å®¹å™¨ --&gt;&lt;bean id="accountServcie" class="com.renda.service.impl.AccountServiceImpl"/&gt;&lt;!-- é€šçŸ¥é¡äº¤çµ¦ IOC å®¹å™¨ --&gt;&lt;bean id="myAdvice" class="com.renda.advice.MyAdvice"/&gt;</code></pre><h1 class=pgc-h-arrow-right><strong>åœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­é…ç½®ç¹”å…¥é—œä¿‚ï¼ŒåŠåˆ‡é¢</strong></h1><p>å°å…¥ AOP å‘½åç©ºé–“</p><pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans"       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"       xmlns:aop="http://www.springframework.org/schema/aop"       xsi:schemaLocation="http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/aop        http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;        &lt;bean id="accountServcie" class="com.renda.service.impl.AccountServiceImpl"/&gt;        &lt;bean id="myAdvice" class="com.renda.advice.MyAdvice"/&gt;        &lt;aop:config&gt;        &lt;aop:aspect ref="myAdvice"&gt;            &lt;aop:before method="before" pointcut="execution(public void com.renda.service.impl.AccountServiceImpl.transfer())"/&gt;        &lt;/aop:aspect&gt;    &lt;/aop:config&gt;â€‹&lt;/beans&gt;</code></pre><h1 class=pgc-h-arrow-right><strong>ç·¨å¯«æ¸¬è©¦ä»£ç¢¼</strong></h1><pre><code>@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration({"classpath:applicationContext.xml"})public class AccountServiceTest {    @Autowired    private AccountService accountService;â€‹    @Test    public void testTransfer() {        accountService.transfer();    }}</code></pre><h1 class=pgc-h-arrow-right><strong>XML é…ç½® AOP è©³è§£</strong></h1><h1 class=pgc-h-arrow-right><strong>åˆ‡é»è¡¨é”å¼</strong></h1><p>è¡¨é”å¼èªæ³•ï¼š</p><ul><li>è¨ªå•ä¿®é£¾ç¬¦å¯ä»¥çœç•¥</li><li>è¿”å›å€¼é¡å‹ã€åŒ…åã€é¡åã€æ–¹æ³•åå¯ä»¥ä½¿ç”¨æ˜Ÿè™Ÿ * ä»£æ›¿ï¼Œä»£è¡¨ä»»æ„</li><li>åŒ…åèˆ‡é¡åä¹‹é–“ä¸€å€‹é» . ä»£è¡¨ç•¶å‰åŒ…ä¸‹çš„é¡ï¼Œå…©å€‹é» .. è¡¨ç¤ºç•¶å‰åŒ…åŠå…¶å­åŒ…ä¸‹çš„é¡</li><li>åƒæ•¸åˆ—è¡¨å¯ä»¥ä½¿ç”¨å…©å€‹é» .. è¡¨ç¤ºä»»æ„å€‹æ•¸ï¼Œä»»æ„é¡å‹çš„åƒæ•¸åˆ—è¡¨</li></ul><p>ä¾‹å­ï¼š</p><pre><code>- execution([ä¿®é£¾ç¬¦] è¿”å›å€¼é¡å‹ åŒ…å.é¡å.æ–¹æ³•å(åƒæ•¸))execution(public void com.renda.service.impl.AccountServiceImpl.transfer(java.lang.String))- è¨ªå•ä¿®é£¾ç¬¦å¯ä»¥çœç•¥execution(void com.renda.service.impl.AccountServiceImpl.transfer(java.lang.String))- è¿”å›å€¼é¡å‹ã€åŒ…åã€é¡åã€æ–¹æ³•åå¯ä»¥ä½¿ç”¨æ˜Ÿè™Ÿ * ä»£æ›¿ï¼Œä»£è¡¨ä»»æ„execution(* *.*.*.*.*.*())- åŒ…åèˆ‡é¡åä¹‹é–“ä¸€å€‹é» . ä»£è¡¨ç•¶å‰åŒ…ä¸‹çš„é¡ï¼Œå…©å€‹é» .. è¡¨ç¤ºç•¶å‰åŒ…åŠå…¶å­åŒ…ä¸‹çš„é¡execution(* *..*.*())- åƒæ•¸åˆ—è¡¨å¯ä»¥ä½¿ç”¨å…©å€‹é» .. è¡¨ç¤ºä»»æ„å€‹æ•¸ï¼Œä»»æ„é¡å‹çš„åƒæ•¸åˆ—è¡¨execution(* *..*.*(..))</code></pre><p>åˆ‡é»è¡¨é”å¼æŠ½å–ï¼šç•¶å¤šå€‹å¢å¼·çš„åˆ‡é»è¡¨é”å¼ç›¸åŒæ™‚ï¼Œå¯ä»¥å°‡åˆ‡é»è¡¨é”å¼é€²è¡ŒæŠ½å–ï¼Œåœ¨å¢å¼·ä¸­ä½¿ç”¨ pointcut-ref å±¬æ€§ä»£æ›¿ pointcut å±¬æ€§ä¾†å¼•ç”¨æŠ½å–å¾Œçš„åˆ‡é»è¡¨é”å¼ã€‚</p><pre><code>public class MyAdvice {    public void before(){        System.out.println("å‰ç½®é€šçŸ¥åŸ·è¡Œäº†....");    }    public void afterReturning(){        System.out.println("å¾Œç½®é€šçŸ¥åŸ·è¡Œäº†....");    }    public void afterThrowing(){        System.out.println("ç•°å¸¸é€šçŸ¥åŸ·è¡Œäº†....");    }    public void after(){        System.out.println("æœ€çµ‚é€šçŸ¥åŸ·è¡Œäº†....");    }    /**     * @param pjp Proceeding JoinPoint - æ­£åœ¨åŸ·è¡Œçš„é€£æ¥é»ï¼šåˆ‡é»     */    public Object around(ProceedingJoinPoint pjp){        Object proceed = null;        try {            System.out.println("å‰ç½®é€šçŸ¥åŸ·è¡Œäº†");            // åˆ‡é»æ–¹æ³•åŸ·è¡Œ            proceed = pjp.proceed();            System.out.println("å¾Œç½®é€šçŸ¥åŸ·è¡Œäº†");        } catch (Throwable throwable) {            throwable.printStackTrace();            System.out.println("ç•°å¸¸é€šçŸ¥åŸ·è¡Œäº†");        }finally {            System.out.println("æœ€çµ‚é€šçŸ¥åŸ·è¡Œäº†");        }        return proceed;    }}&lt;aop:config&gt;    &lt;!-- æŠ½å–çš„åˆ‡é»è¡¨é”å¼ --&gt;    &lt;aop:pointcut id="myPointcut" expression="execution(* com.renda.service.impl.AccountServiceImpl.*(..))"/&gt;    &lt;!-- é…ç½®åˆ‡é¢ï¼šåˆ‡å…¥é» + é€šçŸ¥ --&gt;    &lt;aop:aspect ref="myAdvice"&gt;        &lt;aop:before method="before" pointcut-ref="myPointcut"/&gt;        &lt;aop:after-returning method="afterReturning" pointcut-ref="myPointcut"/&gt;        &lt;aop:after-throwing method="afterThrowing" pointcut-ref="myPointcut"/&gt;        &lt;aop:after method="after" pointcut-ref="myPointcut"/&gt;        &lt;!-- &lt;aop:around method="around" pointcut-ref="myPointcut"/&gt; --&gt;    &lt;/aop:aspect&gt;&lt;/aop:config&gt;</code></pre><h1 class=pgc-h-arrow-right><strong>é€šçŸ¥é¡å‹</strong></h1><p>é€šçŸ¥çš„é…ç½®èªæ³•ï¼š</p><pre><code>&lt;aop:é€šçŸ¥é¡å‹ method=â€œé€šçŸ¥é¡ä¸­æ–¹æ³•åâ€ pointcut=â€œåˆ‡é»è¡¨é”å¼"&gt;&lt;/aop:é€šçŸ¥é¡å‹&gt;</code></pre><ul><li>å‰ç½®é€šçŸ¥ &lt;aop:before> - ç”¨æ–¼é…ç½®å‰ç½®é€šçŸ¥ã€‚æŒ‡å®šå¢å¼·çš„æ–¹æ³•åœ¨åˆ‡å…¥é»æ–¹æ³•ä¹‹å‰åŸ·è¡Œ</li><li>å¾Œç½®é€šçŸ¥ &lt;aop:afterReturning> - ç”¨æ–¼é…ç½®å¾Œç½®é€šçŸ¥ã€‚æŒ‡å®šå¢å¼·çš„æ–¹æ³•åœ¨åˆ‡å…¥é»æ–¹æ³•ä¹‹å¾ŒåŸ·è¡Œ</li><li>ç•°å¸¸é€šçŸ¥ &lt;aop:afterThrowing> - ç”¨æ–¼é…ç½®ç•°å¸¸é€šçŸ¥ï¼›æŒ‡å®šå¢å¼·çš„æ–¹æ³•å‡ºç¾ç•°å¸¸å¾ŒåŸ·è¡Œ</li><li>æœ€çµ‚é€šçŸ¥ &lt;aop:after> - ç”¨æ–¼é…ç½®æœ€çµ‚é€šçŸ¥ï¼›ç„¡è«–åˆ‡å…¥é»æ–¹æ³•åŸ·è¡Œæ™‚æ˜¯å¦æœ‰ç•°å¸¸ï¼Œéƒ½æœƒåŸ·è¡Œ</li><li>ç’°ç¹é€šçŸ¥ &lt;aop:around> - ç”¨æ–¼é…ç½®ç’°ç¹é€šçŸ¥ï¼›é–‹ç™¼è€…å¯ä»¥æ‰‹å‹•æ§åˆ¶å¢å¼·ä»£ç¢¼åœ¨ä»€éº¼æ™‚å€™åŸ·è¡Œ</li></ul><p>æ³¨æ„ï¼šé€šå¸¸æƒ…æ³ä¸‹ï¼Œç’°ç¹é€šçŸ¥éƒ½æ˜¯ç¨ç«‹ä½¿ç”¨çš„</p><h1 class=pgc-h-arrow-right><strong>å°çµ</strong></h1><pre><code>* aop ç¹”å…¥çš„é…ç½®    &lt;aop:config&gt;        &lt;aop:aspect ref=â€œé€šçŸ¥é¡â€&gt;        &lt;aop:before method=â€œé€šçŸ¥æ–¹æ³•åç¨±â€ pointcut=â€œåˆ‡é»è¡¨é”å¼"&gt;&lt;/aop:before&gt;        &lt;/aop:aspect&gt;    &lt;/aop:config&gt;                                                        * é€šçŸ¥çš„é¡å‹    å‰ç½®é€šçŸ¥ã€å¾Œç½®é€šçŸ¥ã€ç•°å¸¸é€šçŸ¥ã€æœ€çµ‚é€šçŸ¥    ç’°ç¹é€šçŸ¥    * åˆ‡é»è¡¨é”å¼    execution([ä¿®é£¾ç¬¦] è¿”å›å€¼é¡å‹ åŒ…å.é¡å.æ–¹æ³•å(åƒæ•¸))</code></pre><p><br></p><h1 class=pgc-h-arrow-right><strong>åŸºæ–¼è¨»è§£çš„ AOP é–‹ç™¼</strong></h1><h1 class=pgc-h-arrow-right><strong>å¿«é€Ÿå…¥é–€</strong></h1><p>æ­¥é©Ÿåˆ†æï¼š</p><ol start=1><li>å‰µå»º java é …ç›®ï¼Œå°å…¥ AOP ç›¸é—œåº§æ¨™</li><li>å‰µå»ºç›®æ¨™æ¥å£å’Œç›®æ¨™å¯¦ç¾é¡ï¼ˆå®šç¾©åˆ‡å…¥é»ï¼‰</li><li>å‰µå»ºé€šçŸ¥é¡ï¼ˆå®šç¾©é€šçŸ¥ï¼‰</li><li>å°‡ç›®æ¨™é¡å’Œé€šçŸ¥é¡å°è±¡å‰µå»ºæ¬Šäº¤çµ¦ spring</li><li>åœ¨é€šçŸ¥é¡ä¸­ä½¿ç”¨è¨»è§£é…ç½®ç¹”å…¥é—œä¿‚ï¼Œå‡ç´šç‚ºåˆ‡é¢é¡</li><li>åœ¨é…ç½®æ–‡ä»¶ä¸­é–‹å•Ÿçµ„ä»¶æƒæå’Œ AOP çš„è‡ªå‹•ä»£ç†</li><li>ç·¨å¯«æ¸¬è©¦ä»£ç¢¼</li></ol><h1 class=pgc-h-arrow-right><strong>å‰µå»º java é …ç›®ï¼Œå°å…¥ AOP ç›¸é—œåº§æ¨™</strong></h1><pre><code>&lt;properties&gt;    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;    &lt;maven.compiler.encoding&gt;UTF-8&lt;/maven.compiler.encoding&gt;    &lt;java.version&gt;1.11&lt;/java.version&gt;    &lt;maven.compiler.source&gt;1.11&lt;/maven.compiler.source&gt;    &lt;maven.compiler.target&gt;1.11&lt;/maven.compiler.target&gt;&lt;/properties&gt;&lt;dependencies&gt;    &lt;!-- å°å…¥ spring çš„ context åº§æ¨™ï¼Œcontext ä¾è³´ aop --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.springframework&lt;/groupId&gt;        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;        &lt;version&gt;5.1.5.RELEASE&lt;/version&gt;    &lt;/dependency&gt;    &lt;!-- aspectj çš„ç¹”å…¥ --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.aspectj&lt;/groupId&gt;        &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;        &lt;version&gt;1.8.13&lt;/version&gt;    &lt;/dependency&gt;    &lt;!-- spring æ•´åˆ junit --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.springframework&lt;/groupId&gt;        &lt;artifactId&gt;spring-test&lt;/artifactId&gt;        &lt;version&gt;5.1.5.RELEASE&lt;/version&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;junit&lt;/groupId&gt;        &lt;artifactId&gt;junit&lt;/artifactId&gt;        &lt;version&gt;4.12&lt;/version&gt;    &lt;/dependency&gt;&lt;/dependencies&gt;</code></pre><h1 class=pgc-h-arrow-right><strong>å‰µå»ºç›®æ¨™æ¥å£å’Œç›®æ¨™å¯¦ç¾é¡</strong></h1><pre><code>public interface AccountService {    void transfer();}public class AccountServiceImpl implements AccountService {    @Override    public void transfer() {        System.out.println("è½‰è³¬æ–¹æ³•åŸ·è¡Œäº†....");    }}</code></pre><h1 class=pgc-h-arrow-right><strong>å‰µå»ºé€šçŸ¥é¡</strong></h1><pre><code>public class MyAdvice {    public void before(){        System.out.println("å‰ç½®é€šçŸ¥åŸ·è¡Œäº†....");    }}</code></pre><h1 class=pgc-h-arrow-right><strong>å°‡ç›®æ¨™é¡å’Œé€šçŸ¥é¡å°è±¡å‰µå»ºæ¬Šäº¤çµ¦ spring</strong></h1><pre><code>@Servicepublic class AccountServiceImpl implements AccountService {    @Override    public void transfer() {        System.out.println("è½‰è³¬æ–¹æ³•åŸ·è¡Œäº†....");    }}@Componentpublic class MyAdvice {    ...}</code></pre><h1 class=pgc-h-arrow-right><strong>åœ¨é€šçŸ¥é¡ä¸­ä½¿ç”¨è¨»è§£é…ç½®ç¹”å…¥é—œä¿‚ï¼Œå‡ç´šç‚ºåˆ‡é¢é¡</strong></h1><pre><code>@Component@Aspect // å‡ç´šç‚ºåˆ‡é¢é¡ï¼šé…ç½®åˆ‡å…¥é»å’Œé€šçŸ¥çš„é—œä¿‚public class MyAdvice {    @Before("execution(* com.renda.service.impl.AccountServiceImpl.*(..))")    public void before(){        System.out.println("å‰ç½®é€šçŸ¥åŸ·è¡Œäº†....");    }}</code></pre><h1 class=pgc-h-arrow-right><strong>åœ¨é…ç½®æ–‡ä»¶ä¸­é–‹å•Ÿçµ„ä»¶æƒæå’Œ AOP çš„è‡ªå‹•ä»£ç†</strong></h1><pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans"       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"       xmlns:aop="http://www.springframework.org/schema/aop"       xmlns:context="http://www.springframework.org/schema/context"       xsi:schemaLocation="http://www.springframework.org/schema/beans		http://www.springframework.org/schema/beans/spring-beans.xsd		http://www.springframework.org/schema/aop		http://www.springframework.org/schema/aop/spring-aop.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"&gt;    &lt;!-- é–‹å•Ÿ IOC è¨»è§£æƒæ --&gt;    &lt;context:component-scan base-package="com.renda"/&gt;    &lt;!-- aop çš„è‡ªå‹•ä»£ç†ï¼šæ¡ç”¨å‹•æ…‹ä»£ç†å®Œæˆç¹”å…¥å¢å¼·ï¼Œä¸¦ä¸”ç”Ÿæˆä»£ç†ï¼›proxy-target-class="true" è¡¨ç¤ºå¼·åˆ¶ä½¿ç”¨ cglib å‹•æ…‹ä»£ç†--&gt;    &lt;aop:aspectj-autoproxy proxy-target-class="false"/&gt;&lt;/beans&gt;</code></pre><h1 class=pgc-h-arrow-right><strong>ç·¨å¯«æ¸¬è©¦ä»£ç¢¼</strong></h1><pre><code>@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration("classpath:applicationContext.xml")public class AccountServiceTest {    @Autowired    private AccountService accountService;    @Test    public void testTransfer(){        accountService.transfer();    }}</code></pre><h1 class=pgc-h-arrow-right><strong>è¨»è§£é…ç½® AOP è©³è§£</strong></h1><h1 class=pgc-h-arrow-right><strong>åˆ‡é»è¡¨é”å¼</strong></h1><p>åˆ‡é»è¡¨é”å¼çš„æŠ½å–</p><pre><code>@Component@Aspect // å‡ç´šç‚ºåˆ‡é¢é¡ï¼šé…ç½®åˆ‡å…¥é»å’Œé€šçŸ¥çš„é—œä¿‚public class MyAdvice {    @Pointcut("execution(* com.renda.service.impl.AccountServiceImpl.*(..))")    public void myPoint(){    }    @Before("MyAdvice.myPoint()")    public void before(){        System.out.println("å‰ç½®é€šçŸ¥åŸ·è¡Œäº†....");    }    @AfterReturning("MyAdvice.myPoint()")    public void afterReturning(){        System.out.println("å¾Œç½®é€šçŸ¥åŸ·è¡Œäº†....");    }    @AfterThrowing("MyAdvice.myPoint()")    public void afterThrowing(){        System.out.println("ç•°å¸¸é€šçŸ¥åŸ·è¡Œäº†....");    }    @After("MyAdvice.myPoint()")    public void after(){        System.out.println("æœ€çµ‚é€šçŸ¥åŸ·è¡Œäº†....");    }    /**     * @param pjp Proceeding JoinPoint - æ­£åœ¨åŸ·è¡Œçš„é€£æ¥é»ï¼šåˆ‡é»     */    public Object around(ProceedingJoinPoint pjp){        Object proceed = null;        try {            System.out.println("å‰ç½®é€šçŸ¥åŸ·è¡Œäº†");            // åˆ‡é»æ–¹æ³•åŸ·è¡Œ            proceed = pjp.proceed();            System.out.println("å¾Œç½®é€šçŸ¥åŸ·è¡Œäº†");        } catch (Throwable throwable) {            throwable.printStackTrace();            System.out.println("ç•°å¸¸é€šçŸ¥åŸ·è¡Œäº†");        }finally {            System.out.println("æœ€çµ‚é€šçŸ¥åŸ·è¡Œäº†");        }        return proceed;    }}</code></pre><h1 class=pgc-h-arrow-right><strong>é€šçŸ¥é¡å‹</strong></h1><p>é€šçŸ¥çš„é…ç½®èªæ³•ï¼š@é€šçŸ¥è¨»è§£(â€œåˆ‡é»è¡¨é”å¼")</p><ul><li>å‰ç½®é€šçŸ¥ @Before - ç”¨æ–¼é…ç½®å‰ç½®é€šçŸ¥ï¼›æŒ‡å®šå¢å¼·çš„æ–¹æ³•åœ¨åˆ‡å…¥é»æ–¹æ³•ä¹‹å‰åŸ·è¡Œ</li><li>å¾Œç½®é€šçŸ¥ @AfterReturning - ç”¨æ–¼é…ç½®å¾Œç½®é€šçŸ¥ï¼›æŒ‡å®šå¢å¼·çš„æ–¹æ³•åœ¨åˆ‡å…¥é»æ–¹æ³•ä¹‹å¾ŒåŸ·è¡Œ</li><li>ç•°å¸¸é€šçŸ¥ @AfterThrowing - ç”¨æ–¼é…ç½®ç•°å¸¸é€šçŸ¥ï¼›æŒ‡å®šå¢å¼·çš„æ–¹æ³•å‡ºç¾ç•°å¸¸å¾ŒåŸ·è¡Œ</li><li>æœ€çµ‚é€šçŸ¥ @After - ç”¨æ–¼é…ç½®æœ€çµ‚é€šçŸ¥ï¼›ç„¡è«–åˆ‡å…¥é»æ–¹æ³•åŸ·è¡Œæ™‚æ˜¯å¦æœ‰ç•°å¸¸ï¼Œéƒ½æœƒåŸ·è¡Œ</li><li>ç’°ç¹é€šçŸ¥ @Around - ç”¨æ–¼é…ç½®ç’°ç¹é€šçŸ¥ï¼›é–‹ç™¼è€…å¯ä»¥æ‰‹å‹•æ§åˆ¶å¢å¼·ä»£ç¢¼åœ¨ä»€éº¼æ™‚å€™åŸ·è¡Œ</li></ul><h1 class=pgc-h-arrow-right><strong>æ³¨æ„</strong></h1><p>ç•¶å‰å››å€‹é€šçŸ¥çµ„åˆåœ¨ä¸€èµ·æ™‚ï¼Œå‡ºç¾ä¸€å€‹ Spring çš„åŸ·è¡Œé †åºçš„ Bugï¼ŒéŒ¯èª¤çš„åŸ·è¡Œé †åºå¦‚ä¸‹ï¼š</p><pre><code>@Before -&gt; @After -&gt; @AfterReturningï¼ˆå¦‚æœæœ‰ç•°å¸¸ï¼š@AfterThrowingï¼‰</code></pre><p>å¦‚æœå–®ç¨ä½¿ç”¨ç’°ç¹é€šçŸ¥ @Around è¨»è§£å‰‡ä¸æœƒæœ‰é€™å€‹ Bugï¼ŒåŸ·è¡Œé †åºå¦‚ä¸‹ï¼š</p><pre><code>@Before -&gt; @AfterReturningï¼ˆå¦‚æœæœ‰ç•°å¸¸ï¼š@AfterThrowingï¼‰-&gt; @After</code></pre><h1 class=pgc-h-arrow-right><strong>ç´”è¨»è§£é…ç½®</strong></h1><p>å»æ‰ applicationContext.xml é…ç½®æ–‡ä»¶ï¼Œå¢åŠ  SpringConfig é…ç½®é¡</p><pre><code>@Configuration@ComponentScan("com.renda")@EnableAspectJAutoProxy // é–‹å•Ÿ AOP çš„è‡ªå‹•ä»£ç†ï¼Œæ›¿ä»£ xml é…ç½®çš„ &lt;aop:aspectj-autoproxy /&gt;public class SpringConfig {}</code></pre><p>ä¿®æ”¹æ¸¬è©¦é¡</p><pre><code>@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration(classes = SpringConfig.class)public class AccountServiceTest {â€‹    @Autowired    private AccountService accountService;â€‹    @Test    public void testTransfer(){        accountService.transfer();    }â€‹}</code></pre><h1 class=pgc-h-arrow-right><strong>çŸ¥è­˜å°çµ</strong></h1><pre><code>* ä½¿ç”¨ @Aspect è¨»è§£ï¼Œæ¨™è¨»åˆ‡é¢é¡* ä½¿ç”¨ @Before ç­‰è¨»è§£ï¼Œæ¨™è¨»é€šçŸ¥æ–¹æ³•* ä½¿ç”¨ @Pointcut è¨»è§£ï¼ŒæŠ½å–åˆ‡é»è¡¨é”å¼* é…ç½® aop è‡ªå‹•ä»£ç† &lt;aop:aspectj-autoproxy/&gt; æˆ– @EnableAspectJAutoProxy</code></pre><p><br></p><h1 class=pgc-h-arrow-right><strong>AOP å„ªåŒ–è½‰è³¬æ¡ˆä¾‹</strong></h1><p>ä¾ç„¶ä½¿ç”¨å‰é¢çš„è½‰è³¬æ¡ˆä¾‹ï¼Œå°‡å…©å€‹ä»£ç†å·¥å» å°è±¡ç›´æ¥åˆªé™¤ï¼Œæ”¹ç‚º spring çš„ AOP æ€æƒ³ä¾†å¯¦ç¾</p><h1 class=pgc-h-arrow-right><strong>xml é…ç½®å¯¦ç¾</strong></h1><h1 class=pgc-h-arrow-right><strong>é…ç½®æ–‡ä»¶</strong></h1><pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans"       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"       xmlns:context="http://www.springframework.org/schema/context"       xmlns:aop="http://www.springframework.org/schema/aop"       xsi:schemaLocation="       	http://www.springframework.org/schema/beans		http://www.springframework.org/schema/beans/spring-beans.xsd       	http://www.springframework.org/schema/context		http://www.springframework.org/schema/context/spring-context.xsd		http://www.springframework.org/schema/aop		http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;    &lt;!-- é–‹å•Ÿè¨»è§£æƒæ --&gt;    &lt;context:component-scan base-package="com.renda"/&gt;    &lt;!-- å¼•å…¥ properties --&gt;    &lt;context:property-placeholder location="classpath:jdbc.properties"/&gt;    &lt;!-- é…ç½® DataSource --&gt;    &lt;bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource"&gt;        &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;        &lt;property name="url" value="${jdbc.url}"/&gt;        &lt;property name="username" value="${jdbc.username}"/&gt;        &lt;property name="password" value="${jdbc.password}"/&gt;    &lt;/bean&gt;    &lt;!-- é…ç½® queryRunner --&gt;    &lt;bean id="queryRunner" class="org.apache.commons.dbutils.QueryRunner"&gt;        &lt;constructor-arg name="ds" ref="dataSource"/&gt;    &lt;/bean&gt;    &lt;!-- AOP é…ç½® --&gt;      &lt;aop:config&gt;          &lt;!-- 1.åˆ‡é»è¡¨é”å¼ --&gt;          &lt;aop:pointcut id="myPointcut" expression="execution(* com.renda.service.impl.AccountServiceImpl.*(..))"/&gt;          &lt;!-- 2.åˆ‡é¢é…ç½® --&gt;          &lt;aop:aspect ref="transactionManager"&gt;              &lt;aop:before method="beginTransaction" pointcut-ref="myPointcut"/&gt;              &lt;aop:after-returning method="commit"  pointcut-ref="myPointcut"/&gt;              &lt;aop:after-throwing method="rollback" pointcut-ref="myPointcut"/&gt;              &lt;aop:after method="release" pointcut-ref="myPointcut"/&gt;          &lt;/aop:aspect&gt;      &lt;/aop:config&gt;&lt;/beans&gt;</code></pre><h1 class=pgc-h-arrow-right><strong>äº‹å‹™ç®¡ç†å™¨ï¼ˆé€šçŸ¥ï¼‰</strong></h1><pre><code>package com.renda.utils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Component;import java.sql.Connection;import java.sql.SQLException;/** * äº‹å‹™ç®¡ç†å™¨å·¥å…·é¡ï¼šåŒ…å«ï¼šé–‹å•Ÿäº‹å‹™ã€æäº¤äº‹å‹™ã€å›æ»¾äº‹å‹™ã€é‡‹æ”¾è³‡æº *      Spring AOP çš„é€šçŸ¥é¡ * * @author Renda Zhang * @create 2020-09-04 15:31 */@Component("transactionManager")public class TransactionManager {    @Autowired    private ConnectionUtils connectionUtils;    /**     * é–‹å•Ÿäº‹å‹™     */    public void beginTransaction(){        // ç²å– connection å°è±¡        Connection connection = connectionUtils.getThreadConnection();        try {            // é–‹å•Ÿäº†ä¸€å€‹æ‰‹å‹•äº‹å‹™            connection.setAutoCommit(false);            System.out.println("é–‹å•Ÿäº‹å‹™");        } catch (SQLException e) {            e.printStackTrace();        }    }    /**     * æäº¤äº‹å‹™     */    public void commit(){        Connection connection = connectionUtils.getThreadConnection();        try {            connection.commit();            System.out.println("æäº¤äº‹å‹™");        } catch (SQLException e) {            e.printStackTrace();        }    }    /**     * å›æ»¾äº‹å‹™     */    public void rollback(){        Connection connection = connectionUtils.getThreadConnection();        try {            connection.rollback();            System.out.println("å›æ»¾äº‹å‹™");        } catch (SQLException e) {            e.printStackTrace();        }    }    /**     * é‡‹æ”¾è³‡æº     */    public void release(){        // å°‡æ‰‹å‹•äº‹å‹™æ”¹å›æˆè‡ªå‹•æäº¤äº‹å‹™        Connection connection = connectionUtils.getThreadConnection();        try {            connection.setAutoCommit(true);            // å°‡é€£æ¥æ­¸é‚„åˆ°é€£æ¥æ±             connectionUtils.getThreadConnection().close();            // è§£é™¤ç·šç¨‹ç¶å®š            connectionUtils.removeThreadConnection();            System.out.println("é‡‹æ”¾è³‡æº");        } catch (SQLException e) {            e.printStackTrace();        }    }}</code></pre><h1 class=pgc-h-arrow-right><strong>è¨»è§£é…ç½®å¯¦ç¾</strong></h1><h1 class=pgc-h-arrow-right><strong>é…ç½®æ–‡ä»¶</strong></h1><pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans"       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"       xmlns:context="http://www.springframework.org/schema/context"       xmlns:aop="http://www.springframework.org/schema/aop"       xsi:schemaLocation="        http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/context        http://www.springframework.org/schema/context/spring-context.xsd        http://www.springframework.org/schema/aop        http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;â€‹    &lt;!-- é–‹å•Ÿè¨»è§£æƒæ --&gt;    &lt;context:component-scan base-package="com.renda"/&gt;â€‹    &lt;!-- å¼•å…¥ properties --&gt;    &lt;context:property-placeholder location="classpath:jdbc.properties"/&gt;â€‹    &lt;!-- é…ç½® DataSource --&gt;    &lt;bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource"&gt;        &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;        &lt;property name="url" value="${jdbc.url}"/&gt;        &lt;property name="username" value="${jdbc.username}"/&gt;        &lt;property name="password" value="${jdbc.password}"/&gt;    &lt;/bean&gt;â€‹    &lt;!-- é…ç½® queryRunner --&gt;    &lt;bean id="queryRunner" class="org.apache.commons.dbutils.QueryRunner"&gt;        &lt;constructor-arg name="ds" ref="dataSource"/&gt;    &lt;/bean&gt;â€‹    &lt;!-- é–‹å•Ÿ AOP çš„è‡ªå‹•ä»£ç† --&gt;    &lt;aop:aspectj-autoproxy/&gt;â€‹&lt;/beans&gt;</code></pre><h1 class=pgc-h-arrow-right><strong>äº‹å‹™ç®¡ç†å™¨ï¼ˆé€šçŸ¥ï¼‰</strong></h1><pre><code>@Component("transactionManager")@Aspect // è¡¨æ˜è©²é¡ç‚ºåˆ‡é¢é¡public class TransactionManager {    @Autowired    private ConnectionUtils connectionUtils;â€‹    @Around("execution(* com.renda.service.impl.AccountServiceImpl.*(..))")    public Object around(ProceedingJoinPoint pjp) throws SQLException {        Object proceed = null;â€‹        try {            // é–‹å•Ÿæ‰‹å‹•äº‹å‹™            System.out.println("é–‹å•Ÿäº‹å‹™");            connectionUtils.getThreadConnection().setAutoCommit(false);â€‹            // åˆ‡å…¥é»æ–¹æ³•åŸ·è¡Œ            proceed = pjp.proceed();â€‹            // æ‰‹å‹•æäº¤äº‹å‹™            System.out.println("æäº¤äº‹å‹™");            connectionUtils.getThreadConnection().commit();        } catch (Throwable throwable) {            throwable.printStackTrace();            // æ‰‹å‹•å›æ»¾äº‹å‹™            System.out.println("å›æ»¾äº‹å‹™");            connectionUtils.getThreadConnection().rollback();        } finally {            System.out.println("é‡‹æ”¾è³‡æº");            // å°‡æ‰‹å‹•äº‹å‹™æ¢å¾©æˆè‡ªå‹•äº‹å‹™            connectionUtils.getThreadConnection().setAutoCommit(true);            // å°‡é€£æ¥æ­¸é‚„åˆ°é€£æ¥æ±             connectionUtils.getThreadConnection().close();            // è§£é™¤ç·šç¨‹ç¶å®š            connectionUtils.removeThreadConnection();        }â€‹        return proceed;    }}</code></pre><blockquote class=pgc-blockquote-abstract><p>æƒ³äº†è§£æ›´å¤šï¼Œæ­¡è¿é—œæ³¨æˆ‘çš„å¾®ä¿¡å…¬çœ¾è™Ÿï¼šRenda_Zhang</p></blockquote></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Spring</a></li><li><a>AOP</a></li><li><a>ç·¨ç¨‹</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/60d27d99.html alt=Springé¢å‘åˆ‡é¢ç·¨ç¨‹AOPçš„åˆæ­¥ç­è§£ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6eb76749eacf41f1ac8d6bb660ae18ab style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/60d27d99.html title=Springé¢å‘åˆ‡é¢ç·¨ç¨‹AOPçš„åˆæ­¥ç­è§£>Springé¢å‘åˆ‡é¢ç·¨ç¨‹AOPçš„åˆæ­¥ç­è§£</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2798be0b.html alt="Spring AOP é¢å‘åˆ‡é¢ç·¨ç¨‹éœ€è¦çŸ¥é“çš„äº‹" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/63832e5a-4ec8-451b-87cf-c6295ac2adf5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2798be0b.html title="Spring AOP é¢å‘åˆ‡é¢ç·¨ç¨‹éœ€è¦çŸ¥é“çš„äº‹">Spring AOP é¢å‘åˆ‡é¢ç·¨ç¨‹éœ€è¦çŸ¥é“çš„äº‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/af398a38.html alt=Springâ€”é¢å‘åˆ‡é¢ç·¨ç¨‹ï¼ˆAOPï¼‰è©³è§£ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/3ad8b3ec-d7c5-4b89-9b46-e473a4f5d570 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/af398a38.html title=Springâ€”é¢å‘åˆ‡é¢ç·¨ç¨‹ï¼ˆAOPï¼‰è©³è§£>Springâ€”é¢å‘åˆ‡é¢ç·¨ç¨‹ï¼ˆAOPï¼‰è©³è§£</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c98c28c3.html alt=ä½¿ç”¨è¨»è§£æ–¹å¼é…ç½®Springä¸­çš„é¢å‘åˆ‡é¢ç·¨ç¨‹AOP class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c98c28c3.html title=ä½¿ç”¨è¨»è§£æ–¹å¼é…ç½®Springä¸­çš„é¢å‘åˆ‡é¢ç·¨ç¨‹AOP>ä½¿ç”¨è¨»è§£æ–¹å¼é…ç½®Springä¸­çš„é¢å‘åˆ‡é¢ç·¨ç¨‹AOP</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b91a8349.html alt="Spring AOPç°¡ä»‹èˆ‡åº•å±¤å¯¦ç¾æ©Ÿåˆ¶â€”â€”å‹•æ…‹ä»£ç†" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/413780d1-cf47-4038-9471-b686d97aa99b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b91a8349.html title="Spring AOPç°¡ä»‹èˆ‡åº•å±¤å¯¦ç¾æ©Ÿåˆ¶â€”â€”å‹•æ…‹ä»£ç†">Spring AOPç°¡ä»‹èˆ‡åº•å±¤å¯¦ç¾æ©Ÿåˆ¶â€”â€”å‹•æ…‹ä»£ç†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b5dd97d4.html alt=Springæ¡†æ¶AOPæŠ€è¡“ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/760bf32faca443cb8e28ed0b9bc20205 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b5dd97d4.html title=Springæ¡†æ¶AOPæŠ€è¡“>Springæ¡†æ¶AOPæŠ€è¡“</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b949fbad.html alt=å°å¯¦ä¾‹ç†è§£Springä¸­çš„AOP----é¢å‘åˆ‡é¢ç·¨ç¨‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/35942664cec244f88d6a0f7b1e7067cc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b949fbad.html title=å°å¯¦ä¾‹ç†è§£Springä¸­çš„AOP----é¢å‘åˆ‡é¢ç·¨ç¨‹>å°å¯¦ä¾‹ç†è§£Springä¸­çš„AOP----é¢å‘åˆ‡é¢ç·¨ç¨‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a7b6ff44.html alt=è«‡è«‡AOPï¼ˆé¢å‘åˆ‡é¢ç·¨ç¨‹ï¼‰ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1534580818763e7a06b5c87 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a7b6ff44.html title=è«‡è«‡AOPï¼ˆé¢å‘åˆ‡é¢ç·¨ç¨‹ï¼‰>è«‡è«‡AOPï¼ˆé¢å‘åˆ‡é¢ç·¨ç¨‹ï¼‰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/82a2f71a.html alt=é¢å‘åˆ‡é¢ç·¨ç¨‹ï¼ˆAOPï¼‰ä¸­çš„è¡“èªä½ èƒ½èªªå‡ºå¹¾å€‹ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/5436586b-f08f-4845-b15a-7da897dc9b16 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/82a2f71a.html title=é¢å‘åˆ‡é¢ç·¨ç¨‹ï¼ˆAOPï¼‰ä¸­çš„è¡“èªä½ èƒ½èªªå‡ºå¹¾å€‹ï¼Ÿ>é¢å‘åˆ‡é¢ç·¨ç¨‹ï¼ˆAOPï¼‰ä¸­çš„è¡“èªä½ èƒ½èªªå‡ºå¹¾å€‹ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0ef619f7.html alt=Autofacçš„AOPé¢å‘åˆ‡é¢ç·¨ç¨‹ç ”ç©¶ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15b5a9a952f84c688e4f9a33c0fe0f13 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0ef619f7.html title=Autofacçš„AOPé¢å‘åˆ‡é¢ç·¨ç¨‹ç ”ç©¶>Autofacçš„AOPé¢å‘åˆ‡é¢ç·¨ç¨‹ç ”ç©¶</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fcef4925.html alt="Spring AOPï¼šSpringçš„é¢å‘åˆ‡é¢ï¼Œæä¾›AOPï¼ˆé¢å‘åˆ‡é¢ç·¨ç¨‹ï¼‰çš„å¯¦ç¾" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fcef4925.html title="Spring AOPï¼šSpringçš„é¢å‘åˆ‡é¢ï¼Œæä¾›AOPï¼ˆé¢å‘åˆ‡é¢ç·¨ç¨‹ï¼‰çš„å¯¦ç¾">Spring AOPï¼šSpringçš„é¢å‘åˆ‡é¢ï¼Œæä¾›AOPï¼ˆé¢å‘åˆ‡é¢ç·¨ç¨‹ï¼‰çš„å¯¦ç¾</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/92488c35.html alt="Springå­¸ç¿’ï¼ˆ4ï¼‰ï¼šSpring AOP" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/be8a179a4a8040648c1fb5a0532cc84b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/92488c35.html title="Springå­¸ç¿’ï¼ˆ4ï¼‰ï¼šSpring AOP">Springå­¸ç¿’ï¼ˆ4ï¼‰ï¼šSpring AOP</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1946647f.html alt=Springé¢å‘åˆ‡é¢ç·¨ç¨‹çš„AOPçš„äº‹å‹™å¢å¼·å®Œæ•´ç‰ˆçš„é…ç½® class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1946647f.html title=Springé¢å‘åˆ‡é¢ç·¨ç¨‹çš„AOPçš„äº‹å‹™å¢å¼·å®Œæ•´ç‰ˆçš„é…ç½®>Springé¢å‘åˆ‡é¢ç·¨ç¨‹çš„AOPçš„äº‹å‹™å¢å¼·å®Œæ•´ç‰ˆçš„é…ç½®</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7d826c93.html alt=springæ¡†æ¶ä¹‹AOPé¢å‘åˆ‡é¢ç·¨ç¨‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9b61c468edc241dda89e2ac1e5fabd74 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7d826c93.html title=springæ¡†æ¶ä¹‹AOPé¢å‘åˆ‡é¢ç·¨ç¨‹>springæ¡†æ¶ä¹‹AOPé¢å‘åˆ‡é¢ç·¨ç¨‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d371c81c.html alt=ä¸€æ‹›å­¸æœƒé¢å‘åˆ‡é¢ç·¨ç¨‹(AOP) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d371c81c.html title=ä¸€æ‹›å­¸æœƒé¢å‘åˆ‡é¢ç·¨ç¨‹(AOP)>ä¸€æ‹›å­¸æœƒé¢å‘åˆ‡é¢ç·¨ç¨‹(AOP)</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>