<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>綜合典藏：全面快速入門Redis數據庫(文末有更多資料） | 极客快訊</title><meta property="og:title" content="綜合典藏：全面快速入門Redis數據庫(文末有更多資料） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/94a1c0a72fcf432bb4711317aadcc8c5"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91277652.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91277652.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/91277652.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91277652.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91277652.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/91277652.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/91277652.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91277652.html><meta property="article:published_time" content="2020-10-29T21:09:57+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:57+08:00"><meta name=Keywords content><meta name=description content="綜合典藏：全面快速入門Redis數據庫(文末有更多資料）"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/91277652.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>綜合典藏：全面快速入門Redis數據庫(文末有更多資料）</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><blockquote><p>作者：小弟調調</p><p>鏈接：https://segmentfault.com/a/1190000010241956</p></blockquote><p><br></p><div class=pgc-img><img alt=綜合典藏：全面快速入門Redis數據庫(文末有更多資料） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/94a1c0a72fcf432bb4711317aadcc8c5><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-android"><section></section></div><div class="pgc-img-button setImageCover fix-android"><section></section></div><div class="pgc-img-button deleteImage fix-android"><section></section></div></div><div class=pgc-img-border></div></div><p>Redis安裝</p><p>官方編譯安裝</p><p>$ wget http://download.redis.io/releases/redis-4.0.0.tar.gz</p><p>$ tar xzvf redis-4.0.0.tar.gz -C /usr/local/</p><p>$ cd /usr/local/redis-4.0.0</p><p>$ make</p><p>$ make test</p><p>$ make install</p><p># 程序會自動執行:</p><p># mkdir -p /usr/local/bin</p><p># cp -pf redis-server /usr/local/bin</p><p># cp -pf redis-benchmark /usr/local/bin</p><p># cp -pf redis-cli /usr/local/bin</p><p># cp -pf redis-check-dump /usr/local/bin</p><p># cp -pf redis-check-aof /usr/local/bin</p><p>測試make test報錯</p><p>$ make test</p><p>You need tcl 8.5 or newer in order to run the Redis test</p><p>make: *** [test] Error 1</p><p>這個是需要安裝tcl</p><p>wget http://downloads.sourceforge.net/tcl/tcl8.6.1-src.tar.gz</p><p>sudo tar xzvf tcl8.6.1-src.tar.gz -C /usr/local/</p><p>cd /usr/local/tcl8.6.1/unix/</p><p>sudo ./configure</p><p>sudo make</p><p>sudo make install</p><p>通過EPEL源安裝</p><p>源安裝問題在於不能安裝最新，或者指定Redis版本。</p><p>yum --enablerepo=epel -y install redis</p><p>如果沒有安裝源，通過下面方式安裝源。</p><p>cd /etc/yum.repos.d/</p><p>rpm -Uvh http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</p><p>Redis升級</p><p>首先，確保安裝了以下repos，EPEL和REMI：</p><p>sudo rpm -Uvh http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</p><p>sudo rpm -Uvh http://rpms.remirepo.net/enterprise/remi-release-6.rpm</p><p>通過--enablerepo=epel參數查看指定源Redis版本，檢查REMI repo中的Redis版本：</p><p>yum --enablerepo=epel info redis</p><p># Loaded plugins: fastestmirror</p><p># Loading mirror speeds from cached hostfile</p><p># * base: centos.ustc.edu.cn</p><p># * epel: mirrors.tuna.tsinghua.edu.cn</p><p># * extras: centos.ustc.edu.cn</p><p># * updates: mirrors.zju.edu.cn</p><p># Available Packages</p><p># Name : redis</p><p># Arch : x86_64</p><p># Version : 2.4.10</p><p># Release : 1.el6</p><p># Size : 213 k</p><p># Repo : epel/x86_64</p><p># Summary : A persistent key-value database</p><p># URL : http://redis.io</p><p># License : BSD</p><p># Description : Redis is an advanced key-value store. It is similar to memcached but the data</p><p># : set is not volatile, and values can be strings, exactly like in memcached, but</p><p># : also lists, sets, and ordered sets. All this data types can be manipulated with</p><p># : atomic operations to push/pop elements, add/remove elements, perform server</p><p># : side union, intersection, difference between sets, and so forth. Redis supports</p><p># : different kind of sorting abilities.</p><p>然後從EPEL repo安裝相關的依賴關係（jemalloc）：</p><p>yum --enablerepo=epel install jemalloc</p><p>在安裝之前，您應該停止舊的Redis守護進程：</p><p>service redis stop</p><p>然後安裝更新版本的Redis：</p><p>sudo yum --enablerepo=remi install redis</p><p>服務管理</p><p>重新啟動Redis守護程序，並使其重新啟動時自動啟動：</p><p>sudo service redis start</p><p>sudo chkconfig redis on</p><p>基本服務操作</p><p>## 啟動並後臺運行</p><p>$ redis-server & nohup</p><p>## 查是否啟動</p><p>$ redis-cli ping</p><p>## 關閉命令</p><p>$ redis-cli shutdown</p><p># 命令行客戶端啟動</p><p>$ redis-cli start</p><p># 啟動</p><p>$ service redis start</p><p># 停止</p><p>$ service redis stop</p><p># 命令行客戶端啟動</p><p>$ redis-cli -p 6380</p><p># 指定端口後臺啟動</p><p>$ redis-server --port 6380 &</p><p>查看版本</p><p>檢查當前安裝的Redis版本：</p><p># 查看 Redis 版本</p><p>$ redis-cli info | grep redis_version</p><p># 查看端口號</p><p>$ redis-cli info | grep tcp_port</p><p>開機啟動</p><p>我們將在 Redis 安裝目錄找到/usr/local/redis-4.0.0/utils這個目錄，在這個目錄中有個有個腳本 redis_init_script，將此腳本拷貝到/etc/init.d目錄下，命名為redis:</p><p>cp /usr/local/redis-4.0.0/utils/redis_init_script /etc/init.d/redis</p><p>拷貝一下redis.conf 文件到/etc/redis目錄下</p><p>cp /usr/local/redis-4.0.0/redis.conf /etc/redis/6380.conf</p><p>配置文件6380.conf需要更改幾個地方</p><p># 是否在後臺執行，yes：後臺運行；no：不是後臺運行（老版本默認）</p><p>daemonize yes</p><p>更改權限，通過 chkconfig 命令檢查、設置系統redis服務開啟</p><p>chmod +x /etc/init.d/redis</p><p>chkconfig redis on</p><p>必須把下面兩行註釋放在 /etc/init.d/redis 文件頭部，不設置會報不支持的提示 service redis does not support chkconfig</p><p># chkconfig: 2345 90 10</p><p># description: redis is a persistent key-value database</p><p>上面的註釋的意思是，redis服務必須在運行級2，3，4，5下被啟動或關閉，啟動的優先級是90，關閉的優先級是10。</p><p><strong>Redis 啟動警告錯誤解決</strong></p><ol><li>WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.</li></ol><p>echo "vm.overcommit_memory=1" > /etc/sysctl.conf # 或 vi /etcsysctl.conf , 然後reboot重啟機器</p><p>echo 1 > /proc/sys/vm/overcommit_memory # 不需要啟機器就生效</p><ol><li>WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</li></ol><p>echo 511 > /proc/sys/net/core/somaxconn</p><p>更改配置</p><p>Redis 的配置文件位於 Redis 安裝目錄下，文件名為 redis.conf。默認 Redis 配置文件在 sudo vi /etc/redis.conf 這裡可以編輯</p><p>sudo vi /etc/redis.conf</p><p>你可以通過 CONFIG 命令查看或設置配置項。配置設置命令</p><p>## 進入redis獲取</p><p>127.0.0.1:6379> CONFIG GET CONFIG_SETTING_NAME</p><p>## 進入redis設置</p><p>127.0.0.1:6379> CONFIG SET CONFIG_SETTING_NAME NEW_CONFIG_VALUE</p><p>## 獲取所有配置</p><p>127.0.0.1:6379> CONFIG GET *</p><p>## 設置配置開啟通知功能</p><p>$ redis-cli config set notify-keyspace-events KEA</p><p>基本操作</p><p>## 命令行客戶端啟動</p><p>$ redis-cli</p><p># 測試心跳</p><p>127.0.0.1:6379> ping</p><p>PONG</p><p># 設置 mykey 鍵的值</p><p>127.0.0.1:6379> set mykey hello</p><p>OK</p><p># 獲取 mykey 鍵的值</p><p>127.0.0.1:6379> get mykey</p><p>"hello"</p><p>## 設置 mykey 失效事件</p><p>127.0.0.1:6379> expire mykey 2</p><p># 查看當前redis的配置信息</p><p>127.0.0.1:6379> config get *</p><p># 獲取所有的key</p><p>127.0.0.1:6379> keys *</p><p># 刪除redis當前數據庫中的所有Key</p><p>127.0.0.1:6379> flushdb</p><p>127.0.0.1:6379> config get dir</p><p># 饞哭當前庫 key 的數量</p><p>127.0.0.1:6379> dbsize</p><p># 刪除所有數據庫中的key</p><p>127.0.0.1:6379> flushall</p><p># 退出</p><p>127.0.0.1:6379> exit</p><p># 找出拖慢 Redis 的罪魁禍首</p><p># 通過這個工具可以查看所有命令統計的快照，</p><p># 比如命令執行了多少次，</p><p># 執行命令所耗費的毫秒數(每個命令的總時間和平均時間)</p><p># 只需要簡單地執行 CONFIG RESETSTAT 命令就可以重置，這樣你就可以得到一個全新的統計結果。</p><p>127.0.0.1:6379> commandstats</p><p>cmdstat_get:calls=78,usec=608,usec_per_call=7.79</p><p>cmdstat_setex:calls=5,usec=71,usec_per_call=14.20</p><p>cmdstat_keys:calls=2,usec=42,usec_per_call=21.00</p><p>cmdstat_info:calls=10,usec=1931,usec_per_call=193.10</p><p>支持的數據類型</p><p>字符串</p><p># 啟動客戶端 ,存儲字符串到redis.</p><p>redis> SET name forezp</p><p>OK</p><p># 取字符串:</p><p>redis> get name</p><p>"forezp"</p><p>Hashes - 哈希值</p><p>redis > HMSET king username forezp password xxdxx age 22</p><p>redis > HGETALL king</p><p>1) "username"</p><p>2) "forezp "</p><p>3) "password "</p><p>4) "xxdxx "</p><p>5) "age "</p><p>6) "22"</p><p>Lists - 列表</p><p>redis> lpush pricess kenny</p><p>(integer) 1</p><p>redis 127.0.0.1:6379> lpush pricess jolin</p><p>(integer) 2</p><p>redis 127.0.0.1:6379> lpush pricess mayun</p><p>(integer) 3</p><p>redis 127.0.0.1:6379> lrange pricess 0 10</p><p>1) "kenny"</p><p>2) "jolin"</p><p>3) "mayun"</p><p>有序集合</p><p>redis > ZADD kindom 1 redis</p><p>(integer) 1</p><p>redis> ZADD kindom 2 mongodb</p><p>(integer) 1</p><p>redis > ZADD kindom 3 mysql</p><p>(integer) 1</p><p>redis > ZADD kindom 3 mysql</p><p>(integer) 0</p><p>redis > ZADD kindom 4 mysql</p><p>(integer) 0</p><p>redis > ZRANGE kindom 0 10 WITHSCORES</p><p>1) "redis"</p><p>2) "1"</p><p>3) "mongodb"</p><p>4) "2"</p><p>5) "mysql"</p><p>6) "4"</p><p>開啟通知</p><p>鍵空間事件通知默認被禁用，因為這個特性消耗CPU電量不是很明智。使用redis.conf的notify-keyspace-events，或者通過CONFIG SET來開啟通知。</p><p>## 設置配置開啟通知功能</p><p>$ redis-cli config set notify-keyspace-events KEA</p><p>## 命令行監控所有通知</p><p>$ redis-cli --csv psubscribe '__key*__:*'</p><p>Reading messages... (press Ctrl-C to quit)</p><p>"psubscribe","__key*__:*",1</p><p>鍵值說明</p><p>K Keyspace events, published with __keyspace@&lt;db>__ prefix.</p><p>E Keyevent events, published with __keyevent@&lt;db>__ prefix.</p><p>g Generic commands (non-type specific) like DEL, EXPIRE, RENAME, ...</p><p>$ String commands</p><p>l List commands</p><p>s Set commands</p><p>h Hash commands</p><p>z Sorted set commands</p><p>x Expired events (events generated every time a key expires)</p><p>e Evicted events (events generated when a key is evicted for maxmemory)</p><p>A Alias for g$lshzxe, so that the "AKE" string means all the events.</p><p>不同命令產生的事件(Events generated by different commands)</p><p>按照下面的清單，不同的命令產生不同類型的事件。 Redis Keyspace Notifications</p><ul><li>DEL 為每一個被刪除的鍵產生一個del事件。</li><li>RENAME 產生兩個事件，為源鍵產生一個rename_from事件，為目標鍵產生一個rename_to事件。</li><li>EXPIRE 當為鍵設置過期時產生一個expire事件，或者每當設置了過期的鍵被刪除時產生一個expired事件(查看EXPIRE文檔獲取更多信息)。</li><li>SORT 當STORE用於設置一個新鍵時產生一個sortstore事件。當結果列表為空，並且使用了STORE選項，並且已經有一個該名字的鍵存在，那麼這個件鍵被刪除，所以這種條件下或產生一個del事件。</li><li>SET及其所有變種(SETEX, SETNX,GETSET) 產生set事件。但是SETEX還會產生一個expire事件。</li><li>MSET 為每個鍵產生一個單獨的set事件。</li><li>SETRANGE 產生一個setrange事件。</li><li>INCR, DECR, INCRBY, DECRBY 都產生incrby事件。</li><li>INCRBYFLOAT 產生一個incrbyfloat事件。</li><li>APPEND 產生一個append事件。</li><li>LPUSH和LPUSHX 產生單個lpush事件，即使在可變情況下(even in the variadic case)。</li><li>RPUSH和RPUSHX 產生單個rpush事件，即使在可變情況下(even in the variadic case)。</li><li>RPOP 產生一個rpop事件。如果鍵由於最後一個元素被從列表中彈出而導致刪除，會又產生一個del事件。</li><li>LPOP 產生一個lpop事件。如果鍵由於最後一個元素被從列表中彈出而導致刪除，會又產生一個del事件。</li><li>LINSERT 產生一個linsert事件。</li><li>LSET 產生一個lset事件。</li><li>LREM 產生一個lrem事件。如果結果列表為空並且鍵被刪除，會又產生一個del事件。</li><li>LTRIM 產生一個ltrim事件。如果結果列表為空並且鍵被刪除，會又產生一個del事件。</li><li>RPOPLPUSH和BRPOPLPUSH 產生一個rpop事件和一個lpush事件。兩種情況下順序都能保證 (lpush事件總是在rpop事件之後被傳遞) 如果結果列表長度為零並且鍵被刪除，會又產生一個del事件。</li><li>HSET, HSETNX和HMSET 都產生單個hset事件。</li><li>HINCRBY 產生一個hincrby事件。</li><li>HINCRBYFLOAT 產生一個hincrbyfloat事件。</li><li>HDEL 產生單個hdel事件。如果結果哈希為空並且鍵被刪除，會又產生一個del事件。</li><li>SADD 產生單個sadd事件，即使在可變情況下(even in the variadic case)。</li><li>SREM 產生單個srem事件。如果結果集合為空並且鍵被刪除，會又產生一個del事件。</li><li>SMOVE 為源鍵產生一個srem事件為目標鍵產生一個sadd事件。</li><li>SPOP 產生一個spop事件。如果結果集合為空並且鍵被刪除，會又產生一個del事件。</li><li>SINTERSTORE, SUNIONSTORE, SDIFFSTORE 分別產生sinterstore，sunionostore，sdiffstore事件。在特殊情況下，集合為空，且存儲結果的鍵已經存在，由於鍵被刪除，會產生一個del事件。</li><li>ZINCR 產生一個zincr事件。</li><li>ZADD產生單個zadd事件，即使添加了多個元素。.</li><li>ZREM 產生單個zrem事件，即使刪除了多個元素。當結果有序集合為空，並且鍵被生成時，會產生一個額外的del事件。</li><li>ZREMBYSCORE 產生單個zrembyscore事件。當結果有序集合為空，並且鍵被生成時，會產生一個額外的del事件。</li><li>ZREMBYRANK 產生單個zrembyrank事件。當結果有序集合為空，並且鍵被生成時，會產生一個額外的del事件。</li><li>ZINTERSTORE和ZUNIONSTORE 分別產生zinterstore和zunionstore事件。在特殊情況下，集合為空，且存儲結果的鍵已經存在，由於鍵被刪除，會產生一個del事件。</li><li>每當一個關聯有生存事件的鍵由於過期而被從數據集中刪除時會產生一個expired事件。</li><li>每當一個鍵由於maxmemory策略而從數據集中被淘汰以節省內存時會產生一個evicted事件。</li></ul><p>開啟遠程登錄連接</p><p>使用 netstat 來查看端口占用情況，6379為默認Redis端口。</p><p>netstat -nlt|grep 6379</p><ul><li>-t：指明顯示 TCP 端口</li><li>-u：指明顯示 UDP 端口</li><li>-l：僅顯示監聽套接字</li><li>-p：顯示進程標識符和程序名稱，每一個套接字/端口都屬於一個程序。</li><li>-n：不進行 DNS 輪詢，顯示 IP （可以加速操作）</li></ul><p>修改防火牆配置</p><p>修改防火牆配置 sudo vi /etc/sysconfig/iptables</p><p>-A INPUT -m state --state NEW -m tcp -p tcp --dport 6379 -j ACCEPT</p><p>修改配置文件</p><p>Redis protected-mode 是3.2 之後加入的新特性，在Redis.conf的註釋中，我們可以瞭解到，他的具體作用和啟用條件。可以在 sudo vi /etc/redis.conf 中編輯，修改配置文件。</p><p># Protected mode is a layer of security protection, in order to avoid that</p><p># Redis instances left open on the internet are accessed and exploited.</p><p>#</p><p># When protected mode is on and if:</p><p>#</p><p># 1) The server is not binding explicitly to a set of addresses using the</p><p># "bind" directive.</p><p># 2) No password is configured.</p><p>#</p><p># The server only accepts connections from clients connecting from the</p><p># IPv4 and IPv6 loopback addresses 127.0.0.1 and ::1, and from Unix domain</p><p># sockets.</p><p>#</p><p># By default protected mode is enabled. You should disable it only if</p><p># you are sure you want clients from other hosts to connect to Redis</p><p># even if no authentication is configured, nor a specific set of interfaces</p><p># are explicitly listed using the "bind" directive.</p><p>protected-mode yes</p><p>它啟用的條件，有兩個：</p><ol><li>沒有bind IP</li><li>沒有設置訪問密碼</li></ol><p>如果啟用了，則只能夠通過lookback ip（127.0.0.1）訪問Redis cache，如果從外網訪問，則會返回相應的錯誤信息：</p><p>(error) DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the lookback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: 1) Just disable protected mode sending the command 'CONFIG SET protected-mode no' from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent. 2) Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to 'no', and then restarting the server. 3) If you started the server manually just for testing, restart it with the --portected-mode no option. 4) Setup a bind address or an authentication password. NOTE: You only need to do one of the above things in order for the server to start accepting connections from the outside.</p><p>提供的原生監控</p><p>當前鏈接的客戶端數和連接數</p><p>redis-cli --stat查看當前連接的客戶端數，連接數等</p><p>------- data ------ --------------------- load -------------------- - child -</p><p>keys mem clients blocked requests connections</p><p>4 1.27M 6 0 17340 (+0) 111</p><p>4 1.27M 6 0 17341 (+1) 111</p><p>4 1.27M 6 0 17342 (+1) 111</p><p>4 1.27M 6 0 17343 (+1) 111</p><p>內存最大的鍵值和平均的鍵值數據</p><p>redis-cli --bigkeys 對當前佔用內存最大的鍵值和平均的鍵值數據，也可以通過指定-i參數定時查看當前的視圖情況。</p><p># Scanning the entire keyspace to find biggest keys as well as</p><p># average sizes per key type. You can use -i 0.1 to sleep 0.1 sec</p><p># per 100 SCAN commands (not usually needed).</p><p>[00.00%] Biggest string found so far 'asdf.js' with 3 bytes</p><p>[00.00%] Biggest string found so far 'wabg-tokeneyJhbGciOiJIUzI1NiJ9.NA.UGGRiB2I42rP-33cIMrcoPub7AzHgDlqHacAKFw1pfE' with 328 bytes</p><p>[00.00%] Biggest string found so far 'wabg-token-province' with 231042 bytes</p><p>-------- summary -------</p><p>Sampled 4 keys in the keyspace!</p><p>Total key length in bytes is 180 (avg len 45.00)</p><p>Biggest string found 'wabg-token-province' has 231042 bytes</p><p>4 strings with 231819 bytes (100.00% of keys, avg size 57954.75)</p><p>0 lists with 0 items (00.00% of keys, avg size 0.00)</p><p>0 sets with 0 members (00.00% of keys, avg size 0.00)</p><p>0 hashs with 0 fields (00.00% of keys, avg size 0.00)</p><p>0 zsets with 0 members (00.00% of keys, avg size 0.00)</p><p>查看當前的鍵值情況</p><p>redis-cli --scan提供和keys *相似的功能，查看當前的鍵值情況，可以通過正則表達</p><p>$ redis-cli --scan</p><p>sess:K4xh-bxOBrcXpy9kEW87oiy-u7I2sAA5</p><p>asdf.js</p><p>sess:1tGNZSXW8GyoEQsbtpqkA5tMmSFp_ZIn</p><p>wabg-tokeneyJhbGciOiJIUzI1NiJ9.NA.UGGRiB2I42rP-33cIMrcoPub7AzHgDlqHacAKFw1pfE</p><p>sess:3e4NGIJd0wf1-RONeTt-FsXQj4EaVNjk</p><p>wabg-token-province</p><p>sess:UuCLAX2sWZ50fiIO1qvDgulf0XIZRd98</p><p>wabg-tokeneyJhbGciOiJIUzI1NiJ9.MQ.6z44GClzAsUED1M_UyxqdREdDKcYFnL9tSqd5ZhLhsY</p><p>sess:2HEchaRLYUoaa44IF1bB6mpik7lZjBb4</p><p>原生的Monitor監控</p><p>redis-cli monitor打印出所有sever接收到的命令以及其對應的客戶端地址</p><p>$ redis-cli monitor</p><p>OK</p><p>1472626566.218175 [0 127.0.0.1:62862] "info"</p><p>1472626571.220948 [0 127.0.0.1:62862] "exists" "aaa"</p><p>1472626571.223174 [0 127.0.0.1:62862] "set" "aaa" ""</p><p>1472626571.232126 [0 127.0.0.1:62862] "type" "aaa"</p><p>1472626571.243697 [0 127.0.0.1:62862] "pttl" "aaa"</p><p>1472626571.243717 [0 127.0.0.1:62862] "object" "ENCODING" "aaa"</p><p>1472626571.243726 [0 127.0.0.1:62862] "strlen" "aaa"</p><p>配置說明</p><p>#redis.conf</p><p># Redis configuration file example.</p><p># ./redis-server /path/to/redis.conf</p><p>################################## INCLUDES ###################################</p><p>#這在你有標準配置模板但是每個redis服務器又需要個性設置的時候很有用。</p><p># include /path/to/local.conf</p><p># include /path/to/other.conf</p><p>################################ GENERAL #####################################</p><p># 是否在後臺執行，yes：後臺運行；no：不是後臺運行（老版本默認）</p><p>daemonize yes</p><p># 3.2裡的參數，是否開啟保護模式，默認開啟。要是配置裡沒有指定bind和密碼。</p><p># 開啟該參數後，redis只會本地進行訪問，拒絕外部訪問。</p><p># 要是開啟了密碼 和bind，可以開啟。否 則最好關閉，設置為no。</p><p>protected-mode yes</p><p># redis的進程文件</p><p>pidfile /var/run/redis/redis-server.pid</p><p># redis監聽的端口號。</p><p>port 6379</p><p># 此參數確定了TCP連接中已完成隊列(完成三次握手之後)的長度，</p><p># 當然此值必須不大於Linux系統定義的/proc/sys/net/core/somaxconn值，默認是511，</p><p># 而Linux的默認參數值是128。當系統併發量大並且客戶端速度緩慢的時候，</p><p># 可以將這二個參數一起參考設定。該內核參數默認值一般是128，對於負載很大的服務程序來說大大的不夠。</p><p># 一般會將它修改為2048或者更大。在/etc/sysctl.conf中添加:net.core.somaxconn = 2048，然後在終端中執行sysctl -p。</p><p>tcp-backlog 511</p><p>#指定 redis 只接收來自於該 IP 地址的請求，如果不進行設置，那麼將處理所有請求</p><p>bind 127.0.0.1</p><p># 配置unix socket來讓redis支持監聽本地連接。</p><p># unixsocket /var/run/redis/redis.sock</p><p># 配置unix socket使用文件的權限</p><p># unixsocketperm 700</p><p># 此參數為設置客戶端空閒超過timeout，服務端會斷開連接，為0則服務端不會主動斷開連接，不能小於0。</p><p>timeout 0</p><p># tcp keepalive參數。如果設置不為0，就使用配置tcp的SO_KEEPALIVE值，</p><p># 使用keepalive有兩個好處:檢測掛掉的對端。降低中間設備出問題而導致網絡看似連接卻已經與對端端口的問題。</p><p># 在Linux內核中，設置了keepalive，redis會定時給對端發送ack。檢測到對端關閉需要兩倍的設置值。</p><p>tcp-keepalive 0</p><p># 指定了服務端日誌的級別。級別包括：debug（很多信息，方便開發、測試），</p><p># verbose（許多有用的信息，但是沒有debug級別信息多），notice（適當的日誌級別，適合生產環境），warn（只有非常重要的信息）</p><p>loglevel notice</p><p>#指定了記錄日誌的文件。空字符串的話，日誌會打印到標準輸出設備。後臺運行的redis標準輸出是/dev/null。</p><p>logfile /var/log/redis/redis-server.log</p><p># 是否打開記錄syslog功能</p><p># syslog-enabled no</p><p># syslog的標識符。</p><p># syslog-ident redis</p><p># 日誌的來源、設備</p><p># syslog-facility local0</p><p># 數據庫的數量，默認使用的數據庫是DB 0。可以通過”SELECT “命令選擇一個db</p><p>databases 16</p><p>################################ SNAPSHOTTING ################################</p><p># 快照配置</p><p># 註釋掉“save”這一行配置項就可以讓保存數據庫功能失效</p><p># 設置sedis進行數據庫鏡像的頻率。</p><p># 900秒（15分鐘）內至少1個key值改變（則進行數據庫保存--持久化）</p><p># 300秒（5分鐘）內至少10個key值改變（則進行數據庫保存--持久化）</p><p># 60秒（1分鐘）內至少10000個key值改變（則進行數據庫保存--持久化）</p><p>save 900 1</p><p>save 300 10</p><p>save 60 10000</p><p># 當RDB持久化出現錯誤後，是否依然進行繼續進行工作，yes：不能進行工作，no：可以繼續進行工作，</p><p># 可以通過info中的rdb_last_bgsave_status瞭解RDB持久化是否有錯誤</p><p>stop-writes-on-bgsave-error yes</p><p># 使用壓縮rdb文件，rdb文件壓縮使用LZF壓縮算法，yes：壓縮，但是需要一些cpu的消耗。no：不壓縮，需要更多的磁盤空間</p><p>rdbcompression yes</p><p># 是否校驗rdb文件。從rdb格式的第五個版本開始，在rdb文件的末尾會帶上CRC64的校驗和。</p><p># 這跟有利於文件的容錯性，但是在保存rdb文件的時候，會有大概10%的性能損耗，所以如果你追求高性能，可以關閉該配置。</p><p>rdbchecksum yes</p><p># rdb文件的名稱</p><p>dbfilename dump.rdb</p><p># 數據目錄，數據庫的寫入會在這個目錄。rdb、aof文件也會寫在這個目錄</p><p>dir /var/lib/redis</p><p>################################# REPLICATION #################################</p><p># 複製選項，slave複製對應的master。</p><p># slaveof &lt;masterip> &lt;masterport></p><p>#如果master設置了requirepass，那麼slave要連上master，需要有master的密碼才行。masterauth就是用來配置master的密碼，這樣可以在連上master後進行認證。</p><p># masterauth &lt;master-password></p><p>#當從庫同主機失去連接或者複製正在進行，從機庫有兩種運行方式：1) 如果slave-serve-stale-data設置為yes(默認設置)，從庫會繼續響應客戶端的請求。2) 如果slave-serve-stale-data設置為no，除去INFO和SLAVOF命令之外的任何請求都會返回一個錯誤”SYNC with master in progress”。</p><p>slave-serve-stale-data yes</p><p>#作為從服務器，默認情況下是隻讀的（yes），可以修改成NO，用於寫（不建議）。</p><p>slave-read-only yes</p><p>#是否使用socket方式複製數據。目前redis複製提供兩種方式，disk和socket。如果新的slave連上來或者重連的slave無法部分同步，就會執行全量同步，master會生成rdb文件。有2種方式：disk方式是master創建一個新的進程把rdb文件保存到磁盤，再把磁盤上的rdb文件傳遞給slave。socket是master創建一個新的進程，直接把rdb文件以socket的方式發給slave。disk方式的時候，當一個rdb保存的過程中，多個slave都能共享這個rdb文件。socket的方式就的一個個slave順序複製。在磁盤速度緩慢，網速快的情況下推薦用socket方式。</p><p>repl-diskless-sync no</p><p>#diskless複製的延遲時間，防止設置為0。一旦複製開始，節點不會再接收新slave的複製請求直到下一個rdb傳輸。所以最好等待一段時間，等更多的slave連上來。</p><p>repl-diskless-sync-delay 5</p><p>#slave根據指定的時間間隔向服務器發送ping請求。時間間隔可以通過 repl_ping_slave_period 來設置，默認10秒。</p><p># repl-ping-slave-period 10</p><p>#複製連接超時時間。master和slave都有超時時間的設置。master檢測到slave上次發送的時間超過repl-timeout，即認為slave離線，清除該slave信息。slave檢測到上次和master交互的時間超過repl-timeout，則認為master離線。需要注意的是repl-timeout需要設置一個比repl-ping-slave-period更大的值，不然會經常檢測到超時。</p><p># repl-timeout 60</p><p>#是否禁止複製tcp鏈接的tcp nodelay參數，可傳遞yes或者no。默認是no，即使用tcp nodelay。如果master設置了yes來禁止tcp nodelay設置，在把數據複製給slave的時候，會減少包的數量和更小的網絡帶寬。但是這也可能帶來數據的延遲。默認我們推薦更小的延遲，但是在數據量傳輸很大的場景下，建議選擇yes。</p><p>repl-disable-tcp-nodelay no</p><p>#複製緩衝區大小，這是一個環形複製緩衝區，用來保存最新複製的命令。這樣在slave離線的時候，不需要完全複製master的數據，如果可以執行部分同步，只需要把緩衝區的部分數據複製給slave，就能恢復正常複製狀態。緩衝區的大小越大，slave離線的時間可以更長，複製緩衝區只有在有slave連接的時候才分配內存。沒有slave的一段時間，內存會被釋放出來，默認1m。</p><p># repl-backlog-size 5mb</p><p>#master沒有slave一段時間會釋放複製緩衝區的內存，repl-backlog-ttl用來設置該時間長度。單位為秒。</p><p># repl-backlog-ttl 3600</p><p>#當master不可用，Sentinel會根據slave的優先級選舉一個master。最低的優先級的slave，當選master。而配置成0，永遠不會被選舉。</p><p>slave-priority 100</p><p>#redis提供了可以讓master停止寫入的方式，如果配置了min-slaves-to-write，健康的slave的個數小於N，mater就禁止寫入。master最少得有多少個健康的slave存活才能執行寫命令。這個配置雖然不能保證N個slave都一定能接收到master的寫操作，但是能避免沒有足夠健康的slave的時候，master不能寫入來避免數據丟失。設置為0是關閉該功能。</p><p># min-slaves-to-write 3</p><p>#延遲小於min-slaves-max-lag秒的slave才認為是健康的slave。</p><p># min-slaves-max-lag 10</p><p># 設置1或另一個設置為0禁用這個特性。</p><p># Setting one or the other to 0 disables the feature.</p><p># By default min-slaves-to-write is set to 0 (feature disabled) and</p><p># min-slaves-max-lag is set to 10.</p><p>################################## SECURITY ###################################</p><p>#requirepass配置可以讓用戶使用AUTH命令來認證密碼，才能使用其他命令。這讓redis可以使用在不受信任的網絡中。為了保持向後的兼容性，可以註釋該命令，因為大部分用戶也不需要認證。使用requirepass的時候需要注意，因為redis太快了，每秒可以認證15w次密碼，簡單的密碼很容易被攻破，所以最好使用一個更復雜的密碼。</p><p># requirepass foobared</p><p>#把危險的命令給修改成其他名稱。比如CONFIG命令可以重命名為一個很難被猜到的命令，這樣用戶不能使用，而內部工具還能接著使用。</p><p># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</p><p>#設置成一個空的值，可以禁止一個命令</p><p># rename-command CONFIG ""</p><p>################################### LIMITS ####################################</p><p># 設置能連上redis的最大客戶端連接數量。默認是10000個客戶端連接。</p><p># 由於redis不區分連接是客戶端連接還是內部打開文件或者和slave連接等，所以maxclients最小建議設置到32。</p><p># 如果超過了maxclients，redis會給新的連接發送’max number of clients reached’，並關閉連接。</p><p># maxclients 10000</p><p># redis配置的最大內存容量。當內存滿了，需要配合maxmemory-policy策略進行處理。</p><p># 注意slave的輸出緩衝區是不計算在maxmemory內的。所以為了防止主機內存使用完，建議設置的maxmemory需要更小一些。</p><p># maxmemory &lt;bytes></p><p># 內存容量超過maxmemory後的處理策略。</p><p># volatile-lru：利用LRU算法移除設置過過期時間的key。</p><p># volatile-random：隨機移除設置過過期時間的key。</p><p># volatile-ttl：移除即將過期的key，根據最近過期時間來刪除（輔以TTL）</p><p># allkeys-lru：利用LRU算法移除任何key。</p><p># allkeys-random：隨機移除任何key。</p><p># noeviction：不移除任何key，只是返回一個寫錯誤。</p><p># 上面的這些驅逐策略，如果redis沒有合適的key驅逐，對於寫命令，還是會返回錯誤。</p><p># redis將不再接收寫請求，只接收get請求。</p><p># 寫命令包括：set setnx setex append incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby getset mset msetnx exec sort。</p><p># maxmemory-policy noeviction</p><p>#lru檢測的樣本數。使用lru或者ttl淘汰算法，從需要淘汰的列表中隨機選擇sample個key，選出閒置時間最長的key移除。</p><p># maxmemory-samples 5</p><p>############################## APPEND ONLY MODE ###############################</p><p>#默認redis使用的是rdb方式持久化，這種方式在許多應用中已經足夠用了。但是redis如果中途宕機，會導致可能有幾分鐘的數據丟失，根據save來策略進行持久化，Append Only File是另一種持久化方式，可以提供更好的持久化特性。Redis會把每次寫入的數據在接收後都寫入 appendonly.aof 文件，每次啟動時Redis都會先把這個文件的數據讀入內存裡，先忽略RDB文件。</p><p>appendonly no</p><p>#aof文件名</p><p>appendfilename "appendonly.aof"</p><p># aof持久化策略的配置</p><p># no表示不執行fsync，由操作系統保證數據同步到磁盤，速度最快。</p><p># always表示每次寫入都執行fsync，以保證數據同步到磁盤。</p><p># everysec表示每秒執行一次fsync，可能會導致丟失這1s數據。</p><p>appendfsync everysec</p><p># 在aof重寫或者寫入rdb文件的時候，會執行大量IO，</p><p># 此時對於everysec和always的aof模式來說，執行fsync會造成阻塞過長時間，</p><p># no-appendfsync-on-rewrite字段設置為默認設置為no。</p><p># 如果對延遲要求很高的應用，這個字段可以設置為yes，否則還是設置為no，</p><p># 這樣對持久化特性來說這是更安全的選擇。設置為yes表示rewrite期間對新寫操作不fsync,</p><p># 暫時存在內存中,等rewrite完成後再寫入，默認為no，建議yes。Linux的默認fsync策略是30秒。可能丟失30秒數據。</p><p>no-appendfsync-on-rewrite no</p><p># aof自動重寫配置。當目前aof文件大小超過上一次重寫的aof文件大小的百分之多少進行重寫，</p><p># 即當aof文件增長到一定大小的時候Redis能夠調用bgrewriteaof對日誌文件進行重寫。</p><p># 當前AOF文件大小是上次日誌重寫得到AOF文件大小的二倍（設置為100）時，自動啟動新的日誌重寫過程。</p><p>auto-aof-rewrite-percentage 100</p><p>#設置允許重寫的最小aof文件大小，避免了達到約定百分比但尺寸仍然很小的情況還要重寫</p><p>auto-aof-rewrite-min-size 64mb</p><p># aof文件可能在尾部是不完整的，當redis啟動的時候，aof文件的數據被載入內存。</p><p># 重啟可能發生在redis所在的主機操作系統宕機後，</p><p># 尤其在ext4文件系統沒有加上data=ordered選項（redis宕機或者異常終止不會造成尾部不完整現象。）</p><p># 出現這種現象，可以選擇讓redis退出，或者導入儘可能多的數據。如果選擇的是yes，</p><p># 當截斷的aof文件被導入的時候，會自動發佈一個log給客戶端然後load。如果是no，用戶必須手動redis-check-aof修復AOF文件才可以。</p><p>aof-load-truncated yes</p><p>################################ LUA SCRIPTING ###############################</p><p># 如果達到最大時間限制（毫秒），redis會記個log，然後返回error。</p><p># 當一個腳本超過了最大時限。</p><p># 只有SCRIPT KILL和SHUTDOWN NOSAVE可以用。</p><p># 第一個可以殺沒有調write命令的東西。要是已經調用了write，只能用第二個命令殺。</p><p>lua-time-limit 5000</p><p>################################ REDIS CLUSTER ###############################</p><p># 集群開關，默認是不開啟集群模式。</p><p># cluster-enabled yes</p><p># 集群配置文件的名稱，每個節點都有一個集群相關的配置文件，持久化保存集群的信息。</p><p># 這個文件並不需要手動配置，這個配置文件有Redis生成並更新，每個Redis集群節點需要一個單獨的配置文件，</p><p># 請確保與實例運行的系統中配置文件名稱不衝突</p><p># cluster-config-file nodes-6379.conf</p><p># 節點互連超時的閥值。集群節點超時毫秒數</p><p># cluster-node-timeout 15000</p><p># 在進行故障轉移的時候，全部slave都會請求申請為master，但是有些slave可能與master斷開連接一段時間了，</p><p># 導致數據過於陳舊，這樣的slave不應該被提升為master。該參數就是用來判斷slave節點與master斷線的時間是否過長。判斷方法是：</p><p># 比較slave斷開連接的時間和(node-timeout * slave-validity-factor) + repl-ping-slave-period</p><p># 如果節點超時時間為三十秒, 並且slave-validity-factor為10,假設默認的repl-ping-slave-period是10秒，</p><p># 即如果超過310秒slave將不會嘗試進行故障轉移</p><p># cluster-slave-validity-factor 10</p><p># master的slave數量大於該值，slave才能遷移到其他孤立master上，</p><p># 如這個參數若被設為2，那麼只有當一個主節點擁有2 個可工作的從節點時，它的一個從節點會嘗試遷移。</p><p># cluster-migration-barrier 1</p><p># 默認情況下，集群全部的slot有節點負責，集群狀態才為ok，才能提供服務。</p><p># 設置為no，可以在slot沒有全部分配的時候提供服務。</p><p># 不建議打開該配置，這樣會造成分區的時候，小分區的master一直在接受寫請求，而造成很長時間數據不一致。</p><p># cluster-require-full-coverage yes</p><p>################################## SLOW LOG ###################################</p><p>###slog log是用來記錄redis運行中執行比較慢的命令耗時。當命令的執行超過了指定時間，就記錄在slow log中，slog log保存在內存中，所以沒有IO操作。</p><p>#執行時間比slowlog-log-slower-than大的請求記錄到slowlog裡面，單位是微秒，所以1000000就是1秒。注意，負數時間會禁用慢查詢日誌，而0則會強制記錄所有命令。</p><p>slowlog-log-slower-than 10000</p><p>#慢查詢日誌長度。當一個新的命令被寫進日誌的時候，最老的那個記錄會被刪掉。這個長度沒有限制。只要有足夠的內存就行。你可以通過 SLOWLOG RESET 來釋放內存。</p><p>slowlog-max-len 128</p><p>################################ LATENCY MONITOR ##############################</p><p>#延遲監控功能是用來監控redis中執行比較緩慢的一些操作，用LATENCY打印redis實例在跑命令時的耗時圖表。只記錄大於等於下邊設置的值的操作。0的話，就是關閉監視。默認延遲監控功能是關閉的，如果你需要打開，也可以通過CONFIG SET命令動態設置。</p><p>latency-monitor-threshold 0</p><p>############################# EVENT NOTIFICATION ##############################</p><p>#鍵空間通知使得客戶端可以通過訂閱頻道或模式，來接收那些以某種方式改動了 Redis 數據集的事件。因為開啟鍵空間通知功能需要消耗一些 CPU ，所以在默認配置下，該功能處於關閉狀態。</p><p>#notify-keyspace-events 的參數可以是以下字符的任意組合，它指定了服務器該發送哪些類型的通知：</p><p>##K 鍵空間通知，所有通知以 __keyspace@__ 為前綴</p><p>##E 鍵事件通知，所有通知以 __keyevent@__ 為前綴</p><p>##g DEL 、 EXPIRE 、 RENAME 等類型無關的通用命令的通知</p><p>##$ 字符串命令的通知</p><p>##l 列表命令的通知</p><p>##s 集合命令的通知</p><p>##h 哈希命令的通知</p><p>##z 有序集合命令的通知</p><p>##x 過期事件：每當有過期鍵被刪除時發送</p><p>##e 驅逐(evict)事件：每當有鍵因為 maxmemory 政策而被刪除時發送</p><p>##A 參數 g$lshzxe 的別名</p><p>#輸入的參數中至少要有一個 K 或者 E，否則的話，不管其餘的參數是什麼，都不會有任何 通知被分發。詳細使用可以參考http://redis.io/topics/notifications</p><p>notify-keyspace-events "KEA"</p><p>############################### ADVANCED CONFIG ###############################</p><p># 數據量小於等於hash-max-ziplist-entries的用ziplist，大於hash-max-ziplist-entries用hash</p><p>hash-max-ziplist-entries 512</p><p># value大小小於等於hash-max-ziplist-value的用ziplist，大於hash-max-ziplist-value用hash。</p><p>hash-max-ziplist-value 64</p><p># 數據量小於等於list-max-ziplist-entries用ziplist，大於list-max-ziplist-entries用list。</p><p>list-max-ziplist-entries 512</p><p># value大小小於等於list-max-ziplist-value的用ziplist，大於list-max-ziplist-value用list。</p><p>list-max-ziplist-value 64</p><p># 數據量小於等於set-max-intset-entries用iniset，大於set-max-intset-entries用set。</p><p>set-max-intset-entries 512</p><p># 數據量小於等於zset-max-ziplist-entries用ziplist，大於zset-max-ziplist-entries用zset。</p><p>zset-max-ziplist-entries 128</p><p># value大小小於等於zset-max-ziplist-value用ziplist，大於zset-max-ziplist-value用zset。</p><p>zset-max-ziplist-value 64</p><p># value大小小於等於hll-sparse-max-bytes使用稀疏數據結構（sparse），</p><p># 大於hll-sparse-max-bytes使用稠密的數據結構（dense）。</p><p># 一個比16000大的value是幾乎沒用的，建議的value大概為3000。</p><p># 如果對CPU要求不高，對空間要求較高的，建議設置到10000左右。</p><p>hll-sparse-max-bytes 3000</p><p># Redis將在每100毫秒時使用1毫秒的CPU時間來對redis的hash表進行重新hash，可以降低內存的使用。</p><p># 當你的使用場景中，有非常嚴格的實時性需要，不能夠接受Redis時不時的對請求有2毫秒的延遲的話，把這項配置為no。</p><p># 如果沒有這麼嚴格的實時性要求，可以設置為yes，以便能夠儘可能快的釋放內存。</p><p>activerehashing yes</p><p># 對客戶端輸出緩衝進行限制可以強迫那些不從服務器讀取數據的客戶端斷開連接，用來強制關閉傳輸緩慢的客戶端。</p><p># 對於normal client，第一個0表示取消hard limit，第二個0和第三個0表示取消soft limit，normal client默認取消限制，因為如果沒有尋問，他們是不會接收數據的。</p><p>client-output-buffer-limit normal 0 0 0</p><p># 對於slave client和MONITER client，如果client-output-buffer一旦超過256mb，又或者超過64mb持續60秒，那麼服務器就會立即斷開客戶端連接。</p><p>client-output-buffer-limit slave 256mb 64mb 60</p><p># 對於pubsub client，如果client-output-buffer一旦超過32mb，又或者超過8mb持續60秒，那麼服務器就會立即斷開客戶端連接。</p><p>client-output-buffer-limit pubsub 32mb 8mb 60</p><p># redis執行任務的頻率為1s除以hz。</p><p>hz 10</p><p># 在aof重寫的時候，如果打開了aof-rewrite-incremental-fsync開關，系統會每32MB執行一次fsync。這對於把文件寫入磁盤是有幫助的，可以避免過大的延遲峰值。</p><p>aof-rewrite-incremental-fsync yes</p><p>10分鐘後進階參考：</p><p><a class=pgc-link href="https://www.toutiao.com/i6607303031492968973/?group_id=6607303031492968973" target=_blank>Redis基礎開發環境搭建</a>；</p><p><a class=pgc-link href="https://www.toutiao.com/i6675301040037822983/?group_id=6675301040037822983" target=_blank>快速認識Redis數據庫</a>；</p><p><a class=pgc-link href="https://www.toutiao.com/i6673093598772199948/?group_id=6673093598772199948" target=_blank>基本搞定Redis數據庫</a>；</p><p><a class=pgc-link href="https://www.toutiao.com/i6691590455001350664/?group_id=6691590455001350664" target=_blank>Redis高可用原理圖解</a>；</p><p><a class=pgc-link href="https://www.toutiao.com/i6653672634510737934/?group_id=6653672634510737934" target=_blank>理解Redis主從同步</a>；</p><p><a class=pgc-link href="https://www.toutiao.com/i6606571678430396936/?group_id=6606571678430396936" target=_blank>高可用Redis解決方案</a>；</p><p><a class=pgc-link href="https://www.toutiao.com/i6769566504800223748/?group_id=6769566504800223748" target=_blank>Redis從入門到精通</a>；</p><p><a class=pgc-link href="https://www.toutiao.com/i6771709610605675012/?group_id=6771709610605675012" target=_blank>Redis 常見試題</a>；以及 <a class=pgc-link href="https://www.toutiao.com/i6609636411266040324/?group_id=6609636411266040324" target=_blank>50道助學題 </a>；</p><p><a class=pgc-link href="https://www.toutiao.com/i6701593489529897480/?group_id=6701593489529897480" target=_blank>Memcache與Redis原理對比</a>。</p><p><a class=pgc-link href="https://www.toutiao.com/i6607997901614350851/?group_id=6607997901614350851" target=_blank>Redis與Java整合案例實戰</a>。</p><p>基本上你需要的NoSQL數據庫Redis這裡基本都有了，花點時間掌握一下吧。</p><p>最後，你<strong>就收個藏、點點贊、轉發分享</strong>順手搞定吧 ^_^</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>文末</a></li><li><a>綜合</a></li><li><a>入門</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/745227e1.html alt=綜合佈線與弱電工程：跳線、尾纖、光纖接口，一文講明白 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/70370b3c8fc348e2ab70ef1e28a16c77 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/745227e1.html title=綜合佈線與弱電工程：跳線、尾纖、光纖接口，一文講明白>綜合佈線與弱電工程：跳線、尾纖、光纖接口，一文講明白</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6fe27eab.html alt="前端 | HTML入門基礎知識-網頁" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e7a0b61194f445b8b9e5ae330961d2ea style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6fe27eab.html title="前端 | HTML入門基礎知識-網頁">前端 | HTML入門基礎知識-網頁</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1d2be915.html alt=寧夏、內蒙古自治區黃河的綜合治理措施 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/217d033a478c468f928df0367a082186 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1d2be915.html title=寧夏、內蒙古自治區黃河的綜合治理措施>寧夏、內蒙古自治區黃河的綜合治理措施</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/19664ba8.html alt=EXCEL入門基礎：對行和列選定數據求和 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1f03f82096d240dd92410709f3e19eb9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/19664ba8.html title=EXCEL入門基礎：對行和列選定數據求和>EXCEL入門基礎：對行和列選定數據求和</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5abb53a8.html alt=工程造價從入門到精通：造價員全能圖解+工程算量表，限時分享！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/49834ccb43ed42cb9a54c9827c3ab134 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5abb53a8.html title=工程造價從入門到精通：造價員全能圖解+工程算量表，限時分享！>工程造價從入門到精通：造價員全能圖解+工程算量表，限時分享！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1a5f8d5f.html alt=工程造價：入門知識全套講義，30章600頁，精通造價首選之作 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9e1b335c343a455f8777dd3144fc1c35 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1a5f8d5f.html title=工程造價：入門知識全套講義，30章600頁，精通造價首選之作>工程造價：入門知識全套講義，30章600頁，精通造價首選之作</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2d4007c7.html alt=“黑客”入門學習之“Windows組策略” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ea21244d5f5c420ebef29650f3fafd1c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2d4007c7.html title=“黑客”入門學習之“Windows組策略”>“黑客”入門學習之“Windows組策略”</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/162efaea.html alt=詳解綜合佈線中屏蔽線纜有何作用！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1535790948669d855fe1265 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/162efaea.html title=詳解綜合佈線中屏蔽線纜有何作用！>詳解綜合佈線中屏蔽線纜有何作用！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9d08c7e6.html alt=PHP入門教程，5天86節課助力小白變大神！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/4366000004d4c98fd587 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9d08c7e6.html title=PHP入門教程，5天86節課助力小白變大神！>PHP入門教程，5天86節課助力小白變大神！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/923fd40e.html alt=Thinkphp6快速入門一 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/c4331ddc0ffb4c94a4aa80be95178354 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/923fd40e.html title=Thinkphp6快速入門一>Thinkphp6快速入門一</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3d2ce3d6.html alt="php新手入門教程， 最全最完整的教學視頻課程" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/666a38216ab04790a716bb1451c7fe44 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3d2ce3d6.html title="php新手入門教程， 最全最完整的教學視頻課程">php新手入門教程， 最全最完整的教學視頻課程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/07454552.html alt=「素描入門」基礎不紮實，從排線練起 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15252166717297d7af296ee style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/07454552.html title=「素描入門」基礎不紮實，從排線練起>「素描入門」基礎不紮實，從排線練起</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/07c706e2.html alt=「素描入門」素描排線的繪畫技法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1530098801296ab58189790 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/07c706e2.html title=「素描入門」素描排線的繪畫技法>「素描入門」素描排線的繪畫技法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a993b442.html alt=素描入門丨你說線條或者排線，容易嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1536648317995f32cedaa40 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a993b442.html title=素描入門丨你說線條或者排線，容易嗎？>素描入門丨你說線條或者排線，容易嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d0e2c5d2.html alt=零基礎入門要知道的素描知識總結 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/c2c16563-8821-4294-a8c6-9d76e62a2440 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d0e2c5d2.html title=零基礎入門要知道的素描知識總結>零基礎入門要知道的素描知識總結</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>