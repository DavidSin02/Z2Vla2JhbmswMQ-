<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>數據結構——30行代碼實現棧和模擬遞歸 | 极客快訊</title><meta property="og:title" content="數據結構——30行代碼實現棧和模擬遞歸 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/961953b4a9dc45259f9980c761d358a0"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/917161a.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/917161a.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/917161a.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/917161a.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/917161a.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/917161a.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/917161a.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/917161a.html><meta property="article:published_time" content="2020-10-29T21:05:30+08:00"><meta property="article:modified_time" content="2020-10-29T21:05:30+08:00"><meta name=Keywords content><meta name=description content="數據結構——30行代碼實現棧和模擬遞歸"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/917161a.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>數據結構——30行代碼實現棧和模擬遞歸</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>原本今天想給大家講講快速選擇算法的，但是發現一連寫了好幾篇排序相關了，所以臨時改了題目，今天聊點數據結構，來看看經典並且簡單的數據結構——棧。</p><p><br></p><p>棧這個結構我想大家應該都耳熟能詳，尤其是在很多地方將和堆並列在一起，稱作“堆棧”就更廣為人知了。但其實堆和棧本質上是兩種不同的數據結構，我們不能簡單地混為一談。讓我們先從比較簡單的棧開始。</p><p><br></p><p>棧和隊列的本質其實都是數組（嚴格地說是<strong>線性表</strong>）。只不過我們在數組上增加了一些限制，使得它滿足一定的條件而已，所以很多對數據結構畏首畏尾的同學可以放寬心，棧沒什麼特別的花樣，就是一種特殊的數組。</p><p><br></p><p>和其他廣義上的線性表數據結構比起來，棧的特殊性只有兩條，一條是<strong>先進後出</strong>，另一條是隻能從<strong>數組的一側讀寫</strong>。但本質上來說這兩條是一樣的，由於我們只能從一側讀寫元素，所以進的越早出的越晚，當然是先進後出。從下面這張圖應該很容易能看明白。</p><div class=pgc-img><img alt=數據結構——30行代碼實現棧和模擬遞歸 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/961953b4a9dc45259f9980c761d358a0><p class=pgc-img-caption></p></div><p>棧規定了我們只能從一側進行讀寫，常規上我們將能夠讀寫的一側稱作是棧頂。不能讀寫的另一側稱為是棧底。從上面的圖可以看到，只有棧頂的元素出棧了之後，才能訪問到棧底的元素。</p><p><br></p><p>我們用Python的數組來實現棧這個數據結構，去掉註釋真的只有30行不到，可以說是非常簡單，我們先來看代碼。</p><p><br></p><div class=pgc-img><img alt=數據結構——30行代碼實現棧和模擬遞歸 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/66c354e603314e718e9c8d86f8cec9ad><p class=pgc-img-caption></p></div><p><br></p><p>本質上來說，一般的棧實現只有以上這麼幾個方法，可能會更少。因為有些語言當中的棧，top和彈出是合併的。意味著訪問必須要彈出，不支持非彈出訪問。所以棧的實現邏輯是非常簡單的，甚至可以說是<strong>毫無技術含量</strong>，非常適合入門數據結構。</p><p><br></p><p>當然，從另一個方面也可以說棧的實現原理並不太重要，相比之下更重要的是棧一般會用在什麼地方。</p><p><br></p><h2 class=Editable-styled><strong>棧的應用</strong></h2><p><br></p><p>棧最廣泛的應用就是在操作系統當中，比如在程序執行調用方法的時候，在編譯器內部，其實是記錄了一個當前調用的<strong>方法棧</strong>。舉個例子，比如當前調用到的方法是A，如果在A方法中又去調用了方法B，那麼計算機就會在系統方法棧當中存儲一個指向B方法的指針，如果B方法又調用到了C方法，那麼又會新增一個C的指針。當C方法執行結束，那麼C就會彈出，計算機會將C的結果帶入B，繼續執行之前的B，以此類推，直到棧空為止。</p><p><br></p><p>那麼，問題來了，如果一個方法A<strong>自己調用自己</strong>會怎麼樣？</p><p><br></p><p>答案是計算機會創建一個新的A的指針填入棧中，如果A繼續遞歸，那麼系統再創建一個新的指針入棧……</p><p><br></p><p>從上面這個過程，我們可以確定兩個事情。第一，我們寫程序時候的遞歸，在編譯器內部其實是以<strong>棧的形式</strong>執行的。第二，如果我們用一個死循環去不停地遞歸，由於<strong>棧存在大小限制</strong>，所以當棧的深度超過限制的時候，就會出現SystemStackExceed的錯誤。也就是說遞歸並不是無限的，因為除了操作系統對於運行內存的限制之外，編譯器還會有最大遞歸深度的限制，防止遞歸中死循環導致系統崩潰。雖然各個語言實現機制不完全一樣，但是有一點是肯定的，遞歸深度是有限的，我們<strong>不能無限制遞歸</strong>。</p><p><br></p><p>那問題來了，如果我們系統就是會存在大規模的遞歸怎麼辦？難道還要手動給機器加內存嗎？</p><p><br></p><p>這是ACM玩家在賽場上經常遇到的問題之一，有經驗的選手在第一天的熱身賽時一定會做的事情除了配置vim或者其他IDE之外，就是會測試一下電腦的<strong>最大遞歸深度</strong>。在C++當中，是支持通過彙編語言強行打開遞歸深度限制的，但是即使如此也是有限的，並且據我所知只有C++可以這麼幹，對於其他語言，以及開大了遞歸深度還是不夠用的情況，就只有一種辦法，就是手動建棧模擬遞歸。</p><p><br></p><h2 class=Editable-styled><strong>手動遞歸</strong></h2><p><br></p><p>許多同學可能覺得遞歸痛苦，但是如果他們試著<strong>手動建棧來模擬遞歸</strong>的話，會發現要更加痛苦。不僅要額外增加變量存儲中間狀態，並且對於編程也是一個巨大的挑戰。</p><p><br></p><p>我們來看一個例子：</p><p><br></p><div class=pgc-img><img alt=數據結構——30行代碼實現棧和模擬遞歸 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/18c26558271f4b04ad90c87eca389f2a><p class=pgc-img-caption></p></div><p><br></p><p>這是一棵簡單的二叉樹，畫出來是這個樣子：</p><p><br></p><div class=pgc-img><img alt=數據結構——30行代碼實現棧和模擬遞歸 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7150042b6d8b48c4bba6d093db91dc0b><p class=pgc-img-caption></p></div><p><br></p><p>下面我們要通過棧在<strong>不使用遞歸的情況下來中序遍歷它</strong>，中序遍歷我們都知道，就是先遍歷左子樹，然後輸出當前節點，再遍歷右子樹。寫成遞歸非常方便，只有幾行：</p><p><br></p><div class=pgc-img><img alt=數據結構——30行代碼實現棧和模擬遞歸 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ca43ac0a534b4d96b5c51bbac89f24ac><p class=pgc-img-caption></p></div><p><br></p><p>大家想想，如果不使用遞歸應該怎麼辦？如果你真的試著去寫，就會發現看起來很簡單的問題好像變得非常複雜。我們很容易可以想到，我們把節點存儲在棧當中，但是存儲數據只是表象。本質問題是當我們從棧當中拿到了一個節點之後，我們<strong>怎麼判斷它究竟應該做什麼</strong>？應該遍歷左節點嗎，應該輸出嗎，還是應該遍歷右節點？</p><p><br></p><p>對這些問題仔細分析和思考，我們可以發現它們都和遞歸的<strong>回溯</strong>有關。</p><p><br></p><p>在遞歸當中，當我們遍歷完了當前節點的某棵子樹之後，隨著棧的彈出，還會回到這個節點。比如上面這棵樹當中，在遞歸過程當中，我們會兩次碰到1這個節點。第一次時它不會輸出1，而是先去遍歷了它的左子樹，也就是3，之後再次回到1，由於它的左子樹已經遍歷過，所以會輸出1。這個離開又回來的過程稱為<strong>回溯</strong>。如果你把樹結構想象成瀑布的話，這個過程有點像是先順流而下，又逆流而上返回，backtracking翻譯成回溯還是蠻合理的。</p><p><br></p><p>我們回到之前的問題，所有的搞不清楚的本質都來源於我們無法判斷當前遇到的節點究竟是初次見面，還是回溯之後的久別重逢。而這關係到我們要對它做什麼。原本在遞歸當中，由於程序會記錄遞歸時的狀態和代碼運行的位置，遞歸回溯之後會回到上次調用的位置，所以我們可以忽略這個問題。而現在我們由於不再使用遞歸，所以<strong>需要我們自己來判斷節點的狀態</strong>。</p><p><br></p><p>想通了其實很簡單，我們只需要在節點當中加一個狀態的字段，表示這個節點是否會發生回溯。顯然在一開始的時候，所有的節點狀態都是True。</p><p><br></p><div class=pgc-img><img alt=數據結構——30行代碼實現棧和模擬遞歸 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d5e2e43e2e69435c9342d9475553a59f><p class=pgc-img-caption></p></div><p><br></p><p>我們在Node類中加一個flag作為記錄，初始化時我們默認它為True。接著就很簡單了，我們就按照左中右的順序遍歷節點，只要左子樹存在<strong>且還沒有回溯過</strong>就往左邊遍歷，在一路往左的過程中遇到的這些節點的flag全部置為False，因為它們的回溯已經開始，以後不會再發生回溯了。由於<strong>往右遍歷不會存在回溯的問題</strong>，所以可以忽略，想明白了，代碼也就順理成章。</p><p><br></p><div class=pgc-img><img alt=數據結構——30行代碼實現棧和模擬遞歸 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d27ebb5de37d4aaca10684ce102e4fca><p class=pgc-img-caption></p></div><p><br></p><p>這段代碼雖然短，但其實不簡單，想要完全看懂需要對遞歸和循環有深入的理解。屬於典型的看著簡單實際不容易的題，我個人比較喜歡這類問題，除了鍛鍊思維之外也很適合用來面試，候選人的思維能力、代碼駕馭能力基本上都一清二楚了。沒有看懂的同學也不用擔心，因為在實際場景當中並不會遇到這樣的場景，以後還會推出其他關於遞歸和搜索算法的文章，只要你堅持閱讀，我相信一定會看懂的。</p><p><br></p><p>今天的文章就是這些，如果覺得有所收穫，請<strong>順手點個關注或轉發</strong>吧，你們的舉手之勞對我來說很重要。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>數據</a></li><li><a>結構</a></li><li><a>30</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/37396ded.html alt=數據結構系列：哈希表？這涉及的是“加密/區塊鏈”等技術的核心 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3609570de59a49a9be5667dd9a637f65 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/37396ded.html title=數據結構系列：哈希表？這涉及的是“加密/區塊鏈”等技術的核心>數據結構系列：哈希表？這涉及的是“加密/區塊鏈”等技術的核心</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0e2547f1.html alt=「數據結構」Hash表 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/617a6d43032e4efbac6b996c9bb5ab11 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0e2547f1.html title=「數據結構」Hash表>「數據結構」Hash表</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b37254e1.html alt=備戰秋招——算法與數據結構（5） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ab6859411bd8435bb2616d6fef468556 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b37254e1.html title=備戰秋招——算法與數據結構（5）>備戰秋招——算法與數據結構（5）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f605b4b8.html alt=懂了數據結構框架思維，一切算法不過是紙老虎 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ad2c8a60d9634e0aa36b5d8a664de355 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f605b4b8.html title=懂了數據結構框架思維，一切算法不過是紙老虎>懂了數據結構框架思維，一切算法不過是紙老虎</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e03941dc.html alt=數據結構一(哈希表)想進大廠的必備知識點 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/86ad7a2f62cc48f98bbe53b42ca4bf9a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e03941dc.html title=數據結構一(哈希表)想進大廠的必備知識點>數據結構一(哈希表)想進大廠的必備知識點</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/385a3c55.html alt="數據結構中的 Hash 表" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/0e43812c-6f05-4cf6-af7e-18011d0a316a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/385a3c55.html title="數據結構中的 Hash 表">數據結構中的 Hash 表</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/629e95d1.html alt=常用數據結構之二叉樹的特性以及適用場景總結 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d8521175c2eb416e97ccf5747b8a6033 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/629e95d1.html title=常用數據結構之二叉樹的特性以及適用場景總結>常用數據結構之二叉樹的特性以及適用場景總結</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/13fb0203.html alt=數據結構23｜二叉樹基礎上：什麼樣的二叉樹適合用數組來存儲？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c9a031d4534f4363963c1ad02aac937f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/13fb0203.html title=數據結構23｜二叉樹基礎上：什麼樣的二叉樹適合用數組來存儲？>數據結構23｜二叉樹基礎上：什麼樣的二叉樹適合用數組來存儲？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a85e2fa9.html alt=數據結構系列：面試常問的二叉樹的遍歷和基本應用，不進來看看嗎 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/02b77c3c1c434606997aa740529d8b17 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a85e2fa9.html title=數據結構系列：面試常問的二叉樹的遍歷和基本應用，不進來看看嗎>數據結構系列：面試常問的二叉樹的遍歷和基本應用，不進來看看嗎</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0f931f71.html alt=數據結構：二叉樹及存儲結構，學生時代的難點嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/0e88a207beca45d08824aaf262458b25 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0f931f71.html title=數據結構：二叉樹及存儲結構，學生時代的難點嗎？>數據結構：二叉樹及存儲結構，學生時代的難點嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f662790b.html alt=「算法與數據結構」二叉樹之美 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/73093d13178e4fa1a45d2babe9d1a54b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f662790b.html title=「算法與數據結構」二叉樹之美>「算法與數據結構」二叉樹之美</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b53da776.html alt=數據結構和算法之二叉樹 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/e887f7fd870a4d7ea59cbbfdc132450f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b53da776.html title=數據結構和算法之二叉樹>數據結構和算法之二叉樹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/059fc3b0.html alt=C語言：數據結構-歸併排序 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/539294f811964720923157c1a6eba72c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/059fc3b0.html title=C語言：數據結構-歸併排序>C語言：數據結構-歸併排序</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b67e3584.html alt=一文看懂編程中的基本數據結構與算法思想 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/44d2fdc7ecf6447a860128c60e5cfe5b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b67e3584.html title=一文看懂編程中的基本數據結構與算法思想>一文看懂編程中的基本數據結構與算法思想</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/48215327.html alt=數據結構與算法（7）遞歸 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/6548910d67bb4d6e82fb33f08f496622 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/48215327.html title=數據結構與算法（7）遞歸>數據結構與算法（7）遞歸</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>