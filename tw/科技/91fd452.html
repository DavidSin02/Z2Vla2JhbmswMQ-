<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>深入分析java中的多態（從jvm角度分析） | 极客快訊</title><meta property="og:title" content="深入分析java中的多態（從jvm角度分析） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/88d8d50aee8449879509252596216982"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91fd452.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91fd452.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/91fd452.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91fd452.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91fd452.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/91fd452.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/91fd452.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/91fd452.html><meta property="article:published_time" content="2020-10-29T20:58:49+08:00"><meta property="article:modified_time" content="2020-10-29T20:58:49+08:00"><meta name=Keywords content><meta name=description content="深入分析java中的多態（從jvm角度分析）"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/91fd452.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>深入分析java中的多態（從jvm角度分析）</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p class=ql-align-justify>對於java中多態概念的理解一直是面試常問的問題，所以今天花了一些時間好好地整理了一下，力求從java虛擬機的角度來分析和理解多態。</p><p class=ql-align-justify><strong>一、認識多態</strong></p><p class=ql-align-justify><strong>1、方法調用</strong></p><p class=ql-align-justify>在Java中，方法調用有兩類，動態方法調用與靜態方法調用。</p><p class=ql-align-justify>（1）靜態方法調用是指對於類的靜態方法的調用方式，是在編譯時刻就已經確定好具體調用方法的情況，是靜態綁定的。</p><p class=ql-align-justify>（2）動態方法調用需要有方法調用所作用的對象，是在調用的時候才確定具體的調用方法，是動態綁定的。</p><p class=ql-align-justify>我們這裡所講的多態就是後者—動態方法調用。</p><p class=ql-align-justify><strong>2、多態概念</strong></p><p class=ql-align-justify>多態有兩種：類內部之間的多態和類之間的多態。我們先看一下標準的概念：</p><blockquote><p>多態是面向對象編程語言的重要特性，它允許基類的指針或引用指向派生類的對象，而在具體訪問時實現方法的動態綁定</p></blockquote><p class=ql-align-justify>（1）Java的方法重載（類內部之間的多態）：就是在類中可以創建多個方法，它們具有相同的名字，但可具有不同的參數列表、返回值類型。我們舉個例子來解釋，就是一對夫婦生了多胞胎，多胞胎之間外觀相似，其實是不同的孩子。</p><p class=ql-align-justify>（2）Java的方法重寫（父類與子類之間的多態）：子類可繼承父類中的方法，但有時子類並不想原封不動地繼承父類的方法，而是想作一定的修改，這就需要採用方法的重寫。重寫的參數列表和返回類型均不可修改。我們再舉個例子，就是子承父業，但是兒子有自己想法，對父親得產業進行再投資的過程。</p><p class=ql-align-justify><strong>二、代碼實現多態</strong></p><p class=ql-align-justify><strong>1、類內部之間得多態：方法重載</strong></p><div class=pgc-img><img alt=深入分析java中的多態（從jvm角度分析） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/88d8d50aee8449879509252596216982><p class=pgc-img-caption></p></div><p class=ql-align-justify>從上述代碼我們可以看到，在類的內部可以有相同的方法名，但是有唯一的參數列表。當然返回類型和修飾符也可以不同。下面我們再看一下類之間的多態。</p><p class=ql-align-justify><strong>2、類之間的多態：方法重寫</strong></p><p class=ql-align-justify>類之間的多態其實是有兩種方式：繼承和接口。我們對這兩種方式一個一個說明。</p><p class=ql-align-justify><strong>（1）繼承方式實現多態</strong></p><p class=ql-align-justify>對於繼承方式我們使用一個例子來解釋，比如說父親可以對自己的房子有處理權，兒子繼承父業同樣也有處理權。</p><p class=ql-align-justify>第一步：定義父類</p><div class=pgc-img><img alt=深入分析java中的多態（從jvm角度分析） onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/6c6435c286aa438283f2bf978db8b787><p class=pgc-img-caption></p></div><p class=ql-align-justify>第二步：定義子類（大兒子和小兒子）</p><div class=pgc-img><img alt=深入分析java中的多態（從jvm角度分析） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/65c6f6b685bd48fcafd736c030f7a848><p class=pgc-img-caption></p></div><p class=ql-align-justify>第三步：測試</p><div class=pgc-img><img alt=深入分析java中的多態（從jvm角度分析） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d84e8029214e41049bca4e49d580f342><p class=pgc-img-caption></p></div><p class=ql-align-justify><strong>（2）接口方式實現多態</strong></p><p class=ql-align-justify>接口方式實現繼承方式其實跟上面一樣，只不過把父類變成了接口而已，其他內容只有微笑的變化，這裡就不演示了，在這裡只給出父接口的形式。</p><div class=pgc-img><img alt=深入分析java中的多態（從jvm角度分析） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f7c2d20862744fad8b70df8c5e6fd678><p class=pgc-img-caption></p></div><p class=ql-align-justify>到了這基本上就對多態形式的代碼實現進行了演示，案例也比較簡單，但是這對我們理解多態的思想還不夠，我們最主要的還是從虛擬機的角度來分析一下。</p><p class=ql-align-justify><strong>三、分析多態</strong></p><p class=ql-align-justify>想要深入分析多態，我們需要弄清楚幾個問題。</p><p class=ql-align-justify><strong>1、jvm內存</strong></p><p class=ql-align-justify>在上面的代碼中我們其實已經看到了，不管是類內部之間實現的多態，還是類之間實現的多態，這些方法的名字其實都是一樣的，那我們的程序在運行的時候，底層虛擬機是如何去區分的呢（java虛擬機實現動態調用）？為此我們還是先從java虛擬機講起。</p><p class=ql-align-justify>其實java虛擬機在執行java程序的時候，並不是直接運行的，他需要一個過程，我們使用一張圖來看下：</p><div class=pgc-img><img alt=深入分析java中的多態（從jvm角度分析） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/59d517b2a3a84bcfb0b98855c0fa5f29><p class=pgc-img-caption></p></div><p class=ql-align-justify>上面這張圖已經很清晰，也就是說，我們的java文件要想運行，需要通過java編譯器編譯成.class文件，然後通過類裝載器講.class文件裝載到JVM中，最後才是執行。而且JVM分了五個區域，那麼在代碼中定義的那些多態方法存到了哪個地方呢？為此我們還需要對這塊內存區域進行一個分析：</p><div class=pgc-img><img alt=深入分析java中的多態（從jvm角度分析） onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/587555de0f374f349d71f34caf211cf6><p class=pgc-img-caption></p></div><p class=ql-align-justify>我給出了一張java7的運行時數據區劃分圖，對於每一個區域的基本情況我相信你也能看明白。那麼我們的多態方法到底存在了哪呢？沒錯就是後一個方法區。java堆存的是就是我們建立的一個個實例對象，而方法區存的就是類的類型信息。</p><p class=ql-align-justify>而且這個方法區中的類型信息跟在堆中存放的class對象是不同的。在方法區中，這個class的類型信息只有唯一的實例（所以方法區是各個線程共享的內存區域），而在堆中可以有多個該class對象。也就是說方法區的類型信息就是像一個模板，那些class對象就好比通過這些模板創建的一個個實例。</p><p class=ql-align-justify><strong>2、通過例子來分析</strong></p><p class=ql-align-justify>現在我們拿上面的例子來說明一下多態在java虛擬機中是如何實現的。在測試類中有兩行代碼：</p><p class=ql-align-justify>Father sonA=new SonA();</p><p class=ql-align-justify>Father sonB=new SonB();</p><p class=ql-align-justify>當程序運行到Father sonA=new SonA()這裡就出現了多態，這是因為編譯時看到Father，但是運行時new出來一個SonA類，兩種類型還不一樣。那麼這些代碼在運行的時候在內存中是如何保存的呢？</p><p class=ql-align-justify>（1）Father sonA是一個引用類型，存在了java棧中的本地方法表中了。</p><p class=ql-align-justify>（2）new SonA其實創建了一個實例對象，存儲在了java堆中。</p><p class=ql-align-justify>（3）SonA的類型數據存在了方法區中</p><p class=ql-align-justify>我們在內存中看一下：</p><div class=pgc-img><img alt=深入分析java中的多態（從jvm角度分析） onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1cd2b1d2fca741b592e73cbae1601566><p class=pgc-img-caption></p></div><p class=ql-align-justify>reference中存儲的就是對象在堆中的實際地址，在堆中存儲的對象信息中包含了在方法區中的相應類型數據。流程很簡單，我們梳理一下：</p><p class=ql-align-justify>第一步：虛擬機通過reference（Father的引用）查詢java棧中的本地變量表，得到堆中的對象類型數據的指針，</p><p class=ql-align-justify>第二步：通過到對象的指針找到方法區中的對象類型數據</p><p class=ql-align-justify>第三步：查詢方法表定位到實際類（SonA類）的方法運行。</p><p class=ql-align-justify>好了，到第三步我們知道，其實是通過方法表來定位到實際運行的方法的。下面我們再來看看這個方法表是什麼。</p><p class=ql-align-justify><strong>3、方法表</strong></p><p class=ql-align-justify>方法表肯定是存在於方法區中的，它是實現多態的關鍵所在，這裡面保存的就是實例方法的引用，而且是直接引用。java虛擬機在執行程序的時候就是通過這個方法表來確定運行哪一個多態方法的。</p><p class=ql-align-justify>我們通過上面的例子，來演示一下父子類在方法表中是如何保存的：</p><div class=pgc-img><img alt=深入分析java中的多態（從jvm角度分析） onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/2b92abc7b3e94839ad02a102c98c7ee9><p class=pgc-img-caption></p></div><p class=ql-align-justify>很明顯每一個類都會有一個方法表，子類中不同的方法指向不同的類型信息。繼承自Object的就指向Object，繼承自Father的就指向Father（也就是包含了父類的方法dealHouse）。</p><p class=ql-align-justify>可能我們到這就迷糊了，既然子類的dealHouse方法其實是父類Father的，那麼為什麼會執行子類的dealHouse方法呢？彆著急往下看。這是<strong>java虛擬機區分多態方法（實現動態調用）的精華所在。</strong></p><p class=ql-align-justify>當Son類的方法表會有一個指向Father類dealHouse方法的指針，同時也有一個指向自己dealHouse方法的指針，這時候，新的數據會覆蓋原有的數據，也就是說原來指向Father.dealHouse的那個引用會被替換成指向Son.dealHouse的引用（佔據原來表中的位置）</p><p class=ql-align-justify><strong>注意：</strong></p><p class=ql-align-justify>上述講述的其實是對繼承實現的多態的一種分析，對接口實現的，會有著不一樣的理解。Java虛擬機 對於接口方法的調用是採用搜索方法表的方式，如，要在Father接口的方法表中找到dealHouse()方法，必須搜索Father的整個方法表。從效率上來說，接口方法的調用總是慢於類方法的調用的。</p><p class=ql-align-justify>以上就是對java多態的分析與理解，總結一下就是說，類調用和接口調用兩種方式區分不同方法是不一樣的，類調用是根據多態方法在方法表中的位移量，而接口調用是根據搜索整個方法表來實現的。</p><blockquote></blockquote></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>java</a></li><li><a>多態</a></li><li><a>jvm</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/5f8b26e0.html alt=多態的本質，java動態綁定 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/50ac000493fbc8532b5e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5f8b26e0.html title=多態的本質，java動態綁定>多態的本質，java動態綁定</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/69818103.html alt=java相關知識(10)總結 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/84649e6ba0f8442a8b10584403bf6635 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/69818103.html title=java相關知識(10)總結>java相關知識(10)總結</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/02729303.html alt=java實戰項目常用類，Date、Calendar、BigDecimal、Math、UUID class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d69c7c9d8b85444da9360e334ba6555d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/02729303.html title=java實戰項目常用類，Date、Calendar、BigDecimal、Math、UUID>java實戰項目常用類，Date、Calendar、BigDecimal、Math、UUID</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cb808de3.html alt=C++中的多態（動態多態）究竟是如何實現 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/30cae7ea5f5647deba7c518ed4e1a91b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cb808de3.html title=C++中的多態（動態多態）究竟是如何實現>C++中的多態（動態多態）究竟是如何實現</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cf633068.html alt="Java 多態的實現機制，看了都說好" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9d3b0e55813d46b4982ae7d9b81d1802 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cf633068.html title="Java 多態的實現機制，看了都說好">Java 多態的實現機制，看了都說好</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bb876e43.html alt=Java特性之一：多態詳解，學java不求人 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/39a700034bab2e1401a3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bb876e43.html title=Java特性之一：多態詳解，學java不求人>Java特性之一：多態詳解，學java不求人</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e27caade.html alt=python基礎知識，多態實例講解以及多態的作用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/2506d9fe7f6641a6a12c35a35a9335db style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e27caade.html title=python基礎知識，多態實例講解以及多態的作用>python基礎知識，多態實例講解以及多態的作用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/96d2083b.html alt=「Java三分鐘」Java三大特性——多態理解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/6a9b8965-0a4c-4cb4-9389-6cbbda0e9d93 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/96d2083b.html title=「Java三分鐘」Java三大特性——多態理解>「Java三分鐘」Java三大特性——多態理解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3ad79c04.html alt=什麼是多態機制？Java語言是如何實現多態的？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/d61f4356-80bf-4d14-8d12-f4a6fdca887c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3ad79c04.html title=什麼是多態機制？Java語言是如何實現多態的？>什麼是多態機制？Java語言是如何實現多態的？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/790fbad0.html alt=多態&動態綁定&方法匹配&方法綁定 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1533542565759f64e623e74 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/790fbad0.html title=多態&動態綁定&方法匹配&方法綁定>多態&動態綁定&方法匹配&方法綁定</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2aa5a357.html alt=大白話講解php多態應用實例 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2aa5a357.html title=大白話講解php多態應用實例>大白話講解php多態應用實例</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2ea7884b.html alt=java程序員注意：少有人知的哈希衝突解決策略，學到就是賺到 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/54d45b20ef6a4a3f960411db61474538 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2ea7884b.html title=java程序員注意：少有人知的哈希衝突解決策略，學到就是賺到>java程序員注意：少有人知的哈希衝突解決策略，學到就是賺到</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/19cbd4c3.html alt="java 常用的正則表達式" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1540129072390e6c4c05126 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/19cbd4c3.html title="java 常用的正則表達式">java 常用的正則表達式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a81470d4.html alt=java常用正則表達式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c811c3c14e4a4fa4825845b2868ee645 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a81470d4.html title=java常用正則表達式>java常用正則表達式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d5b99796.html alt=java正則表達式括號的使用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/88ce74502881405281b2e2e5ae84f5d7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d5b99796.html title=java正則表達式括號的使用>java正則表達式括號的使用</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>