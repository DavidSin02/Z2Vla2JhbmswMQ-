<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Hive SQL常用命令總結，大數據開發學習者請按需收藏 | 极客快訊</title><meta property="og:title" content="Hive SQL常用命令總結，大數據開發學習者請按需收藏 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/8164e94731124aa9a1fb5cfa4c791431"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/93b1883.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/93b1883.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/93b1883.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/93b1883.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/93b1883.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/93b1883.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/93b1883.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/93b1883.html><meta property="article:published_time" content="2020-10-29T20:59:31+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:31+08:00"><meta name=Keywords content><meta name=description content="Hive SQL常用命令總結，大數據開發學習者請按需收藏"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/93b1883.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Hive SQL常用命令總結，大數據開發學習者請按需收藏</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>Hive是基於Hadoop生態的一個重要組件，是對數據倉庫進行管理和分析數據的工具。她提供了SQL查詢方式來分析存儲在HDFS分佈式文件系統中的數據，可以將結構化的數據文件映射為一張數據庫表，並提供完整的SQL查詢功能。</p><p>這種SQL就是Hive SQL，她可以將SQL語句轉換為Map Reduce任務運行，通過特殊的SQL去查詢分析需要的內容，使不熟悉map reduce的用戶很方便的利用SQL 語言查詢，彙總，分析數據。</p><div class=pgc-img><img alt="Hive SQL常用命令總結，大數據開發學習者請按需收藏" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8164e94731124aa9a1fb5cfa4c791431><p class=pgc-img-caption></p></div><h4 class=pgc-h-arrow-right>一、基礎命令</h4><h4 class=pgc-h-arrow-right>1、數據庫操作</h4><ul><li>show databases; # 查看某個數據庫</li><li>use 數據庫; # 進入某個數據庫</li><li>show tables; # 展示所有表</li><li>desc 表名; # 顯示錶結構</li><li>show partitions 表名; # 顯示錶名分區</li><li>show create table_name; # 顯示創建表的結構</li></ul><h4 class=pgc-h-arrow-right>2、表結構修改</h4><ul><li>use xxdb; create table xxx; # 內部表</li><li>create table xxx like xxx; # 創建一個表，結構與其他一樣</li><li>use xxdb; create external table xxx; # 外部表</li><li>use xxdb; create external table xxx (l int) partitoned by (d string); # 分區表</li><li>alter table table_name set TBLPROPROTIES ('EXTERNAL'='TRUE'); # 內部錶轉外部表</li><li>alter table table_name set TBLPROPROTIES ('EXTERNAL'='FALSE');# 外部錶轉內部表</li></ul><h4 class=pgc-h-arrow-right>3、字段類型</h4><ul><li>基本類型： tinyint, smallint, int, bigint, float, decimal, boolean, string</li><li>複合類型：struct, array, map</li></ul><h4 class=pgc-h-arrow-right>二、常用函數</h4><ul><li>length() # 返回字符串長度</li><li>trim() # 去除兩邊空格</li><li>lower(), upper() # 大小寫轉換</li><li>reverse() # 反轉字符串</li><li>cast(expr as type) # 類型轉換</li><li>substring(string A, int start, int len) # 字符串截取</li><li>split(string str, string pat) # 按照pat字符串分割str，返回分割後的字符串數組</li><li>coalesce(v1, v2, v3, ...) # 返回列表中第一個非空元素,如果所有值都為空，則返回null</li><li>from_unixtime(unix_timestamp(), 'yyyy-MM-dd HH:mm:ss') # 返回當前時間</li><li>instr(string str, string search_str) # 返回第二個參數在待查找字符串中的位置(找不到返回0)</li><li>concat(string A, string B, string C, ...) # 字符串連接</li><li>concat_ws(string sep, string A, string B, string C, ...) # 自定義分隔符sep的字符串連接</li><li>str_to_map(string A, string item_pat, string dict_pat) # 將字符串轉為map</li><li>map_keys(map m) # 提取出map的key, 返回key的array</li><li>datediff(date1, date2) # 日期比較函數，返回相差天數，datediff('${cur_date},d)</li><li>explode(colname) # explode就是將hive一行中複雜的array或者map結構拆分成多行</li></ul><h4 class=pgc-h-arrow-right>三、相關概念</h4><h4 class=pgc-h-arrow-right>1、hive</h4><p>hive是基於hadoop的一個數據倉庫工具，可以將結構化的數據文件映射為一張數據庫庫表，並提供類SQL查詢功能。</p><h4 class=pgc-h-arrow-right>2、基本組成</h4><p>用戶接口：CLI，shell命令行;JDBC/ODBC是hive的java實現;webGUI是通過瀏覽器訪問hive;元數據存儲：通常是存儲在關係數據庫如mysql, derby中;hive的元數據包括表的名字，表的列和分區及其屬性，表的屬性(是否為外部表)，表的數據所在目錄等。</p><p>解釋器，編譯器，優化器完成HQL查詢語句從詞法分析，語法分析，編譯，優化以及查詢計劃的生成。生成的查詢存儲在HDFS中，並隨後有mapreduce調用執行。因此，hive與Hadoop的關係可以理解為用戶發出SQL查詢語句，hive將查詢存儲在HDFS中，然後由mapreduce調用執行。</p><h4 class=pgc-h-arrow-right>3、table</h4><p>Hive 中的 Table 和數據庫中的 Table 在概念上是類似的，每一個 Table 在 Hive 中都有一個相應的目錄存儲數據。例如，一個表 pvs，它在 HDFS 中的路徑為：/wh/pvs，其中，wh 是在 hive-site.xml 中由 ${hive.metastore.warehouse.dir} 指定的數據倉庫的目錄，所有的 Table 數據(不包括 External Table)都保存在這個目錄中。</p><h4 class=pgc-h-arrow-right>4、partition</h4><p>Partition 對應於數據庫中的 Partition 列的密集索引，但是 Hive 中 Partition 的組織方式和數據庫中的很不相同。在 Hive 中，表中的一個 Partition 對應於表下的一個目錄，所有的 Partition 的數據都存儲在對應的目錄中。</p><h4 class=pgc-h-arrow-right>5、buckets</h4><p>Buckets 對指定列計算 hash，根據 hash 值切分數據，目的是為了並行，每一個 Bucket 對應一個文件。將 user 列分散至 32 個 bucket，首先對 user 列的值計算 hash，對應 hash 值為 0 的 HDFS 目錄為：/wh/pvs/ds=20090801/ctry=US/part-00000;hash 值為 20 的 HDFS 目錄為：/wh/pvs/ds=20090801/ctry=US/part-00020</p><h4 class=pgc-h-arrow-right>6、external table</h4><p>External Table 指向已經在 HDFS 中存在的數據，可以創建 Partition。它和 Table 在元數據的組織上是相同的，而實際數據的存儲則有較大的差異。</p><p>Table 的創建過程和數據加載過程(這兩個過程可以在同一個語句中完成)，在加載數據的過程中，實際數據會被移動到數據倉庫目錄中;之後對數據對訪問將會直接在數據倉庫目錄中完成。刪除表時，表中的數據和元數據將會被同時刪除。</p><p>External Table 只有一個過程，加載數據和創建表同時完成(CREATE EXTERNAL TABLE ……LOCATION)，實際數據是存儲在 LOCATION 後面指定的 HDFS 路徑中，並不會移動到數據倉庫目錄中。當刪除一個 External Table 時，僅刪除元數據，表中的數據不會真正被刪除。</p><h4 class=pgc-h-arrow-right>7、全量數據和增量數據</h4><p>查看分區信息：如果分區的大小隨時間增加而增加，則最新的分區為全量數據。如果分區的大小隨時間增加而大小上下變化，則每個分區都是增量數據。</p><h4 class=pgc-h-arrow-right>四、HQL和SQL的異同</h4><h4 class=pgc-h-arrow-right>1、HQL和SQL常見不同，</h4><ul><li>select distinct 後必須指定字段名</li><li>join 條件僅支持等值關聯且不支持or條件</li><li>子查詢不能在select中使用;</li><li>HQL中沒有UNION，可使用distinct+ union all 實現 UNION;</li><li>HQL以分號分隔，必須在每個語句結尾寫上分號;</li><li>HQL中字符串的比較比較嚴格，區分大小寫及空格，因此在比較時建議upper(trim(a))=upper(trim(b))</li><li>日期判斷，建議使用to_date(),如：to_date(orderdate)=‘2016-07-18’</li><li>關鍵字必須在字段名上加``符號，如select `exchange` from xxdb.xxtb;</li><li>數據庫和表/視圖之間僅有1個點，如xx_db.xx_tb。</li></ul><h4 class=pgc-h-arrow-right>2、HQL不支持update，採用union all + left join (is null)變相實現update。</h4><ul><li>取出增量數據;</li><li>使用昨日分區的全量數據通過主鍵左連接增量數據，並且只取增量表中主鍵為空的數據(即，取未發生變化的全量數據);</li><li>合併1、2的數據覆蓋至最新的分區，即實現了update。</li></ul><h4 class=pgc-h-arrow-right>3、HQL不支持delete，採用not exists/left join(is null)的方法變相實現。</h4><ul><li>取出已刪除的主鍵數據(表B);</li><li>使用上一個分區的全量數據(表A)通過主鍵左連接A，並且只取A中主鍵為空的數據，然後直接insert overwrite至新的分區。</li></ul><p>對於會SQL的人員，轉入Hive SQL還是比較容易的，語法大部分是想通的，少部分函數不太一致。</p><p>碼字不易，如果您覺得文章寫得不錯，</p><p><strong>請您 1.關注作者~ </strong>您的關注是我寫作的最大動力</p><p><strong>2.私信我“大數據”</strong></p><p>我將與您分享一套最新的大數據學習資源和全套開發工具</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Hive</a></li><li><a>SQL</a></li><li><a>常用命令</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/125dee29.html alt="SQL Server中的事務與鎖" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1533794121802a9afbb22f9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/125dee29.html title="SQL Server中的事務與鎖">SQL Server中的事務與鎖</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e9d6f488.html alt="SQL Server中的事務（附有實例）" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/21e047bd6e3c41fba0beac7ef3f1ce4e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e9d6f488.html title="SQL Server中的事務（附有實例）">SQL Server中的事務（附有實例）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bb071e7e.html alt="SQL 事務機制-transaction" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3231427d97bf4a04b148360fea032241 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bb071e7e.html title="SQL 事務機制-transaction">SQL 事務機制-transaction</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c6e14bc6.html alt=SQL基礎知識——事務 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/773e21df09dc4e3e8403a0a62994039d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c6e14bc6.html title=SQL基礎知識——事務>SQL基礎知識——事務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4ddebd12.html alt="SQL 難點解決：記錄的引用" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/3a1b904121564aa389aba6a046772870 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4ddebd12.html title="SQL 難點解決：記錄的引用">SQL 難點解決：記錄的引用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/75ecd20b.html alt=0777-5.16.2-Hive中使用Date函數用於條件查詢結果異常分析 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1ef21425d90f4625bed940d16f7672b7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/75ecd20b.html title=0777-5.16.2-Hive中使用Date函數用於條件查詢結果異常分析>0777-5.16.2-Hive中使用Date函數用於條件查詢結果異常分析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6b48b90b.html alt=Linux系統常用命令大全 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6b48b90b.html title=Linux系統常用命令大全>Linux系統常用命令大全</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e5773a66.html alt=（二)SQL數據模式、表、索引的建立與刪除 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0f1d1d3b1dac408190a1191154fe642d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e5773a66.html title=（二)SQL數據模式、表、索引的建立與刪除>（二)SQL數據模式、表、索引的建立與刪除</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a0630d89.html alt=SQL分類之DQL：查詢表中的記錄 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a0630d89.html title=SQL分類之DQL：查詢表中的記錄>SQL分類之DQL：查詢表中的記錄</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/332cb941.html alt=數據庫SQL最常用語句 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/332cb941.html title=數據庫SQL最常用語句>數據庫SQL最常用語句</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8ca809f3.html alt="SQL SERVER數據庫中用select語句複製表結構創建新表" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8ca809f3.html title="SQL SERVER數據庫中用select語句複製表結構創建新表">SQL SERVER數據庫中用select語句複製表結構創建新表</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/44c388b7.html alt=數據分析師要掌握SQL到什麼程度？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9632c1ad23d948788a9c4d84a167aafc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/44c388b7.html title=數據分析師要掌握SQL到什麼程度？>數據分析師要掌握SQL到什麼程度？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7f357ca6.html alt="SQL 2大觸發器類型及應用實例" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/a4853ad0f7f84c14a09f3af661787334 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7f357ca6.html title="SQL 2大觸發器類型及應用實例">SQL 2大觸發器類型及應用實例</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/12fe4764.html alt="SQL 中的if判斷語句、while循環語句、和運算符" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/04199ae85d034aba8f5792b86591bb77 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/12fe4764.html title="SQL 中的if判斷語句、while循環語句、和運算符">SQL 中的if判斷語句、while循環語句、和運算符</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6b91c075.html alt="百度語義解析 ( Text-to-SQL ) 技術研究及應用" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/780ac2852a114bb8a09aeffaf6b1f45e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6b91c075.html title="百度語義解析 ( Text-to-SQL ) 技術研究及應用">百度語義解析 ( Text-to-SQL ) 技術研究及應用</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>