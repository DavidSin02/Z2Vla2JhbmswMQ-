<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>架設不斷網的企業網絡：冗餘技術 | 极客快訊</title><meta property="og:title" content="架設不斷網的企業網絡：冗餘技術 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/32fa02f2c5584d72adcd61a457c9ab84"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/952e4ac.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/952e4ac.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/952e4ac.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/952e4ac.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/952e4ac.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/952e4ac.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/952e4ac.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/952e4ac.html><meta property="article:published_time" content="2020-10-29T20:59:02+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:02+08:00"><meta name=Keywords content><meta name=description content="架設不斷網的企業網絡：冗餘技術"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/952e4ac.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>架設不斷網的企業網絡：冗餘技術</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p><strong>冗餘技術簡介</strong></p><p class=ql-align-justify>隨著 Internet 的發展，大型園區網絡從簡單的信息承載平臺轉變成一個公共服務提供平臺。作為終端用戶，希望能時時刻刻保持與網絡的聯繫，因此健壯，高效和可靠成為園區網發展的重要目標，而要保證網絡的可靠性，就需要使用到冗餘技術。高冗餘網絡要給我們帶來的體驗，就是在網絡設備、鏈路發生中斷或者變化的時候，用戶幾乎感覺不到。</p><p class=ql-align-justify>為了達成這一目標，需要在園區網的各個環節上實施冗餘，包括網絡設備，鏈路和廣域網出口，用戶側等等。<strong>大型園區網的冗餘部署也包含了全部的三個環節，分別是：設備級冗餘，鏈路級冗餘和網關級冗餘。</strong> 本文將對這三種冗餘技術的基本原理和實現進行詳細的說明。</p><p><strong>設備級冗餘技術</strong></p><p class=ql-align-justify>設備級的冗餘技術分為電源冗餘和管理板卡冗餘，由於設備成本上的限制，這兩種技術都被應用在中高端產品上。下圖是某廠商交換機的<strong>電源冗餘技術：</strong></p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/32fa02f2c5584d72adcd61a457c9ab84><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>如圖所示，某廠商設備內置了兩個電源插槽，通過插入不同模塊，可以實現兩路AC電源或者兩路DC電源的接入，實現設備電源的 1＋ 1 備份。工程中最常見配置情況是同時插入兩塊 P6800-AC 模塊來實現 220v 交流電源的 1＋1 備份。</p><p class=ql-align-justify>電源模塊的冗餘備份實施後，在主電源供電中斷時，備用電源將繼續為設備供電，不會造成業務的中斷。</p><p class=ql-align-justify><strong>注意： </strong>在實施電源的1＋1冗餘時，請使用兩塊相同型號的電源模塊來實現。如果一塊是交流電源模塊 P6800-AC，另一塊是直流電源模塊 P6800-DC 的話，將有可能造成交換機損壞 。</p><p class=ql-align-justify><strong>交換機的管理板卡冗餘技術</strong></p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3c8824995ebf448d8ee513f128a9cd82><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>如圖 所示，某款交換機提供了兩個管理卡插槽，M6806-CM為RG-S6806E 的主管理模塊。承擔著系統交換、系統狀態的控制、路由的管理、用戶接入的控制和管理、網絡維護等功能。管理模塊插在機箱母板插框中間的第 M1,M2 槽位中，支持主備冗餘，實現熱備份,同時支持熱插拔。</p><p class=ql-align-justify>簡單來說管理卡冗餘也就是在交換機運行過程中，如果主管理板出現異常不能正常工作，交換機將自動切換到從管理板工作，同時不丟失用戶的相應配置，從而保證網絡能夠正常運行，實現冗餘功能。</p><p class=ql-align-justify>在實際工程中使用雙管理卡的設備都是自動選擇主管理卡的，先被插入設備中將會成為主管理卡，後插入的板卡自動處於冗餘狀態，但是也可以通過命令來選擇哪塊板卡成為主管理卡。具體配置如下</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0832d346f5d949c0aa5a23195bffbe57><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>注意：在交換機運行過程中，如果用戶進行了某些配置後執行主管理卡的切換，一定要記得保存配置，否則會造成用戶配置丟失。</p><p class=ql-align-justify>在實際項目中， S65和 S68系列的高端交換機一般都處於網絡的核心或區域核心位置，承載著園區網絡中關鍵的業務流量。 為了提供更可靠的網絡平臺。</p><p><strong>鏈路級冗餘技術</strong></p><p class=ql-align-justify>在大型園區網絡中往往存在多條二層和三層鏈路，使用鏈路級冗餘技術可以實現多條鏈路之間的備份，流量分擔和環路避免。本章將對幾種主要的鏈路冗餘技術進行闡述。</p><p class=ql-align-justify><strong>二層鏈路冗餘的實現：</strong></p><p class=ql-align-justify>在二層鏈路中實現冗餘的方式主要有兩種，生成樹協議和鏈路捆綁技術。其中生成樹協議是一個純二層協議，但是鏈路捆綁技術在二層接口和三層接口上都可以使用。首先介紹的是鏈路捆綁技術（ Aggregate－ port）。</p><p class=ql-align-justify><strong>二層鏈路捆綁技術</strong></p><p class=ql-align-justify><strong>AP 技術的基本原理</strong></p><p class=ql-align-justify>把多個二層物理鏈接捆綁在一起形成一個簡單的邏輯鏈接，這個邏輯鏈接我們稱之為一aggregate port（簡稱AP）。AP是鏈路帶寬擴展的一個重要途徑，符合 IEEE 802.3ad 標準。</p><p class=ql-align-justify>它可以把多個端口的帶寬疊加起來使用，形成一個帶寬更大的邏輯端口，同時當AP中的一條成員鏈路斷開時，系統會將該鏈路的流量分配到 AP 中的其他有效鏈路上去，實現負載均衡和鏈路冗餘。AP技術一般應用在交換機之間的骨幹鏈路，或者是交換機到大流量的服務器之間。</p><p class=ql-align-justify><strong>二層 AP 技術的基本應用和配置</strong></p><p class=ql-align-justify>下面來看一個簡單的AP應用實例：</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/0042af3daa224617b4db6f4ccc576aef><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>在圖中兩臺交換機存在兩條百兆鏈路形成了環路，如果要避免環路的話必須要啟用生成樹協議，這樣會導致其中一條鏈路被阻塞掉，既造成了帶寬的浪費，同時也違背了使用兩條鏈路實現冗餘加負載分擔的設計初衷。</p><p class=ql-align-justify>在這種情況下使用 AP 技術可以園滿的解決這個問題，通過捆綁兩條鏈路形成一個邏輯端口 AggregatePort ，帶寬被提升至 200M ，同時在兩條鏈路中的一條發生故障時，流量會被自動轉往另一條鏈路，從而實現了帶寬提升，流量分擔和冗餘備份的目的。</p><p class=ql-align-justify>具體的設備配置以其中 S3550-1 為例：</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cd61617d633b4996ba47034f291ad99f><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>配置完成後使用命令檢查結果如下：</p><p class=ql-align-justify>S3550-1#show aggregatePort 1 summary</p><p class=ql-align-justify>AggregatePort MaxPorts SwitchPort Mode Ports</p><p class=ql-align-justify>------------- -------- ---------- ------ -----------------------</p><p class=ql-align-justify>Ag1 8 Enabled Access Fa0/1 , Fa0/2</p><p class=ql-align-justify>可以看到 Ag1 已經被正確配置， F0/1 和 F0/2 成為 AP 組 1 的成員。</p><p class=ql-align-justify><strong>二層 AP 技術的負載均衡</strong></p><p class=ql-align-justify>AP技術的配置和應用環境都並不複雜，但是在實際項目使用AP的時候，很多人往往忽視了一個問題，那就是如何用好AP的負載均衡模式。</p><p class=ql-align-justify>二層AP有兩種負載均衡模式： 基於源MAC或者是基於目的MAC進行幀轉發。在實際項目中，靈活運用這兩種模式才能使得AP發揮最大的功效。</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ade2abfc91714a96a891375c74815881><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>在圖中可以看到在核心和匯聚之間存在一條由三個百兆組成的AP鏈路，缺省情況下二層 AP 基於源 MAC 地址進行多鏈路負載均衡。這樣做在用戶側交換機上是沒有任何問題的，因為數據來自不同的用戶主機， 源 MAC 不同；但是如果在核心交換機上也根據源 MAC來投包的話，僅僅會利用上三條鏈路中的一條，因為核心交換機發往用戶數據幀的源 MAC只有一個，就是本身的 SVI 接口 MAC 。因此為了能夠充分利用 AP 的所有成員鏈路， 必須在核心交換機上更改成基於目的 MAC 的負載均衡方式。</p><p class=ql-align-justify>調整二層 AP 負載均衡模式的配置以 S3550 為例：</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/84630e334efb40eca91eb2ccc7c67df8><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p><strong>生成樹技術</strong></p><p class=ql-align-justify>本章節主要介紹如何在實際項目中運用生成樹技術實現二層鏈路的冗餘和流量分擔，對於生成樹技術原理不會做過多的描述，如果對生成樹技術有興趣的讀者請自行查閱資料。</p><p class=ql-align-justify>生成樹協議 802.1D STP 作為一種純二層協議， 通過在交換網絡中建立一個最佳的樹型拓撲結構實現了兩個重要功能：環路避免和冗餘。但是純粹的生成樹協議 IEEE 802.1D 在實際應用中並不多，因為其有幾個非常明顯的缺陷 :,收斂慢，而且浪費了冗餘鏈路的帶寬。</p><p class=ql-align-justify>作為STP 的升級版本， IEEE 802.1W RSTP解決了收斂慢的問題， 但是仍然不能有效利用冗餘鏈路做負載分擔。因此在實際工程應用中，往往會選用 802.1S MSTP 技術。</p><p class=ql-align-justify>MSTP技術除保留了RSTP快速收斂的優點外，同時MSTP能夠使用 instance（實例）關聯 VLAN 的方式來實現多鏈路負載分擔。下面我們來看一個實例：</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8e5465fa054442f7868ca1cf099a2cbe><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>使用STP實現鏈路冗餘</strong></p><p class=ql-align-justify>如圖是一種常見的二層組網方式，三臺交換機上都擁有兩個VLAN ， VLAN10和VLAN20 。接入層交換機到匯聚交換機有兩條鏈路，如果使用802.1D STP技術來進行鏈路冗餘的話，會導致下圖中的結果：</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1a5782cddc1a4aa5ac6d61afd5468993><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>從圖中可以很清楚的看出使用 802.1D STP 或 802.1W RSTP，雖然能夠實現鏈路冗餘，但是無論如何都會導致 S2126G 的某條上行鏈路被阻塞，從而導致鏈路帶寬的浪費。</p><p class=ql-align-justify><strong>使用MSTP實現鏈路冗餘和負載分擔</strong></p><p class=ql-align-justify>如果使用 802.1S MSTP 的話，就可以同時達到冗餘和流量分擔的目的。現在來看看在這種拓撲結構下，如何正確使用 MST 實現以上功能 .</p><p class=ql-align-justify>（1）在三臺交換機上全部啟用MST，並建立VLAN 10到 Instance 10 和 VLAN 20 到Instance 20 的映射，這樣就把原來的物理拓撲，通過 Instance 到 VLAN 的映射關係邏輯上劃分成兩個拓撲，分別對應VLAN 10 和VLAN 20 。</p><p class=ql-align-justify>（2）調整S3550-1 在 VLAN10 中的橋優先級為 4096，保證其在 VLAN 10 的邏輯拓撲中被選舉為根橋。 同時調整在 VLAN20 中的橋優先級為 8192，保證其在VLAN20 的邏輯拓撲中的備用根橋位置。</p><p class=ql-align-justify>（3）S3550-2 的調整方法和 S3550-1 類似，也是要保證在 VLAN20 中 ,S3550-2 成為根橋，在 VLAN10 中，其成為備用根橋。</p><p class=ql-align-justify>下圖非常形象的描述了本案例使用 MSTP 的實現過程</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/351eb502b6794048b5137411a3e118e2><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>MSTP的配置實例：</strong></p><p class=ql-align-justify>S2126G 配置如下</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fcb754d6775646d9ac9cae4c4163b6ff><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>S3550-1 配置如下</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/81c9d734bb6e4e46923845c9d576df40><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>S3550-2 配置如下</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/e0dec4c4332b4cc59610586294adfd27><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>注意：</strong>由於 MST 的配置較為複雜， 因此在下面列出了 MST 的配置中一些經常出現的錯誤。</p><p class=ql-align-justify>(1) Spanning-tree 模式沒有選擇。</p><p class=ql-align-justify>(2) 各個交換機 Instance 映射關係不一致，從而導致交換機間的鏈路被錯誤阻塞。</p><p class=ql-align-justify>(3) 很多工程師在配置完 S3550-1 在 Instance10 中的根橋優先級後， 沒有將其設置成另一個實例的備用根橋。 這是非常危險的操作， 因為一旦出現 Instance20 的主用鏈路失效後可能導致 S2126G 被選舉為根橋， 使得 VLAN20 的所有流量都必須經過 S2126G 這種接入層交換機，在極端情況下可能導致 S2126G 當機。</p><p class=ql-align-justify>(4) MST 的配置順序問題， 應該在配置完MST的參數後再打開生成樹，否則有可能出現MST工作異常的情況。</p><p class=ql-align-justify>(5) 沒有指定VLAN到Instance關聯VLAN都被歸納到Instance0，在實際工程中需要注意 Instance0 的根橋指定。</p><p><strong>三層鏈路冗餘技術</strong></p><p class=ql-align-justify>三層鏈路冗餘技術較二層鏈路冗餘技術豐富很多，依靠各種路由協議可以輕鬆實現三層鏈路冗餘和負載均衡。另外三層鏈路捆綁技術也提供了路由協議之外的一種選擇。由於在當前的大型園區網絡中，絕大部分情況使用的路由協議都是OSPF，因此在討論基於路由協議的冗餘技術時，只考慮使用OSPF 的情況。</p><p class=ql-align-justify><strong>三層鏈路捆綁技術</strong></p><p class=ql-align-justify>三層鏈路的AP和二層鏈路AP技術的本質都是一樣，都是通過捆綁多條鏈路形成一個邏輯端口來實現增大帶寬，保證冗餘和負載分擔的目的。在本節中就只介紹三層 AP 的基本配置。</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/def1befdb7754060be258b4bf52e919c><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>如圖所示，兩臺 S3550 需要建立三層 AP，以 S3550-1 為例，其配置如下：</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/354ad06b9a6f4544a5d8662a02aa567e><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>注意：建立三層 AP 需要首先手動建立匯聚端口，並將其設置為三層接口。如果直接將交換機端口加入的話，會出現接口類型不匹配，命令無法執行的錯誤 。</p><p class=ql-align-justify><strong>三層AP的負載均衡模式</strong></p><p class=ql-align-justify>和二層AP一樣，三層AP也需要選擇負載均衡模式，配置如下：</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/70df82bba59b41ce8d578c522ea005f7><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p><strong>基於OSPF的三層鏈路冗餘技術</strong></p><p class=ql-align-justify>基於OSPF的三層鏈路冗餘技術在大型園區網絡中使用廣泛，通過 cost值的調整可以非常容易的實現鏈路冗餘和負載分擔。</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/33d81accf36342639680a1abecbf0f0b><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>圖中的OSPF網絡通過cost調整很好的實現了鏈路，核心設備和出口的冗餘備份和負載分擔。其實對於這種拓撲接口的網絡，使用 OSPF 還有另外一種解決方案，那就是不修改 cost 值，在 S6806E 的兩條上行鏈路做負載均衡。這種方式看似比前一種方案更合理。但是在實際項目中， 由於園區內部使用私有地址， 在出口路由器上需要做 NAT 轉換， 因此在這種拓撲中是不可行的。對於這種網絡不可能實現真正意義上的負載均衡，只能通過規劃設計來合理分配鏈路流量。</p><p class=ql-align-justify>下面來看看下圖中的網絡，這個OSPF網絡由於是單出口的拓撲結構， 因此不需要通過人工調整cost 值來實現流量分擔。只需要更改OSPF 的參考帶寬，OSPF會自動實現負載均衡功能。</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fbde4f9c61c44f40ac5738257343d9c0><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p><strong>網關級冗餘技術VRRP的實現</strong></p><p class=ql-align-justify>前面談到的冗餘技術保證了園區網絡級別的冗餘，同樣對於使用網絡的終端用戶來講，也需要一種機制來保證其與園區網絡的可靠連接，這就是網關級冗餘技術。</p><p class=ql-align-justify>VRRP 是一種容錯協議，它保證當主機的下一跳路由器失效時，可以及時的由另一臺路由器來替代，從而保持通訊的連續性和可靠性， VRRP協議通過交互報文的方法將多臺物理路由器模擬成一臺虛擬路由器，網絡上的主機與虛擬路由器進行通信。一旦 VRRP組中的某臺物理路由器失效，其他路由器自動將接替其工作。</p><p class=ql-align-justify><strong>單VLAN的VRRP應用</strong></p><p class=ql-align-justify>單VLAN中VRRP的典型應用如下圖所示，圖中所有設備和用戶都處於 VLAN10中，對於用戶來說，其電腦的網關被設置為虛擬路由器 S3550-3 的 IP 地址，實際上真正進行轉發的設備是S3550-1 ，S3550-2 作為冗餘。一旦 S3550-1 出現故障， S3550-2 將自動接替其工作，對用戶來說是感知不到這種變化的。</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/11f1693bce264250b353a3bc64fb47b7><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>在單VLAN 中，VRRP的基本配置如下：</p><p class=ql-align-justify>S3550-1 的配置</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e28c09a112db49a8b6664baa020d6db8><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/33ab09572336437484ba50c6e8989845><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>S3550-2 的配置</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/004f3082df8b48e8b66dc7b11e2a7d8c><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>多VLAN中的VRRP路由器負載分擔：</strong></p><p class=ql-align-justify>在多VLAN 的情況下，如果使用S3550-1作為主網關，S3550-2 僅僅用來做冗餘的話實際上對網絡資源是一種極大的浪費。多VLAN 中的 VRRP 路由器負載分擔模式本質上是單VLAN中VRRP應用模型的拓展。如下圖所示，針對不同的VLAN中建立相應的VRRP組，通過優先級調整來使得路由器在多個VLAN 中充當不同的角色， 這樣可以讓流量均勻分佈到鏈路和設備上，從而實現冗餘和流量分擔的目的。這種應用思想和 MST 的多VLAN流量分擔相似，也是基於VLAN實現邏輯拓撲的劃分。</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e2a48a2ae8c04fbe975709c89e821e59><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify><strong>在多VLAN環境下，實現VRRP 路由器負載分擔的基本配置如下：</strong></p><p class=ql-align-justify>S3550-1的配置</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/6774c806c6e24e5abfc63838fee64022><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>S3550-2的配置</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/9c7bc0269fa946028e1f6c1c4ce043c2><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>經過以上配置後， 最終在 VLAN10 中建立 VRRP 組 1，S3550-1 被當選為主網關， S3550-2成為備用網關，而在 VLAN 20 中建立 VRRP 組 2， S3550-2 被當選為主網關， S3550-1 成為備用網關。</p><p><strong>冗餘技術的綜合使用實例： MSTP+VRRP</strong></p><p class=ql-align-justify>由於每種冗餘技術都工作在特定層面上，所以在網絡實際應用時需要多種冗餘技術的結合使用才能真正保證網絡的可靠性。下面將為大家介紹一個冗餘技術綜合運用的實例，使用MSTP+VRRP來實現基於 VLAN 的鏈路冗餘和網關冗餘。</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d2f104ce9c8c45628ae1e453073fc390><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>如圖所示，這是一個大型園區網絡的某個匯聚節點的拓撲圖，共有兩個用戶VLAN ：VLAN10 和 VLAN20 ，在接入交換機 S2126G 到三層匯聚使用了雙核心和雙鏈路備份。對於這種類型的網絡，設計者的意圖很明顯：希望得到最高的安全性和合理的流量分擔。為了實現這個目的，必須把MSTP和VRRP 結合使用。如圖 8-14 所示。</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fa06a9f5f305483dbb68ea38513f3223><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>對於這種案例來說， 其實把拓撲圖分解成單個 VLAN 的邏輯拓撲後， 理解起來是很簡單的，無非就是先通過調整橋優先級選出本 VLAN 的根橋， 然後再調整 VRRP 的優先級使得這臺根橋同時成為對應 VRRP 組的主網關。</p><p class=ql-align-justify>這樣正常情況下兩個 VLAN 的用戶的數據流量分別通過不同的上行鏈路和網關進入園區網絡，實現了鏈路和網關的負載分擔。同時在故障出現時， MSTP 保障二層冗餘鏈路切換功能，而 VRRP 保證備用網關的倒換，兩種技術被有機的結合，從而完美的解決了這類網絡的冗餘問題。</p><p class=ql-align-justify>本案例的具體配置如下：</p><p class=ql-align-justify>S3550-1在VLAN10和VLAN20中的配置</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e533d580e8ca4bba9b6605c9c80d80a6><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>S3550-2在VLAN10和 VLAN20 中的配置</p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/cf989f64e18e41fd8da3bd19578b3801><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><div class=pgc-img><img alt=架設不斷網的企業網絡：冗餘技術 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/aebb2c24bd3a4391b27a453ed2d4c09a><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>注意：在實際工程中做 VRRP+MSTP 的配置，一定要注意一個 VLAN中根橋的位置和VRRP主網關的位置必須一致，否則會造成網絡故障。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>架設</a></li><li><a>不斷網</a></li><li><a>企業</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/928013b9.html alt=企業網站建設選擇正確的服務器，讓你省錢，網站運行良好 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/f7824718-e78c-40c3-93f8-ba9b88203ea8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/928013b9.html title=企業網站建設選擇正確的服務器，讓你省錢，網站運行良好>企業網站建設選擇正確的服務器，讓你省錢，網站運行良好</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/497b6722.html alt=企業網站建設，如何選擇主機與服務器？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/22a377ed-b740-40a5-acac-d4cc461b823e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/497b6722.html title=企業網站建設，如何選擇主機與服務器？>企業網站建設，如何選擇主機與服務器？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a2871b0c.html alt="可用於企業的 7 個最佳開源 Web 服務器！" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1531874286737ba179830a5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a2871b0c.html title="可用於企業的 7 個最佳開源 Web 服務器！">可用於企業的 7 個最佳開源 Web 服務器！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/64b9210f.html alt=服務器對企業網站的影響 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/455f1d97b93346daa30ad5db07b04a6b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/64b9210f.html title=服務器對企業網站的影響>服務器對企業網站的影響</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d0c9d055.html alt="“工匠”給力 保障企業復工復產電力供應萬無一失" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/9d562209476a4823b9145dd162cf9161 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d0c9d055.html title="“工匠”給力 保障企業復工復產電力供應萬無一失">“工匠”給力 保障企業復工復產電力供應萬無一失</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6d98984a.html alt=重磅乾貨！柯春曉談“世界一流企業的創新生態與知識創新服務業” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2211f4f2f5c349ffa46e9937b47c9f39 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6d98984a.html title=重磅乾貨！柯春曉談“世界一流企業的創新生態與知識創新服務業”>重磅乾貨！柯春曉談“世界一流企業的創新生態與知識創新服務業”</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/75f10997.html alt=企業永久實行彈性工作制，是否應該全面推行？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6bf86d1f40f04e0abdbc103c5ebd852c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/75f10997.html title=企業永久實行彈性工作制，是否應該全面推行？>企業永久實行彈性工作制，是否應該全面推行？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a9bd074a.html alt=企業如何快速擺脫“暫停鍵狀態”？轉換銷售場景，進行營銷破局 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/6983b3de-a005-448a-9834-6be02eeacd79 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a9bd074a.html title=企業如何快速擺脫“暫停鍵狀態”？轉換銷售場景，進行營銷破局>企業如何快速擺脫“暫停鍵狀態”？轉換銷售場景，進行營銷破局</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3bf2f0d0.html alt=哈薩克斯坦44%企業因緊急狀態暫停經營 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3bf2f0d0.html title=哈薩克斯坦44%企業因緊急狀態暫停經營>哈薩克斯坦44%企業因緊急狀態暫停經營</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/efc87ed9.html alt=吳永韜：企業股權合夥模式之合夥單元改造 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f5701b16947947b79791679b0285e029 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/efc87ed9.html title=吳永韜：企業股權合夥模式之合夥單元改造>吳永韜：企業股權合夥模式之合夥單元改造</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9cb8e863.html alt=平川區7月高風險運輸企業“黑榜單” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/RH1UHyOG0biagn style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9cb8e863.html title=平川區7月高風險運輸企業“黑榜單”>平川區7月高風險運輸企業“黑榜單”</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5ad5161d.html alt=食品企業程序文件範本 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/6cb0d535ec904fa2ac5d54a06cea18b4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5ad5161d.html title=食品企業程序文件範本>食品企業程序文件範本</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c00885a3.html alt=企業生命週期｜發現企業衰落的三大要素 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/afd0f515247e456bb17b2e011eb50e34 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c00885a3.html title=企業生命週期｜發現企業衰落的三大要素>企業生命週期｜發現企業衰落的三大要素</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7cd42d01.html alt=企業衰落的五個階段！到第3個階段就危險了，老闆要警惕 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/8dff5ab17e0d4e0e80be318c10b7c09f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7cd42d01.html title=企業衰落的五個階段！到第3個階段就危險了，老闆要警惕>企業衰落的五個階段！到第3個階段就危險了，老闆要警惕</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a8c52dba.html alt=世界十大齒輪加工生產企業，你知道幾個？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15393259811528f8c9cbbe6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a8c52dba.html title=世界十大齒輪加工生產企業，你知道幾個？>世界十大齒輪加工生產企業，你知道幾個？</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>