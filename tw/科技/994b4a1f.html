<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>到底什麼是Hash？Hash算法的原理和實際應用講解 | 极客快訊</title><meta property="og:title" content="到底什麼是Hash？Hash算法的原理和實際應用講解 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/c0b06143ec4848cd85543d2af3eb2063"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/994b4a1f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/994b4a1f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/994b4a1f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/994b4a1f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/994b4a1f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/994b4a1f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/994b4a1f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/994b4a1f.html><meta property="article:published_time" content="2020-11-14T21:07:42+08:00"><meta property="article:modified_time" content="2020-11-14T21:07:42+08:00"><meta name=Keywords content><meta name=description content="到底什麼是Hash？Hash算法的原理和實際應用講解"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/994b4a1f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>到底什麼是Hash？Hash算法的原理和實際應用講解</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><blockquote><p>提到hash，相信大多數同學都不會陌生，之前很火現在也依舊很火的技術區塊鏈背後的底層原理之一就是hash，下面就從hash算法的原理和實際應用等幾個角度，對hash算法進行一個講解。</p></blockquote><h1 class=pgc-h-arrow-right>1、什麼是Hash</h1><p>Hash也稱散列、哈希，對應的英文都是Hash。基本原理就是把任意長度的輸入，通過Hash算法變成固定長度的輸出。這個映射的規則就是對應的Hash算法，而原始數據映射後的二進制串就是哈希值。活動開發中經常使用的MD5和SHA都是歷史悠久的Hash算法。</p><pre><code>echo md5("這是一個測試文案");// 輸出結果：2124968af757ed51e71e6abeac04f98d</code></pre><p>在這個例子裡，這是一個測試文案是原始值，2124968af757ed51e71e6abeac04f98d 就是經過hash算法得到的Hash值。整個Hash算法的過程就是把原始任意長度的值空間，映射成固定長度的值空間的過程。</p><h1 class=pgc-h-arrow-right><strong>2、Hash的特點</strong></h1><p>一個優秀的hash算法，需要什麼樣的要求呢？</p><ul><li>a)、從hash值不可以反向推導出原始的數據<br>這個從上面MD5的例子裡可以明確看到，經過映射後的數據和原始數據沒有對應關係</li><li>b)、輸入數據的微小變化會得到完全不同的hash值，相同的數據會得到相同的值<br>echo md5("這是一個測試文案");<br>// 輸出結果：2124968af757ed51e71e6abeac04f98d<br>echo md5("這是二個測試文案");<br>// 輸出結果：bcc2a4bb4373076d494b2223aef9f702<br>可以看到我們只改了一個文字，但是整個得到的hash值產生了非常大的變化。</li><li>c)、哈希算法的執行效率要高效，長的文本也能快速地計算出哈希值</li><li>d)、hash算法的衝突概率要小<br>由於hash的原理是將輸入空間的值映射成hash空間內，而hash值的空間遠小於輸入的空間。根據抽屜原理，一定會存在不同的輸入被映射成相同輸出的情況。那麼作為一個好的hash算法，就需要這種衝突的概率儘可能小。</li></ul><blockquote><p>桌上有十個蘋果，要把這十個蘋果放到九個抽屜裡，無論怎樣放，我們會發現至少會有一個抽屜裡面放不少於兩個蘋果。這一現象就是我們所說的“抽屜原理”。抽屜原理的一般含義為：“如果每個抽屜代表一個集合，每一個蘋果就可以代表一個元素，假如有n+1個元素放到n個集合中去，其中必定有一個集合裡至少有兩個元素。” 抽屜原理有時也被稱為鴿巢原理。它是組合數學中一個重要的原理</p></blockquote><h1 class=pgc-h-arrow-right><strong>3、Hash碰撞的解決方案</strong></h1><p>前面提到了hash算法是一定會有衝突的，那麼如果我們如果遇到了hash衝突需要解決的時候應該怎麼處理呢？比較常用的算法是鏈地址法和開放地址法。</p><h1 class=pgc-h-arrow-right><strong>3.1 鏈地址法</strong></h1><p>鏈表地址法是使用一個鏈表數組，來存儲相應數據，當hash遇到衝突的時候依次添加到鏈表的後面進行處理。</p><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c0b06143ec4848cd85543d2af3eb2063><p class=pgc-img-caption></p></div><p>鏈地址在處理的流程如下：<br>添加一個元素的時候，首先計算元素key的hash值，確定插入數組中的位置。如果當前位置下沒有重複數據，則直接添加到當前位置。當遇到衝突的時候，添加到同一個hash值的元素後面，行成一個鏈表。這個鏈表的特點是同一個鏈表上的Hash值相同。java的數據結構HashMap使用的就是這種方法來處理衝突，JDK1.8中，針對鏈表上的數據超過8條的時候，使用了紅黑樹進行優化。由於篇幅原因，這裡不深入討論相關數據結構，有興趣的同學可以參考這篇文章：</p><p>《Java集合之一—HashMap》</p><h1 class=pgc-h-arrow-right><strong>3.2 開放地址法</strong></h1><p>開放地址法是指大小為 M 的數組保存 N 個鍵值對，其中 M > N。我們需要依靠數組中的空位解決碰撞衝突。基於這種策略的所有方法被統稱為“開放地址”哈希表。線性探測法，就是比較常用的一種“開放地址”哈希表的一種實現方式。線性探測法的核心思想是當衝突發生時，順序查看錶中下一單元，直到找出一個空單元或查遍全表。簡單來說就是：<strong>一旦發生衝突，就去尋找下 一個空的散列表地址，只要散列表足夠大，空的散列地址總能找到。</strong></p><p>線性探測法的數學描述是：h(k, i) = (h(k, 0) + i) mod m，i表示當前進行的是第幾輪探查。i=1時，即是探查h(k, 0)的下一個；i=2，即是再下一個。這個方法是簡單地向下探查。mod m表示：到達了表的底下之後，回到頂端從頭開始。</p><p>對於開放尋址衝突解決方法，除了線性探測方法之外，還有另外兩種比較經典的探測方法，二次探測（Quadratic probing）和雙重散列（Double hashing）。但是不管採用哪種探測方法，當散列表中空閒位置不多的時候，散列衝突的概率就會大大提高。為了儘可能保證散列表的操作效率，一般情況下，我們會儘可能保證散列表中有一定比例的空閒槽位。我們用裝載因子（load factor）來表示空位的多少。</p><p>散列表的裝載因子=填入表中的元素個數/散列表的長度。裝載因子越大，說明衝突越多，性能越差。</p><h1 class=pgc-h-arrow-right><strong>3.3 兩種方案的demo示例</strong></h1><p>假設散列長為8，散列函數H(K)=K mod 7，給定的關鍵字序列為{32,14,23,2, 20}<br>當使用鏈表法時，相應的數據結構如下圖所示：</p><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ab96495450da473d9787f24662b0e0bb><p class=pgc-img-caption></p></div><p>當使用線性探測法時，相應的數據結果如下圖所示：</p><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/767a8e9a4548469885c298a637638608><p class=pgc-img-caption></p></div><p>這裡的兩種算法的區別是2這個元素，在鏈表法中還是在節點2的位置上，但是在線性探測法遇到衝突時會將衝突數據放到下一個空的位置下面。</p><h1 class=pgc-h-arrow-right><strong>4、hash算法在日常活動中的應用</strong></h1><p>在日常運營活動中，我們活動開發經常遇到的應用場景是信息加密、數據校驗、負載均衡。下面分別對這三種應用場景進行講解。</p><h1 class=pgc-h-arrow-right><strong>4.1 信息加密</strong></h1><p>首先我們看一下信息加密的應用。2011年CSDN脫庫事件，導致超過600W的用戶的密碼洩露，讓人失望的是，CSDN是明文存儲用戶的註冊郵箱和密碼的。作為用戶的非常隱私的信息，最簡單的保護措施就是對密碼進行hash加密。在客戶端對用戶輸入的密碼進行hash運算，然後在服務端的數據庫中保存用戶密碼的hash值。由於服務器端也沒有存儲密碼的明文，所以目前很多網站也就不再有找回密碼的功能了。</p><ul><li>這裡也友情提示一下大家：如果在使用中發現某網站還有提供找回密碼的功能，就要好好擔心下這個網站的安全性了。</li></ul><p>看到這裡有些同學會覺得那麼我們是不是對用戶輸入的密碼進行一次MD5加密就可以了呢，這樣就算惡意用戶知道了hash值，也沒有辦法拿到用戶的真實密碼。假設用戶的密碼是123456789，經過一次md5以後得到的值是:</p><p>25f9e794323b453885f5181f1b624d0b</p><p>那麼是不是使用了這個加密後的字符串來存密碼就萬無一失了呢，理想總是很豐滿，而現實總是很骨感的。</p><p>大家可以看一下這個網站：</p><p>https://www.cmd5.com/</p><p>這裡是該網站的相關介紹：</p><blockquote><p>本站針對md5、sha1等全球通用公開的加密算法進行反向查詢，通過窮舉字符組合的方式，創建了明文密文對應查詢數據庫，創建的記錄約90萬億條，佔用硬盤超過500TB，查詢成功率95%以上，很多複雜密文只有本站才可查詢。已穩定運行十餘年，國內外享有盛譽</p></blockquote><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4346d58f94214be087de51b8c9405aef><p class=pgc-img-caption></p></div><p>那麼一般針對這種問題，我們的解決之道就是引入salt(加鹽)，即利用特殊字符（鹽）和用戶的輸入合在一起組成新的字符串進行加密。通過這樣的方式，增加了反向查詢的複雜度。但是這樣的方式也不是萬無一失，如果發生了鹽被洩露的問題，就需要所有用到的地方來重置密碼。</p><p>針對salt洩露的問題，其實還有一種解決辦法，即使用HMAC進行加密（Hash-based Message Authentication Code）。這種算法的核心思路是加密使用的key是從服務器端獲取的，每一個用戶的是不一樣的。如果發生了洩露，那麼也就是這一個用戶的會被洩露，不會影響到全局。</p><p>這裡也留給大家一個思考點，如果惡意用戶直接抓取了你的活動參與鏈接，也就是拿到了你計算後的hash值，那從技術的角度上說，我們還有沒有其他可以提升惡意用戶的違法成本呢？</p><h1 class=pgc-h-arrow-right><strong>4.2 數據校驗</strong></h1><p>- <strong>git commit id</strong><br>使用過git的同學都應該清楚，每次git提交後都有一個commit id，比如:</p><p>19d02d2cc358e59b3d04f82677dbf3808ae4fc40</p><p>就是一次git commit的結果，那麼這個id是如何生成出來的呢？查閱了相關資料，使用如下代碼可以進行查看：</p><pre><code>printf "commit %s\0" $(git cat-file commit HEAD | wc -c); git cat-file commit HEAD</code></pre><p>git的commit id主要包括了以下幾部分內容：Tree 哈希，parent哈希、作者信息和本次提交的備註。</p><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4734c703476649409677c3861d0eca50><p class=pgc-img-caption></p></div><p>針對這些信息進行SHA-1 算法後得到值就是本次提交的commit id。簡單來講，就是對於單次提交的頭信息的一個校驗和。</p><blockquote><p>Linux kernel開創者和Git的開發者——Linus說，Git使用了sha1並非是為了安全性，而是為了數據的完整性；它可以保證，在很多年後，你重新checkout某個commit時，一定是它多年前的當時的狀態，完全一模一樣，完全值得信任。</p></blockquote><p>但最新研究表明，理論上對其進行哈希碰撞（hash collision，不同的兩塊數據有相同的hash值）的攻擊可以在2^51（2的51次方）左右的次數內實現。不過由於commit id 是針對單個倉庫裡的，所以實際應用中我們可以認為如果兩個文件的SHA-1值是相同的，那麼它們確是完全相同的內容。</p><p><em>注：對於git裡tree、parent等結構感興趣的同學，可以參考下這篇文章《Git 內部原理 - Git 對象》，這裡由於篇幅原因就不進行深入分析了。</em></p><ul><li><strong>版權校驗</strong><br>在數據校驗方面的另一個應用場景就是版權的保護或者違禁信息的打擊，比如某個小視頻，第一個用戶上傳的時候，我們認為是版權所有者，計算一個hash值存下來。當第二個用戶上傳的時候，同樣計算hash值，如果hash值一樣的話，就算同一個文件。這種方案其實也給用戶傳播違禁文件提高了一些門檻，不是簡單的換一個名字或者改一下後綴名就可以躲避掉打擊了。（當然這種方式也是可以繞過的，圖片的你隨便改一下顏色，視頻去掉一幀就又是完全不同的hash值了。注意：我沒有教你變壞，我只是和你在討論這個技術。。。）另外我們在社區裡，也會遇到玩家重複上傳同一張圖片或者視頻的情況，使用這種校驗的方式，可以有效減少cos服務的存儲空間。</li><li><strong>大文件分塊校驗</strong><br>使用過bt的同學都有經驗，在p2p網絡中會把一個大文件拆分成很多小的數據各自傳輸。這樣的好處是如果某個小的數據塊在傳輸過程中損壞了，只要重新下載這個塊就好。為了確保每一個小的數據塊都是發佈者自己傳輸的，我們可以對每一個小的數據塊都進行一個hash的計算，維護一個hash List，在收到所有數據以後，我們對於這個hash List裡的每一塊進行遍歷比對。這裡有一個優化點是如果文件分塊特別多的時候，如果遍歷對比就會效率比較低。可以把所有分塊的hash值組合成一個大的字符串，對於這個字符串再做一次Hash運算，得到最終的hash（Root hash）。在實際的校驗中，我們只需要拿到了正確的Root hash，即可校驗Hash List，也就可以校驗每一個數據塊了。</li></ul><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3b08beae88844d28ab324407781ecee8><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>4.3 負載均衡</strong></h1><p>活動開發同學在應對高星級業務大用戶量參與時，都會使用分庫分表，針對用戶的openid進行hashtime33取模，就可以得到對應的用戶分庫分表的節點了。</p><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e3460cbfce2342a19b0c1f851486ab40><p class=pgc-img-caption></p></div><p>如上圖所示，這裡其實是分了10張表，openid計算後的hash值取模10，得到對應的分表，在進行後續處理就好。對於一般的活動或者系統，我們一般設置10張表或者100張表就好。</p><p>下面我們來看一點複雜的問題，假設我們活動初始分表了10張，運營一段時間以後發現需要10張不夠，需要改到100張。這個時候我們如果直接擴容的話，那麼所有的數據都需要重新計算Hash值，大量的數據都需要進行遷移。如果更新的是緩存的邏輯，則會導致大量緩存失效，發生雪崩效應，導致數據庫異常。造成這種問題的原因是hash算法本身的緣故，只要是取模算法進行處理，則無法避免這種情況。針對這種問題，我們就需要利用一致性hash進行相應的處理了。</p><p>一致性hash的基本原理是將輸入的值hash後，對結果的hash值進行2^32取模，這裡和普通的hash取模算法不一樣的點是在一致性hash算法裡將取模的結果映射到一個環上。將緩存服務器與被緩存對象都映射到hash環上以後，從被緩存對象的位置出發，沿順時針方向遇到的第一個服務器，就是當前對象將要緩存於的服務器，由於被緩存對象與服務器hash後的值是固定的，所以，在服務器不變的情況下，一個openid必定會被緩存到固定的服務器上，那麼，當下次想要訪問這個用戶的數據時，只要再次使用相同的算法進行計算，即可算出這個用戶的數據被緩存在哪個服務器上，直接去對應的服務器查找對應的數據即可。這裡的邏輯其實和直接取模的是一樣的。如下圖所示：</p><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/979b615822d54d0dab65686a4459e516><p class=pgc-img-caption></p></div><p>初始情況如下：用戶1的數據在服務器A裡，用戶2、3的數據存在服務器C裡，用戶4的數據存儲在服務器B裡</p><p>下面我們來看一下當服務器數量發生變化的時候，相應影響的數據情況：</p><ul><li><strong>服務器縮容</strong></li></ul><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/386eb329b12940219918457f7c487d49><p class=pgc-img-caption></p></div><p>服務器B發生了故障，進行剔除後，只有用戶4的數據發生了異常。這個時候我們需要繼續按照順時針的方案，把緩存的數據放在用戶A上面。</p><ul><li><strong>服務器擴容</strong><br>同樣的，我們進行了服務器擴容以後，新增了一臺服務器D，位置落在用戶2和3之間。按照順時針原則，用戶2依然訪問的是服務器C的數據，而用戶3順時針查詢後，發現最近的服務器是D，後續數據就會存儲到d上面。</li></ul><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/5ab11b1be36c4e6e83310d9c3e997db9><p class=pgc-img-caption></p></div><ul><li><strong>虛擬節點</strong><br>當然這只是一種理想情況，實際使用中，由於服務器節點數量有限，有可能出現分佈不均勻的情況。這個時候會出現大量數據都被映射到某一臺服務器的情況，如下圖左側所示。為了解決這個問題，我們採用了虛擬節點的方案。虛擬節點是實際節點（實際的物理服務器）在hash環上的複製品，一個實際節點可以對應多個虛擬節點。虛擬節點越多，hash環上的節點就越多，數據被均勻分佈的概率就越大。</li></ul><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/73bb40c5ce65468cb80249ac4d86b9d8><p class=pgc-img-caption></p></div><p>如右圖所示，B、C、D 是原始節點複製出來的虛擬節點，原本都要訪問機器D的用戶1、4，分別被映射到了B,D。通過這樣的方式，起到了一個服務器均勻分佈的作用。</p><h1 class=pgc-h-arrow-right><strong>5、幾種hash算法的擴展應用</strong></h1><p>下面介紹幾種大家可能不經常遇到的應用，由於篇幅原因，不做深入介紹，只拋磚引玉。</p><h1 class=pgc-h-arrow-right><strong>5.1 SimHash</strong></h1><p>simHash是google用於海量文本去重的一種方法，它是一種局部敏感hash。那什麼叫局部敏感呢，假定兩個字符串具有一定的相似性，在hash之後，仍然能保持這種相似性，就稱之為局部敏感hash。普通的hash是不具有這種屬性的。simhash被Google用來在海量文本中去重。</p><p>simHash算法的思路大致如下：</p><ul><li>將Doc進行關鍵詞抽取(其中包括分詞和計算權重)，抽取出n個(關鍵詞，權重)對， 即圖中的多個(feature, weight)。記為 feature_weight_pairs = [fw1, fw2 … fwn]，其中 fwn = (feature_n,weight_n)。</li><li>對每個feature_weight_pairs中的feature進行hash。然後對hash_weight_pairs進行位的縱向累加，如果該位是1，則+weight,如果是0，則-weight，最後生成bits_count個數字，大於0標記1，小於0標記0</li><li>最後轉換成一個64位的字節，判斷重複只需要判斷他們的特徵字的距離是不是&lt;n (n根據經驗一般取3)，就可以判斷兩個文檔是否相似。</li></ul><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/aab9d26ac607447da31685663e97161f><p class=pgc-img-caption></p></div><p>如下圖所示，當兩個文本只有一個字變化時，如果使用普通Hash則會導致兩次的結果發生較大改變，而SimHash的局部敏感特性，會導致只有部分數據發生變化。</p><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/64b1c2744e5a4533af9b48a1dbfbc3b7><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>5.2 GeoHash</strong></h1><p>GeoHash將地球作為為一個二維平面進行遞歸分解。每個分解後的子塊在一定經緯度範圍內擁有相同的編碼。以下圖為例，這個矩形區域內所有的點（經緯度座標）都共享相同的GeoHash字符串，這樣既可以保護隱私（只表示大概區域位置而不是具體的點），又比較容易做緩存。</p><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ae41246757ef46a5ac44e95d04df2c00><p class=pgc-img-caption></p></div><p>下面以一個例子來理解下這個算法，我們對緯度39.3817進行逼近編碼 ：</p><ul><li>地球緯度區間是[-90,90]，對於這個區間進行二分劃分左區間[-90,0), 右區間[0,90]。39.3817屬於右區間，標記為1</li><li>將右區間[0,90]繼續進行劃分，左區間[0,45) ,右區間[45,90]。39.3817屬於左區間，標記為0</li><li>遞歸上面的過程，隨著每次迭代，區間[a，b]會不斷接近39.3817。遞歸的次數決定了生成的序列長度。</li><li>對於經度做同樣的處理。得到的字符串，偶數位放經度，奇數位放緯度，把2串編碼組合生成新串。對於新串轉成對應10進制查出實際的base32編碼就是類似WX4ER的hash值。</li></ul><p>整體遞歸過程如下表所示：</p><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/28064456e5924cc7a8cbd3dfea984ce1><p class=pgc-img-caption></p></div><p>這裡有一篇文章詳細介紹了GeoHash，有興趣的同學可以移步這裡：</p><p>騰訊技術工程：app 是如何快速定位我們位置的？深入瞭解 geohash 算法及其實現</p><h1 class=pgc-h-arrow-right><strong>5.3 布隆過濾器</strong></h1><p>布隆過濾器被廣泛用於黑名單過濾、垃圾郵件過濾、爬蟲判重系統以及緩存穿透問題。對於數量小，內存足夠大的情況，我們可以直接用hashMap或者hashSet就可以滿足這個活動需求了。但是如果數據量非常大，比如5TB的硬盤上放滿了用戶的參與數據，需要一個算法對這些數據進行去重，取得活動的去重參與用戶數。這種時候，布隆過濾器就是一種比較好的解決方案了。</p><p>布隆過濾器其實是基於bitmap的一種應用，在1970年由布隆提出的。它實際上是一個很長的二進制向量和一系列隨機映射函數，用於檢索一個元素是否在一個集合中。它的優點是空間效率和查詢時間都遠遠超過一般的算法，缺點是有一定的誤識別率和刪除困難，主要用於大數據去重、垃圾郵件過濾和爬蟲url記錄中。核心思路是使用一個bit來存儲多個元素，通過這樣的方式來減少內存的消耗。通過多個hash函數，將每個數據都算出多個值，存放在bitmap中對應的位置上。</p><p>布隆過濾器的原理見下圖所示：</p><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c69abb1c64e54775b9ce916239fd0927><p class=pgc-img-caption></p></div><p>上圖所示的例子中，數據a、b、c經過三次hash映射後，對應的bit位都是1，表示這三個數據已經存在了。而d這份數據經過映射後有一個結果是0，則表明d這個數據一定沒有出現過。布隆過濾器存在假陽率（判定存在的元素可能不存在）的問題，但是沒有假陰率（判斷不存在的原因可能存在）的問題。即對於數據e，三次映射的結果都是1，但是這份數據也可能沒有出現過。</p><p>誤判率的數據公式如下所示：</p><div class=pgc-img><img alt=到底什麼是Hash？Hash算法的原理和實際應用講解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f4ff50061c2849e0b8788bc5e34db884><p class=pgc-img-caption></p></div><p>其中，p是誤判率，n是容納的元素，m是需要的存儲空間。由公式可以看出，布隆過濾器的長度會直接影響誤報率，布隆過濾器越長其誤報率越小。哈希函數的個數也需要權衡，個數越多則布隆過濾器 bit 位置位 1 的速度越快，且布隆過濾器的效率越低；但是如果太少的話，則會導致誤報率升高。</p><h1 class=pgc-h-arrow-right><strong>6、總結</strong></h1><p>Hash算法作為一種活動開發經常遇到的算法，我們在使用中不僅僅要知道這種算法背後真正的原理，才可以在使用上做到有的放矢。Hash的相關知識還有很多，有興趣的同學可以繼續深入研究。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Hash</a></li><li><a>什麼</a></li><li><a>實際</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E5%AD%B8/228f5e01.html alt=為什麼很多公司的法人不是實際控制人呢？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/f8f6f27c-fdac-41a7-8823-c98d984ffdb6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/228f5e01.html title=為什麼很多公司的法人不是實際控制人呢？>為什麼很多公司的法人不是實際控制人呢？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bdedb94f.html alt=科普貼！丨你知道港珠澳大橋為什麼是彎的嗎！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/d84b472b45474058bfd6bd4b87450f53 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bdedb94f.html title=科普貼！丨你知道港珠澳大橋為什麼是彎的嗎！>科普貼！丨你知道港珠澳大橋為什麼是彎的嗎！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/52ecc739.html alt=科普！看完這篇文章，你就知道港珠澳大橋為什麼是彎的了！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8f0b8a6daf6e4f9bab21e7c06cbc9111 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/52ecc739.html title=科普！看完這篇文章，你就知道港珠澳大橋為什麼是彎的了！>科普！看完這篇文章，你就知道港珠澳大橋為什麼是彎的了！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8bbd5f8a.html alt=長知識！什麼是榫卯結構？為什麼現代建築當中不常見了？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1537941825042b6f495fa56 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8bbd5f8a.html title=長知識！什麼是榫卯結構？為什麼現代建築當中不常見了？>長知識！什麼是榫卯結構？為什麼現代建築當中不常見了？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/83641773.html alt=什麼是懸挑結構？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/faebf061b82546f58e63afab5ede5fa2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/83641773.html title=什麼是懸挑結構？>什麼是懸挑結構？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a27253ff.html alt=港珠澳大橋為什麼是曲線的？關於橋那些你不知道的事 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/a3c45dcf4c374ed4be36f55d44847637 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a27253ff.html title=港珠澳大橋為什麼是曲線的？關於橋那些你不知道的事>港珠澳大橋為什麼是曲線的？關於橋那些你不知道的事</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3eed9cb8.html alt=科普！港珠澳大橋為什麼是彎的！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/41bd66f3348b464c89b66628810a1aeb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3eed9cb8.html title=科普！港珠澳大橋為什麼是彎的！>科普！港珠澳大橋為什麼是彎的！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/765025c9.html alt=電纜與光纜有什麼區別 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1c289a44885646ac904fbae012632866 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/765025c9.html title=電纜與光纜有什麼區別>電纜與光纜有什麼區別</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c5053ab7.html alt="網站服務器是什麼 網站服務器怎麼搭建「詳解」" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f9cfb6ae0c13447eab17646a80117f1b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c5053ab7.html title="網站服務器是什麼 網站服務器怎麼搭建「詳解」">網站服務器是什麼 網站服務器怎麼搭建「詳解」</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3b60dd43.html alt=長壽者的耳朵為什麼比別人長？原來耳朵還有這個大祕密 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/616a0000c4f325f77564 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3b60dd43.html title=長壽者的耳朵為什麼比別人長？原來耳朵還有這個大祕密>長壽者的耳朵為什麼比別人長？原來耳朵還有這個大祕密</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2c33cb41.html alt=為什麼每天都那麼累？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/S2HRVEQ6t1WhxB style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2c33cb41.html title=為什麼每天都那麼累？>為什麼每天都那麼累？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3f7c0fd3.html alt=什麼是場景？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3f7c0fd3.html title=什麼是場景？>什麼是場景？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bd2acf38.html alt=寫場面要注意什麼？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/4e5a000167e332d06355 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bd2acf38.html title=寫場面要注意什麼？>寫場面要注意什麼？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bdc59733.html alt="網絡詞名場面是什麼意思 名場面是什麼梗" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bdc59733.html title="網絡詞名場面是什麼意思 名場面是什麼梗">網絡詞名場面是什麼意思 名場面是什麼梗</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/31ba8cf2.html alt=[科普知識]什麼是光纖的冷接？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/c9d2cd0e63c0404f9f4cbdaae98d9606 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/31ba8cf2.html title=[科普知識]什麼是光纖的冷接？>[科普知識]什麼是光纖的冷接？</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>