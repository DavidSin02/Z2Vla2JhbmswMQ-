<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>為深度學習模型加載自定義圖像數據集 | 极客快訊</title><meta property="og:title" content="為深度學習模型加載自定義圖像數據集 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/2688ec63f94347f59c16e136741e70df"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a677c055.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a677c055.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a677c055.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a677c055.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a677c055.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a677c055.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a677c055.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a677c055.html><meta property="article:published_time" content="2020-11-14T21:02:25+08:00"><meta property="article:modified_time" content="2020-11-14T21:02:25+08:00"><meta name=Keywords content><meta name=description content="為深度學習模型加載自定義圖像數據集"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/a677c055.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>為深度學習模型加載自定義圖像數據集</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>在本文中，你將學習如何加載自定義數據和創建圖像序列和測試數據集，作為深度學習模型的輸入。</p><ul><li><strong>Open CV2</strong></li><li><strong>PIL</strong></li></ul><p>這裡使用的數據集是來自Kaggle的Intel圖像分類。</p><p>數據集鏈接：https://www.kaggle.com/puneet6060/intel-image-classification/version/2</p><p>“Intel圖像分類”數據集已分為train、test和Val，我們將僅使用訓練數據集學習如何使用不同的庫加載數據集。</p><p><strong>為深度學習模型加載自定義數據集的典型步驟</strong></p><ol start=1><li>打開圖像文件。文件的格式可以是JPEG、PNG、BMP等。</li><li>調整圖像大小以匹配深度學習模型的輸入層的輸入大小。</li><li>將圖像像素轉換為浮點數據類型。</li><li>將圖像標準化，使像素值在0到1之間。</li><li>深度學習模型的圖像數據應該是一個numpy數組或一個張量對象。</li></ol><p><strong>自定義圖像數據的文件夾結構</strong></p><div class=pgc-img><img alt=為深度學習模型加載自定義圖像數據集 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2688ec63f94347f59c16e136741e70df><p class=pgc-img-caption></p></div><p>每個類都是一個文件夾，其中包含該特定類的圖像。</p><p><strong>使用CV2加載圖像數據</strong></p><p>導入所需的庫</p><pre><code>import pandas as pdimport numpy as npimport osimport tensorflow as tfimport cv2from tensorflow import kerasfrom tensorflow.keras import layers, Dense, Input, InputLayer, Flattenfrom tensorflow.keras.models import Sequential, Modelfrom  matplotlib import pyplot as pltimport matplotlib.image as mpimg%matplotlib inline</code></pre><p>從其中一個文件夾中隨機輸出五張圖像</p><pre><code>plt.figure(figsize=(20,20))test_folder=r'CV\Intel_Images\seg_train\seg_train\forest'for i in range(5):    file = random.choice(os.listdir(img_folder))    image_path= os.path.join(img_folder, file)    img=mpimg.imread(image_path)    ax=plt.subplot(1,5,i+1)    ax.title.set_text(file)    plt.imshow(img)</code></pre><div class=pgc-img><img alt=為深度學習模型加載自定義圖像數據集 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/51ad21736fcc48d6986bf0801e22296b><p class=pgc-img-caption></p></div><p><strong>設置用於加載數據集的圖像維度和源文件夾</strong></p><pre><code>IMG_WIDTH=200IMG_HEIGHT=200img_folder=r'CV\Intel_Images\seg_train\seg_train\'</code></pre><p><strong>從文件夾中的圖像創建圖像數據和標籤</strong></p><p>在下面的函數中</p><ul><li>source文件夾是包含不同類的圖像的輸入參數。</li><li>從文件夾中讀取圖像文件並將其轉換為正確的顏色格式。</li><li>根據模型所需的輸入尺寸調整圖像大小</li><li>將圖像轉換為數據類型為float32的Numpy數組</li><li>將圖像數組標準化，使值在0和1之間，這有助於更快地收斂。</li></ul><pre><code>def create_dataset(img_folder):    img_data_array=[]    class_name=[]    for dir1 in os.listdir(img_folder):        for file in os.listdir(os.path.join(img_folder, dir1)):            image_path= os.path.join(img_folder, dir1,  file)            image= cv2.imread( image_path, cv2.COLOR_BGR2RGB)            image=cv2.resize(image, (IMG_HEIGHT, IMG_WIDTH),interpolation = cv2.INTER_AREA)            image=np.array(image)            image = image.astype('float32')            image /= 255             img_data_array.append(image)            class_name.append(dir1)    return img_data_array, class_name# extract the image array and class nameimg_data, class_name =create_dataset(r'CV\Intel_Images\seg_train\seg_train')</code></pre><p><strong>將文本標籤轉換為數字編碼</strong></p><p>為類的所有唯一值創建字典</p><pre><code>target_dict={k: v for v, k in enumerate(np.unique(class_name))}target_dict</code></pre><div class=pgc-img><img alt=為深度學習模型加載自定義圖像數據集 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c54974e6b37a460b97cc1bfd25c91db8><p class=pgc-img-caption></p></div><p>根據字典將類名稱轉換為各自的數值</p><pre><code>target_val=  [target_dict[class_name[i]] for i in range(len(class_name))]</code></pre><p>創建一個簡單的深度學習模型並編譯它</p><pre><code>model=tf.keras.Sequential(        [            tf.keras.layers.InputLayer(input_shape=(IMG_HEIGHT,IMG_WIDTH, 3)),            tf.keras.layers.Conv2D(filters=32, kernel_size=3, strides=(2, 2), activation='relu'),            tf.keras.layers.Conv2D(filters=64, kernel_size=3, strides=(2, 2), activation='relu'),            tf.keras.layers.Flatten(),            tf.keras.layers.Dense(6)        ])encoder.compile(optimizer='rmsprop', loss='sparse_categorical_crossentropy', metrics=['accuracy'])</code></pre><p>我們最終調整數據集來訓練模型。我們可以使用Numpy數組作為輸入</p><pre><code>history = model.fit(x=np.array(img_data, np.float32), y=np.array(list(map(int,target_val)), np.float32), epochs=5)</code></pre><p>我們還可以使用tf.cast()將輸入數據轉換為張量來訓練模型。</p><pre><code>history = model.fit(x=tf.cast(np.array(img_data), tf.float64), y=tf.cast(list(map(int,target_val)),tf.int32), epochs=5)</code></pre><p>我們使用不同的庫加載圖像數據集但是我們使用相同的模型來進行進一步的訓練</p><h1 class=pgc-h-arrow-right>用PIL加載圖像數據</h1><p>添加附加庫以使用PIL加載圖像數據集</p><pre><code>from PIL import Image</code></pre><p>使用PIL從文件夾中的圖像創建圖像數據和標籤</p><p>在下面的函數中</p><ul><li>source文件夾是包含不同類的圖像的輸入參數。</li><li>使用PIL從文件夾中打開圖像文件。</li><li>根據模型所需的輸入尺寸調整圖像大小</li><li>將圖像轉換為數據類型為float32的Numpy數組</li><li>標準化圖像數組以加快收斂。</li></ul><pre><code>def create_dataset_PIL(img_folder):    img_data_array=[]    class_name=[]    for dir1 in os.listdir(img_folder):        for file in os.listdir(os.path.join(img_folder, dir1)):            image_path= os.path.join(img_folder, dir1,  file)            image= np.array(Image.open(image_path))            image= np.resize(image,(IMG_HEIGHT,IMG_WIDTH,3))            image = image.astype('float32')            image /= 255              img_data_array.append(image)            class_name.append(dir1)    return img_data_array , class_namePIL_img_data, class_name=create_dataset_PIL(img_folder)</code></pre><p><strong>將文本標籤轉換為數字編碼</strong></p><p>下面是我們在CV2中使用的代碼</p><pre><code>target_dict={k: v for v, k in enumerate(np.unique(class_name))}target_val=  [target_dict[class_name[i]] for i in range(len(class_name))]</code></pre><p>創建和編譯一個簡單的深度學習模型</p><pre><code>model=tf.keras.Sequential(        [            tf.keras.layers.InputLayer(input_shape=(IMG_HEIGHT,IMG_WIDTH, 3)),            tf.keras.layers.Conv2D(filters=32, kernel_size=3, strides=(2, 2), activation='relu'),            tf.keras.layers.Conv2D(filters=64, kernel_size=3, strides=(2, 2), activation='relu'),            tf.keras.layers.Flatten(),            tf.keras.layers.Dense(6)        ])encoder.compile(optimizer='rmsprop', loss='sparse_categorical_crossentropy', metrics=['accuracy'])</code></pre><p>我們最終調整數據集來訓練模型。我們可以使用Numpy數組作為輸入</p><pre><code>history = model.fit(x=np.array(PIL_img_data, np.float32), y=np.array(list(map(int,target_val)), np.float32), epochs=5)</code></pre><p>我們還可以使用tf.cast()將輸入數據轉換為張量來訓練模型。</p><pre><code>history = model.fit(x=tf.cast(np.array(PIL_img_data), tf.float64), y=tf.cast(list(map(int,target_val)),tf.int32), epochs=5)</code></pre><p>除了幾個步驟外，使用CV2和PIL加載數據集的過程是相同的。</p><p>現在這將幫助你使用CV2和PIL庫加載數據集。</p><p>這裡提供了使用CV2和PIL加載數據集的代碼：https://github.com/arshren/Load_Dataset</p><p>在下一篇文章中，我們將使用以下的庫來加載數據集。</p><ul><li><strong>Keras</strong></li><li><strong>tf.data</strong></li></ul></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>學習</a></li><li><a>加載</a></li><li><a>義圖</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/dc2af9c9.html alt=機器學習筆記(七)——初識邏輯迴歸、不同方法推導梯度公式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/13adbab9c7f94c7fa81d49a98861b051 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dc2af9c9.html title=機器學習筆記(七)——初識邏輯迴歸、不同方法推導梯度公式>機器學習筆記(七)——初識邏輯迴歸、不同方法推導梯度公式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e214e6d7.html alt=深度學習/機器學習入門數學知識整理（二）梯度與導數，泰勒展開 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1540372101455de0fb74774 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e214e6d7.html title=深度學習/機器學習入門數學知識整理（二）梯度與導數，泰勒展開>深度學習/機器學習入門數學知識整理（二）梯度與導數，泰勒展開</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f3767255.html alt=講透機器學習中的梯度下降 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5c80301e53424671bc22755be2e4ee33 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f3767255.html title=講透機器學習中的梯度下降>講透機器學習中的梯度下降</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ac12f3a1.html alt=直流鍋爐給水控制學習 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/eba10edcc8d14d9f8cde6fd5b212d90e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ac12f3a1.html title=直流鍋爐給水控制學習>直流鍋爐給水控制學習</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a1bc38f3.html alt=HTMLCSS學習筆記（六）——元素類型 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bdb5988349894ce9bf568c6418f85b7d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a1bc38f3.html title=HTMLCSS學習筆記（六）——元素類型>HTMLCSS學習筆記（六）——元素類型</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/97886d06.html alt="web前端（從零開始），每天更新學習筆記 HTML5元素分類" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/46d70004fcd55e1ddad3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/97886d06.html title="web前端（從零開始），每天更新學習筆記 HTML5元素分類">web前端（從零開始），每天更新學習筆記 HTML5元素分類</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c9091681.html alt="MySQL 學習筆記" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c9091681.html title="MySQL 學習筆記">MySQL 學習筆記</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/175f9730.html alt=深入學習MySQL事務：ACID特性的實現原理「轉」 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/cdc702d66d6943499997d11e931425eb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/175f9730.html title=深入學習MySQL事務：ACID特性的實現原理「轉」>深入學習MySQL事務：ACID特性的實現原理「轉」</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f6b2ef73.html alt=如何學習模擬IC設計？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f6b2ef73.html title=如何學習模擬IC設計？>如何學習模擬IC設計？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c56ee116.html alt=小猿圈python學習-三大特性之多態 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ad0e8e3777854337abeb7c779ad79a04 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c56ee116.html title=小猿圈python學習-三大特性之多態>小猿圈python學習-三大特性之多態</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/03a295fc.html alt=地理學習5——地球的運動（地球的公轉及其地理意義） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7b2b74c871eb40beb8ee143627d29611 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/03a295fc.html title=地理學習5——地球的運動（地球的公轉及其地理意義）>地理學習5——地球的運動（地球的公轉及其地理意義）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ebad378f.html alt=繼續學習打卡，還真心學不會了，努力，堅持 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f36d6d47a06840aaaf78138853b9d9d1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ebad378f.html title=繼續學習打卡，還真心學不會了，努力，堅持>繼續學習打卡，還真心學不會了，努力，堅持</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ce278cf4.html alt=機器學習時代的哈希算法，將如何更高效地索引數據 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1525617261534ad07c6455c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ce278cf4.html title=機器學習時代的哈希算法，將如何更高效地索引數據>機器學習時代的哈希算法，將如何更高效地索引數據</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/346037ff.html alt=淺談機器學習時代的哈希算法（一） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1525788510275af3193bcdc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/346037ff.html title=淺談機器學習時代的哈希算法（一）>淺談機器學習時代的哈希算法（一）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/84501417.html alt="為什麼 HashMap 的加載因子是0.75？" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6cbd09e4427c44c082e15ec40e24b6f5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/84501417.html title="為什麼 HashMap 的加載因子是0.75？">為什麼 HashMap 的加載因子是0.75？</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>