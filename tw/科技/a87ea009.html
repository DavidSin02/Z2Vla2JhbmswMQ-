<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>操作系統 - 中斷 | 极客快訊</title><meta property="og:title" content="操作系統 - 中斷 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/e5a3cb6cc12e4b3880e8b1ce8e6f32ca"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a87ea009.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a87ea009.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a87ea009.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a87ea009.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a87ea009.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a87ea009.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/a87ea009.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/a87ea009.html><meta property="article:published_time" content="2020-10-29T21:09:37+08:00"><meta property="article:modified_time" content="2020-10-29T21:09:37+08:00"><meta name=Keywords content><meta name=description content="操作系統 - 中斷"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/a87ea009.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>操作系統 - 中斷</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>讓我們先考慮一個典型的計算機操作：一個執行輸入輸出的程序。</p><p>為了開始一個輸入輸出的操作，設備驅動先把合適的寄存器裝載進設備控制器。</p><p>接著，設備控制器檢查這些寄存器裡的內容，然後再決定執行怎麼樣的操作。</p><p>控制器開始把數據從設備傳送到本地緩存。一旦傳輸完成，設備控制器會通知設備驅動傳輸數據完成。然後，設備驅動會把控制權限給予操作系統中其他的部分。這裡如果是讀操作的話，設備驅動會直接返回數據或是指向數據的指針；如果是其他操作的話，設備驅動可能返回諸如“寫成功”或“設備正忙”的信息。</p><div class=pgc-img><img alt="操作系統 - 中斷" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e5a3cb6cc12e4b3880e8b1ce8e6f32ca><p class=pgc-img-caption></p></div><p><br></p><p>但是，控制器是怎麼通知設備驅動---它已經完成了操作呢？這是通過“<strong>中斷interrupt</strong>”來完成的。</p><hr><p>硬件可以在任何時候，通過發送一個信號給CPU，從而觸發一箇中斷，通常是通過系統總線。（在計算機系統中有許多總線，但系統總線是絕大多數部件之間的主要通訊途徑）。中斷也被用作其他的目的並且是硬件和操作系統中交互的重要部分。</p><p>當CPU被中斷時，他會把當前正在做的事情停下來，並且立即把執行的場所轉移到一個固定的地方。這個固定的地方通常是中斷服務程序所在的開始的地方。然後，中斷服務程序執行。程序執行完以後，CPU會恢復到中斷前的正在做的事情。</p><p>上述操作的時間軸如下：</p><div class=pgc-img><img alt="操作系統 - 中斷" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/84571d34eca9430ea4d78fd9b078c290><p class=pgc-img-caption></p></div><p>中斷是計算機架構中的一個重要部分。每個計算機的設計都有它自己的中斷機制，但有幾個功能是相同的。中斷必須傳輸控制給合適中斷服務程序。最直接的管理這個傳輸的方法是調用一個最通用的程序去檢查中斷信息。然後，這個程序會去調用中斷指定的處理中斷的程序。</p><p>然而，因為中斷髮生的很快，所以中斷必須快速的處理。中斷程序的<strong>指針表(table of pointers)</strong>被用來滿足這樣的速度。中斷程序間接得從這張表中被調用，並且無需中間的服務程序。</p><p>一般情況下，指針表被存儲在內存的低地址段（前100位置）。這些位置存儲著不同設備的中斷服務程序的地址。這個地址數組，或者說是地址的<strong>中斷向量表interrupt vector</strong>，每一項都有一個獨一無二的索引，去映射中斷請求，然後查找出中斷服務程序所在的地址。像Windows和Unix這樣不同的操作系統，也都是以這種方式調度中斷的。</p><p>無論什麼被中斷了，中斷架構必須要存儲狀態信息，以便於在中斷服務程序完成後恢復信息。如果中斷程序需要修改處理器的狀態，比如說修改寄存器值，它必須明確地保存當前的狀態，然後在中斷返回前恢復原先的狀態。中斷服務完成後，中斷前程序運行的地址被裝載回去，然後繼續運行原有的程序，就好像中斷沒發生過一樣。</p><hr><p>最基本的中斷機制是這樣工作的：</p><ul><li>CPU的硬件上有一根被稱為中斷申請的線路，每次執行完一條指令後，CPU都會感知一下這條線路</li><li>當CPU偵測到一個控制器在這條線路上觸發了一個信號，它會讀取中斷信號的數值，把這個當作索引，去中斷向量表中查找對應的中斷程序的入口地址。</li><li>然後從這個地址開始執行程序</li><li>中斷程序會先保存它在執行期間會改變的任何狀態，確定中斷的原因，執行必要的處理，執行狀態的恢復，然後通過執行“return_from_interrupts”指令，讓CPU返回到中斷前執行狀態。</li></ul><p>習慣上，我們是這麼描述上述行為的：</p><ul><li>設備控制器在CPU的中斷申請線路上通過發出一個信號而<strong>raise</strong>了一箇中斷</li><li>CPU<strong>catch</strong>了這個中斷，然後通過它<strong>dispatch</strong>對應的中斷處理程序</li><li>中斷程序<strong>clear</strong>中斷</li></ul><p>具體描述如下圖：</p><div class=pgc-img><img alt="操作系統 - 中斷" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/7fccc02855ca4935bf739d97acc2cdb1><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>中斷的實現</h1><p>基本中斷機制描述了當設備控制器準備好服務時，怎麼讓CPU去迴應這樣一個異步的事件。然而在現代的操作系統中，我們需要更加複雜的處理中斷的特性：</p><ol start=1><li>當我們在處理一些很關鍵很重要的程序時，我們不希望被中斷打擾，又不想丟棄這個中斷，因此我們需要推遲這個中斷的機制。</li><li>我們需要一個高效率的方法去為設備調度合適的中端處理程序。</li><li>我們需要多級別的中斷，好讓操作系統區分低優先級和高優先級，然後按照緊急程度去調度調度中斷程序。</li></ol><p>在現在計算機硬件中，這三個特性由CPU提供，被稱為硬件中斷（interupt-controller hardware）。</p><p>大多數的CPU有兩條中斷申請線路。一條是不可屏蔽中斷（nonmaskable interrupt），用來為諸如不可恢復的內存錯誤的事件服務；第二條線路是可屏蔽的，當CPU在執行一些關鍵的不能被中斷程序指令前，CPU可以先關閉這些中斷。<strong>可屏蔽中斷線路被設備控制器用來申請中斷</strong>。</p><p>向量化中斷機制的目的為了避免單箇中斷申請必須去從所有的中斷處理中去查找匹配的中斷處理程序。實際上，計算機有遠比向量表中地址所能容納的更多的設備。一個通常的做法是使用<strong>中端鏈接interrupt chaining</strong>，也就是讓每一箇中斷處理形成一個鏈表，當有一箇中斷申請時，從該鏈表的頭開始查詢，直到查找到匹配的為止。這種結構是一種在超大中斷向量表的開銷和非高效率調度單箇中斷程序間的折中辦法。</p><p>下圖展示了Intel處理器的中斷向量表的設計。從事件編號0到31是不可屏蔽的，用來指示各種各樣的錯誤信息。事件編號32～255是可屏蔽的中斷，被用作一般的設備產生的中斷請求。</p><div class=pgc-img><img alt="操作系統 - 中斷" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/e01e09735a7a465fb5e60d4ff5de2b48><p class=pgc-img-caption></p></div><p>中斷機制也通常以中斷優先級的形式來實現。這些級別可以讓CPU推遲處理低優先級的中斷而不用屏幕所有的終端，並且可以讓高優先級的中斷搶佔（preempt）低優先級的中斷而率先執行。</p><hr><p>總的來說，現代操作系統使用中斷來處理異步事件。設備控制器和硬件錯誤可以產生中斷。現在計算機使用中斷優先級從而讓最緊急的任務最先得到執行。正是因為中斷被大量用於對時間敏感的處理，才需要有效的中斷處理從而能讓我們獲得良好的系統性能。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>系統</a></li><li><a>中斷</a></li><li><a>操作</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/ce9c74e3.html alt=信息系統安全：操作系統安全 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ce9c74e3.html title=信息系統安全：操作系統安全>信息系統安全：操作系統安全</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ac9fd9af.html alt=Linux操作系統：中斷處理過程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/17704512f67548ca96fd8fd620faef19 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ac9fd9af.html title=Linux操作系統：中斷處理過程>Linux操作系統：中斷處理過程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7022912.html alt=什麼是操作系統，操作系統都有哪些？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/9113e93c7ffc45908f24f3815f20997c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7022912.html title=什麼是操作系統，操作系統都有哪些？>什麼是操作系統，操作系統都有哪些？</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/43a8cb7.html alt="操作系統 - 操作系統的調試" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b0c1b20accf448409c81b82f7bcc4bdc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/43a8cb7.html title="操作系統 - 操作系統的調試">操作系統 - 操作系統的調試</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/adc1d50.html alt=操作系統基礎 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/876d7a61014e42409417891da4c2e0a5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/adc1d50.html title=操作系統基礎>操作系統基礎</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0923cc0.html alt=「操作系統」科普一下目前主流的電腦操作系統 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/bd1ebe0977d949de9324ab91ecddce41 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0923cc0.html title=「操作系統」科普一下目前主流的電腦操作系統>「操作系統」科普一下目前主流的電腦操作系統</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/643fc46.html alt=Linux操作系統：中斷類型和中斷的作用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/0d24b57cc77a4ca58d3bba53a1990e63 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/643fc46.html title=Linux操作系統：中斷類型和中斷的作用>Linux操作系統：中斷類型和中斷的作用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d504429.html alt=中斷系統的結構是什麼樣的？瞭解了結構才能進行下一步 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0b59535549314b4c98222a20a991ec6c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d504429.html title=中斷系統的結構是什麼樣的？瞭解了結構才能進行下一步>中斷系統的結構是什麼樣的？瞭解了結構才能進行下一步</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/74a7661.html alt=Linux操作系統：中斷優先級和多重中斷 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f6752484caba4c3b9ae17d93cae63802 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/74a7661.html title=Linux操作系統：中斷優先級和多重中斷>Linux操作系統：中斷優先級和多重中斷</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/031eafc4.html alt=電廠直流系統調試方案 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/5e8200036f19e04c25bf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/031eafc4.html title=電廠直流系統調試方案>電廠直流系統調試方案</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fc3b4b2c.html alt=一文讀懂智能客服：發展歷程、系統搭建、市場推廣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RbYMTZ55OrJUgU style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fc3b4b2c.html title=一文讀懂智能客服：發展歷程、系統搭建、市場推廣>一文讀懂智能客服：發展歷程、系統搭建、市場推廣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/51410370.html alt=生活垃圾焚燒發電及蒸汽系統優化改造項目公告 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RcblrbTDBokV23 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/51410370.html title=生活垃圾焚燒發電及蒸汽系統優化改造項目公告>生活垃圾焚燒發電及蒸汽系統優化改造項目公告</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b4913b56.html alt=電驅動橋系統或加快電氣化進程，多個案例共同說明問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1539571595921bc5b27eff6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b4913b56.html title=電驅動橋系統或加快電氣化進程，多個案例共同說明問題>電驅動橋系統或加快電氣化進程，多個案例共同說明問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9a7b7719.html alt=基於混沌系統的偽隨機數發生器設計 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9a7b7719.html title=基於混沌系統的偽隨機數發生器設計>基於混沌系統的偽隨機數發生器設計</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/99558abe.html alt=win10系統打印機打印不了顯示已暫停的解決方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/10d0de369d4746c7a0c220ff59bd2470 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/99558abe.html title=win10系統打印機打印不了顯示已暫停的解決方法>win10系統打印機打印不了顯示已暫停的解決方法</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>