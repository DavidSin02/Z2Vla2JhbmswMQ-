<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>用 Arthas 神器來診斷 HBase 異常進程 | 极客快訊</title><meta property="og:title" content="用 Arthas 神器來診斷 HBase 異常進程 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/abdb5401430442cd909755d77fdf8bde"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ab91436.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ab91436.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ab91436.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ab91436.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ab91436.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ab91436.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ab91436.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ab91436.html><meta property="article:published_time" content="2020-10-29T20:59:00+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:00+08:00"><meta name=Keywords content><meta name=description content="用 Arthas 神器來診斷 HBase 異常進程"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/ab91436.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>用 Arthas 神器來診斷 HBase 異常進程</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right>1. 異常突起</h1><p style=text-align:start>HBase 集群的某一個 RegionServer 的 CPU 使用率突然飆升到百分之百，單獨重啟該 RegionServer 之後，CPU 的負載依舊會逐漸攀上頂峰。多次重啟集群之後，CPU 滿載的現象依然會復現，且會持續居高不下，慢慢地該 RegionServer 就會宕掉，慢慢地 HBase 集群就完犢子了。</p><h1 class=pgc-h-arrow-right>2. 異常之上的現象</h1><p style=text-align:start>CDH 監控頁面來看，除 CPU 之外的幾乎所有核心指標都是正常的，磁盤和網絡 IO 都很低，內存更是充足，壓縮隊列，刷新隊列也是正常的。</p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/abdb5401430442cd909755d77fdf8bde><p class=pgc-img-caption></p></div><p style=text-align:start>普羅米修斯的監控也是類似這樣的，就不貼圖了。</p><p style=text-align:start>監控指標裡的數字，只能直觀地告訴我們現象，不能告訴我們異常的起因。因此我們的第二反應是看日誌。</p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c54b770488314302b873e027b97f94d9><p class=pgc-img-caption>（企業微信截圖）</p></div><p>與此同時，日誌中還有很多類似這樣的干擾輸出。</p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ef19ea1f06524dc986a2c163390245aa><p class=pgc-img-caption></p></div><p style=text-align:start>後來發現這樣的輸出只是一些無關緊要的信息，對分析問題沒有任何幫助，甚至會干擾我們對問題的定位。</p><p style=text-align:start>但是，日誌中大量 scan responseTooSlow 的警告信息，似乎在告訴我們，HBase 的 Server 內部正在發生著大量耗時的 scan 操作，這也許就是 CPU 負載高的元凶。可是，由於各種因素的作用，我們當時的關注點並沒有在這個上面，因為這樣的信息，我們在歷史的時間段裡也頻繁撞見。</p><h1 class=pgc-h-arrow-right>3. 初識 arthas</h1><p style=text-align:start>監控和日誌都不能讓我們百分百確定 CPU 負載高是由哪些操作引起的，我們用 top 命令也只能看到 HBase 這個進程消耗了很多 CPU，就像下圖看到的這樣。</p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ff8e3afba6784da1958ecbc5012a1cff><p class=pgc-img-caption></p></div><p style=text-align:start>如果不做進一步分析，你仍然不知道，問題出現在 HBase 相關進程下的哪些執行線程。Java 中分析進程的命令，可以使用 jstack 或 jstat gcutil 等。但是，今天要介紹的主角不是這倆，甚至不是 async-profiler，而是 arthas。async-profiler 雖然也是一個很強大的工具，但是 arthas 包含了它，且功能更強大，堪稱神器。</p><p style=text-align:start>arthas 很早以前就聽說過，起初以為它只能用來分析 WEB 應用，例如 Spring Boot，這兩天仔細翻看其官方文檔之後，才覺得自己是多麼的無知。arthas 的相關介紹和入門使用，請參考其文檔，它的官方文檔比任何第三方資料都詳細和友好。</p><h1 class=pgc-h-arrow-right>4. 用 arthas 來分析 HBase 的異常進程</h1><p><strong>4.1 運行 arthas</strong></p><pre><code>java -jar /data/arthas/arthas-boot.jar  --target-ip 0.0.0.0</code></pre><ul><li>--target-ip 默認 127.0.0.1，此處賦值為 0.0.0.0 是為了使用 webconsole</li></ul><p><strong>4.2 arthas 運行成功的界面</strong></p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/577cc8132e804152bf0f0636bd87647f><p class=pgc-img-caption></p></div><p style=text-align:start>命令 top 定位到的異常的 HBase 進程 ID 是 1214，該進程就是 HRegionServer 的進程。輸入序號 1，回車，就進入了監聽該進程的命令行界面。</p><p><strong>4.3 dashboard</strong></p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d38a3feec6ca4b74bc6d63728e8ecac9><p class=pgc-img-caption></p></div><p style=text-align:start>運行 dashboard 命令回車，就可以查看該進程佔用資源的總體情況，可以從圖中看到，ID 為 59 的線程，佔用的 CPU 最高。</p><p><strong>4.4 thread</strong></p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f919cb40bb7e4139af0d7568754ec770><p class=pgc-img-caption></p></div><p style=text-align:start>輸入 thread 命令回車，查看該進程下所有線程的執行情況。</p><p><strong>4.5 thread -n 3</strong></p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b93a2df73a17482298e0154b48faf040><p class=pgc-img-caption></p></div><p style=text-align:start>輸出資源佔用前三名的線程。</p><p><strong>4.6 thread -n 3 -i 5000</strong></p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d787346a38664a87a89f31f9249907c4><p class=pgc-img-caption></p></div><p style=text-align:start>單位時間為 5 秒內，資源佔用前三名的線程。</p><p><strong>4.7 使用async-profiler生成火焰圖</strong></p><p style=text-align:start>生成火焰圖的最簡單命令。</p><pre><code>profiler start</code></pre><p style=text-align:start>隔一段時間，大概三十秒。</p><pre><code>profiler stop</code></pre><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/61ef4c915ac14ab197d4f4480359a3e4><p class=pgc-img-caption></p></div><p style=text-align:start>在 web console 裡查看。</p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/c2073f5b81ef420e814eaf2f6c3276a9><p class=pgc-img-caption></p></div><p style=text-align:start>關於火焰圖的入門級知識：</p><p style=text-align:start>查看 jvm 進程 cpu 火焰圖工具。</p><p style=text-align:start>火焰圖裡很清楚地定位到 CPU 時間佔用最高的線程是綠框最長的那些線程，也就是 scan 操作。</p><h1 class=pgc-h-arrow-right>5. scan 操作引起的 CPU 負載過高</h1><p style=text-align:start>通過以上的進程分析，我們最終可以確定，scan 操作的發生，導致 CPU 負載很高。我們查詢 HBase 的 API 基於 happybase 封裝而成。</p><p style=text-align:start>其實常規的 scan 操作是能正常返回結果的，發生異常查詢的表也不是很大，所以我們排除了熱點的可能。抽象出來業務方的查詢邏輯是：</p><pre><code>from happybase.connection import Connectionimport timestart = time.time()con = Connection(host='ip', port=9090, timeout=3000)table = con.table("table_name")try:    res = list(table.scan(filter="PrefixFilter('273810955|')",                      row_start='0f10&amp;Rcadf96cbe2ad7$ad9khE19fdaa87a5ddf7851c81ku ^92k',                      limit=3))except Exception as e:    passend = time.time()print 'timeout: %d' % (end - start)</code></pre><p style=text-align:start>PrefixFilter 和 row_start 的組合是為了實現分頁查詢的需求，row_start 的一堆亂碼字符，是加密的一個 user_id，裡面有特殊字符。日誌中看到，所有的耗時查詢，都有此類亂碼字符的傳參。於是，我們猜想，查詢出現的異常與這些亂碼字符有關。</p><p style=text-align:start>但是，後續測試復現的時候又發現。</p><pre><code># 會超時  res = list(table.scan(filter="PrefixFilter('273810955|')",                      row_start='27', limit=3))  # 不會超時  res = list(table.scan(filter="PrefixFilter('273810955|')",                      row_start='27381095', limit=3))</code></pre><p style=text-align:start>也就是，即使不是亂碼字符傳參，filter 和 row_start 組合異常，也會導致 CPU 異常的高，row_start 指定的過小，小於前綴，數據掃描的範圍估計就會變大，類似觸發了全表掃描，CPUload 勢必會變大。</p><h1 class=pgc-h-arrow-right>6. 頻繁創建連接或使用線程池造成 scan 線程持續增長</h1><p style=text-align:start>我們操作 HBase 的公共代碼是由 happybase 封裝而成，其中還用到了 happybase 的線程池，在我們更深入的測試中又發現了一個現象，當我們使用連接池或在循環中重複創建連接時，然後用 arthas 監控線程情況，發現 scan 的線程會很嚴重，測試代碼如下：</p><p><strong>6.1 連接在循環外部創建，重複使用</strong></p><pre><code>from happybase.connection import Connectionimport timecon = Connection(host='ip', port=9090, timeout=2000)table = con.table("table")for i in range(100):    try:          start = time.time()        res = list(table.scan(filter="PrefixFilter('273810955|')",                              row_start='0f10&amp;Rcadf96cbe2ad7$ad9khE19fdaa87a5ddf7851c81ku ^92k',                              limit=3))    except Exception as e:        pass    end = time.time()    print 'timeout: %d' % (end - start)</code></pre><p style=text-align:start>程序開始運行時，可以打開 arthas 進入到 HRegionServer 進程的監控，運行 thread 命令，查看此時的線程使用情況：</p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a5e8e039b3af40a1beca1c5d00321e76><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/78b83e95326c4f8ba48b4683442ef3e5><p class=pgc-img-caption></p></div><p style=text-align:start>小部分在運行，大部分在等待。此時，CPU 的負載情況：</p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2e63c08d84e1465ea43d76dd8f92d8ad><p class=pgc-img-caption></p></div><p><strong>6.2 循環在內部頻繁創建然後使用</strong></p><p style=text-align:start>代碼如下：</p><pre><code>from happybase.connection import Connectionimport timefor i in range(100):    try:        start = time.time()        con = Connection(host='ip', port=9090, timeout=2000)        table = con.table("table")        res = list(table.scan(filter="PrefixFilter('273810955|')",                              row_start='0f10&amp;Rcadf96cbe2ad7$ad9khE19fdaa87a5ddf7851c81ku ^92k',                              limit=3))    except Exception as e:        pass    end = time.time()    print 'timeout: %d' % (end - start)</code></pre><p style=text-align:start>下圖中可以看到開始 RUNNING 的線程越來越多，CPU 的消耗也越來越大。</p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5bc2d53c266249319161673dc10c63b6><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/a8576ac8832645afb7d77c6e32241663><p class=pgc-img-caption></p></div><p style=text-align:start>此時 CPU 的使用情況，由剛才的較為平穩，陡然上升：</p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7f06c43fe100492eb36560da436cf53d><p class=pgc-img-caption></p></div><p><strong>6.3 連接池的方式訪問 HBase</strong></p><p style=text-align:start>CPU 被之前的實驗拉高，重啟下集群使 CPU 的狀態恢復到之前平穩的狀態。然後繼續我們的測試，測試代碼：</p><p style=text-align:start><strong class=highlight-text>沒有超時時間</strong></p><pre><code>from happybase import ConnectionPoolimport timepool = ConnectionPool(size=1, host='ip', port=9090)for i in range(100):    start = time.time()    try:        with pool.connection(2000) as con:            table = con.table("table")            res = list(table.scan(filter="PrefixFilter('273810955|')",                                  row_start='0f10&amp;Rcadf96cbe2ad7$ad9khE19fdaa87a5ddf7851c81ku ^92k',                                  limit=3))    except Exception as e:        pass    end = time.time()    print 'timeout: %d' % (end - start)</code></pre><p style=text-align:start>如果不指定超時時間，會只有一個線程持續運行，因為我的連接池設置為 1。</p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/396f98fef50e492d8bd9e2a2e3a88543><p class=pgc-img-caption></p></div><p style=text-align:start>CPU 的負載也不是太高，如果我的連接池設置的更大，或者我的併發加大，那麼這些耗時 scan 的線程應該會更多，CPU 使用率也會飆升。</p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1c98bbe06bb64a0f87be63deb301c579><p class=pgc-img-caption></p></div><p style=text-align:start><strong class=highlight-text>指定超時時間</strong></p><pre><code>from happybase import ConnectionPoolimport timepool = ConnectionPool(size=1, host='ip', port=9090, timeout=2000)for i in range(100):    start = time.time()    try:        with pool.connection(2000) as con:            table = con.table("table")            res = list(table.scan(filter="PrefixFilter('273810955|')",                                  row_start='0f10&amp;Rcadf96cbe2ad7$ad9khE19fdaa87a5ddf7851c81ku ^92k',                                  limit=3))    except Exception as e:        pass    end = time.time()    print 'timeout: %d' % (end - start)</code></pre><p style=text-align:start>此次測試中，我指定了連接池中的超時時間，期望的是，連接超時，及時斷開，繼續下一次耗時查詢。此時，服務端處理 scan 請求的線程情況：</p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5b962bc287744b6897245e2b5202841b><p class=pgc-img-caption></p></div><p style=text-align:start>服務端用於處理 scan 請求的 RUNNING 狀態的線程持續增長，並耗費大量的 CPU。</p><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/e5f10cd7ca724139b89d80825a9e42a9><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>7. hbase.regionserver.handler.count</h1><div class=pgc-img><img alt="用 Arthas 神器來診斷 HBase 異常進程" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ace12abeb79445ccb32b1b4da4eb24f0><p class=pgc-img-caption></p></div><p style=text-align:start>參考大神的博客，以及自己對這個參數的理解，每一個客戶端發起的 RPC 請求（讀或寫），發送給服務端的時候，服務端就會有一個線程池，專門負責處理這些客戶端的請求，這個線程池可以保證同一時間點有 30 個線程可運行，剩餘請求要麼阻塞，要麼被塞進隊列中等待被處理，scan 請求撐滿了服務端的線程池，大量的耗時操作，把 CPU 資源消耗殆盡，其餘常規的讀寫請求也勢必大受影響，慢慢集群就完犢子了。</p><h1 class=pgc-h-arrow-right>8. 控制 scan 請求佔用很小的隊列</h1><p style=text-align:start>首先，這個 hbase.regionserver.handler.count 的參數不能被調小，如果太小，集群併發高時，讀寫延時必高，因為大部分請求都在排隊。理想情況是，讀和寫佔用不同的線程池，在處理讀請求時，scan 和 get 分別佔用不同的線程池，實現線程池資源隔離。如果是我的話，第一反應可能也會簡單、粗略地搞仨線程池，寫線程池，get 線程池、scan 線程池。scan 線程池分配很小的核心線程，讓其佔用很小的資源，限制其無限擴張。但是真實的情況是這樣嗎？暫時，我還沒仔細研究源碼，HBase 提供瞭如下參數，可以滿足讀寫資源分離的需求。</p><p style=text-align:start><strong>hbase.regionserver.handler.count</strong></p><pre><code>描述在RegionServer上旋轉的RPC偵聽器實例數。主機將相同的屬性用於主機處理程序的計數。過多的處理程序可能適得其反。使它成為CPU計數的倍數。如果大多數情況下是隻讀的，則處理程序計數接近cpu計數的效果很好。從兩倍的CPU計數開始，然後從那裡進行調整。默認30</code></pre><p style=text-align:start><strong>hbase.ipc.server.callqueue.handler.factor</strong></p><pre><code>描述確定呼叫隊列數量的因素。值為0表示在所有處理程序之間共享一個隊列。值為1表示每個處理程序都有自己的隊列。默認0.1</code></pre><p style=text-align:start><strong>hbase.ipc.server.callqueue.read.ratio</strong></p><pre><code>描述將呼叫隊列劃分為讀寫隊列。指定的間隔（應在0.0到1.0之間）將乘以呼叫隊列的數量。值為0表示不拆分呼叫隊列，這意味著讀取和寫入請求都將被推送到同一組隊列中。小於0.5的值表示讀隊列少於寫隊列。值為0.5表示將有相同數量的讀取和寫入隊列。大於0.5的值表示將有比寫隊列更多的讀隊列。值1.0表示除一個隊列外的所有隊列均用於調度讀取請求。示例：給定呼叫隊列的總數為10，讀比率為0表示：10個隊列將包含兩個讀/寫請求。read.ratio為0.3表示：3個隊列將僅包含讀取請求，而7個隊列將僅包含寫入請求。read.ratio為0.5表示：5個隊列僅包含讀取請求，而5個隊列僅包含寫入請求。read.ratio為0.8表示：8個隊列將僅包含讀取請求，而2個隊列將僅包含寫入請求。read.ratio為1表示：9個隊列將僅包含讀取請求，而1個隊列將僅包含寫入請求。默認0</code></pre><p style=text-align:start><strong>hbase.ipc.server.callqueue.scan.ratio</strong></p><pre><code>描述給定讀取呼叫隊列的數量（根據呼叫隊列總數乘以callqueue.read.ratio計算得出），scan.ratio屬性會將讀取呼叫隊列分為小讀取隊列和長讀取隊列。小於0.5的值表示長讀隊列少於短讀隊列。值為0.5表示將有相同數量的短讀和長讀隊列。大於0.5的值表示長讀取隊列比短讀取隊列多。值為0或1表示使用相同的隊列進行獲取和掃描。示例：假設讀取呼叫隊列的總數為8，則scan.ratio為0或1表示：8個隊列將同時包含長讀取請求和短讀取請求。scan.ratio為0.3表示：2個隊列將僅包含長讀請求，而6個隊列將僅包含短讀請求。scan.ratio為0.5表示：4個隊列將僅包含長讀請求，而4個隊列將僅包含短讀請求。scan.ratio為0.8表示：6個隊列將僅包含長讀請求，而2個隊列將僅包含短讀請求。默認0</code></pre><p style=text-align:start>這幾個參數的作用官網解釋的還挺詳細，按照其中的意思，配置一定比例，就可以達到讀寫隊列，get 和 scan 隊列分離的目的，但是，調配參數後，繼續如上測試，發現，並不難控制 RUNNING 的線程的數量，發現沒毛用。</p><p style=text-align:start>這裡有一個疑問，隊列和我所理解的線程池直接到底是什麼關係？是否是一個東西？這個之後需要觀其源碼，窺其本質。</p><h1 class=pgc-h-arrow-right>9. 總結</h1><p style=text-align:start>囉囉嗦嗦總算把定位問題的整個過程記錄了下來，其實文字描述的還不算很詳盡，只是儘可能還原當時的場景和梳理問題的大體思維流程，免得以後遺忘，同時也期望各位同行能從我這裡受到點啟發，期間也受到了不少大神的提點，在此也特別感謝各方大佬的幫助。</p><p><br></p><p>作者 | 介龍平，英文名 leo，碼農一枚</p><p><br></p><p><strong>本文為阿里雲原創內容，未經允許不得轉載。</strong></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Arthas</a></li><li><a>診斷</a></li><li><a>HBase</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/d6bb51d0.html alt=改進的配網故障診斷Petri網方法及其矩陣描述 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RuQUGQxHI4kAhG style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d6bb51d0.html title=改進的配網故障診斷Petri網方法及其矩陣描述>改進的配網故障診斷Petri網方法及其矩陣描述</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/144e90ce.html alt=機械狀態監測與診斷20年，你真的懂系統性的診斷流程嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/47040004d258cae013fa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/144e90ce.html title=機械狀態監測與診斷20年，你真的懂系統性的診斷流程嗎？>機械狀態監測與診斷20年，你真的懂系統性的診斷流程嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/03f85e80.html alt=常用電氣設備的故障診斷與維修，值得收藏 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1cb8e7267b4d4909a4309b58f1593588 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/03f85e80.html title=常用電氣設備的故障診斷與維修，值得收藏>常用電氣設備的故障診斷與維修，值得收藏</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0585f58a.html alt=母豬早期妊娠的診斷方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9e4836c8fe0f4a65a4cc3ad1334c9d5f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0585f58a.html title=母豬早期妊娠的診斷方法>母豬早期妊娠的診斷方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/13057b0b.html alt="HBase Shell 十大花式玩兒法" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/175a118fec5c4113aaa7ba0ad928f4cc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/13057b0b.html title="HBase Shell 十大花式玩兒法">HBase Shell 十大花式玩兒法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9a899cab.html alt=膽道閉鎖診斷及治療指南(2018版) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RhvGVjsGeWMzXL style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9a899cab.html title=膽道閉鎖診斷及治療指南(2018版)>膽道閉鎖診斷及治療指南(2018版)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d346012b.html alt=腰椎間盤突出症的診斷與治療 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8bd416c65dbc413b931beed52a7d82e3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d346012b.html title=腰椎間盤突出症的診斷與治療>腰椎間盤突出症的診斷與治療</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b26a19e1.html alt=消防水泵日常故障診斷，你應該知道的知識 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/27e2cb3d3e564a09a35323681b52d8a4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b26a19e1.html title=消防水泵日常故障診斷，你應該知道的知識>消防水泵日常故障診斷，你應該知道的知識</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2c542eb4.html alt="23條電氣診斷訣竅+電工技能口訣 讓電工作業得心應手" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f5b665f4cc204df5b9633c2ca104d9e2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2c542eb4.html title="23條電氣診斷訣竅+電工技能口訣 讓電工作業得心應手">23條電氣診斷訣竅+電工技能口訣 讓電工作業得心應手</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/13a75345.html alt=史上最全的電氣故障診斷口訣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/13a75345.html title=史上最全的電氣故障診斷口訣>史上最全的電氣故障診斷口訣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f6eaca7e.html alt=電氣故障診斷口訣大全，無保留全分享！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1528200459631d3d5a42eee style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f6eaca7e.html title=電氣故障診斷口訣大全，無保留全分享！>電氣故障診斷口訣大全，無保留全分享！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/65394b5f.html alt=電腦網絡診斷提示以太網適配器驅動出現問題怎麼辦 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/R6YvQw5ARZ7UKF style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/65394b5f.html title=電腦網絡診斷提示以太網適配器驅動出現問題怎麼辦>電腦網絡診斷提示以太網適配器驅動出現問題怎麼辦</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/71dce88f.html alt=來日本求診先端醫療或健康診斷，事前應當檢點的一個準備清單 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1e99a38b720c4edeb154ce730c97b87c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/71dce88f.html title=來日本求診先端醫療或健康診斷，事前應當檢點的一個準備清單>來日本求診先端醫療或健康診斷，事前應當檢點的一個準備清單</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e4389178.html alt=好消息！迪安診斷研製出冠狀病毒檢測試劑並投入應用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RpDtrCIFX8uXGn style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e4389178.html title=好消息！迪安診斷研製出冠狀病毒檢測試劑並投入應用>好消息！迪安診斷研製出冠狀病毒檢測試劑並投入應用</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/173edd7e.html alt=糖尿病足早期，該如何有效預防、診斷及治療？提高糖友生活質量 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/9ee0b8bd-f1e5-4aee-9ba4-69217c525798 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/173edd7e.html title=糖尿病足早期，該如何有效預防、診斷及治療？提高糖友生活質量>糖尿病足早期，該如何有效預防、診斷及治療？提高糖友生活質量</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>