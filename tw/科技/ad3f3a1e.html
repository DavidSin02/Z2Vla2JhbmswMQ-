<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>數據庫技術：MySQL 基礎和 SQL 入門，單表、約束和事務 | 极客快訊</title><meta property="og:title" content="數據庫技術：MySQL 基礎和 SQL 入門，單表、約束和事務 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/107897c16ae7461caa62dd375b631afe"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ad3f3a1e.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ad3f3a1e.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ad3f3a1e.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ad3f3a1e.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ad3f3a1e.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ad3f3a1e.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ad3f3a1e.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ad3f3a1e.html><meta property="article:published_time" content="2020-11-14T21:08:11+08:00"><meta property="article:modified_time" content="2020-11-14T21:08:11+08:00"><meta name=Keywords content><meta name=description content="數據庫技術：MySQL 基礎和 SQL 入門，單表、約束和事務"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/ad3f3a1e.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>數據庫技術：MySQL 基礎和 SQL 入門，單表、約束和事務</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div class=pgc-img><img alt="數據庫技術：MySQL 基礎和 SQL 入門，單表、約束和事務" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/107897c16ae7461caa62dd375b631afe><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>Introduction to MySQL and SQL</h1><p><br></p><h1 class=pgc-h-arrow-right>Basic Concepts</h1><h1 class=pgc-h-arrow-right>What is Database?</h1><ul><li>數據庫就是存儲和管理數據的倉庫。</li><li>數據庫是一個文件系統。它以文件的方式將數據保存在電腦上。</li></ul><blockquote class=pgc-blockquote-abstract><p>想了解更多，歡迎關注我的微信公眾號：Renda_Zhang</p></blockquote><h1 class=pgc-h-arrow-right>Why Should We Use Database?</h1><p>Comparison among different ways of storing data：</p><p>內存</p><ul><li>優點：速度快。</li><li>缺點：不能永久保存，數據是臨時狀態的。</li></ul><p>文件</p><ul><li>優點：數據是可以永久保存。</li><li>缺點：使用 IO 流操作文件，所以不方便。</li></ul><p>數據庫</p><ul><li>優點：1. 數據可以永久保存；2. 方便存儲和管理數據；3. 使用統一的方式操作數據庫。</li><li>缺點：佔用資源，有些數據庫需要付費，如 Oracle 數據庫。</li></ul><p>Conclusion: By using Database, it greatly improves user experience for Data Manipulations, such as Adding, Deleting, or Querying data.</p><h1 class=pgc-h-arrow-right>Common Database Software</h1><p>MySQL 數據庫：開源免費的數據庫。操作簡單，常作為中小型的項目的數據庫首選，但是被 Oracle 公司收購後，MySQL 6.x 開始收費。</p><p>Oracle 數據庫：收費的大型數據庫，Oracle 公司的核心產品。安全性高。</p><p>DB2：收費的超大型數據庫，IBM 公司的數據庫產品。常在銀行系統使用。</p><p>SQL Server：收費的中型數據庫，微軟公司的產品。常用在 C#，.net 等語言。該數據庫只能運行在 Windows 機器上；擴展性，穩定性，安全性，性能都表現平平。</p><h1 class=pgc-h-arrow-right>Why Do We Choose MySQL as the Database Software?</h1><ul><li>功能強大，可以用於 Web 應用開發。</li><li>開源，免費。</li></ul><h1 class=pgc-h-arrow-right><br></h1><h1 class=pgc-h-arrow-right>使用 MySQL</h1><h1 class=pgc-h-arrow-right>下載安裝 MySQL，並配置好相應的環境變量</h1><h1 class=pgc-h-arrow-right>使用 Windows 服務或者 DOS 命令方式啟動 MySQL 服務</h1><h1 class=pgc-h-arrow-right>使用命令行管理數據庫</h1><pre><code>mysql -u用戶名 -p密碼mysql -h主機IP -u用戶名 -p密碼</code></pre><h1 class=pgc-h-arrow-right>使用 SQLyog 圖形化軟件管理登錄 MySQL 數據庫</h1><h1 class=pgc-h-arrow-right>MySQL Directory Structure</h1><h1 class=pgc-h-arrow-right>MySQL Installation Directory</h1><ul><li>bin：放置一些可執行文件</li><li>docs: 文檔</li><li>include: 包含（頭）文件</li><li>lib: 依賴庫</li><li>share: 用於存放字符集、語言等信息</li></ul><h1 class=pgc-h-arrow-right>MySQL Configuration File and the Directory of Databases and Data Tables</h1><ul><li>my.ini 文件：是 MySQL 的配置文件，一般不建議去修改。</li><li>Data 目錄：MySQL 管理的數據庫文件所在的目錄，保存的就是數據庫（文件夾）與數據表（文件）的信息。</li></ul><h1 class=pgc-h-arrow-right>Database Management System</h1><p>數據庫管理系統指一種操作和管理維護數據庫的大型軟件。</p><p>MySQL 就是一個 數據庫管理系統軟件，安裝了 MySQL 的電腦，我們叫它數據庫服務器。</p><p>數據庫管理系統用於建立、使用和維護數據庫，對數據庫進行統一的管理。</p><p>MySQL 中管理著很多數據庫，在實際開發環境中 一個數據庫一般對應了一個的應用，數據庫當中保存著多張表，每一張表對應著不同的業務，表中保存著對應業務的數據。</p><ul><li>安裝了 MySQL 軟件的電腦被稱為 MySQL 服務器</li><li>MySQL 中管理著多個數據庫</li><li>數據庫中包含多張表</li><li>表中包含多條數據</li><li>客戶端（命令行或 SQLyog）通過網絡訪問（服務器地址 : 端口）MySQL 服務器</li></ul><h1 class=pgc-h-arrow-right>Database Tables</h1><h1 class=pgc-h-arrow-right>數據庫中以表為組織單位存儲數據</h1><h1 class=pgc-h-arrow-right>表類似 Java 中的類,每個字段都有對應的數據類型</h1><h1 class=pgc-h-arrow-right>對比 Java 程序與關係型數據庫</h1><ul><li>類 = 表</li><li>類中屬性 = 表中字段</li><li>對象 = 數據記錄</li></ul><h1 class=pgc-h-arrow-right><br></h1><h1 class=pgc-h-arrow-right>SQL</h1><h1 class=pgc-h-arrow-right>SQL Concept</h1><p>SQL - Structured Query Language，是一種特殊目的的編程語言，是一種數據庫查詢和程序設計語言，用於存取數據以及查詢、更新和管理關係數據庫系統。</p><p>Functions of SQL:</p><ul><li>是所有關係型數據庫的統一查詢規範，不同的關係型數據庫都支持 SQL</li><li>所有的關係型數據庫都可以使用 SQL</li><li>不同數據庫之間的 SQL 有一些區別方言</li></ul><h1 class=pgc-h-arrow-right>SQL Syntax</h1><p>SQL 語句可以單行或者多行書寫，以分號結尾 ; （Sqlyog 中可以不用寫分號，但建議加上）</p><p>可以使用空格和縮進來增加語句的可讀性。</p><p>MySQL 中使用 SQL 不區分大小寫，一般關鍵字大寫，數據庫名錶名列名小寫。</p><p>MySQL 註釋方式：</p><pre><code># show databases;  單行註釋-- show databases; 單行註釋/*    多行註釋    show databases;*/</code></pre><h1 class=pgc-h-arrow-right>SQL 的分類</h1><p>DDL - Data Deﬁnition Language：數據定義語言，用來定義數據庫對象：數據庫，表，列等。</p><p>DML - Data Manipulation Language：數據操作語言，用來對數據庫中表的記錄進行更新。</p><p>DQL - Data Query Language：數據查詢語言，用來查詢數據庫中表的記錄。</p><p>DCL - Date Control Language：數據控制語言，用來定義數據庫的訪問權限和安全級別，及創建用戶。</p><pre><code>/*     CRUD    C - create    R - retrieve    U - update    D - delete*/</code></pre><h1 class=pgc-h-arrow-right>DDL - Define Database</h1><h1 class=pgc-h-arrow-right>MySQL Built-in Database</h1><p>information_schema：信息數據庫，保存的是其它數據庫的信息</p><p>mysql：MySQL 核心數據庫，保存的是用戶和權限</p><p>performance_schema：保存性能相關的數據，監控 MySQL 的性能</p><p>sys：記錄了 DBA（Database Administrator） 所需要的一些信息，更方便地讓 DBA 快速瞭解數據庫的運行情況。</p><h1 class=pgc-h-arrow-right>Create Database</h1><pre><code>/*    方式1 直接指定數據庫名進行創建    默認數據庫字符集為：latin1*/CREATE DATABASE db1; /*    方式2 指定數據庫名稱，指定數據庫的字符集    一般都指定為 utf8,與Java中的編碼保持一致*/CREATE DATABASE db1_1 CHARACTER SET utf8;</code></pre><p>create database 數據庫名; -- 創建指定名稱的數據庫。</p><p>create database 數據庫名 character set 字符集; -- 創建指定名稱的數據庫，並且指定字符集（一般都指定 UTF-8）。</p><h1 class=pgc-h-arrow-right>Show Database</h1><pre><code>-- 切換數據庫 從db1 切換到 db1_1USE db1_1;-- 查看當前正在使用的數據庫SELECT DATABASE();-- 查看Mysql中有哪些數據庫SHOW DATABASES;-- 查看一個數據庫的定義信息SHOW CREATE DATABASE db1_1;</code></pre><p>use 數據庫; -- 切換數據庫</p><p>select database(); -- 查看當前正在使用的數據庫</p><p>show databases; -- 查看 MySQL 中都有哪些數據庫</p><p>show create database 數據庫名; -- 查看一個數據庫的定義信息</p><h1 class=pgc-h-arrow-right>Alter Database</h1><pre><code>-- 將數據庫db1 的字符集 修改為 utf8ALTER DATABASE db1 CHARACTER SET utf8;-- 查看當前數據庫的基本信息，發現編碼已更改SHOW CREATE DATABASE db1;</code></pre><p>alter database 數據庫名 character set 字符集; -- 數據庫的字符集修改操作</p><h1 class=pgc-h-arrow-right>Drop Database</h1><pre><code>-- 刪除某個數據庫DROP DATABASE db1_1;</code></pre><p>drop database 數據庫名; -- 從 MySQL 中永久的刪除某個數據庫</p><h1 class=pgc-h-arrow-right>DDL - Define Table</h1><h1 class=pgc-h-arrow-right>MySQL Data Type</h1><p>常用數據類型</p><ul><li>int（整型），double（浮點型）</li><li>char（字符串型 固定長度），varchar（字符串型 只使用字符串長度所需的空間），text（字符串型 存儲文本）</li><li>date（日期類型 yy-MM-dd），datetime（日期類型 yyyy-MM-dd HH:mm:ss），timestamp（日期類型 自動存儲記錄修改時間）</li></ul><h1 class=pgc-h-arrow-right>Create Table</h1><pre><code>-- 創建測試表CREATE TABLE test1(    tid INT,    tname VARCHAR(20),    tdate DATE -- 注意最後不要加逗號);-- 創建一個表結構與 test1 相同的 test2表CREATE TABLE test2 LIKE test1;-- 查看錶結構DESC test2;</code></pre><h1 class=pgc-h-arrow-right>Show Table</h1><pre><code>-- 查看當前數據庫中的所有表名SHOW TABLES;-- 顯示當前數據表的結構DESC test1;-- 查看創建表的 SQL 語句SHOW CREATE TABLE test1;</code></pre><h1 class=pgc-h-arrow-right>Drop Table</h1><pre><code>-- 直接刪除 test1 表DROP TABLE test1;-- 先判斷 再刪除 test2 表DROP TABLE IF EXISTS test2;</code></pre><h1 class=pgc-h-arrow-right>Alter Table</h1><pre><code>--  將 category 表改為 category1RENAME TABLE category TO category1;-- 將 category 表的字符集 修改為 gbkalter table category character set gbk;-- 為分類表添加一個新的字段為分類描述 cdesc varchar(20)ALTER TABLE category ADD cdesc VARCHAR(20);-- 對分類表的描述字段進行修改，類型 varchar(50) ALTER TABLE category MODIFY cdesc VARCHAR(50);-- 對分類表中的 desc 字段進行更換, 更換為 cdesc2 varchar(30)ALTER TABLE category CHANGE cdesc cdesc2 VARCHAR(30);--  刪除分類表中 cdesc2 列ALTER TABLE category DROP cdesc2;</code></pre><h1 class=pgc-h-arrow-right>Data Manipulation Language</h1><pre><code># 創建學生表CREATE TABLE student(    sid INT, # 學員ID    sname VARCHAR(20), # 姓名    age INT, # 年齡    sex CHAR(1), # 性別    address VARCHAR(40) # 地址);</code></pre><h1 class=pgc-h-arrow-right>Insert Data</h1><pre><code>-- 插入全部字段，將所有字段名都寫出來INSERT INTO student (sid,sname,age,sex,address)     VALUES(1,'張人大',20,'男','廣州');-- 插入全部字段，不寫字段名INSERT INTO student     VALUES(2,'李小明',10,'男','上海');-- 插入指定字段的值，必須要寫上列名INSERT INTO student (sid, sname)     VALUES(3,'周小紅');-- 如果插入空值，可以忽略不寫或者寫 nullINSERT INTO student (sid,sname)     VALUES(4,'趙四');INSERT INTO student (sid,sname,age,sex,address)     VALUES(5,'錢五',NULL,NULL,NULL);</code></pre><h1 class=pgc-h-arrow-right>Update Data</h1><pre><code>-- 不帶條件修改，將所有的性別改為女，慎用UPDATE student SET sex = '女';-- 帶條件的修改，將 sid 為 3 的學生，性別改為女UPDATE student SET sex = '女' WHERE sid = 3;-- 一次修改多個列， 將 sid 為 2 的學員，年齡改為 18，地址改為北京UPDATE student     SET age = 18, address = '北京' WHERE sid = 2;</code></pre><h1 class=pgc-h-arrow-right>Delete Data</h1><pre><code>-- 刪除 sid 為 1 的數據DELETE FROM student WHERE sid = 1;-- 刪除所有數據方法一：有多少條記錄，就執行多少次刪除操作，效率低DELETE FROM student;-- 刪除所有數據方法二：先刪除整張表，然後再重新創建一張一模一樣的表，效率高truncate table student;</code></pre><h1 class=pgc-h-arrow-right>Data Query Language</h1><pre><code>-- 創建員工表CREATE TABLE emp(    eid INT,    ename VARCHAR(20),    sex CHAR(1),    salary DOUBLE,    hire_date DATE,    dept_name VARCHAR(20));-- 添加數據...</code></pre><h1 class=pgc-h-arrow-right>Simple Query</h1><pre><code>-- 查詢 emp 中的所有數據，使用 * 表示所有列SELECT * FROM emp;-- 查詢 emp 表中的所有記錄，僅顯示 id 和 name 字段SELECT eid, ename FROM emp;-- 別名查詢，使用關鍵字 as 為列起別名SELECT     eid AS '編號',    ename AS '姓名' ,    sex AS '性別',    salary AS '薪資',    hire_date '入職時間', -- AS 可以省略    dept_name '部門名稱'FROM emp;-- 使用distinct 關鍵字,去掉重複部門信息SELECT DISTINCT dept_name FROM emp;-- 運算查詢，查詢結果參與運算SELECT ename, salary + 1000 FROM emp;SELECT     ename AS '姓名',     salary + 1000 AS '薪資' FROM emp;</code></pre><h1 class=pgc-h-arrow-right>Conditional Query</h1><p>比較運算符</p><ul><li>> &lt; &lt;= >= = 大於、小於、小於等於、大於等於、等於</li><li>&lt;>，!= 不等於</li><li>BETWEEN ... AND ... 顯示在某一區間的值</li><li>IN (集合) 集合表示多個值，使用逗號分隔，in 中的每個數據都會作為一次條件，只要滿足條件就會顯示</li><li>LIKE '%張%' 模糊查詢</li><li>IS NULL 查詢某一列為 NULL 的值，注：不能寫 = NULL</li></ul><p>邏輯運算符</p><ul><li>And && 多個條件同時成立</li><li>Or || 多個條件任一成立</li><li>Not 不成立，取反</li></ul><p>模糊查詢</p><ul><li>% 表示匹配任意多個字符串</li><li>_ 表示匹配 一個字符</li></ul><pre><code>-- 查詢員工姓名為'張人大'的員工信息SELECT * FROM emp WHERE ename = '張人大';-- 查詢薪水價格為 3000 的員工信息SELECT * FROM emp WHERE salary = 3000;-- 查詢薪水價格不是 5000 的所有員工信息SELECT * FROM emp WHERE salary != 5000;SELECT * FROM emp WHERE salary &lt;&gt; 5000;-- 查詢薪水價格大於 6000 元的所有員工信息SELECT * FROM emp WHERE salary &gt; 6000;-- 查詢薪水價格在 5000 到 10000 之間所有員工信息SELECT * FROM emp WHERE salary     BETWEEN 5000 AND 10000;-- 查詢薪水價格是 3000 或 8000 或者 20000 的所有員工信息# 方法 1: orSELECT * FROM emp WHERE salary = 3000     OR salary = 8000     OR salary = 20000;# 方法 2: in() 匹配括號中指定的參數SELECT * FROM emp WHERE salary IN(3000, 8000, 20000);-- 查詢含有'人'字的所有員工信息SELECT * FROM emp WHERE ename LIKE '%人%';-- 查詢以'張'開頭的所有員工信息SELECT * FROM emp WHERE ename LIKE '張%';-- 查詢第二個字為'萊'的所有員工信息SELECT * FROM emp WHERE ename LIKE '_萊%';-- 查詢沒有部門的員工信息SELECT * FROM emp WHERE dept_name IS NULL;-- 錯誤方式，不可以用 = 來判斷是否為空# SELECT * FROM emp WHERE dept_name = NULL; -- 查詢有部門的員工信息SELECT * FROM emp WHERE dept_name IS NOT NULL;</code></pre><p><br></p><hr><h1 class=pgc-h-arrow-right>MySQL: Single Table，Constraint and Transaction</h1><h1 class=pgc-h-arrow-right><br></h1><h1 class=pgc-h-arrow-right>Single Table Operation</h1><h1 class=pgc-h-arrow-right>Sorting</h1><h1 class=pgc-h-arrow-right>單列排序</h1><p>只按照某一個字段進行排序，就是單列排序</p><pre><code>-- 使用 salary 字段，對 emp 表數據進行排序 (升序/降序)# 默認升序排序 ASCSELECT * FROM emp ORDER BY salary;# 降序排序SELECT * FROM emp ORDER BY salary DESC;</code></pre><h1 class=pgc-h-arrow-right>組合排序</h1><p>同時對多個字段進行排序，如果第一個字段相同就按照第二個字段進行排序，以此類推</p><pre><code>-- 在薪水排序的基礎上, 再使用 eid 進行排序, 如果薪水相同就以 eid 做降序排序# 組合排序SELECT * FROM emp ORDER BY salary DESC, eid DESC;</code></pre><h1 class=pgc-h-arrow-right>Aggregate Function</h1><h1 class=pgc-h-arrow-right>count (字段) -- 統計指定列不為 NULL 的記錄行數</h1><pre><code>-- 查詢員工的總數# 統計表中的記錄條數SELECT COUNT(eid) FROM emp;SELECT COUNT(*) FROM emp;# 使用 1，與 * 效果一樣SELECT COUNT(1) FROM emp;-- 查詢薪水大於 4000 員工的個數SELECT COUNT(*) FROM emp WHERE salary &gt; 4000;-- 查詢部門為'教學部'的所有員工的個數SELECT COUNT(*) FROM emp WHERE dept_name = '教學部';</code></pre><h1 class=pgc-h-arrow-right>sum (字段) -- 計算指定列的數值和</h1><h1 class=pgc-h-arrow-right>max (字段) -- 計算指定列的最大值</h1><h1 class=pgc-h-arrow-right>min (字段) -- 計算指定列的最小值</h1><h1 class=pgc-h-arrow-right>avg (字段) -- 計算指定列的平均值</h1><pre><code>-- 查看員工總薪水、最高薪水、最小薪水、薪水的平均值SELECT     SUM(salary) AS '總薪水',    MAX(salary) AS '最高薪水',    MIN(salary) AS '最低薪水',    AVG(salary) AS '平均薪水'   FROM emp;-- 查詢部門為'市場部'所有員工的平均薪水SELECT     AVG(salary) AS '市場部平均薪資' FROM emp WHERE dept_name = '市場部';</code></pre><h1 class=pgc-h-arrow-right>Query by Group</h1><p>分組查詢指的是使用 GROUP BY 語句，對查詢的信息進行分組，相同數據作為一組。分組時可以查詢要分組的字段，或者使用聚合函數進行統計操作。</p><pre><code>-- 按照性別進行分組操作。# 使用 * 會讓所有字段顯示SELECT * FROM emp GROUP BY sex;-- 通過性別字段進行分組，求各組的平均薪資SELECT sex, AVG(salary) FROM emp GROUP BY sex;-- 查詢有幾個部門SELECT dept_name AS '部門名稱' FROM emp GROUP BY dept_name;-- 查詢每個部門的平均薪資SELECT dept_name AS '部門名稱',AVG(salary) AS '平均薪資' FROM emp GROUP BY dept_name;-- 查詢每個部門的平均薪資, 且部門名稱不為 nullSELECT     dept_name AS '部門名稱',    AVG(salary) AS '平均薪資' FROM emp WHERE dept_name IS NOT NULL GROUP BY dept_name;</code></pre><p>分組操作中的 having 子語句，是用於在分組後對數據進行過濾的，作用類似於 where 條件。where 與 having 的區別：1. where 進行分組前的過濾，having 是分組後的過濾；2. where 後面不能寫聚合函數，having 後面可以寫。</p><pre><code>-- 查詢平均薪資大於6000的部門# 需要在分組後再次進行過濾，使用 havingSELECT     dept_name,    AVG(salary)FROM emp  WHERE dept_name IS NOT NULL GROUP BY dept_name HAVING AVG(salary) &gt; 6000 ;</code></pre><h1 class=pgc-h-arrow-right>Limit</h1><p>Limit 關鍵字用於限制返回的查詢結果的行數 (可以通過 limit 指定查詢多少行數據)，是 MySQL 的方言，用來完成分頁。分頁公式：起始索引 = (當前頁 - 1) * 每頁條數。</p><pre><code>-- 查詢 emp 表中的前 5 條數據# 參數 1 是起始值，默認為 0；參數 2 是要查詢的條數SELECT * FROM emp LIMIT 5;SELECT * FROM emp LIMIT 0, 5;-- 查詢 emp 表中從第 4 條開始，查詢 6 條# 起始值默認是從 0 開始的SELECT * FROM emp LIMIT 3, 6;-- 分頁操作：每頁顯示 3 條數據# 第 1 頁SELECT * FROM emp LIMIT 0, 3;# 第 2 頁 (2-1)*3=3SELECT * FROM emp LIMIT 3, 3;# 第 3 頁SELECT * FROM emp LIMIT 6, 3;</code></pre><h1 class=pgc-h-arrow-right><br></h1><h1 class=pgc-h-arrow-right>Constraint</h1><p>SQL 的約束對錶中的數據進行進一步的限制，從而保證數據的正確性、有效性、完整性。違反約束的不正確數據，將無法插入到表中。</p><h1 class=pgc-h-arrow-right>Primary Key -- 主鍵約束</h1><p>主鍵約束是不可重複的、唯一的、非空的，用來表示數據庫中的每一條記錄。通常針對業務去設計主鍵，每張表都設計一個主鍵 id。主鍵是給數據庫和程序使用的，與客戶的要求無關，所以只要能夠保證主鍵不重複即可。</p><pre><code>-- 方式 1：直接設置主鍵CREATE TABLE emp1(    #     eid INT PRIMARY KEY,    ename VARCHAR(20),    sex CHAR(1));-- 方式 2：指定主鍵為 eid 字段CREATE TABLE emp2(    eid INT,    ename VARCHAR(20),    sex CHAR(1),    PRIMARY KEY(eid));-- 方式 3：通過數據定義語言進行主鍵設置CREATE TABLE emp3(    eid INT,    ename VARCHAR(20),    sex CHAR(1))ALTER TABLE emp3 ADD PRIMARY KEY(eid);DESC emp3;-- 測試主鍵的唯一性和非空性# 正常插入一條數據INSERT INTO emp3 VALUES(1,'張人大','男');# 錯誤：主鍵不能為空INSERT INTO emp3 VALUES(NULL,'布萊爾','女');# 錯誤：主鍵不能重複INSERT INTO emp3 VALUES(1,'李小明','男');-- 使用數據定義語言語句刪除表中的主鍵ALTER TABLE emp3 DROP PRIMARY KEY;DESC emp3;-- 創建主鍵自增的表# 關鍵字 AUTO_INCREMENT，類型必須是整數類型CREATE TABLE emp4(    eid INT PRIMARY KEY AUTO_INCREMENT,    ename VARCHAR(20),    sex CHAR(1));#  添加數據觀察主鍵的自增，默認開始值為 1。INSERT INTO emp4(ename,sex) VALUES('張人大','男');INSERT INTO emp4(ename,sex) VALUES('李小明','男');INSERT INTO emp4 VALUES(NULL,'布萊爾','女');INSERT INTO emp4 VALUES(NULL,'周小紅','女');-- 自定義自增其實值CREATE TABLE emp5(    eid INT PRIMARY KEY AUTO_INCREMENT,    ename VARCHAR(20),    sex CHAR(1)) AUTO_INCREMENT = 100;# 插入數據,觀察主鍵的起始值INSERT INTO emp5(ename,sex) VALUES('張人大','男');INSERT INTO emp5(ename,sex) VALUES('布萊爾','女');-- 使用 delete 刪除表中所有數據# 目前最後的主鍵值是 101SELECT * FROM emp5;# delete 刪除表中數據，對自增沒有影響DELETE FROM emp5;# 插入數據，發現主鍵從 102 繼續自增INSERT INTO emp5(ename,sex) VALUES('張人大','男');INSERT INTO emp5(ename,sex) VALUES('布萊爾','女');-- 使用 truncate 刪除表中所有數據,TRUNCATE TABLE emp5;-- 插入數據，發現主鍵從 1 重新自增INSERT INTO emp5(ename,sex) VALUES('張人大','男');INSERT INTO emp5(ename,sex) VALUES('布萊爾','女');</code></pre><h1 class=pgc-h-arrow-right>Not Null -- 非空約束</h1><p>非空約束的特點：某一列不予許為空。</p><pre><code>-- 添加非空約束, ename 字段不能為空CREATE TABLE emp6(    eid INT PRIMARY KEY AUTO_INCREMENT,    ename VARCHAR(20) NOT NULL,    sex CHAR(1));</code></pre><h1 class=pgc-h-arrow-right>Unique -- 唯一約束</h1><p>唯一約束的特點：表中的某一列的值不能重複（對 null 不做唯一的判斷）。</p><p>主鍵約束與唯一約束的區別：1. 主鍵約束是唯一的且不能夠為空，唯一約束是唯一的但可以為空；2. 一個表中只能有一個主鍵，但是可以有多個唯一約束。</p><pre><code>-- 創建 emp3 表 為 ename 字段添加唯一約束CREATE TABLE emp7(    eid INT PRIMARY KEY AUTO_INCREMENT,    ename VARCHAR(20) UNIQUE,    sex CHAR(1));-- 測試唯一約束# 添加一條數據INSERT INTO emp7(ename,sex) VALUES('布萊爾','男');# 錯誤：ename 不能重複INSERT INTO emp7(ename,sex) VALUES('布萊爾','女');</code></pre><h1 class=pgc-h-arrow-right>Foreign Key -- 外鍵約束</h1><p>外鍵約束將在多表中介紹。</p><h1 class=pgc-h-arrow-right>Default -- 默認值約束</h1><p>默認值約束用來指定某列的默認值</p><pre><code>-- 為 ename 字段添加默認值CREATE TABLE emp8(    eid INT PRIMARY KEY AUTO_INCREMENT,    ename VARCHAR(20) DEFAULT '無名氏',    sex CHAR(1));-- 測試默認值INSERT INTO emp8(ename,sex) VALUES(DEFAULT,'男');INSERT INTO emp8(sex) VALUES('女');# 不使用默認值，則覆蓋默認值。INSERT INTO emp8(ename,sex) VALUES('布萊爾','女');</code></pre><h1 class=pgc-h-arrow-right><br></h1><h1 class=pgc-h-arrow-right>Database Transaction</h1><h1 class=pgc-h-arrow-right>What is Database Transaction?</h1><p>數據庫事務：是一個整體，由一條或者多條 SQL 語句組成，這些 SQL 語句要麼都執行成功，要麼都執行失敗，只要有一條 SQL 出現異常，整個操作就會回滾，整個業務執行失敗。</p><h1 class=pgc-h-arrow-right>Database Rollback</h1><p>數據庫回滾：即在事務運行的過程中發生了某種故障，事務不能繼續執行，系統將事務中對數據庫的所有已完成的操作全部撤銷，滾回到事務開始時的狀態（在提交之前執行）。</p><h1 class=pgc-h-arrow-right>Account Transfer Example</h1><pre><code>-- 創建賬戶表CREATE TABLE account(    # 主鍵    id INT PRIMARY KEY AUTO_INCREMENT,    # 姓名    NAME VARCHAR(10),    # 餘額    money DOUBLE);-- 添加兩個用戶INSERT INTO account(NAME, money) VALUES ('張人大', 1000), ('布萊爾', 1000);-- 模擬張人大給布萊爾轉 500 元錢# 張人大賬戶減去 500 元UPDATE account SET money = money - 500 WHERE NAME = '張人大';# 布萊爾賬戶增加 500 元UPDATE account SET money = money + 500 WHERE NAME = '布萊爾';-- 假設當張人大減去了錢，然後服務器崩潰。-- 布萊爾的賬號並沒有收到錢，數據就出現問題。-- 所以要保證整個事務執行的完整性，要麼都成功，要麼都失敗。</code></pre><h1 class=pgc-h-arrow-right>MySQL Transaction Operations</h1><p>MySQL 中可以有兩種方式進行事務的操作：手動或自動提交事務。</p><h1 class=pgc-h-arrow-right>手動提交事務</h1><p>開啟事務 - start transaction; 或 BEGIN;</p><p>提交事務 - commit;</p><p>回滾事務 - rollback;</p><pre><code>-- 執行成功的情況：開啟事務 -&gt; 執行多條 SQL 語句 -&gt; 成功提交事務# 開啟事務start transaction;# 張人大賬戶減去 500 元UPDATE account SET money = money - 500 WHERE NAME = '張人大';# 布萊爾賬戶增加 500 元，此時使用 SQLyog 查看錶，發現數據並沒有改變UPDATE account SET money = money + 500 WHERE NAME = '布萊爾';# 執行 commit 提交事務，此時發現數據發生改變commit;-- 執行失敗的情況：開啟事務 -&gt; 執行多條 SQL 語句 -&gt; 事務的回滾start transaction;INSERT INTO account VALUES(NULL,'張人大',3000);INSERT INTO account VALUES(NULL,'張人大',3500);# 此時不去提交事務直接退出程序，發生回滾操作，數據沒有改變rollback;</code></pre><h1 class=pgc-h-arrow-right>自動提交事務</h1><p>MySQL 默認是自動提交事務：每一條增刪改語句都是一個單獨的事務，每條語句都會自動開啟一個事務，語句執行完畢會自動提交事務。</p><pre><code>-- 查看 autocommit 狀態SHOW VARIABLES LIKE 'autocommit';-- 取消自動提交，再次修改，則需要提交之後才生效 SET @@autocommit = off;# 修改數據update account set money = money - 500 where name = '張人大';# 手動提交commit;-- 開啟自動提交SET @@autocommit = on;</code></pre><h1 class=pgc-h-arrow-right>The Four ACID Attributes of Database Transaction</h1><p>Atomicity -- 原子性。每個事務都是一個整體，不可再拆分，事務中所有的 SQL 語句要麼都執行成功， 要麼都失敗。</p><p>Consistency -- 一致性。事務在執行前數據庫的狀態與執行後數據庫的狀態保持一致。如：轉賬前2個人的 總金額是 2000，轉賬後 2 個人總金額也是 2000。</p><p>Isolation -- 隔離性。事務與事務之間不應該相互影響，執行時保持隔離的狀態。</p><p>Durability -- 持久性。一旦事務執行成功，對數據庫的修改是持久的。就算關機，數據也是要保存下來的。</p><h1 class=pgc-h-arrow-right>Transaction Isolation Level</h1><h1 class=pgc-h-arrow-right>Data Concurrency</h1><p>數據併發訪問：一個數據庫可能擁有多個訪問客戶端，這些客戶端都可以併發方式訪問數據庫。數據庫的相同數據可能被多個事務同時訪問，如果不採取隔離措施，就會導致各種問題，破壞數據的完整性。</p><h1 class=pgc-h-arrow-right>Data Concurrency Problems</h1><p>Dirty Reads -- 髒讀：一個事務讀取到了另一個事務中尚未提交的數據</p><p>Unrepeatable Reads -- 不可重複讀：一個事務中多次讀取的數據內容不一致。這是進行 update 操作時引發的問題。注意這裡的重點是同一個事務中的多次讀取，比如開啟事務後，第一次讀取有 1000 塊錢，在事務還未結束時，第二次讀取就可能變成 500 塊錢了。又比如銀行系統的程序在一個事務中要讀取兩次數據然後發到文件和電腦屏幕上，這時候就需要保證不可重複讀的問題不會發生，否則會導致文件和電腦屏幕的數據不一致。</p><p>Phantom Reads -- 幻讀：一個事務中，某一次的 select 操作得到的結果所表徵的數據狀態，無法支撐後續的業務操作。查詢得到的數據狀態不準，導致幻讀。為什麼會出現幻讀？首先，為了解決不可重複讀問題，只能底層設置一個緩存機制來保證一個事務中每次讀取到的值會一樣；基於解決了不可重複讀問題的前提下，假設一個事務 A 查詢了數據 x 是否存在並基於查詢結果進行數據 x 的增加，但同時有另一個事務 B 提交了數據 x 的增加 ，那麼事務 A 的增加就會因為重複而報錯；這時候，在事務 A 中就會出現報錯信息提示數據 x 已經存在，但是查詢結果提示數據 x 不存在，就像出現幻覺一樣。</p><h1 class=pgc-h-arrow-right>The Four Isolation Level</h1><p>Read Uncommitted -- 讀未提交：沒有解決問題。只要數據被修改，就立即持久化修改後的值。</p><p>Read Committed -- 讀已提交：解決髒讀問題。如果數據修改沒有被提交，就不會持久化修改後的值。這是 Oracle 和 SQL 的默認隔離級別。</p><p>Repeatable Read -- 可重複讀：解決不可重複讀問題。底層設置了緩存保證一個事務內的每次讀取都是一樣的。這是 MySQL 的默認隔離級別。</p><p>Serializable -- 串行化：解決幻讀問題。解決幻讀問題只能通過取消數據併發訪問，變成串行訪問。但是串行化非常耗時，而且，影響數據庫的性能，所以，數據庫不會使用這種隔離級別。</p><pre><code>-- 查看隔離級別select @@tx_isolation;-- 修改隔離級別為讀未提交set global transaction isolation level read uncommitted;</code></pre><hr></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>數據庫</a></li><li><a>技術</a></li><li><a>MySQL</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/3269d080.html alt=MySQL數據庫的事務管理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/152203544367254a708f807 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3269d080.html title=MySQL數據庫的事務管理>MySQL數據庫的事務管理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4959ed6a.html alt="技術分享 | MySQL 的嵌套事務、自治事務與鏈式事務" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4959ed6a.html title="技術分享 | MySQL 的嵌套事務、自治事務與鏈式事務">技術分享 | MySQL 的嵌套事務、自治事務與鏈式事務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8ff1c7a8.html alt=解讀數據庫：深入分析MySQL中事務以及MVCC的實現原理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/dfic-imagehandler/8f370516-d41a-4803-84ba-2c01e4637c8b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8ff1c7a8.html title=解讀數據庫：深入分析MySQL中事務以及MVCC的實現原理>解讀數據庫：深入分析MySQL中事務以及MVCC的實現原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9bbdeed9.html alt="MySQL 數據庫、表、字段的命名建議規範" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ed974f814051426eb120a107abc94df7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9bbdeed9.html title="MySQL 數據庫、表、字段的命名建議規範">MySQL 數據庫、表、字段的命名建議規範</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ae0a02c6.html alt=MySQL數據庫+命令大全，人手一份的實操攻略來啦 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RTDWEx38S8Abbo style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ae0a02c6.html title=MySQL數據庫+命令大全，人手一份的實操攻略來啦>MySQL數據庫+命令大全，人手一份的實操攻略來啦</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c9a0268c.html alt=時序數據庫的技術和架構演進 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/122f6b0b368f4313b7efe62c811270ff style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c9a0268c.html title=時序數據庫的技術和架構演進>時序數據庫的技術和架構演進</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f179bf4.html alt="技術分享 | MySQL 網絡延時參數設置建議" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/80785e9fd972414ca6f4154d85ac8162 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f179bf4.html title="技術分享 | MySQL 網絡延時參數設置建議">技術分享 | MySQL 網絡延時參數設置建議</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3c25334.html alt=MySQL數據庫字符串類型常用操作 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/4ebac77cb4234d3f85cf2ee58b785b47 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3c25334.html title=MySQL數據庫字符串類型常用操作>MySQL數據庫字符串類型常用操作</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dacc263.html alt=MySQL數據庫中的事務以及創建表的注意事項 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dacc263.html title=MySQL數據庫中的事務以及創建表的注意事項>MySQL數據庫中的事務以及創建表的注意事項</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/e6b01ca.html alt=數據庫事務系列－MySQL跨行事務模型 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=http://p1.pstatp.com/large/dfic-imagehandler/64c5efca-90a2-44e0-99ff-f3cfd727679e style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/e6b01ca.html title=數據庫事務系列－MySQL跨行事務模型>數據庫事務系列－MySQL跨行事務模型</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/93727dba.html alt="技術帖 | 3分鐘搞定各種測試分析技術" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/f055e0a4477240088de2abb7cd696cfa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/93727dba.html title="技術帖 | 3分鐘搞定各種測試分析技術">技術帖 | 3分鐘搞定各種測試分析技術</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2d0ddee5.html alt=建築房屋結構平衡技術要求，你都會知道嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/5e7d0001715d878ed66c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2d0ddee5.html title=建築房屋結構平衡技術要求，你都會知道嗎？>建築房屋結構平衡技術要求，你都會知道嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/47c8cac0.html alt=新《裝配式混凝土建築技術標準》有哪些改變？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1540524372015dc56ec3fb9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/47c8cac0.html title=新《裝配式混凝土建築技術標準》有哪些改變？>新《裝配式混凝土建築技術標準》有哪些改變？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b6c2fc2b.html alt=鈦合金精密鑄造技術發展現狀 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/SCynkUUBbHN8CF style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b6c2fc2b.html title=鈦合金精密鑄造技術發展現狀>鈦合金精密鑄造技術發展現狀</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d2e8af08.html alt=傾斜航攝技術小知識——航線設計篇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RS1ucOiDvLRlVt style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d2e8af08.html title=傾斜航攝技術小知識——航線設計篇>傾斜航攝技術小知識——航線設計篇</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>