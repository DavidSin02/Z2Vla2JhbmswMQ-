<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ä½¿ç”¨GoåŸºæ–¼WebSocketæ§‹å»ºåƒè¬ç´šè¦–é »ç›´æ’­å½ˆå¹•ç³»çµ± | æå®¢å¿«è¨Š</title><meta property="og:title" content="ä½¿ç”¨GoåŸºæ–¼WebSocketæ§‹å»ºåƒè¬ç´šè¦–é »ç›´æ’­å½ˆå¹•ç³»çµ± - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/f89b8532845242149b2510d6fe6b0bec"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/af44354f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/af44354f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/af44354f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/af44354f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/af44354f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/af44354f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/af44354f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/af44354f.html><meta property="article:published_time" content="2020-11-14T20:55:07+08:00"><meta property="article:modified_time" content="2020-11-14T20:55:07+08:00"><meta name=Keywords content><meta name=description content="ä½¿ç”¨GoåŸºæ–¼WebSocketæ§‹å»ºåƒè¬ç´šè¦–é »ç›´æ’­å½ˆå¹•ç³»çµ±"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/af44354f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ä½¿ç”¨GoåŸºæ–¼WebSocketæ§‹å»ºåƒè¬ç´šè¦–é »ç›´æ’­å½ˆå¹•ç³»çµ±</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h2 class=pgc-h-arrow-right>ï¼ˆ1ï¼‰æ¥­å‹™è¤‡é›œåº¦ä»‹ç´¹</h2><p>é–‹é–€è¦‹å±±ï¼Œå‡è¨­ä¸€å€‹ç›´æ’­é–“åŒæ™‚500Wäººåœ¨ç·šï¼Œé‚£éº¼1ç§’é˜1000æ¢å½ˆå¹•ï¼Œé‚£éº¼å½ˆå¹•ç³»çµ±çš„æ¨é€é »ç‡å°±æ˜¯ï¼š500W * 1000æ¢/ç§’=50å„„æ¢/ç§’ï¼Œæƒ³æƒ³Bç«™2019è·¨å¹´æ™šæœƒé‚£æ¬¡å½ˆå¹•ç³»çµ±å¾—æ˜¯å¤šéº¼çš„NBï¼Œæ³ä¸”ä¸€å€‹å¤§å‹ç¶²ç«™ä¸å¯èƒ½åªæœ‰ä¸€å€‹ç›´æ’­é–“ï¼</p><p>goèªè¨€ä¸­æ–‡æ–‡æª”ï¼šwww.topgoer.com</p><p>è½‰è‡ªï¼šhttps://blog.51cto.com/xvjunjie/2509035</p><div class=pgc-img><img alt=ä½¿ç”¨GoåŸºæ–¼WebSocketæ§‹å»ºåƒè¬ç´šè¦–é »ç›´æ’­å½ˆå¹•ç³»çµ± onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f89b8532845242149b2510d6fe6b0bec><p class=pgc-img-caption></p></div><p>ä½¿ç”¨GoåšWebSocketé–‹ç™¼ç„¡éå°±æ˜¯ä¸‰ç¨®æƒ…æ³ï¼š</p><ul><li>ä½¿ç”¨GoåŸç”Ÿè‡ªå¸¶çš„åº«ï¼Œä¹Ÿå°±æ˜¯golang.org/x/netï¼Œä½†æ˜¯é€™å€‹å®˜æ–¹åº«çœŸæ˜¯å‡ºäº†å¥‡Bugå¤š</li><li>ä½¿ç”¨GitHubå¤§ä½¬gorilla/websocketåº«ï¼Œå¯ä»¥çµåˆåˆ°æŸäº›Webé–‹ç™¼æ¡†æ¶ï¼Œæ¯”å¦‚Ginã€irisç­‰ï¼Œåªè¦ä½¿ç”¨çš„æ¡†æ¶å¼åŸºæ–¼golang.org/netçš„ï¼Œé‚£éº¼é€™å€‹åº«å°±å¯ä»¥èˆ‡é€™å€‹æ¡†æ¶çµåˆ</li><li>æ‰‹æ“¼ä¸€å€‹WebSocketæ¡†æ¶</li></ul><p>æ ¹æ“šä¼°ç®—çµæœï¼Œå½ˆå¹•æ¨é€é‡å¾ˆå¤§çš„æ™‚å€™ï¼ŒLinuxå…§æ ¸å°‡æœƒå‡ºç¾ç“¶é ¸ï¼Œå› ç‚ºLinuxå…§æ ¸ç™¼é€TCPåŒ…çš„æ™‚å€™æ¥µé™åŒ…ç™¼é€é »ç‡æ˜¯100Wã€‚å› æ­¤å¯ä»¥å°‡åŒä¸€ç§’å…§çš„å½ˆå¹•æ¶ˆæ¯åˆä½µç‚º1æ¢æ¨é€ï¼Œæ¸›å°‘ç¶²çµ¡å°æ•¸æ“šåŒ…çš„ç™¼é€ï¼Œå¾è€Œé™ä½æ¨é€é »ç‡ã€‚</p><p>å½ˆå¹•ç³»çµ±éœ€è¦ç¶­è­·åœ¨ç·šçš„ç”¨æˆ¶é•·é€£æ¥ä¾†å¯¦ç¾å®šå‘æ¨é€åˆ°åœ¨ç·šçš„ç”¨æˆ¶ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨Hashå­—å…¸çµæ§‹ï¼Œé€šå¸¸æ¨é€æ¶ˆæ¯å°±æ˜¯éæ­·åœ¨ç·šç”¨çš„Hashå­—å…¸ã€‚åœ¨å½ˆå¹•æ¨é€æœŸé–“ç”¨æˆ¶åœ¨ä¸æ–·çš„ä¸Šä¸‹ç·šï¼Œç‚ºäº†ç¶­è­·ä¸Šç·šç”¨æˆ¶ï¼Œé‚£éº¼å°±å¾—ä¸æ–·çš„ä¿®æ”¹Hashå­—å…¸ï¼Œä¸æ–·åœ°é€²è¡Œé–æ“ä½œï¼Œç”¨æˆ¶é‡éå¤§å°è‡´é–ç“¶é ¸ã€‚å› æ­¤å¯ä»¥å°‡æ•´å€‹Hashçµæ§‹æ‹†åˆ†ç‚ºå¤šå€‹Hashçµæ§‹ï¼Œåˆ†åˆ¥å°å¤šå€‹Hashçµæ§‹åŠ ä¸åŒçš„é–ï¼Œä¸¦ä¸”ä½¿ç”¨è®€å¯«é–æ›¿ä»£äº’æ–¥é–ã€‚</p><p>é€šå¸¸æœå‹™å™¨èˆ‡å®¢æˆ¶ç«¯äº¤äº’ä½¿ç”¨JSONçµæ§‹ï¼Œé‚£éº¼éœ€è¦ä¸æ–·çš„ç·¨ç¢¼è§£ç¢¼JSONæ•¸æ“šï¼Œé€™å°‡æœƒå°è‡´CPUç“¶é ¸ã€‚å°‡æ¶ˆæ¯å…ˆé€²è¡Œåˆä½µï¼Œç„¶å¾Œé€²è¡Œç·¨ç¢¼ï¼Œæœ€å¾Œè¼ªè©¢Hashçµæ§‹é€²è¡Œæ¨é€ã€‚</p><p>ä»¥ä¸Šæ˜¯å–®é«”æ¶æ§‹å­˜åœ¨çš„å•é¡Œï¼Œç‚ºäº†æ”¯æŒæ›´å¤šçš„ç”¨æˆ¶è² è¼‰ï¼Œé€šå¸¸å½ˆå¹•ç³»çµ±æ¡ç”¨åˆ†ä½ˆå¼æ¶æ§‹ï¼Œé€²è¡Œå½ˆæ€§æ“´å®¹ç¸®å®¹ã€‚</p><h2 class=pgc-h-arrow-right>ï¼ˆ2ï¼‰æ¨é€é‚„æ˜¯æ‹‰å–ï¼Ÿ</h2><p>å¦‚æœæ˜¯å®¢æˆ¶ç«¯æ‹‰å–æœå‹™å™¨ç«¯æ•¸æ“šï¼Œé‚£éº¼å°‡æœƒå­˜åœ¨ä»¥ä¸‹å¹¾å€‹å•é¡Œï¼š</p><ul><li>ç›´æ’­åœ¨ç·šäººæ•¸å¤šå°±æ„å‘³è‘—æ¶ˆæ¯æ•¸æ“šæ›´æ–°é »ç‡é«˜ï¼Œæ‹‰å–æ¶ˆæ¯æ„å‘³è‘—å½ˆå¹•ç„¡æ³•æ»¿è¶³æ™‚æ•ˆæ€§</li><li>å¦‚æœå¾ˆå¤šå®¢æˆ¶ç«¯åŒæ™‚æ‹‰å–ï¼Œé‚£éº¼æœå‹™å™¨ç«¯çš„å£“åŠ›ç„¡ç•°æ–¼DDOS</li><li>ä¸€å€‹å½ˆå¹•ç³»çµ±æ‡‰è©²æ˜¯é€šç”¨çš„ï¼Œå› æ­¤å°æ–¼ç›´æ’­é–“å½ˆå¹•è¼ƒå°‘çš„å ´æ™¯ï¼Œæ„å‘³è‘—æ¶ˆæ¯æ•¸æ“šæ‹‰å–è«‹æ±‚éƒ½æ˜¯ç„¡æ•ˆçš„</li></ul><p>å› æ­¤æˆ‘å€‘è€ƒæ…®æ¨é€æ¨¡å¼ï¼šç•¶æ•¸æ“šç™¼ç”Ÿæ›´æ–°çš„æ™‚å€™æœå‹™å™¨ç«¯ä¸»å‹•æ¨é€åˆ°å®¢æˆ¶ç«¯ï¼Œé€™æ¨£å¯ä»¥æœ‰æ•ˆæ¸›å°‘å®¢æˆ¶ç«¯çš„è«‹æ±‚æ¬¡æ•¸ã€‚å¦‚æœéœ€è¦å¯¦ç¾æ¶ˆæ¯æ¨é€ï¼Œé‚£éº¼å°±æ„å‘³è‘—æœå‹™å™¨ç«¯ç¶­è­·å¤§é‡çš„é•·é€£æ¥ã€‚</p><h2 class=pgc-h-arrow-right>ï¼ˆ3ï¼‰ç‚ºä»€éº¼ä½¿ç”¨WebSocketï¼Ÿ</h2><p>å¯¦ç¾å½ˆå¹•æ¶ˆæ¯çš„å¯¦æ™‚æ›´æ–°ä¸€å®šæ˜¯ä½¿ç”¨Socketçš„æ–¹å¼ï¼Œé‚£éº¼ç‚ºå•¥è¦ä½¿ç”¨WebSocketå‘¢ï¼Ÿç¾åœ¨å¤§éƒ¨åˆ†ç›´æ’­æ‡‰ç”¨çš„é–‹ç™¼éƒ½æ˜¯è·¨å¹³è‡ºçš„ï¼Œç„¶è€Œè·¨å¹³è‡ºçš„é–‹ç™¼æ¡†æ¶æœ¬è³ªå°±æ˜¯Webé–‹ç™¼ï¼Œé‚£éº¼ä¸€å®šé›¢ä¸é–‹WebSocketï¼Œè€Œä¸”ä¸€éƒ¨åˆ†ç”¨æˆ¶æœƒé¸æ“‡åœ¨Webç«¯çœ‹è¦–é »ï¼Œæ¯”å¦‚Bilibiliï¼Œç¾å¦‚ä»Šä¹Ÿæœ‰ä¸€äº›æ¡Œé¢æ‡‰ç”¨æ˜¯ç”¨Electronç­‰è·¨å¹³è‡ºæ¡†æ¶é–‹ç™¼çš„ï¼Œæ¯”å¦‚Larké£›æ›¸ç­‰ï¼Œå› æ­¤å¯¦ç¾æ¶ˆæ¯æ¨é€çš„æœ€ä½³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨WebSocketã€‚</p><p>ä½¿ç”¨WebSocketå¯ä»¥è¼•é¬†çš„ç¶­æŒæœå‹™å™¨ç«¯é•·é€£æ¥ï¼Œå…¶æ¬¡WebSocketæ˜¯æ¶æ§‹åœ¨HTTPå”è­°ä¹‹ä¸Šçš„ï¼Œä¸¦ä¸”ä¹Ÿå¯ä»¥ä½¿ç”¨HTTPSæ–¹å¼ï¼Œå› æ­¤WebSocketæ˜¯å¯é å‚³è¼¸ï¼Œä¸¦ä¸”ä¸éœ€è¦é–‹ç™¼è€…é—œæ³¨åº•å±¤ç´°ç¯€ã€‚</p><div class=pgc-img><img alt=ä½¿ç”¨GoåŸºæ–¼WebSocketæ§‹å»ºåƒè¬ç´šè¦–é »ç›´æ’­å½ˆå¹•ç³»çµ± onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/bdb483f6895640618baeaed7b597534f><p class=pgc-img-caption></p></div><p>ç‚ºå•¥è¦ä½¿ç”¨GoæWebSocketå‘¢ï¼Ÿé¦–å…ˆèªªåˆ°WebSocketä½ å¯èƒ½æœƒæƒ³åˆ°Node.jsï¼Œä½†æ˜¯Node.jsæ˜¯å–®ç·šç¨‹æ¨¡å‹ï¼Œå¦‚æœå¯¦ç¾é«˜ä½µç™¼ï¼Œä¸å¾—ä¸å‰µå»ºå¤šå€‹Node.jsé€²ç¨‹ï¼Œä½†æ˜¯é€™åˆä¸å®¹æ˜“æœå‹™ç«¯éæ­·æ•´å€‹é€£æ¥é›†åˆï¼›å¦‚æœä½¿ç”¨Javaå°±æœƒé¡¯å¾—æ¯”è¼ƒç¬¨é‡ï¼ŒJavaé …ç›®çš„éƒ¨ç½²ï¼Œç·¨å¯«Dockerfileéƒ½ä¸å¦‚Goçš„ç›®æ¨™äºŒé€²åˆ¶æ›´åŠ ç°¡æ½”ï¼Œä¸¦ä¸”Goå”ç¨‹å¾ˆå®¹æ˜“å¯¦ç¾é«˜ä½µç™¼ï¼Œä¸Šä¸€ç« èªªåˆ°Goèªè¨€ç›®å‰ä¹Ÿæœ‰æˆç†Ÿçš„WebSocketè¼ªå­ã€‚</p><h2 class=pgc-h-arrow-right>ï¼ˆ4ï¼‰æœå‹™ç«¯åŸºæœ¬Demo</h2><p>é¦–å…ˆæ­å»ºå¥½ä¸€å€‹æ¡†æ¶ï¼š</p><pre><code>package mainimport (    "fmt"    "net/http")func main() {  fmt.Println("Listen localhost:8080")     // è¨»å†Šä¸€å€‹ç”¨æ–¼WebSocketçš„è·¯ç”±ï¼Œå¯¦éš›æ¥­å‹™ä¸­ä¸å¯èƒ½åªæœ‰ä¸€å€‹è·¯ç”±    http.HandleFunc("/messages", messageHandler)    // ç›£è½8080ç«¯å£ï¼Œæ²’æœ‰å¯¦ç¾æœå‹™ç•°å¸¸è™•ç†å™¨ï¼Œå› æ­¤ç¬¬äºŒå€‹åƒæ•¸æ˜¯nil    http.ListenAndServe("localhost:8080", nil)}func messageHandler(response http.ResponseWriter, request *http.Request) {    // TODO: å¯¦ç¾æ¶ˆæ¯è™•ç†    response.Write([]byte("HelloWorld"))}</code></pre><p>ç„¶å¾Œå®Œå–„messageHandlerå‡½æ•¸ï¼š</p><pre><code>func messageHandler(response http.ResponseWriter, request *http.Request) {    var upgrader = websocket.Upgrader{        // å…è¨±è·¨åŸŸ        CheckOrigin: func(resquest *http.Request) bool {            return true        },    }    // å»ºç«‹é€£æ¥    conn, err := upgrader.Upgrade(response, request, nil)    if err != nil {        return    }    // æ”¶ç™¼æ¶ˆæ¯    for {        // è®€å–æ¶ˆæ¯        _, bytes, err := conn.ReadMessage()        if err != nil {            _ = conn.Close()        }        // å¯«å…¥æ¶ˆæ¯        err = conn.WriteMessage(websocket.TextMessage, bytes)        if err != nil {            _ = conn.Close()        }    }}</code></pre><p>ç¾åœ¨åŸºæœ¬ä¸Šå¯¦ç¾äº†WebSocketåŠŸèƒ½ï¼Œä½†æ˜¯websocketçš„åŸç”ŸAPIä¸æ˜¯ç·šç¨‹å®‰å…¨çš„ï¼ˆCloseæ–¹æ³•æ˜¯ç·šç¨‹å®‰å…¨çš„ï¼Œä¸¦ä¸”æ˜¯å¯é‡å…¥çš„ï¼‰ï¼Œä¸¦ä¸”å…¶ä»–æ¨¡å¡Šç„¡æ³•è¤‡ç”¨æ¥­å‹™é‚è¼¯ï¼Œå› æ­¤é€²è¡Œå°è£ï¼š</p><ul><li>å°è£Connectionå°è±¡æè¿°ä¸€å€‹WebSocketé€£æ¥</li><li>ç‚ºConnectionå°è±¡æä¾›ç·šç¨‹å®‰å…¨çš„é—œé–‰ã€æ¥æ”¶ã€ç™¼é€API</li></ul><pre><code>// main.gopackage mainimport (    "bluemiaomiao.github.io/websocket-go/service"    "fmt"    "net/http"    "github.com/gorilla/websocket")func main() {    fmt.Println("Listen localhost:8080")    http.HandleFunc("/messages", messageHandler)    _ = http.ListenAndServe("localhost:8080", nil)}func messageHandler(response http.ResponseWriter, request *http.Request) {    var upgrader = websocket.Upgrader{        // å…è¨±è·¨åŸŸ        CheckOrigin: func(resquest *http.Request) bool {            return true        },    }    // å»ºç«‹é€£æ¥    conn, err := upgrader.Upgrade(response, request, nil)    wsConn, err := service.Create(conn)    if err != nil {        return    }    // æ”¶ç™¼æ¶ˆæ¯    for {        // è®€å–æ¶ˆæ¯        msg, err := wsConn.ReadOne()        if err != nil {            wsConn.Close()        }        // å¯«å…¥æ¶ˆæ¯        err = wsConn.WriteOne(msg)        if err != nil {            _ = conn.Close()        }    }}</code></pre><pre><code>// service/messsage_service.gopackage serviceimport (    "errors"    "github.com/gorilla/websocket"    "sync")// å°è£çš„é€£æ¥å°è±¡// // ç”±æ–¼websocketçš„Close()æ–¹æ³•æ˜¯å¯é‡å…¥çš„ï¼Œæ‰€ä»¥å¯ä»¥å¤šæ¬¡èª¿ç”¨ï¼Œä½†æ˜¯é—œé–‰Channelçš„close()// æ–¹æ³•ä¸æ˜¯å¯é‡å…¥çš„ï¼Œå› æ­¤é€šéisClosedé€²è¡Œåˆ¤æ–·// isClosedå¯èƒ½ç™¼ç”Ÿè³‡æºç«¶çˆ­ï¼Œå› æ­¤é€šéäº’æ–¥é–é¿å…// é—œé–‰websocketé€£æ¥å¾Œï¼Œä¹Ÿè¦è‡ªå‹•é—œé–‰è¼¸å…¥è¼¸å‡ºæ¶ˆæ¯æµï¼Œå› æ­¤é€šésignalCloseLoopChanå¯¦ç¾type Connection struct {    conn                                   *websocket.Conn    // å…·é«”çš„é€£æ¥å°è±¡    inputStream                         chan []byte             // è¼¸å…¥æµï¼Œä½¿ç”¨Channelæ¨¡æ“¬    outputStream                      chan []byte             // è¼¸å‡ºæµï¼Œä½¿ç”¨chaneelæ¨¡æ“¬    signalCloseLoopChan         chan byte              // é—œé–‰ä¿¡è™Ÿ    isClosed                              bool                       // æ˜¯å¦èª¿ç”¨éclose()æ–¹æ³•    lock                                     sync.Mutex            // ç°¡å–®çš„é–}// ç”¨æ–¼åˆå§‹åŒ–ä¸€å€‹é€£æ¥å°è±¡func Create(conn *websocket.Conn) (connection *Connection, err error) {    connection = &amp;Connection{        conn:                            conn,        inputStream:                make(chan []byte, 1000),        outputStream:              make(chan []byte, 1000),        signalCloseLoopChan: make(chan byte, 1),        isClosed:                       false,    }    // å•Ÿå‹•è®€å¯«å¾ªç’°    go connection.readLoop()    go connection.writeLoop()    return}// è®€å–ä¸€æ¢æ¶ˆæ¯func (c *Connection) ReadOne() (msg []byte, err error) {    select {    case msg = &lt;-(*c).inputStream:    case &lt;-(*c).signalCloseLoopChan:        err = errors.New("connection is closed")    }    return}// å¯«å…¥ä¸€æ¢æ¶ˆæ¯func (c *Connection) WriteOne(msg []byte) (err error) {    select {    case (*c).outputStream &lt;- msg:    case &lt;-(*c).signalCloseLoopChan:        err = errors.New("connection is closed")    }    return}// é—œé–‰é€£æ¥å°è±¡func (c *Connection) Close() {    _ = (*c).conn.Close()    (*c).lock.Lock()    if !(*c).isClosed {        close((*c).signalCloseLoopChan)    }    (*c).lock.Unlock()}// è®€å–å¾ªç’°func (c *Connection) readLoop() {    // ä¸åœçš„è®€å–é•·é€£æ¥ä¸­çš„æ¶ˆæ¯ï¼Œåªè¦å­˜åœ¨æ¶ˆæ¯å°±å°‡å…¶æ”¾åˆ°éšŠåˆ—ä¸­    for {        _, bytes, err := (*c).conn.ReadMessage()        if err != nil {            (*c).Close()        }        select {        case &lt;-(*c).signalCloseLoopChan:            (*c).Close()        case (*c).inputStream &lt;- bytes:        }    }}// å¯«å…¥å¾ªç’°func (c *Connection) writeLoop() {    // åªè¦éšŠåˆ—ä¸­å­˜åœ¨æ¶ˆæ¯ï¼Œå°±å°‡å…¶å¯«å…¥    var data []byte    for {        select {        case data = &lt;-(*c).outputStream:        case &lt;-(*c).signalCloseLoopChan:            (*c).Close()        }        err := (*c).conn.WriteMessage(websocket.TextMessage, data)        if err != nil {            _ = (*c).conn.Close()        }    }}</code></pre><p>è‡³æ­¤ï¼Œä½ å·²ç¶“å­¸æœƒäº†å¦‚ä½•ä½¿ç”¨Goæ§‹å»ºWebSocketæœå‹™ã€‚</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Go</a></li><li><a>WebSocket</a></li><li><a>æ§‹å»ºåƒè¬ç´š</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/85697d72.html alt="æˆ‘ç”¨ Go ç”Ÿæˆçš„éš¨æ©Ÿæ•¸ç‚ºä»€éº¼ä¸éš¨æ©Ÿï¼Ÿéš¨æ©Ÿæ•¸æ˜¯æ€æ¨£ç”¢ç”Ÿçš„" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/47dfbe87bec844cf988f2e497c78641a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/85697d72.html title="æˆ‘ç”¨ Go ç”Ÿæˆçš„éš¨æ©Ÿæ•¸ç‚ºä»€éº¼ä¸éš¨æ©Ÿï¼Ÿéš¨æ©Ÿæ•¸æ˜¯æ€æ¨£ç”¢ç”Ÿçš„">æˆ‘ç”¨ Go ç”Ÿæˆçš„éš¨æ©Ÿæ•¸ç‚ºä»€éº¼ä¸éš¨æ©Ÿï¼Ÿéš¨æ©Ÿæ•¸æ˜¯æ€æ¨£ç”¢ç”Ÿçš„</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/317308ae.html alt="Go ä¹‹ç¦ªï¼šDaveå‘Šè¨´ä½ ç·¨å¯«ç°¡å–®ã€å¯è®€ã€å¯ç¶­è­·ä»£ç¢¼çš„åå€‹å·¥ç¨‹ç¶“é©—" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/35e73626e50e4835a1eacdc0f5f74a69 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/317308ae.html title="Go ä¹‹ç¦ªï¼šDaveå‘Šè¨´ä½ ç·¨å¯«ç°¡å–®ã€å¯è®€ã€å¯ç¶­è­·ä»£ç¢¼çš„åå€‹å·¥ç¨‹ç¶“é©—">Go ä¹‹ç¦ªï¼šDaveå‘Šè¨´ä½ ç·¨å¯«ç°¡å–®ã€å¯è®€ã€å¯ç¶­è­·ä»£ç¢¼çš„åå€‹å·¥ç¨‹ç¶“é©—</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7e187bc3.html alt=Goèªè¨€ä¹‹çˆ¶å¸¶ä½ é‡æ–°èªè­˜å­—ç¬¦ä¸²ã€å­—ç¯€ã€runeå’Œå­—ç¬¦ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/52e46ed353da4c058a36fb1153b3bf17 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7e187bc3.html title=Goèªè¨€ä¹‹çˆ¶å¸¶ä½ é‡æ–°èªè­˜å­—ç¬¦ä¸²ã€å­—ç¯€ã€runeå’Œå­—ç¬¦>Goèªè¨€ä¹‹çˆ¶å¸¶ä½ é‡æ–°èªè­˜å­—ç¬¦ä¸²ã€å­—ç¯€ã€runeå’Œå­—ç¬¦</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/288f86f6.html alt=Goèªè¨€å¯¦ç¾ï¼šå¸¸è¦‹æ’åºç®—æ³• class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/3a6d9a4e785e4fa097b0adf18620d616 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/288f86f6.html title=Goèªè¨€å¯¦ç¾ï¼šå¸¸è¦‹æ’åºç®—æ³•>Goèªè¨€å¯¦ç¾ï¼šå¸¸è¦‹æ’åºç®—æ³•</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/73f8e8da.html alt=Goèªè¨€å­¸ç¿’åŸºç¤-ç”Ÿæˆé€²ç¨‹ã€æ›¿æ›é€²ç¨‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0006f0b743b040789141c4474d31a24c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/73f8e8da.html title=Goèªè¨€å­¸ç¿’åŸºç¤-ç”Ÿæˆé€²ç¨‹ã€æ›¿æ›é€²ç¨‹>Goèªè¨€å­¸ç¿’åŸºç¤-ç”Ÿæˆé€²ç¨‹ã€æ›¿æ›é€²ç¨‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/013bd19f.html alt=WebSocketå®¢æˆ¶ç«¯æ–·é–‹é€£æ¥å¾Œï¼Œæœå‹™å™¨ç«¯çš„è™•ç†æ©Ÿåˆ¶ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/87a28fa28fc442ea86284897f8232f58 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/013bd19f.html title=WebSocketå®¢æˆ¶ç«¯æ–·é–‹é€£æ¥å¾Œï¼Œæœå‹™å™¨ç«¯çš„è™•ç†æ©Ÿåˆ¶>WebSocketå®¢æˆ¶ç«¯æ–·é–‹é€£æ¥å¾Œï¼Œæœå‹™å™¨ç«¯çš„è™•ç†æ©Ÿåˆ¶</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fb36bf65.html alt=WebSocketå®¢æˆ¶ç«¯é€£æ¥æ–·é–‹å¾Œï¼Œæœå‹™å™¨ç«¯çš„ææ§‹è™•ç† class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/cde98b789c1a4a4cb384148be9d5903a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fb36bf65.html title=WebSocketå®¢æˆ¶ç«¯é€£æ¥æ–·é–‹å¾Œï¼Œæœå‹™å™¨ç«¯çš„ææ§‹è™•ç†>WebSocketå®¢æˆ¶ç«¯é€£æ¥æ–·é–‹å¾Œï¼Œæœå‹™å™¨ç«¯çš„ææ§‹è™•ç†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4cc38087.html alt="Go å¦‚ä½•ç²å–ç•¶å‰åŸ·è¡Œæ–‡ä»¶æ‰€åœ¨çš„ç›®éŒ„ï¼Ÿ" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/4d316ba5638c47e391011bce4e28f6a8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4cc38087.html title="Go å¦‚ä½•ç²å–ç•¶å‰åŸ·è¡Œæ–‡ä»¶æ‰€åœ¨çš„ç›®éŒ„ï¼Ÿ">Go å¦‚ä½•ç²å–ç•¶å‰åŸ·è¡Œæ–‡ä»¶æ‰€åœ¨çš„ç›®éŒ„ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/190ae162.html alt="å¦‚ä½•åœ¨ Go ä¸­å¯«å‡ºé«˜æ•ˆçš„å–®å…ƒæ¸¬è©¦" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ed1aef2573fe45c582af69ef44638521 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/190ae162.html title="å¦‚ä½•åœ¨ Go ä¸­å¯«å‡ºé«˜æ•ˆçš„å–®å…ƒæ¸¬è©¦">å¦‚ä½•åœ¨ Go ä¸­å¯«å‡ºé«˜æ•ˆçš„å–®å…ƒæ¸¬è©¦</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2122bafb.html alt="å°æ¯”è‘—å­¸ Go èªè¨€-åŸºç¤ï¼šé¢å‘å°è±¡ç·¨ç¨‹ä¹‹æ¥å£" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2122bafb.html title="å°æ¯”è‘—å­¸ Go èªè¨€-åŸºç¤ï¼šé¢å‘å°è±¡ç·¨ç¨‹ä¹‹æ¥å£">å°æ¯”è‘—å­¸ Go èªè¨€-åŸºç¤ï¼šé¢å‘å°è±¡ç·¨ç¨‹ä¹‹æ¥å£</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/27147bdc.html alt=æ²’æŒæ¡é€™å€‹çŸ¥è­˜é»ï¼Œä½ çš„Goèªè¨€åŸºç¤æ˜¯ä¸ç´®å¯¦çš„ï¼šæ¥å£å¾ˆé‡è¦ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/2d906b089a5b448f9cc8c13c1031d4c0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/27147bdc.html title=æ²’æŒæ¡é€™å€‹çŸ¥è­˜é»ï¼Œä½ çš„Goèªè¨€åŸºç¤æ˜¯ä¸ç´®å¯¦çš„ï¼šæ¥å£å¾ˆé‡è¦>æ²’æŒæ¡é€™å€‹çŸ¥è­˜é»ï¼Œä½ çš„Goèªè¨€åŸºç¤æ˜¯ä¸ç´®å¯¦çš„ï¼šæ¥å£å¾ˆé‡è¦</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d6b5eb9f.html alt="è©³ç´°ä»‹ç´¹ Go ä¸­å¦‚ä½•å¯¦ç¾ bitset" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/aa4b2de8-ff82-4bfc-a72e-77a49dc17c63 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d6b5eb9f.html title="è©³ç´°ä»‹ç´¹ Go ä¸­å¦‚ä½•å¯¦ç¾ bitset">è©³ç´°ä»‹ç´¹ Go ä¸­å¦‚ä½•å¯¦ç¾ bitset</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/5ad9b6f8.html alt="Ready Go!é™¸è»é‚Šæµ·é˜²å­¸é™¢é¦–å±†è»äº‹æ¯”æ­¦é‹å‹•æœƒâ€œä¸€è§¸å³ç™¼â€" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15264415386849b8f4ba53d style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/5ad9b6f8.html title="Ready Go!é™¸è»é‚Šæµ·é˜²å­¸é™¢é¦–å±†è»äº‹æ¯”æ­¦é‹å‹•æœƒâ€œä¸€è§¸å³ç™¼â€">Ready Go!é™¸è»é‚Šæµ·é˜²å­¸é™¢é¦–å±†è»äº‹æ¯”æ­¦é‹å‹•æœƒâ€œä¸€è§¸å³ç™¼â€</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/df1659b7.html alt="Go èªè¨€åœ¨æ¥µå°ç¡¬ä»¶ä¸Šçš„é‹ç”¨ï¼ˆäºŒï¼‰" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e76fc77d34ef460bbe3f5fddb64b0f57 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/df1659b7.html title="Go èªè¨€åœ¨æ¥µå°ç¡¬ä»¶ä¸Šçš„é‹ç”¨ï¼ˆäºŒï¼‰">Go èªè¨€åœ¨æ¥µå°ç¡¬ä»¶ä¸Šçš„é‹ç”¨ï¼ˆäºŒï¼‰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/be5b02ae.html alt="Goï¼šGoroutine çš„åˆ‡æ›éç¨‹å¯¦éš›ä¸Šæ¶‰åŠäº†ä»€éº¼" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/57e063b10f50450190fde2fe07d4d666 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/be5b02ae.html title="Goï¼šGoroutine çš„åˆ‡æ›éç¨‹å¯¦éš›ä¸Šæ¶‰åŠäº†ä»€éº¼">Goï¼šGoroutine çš„åˆ‡æ›éç¨‹å¯¦éš›ä¸Šæ¶‰åŠäº†ä»€éº¼</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>