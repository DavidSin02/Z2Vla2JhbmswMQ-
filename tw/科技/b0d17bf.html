<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>阿里畢玄：系統架構師如何做好系統設計？ | 极客快訊</title><meta property="og:title" content="阿里畢玄：系統架構師如何做好系統設計？ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/af174083e4544bdfb0b17d3c33bab782"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b0d17bf.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b0d17bf.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b0d17bf.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b0d17bf.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b0d17bf.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b0d17bf.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b0d17bf.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b0d17bf.html><meta property="article:published_time" content="2020-10-29T20:59:28+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:28+08:00"><meta name=Keywords content><meta name=description content="阿里畢玄：系統架構師如何做好系統設計？"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/b0d17bf.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>阿里畢玄：系統架構師如何做好系統設計？</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p class=ql-align-center><br></p><div class=pgc-img><img alt=阿里畢玄：系統架構師如何做好系統設計？ onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/af174083e4544bdfb0b17d3c33bab782><p class=pgc-img-caption></p></div><blockquote><p>阿里妹導讀：畢玄是阿里巴巴資深技術專家，07年加入阿里，一手打造了HSF，十多年來更見證參與了阿里在基礎技術上的演進與發展。他覺得系統設計是遠比 Java 編程技能更難的培訓，很容易變成務虛課。為了挑戰難題，畢玄決定大膽嘗試在內部搞了個民間培訓。於是就有了今天的文章，希望這些深入淺出的解讀能給架構師們帶來一些收穫。</p></blockquote><div class=pgc-img><img alt=阿里畢玄：系統架構師如何做好系統設計？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/897a7b31a828474fbce94b659f53fa5d><p class=pgc-img-caption></p></div><p>阿里巴巴資深技術專家 畢玄</p><p>本文轉自畢玄老師個人公眾號：hellojavacases（不常更新，一更就是經典）</p><hr><p>系統設計我一直覺得是遠比Java編程技能更難多了的培訓，很容易變成務虛課，全是一堆理論，所以，以前從來不敢嘗試做這方面的培訓，今年由於一些情況，決定大膽嘗試下，就在內部搞了個民間的培訓，還真有不少同學捧場。在開始上這門課後，我覺得收穫最大的搞不好是我自己，整理思路，從和學員的互動中學習到了很多，能更好地對系統設計的一些方法論進行抽象總結，所以我對這些捧場的學員們說：其實是我們一起在共創系統設計的課程 。</p><p>我給系統設計培訓定的目標是：</p><ol><li>通過這堂課掌握一個思考框架，知道做系統設計的套路，系統設計不是簡單的上來就畫畫框什麼，必須按照一定的套路才能更好的進行系統設計；</li><li>拓寬知識面，系統設計中非常重要的是考慮的全面性，以更好的進行權衡取捨，所以能不能借助系統設計培訓來拓寬知識面非常重要。</li></ol><p>而要達到這樣的效果，怎麼去上這堂課挑戰其實是不小的：想要傳達的思考框架到底是什麼？怎麼樣變成不是純粹的理論，務虛的傳達，從而讓大家能更好的掌握並真正的去運用這個思考框架？以前真的沒仔細的思考過系統設計的思考框架的問題，其實吧很多的系統設計的模板就是一個思考框架，但在不理解的情況下，是很難應用好的。</p><h1><strong>系統設計的套路</strong></h1><p>回顧了下自己做過的幾個系統的設計，發現現在自己在做系統設計的時候確實是會按照一個套路去做，這個套路就是：</p><p><strong>系統設計的目的->系統設計的目標->圍繞目標的核心設計->圍繞核心設計形成的設計原則->各子系統，模塊的詳細設計。</strong></p><p><strong>1) 系統設計的目的</strong></p><p>是指做這個系統設計的目的到底是什麼，很多人在做系統設計時，是搞不清為什麼要做一個新系統的設計，或者為什麼要做一個系統的重構/演進的設計，如果搞不清楚這個目的，後面的系統設計上是很容易形成偏差的，導致本來是為了解決一個問題，要去做新的系統或重構/升級舊的系統，但最後完全脫離了初心。</p><p>另外，還有很重要的一點是，一個大架構師是需要給很多人講解系統設計的，只有理解並講清了系統設計的目的，團隊才能更好的去實現。</p><p><strong>2) 系統設計的目標</strong></p><p>圍繞上面的目的，能不能形成一些可衡量的目標，從而確保最終系統實現和最初的目的不要出現太大的偏差，相信很多人都經歷過最終的系統實現和系統設計偏差極大的現象，主要的原因基本都是沒有制定衡量系統設計的目標，並在系統設計上讓系統能透出這些目標的情況。</p><p><strong>3) 圍繞目標的核心設計</strong></p><p>這步最重要的就是通過設計如何去實現上面的目標，這個環節中技術的專業、視野、全面的考慮、權衡取捨的主觀原則、解題的思路，這是形成最後的核心設計的關鍵。</p><p>在核心設計的這個階段中，會產生一些新的衡量設計最後實現情況的目標，這些也都要增加到系統設計中，確保最後的實現和設計的偏差度是可視的。</p><p><strong>4) 圍繞核心設計形成的設計原則</strong></p><p>有了上面的核心設計後，可以真正的形成一些設計原則，確保後面的子系統/模塊的詳細設計中能夠遵循，並在詳細設計中體現出來，這樣才能讓整個大的系統設計的一致性。</p><p><strong>5) 各子系統/模塊的詳細設計</strong></p><p>這個部分我倒覺得難度不會太大，畢竟有了前面的鋪墊，就是解好一個更小範圍的題，程序員群體在解題能力上通常是不錯的，所以我一直覺得數學功底好是程序員的基本，數學就是典型的解題的學科。</p><p>ps: 這就是做分享/培訓的好處，藉機仔細整理自己的碎片，從而形成體系。</p><p>關於怎麼更好的讓大家能掌握並運用這個思考框架，我的想法就是在講每個步驟的時候講講自己當年在這些步驟上犯的錯，實際的經驗，這樣我覺得也許大家以後在做系統設計時就能想起，所以我覺得系統設計這種培訓絕對是需要具備大量實際經驗的架構師才能做。</p><p>在運用部分，採取的方法就是通過互動，讓大家按照同樣的思考框架來講自己的所負責的系統，通過互動來更好的彼此對齊，並藉此逐漸變成習慣。</p><h1><strong>系統設計之系統建設的目的</strong></h1><p>作為系統設計的第一步，重要性毋庸置疑，如果連繫統建設的目的都沒搞清楚，後面所有的步驟都會錯誤。如果我們去看很多的系統設計，會發現壓根就沒有系統建設的目的的仔細分析。</p><p>當需要做系統設計時，就意味著需要建設一套新系統，或者對原有的系統進行比較大的架構的改造升級，這一定是基於什麼原因才要去做的。之所以要分析好系統建設的目的，<strong>一方面是為了避免出發點有問題，系統建設的目的應該是充分反映出解決業務層面臨的挑戰，</strong>或者系統用戶層面面臨的問題的，而不是出於個人訴求，<strong>另一方面是為了確保在後續的系統設計中能保證目的的達成。</strong></p><p>從對系統建設的目的的分析中，是很容易看出格局和高度的，這兩個詞看起來非常虛，但其實很實，格局和高度通常是指所做的事影響的範圍大小，例如從所在的一個小團隊，到所在的大部門，到所在的大BU，到所在的大BG，到跨多BG的業務板塊，到整個集團，甚至是到這個社會，這裡一定要實事求是，別這裡講的是世界形勢，後面的整個系統設計又完全解決不了這裡所說的。</p><p>結合我自己的經歷來說，在早期做HSF時，在系統建設的目的這點上是最為缺失的，也導致了自己在HSF階段犯下了幾次大的錯誤，例如最典型的就是HSF做動態化的那次系統架構改造，如果仔細的去分析當時做這件事的目的，就會看到這個是出於技術情懷，而不是業務端面臨的業務挑戰，或者說HSF的用戶面臨的問題，也就是之前說的出發點的問題，我覺得這是很多技術人員非常容易犯的錯誤，就是純粹是出於技術訴求發動的很大動作的系統重構，我自己是在有一年有一位阿里的高管在給我做輔導時，提到首先要思考清楚為什麼做某件事，並且能講清楚原因，才明白了動機真的是非常重要的，後面做事的時候才能沒那麼技術化了。</p><p>因為HSF/Ali HBase的經歷，到了後面做阿里容器/調度、異地多活的時候在目的這塊才算是能更好的把握，能更好的去結合阿里的業務所面臨的挑戰來看要做的事。</p><p>大多數時候，驅動系統設計這件事的發生是其他方提出的，作為架構師，做好需求的轉換，決定是否要建設新系統，或重構升級老系統，深刻地去理解系統建設的目的也非常重要，因為架構師是最終要給整個技術團隊講為什麼要做的，這能夠更好地讓團隊明白做這件事的價值和意義。</p><p><strong>總得來說，我認為做系統設計前，一定要先對於系統建設的目的分析清楚，確保系統建設有價值和有意義，同時確保後面的整個系統設計是能讓目的達成的。</strong></p><div class=pgc-img><img alt=阿里畢玄：系統架構師如何做好系統設計？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/dd0f2c42951a4e63bc8414cdc6d8c2c2><p class=pgc-img-caption></p></div><h1><strong>系統建設的目標</strong></h1><p>在分析清楚了系統建設的目的後，到了目標這個環節，最重要的是要把前面的目的的描述，<strong>轉換為可衡量的目標的描述</strong>，之所以要形成可衡量的目標，最重要的原因是為了確保最後實現的系統是達成了系統建設的目的的，相信很多人都碰到過設計出來的系統和最後落地的系統很不一致的現象，通常這都是缺乏了可衡量的目標造成的。</p><p>舉兩個例子說下：</p><p>第一個是2011年做容器化，建設這套系統的目的是為了應對預計會越來越大的機器成本，目標相應的制定為支撐相同的業務量，機器下降一半。</p><p>第二個是2013年做異地多活，建設這套系統的目的是為了能夠讓業務具備更強的抵禦災害的能力，儘管後面發現因為有了異地多活，有了更多的好處，但那些確實在系統設計之初是完全沒放在建設目的裡的，後面能做到純屬巧合，例如因為有了異地多活使得後面的彈性藉助雲資源成為了現實，因為有了異地多活，基礎設施技術的演進可以更加快速，在設計之初根據目的相應制定的目標為業務能夠部署在中國多個地點（地點間距離>1千公里），多個地點部署的業務都處於承接流量的狀態，且流量從A點切換到B點能在30s內完成。</p><p>有了清晰的可衡量的系統建設的目標，意味著：</p><ol><li>確保了系統設計過程中可以非常針對性的圍繞目標來做，避免偏題；</li><li>更重要也是最容易遺漏的一點，是可以做一個用來跟蹤系統建設效果的系統，例如之前做容器化，我們會有一個展示，是容器化後的集群多少機器支撐了多少的業務量，和目前還未容器化的集群的一個對比；異地多活，會有一個管控系統，用來展示系統的部署情況，以及流量切換。只有有了跟蹤系統建設目標是否達標的系統，才能真正確保系統建設完畢後和初心保持了一致，否則很多系統建設的時候是一個目的，最後做完了是另外的狀況，所以這個跟蹤效果的體系是一定要在系統建設的時候同步就做好的。</li></ol><p>從目的->目標這個部分，理論上並不複雜，但也很容易漏掉，導致後面的系統設計環節出問題，關鍵是要形成可衡量的目標，以及相應的跟蹤目標達成情況的系統。</p><div class=pgc-img><img alt=阿里畢玄：系統架構師如何做好系統設計？ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/349d8d207abe4d0f8252855a19f2ed56><p class=pgc-img-caption></p></div><h1><strong>達成目標的核心問題</strong></h1><p>如果要達成系統設計的可衡量的目標，到底面臨了一些什麼核心問題，只有明白了面臨什麼核心問題，才能更加明確的進行系統設計來解決這些問題。</p><p>還是用我自己的經歷來講這個話題。</p><p>最開始做HSF的時候，為什麼要做HSF是比較清晰的，在可衡量的目標上也有一個大概的要支持每條上億的服務調用，但由於當時的技術功底問題，導致了在提煉核心問題上是有很大差距的，這些也造成了後來HSF總是不斷的重構、修修補補之類。所以，我從來就不認為技術功底不好的人能做好一個架構師，架構師絕對不是看到的隨手畫幾個框那麼簡單，那通常只是個結果，但要合理的把框畫出來是需要基於非常堅實的技術功底，HSF在最初設計時認為的核心問題就是怎麼實現一個易用有服務定義的RPC框架，但對於如何支撐好上億的交互調用量，服務化上線後給業務研發會帶來什麼問題（例如排查問題變複雜了），在核心問題上是有很大的缺失的，例如HSF上線後才發現的中間的負載均衡的問題，而這個問題是導致了HSF結構重新設計的，這個後來回頭看就會發現如果是一個知識面更廣的架構師可能一開始就會想到這個核心問題，所以如果回過頭去看，HSF這樣的框架，要達成目標，要解決的核心問題應該是：</p><ol><li>易用、能支撐上億次服務交互的RPC框架；</li><li>服務間的軟件負載均衡問題；</li><li>服務交互的問題排查；</li></ol><p>在做T4（容器）的時候，目的、目標都還比較清晰，問題的提煉現在回顧也做的還ok，T4要解的核心問題為如何實現在一臺機器上跑20個應用，T4出現的問題更多是對於核心問題的設計方案上，這個到下篇講圍繞核心問題的系統設計上再寫。</p><p>到了做異地多活的時候，目的、目標的清晰化都ok，對於異地多活而言，要做到在中國多個城市都可同時支撐流量，並且可在幾十秒內完成流量切換，異地多活中物理距離所帶來的網絡延時是不可突破的，怎麼做到多地活且流量可動態切換，要做到這個，面臨的核心問題是：</p><ol><li>如何將流量進行切分，且讓請求的整個處理過程能封閉在local完成；</li><li>如何保障異地多活後的數據一致性？</li></ol><p>到了最近幾年做統一調度的時候，整個做系統設計的思考框架我覺得算是比較熟練了，所以統一調度的目的、目標都很清晰，結合當時的情況，要實現統一調度的目標，其面臨的核心問題是：</p><ol><li>如何實現一套在線業務資源的調度系統去滿足各種資源訴求？</li><li>如何儘可能擴大統一的資源池，解決資源池統一面臨的資源競爭、資源被搶、多種不同資源規格等問題？</li><li>如何實現在線業務、離線任務兩套調度系統的互通？</li><li>如何解決在線業務、離線任務混合部署時的資源競爭的問題？</li></ol><p>從上面的這些cases來看，可以看到，從可衡量的目標映射到技術層面要去解決的核心問題，是很需要技術功底的，對於工程類型的項目、產品而言，工程經驗在這個時候也會特別重要，而通常我也覺得這是衡量一個優秀架構師很直接的地方。</p><div class=pgc-img><img alt=阿里畢玄：系統架構師如何做好系統設計？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7618ba8ae5854ead90d88e1b78bdc578><p class=pgc-img-caption></p></div><h1><strong>解決核心問題的設計</strong></h1><p>繼前面的系統建設的目的、可衡量的目標，達成目標的核心問題後，進入到解決核心問題的設計環節了，技術人員其實最擅長的是直奔這個主題，而且估計更期盼的也是這篇，有些時候會導致跳過前面的目的、目標環節，導致最終做出來的系統要麼沒貼合業務挑戰，要麼嘛偏離了做這個系統的初衷，所以我仍然強烈建議做系統設計的同學不要著急，一步一步來。</p><p>繼續結合自己的cases來講講解決核心問題的設計這個環節，回顧自己的cases，犯了不少的錯誤，也碰到了非常多複雜的權衡選擇的狀況，才逐漸更加明白一個架構師應該具備的一些能力。</p><p><strong>HSF的設計</strong></p><p>HSF在設計之初要解決的第一個核心問題就是做一個易用，能支撐每天上億次服務調用的服務方式的RPC框架。</p><p>易用這點在第一個版本犯了錯，不過還好是第一個版本，否則糾正錯誤的代價會無比巨大，那個版本里，如果要把一個spring的bean發佈為HSF服務，或者調用一個HSF服務，需要寫一個文件，在文件裡描述發佈的服務和調用的服務，並且在這個文件放在jboss的某個目錄裡，這個方式看起來對在寫代碼的過程中完全沒有侵入，但導致的巨大問題是這文件放在哪裡寫，寫完後部署的階段怎麼自動放到對應的目錄去，在第二個版本里才把這個調整為用一個Spring Bean的方式來做服務的發佈和調用，儘管這一定程度導致了業務代碼需要有對HSF的明顯的依賴，但對維護、部署等都變的很標準，所以從這裡可以看到，設計是全方位的，要考慮到的不僅僅是怎麼實現，還有別人怎麼用，運行、維護階段又是怎麼樣的。</p><p>HSF犯的第二個錯，就是在能支撐每天上億次服務調用的RPC框架這點上，是給我自己代碼生涯最大的教訓，甚至徹底改變了我之後做設計時的技術選型風格。在做HSF之前，我從來沒做過一天訪問量超過100w的系統，完全搞不清一個每天上億次的系統到底有什麼不同，HSF最早的版本在通訊框架上選擇了JBoss-Remoting，原因也其實比較簡單，因為我們用的Web容器是JBoss，結果這個版本在一個非常重要的系統上線時，出現了嚴重的故障，導致了整個網站的響應速度都變的很慢。當時查了幾乎整整一天都沒查出原因到底是什麼，後來回滾恢復，所以可以肯定是HSF上線造成的，等到回滾後的一個星期內才查出原因，是因為JBoss-Remoting在調用遠端時，默認的超時時間為60s，而我們後端的那個系統在處理某些服務的時候會特別慢，進而導致了共用的處理線程池滿了，所以整個網站的表現就變慢了。</p><p>這次問題讓我徹底明白了訪問量大的系統最重要的是對整個系統的處理過程要非常的清楚，因為在訪問量大的情況下，一些小的問題有可能會放大成很大的問題，進而到故障，所以訪問量大的系統對技術的可控性要求是極高的，這也是最大的不同，可控性並不代表一定要完全自己寫，但要求如果用到開源的東西，要對開源的東西的代碼邏輯非常熟悉，為了解決上面的問題，HSF基於Mina寫了一個自己版本的通訊框架，自己來處理連接方式、線程池等，後面在做各種HSF改造，以及其他技術改造時，基本都遵循了技術可控性這個原則。</p><p>在前面核心問題那篇裡也講到，HSF在設計時其實核心問題提煉的就是有問題的，導致了後面在負載均衡、服務化後問題排查這兩點上出現了嚴重的返工現象，而這些本其實都可以避免，就像現在再去做服務化框架的人基本都不會犯這樣的錯了。</p><p>在負載均衡這點上，在早期版本里，是通過硬件負載均衡設備來做的，這裡造成了好幾個問題，一是需要先配置要調用的服務的vip地址，當然，這可以通過一箇中央的配置服務器之類的方式，第二個是HSF採用的是長連接的方式，通過vip去連接後端的一個集群時，這裡會出現非常麻煩的問題，例如後端集群發佈重啟，很有可能就會造成連接的極度不均衡，進而導致故障。</p><p>除了上面兩個問題後，還有一個觸發HSF去做改造的原因是當時的硬件負載設備出現了流量跑滿的現象，而這是必須要經過的一個點，會造成全站全部崩潰，不希望在未來系統中有個這麼大的高風險的集中點，再加上上面的兩個問題，決定做徹底的改造，於是HSF開始設計了目前看起來在服務框架體系中非常經典的軟件方式的服務註冊、發現和尋址的結構。</p><div class=pgc-img><img alt=阿里畢玄：系統架構師如何做好系統設計？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/492e1c13cf1e4619b4e398d7f0ce18c7><p class=pgc-img-caption></p></div><p>在負載均衡這件事上，現在回顧也可以看出這個仍然是當初對一個訪問量巨大的系統考慮不夠全面造成的。</p><p>在服務化後會帶來的排查問題這點上，當初設計的時候更是完全沒有考慮到，導致了後面排查問題效率低、人力投入大等等問題，後來為了解決這個問題，學習了Google家Dapper的思想，但花了很長時間這東西才真正落地。</p><p>除了上面這些外，HSF其實還有各種設計問題，例如最早的通訊協議裡竟然是沒有版本號的，導致後面升級時處理兼容的複雜，又例如更麻煩的一個話題就是在多語言支持上。</p><p>HSF作為我第一個真正做的訪問量巨大且核心的系統的設計，由於當初的技術功底，犯下了無數錯誤，導致了N次返工、故障和彌補，當然也讓自己得到了很大的成長，這幾年回過頭想這個問題，越來越覺得必須無比感謝我當時的主管對我巨大的包容和支持，HSF的經歷，讓我在解決核心問題的設計這個環節上，明白的是作為一個架構師，在技術選型上深厚的技術功底，在整個設計方案上知識的廣度，考慮的全面性（從開發態、部署態、運行態和運維態）都是要求極高的。</p><p><strong>T4的設計</strong></p><p>T4在核心問題的提煉上沒有太大的問題，但在怎麼解這個問題的設計上那犯下的錯誤現在來看都是低級到不行。</p><p>為了做到在一臺機器上能比以前用虛擬機的方式運行更多的應用進程，最早我們採用的方法是各種hack，其實要實現的就是進程級隔離，結果就是hack到了一定程度後，確實勉強能用了，但上線了一些小範圍，有了一些用戶後，發現我們的hack是很難枚舉的，非常痛苦，直到有一天“發現”了LXC，才走對了路線。</p><p>除了上面這個選型層面的問題外，T4的過程中還碰到過很多類似的問題，例如用什麼方法去控制磁盤空間的限制，最早我們也是用的同樣的image的方式，但image的方式對磁盤空間超賣其實是非常不友好的，後來為了把這個方案更換成dir quota的方案，一幫人幾乎是連續折騰了一個多月，因為線上已經在運行的要通過cp文件等方法來弄。</p><p>HSF的那段看到的很多是在技術深度上的問題，而T4的這段設計，現在回顧最主要的問題是這個技術領域視野的嚴重問題，所以我認為作為架構師，在相應的技術領域要有足夠的視野，一定要知道這個領域的工程界、學術界是什麼情況，這樣對自己在結合目的、目標以及一些約束條件下做出更合理的技術選型是非常重要的，之前也寫過一篇關於如何擴充技術視野的文章。</p><div class=pgc-img><img alt=阿里畢玄：系統架構師如何做好系統設計？ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/987e521dfdbb4985a7a0314feea4b70f><p class=pgc-img-caption></p></div><p><strong>異地多活的設計</strong></p><p>到了做異地多活這個階段，也許是因為有了前面的一些積累，總結反思，我自己覺得異地多活的設計更多的是選擇，至於對錯我總體認為還好，所以這裡我就講一些異地多活設計上為了解決核心問題所面臨的一些權衡選擇，而這也是架構師在做設計上非常重要的一個部分，如何去根據各種約束來做一些方案的權衡選擇。</p><p>異地多活在核心問題上要解決的是請求封閉、數據一致性這兩個關鍵問題，在為了解決這兩個問題的設計上，參考了工程界的一些情況，最後發現我們所面臨的狀況還是很不一樣。</p><p>在這裡就拋出一些異地多活設計上所面臨的選擇，我就不去講我的選擇邏輯之類的了，方便大家思考，以及交流探討。</p><ol><li>流量/數據拆分的規則到底按什麼好？買家/賣家/商品？</li><li>分流的規則和數據庫分庫分表的規則的關係：鬆耦合 Vs 強綁定？</li><li>數據同步策略的選擇：部分 Vs 全量？</li><li>數據一致性的保障，在哪些層面做，CAP？</li><li>部署的選擇：兩地 Vs 三地，地域的分佈選擇？</li><li>落地節奏，一年？兩年？三年？</li></ol><h1><strong>架構師應具備的能力總結</strong></h1><p>最後根據目的、可衡量的目標、核心問題提煉、解決核心問題的設計這些環節，總結提煉下我覺得架構師需要具備的能力：</p><ol><li>對業務所面臨的挑戰的理解，從業務挑戰到技術挑戰映射的能力，或者說技術抽象的能力；</li><li>知識儲備以及考慮的全面性，從開發、部署、運行、維護態；</li><li>技術選型能力，極厚的技術功底，開闊的技術視野；</li><li>在各種約束條件下權衡選擇的能力，原則。</li></ol><p>所以架構師我覺得絕對不是爛大街的頭銜，要做到一個合格的架構師還是相當難的，尤其是工程類型的架構師，需要長期的實戰、經驗積累。</p><p>系統設計一直是我認為最難講的內容，主要還是因為我在內部嘗試做的一個系統設計的培訓，非常感謝一幫同學支持了我做這個培訓，要不是他們的參與，我覺得不可能寫這篇文章，也不可能較為體系化的說說系統設計，並且更重要的是讓我覺得系統設計這個東西其實還是可以不講的那麼虛的，以及系統設計的技能一定程度上確實也是可以培養的。</p><p>轉載自公眾號 HelloJava，作者 bluedavy</p><p>版權聲明：未經允許不得轉載。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>系統</a></li><li><a>畢玄</a></li><li><a>構師</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/93f22358.html alt=架構師：系統運行環境的集成與設計有哪幾種？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/93f22358.html title=架構師：系統運行環境的集成與設計有哪幾種？>架構師：系統運行環境的集成與設計有哪幾種？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/96cce29.html alt=系統架構師之——測試評審方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/84a587df5a124777a10d126b233c7d9a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/96cce29.html title=系統架構師之——測試評審方法>系統架構師之——測試評審方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2c36ec7.html alt=系統架構師之——軟件開發方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/788cb7b3bbb4421798028ac5617e7fee style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2c36ec7.html title=系統架構師之——軟件開發方法>系統架構師之——軟件開發方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/031eafc4.html alt=電廠直流系統調試方案 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/5e8200036f19e04c25bf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/031eafc4.html title=電廠直流系統調試方案>電廠直流系統調試方案</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fc3b4b2c.html alt=一文讀懂智能客服：發展歷程、系統搭建、市場推廣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RbYMTZ55OrJUgU style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fc3b4b2c.html title=一文讀懂智能客服：發展歷程、系統搭建、市場推廣>一文讀懂智能客服：發展歷程、系統搭建、市場推廣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/51410370.html alt=生活垃圾焚燒發電及蒸汽系統優化改造項目公告 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RcblrbTDBokV23 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/51410370.html title=生活垃圾焚燒發電及蒸汽系統優化改造項目公告>生活垃圾焚燒發電及蒸汽系統優化改造項目公告</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b4913b56.html alt=電驅動橋系統或加快電氣化進程，多個案例共同說明問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1539571595921bc5b27eff6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b4913b56.html title=電驅動橋系統或加快電氣化進程，多個案例共同說明問題>電驅動橋系統或加快電氣化進程，多個案例共同說明問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9a7b7719.html alt=基於混沌系統的偽隨機數發生器設計 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9a7b7719.html title=基於混沌系統的偽隨機數發生器設計>基於混沌系統的偽隨機數發生器設計</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/99558abe.html alt=win10系統打印機打印不了顯示已暫停的解決方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/10d0de369d4746c7a0c220ff59bd2470 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/99558abe.html title=win10系統打印機打印不了顯示已暫停的解決方法>win10系統打印機打印不了顯示已暫停的解決方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2564328d.html alt=虛設投資交易系統吸引投資 成都破獲一特大團夥詐騙案 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2564328d.html title=虛設投資交易系統吸引投資 成都破獲一特大團夥詐騙案>虛設投資交易系統吸引投資 成都破獲一特大團夥詐騙案</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e4b6c065.html alt=全球定位系統（GPS），不只是導航 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/S7sY2h8G8GOmul style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e4b6c065.html title=全球定位系統（GPS），不只是導航>全球定位系統（GPS），不只是導航</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f75e014c.html alt=謹記！短線王者交易系統，學會極大概率提高買入與賣出的時機！掌握終身獲益無窮！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RL8KN4P57T39Db style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f75e014c.html title=謹記！短線王者交易系統，學會極大概率提高買入與賣出的時機！掌握終身獲益無窮！>謹記！短線王者交易系統，學會極大概率提高買入與賣出的時機！掌握終身獲益無窮！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0ad4f2c9.html alt="焦爐系統停電 —— 應急操作" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8ca2e135770644bfb97620aad1b362c0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0ad4f2c9.html title="焦爐系統停電 —— 應急操作">焦爐系統停電 —— 應急操作</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/75270289.html alt=win10系統如何使用返回桌面快捷鍵 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/822a8f5c52e1461a94e116d0e24871f0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/75270289.html title=win10系統如何使用返回桌面快捷鍵>win10系統如何使用返回桌面快捷鍵</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a435b80f.html alt=從操作系統（Windows）的角度討論中斷和異常機制 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/95371ea9a81e4e32b3cf7591d4dbbc83 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a435b80f.html title=從操作系統（Windows）的角度討論中斷和異常機制>從操作系統（Windows）的角度討論中斷和異常機制</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>