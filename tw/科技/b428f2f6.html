<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>無需If-Else語句，狀態模式即可編寫乾淨可維護的代碼 | 极客快訊</title><meta property="og:title" content="無需If-Else語句，狀態模式即可編寫乾淨可維護的代碼 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/d31e7c970ad64665a37b825d6d87979f"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b428f2f6.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b428f2f6.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b428f2f6.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b428f2f6.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b428f2f6.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b428f2f6.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b428f2f6.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b428f2f6.html><meta property="article:published_time" content="2020-11-14T21:05:50+08:00"><meta property="article:modified_time" content="2020-11-14T21:05:50+08:00"><meta name=Keywords content><meta name=description content="無需If-Else語句，狀態模式即可編寫乾淨可維護的代碼"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/b428f2f6.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>無需If-Else語句，狀態模式即可編寫乾淨可維護的代碼</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><blockquote class=pgc-blockquote-abstract><p>全文共1316字，預計學習時長5分鐘</p></blockquote><p><br></p><div class=pgc-img><img alt=無需If-Else語句，狀態模式即可編寫乾淨可維護的代碼 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d31e7c970ad64665a37b825d6d87979f><p class=pgc-img-caption>圖源：unsplash</p></div><p><br></p><p>If-Else語句我們再熟悉不過了，你可能看過無數的相關教程，讀過很多編程書籍，來提升將If-Else用作de facto分支技術的方法，甚至可能你的默認模式就是使用If-Else。</p><p><br></p><p>可以結束這一切了。在任何新的條件要求下，使用If-Else都會增加複雜性。用狀態對象來代替If-Else吧。應用狀態模式，你只需使用專用狀態對象而無需使用If-Else語句來更改對象行為。</p><p><br></p><p>像下面這樣的代碼時代已經一去不復返了：</p><p><br></p><div class=pgc-img><img alt=無需If-Else語句，狀態模式即可編寫乾淨可維護的代碼 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d683e61333df4734be550a04970eb491><p class=pgc-img-caption>觸發PTSD警告</p></div><p><br></p><p>你肯定曾經寫過更復雜的分支，我也曾是這麼做的。上面的分支邏輯甚至還不是很複雜，但如果嘗試添加新條件，事情肯定會越弄越糟。</p><p><br></p><p>另外，如果你認為創建新類而非簡單地使用分支語句聽起來很煩人，那麼請一定等到實際使用的時候，你會發現這種方法簡潔而優雅。除了“ D”部分之外，它還將使你的代碼庫更加紮實。</p><p><br></p><div class=pgc-img><img alt=無需If-Else語句，狀態模式即可編寫乾淨可維護的代碼 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c64b9d605d90435392d8a61972973a28><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>那麼如何避免混亂的分支代碼呢？</h3><p><br></p><p>我們將研究如何在生產就緒代碼中替換If-Else分支。這是一個虛構的例子，但是方法與我在大型客戶的代碼庫中使用的方法相同。</p><p><br></p><p>創建一個非常簡單的Booking類，其中包含一些狀態。它還有兩個公共方法：Accept()and Cancel().。我盡力繪製了一個圖表，顯示了預訂可能處於的不同狀態。</p><p><br></p><div class=pgc-img><img alt=無需If-Else語句，狀態模式即可編寫乾淨可維護的代碼 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/43383ad5057d4c69b03bc219da784241><p class=pgc-img-caption></p></div><p>代碼中重構分支邏輯的過程一共有三步：</p><p><br></p><p>· 創建一個抽象基類</p><p>· 將每個狀態實現為繼承自基本狀態的單獨類</p><p>· 讓Booking`類具有私有或內部方法，該方法以狀態基類為參數</p><p><br></p><div class=pgc-img><img alt=無需If-Else語句，狀態模式即可編寫乾淨可維護的代碼 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c64b9d605d90435392d8a61972973a28><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>演示時間到！</h3><p><br></p><p>首先，需要一個將繼承所有狀態的基類。</p><p><br></p><div class=pgc-img><img alt=無需If-Else語句，狀態模式即可編寫乾淨可維護的代碼 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ad78e17d3303451eaaa8f32f34679af2><p class=pgc-img-caption></p></div><p>請注意，該基類還具有兩種方法，Accept和Cancel——儘管此處將它們標記為內部。此外，基態具有“特殊” EnterState(Booking booking)方法。每當將新狀態分配給預訂對象時，就會調用此方法。</p><p><br></p><p>其次，為要代表的每個狀態創建單獨的類。</p><p><br></p><div class=pgc-img><img alt=無需If-Else語句，狀態模式即可編寫乾淨可維護的代碼 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d0f10c76bf9244f0a7a0cae612b21709><p class=pgc-img-caption></p></div><p>注意，如上圖所示，每個類如何表示一個狀態。此外，ExpiredState和CancelledState不會將預訂轉換為新狀態。這兩類在本質上與Null Object Pattern非常相似。</p><p><br></p><p>最後，預訂類型本身。</p><p><br></p><div class=pgc-img><img alt=無需If-Else語句，狀態模式即可編寫乾淨可維護的代碼 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d7a4af1a1db3430db4d04b2d9c617f4c><p class=pgc-img-caption></p></div><p>看到預訂類型如何簡單地將Accept和Cancel的實現委派給其狀態對象了嗎？這樣做可以使我們刪除許多條件邏輯，並使每個狀態僅關注對自己重要的事情，當前狀態也有機會將預訂過渡到新狀態。</p><p><br></p><div class=pgc-img><img alt=無需If-Else語句，狀態模式即可編寫乾淨可維護的代碼 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c64b9d605d90435392d8a61972973a28><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>Q&A</h3><p><br></p><p><strong>如何處理新的條件功能？</strong></p><p><br></p><p>如果說通常需要使用某些條件檢查來實現新功能，那麼現在只需創建一個新的狀態類即可，你將不再需要費力地處理if-else語句了。</p><p><br></p><p><strong>如何將狀態對象保留在數據庫中？</strong></p><p><br></p><p>不，你不想。</p><p><br></p><p>當將對象保存到例如SQL或NoSQL數據庫時，狀態對象並不重要，這時只有瞭解對象的狀態及其應如何映射到列是重要的。你可以將狀態映射到友好類型名稱，枚舉或整數。只要你願意，總有某種方法可以將保存的值轉換回狀態對象。</p><p><br></p><p><strong>但是你還在使用If’s嗎？</strong></p><p><br></p><p>它們是必不可少的，特別是當用作保護子句時。但If-Else組合是造成可維護性難題的根本原因。</p><p><br></p><div class=pgc-img><img alt=無需If-Else語句，狀態模式即可編寫乾淨可維護的代碼 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5caf80d046f44e9a97ddbbe435971cc1><p class=pgc-img-caption>圖源：unsplash</p></div><p><br></p><p>複雜性不是源於你擁有的類的數量，而是源於這些類承擔的功能。擁有許多專門的類將使你的代碼庫更具可讀性與可維護性，並且從總體上來說，也更易於使用。</p><p><br></p><p>適時地和If-Else語句說再見吧！</p><div class=pgc-img><img alt=無需If-Else語句，狀態模式即可編寫乾淨可維護的代碼 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/662ffc631f6d4f48b1700bc33e890eca><p class=pgc-img-caption></p></div><p><strong>留言點贊關注</strong></p><p><strong>我們一起分享AI學習與發展的乾貨</strong></p><p>如轉載，請後臺留言，遵守轉載規範</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>無需</a></li><li><a>Else</a></li><li><a>語句</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/4cf95694.html alt="無需軟件：在線提取 QQ 群成員方法" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/f8c3e5d8-4614-4261-99f2-52f523f48300 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4cf95694.html title="無需軟件：在線提取 QQ 群成員方法">無需軟件：在線提取 QQ 群成員方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2e39196d.html alt=MySQL語句和命令大全 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2e39196d.html title=MySQL語句和命令大全>MySQL語句和命令大全</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/332cb941.html alt=數據庫SQL最常用語句 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/332cb941.html title=數據庫SQL最常用語句>數據庫SQL最常用語句</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c9c59606.html alt="轉板機制來了！無需監管審核或註冊 證監會就新三板企業轉板上市徵求意見" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RsSnuOf9d0RyEF style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c9c59606.html title="轉板機制來了！無需監管審核或註冊 證監會就新三板企業轉板上市徵求意見">轉板機制來了！無需監管審核或註冊 證監會就新三板企業轉板上市徵求意見</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9f4a4946.html alt=存儲芯片國產率大大提升，無需抱團對抗海外廠商 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8dfb9fbe76b847b8bef34a5b845116db style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9f4a4946.html title=存儲芯片國產率大大提升，無需抱團對抗海外廠商>存儲芯片國產率大大提升，無需抱團對抗海外廠商</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/12fe4764.html alt="SQL 中的if判斷語句、while循環語句、和運算符" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/04199ae85d034aba8f5792b86591bb77 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/12fe4764.html title="SQL 中的if判斷語句、while循環語句、和運算符">SQL 中的if判斷語句、while循環語句、和運算符</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1117cce0.html alt=瞭解分支語句的使用以及形參和實參的區別 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1117cce0.html title=瞭解分支語句的使用以及形參和實參的區別>瞭解分支語句的使用以及形參和實參的區別</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/1dc8b128.html alt=高中物理結論性語句及二級結論 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/a0e17455ee5942bdb47a647232be8c25 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/1dc8b128.html title=高中物理結論性語句及二級結論>高中物理結論性語句及二級結論</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/cd8cc656.html alt=無需指針的頂級“怪”表，奇想系列到底是什麼樣的存在？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/39f74a3bfa054af2b9909ec2f06e9619 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/cd8cc656.html title=無需指針的頂級“怪”表，奇想系列到底是什麼樣的存在？>無需指針的頂級“怪”表，奇想系列到底是什麼樣的存在？</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/c185d034.html alt=中國遊客去新加坡無需再隔離，多國觀望同時放鬆旅行限制 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/SEtttXfHPZi1z4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/c185d034.html title=中國遊客去新加坡無需再隔離，多國觀望同時放鬆旅行限制>中國遊客去新加坡無需再隔離，多國觀望同時放鬆旅行限制</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/03cfb0cd.html alt=JavaScript中條件語句的使用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ac2e26bf9bd84f96a17dbb252d0a2e06 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/03cfb0cd.html title=JavaScript中條件語句的使用>JavaScript中條件語句的使用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c4493bbf.html alt=不需要接觸的洗手機，無需按壓、0.25秒極速出泡，更加便利、衛生 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/b29071f998d9447eb03c73f6b2cfafbc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c4493bbf.html title=不需要接觸的洗手機，無需按壓、0.25秒極速出泡，更加便利、衛生>不需要接觸的洗手機，無需按壓、0.25秒極速出泡，更加便利、衛生</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9c54f438.html alt=賦值語句與字符數據的輸入輸出 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/dd3b454078a2487abbfe5e1f4a6bfb1b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9c54f438.html title=賦值語句與字符數據的輸入輸出>賦值語句與字符數據的輸入輸出</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3d4d5d30.html alt="Hive中where 語句的“不等於”的陷阱" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15349027008996ae0922e26 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3d4d5d30.html title="Hive中where 語句的“不等於”的陷阱">Hive中where 語句的“不等於”的陷阱</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e5902a9.html alt=頁面埋點之無埋點：無需工程師在業務代碼裡面插入侵入式的代碼 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/066ef2245585453f8a82a9cbdd9d50be style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e5902a9.html title=頁面埋點之無埋點：無需工程師在業務代碼裡面插入侵入式的代碼>頁面埋點之無埋點：無需工程師在業務代碼裡面插入侵入式的代碼</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>