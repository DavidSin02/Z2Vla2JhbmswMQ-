<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>抓包分析以太網幀和IP數據包，頭部那麼多東東用來幹啥的，掃盲篇 | 极客快訊</title><meta property="og:title" content="抓包分析以太網幀和IP數據包，頭部那麼多東東用來幹啥的，掃盲篇 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/73b4278c40774903a2f0cfb0f6752925"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b571a20.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b571a20.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b571a20.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b571a20.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b571a20.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b571a20.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b571a20.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b571a20.html><meta property="article:published_time" content="2020-10-29T21:06:37+08:00"><meta property="article:modified_time" content="2020-10-29T21:06:37+08:00"><meta name=Keywords content><meta name=description content="抓包分析以太網幀和IP數據包，頭部那麼多東東用來幹啥的，掃盲篇"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/b571a20.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>抓包分析以太網幀和IP數據包，頭部那麼多東東用來幹啥的，掃盲篇</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><br></p><p>目錄</p><ul><li>抓包過程</li><li>以太網幀（也叫MAC幀）首部分析</li><li>IP數據包首部分析</li></ul><p><br></p><h2 class=pgc-h-arrow-right><strong>抓包過程</strong></h2><p>使用了 Wireshark 進行抓包，用兩個最常用的 curl 和 ping 命令來演示抓包情況，開啟抓包。</p><pre><code>## 先訪問我自己的網站首頁 curl https://zengzhiqin.kuaizhan.com ## 再查看我自己網站的地址 ping https://zengzhiqin.kuaizhan.com</code></pre><p>Wireshark根據 ping 命令得到的地址進行條件過濾，得到上面兩個命令所得到的包，主要有 TCP（https基於tcp協議）協議和 ICMP（ping命令是基於 ICMP 協議）協議的包，如下圖所示：</p><div class=pgc-img><img alt=抓包分析以太網幀和IP數據包，頭部那麼多東東用來幹啥的，掃盲篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/73b4278c40774903a2f0cfb0f6752925><p class=pgc-img-caption></p></div><p>抓包分析</p><h2 class=pgc-h-arrow-right><strong>以太網幀（也叫MAC幀）首部分析</strong></h2><div class=pgc-img><img alt=抓包分析以太網幀和IP數據包，頭部那麼多東東用來幹啥的，掃盲篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/be0e0bee9f4948139472d333af8f334b><p class=pgc-img-caption></p></div><p>MAC幀 = 6字節源mac地址 + 6字節目標mac地址 + 2字節類型 + 4字節幀檢驗序列FCS + 數據長度（46~1500字節）</p><p>MAC幀長度是需要在64~1518字節之間的，太長或者太短都是無效的幀。</p><p>IP數據包過來了，MAC 層會給分別使用6個字節為其加上“源mac地址”和“目標mac地址”，並且花2個字節為其指明是哪種類型的IP數據報(目前有IPV4,IPV6兩種類型)，4字節“FCS幀檢驗序列” 負責檢驗幀是否有效，然後就是46~1500字節之間的IP數據報長度。</p><p>抓包裡面的mac幀內容如下，選取了ping的reply類型包信息進行查看分析：</p><div class=pgc-img><img alt=抓包分析以太網幀和IP數據包，頭部那麼多東東用來幹啥的，掃盲篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/daea57f6e214480aa184d7e2f566378a><p class=pgc-img-caption></p></div><p>以太網幀</p><p>小補充：幀檢驗序列即FCS（frame check sequence）, 讓接收幀的網卡或接口判斷是否發生了錯誤。</p><p>判斷過程如下：發送網卡利用多項式計算，稱循環冗餘校驗（CRC),將計算結果寫入FCS字段，接收方收到這個幀，對其做相同的CRC計算。如果計算結果與接收的FCS字段相同，則幀沒有發生錯誤。如果不同，接收方就相信幀肯定發生了錯誤，並丟棄這個幀。</p><h2 class=pgc-h-arrow-right><strong>IP數據包首部分析</strong></h2><p>抓包得到的頭部對應關係如下所示（1~31表示的bit，8bit=1byte）：</p><div class=pgc-img><img alt=抓包分析以太網幀和IP數據包，頭部那麼多東東用來幹啥的，掃盲篇 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/13bced70a3fb4ee592baafe0c60f1650><p class=pgc-img-caption></p></div><p>IP數據包頭部</p><div class=pgc-img><img alt=抓包分析以太網幀和IP數據包，頭部那麼多東東用來幹啥的，掃盲篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/67cbf128c9ee4cc39112e27569296fb6><p class=pgc-img-caption></p></div><p>頭部每個內容如下：</p><ul><li>版本： TCP/IP 協議版本，是ipv4,還是ipv6；</li><li>首部長度：告訴數據包，首部長度有多長，因為首部有變長部分（如圖中可變部分，試想一下如果當初沒有設計這個可變長度，是不需要設計這個“首部長度”的）；</li><li>服務類型：網絡中的數據包有著急的，有不著急的，比如你和別人聊微信，這個包就比較著急了，如果你是在發郵件，那麼點擊了發送讓他慢慢溜達過去也是沒問題的。就相當於火車站排隊，軍屬優先，殘疾人優先，讓列寧同志先走的意思；</li><li>總長度：首部+數據 的長度，總長度最大是2的16次方-1，即65535字節（上面講到的數據鏈路層數據大小最大1500字節別忘了，除去IP首部的20個字節，數據鏈路層能接受的IP數據大小是1480字節，正因為這兩貨大小不一樣，如果一個數據包大於了1480字節，網絡層要把包送給數據鏈路層傳輸，才需要後面的分片）</li><li>標識：用途就是數據包分片之後可以根據標識的編號，將分片的包重新組裝為一個完整數據包</li></ul><div class=pgc-img><img alt=抓包分析以太網幀和IP數據包，頭部那麼多東東用來幹啥的，掃盲篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8dd0e5351e3b4b2c82b7c5a93051b114><p class=pgc-img-caption></p></div><p>分片</p><ul><li>標誌：3bit表示標誌，計算機收到了一個包，那他咋知道這是一個完整的數據包，還只是一個分片呢，標誌說看我的</li></ul><div class=pgc-img><img alt=抓包分析以太網幀和IP數據包，頭部那麼多東東用來幹啥的，掃盲篇 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d93cac3d0d1c4e8f8b0b58f090e803fa><p class=pgc-img-caption></p></div><p>此處單獨截圖抓包分析的標誌內容，Reserved bit為保留了一位，沒有進行設置；Don't fragement為1表示他是一個完整的數據包，不是一個片；More fragements為0表示這是最後一個分片，為1表示後面還有分片；</p><p>我curl的我的站點首頁，內容是不多的，沒有大於1500字節，所以不需要分片，如果我開啟迅雷下載了一個很大的東西，那這個地方是需要分片的。</p><ul><li>片偏移：偏移量，標識數據包的第一個字節是整個數據包的第幾個偏移量，此處抓包的片偏移量是0，因為他沒有分片</li></ul><div class=pgc-img><img alt=抓包分析以太網幀和IP數據包，頭部那麼多東東用來幹啥的，掃盲篇 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1fbecf5deed5483b9d64e201f921cd37><p class=pgc-img-caption></p></div><p>片偏移</p><ul><li>生存時間ttl：Linux給數據包的默認ttl是64，Windows系統是128，Unix系統是255，每次過一個路由器那麼ttl-1，每次經過一個路由器就要減1，ttl耗盡了那麼這個包就自動消失了，防止路由裡面出現了環路死循環了，包永不消失。</li><li>協議：標識這個包要交給誰來處理，如果是 tcp 或者 udp 那麼就需要交給傳輸層處理，如果是ICMP，IGMP，OSPF那麼就交給網絡層來處理這個包。此處是tcp協議，協議號是6.</li></ul><div class=pgc-img><img alt=抓包分析以太網幀和IP數據包，頭部那麼多東東用來幹啥的，掃盲篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/064755311eb54a1291e8496b9224d11f><p class=pgc-img-caption></p></div><p>image</p><ul><li>首部檢驗和</li></ul><div class=pgc-img><img alt=抓包分析以太網幀和IP數據包，頭部那麼多東東用來幹啥的，掃盲篇 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fa29ae8a00a54a6484e05f1a54572058><p class=pgc-img-caption></p></div><p>校驗過程</p><ul><li>源地址和目標地址無需多說了</li><li>可選字段，填充：ipv6已經將這個可選的去掉了，因為可變就要可控，就要增大處理時間，這裡是為了增大IP數據包的功能，但是實際上很少用到。</li></ul><p>網絡裡面時時刻刻有那麼多的包，設計者們秉著絕不浪費一個 bit 的精神，每一個標誌的設計都是精心設計的，這個時候包的首部就要絕對的精簡了。這兩個內容寫完就很多了，下一篇我會寫一個姊妹篇，抓包分析傳輸層的tcp三次牽手四次分手過程~~感謝觀看。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>抓包</a></li><li><a>網幀</a></li><li><a>IP</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/eef1832a.html alt=IP電話專線（運營商中繼線）業務介紹 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eef1832a.html title=IP電話專線（運營商中繼線）業務介紹>IP電話專線（運營商中繼線）業務介紹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a660d731.html alt=網絡基本概念-TCP/IP架構及各層網絡協議 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/7f834ac140184ca6a079de4d0d3e515c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a660d731.html title=網絡基本概念-TCP/IP架構及各層網絡協議>網絡基本概念-TCP/IP架構及各層網絡協議</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/17e3ef59.html alt="G park生意經：引入更具流量IP，為西安商業賦能" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d46e6272b998414e9d3a0ede20ecab11 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/17e3ef59.html title="G park生意經：引入更具流量IP，為西安商業賦能">G park生意經：引入更具流量IP，為西安商業賦能</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4b0d0bba.html alt=7、90秒快速“讀懂”IP編址（有類IP和無類IP） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/4c8ac4e1cad442f89eb5560d9164f0e4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4b0d0bba.html title=7、90秒快速“讀懂”IP編址（有類IP和無類IP）>7、90秒快速“讀懂”IP編址（有類IP和無類IP）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/da6be6a1.html alt=「方案」智慧校園IP廣播系統介紹 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3f53fb2955f54fb694efc894c5bacf79 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/da6be6a1.html title=「方案」智慧校園IP廣播系統介紹>「方案」智慧校園IP廣播系統介紹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5cdb2d1a.html alt=小區背景音樂（智能IP廣播）系統解決方案 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/dfic-imagehandler/63822a27-30a5-4e30-ab9e-01ded0f7847f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5cdb2d1a.html title=小區背景音樂（智能IP廣播）系統解決方案>小區背景音樂（智能IP廣播）系統解決方案</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dbcb0693.html alt="利用IBERT IP核實現GTX收發器硬件眼圖測試實例" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/06d4e7a7f50f4880a53d3d09a4365487 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dbcb0693.html title="利用IBERT IP核實現GTX收發器硬件眼圖測試實例">利用IBERT IP核實現GTX收發器硬件眼圖測試實例</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/024d3fc2.html alt=TCP/IP報文格式，康康就知道了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/73eecbbd2b0c4f93ad75a83ff43ace41 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/024d3fc2.html title=TCP/IP報文格式，康康就知道了>TCP/IP報文格式，康康就知道了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/96bdbe98.html alt=無公網IP？不知道怎麼訪問家裡的服務器？今天教大家只需3分鐘 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/43d0f3c5f1f849ebae2487e8a2c23823 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/96bdbe98.html title=無公網IP？不知道怎麼訪問家裡的服務器？今天教大家只需3分鐘>無公網IP？不知道怎麼訪問家裡的服務器？今天教大家只需3分鐘</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/aaf5b5ad.html alt=預告｜超級IP小牛頓壓軸圖書《寫給孩子的世界名人傳記》，大陸首次引進，孩子成長路上的人生導師！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/R8aPLI82sAAP7W style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/aaf5b5ad.html title=預告｜超級IP小牛頓壓軸圖書《寫給孩子的世界名人傳記》，大陸首次引進，孩子成長路上的人生導師！>預告｜超級IP小牛頓壓軸圖書《寫給孩子的世界名人傳記》，大陸首次引進，孩子成長路上的人生導師！</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/3a416019.html alt=良渚文化IP貴金屬幣確定發行，一金二銀！初始發售價如何？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3aee268193254568a85e6c7b84fd5380 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/3a416019.html title=良渚文化IP貴金屬幣確定發行，一金二銀！初始發售價如何？>良渚文化IP貴金屬幣確定發行，一金二銀！初始發售價如何？</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/cb4acf2a.html alt=大IP劇《且試天下》官宣，趙露思出演女主，我卻在意男主人選 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5068ef5234354641bd0ee19d164f5d09 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/cb4acf2a.html title=大IP劇《且試天下》官宣，趙露思出演女主，我卻在意男主人選>大IP劇《且試天下》官宣，趙露思出演女主，我卻在意男主人選</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/23d55860.html alt=吱吱人氣IP《慕南枝》啟動，妖貓傳造型設計加盟！你期待誰來演？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/2c12da5992ab4b919fbd0e4637f75da9 style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/23d55860.html title=吱吱人氣IP《慕南枝》啟動，妖貓傳造型設計加盟！你期待誰來演？>吱吱人氣IP《慕南枝》啟動，妖貓傳造型設計加盟！你期待誰來演？</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/0aa9732f.html alt=以《鹿鼎記》為例：當IP熱度退去，國產改編類遊戲靠什麼吸引玩家 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1e96eb24d5fb4ef9ba22dd35affaff8e style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/0aa9732f.html title=以《鹿鼎記》為例：當IP熱度退去，國產改編類遊戲靠什麼吸引玩家>以《鹿鼎記》為例：當IP熱度退去，國產改編類遊戲靠什麼吸引玩家</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/c3a534bd.html alt=CO-IP結果解讀 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/dea609f127d2496186487ceb331093e6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/c3a534bd.html title=CO-IP結果解讀>CO-IP結果解讀</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>