<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Java 字符編碼 | 极客快訊</title><meta property="og:title" content="Java 字符編碼 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/689930fcab234b1fa89acd0868efc912"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b7b26a08.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b7b26a08.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b7b26a08.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b7b26a08.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b7b26a08.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b7b26a08.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b7b26a08.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b7b26a08.html><meta property="article:published_time" content="2020-11-14T21:01:00+08:00"><meta property="article:modified_time" content="2020-11-14T21:01:00+08:00"><meta name=Keywords content><meta name=description content="Java 字符編碼"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/b7b26a08.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Java 字符編碼</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h2 class=pgc-h-arrow-right>基本概念</h2><h2 class=pgc-h-arrow-right>字符集</h2><p>字符（Character）是各種文字和符號的總稱，包括各國家文字、標點符號、圖形符號、數字等。字符集（Character set）是多個字符的集合，字符集種類較多，每個字符集包含的字符個數不同，常見字符集名稱：ASCII 字符集、GB2312 字符集、BIG5 字符集、 GB18030 字符集、Unicode 字符集等。計算機要準確的處理各種字符集文字，就需要進行字符編碼，以便計算機能夠識別和存儲各種文字。</p><h2 class=pgc-h-arrow-right>字符編碼</h2><p>字符編碼（英語：Character encoding）也稱字集碼，是把字符集中的字符編碼為指定集合中某一對象（例如：比特模式、自然數序列、8 位組或者電脈衝），以便文本在計算機中存儲和通過通信網絡的傳遞。</p><p>為了理解字符集和字符編碼的關係，這裡舉個簡單的例子，我們可以把字符集當成接口，把字符編碼當成接口的實現。 Unicode 是接口（字符集）， UTF-8 / UTF-16 / UTF-32 則是不同的實現（字符編碼）。</p><h2 class=pgc-h-arrow-right>ANSI</h2><p>ANSI 全稱（American National Standard Institite）美國國家標準學會（美國的一個非營利組織），首先 ANSI 不是指的一種特定的編碼，而是不同地區擴展編碼方式的統稱，各個國家和地區所獨立制定的兼容 ASCII 但互相不兼容的字符編碼，微軟統稱為 ANSI 編碼。</p><div class=pgc-img><img alt="Java 字符編碼" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/689930fcab234b1fa89acd0868efc912><p class=pgc-img-caption></p></div><p>在簡體中文 windows 下使用文本文件保存”聯通“，則再次打開會顯示亂碼。這是因為 windows 下的文本文件默認使用 ansi 字符集，而簡體中文 windows 下的 ansi 字符集為 GB2312，”聯通“兩個字的 GB2312 編碼看起來和 UTF-8 非常相似，又因為我們沒有在文件開頭設置字符集標記（BOM），所以當我們再次打開該文件時，被識別為 UTF-8，因此出現亂碼。</p><h2 class=pgc-h-arrow-right>Unicode</h2><p>Unicode（統一碼、萬國碼、單一碼）是計算機科學領域裡的一項業界標準，包括字符集、編碼方案等。Unicode 是為了解決傳統的字符編碼方案的侷限而產生的，它為每種語言中的每個字符設定了統一併且唯一的二進制編碼，以滿足跨語言、跨平臺進行文本轉換、處理的要求。</p><ul><li>CodeUnit ：代碼單元/編碼單元，是 Unicode 編碼裡一個 CodePoint 需要的最少字節數例如：UTF-8 是一個字節，UTF-16 是兩個字節，UTF-32 是四個字節</li><li>CodePoint ：代碼點，Unicode 規定的每一個字符就是一個 CodePoint</li><li>CodeSpace ：代碼空間，所有的代碼點構成一個代碼空間，根據 Unicode 定義，總共有 1,114,112 個代碼點，編號從 0x0-0x10FFFF ，也就是大概 110 多萬個字符</li><li>CodePlane ：代碼平面，Unicode 標準把代碼點分成了17 個代碼平面，編號為 #0-#16。每個代碼平面包含 65,536（2^16）個代碼點（17*65,536=1,114,112）。#0 叫做 基本多語言平面 (BMP：大部分常用的字符都坐落在這個平面內，比如 ASCII 字符，漢字等。代碼點範圍：0x0000-0xFFFF)，其餘平面叫做 補充平面</li><li>SurrogatePair ：代理對，由一個 High-surrogate （高代理代碼點： 0xD800-0xDBFF ）和一個 Low-surrogate （低代理代碼點： 0xDC00-0xDFFF ）組成。這 2048 個代碼點位於 BMP 內，並且不是有效的字符代碼點，它們是為 UTF 編碼保留的。在 UTF-16 中它可以編碼 BMP 之外的代碼點</li></ul><h2 class=pgc-h-arrow-right>UTF-8</h2><p>UTF-8 的特點是對不同範圍的字符使用不同長度的編碼。對於 0x00-0x7F 之間的字符，UTF-8 編碼與 ASCII 編碼完全相同。UTF-8 編碼的最大長度是 4 個字節。</p><ul><li>對於單個字節的字符，第一位設為 0，後面的 7 位對應這個字符的 Unicode 碼點。</li><li>對於需要使用 N 個字節來表示的字符（N > 1），第一個字節的前 N 位都設為 1，第 N + 1 位設為0，剩餘的 N - 1 個字節的前兩位都設位 10，剩下的二進制位則使用這個字符的 Unicode 碼點來填充。</li></ul><p>Unicode 編碼(十六進制)UTF-8 字節流(二進制)000000-00007F0xxxxxxx000080-0007FF110xxxxx 10xxxxxx000800-00FFFF1110xxxx 10xxxxxx 10xxxxxx010000-10FFFF11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</p><p>UTF-8 編碼的最大長度是 4 個字節。從上表可以看出，4 字節模板有 21 個 x，即可以容納 21 位二進制數字。Unicode 的最大碼位 0x10FFFF 也只有 21 位。</p><p>例1：“漢”字的Unicode 編碼是 0x6C49。0x6C49 在 0x0800-0xFFFF 之間，使用3字節模板： 1110xxxx10xxxxxx10xxxxxx 。將0x6C49寫成二進制是： 0110110001001001 ， 用這個比特流依次代替模板中的x，得到： 111001101011000110001001 ，即 E6 B1 89。</p><p>例2：Unicode編碼0x20C30在0x010000-0x10FFFF 之間，使用 4 字節模板 11110xxx10xxxxxx10xxxxxx10xxxxxx 。將 0x20C30 寫成 21 位二進制數字（不足 21 位就在前面補 0）： 000100000110000110000 ，用這個比特流依次代替模板中的 x，得到： 11110000101000001011000010110000 ，即 F0 A0 B0 B0。</p><h2 class=pgc-h-arrow-right>UTF-16</h2><p>UTF-16 是 Unicode 的一種編碼方式，它用兩個字節來編碼 BMP 裡的代碼點，用四個字節編碼其餘平面裡的代碼點。</p><p>為了書寫方便，我們把 Unicode 編碼記作 U。</p><ul><li>如果 U&lt;0x10000 ，U 的 UTF-16 編碼就是 U 對應的 16 位無符號整數。</li><li>如果 U≥0x10000 ，我們先計算 U'=U-0x10000，然後將 U' 寫成二進制形式： yyyy yyyy yyxx xxxx xxxx ，U 的 UTF-16 編碼（二進制）就是： 110110yyyyyyyyyy110111xxxxxxxxxx 。</li></ul><h4 class=pgc-h-arrow-right>為什麼 U' 可以被寫成 20 個二進制位？</h4><p>Unicode 的最大碼位是 0x10FFFF，減去 0x10000 後，U 的最大值是 0xFFFFF，所以肯定可以用 20 個二進制位表示。</p><h4 class=pgc-h-arrow-right>為什麼把 0x10000-0x10FFFF 編碼為 110110yyyyyyyyyy110111xxxxxxxxxx ？</h4><p>110110yyyyyyyyyy 的取值範圍為 1101100000000000 - 1101101111111111 ，即 0xD800-0xDBFF（ High-surrogate ）</p><p>110111xxxxxxxxxx 的取值範圍為 1101110000000000 - 1101111111111111 ，即 0xDC00-0xDFFF（ Low-surrogate ） 所以 110110yyyyyyyyyy110111xxxxxxxxxx 正好是一個 SurrogatePair ，也就是 4 個字節</p><p>例如：Unicode 編碼 0x20C30，減去 0x10000 後，得到 0x10C30，寫成二進制是： 00010000110000110000 。用前 10 位依次替代模板中的 y，用後 10 位依次替代模板中的 x，就 得到： 11011000010000111101110000110000 ，即 0xD843 0xDC30。</p><h2 class=pgc-h-arrow-right>UTF-32</h2><p>UTF-32 編碼以 32 位無符號整數為單位。Unicode 的 UTF-32 編碼就是其對應的 32 位無符號整數。</p><h2 class=pgc-h-arrow-right>大/小端</h2><p>大小端是 CPU 處理多字節數的不同方式，其主要特點是字節序在內存中存儲位置不同。</p><ul><li>大端（Big-Endian）：高字節序存儲在低地址，低字節序存儲在高地址。</li><li>小端（Little-Endian）：高字節序存儲在高地址，低字節序存儲在低地址。</li></ul><div class=pgc-img><img alt="Java 字符編碼" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c3f17413eec74feaa0cba5e102ca7727><p class=pgc-img-caption></p></div><p>對於任何字符編碼，編碼單元的順序是由編碼方案指定的，與 endian 無關。例如 GBK 的編碼單元是字節，用兩個字節表示一個漢字。這兩個字節的順序是固定的，不受 CPU 字節序的影響。UTF-16 的編碼單元是 word（雙字節），word 之間的順序是編碼方案指定的，word 內部的字節排列才會受到 endian 的影響。</p><p>在網絡上傳輸數據時，由於數據傳輸的兩端對應不同的硬件平臺，採用的存儲字節順序可能不一致。所以在 TCP/IP 協議規定了在網絡上必須採用網絡字節順序，也就是大端模式。</p><p>JVM 屏蔽了大小端問題，默認為大端，並且可使用 ByteOrder.nativeOrder() 查詢處理器和內存系統的大小端，在使用 ByteBuffer 時，也可以使用 ByteBuffer.order() 進行設置。</p><h2 class=pgc-h-arrow-right>BOM</h2><p>Unicode 的學名是 "Universal Multiple-Octet Coded Character Set"，簡稱為 UCS。UCS 可以看作是 "Unicode Character Set" 的縮寫。在 UCS 編碼中有一個叫做 "Zero Width No-Break Space"，中文譯名作“零寬無間斷間隔”的字符，它的編碼是 FEFF。而 FFFE 在 UCS 中是不存在的字符，所以不應該出現在實際傳輸中。UCS 規範建議我們在傳輸字節流前，先傳輸字符 "Zero Width No-Break Space"。這樣如果接收者收到 FEFF，就表明這個字節流是 Big-Endian 的；如果收到 FFFE，就表明這個字節流是 Little- Endian 的。因此字符 "Zero Width No-Break Space" （“零寬無間斷間隔”）又被稱作 BOM(即 Byte Order Mark)。</p><p>UTF-8 BOM：UTF-8 以字節為編碼單元，沒有字節序的問題，但可以用 BOM 來表明編碼方式。字符 "Zero Width No-Break Space" 的 UTF-8 編碼是 EF BB BF 。（ windows 系統默認使用 UTF-8 BOM 編碼，需要注意 ）</p><h4 class=pgc-h-arrow-right>文件：D:\bom.txt，編碼：UTF-8-BOM</h4><div class=pgc-img><img alt="Java 字符編碼" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/27fd826e9c7b49658a99921457b7c852><p class=pgc-img-caption></p></div><h4 class=pgc-h-arrow-right>代碼：</h4><h4 class=pgc-h-arrow-right>結果</h4><h4 class=pgc-h-arrow-right>常見BOM</h4><p>BOM Encoding字符編碼EF BB BFUTF-8 BOMFE FFUTF-16 (big-endian)FF FEUTF-16 (little-endian)00 00 FE FFUTF-32 (big-endian)FF FE 00 00UTF-32 (little-endian)</p><h2 class=pgc-h-arrow-right>Java 字符編碼</h2><pre><code>Java 使用 Unicode 字符集並且使用 UTF-16 字符編碼。Java 語言規範規定，Java 的 char 類型是 UTF-16的code unit，也就是一定是 16 位（2 字節）。</code></pre><h2 class=pgc-h-arrow-right>一個字符到底佔用多少個字節？</h2><p>對於 Java 中的 char 類型來說的話，固定佔用 2 字節，但是為什麼使用 newString("字").getBytes().length 返回的是 3，這是因為 getBytes 實際是做了 編碼轉換 (內碼轉外碼)，你可以顯式傳入一個參數來指定編碼，否則它會使用 缺省編碼 來轉換。</p><p>對於肉眼可見的字符來說，這個取決於字符編碼，同一個字符在不同的編碼下佔用不同的字節。例如：漢字的"字","字"在 GBK 編碼下佔 2 字節，在 UTF-8 編碼下佔 3 字節，在 UTF-32 編碼下佔 4 字節。</p><h3 class=pgc-h-arrow-right>內碼 & 外碼</h3><ul><li>內碼 ：程序內部使用的字符編碼，特別是某種語言實現其 char 或 String 類型在內存裡用的內部編碼。Java 的內碼就是 UTF-16。</li><li>外碼 ：程序與外部交互時外部使用的字符編碼。簡單的來說就是除了內碼都可以認為是“外碼”（包括 class 文件的編碼）。</li></ul><h4 class=pgc-h-arrow-right>內碼轉外碼：</h4><ul><li>String.getBytes(StringcharsetName) ：將內存中的字符串用 UTF-16 編碼轉換為指定編碼的 byte 序列。</li><li>String.getBytes() ：將內存中的字符串用 UTF-16 編碼轉換為缺省編碼的 byte 序列。</li></ul><h4 class=pgc-h-arrow-right>外碼轉內碼：</h4><ul><li>newString(byte[]bytes,Stringcharset) ：就是把字節流以指定的編碼轉換為 UTF-16 編碼的字節流存入內存中。</li><li>Java 的 class 文件是以 UTF-8 的方式來編碼的。JVM 讀取 class 文件時需要把 UTF-8 編碼轉換為 UTF-16 編碼讀入內存。</li></ul><p>注意：編碼和解碼的“字符編碼”必須要一致才能解碼成想要的字符串。</p><h3 class=pgc-h-arrow-right>缺省編碼</h3><p>可以在啟動 JVM 時通過 -Dfile.encoding=UTF-8 來設置，否則使用操作系統環境下的缺省編碼，可通過 Charset.defaultCharset() 獲取編碼。</p><p>通常，Windows 系統下是 GBK，Linux 和 Mac 是 UTF-8。</p><p>如果使用 IDE，則會使用工程的缺省編碼，具體編碼是什麼，需要看具體使用的 IDE，可以百度來修改 IDE 的編碼。（有可能會遇到某 IDE 在啟動項目時控制檯打印的日誌是亂碼，這就是編碼搞得鬼） 因為 getBytes 受缺省編碼的影響而得到的結果不同，所以在使用該方法時，建議顯示指定編碼。</p><h2 class=pgc-h-arrow-right>String#length()獲取的是真正的字符串長度嗎？</h2><p>不是，它獲取的僅僅是代碼單元的數量，而真正的字符串長度是代碼點數量，可使用 String#codePointCount() 來獲取。</p><p>原因：我們在上面介紹過，某字符的代碼點>=0x10000時UTF-16 編碼會佔用 4 個字節，又因為 Java 的 char 固定就是 2 字節，所以我們需要使用 2 個 char 來表示該字符，那麼在使用 String#length()獲取字符串長度時，就會出錯。</p><p>為什麼我們平時都是使用該方法獲取字符串長度呢？因為 BMP 裡定義了我們使用的大部分字符，並且我們基本使用不到 BMP 之外的字符。</p><h2 class=pgc-h-arrow-right>為什麼 Java 不使用定長編碼呢？</h2><pre><code>Java 設計之初 UTF-16 確實是定長編碼，只不過後來 Unicode 的字符變多了之後，UTF-16 變成了變長編碼。Java 5.0 版本既要支持 Unicode 4.0 同時要保證向後兼容性，不得不開始使用 UTF-16  作為內部編碼方式。</code></pre><h2 class=pgc-h-arrow-right>代碼點/代碼單元分析</h2><h4 class=pgc-h-arrow-right>代碼</h4><h4 class=pgc-h-arrow-right>結果</h4><h2 class=pgc-h-arrow-right>編解碼</h2><p>可通過 Charset.availableCharsets().keySet()來查看 Java 到底支持哪些字符編碼。</p><ul><li>編碼：字符集的字符 => 字節數組</li><li>解碼：字節數組 => 字符集的字符</li><li>編碼轉換：字符集1的字符 => 字符集 2 的字符，通過這裡可以看出如果 2 個字符集的某個字符沒有對應關係，那麼就會導致亂碼</li></ul><p>其他來源的字符保存到 JVM 內存需要經歷：字節數組 => 指定編碼的字符 => Unicode 字符 => UTF-16 編碼後的字節數組。</p><p>JVM 內存保存到其他地方需要經歷：UTF-16 編碼後的字節數組 => Unicode字符 => 指定編碼的字符 => 字節數組。</p><p>由此可以看出，系統內部是做了一步字符集轉換。如果兩個字符集沒有轉換規則，那麼就會使用 Codepage（代碼頁），有興趣的同學可以自行去了解代碼頁。</p><h4 class=pgc-h-arrow-right>代碼</h4><h4 class=pgc-h-arrow-right>結果</h4><p>1. "編碼轉換"以 UTF-8 編碼存儲在class文件。</p><p>2. JVM 加載 class 文件，從常量池中讀取”編碼轉換“，並使用 UTF-8 解碼為 Unicode 字符，然後使用 UTF-16 編碼保存到 JVM 內存。</p><p>3. "編碼轉換".getBytes("UTF-8")，直接從 JVM 內存獲取"編碼轉換"的字節數組，然後使用 UTF-16 解碼為 Unicode 字符，最後使用 UTF-8 編碼為新的字節數組。（UTF-16 => UTF-8）</p><p>4. new String(utf8Bytes, "GBK")，使用 GBK 把 bytes 解碼為 GBK 字符，然後把 GBK 字符轉換為 Unicode 字符，最後使用 UTF-16 編碼保存到 JVM 內存（GBK 和 Unicode 無聯繫，所以通過代碼頁來完成轉換）。</p><h2 class=pgc-h-arrow-right>瀏覽器/Tomcat/Mysql</h2><div class=pgc-img><img alt="Java 字符編碼" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/60a29e14cbda41c9af71b979dcaa03b6><p class=pgc-img-caption></p></div><h2 class=pgc-h-arrow-right>瀏覽器編碼</h2><p>URI：不同瀏覽器採用的編碼方案不同。例如 chrome 使用 UTF-8 header：ISO-8859-1 body：根據 Content-Type 來進行編碼</p><h4 class=pgc-h-arrow-right>chrome瀏覽器</h4><div class=pgc-img><img alt="Java 字符編碼" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cd3135f2ab5d4d93889c731fbc3d7a8d><p class=pgc-img-caption></p></div><h2 class=pgc-h-arrow-right>瀏覽器解碼</h2><p>header：ISO-8859-1 body：首先查看 Content-Type 中是否存在編碼方案，其次若返回的是 html 格式，則查看 meta 中是否指定字符集，最後使用瀏覽器默認字符集解碼</p><p>在 chrome 中可以使用插件手動修改默認的字符集。例如：Set Character Encoding。</p><h2 class=pgc-h-arrow-right>tomcat 編碼</h2><p>依賴於應用程序</p><h2 class=pgc-h-arrow-right>tomcat 解碼</h2><p>依賴於 server.xml 的 Connector 的配置</p><p>UTIEncoding：URI 的編碼，tomcat7 默認 ISO-8859-1，tomcat8 默認 UTF-8。</p><p>useBodyEncodingForURI：使 URI 編碼等於 request.setCharacterEncoding() 設置的編碼。</p><p>request.setCharacterEncoding()：指定 body 體的編碼方式，必須在第一次獲取 body 體內容之前設置。</p><h3 class=pgc-h-arrow-right>Spring</h3><p>如果使用 Spring MVC，則需要配置 CharacterEncodingFilter 為第一個過濾器，並且指定編碼。</p><p>如果使用 Spring Boot，則無需配置，默認配置了 OrderedCharacterEncodingFilter ，默認編碼為 UTF-8。</p><p>這個過濾器只是針對的 body 體，至於 get 請求還依賴於使用的 tomcat 版本，如使用 Tomcat7，則需要去 server.xml 配置 UTIEncoding/useBodyEncodingForURI，若使用 Tomcat8，無需配置。</p><h2 class=pgc-h-arrow-right>Mysql</h2><div class=pgc-img><img alt="Java 字符編碼" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0babe0e82f544090a6372d2586b64e4e><p class=pgc-img-caption></p></div><p>character_set_client ：客戶端數據解析、編碼的字符集</p><p>character_set_connection ：連接層字符集</p><p>character_set_database ：當前數據庫的字符集</p><p>character_set_server ：服務器內部操作字符集</p><p>character_set_results ：查詢結果字符集</p><p>character_set_system ：系統源數據(字段名等)字符集</p><p>setnames utf8mb4 等同於同時設置 character_set_client ， character_set_connection ， character_set_results 這三個字符集</p><p>1. 客戶端使用特定字符集編碼 SQL 發送到服務端。</p><p>2. 服務端接受到字節流後，使用 character_set_client 進行解碼。</p><p>3. 服務端解碼後，會使用 character_set_connection 進行編碼，然後傳給存儲引擎。若 character_set_connection 和 character_set_client 不同，則發生字符集轉換操作。</p><p>4. 存儲引擎查詢表時，若表字符集和 character_set_connection 不同，則發生字符集轉換操作。</p><p>5. 存儲引擎查詢到結果之後，會使用 character_set_results 進行編碼返回給客戶端，若表字符集和 character_set_results 不同，則發生字符集轉換操作。</p><p>6. 客戶端接受到結果後，使用特定字符集進行解碼。</p><p>客戶端character set clientcharacter set connection表字符集character set results結果utf8utf8utf8/gbkutf8/gbkutf8正常gbkgbkutf8/gbkutf8/gbkgbk正常gbkutf8utf8/gbkutf8/gbkgbk亂碼gbkgbkutf8/gbkutf8/gbkutf8亂碼gbkutf8utf8/gbkutf8/gbkutf8亂碼</p><p>由此表可以看出，必須保證 客戶端 、 character_set_client 、 character_set_results 一致才可以保證數據正常。如果使 character_set_connection 、 表字符集 和上面 3 個保持一致，可以減少字符集轉換。</p><h3 class=pgc-h-arrow-right>Connector / J</h3><p>在使用Connector / J時，創建連接語句 jdbc:mysql://127.0.0.1:3306/test?useUnicode=true&characterEncoding=utf8 基本都會配置 useUnicode 和 characterEncoding 。否則創建連接時，驅動程序會自動檢測 character_set_server 並使用該字符集。</p><p>要覆蓋客戶端自動檢測到的編碼，請使用 characterEncoding 服務器連接 URL 中的屬性。指定字符編碼時，請使用 Java 樣式的名稱。</p><div class=pgc-img><img alt="Java 字符編碼" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/8909a76522ee47bdbf8754ef4fcb5f50><p class=pgc-img-caption></p></div><p>對於 Connector / J 5.1.46 及更早版本：為了使用 utf8mb4 字符集進行連接，服務器必須配置為 character set server=utf8mb4。如果不是這種情況，UTF-8則characterEncoding在連接字符串中使用時，它將映射到 MySQL 字符集名稱 utf8。</p><p>對於 Connector / J 5.1.47 及更高版本：當 UTF-8 用於 characterEncoding 連接字符串中，它映射到 MySQL 的字符集的名字 utf8mb4。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Java</a></li><li><a>編碼</a></li><li><a>字符</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/20dcfe0c.html alt=Java--字符編碼和字符集詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/20dcfe0c.html title=Java--字符編碼和字符集詳解>Java--字符編碼和字符集詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dac12ddf.html alt=圖解字符編碼 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/caf1b27c8b4747ad8d801f3c00444cc1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dac12ddf.html title=圖解字符編碼>圖解字符編碼</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3bffcca9.html alt=常用字符編碼介紹 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6f7200df229c4408bfc672c73e4c8c26 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3bffcca9.html title=常用字符編碼介紹>常用字符編碼介紹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5da0997a.html alt="深入分析 Java Web 中的中文編碼問題" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/154071479216321347e0b7f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5da0997a.html title="深入分析 Java Web 中的中文編碼問題">深入分析 Java Web 中的中文編碼問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bbed920b.html alt=與你的理解是否相同-字符編碼 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/59420003c8ac3bf05a4e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bbed920b.html title=與你的理解是否相同-字符編碼>與你的理解是否相同-字符編碼</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3f5733e7.html alt="Java IO4：字符編碼，來來來，繼續" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b393785e9fc14c139e7277da465fd2ea style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3f5733e7.html title="Java IO4：字符編碼，來來來，繼續">Java IO4：字符編碼，來來來，繼續</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/02402c9e.html alt=「乾貨」藍牙耳機編碼（SBC、AAC、aptX）都有啥區別？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/feb0ab00-bb82-4c38-9e77-e3570f56137d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/02402c9e.html title=「乾貨」藍牙耳機編碼（SBC、AAC、aptX）都有啥區別？>「乾貨」藍牙耳機編碼（SBC、AAC、aptX）都有啥區別？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4e49d1f3.html alt=信息編碼：數字和文字是如何誕生的？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1f3d0677443e48bfbb2435b71f6da199 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4e49d1f3.html title=信息編碼：數字和文字是如何誕生的？>信息編碼：數字和文字是如何誕生的？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/17054f8d.html alt=詳解CD編碼格式（16bit/44.1kHz）合理性之量化篇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/6f23d12bac3843e2b09628221846ce0f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/17054f8d.html title=詳解CD編碼格式（16bit/44.1kHz）合理性之量化篇>詳解CD編碼格式（16bit/44.1kHz）合理性之量化篇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f3070f16.html alt=買這個編碼格式的藍牙設備，又便宜又好用！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/8d5cc4a5-5d5b-4a34-adbd-cb74f8d4db2b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f3070f16.html title=買這個編碼格式的藍牙設備，又便宜又好用！>買這個編碼格式的藍牙設備，又便宜又好用！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8775ee99.html alt=音頻壓縮編碼的基本原理詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1d62465bab4542babd5647386c272c82 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8775ee99.html title=音頻壓縮編碼的基本原理詳解>音頻壓縮編碼的基本原理詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/53140375.html alt=信息編碼與數字化 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/8bea8e2d5bad49659ffd74924fc6f08b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/53140375.html title=信息編碼與數字化>信息編碼與數字化</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ed5abbe2.html alt=很多程序員編碼時都戴耳機？他們在聽什麼？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0710e96976d448dc8a7fde6c55312565 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ed5abbe2.html title=很多程序員編碼時都戴耳機？他們在聽什麼？>很多程序員編碼時都戴耳機？他們在聽什麼？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/22525cee.html alt=數字音視頻壓縮編碼標準及H.265的編碼優勢 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/558a023201a84604894ebc359d178ed2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/22525cee.html title=數字音視頻壓縮編碼標準及H.265的編碼優勢>數字音視頻壓縮編碼標準及H.265的編碼優勢</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f4df1c1a.html alt="有一種音頻編碼技術叫MQA，聲音質感優於TIDAL HiFi（CD等級）" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/6383bc881ccf4674aa3074a767f7f743 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f4df1c1a.html title="有一種音頻編碼技術叫MQA，聲音質感優於TIDAL HiFi（CD等級）">有一種音頻編碼技術叫MQA，聲音質感優於TIDAL HiFi（CD等級）</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>