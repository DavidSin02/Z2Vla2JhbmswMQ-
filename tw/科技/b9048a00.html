<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>以前面試只問多線程，現在都開始問響應式編程了！我懵了 | 极客快訊</title><meta property="og:title" content="以前面試只問多線程，現在都開始問響應式編程了！我懵了 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/dfic-imagehandler/db2f6d0a-3f0f-4f56-8305-0366b7198f02"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b9048a00.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b9048a00.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b9048a00.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b9048a00.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b9048a00.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b9048a00.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b9048a00.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b9048a00.html><meta property="article:published_time" content="2020-11-14T20:59:17+08:00"><meta property="article:modified_time" content="2020-11-14T20:59:17+08:00"><meta name=Keywords content><meta name=description content="以前面試只問多線程，現在都開始問響應式編程了！我懵了"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/b9048a00.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>以前面試只問多線程，現在都開始問響應式編程了！我懵了</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>以前面試只問多線程，現在都開始問響應式編程了！</p><p>看完這篇文章你就能有個大體的瞭解了。</p><p><br></p><div class=pgc-img><img alt=以前面試只問多線程，現在都開始問響應式編程了！我懵了 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/db2f6d0a-3f0f-4f56-8305-0366b7198f02><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>基本介紹</h1><p>目前比較流行的編程方法論有函數式編程(functional programming)、響應式編程(reactive programming)等。</p><p>函數式編程的代表就是工作流模式，而響應式編程的代表就是reactor模式了。</p><p>reactor模式廣泛地用於各種RPC框架，例如linux的epoll，redis，netty，kafka等。</p><h1 class=pgc-h-arrow-right>事件驅動編程與多線程編程</h1><p>多線程編程有如下幾個缺點:</p><ul><li>對於共享資源需要使用鎖結構 容易造成死鎖問題</li><li>難以Debug</li><li>多線程破壞了抽象 無法設計出模塊化的程序</li><li>因為鎖導致回調無法完成</li><li>想要得到良好的性能很難</li><li>線程庫不受支持 很多函數不支持線程安全</li></ul><p>事件驅動編程有以下幾個特點：</p><ul><li>一個執行流進程: 沒有CPU的併發</li><li>在時間上註冊消息(通過回調)</li><li>事件輪詢等待消息, 調用處理器模型</li><li>時間處理器沒有搶斷</li><li>處理器通常是 短生命週期的</li></ul><p>兩者相比:</p><ul><li>事件驅動編髮編程儘可能的避免 併發, 而多線程編程則傾向於併發：</li><li>使用事件驅動更加容易調試</li><li>在單個CPU上時間驅動程序比線程更加快速</li><li>事件驅動編程更加面向接口編程</li><li>多線程提供了真正的併發性</li></ul><p>Reactor模式就是一種事件驅動編程的模式，也是IO多路複用的基本設計模式。</p><p>他有如下幾個特點</p><ul><li>Reactor模式中會通過分配適當的handler(處理程序)來響應IO事件，類似與AWT 事件處理線程；</li><li>每個handler執行非阻塞的操作，類似於AWT ActionListeners 事件監聽</li><li>通過將handler綁定到事件進行管理，類似與AWT addActionListener 添加事件監聽；</li></ul><p>基本結構如下</p><p><br></p><div class=pgc-img><img alt=以前面試只問多線程，現在都開始問響應式編程了！我懵了 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ddf738d0576d4be080aeeb75fb9422ed><p class=pgc-img-caption></p></div><ul><li>Handles:句柄，標識OS管理的資源.每個連接由socket句柄表示。</li><li>Synchronous Event Demultiplexer：同步事件多路複用器，在句柄集合上阻塞等待事件的發生。</li><li>Initiation Dispatcher：初始分發器，分發事件處理器的接口。</li><li>Event Handler：事件處理器，指定一個由鉤子方法組成的接口。</li><li>Concrete Event Handler：具體處理事件的方法</li></ul><p>整個流程如下：</p><ul><li>我們註冊Concrete Event Handler到Initiation Dispatcher中。</li><li>Initiation Dispatcher調用每個Event Handler的get_handle接口獲取其綁定的Handle。</li><li>Initiation Dispatcher調用handle_events開始事件處理循環。在這裡，Initiation Dispatcher會將步驟2獲取的所有Handle都收集起來，使用Synchronous Event Demultiplexer來等待這些Handle的事件發生。</li><li>當某個（或某幾個）Handle的事件發生時，Synchronous Event Demultiplexer通知Initiation Dispatcher。</li><li>Initiation Dispatcher根據發生事件的Handle找出所對應的Handler。</li><li>Initiation Dispatcher調用Handler的handle_event方法處理事件。</li></ul><p><br></p><p>下面用一個例子來具體說明Reactor模式的運作：</p><p><br></p><div class=pgc-img><img alt=以前面試只問多線程，現在都開始問響應式編程了！我懵了 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1c27d1b5364b4d17910f65b33e22a7a9><p class=pgc-img-caption></p></div><p>步驟如下：</p><ul><li>日誌服務註冊Logging Acceptor 到初始分發器來處理連接請求；</li><li>日誌服務調用初始分發器的handle_events 方法；</li><li>初始分發器調用同步事件多路複用器的select 方法，等待連接請求或者日誌數據的達到；</li><li>客戶端連接到日誌服務器；</li><li>初始分發器通知Logging Acceptor 有新連接達到；</li><li>Logging Acceptor 接受新連接；</li><li>Logging Acceptor 創建一個Logging Handler 來為新客戶端服務；</li><li>Logging Handler 將它的socket句柄註冊到初始分發器，並且要求，當socket可讀時，初始分發器通知它；</li></ul><h1 class=pgc-h-arrow-right>Reactor線程模型</h1><h2 class=pgc-h-arrow-right>單線程模型</h2><p><br></p><div class=pgc-img><img alt=以前面試只問多線程，現在都開始問響應式編程了！我懵了 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ef6f5732b8cb4ea68bbd1ebd0be02961><p class=pgc-img-caption></p></div><h2 class=pgc-h-arrow-right>多線程模型</h2><p><br></p><div class=pgc-img><img alt=以前面試只問多線程，現在都開始問響應式編程了！我懵了 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e8f15722f4bd4ba3a8d89dc478b7fba6><p class=pgc-img-caption></p></div><h2 class=pgc-h-arrow-right>基於多個反應器的多線程模型</h2><p><br></p><div class=pgc-img><img alt=以前面試只問多線程，現在都開始問響應式編程了！我懵了 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6bb087b848f248b9b562a17c02d0ace1><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>Reactor模式的應用</h1><h2 class=pgc-h-arrow-right>redis(單線程模型)</h2><p><br></p><div class=pgc-img><img alt=以前面試只問多線程，現在都開始問響應式編程了！我懵了 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e2eac92586734c3cb36db7f6612b2d57><p class=pgc-img-caption></p></div><h2 class=pgc-h-arrow-right>Netty(多Reactor線程多Worker線程模型)</h2><p>Netty的線程模式就是一個實現了Reactor模式的經典模式。</p><p>結構對應：</p><ul><li>NioEventLoop ———— Initiation Dispatcher</li><li>Synchronous EventDemultiplexer ———— Selector</li><li>Evnet Handler ———— ChannelHandle</li><li>rConcreteEventHandler ———— 具體的ChannelHandler的實現</li></ul><p>模式對應（Netty服務端使用了“多Reactor多線程模式”）</p><ul><li>mainReactor ———— bossGroup(NioEventLoopGroup) 中的某個NioEventLoop</li><li>subReactor ———— workerGroup(NioEventLoopGroup) 中的某個NioEventLoop</li><li>acceptor ———— ServerBootstrapAcceptor</li><li>ThreadPool ———— 用戶自定義線程池</li></ul><h2 class=pgc-h-arrow-right>Spring5</h2><p>2年前 Java 9 發佈，其中一個重要的特性就是java.util.concurrent.flow包，它規範了reactive編程中異步非阻塞流處理的背壓(back pressure)問題。java8中的stream可以理解為迭代器模式(Iterator)的實現，而reactive可以理解為觀察者模式(Observer)的實現。Iterator模式是服務線程去拉(pull)數據，而Observer模式是數據主動推(push)給服務線程，如果服務線程消費的太慢或者說數據推送的太快 就會引起阻塞情況 這種現象就叫做背壓，java9推出了reactivestream來規範背壓問題的解決方案。在Java 9之後 Spring5也All in了reactive programming，推出spring reactor包。</p><p><br></p><h1 class=pgc-h-arrow-right>References</h1><p>1.John Ousterhout: Why Threads Are A Bad Idea(for most purposes)</p><p>2.Douglas C. Schmidt: Reactor An Object Behavioral Pattern for Demultiplexing and Dispatching Handlers for Synchr</p><p>3. Doug Lea: Scalable IO in Java</p><p><br></p><blockquote class=pgc-blockquote-abstract><p>希望能得到您的 關注、評論、轉發，謝謝！</p></blockquote><blockquote class=pgc-blockquote-abstract><p>私信我“資料”，可以免費獲取海量 JAVA技術棧電子書 和 大廠面試題。</p></blockquote></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>試只</a></li><li><a>問多線程</a></li><li><a>現在</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/75f7a232.html alt=招商銀行汪建中：掌上生活APP現在累計用戶達7千萬 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/75f7a232.html title=招商銀行汪建中：掌上生活APP現在累計用戶達7千萬>招商銀行汪建中：掌上生活APP現在累計用戶達7千萬</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fc2bac3b.html alt=現在黃沙（河沙）多少錢一噸？2018黃沙價格走勢如何？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/66b5000416e765b8fced style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fc2bac3b.html title=現在黃沙（河沙）多少錢一噸？2018黃沙價格走勢如何？>現在黃沙（河沙）多少錢一噸？2018黃沙價格走勢如何？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bb424892.html alt="@史季 南宋都城是現在杭州還是現在的臨安？當時的建築都去哪了？" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/bc52cb7c8a6542a6a067699b7e976b37 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bb424892.html title="@史季 南宋都城是現在杭州還是現在的臨安？當時的建築都去哪了？">@史季 南宋都城是現在杭州還是現在的臨安？當時的建築都去哪了？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3c12a50b.html alt=當少女偶像後，我放棄了學業，現在每天擠地鐵去上班 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2ef242e9c12a4d5e980bdb9d0ae8d847 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3c12a50b.html title=當少女偶像後，我放棄了學業，現在每天擠地鐵去上班>當少女偶像後，我放棄了學業，現在每天擠地鐵去上班</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9de460f3.html alt="你不要我不要他不要 現在才發現廢玻璃還挺值錢" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/85a3da94cf4f44669d4b650640a2c544 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9de460f3.html title="你不要我不要他不要 現在才發現廢玻璃還挺值錢">你不要我不要他不要 現在才發現廢玻璃還挺值錢</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ffe450a4.html alt=現在隨處可見的測溫槍，用多了對人體有害嗎？原理是什麼？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/d503403784f3416c93f3caf7fb362bb2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ffe450a4.html title=現在隨處可見的測溫槍，用多了對人體有害嗎？原理是什麼？>現在隨處可見的測溫槍，用多了對人體有害嗎？原理是什麼？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/985ff6f8.html alt=現在女人的地位太高，結婚3年，媳婦做飯洗碗的次數不超過10次 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5f8df08758a1416982b5d7bbbdcdc245 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/985ff6f8.html title=現在女人的地位太高，結婚3年，媳婦做飯洗碗的次數不超過10次>現在女人的地位太高，結婚3年，媳婦做飯洗碗的次數不超過10次</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3b59f9b8.html alt=現在社會女性地位真的高了？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3b59f9b8.html title=現在社會女性地位真的高了？>現在社會女性地位真的高了？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8a0c5a54.html alt=現在將風信子種下，一個月後就開花，花朵漂亮成活率高 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/558708118c0f47feadfcd4c647f01f63 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8a0c5a54.html title=現在將風信子種下，一個月後就開花，花朵漂亮成活率高>現在將風信子種下，一個月後就開花，花朵漂亮成活率高</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/efa3caae.html alt=現在你可以花費較少的時間，學會關於眼圖的全方位知識，點進看看 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/154080345569854317f8785 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/efa3caae.html title=現在你可以花費較少的時間，學會關於眼圖的全方位知識，點進看看>現在你可以花費較少的時間，學會關於眼圖的全方位知識，點進看看</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1272aa2b.html alt=患帕15年了，現在明顯凍結，言語不清，我該調藥還是選擇DBS？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/2c7eb46f-3a77-4786-a598-85a0643d3373 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1272aa2b.html title=患帕15年了，現在明顯凍結，言語不清，我該調藥還是選擇DBS？>患帕15年了，現在明顯凍結，言語不清，我該調藥還是選擇DBS？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4f07992f.html alt=現在是黃金投資的“黃金時刻”嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ed16cbb96d664529a91eeed9a9e4be57 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4f07992f.html title=現在是黃金投資的“黃金時刻”嗎？>現在是黃金投資的“黃金時刻”嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8adb4f5e.html alt=小學四、五年級，竟決定了孩子一生走向！現在看還來的及 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5218fd8071ea4bd8985a647c5841611a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8adb4f5e.html title=小學四、五年級，竟決定了孩子一生走向！現在看還來的及>小學四、五年級，竟決定了孩子一生走向！現在看還來的及</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/21255f41.html alt=當朋友不好嗎？非要當情侶，現在好了，連個屁都不是了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/83f48732a156413fa97602514719d801 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/21255f41.html title=當朋友不好嗎？非要當情侶，現在好了，連個屁都不是了>當朋友不好嗎？非要當情侶，現在好了，連個屁都不是了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/be60f7be.html alt="現在買手機你們還會選 128G 存儲容量的嗎？" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f9b5d6620dc64902a0f4b55c563ca9a2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/be60f7be.html title="現在買手機你們還會選 128G 存儲容量的嗎？">現在買手機你們還會選 128G 存儲容量的嗎？</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>