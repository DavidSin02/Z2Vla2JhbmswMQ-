<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Linuxç³»çµ±ç§»æ¤ä¹‹â€”â€”åœ¨ U-BOOT å° Nand Flash çš„æ”¯æŒï¼Œå…ˆæ”¶è— | æå®¢å¿«è¨Š</title><meta property="og:title" content="Linuxç³»çµ±ç§»æ¤ä¹‹â€”â€”åœ¨ U-BOOT å° Nand Flash çš„æ”¯æŒï¼Œå…ˆæ”¶è— - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/3fbc533d28464dae828bdfd33c49046d"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b977a02.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b977a02.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b977a02.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b977a02.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b977a02.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b977a02.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/b977a02.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/b977a02.html><meta property="article:published_time" content="2020-10-29T20:53:12+08:00"><meta property="article:modified_time" content="2020-10-29T20:53:12+08:00"><meta name=Keywords content><meta name=description content="Linuxç³»çµ±ç§»æ¤ä¹‹â€”â€”åœ¨ U-BOOT å° Nand Flash çš„æ”¯æŒï¼Œå…ˆæ”¶è—"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/b977a02.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Linuxç³»çµ±ç§»æ¤ä¹‹â€”â€”åœ¨ U-BOOT å° Nand Flash çš„æ”¯æŒï¼Œå…ˆæ”¶è—</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>ä¸Šç« ç¯€è¬›äº†Nand flashé©…å‹•çš„ç·¨å¯«èˆ‡ç§»æ¤ï¼Œæœ¬ç« ç¯€ä¸»è¦è¬›åœ¨ U-BOOT å° Nand Flash çš„æ”¯æŒï¼Œå­¸linuxçš„å»ºè­°æ”¶è—ï¼Œä»¥å¾Œå·¥ä½œä¸­æœƒé‡åˆ°ã€‚</p><pre><code>èªªæ˜ï¼šæœ¬äººä½œç‚ºä¸€åå·¥ä½œå¤šå¹´çš„ç¨‹åºå“¡ï¼Œçµ¦å¤§å®¶éƒ½æ˜¯ç²¾å¿ƒæŒ‘é¸çš„è³‡æ–™ï¼Œå¸Œæœ›å°å¤§å®¶çš„å­¸ç¿’æœ‰å¹«åŠ©ã€‚</code></pre><p>æœ¬ç« ä¸»è¦å…§å®¹å¦‚ä¸‹ï¼š</p><p>3 åœ¨ UÂ­BOOT å° Nand Flash çš„æ”¯æŒ</p><p>3.1 UÂ­BOOT å°å¾ Nand Flash å•Ÿå‹•çš„æ”¯æŒ</p><p>3.1.1 å¾ Nand Flash å•Ÿå‹• UÂ­BOOT çš„åŸºæœ¬åŸç†</p><p>3.1.2 æ”¯æŒ Nand Flash å•Ÿå‹•ä»£ç¢¼èªªæ˜</p><p>3.2 UÂ­BOOT å° Nand Flash å‘½ä»¤çš„æ”¯æŒ</p><p>3.2.1 ä¸»è¦æ•¸æ“šçµæ§‹ä»‹ç´¹</p><p>3.2.2 æ”¯æŒçš„å‘½ä»¤å‡½æ•¸èªªæ˜</p><p>4 åœ¨ Linux å° Nand Flash çš„æ”¯æŒ</p><p>4.1 Linux ä¸‹ Nand Flash èª¿ç”¨é—œä¿‚</p><p>4.1.1 Nand Flash è¨­å‚™æ·»åŠ æ™‚æ•¸æ“šçµæ§‹åŒ…å«é—œä¿‚</p><p>4.1.2 Nand Flash è¨­å‚™è¨»å†Šæ™‚æ•¸æ“šçµæ§‹åŒ…å«é—œä¿‚</p><p>4.2 Linux ä¸‹ Nand Flash é©…å‹•ä¸»è¦æ•¸æ“šçµæ§‹èªªæ˜</p><p>4.2.1 s3c2410 å°ˆæœ‰æ•¸æ“šçµæ§‹</p><p>4.2.2 Linux é€šç”¨æ•¸æ“šçµæ§‹èªªæ˜</p><p>4.3.1 è¨»å†Š driver_register</p><p>4.3.2 æ¢æ¸¬è¨­å‚™ probe</p><p>4.3.3 åˆå§‹åŒ– Nand Flash æ§åˆ¶å™¨</p><p>4.3.4 ç§»é™¤è¨­å‚™</p><p>4.3.5 Nand Flash èŠ¯ç‰‡åˆå§‹åŒ–</p><p>4.3.6 è®€ Nand Flash</p><p>4.3.7 å¯« Nand Flash</p><p><br></p><div class=pgc-img><img alt="Linuxç³»çµ±ç§»æ¤ä¹‹â€”â€”åœ¨ U-BOOT å° Nand Flash çš„æ”¯æŒï¼Œå…ˆæ”¶è—" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3fbc533d28464dae828bdfd33c49046d><p class=pgc-img-caption></p></div><p><br></p><p><strong>3.1 U-BOOT å°å¾ Nand Flash å•Ÿå‹•çš„æ”¯æŒ</strong></p><p><strong>3.1.1 å¾ Nand Flash å•Ÿå‹• U-BOOT çš„åŸºæœ¬åŸç†</strong></p><p>1. å‰ 4K çš„å•é¡Œ</p><p>å¦‚æœ S3C2410 è¢«é…ç½®æˆå¾ Nand Flash å•Ÿå‹•(é…ç½®ç”±ç¡¬ä»¶å·¥ç¨‹å¸«åœ¨é›»è·¯æ¿è¨­ç½®), S3C2410 çš„ Nand Flash æ§åˆ¶å™¨</p><p>æœ‰ä¸€å€‹ç‰¹æ®Šçš„åŠŸèƒ½, åœ¨ S3C2410 ä¸Šé›»å¾Œ, Nand Flash æ§åˆ¶å™¨æœƒè‡ªå‹•çš„æŠŠ Nand Flash ä¸Šçš„å‰ 4K æ•¸æ“šæ¬ç§»åˆ° 4K å…§éƒ¨</p><p>RAM ä¸­, ä¸¦æŠŠ 0x00000000 è¨­ç½®å…§éƒ¨ RAM çš„èµ·å§‹åœ°å€, CPU å¾å…§éƒ¨ RAM çš„ 0x00000000 ä½ç½®é–‹å§‹å•Ÿå‹•ã€‚é€™å€‹é</p><p>ç¨‹ä¸éœ€è¦ç¨‹åºå¹²æ¶‰ã€‚</p><p>ç¨‹åºå“¡éœ€è¦å®Œæˆçš„å·¥ä½œï¼Œæ˜¯æŠŠæœ€æ ¸å¿ƒçš„å•Ÿå‹•ç¨‹åºæ”¾åœ¨ Nand Flash çš„å‰ 4K ä¸­ã€‚</p><p>2. å•Ÿå‹•ç¨‹åºçš„å®‰æ’</p><p>ç”±æ–¼ Nand Flash æ§åˆ¶å™¨å¾ Nand Flash ä¸­æ¬ç§»åˆ°å…§éƒ¨ RAM çš„ä»£ç¢¼æ˜¯æœ‰é™çš„,æ‰€ä»¥, åœ¨å•Ÿå‹•ä»£ç¢¼çš„å‰ 4K è£¡,æˆ‘</p><p>å€‘å¿…é ˆå®Œæˆ S3C2410 çš„æ ¸å¿ƒé…ç½®ä»¥åŠæŠŠå•Ÿå‹•ä»£ç¢¼(UBOOT)å‰©é¤˜éƒ¨åˆ†æ¬åˆ° RAM ä¸­é‹è¡Œã€‚ä»¥ UBOOT ç‚ºä¾‹, å‰ 4K</p><p>å®Œæˆçš„ä¸»è¦å·¥ä½œ, è¦‹ç¬¬å››éƒ¨åˆ†çš„ 2.2 ç¯€ã€‚</p><p><strong>3.1.2 æ”¯æŒ Nand Flash å•Ÿå‹•ä»£ç¢¼èªªæ˜</strong></p><p>é¦–å…ˆåœ¨ include/configs/crane2410.h ä¸­åŠ å…¥ CONFIG_S3C2410_NAND_BOOT, å¦‚ä¸‹ï¼š</p><p>#define CONFIG_S3C2410_NAND_BOOT 1</p><p>æ”¯æŒå¾ Nand Flash ä¸­å•Ÿå‹•.</p><p>1. åŸ·è¡Œ Nand Flash åˆå§‹åŒ–</p><p>ä¸‹é¢ä»£ç¢¼åœ¨ cpu/arm920t/start.S ä¸­</p><p>#ifdef CONFIG_S3C2410_NAND_BOOT</p><p>copy_myself:</p><p>mov r10, lr</p><p>ldr sp, DW_STACK_START @å®‰è£æ£§çš„èµ·å§‹åœ°å€</p><p>mov fp, #0 @åˆå§‹åŒ–å¹€æŒ‡é‡å¯„å­˜å™¨</p><p>bl nand_reset @è·³åˆ°å¾©ä½ C å‡½æ•¸å»åŸ·è¡Œ</p><p>...</p><p>DW_STACK_START:</p><p>.word STACK_BASE+STACK_SIZEÂ­4</p><p>2. nand_reset C ä»£ç¢¼</p><p>ä¸‹é¢ä»£ç¢¼è¢«åŠ åœ¨/board/crane2410/crane2410.c ä¸­</p><p>void nand_reset(void)</p><p>{</p><p>int i;</p><p>/* è¨­ç½® Nand Flash æ§åˆ¶å™¨ */</p><p>rNFCONF=(1&lt;&lt;15)|(1&lt;&lt;14)|(1&lt;&lt;13)|(1&lt;&lt;12)|(1&lt;&lt;11)|(TACLS&lt;&lt;8)|(TWRPH0&lt;&lt;4)|(TWRPH1&lt;&lt;0);</p><p>/* çµ¦ Nand Flash èŠ¯ç‰‡ç™¼é€å¾©ä½å‘½ä»¤ */</p><p>NF_nFCE_L();</p><p>NF_CMD(0xFF);</p><p>for(i=0; i&lt;10; i++);</p><p>NF_WAITRB(); NF_nFCE_H();</p><p>}</p><p>3. å¾ Nand Flash ä¸­æŠŠ UBOOT æ‹·è²åˆ° RAM</p><p>@read UÂ­BOOT from Nand Flash to RAM</p><p>ldr r0, =UBOOT_RAM_BASE @ è¨­ç½®ç¬¬ 1 å€‹åƒæ•¸: UBOOT åœ¨ RAM ä¸­çš„èµ·å§‹åœ°å€</p><p>mov r1, #0x0 @ è¨­ç½®ç¬¬ 2 å€‹åƒæ•¸:Nand Flash çš„èµ·å§‹åœ°å€</p><p>mov r2, #0x20000 @ è¨­ç½®ç¬¬ 3 å€‹åƒæ•¸: UBOOT çš„é•·åº¦(128KB)</p><p>bl nand_read_whole @ èª¿ç”¨ nand_read_whole(), è©²å‡½æ•¸åœ¨ board/crane2410/crane2410.c ä¸­</p><p>tst r0, #0x0 @ å¦‚æœå‡½æ•¸çš„è¿”å›å€¼ç‚º 0,è¡¨ç¤ºåŸ·è¡ŒæˆåŠŸ.</p><p>beq ok_nand_read @ åŸ·è¡Œå…§å­˜æ¯”è¼ƒ</p><p>4. å¾ Nand Flash ä¸­æŠŠæ•¸æ“šè®€å…¥åˆ° RAM ä¸­</p><p>int nand_read_whole(unsigned char *buf, unsigned long start_addr, int size)</p><p>{</p><p>int i, j;</p><p>/* å¦‚æœèµ·å§‹åœ°å€å’Œé•·åº¦ä¸æ˜¯ 512 å­—ç¯€(1 é )çš„å€æ•¸, å‰‡è¿”å›éŒ¯èª¤ä»£ç¢¼ */</p><p>if ((start_addr & NAND_BLOCK_MASK) || (size & NAND_BLOCK_MASK)) {</p><p>return Â­1;</p><p>}</p><p>/* æ¿€æ´» Nand Flash */</p><p>NF_nFCE_L();</p><p>for(i=0; i&lt;10; i++);</p><p>i = start_addr;</p><p>while(i &lt; start_addr + size) {</p><p>/* è®€ A å€ */</p><p>rNFCMD = 0;</p><p>/* å¯«å…¥è®€å–åœ°å€ */</p><p>rNFADDR = i & 0xff;</p><p>rNFADDR = (i >> 9) & 0xff;</p><p>rNFADDR = (i >> 17) & 0xff;</p><p>rNFADDR = (i >> 25) & 0xff;</p><p>NF_WAITRB();</p><p>/* è®€å‡ºä¸€é (512 å­—ç¯€) */</p><p>for(j=0; j &lt; NAND_SECTOR_SIZE; j++, i++) {</p><p>*buf = (rNFDATA & 0xff);</p><p>buf++;</p><p>}</p><p>}</p><p>/* åœæ­¢é©…å‹• Nand Flash */</p><p>NF_nFCE_H();</p><p>return 0;</p><p>}5. æ ¡æŸ¥æ¬ç§»å¾Œçš„æ•¸æ“š</p><p>æŠŠ RAM ä¸­çš„å‰ 4K èˆ‡å…§éƒ¨ä¸­å‰ 4K é€²è¡Œæ¯”è¼ƒ, å¦‚æœå®Œå…¨ç›¸åŒ, å‰‡è¡¨ç¤ºæ¬ç§»æˆåŠŸ.</p><p>ok_nand_read:</p><p>mov r0, #0x00000000 @å…§éƒ¨ RAM çš„èµ·å§‹åœ°å€</p><p>ldr r1, =UBOOT_RAM_BASE @UBOOT åœ¨ RAM ä¸­çš„èµ·å§‹åœ°å€</p><p>mov r2, #0x400 @æ¯”è¼ƒ 1024 æ¬¡, æ¯æ¬¡ 4 å­—ç¯€, 4 bytes * 1024 = 4KÂ­bytes</p><p>go_next: @ æ¯”è¼ƒ 1024 æ¬¡, æ¯æ¬¡ 4 å€‹å­—ç¯€</p><p>ldr r3, [r0], #4</p><p>ldr r4, [r1], #4</p><p>teq r3, r4</p><p>bne notmatch</p><p>subs r2, r2, #4</p><p>beq done_nand_read</p><p>bne go_next</p><p>notmatch:</p><p>1:b 1b</p><p>done_nand_read:</p><p>mov pc, r10</p><p><strong>3.2 U-BOOT å° Nand Flash å‘½ä»¤çš„æ”¯æŒ</strong></p><p>åœ¨ UÂ­BOOT ä¸‹å° Nand Flash çš„æ”¯æŒä¸»è¦æ˜¯åœ¨å‘½ä»¤è¡Œä¸‹å¯¦ç¾å° nand flash çš„æ“ä½œã€‚å° nand flash å¯¦ç¾çš„å‘½ä»¤</p><p>ç‚ºï¼šnand infoã€nand deviceã€nand readã€nand writeã€nand ereaseã€nand badã€‚</p><p>ç”¨åˆ°çš„ä¸»è¦æ•¸æ“šçµæ§‹æœ‰ï¼šstruct nand_flash_devã€struct nand_chipã€‚å‰è€…åŒ…æ‹¬ä¸»è¦çš„èŠ¯ç‰‡å‹è™Ÿã€å­˜å„²å®¹é‡ã€</p><p>è¨­å‚™ IDã€I/O ç¸½ç·šå¯¬åº¦ç­‰ä¿¡æ¯ï¼›å¾Œè€…æ˜¯å…·é«”å° nand flash é€²è¡Œæ“ä½œæ™‚ç”¨åˆ°çš„ä¿¡æ¯ã€‚</p><p><strong>3.2.1 ä¸»è¦æ•¸æ“šçµæ§‹ä»‹ç´¹</strong></p><p>1. struct nand_flash_dev æ•¸æ“šçµæ§‹</p><p>è©²æ•¸æ“šçµæ§‹åœ¨ include/linux/mtd/nand.h ä¸­å®šç¾©ï¼Œåœ¨ include/linux/mtd/nand_ids.h ä¸­è³¦åˆå€¼ã€‚</p><p>struct nand_flash_dev {</p><p>char *n<strong>ame;</strong></p><p><strong>/* èŠ¯ç‰‡åç¨± */</strong></p><p>int manufacture_id; /* å» å•† ID */</p><p>int model_id; /* æ¨¡å¼ ID */</p><p>int chipshift; /* Nand Flash åœ°å€ä½æ•¸ */</p><p>char page256; /* è¡¨æ˜æ˜¯å¦æ™‚ 256 å­—ç¯€ä¸€é ã€‚1ï¼šæ˜¯ï¼›0ï¼šå¦ã€‚*/</p><p>char pageadrlen; /* å®Œæˆä¸€æ¬¡åœ°å€å‚³é€éœ€è¦å¾€ NFADDR ä¸­å‚³é€å¹¾æ¬¡ã€‚*/</p><p>unsigned long erasesize; /* ä¸€æ¬¡å¡Šæ“¦é™¤å¯ä»¥æ“¦é™¤å¤šå°‘å­—ç¯€ */</p><p>int bus16; /* åœ°å€ç·šæ˜¯å¦æ˜¯ 16 ä½ï¼Œ1ï¼šæ˜¯ï¼›0ï¼šå¦ */</p><p>};</p><p>2. struct nand_chip æ•¸æ“šçµæ§‹</p><p>è©²æ•¸æ“šçµæ§‹åœ¨ include/linux/mtd/nand.h ä¸­å®šç¾©. è©²çµæ§‹é«”å®šç¾©å‡ºä¸€å€‹ Nand Flash è¨­å‚™æ•¸çµ„:</p><p>struct nand_chip nand_dev_desc[CFG_MAX_NAND_DEVICE];</p><p>è©²æ•¸çµ„åœ¨ nand_probe()ä¸­å°å…¶é€²è¡Œåˆå§‹åŒ–.</p><p>struct nand_chip {</p><p>int</p><p>page_shift; /* Page åœ°å€ä½æ•¸ */</p><p>u_char *data_buf; /* æœ¬æ¬¡è®€å‡ºçš„ä¸€é æ•¸æ“š */</p><p>u_char *data_cache; /* è®€å‡ºçš„ä¸€é æ•¸æ“š */</p><p>int cache_page; /* ä¸Šæ¬¡æ“ä½œçš„é è™Ÿ */u_char ecc_code_buf[6]; /* ECC æ ¡é©—ç¢¼ */</p><p>u_char reserved[2];</p><p>char ChipID;</p><p>/* èŠ¯ç‰‡ ID è™Ÿ */</p><p>struct Nand *chips; /* Nand Flash èŠ¯ç‰‡åˆ—è¡¨, è¡¨ç¤ºæ”¯æŒå¹¾å€‹èŠ¯ç‰‡ç‚ºä¸€å€‹è¨­å‚™*/</p><p>int chipshift;</p><p>char* chips_name; /* Nand Flash èŠ¯ç‰‡åç¨± */</p><p>unsigned long erasesize; /* å¡Šæ“¦å¯«çš„å¤§å° */</p><p>unsigned long mfr; /* å» å•† ID */</p><p>unsigned long id; /* æ¨¡å¼ ID */</p><p>char* name; /* è¨­å‚™åç¨± */</p><p>int numchips; /* æœ‰å¹¾å¡Š Nand Flash èŠ¯ç‰‡ */</p><p>char page256; /* ä¸€é æ˜¯ 256 å­—ç¯€, é‚„æ˜¯ 512 å­—ç¯€ */</p><p>char pageadrlen; /* é åœ°å€çš„é•·åº¦ */</p><p>unsigned long IO_ADDR; /* ç”¨æ–¼å° nand flash é€²è¡Œå°‹å€çš„åœ°å€å€¼å­˜æ”¾è™• */</p><p>unsigned long totlen; /* Nand Flash ç¸½å…±å¤§å° */</p><p>uint oobblock; /* ä¸€é çš„å¤§å°ã€‚æœ¬æ¬¾ nand flash ç‚º 512 */</p><p>uint oobsize;</p><p>/* spare array å¤§å°ã€‚æœ¬æ¬¾ nand flash ç‚º 16 */</p><p>uint eccsize; /* ECC å¤§å° */</p><p>int bus16; /* åœ°å€ç·šæ˜¯å¦æ˜¯ 16 ä½ï¼Œ1ï¼šæ˜¯ï¼›0ï¼šå¦ */</p><p>};</p><p><strong>3.2.2 æ”¯æŒçš„å‘½ä»¤å‡½æ•¸èªªæ˜</strong></p><p>1. nand info/nand device</p><p>åŠŸèƒ½ï¼šé¡¯ç¤ºç•¶å‰ nand flash èŠ¯ç‰‡ä¿¡æ¯ã€‚</p><p>å‡½æ•¸èª¿ç”¨é—œä¿‚å¦‚ä¸‹(æŒ‰å…ˆå¾Œé †åº)ï¼š</p><p>static void nand_print(struct nand_chip *nand) ;</p><p>2. nand erase</p><p>åŠŸèƒ½ï¼šæ“¦é™¤æŒ‡å®šå¡Šä¸Šçš„æ•¸æ“šã€‚</p><p>å‡½æ•¸èª¿ç”¨é—œä¿‚å¦‚ä¸‹(æŒ‰å…ˆå¾Œé †åº)ï¼š</p><p>int nand_erase(struct nand_chip* nand, size_t ofs, size_t len, int clean);</p><p>3. nand bad</p><p>åŠŸèƒ½ï¼šé¡¯ç¤ºå£å¡Šã€‚</p><p>å‡½æ•¸èª¿ç”¨é—œä¿‚å¦‚ä¸‹(æŒ‰å…ˆå¾Œé †åº)ï¼š</p><p>static void nand_print_bad(struct nand_chip* nand);</p><p>int check_block (struct nand_chip *nand, unsigned long pos);</p><p>4. nand read</p><p>åŠŸèƒ½ï¼šè®€å– nand flash ä¿¡æ¯åˆ° SDRAMã€‚</p><p>å‡½æ•¸èª¿ç”¨é—œä¿‚å¦‚ä¸‹(æŒ‰å…ˆå¾Œé †åº)ï¼š</p><p>int nand_rw (struct nand_chip* nand, int cmd,size_t start, size_t len, size_t * retlen, u_char * buf);</p><p>static int nand_read_ecc(struct nand_chip *nand, size_t start, size_t len,</p><p>size_t * retlen, u_char *buf, u_char *ecc_code);</p><p>static void NanD_ReadBuf (struct nand_chip *nand, u_char * data_buf, int cntr);</p><p>READ_NAND(adr);</p><p>5. nand write</p><p>åŠŸèƒ½ï¼šå¾ SDRAM å¯«æ•¸æ“šåˆ° nand flash ä¸­ã€‚</p><p>å‡½æ•¸èª¿ç”¨é—œä¿‚å¦‚ä¸‹(æŒ‰å…ˆå¾Œé †åº)ï¼šint nand_rw (struct nand_chip* nand, int cmd,size_t start, size_t len, size_t * retlen, u_char * buf);</p><p>static int nand_write_ecc (struct nand_chip* nand, size_t to, size_t len,</p><p>size_t * retlen, const u_char * buf, u_char * ecc_code);</p><p>static int nand_write_page (struct nand_chip *nand, int page, int col, int last, u_char * ecc_code);</p><p>WRITE_NAND(d , adr);</p><p><strong>3.2.3 U-BOOT æ”¯æŒ Nand Flash å‘½ä»¤ç§»æ¤èªªæ˜</strong></p><p>1. è¨­ç½®é…ç½®é¸é …</p><p>åœ¨ CONFIG_COMMANDS ä¸­, æ‰“é–‹ CFG_CMD_NAND é¸é ….</p><p>#define CONFIG_COMMANDS \</p><p>(CONFIG_CMD_DFL</p><p>| \</p><p>CFG_CMD_CACHE</p><p>| \</p><p>CFG_CMD_NAND</p><p>| \</p><p>/*CFG_CMD_EEPROM |*/ \</p><p>/*CFG_CMD_I2C</p><p>|*/ \</p><p>/*CFG_CMD_USB</p><p>|*/ \</p><p>CFG_CMD_PING | \</p><p>CFG_CMD_REGINFO | \</p><p>CFG_CMD_DATE</p><p>| \</p><p>CFG_CMD_ELF)</p><p>#if (CONFIG_COMMANDS & CFG_CMD_NAND)</p><p>#define CFG_NAND_BASE 0x4E000000 /* Nand Flash æ§åˆ¶å™¨åœ¨ SFR å€ä¸­èµ·å§‹å¯„å­˜å™¨åœ°å€ */</p><p>#define CFG_MAX_NAND_DEVICE 1 /* æ”¯æŒçš„æœ€åœ¨ Nand Flash æ•¸æ“š */</p><p>#define SECTORSIZE 512 /* 1 é çš„å¤§å° */</p><p>#define NAND_SECTOR_SIZE SECTORSIZE</p><p>#define NAND_BLOCK_MASK (NAND_SECTOR_SIZE â€“ 1) /* é æ©ç¢¼ */</p><p>#define ADDR_COLUMN 1 /* ä¸€å€‹å­—ç¯€çš„ Column åœ°å€ */</p><p>#define ADDR_PAGE 3 /* 3 å­—ç¯€çš„é å¡Šåœ°å€, A9Â­A25*/</p><p>#define ADDR_COLUMN_PAGE 4 /* ç¸½å…± 4 å­—ç¯€çš„é å¡Šåœ°å€ */</p><p>#define NAND_ChipID_UNKNOWN 0x00 /* æœªçŸ¥èŠ¯ç‰‡çš„ ID è™Ÿ */</p><p>#define NAND_MAX_FLOORS 1</p><p>#define NAND_MAX_CHIPS 1</p><p>/* Nand Flash å‘½ä»¤å±¤åº•å±¤æ¥å£å‡½æ•¸ */</p><p>#define WRITE_NAND_COMMAND(d, adr) do {rNFCMD = d;} while(0)</p><p>#define WRITE_NAND_ADDRESS(d, adr) do {rNFADDR = d;} while(0)</p><p>#define WRITE_NAND(d, adr) do {rNFDATA = d;} while(0)</p><p>#define READ_NAND(adr) (rNFDATA)</p><p>#define NAND_WAIT_READY(nand) {while(!(rNFSTAT&(1&lt;&lt;0)));}</p><p>#define NAND_DISABLE_CE(nand) {rNFCONF |= (1&lt;&lt;11);}</p><p>#define NAND_ENABLE_CE(nand) {rNFCONF &= ~(1&lt;&lt;11);}</p><p>/* ä¸‹é¢ä¸€çµ„æ“ä½œå° Nand Flash ç„¡æ•ˆ */</p><p>#define NAND_CTL_CLRALE(nandptr)</p><p>#define NAND_CTL_SETALE(nandptr)</p><p>#define NAND_CTL_CLRCLE(nandptr)</p><p>#define NAND_CTL_SETCLE(nandptr)/* å…è¨± Nand Flash å¯«æ ¡é©— */</p><p>#define CONFIG_MTD_NAND_VERIFY_WRITE 1</p><p>#endif /* CONFIG_COMMANDS & CFG_CMD_NAND*/</p><p>2. åŠ å…¥è‡ªå·±çš„ Nand Flash èŠ¯ç‰‡å‹è™Ÿ</p><p>åœ¨ include/linux/mtd/ nand_ids.h ä¸­çš„å°å¦‚ä¸‹çµæ§‹é«”è³¦å€¼é€²è¡Œä¿®æ”¹:</p><p>static struct nand_flash_dev nand_flash_ids[] = {</p><p>......</p><p>{"Samsung K9F1208U0B", NAND_MFR_SAMSUNG, 0x76, 26, 0, 4, 0x4000, 0},</p><p>.......</p><p>}</p><p>é€™æ¨£å°æ–¼è©²æ¬¾ Nand Flash èŠ¯ç‰‡çš„æ“ä½œæ‰èƒ½æ­£ç¢ºåŸ·è¡Œã€‚</p><p>3. ç·¨å¯«è‡ªå·±çš„ Nand Flash åˆå§‹åŒ–å‡½æ•¸</p><p>åœ¨ board/crane2410/crane2410.c ä¸­åŠ å…¥ nand_init()å‡½æ•¸.</p><p>void nand_init(void)</p><p>{</p><p>/* åˆå§‹åŒ– Nand Flash æ§åˆ¶å™¨, ä»¥åŠ Nand Flash èŠ¯ç‰‡ */</p><p>nand_reset();</p><p>/* èª¿ç”¨ nand_probe()ä¾†æª¢æ¸¬èŠ¯ç‰‡é¡å‹ */</p><p>printf ("%4lu MB\n", nand_probe(CFG_NAND_BASE) >> 20);</p><p>}</p><p>è©²å‡½æ•¸åœ¨å•Ÿå‹•æ™‚è¢« start_armboot()èª¿ç”¨.</p><p><strong>4 åœ¨ Linux å° Nand Flash çš„æ”¯æŒ</strong></p><p><strong>4.1 Linux ä¸‹ Nand Flash èª¿ç”¨é—œä¿‚</strong></p><p><strong>4.1.1 Nand Flash è¨­å‚™æ·»åŠ æ™‚æ•¸æ“šçµæ§‹åŒ…å«é—œä¿‚</strong></p><p>struct mtd_partition <strong>partition_info[]</strong></p><p>--> struct s3c2410_nand_<strong>set nandset</strong></p><p>--> struct s3c2410_platform_nand <strong>superlpplatfrom</strong></p><p>--> struct platform_device <strong>s3c_device_nand</strong></p><p><strong>åœ¨è©²æ•¸æ“šçµæ§‹çš„ nameå­—æ®µçš„åˆå§‹åŒ–å€¼"s3c2410-nand",å¿…é ˆèˆ‡ Nand Flashè¨­å‚™é©…å‹•è¨»å†Šæ™‚</strong></p><p><strong>struct device_driverçµæ§‹ä¸­çš„ nameå­—æ®µç›¸åŒ,å› ç‚º platfrom bus æ˜¯ä¾é åå­—ä¾†åŒ¹é…çš„.</strong></p><p><strong>-</strong>-> struct platform_device <strong>*smdk2410_devices[]</strong></p><p><strong>4.1.2 Nand Flash è¨­å‚™è¨»å†Šæ™‚æ•¸æ“šçµæ§‹åŒ…å«é—œä¿‚</strong></p><p>struct device_driver s3c2410_nand_driver</p><p>-->struct device *dev</p><p>è©²æ•¸æ“šæ§‹ç”±ç³»çµ±åˆ†é….</p><p>-->struct platform_device *pdev</p><p>-->struct s3c2410_platform_nand *plat</p><p>-->struct s3c2410_nand_set nset</p><p>-->struct mtd_partition</p><p><strong>4.1.3 ç•¶ç™¼ç”Ÿç³»çµ±èª¿ç”¨æ™‚æ•¸æ“šçµæ§‹èª¿ç”¨é—œä¿‚</strong></p><p>struct mtd_infoå®ƒçš„*privæŒ‡å‘ chip</p><p>-->struct nand_chip</p><p>å®ƒçš„*privæŒ‡å‘ nmtd</p><p>-->struct s3c2410_nand_mtd</p><p>å®ƒæ˜¯ s3c2410_nand_info çš„ä¸€å€‹å­—æ®µ</p><p>-->s3c2410_nand_info</p><p>å®ƒè¢«è¨­ç‚º Nand Flashè¨­å‚™é©…å‹•çš„ç§æœ‰æ•¸æ“šçµæ§‹,åœ¨ Nand Flashè¨­å‚™é©…å‹•è¨»å†Šæ™‚åˆ†é…ç©ºé–“.</p><p>-->struct device</p><p><strong>4.2 Linux ä¸‹ Nand Flash é©…å‹•ä¸»è¦æ•¸æ“šçµæ§‹èªªæ˜</strong></p><p><strong>4.2.1 s3c2410 å°ˆæœ‰æ•¸æ“šçµæ§‹</strong></p><p>1. s3c2410_nand_set</p><p>struct s3c2410_nand_set {</p><p>int nr_chips; /* èŠ¯ç‰‡çš„æ•¸ç›® */</p><p>int nr_partitions; /* åˆ†å€çš„æ•¸ç›® */</p><p>char *name; /* é›†åˆåç¨± */</p><p>int <strong>nr_map; /* å¯é¸, åº•å±¤é‚è¼¯åˆ°ç‰©ç†çš„èŠ¯ç‰‡æ•¸ç›® */</strong></p><p>struct mtd_partition <strong>partitions; /* åˆ†å€åˆ—è¡¨ */</strong></p><p>};</p><p>2. s3c2410_platform_and</p><p>struct s3c2410_platform_nand {</p><p>/* timing information for controller, all times in nanoseconds */</p><p>int tacls; /* å¾ CLE/ALEæœ‰æ•ˆåˆ° nWE/nOE çš„æ™‚é–“ */</p><p>int twrph0; /* nWE/nOE çš„æœ‰æ•ˆæ™‚é–“ */</p><p>int twrph1; /* å¾é‡‹æ”¾ CLE/ALEåˆ° nWE/nOE ä¸æ´»å‹•çš„æ™‚é–“ */</p><p>int nr_sets; /* é›†åˆæ•¸ç›® */</p><p>struct s3c2410_nand_set <strong>sets; /* é›†åˆåˆ—è¡¨ */</strong></p><p><strong>/* æ ¹æ“šèŠ¯ç‰‡ç·¨è™Ÿé¸æ“‡æœ‰æ•ˆé›†åˆ */</strong></p><p>void (*select_chip)(struct s3c2410_nand_set <strong>, int chip);</strong></p><p>};</p><p>3. s3c2410_nand_mtd</p><p>åœ¨ drivers/mtd/nand/s3c2410.c ä¸­,</p><p>struct s3c2410_nand_mtd {</p><p>struct mtd_info mtd; /* MTD ä¿¡æ¯ */</p><p>struct nand_chip chip; /* nand flash èŠ¯ç‰‡ä¿¡æ¯ */</p><p>struct s3c2410_nand_set <strong>set; /*</strong> nand flash é›†åˆ */</p><p>struct s3c2410_nand_info *info; /* nand flash ä¿¡æ¯ */</p><p>int scan_res;</p><p>};</p><p>4. s3c2410_nand_info</p><p>struct s3c2410_nand_info {</p><p>/* mtd info */</p><p>struct nand_hw_control controller; /* ç¡¬ä»¶æ§åˆ¶å™¨ */</p><p>struct s3c2410_nand_mtd *mtds; /* MTD è¨­å‚™è¡¨ */</p><p>struct s3c2410_platform_nand <strong>platform; /* Nand è¨­å‚™çš„å¹³è‡º */</strong> /* device info */</p><p>struct device *device; /* è¨­å‚™æŒ‡é‡ */</p><p>struct resource *area; /* è³‡æºæŒ‡é‡ */</p><p>struct clk *clk; /* Nand Flash æ™‚é˜ */</p><p>void __iomem *regs; /* å¯„å­˜å™¨åŸºåœ°å€(mapå¾Œçš„é‚è¼¯åœ°å€) */</p><p>int mtd_count; /* MTDçš„æ•¸ç›® */</p><p>unsigned char is_s3c2440;</p><p>};</p><p>5. struct clk</p><p>åœ¨ arch/arm/machÂ­s3c2410/clock.h ä¸­</p><p>struct clk {</p><p>struct list_head list; /* clock åˆ—è¡¨çµé» */</p><p>struct module *owner; /* æ‰€å±¬æ¨¡å¡Š */</p><p>struct clk *parent; /* çˆ¶çµé» */</p><p>const char *name; /* åç¨± */</p><p>int id; /* ç·¨è™Ÿ */</p><p>atomic_t used; /* ä½¿ç”¨è€…è¨ˆæ•¸ */</p><p>unsigned long rate; /* æ™‚é˜é€Ÿç‡ */</p><p>unsigned long ctrlbit; /* æ§åˆ¶ä½ */</p><p>int (*enable)(struct clk *, int enable); /* Clock æ‰“é–‹æ–¹æ³• */</p><p>};</p><p><strong>4.2.2 Linux é€šç”¨æ•¸æ“šçµæ§‹èªªæ˜</strong></p><p>1. device_driver</p><p>include/linux/device.h</p><p>struct device_driver {</p><p>const char * name; <strong>/* é©…å‹•åç¨± */</strong></p><p>struct bus_type * bus; /* ç¸½ç·šé¡å‹ */</p><p>struct completion unloaded; /* å¸è¼‰äº‹ä»¶é€šçŸ¥æ©Ÿåˆ¶ */</p><p>struct kobject kobj; /* sysä¸­çš„å°è±¡ */</p><p>struct klist klist_devices; /* è¨­å‚™åˆ—è¡¨ */</p><p>struct klist_node knode_bus; /* ç¸½ç·šçµé»åˆ—è¡¨ */</p><p>struct module * owner;/* æ‰€æœ‰è€… */</p><p>/* è¨­å‚™é©…å‹•é€šç”¨æ–¹æ³• */</p><p>int (*probe) (struct device * dev); /* æ¢æ¸¬è¨­å‚™ */</p><p>int (*remove) (struct device * dev); /* ç§»é™¤è¨­å‚™ */</p><p>void (*shutdown) (struct device * dev); /* é—œé–‰è¨­å‚™ */</p><p>/* æ›èµ·è¨­å‚™ */</p><p>int (*suspend) (struct device * dev, pm_message_t state, u32 level);</p><p>int (*resume) (struct device * dev, u32 level); /* æ¢å¾© */</p><p>};</p><p>2. platform_device</p><p>include/linux/device.h</p><p>struct platform_device {</p><p>const char * name; /* åç¨± */</p><p>u32 id; /* è¨­å‚™ç·¨è™Ÿ, -1è¡¨ç¤ºä¸æ”¯æŒåŒé¡å¤šå€‹è¨­å‚™ */</p><p>struct device dev; /* è¨­å‚™ */</p><p>u32 num_resources; /* è³‡æºæ•¸ */</p><p>struct resource * resource; /* è³‡æºåˆ—è¡¨ */};</p><p>3. resource</p><p>struct resource {</p><p>const char <strong>name; /* è³‡æºåç¨± */</strong></p><p>unsigned long start, end; /* é–‹å§‹ä½ç½®å’ŒçµæŸä½ç½® */</p><p>unsigned long flags; /* è³‡æºé¡å‹ */</p><p>/* è³‡æºåœ¨è³‡æºæ¨¹ä¸­çš„çˆ¶è¦ª,å…„å¼Ÿå’Œå­©å­ */</p><p>struct resource *parent, *sibling, *child;</p><p>};</p><p>4. device</p><p>include/linux/device.h</p><p>struct device {</p><p>struct klist klist_children; /* åœ¨è¨­å‚™åˆ—è¡¨ä¸­çš„å­©å­åˆ—è¡¨ */</p><p>struct klist_node knode_parent; /* å…„å¼Ÿçµé» */</p><p>struct klist_node knode_driver; /* é©…å‹•çµé» */</p><p>struct klist_node knode_bus; /* ç¸½ç·šçµé» */</p><p>struct device <strong>parent; /* çˆ¶è¦ª */</strong></p><p>struct kobject kobj; /* sysçµé» */</p><p>char bus_id[BUS_ID_SIZE];</p><p>struct semaphore sem; /* åŒæ­¥é©…å‹•çš„ä¿¡è™Ÿé‡ */</p><p>struct bus_type * bus; /* ç¸½ç·šé¡å‹ */</p><p>struct device_driver *driver; /* è¨­å‚™é©…å‹• */</p><p>void *driver_data; /* é©…å‹•çš„ç§æœ‰æ•¸æ“š */</p><p>void *platform_data; /* å¹³è‡ºæŒ‡å®šçš„æ•¸æ“š,ç‚º deviceæ ¸å¿ƒé©…å‹•ä¿ç•™ */</p><p>void *firmware_data; /* å›ºä»¶æŒ‡å®šçš„æ•¸æ“š,ç‚º deviceæ ¸å¿ƒé©…å‹•ä¿ç•™ */</p><p>struct dev_pm_info power; /* è¨­å‚™é›»æºç®¡ç†ä¿¡æ¯ */</p><p>u64 *dma_mask; /* DMAæ©ç¢¼ */</p><p>u64 coherent_dma_mask;</p><p>struct list_head dma_pools; /* DMAç·©è¡æ±  */</p><p>struct dma_coherent_mem *dma_mem; /* é€£çºŒ DMA å…§å­˜çš„èµ·å§‹ä½ç½® */</p><p>void (*release)(struct device * dev); /* é‡‹æ”¾è¨­ç½®æ–¹æ³• */</p><p>};</p><p>5. nand_hw_control</p><p>include/linux/mtd/nand.h</p><p>struct nand_hw_control {</p><p>spinlock_t lock; /* è‡ªæ—‹é–,ç”¨æ–¼ç¡¬ä»¶æ§åˆ¶ */</p><p>struct nand_chip *active; /* æ­£åœ¨è™•ç† MTD è¨­å‚™ */</p><p>wait_queue_head_t wq; /* ç­‰å¾…éšŠåˆ— */</p><p>};</p><p>6. nand_chip</p><p>include/linux/mtd/nand.h</p><p>struct nand_chip {</p><p>void __iomem *IO_ADDR_R; /* è®€åœ°å€ */</p><p>void __iomem *IO_ADDR_W; /* å¯«åœ°å€ */ /* å­—ç¯€æ“ä½œ */</p><p>u_char (*read_byte)(struct mtd_info *mtd); /* è®€ä¸€å€‹å­—ç¯€ */</p><p>void (*write_byte)(struct mtd_info *mtd, u_char byte); /* å¯«ä¸€å€‹å­—ç¯€ */</p><p>/* é›™å­—ç¯€æ“ä½œ */</p><p>u16 (*read_word)(struct mtd_info <strong>mtd); /* è®€ä¸€å€‹å­— */</strong></p><p>void (*write_word)(struct mtd_info *mtd, u16 word); /* å¯«ä¸€å€‹å­— */</p><p>/* bufferæ“ä½œ */</p><p>void (*write_buf)(struct mtd_info *mtd, const u_char *buf, int len);</p><p>void (*read_buf)(struct mtd_info *mtd, u_char *buf, int len);</p><p>int (*verify_buf)(struct mtd_info *mtd, const u_char *buf, int len);</p><p>/* é¸æ“‡ä¸€å€‹æ“ä½œèŠ¯ç‰‡ */</p><p>void (*select_chip)(struct mtd_info *mtd, int chip);</p><p>/* å£å¡Šæª¢æŸ¥æ“ä½œ */</p><p>int (*block_bad)(struct mtd_info *mtd, loff_t ofs, int getchip);</p><p>/* å£å¡Šæ¨™è¨˜æ“ä½œ */</p><p>int (*block_markbad)(struct mtd_info *mtd, loff_t ofs);</p><p>/* ç¡¬ä»¶æ§åˆ¶æ“ä½œ */</p><p>void (*hwcontrol)(struct mtd_info *mtd, int cmd);</p><p>/* è¨­å‚™æº–å‚™æ“ä½œ */</p><p>int (*dev_ready)(struct mtd_info *mtd);</p><p>/* å‘½ä»¤ç™¼é€æ“ä½œ */</p><p>void (*cmdfunc)(struct mtd_info *mtd, unsigned command, int column, int</p><p>page_addr);</p><p>/* ç­‰å¾…å‘½ä»¤å®Œæˆ */</p><p>int (*waitfunc)(struct mtd_info *mtd, struct nand_chip *this, int state);</p><p>/* è¨ˆç®— ECC ç¢¼æ“ä½œ */</p><p>int (*calculate_ecc)(struct mtd_info *mtd, const u_char *dat, u_char</p><p>*ecc_code);</p><p>/* æ•¸æ“šç³¾éŒ¯æ“ä½œ */</p><p>int (*correct_data)(struct mtd_info *mtd, u_char *dat, u_char *read_ecc,</p><p>u_char *calc_ecc);</p><p>/* é–‹å•Ÿç¡¬ä»¶ ECC */</p><p>void (*enable_hwecc)(struct mtd_info *mtd, int mode);</p><p>/* æ“¦é™¤æ“ä½œ */</p><p>void (*erase_cmd)(struct mtd_info *mtd, int page);</p><p>/* æª¢æŸ¥å£å¡Šè¡¨ */</p><p>int (*scan_bbt)(struct mtd_info *mtd);</p><p>int eccmode; /* ECC æ¨¡å¼ */</p><p>int eccsize; /* ECC è¨ˆç®—æ™‚ä½¿ç”¨çš„å­—ç¯€æ•¸ */</p><p>int eccbytes; /* ECC ç¢¼çš„å­—ç¯€æ•¸ */</p><p>int eccsteps; /* ECC ç¢¼è¨ˆç®—çš„æ­¥é©Ÿæ•¸ */</p><p>int chip_delay; /* èŠ¯ç‰‡çš„å»¶é²æ™‚é–“ */</p><p>spinlock_t chip_lock; /* èŠ¯ç‰‡è¨ªå•çš„è‡ªæ—‹é– */</p><p>wait_queue_head_t wq; /* èŠ¯ç‰‡è¨ªå•çš„ç­‰å¾…éšŠåˆ— */</p><p>nand_state_t state; /* Nand Flashç‹€æ…‹ */</p><p>int page_shift; /* é å³ç§»çš„ä½æ•¸,å³ columnåœ°å€ä½æ•¸ */</p><p>int phys_erase_shift; /* å¡Šå³ç§»çš„ä½æ•¸, å³ columnå’Œé ä¸€å…±çš„åœ°å€ä½æ•¸ */</p><p>int bbt_erase_shift; /* å£å¡Šé è¡¨çš„ä½æ•¸ */</p><p>int chip_shift; /* è©²èŠ¯ç‰‡ç¸½å…±çš„åœ°å€ä½æ•¸ */</p><p>u_char *data_buf; /* æ•¸æ“šç·©è¡å€ */</p><p>u_char *oob_buf; /* oob ç·©è¡å€ */</p><p>int oobdirty; /* oob ç·©è¡å€æ˜¯å¦éœ€è¦é‡æ–°åˆå§‹åŒ– */</p><p>u_char *data_poi; /* æ•¸æ“šç·©è¡å€æŒ‡é‡ */</p><p>unsigned int options; /* èŠ¯ç‰‡å°ˆæœ‰é¸é … */</p><p>int badblockpos;/* å£å¡Šæ¨™ç¤ºå­—ç¯€åœ¨ OOB ä¸­çš„ä½ç½® */</p><p>int numchips; /* èŠ¯ç‰‡çš„å€‹æ•¸ */ unsigned long chipsize; /* åœ¨å¤šå€‹èŠ¯ç‰‡çµ„ä¸­, ä¸€å€‹èŠ¯ç‰‡çš„å¤§å° */</p><p>int pagemask; /* æ¯å€‹èŠ¯ç‰‡é æ•¸çš„å±è”½å­—, é€šéå®ƒå–å‡ºæ¯å€‹èŠ¯ç‰‡åŒ…å«å¤šå°‘å€‹é  */</p><p>int pagebuf; /* åœ¨é ç·©è¡å€ä¸­çš„é è™Ÿ */</p><p>struct nand_oobinfo *autooob; /* oob ä¿¡æ¯ */</p><p>uint8_t *bbt; /* å£å¡Šé è¡¨ */</p><p>struct nand_bbt_descr *bbt_td; /* å£å¡Šè¡¨æè¿° */</p><p>struct nand_bbt_descr *bbt_md; /* å£å¡Šè¡¨é¡åƒæè¿° */</p><p>struct nand_bbt_descr *badblock_pattern; /* å£å¡Šæª¢æ¸¬æ¨¡æ¿ */</p><p>struct nand_hw_control *controller; /* ç¡¬ä»¶æ§åˆ¶ */</p><p>void *priv; /* ç§æœ‰æ•¸æ“šçµæ§‹ */</p><p>/* é€²è¡Œé™„åŠ éŒ¯èª¤æª¢æŸ¥ */</p><p>int (*errstat)(struct mtd_info *mtd, struct nand_chip *this, int state, int</p><p>status, int page);</p><p>};</p><p>7. mtd_info</p><p>include/linux/mtd/mtd.h</p><p>struct mtd_info {</p><p>u_char type; /* è¨­å‚™é¡å‹ */</p><p>u_int32_t flags; /* è¨­å‚™æ¨™èªŒä½çµ„ */</p><p>u_int32_t size; /* ç¸½å…±è¨­å‚™çš„å¤§å° */</p><p>u_int32_t erasesize; /* æ“¦é™¤å¡Šçš„å¤§å° */</p><p>u_int32_t oobblock; /* OOBå¡Šçš„å¤§å°,å¦‚ï¼š512 å€‹å­—ç¯€æœ‰ä¸€å€‹ OOB */</p><p>u_int32_t oobsize; /* OOBæ•¸æ“šçš„å¤§å°,å¦‚:ä¸€å€‹ OOB å¡Šæœ‰ 16 å€‹å­—ç¯€ */</p><p>u_int32_t ecctype; /* ECC æ ¡é©—çš„é¡å‹ */</p><p>u_int32_t eccsize; /* ECC ç¢¼çš„å¤§å° */</p><p>char *name; /* è¨­å‚™åç¨± */</p><p>int index; /* è¨­å‚™ç·¨è™Ÿ */</p><p>/* oobinfo ä¿¡æ¯,å®ƒå¯ä»¥é€šé MEMSETOOBINFO ioctl å‘½ä»¤ä¾†è¨­ç½® */</p><p>struct nand_oobinfo oobinfo;</p><p>u_int32_t oobavail; /* OOBå€çš„æœ‰æ•ˆå­—ç¯€æ•¸,ç‚ºæ–‡ä»¶ç³»çµ±æä¾› */</p><p>/* æ•¸æ“šæ“¦é™¤é‚Šç•Œä¿¡æ¯ */</p><p>int numeraseregions;</p><p>struct mtd_erase_region_info *eraseregions;</p><p>u_int32_t bank_size; /* ä¿ç•™ */</p><p>/* æ“¦é™¤æ“ä½œ */</p><p>int (*erase) (struct mtd_info *mtd, struct erase_info *instr);</p><p>/* æŒ‡å‘æŸå€‹åŸ·è¡Œä»£ç¢¼ä½ç½® */</p><p>int (*point) (struct mtd_info *mtd, loff_t from,</p><p>size_t len, size_t *retlen, u_char **mtdbuf);</p><p>/* å–æ¶ˆæŒ‡å‘ */</p><p>void (*unpoint) (struct mtd_info *mtd, u_char * addr, loff_t from, size_t len);</p><p>/* è®€/å¯«æ“ä½œ */</p><p>int (*read) (struct mtd_info *mtd, loff_t from, size_t len, size_t *retlen, u_char *buf);</p><p>int (*write) (struct mtd_info *mtd, loff_t to, size_t len,</p><p>size_t *retlen, const u_char *buf);</p><p>/* å¸¶ ECC ç¢¼çš„è®€/å¯«æ“ä½œ */</p><p>int (*read_ecc) (struct mtd_info *mtd, loff_t from, size_t len, size_t *retlen,</p><p>u_char *buf, u_char *eccbuf, struct nand_oobinfo *oobsel);</p><p>int (*write_ecc) (struct mtd_info *mtd, loff_t to, size_t len, size_t *retlen,</p><p>const u_char *buf, u_char *eccbuf, struct nand_oobinfo *oobsel); /* å¸¶ OOB ç¢¼çš„è®€/å¯«æ“ä½œ */</p><p>int (*read_oob) (struct mtd_info *mtd, loff_t from, size_t len, size_t *retlen,</p><p>u_char *buf);</p><p>int (*write_oob) (struct mtd_info *mtd, loff_t to, size_t len, size_t *retlen,</p><p>const u_char *buf);</p><p>/* æä¾›è¨ªå•ä¿è­·å¯„å­˜å™¨å€çš„æ–¹æ³• */</p><p>int (*get_fact_prot_info) (struct mtd_info *mtd, struct otp_info *buf, size_t len);</p><p>int (*read_fact_prot_reg) (struct mtd_info *mtd, loff_t from, size_t len,</p><p>size_t *retlen, u_char *buf);</p><p>int (*get_user_prot_info) (struct mtd_info *mtd, struct otp_info *buf, size_t len);</p><p>int (*read_user_prot_reg) (struct mtd_info *mtd, loff_t from, size_t len,</p><p>size_t *retlen, u_char *buf);</p><p>int (*write_user_prot_reg) (struct mtd_info *mtd, loff_t from, size_t len,</p><p>size_t *retlen, u_char *buf);</p><p>int (*lock_user_prot_reg) (struct mtd_info *mtd, loff_t from, size_t len);</p><p>/* æä¾› readvå’Œ writev æ–¹æ³• */</p><p>int (*readv) (struct mtd_info *mtd, struct kvec *vecs, unsigned long count,</p><p>loff_t from, size_t *retlen);</p><p>int (*readv_ecc) (struct mtd_info *mtd, struct kvec *vecs, unsigned long count,</p><p>loff_t from, size_t *retlen, u_char *eccbuf,</p><p>struct nand_oobinfo *oobsel);</p><p>int (*writev) (struct mtd_info *mtd, const struct kvec *vecs,</p><p>unsigned long count, loff_t to, size_t *retlen);</p><p>int (*writev_ecc) (struct mtd_info *mtd, const struct kvec *vecs,</p><p>unsigned long count, loff_t to, size_t *retlen,</p><p>u_char *eccbuf, struct nand_oobinfo *oobsel);</p><p>/* åŒæ­¥æ“ä½œ */</p><p>void (*sync) (struct mtd_info *mtd);</p><p>/* èŠ¯ç‰‡ç´šæ”¯æŒçš„åŠ /è§£é–æ“ä½œ */</p><p>int (*lock) (struct mtd_info *mtd, loff_t ofs, size_t len);</p><p>int (*unlock) (struct mtd_info *mtd, loff_t ofs, size_t len);</p><p>/* é›»æºç®¡ç†æ“ä½œ */</p><p>int (*suspend) (struct mtd_info *mtd);</p><p>void (*resume) (struct mtd_info *mtd);</p><p>/* å£å¡Šç®¡ç†æ“ä½œ */</p><p>int (*block_isbad) (struct mtd_info *mtd, loff_t ofs);</p><p>int (*block_markbad) (struct mtd_info *mtd, loff_t ofs);</p><p>/* é‡å•Ÿå‰çš„é€šçŸ¥äº‹ä»¶ */</p><p>struct notifier_block reboot_notifier;</p><p>void *priv; /* ç§æœ‰æ•¸æ“šçµæ§‹ */</p><p>struct module *owner; /* æ¨¡å¡Šæ‰€æœ‰è€… */</p><p>int usecount; /* ä½¿ç”¨æ¬¡æ•¸ */</p><p>};</p><p><strong>4.3 Linux ä¸‹ Nand Flash é©…å‹•èªªæ˜4.3.1 è¨»å†Š driver_register</strong></p><p>é€šé module_init(s3c2410_nand_init);è¨»å†Š Nand Flash é©…å‹•. åœ¨ s3c2410_nand_init ()ä¸­é€šé driver_register()è¨»å†Š</p><p>s3c2410_nand_driveré©…å‹•ç¨‹åº,å¦‚ä¸‹æ‰€ç¤º:</p><p>static struct device_driver s3c2410_nand_driver = {</p><p>.name = "s3c2410-nand",</p><p>.bus = &platform_bus_type, /* åœ¨ drivers/base/platform.cä¸­å®šç¾© */</p><p>.probe = s3c2410_nand_probe,</p><p>.remove = s3c2410_nand_remove,</p><p>};</p><p><strong>4.3.2 æ¢æ¸¬è¨­å‚™ probe</strong></p><p>åœ¨è¨»å†Šçš„ Nand Flashé©…å‹•ç¨‹åºä¸­, probe æ–¹æ³•ç‚º s3c2410_nand_probe(). s3c2410_nand_probe()å†èª¿ç”¨</p><p>s3c24xx_nand_probe(). åœ¨è©²å‡½æ•¸ä¸­, æŠŠ*info ä½œç‚º Nand Flash é©…å‹•çš„ç§æœ‰æ•¸æ“šçµæ§‹, ä¸¦é€šé dev_set_drvdata(dev,</p><p>info)æŠŠ*info ä¿å­˜åœ¨*device çš„*driver_data å­—æ®µä¸­.ç„¶å¾Œé€šé clk_get(dev, "nand")ç²å– Nand Flashçš„æ™‚é˜è³‡</p><p>æº, clk_use(info->clk)å¢åŠ æ™‚é˜è³‡æºçš„ä½¿ç”¨è¨ˆæ•¸, clk_enable(info->clk)é–‹å•Ÿè³‡æº.å¡«å¯«*info çš„å…¶å®ƒå­—æ®µ,</p><p>å…¶ä¸­åŒ…æ‹¬:</p><p>1. é€šé request_mem_region()ç‚º Nand Flash å¯„å­˜å™¨å€ç”³è«‹ I/O å…§å­˜åœ°å€ç©ºé–“å€,ä¸¦é€šé ioremap()æŠŠå®ƒæ˜ å°„åˆ°è™›</p><p>æ“¬åœ°å€ç©ºé–“.</p><p>2. èª¿ç”¨ s3c2410_nand_inithw()åˆå§‹åŒ– Nand Flash æ§åˆ¶å™¨.</p><p>3. ç‚º mtd è¨­å‚™åˆ†é…è¨­å‚™ä¿¡æ¯çš„å­˜å„²ç©ºé–“.</p><p>4. å°ç•¶å‰ mtd è¨­å‚™,èª¿ç”¨ s3c2410_nand_init_chip()é€²è¡Œåˆå§‹åŒ–.</p><p>5. å°ç•¶å‰ mtd è¨­å‚™, èª¿ç”¨ nand_scan()æª¢æ¸¬ Nand Flash èŠ¯ç‰‡, nand_scan()å‡½æ•¸åœ¨ drivers/mtd/nand/nand_base.c ä¸­</p><p>å®šç¾©.è©²å‡½æ•¸çš„ä½œç”¨æ˜¯åˆå§‹åŒ– struct nand_chip ä¸­ä¸€äº›æ–¹æ³•, ä¸¦å¾ Nand Flash ä¸­è®€å–èŠ¯ç‰‡ ID, ä¸¦åˆå§‹åŒ– struct</p><p>mtd_info ä¸­çš„æ–¹æ³•.</p><p>6. å°ç•¶å‰ mtd è¨­å‚™,åŠ å…¥å…¶åˆ†å€ä¿¡æ¯.</p><p>7. å¦‚æœé‚„æœ‰æ›´å¤š mtd è¨­å‚™,åˆ° 4 åŸ·è¡Œ.</p><p><strong>4.3.3 åˆå§‹åŒ– Nand Flash æ§åˆ¶å™¨</strong></p><p>s3c2410_nand_inithw()å‡½æ•¸æœƒåˆå§‹åŒ– Nand Flash æ§åˆ¶å™¨, é€šéè¨­ç½® Nand Flash æ§åˆ¶å¯„å­˜å™¨(S3C2410_NFCONF)ä¾†</p><p>å®Œæˆ, é€™è£¡æœ€é‡è¦çš„æ˜¯æ ¹æ“š S3C2410 çš„ PCLK è¨ˆç®—å‡º tacls, twrph0 ä»¥åŠ twrph1 å€¼.</p><p><strong>4.3.4 ç§»é™¤è¨­å‚™</strong></p><p>s3c2410_nand_remove()ç•¶è¨­å‚™è¢«ç§»é™¤æ™‚,è¢« device æ ¸å¿ƒé©…å‹•èª¿ç”¨.å®ƒå®Œæˆçš„ä¸»è¦å·¥ä½œå¦‚ä¸‹:</p><p>1. æŠŠ*device çš„*driver_data å­—æ®µç½®ç©º.</p><p>2. é‡‹æ”¾ mtd è¨­å‚™ä¿¡æ¯.</p><p>3. é‡‹æ”¾ clk è³‡æº.</p><p>4. é€šé iounmap()å–æ¶ˆæ˜ åœ°å€ç©ºé–“.</p><p>5. é‡‹æ”¾ç”³è«‹çš„ I/O å…§å­˜è³‡æº.</p><p>6. é‡‹æ”¾è¨­å‚™ç§æœ‰æ•¸æ“š*info çš„ç©ºé–“.</p><p><strong>4.3.5 Nand Flash èŠ¯ç‰‡åˆå§‹åŒ–</strong></p><p>s3c2410_nand_init_chip()åˆå§‹åŒ– struct nand_chip ä¸­çš„ä¸€äº›ä¸»è¦å­—æ®µä»¥åŠæ–¹æ³•.å…¶ä¸­ä¸»è¦åŒ…æ‹¬çš„æ–¹æ³•æœ‰ï¼š</p><p>1. s3c2410_nand_hwcontrol(); ç¡¬ä»¶æ§åˆ¶</p><p>2. s3c2410_nand_devready(); è¨­å‚™æ˜¯å¦æº–å‚™å¥½</p><p>3. s3c2410_nand_write_buf(); å¯«ä¸€å€‹ buffer åˆ° nand flash</p><p>4. s3c2410_nand_read_buf(); è®€ä¸€å€‹ buffer åˆ° nand flash</p><p>5. s3c2410_nand_select_chip(); é¸æ“‡æ“ä½œèŠ¯ç‰‡</p><p>å¦‚æœæ”¯æŒ ECC ç¡¬ä»¶æ ¡é©—,é‚„è¨­ç½®å¦‚ä¸‹æ–¹æ³•ï¼š 1. s3c2410_nand_correct_data(); é€šé ECC ç¢¼æ ¡æ­£æ•¸æ“š</p><p>2. s3c2410_nand_enable_hwecc(); é–‹å•Ÿç¡¬ä»¶ ECC æª¢æŸ¥</p><p>3. s3c2410_nand_calculate_ecc(); è¨ˆç®— ECC ç¢¼</p><p><strong>4.3.6 è®€ Nand Flash</strong></p><p>ç•¶å° nand flash çš„è¨­å‚™æ–‡ä»¶(nand flash åœ¨/dev ä¸‹å°æ‡‰çš„æ–‡ä»¶)åŸ·è¡Œç³»çµ±èª¿ç”¨ read(),æˆ–åœ¨æŸå€‹æ–‡ä»¶ç³»çµ±ä¸­å°è©²</p><p>è¨­å‚™é€²è¡Œè®€æ“ä½œæ™‚. æœƒèª¿ç”¨ struct mtd_info ä¸­çš„ readæ–¹æ³•,ä»–å€‘ç¼ºçœèª¿ç”¨å‡½æ•¸ç‚º nand_read(),åœ¨</p><p>drivers/mtd/nand/nand_base.cä¸­å®šç¾©.nand_read()èª¿ç”¨ nand_do_read_ecc(),åŸ·è¡Œè®€æ“ä½œ. åœ¨</p><p>nand_do_read_ecc()å‡½æ•¸ä¸­,ä¸»è¦å®Œæˆå¦‚ä¸‹å¹¾é …å·¥ä½œï¼š</p><p>1. æœƒèª¿ç”¨åœ¨ nand flashé©…å‹•ä¸­å° struct nand_chip é‡è¼‰çš„ select_chip æ–¹æ³•,å³</p><p>s3c2410_nand_select_chip()é¸æ“‡è¦æ“ä½œçš„ MTD èŠ¯ç‰‡.</p><p>2. æœƒèª¿ç”¨åœ¨ struct nand_chip ä¸­ç³»çµ±ç¼ºçœçš„æ–¹æ³• cmdfunc ç™¼é€è®€å‘½ä»¤åˆ° nand flash.</p><p>3. æœƒèª¿ç”¨åœ¨ nand flashé©…å‹•ä¸­å° struct nand_chip é‡è¼‰çš„ read_buf(),å³ s3c2410_nand_read_buf()</p><p>å¾ Nand Flashçš„æ§åˆ¶å™¨çš„æ•¸æ“šå¯„å­˜å™¨ä¸­è®€å‡ºæ•¸æ“š.</p><p>4. å¦‚æœæœ‰å¿…è¦çš„è©±,æœƒèª¿ç”¨åœ¨ nand flashé©…å‹•ä¸­å° struct nand_chip é‡è¼‰çš„</p><p>enable_hwecc,correct_data ä»¥åŠ calculate_eccæ–¹æ³•,é€²è¡Œæ•¸æ“š ECC æ ¡é©—ã€‚</p><p><strong>4.3.7 å¯« Nand Flash</strong></p><p>ç•¶å° nand flash çš„è¨­å‚™æ–‡ä»¶(nand flash åœ¨/dev ä¸‹å°æ‡‰çš„æ–‡ä»¶)åŸ·è¡Œç³»çµ±èª¿ç”¨ write(),æˆ–åœ¨æŸå€‹æ–‡ä»¶ç³»çµ±ä¸­å°è©²è¨­å‚™</p><p>é€²è¡Œè®€æ“ä½œæ™‚, æœƒèª¿ç”¨ struct mtd_info ä¸­ write æ–¹æ³•,ä»–å€‘ç¼ºçœèª¿ç”¨å‡½æ•¸ç‚º nand_write(),é€™å…©å€‹å‡½æ•¸åœ¨</p><p>drivers/mtd/nand/nand_base.cä¸­å®šç¾©. nand_write()èª¿ç”¨ nand_write_ecc(),åŸ·è¡Œå¯«æ“ä½œ.åœ¨</p><p>nand_do_write_ecc()å‡½æ•¸ä¸­,ä¸»è¦å®Œæˆå¦‚ä¸‹å¹¾é …å·¥ä½œï¼š</p><p>1. æœƒèª¿ç”¨åœ¨ nand flashé©…å‹•ä¸­å° struct nand_chip é‡è¼‰çš„ select_chip æ–¹æ³•,å³</p><p>s3c2410_nand_select_chip()é¸æ“‡è¦æ“ä½œçš„ MTD èŠ¯ç‰‡.</p><p>2. èª¿ç”¨ nand_write_page()å¯«ä¸€å€‹é .</p><p>3. åœ¨ nand_write_page()ä¸­,æœƒèª¿ç”¨åœ¨ struct nand_chip ä¸­ç³»çµ±ç¼ºçœçš„æ–¹æ³• cmdfunc ç™¼é€å¯«å‘½ä»¤</p><p>åˆ° nand flash.</p><p>4. åœ¨ nand_write_page()ä¸­,æœƒèª¿ç”¨åœ¨ nand flashé©…å‹•ä¸­å° struct nand_chip é‡è¼‰çš„</p><p>write_buf(),å³ s3c2410_nand_write_buf()å¾ Nand Flashçš„æ§åˆ¶å™¨çš„æ•¸æ“šå¯„å­˜å™¨ä¸­å¯«å…¥æ•¸æ“š.</p><p>5. åœ¨ nand_write_page()ä¸­,æœƒèª¿ç”¨åœ¨ nand flashé©…å‹•ä¸­å° struct nand_chip é‡è¼‰ waitfunc æ–¹æ³•,</p><p>è©²æ–¹æ³•èª¿ç”¨ç³»çµ±ç¼ºçœå‡½æ•¸ nand_wait(),è©²æ–¹æ³•ç²å–æ“ä½œç‹€æ…‹,ä¸¦ç­‰å¾… nand flashæ“ä½œå®Œæˆ.ç­‰</p><p>å¾…æ“ä½œå®Œæˆ,æ˜¯èª¿ç”¨ nand flashé©…å‹•ä¸­å° struct nand_chip ä¸­é‡è¼‰çš„ dev_readyæ–¹æ³•,å³</p><p>s3c2410_nand_devready()å‡½æ•¸.</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Linux</a></li><li><a>ç³»çµ±</a></li><li><a>BOOT</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/bcacd8fd.html alt=Linuxç³»çµ±â€”â€”ç”¨æˆ¶ã€ç”¨æˆ¶çµ„ã€æ¬Šé™å’Œæ–‡ä»¶å±¬æ€§ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bcacd8fd.html title=Linuxç³»çµ±â€”â€”ç”¨æˆ¶ã€ç”¨æˆ¶çµ„ã€æ¬Šé™å’Œæ–‡ä»¶å±¬æ€§>Linuxç³»çµ±â€”â€”ç”¨æˆ¶ã€ç”¨æˆ¶çµ„ã€æ¬Šé™å’Œæ–‡ä»¶å±¬æ€§</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6b48b90b.html alt=Linuxç³»çµ±å¸¸ç”¨å‘½ä»¤å¤§å…¨ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6b48b90b.html title=Linuxç³»çµ±å¸¸ç”¨å‘½ä»¤å¤§å…¨>Linuxç³»çµ±å¸¸ç”¨å‘½ä»¤å¤§å…¨</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d39b51ac.html alt=Linuxæ“ä½œç³»çµ±å­˜å„²å­ç³»çµ±æ ¸å¿ƒæŠ€è¡“ä¹‹ç¡¬ç›¤èˆ‡RAID class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/12a0a3d09fd54be3b2087a5d45b798b6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d39b51ac.html title=Linuxæ“ä½œç³»çµ±å­˜å„²å­ç³»çµ±æ ¸å¿ƒæŠ€è¡“ä¹‹ç¡¬ç›¤èˆ‡RAID>Linuxæ“ä½œç³»çµ±å­˜å„²å­ç³»çµ±æ ¸å¿ƒæŠ€è¡“ä¹‹ç¡¬ç›¤èˆ‡RAID</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/59993286.html alt="Linux æ–‡ä»¶ç³»çµ±ä»‹ç´¹" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/50a30000b2bb9135b878 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/59993286.html title="Linux æ–‡ä»¶ç³»çµ±ä»‹ç´¹">Linux æ–‡ä»¶ç³»çµ±ä»‹ç´¹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8024f20c.html alt="Linux æ–‡ä»¶ç³»çµ±å‰–æ" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7ea491ff1de847568632e723367af267 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8024f20c.html title="Linux æ–‡ä»¶ç³»çµ±å‰–æ">Linux æ–‡ä»¶ç³»çµ±å‰–æ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/13a20156.html alt=Linuxæ–‡ä»¶ç³»çµ±101 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/184733a1b935442eaf00466d218e78af style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/13a20156.html title=Linuxæ–‡ä»¶ç³»çµ±101>Linuxæ–‡ä»¶ç³»çµ±101</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1d5836cb.html alt=Linuxæ–‡ä»¶ç³»çµ±ä»‹ç´¹ï¼šExtã€XFSã€Btrfsç­‰ï¼Œé¸æ“‡é©åˆè‡ªå·±çš„æ–‡ä»¶ç³»çµ± class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/988b5ddedbeb42e8ae01b11a525ff754 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1d5836cb.html title=Linuxæ–‡ä»¶ç³»çµ±ä»‹ç´¹ï¼šExtã€XFSã€Btrfsç­‰ï¼Œé¸æ“‡é©åˆè‡ªå·±çš„æ–‡ä»¶ç³»çµ±>Linuxæ–‡ä»¶ç³»çµ±ä»‹ç´¹ï¼šExtã€XFSã€Btrfsç­‰ï¼Œé¸æ“‡é©åˆè‡ªå·±çš„æ–‡ä»¶ç³»çµ±</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/198ca4e7.html alt=Linuxæ–‡ä»¶ç³»çµ±æ¦‚å¿µè§£é‡‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/153dc1ea3f434fef9762d98d4d308380 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/198ca4e7.html title=Linuxæ–‡ä»¶ç³»çµ±æ¦‚å¿µè§£é‡‹>Linuxæ–‡ä»¶ç³»çµ±æ¦‚å¿µè§£é‡‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/11002b4c.html alt=Linuxæ–‡ä»¶ç³»çµ±ç›®éŒ„æ¨™æº–ä»‹ç´¹ï¼ˆFHSï¼‰ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5fcf0579209e4a4794121746fe9b8ddc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/11002b4c.html title=Linuxæ–‡ä»¶ç³»çµ±ç›®éŒ„æ¨™æº–ä»‹ç´¹ï¼ˆFHSï¼‰>Linuxæ–‡ä»¶ç³»çµ±ç›®éŒ„æ¨™æº–ä»‹ç´¹ï¼ˆFHSï¼‰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b2909f2b.html alt=Linuxæ–‡ä»¶ç³»çµ±èˆ‡ç›®éŒ„çµæ§‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b2909f2b.html title=Linuxæ–‡ä»¶ç³»çµ±èˆ‡ç›®éŒ„çµæ§‹>Linuxæ–‡ä»¶ç³»çµ±èˆ‡ç›®éŒ„çµæ§‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/10be8693.html alt=ä¸€ç¯‡æ–‡ç« è¬›æ¸…Linuxæ“ä½œç³»çµ±çš„ç›®éŒ„çµæ§‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/64f85cc0fcc548d99f56bd2567c34511 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/10be8693.html title=ä¸€ç¯‡æ–‡ç« è¬›æ¸…Linuxæ“ä½œç³»çµ±çš„ç›®éŒ„çµæ§‹>ä¸€ç¯‡æ–‡ç« è¬›æ¸…Linuxæ“ä½œç³»çµ±çš„ç›®éŒ„çµæ§‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4717b88a.html alt=åµŒå…¥å¼é–‹ç™¼ä¹‹Linuxç³»çµ±ä¸­æ–‡ä»¶å’Œç›®éŒ„ç›¸é—œå‘½ä»¤ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1d8b5c2d75ba4ed5a0cc99267cb18c73 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4717b88a.html title=åµŒå…¥å¼é–‹ç™¼ä¹‹Linuxç³»çµ±ä¸­æ–‡ä»¶å’Œç›®éŒ„ç›¸é—œå‘½ä»¤>åµŒå…¥å¼é–‹ç™¼ä¹‹Linuxç³»çµ±ä¸­æ–‡ä»¶å’Œç›®éŒ„ç›¸é—œå‘½ä»¤</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fd75dea8.html alt="ç³»çµ±ç­è§£ Linux æ–‡ä»¶ç³»çµ±" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/3b15000077fa0e231516 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fd75dea8.html title="ç³»çµ±ç­è§£ Linux æ–‡ä»¶ç³»çµ±">ç³»çµ±ç­è§£ Linux æ–‡ä»¶ç³»çµ±</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1b6548ae.html alt=è©³è§£Linuxç³»çµ±æ¶æ§‹--å…§æ ¸ï¼ˆå…§å­˜ã€é€²ç¨‹ã€è¨­å‚™ã€æ–‡ä»¶ç³»çµ±å’Œç¶²çµ¡ï¼‰ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/69fc12e26bdd4ebf942d997de47a1396 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1b6548ae.html title=è©³è§£Linuxç³»çµ±æ¶æ§‹--å…§æ ¸ï¼ˆå…§å­˜ã€é€²ç¨‹ã€è¨­å‚™ã€æ–‡ä»¶ç³»çµ±å’Œç¶²çµ¡ï¼‰>è©³è§£Linuxç³»çµ±æ¶æ§‹--å…§æ ¸ï¼ˆå…§å­˜ã€é€²ç¨‹ã€è¨­å‚™ã€æ–‡ä»¶ç³»çµ±å’Œç¶²çµ¡ï¼‰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b7ea2e49.html alt=Linuxæ–‡ä»¶ç³»çµ±æ˜¯æ€éº¼å·¥ä½œçš„ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/dc7369f3a6f547b4a03c383142a7af8c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b7ea2e49.html title=Linuxæ–‡ä»¶ç³»çµ±æ˜¯æ€éº¼å·¥ä½œçš„ï¼Ÿ>Linuxæ–‡ä»¶ç³»çµ±æ˜¯æ€éº¼å·¥ä½œçš„ï¼Ÿ</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>