<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>細數這些年項目中用過的配置文件（ini 篇） | 极客快訊</title><meta property="og:title" content="細數這些年項目中用過的配置文件（ini 篇） - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/c8eb892214c9452aa6c3c0348522bab6"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bb28606.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bb28606.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bb28606.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bb28606.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bb28606.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bb28606.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bb28606.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bb28606.html><meta property="article:published_time" content="2020-10-29T20:59:54+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:54+08:00"><meta name=Keywords content><meta name=description content="細數這些年項目中用過的配置文件（ini 篇）"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/bb28606.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>細數這些年項目中用過的配置文件（ini 篇）</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>Java 菜鳥，會把可變的配置信息寫死在代碼裡；Java 老鳥，會把可變的配置信息提取到配置文件中。坊間流傳這麼一句非科學的衡量標準，來評判程序員的級別。</p><p><br></p><p>那麼，項目中的配置信息，你平時都是怎樣來實現的呢？你項目中用過哪些配置文件呢？</p><p><br></p><p>近期將結合實際項目或源碼，說說這些年用過的那些有關配置的奇技淫巧，看看能否幫你提高研發能力，那怕是提高一丟丟，就算成功。</p><p><br></p><h1 class=pgc-h-decimal data-index=01><strong>後綴為 .ini 的文件，你用過沒？</strong></h1><p><br></p><p>後綴為 .ini 的文件，是 Initialization File 的縮寫，主要用於程序的初始化的一些配置參數，後綴當然也可以是 .conf、.cfg，只是項目中習慣上用後綴 .ini 罷了。</p><p><br></p><p>簡單介紹一下，一個 ini 配置文件主要由節（section）、鍵值對組成。</p><p><br></p><div class=pgc-img><img alt="細數這些年項目中用過的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c8eb892214c9452aa6c3c0348522bab6><p class=pgc-img-caption></p></div><p><br></p><p>如上圖所示，ini 文件中，配置參數都是以節（section）為單位組合在一起的，每個節名字都被方括號包圍著，像 owner、database 都被方括號括著。而每個節聲明後的鍵值對都屬於該 section，而且一個 section 沒有結束標識符，一個節的開始就是上一個節的結束。</p><p><br></p><h1 class=pgc-h-decimal data-index=02>後綴為 .ini 的文件，怎麼用啊？</h1><p><br></p><p>在自研框架或者業務項目開發中，往往會配置一些項目啟動時要初始化的一些參數信息，例如端口、域名等等。從老項目中截取一段，其實就配置鍵值對而已，很簡單，有沒有？</p><p><br></p><div class=pgc-img><img alt="細數這些年項目中用過的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b4ebcb9951d4452498d3cd4a3a16cf0f><p class=pgc-img-caption></p></div><p><br></p><p>另外，項目研發中在面對身份驗證、授權、密碼和會話管理等需求時，經常會集成 Java 安全框架 Shiro，而 Shiro 就提供了使用 ini 文件，進行配置參數的能力（INI is easy to read, simple to use, and requires very fewdependencies）。</p><p><br></p><div class=pgc-img><img alt="細數這些年項目中用過的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/57be18e900004eee9b9f3d06bc73370b><p class=pgc-img-caption></p></div><p><br></p><p><strong>後綴為 .ini 的文件，怎麼解析啊？</strong></p><p><br></p><p><strong>老土方法：</strong>用腳指頭想出來的簡單方法，往文件上插一根管子，直接採用 Properties 的 load 方法完成數據的讀取，勢必能達到解析的目的（腦補代碼，懶得寫代碼啦）。</p><p><br></p><p><strong>老土方法：</strong>用手指頭想出來的簡單方法，往文件上插一根管子，一行一行去讀，再按照等號拆分鍵值對，最後把鍵值對向 Map 放一下，必然也能達到解析的目的（腦補代碼，代碼懶得寫啦）。</p><p><br></p><p><strong>優雅方法：</strong>看看 Shiro 咋搞的？項莊舞劍意在沛公。嘗試告訴你：為什麼 Java 輪子會多呢？這可能就是造輪子的其中一條路徑，熟讀源碼，到處抄，哈哈。</p><p><br></p><h1 class=pgc-h-decimal data-index=03>看看 Shiro，人家到底怎麼解析的？</h1><p><br></p><div class=pgc-img><img alt="細數這些年項目中用過的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/429a4fb233b8437f8c05518aa85c7cfe><p class=pgc-img-caption></p></div><p><br></p><p>首先，Shiro 加載配置文件支持好幾種方式，我們就挑如何加載類路徑下的 shiro.ini 配置文件進行剖析，掌握這一條路徑，其它方式殊途同歸。</p><p><br></p><div class=pgc-img><img alt="細數這些年項目中用過的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/38ace7896cc3499fbaf43c6801b4468d><p class=pgc-img-caption></p></div><p><br></p><p>如上圖源碼所示，在加載 shiro.ini 配置文件前，首先會判斷文件是否存在，存在則從類路徑下進行加載，而且會發現 Shiro 把 ini 配置封裝成了 Ini 對象（<strong>這不就是面向對象嗎？Java 的核心思想：Every thing is object！</strong>）。</p><p><br></p><div class=pgc-img><img alt="細數這些年項目中用過的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/a5ee4846c94048bfa8414f3f501d44f7><p class=pgc-img-caption></p></div><p><br></p><p>如上圖源碼所示，很顯然會發現，具體讀取 shiro.ini 配置的事情，就交給了 ResourceUtils 去辦了（<strong>術業有專攻，分工明確，各司其職</strong>），不過和咱們能想到的土方法也差不多，就是往文件上插一根管子，然後調用 load 方法進行讀取。</p><p><br></p><div class=pgc-img><img alt="細數這些年項目中用過的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2a61edf76a604423bac44545ace2b876><p class=pgc-img-caption></p></div><p><br></p><p>通過上面源碼截圖，發現 load 方法只是稍微裝飾了一下，把 InputStream 變成了 Reader（<strong>設計模式：裝飾器模式；面向對象的核心：多態</strong>）。</p><p><br></p><div class=pgc-img><img alt="細數這些年項目中用過的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/781e303b75ca43e294b7738031ed5411><p class=pgc-img-caption></p></div><p><br></p><p>看到上面的代碼，會發現依然沒有真正的讀取，而是繼續包裝 Reader，變成 Scanner 來獲取文件輸入（敢問，有必要這麼繞來繞去嗎？不過，無所謂，繼續往下看！）</p><p><br></p><div class=pgc-img><img alt="細數這些年項目中用過的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/eba70366260547d79050bdd1f8e4bd11><p class=pgc-img-caption></p></div><p><br></p><p>到這兒，如上面截圖所示，看到了廬山真面目，終於見到了一行一行進行讀取內容，並進行截取其中的 section（節），也就是 shiro.ini 中配置的 [main]、[urls] 等等，接著把每個 section 下面的內容直接拼接在一起形成字符串，而此時，並沒有拆分鍵值對。</p><p><br></p><div class=pgc-img><img alt="細數這些年項目中用過的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/be3995ba597a4bfe941edc56a12e09f2><p class=pgc-img-caption></p></div><p><br></p><p>如上面源碼所示，很顯然 Shiro 把 ini 配置的組件又封裝成了 Section 對象（<strong>再一次體會Java 的核心思想：Every thing is object！</strong>）。</p><p><br></p><p>不過，還記得配置文件咋配置的嗎？把 shiro.ini 配置圖再貼一次。</p><p><br></p><div class=pgc-img><img alt="細數這些年項目中用過的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b8bd522f54f943c8936c2f62568b5f41><p class=pgc-img-caption></p></div><p><br></p><p>我們結合下面的源碼，再去看上面這個段配置，順道看看 Section 對象裡面都有啥？</p><p><br></p><div class=pgc-img><img alt="細數這些年項目中用過的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/00a8fbb4e5e44a54a65cc86bb1b202e5><p class=pgc-img-caption></p></div><p><br></p><p>如上圖源碼標註 1，定義了一個 Map 用於保存配置的鍵值對信息；代碼標註 2，是把上一步的字符串轉換成 Map，具體轉換如下圖所示，按照等號進行拆分鍵值對，並放到 Map中。</p><p><br></p><div class=pgc-img><img alt="細數這些年項目中用過的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/051c9f5da6d54b6d930e22decc8c1505><p class=pgc-img-caption></p></div><p><br></p><p>仔細去看源碼，會發現拆分鍵值對時，不僅僅是按照等號，但是 who care 呢？只因為到這兒，梗概已經瞭解個八九不離十啦。</p><p><br></p><div class=pgc-img><img alt="細數這些年項目中用過的配置文件（ini 篇）" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f554d78e2e4b46619b9e1e7ef71e33ca><p class=pgc-img-caption></p></div><p><br></p><p>好了，剖析的差多了，從源碼去看反而感覺複雜了不少，其實際使用超級之簡單，和咱們用手指頭想的老土方法差不多，只是 Shiro 封裝的稍微好一些。</p><p><br></p><p>但是，你有沒有發現，有好多代碼是可以簡單抽一抽，你就可以直接應用到項目中的呢？</p><p><br></p><h1 class=pgc-h-decimal data-index=04>它山之石可以攻玉</h1><p><br></p><p>它山之石可以攻玉，相信會對你有幫助！</p><p><br></p><p>行文至此，你肯定會有疑問，為什麼不用 properties 啊？為什麼不用 ymal 啊？其實說實話，黑貓白貓抓住老鼠都是好貓。</p><p><br></p><p>另外，為了能夠幫你提高研發能力（那怕是提高一丟丟呢），後續將繼續結合實際項目，看看用到的其它形式的配置文件，敬請期待。</p><p>歡迎關注「<strong class=highlight-text>一猿小講</strong>」，瞭解更多精彩。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>配置文件</a></li><li><a>細數</a></li><li><a>這些</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/a9681862.html alt=停電通知：涉及西安這些區域，最長超過48小時 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RqALLGVINNInKI style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a9681862.html title=停電通知：涉及西安這些區域，最長超過48小時>停電通知：涉及西安這些區域，最長超過48小時</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e2d6fc9f.html alt=包頭這些地方要停電 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/859d3095cd1d477ab613027b9ce219c2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e2d6fc9f.html title=包頭這些地方要停電>包頭這些地方要停電</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4c4b6b45.html alt=明天起西安這些地方停水、停電，最長24小時！雨還來嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/23f74c70f3344e2b98c87cf66a594d8d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4c4b6b45.html title=明天起西安這些地方停水、停電，最長24小時！雨還來嗎？>明天起西安這些地方停水、停電，最長24小時！雨還來嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4375da16.html alt="滾輪鍵按一下 這些功能超方便" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/b646e119c9604f76ad8267cd63a6b661 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4375da16.html title="滾輪鍵按一下 這些功能超方便">滾輪鍵按一下 這些功能超方便</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bf03ccfb.html alt=想要更好的藍牙音質？這些藍牙音頻編碼你要知道 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RAVmUNPA9yJDfa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bf03ccfb.html title=想要更好的藍牙音質？這些藍牙音頻編碼你要知道>想要更好的藍牙音質？這些藍牙音頻編碼你要知道</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a60af1ac.html alt="耳機小白必讀 這些常見音頻編碼一定要了解" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RN7gZcbAxeBjkW style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a60af1ac.html title="耳機小白必讀 這些常見音頻編碼一定要了解">耳機小白必讀 這些常見音頻編碼一定要了解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cfee15a7.html alt=建築層高和淨高知識彙總，這些你都知道嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/f5a612c7-aeab-4603-af94-2d692cfc5e76 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cfee15a7.html title=建築層高和淨高知識彙總，這些你都知道嗎？>建築層高和淨高知識彙總，這些你都知道嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7206f327.html alt=這些方法可以讓發硬的紅糖變軟 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7206f327.html title=這些方法可以讓發硬的紅糖變軟>這些方法可以讓發硬的紅糖變軟</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ea55b21f.html alt=趁著疫情來騙錢！闢謠：這些號稱能預防新冠毒肺炎的七個產品 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/59694987d69649508d0f4701be15daf6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ea55b21f.html title=趁著疫情來騙錢！闢謠：這些號稱能預防新冠毒肺炎的七個產品>趁著疫情來騙錢！闢謠：這些號稱能預防新冠毒肺炎的七個產品</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9692432a.html alt=中國這些超級鹽湖，實力與魅力並存 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15379278320496657273e6c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9692432a.html title=中國這些超級鹽湖，實力與魅力並存>中國這些超級鹽湖，實力與魅力並存</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/813d5912.html alt=關於Facebook像素，這些你瞭解嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RM0p5dK51SH9EU style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/813d5912.html title=關於Facebook像素，這些你瞭解嗎？>關於Facebook像素，這些你瞭解嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b4e33540.html alt="收藏 | 這些航測必備的知識點你瞭解嗎？" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b4e33540.html title="收藏 | 這些航測必備的知識點你瞭解嗎？">收藏 | 這些航測必備的知識點你瞭解嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/28238c20.html alt=焊工考試這些題你會做嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/28238c20.html title=焊工考試這些題你會做嗎？>焊工考試這些題你會做嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e9ebdb58.html alt=升冪、降冪、二倍、半角這些繞暈你的變換你會嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/23ec864c961f438d9141a0eacd5d8792 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e9ebdb58.html title=升冪、降冪、二倍、半角這些繞暈你的變換你會嗎？>升冪、降冪、二倍、半角這些繞暈你的變換你會嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cff57476.html alt=北海的這些樣子，你都見過嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6f8a3f9c96b94f39a96334bdab83920b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cff57476.html title=北海的這些樣子，你都見過嗎？>北海的這些樣子，你都見過嗎？</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>