<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Lyft 基於 Flink 的大規模準實時數據分析平臺 | 极客快訊</title><meta property="og:title" content="Lyft 基於 Flink 的大規模準實時數據分析平臺 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/90ad212bc87c4d828c5fbe8e21dfddf7"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bd043816.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bd043816.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bd043816.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bd043816.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bd043816.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bd043816.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/bd043816.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/bd043816.html><meta property="article:published_time" content="2020-11-14T21:00:57+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:57+08:00"><meta name=Keywords content><meta name=description content="Lyft 基於 Flink 的大規模準實時數據分析平臺"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/bd043816.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Lyft 基於 Flink 的大規模準實時數據分析平臺</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">如何基於 Flink 搭建大規模準實時數據分析平臺？來自 Lyft 公司實時數據平臺的徐贏博士和計算數據平臺的高立博士分享了 Lyft 基於 Apache Flink 的大規模準實時數據分析平臺。本次分享主要分為四個方面：</span></p><ul><li><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">Lyft 流數據與場景</span></li><li><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">準實時數據分析平臺和架構</span></li><li><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">平臺性能及容錯深入分析</span></li><li><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">總結與未來展望</span></li></ul><p><strong>01</strong></p><p><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">Lyft 流數據與場景</span></strong></p><p><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">1. 關於 Lyft</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">Lyft 是位於北美的一個共享交通平臺，和大家所熟知的 Uber 和國內的滴滴類似，Lyft 也為民眾提供共享出行的服務。Lyft 的宗旨是提供世界最好的交通方案來改善人們的生活。</span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/90ad212bc87c4d828c5fbe8e21dfddf7><p class=pgc-img-caption></p></div><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">2. Lyft 的流數據場景</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">Lyft 的流數據可以大致分為三類，秒級別、分鐘級別和不高於 5 分鐘級別。分鐘級別流數據中，自適應定價系統、欺詐和異常檢測系統是最常用的，此外還有 Lyft 最新研發的機器學習特徵工程。不高於 5 分鐘級別的場景則包括準實時數據交互查詢相關的系統。</span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/cc33489f54be468583f0b4443070181a><p class=pgc-img-caption></p></div><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">3. Lyft 數據分析平臺架構</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">如下圖所示的是 Lyft 之前的數據分析平臺架構。Lyft 的大部分流數據都是來自於事件，而事件產生的來源主要有兩種，分別是手機 APP 和後端服務，比如乘客、司機、支付以及保險等服務都會產生各種各樣的事件，而這些事件都需要實時響應。</span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fccd7f314f3b4d0fbc7f20286e1c9336><p class=pgc-img-caption></p></div><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">在分析平臺這部分，事件會流向 AWS 的 Kinesis 上面，這裡的 Kinesis 與 Apache Kafka 非常類似，是一種 AWS 上專有的 PubSub 服務，而這些數據流都會量化成文件，這些文件則都會存儲在 AWS 的 S3 上面，並且很多批處理任務都會彈出一些數據子集。在分析系統方面，Lyft 使用的是開源社區中比較活躍的 presto 查詢引擎。Lyft 數據分析平臺的用戶主要有四種，即數據工程師、數據分析師以及機器學習專家和深度學習專家，他們往往都是通過分析引擎實現與數據的交互。</span></p><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">4. 既往平臺的問題</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">Lyft 之所以要基於 Apache Flink 實現大規模準實時數據分析平臺，是因為以往的平臺存在一些問題。比如較高的延遲，導入數據無法滿足準實時查詢的要求；並且基於 Kinesis Client Library 的流式數據導入性能不足；導入數據存在太多小文件導致下游操作性能不足；數據 ETL 大多是高延遲多日多步的架構；此外，以往的平臺對於嵌套數據提供的支持也不足。</span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/63f2052a454c4e11a18b1414a28cbf3f><p class=pgc-img-caption></p></div><p><strong>02</strong></p><p><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">準實時數據分析平臺和架構</span></strong></p><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">1. 準實時平臺架構</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">在新的準實時平臺架構中，Lyft 採用 Flink 實現流數據持久化。Lyft 使用雲端存儲，而使用 Flink 直接向雲端寫一種叫做 Parquet 的數據格式，Parquet 是一種列數據存儲格式，能夠有效地支持交互式數據查詢。Lyft 在 Parquet 原始數據上架構實時數倉，實時數倉的結構被存儲在 Hive 的 Table 裡面，Hive Table 的 metadata 存儲在 Hive metastore 裡面。</span></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">平臺會對於原始數據做多級的非阻塞 ETL 加工，每一級都是非阻塞的 ( nonblocking )，主要是壓縮和去重的操作，從而得到更高質量的數據。平臺主要使用 Apache Airflow 對於 ETL 操作進行調度。所有的 Parquet 格式的原始數據都可以被 presto 查詢，交互式查詢的結果將能夠以 BI 模型的方式顯示給用戶。</span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/d21a69a5df46462c9c3cdd1b1fe5a30c><p class=pgc-img-caption></p></div><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">2. 平臺設計</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">Lyft 基於 Apache Flink 實現的大規模準實時數據分析平臺具有幾個特點：</span></p><ul><li><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">首先，平臺藉助 Flink 實現高速有效的流數據接入，使得雲上集群規模縮減為原來的十分之一，因此大大降低了運維成本。</span></li><li><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">其次，Parquet 格式的數據支持交互式查詢，當用戶僅對於某幾個列數據感興趣時可以通過分區和選擇列的方式過濾不必要的數據，從而提升查詢的性能。</span></li><li><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">再次，基於 AWS 的雲端存儲，平臺的數據無需特殊存儲形式。</span></li><li><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">之後，多級 ETL 進程能夠確保更好的性能和數據質量。</span></li><li><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">最後，還能夠兼顧性能容錯及可演進性。</span></li></ul><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/67e1928b19af4e9cb425be31f0ea2a64><p class=pgc-img-caption></p></div><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">3. 平臺特徵及應用</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">Lyft 準實時數據分析平臺需要每天處理千億級事件，能夠做到數據延遲小於 5 分鐘，而鏈路中使用的組件確保了數據完整性，同時基於 ETL 去冗餘操作實現了數據單一性保證。</span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5c95ae0afac64f6bbe4a66fe22d76467><p class=pgc-img-caption></p></div><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">數據科學家和數據工程師在建模時會需要進行自發的交互式查詢，此外，平臺也會提供實時機器學習模型正確性預警，以及實時數據面板來監控供需市場健康狀況。</span></p><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">4. 基於 Flink 的準實時數據導入</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">下圖可以看到當事件到達 Kinesis 之後就會被存儲成為 EventBatch。通過 Flink-Kinesis 連接器可以將事件提取出來並送到 FlatMap 和 Record Counter 上面，FlatMap 將事件</span><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">打撒</span><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">並送到下游的 Global Record Aggregator 和 Tagging Partitioning 上面，每當做 CheckPoint 時會關閉文件並做一個持久化操作，針對於 StreamingFileSink 的特徵，平臺設置了每三分鐘做一次 CheckPoint 操作，這樣可以保證當事件進入 Kinesis 連接器之後在三分鐘之內就能夠持久化。</span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/454560c31a9b4feaa5a236654d8e7288><p class=pgc-img-caption></p></div><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">以上的方式會造成太多數量的小文件問題，因為數據鏈路支持成千上萬種文件，因此使用了 Subtasks 記錄本地事件權重，並通過全局記錄聚合器來計算事件全局權重並廣播到下游去。而 Operator 接收到事件權重之後將會將事件分配給 Sink。</span></p><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">5. ETL 多級壓縮和去重</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">上述的數據鏈路也會做 ETL 多級壓縮和去重工作，主要是 Parquet 原始數據會經過每小時的智能壓縮去重的 ETL 工作，產生更大的 Parquet File。同理，對於小時級別壓縮去重不夠的文件，每天還會再進行一次壓縮去重。對於新產生的數據會有一個原子性的分區交換，也就是說當產生新的數據之後，ETL Job 會讓 Hive metastore 裡的表分區指向新的數據和分區。這裡的過程使用了啟發性算法來分析哪些事件必須要經過壓縮和去重以及壓縮去重的時間間隔級別。此外，為了滿足隱私和合規的要求，一些 ETL 數據會被保存數以年計的時間。</span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fdfabea2a62c4800a876103ef1f6b910><p class=pgc-img-caption></p></div><p><strong>03</strong></p><p><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">平臺性能及容錯深入分析</span></strong></p><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">1. 事件時間驅動的分區感測</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">Flink 和 ETL 是通過事件時間驅動的分區感測實現同步的。S3 採用的是比較常見的分區格式，最後的分區是由時間戳決定的，時間戳則是基於 EventTime 的，這樣的好處在於能夠帶來 Flink 和 ETL 共同的時間源，這樣有助於同步操作。此外，基於事件時間能夠使得一些回填操作和主操作實現類似的結果。Flink 處理完每個小時的事件後會向事件分區寫入一個 Success 文件，這代表該小時的事件已經處理完畢，ETL 可以對於該小時的文件進行操作了。<br></span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/8eaddf85633149a8aae601fb927defdb><p class=pgc-img-caption></p></div><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">Flink 本身的水印並不能直接用到 Lyft 的應用場景當中，主要是因為當 Flink 處理完時間戳並不意味著它已經被持久化到存儲當中，此時就需要引入分區水印的概念，這樣一來每個 Sink Source 就能夠知道當前寫入的分區，並且維護一個分區 ID，並且通過 Global State Aggregator 聚合每個分區的信息。每個 Subtasks 能夠知道全局的信息，並將水印定義為分區時間戳中最小的一個。</span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/84437bec524c4246b91a38a0875d779f><p class=pgc-img-caption></p></div><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">ETL 主要有兩個特點，分別是及時性和去重，而 ETL 的主要功能在於去重和壓縮，最重要的是在非阻塞的情況下就進行去重。前面也提到 Smart ETL，所謂 Smart 就是智能感知，需要兩個相應的信息來引導 Global State Aggregator，分別是分區完整性標識 SuccessFile，在每個分區還有幾個相應的 States 統計信息能夠告訴下游的 ETL 怎樣去重和壓縮以及操作的頻率和範圍。</span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f324d574ac4947369098a27235280d48><p class=pgc-img-caption></p></div><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">2. Schema 演進的挑戰</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">ETL 除了去重和壓縮的挑戰之外，還經常會遇到 Schema 的演化挑戰。Schema 演化的挑戰分為三個方面，即不同引擎的數據類型、嵌套結構的演變、數據類型演變對去重邏輯的影響。</span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3f41aa74764d4c43a04f4acb41ea670b><p class=pgc-img-caption></p></div><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">3. S3 深入分析</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">Lyft 的數據存儲系統其實可以認為是</span><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">數據湖</span><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">，對於 S3 而言，Lyft 也有一些性能的優化考量。S3 本身內部也是有分區的，為了使其具有並行的讀寫性能，添加了 S3 的熵數前綴，在分區裡面也增加了標記文件，這兩種做法能夠極大地降低 S3 的 IO 性能的影響。標識符對於能否觸發 ETL 操作會產生影響，與此同時也是對於 presto 的集成，能夠讓 presto 決定什麼情況下能夠掃描多少個文件。<br></span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/299247b7bc8c40b680198300ab8590c5><p class=pgc-img-caption></p></div><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">4. Parquet 優化方案</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">Lyft 的準實時數據分析平臺在 Parquet 方面做了很多優化，比如文件數據值大小範圍統計信息、文件系統統計信息、基於主鍵數據值的排序加快 presto 的查詢速度以及二級索引的生成。</span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/195441355090468bbaa69c4af5e0ea8b><p class=pgc-img-caption></p></div><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">5. 基於數據回填的平臺容錯機制</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">如下兩個圖所示的是 Lyft 準實時數據分析平臺的基於數據回填的平臺容錯機制。對於 Flink 而言，因為平臺的要求是達到準實時，而 Flink 的 Job 出現失效的時候可能會超過一定的時間，當 Job 重新開始之後就會形成兩個數據流，主數據流總是從最新的數據開始往下執行，附加數據流則可以回溯到之前中斷的位置進行執行直到中斷結束的位置。這樣的好處是既能保證主數據流的準實時特性，同時通過回填數據流保證數據的完整性。</span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b79892359b414214bfc5507ef173c19d><p class=pgc-img-caption></p></div><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">對於 ETL 而言，基於數據回填的平臺容錯機制則表現在 Airflow 的冪等調度系統、原子壓縮和 HMS 交換操作、分區自建自修復體系和 Schema 整合。</span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ccb2894fb00b47418a5187a115d7b742><p class=pgc-img-caption></p></div><p><br></p><p><strong>04</strong></p><p><br></p><p><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">總結與未來展望</span></strong></p><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">1. 體驗與經驗教訓</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">利用 Flink 能夠準實時注入 Parquet 數據，使得交互式查詢體驗為可能。同時，Flink 在 Lyft 中的應用很多地方也需要提高，雖然 Flink 在大多數情況的延時都能夠得到保證，但是重啟和部署的時候仍然可能造成分鐘級別的延時，這會對於 SLO 產生一定影響。</span></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">此外，Lyft 目前做的一件事情就是改善部署系統使其能夠支持 Kubernetes，並且使得其能夠接近 0 宕機時間的效果。因為 Lyft 準實時數據分析平臺在雲端運行，因此在將數據上傳到 S3 的時候會產生一些隨機的網絡情況，造成 Sink Subtasks 的停滯，進而造成整個 Flink Job 的停滯。而通過引入一些 Time Out 機制來檢測 Sink Subtasks 的停滯，使得整個 Flink Job 能夠順利運行下去。</span></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">ETL 分區感應能夠降低成本和延遲，成功文件則能夠表示什麼時候處理完成。此外，S3 文件佈局對性能提升的影響還是非常大的，目前而言引入</span><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">熵數</span><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">還屬於經驗總結，後續 Lyft 也會對於這些進行總結分析並且公開。因為使用 Parquet 數據，因此對於 Schema 的兼容性要求就非常高，如果引入了不兼容事件則會使得下游的 ETL 癱瘓，因此 Lyft 已經做到的就是在數據鏈路上游對於 Schema 的兼容性進行檢查，檢測並拒絕用戶提交不兼容的 Schema。</span></p><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e6a30b18f4e344af97f6f7ff66d7cc91><p class=pgc-img-caption></p></div><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">2. 未來展望</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">Lyft 對於準實時數據分析平臺也有一些設想：</span></p><ul><li><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">首先，Lyft 希望將 Flink 部署在 Kubernetes 集群環境下運行，使得 Kubernetes 能夠管理這些 Flink Job，同時也能夠充分利用 Kubernetes 集群的高可擴展性。</span></li><li><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">其次，Lyft 也希望實現通用的流數據導入框架，準實時數據分析平臺不僅僅支持事件，也能夠支持數據庫以及服務日誌等數據。</span></li><li><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">再次，Lyft 希望平臺能夠實現 ETL 智能壓縮以及事件驅動 ETL，使得回填等事件能夠自動觸發相應的 ETL 過程，實現和以前的數據的合併，同時將延時數據導入來對於 ETL 過程進行更新。</span></li><li><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">最後，Lyft 還希望準實時數據分析平臺能夠實現存儲過程的改進以及查詢優化，藉助 Parquet 的統計數據來改善 presto 的查詢性能，藉助表格管理相關的開源軟件對存儲管理進行性能改善，同時實現更多的功能。</span></li></ul><div class=pgc-img><img alt="Lyft 基於 Flink 的大規模準實時數據分析平臺" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9d06515cb0c54fc8bc09aeff2e87667c><p class=pgc-img-caption></p></div><p style=text-align:justify><strong><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">作者：</span></strong></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">徐贏博士是 Lyft 數據平臺流媒體平臺的技術領導（Technical Lead），目前主導準實時數據分析平臺的架構開發。在 Lyft 之前，他曾在領英(Linkedin)以及 IBM 擔任技術領導職位，主導領英跨數據中心數據庫複製的上線，以及 IBM 高速數據傳輸技術的研發。</span></p><p style=text-align:justify><span style="color:#3f4a59;--tt-darkmode-color: #8897AB">高立博士在 Lyft 的數據平臺團隊中工作，目前領導 Lyft 數據平臺內的多個數據基礎架構項目，包括實時數據倉庫，自服務機器學習平臺項目等。 曾在 Salesforce，Fitbit，Groupon 和其他初創公司擔任關鍵技術領導職務。</span></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Lyft</a></li><li><a>Flink</a></li><li><a>大規</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/3638ad51.html alt="Apache Flink 1.10 細粒度資源管理解析" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15513883d97c4f799a3897342310c24f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3638ad51.html title="Apache Flink 1.10 細粒度資源管理解析">Apache Flink 1.10 細粒度資源管理解析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7f4f1166.html alt=服務器疑似大規模宕機，騰訊迴應：由於光纖故障，正在緊急搶修中 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7f4f1166.html title=服務器疑似大規模宕機，騰訊迴應：由於光纖故障，正在緊急搶修中>服務器疑似大規模宕機，騰訊迴應：由於光纖故障，正在緊急搶修中</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3cf03ac8.html alt=華為雲史上第一次大規模宕機？官方迴應部分異常 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RvjUnPj93HazKi style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3cf03ac8.html title=華為雲史上第一次大規模宕機？官方迴應部分異常>華為雲史上第一次大規模宕機？官方迴應部分異常</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/aed6c673.html alt="Flink 滑動窗口優化" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/efb733b701294ed085d37f6a8871e99f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/aed6c673.html title="Flink 滑動窗口優化">Flink 滑動窗口優化</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/92b7ebb2.html alt=大數據專家，對Flink批處理生成JobGraph流程深入分析，值得收藏 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9c9227424d8f4b52958e32ec1ffdb116 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/92b7ebb2.html title=大數據專家，對Flink批處理生成JobGraph流程深入分析，值得收藏>大數據專家，對Flink批處理生成JobGraph流程深入分析，值得收藏</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5d9900a2.html alt=Flink中的數據抽象及數據交換過程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/1b7a1014-7ea5-421b-808e-c41398f5e4aa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5d9900a2.html title=Flink中的數據抽象及數據交換過程>Flink中的數據抽象及數據交換過程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0fe039b8.html alt="深入分析 Flink SQL 工作機制" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d6fbb1aee0444698aad234b9df699720 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0fe039b8.html title="深入分析 Flink SQL 工作機制">深入分析 Flink SQL 工作機制</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/58aaf76b.html alt="Flink 基礎學習(七) 窗口 Window" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a5ba05cd74894e939e1a8fb461677d41 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/58aaf76b.html title="Flink 基礎學習(七) 窗口 Window">Flink 基礎學習(七) 窗口 Window</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7bf5ff7.html alt=成立8年，Lyft二季度仍虧損4.371億美元，與Uber“同病相憐” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f4d2badedb054ba5b291d4a8031cdf80 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7bf5ff7.html title=成立8年，Lyft二季度仍虧損4.371億美元，與Uber“同病相憐”>成立8年，Lyft二季度仍虧損4.371億美元，與Uber“同病相憐”</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/5128f9e.html alt=青海首次發現大規模白藍翠雀花群落 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/dfbb1223f7544da98d116ffb164ffdee style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/5128f9e.html title=青海首次發現大規模白藍翠雀花群落>青海首次發現大規模白藍翠雀花群落</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/71aa4d1.html alt=碧桂園大規模架構調整：區域公司合併整合，38名高管換防 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/71aa4d1.html title=碧桂園大規模架構調整：區域公司合併整合，38名高管換防>碧桂園大規模架構調整：區域公司合併整合，38名高管換防</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>