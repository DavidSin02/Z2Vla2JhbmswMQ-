<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ååˆ†é˜å­¸æœƒæœ‰é™ç‹€æ…‹æ©Ÿçš„å¯¦ç¾åŸç† | æå®¢å¿«è¨Š</title><meta property="og:title" content="ååˆ†é˜å­¸æœƒæœ‰é™ç‹€æ…‹æ©Ÿçš„å¯¦ç¾åŸç† - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/67db0a1f58fe43878523eb9e1b738b2c"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c0b4132.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c0b4132.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c0b4132.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c0b4132.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c0b4132.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c0b4132.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c0b4132.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c0b4132.html><meta property="article:published_time" content="2020-10-29T20:59:15+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:15+08:00"><meta name=Keywords content><meta name=description content="ååˆ†é˜å­¸æœƒæœ‰é™ç‹€æ…‹æ©Ÿçš„å¯¦ç¾åŸç†"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/c0b4132.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ååˆ†é˜å­¸æœƒæœ‰é™ç‹€æ…‹æ©Ÿçš„å¯¦ç¾åŸç†</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div class=pgc-img><img alt=ååˆ†é˜å­¸æœƒæœ‰é™ç‹€æ…‹æ©Ÿçš„å¯¦ç¾åŸç† onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/67db0a1f58fe43878523eb9e1b738b2c><p class=pgc-img-caption></p></div><p>åœ¨å­¸ç¿’ç‹€æ…‹æ©Ÿå¯¦ç¾åŸç†ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆäº†è§£ç‹€æ…‹æ©Ÿçš„äº”å€‹å®šç¾©å¦‚ä¸‹ï¼š</p><ul><li>å®šç¾©ä¸€ï¼šæœ‰é™çš„ç‹€æ…‹</li><li>å®šç¾©äºŒï¼šæœ‰é™çš„äº‹ä»¶</li><li>å®šç¾©ä¸‰ï¼šä¸€å€‹åˆå§‹ç‹€æ…‹</li><li>å®šç¾©å››ï¼šè®Šæ›å™¨ï¼ˆçµ¦å®šç•¶å‰ç‹€æ…‹ + äº‹ä»¶ï¼Œå¯ä»¥å¾—å‡ºä¸‹å€‹ç‹€æ…‹ï¼‰</li><li>å®šç¾©äº”ï¼šè‹¥å¹²å€‹ï¼ˆæˆ–ç„¡ï¼‰çš„æœ€çµ‚ç‹€æ…‹</li></ul><p>ç„¶å¾Œæˆ‘å€‘ä¾æ“šç‹€æ…‹æ©Ÿçš„å®šç¾©é€²è¡Œé€å€‹åˆ†æã€‚</p><h2 class=pgc-h-arrow-right>å®šç¾©è§£è®€</h2><h3 class=pgc-h-arrow-right>å®šç¾©ä¸€ï¼šæœ‰é™çš„ç‹€æ…‹</h3><p>ç‹€æ…‹æ©Ÿä¹‹æ‰€ä»¥é€™æ¨£å‘½åï¼Œå¤§ç•¥éƒ½å¯ä»¥ç†è§£ç‚ºç®¡ç†â€œç‹€æ…‹â€çš„æ©Ÿå™¨ã€‚å¾å·¥æ¥­ç”Ÿç”¢å¯ç”¨æ€§çš„è§’åº¦ä¾†çœ‹ï¼Œä»»ä½•äº‹ç‰©éƒ½æ˜¯å¯ä»¥ <strong>è¿‘ä¼¼</strong> çœ‹åšæœ‰é™çš„ç‹€æ…‹çš„ã€‚</p><p>æ€éº¼ç†è§£å‘¢ï¼Ÿæ¯”å¦‚ä¸€æ¯æ°´çš„æº«åº¦å¯ä»¥ç®—ä½œå®ƒçš„ç‹€æ…‹ï¼Œç†è«–ä¸Šæº«åº¦çš„å€¼æ˜¯ç„¡é™çš„ï¼Œæ¯”å¦‚æˆ‘å¯ä»¥èªªæ°´çš„æº«åº¦å¾ 30Â° å‡åˆ°äº† 30.0001Â° ä¹Ÿç®—æ˜¯ç‹€æ…‹è®ŠåŒ–ï¼Œä½†æ˜¯æˆ‘å€‘åœ¨æ™®éå ´æ™¯ä¸‹ï¼Œå°æ°´çš„æº«åº¦ç²¾åº¦ä¸¦ä¸æœƒè¦æ±‚å¾ˆé«˜ã€‚</p><p>å› æ­¤æˆ‘å€‘å¯ä»¥å®šç¾©ç‚ºæ°´çš„æ¯ 1Â° å°±æ˜¯ä¸€å€‹ç‹€æ…‹ï¼Œä¸¦ä¸”æˆ‘å€‘åªé—œæ³¨ 0Â° ~ 100Â°ã€‚å› æ­¤æ°´çš„æº«åº¦ç‹€æ…‹å°±åªæœ‰ 100 å€‹ï¼Œå¾è€Œè¡¨é”äº† <strong>æœ‰é™</strong> çš„æ¦‚å¿µã€‚</p><p>å°æ–¼è¨­è¨ˆå¯¦ç¾ä¾†èªªï¼Œæˆ‘å€‘æ‹¿ç‡ˆæ³¡èˆ‰ä¾‹å­ï¼Œå‡è¨­ç‡ˆæ³¡æœ‰äº®ã€ä¸äº®ã€å£æ‰ä¸‰å€‹ç‹€æ…‹ï¼Œæˆ‘å€‘åƒ…åƒ…ç”¨ä¸€å€‹æ•¸çµ„å°±å¯ä»¥è¡¨é”å®Œé€™å€‹äº‹æƒ…ã€‚</p><pre><code>const lightBulbStates = ['LIT', 'UNLIT', 'BROKEN'];</code></pre><p>ç•¶ç„¶ï¼Œåœ¨å¯¦éš›é–‹ç™¼ä¸­ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥ç”¨å“ˆå¸Œè¡¨æˆ–è€… enum æšèˆ‰æ‰€æœ‰ç‹€æ…‹ã€‚</p><pre><code>const lightBulbStates = {  lit: 'LIT',  unlit: 'UNLIT',  broken: 'BROKEN',};</code></pre><h3 class=pgc-h-arrow-right>å®šç¾©äºŒï¼šæœ‰é™çš„äº‹ä»¶</h3><p>ä»€éº¼æ˜¯äº‹ä»¶ï¼Ÿ</p><p>èˆ‰å€‹ä¾‹å­ï¼šæ¯”å¦‚èªªå°æ˜å¿ƒå¦‚æ­¢æ°´åœ°åœ¨å·¥ä½œï¼Œçªç„¶éš”å£åŒäº‹çµ¦äº†ä»–ä¸€å·´æŒï¼Œå°æ˜æ°£ç‚¸äº†ï¼Œæº–å‚™æ“¼èµ·è¢–å­å»æ‰“æ¶ã€‚</p><p>é€™è£¡å°æ˜å°±æ˜¯ä¸€å€‹ç‹€æ…‹æ©Ÿï¼Œä»–å¾ <strong>å¿ƒå¦‚æ­¢æ°´</strong> çš„ç‹€æ…‹ï¼Œè½‰æ›åˆ°äº† <strong>æ°£ç‚¸äº†</strong> çš„ç‹€æ…‹ï¼Œå…¨å› ç™¼ç”Ÿäº† <strong>è¢«åŒäº‹æ‰‡äº†ä¸€å·´æŒ</strong> çš„äº‹ä»¶ï¼Œä¸¦ä¸”ç”¢ç”Ÿäº† <strong>æº–å‚™å»å¹¹æ¶</strong> çš„è¡Œç‚ºå‰¯ä½œç”¨ã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><p>å¿ƒå¦‚æ­¢æ°´ï¼ˆç‹€æ…‹ï¼‰ + è¢«æ‰‡ä¸€å·´æŒï¼ˆäº‹ä»¶ï¼‰ = æ°£ç‚¸äº†ï¼ˆæ–°çš„ç‹€æ…‹ï¼‰+ æº–å‚™å¹¹æ¶ï¼ˆå‰¯ä½œç”¨ï¼‰ã€‚</p><p>ç•¶ç„¶åŒäº‹ä¹‹é–“é‚„æ˜¯è¦åœ˜çµå‹æ„›å•¦ï¼Œå›å­å‹•å£ä¸å‹•æ‰‹ï¼Œæˆ‘å€‘è¦ä»¥ç†æœäººï¼Œæ˜¯å§ã€‚</p><p>åŸºæ–¼ä¸Šè¿°çš„ä¾‹å­ï¼Œæˆ‘å€‘é€²è¡ŒæŠ½è±¡ï¼Œç¸½çµå¾—å‡ºå…¬å¼å¦‚ä¸‹ï¼š</p><pre><code>state + event = newState + effect</code></pre><p>å› æ­¤ï¼Œå› ç‚ºç‹€æ…‹æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥ç•¶ç„¶äº‹ä»¶ä¹Ÿæ˜¯æœ‰é™çš„ã€‚å°±æ¯”å¦‚åœ–æœ‰ä¸‰å€‹é ‚é»ï¼Œé»ä¹‹é–“çš„é€£ç·šå¦‚æœæœ‰å‘ï¼Œé‚£ä¹Ÿåªæœ‰å…­æ¢ç·šï¼ˆ2 ^ 3 = 6ï¼‰ï¼Œé€™å¾ˆå¥½ç†è§£ã€‚</p><p>å†çµåˆåˆ°æˆ‘å€‘çš„ç‡ˆæ³¡ç‹€æ…‹æ©Ÿä¾†çœ‹ï¼Œå®ƒçš„äº‹ä»¶æœ‰å¦‚ä¸‹å¹¾ç¨®ï¼š</p><pre><code>unlit + TOGGLE = lit + effectlit + TOGGLE = unlit + effectunlit + BREAK = broken + effectlit + BREAK = broken + effect</code></pre><p>æˆ‘å€‘æ•´ç†ä¸€ä¸‹ï¼Œç”¨ JavaScript å°è±¡ä¾†è¡¨è¿°é€™å€‹äº‹æƒ…ï¼š</p><pre><code>const lightBulbEventMap = {  unlit: {    on: {      TOGGLE: 'lit',      BREAK: 'broken',    },  },  lit: {    on: {      TOGGLE: 'unlit',      BREAK: 'broken',    },  },  broken: {},};</code></pre><p>é€™æ¨£ç‹€æ…‹èˆ‡äº‹ä»¶ä¹‹é–“çš„é—œä¿‚å°±ä¸€ç›®ç­ç„¶äº†ã€‚</p><h3 class=pgc-h-arrow-right>å®šç¾©ä¸‰ï¼šä¸€å€‹åˆå§‹ç‹€æ…‹</h3><p>ç›¤å¤é–‹å¤©ã€å¥³åª§é€ äººã€ä¼Šç”¸åœ’è£¡çš„äºç•¶å¤å¨ƒï¼Œè¬äº‹è¬ç‰©éƒ½æœ‰ä¸€å€‹åˆå§‹ç‹€æ…‹ã€‚å°±åƒäººçš„ä¸€ç”Ÿä¹Ÿæœƒå¾å‘±å‘±è½åœ°é–‹å§‹ï¼Œåˆ°åŒ–ä½œä¸€æŠ”é»ƒåœŸçµæŸï¼Œæ•´å€‹éç¨‹æ˜¯éš¨æ™‚é–“æµé€è€Œä¸æ–·è®Šæ›çš„ï¼Œæˆ‘å€‘ä¸å¯èƒ½ç›´æ¥ç¹éé–‹å§‹ï¼Œç›´æ¥åˆ°ä¸­é–“æŸå€‹ç¯€é»ã€‚</p><p>å°æ–¼ç‹€æ…‹æ©Ÿä¾†èªªä¹Ÿæ˜¯å¦‚æ­¤ã€‚ç‡ˆæ³¡è²·å›ä¾†ä¸€èˆ¬è™•æ–¼æœªé»äº®çš„ç‹€æ…‹ï¼ˆæ­£å¸¸ä¾†èªªï¼‰ã€‚å› æ­¤ï¼Œæˆ‘å€‘é‚„æ˜¯ç”¨ JavaScript å°è±¡ä¾†è¡¨è¿°é€™å€‹äº‹æƒ…ï¼š</p><pre><code>const lightBulbMachine = {  initial: 'unlit',  states: {    unlit: {      on: {        TOGGLE: 'lit',        BREAK: 'broken',      },    },    lit: {      on: {        TOGGLE: 'unlit',        BREAK: 'broken',      },    },    broken: {},  },};</code></pre><h3 class=pgc-h-arrow-right>å®šç¾©å››ï¼šè®Šæ›å™¨ï¼ˆçµ¦å®šç•¶å‰ç‹€æ…‹ + äº‹ä»¶ï¼Œå¯ä»¥å¾—å‡ºä¸‹å€‹ç‹€æ…‹ï¼‰</h3><p>å…¶å¯¦åˆ°é€™è£¡æˆ‘å€‘å·²ç¶“æŠŠç‡ˆæ³¡çš„ç‹€æ…‹ã€äº‹ä»¶éƒ½å®šç¾©å®Œäº†ã€‚ä½†æˆ‘å€‘ä»ç„¶éœ€è¦çµ¦å‡ºè®Šæ›å™¨çš„å¯¦ç¾ï¼Œç”¨ä»¥å¯¦ç¾ç‹€æ…‹èˆ‡ç‹€æ…‹ä¹‹å‰çš„éæ¸¡ã€‚</p><p>è®Šæ›å™¨å¯¦ç¾è¤‡é›œéº¼ï¼Ÿä¸ï¼Œä¸€é»ä¹Ÿä¸ã€‚è«‹çœ‹ï¼š</p><pre><code>function transition(state, event) {  return machine.states[state].on[event];}</code></pre><p>ç„¶å¾Œæˆ‘å€‘å¯ä»¥ç”¨è®Šæ›å™¨å‡½æ•¸å°ç‡ˆæ³¡çš„ç‹€æ…‹é€²è¡Œé‹ç®—</p><pre><code>const newState = transition('unlit', 'TOGGLE'); // lit</code></pre><p>æˆ–è€…~</p><pre><code>const newState = transition('lit', 'BREAK'); // broken</code></pre><p>å‡å¦‚ç‡ˆæ³¡å£äº†ï¼Œæˆ‘å€‘é‚„æ˜¯æƒ³é»äº®å®ƒï¼Œæ€éº¼è¾¦ï¼Ÿ</p><pre><code>const newState = transition('broken', 'TOGGLE'); // Throw error</code></pre><p>ç‹€æ…‹æ©Ÿå‘Šè¨´ä½ ï¼Œç—´å¿ƒå¦„æƒ³ï¼</p><h3 class=pgc-h-arrow-right>å®šç¾©äº”ï¼šè‹¥å¹²å€‹ï¼ˆæˆ–ç„¡ï¼‰çš„æœ€çµ‚ç‹€æ…‹</h3><p>å‰é¢èªªåˆ°è¬äº‹è¬ç‰©éƒ½æœ‰èµ·é»ï¼Œæ‰€ä»¥æŒ‰é“ç†ä¾†èªªï¼Œæ‡‰è©²ä¹Ÿå¿…ç„¶æœ‰çµ‚é»ã€‚ä½†æ˜¯è€ƒæ…®åˆ°å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œå…¶å¯¦æŠ½è±¡ä¾†èªªæœªå¿…éœ€è¦ä¸€å€‹çµ‚é»ã€‚å°±æ¯”å¦‚ç¶²ç«™ç”¨æˆ¶å¯ä»¥ç™»éŒ„ã€æ¼«éŠã€é€€å‡ºã€å†ç™»éŒ„ã€å†æ¼«éŠç­‰ç­‰ï¼Œå®ƒä¸¦æ²’æœ‰ä¸€å€‹å¯¦éš›çš„çµ‚é»ã€‚</p><p>ä½†æ˜¯ä¹Ÿå¯ä»¥æœ‰çµ‚é»ã€‚æ¯”å¦‚ Promise è«‹æ±‚ï¼Œå¾ init åˆ° pendingï¼Œå†è¿”å› resolve ä»£è¡¨æˆåŠŸï¼Œæˆ–è€… reject ä»£è¡¨å¤±æ•—ã€‚å®ƒæœ‰å…©å€‹çµ‚é»ã€‚</p><p>æ¯”å¦‚äººå¾å‡ºç”Ÿåˆ°é€å»ï¼Œå®è§€ä¸Šä¾†èªªï¼Œåˆ†åˆ¥å°æ‡‰è‘—åˆå§‹ç‹€æ…‹ã€æœ€çµ‚ç‹€æ…‹ã€‚</p><p>æˆ‘å€‘é‚„æ˜¯å›åˆ°æˆ‘å€‘çš„ç‡ˆæ³¡ç‹€æ…‹æ©Ÿï¼Œbroken å°±æ˜¯å®ƒçš„æœ€çµ‚ç‹€æ…‹ã€‚ç‹€æ…‹æ©Ÿä¸€æ—¦æŠµé”åˆ°æœ€çµ‚çš„ç‹€æ…‹ï¼Œå°±ç›¸ç•¶æ–¼çµæŸäº†ã€‚</p><pre><code>const lightBulbMachine = {  initial: 'unlit',  states: {    // ...    broken: {      type: 'final',    },  },};</code></pre><h2 class=pgc-h-arrow-right>ç‹€æ…‹æ©Ÿæœ€ç°¡å–®å¯¦ç¾</h2><p>ä¾†ï¼Œè®“æˆ‘å€‘å¯¦ç¾ä¸€å€‹ç‹€æ…‹æ©Ÿå§ï¼</p><pre><code>function createMachine({ initial, states }) {  const machine = {    initialState: initial,    transition: (state, event) =&gt; states[state].on[event]  };  return machine;}</code></pre><p>åŒå­¸å€‘è‚¯å®šæœƒè¦ºå¾—ï¼Œå°±é€™éº¼ç°¡å–®éº¼ï¼Ÿå…¶å¯¦æœ¬è³ªä¸Šå°±é€™æ¨£ã€‚é›–ç„¶å¦‚æ­¤ç°¡å–®çš„å¯¦ç¾ï¼Œæ˜¯çµ•å°ä¸èƒ½æ”¯æ’èµ·æˆ‘å€‘è¤‡é›œçš„æ¥­å‹™å ´æ™¯éœ€æ±‚çš„ã€‚ä½†æ˜¯ä¸€æ—¦åªè¦æ˜ç™½äº†æœ¬è³ªï¼Œæ“´å±•çš„å¯¦ç¾ç†è§£èµ·ä¾†ä¹Ÿä¸æœƒå¾ˆå›°é›£ã€‚</p><h2 class=pgc-h-arrow-right>å‰¯ä½œç”¨</h2><p>ä¸Šæ–‡çš„ç‹€æ…‹æ©Ÿå¯¦ç¾å…¶å¯¦æœ¬è³ªä¸Šæ˜¯å€‹ç´”å‡½æ•¸ï¼Œä½†æˆ‘å€‘ä»”ç´°è§€å¯Ÿä¸Šæ–‡æåˆ°éçš„å…¬å¼ã€‚</p><pre><code>state + event = newState + effect</code></pre><p>é—œæ–¼å‰¯ä½œç”¨æˆ‘å€‘å»éš»å­—æœªæã€‚åœ¨å¤§å‹çš„æ‡‰ç”¨ä¸­ï¼Œå‰¯ä½œç”¨æ˜¯åˆ°è™•å­˜åœ¨çš„ï¼Œæ¯”å¦‚ç¶²çµ¡è«‹æ±‚ã€æœ¬åœ°æ—¥èªŒå­˜å„²ã€éŒ¯èª¤è¼¸å‡ºã€DOM æ“ä½œã€æ•¸æ“šåº«å¯«å…¥ã€äº‹ä»¶è¨»å†Šç›£è½ã€‚</p><p>ç´”å‡½æ•¸å¯ä»¥æé«˜æˆ‘å€‘ä»£ç¢¼çš„è³ªé‡ï¼Œä½†æ˜¯å»ä¸èƒ½è¡¨é”è¤‡é›œçš„æ¥­å‹™ã€‚</p><p>ç‹€æ…‹æ©Ÿä¹Ÿæ˜¯å¦‚æ­¤ã€‚ç‹€æ…‹æ©Ÿå¯ä»¥é€šéè¨»å†Šæ´»å‹•ï¼ˆActivitiesï¼‰ã€ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ã€è¨‚é–±ç‹€æ…‹æ©Ÿæœå‹™ï¼ˆService.subscribeï¼‰ç­‰æ–¹å¼é€²è¡Œè¡¨é”å‰¯ä½œç”¨ã€‚</p><p>é€™äº›éƒ½å¯ä»¥å» <strong>XState Docs</strong> XState å®˜ç¶²é€²è¡Œå­¸ç¿’ç­è§£ã€‚</p><h2 class=pgc-h-arrow-right>æºç¢¼è§£è®€</h2><p>é€™è£¡è²¼ä¸Šäº†æœ€ç°¡å–®çš„ç‹€æ…‹æ©Ÿå¯¦ç¾ï¼ˆ@xstate/fsmï¼‰çš„è¨»é‡‹ã€‚é™¤äº†åŒ…å«äº†ä¸Šè¿°æœ€åŸºæœ¬çš„äº”å€‹å®šç¾©ã€é‚„æœ‰æ“´å±•ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ã€æ¢ä»¶å®ˆè­·ï¼ˆcondï¼‰ã€ç‹€æ…‹æ©Ÿè§£é‡‹æœå‹™ï¼ˆserviceï¼‰ç­‰ã€‚</p><p>å°ç‹€æ…‹æ©Ÿæ›´é€²ä¸€æ­¥å¯¦ç¾æ„Ÿèˆˆè¶£çš„åŒå­¸å¯ä»¥é–±è®€ã€‚</p><pre><code>// xstate.jsimport {  toTransitionObject, toActionObject, toEventObject, toArray, isString, isFunction} from './util';const INIT_EVENT = { type: 'xstate.init' };const ASSIGN_ACTION = 'xstate.assign';function createMatcher(value) {  return stateValue =&gt; value === stateValue;}function createUnchangedState(value, context) {  return {    value,    context,    actions: [],    changed: false,    matches: createMatcher(value)  };}export function assign(assignment) {  return {    type: ASSIGN_ACTION,    assignment  }}export function execActions(state, event) {  state.actions.forEach(({ exec }) =&gt; {    exec &amp;&amp; exec(state.context, event);  });}// é€šéç´„å®šçš„ç‹€æ…‹æ©Ÿé…ç½®ï¼Œç”Ÿç”¢ä¸€å€‹æœ‰é™ç‹€æ…‹æ©Ÿ// ç‹€æ…‹æ©Ÿå®šç¾©å¦‚ä¸‹ï¼š// - å®šç¾©ä¸€ï¼šæœ‰é™çš„ç‹€æ…‹// - å®šç¾©äºŒï¼šæœ‰é™çš„äº‹ä»¶// - å®šç¾©ä¸‰ï¼šä¸€å€‹åˆå§‹ç‹€æ…‹// - å®šç¾©å››ï¼šè®Šæ›å™¨ï¼ˆçµ¦å®šç•¶å‰ç‹€æ…‹ + äº‹ä»¶ï¼Œå¯ä»¥å¾—å‡ºä¸‹å€‹ç‹€æ…‹ï¼‰// - å®šç¾©äº”ï¼šè‹¥å¹²å€‹ï¼ˆæˆ–ç„¡ï¼‰çš„æœ€çµ‚ç‹€æ…‹export function createMachine(fsmConfig, options = {}) {  function getCombinedActions({ states, initial }) {    const entryAction = states[initial].entry;    return toArray(      entryAction    ).map(action =&gt; toActionObject(action, options.actions));  }  function getContext() {    return fsmConfig.context || {};  }  const machine = {    _options: options,    config: fsmConfig,    // å¯¦ç¾å®šç¾©ä¸‰ - ä¸€å€‹åˆå§‹ç‹€æ…‹ç¯€é»    initialState: {      // ç‹€æ…‹å€¼      value: fsmConfig.initial,      // äº‹ä»¶      actions: getCombinedActions(fsmConfig),      // ä¸Šä¸‹æ–‡      context: getContext(),      // ç‹€æ…‹åŒ¹é…åˆ¤æ–·æ–¹æ³•      matches: createMatcher(fsmConfig.initial)    },    // å¯¦ç¾å®šç¾©å›› - è®Šæ›å™¨    transition: (state, event) =&gt; {      const { value, context } = isString(state) ?        { value: state, context: getContext() } : state;      const eventObject = toEventObject(event);      const stateConfig = fsmConfig.states[value];      if (stateConfig.on) {        // æ ¹æ“šäº‹ä»¶é¡å‹å–å¾—å°æ‡‰çš„è®Šæ›å™¨        const transitions = toArray(stateConfig.on[eventObject.type]);        for (const transtion of transitions) {          // å¯¦éš›ä¸Šæ²’æœ‰ä»»ä½•è®Šæ›å™¨ã€æˆ–ä½¿ç”¨ undefined ä¸­æ–·äº†è®Šæ›å™¨          if (transtion === undefined) {            return createUnchangedState(value, context);          }          const { target = value, actions = [], cond = () =&gt; true } = toTransitionObject(transtion);          let nextContext = context;          // æ¢ä»¶å®ˆè­·ï¼Œåªè¦æ»¿è¶³ä¸€å€‹è®Šæ›å™¨ï¼Œç›´æ¥é€€å‡º          if (cond(context, eventObject)) {            // åˆ¤æ–·ä¸Šä¸‹æ–‡æ˜¯å¦è¢«ä¿®æ”¹            let assigned = false;            // ç²å–ä¸‹å€‹ç‹€æ…‹å°è±¡ç¯€é»            const nextStateConfig = fsmConfig.states[target];            const allActions = []              // ä¾æ¬¡é€²è¡Œç•¶å‰ç‹€æ…‹çš„ Exit Actionã€ç•¶å‰ç‹€æ…‹çš„ Action é›†åˆã€ä¸‹å€‹ç‹€æ…‹çš„ Entry Action              .concat(                stateConfig.exit, actions, nextStateConfig.entry              )              // éæ¿¾å‡å€¼              .filter(a =&gt; a)              // å°‹æ‰¾ Action é…ç½®ï¼Œè¿”å›çµ±ä¸€æ ¼å¼çš„ Action å°è±¡              .map(action =&gt; toActionObject(action, machine._options.actions))              // å…§éƒ¨äº‹ä»¶ï¼Œæ”¯æŒ assign å‡½æ•¸ä¿®æ”¹ä¸Šä¸‹æ–‡              .filter(action =&gt; {                if (action.type === ASSIGN_ACTION) {                  assigned = true;                  let tmpContext = Object.assign({}, nextContext);                  if (isFunction(action.assignment)) {                    tmpContext = action.assignment(nextContext, eventObject);                  } else {                    Object.keys(action.assignment).forEach(key =&gt; {                      const assignment = action.assignment[key];                      tmpContext[key] = isFunction(assignment) ? assignment(nextContext, eventObject) : assignment                    });                  }                  nextContext = tmpContext;                  return false;                }                return true;              });            return {              value: target,              context: nextContext,              actions: allActions,              changed: target !== value || allActions.length &gt; 0 || assigned,              matches: createMatcher(target)            };          }        }      }      // ç‹€æ…‹ç¯€é»æœªè¨»å†Šä»»ä½•è®Šæ›å™¨ã€æ¢ä»¶å®ˆè­·æœªæ»¿è¶³ï¼Œå°è‡´åœç•™åœ¨åŸæœ¬çš„ç‹€æ…‹ç¯€é»      return createUnchangedState(value, context);    }  };  return machine;}// ç‹€æ…‹æ©Ÿæœå‹™çš„ç‹€æ…‹export const INTERPRETER_STATUS = {  NotStarted: 0,  Running: 1,  Stopped: 2};// å°‡ Machine è§£é‡‹ç‚ºä¸€å€‹ç‹€æ…‹æ©Ÿæœå‹™ï¼Œæ‡‰ç”¨æ–¼å¯¦éš›ç”Ÿç”¢ç’°å¢ƒexport function interpret(machine) {  let state = machine.initialState;  let status = INTERPRETER_STATUS.NotStarted;  // ç”¨ä»¥è¨‚é–±ç‹€æ…‹æ©Ÿæœå‹™  const listeners = new Set();  const service = {    _machine: machine,    send(event) {      // ç‹€æ…‹æ©Ÿæœå‹™æœªå•Ÿå‹•æ™‚ï¼Œä¸å…è¨±ç™¼é€äº‹ä»¶      if (status !== INTERPRETER_STATUS.Running) {        return;      }      // é€šéè®Šæ›å™¨æ›´æ–°ç‹€æ…‹      state = machine.transition(state, event);      // åŸ·è¡Œç•¶å‰ç‹€æ…‹çš„æ‰€æœ‰ Actionï¼ˆAction é›†åˆåœ¨ Machine ä¸­å·²é€²è¡Œè¨ˆç®—ï¼‰      execActions(state, toEventObject(event));      listeners.forEach((listener) =&gt; listener(state));      return service;    },    subscribe: (listener) =&gt; {      listeners.add(listener);      listener(state);      return {        unsubscribe: () =&gt; listeners.delete(listener)      };    },    // ç‹€æ…‹æ©Ÿæœå‹™å•Ÿå‹•    start: () =&gt; {      status = INTERPRETER_STATUS.Running;      execActions(state, INIT_EVENT);      return service;    },    // ç‹€æ…‹æ©Ÿæœå‹™æš«åœ    stop: () =&gt; {      status = INTERPRETER_STATUS.Stopped;      listeners.clear();      return service;    },    get state() {      return state;    },    get status() {      return status;    }  };  return service;}export const Machine = createMachine;</code></pre><pre><code>// util.jsexport function toArray(item) {  return item === undefined ? [] : [].concat(item);}export function isString(o) {  return typeof o === 'string';}export function isFunction(o) {  return typeof o === 'function';}export function toActionObject(action, actionMap = {}) {  action = isString(action) &amp;&amp; actionMap[action] ?    actionMap[action] : action;  if (isString(action)) {    return {      type: action    };  } else if (isFunction(action)) {    return {      type: action.name,      exec: action    }  } else {    return action;  }}export function toEventObject(event) {  return isString(event) ? { type: event } : event;}export function toTransitionObject(transition) {  return isString(transition) ? { target: transition } : transition;}</code></pre></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>é˜å­¸æœƒ</a></li><li><a>ç‹€æ…‹æ©Ÿ</a></li><li><a>å¯¦ç¾</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/ef75f18.html alt=ç”¨Cèªè¨€å¯¦ç¾æœ‰é™ç‹€æ…‹æ©Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ef75f18.html title=ç”¨Cèªè¨€å¯¦ç¾æœ‰é™ç‹€æ…‹æ©Ÿ>ç”¨Cèªè¨€å¯¦ç¾æœ‰é™ç‹€æ…‹æ©Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f09ac34c.html alt=å½©è‰²é›»å­æ›¸åœ¨å»£å·ç‡å…ˆå¯¦ç¾é‡ç”¢ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RkPMb9G6tipobr style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f09ac34c.html title=å½©è‰²é›»å­æ›¸åœ¨å»£å·ç‡å…ˆå¯¦ç¾é‡ç”¢>å½©è‰²é›»å­æ›¸åœ¨å»£å·ç‡å…ˆå¯¦ç¾é‡ç”¢</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2d12804e.html alt=[ç©è½‰MySQLä¹‹ä¹]MySQLå¯¦ç¾ACIDä¹‹åŸå­æ€§ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bdb044d821f74107a3fd9119fc34c642 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2d12804e.html title=[ç©è½‰MySQLä¹‹ä¹]MySQLå¯¦ç¾ACIDä¹‹åŸå­æ€§>[ç©è½‰MySQLä¹‹ä¹]MySQLå¯¦ç¾ACIDä¹‹åŸå­æ€§</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fb2bc471.html alt="ã€Œè­¯ã€ Spring çš„åˆ†ä½ˆå¼äº‹å‹™å¯¦ç¾â€”ä½¿ç”¨å’Œä¸ä½¿ç”¨ XAâ€”ç¬¬äºŒéƒ¨åˆ†" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fb2bc471.html title="ã€Œè­¯ã€ Spring çš„åˆ†ä½ˆå¼äº‹å‹™å¯¦ç¾â€”ä½¿ç”¨å’Œä¸ä½¿ç”¨ XAâ€”ç¬¬äºŒéƒ¨åˆ†">ã€Œè­¯ã€ Spring çš„åˆ†ä½ˆå¼äº‹å‹™å¯¦ç¾â€”ä½¿ç”¨å’Œä¸ä½¿ç”¨ XAâ€”ç¬¬äºŒéƒ¨åˆ†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e41fd8de.html alt="æ’«é †å„é …é˜²æ±›å·¥ä½œå¯¦ç¾â€œå…­åˆ°ä½â€ ç¢ºä¿å…¨å¸‚å®‰å…¨åº¦æ±›" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e41fd8de.html title="æ’«é †å„é …é˜²æ±›å·¥ä½œå¯¦ç¾â€œå…­åˆ°ä½â€ ç¢ºä¿å…¨å¸‚å®‰å…¨åº¦æ±›">æ’«é †å„é …é˜²æ±›å·¥ä½œå¯¦ç¾â€œå…­åˆ°ä½â€ ç¢ºä¿å…¨å¸‚å®‰å…¨åº¦æ±›</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f22ee5ad.html alt="Redis è¨­è¨ˆèˆ‡å¯¦ç¾ : Lua è…³æœ¬" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f22ee5ad.html title="Redis è¨­è¨ˆèˆ‡å¯¦ç¾ : Lua è…³æœ¬">Redis è¨­è¨ˆèˆ‡å¯¦ç¾ : Lua è…³æœ¬</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/56e2a065.html alt=é€™ä½å¤§å”åœ¨éš¨æ©Ÿçš„å½©ç¥¨ä¸Šå¯¦ç¾äº†90%çš„ä¸­çç‡ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/50ab0003166decded7e4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/56e2a065.html title=é€™ä½å¤§å”åœ¨éš¨æ©Ÿçš„å½©ç¥¨ä¸Šå¯¦ç¾äº†90%çš„ä¸­çç‡>é€™ä½å¤§å”åœ¨éš¨æ©Ÿçš„å½©ç¥¨ä¸Šå¯¦ç¾äº†90%çš„ä¸­çç‡</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cf633068.html alt="Java å¤šæ…‹çš„å¯¦ç¾æ©Ÿåˆ¶ï¼Œçœ‹äº†éƒ½èªªå¥½" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9d3b0e55813d46b4982ae7d9b81d1802 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cf633068.html title="Java å¤šæ…‹çš„å¯¦ç¾æ©Ÿåˆ¶ï¼Œçœ‹äº†éƒ½èªªå¥½">Java å¤šæ…‹çš„å¯¦ç¾æ©Ÿåˆ¶ï¼Œçœ‹äº†éƒ½èªªå¥½</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d0662f03.html alt="å»£è¥¿éµè·¯å‡ºæµ·å¤§é€šé“ å…¨é¢å¯¦ç¾é›»æ°£åŒ–é‹ç‡Ÿ" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d0662f03.html title="å»£è¥¿éµè·¯å‡ºæµ·å¤§é€šé“ å…¨é¢å¯¦ç¾é›»æ°£åŒ–é‹ç‡Ÿ">å»£è¥¿éµè·¯å‡ºæµ·å¤§é€šé“ å…¨é¢å¯¦ç¾é›»æ°£åŒ–é‹ç‡Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c78a6fe2.html alt=HashMapçš„åº•å±¤å¯¦ç¾ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/0f9ffe95e10e4ff5804a8fd9cf591cfc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c78a6fe2.html title=HashMapçš„åº•å±¤å¯¦ç¾>HashMapçš„åº•å±¤å¯¦ç¾</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7c3d9f70.html alt=æ–°ç©çš„æ··åˆææ–™æˆ–æœ‰åŠ©æ–¼å¯¦ç¾é«˜æ•ˆçš„ä¸‹ä¸€ä»£é¡¯ç¤ºå™¨ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/47050004da4f36dcec1b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7c3d9f70.html title=æ–°ç©çš„æ··åˆææ–™æˆ–æœ‰åŠ©æ–¼å¯¦ç¾é«˜æ•ˆçš„ä¸‹ä¸€ä»£é¡¯ç¤ºå™¨>æ–°ç©çš„æ··åˆææ–™æˆ–æœ‰åŠ©æ–¼å¯¦ç¾é«˜æ•ˆçš„ä¸‹ä¸€ä»£é¡¯ç¤ºå™¨</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8d93e49d.html alt=æ•™ç¨‹ï¼šæ¡ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•å¯¦ç¾ç·šæ€§è¿´æ­¸ï¼ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1537162000876f4501fb1c4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8d93e49d.html title=æ•™ç¨‹ï¼šæ¡ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•å¯¦ç¾ç·šæ€§è¿´æ­¸ï¼>æ•™ç¨‹ï¼šæ¡ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•å¯¦ç¾ç·šæ€§è¿´æ­¸ï¼</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e8e17d90.html alt=é‡è¦çªç ´ï¼ä¸­åœ‹ç§‘å­¸å®¶å¯¦ç¾åŸºåº•ç´°èƒç™Œ4.1ç§’äººå·¥æ™ºèƒ½ç²¾æº–è­˜åˆ¥ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RtbWBYL9koJMmN style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e8e17d90.html title=é‡è¦çªç ´ï¼ä¸­åœ‹ç§‘å­¸å®¶å¯¦ç¾åŸºåº•ç´°èƒç™Œ4.1ç§’äººå·¥æ™ºèƒ½ç²¾æº–è­˜åˆ¥>é‡è¦çªç ´ï¼ä¸­åœ‹ç§‘å­¸å®¶å¯¦ç¾åŸºåº•ç´°èƒç™Œ4.1ç§’äººå·¥æ™ºèƒ½ç²¾æº–è­˜åˆ¥</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1b218e68.html alt=åœ–åƒæ‹¼æ¥ç®—æ³•åŠå¯¦ç¾ï¼ˆä¸€ï¼‰ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1534489824878547eee8fc2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1b218e68.html title=åœ–åƒæ‹¼æ¥ç®—æ³•åŠå¯¦ç¾ï¼ˆä¸€ï¼‰>åœ–åƒæ‹¼æ¥ç®—æ³•åŠå¯¦ç¾ï¼ˆä¸€ï¼‰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c9eb3d63.html alt=PHPå¯¦ç¾å„ç¨®ç¶“å…¸ç®—æ³•è©³è§£ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15357595091626cf296dc3e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c9eb3d63.html title=PHPå¯¦ç¾å„ç¨®ç¶“å…¸ç®—æ³•è©³è§£>PHPå¯¦ç¾å„ç¨®ç¶“å…¸ç®—æ³•è©³è§£</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>