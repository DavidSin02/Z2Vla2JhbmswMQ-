<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>靜態路由理論知識詳解 | 极客快訊</title><meta property="og:title" content="靜態路由理論知識詳解 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/1ce05bb5a66c4d31bba69935dc51c710"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c62a080.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c62a080.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c62a080.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c62a080.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c62a080.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c62a080.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c62a080.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c62a080.html><meta property="article:published_time" content="2020-10-29T21:04:00+08:00"><meta property="article:modified_time" content="2020-10-29T21:04:00+08:00"><meta name=Keywords content><meta name=description content="靜態路由理論知識詳解"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/c62a080.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>靜態路由理論知識詳解</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p><strong>一、簡介</strong></p><p>靜態路由是一種需要管理員手工配置的特殊路由。</p><p>靜態路由在不同網絡環境中有不同的目的：</p><p>當網絡結構比較簡單時，只需配置靜態路由就可以使網絡正常工作。</p><p>在複雜網絡環境中，配置靜態路由可以改進網絡的性能，並可為重要的應用保證帶寬。</p><p>靜態路由可在VPN實例中使用，主要用於VPN路由的管理。</p><p><strong>二、原理</strong></p><p>一、靜態路由基礎</p><p>路由器根據路由轉發數據包，路由可通過手動配置和使用動態路由算法計算產生，其中手動配置產生的路由就是靜態路由。</p><p>靜態路由比動態路由使用更少的帶寬，並且不佔用CPU資源來計算和分析路由更新。但是當網絡發生故障或者拓撲發生變化後，靜態路由不會自動更新，必須手動重新配置。</p><p>靜態路由有5個主要的參數：目的地址和掩碼、出接口和下一跳、優先級。</p><p><strong>1、目的地址和掩碼</strong></p><p>IPv4的目的地址為點分十進制格式，掩碼可以用點分十進制表示，也可用掩碼長度（即掩碼中連續‘1’的位數）表示。當目的地址和掩碼都為零時，表示靜態缺省路由。</p><p><strong></strong></p><p><strong>2、出接口和下一跳地址</strong></p><p>在配置靜態路由時，根據不同的出接口類型，指定出接口和下一跳地址。</p><p>1、對於點到點類型的接口，只需指定出接口。</p><p>因為指定發送接口即隱含指定了下一跳地址，這時認為與該接口相連的對端接口地址就是路由的下一跳地址。如10GE封裝PPP（Point-to-Point Protocol）協議，通過PPP協商獲取對端的IP地址，這時可以不指定下一跳地址。</p><p>2、對於NBMA（Non Broadcast Multiple Access）類型的接口（如ATM接口），只需配置下一跳。</p><p>因為除了配置IP路由外，還需在鏈路層建立IP地址到鏈路層地址的映射。</p><p>3、對於廣播類型的接口（如以太網接口）和VT（Virtual-template）接口，必須指定通過該接口發送時對應的下一跳地址。</p><p>因為以太網接口是廣播類型的接口，而VT接口下可以關聯多個虛擬訪問接口（Virtual Access Interface），這都會導致出現多個下一跳，無法唯一確定下一跳。</p><p><strong>3、靜態路由優先級</strong></p><p>對於不同的靜態路由，可以為它們配置不同的優先級，優先級數字越小優先級越高。配置到達相同目的地的多條靜態路由，如果指定相同優先級，則可實現負載分擔；如果指定不同優先級，則可實現路由備份。</p><p><strong>4、靜態路由的特點</strong></p><p>1、手動配置</p><p>2、路由路徑固定（除非手動修改）</p><p>3、不可通告</p><p>不會主動通告給其他路由器。但管理員可以在本地設備的動態路由中引入靜態路由，然後以對應動態協議路由進行通告。</p><p>4、單向性</p><p>僅為數據提供沿著下一跳的方向進行路由，不提供反向路由。如果要使源節點域目標網絡進行雙向通信，必須同時配置回程靜態路由</p><p>5、接力性</p><p>如果某條靜態路由中間經過的跳數大於1（路由要經過3個或以上路由節點），則必須在除最後一個路由器外的其他路由器上<strong>依次配置到達相同目的節點</strong>或目的網絡的靜態路由。</p><p>（路由器各端口上直連的各個網絡都是直連互通的，因此之間默認是直連路由，因而無需另外配置路由。）</p><p>6、迭代性</p><p>理論上來說，靜態路由的下一跳可以是路徑中其他路由器中的任意一個接口，只要能保證路由到達下一跳就行了。（靜態路由沒有建立鄰居關係hello包，也不會被通告鄰居路由，所以他的下一跳純粹是配置的“下一跳IP地址”直接指定的，或者通過出接口間接指定。不是我們平常理解的必須與路由器直連的下一個設備接口。）</p><p>路由迭代</p><p>通過路由的下一跳信息來找到直連出接口的過程。</p><p>迭代深度</p><p>路由迭代中查找路由的次數，次數越少迭代深度越小。</p><p>二、靜態路由與BFD聯動</p><p>與動態路由協議不同，靜態路由自身沒有檢測機制，當網絡發生故障的時候，需要管理員介入。靜態路由與BFD聯動可為靜態路由綁定BFD會話，利用BFD會話來檢測靜態路由所在鏈路的狀態，具體過程如下：</p><p>當某條靜態路由上的BFD會話檢測到鏈路故障時，BFD會將故障上報系統，促使該路由失效，使該路由在IP路由表中不可見。</p><p>當某條靜態路由上的BFD會話檢測到故障的鏈路重新建立成功時，BFD會上報系統，激活該路由，使該路由重新出現在IP路由表中。</p><p>三、靜態路由與NQA聯動</p><p>靜態路由本身並沒有檢測機制，如果非本機直連鏈路發生了故障，靜態路由不會自動改變（不會從IP路由表中自動刪除），需要管理員介入，這就無法保證及時進行鏈路切換，可能造成較長時間的業務中斷。</p><p>基於以上原因，需要有一種有效的方案來檢測靜態路由所在的鏈路。對於靜態路由而言，<strong>現有的靜態路由與BFD聯動特性，由於受到互通設備兩端都必須支持BFD的限制</strong>，在某些應用場景無法實施。而靜態路由與NQA（Network Quality Analysis）聯動則只要求互通設備的其中一端支持NQA即可。</p><p>靜態路由與NQA聯動特性即為靜態路由綁定NQA測試例，利用NQA測試例來檢測靜態路由所在鏈路的狀態，根據NQA的檢測結果，決定靜態路由是否活躍，達到避免通信的中斷或服務質量降低的目的。靜態路由與NQA聯動特性的功能如下：</p><p>如果NQA測試例檢測到鏈路故障，路由器將這條靜態路由設置為“非激活”狀態（此條路由不可用，從IP路由表中刪除）</p><p>如果NQA測試例檢測到鏈路恢復正常，路由器將這條靜態路由設置為“激活”狀態（此條路由可用，添加到IP路由表）</p><p>靜態路由與NQA聯動時僅採用ICMP測試例來檢測源端到目的端的路由是否可達。</p><p>每條靜態路由只可以綁定一個NQA測試例。</p><div class=pgc-img><img alt=靜態路由理論知識詳解 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1ce05bb5a66c4d31bba69935dc51c710><p class=pgc-img-caption></p></div><p>圖1 靜態路由與NQA聯動應用組網圖</p><p>上圖1所示，每臺接入交換機下連接10個用戶，共100個用戶。由於在RouterB和用戶之間無法使用動態路由協議，所以在RouterB上配置到用戶的靜態路由。出於網絡穩定性的考慮，在RouterC上進行同樣的配置，作為冗餘備份。</p><p>RouterA、RouterB和RouterC上運行動態路由協議，相互間可以學習路由。其中，RouterB和RouterC配置動態路由協議引入靜態路由，並且設置不同的度量值，這樣RouterA也能通過動態路由協議從RouterB和RouterC分別學習到用戶的路由，RouterA根據兩條鏈路的度量值不同選擇一條主用鏈路，另一條鏈路做為備份鏈路。</p><p>在RouterB上配置靜態路由與NQA聯動特性，利用NQA測試例檢測主用鏈路RouterB→SwitchA→SwitchC（SwitchD）的狀態，當主用鏈路發生故障時，撤銷靜態路由發佈，使下行流量經無故障的鏈路RouterC→SwitchB→SwitchC（SwitchD）轉發。在兩條鏈路都正常時，控制下行流量優先選擇主用鏈路。</p><p>四、靜態路由永久發佈</p><p>靜態路由永久發佈可以為客戶提供一種低成本、部署簡單的鏈路檢測機制，並提高與其他廠商設備的兼容性。在客戶希望確定業務流量的轉發路徑，不希望流量從其它路徑穿越時，<strong>靜態路由永久發佈可以通過Ping靜態路由目的地址的方式來檢測鏈路的有效性而達到業務監控的目的。</strong></p><p>鏈路有效性直接影響網絡的穩定性和可用性，因此鏈路狀態的檢測對網絡維護具有重要意義。BFD作為一種常用方案，並不適合所有的場景。例如，在不同的ISP之間，客戶更希望採用更簡單、更自然的方式來達到這一目的。</p><p>配置永久發佈屬性後，之前無法發佈的靜態路由仍然被優選並添加到路由表中。具體可以分為以下兩種情況：</p><p>1、靜態路由配置出接口且出接口的IP地址存在時，無論接口狀態是Up或Down，只要配置了永久發佈屬性，靜態路由都會被優選並添加到路由表。</p><p>2、靜態路由沒有配置出接口時，無論靜態路由是否能迭代到出接口，只要配置了永久發佈屬性，路由都會被優選並添加到路由表中。</p><p>這樣，通過控制靜態路由的優先級和前綴長度，使Ping數據包始終通過靜態路由轉發，就可以檢測出鏈路的有效性。</p><p>該特性不判斷路由是否可達，而是一直會將靜態路由保留在IP路由表中，如果實際路徑不可達，靜態路由可能形成黑洞路由。</p><div class=pgc-img><img alt=靜態路由理論知識詳解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/24daf20d090745198798b9d65b666980><p class=pgc-img-caption></p></div><p>圖1 靜態路由永久發佈應用組網圖</p><p>如上圖1所示，BR1、BR2和BR3分別屬於ISP1、ISP2和ISP3。從BR1到BR2有兩條鏈路（LinkA和LinkB）可達，但ISP1希望業務流量都通過LinkA直接轉發到ISP2，而不從ISP3穿越。</p><p>在 BR1 和 BR2 之間建立直連單跳 EBGP 鄰居，同時為了進行業務狀態監控，在 BR1 上配置到對端（ BR2 ） BGP 鄰居地址（ 10.1.1.2/24 ）的靜態路由（出接口為與 BR2 直連的本地接口），並使能路由永久發佈。網絡監控系統週期性的 Ping 10.1.1.2 ，可通過 Ping 結果來判斷 LinkA 的狀態。</p><p>當LinkA正常時，Ping數據包都是通過LinkA進行轉發。如果LinkA發生故障，即使能通過LinkB到達BR2，但由於靜態路由使能了靜態路由永久發佈，所以Ping數據包還是通過LinkA進行轉發，但此時轉發不通。對於BGP數據包也是相同的情況，故障會導致BGP鄰居斷開，監控系統可以通過Ping結果間接的檢測到業務問題，並通知維護人員及時響應。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>靜態</a></li><li><a>理論</a></li><li><a>知識</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/a8cf5b4d.html alt=速寫理論知識，超級有用！快收藏 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/a58ccd996bd341adbc7a84200fca7f23 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a8cf5b4d.html title=速寫理論知識，超級有用！快收藏>速寫理論知識，超級有用！快收藏</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/431b8262.html alt=今天補了個缺，缺口理論複習，這些知識你得知道 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5704ddecd0534353a695af577e29bd50 style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/431b8262.html title=今天補了個缺，缺口理論複習，這些知識你得知道>今天補了個缺，缺口理論複習，這些知識你得知道</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/071c1c91.html alt=缺口理論知識 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/8b93d54fce2549aab2d853efb23571a5 style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/071c1c91.html title=缺口理論知識>缺口理論知識</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/058b7e7b.html alt=鋼的熱處理基本理論知識——退火 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/05e730b1dd434899b36f3d92dfe98cb6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/058b7e7b.html title=鋼的熱處理基本理論知識——退火>鋼的熱處理基本理論知識——退火</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/78becec.html alt=「知識貼」靜態人臉識別和動態人臉識別的區別 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/3b170001545b007c0444 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/78becec.html title=「知識貼」靜態人臉識別和動態人臉識別的區別>「知識貼」靜態人臉識別和動態人臉識別的區別</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1bb93f0.html alt=靜態路由基礎知識 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/987a89cbec8a44a6b1df4b18a1c5b015 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1bb93f0.html title=靜態路由基礎知識>靜態路由基礎知識</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/804ea540.html alt=「行業知識」結構工程師的心結——鋼樑扭轉計算 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/177f1b37fa4b41698a4e78accf7efbb4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/804ea540.html title=「行業知識」結構工程師的心結——鋼樑扭轉計算>「行業知識」結構工程師的心結——鋼樑扭轉計算</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bcc4c942.html alt=「鋼構知識」經典鋼結構設計問答 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bcc4c942.html title=「鋼構知識」經典鋼結構設計問答>「鋼構知識」經典鋼結構設計問答</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7f6e1fd9.html alt=「鋼構知識」經典鋼結構設計問答彙總 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/76195b1e9d934c2e952b060dad0951e6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7f6e1fd9.html title=「鋼構知識」經典鋼結構設計問答彙總>「鋼構知識」經典鋼結構設計問答彙總</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0fc448f5.html alt=各種門窗知識大全，是我見過最全的了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15349013240149cf1ef5531 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0fc448f5.html title=各種門窗知識大全，是我見過最全的了>各種門窗知識大全，是我見過最全的了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f0ff6432.html alt=鋼結構必備知識38問 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f0ff6432.html title=鋼結構必備知識38問>鋼結構必備知識38問</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bb258a5a.html alt=鋼結構必備知識38問，你的晉級之路！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1535975955779bcac330762 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bb258a5a.html title=鋼結構必備知識38問，你的晉級之路！>鋼結構必備知識38問，你的晉級之路！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8bbd5f8a.html alt=長知識！什麼是榫卯結構？為什麼現代建築當中不常見了？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1537941825042b6f495fa56 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8bbd5f8a.html title=長知識！什麼是榫卯結構？為什麼現代建築當中不常見了？>長知識！什麼是榫卯結構？為什麼現代建築當中不常見了？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9bb06250.html alt=鋼管混凝土結構：理論與實踐 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RJ9K096BfRwzs2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9bb06250.html title=鋼管混凝土結構：理論與實踐>鋼管混凝土結構：理論與實踐</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0a77c203.html alt="（鑄造知識四）----- 真空吸鑄" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/b52f6cfa-2566-4f1d-a4b0-f9921b5d06b9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0a77c203.html title="（鑄造知識四）----- 真空吸鑄">（鑄造知識四）----- 真空吸鑄</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>