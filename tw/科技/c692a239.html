<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>強連通分量與拓撲排序 | 极客快訊</title><meta property="og:title" content="強連通分量與拓撲排序 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/70f8cf4acc804054acc4c73649b83179"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c692a239.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c692a239.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c692a239.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c692a239.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c692a239.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c692a239.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c692a239.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c692a239.html><meta property="article:published_time" content="2020-11-14T21:06:28+08:00"><meta property="article:modified_time" content="2020-11-14T21:06:28+08:00"><meta name=Keywords content><meta name=description content="強連通分量與拓撲排序"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/c692a239.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>強連通分量與拓撲排序</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>GacUI需要用到拓撲排序的地方很多，包括但不限於：</p><p><strong>CodePack.exe</strong></p><p>一個把一堆C++代碼打包成幾個成對的h和cpp代碼的工具。這裡就需要拓撲排序。因為在配置文件裡（譬如說這個），我只定義了哪一些文件需要合併。而最後文件與文件的#include關係，是自動算出來的。拓撲排序在這裡起到的作用，就是如果排序不成功，那我就要輸出錯誤信息。</p><p>現在我輸出錯誤信息只是告訴說你錯了，並不能告訴你是誰跟誰搞在一起導致出錯的。強連通分量在這裡就起到了很好的效果，他識別出了循環引用的最小的集合，那麼我就可以把這個集合輸出到錯誤信息裡，這樣你就知道配置文件裡面哪裡寫的不對。</p><p><strong>Workflow 編譯器</strong></p><p>Workflow腳本語言支持C#那樣子的class和struct。class可以繼承，struct可以在成員裡面引用別的struct。如果我們把class a繼承自class b，和struct a用了struct b，都看成a依賴b的話，那麼所有的class或者所有的struct就構成了一個圖。這個圖必須是偏序結構的，否則就意味著，要麼你循環繼承class，要麼你虛幻嵌套struct，這都是錯誤的。</p><p>那強連通分量是什麼作用呢？其實仍然是為了輸出錯誤信息。如果你有一個很大的Workflow程序，我告訴你某個class循環繼承了自己，看起來其實不是很友好。如果我可以告訴你到底是哪幾個class互相繼承，你改起代碼來自然就方便多了。每一個強連通分量都代表了一個錯誤信息，很方便。</p><p><strong>Workflow C++代碼生成器</strong></p><p>Workflow生成C++代碼還有一些額外的要求。譬如說你在GacUI裡面，指明瞭一個窗口的ref.CodeBehind屬性為true，那麼GacUI就會為你這個窗口單獨生成一對C++文件，否則就全部加進大文件裡。這樣可以有效減少文件數量。你需要單獨生成文件的理由，自然是你需要把自己的C++代碼合併進這個窗口生成的C++代碼裡，就像流行的GUI庫編輯器做的那樣。典型的有事件處理函數，或者是你自己用C++添加的成員等等。</p><p>這就帶來了兩個問題。<strong>第一個問題</strong>是，如果你有三個窗口，a繼承出b，而b繼承出c。本來abc都是生成到同一個文件裡面的，但是後來你給b加上了ref.CodeBehind=true，這會導致c也必須生成到一個獨立的文件。因為如果ac在一個文件，b在另一個文件的話，你就沒法正確#include。</p><p>顯然，你ref.CodeBehind=true的一些窗口，使得ref.CodeBehind=false的一些窗口不一定可以全部放到一個頭文件裡。在這裡識別出強連通分量就可以很好地減少分裂的頭文件數量。當然並不是每一個強連通分量就是一個文件，這樣也是很多餘的。具體的辦法我還沒開始想，不過肯定是水到渠成的問題，因為明顯只要對每一個強連通分量按照一定的規則染色，就搞定了。</p><p><strong>第二個問題</strong>是，Workflow的類可以有嵌套類，嵌套類也會影響生成文件的安排，但是就算你只有一個文件，還會帶來另一個問題。譬如說我有這樣的C++代碼：</p><pre>class Fuck : public Bitch::Dung{public: class Shit{};};class Bitch : public Fuck::Shit{public: class Dung{};};</pre><p>你會發現，不管你怎麼調整順序，不管你怎麼向前聲明，你都沒辦法讓他編譯通過。當然C#是不會有這個問題的，以C#和COM作為模板的Workflow自然也不會有這個問題。但是你真的這麼寫了，我就沒辦法替你生成C++代碼。</p><p>那麼自然，Workflow的C++代碼生成器必須在這個時候報錯。這裡我們仍然要進行拓撲排序，但是圖的每一個節點，其實就是每一個top level class和所有內部類的集合。在這裡自然就是{Fuck, Fuck::Shit}以及{Bitch, Bitch::Dung}。在檢查繼承關係之後，我們發現這兩個節點是循環引用的，因此會被分配到同一個強連通分量裡。如果排序的結果，有一個強連通分量有超過一個節點的話，那麼就意味著這種代碼沒辦法生成C++代碼，因此就可以抱錯了。報錯的時候，我又可以生成好看的錯誤信息了。</p><p><strong>實現</strong></p><p>其他的我就不說了，還有很多。如果你們好好看了上面的維基百科的鏈接，就知道Kosaraju算法是表達為遞歸的。在敲代碼之前，我也考慮過到底要不要把遞歸化為循環，讓爆棧不那麼容易發生。後來想想算了，因為這裡的遞歸的層數，跟你C++代碼#include的層數，和類繼承的層數是一致的。如果你的Workflow類一共繼承了1000層，那你也不要怪我GacGen.exe崩潰，我不管的（逃。因此我毅然選擇了遞歸。</p><p>Vlpp裡面一共有三個文件：PartialOrdering.h、PartialOrdering.cpp和TestPartialOrdering.cpp。大家有興趣的話就去看，裡面有實現以及測試用例。</p><p>經過我的估算，這個類的三個主要函數的worst case複雜度分別是：</p><ul><li>InitWithGroup：O(ElgV)</li><li>InitWithFunc：O(V² + ElgV)</li><li>Sort：O(V+E)</li></ul><p>總的來說，整個東西的複雜度還是會被控制在O(nlgn)或者O(n²)，還行。</p><p>之前瞎JB搞得算法的worst case是O(n³lgn)，看起來很嚇人，不過因為我處理的圖都是稀疏圖，所以平均下來也不會這麼難看。既然已經把靠譜的算法做進GacUI了，那麼接下來就是把每一處用到垃圾拓撲排序的地方刪掉，用新寫的算法替換上</p><h1>如果你想要自學編程卻找不到資料？關注我吧。關注“程序員資源課”，你想要的資料我這裡都有。</h1><div class=pgc-img><img alt=強連通分量與拓撲排序 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/70f8cf4acc804054acc4c73649b83179><p class=pgc-img-caption></p></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>強連通</a></li><li><a>拓撲</a></li><li><a>排序</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E5%AD%B8/d712d725.html alt=算法實現——拓撲排序的原理及實現 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/68d7916f4828401f95d9261fe25237ec style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/d712d725.html title=算法實現——拓撲排序的原理及實現>算法實現——拓撲排序的原理及實現</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d2c4e836.html alt=三個步驟完成強連通分量分解的Kosaraju算法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/cb33900ca44848578d9b1731b67ed20b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d2c4e836.html title=三個步驟完成強連通分量分解的Kosaraju算法>三個步驟完成強連通分量分解的Kosaraju算法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9f08f133.html alt=強連通分量及縮點tarjan算法解析 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/d37a67d832d14584a76b4682bc1397e1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9f08f133.html title=強連通分量及縮點tarjan算法解析>強連通分量及縮點tarjan算法解析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/00724d57.html alt=「技術帖」基於拓撲優化的複合材料汽車座椅骨架設計 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d17fc52c47764b149b99c25fd6ded601 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/00724d57.html title=「技術帖」基於拓撲優化的複合材料汽車座椅骨架設計>「技術帖」基於拓撲優化的複合材料汽車座椅骨架設計</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/10310f41.html alt=「乾貨」常用排序算法總結，必收藏系列 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d8acebd059bd4f4bba84851e32fa7ce7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/10310f41.html title=「乾貨」常用排序算法總結，必收藏系列>「乾貨」常用排序算法總結，必收藏系列</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f5d0a0be.html alt=五種常用且高效的排序算法性能總結 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1534143270780b452d84457 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f5d0a0be.html title=五種常用且高效的排序算法性能總結>五種常用且高效的排序算法性能總結</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/977abfb9.html alt="冒泡排序、快速排序、歸併排序、基數排序 | 排序算法（二）" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7179768ce3434cdba1850438f76df374 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/977abfb9.html title="冒泡排序、快速排序、歸併排序、基數排序 | 排序算法（二）">冒泡排序、快速排序、歸併排序、基數排序 | 排序算法（二）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/257bd06a.html alt=排序算法整合（冒泡，快速，希爾，拓撲，歸併） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RateqO55LCLXqj style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/257bd06a.html title=排序算法整合（冒泡，快速，希爾，拓撲，歸併）>排序算法整合（冒泡，快速，希爾，拓撲，歸併）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a61341cf.html alt=深入淺出排序算法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c898a3bab26542c2965d2bc5bebf9bd8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a61341cf.html title=深入淺出排序算法>深入淺出排序算法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8257f1b4.html alt=程序員那些必須掌握的排序算法(上) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/c32d187d725f4bd59225a5d09a38cb37 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8257f1b4.html title=程序員那些必須掌握的排序算法(上)>程序員那些必須掌握的排序算法(上)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/500d3e1f.html alt="算法 － 七大排序算法詳細介紹" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9275d53c0e5f432294fce6dd4cfef236 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/500d3e1f.html title="算法 － 七大排序算法詳細介紹">算法 － 七大排序算法詳細介紹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1ca491e3.html alt=算法之旅｜快速排序法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/3b0e0000a716d98c3cba style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1ca491e3.html title=算法之旅｜快速排序法>算法之旅｜快速排序法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1e77b20f.html alt=常見的排序算法簡介 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1e77b20f.html title=常見的排序算法簡介>常見的排序算法簡介</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a35a8e8a.html alt=排序算法（1）——O(n^2) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/593b00001b3fdbe6409a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a35a8e8a.html title=排序算法（1）——O(n^2)>排序算法（1）——O(n^2)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/367001e2.html alt=算法之旅｜選擇排序法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/3214000370c00fc3211e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/367001e2.html title=算法之旅｜選擇排序法>算法之旅｜選擇排序法</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>