<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>åŒæ­¥è«‹æ±‚å’Œç•°æ­¥è«‹æ±‚ | æå®¢å¿«è¨Š</title><meta property="og:title" content="åŒæ­¥è«‹æ±‚å’Œç•°æ­¥è«‹æ±‚ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/37b36c91e46045098266d0264cb7f6e8"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c6fa5bc.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c6fa5bc.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c6fa5bc.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c6fa5bc.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c6fa5bc.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c6fa5bc.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c6fa5bc.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c6fa5bc.html><meta property="article:published_time" content="2020-10-29T20:59:17+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:17+08:00"><meta name=Keywords content><meta name=description content="åŒæ­¥è«‹æ±‚å’Œç•°æ­¥è«‹æ±‚"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/c6fa5bc.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>åŒæ­¥è«‹æ±‚å’Œç•°æ­¥è«‹æ±‚</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h1 class=postTitle>åŒæ­¥è«‹æ±‚å’Œç•°æ­¥è«‹æ±‚çš„å€åˆ¥</h1><ul><li>åŒæ­¥æ˜¯æŒ‡ï¼šç™¼é€æ–¹ç™¼å‡ºæ•¸æ“šå¾Œï¼Œç­‰æ¥æ”¶æ–¹ç™¼å›éŸ¿æ‡‰ä»¥å¾Œæ‰ç™¼ä¸‹ä¸€å€‹æ•¸æ“šåŒ…çš„é€šè¨Šæ–¹å¼ã€‚</li></ul><ul><li>ç•°æ­¥æ˜¯æŒ‡ï¼šç™¼é€æ–¹ç™¼å‡ºæ•¸æ“šå¾Œï¼Œä¸ç­‰æ¥æ”¶æ–¹ç™¼å›éŸ¿æ‡‰ï¼Œæ¥è‘—ç™¼é€ä¸‹å€‹æ•¸æ“šåŒ…çš„é€šè¨Šæ–¹å¼ã€‚</li></ul><p>å³åŒæ­¥å°±æ˜¯ä¸€å€‹ä»»å‹™çš„å®Œæˆéœ€è¦ä¾è³´å¦å¤–ä¸€å€‹ä»»å‹™æ™‚ï¼Œåªæœ‰ç­‰å¾…è¢«ä¾è³´çš„ä»»å‹™å®Œæˆå¾Œï¼Œä¾è³´çš„ä»»å‹™æ‰èƒ½ç®—å®Œæˆï¼Œé€™æ˜¯ä¸€ç¨®å¯é çš„ä»»å‹™åºåˆ—ã€‚</p><p>æ‰€è¬‚ç•°æ­¥æ˜¯ä¸éœ€è¦ç­‰å¾…è¢«ä¾è³´çš„ä»»å‹™å®Œæˆï¼Œåªæ˜¯é€šçŸ¥è¢«ä¾è³´çš„ä»»å‹™è¦å®Œæˆä»€éº¼å·¥ä½œï¼Œä¾è³´çš„ä»»å‹™ä¹Ÿç«‹å³åŸ·è¡Œï¼Œåªè¦è‡ªå·±å®Œæˆäº†æ•´å€‹ä»»å‹™å°±ç®—å®Œæˆäº†ã€‚è‡³æ–¼è¢«ä¾è³´çš„ä»»å‹™æœ€çµ‚æ˜¯å¦çœŸæ­£å®Œæˆï¼Œä¾è³´å®ƒçš„ä»»å‹™ç„¡æ³•ç¢ºå®šï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸å¯é çš„ä»»å‹™åºåˆ—ã€‚</p><p>ç•°æ­¥çš„æ¦‚å¿µå’ŒåŒæ­¥ç›¸å°ã€‚ç•¶ä¸€å€‹åŒæ­¥èª¿ç”¨ç™¼å‡ºå¾Œï¼Œèª¿ç”¨è€…è¦ä¸€ç›´ç­‰å¾…è¿”å›æ¶ˆæ¯ï¼ˆçµæœï¼‰é€šçŸ¥å¾Œï¼Œæ‰èƒ½é€²è¡Œå¾ŒçºŒçš„åŸ·è¡Œï¼›ç•¶ä¸€å€‹ç•°æ­¥éç¨‹èª¿ç”¨ç™¼å‡ºå¾Œï¼Œèª¿ç”¨è€…ä¸èƒ½ç«‹åˆ»å¾—åˆ°è¿”å›æ¶ˆæ¯ï¼ˆçµæœï¼‰ã€‚å¯¦éš›è™•ç†é€™å€‹èª¿ç”¨çš„éƒ¨ä»¶åœ¨å®Œæˆå¾Œï¼Œé€šéç‹€æ…‹ã€é€šçŸ¥å’Œå›èª¿ä¾†é€šçŸ¥èª¿ç”¨è€…ã€‚</p><p>é‡å°ä»¥ä¸Šæè¿°ï¼Œå¯¦éš›å·¥ç¨‹ç·¨ç¨‹ä¸­ï¼Œå…·é«”æˆ‘å€‘å¦‚ä½•æ ¹æ“šå ´æ™¯é¸æ“‡å’Œä½¿ç”¨åŒæ­¥å’Œç•°æ­¥ï¼š</p><p>ç•°æ­¥çš„ä½¿ç”¨å ´æ™¯ï¼š</p><ul><li>ä¸æ¶‰åŠå…±äº«è³‡æºï¼Œæˆ–å°å…±äº«è³‡æºåªè®€ï¼Œå³éäº’æ–¥æ“ä½œ</li><li>æ²’æœ‰æ™‚åºä¸Šçš„åš´æ ¼é—œä¿‚</li><li>ä¸éœ€è¦åŸå­æ“ä½œï¼Œæˆ–å¯ä»¥é€šéå…¶ä»–æ–¹å¼æ§åˆ¶åŸå­æ€§</li><li>å¸¸ç”¨æ–¼IOæ“ä½œç­‰è€—æ™‚æ“ä½œï¼Œå› ç‚ºæ¯”è¼ƒå½±éŸ¿å®¢æˆ¶é«”é©—å’Œä½¿ç”¨æ€§èƒ½</li><li>ä¸å½±éŸ¿ä¸»ç·šç¨‹é‚è¼¯</li></ul><p>åŒæ­¥çš„ä½¿ç”¨å ´æ™¯ï¼šä¸ä½¿ç”¨ç•°æ­¥çš„æ™‚å€™</p><p>åŒæ­¥çš„å¥½è™•ï¼š</p><ul><li>åŒæ­¥æµç¨‹å°çµæœè™•ç†é€šå¸¸æ›´ç‚ºç°¡å–®ï¼Œå¯ä»¥å°±è¿‘è™•ç†ã€‚</li><li>åŒæ­¥æµç¨‹å°çµæœçš„è™•ç†å§‹çµ‚å’Œå‰æ–‡ä¿æŒåœ¨ä¸€å€‹ä¸Šä¸‹æ–‡å…§ã€‚</li><li>åŒæ­¥æµç¨‹å¯ä»¥å¾ˆå®¹æ˜“æ•ç²ã€è™•ç†ç•°å¸¸ã€‚</li><li>åŒæ­¥æµç¨‹æ˜¯æœ€å¤©ç„¶çš„æ§åˆ¶éç¨‹é †åºåŸ·è¡Œçš„æ–¹å¼ã€‚</li></ul><p>ç•°æ­¥çš„å¥½è™•ï¼š</p><ul><li>ç•°æ­¥æµç¨‹å¯ä»¥ç«‹å³çµ¦èª¿ç”¨æ–¹è¿”å›åˆæ­¥çš„çµæœã€‚</li><li>ç•°æ­¥æµç¨‹å¯ä»¥å»¶é²çµ¦èª¿ç”¨æ–¹æœ€çµ‚çš„çµæœæ•¸æ“šï¼Œåœ¨æ­¤æœŸé–“å¯ä»¥åšæ›´å¤šé¡å¤–çš„å·¥ä½œï¼Œä¾‹å¦‚çµæœè¨˜éŒ„ç­‰ç­‰ã€‚</li><li>ç•°æ­¥æµç¨‹åœ¨åŸ·è¡Œçš„éç¨‹ä¸­ï¼Œå¯ä»¥é‡‹æ”¾ä½”ç”¨çš„ç·šç¨‹ç­‰è³‡æºï¼Œé¿å…é˜»å¡ï¼Œç­‰åˆ°çµæœç”¢ç”Ÿå†é‡æ–°ç²å–ç·šç¨‹è™•ç†ã€‚</li><li>ç•°æ­¥æµç¨‹å¯ä»¥ç­‰å¤šæ¬¡èª¿ç”¨çš„çµæœå‡ºä¾†å¾Œï¼Œå†çµ±ä¸€è¿”å›ä¸€æ¬¡çµæœé›†åˆï¼Œæé«˜éŸ¿æ‡‰æ•ˆç‡ã€‚</li></ul><p>æ¥ä¸‹ä¾†åŸºæ–¼httpè«‹æ±‚åˆ†åˆ¥å¯¦ç¾åŒæ­¥å’Œç•°æ­¥ç²å–å¤©æ°£ä¿¡æ¯çš„ç·¨ç¨‹ï¼š</p><p>è²¼å‡ºä¾†ä¸€å€‹httpè«‹æ±‚æ ¼å¼ï¼Œä»£ç¢¼éœ€è¦æŒ‰ç…§é€™å€‹æ ¼å¼æ‹¼æ¥ç›¸é—œçš„å­—ç¬¦ä¸²ã€‚</p><div class=pgc-img><img alt=åŒæ­¥è«‹æ±‚å’Œç•°æ­¥è«‹æ±‚ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/37b36c91e46045098266d0264cb7f6e8><p class=pgc-img-caption></p></div><p>ä¸€å€‹ç²å–å¤©æ°£ä¿¡æ¯çš„ç¶²ç«™APIèªªæ˜ï¼šhttps://docs.seniverse.com/api/weather/now.html</p><div class=pgc-img><img alt=åŒæ­¥è«‹æ±‚å’Œç•°æ­¥è«‹æ±‚ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3266c0f2fa0246c4a80e57d3b2ca2ab7><p class=pgc-img-caption></p></div><p>httpè«‹æ±‚syncçš„ä»£ç¢¼å¯¦ç¾ï¼š</p><pre><code>#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;unistd.h&gt;#include &lt;time.h&gt;#include &lt;fcntl.h&gt;#include &lt;errno.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/socket.h&gt;#include &lt;sys/time.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;unistd.h&gt;		/* close */#include &lt;netdb.h&gt; #include &lt;sys/epoll.h&gt;#define HTTP_VERSION    "HTTP/1.1"#define USER_AGENT		"User-Agent: Mozilla/5.0 (Windows NT 5.1; rv:10.0.2) Gecko/20100101 Firefox/10.0.2\r\n"#define ENCODE_TYPE		"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"//è¨­ç½®é€£æ¥é¡å‹ï¼Œç”±æ–¼æ˜¯çŸ­é€£æ¥ï¼Œä¸éœ€è¦è¨­ç½®ç‚ºkeep-alive#define CONNECTION_TYPE "Connection: close\r\n"#define BUFFER_SIZE		4096struct http_request {	char *hostname;	char *resource;};struct http_request reqs[] = {	{"api.seniverse.com", "/v3/weather/now.json?key=0pyd8z7jouficcil&amp;location=beijing&amp;language=zh-Hans&amp;unit=c" },	{"api.seniverse.com", "/v3/weather/now.json?key=0pyd8z7jouficcil&amp;location=shenzhen&amp;language=zh-Hans&amp;unit=c" },};char *host_to_ip(const char *hostname) {	struct hostent *host_entry = gethostbyname(hostname);  /*******************************************************************************************************  ç”±æ–¼gethostbynameé€™å€‹å‡½æ•¸ä¸å¯é‡å…¥ï¼Œä¸¦ä¸é©ç”¨æ–¼å¤šç·šç¨‹ç’°å¢ƒä»¥åŠå…¶å®ƒå°DNSè§£æé€Ÿåº¦è¦æ±‚è¼ƒé«˜çš„ç¨‹åº  å¾Œä¾†åˆå¢åŠ ä¸€å€‹å‡½æ•¸gethostbyname_rï¼Œè§£æ±ºgethostbynameçš„å•é¡Œï¼Œä½†æ˜¯åˆç”±æ–¼è©²å‡½æ•¸å°ipv6çš„æ”¯æŒä¸å¥½ï¼Œ  æœ€å¾Œç›®å‰æ¨è–¦ä½¿ç”¨getaddrinfo  *********************************************************************************************************/  if (host_entry) {		return inet_ntoa(*(struct in_addr*)*host_entry-&gt;h_addr_list);	} else {		return NULL;	}}int http_create_socket( char *ip) {	int sockfd = socket(AF_INET, SOCK_STREAM, 0);	struct sockaddr_in sin = {0};	sin.sin_addr.s_addr = inet_addr(ip);	sin.sin_port = htons(80);	sin.sin_family = AF_INET;	if (-1 == connect(sockfd, (struct sockaddr*)&amp;sin, sizeof(struct sockaddr_in))) {		return -1;	}	fcntl(sockfd, F_SETFL, O_NONBLOCK);	return sockfd;}char *http_send_request(int sockfd, const char *hostname, const char *resource) {	char buffer[BUFFER_SIZE] = {0};		int len = sprintf(buffer, "GET %s %s\r\n\Host: %s\r\n\%s\r\n\\r\n",		 resource, HTTP_VERSION,		 hostname,		 CONNECTION_TYPE		 );//æ‹¼æ¥httpè«‹æ±‚	send(sockfd, buffer, strlen(buffer), 0);	struct timeval tv;	tv.tv_sec = 5;	tv.tv_usec = 0;	fd_set fdread;	FD_ZERO(&amp;fdread);	FD_SET(sockfd, &amp;fdread);	char *result = malloc(sizeof(int));	result[0] = '\0';	while (1) {		int selection = select(sockfd+1, &amp;fdread, NULL, NULL, &amp;tv);		if (!selection || !(FD_ISSET(sockfd, &amp;fdread))) {			break;		} else {			len = recv(sockfd, buffer, BUFFER_SIZE, 0);			if (len == 0) break;			result = realloc(result, (strlen(result) + len + 1) * sizeof(char));			strncat(result, buffer, len);		}	}	return result;}int http_sync_client_commit(const char *hostname, const char *resource) {	char *ip = host_to_ip(hostname);//æ ¹æ“šåŸŸåç²å–IPåœ°å€	int sockfd = http_create_socket(ip);//å‰µå»ºsocketï¼Œä¸¦ä½¿ç”¨selectç›£è½æŸ¥è©¢fd	char *content =  http_send_request(sockfd, hostname, resource);//ç™¼é€è«‹æ±‚	if (content == NULL) {		printf("have no data\n");	}	puts(content);	close(sockfd);	free(content);}int main(int argc, char *argv[]) {	int count = sizeof(reqs) / sizeof(reqs[0]);	int i = 0;	for (i = 0;i &lt; count;i ++) {		http_client_commit(reqs[i].hostname, reqs[i].resource);	}</code></pre><p>é‹è¡Œçµæœï¼š</p><p><br></p><div class=pgc-img><img alt=åŒæ­¥è«‹æ±‚å’Œç•°æ­¥è«‹æ±‚ onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/2e77b43d06ec4505abf702d85bc9296b><p class=pgc-img-caption></p></div><p>httpè«‹æ±‚asyncçš„ä»£ç¢¼å¯¦ç¾ï¼š</p><pre><code>#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;unistd.h&gt;#include &lt;time.h&gt;#include &lt;fcntl.h&gt;#include &lt;errno.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/socket.h&gt;#include &lt;sys/time.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#include &lt;unistd.h&gt;		/* close */#include &lt;netdb.h&gt; #include &lt;sys/epoll.h&gt;#define HTTP_VERSION    "HTTP/1.1"#define USER_AGENT		"User-Agent: Mozilla/5.0 (Windows NT 5.1; rv:10.0.2) Gecko/20100101 Firefox/10.0.2\r\n"#define ENCODE_TYPE		"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"#define CONNECTION_TYPE "Connection: close\r\n"#define BUFFER_SIZE		4096#define ASYNC_CLIENT_NUM		1024#define HOSTNAME_LENGTH			128typedef void (*async_result_cb)(const char *hostname, const char *result);struct ep_arg {	int sockfd;	char hostname[HOSTNAME_LENGTH];	async_result_cb cb;};struct async_context {	int epfd;	pthread_t thread_id;};struct http_request {	char *hostname;	char *resource;};struct http_request reqs[] = {	{"api.seniverse.com", "/v3/weather/now.json?key=0pyd8z7jouficcil&amp;location=beijing&amp;language=zh-Hans&amp;unit=c" },	{"api.seniverse.com", "/v3/weather/now.json?key=0pyd8z7jouficcil&amp;location=shenzhen&amp;language=zh-Hans&amp;unit=c" },};char *host_to_ip(const char *hostname) {	struct hostent *host_entry = gethostbyname(hostname);	if (host_entry) {		return inet_ntoa(*(struct in_addr*)*host_entry-&gt;h_addr_list);	} else {		return NULL;	}}int http_async_client_commit(struct async_context *ctx, const char *hostname, const char *resource, async_result_cb cb) {	char *ip = host_to_ip(hostname);	if (ip == NULL) return -1;		int sockfd = socket(AF_INET, SOCK_STREAM, 0);	struct sockaddr_in sin = {0};	sin.sin_addr.s_addr = inet_addr(ip);	sin.sin_port = htons(80);	sin.sin_family = AF_INET;	if (-1 == connect(sockfd, (struct sockaddr*)&amp;sin, sizeof(struct sockaddr_in))) {		return -1;	}	fcntl(sockfd, F_SETFL, O_NONBLOCK);	char buffer[BUFFER_SIZE] = {0};		int len = sprintf(buffer, "GET %s %s\r\n\Host: %s\r\n\%s\r\n\\r\n",		 resource, HTTP_VERSION,		 hostname,		 CONNECTION_TYPE		 );//æ‹¼æ¥httpè«‹æ±‚	int slen = send(sockfd, buffer, strlen(buffer), 0);//ç™¼é€è«‹æ±‚		struct ep_arg *eparg = (struct ep_arg*)calloc(1, sizeof(struct ep_arg));//å‰µå»ºä¸€å€‹çµæ§‹é«”ï¼ŒæŠŠfdå’Œå›èª¿å‡½æ•¸æ”¾é€²å»ï¼Œæ–¹ä¾¿epollè¿”å›çš„æ™‚å€™ï¼Œå°±å¯ä»¥å–åˆ°å°æ‡‰fdå’Œå›èª¿å‡½æ•¸ï¼Œç”¨æ–¼å®¢æˆ¶ç«¯åŒä¸€å€‹ç·šç¨‹è™•ç†æ•¸æ“š	if (eparg == NULL) return -1;	eparg-&gt;sockfd = sockfd;	eparg-&gt;cb = cb;	struct epoll_event ev;	ev.data.ptr = eparg;//å‚³éåƒæ•¸çµ¦epoll	ev.events = EPOLLIN;	int ret = epoll_ctl(ctx-&gt;epfd, EPOLL_CTL_ADD, sockfd, &amp;ev); //æŠŠhttpè«‹æ±‚çš„fdåŠ å…¥åˆ°epollçš„äº‹ä»¶è¨»å†Šå‡½æ•¸	return ret;}int http_async_client_uninit(struct async_context *ctx) {	close(ctx-&gt;epfd);	pthread_cancel(ctx-&gt;thread_id);	return 0;}static void *http_async_client_callback(void *arg) {	struct async_context *ctx = (struct async_context*)arg;	int epfd = ctx-&gt;epfd;	while (1) {		struct epoll_event events[ASYNC_CLIENT_NUM] = {0};		int nready = epoll_wait(epfd, events, ASYNC_CLIENT_NUM, -1);//ç­‰å¾…æº–å‚™å°±ç·’çš„fd		if (nready &lt; 0) {			if (errno == EINTR || errno == EAGAIN) {				continue;			} else {				break;			}		} else if (nready == 0) {			continue;		}		printf("nready:%d\n", nready);		int i = 0;		for (i = 0;i &lt; nready;i ++) {			struct ep_arg *data = (struct ep_arg*)events[i].data.ptr;//httpè«‹æ±‚çš„fdåŠ å…¥epollçš„äº‹ä»¶è¨»å†Šå‡½æ•¸æ™‚å€™ev.data.ptr = epargï¼Œç¾åœ¨é€šéptrç²å–ç•¶æ™‚å‚³éçš„åƒæ•¸			int sockfd = data-&gt;sockfd;						char buffer[BUFFER_SIZE] = {0};			struct sockaddr_in addr;			size_t addr_len = sizeof(struct sockaddr_in);			int n = recv(sockfd, buffer, BUFFER_SIZE, 0);//è®€å–æ•¸æ“š			data-&gt;cb(data-&gt;hostname, buffer); //èª¿ç”¨å›èª¿ï¼Œè™•ç†è¿”å›çš„æ•¸æ“š						int ret = epoll_ctl(epfd, EPOLL_CTL_DEL, sockfd, NULL);//å®Œæˆä¹‹å¾Œéœ€è¦ç§»é™¤ç›¸æ‡‰çš„fd			//printf("epoll_ctl DEL --&gt; sockfd:%d\n", sockfd);			close(sockfd); /////			free(data);		}			}}struct async_context *http_async_client_init(void) {	int epfd = epoll_create(1); // å‰µå»ºä¸€å€‹epollçš„å¥æŸ„	if (epfd &lt; 0) return NULL;	struct async_context *ctx = calloc(1, sizeof(struct async_context));	if (ctx == NULL) {		close(epfd);		return NULL;	}	ctx-&gt;epfd = epfd;	int ret = pthread_create(&amp;ctx-&gt;thread_id, NULL, http_async_client_callback, ctx);//å‰µå»ºç·šç¨‹ï¼Œè¨»å†Šå›èª¿ç”¨æ–¼ç•°æ­¥epoll fd eventsçš„ç›£è½æŸ¥è©¢	if (ret) {		perror("pthread_create");		return NULL;	}	usleep(1); 	return ctx;}static void http_async_client_result_callback(const char *hostname, const char *result) {		printf("hostname:%s, result:%s\n\n\n\n", hostname, result);}int main(int argc, char *argv[]) {	struct async_context *ctx = http_async_client_init();//å‰µå»ºepollå’Œä¸€å€‹ç·šç¨‹ç”¨æ–¼ç•°æ­¥è™•ç†	if (ctx == NULL) return -1;	int count = sizeof(reqs) / sizeof(reqs[0]);	int i = 0;	for (i = 0;i &lt; count;i ++) {		http_async_client_commit(ctx, reqs[i].hostname, reqs[i].resource, http_async_client_result_callback);	}	getchar();}</code></pre><p>é‹è¡Œçµæœï¼š</p><div class=pgc-img><img alt=åŒæ­¥è«‹æ±‚å’Œç•°æ­¥è«‹æ±‚ onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1d9cf327ccd94a3ba0edf295cf79bb7f><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>ç•°æ­¥</a></li><li><a>è«‹æ±‚</a></li><li><a>æ±‚å’Œ</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/3ce8e34.html alt=ä¸€åˆ†é˜æŒæ¡ç•°æ­¥æ“ä½œ(Ajaxè«‹æ±‚ï¼‰ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3ce8e34.html title=ä¸€åˆ†é˜æŒæ¡ç•°æ­¥æ“ä½œ(Ajaxè«‹æ±‚ï¼‰>ä¸€åˆ†é˜æŒæ¡ç•°æ­¥æ“ä½œ(Ajaxè«‹æ±‚ï¼‰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7cb6bec.html alt="å¤§éƒ¨åˆ†ç¨‹åºå“¡ä¸çŸ¥é“çš„ Servelt3 ç•°æ­¥è«‹æ±‚ï¼ŒåŸä¾†é€™éº¼ç°¡å–®ï¼Ÿ" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/dc3238ed4c184f989370e72dc0ad69cd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7cb6bec.html title="å¤§éƒ¨åˆ†ç¨‹åºå“¡ä¸çŸ¥é“çš„ Servelt3 ç•°æ­¥è«‹æ±‚ï¼ŒåŸä¾†é€™éº¼ç°¡å–®ï¼Ÿ">å¤§éƒ¨åˆ†ç¨‹åºå“¡ä¸çŸ¥é“çš„ Servelt3 ç•°æ­¥è«‹æ±‚ï¼ŒåŸä¾†é€™éº¼ç°¡å–®ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/65d3d26.html alt=çˆ¬å–ç•°æ­¥è«‹æ±‚ï¼ˆXHR/JSï¼‰æ•¸æ“šæ–¹æ³•ä¸€äººå·¥åˆ†æç•°æ­¥è«‹æ±‚ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/65d3d26.html title=çˆ¬å–ç•°æ­¥è«‹æ±‚ï¼ˆXHR/JSï¼‰æ•¸æ“šæ–¹æ³•ä¸€äººå·¥åˆ†æç•°æ­¥è«‹æ±‚>çˆ¬å–ç•°æ­¥è«‹æ±‚ï¼ˆXHR/JSï¼‰æ•¸æ“šæ–¹æ³•ä¸€äººå·¥åˆ†æç•°æ­¥è«‹æ±‚</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/03ac1cd8.html alt=11å€‹æœ€å¯¦ç”¨çš„Excelæ±‚å’Œå…¬å¼ï¼Œå„é¡æ±‚å’Œæƒ…æ³éƒ½æœ‰æ¨¡æ¿äº†ï¼ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1535796946527b7df391e10 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/03ac1cd8.html title=11å€‹æœ€å¯¦ç”¨çš„Excelæ±‚å’Œå…¬å¼ï¼Œå„é¡æ±‚å’Œæƒ…æ³éƒ½æœ‰æ¨¡æ¿äº†ï¼>11å€‹æœ€å¯¦ç”¨çš„Excelæ±‚å’Œå…¬å¼ï¼Œå„é¡æ±‚å’Œæƒ…æ³éƒ½æœ‰æ¨¡æ¿äº†ï¼</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a9c3cd10.html alt="6å€‹æœ€å¿«çš„ Excelè¡¨æ ¼æ±‚å’Œ æ–¹æ³•" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ed973ea536f34ff38b17ba457fd16350 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a9c3cd10.html title="6å€‹æœ€å¿«çš„ Excelè¡¨æ ¼æ±‚å’Œ æ–¹æ³•">6å€‹æœ€å¿«çš„ Excelè¡¨æ ¼æ±‚å’Œ æ–¹æ³•</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3998ca69.html alt=Excelå¿«é€Ÿæ±‚å’Œ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8d37e0d1e86d478da118b1d8e7129f3c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3998ca69.html title=Excelå¿«é€Ÿæ±‚å’Œ>Excelå¿«é€Ÿæ±‚å’Œ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b74be616.html alt=VLOOKUPå¤šåˆ—æ±‚å’Œ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/153176249716393f5fb0e37 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b74be616.html title=VLOOKUPå¤šåˆ—æ±‚å’Œ>VLOOKUPå¤šåˆ—æ±‚å’Œ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/06708c4c.html alt=excelå°æŠ€å·§ï¼šè‡ªå‹•æ±‚å’Œï¼Œç•¶æ–°å¢æ•¸æ“šæ™‚è‡ªå‹•æ±‚å’Œ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1523970520159b755ba89ba style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/06708c4c.html title=excelå°æŠ€å·§ï¼šè‡ªå‹•æ±‚å’Œï¼Œç•¶æ–°å¢æ•¸æ“šæ™‚è‡ªå‹•æ±‚å’Œ>excelå°æŠ€å·§ï¼šè‡ªå‹•æ±‚å’Œï¼Œç•¶æ–°å¢æ•¸æ“šæ™‚è‡ªå‹•æ±‚å’Œ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f9db061d.html alt=ä¸‰ç›¸ç•°æ­¥é›»å‹•æ©Ÿçµ•ç·£è™•ç†çš„ç›®çš„åŠæ–¹æ³• class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/3c439a15bdf64f1f975914c96a2c66e7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f9db061d.html title=ä¸‰ç›¸ç•°æ­¥é›»å‹•æ©Ÿçµ•ç·£è™•ç†çš„ç›®çš„åŠæ–¹æ³•>ä¸‰ç›¸ç•°æ­¥é›»å‹•æ©Ÿçµ•ç·£è™•ç†çš„ç›®çš„åŠæ–¹æ³•</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b44410f0.html alt=ç•°æ­¥é›»æ©Ÿå…¸å‹çµæ§‹ç°¡è¿° class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15349080656472f5dd62512 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b44410f0.html title=ç•°æ­¥é›»æ©Ÿå…¸å‹çµæ§‹ç°¡è¿°>ç•°æ­¥é›»æ©Ÿå…¸å‹çµæ§‹ç°¡è¿°</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c2cb8d92.html alt=ç¹çµ„5å¤§åŸºæœ¬åè©è§£æèˆ‡ä¸‰ç›¸ç•°æ­¥é›»å‹•æ©Ÿç¹çµ„åŠå…¶è¯æ¥æ–¹æ³•ä»‹ç´¹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/56930005e593537411b9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c2cb8d92.html title=ç¹çµ„5å¤§åŸºæœ¬åè©è§£æèˆ‡ä¸‰ç›¸ç•°æ­¥é›»å‹•æ©Ÿç¹çµ„åŠå…¶è¯æ¥æ–¹æ³•ä»‹ç´¹>ç¹çµ„5å¤§åŸºæœ¬åè©è§£æèˆ‡ä¸‰ç›¸ç•°æ­¥é›»å‹•æ©Ÿç¹çµ„åŠå…¶è¯æ¥æ–¹æ³•ä»‹ç´¹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b3e098cc.html alt=å–®ç›¸ç•°æ­¥é›»æ©Ÿå¦‚ä½•è½‰èµ·ä¾†ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/66c6000099c8d7f13f98 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b3e098cc.html title=å–®ç›¸ç•°æ­¥é›»æ©Ÿå¦‚ä½•è½‰èµ·ä¾†ï¼Ÿ>å–®ç›¸ç•°æ­¥é›»æ©Ÿå¦‚ä½•è½‰èµ·ä¾†ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/51fefa66.html alt=è¿„ä»Šç‚ºæ­¢æŠŠåŒæ­¥/ç•°æ­¥/é˜»å¡/éé˜»å¡è¬›çš„é€™éº¼æ¸…æ¥šçš„å¥½æ–‡ç«  class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/28ca13300b9f4d55bd5af3f9156f8874 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/51fefa66.html title=è¿„ä»Šç‚ºæ­¢æŠŠåŒæ­¥/ç•°æ­¥/é˜»å¡/éé˜»å¡è¬›çš„é€™éº¼æ¸…æ¥šçš„å¥½æ–‡ç« >è¿„ä»Šç‚ºæ­¢æŠŠåŒæ­¥/ç•°æ­¥/é˜»å¡/éé˜»å¡è¬›çš„é€™éº¼æ¸…æ¥šçš„å¥½æ–‡ç« </a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/71debf3a.html alt=å¦‚ä½•å¾è«‹æ±‚ã€å‚³è¼¸ã€æ¸²æŸ“3å€‹æ–¹é¢æå‡Webå‰ç«¯æ€§èƒ½ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ec3175fa2700484eac030574b8369e79 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/71debf3a.html title=å¦‚ä½•å¾è«‹æ±‚ã€å‚³è¼¸ã€æ¸²æŸ“3å€‹æ–¹é¢æå‡Webå‰ç«¯æ€§èƒ½>å¦‚ä½•å¾è«‹æ±‚ã€å‚³è¼¸ã€æ¸²æŸ“3å€‹æ–¹é¢æå‡Webå‰ç«¯æ€§èƒ½</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0f8e9216.html alt=å¯«å€‹æ—¥èªŒè«‹æ±‚åˆ‡é¢ï¼Œå‰å¾Œç«¯ç”©é‹æ›´æ–¹ä¾¿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/9ee016d0-a9b0-43a8-95a8-2d6d7b5e7e21 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0f8e9216.html title=å¯«å€‹æ—¥èªŒè«‹æ±‚åˆ‡é¢ï¼Œå‰å¾Œç«¯ç”©é‹æ›´æ–¹ä¾¿>å¯«å€‹æ—¥èªŒè«‹æ±‚åˆ‡é¢ï¼Œå‰å¾Œç«¯ç”©é‹æ›´æ–¹ä¾¿</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>