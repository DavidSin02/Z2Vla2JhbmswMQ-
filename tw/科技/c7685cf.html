<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>一怒之下我自己寫了個PageHelper分頁插件 | 极客快訊</title><meta property="og:title" content="一怒之下我自己寫了個PageHelper分頁插件 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/50426602d0764e93a53961830b578346"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c7685cf.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c7685cf.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c7685cf.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c7685cf.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c7685cf.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c7685cf.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c7685cf.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c7685cf.html><meta property="article:published_time" content="2020-10-29T20:58:00+08:00"><meta property="article:modified_time" content="2020-10-29T20:58:00+08:00"><meta name=Keywords content><meta name=description content="一怒之下我自己寫了個PageHelper分頁插件"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/c7685cf.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一怒之下我自己寫了個PageHelper分頁插件</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right><span style="color:#4f4f4f;--tt-darkmode-color: #979797">前言</span></h1><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">提到插件，相信大家都知道，插件的存在主要是用來改變或者增強原有的功能，MyBatis中也一樣。然而如果我們對MyBatis的工作原理不是很清楚的話，最好不要輕易使用插件，否則的話如果因為使用插件導致了底層工作邏輯被改變，很可能會出現很多意料之外的問題。</span></p><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">本文主要會介紹MyBatis插件的使用及其實現原理，相信讀完本文，我們也可以寫出自己的PageHelper分頁插件了。</span></p><h1 class=pgc-h-arrow-right><span style="color:#4f4f4f;--tt-darkmode-color: #979797">MyBatis中插件是如何實現的</span></h1><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">在MyBatis中插件</span><span style="color:#4d4d4d;--tt-darkmode-color: #999999">式</span><span style="color:#4d4d4d;--tt-darkmode-color: #999999">通過攔截器來實現的，那麼既然是通過攔截器來實現的，就會有一個問題，哪些對象才允許被攔截呢？</span></p><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999">回想前面我們介紹Executor的文章中提到，真正執行Sql的是四大對象：Executor，StatementHandler，ParameterHandler，ResultSetHandler。而MyBatis的插件正是基於攔截這四大對象來實現的。需要注意的是，雖然我們可以攔截這四大對象，但是並不是這四大對象中的所有方法都能被攔截，下面就是官網提供的可攔截的對象和方法彙總：<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/50426602d0764e93a53961830b578346><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><span style="color:#4f4f4f;--tt-darkmode-color: #979797">MyBatis插件的使用</span></h1><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">首先我們先來通過一個例子來看看如何使用插件。<br>1、首先建立一個MyPlugin實現接口Interceptor，然後重寫其中的三個方法(注意，這裡必須要實現Interceptor接口，否則無法被攔截)。</span></p><pre><code>package com.lonelyWolf.mybatis.plugin;import org.apache.ibatis.executor.Executor;import org.apache.ibatis.mapping.MappedStatement;import org.apache.ibatis.plugin.*;import org.apache.ibatis.session.ResultHandler;import org.apache.ibatis.session.RowBounds;import java.util.Properties;@Intercepts({@Signature(type = Executor.class,method = "query",args = {MappedStatement.class,Object.class, RowBounds.class, ResultHandler.class})})public class MyPlugin implements Interceptor {    /**     * 這個方法會直接覆蓋原有方法     * @param invocation     * @return     * @throws Throwable     */    @Override    public Object intercept(Invocation invocation) throws Throwable {        System.out.println("成功攔截了Executor的query方法，在這裡我可以做點什麼");        return invocation.proceed();//調用原方法    }    @Override    public Object plugin(Object target) {        return Plugin.wrap(target,this);//把被攔截對象生成一個代理對象    }    @Override    public void setProperties(Properties properties) {//可以自定義一些屬性        System.out.println("自定義屬性:userName-&gt;" + properties.getProperty("userName"));    }}</code></pre><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">@Intercepts是聲明當前類是一個攔截器，後面的@Signature是標識需要攔截的方法簽名，通過以下三個參數來確定</span></p><ul><li>type：被攔截的類名。</li><li>method：被攔截的方法名</li><li>args：標註方法的參數類型</li></ul><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">2、我們還需要在mybatis-config中配置好插件。</span></p><pre><code>&lt;plugins&gt;        &lt;plugin interceptor="com.lonelyWolf.mybatis.plugin.MyPlugin"&gt;            &lt;property name="userName" value="張三"/&gt;        &lt;/plugin&gt;    &lt;/plugins&gt;</code></pre><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">這裡如果配置了property屬性，那麼我們可以在setProperties獲取到。</span></p><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999">完成以上兩步，我們就完成了一個插件的配置了，接下來我們運行一下：<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9b2842024f2e4c60af3a028a0ede8d43><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>可以看到，setProperties方法在加載配置文件階段就會被執行了。</span></p><h1 class=pgc-h-arrow-right><span style="color:#4f4f4f;--tt-darkmode-color: #979797">MyBatis插件實現原理</span></h1><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">接下來讓我們分析一下從插件的加載到初始化到運行整個過程的實現原理。</span></p><h1 class=pgc-h-arrow-right><span style="color:#4f4f4f;--tt-darkmode-color: #979797">插件的加載</span></h1><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999">既然插件需要在配置文件中進行配置，那麼肯定就需要進行解析，我們看看插件式如何被解析的。我們進入XMLConfigBuilder類看看<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2e757fa536454deebf7af7b8740f988e><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>解析出來之後會將插件存入InterceptorChain對象的list屬性<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b690200bcb4149839295df94a9256966><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>看到InterceptorChain我們是不是可以聯想到，</span><strong><span style="color:#4d4d4d;--tt-darkmode-color: #999999">MyBatis的插件就是通過責任鏈模式實現的</span></strong><span style="color:#4d4d4d;--tt-darkmode-color: #999999">。</span></p><h1 class=pgc-h-arrow-right><span style="color:#4f4f4f;--tt-darkmode-color: #979797">插件如何進行攔截</span></h1><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">既然插件類已經被加載到配置文件了，那麼接下來就有一個問題了，插件類何時會被攔截我們需要攔截的對象呢？</span></p><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">其實插件的攔截是和對象有關的，不同的對象進行攔截的時間也會不一致，接下來我們就逐一分析一下。</span></p><h1 class=pgc-h-arrow-right><span style="color:#4f4f4f;--tt-darkmode-color: #979797">攔截Executor對象</span></h1><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999">我們知道，SqlSession對象是通過openSession()方法返回的，而Executor又是屬於SqlSession內部對象，所以讓我們跟隨openSession方法去看一下Executor對象的初始化過程。<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c2b4fbdbae3e4cdab2f41b57332567b2><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>可以看到，當初始化完成Executor之後，會調用interceptorChain的pluginAll方法，pluginAll方法本身非常簡單，就是把我們存到list中的插件進行循環，並調用Interceptor對象的plugin方法：<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/c0fcf7e6170344e18ccc58927d8ce00f><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>再次點擊進去：<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d90fe91337cc4200afb4712bc9a10c43><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>到這裡我們是不是發現很熟悉，沒錯，這就是我們上面示例中重寫的方法，而plugin方法是接口中的一個默認方法。</span></p><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999">這個方法是關鍵，我們進去看看：<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7c27a2fb91784acfa87eac4415d7fc8a><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>可以看到這個方法的邏輯也很簡單，但是需要注意的是MyBatis插件是通過JDK動態代理來實現的，而JDK動態代理的條件就是被代理對象必須要有接口，這一點和Spring中不太一樣，Spring中是如果有接口就採用JDK動態代理，沒有接口就是用CGLIB動態代理。<br></span><strong><span style="color:#4d4d4d;--tt-darkmode-color: #999999">關於動態代理，想詳細瞭解的可以點擊這裡</span></strong><span style="color:#4d4d4d;--tt-darkmode-color: #999999">。</span></p><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999">正因為MyBatis的插件只使用了JDK動態代理，所以我們上面才強調了一定要實現Interceptor接口。<br>而代理之後匯之星Plugin的invoke方法，我們最後再來看看invoke方法：<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/598f405806c446748929e0eea67de618><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>而最終執行的intercept方法，就是我們上面示例中重寫的方法。</span></p><h1 class=pgc-h-arrow-right><span style="color:#4f4f4f;--tt-darkmode-color: #979797">其他對象插件解析</span></h1><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999">接下來我們再看看StatementHandler，StatementHandler是在Executor中的doQuery方法創建的，其實這個原理就是一樣的了，找到初始化StatementHandler對象的方法：<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/30a07174a5424d7896d1f1bcd9509712><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>進去之後裡面執行的也是pluginAll方法：<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/dc49819fe7994065aabd23ef01139599><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>其他兩個對象就</span><span style="color:#4d4d4d;--tt-darkmode-color: #999999">不在</span><span style="color:#4d4d4d;--tt-darkmode-color: #999999">舉例了，其實搜一下全局就很明顯了：<br>PS:<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/06370677bc6b490fa5ae0d6fb42541e8><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>四個對象初始化的時候都會調用pluginAll來進行判定是否有被代理。</span></p><h1 class=pgc-h-arrow-right><span style="color:#4f4f4f;--tt-darkmode-color: #979797">插件執行流程</span></h1><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999">下面就是實現了插件之後的執行時序圖：<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/980634d3191643f7b2b8b8f5bc3f583b><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><span style="color:#4f4f4f;--tt-darkmode-color: #979797">假如一個對象被代理很多次</span></h1><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">一個對象是否可以被多個代理對象進行代理？也就是說同一個對象的同一個方法是否可以被多個攔截器進行攔截？</span></p><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">答案是肯定的，因為被代理對象是被加入到list，所以我們</span><strong><span style="color:#4d4d4d;--tt-darkmode-color: #999999">配置在最前面的攔截器最先被代理，但是執行的時候卻是最外層的先執行</span></strong><span style="color:#4d4d4d;--tt-darkmode-color: #999999">。<br>具體點：<br>假如依次定義了三個插件：插件A，插件B和插件C。<br>那麼List中就會按順序存儲：插件A，插件B和插件C，而解析的時候是遍歷list，所以解析的時候也是按照：插件A，插件B和插件C的順序，但是執行的時候就要反過來了，執行的時候是按照：插件C，插件B和插件A的順序進行執行。</span></p><h1 class=pgc-h-arrow-right><span style="color:#4f4f4f;--tt-darkmode-color: #979797">PageHelper插件的使用</span></h1><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">上面我們瞭解了在MyBatis中的插件是如何定義以及MyBatis中是如何處理插件的，接下來我們就以經典分頁插件PageHelper為例來進一步加深理解。</span></p><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">首先我們看看PageHelper的用法：</span></p><pre><code>package com.lonelyWolf.mybatis;import com.alibaba.fastjson.JSONObject;import com.github.pagehelper.Page;import com.github.pagehelper.PageHelper;import com.github.pagehelper.PageInfo;import com.lonelyWolf.mybatis.mapper.UserMapper;import com.lonelyWolf.mybatis.model.LwUser;import org.apache.ibatis.executor.result.DefaultResultHandler;import org.apache.ibatis.io.Resources;import org.apache.ibatis.session.ResultHandler;import org.apache.ibatis.session.SqlSession;import org.apache.ibatis.session.SqlSessionFactory;import org.apache.ibatis.session.SqlSessionFactoryBuilder;import java.io.IOException;import java.io.InputStream;import java.util.List;public class MyBatisByPageHelp {    public static void main(String[] args) throws IOException {        String resource = "mybatis-config.xml";        //讀取mybatis-config配置文件        InputStream inputStream = Resources.getResourceAsStream(resource);        //創建SqlSessionFactory對象        SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);        //創建SqlSession對象        SqlSession session = sqlSessionFactory.openSession();        PageHelper.startPage(0,10);        UserMapper userMapper = session.getMapper(UserMapper.class);        List&lt;LwUser&gt; userList = userMapper.listAllUser();        PageInfo&lt;LwUser&gt; pageList = new PageInfo&lt;&gt;(userList);        System.out.println(null == pageList ? "": JSONObject.toJSONString(pageList));    }}</code></pre><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999">輸出如下結果：<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/83d4148fb5ce42dbab0d83990aa39c4d><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>可以看到對象已經被分頁，那麼這是如何做到的呢？</span></p><h1 class=pgc-h-arrow-right><span style="color:#4f4f4f;--tt-darkmode-color: #979797">PageHelper插件原理</span></h1><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999">我們上面提到，要實現插件必須要實現MyBatis提供的Interceptor接口，所以我們去找一下，發現PageHeler實現了Interceptor：<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/feeeca4b16ac421ab5fb121e7d1b3df7><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>經過上面的介紹這個類應該一眼就能看懂，我們關鍵要看看SqlUtil的intercept方法做了什麼：<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/209baf973f894947897270a7c9fa15fc><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>這個方法的邏輯比較多，因為要考慮到不同的數據庫方言的問題，所以會有很多判斷，我們主要是關注PageHelper在哪裡改寫了sql語句，上圖中的紅框就是改寫了sql語句的地方：<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/58ce1e0ba6404294ab01d3329507df92><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>這裡面會獲取到一個Page對象，然後在愛寫sql的時候也會將一些分頁參數設置到Page對象，我們看看Page對象是從哪裡獲取的：<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1391dba30b2a42f88158389d9d721dc2><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999">我們看到對象是從LOCAL_PAGE對象中獲取的，這個又是什麼呢？<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5988773549604ac2b659b20e35c60947><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>這是一個本地線程池變量，那麼這裡面的Page又是什麼時候存進去的呢？<br>這就要回到我們的示例上了，分頁的開始必須要調用：</span></p><pre><code>PageHelper.startPage(0,10);</code></pre><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/382de90bab614b8eb341f02d0fef6afb><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>這裡就會構建一個Page對象，並設置到ThreadLocal內。</span></p><h1 class=pgc-h-arrow-right><span style="color:#4f4f4f;--tt-darkmode-color: #979797">為什麼PageHelper只對startPage後的第一條select語句有效</span></h1><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999">這個其實也很簡單哈，但是可能會有人有這個</span><span style="color:#4d4d4d;--tt-darkmode-color: #999999">以為</span><span style="color:#4d4d4d;--tt-darkmode-color: #999999">，我們還是要回到上面的intercept方法：<br></span></p><div class=pgc-img><img alt=一怒之下我自己寫了個PageHelper分頁插件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/89fd2c041ea84d8c8007d67261caffeb><p class=pgc-img-caption></p></div><p><span style="color:#4d4d4d;--tt-darkmode-color: #999999"><br>在finally內把ThreadLocal中的分頁數據給清除掉了，所以只要執行一次查詢語句就會清除分頁信息，故而後面的select語句自然就無效了。</span></p><h1 class=pgc-h-arrow-right><span style="color:#4f4f4f;--tt-darkmode-color: #979797">不通過插件能否改變MyBatis的核心行為</span></h1><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">上面我們介紹了通過插件來改變MyBatis的核心行為，那麼不通過插件是否也可以實現呢？</span></p><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">答案是肯定的，官網中提到，我們可以通過覆蓋配置類來實現改變MyBatis核心行為，也就是我們自己寫一個類繼承Configuration類，然後實現其中的方法，最後構建SqlSessionFactory對象的時候傳入自定義的Configuration方法：</span></p><pre><code>SqlSessionFactory build(MyConfiguration)</code></pre><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">當然，這種方法是非常不建議使用的，因為這種方式就相當於在建房子的時候把地基抽出來重新建了，稍有不慎，房子就要塌了。</span></p><h1 class=pgc-h-arrow-right><span style="color:#4f4f4f;--tt-darkmode-color: #979797">總結</span></h1><p style=text-align:start><span style="color:#4d4d4d;--tt-darkmode-color: #999999">本文主要會介紹MyBatis插件的使用及MyBatis其實現原理，最後我們也大致介紹了PageHelper插件的主要實現原理，相信讀完本文學會MyBatis插件原理之後，我們也可以寫個自己的PageHelper分頁插件了。</span></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>插件</a></li><li><a>PageHelper</a></li><li><a>分頁</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/9a900bc.html alt=PageHelper分頁插件源碼及原理剖析 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7be33d442f35419cbb3709ec81b6fb94 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9a900bc.html title=PageHelper分頁插件源碼及原理剖析>PageHelper分頁插件源碼及原理剖析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1dcde7b.html alt=Mybatis：PageHelper分頁插件源碼及原理剖析 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7b3698d638b3452ea05fc8a04e06c773 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1dcde7b.html title=Mybatis：PageHelper分頁插件源碼及原理剖析>Mybatis：PageHelper分頁插件源碼及原理剖析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5ba214b.html alt=分享：（血和淚的成果）使用PageHelper分頁插件進行後臺分頁 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/3e574121-b317-438d-99fc-6d4a76b02978 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5ba214b.html title=分享：（血和淚的成果）使用PageHelper分頁插件進行後臺分頁>分享：（血和淚的成果）使用PageHelper分頁插件進行後臺分頁</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d57d336.html alt=分頁插件使用的方式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3dc39ccc703f4fa3a7fcbd967f8cf897 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d57d336.html title=分頁插件使用的方式>分頁插件使用的方式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d22b92b0.html alt=SW齒輪設計插件「GearTrax」破解版免費下載附安裝教程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/857f3094d9ec4f54b1b8ca1abd412f40 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d22b92b0.html title=SW齒輪設計插件「GearTrax」破解版免費下載附安裝教程>SW齒輪設計插件「GearTrax」破解版免費下載附安裝教程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c6fe44c8.html alt=下載安卓桌面便籤插件怎麼在手機桌面上設置添加顯示便籤組部件 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/5e8100039a46b9346f6f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c6fe44c8.html title=下載安卓桌面便籤插件怎麼在手機桌面上設置添加顯示便籤組部件>下載安卓桌面便籤插件怎麼在手機桌面上設置添加顯示便籤組部件</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/01f497f5.html alt=你缺的不是收藏而是藏經閣——那些好用的收藏夾整理插件/網站 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/e67aba1a12e74d4597176dba6e2bc387 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/01f497f5.html title=你缺的不是收藏而是藏經閣——那些好用的收藏夾整理插件/網站>你缺的不是收藏而是藏經閣——那些好用的收藏夾整理插件/網站</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4db2f58a.html alt="ECSHOP 短信插件說明" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4db2f58a.html title="ECSHOP 短信插件說明">ECSHOP 短信插件說明</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/55359697.html alt=七個PPT小插件，隨便用上一個你就是大神 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1525671634120519189df6c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/55359697.html title=七個PPT小插件，隨便用上一個你就是大神>七個PPT小插件，隨便用上一個你就是大神</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b96f6964.html alt=在多個瀏覽器中添加IDM插件 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/7a235092f6244f0db94a546bc46d2bdf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b96f6964.html title=在多個瀏覽器中添加IDM插件>在多個瀏覽器中添加IDM插件</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dbca9845.html alt="Slate Digital Plug-Ins 板岩插件系列 5件套" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9248511199a3468eac8b059fe4ccb5b8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dbca9845.html title="Slate Digital Plug-Ins 板岩插件系列 5件套">Slate Digital Plug-Ins 板岩插件系列 5件套</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6705b0a4.html alt=插件電阻阻值的標示法有哪些？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d891115400cc46509e71af426e3ada13 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6705b0a4.html title=插件電阻阻值的標示法有哪些？>插件電阻阻值的標示法有哪些？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/603d8ae7.html alt=兩款VB6開發環境插件，修改IDE對話框尺寸、快速添加常用引用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d5d44a749d30403fbdaf27a941360f74 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/603d8ae7.html title=兩款VB6開發環境插件，修改IDE對話框尺寸、快速添加常用引用>兩款VB6開發環境插件，修改IDE對話框尺寸、快速添加常用引用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1ffbfd1a.html alt=技能帖｜談談Django的CSRF插件的漏洞 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1533025935328f982c8f727 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1ffbfd1a.html title=技能帖｜談談Django的CSRF插件的漏洞>技能帖｜談談Django的CSRF插件的漏洞</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1142cdfd.html alt="Fuse.js - 輕量級零依賴的JS模糊搜索插件" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/3291ddda-252e-46ea-b96c-3dc6d24b793f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1142cdfd.html title="Fuse.js - 輕量級零依賴的JS模糊搜索插件">Fuse.js - 輕量級零依賴的JS模糊搜索插件</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>