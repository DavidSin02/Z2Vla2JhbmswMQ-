<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>談談開發過程中的配置文件 | 极客快訊</title><meta property="og:title" content="談談開發過程中的配置文件 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/0cc819f5ba01468e87688c124fcfc122"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c916556.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c916556.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c916556.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c916556.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c916556.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c916556.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/c916556.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/c916556.html><meta property="article:published_time" content="2020-10-29T20:59:53+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:53+08:00"><meta name=Keywords content><meta name=description content="談談開發過程中的配置文件"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/c916556.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>談談開發過程中的配置文件</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>在應用程序開發中，配置文件是一個重要但反而總是被忽略掉的問題，因為它的解決方案很簡單，而且在項目中往往被架構師一次性就寫好了，其他的開發人員只是用就可以了，根本不用關心。但是初學者在從頭搭建項目腳手架時，往往被這貌似簡單的問題絆住手腳，浪費時間。今天花點時間說下我所理解的配置化</p><p>單獨說配置文件其實非常簡單，無非就是把一些程序中會用到的參數放置到文本文件中，方便之後修改，但是往往這些配置項是程序的關鍵參數，比如數據庫連接地址、接口地址，連接池定義、程序的logo等。這些參數往往都與環境相關，在本地開發時、測試環境、灰度環境、生產環境都不一樣，於是需要根據不同的環境用不同的配置文件，這就是我們的需求的來源</p><p>隨便列舉幾種應用場景：</p><p>1、中間件地址不同。我們的應用都依賴於一個隊列集群，不同環境下的隊列集群地址不一樣。</p><p>2、日誌打印的位置不一樣。在本地調試時，我的日誌打印到一個目錄下，但是在測試環境的主機上，我希望日誌打印到另外一個目錄下</p><p>3、希望根據不同的環境做不同的業務處理。業務需求說每天給xxx@email.com發送郵件，但是我只想生產環境發送真實的郵件，測試環境我希望只是返回一個成功字符串即可。</p><p><strong>使用spring.profile.active</strong></p><p>從以上的問題就可以看出，定義出能區分環境的變量非常關鍵，於是自然而然想到，在啟動程序時傳入一個參數，告訴程序目前是什麼環境，程序根據不同的環境來加載不同的配置項。</p><p>於是，在spring的世界裡，開發者們定義了spring.profile.active這個變量，並互相約定當在xml或者Bean定義中見到profile時，把它當做環境的標識。比如：只有在當前模式為spring.profile.active=test的時候，才會加載profile=test的配置項。這在一些Spring團隊出品的軟件上工作的不錯。隨著時間的推移，spring成為實際意義上的j2ee標準，於是這一做法獲得廣泛的應用，舉一個配置文件的例子：</p><div class=pgc-img><img alt=談談開發過程中的配置文件 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0cc819f5ba01468e87688c124fcfc122><p class=pgc-img-caption></p></div><p>在程序啟動時jvm參數傳入-Dspring.profile.active=test</p><p><strong>打包工具和佔位符</strong></p><p>上述spring.profile.active操作方式解決了不少的問題，但是這還是遺留了一些問題：</p><p>問題一：如何傳入這個參數帶來了一些新的工作量，儘管spring提供了各種各樣的方式設置這個參數，比如：設置在操作系統環境變量裡、設置在tomcat的jvm參數等，但是這些方法都需要在程序的目標主機上做些操作，儘管這工作量並不大，但是程序不再是隨處遷移的，必須要在相應的主機上進行設置才行。</p><p>問題二：在一些並不是spring團隊出品或者沒有遵循spring.profile.active設計的一些軟件上時，這種方式並不好用的。當然還是可以通過一些修改，把配置遷移到spring中以遵循這個設計，但是成本還是有點高。</p><p>問題三：分佈式應用越來越流行，相同的應用越來越多，每一份配置文件都要在程序中放一份，當修改了一個配置項時，所有的相關程序都要重新部署打包。</p><p>針對問題一和二，工程師們想出了另外的一種解決思路，就是利用maven或者gradle等打包工具，把環境參數的定義放在打包部署的環節，在編譯打包的時候，傳入相應的環境參數，來決定將什麼樣的配置項打包部署到程序包中去，這樣就不需要在運行時做處理，而且也不依賴spring.profile.active設計。</p><p>以gradle下spring boot為例，配置文件通常是放置到src/main/resources中的，比如：</p><p>開發環境下</p><p>bootstrap.properties定義了隊列集群的地址：</p><div class=pgc-img><img alt=談談開發過程中的配置文件 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/7904e331fd8941e1b514d60cef35a164><p class=pgc-img-caption></p></div><p>log4j2.xml定義了日誌文件的路徑及名稱：</p><div class=pgc-img><img alt=談談開發過程中的配置文件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0b6a6ede3bbb4136b1f41cd146b89cba><p class=pgc-img-caption></p></div><p><em>測試環境下</em></p><p>bootstrap.properties定義了隊列集群的地址：</p><div class=pgc-img><img alt=談談開發過程中的配置文件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/27a56cc9dfaf4a6680a856da11e89fb7><p class=pgc-img-caption></p></div><p>將log4j2.xml中的內容替換為：</p><div class=pgc-img><img alt=談談開發過程中的配置文件 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7610470ed4c742dca971e5b500f37367><p class=pgc-img-caption></p></div><p>再聲明一個新的配置文件config.groovy</p><div class=pgc-img><img alt=談談開發過程中的配置文件 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/aa6ee874be3a4af287e745120563c49d><p class=pgc-img-caption></p></div><p>看明白了嗎，我們的目標就是將config.groovy中的內容根據不同的環境（dev or test），替換不同的配置項到配置文件中去，如何做到這一點呢，利用gradle的一個內置任務processResources</p><p>修改build.gradle文件（gradle的打包配置文件，同maven的pom文件，不懂得去百度）</p><div class=pgc-img><img alt=談談開發過程中的配置文件 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bfe00869f8be4cada96fafa29e7d6f13><p class=pgc-img-caption></p></div><p>定義好了的話，當你使用gradle bootRun -DprofileMode=test的時候，程序中配置文件的@@佔位符最終都會被替換成config.groovy的test下的內容。</p><p>當然，不使用佔位符的話，使用不同的文件夾也可以作區分比如test文件都放到test文件夾下，在打包命令gradle bootRun -DprofileMode=test時，使用test文件夾的內容替換src/main/resources的內容，但是我認為這種方式處理起來還是不如佔位符更加清晰明瞭。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>配置文件</a></li><li><a>談談</a></li><li><a>開發</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/e2e4fe9.html alt=python開發項目，不得不瞭解的.cfg配置文件 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/396d15e0aa73488fa469d2a80e62dcbe style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e2e4fe9.html title=python開發項目，不得不瞭解的.cfg配置文件>python開發項目，不得不瞭解的.cfg配置文件</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a980c6f3.html alt=教你從頭學前端開發——第一個網頁（一） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1c44113d83f24f5db93c8353aff0c670 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a980c6f3.html title=教你從頭學前端開發——第一個網頁（一）>教你從頭學前端開發——第一個網頁（一）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e1f5a66a.html alt=網頁開發網頁的相關概念你知道嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/8ca7902bdcb14bc5a25a88be4953edd6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e1f5a66a.html title=網頁開發網頁的相關概念你知道嗎？>網頁開發網頁的相關概念你知道嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9552c1b8.html alt="軟件開發中數據庫必備基礎01 - 圖解事務基礎" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e4e00ac778db451792b955bde23add02 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9552c1b8.html title="軟件開發中數據庫必備基礎01 - 圖解事務基礎">軟件開發中數據庫必備基礎01 - 圖解事務基礎</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f8c3b92d.html alt=python安全開發軍規之四：使用安全的隨機數生成器 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bbda123b84db44148aca9d3e26ddf119 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f8c3b92d.html title=python安全開發軍規之四：使用安全的隨機數生成器>python安全開發軍規之四：使用安全的隨機數生成器</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/382d9587.html alt=談談我的對彩票隨機事件小概率的看法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/64e0d9189e2a40128e7577bbadd25154 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/382d9587.html title=談談我的對彩票隨機事件小概率的看法>談談我的對彩票隨機事件小概率的看法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/234d55fa.html alt=Java開發課程（十）——面向對象5、多態 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/df3621e51e4242fd90731dd013472f12 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/234d55fa.html title=Java開發課程（十）——面向對象5、多態>Java開發課程（十）——面向對象5、多態</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/64d13873.html alt=文科無用論：談談近代以來文科的衰落 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/f1b9f3e9-2ccf-4782-9011-bbcf07d0905b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/64d13873.html title=文科無用論：談談近代以來文科的衰落>文科無用論：談談近代以來文科的衰落</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1c9afde0.html alt="一起來談談ThreadLocal 原理吧！你需要了解！" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/499a403f2b63464db8e3e12298c1a3e5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1c9afde0.html title="一起來談談ThreadLocal 原理吧！你需要了解！">一起來談談ThreadLocal 原理吧！你需要了解！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/894f3dfe.html alt=談談液壓油缸防鏽和控制溫度、速度的重要性 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1c05777a41984cc29fcc7d8550c1c45e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/894f3dfe.html title=談談液壓油缸防鏽和控制溫度、速度的重要性>談談液壓油缸防鏽和控制溫度、速度的重要性</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8dd83b90.html alt=常用最全正則表達式整理(開發必備) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5127ac984657471b853b307afe52b2fe style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8dd83b90.html title=常用最全正則表達式整理(開發必備)>常用最全正則表達式整理(開發必備)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e2ad303f.html alt=給JAVA開發人員的正則表達式入門課 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/5d620d422d0a4855924c5bcbf8ba483a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e2ad303f.html title=給JAVA開發人員的正則表達式入門課>給JAVA開發人員的正則表達式入門課</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6d3adf54.html alt=Win10系統如何刪除用戶配置文件？這個方法麻煩收好 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/5d9b3c531d8e4d64ac1f5582c2a6867e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6d3adf54.html title=Win10系統如何刪除用戶配置文件？這個方法麻煩收好>Win10系統如何刪除用戶配置文件？這個方法麻煩收好</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b54ce2e1.html alt="Windows 10 KB4549951補丁讓用戶配置文件缺失故障再次發生" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/Ry0yIZwBOBWLcl style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b54ce2e1.html title="Windows 10 KB4549951補丁讓用戶配置文件缺失故障再次發生">Windows 10 KB4549951補丁讓用戶配置文件缺失故障再次發生</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e5f86559.html alt="外媒發現Windows 10用戶配置文件丟失問題仍舊存在" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RxyuIVJ8HFwmLA style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e5f86559.html title="外媒發現Windows 10用戶配置文件丟失問題仍舊存在">外媒發現Windows 10用戶配置文件丟失問題仍舊存在</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>