<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>淺析HDFS架構和設計 | 极客快訊</title><meta property="og:title" content="淺析HDFS架構和設計 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/5ab2c36d649e4f21b0ceacc2d36d0d49"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cd1b81d8.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cd1b81d8.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/cd1b81d8.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cd1b81d8.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cd1b81d8.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/cd1b81d8.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/cd1b81d8.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cd1b81d8.html><meta property="article:published_time" content="2020-11-14T21:03:23+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:23+08:00"><meta name=Keywords content><meta name=description content="淺析HDFS架構和設計"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/cd1b81d8.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>淺析HDFS架構和設計</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>作者 | 大尊</p><p>hdfs是hadoop的分佈式文件系統，即Hadoop Distributed Filesystem。下面主要講下HDFS設計中的比較重要的點，使讀者能通過簡短的文章一窺HDFS的全貌，適合對HDFS有一點了解，但是對HDFS又感到困惑的初學者。本文主要參考的是hadoop 3.0的官方文檔。</p><p>鏈接：http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HdfsDesign.html</p><p>當數據集的大小超過了一臺物理機所能存儲的能力時，就需要將它進行分區並存儲到若干不同的獨立的計算機上，其中管理跨多臺計算機存儲的文件系統稱為分佈式文件系統。</p><p><strong>目錄</strong></p><ul><li>使用HDFS的場景</li><li>HDFS的工作模式</li><li>文件系統命名空間（namespace）</li><li>數據複製</li><li>文件系統元數據的持久化</li><li>通訊協議</li><li>健壯性</li><li>數據組織</li><li>可訪問性</li><li>存儲空間回收</li></ul><p><strong>1、使用HDFS的場景</strong></p><p>HDFS適合於以流式數據訪問模式來存儲超大的文件。即一次寫入，多次讀取，在數據集上長時間進行各種分析，每次分析都涉及該數據集數據的大部分甚至全部，對於超大文件，hadoop目前以支持存儲PB級數據。</p><p>HDFS並不適合要求低時間延遲數據訪問的應用，因為HDFS是為高數據吞吐量應用而優化的，這就有可能以時間延遲大為代價。</p><p>HDFS文件系統所能存儲的文件總數受限於namenode的內存容量，根據經驗，100百萬的文件，且每個文件佔一個數據塊，那至少需要300MB的內存。</p><p>目前hadoop文件可能只有一個writer,而且寫操作總是將數據添加在文件末尾，不支持在文件的任意位置進行修改。</p><p>相對於普通文件系統的數據塊，HDFS也有塊的概念，默認是128MB，HDFS上的文件也被劃分成塊大小的多個分塊，作為獨立的存儲單元，不過HDFS中小於一個塊大小的文件不會佔據整個塊的空間。如果沒有特別指出，文中提到的塊特指HDFS的塊。</p><p>為何HDFS的塊如此之大，其目的是為了最小化尋址開銷。這個數也不能設置的過大，mapreduce中的map任務通常一次只處理一個塊中的數據，因此如果任務數太少，作業的運行速度就會比較慢。</p><p><strong>2、HDFS的工作模式</strong></p><p>HDFS採用master/slave架構，即一個namenode(管理者)多個datanode(工作者)。</p><p>namenode負責管理文件系統的命名空間。維護著文件系統樹和整個樹內所有的文件和目錄，這些信息都保存在兩個文件中，命名空間鏡像文件和編輯日誌文件。namenode也記錄了每個文件中各個塊所在的數據節點信息。datanode是文件系統的工作節點，它們需要存儲並檢索數據塊（受客戶端或namenode調度），並定期向namenode發送它們所存儲的塊的列表。</p><p>如果沒有namenode,文件系統將無法使用，因為我們不知道如何根據datanode的塊重建文件，所以對namenode進行容錯是非常重要的。為此hadoop提供了兩種機制。</p><p>第一種機制是備份那些組成文件系統元數據持久狀態的文件。一般，在將持久化文件寫入本地磁盤的同時，寫入遠程掛載的NFS。</p><p>第二種方法是運行一個輔助namenode，這個輔助namenode定期通過編輯日誌合併命名空間鏡像，並在本地保存合併後的命名空間鏡像的副本，在namenode發生故障時啟用。但是在主節點失效時，難免會丟失部分數據，這時可以把存儲在NFS的namenode元數據複製到輔助的namenode上作為新的namenode運行。這其中涉及到故障轉移的機制。稍後會做一點分析。</p><p><strong>3、文件系統命名空間（namespace）</strong></p><p>HDFS支持傳統的層次型文件組織結構。用戶或者應用程序可以創建目錄，然後將文件保存在這些目錄裡。</p><p>文件系統名字空間的層次結構和大多數現有的文件系統類似：用戶可以創建、刪除、移動或重命名文件。HDFS支持用戶磁盤配額和訪問權限控制，目前還不支持硬鏈接和軟鏈接。但是HDFS架構並不妨礙實現這些特性。</p><p>Namenode負責維護文件系統的名字空間，任何對文件系統名字空間或屬性的修改都將被Namenode記錄下來。應用程序可以設置HDFS保存的文件的副本數目。文件副本的數目稱為文件的副本系數，這個信息也是由Namenode保存的。</p><p><strong>4、數據複製</strong></p><p>HDFS被設計成能夠在一個大集群中跨機器可靠地存儲超大文件。它將每個文件存儲成一系列的數據塊，除了最後一個，所有的數據塊都是同樣大小的。</p><p>為了容錯，文件的所有數據塊都會有副本。每個文件的數據塊大小和副本系數都是可配置的。 應用程序可以指定某個文件的副本數目。副本系數可以在文件創建的時候指定，也可以在之後改變。</p><p>HDFS中的文件都是一次性寫入的，並且嚴格要求在任何時候只能有一個寫入者。</p><p>Namenode全權管理數據塊的複製，它週期性地從集群中的每個Datanode接收心跳信號和塊狀態報告(Blockreport)。當一個Datanode啟動時，它會掃描本地文件系統，產生一個這些本地文件對應的所有HDFS數據塊的列表，然後作為報告發送到Namenode，這個報告就是塊狀態報告。接收到心跳信號意味著該Datanode節點工作正常。塊狀態報告包含了一個該Datanode上所有數據塊的列表。</p><p>數據塊列表獲取。查看數據塊的健康狀態：hdfs fsck / -files -block或者hdfs fsck /</p><div class=pgc-img><img alt=淺析HDFS架構和設計 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5ab2c36d649e4f21b0ceacc2d36d0d49><p class=pgc-img-caption></p></div><p class=ql-align-center>HDFS的數據塊存儲在以_blk為前綴名的文件中，每個塊還有一個相關的帶有.meta後綴的元數據文件，元數據文件包括頭部和該塊各區段的一系列校驗和。</p><p>當數據塊的數量增加到一定規模時，datanode會創建一個子目錄來存放新的數據塊及元數據信息。如果當前目錄已經存儲了64個（通過dfs.datanode.numlocks屬性設置）數據塊時，就創建一個子目錄，終極目標是設計一顆高扇出的目錄樹。</p><p>如果dfs.datanode.data.dir屬性指定了不同磁盤的多個目錄，那麼數據塊會以輪轉（round-robin）的方式寫入到各個目錄中。</p><p>在每個datanode上也會運行一個塊掃描器，定期檢測本節點上的所有塊，從而在客戶端讀取到壞塊之前就及時的檢測和修復壞塊。默認情況下每隔3週會測試塊的狀態，並對可能的故障進行修復。</p><p>用戶可以通過http://datanode:50070/blockScannerReport獲取該datanode的塊檢測報告。</p><p><strong>副本存放</strong></p><p>副本的存放是HDFS可靠性和性能的關鍵。優化的副本存放策略是HDFS區分於其他大部分分佈式文件系統的重要特性。這種特性需要做大量的調優，並需要經驗的積累。HDFS採用一種稱為機架感知(rack-aware)的策略來改進數據的可靠性、可用性和網絡帶寬的利用率。目前實現的副本存放策略只是在這個方向上的第一步。</p><p>通過一個機架感知的過程，Namenode可以確定每個Datanode所屬的機架id。一個簡單但沒有優化的策略就是將副本存放在不同的機架上。這樣可以有效防止當整個機架失效時數據的丟失，並且允許讀數據的時候充分利用多個機架的帶寬。這種策略設置可以將副本均勻分佈在集群中，有利於當組件失效情況下的負載均衡。但是，因為這種策略的一個寫操作需要傳輸數據塊到多個機架，這增加了寫的代價。</p><p>在大多數情況下，副本系數是3，HDFS的存放策略是將一個副本存放在本地機架的節點上，一個副本放在同一機架的另一個節點上，最後一個副本放在不同機架的節點上。這種策略減少了機架間的數據傳輸，這就提高了寫操作的效率。</p><p>而在現實中，在hadoop2.0中，datanode數據副本存放磁盤選擇策略有兩種方式：</p><p>第一種是沿用hadoop1.0的磁盤目錄輪詢方式，實現類：</p><p>RoundRobinVolumeChoosingPolicy.java</p><p>第二種是選擇可用空間足夠多的磁盤方式存儲，實現類：AvailableSpaceVolumeChoosingPolicy.java</p><p>第二種策略對應的配置項是：</p><div class=pgc-img><img alt=淺析HDFS架構和設計 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7df0721b51e849aba5ee640f9d9d4cc7><p class=pgc-img-caption></p></div><p class=ql-align-center>如果不配置，默認使用第一種方式，既輪詢選擇磁盤來存儲數據副本，但是輪詢的方式雖然能夠保證所有磁盤都能夠被使用，但是經常會出現各個磁盤直接數據存儲不均衡問題，有的磁盤存儲得很滿了，而有的磁盤可能還有很多存儲空間沒有得到利用，所有在hadoop2.0集群中，最好將磁盤選擇策略配置成第二種，根據磁盤空間剩餘量來選擇磁盤存儲數據副本，這樣一樣能保證所有磁盤都能得到利用，還能保證所有磁盤都被利用均衡。</p><p>在採用第二種方式時還有另外兩個參數會用到：</p><div class=pgc-img><img alt=淺析HDFS架構和設計 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e53d23b3c1cb47569a649b331a116746><p class=pgc-img-caption></p></div><p class=ql-align-center>默認值是10737418240，既10G，一般使用默認值就行。官方解釋為，首先計算出兩個值，一個是所有磁盤中最大可用空間，另外一個值是所有磁盤中最小可用空間，如果這兩個值相差小於該配置項指定的閥值時，則就用輪詢方式的磁盤選擇策略選擇磁盤存儲數據副本。</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=淺析HDFS架構和設計 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/d68a745a48cf4968be98ad2ad5a92e1f><p class=pgc-img-caption></p></div><p>默認值是0.75f，一般使用默認值就行。官方解釋為，有多少比例的數據副本應該存儲到剩餘空間足夠多的磁盤上。該配置項取值範圍是0.0-1.0，一般取0.5-1.0，如果配置太小，會導致剩餘空間足夠的磁盤實際上沒分配足夠的數據副本，而剩餘空間不足的磁盤取需要存儲更多的數據副本，導致磁盤數據存儲不均衡。</p><p><strong>副本選擇</strong></p><p>為了降低整體的帶寬消耗和讀取延時，HDFS會盡量讓讀取程序讀取離它最近的副本。如果在讀取程序的同一個機架上有一個副本，那麼就讀取該副本。如果一個HDFS集群跨越多個數據中心，那麼客戶端也將首先讀本地數據中心的副本。</p><p><strong>安全模式</strong></p><p>Namenode啟動後會進入一個稱為安全模式的特殊狀態。 處於安全模式的Namenode是不會進行數據塊的複製的。Namenode從所有的 Datanode接收心跳信號和塊狀態報告。塊狀態報告包括了某個Datanode所有的數據塊列表。每個數據塊都有一個指定的最小副本數。</p><p>當Namenode檢測確認某個數據塊的副本數目達到這個最小值(最小值默認是1，由dfs.namenode.replication.min屬性設置)，那麼該數據塊就會被認為是副本安全(safely replicated)的；在一定百分比（這個參數可配置,默認是0.999f,屬性值為dfs.safemode.threshold.pct）的數據塊被Namenode檢測確認是安全之後（加上一個額外的30秒等待時間），Namenode將退出安全模式狀態。接下來它會確定還有哪些數據塊的副本沒有達到指定數目，並將這些數據塊複製到其他Datanode上。</p><p>如果datanode丟失的block達到一定的比例,namenode就會一直處於安全模式即只讀模式。</p><p>當namenode處於安全模式時，該怎麼處理？</p><p>找到問題所在，進行修復（比如修復宕機的datanode)。</p><p>或者可以手動強行退出安全模式（沒有真正解決問題）： hdfs namenode --safemode leave。</p><p>在hdfs集群正常冷啟動時，namenode也會在safemode狀態下維持相當長的一段時間，此時你不需要去理會，等待它自動退出安全模式即可。</p><p>用戶可以通過dfsadmin -safemode value 來操作安全模式，參數value的說明如下：</p><p>enter - 進入安全模式</p><p>leave - 強制NameNode離開安全模式</p><p>get - 返回安全模式是否開啟的信息</p><p>wait - 等待，在執行某條命令前先退出安全模式。</p><p><strong>5、文件系統元數據的持久化</strong></p><p>Namenode上保存著HDFS的名字空間。對於任何對文件系統元數據產生修改的操作，Namenode都會使用一種稱為EditLog的事務日誌記錄下來。例如，在HDFS中創建一個文件，Namenode就會在Editlog中插入一條記錄來表示；同樣地，修改文件的副本系數也將往Editlog插入一條記錄。Namenode在本地操作系統的文件系統中存儲這個Editlog。</p><p>整個文件系統的名字空間，包括數據塊到文件的映射、文件的屬性等，都存儲在一個稱為FsImage的文件中，這個文件也是放在Namenode所在的本地文件系統上。</p><p>Namenode在內存中保存著整個文件系統的名字空間和文件數據塊映射(Blockmap)的映像(即FsImage)。這個關鍵的元數據結構設計得很緊湊，因而一個有4G內存的Namenode足夠支撐大量的文件和目錄。</p><p>當Namenode啟動時，或者檢查點達到配置文件中的閥值，它從硬盤中讀取Editlog和FsImage，將所有Editlog中的事務作用在內存中的FsImage上，並將這個新版本的FsImage從內存中保存到本地磁盤上，然後刪除舊的Editlog，因為這個舊的Editlog的事務都已經作用在FsImage上了。這個過程稱為一個檢查點(checkpoint)。</p><p>hdfs dfsadmin -fetchImage fsimage.backup</p><p>//手動從namenode獲取最新fsimage文件，並保存為本地文件。</p><p>因為編輯日誌會無限增長，那麼恢復編輯日誌的過程就會比較長，解決方案是，運行輔助namenode,為主namenode內存中的文件系統元數據創建檢查點。最終主namenode擁有最新的fsimage文件和更小的edits文件。</p><p>這也解釋了輔助namenode和主namenode擁有相近內存需求的原因（輔助namenode也需要把fsimage文件載入內存）。</p><p>創建檢查點的觸發條件受兩個配置參數控制，</p><p>dfs.namenode.checkpoint.period屬性（輔助namenode每隔一段時間就創建檢查點，單位s）。dfs.namenode.checkpoint.txns,如果從上一個檢查點開始編輯日誌大小達到多少的事務數時，創建檢查點。</p><p>在主namenode發生故障時（假設沒有備份），就可以從輔助的namenode上恢復數據。有兩種實現方式。</p><p>方法一，將相關的存儲目錄複製到新的namenode中 。</p><p>方法二，使用-importCheckpoint選項啟動namenode守護進程，從而將輔助namenode用作新的主namenode,有個前提時，dfs.namenode.dir屬性定義的目錄中沒有元數據時。</p><p><strong>6、通訊協議</strong></p><p>所有的HDFS通訊協議都是建立在TCP/IP協議之上。客戶端通過一個可配置的TCP端口連接到Namenode，通過ClientProtocol協議與Namenode交互。而Datanode使用DatanodeProtocol協議與Namenode交互。</p><p>一個遠程過程調用(RPC)模型被抽象出來封裝ClientProtocol和Datanodeprotocol協議。在設計上，Namenode不會主動發起RPC，而是響應來自客戶端或 Datanode 的RPC請求。</p><p><strong>7、健壯性</strong></p><p>HDFS的主要目標就是即使在出錯的情況下也要保證數據存儲的可靠性。</p><p>常見的三種出錯情況是：Namenode出錯, Datanode出錯和網絡割裂(network partitions)。</p><p>心跳檢測,磁盤數據錯誤和重新複製。</p><p>每個Datanode節點週期性地向Namenode發送心跳信號。網絡割裂可能導致一部分Datanode跟Namenode失去聯繫。Namenode通過心跳信號的缺失來檢測這一情況，並將這些近期不再發送心跳信號Datanode標記為宕機，不會再將新的IO請求發給它們。任何存儲在宕機Datanode上的數據將不再有效。</p><p>Datanode的宕機可能會引起一些數據塊的副本系數低於指定值，Namenode不斷地檢測這些需要複製的數據塊，一旦發現就啟動複製操作。</p><p>設置合適的datanode心跳超時時間，避免用datanode不穩定導致的複製風暴。</p><p>在下列情況下，也可能需要重新複製：某個Datanode節點失效，某個副本遭到損壞，Datanode上的硬盤錯誤，或者文件的副本系數增大。</p><p><strong>集群均衡（針對datanode）</strong></p><p>HDFS的架構支持數據均衡策略。如果某個Datanode節點上的空閒空間低於特定的臨界點，按照均衡策略系統就會自動地將數據從這個Datanode移動到其他空閒的Datanode。</p><p>個文件的請求突然增加，那麼也可能啟動一個計劃創建該文件新的副本，並且同時重新平衡集群中的其他數據。這個均衡策略目前還沒有實現。</p><p><strong>數據完整性（針對datanode）</strong></p><p>從某個Datanode獲取的數據塊有可能是損壞的，損壞可能是由Datanode的存儲設備錯誤、網絡錯誤或者軟件bug造成的。HDFS客戶端軟件實現了對HDFS文件內容的校驗和(checksum)檢查。</p><p>當客戶端創建一個新的HDFS文件，會計算這個文件每個數據塊的校驗和，並將校驗和作為一個單獨的隱藏文件保存在同一個HDFS名字空間下。當客戶端獲取文件內容後，它會檢驗從Datanode獲取的數據跟相應的校驗和文件中的校驗和是否匹配，如果不匹配，客戶端可以選擇從其他Datanode獲取該數據塊的副本。</p><p><strong>元數據磁盤錯誤（針對namenode出錯）</strong></p><p>FsImage和Editlog是HDFS的核心數據結構。如果這些文件損壞了，整個HDFS實例都將失效。因而，Namenode可以配置成支持維護多個FsImage和Editlog的副本。任何對FsImage或者Editlog的修改，都將同步到它們的副本上。這種多副本的同步操作可能會降低Namenode每秒處理的名字空間事務數量。然而這個代價是可以接受的，因為即使HDFS的應用是數據密集的，它們也非元數據密集的。當Namenode重啟的時候，它會選取最近的完整的FsImage和Editlog來使用。</p><p>另外一個可選方案是通過共享存儲NFS或一個分佈式編輯日誌（也叫journal）實現多namenode節點(HA)，來增強故障恢復能力。</p><p>在HDFS HA的實現中，配置了一對active-standby的namenode,當活動的namenode失效，備用的namenode就會接管它的任務並開始服務於客戶端的請求。</p><p>實現HA需要在架構上做如下修改：</p><p>namenode之間通過高可用共享存儲實現編輯日誌的共享，當備用namenode接管工作之後，它將通讀共享編輯日誌直到末尾，實現與active namenode狀態同步，並繼續讀取由活動namenode寫入的新條目。</p><p>datanode需要同時向兩個namenode發送數據塊處理報告，因為數據塊映射信息存在namenode的內存，而非硬盤。</p><p>客戶端使用特定的機制處理namenode的失效，這一機制對於用戶是透明的。</p><p>輔助namenode的角色被namenode所包含，備用namenode為活動的namenode命名空間設置週期性檢查。</p><p><strong>快照</strong></p><p>快照支持某一特定時刻的數據的複製備份。利用快照，可以讓HDFS在數據損壞時恢復到過去一個已知正確的時間點。</p><p><strong>8、數據組織</strong></p><p><strong>數據塊</strong></p><p>HDFS被設計成支持大文件，適用HDFS的是那些需要處理大規模的數據集的應用。這些應用都是隻寫入數據一次，但卻讀取一次或多次，並且讀取速度應能滿足流式讀取的需要。HDFS支持文件的“一次寫入多次讀取”語義。一個典型的數據塊大小是128MB。因而，HDFS中的文件總是按照128M被切分成不同的塊，每個塊儘可能地存儲於不同的Datanode中。</p><p><strong>流水線複製</strong></p><p>當客戶端向HDFS文件寫入數據的時候，一開始是寫到本地臨時文件中。假設該文件的副本系數設置為3，當本地臨時文件累積到一個數據塊的大小時，客戶端會從Namenode獲取一個Datanode列表用於存放副本。然後客戶端開始向第一個Datanode傳輸數據，第一個Datanode一小部分一小部分(4 KB)地接收數據，將每一部分寫入本地倉庫，並同時傳輸該部分到列表中第二個Datanode節點。第二個Datanode也是這樣，一小部分一小部分地接收數據，寫入本地倉庫，並同時傳給第三個Datanode。最後，第三個Datanode接收數據並存儲在本地。</p><p>因此，Datanode能流水線式地從前一個節點接收數據，並在同時轉發給下一個節點，數據以流水線的方式從前一個Datanode複製到下一個。</p><p><strong>9、可訪問性</strong></p><p>HDFS給應用提供了多種訪問方式。用戶可以通過Java API接口訪問，也可以通過C語言的封裝API訪問，還可以通過瀏覽器的方式訪問HDFS中的文件。通過WebDAV協議訪問的方式正在開發中。</p><p><strong>DFSShell</strong></p><p>HDFS以文件和目錄的形式組織用戶數據。它提供了一個命令行的接口(DFSShell)讓用戶與HDFS中的數據進行交互。命令的語法和用戶熟悉的其他shell(例如 bash, csh)工具類似。下面是一些動作/命令的示例：</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=淺析HDFS架構和設計 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1b6fe1dbc10542428dbce863e7c1d3de><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>DFSAdmin</strong></p><p>DFSAdmin 命令用來管理HDFS集群。這些命令只有HDSF的管理員才能使用。下面是一些動作/命令的示例：</p><p class=ql-align-center><br></p><div class=pgc-img><img alt=淺析HDFS架構和設計 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c4263759a27c424ba8a2fe1cae0ff6ca><p class=pgc-img-caption></p></div><p class=ql-align-center><strong>瀏覽器接口</strong></p><p>一個典型的HDFS安裝會在一個可配置的TCP端口開啟一個Web服務器用於暴露HDFS的名字空間。用戶可以用瀏覽器來瀏覽HDFS的名字空間和查看文件的內容。</p><p>http://ip:50070</p><p><strong>10、存儲空間回收</strong></p><p><strong>文件的刪除和恢復</strong></p><p>當垃圾回收生效時，通過fs shell刪除的文件並沒有立刻從HDFS中刪除。實際上，HDFS會將這個文件重命名轉移到user//.Trash目錄。只要文件還在.Trash目錄中，該文件就可以被迅速地恢復。文件在Trash中保存的時間是可配置的，當超過這個時間時，Namenode就會將該文件從名字空間中刪除。刪除文件會使得該文件相關的數據塊被釋放。注意，從用戶刪除文件到HDFS空閒空間的增加之間會有一定時間的延遲。</p><p>只要被刪除的文件還在.Trash目錄中，用戶就可以恢復這個文件。如果用戶想恢復被刪除的文件，他/她可以瀏覽.Trash目錄找回該文件。</p><p><strong>減少副本系數</strong></p><p>當一個文件的副本系數被減小後，Namenode會選擇過剩的副本刪除。下次心跳檢測時會將該信息傳遞給Datanode。Datanode遂即移除相應的數據塊，集群中的空閒空間加大。同樣，在調用setReplication API結束和集群中空閒空間增加間會有一定的延遲。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>淺析</a></li><li><a>HDFS</a></li><li><a>架構</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/24a6006e.html alt=服務器架構：十張圖帶你瞭解大型網站架構 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/2af10e2429bc47a5823244277a07bb77 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/24a6006e.html title=服務器架構：十張圖帶你瞭解大型網站架構>服務器架構：十張圖帶你瞭解大型網站架構</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6237da3d.html alt=朗坤雙模IT架構的智慧電廠，更安全、更經濟、更環保、更高效 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0670cbc9828449c782ac323a238b99e3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6237da3d.html title=朗坤雙模IT架構的智慧電廠，更安全、更經濟、更環保、更高效>朗坤雙模IT架構的智慧電廠，更安全、更經濟、更環保、更高效</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8f087332.html alt=手機1億像素真的能提升拍照效果嗎？淺析像素、CMOS與畫質的關係 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f5cf31426bc84bb5b7c89e2ef18369b1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8f087332.html title=手機1億像素真的能提升拍照效果嗎？淺析像素、CMOS與畫質的關係>手機1億像素真的能提升拍照效果嗎？淺析像素、CMOS與畫質的關係</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a4b90207.html alt=淺析袁大頭銀元的邊齒形態和齒數的應用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e873968a07b5482ba0da02ce9e144cc9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a4b90207.html title=淺析袁大頭銀元的邊齒形態和齒數的應用>淺析袁大頭銀元的邊齒形態和齒數的應用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d29f4e4e.html alt=淺析裝配螺栓鬆動原因及防鬆措施 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1534993351852a9200b291f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d29f4e4e.html title=淺析裝配螺栓鬆動原因及防鬆措施>淺析裝配螺栓鬆動原因及防鬆措施</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f3d4671c.html alt=活動文件櫃的架構是什麼 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/104d3629a97947b19d62b03dc3b8d82f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f3d4671c.html title=活動文件櫃的架構是什麼>活動文件櫃的架構是什麼</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b506f512.html alt=九年新浪架構師整理PHP架構核心技術教程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b3a3c32254344742b6746996f7fab54b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b506f512.html title=九年新浪架構師整理PHP架構核心技術教程>九年新浪架構師整理PHP架構核心技術教程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cadf04a2.html alt=淺析正則表達式的原理和運用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9fe74f2e095e4f1797edc7a9a0e089e4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cadf04a2.html title=淺析正則表達式的原理和運用>淺析正則表達式的原理和運用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b6297d23.html alt=淺析定量給料機在水泥行業的應用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f6d0d6af7bf2441c8a3c9784452ca0c9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b6297d23.html title=淺析定量給料機在水泥行業的應用>淺析定量給料機在水泥行業的應用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/23c87346.html alt=淺析“模型跟蹤控制”-兩個PID控制器組成的控制算法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ba2907deef34450ebaf77defe6ca4c71 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/23c87346.html title=淺析“模型跟蹤控制”-兩個PID控制器組成的控制算法>淺析“模型跟蹤控制”-兩個PID控制器組成的控制算法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/14323873.html alt=淺析VPN光纖接入技術在接入網中的應用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1522292433987de882f9173 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/14323873.html title=淺析VPN光纖接入技術在接入網中的應用>淺析VPN光纖接入技術在接入網中的應用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/38177b29.html alt=淺析智慧企業建設之知識工程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5efde817156b4136b6170e3416f14e4b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/38177b29.html title=淺析智慧企業建設之知識工程>淺析智慧企業建設之知識工程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6c984f60.html alt=Kafka整體架構圖解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/05ae540358854cb3ba0aa4577709330d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6c984f60.html title=Kafka整體架構圖解>Kafka整體架構圖解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f15af9d2.html alt=MyBatis整體架構分析：基礎支持層、核心處理層和接口層 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8d6a0b300b114d07b2f3fe66d7ef7005 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f15af9d2.html title=MyBatis整體架構分析：基礎支持層、核心處理層和接口層>MyBatis整體架構分析：基礎支持層、核心處理層和接口層</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5747aeb3.html alt=K8S整體架構解析，簡單明瞭 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/37380f3294a54bbf8c6bec1de3e08ba0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5747aeb3.html title=K8S整體架構解析，簡單明瞭>K8S整體架構解析，簡單明瞭</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>