<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>深入聊聊微服務架構的身份認證問題「轉」 | 极客快訊</title><meta property="og:title" content="深入聊聊微服務架構的身份認證問題「轉」 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/f2dd2ce800384b23b0223080c34eea42"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cec715b8.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cec715b8.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/cec715b8.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cec715b8.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cec715b8.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/cec715b8.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/cec715b8.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cec715b8.html><meta property="article:published_time" content="2020-11-14T21:00:28+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:28+08:00"><meta name=Keywords content><meta name=description content="深入聊聊微服務架構的身份認證問題「轉」"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/cec715b8.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>深入聊聊微服務架構的身份認證問題「轉」</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>從單體應用架構到分佈式應用架構再到微服務架構，應用的安全訪問在不斷的經受考驗。為了適應架構的變化、需求的變化，身份認證與鑑權方案也在不斷的變革。面對數十個甚至上百個微服務之間的調用，如何保證高效安全的身份認證？面對外部的服務訪問，該如何提供細粒度的鑑權方案？本文將會為大家闡述微服務架構下的安全認證與鑑權方案。</p><p><br></p><div class=tt-column-card data-content='{"new_thumb_url": "http://sf3-ttcdn-tos.pstatp.com/img/pgc-image/be46683c308c4564a5005d478ef4d252", "title": "\u5b9e\u4f8b\u63ed\u79d8spring5 mvc\u6838\u5fc3\u6e90\u7801", "url": "", "price": 99, "column_id": "6809814222852063492", "content": "", "author_description": "\u67b6\u6784\u5e08\u7b14\u8bb0", "share_price": 39.6, "thumb_url": "http://p1.pstatp.com/large/pgc-image/be46683c308c4564a5005d478ef4d252", "sold": 1}'><p class=column-placeholder></p></div><p><br></p><h2 class=pgc-h-arrow-right>單體應用 VS 微服務</h2><p>隨著微服務架構的興起，傳統的單體應用場景下的身份認證和鑑權面臨的挑戰越來越大。單體應用體系下，應用是一個整體，一般針對所有的請求都會進行權限校驗。請求一般會通過一個權限的攔截器進行權限的校驗，在登錄時將用戶信息緩存到 session 中，後續訪問則從緩存中獲取用戶信息。</p><div class=pgc-img><img alt=深入聊聊微服務架構的身份認證問題「轉」 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/f2dd2ce800384b23b0223080c34eea42><p class=pgc-img-caption></p></div><p>而微服務架構下，一個應用會被拆分成若干個微應用，每個微應用都需要對訪問進行鑑權，每個微應用都需要明確當前訪問用戶以及其權限。尤其當訪問來源不只是瀏覽器，還包括其他服務的調用時，單體應用架構下的鑑權方式就不是特別合適了。在為服務架構下，要考慮外部應用接入的場景、用戶 - 服務的鑑權、服務 - 服務的鑑權等多種鑑權場景。</p><div class=pgc-img><img alt=深入聊聊微服務架構的身份認證問題「轉」 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ef99c54c2a724c25afaf5333f3ec5d32><p class=pgc-img-caption></p></div><p>David Borsos 在倫敦的微服務大會上提出了四種方案：</p><p><strong>1. 單點登錄（SSO）</strong></p><p>這種方案意味著每個面向用戶的服務都必須與認證服務交互，這會產生大量非常瑣碎的網絡流量和重複的工作，當動輒數十個微應用時，這種方案的弊端會更加明顯。</p><p><strong>2. 分佈式 Session 方案</strong></p><p>分佈式會話方案原理主要是將關於用戶認證的信息存儲在共享存儲中，且通常由用戶會話作為 key 來實現的簡單分佈式哈希映射。當用戶訪問微服務時，用戶數據可以從共享存儲中獲取。在某些場景下，這種方案很不錯，用戶登錄狀態是不透明的。同時也是一個高可用且可擴展的解決方案。這種方案的缺點在於共享存儲需要一定保護機制，因此需要通過安全鏈接來訪問，這時解決方案的實現就通常具有相當高的複雜性了。</p><p><strong>3. 客戶端 Token 方案</strong></p><p>令牌在客戶端生成，由身份驗證服務進行簽名，並且必須包含足夠的信息，以便可以在所有微服務中建立用戶身份。令牌會附加到每個請求上，為微服務提供用戶身份驗證，這種解決方案的安全性相對較好，但身份驗證註銷是一個大問題，緩解這種情況的方法可以使用短期令牌和頻繁檢查認證服務等。對於客戶端令牌的編碼方案，Borsos 更喜歡使用 JSON Web Tokens（JWT），它足夠簡單且庫支持程度也比較好。</p><p><strong>4. 客戶端 Token 與 API 網關結合</strong></p><p>這個方案意味著所有請求都通過網關，從而有效地隱藏了微服務。 在請求時，網關將原始用戶令牌轉換為內部會話 ID 令牌。在這種情況下，註銷就不是問題，因為網關可以在註銷時撤銷用戶的令牌。</p><h2 class=pgc-h-arrow-right>微服務常見安全認證方案</h2><h3 class=pgc-h-arrow-right>HTTP 基本認證</h3><p><br></p><div class=tt-column-card data-content='{"new_thumb_url": "http://sf1-ttcdn-tos.pstatp.com/img/pgc-image/6575399823564fd9a12d3df367b27135", "title": "\u7528\u5b9e\u4f8b\u6df1\u5ea6\u63ed\u79d8spring5\u6838\u5fc3\u539f\u7406 ", "url": "", "price": 123, "column_id": "6765741896099692808", "content": "", "author_description": "\u67b6\u6784\u5e08\u7b14\u8bb0", "share_price": 49.2, "thumb_url": "http://p8.pstatp.com/large/pgc-image/6575399823564fd9a12d3df367b27135", "sold": 10}'><p class=column-placeholder></p></div><p><br></p><p>HTTP Basic Authentication（HTTP 基本認證）是 HTTP 1.0 提出的一種認證機制，這個想必大家都很熟悉了，我不再贅述。HTTP 基本認證的過程如下：</p><ol start=1><li>客戶端發送 HTTP Request 給服務器。</li><li>因為 Request 中沒有包含 Authorization header，服務器會返回一個 401 Unauthozied 給客戶端，並且在 Response 的 Header "WWW-Authenticate" 中添加信息。</li><li>客戶端把用戶名和密碼用 BASE64 加密後，放在 Authorization Header 中發送給服務器， 認證成功。</li><li>服務器將 Authorization Header 中的用戶名密碼取出，進行驗證， 如果驗證通過，將根據請求，發送資源給客戶端。</li></ol><h3 class=pgc-h-arrow-right>基於 Session 的認證</h3><p>基於 Session 的認證應該是最常用的一種認證機制了。用戶登錄認證成功後，將用戶相關數據存儲到 Session 中，單體應用架構中，默認 Session 會存儲在應用服務器中，並且將 Session ID 返回到客戶端，存儲在瀏覽器的 Cookie 中。</p><p>但是在分佈式架構下，Session 存放於某個具體的應用服務器中自然就無法滿足使用了，簡單的可以通過 Session 複製或者 Session 粘制的方案來解決。</p><p>Session 複製依賴於應用服務器，需要應用服務器有 Session 複製能力，不過現在大部分應用服務器如 Tomcat、JBoss、WebSphere 等都已經提供了這個能力。</p><p>除此之外，Session 複製的一大缺陷在於當節點數比較多時，大量的 Session 數據複製會佔用較多網絡資源。Session 粘滯是通過負載均衡器，將統一用戶的請求都分發到固定的服務器節點上，這樣就保證了對某一用戶而言，Session 數據始終是正確的。不過這種方案依賴於負載均衡器，並且只能滿足水平擴展的集群場景，無法滿足應用分割後的分佈式場景。</p><p>在微服務架構下，每個微服務拆分的粒度會很細，並且不只有用戶和微服務打交道，更多還有微服務間的調用。這個時候上述兩個方案都無法滿足，就要求必須要將 Session 從應用服務器中剝離出來，存放在外部進行集中管理。可以是數據庫，也可以是分佈式緩存，如 Memchached、Redis 等。這正是 David Borsos 建議的第二種方案，分佈式 Session 方案。</p><div class=pgc-img><img alt=深入聊聊微服務架構的身份認證問題「轉」 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c19f9cba81aa42cca109cd17ced07f7c><p class=pgc-img-caption></p></div><h3 class=pgc-h-arrow-right>基於 Token 的認證</h3><p>隨著 Restful API、微服務的興起，基於 Token 的認證現在已經越來越普遍。Token 和 Session ID 不同，並非只是一個 key。Token 一般會包含用戶的相關信息，通過驗證 Token 就可以完成身份校驗。像 Twitter、微信、QQ、GitHub 等公有服務的 API 都是基於這種方式進行認證的，一些開發框架如 OpenStack、Kubernetes 內部 API 調用也是基於 Token 的認證。基於 Token 認證的一個典型流程如下：</p><div class=pgc-img><img alt=深入聊聊微服務架構的身份認證問題「轉」 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4c9673a32a64408f9987da58deaabef2><p class=pgc-img-caption></p></div><ol start=1><li>用戶輸入登錄信息（或者調用 Token 接口，傳入用戶信息），發送到身份認證服務進行認證（身份認證服務可以和服務端在一起，也可以分離，看微服務拆分情況了）。</li><li>身份驗證服務驗證登錄信息是否正確，返回接口（一般接口中會包含用戶基礎信息、權限範圍、有效時間等信息），客戶端存儲接口，可以存儲在 Session 或者數據庫中。</li><li>用戶將 Token 放在 HTTP 請求頭中，發起相關 API 調用。</li><li>被調用的微服務，驗證 Token 權限。</li><li>服務端返回相關資源和數據。</li></ol><p><br></p><div class=tt-column-card data-content='{"new_thumb_url": "http://sf6-ttcdn-tos.pstatp.com/img/pgc-image/41a1ac3a0aae4b51a130cac8c6c52d8c", "title": "Mybatis\u8fd0\u884c\u539f\u7406\u53ca\u6e90\u7801\u89e3\u6790", "url": "", "price": 48, "column_id": "6815498101017542916", "content": "", "author_description": "\u67b6\u6784\u5e08\u7b14\u8bb0", "share_price": 19.2, "thumb_url": "http://p9.pstatp.com/large/pgc-image/41a1ac3a0aae4b51a130cac8c6c52d8c", "sold": 0}'><p class=column-placeholder></p></div><p><br></p><p>基於 Token 認證的好處如下：</p><ol start=1><li>服務端無狀態：Token 機制在服務端不需要存儲 session 信息，因為 Token 自身包含了所有用戶的相關信息。</li><li>性能較好，因為在驗證 Token 時不用再去訪問數據庫或者遠程服務進行權限校驗，自然可以提升不少性能。</li><li>支持移動設備。</li><li>支持跨程序調用，Cookie 是不允許垮域訪問的，而 Token 則不存在這個問題。</li></ol><p>下面會重點介紹兩種基於 Token 的認證方案 JWT/Oauth2.0。</p><h2 class=pgc-h-arrow-right>JWT 介紹</h2><p>JSON Web Token（JWT）是為了在網絡應用環境間傳遞聲明而執行的一種基於 JSON 的開放標準（RFC 7519）。來自 JWT RFC 7519 標準化的摘要說明：JSON Web Token 是一種緊湊的，URL 安全的方式，表示要在雙方之間傳輸的聲明。JWT 一般被用來在身份提供者和服務提供者間傳遞被認證的用戶身份信息，以便於從資源服務器獲取資源，也可以增加一些額外的其它業務邏輯所必須的聲明信息，該 Token 也可直接被用於認證，也可被加密。</p><h3 class=pgc-h-arrow-right>JWT 認證流程</h3><ol start=1><li>客戶端調用登錄接口（或者獲取 token 接口），傳入用戶名密碼。</li><li>服務端請求身份認證中心，確認用戶名密碼正確。</li><li>服務端創建 JWT，返回給客戶端。</li><li>客戶端拿到 JWT，進行存儲（可以存儲在緩存中，也可以存儲在數據庫中，如果是瀏覽器，可以存儲在 Cookie 中）在後續請求中，在 HTTP 請求頭中加上 JWT。</li><li>服務端校驗 JWT，校驗通過後，返回相關資源和數據。</li></ol><h3 class=pgc-h-arrow-right>JWT 結構</h3><p>JWT 是由三段信息構成的，第一段為頭部（Header），第二段為載荷（Payload)，第三段為簽名（Signature）。每一段內容都是一個 JSON 對象，將每一段 JSON 對象採用 BASE64 編碼，將編碼後的內容用. 鏈接一起就構成了 JWT 字符串。如下：</p><p>header.payload.signature</p><p><strong>1. 頭部（Header）</strong></p><p>頭部用於描述關於該 JWT 的最基本的信息，例如其類型以及簽名所用的算法等。這也可以被表示成一個 JSON 對象。</p><pre><code>{"typ": "JWT","alg": "HS256"}</code></pre><p>在頭部指明瞭簽名算法是 HS256 算法。</p><p><strong>2. 載荷（payload）</strong></p><p>載荷就是存放有效信息的地方。有效信息包含三個部分：</p><ul><li>標準中註冊的聲明</li><li>公共的聲明</li><li>私有的聲明</li></ul><p>標準中註冊的聲明（建議但不強制使用）：</p><ul><li>iss：JWT 簽發者</li><li>sub：JWT 所面向的用戶</li><li>aud：接收 JWT 的一方</li><li>exp：JWT 的過期時間，這個過期時間必須要大於簽發時間</li><li>nbf：定義在什麼時間之前，該 JWT 都是不可用的</li><li>iat：JWT 的簽發時間</li><li>jti：JWT 的唯一身份標識，主要用來作為一次性 token, 從而回避重放攻擊。</li></ul><p>公共的聲明 ：</p><p>公共的聲明可以添加任何的信息，一般添加用戶的相關信息或其他業務需要的必要信息. 但不建議添加敏感信息，因為該部分在客戶端可解密。</p><p>私有的聲明 ：</p><p>私有聲明是提供者和消費者所共同定義的聲明，一般不建議存放敏感信息，因為 base64 是對稱解密的，意味著該部分信息可以歸類為明文信息。</p><p>示例如下：</p><pre><code>{ "iss": "Online JWT Builder", "iat": 1416797419, "exp": 1448333419, "aud": "www.primeton.com", "sub": "devops@primeton.com", "GivenName": "dragon", "Surname": "wang", "admin": true}</code></pre><p><strong>3. 簽名（signature)</strong></p><p>創建簽名需要使用 Base64 編碼後的 header 和 payload 以及一個祕鑰。將 base64 加密後的 header 和 base64 加密後的 payload 使用. 連接組成的字符串，通過 header 中聲明的加密方式進行加鹽 secret 組合加密，然後就構成了 jwt 的第三部分。</p><p>比如：HMACSHA256(base64UrlEncode(header) + "." + base64UrlEncode(payload), secret)</p><p>JWT 的優點：</p><ol start=1><li>跨語言，JSON 的格式保證了跨語言的支撐</li><li>基於 Token，無狀態</li><li>佔用字節小，便於傳輸</li></ol><p><strong>關於 Token 註銷：</strong></p><p>Token 的註銷，由於 Token 不存儲在服務端，由客戶端存儲，當用戶註銷時，Token 的有效時間還沒有到，還是有效的。所以如何在用戶註銷登錄時讓 Token 註銷是一個要關注的點。一般有如下幾種方式：</p><ol start=1><li>Token 存儲在 Cookie 中，這樣客戶端註銷時，自然可以清空掉</li><li>註銷時，將 Token 存放到分佈式緩存中，每次校驗 Token 時區檢查下該 Token 是否已註銷。不過這樣也就失去了快速校驗 Token 的優點。</li><li>多采用短期令牌，比如令牌有效期是 20 分鐘，這樣可以一定程度上降低註銷後 Token 可用性的風險。</li></ol><h2 class=pgc-h-arrow-right>OAuth 2.0 介紹</h2><p>OAuth 的官網介紹：An open protocol to allow secure API authorization in a simple and standard method from desktop and web applications。OAuth 是一種開放的協議，為桌面程序或者基於 BS 的 web 應用提供了一種簡單的，標準的方式去訪問需要用戶授權的 API 服務。OAUTH 認證授權具有以下特點：</p><ol start=1><li>簡單：不管是 OAuth 服務提供者還是應用開發者，都很容易於理解與使用；</li><li>安全：沒有涉及到用戶密鑰等信息，更安全更靈活；</li><li>開放：任何服務提供商都可以實現 OAuth，任何軟件開發商都可以使用 OAuth；</li></ol><p>OAuth 2.0 是 OAuth 協議的下一版本，但不向後兼容 OAuth 1.0，即完全廢止了 OAuth 1.0。 OAuth 2.0 關注客戶端開發者的簡易性。要麼通過組織在資源擁有者和 HTTP 服務商之間的被批准的交互動作代表用戶，要麼允許第三方應用代表用戶獲得訪問的權限。同時為 Web 應用，桌面應用和手機，和起居室設備提供專門的認證流程。2012 年 10 月，OAuth 2.0 協議正式發佈為 RFC 6749。</p><h3 class=pgc-h-arrow-right>授權流程</h3><p>OAuth 2.0 的流程如下：</p><div class=pgc-img><img alt=深入聊聊微服務架構的身份認證問題「轉」 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/bf524042a93b437294605638049a6dde><p class=pgc-img-caption></p></div><p>（A）用戶打開客戶端以後，客戶端要求用戶給予授權。（B）用戶同意給予客戶端授權。（C）客戶端使用上一步獲得的授權，向認證服務器申請令牌。（D）認證服務器對客戶端進行認證以後，確認無誤，同意發放令牌。（E）客戶端使用令牌，向資源服務器申請獲取資源。（F）資源服務器確認令牌無誤，同意向客戶端開放資源。</p><h3 class=pgc-h-arrow-right>四大角色</h3><p>由授權流程圖中可以看到 OAuth 2.0 有四個角色：客戶端、資源擁有者、資源服務器、授權服務器。</p><ol start=1><li>客戶端：客戶端是代表資源所有者對資源服務器發出訪問受保護資源請求的應用程序。</li><li>資源擁有者：資源擁有者是對資源具有授權能力的人。</li><li>資源服務器：資源所在的服務器。</li><li>授權服務器：為客戶端應用程序提供不同的 Token，可以和資源服務器在統一服務器上，也可以獨立出去。</li></ol><h3 class=pgc-h-arrow-right>客戶端的授權模式</h3><p>客戶端必須得到用戶的授權（Authorization Grant），才能獲得令牌（access token）。OAuth 2.0 定義了四種授權方式：authorizationcode、implicit、resource owner password credentials、client credentials。</p><p><strong>1. 授權碼模式（authorization code）</strong></p><p>授權碼模式（authorization code）是功能最完整、流程最嚴密的授權模式。它的特點就是通過客戶端的後臺服務器，與"服務提供商"的認證服務器進行互動。流程如下：</p><ol start=1><li>用戶訪問客戶端，後者將前者導向認證服務器。</li><li>用戶選擇是否給予客戶端授權。</li><li>假設用戶給予授權，認證服務器將用戶導向客戶端事先指定的"重定向 URI"（redirection URI），同時附上一個授權碼。</li><li>客戶端收到授權碼，附上早先的"重定向 URI"，向認證服務器申請令牌。這一步是在客戶端的後臺的服務器上完成的，對用戶不可見。</li><li>認證服務器核對了授權碼和重定向 URI，確認無誤後，向客戶端發送訪問令牌（access token）和更新令牌（refresh token）。</li></ol><p><strong>2. 簡化模式（implicit）</strong></p><p>簡化模式（Implicit Grant Type）不通過第三方應用程序的服務器，直接在瀏覽器中向認證服務器申請令牌，跳過了"授權碼"這個步驟，因此得名。所有步驟在瀏覽器中完成，令牌對訪問者是可見的，且客戶端不需要認證。流程如下：</p><ol start=1><li>客戶端將用戶導向認證服務器。</li><li>用戶決定是否給於客戶端授權。</li><li>假設用戶給予授權，認證服務器將用戶導向客戶端指定的"重定向 URI"，並在 URI 的 Hash 部分包含了訪問令牌。</li><li>瀏覽器向資源服務器發出請求，其中不包括上一步收到的 Hash 值。</li><li>資源服務器返回一個網頁，其中包含的代碼可以獲取 Hash 值中的令牌。</li><li>瀏覽器執行上一步獲得的腳本，提取出令牌。</li><li>瀏覽器將令牌發給客戶端。</li></ol><p><strong>3. 密碼模式（Resource Owner Password Credentials）</strong></p><p>密碼模式中，用戶向客戶端提供自己的用戶名和密碼。客戶端使用這些信息，向"服務商提供商"索要授權。在這種模式中，用戶必須把自己的密碼給客戶端，但是客戶端不得儲存密碼。這通常用在用戶對客戶端高度信任的情況下，比如客戶端是操作系統的一部分，或者由一個著名公司出品。而認證服務器只有在其他授權模式無法執行的情況下，才能考慮使用這種模式。流程如下：</p><ol start=1><li>用戶向客戶端提供用戶名和密碼。</li><li>客戶端將用戶名和密碼發給認證服務器，向後者請求令牌。</li><li>認證服務器確認無誤後，向客戶端提供訪問令牌。</li></ol><p><strong>4. 客戶端模式（Client Credentials）</strong></p><p>客戶端模式（Client Credentials Grant）指客戶端以自己的名義，而不是以用戶的名義，向"服務提供商"進行認證。嚴格地說，客戶端模式並不屬於 OAuth 框架所要解決的問題。</p><p>在這種模式中，用戶直接向客戶端註冊，客戶端以自己的名義要求"服務提供商"提供服務，其實不存在授權問題。流程如下：</p><ol start=1><li>客戶端向認證服務器進行身份認證，並要求一個訪問令牌。</li><li>認證服務器確認無誤後，向客戶端提供訪問令牌。</li></ol><h2 class=pgc-h-arrow-right>思考總結</h2><p>正如 David Borsos 所建議的一種方案，在微服務架構下，我們更傾向於將 Oauth 和 JWT 結合使用，Oauth 一般用於第三方接入的場景，管理對外的權限，所以比較適合和 API 網關結合，針對於外部的訪問進行鑑權（當然，底層 Token 標準採用 JWT 也是可以的）。JWT 更加輕巧，在微服務之間進行訪問鑑權已然足夠，並且可以避免在流轉過程中和身份認證服務打交道。當然，從能力實現角度來說，類似於分佈式 Session 在很多場景下也是完全能滿足需求，具體怎麼去選擇鑑權方案，還是要結合實際的需求來。</p><div class=tt-column-card data-content='{"new_thumb_url": "http://sf3-ttcdn-tos.pstatp.com/img/pgc-image/7ed9f0d429394e0b98dce4c9737c05a6", "title": "\u5b9e\u6218redis--\u5927\u5e08\u5e26\u4f60\uff0c\u4ee5\u6218\u4ee3\u7ec3", "url": "", "price": 39, "column_id": "6756075730490114311", "content": "", "author_description": "\u67b6\u6784\u5e08\u7b14\u8bb0", "share_price": 15.6, "thumb_url": "http://p4.pstatp.com/large/pgc-image/7ed9f0d429394e0b98dce4c9737c05a6", "sold": 2}'><p class=column-placeholder></p></div><p><br></p><p>原文地址：http://www.infoq.com/cn/articles/identity-authentication-of-architecture-in-micro-service</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>務架構</a></li><li><a>認證</a></li><li><a>問題</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/2f87337a.html alt=收不到交警便民通知？可能是這裡出了問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bdf88511c83f431c9f75609d9e44d585 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2f87337a.html title=收不到交警便民通知？可能是這裡出了問題>收不到交警便民通知？可能是這裡出了問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8db1a012.html alt=問題408:在變壓器送電前後怎樣檢測差動保護裝置？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e7912ea051664f678d2616da1c042a37 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8db1a012.html title=問題408:在變壓器送電前後怎樣檢測差動保護裝置？>問題408:在變壓器送電前後怎樣檢測差動保護裝置？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4d964d47.html alt=3C認證消防產品認證證書的註銷、暫停和撤銷區別是什麼？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/95316f9c8993463793447f5ce8aba205 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4d964d47.html title=3C認證消防產品認證證書的註銷、暫停和撤銷區別是什麼？>3C認證消防產品認證證書的註銷、暫停和撤銷區別是什麼？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/84e317ac.html alt=檢測虛設問題，應當採取強有力的措施加以解決 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/115bad769be144f19346317e77eed4b3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/84e317ac.html title=檢測虛設問題，應當採取強有力的措施加以解決>檢測虛設問題，應當採取強有力的措施加以解決</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dfdb3278.html alt=南通中海問題多多？！竟遭市住建局通報批評 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RZ6gaqQHcJXxWV style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dfdb3278.html title=南通中海問題多多？！竟遭市住建局通報批評>南通中海問題多多？！竟遭市住建局通報批評</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3afc3600.html alt="歡居改造家 一篇看懂，砌牆需要注意的問題有哪些，再也不怕被坑" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/fe51a7bcc26445fa95824ca74c172f17 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3afc3600.html title="歡居改造家 一篇看懂，砌牆需要注意的問題有哪些，再也不怕被坑">歡居改造家 一篇看懂，砌牆需要注意的問題有哪些，再也不怕被坑</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/97268c50.html alt=蛋糕製作中的十一個常見問題及原因 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/2658ec69-8ea5-490e-a30a-08c8ed990c73 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/97268c50.html title=蛋糕製作中的十一個常見問題及原因>蛋糕製作中的十一個常見問題及原因</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7245dc43.html alt=別說我沒提醒你！螺栓連接有問題，趕緊測一下扭矩！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/35dce4fcbaa64306ab138cc84d150d4e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7245dc43.html title=別說我沒提醒你！螺栓連接有問題，趕緊測一下扭矩！>別說我沒提醒你！螺栓連接有問題，趕緊測一下扭矩！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/56faa63d.html alt=航空發動機軸承問題解析：慎重選用軸承遊隙和​防止軸承打滑 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/fa005c54189c4c61bf01b5c6f8afe285 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/56faa63d.html title=航空發動機軸承問題解析：慎重選用軸承遊隙和​防止軸承打滑>航空發動機軸承問題解析：慎重選用軸承遊隙和​防止軸承打滑</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7deecdbb.html alt=定製文件櫃需要注意哪些問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/931a82db62a14175b712856354243b2e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7deecdbb.html title=定製文件櫃需要注意哪些問題>定製文件櫃需要注意哪些問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/25ca0d4f.html alt=有些暗傷，破解與和解，從來都不是問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b5e2b6f988c141fdbd859d5f5e943129 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/25ca0d4f.html title=有些暗傷，破解與和解，從來都不是問題>有些暗傷，破解與和解，從來都不是問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ae35566a.html alt="分析問題 查找差距 添新舉措——九重二小召開疫情後測試質量分析會" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/S09WOUFHmuIHOE style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ae35566a.html title="分析問題 查找差距 添新舉措——九重二小召開疫情後測試質量分析會">分析問題 查找差距 添新舉措——九重二小召開疫情後測試質量分析會</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f8902836.html alt="分析問題尋差距 鼓足幹勁再出發" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f8902836.html title="分析問題尋差距 鼓足幹勁再出發">分析問題尋差距 鼓足幹勁再出發</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8777ea19.html alt=對同一省份不同單位領取基本養老金差距問題的分析與解讀？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/f50b917fab194c1280c4057fc27199e6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8777ea19.html title=對同一省份不同單位領取基本養老金差距問題的分析與解讀？>對同一省份不同單位領取基本養老金差距問題的分析與解讀？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f48dabde.html alt="一加8系列屏幕獲DisplayMate A+認證 創13項顯示記錄" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bdc3f2fefa644589a72cacfff44024bc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f48dabde.html title="一加8系列屏幕獲DisplayMate A+認證 創13項顯示記錄">一加8系列屏幕獲DisplayMate A+認證 創13項顯示記錄</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>