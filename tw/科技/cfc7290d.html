<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>OpenCV項目實戰---人臉檢測 | 极客快訊</title><meta property="og:title" content="OpenCV項目實戰---人臉檢測 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/f267e46946554437b5ffe48234f3b78d"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cfc7290d.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cfc7290d.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/cfc7290d.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cfc7290d.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cfc7290d.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/cfc7290d.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/cfc7290d.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cfc7290d.html><meta property="article:published_time" content="2020-11-14T21:08:21+08:00"><meta property="article:modified_time" content="2020-11-14T21:08:21+08:00"><meta name=Keywords content><meta name=description content="OpenCV項目實戰---人臉檢測"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/cfc7290d.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>OpenCV項目實戰---人臉檢測</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>OpenCV是一個強大的圖像處理庫，包含各種功能。人臉識別只是其眾多應用的其中一個。</p><p style=text-align:justify><br></p><p style=text-align:justify>本篇文章與上一篇所講述的知識有很大的重合 ，請按需觀看。</p><p style=text-align:justify><br></p><p style=text-align:justify><strong>理論知識</strong></p><p style=text-align:justify><br></p><p style=text-align:justify>計算機的視覺系統，計算機通過攝像頭看到的，簡單來說，就是一堆由數字組成的矩陣。這些數字表明瞭物體發出的光的強弱，攝像頭的光敏元件將光信號轉化成數字信號，將其量化為矩陣。</p><p><br></p><p><br>計算機中的彩色圖片都是由若干個色彩通道累積出來的，比如RGB模式的圖片，這三個通道都是灰度圖，比如一個點由8位來表示，則一 個通道可以表示2^8=256個灰度。那樣三個通道進行疊加以後可以表3*8=24位種色彩。</p><p><br></p><p><br>對這樣的圖片做處理，無疑是一件很複雜的事，所以有必要先<strong>將彩色圖轉為灰度圖</strong>，那樣可以減少數據量(比如RGB模式，可以減少到原圖片的1/3)，同時可 以去掉一些噪聲信號。先將圖片轉化為灰度圖，然後將這個灰度圖的<strong>對比度</strong>增高，這樣可以使得圖片本來暗的地方更暗，亮的地方更亮一些。這樣處理以後，圖片就更容易被算法識別出來了。</p><p><br></p><p style=text-align:justify>Haar特徵</p><p style=text-align:justify><br></p><p>Haar特徵包含三種：邊緣特徵、線性特徵、和中心圍繞特徵。</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f267e46946554437b5ffe48234f3b78d><p class=pgc-img-caption></p></div><p><br></p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ce6dce6b4dd6499f8ad379f6410a9706><p class=pgc-img-caption></p></div><p>Haar特徵提取流程圖</p><p>在OpenCV人臉檢測中，Haar特徵分類器就是一個XML文件，該文件中會描述人體各個部位的Haar特徵值。包括人臉、眼睛、嘴脣等等。</p><p><br></p><p><strong>HOG （</strong>Histograms of Oriented Gradients<strong>）</strong></p><p>對於一張待檢測圖片，我們分析每個像素以及其周圍的像素，根據明暗度畫一個箭頭，箭頭的指向代表了像素逐漸變暗的方向，如果我們重複操作每一個像素，最終像素會被箭頭取代。這些箭頭被稱為<strong>梯度(gradients)，它們能顯示出圖像從明亮到黑暗流動的過程。</strong></p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/48ef51a7f8c2467eab3dd59efacf19a7><p class=pgc-img-caption></p></div><p>分析每個像素對我們來說太過細節化了，像素過多不利於整體的分析，我們應該從更高的角度觀察明暗的流動。為此我們<strong>將圖像分割成16x16像素的小方塊</strong>。在每個小方塊中，計算出每個主方向有多少個梯度（有多少指向上，指向右上，指向右等）。然後<strong>用指向性最強的那個方向箭頭來代替原來那個小方塊</strong>。</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fbeaa125d5dc401897b43101c2018eea><p class=pgc-img-caption></p></div><p>最終結果，我們把<strong>原始圖像轉換成非常簡單的HOG圖像</strong>，它可以很輕鬆的捕獲面部的基本結構。為了在HOG圖像中找到臉部，我們需要做的是，與<strong>已知的一些HOG圖案中</strong>，來尋找看起來最相似的部分。</p><p>這些<strong>HOG圖案都是從其他面部訓練數據中提取出來</strong>的。</p><p><br></p><p><strong>級聯分類器</strong></p><p style=text-align:justify>對於本次的設計人臉檢測，可以說是一次機器學習的過程。級聯分類器中有一個級聯分類函數，此函數當中的一些參數就是由機器訓練得到的。對於人臉識別，計算機通過大量帶人臉和不帶人臉的圖片，對人臉上的幾萬個特徵，通過機器學習找出人臉<strong>分類效果最好、錯誤率最小的特徵</strong>。訓練開始時，所有訓練集中的圖片具有相同的權重，對於被分類<strong>錯誤的圖片，提升權重</strong>，重新計算出新的錯誤率和新的權重。直到錯誤率或迭代次數達到要求。這種<strong>訓練方法叫做Adaboost</strong>。</p><p style=text-align:justify>上文提到的hog圖像，正是由adaboost訓練方法對大量圖片進行訓練後所提取出來的。</p><p style=text-align:justify><br></p><p><strong>Cascade級聯分類器</strong></p><p style=text-align:justify>Cascade 譯為級聯，階梯。cascade級聯分類器是一種基於Haar特徵的有效的物體檢測方法。</p><p style=text-align:justify><br></p><p>一張圖片絕大部分的區域都不是人臉。如果對一張圖片的每個角落都提取6000個特徵，將會浪費巨量的計算資源。</p><p>如果能找到一個簡單的方法能夠檢測某個窗口是不是人臉區域，如果該窗口不是人臉區域，那麼就只看一眼便直接跳過，也就不用進行後續處理了，這樣就能集中精力判別那些可能是人臉的區域。為此，有人引入了Cascade 分類器。它不是將6000個特徵都用在一個窗口，而是將特徵分為不同的階段，然後一個階段一個階段的應用這些特徵(通常情況下，前幾個階段只有很少量的特徵）。如果窗口在第一個階段就檢測失敗了，那麼就直接捨棄它，無需考慮剩下的特徵。如果檢測通過，則考慮第二階段的特徵並繼續處理。如果所有階段的都通過了，那麼這個窗口就是人臉區域。</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a0b12d8521744d31b72cd5059b8eb0ab><p class=pgc-img-caption></p></div><p>比如上圖中，橫的黑道將人臉中較暗的雙眼提取了出來，而豎的白道將人臉中較亮的鼻樑提取了出來。</p><p>由於事先不太可能知道要檢測的目標的大小，這就要求我們的級聯表中的分類器具有按比例增大(或者縮小)的能力，這樣，當小的窗口移動完整個待檢測圖片沒有發現目標時，我們可以調整分類器的大小，然後繼續檢測，直到檢測到目標或者窗口與待檢測圖片的大小相當為止。人臉檢測流程圖見圖</p><p><br></p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/413474fa35704022a97a2dd17e9914ce><p class=pgc-img-caption></p></div><p><br></p><p><strong>人臉檢測具體實現</strong></p><p><strong>環境搭建</strong></p><p style=text-align:justify>本項目採用python作為編輯器，pycharm作為解釋器。</p><p style=text-align:justify>OpenCV是一個可跨平臺的計算機視覺和機器學習的軟件庫，實現了圖像處理和計算機視覺方面的很多通用算法。</p><p style=text-align:justify>安裝OpenCV時，有以下幾種方法。</p><p style=text-align:justify>一，首先可以利用的是pycharm來進行引入</p><p style=text-align:justify>file -- settings --project interpreter-- +</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4b43690d5661419f956d52f84cec64f2><p class=pgc-img-caption></p></div><p style=text-align:justify><br></p><p style=text-align:justify>選擇OpenCV--python ---install</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9ae0e899d7bb4772b6dadc009f3335d8><p class=pgc-img-caption></p></div><p style=text-align:justify><br></p><p style=text-align:justify>如果安裝成功，隨後你可以在project interpreter裡來進行版本的查看。</p><p style=text-align:justify><br></p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/84e8cd6626bf495486f8f967477ade1a><p class=pgc-img-caption></p></div><p style=text-align:justify><br></p><p style=text-align:justify>二，利用常規命令</p><p style=text-align:justify>Win+r後輸入cmd，隨後輸入pip install OpenCV-python</p><p style=text-align:justify>如果顯示install successfully，則安裝完成。</p><p style=text-align:justify><br></p><p style=text-align:justify>如果報錯，read time error ，則可能是庫在下載時有延遲的問題，需要在命令里加入一個代理，這裡用到的是豆瓣的，在install 後面加入以下命令即可。</p><p style=text-align:justify>- -index-url https://pypi.douban.com/simple opencv-python</p><p style=text-align:justify><br></p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/79cc7faec083411ab89dc9c151fecda2><p class=pgc-img-caption></p></div><p style=text-align:justify><br></p><p style=text-align:justify>OpenCV可以說是人臉物體檢測識別中比較常用的一個庫，利用import cv2來進行調用。</p><p style=text-align:justify><br></p><p><strong>項目代碼</strong></p><p>對於識別本地圖片中的人臉，我們需要進行以下幾個步驟的操作：</p><p>1）把圖像轉換為灰度圖，這樣可以去除色彩對目標檢測的影響。同時可以降低圖像的噪聲。</p><pre><code>import cv2  #引入OpenCV模塊</code></pre><pre><code> #規定圖像的路徑。filepath = "./image1.png" </code></pre><pre><code> # ./為當前文件夾下的相對路徑，我們需要將檢測圖片與程序文件放於同一文件夾下。</code></pre><pre><code>img = cv2.imread(filepath)</code></pre><pre><code>#cv2.IMread就是利用OpenCV模塊來讀取此路徑下的圖片文件   imread=image-read</code></pre><pre><code>gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</code></pre><pre><code>#img為原始彩色圖片，這裡我們用到了cv2模塊的圖像顏色轉換功能，將轉換後的圖像命名為gray</code></pre><pre><code>cv2.imshow("Image", gray)</code></pre><pre><code>#顯示灰色圖像</code></pre><pre><code></code></pre><p>2）在灰色圖像上進行矩形框的繪製</p><pre><code>cv2.imshow("Image-gray", img)x = y = 100  # 任意規定一個座標w =h= 135  # 矩形的寬、高color = (0,255,0)  # 定義繪製顏色，遵循bgr模式cv2.rectangle(img, (x, y), (x + w, y + h),color , 3)  #調用cv2裡的rectangle來 繪製矩形，rectangle（圖像，左上角座標，右下角座標，顏色，線粗）cv2.imshow("Image-gray-square", img)  # 顯示灰色方框圖像</code></pre><p><br></p><p>3）使用分類器查找人臉</p><p>CascadeClassifier是Opencv中做人臉檢測時候的一個級聯分類器。數據結構包括Data和FeatureEvaluator兩個主要部分。Data中存儲的是從訓練獲得的xml文件中載入的分類器數據；而FeatureEvaluator中是關於特徵的載入、存儲和計算。這裡採用的訓練文件是OpenCV中默認提供的haarcascade_frontalface_default.xml。至於Haar，LBP的具體原理，可以參考opencv的相關文檔，簡單地，可以理解為人臉的特徵數據。</p><pre><code>face_engine=cv2.CascadeClassifier(cv2.data.haarcascades+'haarcascade_frontalface_default.xml')</code></pre><pre><code># 導入人臉級聯分類器引擎，'.xml'文件裡包含已經訓練出來的人臉特徵</code></pre><pre><code></code></pre><pre><code>faces=face_engine.detectMultiScale(img,scaleFactor=1.3,minNeighbors=5)</code></pre><pre><code># 用人臉級聯分類器引擎進行人臉識別，返回的faces為人臉座標列表，1.3是放大比例，5是重複識別次數</code></pre><pre><code></code></pre><p><br></p><p>整體代碼如下：</p><pre><code>importcv2</code></pre><pre><code>img=cv2.imread('image1.jpg',1)</code></pre><pre><code>face_engine=cv2.CascadeClassifier(cv2.data.haarcascades+'haarcascade_frontalface_default.xml')</code></pre><pre><code>faces=face_engine.detectMultiScale(img,scaleFactor=1.3,minNeighbors=5)</code></pre><pre><code>for(x,y,w,h)infaces:</code></pre><pre><code>    img =cv2.rectangle(img,(x,y),(x+w,y+h),(255,0,0),2)</code></pre><pre><code>cv2.imshow('img2',img)</code></pre><pre><code>cv2.waitKey(0)</code></pre><pre><code>cv2.destroyAllWindows()</code></pre><pre><code>cv2.imwrite('output.jpg',img)</code></pre><pre><code></code></pre><p><br></p><p>注：</p><p>* cv2.waitKey等待鍵盤輸入，單位為毫秒，即等待指定的毫秒數看是否有鍵盤輸入，若在等待時間內按下任意鍵則返回按鍵的ASCII碼，程序繼續運行。若沒有按下任何鍵，超時後返回-1。參數為0表示無限等待。不調用waitKey的話，窗口會一閃而逝，看不到顯示的圖片。</p><p>* cv2.destroyAllWindow()銷燬所有窗口</p><p>* cv2.destroyWindow(wname)銷燬指定窗口</p><p><br></p><p>運行結果圖</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8b20290ad7d9432391ff11acb8af4dea><p class=pgc-img-caption></p></div><p>由此可以看出此代碼運行結果良好，符合預期結果。</p><p><br></p><p><strong>代碼改進</strong></p><p>上述代碼為引入本地圖片來進行人臉測量。現在改進下代碼，可以通過攝像頭進行實時的人臉檢測。</p><p>在源代碼的基礎上，增加以下語句：</p><pre><code>cap=cv2.VideoCapture(0)</code></pre><pre><code>while(True):</code></pre><pre><code>   # 獲取攝像頭拍攝到的畫面</code></pre><pre><code>    ret, frame=cap.read()</code></pre><pre><code>faces=face_cascade.detectMultiScale(frame,1.3,5)</code></pre><pre><code>#frame是攝像頭捕捉到的畫面</code></pre><pre><code></code></pre><pre><code>.....</code></pre><pre><code></code></pre><pre><code>   #每隔5毫秒監聽一次鍵盤，當按下q鍵時退出攝像窗口</code></pre><pre><code>ifcv2.waitKey(5)&amp;0xFF==ord('q'):</code></pre><pre><code>   break</code></pre><pre><code># 關閉所有窗口</code></pre><pre><code>cap.release()</code></pre><pre><code>cv2.destroyAllWindows()</code></pre><p><br></p><p>利用手機播放視頻，可進行實時人臉檢測，運行結果良好。結果如圖</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/dae4b85bb0584305a8d63b9743331de0><p class=pgc-img-caption></p></div><p><br></p><p><strong>注</strong>：</p><p>1）在用cv2.rectangle進行畫框時，原始定義為（圖像，左上角，右下角）。但由於疏忽，有一次我將左上角和右下角的座標順序寫反，即（右下角，左上角）。但是結果卻依然正確。在後來我將數據改為（右上角，左下角）（左下角，右上角），<strong>結果依然一樣。因此得知，rectangle是利用對角線來進行矩形的框定。</strong></p><p>在此附上此次驗證的相關代碼：</p><pre><code></code></pre><pre><code>import cv2# filepath = "./men-face.jpg"image = cv2.imread('./men-face.jpg',cv2.IMREAD_GRAYSCALE)h, w = image.shape[:2]h, w = map(int, [h/4, w/4])draw_0 = cv2.rectangle(image, (2*w, 2*h), (3*w, 3*h), (255, 0, 0), 2)draw_1 = cv2.rectangle(image, (2*w, 3*h), (3*w, 2*h), (255, 0, 0), 2)draw_2 = cv2.rectangle(image, (3*w, 2*h), (2*w, 3*h), (255, 0, 0), 2)draw_3 = cv2.rectangle(image, (3*w, 3*h), (2*w, 2*h), (255, 0, 0), 2)cv2.imshow("origin.jpg", draw_0)cv2.imshow("change1.jpg", draw_1)cv2.imshow("change2.jpg", draw_2)cv2.imshow("change3.jpg", draw_3)cv2.waitKey(0)cv2.destroyAllWindows()</code></pre><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6777500c9f754771878a8e06e2739ea5><p class=pgc-img-caption></p></div><p><br></p><p>2）HOG的發明者是Navneet Dalal，在2005年其在CVPR上發表了Histograms of Oriented Gradients forHuman Detection這一篇論文。</p><p><strong>HOG算法思想</strong>：</p><p>在計算機視覺以及數字圖像處理中梯度方向直方圖(HOG)是一種能對物體進行檢測的基於形狀邊緣特徵的描述算子，它的基本思想是利用梯度信息能很好的反映圖像目標的邊緣信息並通過局部梯度的大小將圖像局部的外觀和形狀特徵化。一些研究者利用梯度HOG特徵並結合其他特徵對人體進行檢測得到了較好的結果。</p><p>HOG特徵的提取可以用下圖所示的過程表示: <strong>顏色空間的歸一化</strong>是為了減少光照以及背景等因素的影響；劃分檢測窗口成大小相同的細胞單元(cell)，並分別<strong>提取相應的梯度信息</strong>；組合相鄰的細胞單元成大的相互有<strong>重疊的塊(block)</strong>，這樣能有效的利用重疊的邊緣信息，以統計整個塊的直方圖；並對<strong>每個塊內的梯度直方圖進行歸一化</strong>，從而進一步減少背景顏色及噪聲的影響；最後將整個窗口中所有塊的<strong>HOG特徵收集起來</strong>，並使用特徵向量來表示其特徵。在這一過程中，不同尺度的參數模板、梯度方向的選擇、重疊塊及單元格的大小還有歸一化因子等因素都會影響最終的檢測結果。最終<strong>通過SVM或cascade分類器</strong>分離出正確的行人目標。</p><p>HOG的整體流程圖如下所示。</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/16786406efb249feb1c8c98ef675a2a3><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/81a7562451de489289ff4f7bcd696232><p class=pgc-img-caption></p></div><p><strong>顏色空間歸一化：</strong></p><p>在現實的情況，圖像目標會出現在不同的環境中，光照也會有所不一樣，顏色空間歸一化就是對整幅圖像的顏色信息作歸一化處理從而減少不同光照及背景的影響，也為了提高檢測的魯棒性，<strong>引入圖像Gamma校正和顏色空間歸一化來作為特徵提取的預處理手段</strong>。ND等人也對不同的圖像像素點的表達方式包括灰度空間等進行了評估，最終驗證<strong>RGB還有LAB</strong>色彩空間能使檢測結果大致相同且能起到積極的影響，且另一方面，ND等人在研究中分別在每個顏色通道上使用了兩種不同的Gamma歸一化方式，取平方根或者使用對數法，最終驗證這一預處理對檢測的結果幾乎沒有影響，而<strong>不能對圖像進行高斯平滑處理</strong>，因平滑處理會降低圖像目標邊緣信息的辨識度，影響檢測結果。</p><p><br></p><p><strong>梯度計算：</strong></p><p><strong>邊緣是由圖像局部特徵包括灰度、顏色和紋理的突變導致的。</strong>一幅圖像中相鄰的像素點之間變化比較少，區域變化比較平坦，則梯度幅值就會比較小，反之，則梯度幅值就會比較大。梯度在圖像中對應的就是其一階導數。模擬圖像f(x,y)中任一像素點（x,y）的梯度是一個矢量：</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/029a1301baf2455db270074b47ee8792><p class=pgc-img-caption></p></div><p>其中，Gx是沿x方向上的梯度，Gy是沿y方向上的梯度，梯度的幅值及方向角可表示如下：</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f16554bace4d498c9a48e2489e62175f><p class=pgc-img-caption></p></div><p>數字圖像中像素點的梯度是用差分來計算的：</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8d854404a7a34495a96b7b0f3a82b76f><p class=pgc-img-caption></p></div><p><br></p><p>一維離散微分模板在將圖像的梯度信息簡單、快速且有效地計算出來，其公式如下：</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b92813a467f24a1db52f1e32d1d27553><p class=pgc-img-caption></p></div><p>式中，Gx，Gy，H(x,y)分別表示的是像素點（x,y）在水平方向上及垂直方向上的梯度以及像素的灰度值，其梯度的幅值及方向計算公式如下：</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/c414d11da99a495bbbe3bf989132566c><p class=pgc-img-caption></p></div><p>ND等人也驗證，不同的梯度運算模板在其檢測效果上也不一樣，如下表，可以看出，<strong>使用簡單的一維離散微分模板[-1,0,1]</strong>進行的梯度運算得到的檢測效果是最好的，而使用其他形式的梯度運算模板如Prewitt和Sobel等算子，如下圖所示，不僅增加運算量而同時也降低了其檢測效果。</p><p><br></p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4fdf302548ca4146905c88f4c1c8d303><p class=pgc-img-caption></p></div><p><br></p><p><strong>計算細胞單元的梯度直方圖：</strong></p><p>對於整個目標窗口，我們需要<strong>將其分成</strong><em><strong>互不重疊</strong></em><strong>大小相同的細胞單元（cell）</strong>，然後分別計算出每個cell的梯度信息，包括梯度大小和梯度方向。ND大神等人實驗指出，將像素的梯度方向在0-180°區間內<strong>平均劃分為9個bins</strong>，超過9個時不僅檢測性能沒有明顯的提高反而增加了檢測運算量, <strong>每個cell內的像素為其所在的梯度方向直方圖進行加權投票</strong>，加權的權值可以是像素本身的梯度幅值，也可以是幅值的平方或平方根等，而若使用平方或平方根，實驗的檢測性能會有所降低，ND等人也驗證，<strong>使用梯度幅值的實驗效果更可靠</strong>。</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/e132356bf1b54bb8ba5db5d603680717><p class=pgc-img-caption></p></div><p style=text-align:center>梯度直方圖的計算</p><p><br></p><p><strong>對組合成塊的梯度直方圖作歸一化：</strong></p><p>從梯度計算公式中可以看出，梯度幅值絕對值的大小容易受到前景與背景對比度及局部光照的影響，要減少這種影響得到較準確的檢測效果就<strong>必須對局部細胞單元進行歸一化處理</strong>。歸一化方法多種多樣，但整體思想基本上是一致的：<strong>將幾個細胞單元（cell）組合成更大的塊（block）</strong>，這時整幅圖像就可看成是待檢測窗口，將<strong>更大的塊看成是滑動窗口，依次</strong><em><strong>從左到右從上到下進行滑動</strong></em>，得到一些有重複細胞單元的塊及一些相同細胞單元（cell）在不同塊（block）中的梯度信息，再對這些塊（block）信息分別作歸一化處理，不同的細胞單元尺寸大小及不同塊的尺寸大小會影響最終的檢測效果。</p><p><br></p><p>假設64×64像素是檢測的窗口的尺寸，分成 4×4=16 個細胞單元(cell)，如下圖中黑色的小框(1-16),16×16 像素是每個細胞單元的大小，塊（block）是由相鄰的 2×2=4 個細胞單元組成的，如圖紫色的小框，滑動窗口的大小為一個塊的大小，依次<strong>將滑動窗口從左到右從上到下進行滑動來獲得整個待測窗口的邊緣信息</strong>，得到9個塊，<strong>統計這9個塊在9個不同方向上的梯度信息</strong>，在整個窗口中得到的梯度特徵是9×9=81 維的向量。在實際情況中我們的檢測窗口的大小為128×64像素，一個細胞單元的大小為8×8像素，由2×2個細胞單元組成大小為16×16像素的塊，一個細胞單元的梯度直方圖化成9個bins，塊的移動步長是8個像素，則檢測窗口在圖像中移動的步長也為8個像素，這樣檢測窗口就有((128-16)/8+1)×((64-16)/8+1)= 105個塊，一<strong>個塊有4個細胞單元，每個細胞單元的HOG特徵向量長度是9，則最終的HOG特徵描述符大小就是105×4×9 = 3780維</strong>。</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/7b81e3a864a34f61953254c85d71882c><p class=pgc-img-caption></p></div><p>對於塊的梯度直方圖向量的歸一化，ND等人使用了不同方法，並對結果進行了比較，假設V是未歸一化的向量，是一個很小的必要的常數，下式是定義的範數的函數表達式：</p><p>L1範數：</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/54f949e82ff642adb4828cc3f0bb6061><p class=pgc-img-caption></p></div><p>L2範數：</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/a2870503f0144f4a88c9814678d28001><p class=pgc-img-caption></p></div><p>歸一化計算公式為：</p><p>L2常規：</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/75f14d7fe87b4b75bc2a7a14b3df5b39><p class=pgc-img-caption></p></div><p>L1常規：</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/102a5bf066994d3ba8cde20cfaa80ff9><p class=pgc-img-caption></p></div><p>L1平方根：</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/de700fb6b5c041c4a703818c00a44c85><p class=pgc-img-caption></p></div><p>ND等人指出，用L1常規方法進行向量歸一化比用L2常規和L1平方根方法而得到的檢測效果降低5%。</p><div class=pgc-img><img alt=OpenCV項目實戰---人臉檢測 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/4aae31212fe241499f845fe2ac7db8c7><p class=pgc-img-caption></p></div><p style=text-align:justify><em>來源：六月的日記 作者：小胖鴨</em></p><p><strong>End</strong></p><p><br></p><p>聲明：部分內容來源於網絡，僅供讀者學習、交流之目的。文章版權歸原作者所有。如有不妥，請聯繫刪除。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>OpenCV</a></li><li><a>項目</a></li><li><a>實戰</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/02729303.html alt=java實戰項目常用類，Date、Calendar、BigDecimal、Math、UUID class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d69c7c9d8b85444da9360e334ba6555d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/02729303.html title=java實戰項目常用類，Date、Calendar、BigDecimal、Math、UUID>java實戰項目常用類，Date、Calendar、BigDecimal、Math、UUID</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c3d6e4c9.html alt=Java項目實戰第10天：分頁欄的實現 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/000f44dadac946188c05567c6741ae3c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c3d6e4c9.html title=Java項目實戰第10天：分頁欄的實現>Java項目實戰第10天：分頁欄的實現</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/20b12ef6.html alt=Java項目實戰第7天：導航欄業務的實現 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5ed388098e304e21872e291ae4eebf6f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/20b12ef6.html title=Java項目實戰第7天：導航欄業務的實現>Java項目實戰第7天：導航欄業務的實現</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b413fa9.html alt="Go 實戰項目推薦：Gin 實現的工單系統" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5e5a39cad5e4403b9f28d044a60fbcd6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b413fa9.html title="Go 實戰項目推薦：Gin 實現的工單系統">Go 實戰項目推薦：Gin 實現的工單系統</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fcc2ad9e.html alt=音頻編碼實戰 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/aacf5cab-b987-443f-815e-236f984fb2d0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fcc2ad9e.html title=音頻編碼實戰>音頻編碼實戰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/81d30f09.html alt=非政府投資項目！重慶市忠縣三一綠建天然氣分佈式能源項目 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/23ac15e9ed254c67aac3bf8c6ce5bb0c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/81d30f09.html title=非政府投資項目！重慶市忠縣三一綠建天然氣分佈式能源項目>非政府投資項目！重慶市忠縣三一綠建天然氣分佈式能源項目</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/50fe2d58.html alt=非政府投資項目！重慶市萬州區天然氣分佈式能源項目 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/a37e6a8d7f2144298efa93acffc91caa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/50fe2d58.html title=非政府投資項目！重慶市萬州區天然氣分佈式能源項目>非政府投資項目！重慶市萬州區天然氣分佈式能源項目</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/92ac65bf.html alt=項目名稱：廣東清遠市2×1000MW電廠二期項目 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/Rcb3FwPA0RFE20 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/92ac65bf.html title=項目名稱：廣東清遠市2×1000MW電廠二期項目>項目名稱：廣東清遠市2×1000MW電廠二期項目</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5b4206a1.html alt="現場教學 項目對接 組織簽約 胡應海來我縣調研，做了這些工作" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c530e9eee9e34c149f5f2795adcd7467 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5b4206a1.html title="現場教學 項目對接 組織簽約 胡應海來我縣調研，做了這些工作">現場教學 項目對接 組織簽約 胡應海來我縣調研，做了這些工作</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/73ba27bb.html alt=老股民總結的賣出技巧實戰圖解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/7575000bb7b8e57fa260 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/73ba27bb.html title=老股民總結的賣出技巧實戰圖解>老股民總結的賣出技巧實戰圖解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/22408815.html alt=股票交易指南：實戰圖解經典的賣出技巧 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15305260751844061be70e0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/22408815.html title=股票交易指南：實戰圖解經典的賣出技巧>股票交易指南：實戰圖解經典的賣出技巧</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eaa95354.html alt=股票賣出實戰技術圖解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/88520001219b9b7dabd2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eaa95354.html title=股票賣出實戰技術圖解>股票賣出實戰技術圖解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4df37406.html alt=非政府投資項目！河北省邯鄲市鑫森冶金建設幹熄焦項目 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/b1a8c1102a66483bacf5f5f739a64897 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4df37406.html title=非政府投資項目！河北省邯鄲市鑫森冶金建設幹熄焦項目>非政府投資項目！河北省邯鄲市鑫森冶金建設幹熄焦項目</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/11187004.html alt=軸承運轉的檢查項目及故障處理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e23ae493b21a4693b8e7f8d45c62a64a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/11187004.html title=軸承運轉的檢查項目及故障處理>軸承運轉的檢查項目及故障處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c40003a2.html alt=去4s店保養這4個項目可以不用做 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a99383e6d8ed445b9d9dedd64cdc2cb9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c40003a2.html title=去4s店保養這4個項目可以不用做>去4s店保養這4個項目可以不用做</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>