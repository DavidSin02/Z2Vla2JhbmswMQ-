<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>簡單明瞭：緩存穿透、緩存擊穿、緩存雪崩區別和解決方案 | 极客快訊</title><meta property="og:title" content="簡單明瞭：緩存穿透、緩存擊穿、緩存雪崩區別和解決方案 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/f0a9370247d9481db387d339695f03af"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cfe5224.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cfe5224.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/cfe5224.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cfe5224.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cfe5224.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/cfe5224.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/cfe5224.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/cfe5224.html><meta property="article:published_time" content="2020-10-29T20:52:48+08:00"><meta property="article:modified_time" content="2020-10-29T20:52:48+08:00"><meta name=Keywords content><meta name=description content="簡單明瞭：緩存穿透、緩存擊穿、緩存雪崩區別和解決方案"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/cfe5224.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>簡單明瞭：緩存穿透、緩存擊穿、緩存雪崩區別和解決方案</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1><strong>前言</strong></h1><p class=ql-align-justify>Redis緩存的使用，極大的提升了應用程序的性能和效率，特別是數據查詢方面。</p><p class=ql-align-justify>但同時，它也帶來了一些問題。其中，最要害的問題，就是數據的一致性問題，從嚴格意義上講，這個問題無解。如果對數據的一致性要求很高，那麼就不能使用緩存。</p><p class=ql-align-justify>另外的一些典型問題就是，緩存穿透、緩存雪崩和緩存擊穿，這是設計一個緩存系統，不得不要考慮的問題！</p><h1><strong>緩存處理流程</strong></h1><p>正常的一個緩存處理流程都會這樣設計：請求數據 ，後段先從緩存中get數據，get到直接返回結果，get不到時從DB中取，DB取到更新緩存，並返回結果，DB也沒取到，那直接返回空結果，流程見下圖：</p><div class=pgc-img><img alt=簡單明瞭：緩存穿透、緩存擊穿、緩存雪崩區別和解決方案 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f0a9370247d9481db387d339695f03af><p class=pgc-img-caption></p></div><p>但這樣很容易引起緩存穿透、緩存擊穿、緩存雪崩！！！！！</p><h1>緩存穿透</h1><p>緩存穿透是指查詢一個一定不存在的數據，由於緩存是不命中時被動寫的，並且出於容錯考慮，如果從存儲層查不到數據則不寫入緩存，這將導致這個不存在的數據每次請求都要到存儲層去查詢，失去了緩存的意義。在流量大時，可能DB就掛掉了，要是有人利用不存在的key頻繁攻擊我們的應用，這就是漏洞。</p><p><strong>解決方案</strong></p><p>有很多種方法可以有效地解決緩存穿透問題：</p><ol><li>最常見的則是採用布隆過濾器，將所有可能存在的數據哈希到一個足夠大的bitmap中，一個一定不存在的數據會被 這個bitmap攔截掉，從而避免了對底層存儲系統的查詢壓力；</li><li>接口層增加校驗，如用戶鑑權校驗，id做基礎校驗，id&lt;=0的直接攔截；</li><li>另外也有一個更為簡單粗暴的方法，如果一個查詢返回的數據為空，仍然把這個空結果進行緩存，緩存有效時間可以設置短點，如30秒（設置太長會導致正常情況也沒法使用）。這樣可以防止攻擊用戶反覆用同一個id暴力攻擊。</li></ol><h1>緩存雪崩</h1><p>緩存雪崩是指在我們設置緩存時採用了相同的過期時間，導致緩存在某一時刻同時失效，請求全部轉發到DB，DB瞬時壓力過重雪崩。</p><p><strong>解決方案</strong></p><ol><li>緩存數據的過期時間設置隨機，防止同一時間大量數據過期現象發生。</li><li>如果緩存數據庫是分佈式部署，將熱點數據均勻分佈在不同搞得緩存數據庫中。</li><li>設置熱點數據永遠不過期。</li></ol><h1>緩存擊穿</h1><p>對於一些設置了過期時間的key，如果這些key可能會在某些時間點被超高併發地訪問，是一種非常“熱點”的數據。這個時候，需要考慮一個問題：緩存被“擊穿”的問題，這個和緩存雪崩的區別在於這裡針對某一key緩存，前者則是很多key。</p><p><strong>解決方案</strong></p><p>1.使用互斥鎖(mutex key)</p><p>這種解決方案思路比較簡單，就是隻讓一個線程構建緩存，其他線程等待構建緩存的線程執行完，重新從緩存獲取數據就可以，如下圖：</p><div class=pgc-img><img alt=簡單明瞭：緩存穿透、緩存擊穿、緩存雪崩區別和解決方案 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/d409ea478f6646a3a2c6610f7a785591><p class=pgc-img-caption></p></div><p>2."提前"使用互斥鎖(mutex key)</p><p>在value內部設置1個超時值(timeout1), timeout1比實際的memcache timeout(timeout2)小。當從cache讀取到timeout1發現它已經過期時候，馬上延長timeout1並重新設置到cache。然後再從數據庫加載數據並設置到cache中。</p><p>3."永遠不過期"</p><p>這裡的“永遠不過期”包含兩層意思：</p><p>a.從redis上看，確實沒有設置過期時間，這就保證了，不會出現熱點key過期問題，也就是“物理”不過期。</p><p>b. 從功能上看，如果不過期，那不就成靜態的了嗎？所以我們把過期時間存在key對應的value裡，如果發現要過期了，通過一個後臺的異步線程進行緩存的構建，也就是“邏輯”過期</p><p><strong>方案對比</strong></p><div class=pgc-img><img alt=簡單明瞭：緩存穿透、緩存擊穿、緩存雪崩區別和解決方案 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d4817cce55864124bbe5f0bdfaec3124><p class=pgc-img-caption></p></div><h1><strong>總結</strong></h1><p>沒有最好，只有更好！</p><p>只有熟悉自己的業務系統，才能找到最合適自己系統的解決方案。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>緩存</a></li><li><a>簡單</a></li><li><a>緩存擊</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/f72a8eb3.html alt=明白了緩存穿透和緩存雪崩，再瞭解一下緩存擊穿？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/2eacd4e19cd94d3c89f249bd969d6fa7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f72a8eb3.html title=明白了緩存穿透和緩存雪崩，再瞭解一下緩存擊穿？>明白了緩存穿透和緩存雪崩，再瞭解一下緩存擊穿？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/51e434ad.html alt=新手用雲服務器快速搭建個人網站簡單教程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/51e434ad.html title=新手用雲服務器快速搭建個人網站簡單教程>新手用雲服務器快速搭建個人網站簡單教程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/61d5b89d.html alt=場面描寫很簡單，讓語文老師舉例，教會你好用的寫作技巧和方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/a12e06c3-dac8-4ef1-a44b-bbf85671edb2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/61d5b89d.html title=場面描寫很簡單，讓語文老師舉例，教會你好用的寫作技巧和方法>場面描寫很簡單，讓語文老師舉例，教會你好用的寫作技巧和方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ecbd05fe.html alt="比搶錢還要簡單！蘋果上架Mac Pro配件：四個輪子要五千塊" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5e07933580e64355abbbcac953abfc3d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ecbd05fe.html title="比搶錢還要簡單！蘋果上架Mac Pro配件：四個輪子要五千塊">比搶錢還要簡單！蘋果上架Mac Pro配件：四個輪子要五千塊</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9ababaae.html alt=初中科學元素的簡單分類每日一練含答案解析 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/cc6f0300765348b3a57404a617d32c99 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9ababaae.html title=初中科學元素的簡單分類每日一練含答案解析>初中科學元素的簡單分類每日一練含答案解析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e4707da0.html alt=高中化學物質分類竟如此簡單，你還記得多少？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b73cc7c22bc14eb9af43cf76f66e5d70 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e4707da0.html title=高中化學物質分類竟如此簡單，你還記得多少？>高中化學物質分類竟如此簡單，你還記得多少？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ec613168.html alt=十大世界足球先生，認識四位以上的人都不簡單 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8bf0e55d0e30483abc88ce0fa1ac279d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ec613168.html title=十大世界足球先生，認識四位以上的人都不簡單>十大世界足球先生，認識四位以上的人都不簡單</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/35c96373.html alt=14種家常哨子面的做法，美味不油膩，簡單易學又實用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1ef1a62cd3ad4bf9b000021a38952cb4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/35c96373.html title=14種家常哨子面的做法，美味不油膩，簡單易學又實用>14種家常哨子面的做法，美味不油膩，簡單易學又實用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dacdca28.html alt=媽媽教的剪刀面做法，無保留分享，簡單又實用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2e3e5ec81da04a70bf4d1fe077acb24c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dacdca28.html title=媽媽教的剪刀面做法，無保留分享，簡單又實用>媽媽教的剪刀面做法，無保留分享，簡單又實用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bd7a84b7.html alt=鑑別被追尾車就是這麼簡單！這4個方法你都瞭解嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a51a16723af8485ab69705c547ea4fd8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bd7a84b7.html title=鑑別被追尾車就是這麼簡單！這4個方法你都瞭解嗎？>鑑別被追尾車就是這麼簡單！這4個方法你都瞭解嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a2d512e5.html alt=6個實用電路圖，簡單易懂！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d4ccc825dea840e0bccda3481c8a96ce style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a2d512e5.html title=6個實用電路圖，簡單易懂！>6個實用電路圖，簡單易懂！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/75c082ee.html alt=一個買入和賣出股票的簡單方法——金字塔法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1539052330140848b6dfdb4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/75c082ee.html title=一個買入和賣出股票的簡單方法——金字塔法>一個買入和賣出股票的簡單方法——金字塔法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9d4099ff.html alt=經典的股票賣出技巧，簡單高效，掌握大有益處 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/R6Vq6K4Fye4OrU style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9d4099ff.html title=經典的股票賣出技巧，簡單高效，掌握大有益處>經典的股票賣出技巧，簡單高效，掌握大有益處</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7ea39ba5.html alt=股票交易指南：幾種簡單易學的股票賣出技巧 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/8e36000b3bf0548a94ba style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7ea39ba5.html title=股票交易指南：幾種簡單易學的股票賣出技巧>股票交易指南：幾種簡單易學的股票賣出技巧</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4227e37e.html alt=金字塔買賣法，一個最簡單的買入賣出方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/153732971874727be0bf3b9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4227e37e.html title=金字塔買賣法，一個最簡單的買入賣出方法>金字塔買賣法，一個最簡單的買入賣出方法</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>