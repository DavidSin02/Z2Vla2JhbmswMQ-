<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>第72集 python機器學習：停用詞和tf-idf縮放數據用於電影評論 | 极客快訊</title><meta property="og:title" content="第72集 python機器學習：停用詞和tf-idf縮放數據用於電影評論 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/3d1ef02f01fc4702b9118ba289a0bb1c"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d2429ee.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d2429ee.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d2429ee.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d2429ee.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d2429ee.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d2429ee.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d2429ee.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d2429ee.html><meta property="article:published_time" content="2020-10-29T21:07:51+08:00"><meta property="article:modified_time" content="2020-10-29T21:07:51+08:00"><meta name=Keywords content><meta name=description content="第72集 python機器學習：停用詞和tf-idf縮放數據用於電影評論"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/d2429ee.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>第72集 python機器學習：停用詞和tf-idf縮放數據用於電影評論</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>停用詞是一種刪除沒有信息量的單詞的一種方法，該方法就是捨棄那些出現次數太多以至於沒有信息量的次。主要有兩種方法：使用特定語言的停用詞（stopword）列表或捨棄那些出現過於頻繁的單詞</p><p>在scikit-learn的feature-extraction模塊中提供了英語停用詞的內置列表，代碼示例如下：</p><p>from sklearn.feature_extraction.text import ENGLISH_STOP_WORDS</p><p>print("Number of stop word: {}".format(len(ENGLISH_STOP_WORDS)))</p><p>print("Every 10th stopword:\n{}".format(list(ENGLISH_STOP_WORDS)[::10]))</p><p><strong>運行上述代碼其結果為：</strong></p><p>Number of stop word: 318</p><p>Every 10th stopword:</p><p>['mine', 'meanwhile', 'again', 'across', 'off', 'though', 'such', 'something', 'myself', 'if', 'noone', 'call', 'been', 'interest', 'whose', 'behind', 'fifteen', 'even', 'often', 'found', 'sometime', 'done', 'alone', 'they', 'forty', 'last', 'co', 'part', 'whenever', 'somewhere', 'anything', 'anyhow']</p><p>由上述運行結果可知，刪除上述列表中的停用詞只能使得特徵數量少了318個（即上述列表的長度），下面我們來看一下是否對性能產生影響。代碼如下：</p><p>#指定stop_words=“English”將使用內置列表</p><p>#也可以擴展這個列表並傳入自己的列表</p><p>from sklearn.feature_extraction.text import CountVectorizer</p><p>from sklearn.model_selection import GridSearchCV</p><p>from sklearn.linear_model import LogisticRegression</p><p>param_grid = {'C':[0.001,0.01,0.1,1,10,100]}</p><p>vect = CountVectorizer(min_df=10, stop_words="english").fit(text_train)</p><p>x_train = vect.transform(text_train)</p><p>print("x_train with stop words:\n{}".format(repr(x_train)))</p><p>grid = GridSearchCV(LogisticRegression(), param_grid, cv=5)</p><p>grid.fit(x_train, y_train)</p><p>print("Best coss validation score is: {:.3f}".format(grid.best_score_))</p><p><strong>運行後其對應的結果如下</strong>：</p><p>x_train with stop words:</p><p>&lt;75000x31610 sparse matrix of type '&lt;class 'numpy.int64'>'</p><p>with 6538340 stored elements in Compressed Sparse Row format></p><p>Best coss validation score is: 0.713</p><p>使用停用詞偶網格搜索性能有所下降，但是鑑於3萬多個數據減少300多個數據不太可能對性能或解釋造成很大影響，所以這個列表似乎是不值得的，固定的列表主要對小型數據很有幫助，這些數據集可能沒有包含足夠的信息，模型從數據本身無法判斷哪些單詞是停用詞。</p><p>下面我們通過設置CountVectorizer的max_df選項來捨棄出現最頻繁的單詞，並查看其對特徵數量和性能有什麼影響。</p><p><strong>用tf_idf縮放數據</strong>：另一種刪除沒有信息量的單詞（也是最常用的方法）是詞頻-逆向文檔頻率（tf-idf）方法，該方法對在某個特定文檔中經常出現的術語給予很高的權重，但對於在語料庫的許多文檔中經常出現的術語給予的權重卻不高。</p><p>如果一個單詞在某個特定文檔中經常出現，但是在許多文檔中卻不常出現，那麼這個單詞很可能是對文檔的很好描述。scikit-learn在兩個類中實現了td-idf的方法——TfidfTransform和TfidfVectorizer。前者接受CountVectorizer生成的稀疏矩陣並將其變換，後者接受文本數據並完成詞袋特徵提取和tf-idf變換。</p><p>由於tf-idf實際上利用了訓練數據的統計學屬性，所以我們將使用管道以確保網格搜索結果有效，對應代碼如下：</p><p>from sklearn.feature_extraction.text import TfidfVectorizer</p><p>from sklearn.pipeline import make_pipeline</p><p>pipe = make_pipeline(TfidfVectorizer(min_df=5),LogisticRegression())</p><p>#對於高維稀疏數據，類似於LogisticRegression的線性模型通常效果最好</p><p>param_grid = {'logisticregression__C':[0.001, 0.01, 0.1, 1, 10],</p><p>'tfidfvectorizer__ngram_range':[(1,1),(1,2),(1,3)]}</p><p>#首先需要用一個字典指定要搜索的參數，字典的鍵是我們要調節的參數名稱</p><p>grid = GridSearchCV(pipe, param_grid, cv=5)#cv=5,分層k折交叉驗證中k取值為5</p><p>grid.fit(text_train, y_train)</p><p>#grid對象的行為就像一個分類器，我們可以對它調用標準的fit、predict、score方法</p><p>#調用fit時，對我們指定的所有參數組合都運行交叉驗證</p><p>#擬合fit對象不僅會搜索最佳參數，還會利用得到的最佳驗證性能的參數在整個訓練數據集上自動擬合一個新模型</p><p>#可以用predict、score方法來訪問重新訓練過的模型</p><p>#我們找到的參數保存在best_params_中</p><p>#交叉驗證的最佳精度保存在best_score_中</p><p>print("Best cross-validation score:{:.3f}".format(grid.best_score_))</p><p><strong>運行上述代碼後結果為</strong>：</p><p>Best cross-validation score:0.723</p><p>從運行結果可以看出，使用tf-idf替代僅統計詞數對性能有所提高，同時要注意的是tf-idf可以查看找到的最重要的單詞，其縮放目的是找到能夠區分文檔的單詞，但是它完全是一種無監督技術。因此，這裡的“重要”不一定是我們所需要的“正面評論”和“負面評論”標籤相關，所以我們還需要進行如下操作：</p><p>首先，從管道中提取TfidfVectorizer：</p><p>vectorizer = grid.best_estimator_.named_steps["tfidfvectorizer"]</p><p>x_train=vectorizer.transform(text_train)</p><p>#變換訓練數據集，並找到數據集中每個特徵的最大值</p><p>max_value = x_train.max(axis=0).toarray().ravel()</p><p>sorted_by_tfidf = max_value.argsort()</p><p>#獲取特徵名稱</p><p>feature_names = np.array(vectorizer.get_feature_names())</p><p>print('Features with lowest tfidf:\n{}'.format(feature_names[sorted_by_tfidf[:20]]))</p><p>print('Features with highest tfidf:\n{}'.format(feature_names[sorted_by_tfidf[-20:]]))</p><p>#下面是找出逆向文檔頻率較低的詞——出現次數很多，但是被認為不那麼重要的單詞</p><p>#這些詞被保存在idf_屬性中</p><p>sorted_by_idf=np.argsort(vectorizer.idf_)</p><p>print('Feature with lowest idf:\n{}'.format(feature_names[sorted_by_idf[:100]]))</p><p><strong>運行結果如下：</strong></p><div class=pgc-img><img alt="第72集 python機器學習：停用詞和tf-idf縮放數據用於電影評論" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/3d1ef02f01fc4702b9118ba289a0bb1c><p class=pgc-img-caption>tf-idf 對應的各種特徵</p></div><p><br></p><p>tf-idf較小的特徵要麼在很多文檔裡都很常用，要麼就是很少使用，且僅出現在非常長的文檔中。而tf-idf叫他的特徵實際上對應的是特定的電影或演出中。而在lowest idf中表現出來的是對應的停用詞。</p><p>接著我們來看一下這些評估分數對應的熱圖，對應代碼如下：</p><p>scores=grid.cv_results_['mean_test_score'].reshape(-1,3).T</p><p>#獲取對應熱圖</p><p>heatmap=mglearn.tools.heatmap(</p><p>scores,xlabel='C',ylabel='ngram_range',cmap='viridis',fmt='%.3f',</p><p>xticklabels=param_grid['logisticregression__C'],</p><p>yticklabels=param_grid['tfidfvectorizer__ngram_range']</p><p>)</p><p>plt.colorbar(heatmap)</p><div class=pgc-img><img alt="第72集 python機器學習：停用詞和tf-idf縮放數據用於電影評論" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/d9034926fcf543bfa4eaa0eec278cdd7><p class=pgc-img-caption>ngram_range和C參數控制下的預測分數熱圖</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>72</a></li><li><a>python</a></li><li><a>機器</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/abf70f51.html alt=機器學習-python文本主題提取 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/2ecdf5b89f5e4a6c82a24540e307a148 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/abf70f51.html title=機器學習-python文本主題提取>機器學習-python文本主題提取</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cfb83fa2.html alt=機器視覺｜晏磊：航空遙感平臺通用物理模型及可變基高比系統精度評價 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1530929302432561dc6cda6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cfb83fa2.html title=機器視覺｜晏磊：航空遙感平臺通用物理模型及可變基高比系統精度評價>機器視覺｜晏磊：航空遙感平臺通用物理模型及可變基高比系統精度評價</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/098d4a35.html alt=「火爐煉AI」機器學習048-Harris檢測圖像角點 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d756b20a1dbc4ab4b4f22d6b61be2043 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/098d4a35.html title=「火爐煉AI」機器學習048-Harris檢測圖像角點>「火爐煉AI」機器學習048-Harris檢測圖像角點</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dc2af9c9.html alt=機器學習筆記(七)——初識邏輯迴歸、不同方法推導梯度公式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/13adbab9c7f94c7fa81d49a98861b051 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dc2af9c9.html title=機器學習筆記(七)——初識邏輯迴歸、不同方法推導梯度公式>機器學習筆記(七)——初識邏輯迴歸、不同方法推導梯度公式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e214e6d7.html alt=深度學習/機器學習入門數學知識整理（二）梯度與導數，泰勒展開 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1540372101455de0fb74774 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e214e6d7.html title=深度學習/機器學習入門數學知識整理（二）梯度與導數，泰勒展開>深度學習/機器學習入門數學知識整理（二）梯度與導數，泰勒展開</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f3767255.html alt=講透機器學習中的梯度下降 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5c80301e53424671bc22755be2e4ee33 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f3767255.html title=講透機器學習中的梯度下降>講透機器學習中的梯度下降</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bc93016e.html alt=人工智能時代，機器人真的能在對話中識別人的意圖嘛？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7804be8632614272aab014f77d8f40a9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bc93016e.html title=人工智能時代，機器人真的能在對話中識別人的意圖嘛？>人工智能時代，機器人真的能在對話中識別人的意圖嘛？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/51723e35.html alt=AI也有偏見：你在機器“眼裡”是好人還是壞蛋？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RfDgA10IBHJqK9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/51723e35.html title=AI也有偏見：你在機器“眼裡”是好人還是壞蛋？>AI也有偏見：你在機器“眼裡”是好人還是壞蛋？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ee69f5ac.html alt=基於機器視覺技術快速準確地確定收穫後幹大豆種子的品質 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/519b968bf69146fda9bf55f89779d373 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ee69f5ac.html title=基於機器視覺技術快速準確地確定收穫後幹大豆種子的品質>基於機器視覺技術快速準確地確定收穫後幹大豆種子的品質</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f8c3b92d.html alt=python安全開發軍規之四：使用安全的隨機數生成器 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bbda123b84db44148aca9d3e26ddf119 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f8c3b92d.html title=python安全開發軍規之四：使用安全的隨機數生成器>python安全開發軍規之四：使用安全的隨機數生成器</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dbe0144c.html alt=如何減少焊接機器人出現焊接件變形的情況？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3a62de9fde6c4a09ac0950d5f16dea0a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dbe0144c.html title=如何減少焊接機器人出現焊接件變形的情況？>如何減少焊接機器人出現焊接件變形的情況？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e27caade.html alt=python基礎知識，多態實例講解以及多態的作用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/2506d9fe7f6641a6a12c35a35a9335db style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e27caade.html title=python基礎知識，多態實例講解以及多態的作用>python基礎知識，多態實例講解以及多態的作用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c56ee116.html alt=小猿圈python學習-三大特性之多態 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ad0e8e3777854337abeb7c779ad79a04 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c56ee116.html title=小猿圈python學習-三大特性之多態>小猿圈python學習-三大特性之多態</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ce278cf4.html alt=機器學習時代的哈希算法，將如何更高效地索引數據 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1525617261534ad07c6455c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ce278cf4.html title=機器學習時代的哈希算法，將如何更高效地索引數據>機器學習時代的哈希算法，將如何更高效地索引數據</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/346037ff.html alt=淺談機器學習時代的哈希算法（一） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1525788510275af3193bcdc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/346037ff.html title=淺談機器學習時代的哈希算法（一）>淺談機器學習時代的哈希算法（一）</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>