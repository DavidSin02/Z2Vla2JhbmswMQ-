<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>æ´»ç”¨æ™‚åºæ•¸æ“šåº«ï¼Œç©è½‰è‡ªå‹•åŒ–ç›£æ§ | æå®¢å¿«è¨Š</title><meta property="og:title" content="æ´»ç”¨æ™‚åºæ•¸æ“šåº«ï¼Œç©è½‰è‡ªå‹•åŒ–ç›£æ§ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/740a948eab61466aabb3565955e5d8ce"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d3715674.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d3715674.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d3715674.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d3715674.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d3715674.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d3715674.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d3715674.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d3715674.html><meta property="article:published_time" content="2020-11-14T21:04:01+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:01+08:00"><meta name=Keywords content><meta name=description content="æ´»ç”¨æ™‚åºæ•¸æ“šåº«ï¼Œç©è½‰è‡ªå‹•åŒ–ç›£æ§"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/d3715674.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>æ´»ç”¨æ™‚åºæ•¸æ“šåº«ï¼Œç©è½‰è‡ªå‹•åŒ–ç›£æ§</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><p>InfluxDBæ˜¯ä¸€æ¬¾ç”¨Goèªè¨€ç·¨å¯«çš„é–‹æºåˆ†ä½ˆå¼æ™‚åºã€äº‹ä»¶å’ŒæŒ‡æ¨™æ•¸æ“šåº«ï¼Œç„¡éœ€å¤–éƒ¨ä¾è³´ã€‚è©²æ•¸æ“šåº«ç¾åœ¨ä¸»è¦ç”¨æ–¼å­˜å„²æ¶‰åŠå¤§é‡çš„æ™‚é–“æˆ³æ•¸æ“šï¼Œå¦‚DevOpsç›£æ§æ•¸æ“šï¼ŒAPP metrics, loTå‚³æ„Ÿå™¨æ•¸æ“šå’Œå¯¦æ™‚åˆ†ææ•¸æ“šã€‚</p><p><strong>InfluxDBç‰¹å¾µ</strong></p><p><strong>âœ” </strong>ç„¡çµæ§‹(ç„¡æ¨¡å¼)ï¼šå¯ä»¥æ˜¯ä»»æ„æ•¸é‡çš„åˆ—(tags)ã€‚</p><p><strong>âœ” </strong>å¯ä»¥è¨­ç½®metricçš„ä¿å­˜æ™‚é–“ã€‚</p><p><strong>âœ” </strong>æ”¯æŒèˆ‡æ™‚é–“æœ‰é—œçš„ç›¸é—œå‡½æ•¸(å¦‚minã€maxã€sumã€countã€meanã€medianç­‰)ï¼Œæ–¹ä¾¿çµ±è¨ˆã€‚</p><p><strong>âœ” </strong>æ”¯æŒå­˜å„²ç­–ç•¥ï¼šå¯ä»¥ç”¨æ–¼æ•¸æ“šçš„åˆªæ”¹(influxDBæ²’æœ‰æä¾›æ•¸æ“šçš„åˆªé™¤èˆ‡ä¿®æ”¹æ–¹æ³•)ã€‚</p><p><strong>âœ” </strong>æ”¯æŒé€£çºŒæŸ¥è©¢ï¼šæ˜¯æ•¸æ“šåº«ä¸­è‡ªå‹•å®šæ™‚å•Ÿå‹•çš„ä¸€çµ„èªå¥ï¼Œå’Œå­˜å„²ç­–ç•¥æ­é…å¯ä»¥é™ä½InfluxDBçš„ç³»çµ±ä½”ç”¨é‡ã€‚</p><p><strong>âœ” </strong>æ”¯æŒé¡ä¼¼SQLèªæ³•ã€‚</p><p><strong>âœ” </strong>æ”¯æŒè¨­ç½®æ•¸æ“šåœ¨é›†ç¾¤ä¸­çš„å‰¯æœ¬æ•¸ã€‚</p><p><strong>âœ” </strong>æ”¯æŒå®šæœŸæ¡æ¨£æ•¸æ“šï¼Œå¯«å…¥å¦å¤–çš„measurementï¼Œæ–¹ä¾¿åˆ†ç²’åº¦å­˜å„²æ•¸æ“šã€‚</p><p><strong>âœ” </strong>è‡ªå¸¶webç®¡ç†ç•Œé¢ï¼Œæ–¹ä¾¿ä½¿ç”¨(ç™»å…¥æ–¹å¼ï¼šhttp://&lt; InfluxDB-IP >:8083)ã€‚</p><p><strong>âœ” </strong>æœ€é—œéµçš„ä¸€é»ï¼Œä¹Ÿæ˜¯æˆ‘æ¡ç”¨çš„åŸå› ï¼Œæ”¯æŒGrafanaç•«åœ–å±•ç¤ºã€‚</p><p>æœ‰äº†InfluxDB+Grafanaå¾Œï¼Œä½ å°±å¯ä»¥ç”¨pythonå¯«ä¸€äº›ç°¡å–®çš„ç¨‹åºäº†ï¼Œå¯ä»¥åªè² è²¬å¯«å¾Œç«¯é‚è¼¯éƒ¨åˆ†ï¼Œæ•¸æ“šéƒ½å¯ä»¥å­˜å…¥InfluxDBï¼Œç„¶å¾Œé€šéGrafanaå±•ç¤ºå‡ºä¾†ï¼Œç„¶å¾Œåšä¸€ç³»åˆ—çš„ç›£æ§å·¥ä½œï¼Œå¾Œé¢æœƒé€²è¡Œè©³ç´°ä»‹ç´¹</p><h1 class=ql-align-center><strong>influxdbå®‰è£</strong></h1><p class=ql-align-justify><br></p><p>äºŒé€²åˆ¶å®‰è£ï¼Œé€™è£¡ä»¥centos6.5ç‚ºä¾‹é€²è¡Œå®‰è£ã€‚</p><p>wget https://dl.influxdata.com/influxdb/releases/influxdb-1.1.0.x86_64.rpm</p><p>yum localinstall influxdb-1.1.0.x86_64.rpm</p><p>å®‰è£å¾Œï¼Œåœ¨/usr/binä¸‹é¢æœ‰å¦‚ä¸‹æ–‡ä»¶ã€‚</p><pre class=ql-align-justify></pre><p class=ql-align-justify><br></p><ul><li><br></li></ul><pre>influxd influxdbæœå‹™å™¨influx influxdbå‘½ä»¤è¡Œå®¢æˆ¶ç«¯influx_inspect æŸ¥çœ‹å·¥å…·influx_stress å£“åŠ›æ¸¬è©¦å·¥å…·influx_tsm æ•¸æ“šåº«è½‰æ›å·¥å…·ï¼ˆå°‡æ•¸æ“šåº«å¾b1æˆ–bz1æ ¼å¼è½‰æ›ç‚ºtsm1æ ¼å¼)åœ¨/var/lib/influxdb/ä¸‹é¢æœƒæœ‰å¦‚ä¸‹æ–‡ä»¶å¤¾data å­˜æ”¾æœ€çµ‚å­˜å„²çš„æ•¸æ“šï¼Œæ–‡ä»¶ä»¥.tsmçµå°¾meta å­˜æ”¾æ•¸æ“šåº«å…ƒæ•¸æ“šwal å­˜æ”¾é å¯«æ—¥èªŒæ–‡ä»¶InfluxDBåŸºæœ¬æ¦‚å¿µ</pre><p class=ql-align-justify><br></p><p>åœ¨å…·é«”çš„è¬›è§£influxdbçš„ç›¸é—œæ“ä½œä¹‹å‰å…ˆèªªèªªinfluxdbçš„ä¸€äº›å°ˆæœ‰åè©ï¼Œé€™äº›åè©ä»£è¡¨ä»€éº¼ã€‚å…ˆçœ‹ä¸‹é¢ä¸€æ®µInfluxdbä¸­çš„è¡¨ä¿¡æ¯ã€‚</p><p>> select * from disk;</p><p>name: disk</p><p>time count device free hostname used used_percent</p><p>---- ----- ------ ---- -------- ---- ------------</p><p>1502089306183159978 1 /data 80 server01 100 60.33</p><p>1502089342879496791 1 /data 90 server02 110 68.33</p><p>InfluxDBæ˜¯æ™‚åºæ•¸æ“šåº«ï¼Œæ‰€ä»¥æ€éº¼éƒ½ç¹ä¸é–‹æ™‚é–“ï¼Œç¬¬ä¸€ç¸±åˆ—timeå­˜å„²è‘—æ™‚é–“æˆ³ï¼Œè€Œæ™‚é–“æˆ³æ˜¯èˆ‡æ•¸æ“šé€²è¡Œé—œè¯ï¼Œé€™æ¨£æ‰èƒ½å°‡æ™‚é–“å’Œæ•¸æ“šé€²è¡Œå±•ç¤ºã€‚</p><pre class=ql-align-justify>influxDBä¸­çš„åè©</pre><ul><li><br></li></ul><pre>database æ•¸æ“šåº«åï¼Œåœ¨InfluxDBä¸­å¯ä»¥å‰µå»ºå¤šå€‹æ•¸æ“šåº«ï¼Œä¸åŒæ•¸æ“šåº«ä¸­çš„æ•¸æ“šæ–‡ä»¶æ˜¯éš”é›¢å­˜æ”¾çš„ï¼Œå­˜æ”¾åœ¨ç£ç›¤ä¸Šçš„ä¸åŒç›®éŒ„measurement æ¸¬é‡æŒ‡æ¨™å,ç›¸ç•¶æ–¼å‚³çµ±æ•¸æ“šåº«è¡¨åtag æ¨™ç±¤ï¼Œåœ¨InfluxDBä¸­ï¼Œtagæ˜¯ä¸€å€‹éå¸¸é‡è¦çš„éƒ¨åˆ†ï¼Œè¡¨å+tagä¸€èµ·ä½œç‚ºæ•¸æ“šåº«çš„ç´¢å¼•ï¼Œæ˜¯â€key-valueâ€çš„å½¢å¼tag key å„ç¨®ç´¢å¼•çš„keytag value å„ç¨®ç´¢å¼•çš„valuetag set ç”±ä¸€ç³»åˆ—çš„tagçµ„æˆã€‚tags åœ¨ InfluxDB ä¸­æœƒæŒ‰ç…§å­—å…¸åºæ’åºï¼Œä¸ç®¡æ˜¯ tagk é‚„æ˜¯ tagvï¼Œåªè¦ä¸ä¸€è‡´å°±åˆ†åˆ¥å±¬æ–¼å…©å€‹ keyï¼Œä¾‹å¦‚ host=server01,region=us-west å’Œ host=server02,region=us-west å°±æ˜¯å…©å€‹ä¸åŒçš„ tag setfield æ•¸æ“šï¼Œfieldä¸»è¦æ˜¯ç”¨ä¾†å­˜æ”¾æ•¸æ“šçš„éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯â€key-valueâ€çš„å½¢å¼field key å„ç¨®è¨˜éŒ„keyfield value fieldå°æ‡‰çš„valueå°±æ˜¯fieldNameï¼ŒInfluxDBä¸­æ”¯æŒä¸€æ¢æ•¸æ“šä¸­æ’å…¥å¤šå€‹fieldNameï¼Œé€™å…¶å¯¦æ˜¯ä¸€å€‹èªæ³•ä¸Šçš„å„ªåŒ–ï¼Œåœ¨å¯¦éš›çš„åº•å±¤å­˜å„²ä¸­ï¼Œæ˜¯ç•¶ä½œå¤šæ¢æ•¸æ“šä¾†å­˜å„²field set ç”±ä¸€ç³»åˆ—çš„key=valueçµ„æˆkey settimestamp æ™‚é–“æˆ³ï¼Œä½œç‚ºæ™‚åºå‹æ•¸æ“šåº«ï¼Œæ™‚é–“æˆ³æ˜¯InfluxDBä¸­æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œåœ¨æ’å…¥æ•¸æ“šæ™‚å¯ä»¥è‡ªå·±æŒ‡å®šä¹Ÿå¯ç•™ç©ºè®“ç³»çµ±æŒ‡å®š,åœ¨æ’å…¥æ–°æ•¸æ“šæ™‚ï¼Œtagã€fieldå’Œtimestampä¹‹é–“ç”¨ç©ºæ ¼åˆ†éš”ã€‚åœ¨ TSM å­˜å„²å¼•æ“ä¸­æœƒç‰¹æ®Šå°å¾…ï¼Œç‚ºäº†å„ªåŒ–å¾ŒçºŒçš„æŸ¥è©¢æ“ä½œseries åºåˆ—ï¼Œæ‰€æœ‰åœ¨æ•¸æ“šåº«ä¸­çš„æ•¸æ“šï¼Œéƒ½éœ€è¦é€šéåœ–è¡¨ä¾†å±•ç¤ºï¼Œè€Œé€™å€‹seriesè¡¨ç¤ºé€™å€‹è¡¨è£¡é¢çš„æ•¸æ“šï¼Œå¯ä»¥åœ¨åœ–è¡¨ä¸Šç•«æˆå¹¾æ¢ç·šï¼Œé€šétagsæ’åˆ—çµ„åˆç®—å‡ºä¾†Retention policy æ•¸æ“šä¿ç•™ç­–ç•¥ï¼Œå¯ä»¥å®šç¾©æ•¸æ“šä¿ç•™çš„æ™‚é•·ï¼Œæ¯å€‹æ•¸æ“šåº«å¯ä»¥æœ‰å¤šå€‹æ•¸æ“šä¿ç•™ç­–ç•¥ï¼Œä½†åªèƒ½æœ‰ä¸€å€‹é»˜èªç­–ç•¥ï¼ŒInfluxDB æœƒå®šæœŸæ¸…é™¤éæœŸçš„æ•¸æ“š</pre><h1 class=ql-align-justify><br></h1><h1 class=ql-align-center><strong>InfluxDBåŸºæœ¬æ“ä½œ</strong></h1><p class=ql-align-justify><br></p><ul><li><br></li></ul><pre>#å‰µå»ºæ•¸æ“šåº«create database "db_name"#é¡¯ç¤ºæ‰€æœ‰çš„æ•¸æ“šåº«show databases#åˆªé™¤æ•¸æ“šåº«drop database "db_name"#ä½¿ç”¨æ•¸æ“šåº«;use db_name#é¡¯ç¤ºè©²æ•¸æ“šåº«ä¸­æ‰€æœ‰çš„è¡¨;show measurements#å‰µå»ºè¡¨,ç›´æ¥åœ¨æ’å…¥æ•¸æ“šçš„æ™‚å€™æŒ‡å®šè¡¨å(key-value)insert disk,hostname=server02,device=/data free=90,used=110,used_percent=98.33,count=1#åˆªé™¤è¡¨;drop measurement "measurement_name"pythonæ“ä½œinfluxdbæ•¸æ“šåº«</pre><p class=ql-align-justify><br></p><p class=ql-align-center><strong>å®‰è£influxdb-python</strong></p><p class=ql-align-justify><br></p><p>pip install influxdb</p><p class=ql-align-justify>ä½¿ç”¨pythonæ“ä½œinfluxdbï¼Œæ•¸æ“šåº«æ“ä½œå®Œæ•´ç¤ºä¾‹å¦‚ä¸‹</p><pre class=ql-align-justify>#! /usr/bin/env python#-*- coding:utf-8 -*-from influxdb import InfluxDBClientclient = InfluxDBClient(â€˜localhostâ€˜, 8086, â€˜rootâ€˜, â€˜â€˜, â€˜â€˜) # åˆå§‹åŒ–print client.get_list_database() # é¡¯ç¤ºæ‰€æœ‰æ•¸æ“šåº«åç¨±client.create_database(â€˜testdbâ€˜) # å‰µå»ºæ•¸æ“šåº«print client.get_list_database() # é¡¯ç¤ºæ‰€æœ‰æ•¸æ“šåº«åç¨±client.drop_database(â€˜testdbâ€˜) # åˆªé™¤æ•¸æ“šåº«print client.get_list_database() # é¡¯ç¤ºæ‰€æœ‰æ•¸æ“šåº«åç¨±</pre><p class=ql-align-center><strong>å‰µå»ºæ–°è¡¨ä¸¦æ·»åŠ æ•¸æ“š</strong></p><p class=ql-align-justify><br></p><p>InfluxDBæ²’æœ‰æä¾›å–®ç¨çš„å»ºè¡¨èªå¥ï¼Œå¯ä»¥é€šéä¸¦æ·»åŠ æ•¸æ“šçš„æ–¹å¼å»ºè¡¨ï¼Œç¤ºä¾‹å¦‚ä¸‹</p><p>json_body = [</p><p>{</p><p>"measurement": "students",</p><p>"tags": {</p><p>"stuid": "s123"</p><p>},</p><p>#"time": "2017-03-12T22:00:00Z",</p><p>"fields": {</p><p>"score": 89</p><p>}</p><p>}</p><p>]</p><p>client = InfluxDBClient(â€˜localhostâ€˜, 8086, â€˜rootâ€˜, â€˜â€˜, â€˜testdbâ€˜) # åˆå§‹åŒ–ï¼ˆæŒ‡å®šè¦æ“ä½œçš„æ•¸æ“šåº«ï¼‰</p><p>client.write_points(json_body) # å¯«å…¥æ•¸æ“šï¼ŒåŒæ™‚å‰µå»ºè¡¨</p><h1 class=ql-align-center><strong>åˆ©ç”¨æ™‚åºæ•¸æ“šåº«é€²è¡Œè‡ªå‹•åŒ–ç›£æ§</strong></h1><p class=ql-align-justify><br></p><p>ä»¥ä¸Šè¬›è§£äº†influxdbçš„åŸºæœ¬ä½¿ç”¨ï¼Œå¾Œé¢è«‡ä¸€ä¸‹influxdbåœ¨ç›£æ§ä¸­çš„æ‡‰ç”¨ï¼Œä½¿ç”¨pythonè…³æœ¬å°‡ç›£æ§æ•¸æ“šå­˜å…¥influnxdbï¼Œç„¶å¾Œä½¿ç”¨grafanaé€²è¡Œåœ–è¡¨é¡¯ç¤ºã€‚ä¸‹é¢æ¡ˆä¾‹æ˜¯ç›£æ§åœ–ç‰‡ä¸Šå‚³åˆ°ä¸ƒç‰›é›²å­˜å„²çš„ä¸Šå‚³å’Œä¸‹è¼‰æ™‚é–“ï¼Œä»¥åŠpingä¸ƒç‰›åŸŸåçš„éŸ¿æ‡‰æ™‚é–“ï¼Œåœ¨å·¥ä½œä¸­æˆ‘å€‘ç¶“å¸¸ä¸Šå‚³é›²å­˜å„²æ¯”è¼ƒæ…¢çš„ç¾è±¡ï¼Œæˆ‘å€‘å°‡æ¡é›†åˆ°çš„æ•¸æ“šå­˜å…¥åˆ°influnx</p><ul><li><br></li></ul><pre>##è…³æœ¬æ”¾åˆ°linuxçš„crontabè…³æœ¬ä¸­ï¼Œ1åˆ†é˜åŸ·è¡Œä¸€æ¬¡ï¼Œæ¯æ¬¡åŸ·è¡Œæœƒå°‡æ•¸æ“šæ‰“å°åˆ°influnxdbé€²è¡Œå­˜å„²# -*- coding: utf-8 -*-import os,sys,commandsimport datetimefrom influxdb import InfluxDBClientimport sys, time, subprocess,oslogFile = os.getcwd()+"/vrping.log"#æ‰“å°æ—¥èªŒå‡½æ•¸def logger(logContent,logFile): with open(logFile,'a') as f: f.write(logContent+'\n')#ç²å–æ™‚æœŸå‡½æ•¸def get_today_date(): now_time = datetime.datetime.now() yes_time = now_time + datetime.timedelta(days=0) yes_time_nyr = yes_time.strftime('%Y-%m-%d') result = str(yes_time_nyr) return resultdef annotate(time_loss,time_delay,server_name,Average_Speed,Average_Time,used_time): """Send the data across to InfluxDB as an annotation"""# client = InfluxDBClient("10.99.69.40", 8086, 'testdb')#é€£æ¥influnxdb client = InfluxDBClient('10.99.69.40', 8086, 'root', '', 'testdb')#æ§‹é€ æ•¸æ“š data = [ { # The 'table' "measurement": "vr_ping", # Metadata "tags": { "stuid": "sdds" }, # Data "fields": { "time_loss": time_loss, "time_delay": time_delay, "server_name":server_name, "Average_Speed":Average_Speed, "Average_Time":Average_Time, "used_time":used_time } } ] try: client.write_points(data) except Exception as e: logger("å¯«å…¥æ•¸æ“šå¤±æ•—",logFile) print e#å®šç¾©å‡½æ•¸ï¼Œè£½ä½œæ•¸æ“šå¯«å…¥influnxdbdef vr_ping(server_name): file = '/tmp/zabbix-vr.jpg' command = 'wget --timeout=3 http://oe9anrc75.bkt.clouddn.com/zabbix-vr.jpg?attname= -O %s' % file cmd1="ping -W 0.5 -i 0.05 -c 1 {0} -w 1|grep -oP '(?&lt;=time\=)[0-9.]+'||echo 1000.1".format(server_name) cmd2="ping -W 0.5 -i 0.05 -c200" +" " + server_name +" "+ " -w 15|grep loss|awk '{print (200-$4)/200*100}'" cmd3 = "/root/qshell fput panop2 zabbix-vr.jpg /root/zabbix-vr.jpg true|grep 'Average Speed:'|awk '{print $(NF-1)}'" cmd4 = "/root/qshell fput panop2 zabbix-vr.jpg /root/zabbix-vr.jpg true|grep 'Average Speed:'|awk '{print $3}'" (status, output) = commands.getstatusoutput(cmd1) if status == 0: time_delay=output else: logger("time_delay åŸ·è¡Œå¤±æ•—",logFile) (status, output) = commands.getstatusoutput(cmd2) if status == 0: time_loss=output else: logger("time_loss åŸ·è¡Œå¤±æ•—", logFile) (status, output) = commands.getstatusoutput(cmd3) Average_Speed = output (status, output) = commands.getstatusoutput(cmd4) Average_Time = output # command = 'wget --timeout=3 http://oanphm9zg.bkt.clouddn.com/0cf863.m3u8?attname= -O %s' % file #print command start_time = time.time() # print start_time sp = subprocess.Popen(command, bufsize=1024, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, close_fds=True) out, err = sp.communicate() end_time = time.time() # print end_time if err: if '200 OK' not in err: used_time = 5 print used_time sys.exit(1) used_time = (end_time - start_time).seconds used_time = round(used_time,2) os.remove(file) annotate(time_loss, time_delay, server_name,Average_Speed,Average_Time,used_time)vr_ping('up.qiniu.com')</pre><h1 class=ql-align-center><strong>çµåˆgrafanaä½¿ç”¨</strong></h1><p class=ql-align-justify><br></p><p>grafana æ˜¯ä¸€æ¬¾ç•Œé¢ç¾è§€ã€å¼·å¤§çš„å¯è¦–åŒ–ç›£æ§æŒ‡æ¨™å±•ç¤ºå·¥å…·ï¼Œæ¡ç”¨ go èªè¨€ç·¨å¯«çš„é–‹æºæ‡‰ç”¨ï¼Œä¸»è¦ç”¨æ–¼å¤§è¦æ¨¡æŒ‡æ¨™æ•¸æ“šçš„å¯è¦–åŒ–å±•ç¾ï¼ŒåŸºæ–¼å•†æ¥­å‹å¥½çš„ Apache License 2.0 é–‹æºå”è­°ã€‚</p><p class=ql-align-justify>grafanaå®‰è£</p><pre class=ql-align-justify></pre><p class=ql-align-justify><br></p><ul><li><br></li></ul><pre>$ wget https://s3-us-west-2.amazonaws.com/grafana-releases/release/grafana-4.2.0-1.x86_64.rpm$ sudo yum localinstall grafana-4.2.0-1.x86_64.rpmgrafanaå•Ÿå‹•service grafana-server startgrafanaå¾Œè‡ºé é¢è¨ªå•http://IP:3000</pre><p class=ql-align-justify>Grafanaæ·»åŠ IfluxDBç‚ºæ•¸æ“šæº</p><div class=pgc-img><img alt=æ´»ç”¨æ™‚åºæ•¸æ“šåº«ï¼Œç©è½‰è‡ªå‹•åŒ–ç›£æ§ onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/740a948eab61466aabb3565955e5d8ce><p class=pgc-img-caption></p></div><p class=ql-align-justify><br></p><p class=ql-align-justify>åˆ©ç”¨grafanaé€²è¡Œç•«åœ–</p><div class=pgc-img><img alt=æ´»ç”¨æ™‚åºæ•¸æ“šåº«ï¼Œç©è½‰è‡ªå‹•åŒ–ç›£æ§ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9c552a3e616a43569aa0d6fdbead052b><p class=pgc-img-caption></p></div><h1 class=ql-align-justify><br></h1><h1 class=ql-align-center><strong>ç¸½çµ</strong></h1><p class=ql-align-justify><br></p><p>åœ¨æˆ‘å€‘å¹³æ™‚å·¥ä½œä¸­ï¼Œæœƒé‡åˆ°å„å¼å„æ¨£çš„ç›£æ§ï¼Œä½¿ç”¨python +influnxdb+grafanaé€²è¡Œæ•¸æ“šæ”¹é€ ã€æ•¸æ“šå…¥åº«ã€æ•¸æ“šåœ–å½¢åŒ–é¡¯ç¤ºæ˜¯ä¸€ç¨®æ¯”è¼ƒéˆæ´»å¸¸è¦‹çš„æ–¹å¼ï¼Œåœ¨å·¥ä½œä¸­æœƒé‡åˆ°å¾ˆå¤šï¼Œä¸ç®¡æ˜¯æ¥­å‹™æ•¸æ“šé‚„æ˜¯æ©Ÿå™¨åŸºç¤ç›£æ§æ•¸æ“šï¼Œéƒ½å¯ä»¥å°‡æ•¸æ“šæ‰“é»ï¼Œæœ€å¾Œå±•ç¤ºå‡ºæ¯”è¼ƒå‹å¥½çš„åœ–å½¢åŒ–ç•Œé¢ã€‚</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>æ™‚åº</a></li><li><a>æ•¸æ“šåº«</a></li><li><a>ç©è½‰</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/51371207.html alt=DBengineæ’åç¬¬ä¸€æ™‚åºæ•¸æ“šåº«â€”â€”é˜¿é‡Œé›²æ•¸æ“šåº«InfluxDBæ­£å¼å•†æ¥­åŒ– class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8fed1db0f05a46d0845d4ae8fceded1c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/51371207.html title=DBengineæ’åç¬¬ä¸€æ™‚åºæ•¸æ“šåº«â€”â€”é˜¿é‡Œé›²æ•¸æ“šåº«InfluxDBæ­£å¼å•†æ¥­åŒ–>DBengineæ’åç¬¬ä¸€æ™‚åºæ•¸æ“šåº«â€”â€”é˜¿é‡Œé›²æ•¸æ“šåº«InfluxDBæ­£å¼å•†æ¥­åŒ–</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a793e5aa.html alt=ä»€éº¼æ˜¯æ™‚åºæ•¸æ“šåº«ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a793e5aa.html title=ä»€éº¼æ˜¯æ™‚åºæ•¸æ“šåº«ï¼Ÿ>ä»€éº¼æ˜¯æ™‚åºæ•¸æ“šåº«ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b1e1ee49.html alt=ååˆ†é˜è®“ä½ çœ‹æ‡‚æ™‚åºæ•¸æ“šåº« class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/45d1d3313c644396bf29f249b2fce90b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b1e1ee49.html title=ååˆ†é˜è®“ä½ çœ‹æ‡‚æ™‚åºæ•¸æ“šåº«>ååˆ†é˜è®“ä½ çœ‹æ‡‚æ™‚åºæ•¸æ“šåº«</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ef737d82.html alt=åŸºæ–¼æ™‚åºæ•¸æ“šåº«åšç›£æ§ï¼Œé€™è£¡æœ‰è¶…æµè¡Œçš„é–‹æºæ–¹æ¡ˆ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/RcHNVefHoUVLac style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ef737d82.html title=åŸºæ–¼æ™‚åºæ•¸æ“šåº«åšç›£æ§ï¼Œé€™è£¡æœ‰è¶…æµè¡Œçš„é–‹æºæ–¹æ¡ˆ>åŸºæ–¼æ™‚åºæ•¸æ“šåº«åšç›£æ§ï¼Œé€™è£¡æœ‰è¶…æµè¡Œçš„é–‹æºæ–¹æ¡ˆ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c9a0268c.html alt=æ™‚åºæ•¸æ“šåº«çš„æŠ€è¡“å’Œæ¶æ§‹æ¼”é€² class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/122f6b0b368f4313b7efe62c811270ff style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c9a0268c.html title=æ™‚åºæ•¸æ“šåº«çš„æŠ€è¡“å’Œæ¶æ§‹æ¼”é€²>æ™‚åºæ•¸æ“šåº«çš„æŠ€è¡“å’Œæ¶æ§‹æ¼”é€²</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/55686102.html alt="æ™‚åºæ•¸æ“šåº«é€£è¼‰ç³»åˆ—: æ™‚åºæ•¸æ“šåº«ä¸€å“¥InfluxDBä¹‹å­˜å„²æ©Ÿåˆ¶è§£æ" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/bee309a50ea64a2ea56fbd698279eff2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/55686102.html title="æ™‚åºæ•¸æ“šåº«é€£è¼‰ç³»åˆ—: æ™‚åºæ•¸æ“šåº«ä¸€å“¥InfluxDBä¹‹å­˜å„²æ©Ÿåˆ¶è§£æ">æ™‚åºæ•¸æ“šåº«é€£è¼‰ç³»åˆ—: æ™‚åºæ•¸æ“šåº«ä¸€å“¥InfluxDBä¹‹å­˜å„²æ©Ÿåˆ¶è§£æ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2aa8e0f7.html alt=æ™‚åºæ•¸æ“šåº«é€£è¼‰ç³»åˆ—ï¼šæ™‚åºæ•¸æ“šåº«é‚£äº›äº‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/125534ddebc242d5ad4694adcd1602aa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2aa8e0f7.html title=æ™‚åºæ•¸æ“šåº«é€£è¼‰ç³»åˆ—ï¼šæ™‚åºæ•¸æ“šåº«é‚£äº›äº‹>æ™‚åºæ•¸æ“šåº«é€£è¼‰ç³»åˆ—ï¼šæ™‚åºæ•¸æ“šåº«é‚£äº›äº‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9683f9e4.html alt=æ™‚åºæ•¸æ“šåº«ï¼ˆTSDBï¼‰ï¼ç‚ºè¬ç‰©äº’è¯æ’ä¸Šä¸€é›™ç¿…è†€ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/40fac3819b4942798af866c5df7a540a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9683f9e4.html title=æ™‚åºæ•¸æ“šåº«ï¼ˆTSDBï¼‰ï¼ç‚ºè¬ç‰©äº’è¯æ’ä¸Šä¸€é›™ç¿…è†€>æ™‚åºæ•¸æ“šåº«ï¼ˆTSDBï¼‰ï¼ç‚ºè¬ç‰©äº’è¯æ’ä¸Šä¸€é›™ç¿…è†€</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/03043a87.html alt=ç”¨Pythonç©è½‰æ™‚åºæ•¸æ“š class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/db6b5c4e3cba4f37b35163e85a7db1fb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/03043a87.html title=ç”¨Pythonç©è½‰æ™‚åºæ•¸æ“š>ç”¨Pythonç©è½‰æ™‚åºæ•¸æ“š</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/221f2be8.html alt=è©³è§£æ™‚åºæ•¸æ“šåº«InfluxDBï½œä¸€å€‹ä¸ç‚ºäººçŸ¥çš„æ•¸æ“šåº« class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b9d6b2f37d7f4707abb3475a03068a89 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/221f2be8.html title=è©³è§£æ™‚åºæ•¸æ“šåº«InfluxDBï½œä¸€å€‹ä¸ç‚ºäººçŸ¥çš„æ•¸æ“šåº«>è©³è§£æ™‚åºæ•¸æ“šåº«InfluxDBï½œä¸€å€‹ä¸ç‚ºäººçŸ¥çš„æ•¸æ“šåº«</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f7854676.html alt="é’é›²QingCloud æ™‚åºæ•¸æ“šåº« ChronusDB æ­£å¼ä¸Šç·š | æ–°è" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9e805931a15e49a4bd65dcb2d44a452c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f7854676.html title="é’é›²QingCloud æ™‚åºæ•¸æ“šåº« ChronusDB æ­£å¼ä¸Šç·š | æ–°è">é’é›²QingCloud æ™‚åºæ•¸æ“šåº« ChronusDB æ­£å¼ä¸Šç·š | æ–°è</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/945f94d0.html alt=é¤“äº†éº¼è¼•é‡ç´šåˆ†ä½ˆå¼æ™‚åºæ•¸æ“šåº«çš„è¨­è¨ˆèˆ‡æ¢ç´¢ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15254882999416c80866253 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/945f94d0.html title=é¤“äº†éº¼è¼•é‡ç´šåˆ†ä½ˆå¼æ™‚åºæ•¸æ“šåº«çš„è¨­è¨ˆèˆ‡æ¢ç´¢>é¤“äº†éº¼è¼•é‡ç´šåˆ†ä½ˆå¼æ™‚åºæ•¸æ“šåº«çš„è¨­è¨ˆèˆ‡æ¢ç´¢</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/62c78373.html alt=ç‹å»ºæ°‘ï¼šæ™‚åºæ•¸æ“šåº«æ‰“é€šç‰©è¯ç¶²æ•¸æ“šç”Ÿå‘½é€±æœŸ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RPhFdULGUY5XFP style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/62c78373.html title=ç‹å»ºæ°‘ï¼šæ™‚åºæ•¸æ“šåº«æ‰“é€šç‰©è¯ç¶²æ•¸æ“šç”Ÿå‘½é€±æœŸ>ç‹å»ºæ°‘ï¼šæ™‚åºæ•¸æ“šåº«æ‰“é€šç‰©è¯ç¶²æ•¸æ“šç”Ÿå‘½é€±æœŸ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3269d080.html alt=MySQLæ•¸æ“šåº«çš„äº‹å‹™ç®¡ç† class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/152203544367254a708f807 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3269d080.html title=MySQLæ•¸æ“šåº«çš„äº‹å‹™ç®¡ç†>MySQLæ•¸æ“šåº«çš„äº‹å‹™ç®¡ç†</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2d12804e.html alt=[ç©è½‰MySQLä¹‹ä¹]MySQLå¯¦ç¾ACIDä¹‹åŸå­æ€§ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bdb044d821f74107a3fd9119fc34c642 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2d12804e.html title=[ç©è½‰MySQLä¹‹ä¹]MySQLå¯¦ç¾ACIDä¹‹åŸå­æ€§>[ç©è½‰MySQLä¹‹ä¹]MySQLå¯¦ç¾ACIDä¹‹åŸå­æ€§</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>