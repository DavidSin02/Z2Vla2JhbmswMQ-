<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>vlan詳解之二層三層轉發原理 | 极客快訊</title><meta property="og:title" content="vlan詳解之二層三層轉發原理 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/2d71c8de68654968976708295c4191da"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d3a9625.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d3a9625.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d3a9625.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d3a9625.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d3a9625.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d3a9625.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d3a9625.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d3a9625.html><meta property="article:published_time" content="2020-10-29T21:05:40+08:00"><meta property="article:modified_time" content="2020-10-29T21:05:40+08:00"><meta name=Keywords content><meta name=description content="vlan詳解之二層三層轉發原理"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/d3a9625.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>vlan詳解之二層三層轉發原理</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><h1 class=pgc-h-arrow-right><strong>前言</strong></h1><p style=text-align:start>曾經開發了二層交換機，對交換芯片的vlan處理比較熟悉，對vlan的原理自認為也是理解深刻；但是當進行到防火牆時，突然發現又不理解vlan了！</p><p style=text-align:start>於是開始重新學習linux的vlan和橋接，更是發現不瞭解其含義和實現了；於是有了下面的學習結果。</p><p style=text-align:start>關於一些基本的概念（如廣播域 衝突域 vlan）就不做說明了。</p><p style=text-align:start>以下內容摘抄自網上資料，出處用參考標記出來，方便大家參考，網上內容相對零散，為了方便由淺入深的方便理解，根據我自己學習過程，做了梳理。</p><h1 class=pgc-h-arrow-right><strong>第一回 基於vlan的二層交換轉發原理</strong></h1><p>參考： https://www.jianshu.com/p/c930913948a8</p><h1 class=pgc-h-arrow-right><strong>普通轉發流程</strong></h1><p>交換機的二層轉發涉及到兩個關鍵的線程：MAC地址學習流程和報文轉發流程。</p><p><strong>MAC地址學習流程</strong>：</p><ol start=1><li><strong>MAC的學習：</strong>交換機接收網段上的所有數據幀，利用接收數據幀中的源MAC地址來建立MAC地址表；</li><li><strong>MAC的漂移：</strong>交換機如果發現一個包文的入端口和報文中源MAC地址的所在端口不同，就產生端口移動，將MAC地址重新學習到新的端口；</li><li><strong>MAC的老化：</strong> 如果交換機在很長一段時間之內沒有收到某臺主機發出的報文，在該主機對應的MAC地址就會被刪除，等下次報文來的時候會重新學習。</li></ol><p><strong>二層報文轉發流程:</strong></p><ol start=1><li><strong>已知單播-轉發：</strong>交換機在MAC地址表中查找數據幀中的目的MAC地址，如果找到，就將該數據幀發送到相應的端口</li><li><strong>未知單播-泛洪：</strong>如果找不到，就向入端口以外的其它所有端口發送；</li><li><strong>同端口-不轉發：</strong>如果交換機收到的報文中源MAC地址和目的MAC地址所在的端口相同，則丟棄該報文；</li><li><strong>組播和廣播-泛洪：</strong>交換機向入端口以外的其它所有端口轉發廣播報文。</li></ol><p>上面流程是簡單的橋交換流程，增加了VLAN以後，所有流量都在VLAN內部交換。目前的二層交換芯片都支持vlan，如果想對二層轉發有更深入瞭解，當然是閱讀某些二層交換芯片的手冊。</p><p>參考：https://blog.csdn.net/weixin_42096901/article/details/104802047</p><h1 class=pgc-h-arrow-right><strong>基於vlan轉發流程</strong></h1><p>基於Vlan的二層轉發流程主要包括：確定和查找Vlan、查找和學習源MAC、查找目的MAC並轉發數據幀。</p><p><strong>1) 確定和查找Vlan</strong>：交換機端口接收到一個數據幀時，首先通過TPID值判斷該幀是否帶標籤。</p><p>若是tagged幀，且Vid≠0，則在端口所屬的Vlan表中查找該幀標籤中的Vid是否存在，若存在，則進入下一步，否則丟棄該幀(或提交CPU處理);</p><p>若是tagged幀，且Vid=0(即priority幀)，則對該幀附加端口PVid（默認vlan）使之成為tagged幀;</p><p>若是untagged幀，則對該幀附加端口PVid並指定優先級使之成為tagged幀。</p><p>注：</p><p>①為提高處理效率，交換機內部所有數據幀均攜帶Vlan標籤，以統一方式處理。故需對輸入交換機的數據幀進行標籤檢查並按需加上標籤。</p><p>②802.1Q Vlan環境下，幀可分為tagged、untagged和priority-tagged三種。Tagged幀根據其攜帶的標籤Vid進行MAC學習轉發。Untagged和Priority-tagged幀進入交換機端口後根據PVid進行MAC學習轉發。</p><p><strong>2) 查找和學習源MAC</strong>：交換機在MAC轉發表(Mac+Vid+Port)中查找收幀Vid對應的源MAC表項，未找到則學習收幀源MAC (將“源MAC+Vid+Port”添加到MAC表中); 若找到則更新該表項的老化時間。</p><p>注：MAC地址學習只學習單播地址，對於廣播和組播地址不進行學習。組播MAC表項通過CPU配置建立。</p><p><strong>3) 查找目的MAC</strong>：若目的MAC是廣播或組播，則在所屬的Vlan中廣播或組播;否則在MAC表中查找是否存在Vid對應的目的MAC表項。</p><p><strong>4) 轉發數據幀</strong>：若在MAC表中查找到完全匹配的DMAC+Vid表項，則將該幀轉發到表項中的相應端口(若相應端口為收幀端口，則應丟棄該幀);否則向所屬Vlan內除收包端口外的其他所有端口洪泛該幀(洪泛廣播的是未知單播幀而不是廣播幀)。</p><p><br></p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2d71c8de68654968976708295c4191da><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>二層交換機轉發流程實例</strong></h1><p>數據幀從PC1經過一臺交換機轉發到與另一臺交換機相連的PC2並得到響應，如下圖所示。</p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ea78d2bea36644cdb878fcb833be9e81><p class=pgc-img-caption></p></div><p>PC1向PC2發送信息</p><p>假設兩臺交換機剛剛開機(此時MAC地址表為空)，其具體的轉發過程如下：</p><p>①PC1發出的數據幀進入交換機SW1的Access端口後，按照端口PVid加上Vid=100的標籤。交換機將該幀源MAC地址存入MAC地址表(學習)，並將該幀洪泛到Vid=100的所有端口(除入端口外);</p><p>②SW1的Trunk端口屬於Vid=100的Vlan，故接受這個標記為100的Tagged數據幀;而該端口在Vid=100上為Tagged port，因此在發送數據幀出交換機SW1時，不改變Tagged幀的結構;</p><p>③Tagged幀到達交換機SW2的Trunk端口，由於Trunk端口擁有VID=100的Vlan，故接受該幀;該Trunk端口不改變Tagged幀的結構，而是學習源MAC地址後把該數據幀洪泛給所有Vid=100的端口(除入端口外);</p><p>④SW2的Access端口接收到該幀，剝除該幀的Tag標籤後發送給PC2。</p><p>⑤PC2收到PC1發送的數據幀，併發送響應幀給PC1。</p><p>⑥經過與前述過程類似的轉發，響應幀到達交換機SW1。交換機發現該幀的目的MAC地址已在MAC地址表中，則僅轉發給PC1。</p><p>可見，收發雙方同屬一個Vlan的通信，一切處理均在二層網絡內完成。</p><h1 class=pgc-h-arrow-right><strong>第二回 vlan技術續</strong></h1><p>參考： https://blog.csdn.net/z429831417/article/details/50498072</p><h1 class=pgc-h-arrow-right><strong>vlan技術及產生背景</strong></h1><p>在交換式以太網出現後，同一交換機的所有端口處於不同的衝突域，工作效率得到了很大的提高，但是所有端口處於同一廣播域，導致一臺計算機發出廣播幀，局域網中所有的計算機都能夠接受到，使局域網中有限的網絡資源被無用的廣播信息所佔用。</p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/75798f9f43ea49d9b0887038f574f66f><p class=pgc-img-caption></p></div><p>在如上圖中的網絡拓撲，PCA發出一個廣播幀，二層交換機所有的端口處於同一廣播域，那麼交換機會把該數據幀從除收到該數據幀的端口以外的所有端口都進行發送，導致全網充斥這廣播報文，如果一臺計算機發出的廣播報文是100Kbps，那麼10臺將會達到1000Kbps，那麼100臺1000臺呢？是不是導致無用信息大量的佔用著網絡資源，嚴重的時候可能會導致交換機死機，從而影響該局域網的通信，所以如何限制廣播域的傳播範圍成了一個急需解決的問題。</p><p>以太網處於TCP/IP協議棧的第二層，二層上的本地廣播幀是不能被三層設備路由器轉發的，使用路由器可以解決廣播幀的傳播範圍，但是路由器也存在著弊端，一個是路由器的價格比交換機的價格昂貴，是種不經濟的解決方案；二個路由器的端口較少，一個局域網一個端口，如果需要隔離的局域網較多，那麼路由器會應付不過來；三個是在大部分中低端路由器上使用軟件轉發，轉發性能並不高，容易造成性能瓶頸，所以用路由來隔離廣播是個高成本低性能的方案。</p><p>後來IEEE協會專門制定了一個<strong>802.1Q的協議標準</strong>，這就是VLAN技術，VLAN就是在一物理LAN內劃分出多個虛擬LAN的，每個VLAN是一個廣播域，這就縮小了廣播域的範圍，各個VLAN之間不能直接通信</p><p>我們現在來說一下VLAN有哪一些優點，</p><p>一是可以有效的控制廣播域的範圍，前面說了每個VLAN是一個廣播域，VLAN之間隔離廣播域；</p><p>二是VLAN 不受物理位置的閒置，可以靈活的構建工作組；</p><p>三是各個VLAN之間不能直接進行通信，增強了局域網的安全性；</p><p>四是增強了網絡的健壯性，各個VLAN是獨立了，一個VLAN出了問題不會影響其他的VLAN，縮小了故障範圍</p><p>VLAN的作用是用來隔離廣播域，那我們在實際的操作中是如何來劃分VLAN呢？</p><p>下面我們就逐一來講四個基本的VLAN 劃分方法；</p><p>第一個是利用端口來劃分VLAN，這個是我們現在最常用的VLAN 劃分方法，該方法就是把交換機的各個端口按照需要劃分到不同VLAN 裡面去，這是最簡單也是最有效的劃分方法；二層交換機基本是使用改方法；</p><p>第二個是利用MAC地址來劃分VLAN，該方法就是利用主機的MAC地址建立一個與VLAN的映射關係，形成一個映射表，這種方法的優點就是當用戶的物理位置移動時，其所處的VLAN 不會發生變化，靈活性比較高，但是前期的工作量非常大，技術人員得一一去收集MAC地址，然後建立一個映射關係；這種方法在現在的網絡環境裡，好像不會見到了。</p><p>第三個是利用協議來劃分VLAN，不同的協議處於不同的VLAN，比如IP協議映射到vlan1，ipx協議映射到vlan2，交換機通過識別協議標籤來自動劃分到不同的VLAN，但是在現在的網絡環境中用的最多的還是IP協議，運行其他協議已經非常少了；所以這種方法，在現在網絡環境裡應該不會見到了。</p><p>第四個方法就是基於子網劃分，基於子網劃分的就是利用報文中源IP地址以及子網掩碼作為劃分依據，交換機根據收到的報文中的源IP地址找到交換機已經存在的對應關係，然後自動轉發到對應的的VLAN中，這種方法的劃分方式比較靈活，用戶移動位置也不需要重新配置，但是這種方法也不是很完美，因為為了判斷用戶的屬性，必須逐一檢查數據包網絡層的地址，這建耗費交換機不少資源；綜合以上幾種劃分方法的優缺點來看，基於端口劃分是普遍的也是目前所有交換機都支持的VLAN 劃分方法。</p><h1 class=pgc-h-arrow-right><strong>vlan轉發技術原理</strong></h1><p>我們現在來看一下VLAN的轉發技術原理，在以太網交換機中是根據目的MAC地址來查MAC地址表進行數據幀的轉發，MAC地址表中包含了MAC地址與端口的一個對應的關係，當交換機收到一個數據幀的時候，交換機會查看該數據幀中的目的MAC地址，如果是一個單播幀，交換機會查表從對應的端口轉發出去，如果是廣播地址，那麼交換機會從除收到該廣播幀的以外的所有端口發送出去；但是在VLAN 技術中，交換機在數據幀中加上一個標籤，然後交換機在查表的過程之外還要檢查端口上的標籤是否匹配，交換機只會在屬於這個標籤的端口上進行轉發，如果不是就不進行轉發操作</p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d8c82b3d85ea4e01bf202eee844dd135><p class=pgc-img-caption></p></div><p>上圖就是一個帶IEEE802.1Q標記的以太網幀格式，我們現在重點來看中間的tag字段，tag字段總共佔四個字節，其中TPID（標籤協議標識）和TCI（標籤控制信息）各佔兩個字節；TPID是什麼？TPID是IEEE定義的新的類型，標識這是一個封裝了802.1Q標籤的幀，其中就包含了一個固定的值0x8100。後面的TCI又包含了三個字段。分別是priority（優先級）、CFI、VLAN ID；priority佔3位，指定幀的優先級，一共有8種優先級，從0-7；CFI佔1為，當這個值為0時說明這是一個規範格式，為1時是非規範格式，它在令牌環網、FDDI網絡中來指示封裝幀中所帶的地址的比特次序；VLAN ID字段佔12位，指明該數據幀所在的vlan編號，VLAN的編號共4096個，但是0和4096兩個值保留，所以可用的也就4094個，其中的vlan 1是交換機的默認vlan</p><p>我們看完了802.1Q的幀格式，現在再來看看vlan的標籤是怎麼打上去的。</p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/f702adf1a9174c97840a8b100176eccb><p class=pgc-img-caption></p></div><p>當PCA發送一個數據幀到交換機時，這個時候是不帶標籤的，當這個數據幀到達交換機的端口時，交換機給這個數據幀打上一個<strong>默認的標籤（默認vid）</strong>，等這個數據幀要離開這臺交換機的時候，交換機又會把這個標籤去掉，這就是一個單標籤的操作過程，在整個數據轉發的過程中對終端主機來說是透明的，交換機如何進行vlan劃分主機是不知道的，也不需要主機去了解，所有的打標籤和去標籤都交由交換機處理，這就是單標籤的一個操作過程</p><p>看完標籤操作過程後我們來了解下三種鏈路類型，分別是<strong>access、trunk、hybrid</strong></p><p><strong>Access</strong>一般是用在連接用戶設備的那一端，<u>只允許缺省vlan通過</u>，僅接收和發送一個vlan的數據幀，這也就是我們前面所說的單標籤交換過程；看上圖，PCA發送一個數據幀個PCC，交換機收到該數據的時候把這個數據幀打上vlan 10的標籤，然後進行查表操作，把數據幀發送到與PCC連接的端口的時候就會把這個VLAN 10的標籤去掉。</p><p>訪問鏈接（Access Link，或者Access類型端口），指的是“只屬於一個VLAN，且僅向該VLAN轉發數據幀”的端口。在大多數情況下，訪問鏈接所連的是客戶機。</p><p><u>在access鏈路類型中是不是一次只能允許一個vlan通過？</u>那我如果一次要允許多個vlan通過，那麼這個access鏈路類型是不是就行不通了？這也就有了我們第二個鏈路類型，trunk鏈路類型</p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a8321bd1d96643918d4d8fe095bb6f97><p class=pgc-img-caption></p></div><p><strong>Trunk</strong>，匯聚鏈接（Trunk Link），指的是能夠轉發多個不同VLAN的通信的端口；匯聚鏈路上流通的數據幀，都被附加了用於識別分屬於哪個VLAN的標籤。</p><p>看上圖，兩臺交換機中間只有一條鏈路，但是兩個交換機之間要同時傳遞vlan10和vlan20兩個標籤，我們現在用前面的access肯定不行了吧，這個時候我們用trunk來看是怎麼操作的，PCA發送一個數據幀給SWA，SWA收到後打上10的標籤，然後查表通過E1/0/24端口發送SWB，在發送給SWB的時候不做任何操作，原封不動的傳給SWB，SWB收到後再進行查表，然後發送到vlan10對應的端口E1/0/1進行去標籤的操作，最後把去掉標籤的數據幀發送給PCC，PCB和PCD進行通信也進行相同的操作，不過<u>默認幀是個例外</u>，<strong>發送默認幀時</strong>，trunk會去掉默認vlan的標籤；同樣，交換機從trunk收到不帶標籤的幀時會打上默認vlan標籤；我們除了學完access鏈路類型和trunk類型以外，還有第三種鏈路類型hybrid，</p><p><strong>Hybrid</strong>，混合鏈路（Hybrid Link）這是華三的一個私有的鏈路類型，hybrid端口可以接收和發送多個VLAN的數據幀，同時還能對任何vlan幀進行去標籤的操作</p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8aaef86c80c3468e946019399a0ae22c><p class=pgc-img-caption></p></div><p>看上圖，PCA發送一個數據幀給PCC，當交換機收到PCA發來的數據幀時會打上10的標籤，然後交換機進行查表操作，發送到PCC的端口，交換機進行去標籤的操作的時候會檢查untag，在untag表項中可以去掉帶標籤10、20、30的數據幀，所以很方便的就去掉了數據幀；這時PCA又發送一個數據幀給PCB；當交換機收到PCA發來的數據幀時會打上10的標籤，然後交換機進行查表操作，然後發送到PCB的端口，交換機進行去標籤的操作的時候會檢查untag，但是此時untag表項中只有20和30，也就意味著該端口只能去掉帶標籤20和30的數據幀，這是交換機無法去掉標籤，所以只能把該數據幀丟棄</p><p>通過本回的學習我們知道了vlan的作用就是在局域網中限制廣播的傳送範圍，以及如何劃分vlan，我們可以基於端口、子網、協議、MAC四種vlan劃分方法來劃分vlan，還有access、trunk、hybrid三種鏈路類型的應用場景，以及它們是怎麼對標籤操作的，access是進口打標出口解標；trunk可以同時允許多個VLAN幀通過，不對標籤做任何操作，但是發送帶默認標籤的數據幀時會解標，收到不帶標籤的數據幀會打上默認標籤；hybrid可以同時接收和發送多個VLAN的數據幀，同時還能對任何vlan幀進行去標籤的操作</p><p>參考：https://www.cnblogs.com/xieyunc/p/9784041.html</p><p>注意，Access、Trunk和Hybrid端口是廠家對某種端口的稱謂，並非IEEE802.1Q協議標準定義。</p><p>Access端口只屬於一個Vlan，PVid就是其所在Vlan，故不用設置;Trunk和Hybrid端口屬於多個Vlan，故需要設置PVid(缺省為1)。若設置端口PVid，則當端口收到不帶Vlan Tag的數據幀時，對該幀加上Tag標記(Vid設置為端口所屬的默認Vlan編號)並轉發到屬於PVid的端口;當端口發送Vlan Tag的數據幀時，若收幀的Vlan Tag和端口PVid相同，剝除Vlan Tag後再發送該幀。</p><p>Hybrid端口與Trunk端口在接收數據時處理方法相同，區別在於發送數據時：Hybrid端口允許多個Vlan的數據幀發送時不帶標籤，而Trunk端口只允許默認Vlan的數據幀發送時不帶標籤。在同一交換機上Hybrid端口和Trunk端口不能並存，實際使用中可用Hybrid代替Trunk。</p><p>本Hybrid端口的PVid和相連的對端交換機Hybrid端口的PVid必須一致。</p><p>由於端口類型不同，交換機對幀的處理過程也不同。下表根據不同的端口類型分別介紹。</p><p>表2 不同端口類型的Vlan幀處理方式</p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/56e829c6d5bc4d3d97559909122f86b9><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>第三回 vlan間路由和三層交換轉發原理</strong></h1><h1 class=pgc-h-arrow-right><strong>簡單的vlan間路由流程</strong></h1><p><br></p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/38a2e20b883c4154a53ebe5ac6d41164><p class=pgc-img-caption></p></div><p><br></p><p>每一個VLAN有一個端口連接到路由器，所有終端以該路由器為默認網關。並由該路由器完成VLAN間報文的轉發過程。比如10.1.1.1要與11.1.1.1終端通訊。</p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/78610ccc88f94e48b4c1d49ceca590d1><p class=pgc-img-caption></p></div><p><br></p><h1 class=pgc-h-arrow-right><strong>單臂路由工作原理</strong></h1><p>從上面我們看到，如果要通過路由器轉發三層流量，在交換機和路由器之間，每一個VLAN需要有一個鏈路連接，當VLAN很多的時候，這將耗費大量的路由器接口，而路由器接口成本是非常高的。為了節約路由器接口，一個解決方案是路由器支持VLAN子接口。</p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1c39dae99ca54e96a6b017fafe922f1f><p class=pgc-img-caption></p></div><p><br></p><pre><code>VLAN子接口（這裡的vlan子接口，後面linux的vlan實現中也會見到）1. 所謂子接口，就是是通過協議和技術將一個物理接口（interface）虛擬出來的多個邏輯接口。2. VLAN子接口，就是通過VLAN技術，將一個物理接口，虛擬出多個邏輯接口，   VLAN子接口上發送的報文，會打上Vlan-tag，用於區分不同的VLAN鏈路。</code></pre><p>通過配置路由器上的VLAN子接口，路由器和交換機物理上只需要一個端口連接，通過報文上的VLAN-tag區分不同的邏輯鏈路。這樣節省了大量的端口資源。</p><p>參考：https://blog.csdn.net/weixin_42096901/article/details/104802047</p><p>將用於連接路由器的交換機端口設為Trunk匯聚端口，而路由器上的端口也必須支持匯聚鏈路。雙方用於匯聚鏈路的協議也必須相同。接著在路由器上定義對應各Vlan的“子接口(Sub Interface)”。儘管實際與交換機連接的物理端口只有一個，但在理論上可將其分割為多個虛擬端口。如下圖所示。</p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/343f473101e741409850577fd459178a><p class=pgc-img-caption></p></div><p>使用這種Vlan Trunking技術，可使多個Vlan的業務流共享相同的物理連接，通過在匯聚鏈路上傳遞帶標籤的幀來區分各Vlan的流量。通常情況下，Vlan間路由的流量不足以達到鏈路的線速度，使用Vlan Trunking的配置，可提高鏈路的帶寬利用率，節省端口資源以及簡化管理(網絡新增Vlan時只需在路由器上新設一個對應新Vlan的子接口，無需重新佈線)</p><p>【例】不同Vlan間通信時數據的流程，如下圖所示。</p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/49079ee3c00f411588a0caf5ab8c5f1a><p class=pgc-img-caption></p></div><p><strong>不同Vlan間通信流程</strong></p><p>主機PC1通過通信目標IP地址(192.168.2.1) 與子網掩碼計算比較發現PC2與本機不屬於同一網段，不能直接訪問。根據IP通信規則，PC1查找本機路由表尋找相應的網關。在實際網絡中，主機通常只配置默認網關(Default Gateway，GW)，故PC1找到默認網關。然後，PC1在本機ARP高速緩存中查找默認網關(即路由器)的MAC地址，若沒有則向外廣播發送一個ARP請求幀，其目的MAC地址為全1，源MAC地址為本機MAC地址，請求的IP地址為網關192.168.1.100。從路由器返回的ARP單播應答幀中得到路由器MAC地址R後，接下來就按圖中所示的步驟向PC2發送數據幀①，其目的MAC地址是路由器地址R、但目的IP地址仍是最終要通信的對象PC2的地址。</p><p>交換機在端口1上收到數據幀①後，檢索MAC地址表中與端口1同屬一個Vlan的表項。匯聚鏈路被視為屬於所有的Vlan，因此端口6也屬於檢索對象。檢索後交換機得知往MAC地址R發送數據幀時，需經過端口6轉發。</p><p><em>從匯聚端口6發送數據幀時，會附加Vlan識別信息。圖中數據幀②被加上原屬的紅色Vlan標籤後，進入匯聚鏈路。路由器收到數據幀②後，確認其Vlan標籤，交由負責紅色Vlan的子接口接收。</em></p><p>接著，根據路由器內部的路由表，判斷該向哪裡轉發。由於目標網絡192.168.2.0/24屬於藍色Vlan，且該網絡通過子接口與路由器直連，因此只需從負責藍色Vlan的子接口轉發即可。此時數據幀的目的MAC地址被改成PC2的MAC地址;由於需要經過匯聚鏈路轉發，故附加屬於藍色Vlan的識別信息(數據幀③)。</p><p>交換機收到數據幀③後，根據Vlan標籤從MAC地址表中檢索屬於藍色Vlan的表項。由於通信目標PC2連接在端口3上且該端口為接入端口，因此交換機剝除數據幀的Vlan標籤後(數據幀④)轉發給端口3，最終PC2成功收到PC1發來的數據幀。</p><p>可見，Vlan間通信時，即使雙方都連接在同一臺交換機上，也必須經過<strong>“發送方→交換機→路由器→交換機→接收方”</strong>這樣一個流程。在進行三層路由轉發時，<strong>數據包IP地址保持不變，MAC地址則在每個節點都會改變</strong>。</p><h1 class=pgc-h-arrow-right><strong>三層交換機</strong></h1><p style=text-align:start>三層交換機的原理模型可以認為是：三層交換機 = 二層交換機+三層路由器 三層交換機既有二層交換單元，內部還有一個三層路由模塊。（原理上可以認為三層交換機就是把一個交換機和一個路由器裝在一個盒子裡。雖然原理上我們可以這樣簡單認為，但在具體實現上，特別是報文的轉發流程上，還是有很大差異的。所以三層交換機在轉發性能和成本上都有很大的優勢）</p><p style=text-align:start><br></p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5c86d1591d7847a7b31254ee7cc117c3><p class=pgc-img-caption></p></div><p style=text-align:start>在三層交換機上，可以在一個VLAN配置三層接口（cisco成為交換機虛擬接口 SVI:switch virtual interface），這個SVI接口就是上面原理模型中的那個路由模塊對應的接口。它具備普通路由器接口的基本特性，比如：</p><ul><li>該接口有自己的MAC地址；</li><li>在該SVI接口上，我們可以進行標準的三層協議的配置，包括IP地址，路由協議等等。</li></ul><h1 class=pgc-h-arrow-right><strong>三層交換機轉發流程</strong></h1><p style=text-align:start>使用VLAN Trunking後，用傳統路由器進行Vlan間路由在性能上存在一定的不足：由於路由器採用通用CPU，轉發完全依靠軟件處理，同時支持各種通信接口，給軟件帶來較大負擔。軟件要處理包括報文接收、校驗、查找路由、選項處理、報文分片等，導致性能不可能很高。就Vlan間路由而言，流量會集中到路由器和交換機互聯的匯聚鏈路部分，該部分容易成為速度瓶頸。</p><p style=text-align:start>由於Vlan間通信比較簡單，只需查下路由表，所以可將交換機集成查路由表的專用芯片(ASIC)，實現二層交換和三層路由的功能集成，即三層交換機(Layer 3 Switch)。</p><p style=text-align:start>三層交換機的設計基於對IP路由的仔細分析，提取出IP路由中每個報文都必經的簡化過程：</p><p style=text-align:start>IP路由中絕大多數報文不包含IP選項，因此多數情況下無需處理報文IP選項;</p><p style=text-align:start>不同的網絡報文長度不同，為支持各種異構網絡的互連，IP實現了報文分片功能，但在全以太網環境中，數據幀(報文)長度固定，因此可裁減報文分片功能;</p><p style=text-align:start>三層交換機採用與路由器最長地址掩碼匹配不同的方法，使用精確地址匹配的方式處理，有利於硬件實現快速查找;</p><p style=text-align:start>三層交換機採用Cache方法，將最近經常使用的主機路由放入硬件查找表。只有在該Cache中無法匹配到的條項才通過軟件轉發。這樣，只有每個流的第一個報文通過軟件轉發，其後的大量數據流則在硬件中得以完成，極大提升轉發性能。</p><p style=text-align:start>三層交換機的內部結構可參照下面的簡圖。</p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/fe41bdc30f7249daa7d7ffb17ea3e5c3><p class=pgc-img-caption></p></div><p style=text-align:start>如圖，內置的路由模塊與交換模塊相同，使用ASIC硬件處理路由。因此，與傳統的路由器相比，可實現高速路由。並且，路由與交換模塊由內部匯聚鏈路連接，可確保相當大的帶寬。</p><p style=text-align:start>對應到IP網絡模型中，每個Vlan對應一個IP網段，三層交換機中的三層轉發引擎在各網段(Vlan)間轉發報文，實現Vlan之間的互通，因此三層交換機的路由功能通常叫做Vlan間路由(Inter-VLAN Routing)。</p><p style=text-align:start>使用路由器連接時，一般需要在LAN接口上設置對應各Vlan的子接口;三層交換機則是在內部生成“VLAN接口(VLAN Interface)”，用於各Vlan收發數據。在Cisco的Catalyst系列交換機上，VLAN接口被稱為SVI(Switched Virtual Interface，交換虛擬接口)。三層交換機每創建一個Vlan就會自動生成一個SVI。在SVI接口設置默認網關後，並將主機網關配置成與交換機SVI相同，即可實現不同Vlan間的路由。</p><p style=text-align:start>使用三層交換機進行Vlan間路由與使用匯聚鏈路連接路由器與交換機相似，即需經過“發送方→交換模塊→路由模塊→交換模塊→接收方”的流程。</p><p style=text-align:start>交換機的轉發行為主要藉助於下面幾張表：</p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d47423b9bb9b4689859db124601171e3><p class=pgc-img-caption></p></div><p style=text-align:start>三層主機路由表相當於【網段路由表+ARP表】的組合，用於加快交換流程。三層主機路由表的生成有兩種方式：</p><ul><li>預先生成： 也有些設備只要學習到ARP條目，就自動生成主機路由，並保持主機路由與ARP條目之間的同步與一致性。這種方式對主機路由硬件資源開銷會大一些，但第一個報文就能採用交換方式，性能更高。</li><li>按需生成：到達該目的地的第一個報文轉發時，有軟件進行三層轉發後生成。並且該目的地址一定時間內沒有流量將被老化。這就是所謂的“一次路由，多次交換”。</li></ul><ol start=1><li><strong>準備工作：</strong> 三層交換機為VLAN配置三層接口IP後，會在交換芯片的<strong>MAC地址表</strong>中添加三層接口MAC＋VID的表項，並且為表項的<strong>三層轉發標誌(Route標誌)置位</strong>。</li><li><strong>轉發流程</strong></li></ol><ul><li>硬件二層交換：</li></ul><p>報文進入三層交換機後，首先在交換模塊進行標準的二層交換處理：</p><p>根據報文的目的MAC（精確匹配查找），查找二層MAC轉發表： 如果不存在該MAC條目，則在所有端口上進行泛洪處理（廣播組播也會泛洪）。 如果存在該MAC條目，並且該條目沒有Route標誌，則進行標準交換轉發 如果該MAC條目上有Route標記，則進行硬件三層轉發。</p><ul><li>硬件三層轉發：</li></ul><p>根據報文的目的IP地址（精確匹配查找），查找三層主機路由表： 如果存在，直接轉發（TTL--，目的MAC地址進行替換） 如果不存在，則進行標準的軟件三層報文轉發。</p><ul><li>軟件三層轉發：</li></ul><p>查找目的IP的網段路由（最佳匹配查找）， 如果路由不存在，報文丟棄。 如果存在，查找下一跳的ARP表，如果ARP不存在，進行ARP學習。 學習到ARP後，進行報文轉發，並將轉發信息寫入硬件主機路由表， 以後該目的IP的報文就可以通過硬件進行三層轉發了。（這就是所謂的一次路由，多次交換）</p><h1 class=pgc-h-arrow-right><strong>實例</strong></h1><p style=text-align:start>假設網絡按圖19連接好後，所有設備均為初始狀態，也未向外發送過任何報文。若PC1已知PC2的IP地址，則可通過ping命令發送ICMP報文來獲知PC1能否到達PC2。以下分析該過程。</p><div class=pgc-img><img alt=vlan詳解之二層三層轉發原理 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/3b2a22f24f68492ea8b6c40db2425f05><p class=pgc-img-caption></p></div><p style=text-align:start>ping流程網絡拓撲</p><ol start=1><li>PC1將自身IP和子網掩碼255.255.255.0相與得到網絡號1.1.1.0，將PC2的IP與子網掩碼相與得到網絡號2.2.2.0，得知PC2與自己不在同一網段。於是PC1檢索路由表得到默認網關。PC1欲向網關傳遞信息，但此時PC1中ARP表為空，所以向默認網關(交換機三層接口)發出ARP請求幀，請求網關MAC地址。該幀目的MAC地址為全1，源MAC地址為本機MAC地址，請求的IP地址為網關1.1.1.1;</li><li>SW收到ARP請求幀，對其附加端口PVid(10)的標籤;</li><li>SW用ARP請求幀的Mac1和Vid10查找MAC轉發表，發現沒有該項，則進行學習，即在表中添加“Mac1—Vid10—Port1”的記錄;並將源IP和MAC的對應關係(“1.1.1.2—Mac1”)記錄到ARP表，表明目的IP為1.1.1.2的數據幀轉發時目的MAC為Mac1，同時需路由到端口Port1;</li><li>ARP請求的目的地址是廣播地址，SW將其洪泛到該Vlan的每個端口(除入端口);同時SW自身截獲一份上送CPU(網關)，發現是詢問自己的MAC，於是回覆ARP單播應答幀，目的MAC為PC1的Mac1，源MAC為網關的MAC地址GwMac1，源IP為1.1.1.1，目的IP為PC1的1.1.1.2;</li><li>PC1收到SW發來的ARP應答幀，得到SW三層網關MAC地址，將“1.1.1.1—GwMac1”記錄到ARP表。PC1向SW發送ICMP請求幀，目的IP為PC2的IP(2.2.2.2)，目的MAC為網關MAC，源IP和源MAC為PC1的;</li><li>SW收到ICMP請求幀，對其附加端口PVid(10)的標籤，然後進行源MAC地址學習，發現二層轉發表有該條目，更新老化時間。因該幀目的MAC地址是網關，SW送交三層路由處理。</li><li>在三層首先檢查IP報文的版本、IP首部檢驗和TTL是否正確，若不正確則標記丟棄並交由CPU處理;正確則在三層主機路由表(又稱L3表)中查找目的IP(即PC2的IP 2.2.2.2)。此時L3表中只包含與自己直連的32位地址(包括自身接口)及步驟⑶中ARP表學習後下發的PC1信息，而找不到PC2的信息。進而按最長前綴匹配算法查找子網路由表(又稱Longest Prefix Match即LPM表)得到2.2.2.1目的網段的條目，下一跳的IP地址為 2.2.2.1;</li><li>索引回L3表查找2.2.2.1，得到該條目，發現要提交CPU處理(CPU也需要看作是一個端口);</li><li>CPU沒有到PC2的路由，但PC2的目的IP屬於自己接口地址2.2.2.1的網段，故向接口Vlan20所包含的所有物理端口廣播一個ARP請求幀，源MAC地址為交換機接口的三層MAC地址GwMac2，源IP地址為2.2.2.1，請求IP地址2.2.2.2的MAC地址;</li><li>PC2收到ARP請求，學習“2.2.2.1—GwMac2”加入ARP表;並回復ARP應答幀，目的IP為交換機接口Vlan20的IP地址2.2.2.1，目的MAC為交換機接口Vlan20的MAC地址GwMac2;</li><li>SW收到PC2發送的ARP應答幀，附加端口PVid(20)後在MAC表中查找“Mac2+Vid20”，沒找到則學習源地址，在MAC轉發表中添加PC2相關記錄。因該幀目的MAC為網關地址，故提交三層處理;</li><li>三層首先檢查報文正確性，無誤則在L3表中查找目的IP。由於目的IP為本機，故上送CPU處理。CPU對報文處理後得到“2.2.2.2—Mac2”將相關信息加入ARP表(CPU下發給L3表進行記錄)。</li><li>PC1向SW發送的第一個ICMP請求幀存儲在內存中，此時交由CPU進行IP報文頭部修改(TTL減1,FCS重新計算封裝)和MAC封裝(目的MAC地址改為PC2的MAC地址，源MAC地址改為SW三層MAC地址)併發送給PC2，如果超時則丟棄，CPU發送ICMP超時給PC1;</li><li>PC2收到PC1發來的ICMP請求後，回覆ICMP應答幀，目的IP為PC1的IP 1.1.1.2，同樣PC2發現該地址和自己不在同一子網，需要網關進行轉發。之前PC2已學習到交換機接口Vlan20的ARP，此時根據該ARP將ICMP應答幀目的MAC地址填為網關MAC地址GwMac2發送出去。交換機收到幀後，發現目的MAC地址是網關地址，取出幀中的目的IP地址1.1.1.1查找路由。之前交換機已學習到該IP的路由，所以會查找到主機路由表中相應的路由並將幀目的MAC地址換成Mac1，源MAC地址換成網關MAC地址GwMac2，發送到端口Port1上。最終，PC1就收到PC2的ICMP應答。</li><li>經過以上流程後，PC1和PC2分別學到各自網關接口的ARP，交換機也有了分別到達PC1和PC2的路由。後續的報文不再通過路由，而直接由L3表中對應的表項進行硬件轉發。</li></ol><p style=text-align:start><br></p><p style=text-align:start>至此，基於vlan的二層三層轉發原理就基本清楚了，後面將開始研究linux的vlan實現了！linux的vlan原理，明白了linux的實現思路，大有益處。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>vlan</a></li><li><a>詳解</a></li><li><a>層三層</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/f8b2a960.html alt="思路方法詳解 高三數學複習難點突破 圓錐曲線中的定點、定值問題" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/afd28158b4384f5eaa05c44c3104e24f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f8b2a960.html title="思路方法詳解 高三數學複習難點突破 圓錐曲線中的定點、定值問題">思路方法詳解 高三數學複習難點突破 圓錐曲線中的定點、定值問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/17054f8d.html alt=詳解CD編碼格式（16bit/44.1kHz）合理性之量化篇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/6f23d12bac3843e2b09628221846ce0f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/17054f8d.html title=詳解CD編碼格式（16bit/44.1kHz）合理性之量化篇>詳解CD編碼格式（16bit/44.1kHz）合理性之量化篇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c84544ec.html alt=詳解CD編碼格式（16bit/44.1kHz）合理性之採樣篇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5dc880024dac477f8aed432054712f82 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c84544ec.html title=詳解CD編碼格式（16bit/44.1kHz）合理性之採樣篇>詳解CD編碼格式（16bit/44.1kHz）合理性之採樣篇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/feaa3a52.html alt=詳解音頻編解碼的原理、演進和應用選型等 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c0abba2ccef04296b442c6457cc98f49 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/feaa3a52.html title=詳解音頻編解碼的原理、演進和應用選型等>詳解音頻編解碼的原理、演進和應用選型等</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8293e598.html alt=MySQl事務最全詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c61163c863114226b14bb3760da19e4d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8293e598.html title=MySQl事務最全詳解>MySQl事務最全詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cb944fe7.html alt=Mysql事務詳解(一文讀懂數據庫事務) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/cb7ba6cbda8c44438d9d3d7c57bd25b9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cb944fe7.html title=Mysql事務詳解(一文讀懂數據庫事務)>Mysql事務詳解(一文讀懂數據庫事務)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dc1a27dd.html alt="詳解Oracle 數據庫啟動過程" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/1538236609349861be8e044 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dc1a27dd.html title="詳解Oracle 數據庫啟動過程">詳解Oracle 數據庫啟動過程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b8bda645.html alt=「Java」隨機數詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b471807e699b44c2b1dedc580ea3f3af style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b8bda645.html title=「Java」隨機數詳解>「Java」隨機數詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f44ab8f6.html alt=詳解13項鋼筋安裝質量標準及通病防治 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/fd3ff534941a487884c7a67361337cfb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f44ab8f6.html title=詳解13項鋼筋安裝質量標準及通病防治>詳解13項鋼筋安裝質量標準及通病防治</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/464b2d9e.html alt=史上最全電路圖詳解！老電工都收藏了！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1533138404073909636bf43 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/464b2d9e.html title=史上最全電路圖詳解！老電工都收藏了！>史上最全電路圖詳解！老電工都收藏了！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/79cb5594.html alt=每一滴油力爭做到不浪費，詳解各種燃油噴射方式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/3ed00001d75ac552f05c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/79cb5594.html title=每一滴油力爭做到不浪費，詳解各種燃油噴射方式>每一滴油力爭做到不浪費，詳解各種燃油噴射方式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4ea3618a.html alt="Excel萬金油套路詳解 單條件查找返回多行數據" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2633664673fd439a862a2527763e82c7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4ea3618a.html title="Excel萬金油套路詳解 單條件查找返回多行數據">Excel萬金油套路詳解 單條件查找返回多行數據</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4d1e6d96.html alt=詳解如何使用sum+offset+match函數進行動態區域求和，大神祕籍 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/7360fe7df5e241e7af4b15f75f6474fd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4d1e6d96.html title=詳解如何使用sum+offset+match函數進行動態區域求和，大神祕籍>詳解如何使用sum+offset+match函數進行動態區域求和，大神祕籍</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e2946ed8.html alt=詳解變配電所的佈置 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9fe764b6e4db4a01b0f251f70eb4e912 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e2946ed8.html title=詳解變配電所的佈置>詳解變配電所的佈置</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4b7c4cde.html alt=圖文詳解典型客戶配電室 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/b0d80059-00a9-4fa4-8151-0e56153a02cd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4b7c4cde.html title=圖文詳解典型客戶配電室>圖文詳解典型客戶配電室</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>