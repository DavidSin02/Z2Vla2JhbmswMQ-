<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>SPL 的集合思維 | 极客快訊</title><meta property="og:title" content="SPL 的集合思維 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/b0cab605feda44bbab62157c98769c56"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d461e468.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d461e468.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d461e468.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d461e468.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d461e468.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d461e468.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d461e468.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d461e468.html><meta property="article:published_time" content="2020-11-14T21:07:40+08:00"><meta property="article:modified_time" content="2020-11-14T21:07:40+08:00"><meta name=Keywords content><meta name=description content="SPL 的集合思維"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/d461e468.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>SPL 的集合思維</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>和傳統的程序設計語言不同，SPL中集合的應用非常普遍，實際上最常見的序列和序表等本質上都是集合，可以對它們進行真正的集合運算，從而大幅度提高開發效率和代碼性能。因此，在使用SPL時，需要特別重視對集合概念的理解。</p><p><strong>1 SPL中的序列與集合</strong></p><p>SPL中，序列如同整數、字符串一樣是非常常用的基本數據類型，也能進行相應的基本運算。從集合角度出發，SPL提供了兩個集合A、B的交、並、聯、差等基本運算符：A^B，A|B，A&B，A\B等。如果能夠從這些運算開始深刻理解並熟練運用，解決問題時就能更主動地採用集合思維，從而充分利用已知的數據，思路更直接和簡潔，方法也更加簡易清晰。</p><p>下面的例子顯示瞭如何利用集合運算來簡化代碼：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b0cab605feda44bbab62157c98769c56><p class=pgc-img-caption></p></div><p>代碼中，A4、A6、A8採用了集合運算，分別統計了California州的男員工、所有男性或者位於California州的員工、不在California州的男員工，形式上和A5、A7、A9的傳統統計方式相比，明顯簡潔了很多。</p><p>但是，需要注意的是，A6與A7中雖然獲得的員工資料一致，但結果中記錄的順序不同，如下所示：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3d5c83a453ae443f8b95192eb4ccd331><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/c9a485e8b67e4c34bf9bcd1934e4bd38><p class=pgc-img-caption></p></div><p>造成這種情況的原因是，與數學上的集合不完全相同，SPL中的集合稱為有序集合，是有次序的，同時也可以有重複的成員。序列、序表、排列等全都是這種有序集合。</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ff217e8e240b48779e5d8c7be3133fa1><p class=pgc-img-caption></p></div><p>上表中，A2中的序列有重複的成員，而A3中兩個序列中成員順序不同，直接比較時會認為它們不相等，結果為false：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/55d62f35ad064cbd8f496793ab2249af><p class=pgc-img-caption></p></div><p>另外，數學上集合的交併運算是可交換的，即A∩BºB∩A和A∪B º B∪A，但由於SPL中的集合是有序集合，因此交換律並不成立，交併運算的結果集合將以左操作數的次序為準。</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1a337d4701aa4505bcef58dadfe4c6e0><p class=pgc-img-caption></p></div><p>A3,A4,A5和A6中的計算結果依次如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/114270062b1a462790196aa3761d2e67><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/0cda15c286234df79eaa7f285cdc4fc7><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/83ced6554b5440f88f8bc6e1ef332db6><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9e863df1ac0b4cb7bf2166e1f3c047c2><p class=pgc-img-caption></p></div><p>由於SPL中的序列是有序集合，因此判斷兩個序列是否有同樣成員不能簡單地用比較符==，而要用函數<strong>A</strong>.eq(<strong>B</strong>)：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3481e706619c44fba2359a6744f58970><p class=pgc-img-caption></p></div><p>A1與A2中判斷兩個序列是否相同，結果如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/55d62f35ad064cbd8f496793ab2249af><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/624f9f53a9624cbbac541c3e438abd5f><p class=pgc-img-caption></p></div><p>這是因為A2中[3,2,1]執行sort函數排序後，得到的結果是[1,2,3]，次序也和A1一樣了。</p><p>A3、A4、A5和A6分別都使用函數A.eq(B)來判斷兩個序列是否有著同樣的成員，結果依次如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/624f9f53a9624cbbac541c3e438abd5f><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/55d62f35ad064cbd8f496793ab2249af><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/624f9f53a9624cbbac541c3e438abd5f><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/55d62f35ad064cbd8f496793ab2249af><p class=pgc-img-caption></p></div><p>如果兩個序列中的所有成員全相同，則稱這兩個序列互為置換列。特別的，如果序列中出現了重複的成員，那麼它的置換列中，這個成員也需要有同樣的重複數量。</p><p><strong>2 循環函數</strong></p><p>有了集合數據類型，許多針對集合中成員的運算就可以方便地一句寫出來，不再需要編寫循環代碼了。</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/487307395a7143cb8e12e4cea5f475dc><p class=pgc-img-caption></p></div><p>上表用到了4個循環函數，A2中的sum()計算序列中成員的總和，A3中的avg()計算序列成員的平均值，A4中的max()和min()計算序列中最大值與最小值的差。它們的計算結果依次如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5373a47ca2404fb2beaf5acccb4175c2><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0c1268aacba34360b903ea2f6b0376a5><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/104e745a77434dacb0bcfbbac680ada1><p class=pgc-img-caption></p></div><p>循環函數計算時不僅可以使用集合成員本身的值，而且可以使用成員計算出來的值，包括成員值的計算結果，以及具有結構的集合成員的屬性值。這時可以在函數的參數中指明計算式，其中用符號~表示循環計算中的當前成員。</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b68d33019c2a4e58b5742f8149da9c91><p class=pgc-img-caption></p></div><p>上表中的A2計算序列中成員的平方和，即循環累加每個成員值的平方，結果如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8011462e0e5749f280fac2b3f06122a5><p class=pgc-img-caption></p></div><p>而A4、A5和A6則對A3生成的集合中的每個成員的屬性值進行循環計算。A3對員工信息序表進行查詢後生成集合，其中每個成員是一個員工的信息。A4中計算員工最早的生日，即成員生日的最小值，結果如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ad89df7cfef447bab38688a8f18997d2><p class=pgc-img-caption></p></div><p>A4表達式中的~.可以省略，寫成A5的樣子，因此計算結果與A4相同。</p><p>A6中計算所有員工平均入職年齡，即每個成員入職時間和生日時間的年份差的平均值，結果如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/46474d5c106340dd846ad927fe99369d><p class=pgc-img-caption></p></div><p>執行帶有參數的聚合函數可以被理解為如下兩步：</p><p>1) 先根據參數表達式對集合中的每個成員進行計算，結果稱為計算列</p><p>2) 再對計算列做聚合計算。</p><p>形式上可以表示為：A.f(x)=A.(x).f()，如A1.sum(~*~) 相當於A1.(~*~).sum()，其中A1.(~*~) 為計算列函數，即計算出A1中每個成員的平方，並返回為序列。</p><p>上面例子中A5、A6省略了符號~，這是因為只使用了一層循環函數，省略~不會引起歧義。如果嵌套使用循環函數，~將被解釋為內層序列的成員，這時如果想引用外層序列成員，就必須在~前加上外層序列名。</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/85e578636ea2437aa8626fc9dba2e9fe><p class=pgc-img-caption></p></div><p>這個例子中用到了字符串拼接運算/。A3中，在循環中用/拼接兩個字母，但只用~就只能取到內層序列A2的成員，所以得到的字串只是兩個重複的小寫字母。而A4在循環時指明前一個~所對應的是外層序列，因此得到的是A1大寫字母在前、A2小寫字母在後拼接的結果。A5的表達式中，內層循環即便用了A1.~，但無法識別究竟是哪一層的A1，因此無法引用外層A1成員，所以計算時只能使用內層序列中的成員，因此得到的結果就是重複的大寫字母。這種情況下，如果需要引用外層的成員，就需要採用A6的方法，先將外層成員值賦給臨時變量，再通過臨時變量引用，這樣就可以得到大寫字母交叉拼接的結果了。A3~A6中的計算結果依次如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/ec5db1e3cc694439b7f952f2f878b262><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/4129813b32a649ae8156eba1840c6b9c><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/5ad01d92356440bd859769bac7d8889e><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/dc211300982d4c2fae8136f23908fa6f><p class=pgc-img-caption></p></div><p>關於~的這個規則同樣適用於序表或排列的循環計算，省略~的字段引用寫法，字段將被優先解釋為內層排列的字段，如果在內層排列找不到指定的屬性字段才會再向外層找。</p><p><strong>3 循環次序</strong></p><p>簡單地說，循環函數在計算時將按原序列的次序依次計算，而我們在使用時可以充分利用這一特點。</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bdcfc8fa592442d79553b503b094e365><p class=pgc-img-caption></p></div><p>A3中，通過循環，計算出A1中成員累積和序列：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/dc47683738e34801a7939c873cec3779><p class=pgc-img-caption></p></div><p>A6中，計算出序列A4中，成員0連續出現的最長個數：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/7a326a0776be45dd8a93a9171a84c5b4><p class=pgc-img-caption></p></div><p>類似的情況很多，我們可以只用一個表達式就寫出等同於簡單循環代碼的效果。</p><p><strong>4 計算序列</strong></p><p>除了上面這些返回單個聚合值的循環函數（如sum, avg），很多情況我們還需要繼續對集合進行計算，除了採用基本的集合並、交、差等運算能夠生成一個新集合外，使用計算序列函數<strong>A</strong>.(<strong>x</strong>)返回一個集合，也是很常用的方法。</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3f398728be484a5abfa2122fe2754afd><p class=pgc-img-caption></p></div><p>例子中的A2~A6根據序列A1計算，生成不同的新序列：A2計算每個成員的平方；A3與A4都是用原序列的成員生成新序列；A5循環生成和原序列數量相同的序列，但其中的成員都是1；A6略為複雜些，在循環計算對A1中的成員逐個判斷，如果為奇數，則得到0，否則獲得對應成員的值。A2~A6的計算結果如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4047e5b2294c40e7817039688f09824d><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/98a7913c10554436835f3290b8faa3d9><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/98a7913c10554436835f3290b8faa3d9><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f0f302aaac8c489ea86f603f0a4f173f><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0743d8292c2a4e709ef9d29bc0db7e98><p class=pgc-img-caption></p></div><p>A8的完整寫法是=to(len(A7)).(mid(A7,~,1))，其中to(n)函數生成一個從1到n的數字組成的新序列（熟練後和前面的符號 ~ 一樣，有些情況可以省略），對這個序列進行循環，逐個取出A7中的字符串，從而展開為單字符構成的序列；A9計算出其中字母o出現的次數。A8與A9中的結果如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/90e1b72dc30b477eb7ee8a55a05c4a2b><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/49b595fc8d624ee6bd7312085a06b81f><p class=pgc-img-caption></p></div><p>除了返回序列，我們還可以對序列計算後返回序表，這時需要用new函數。</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b7ec9630c8d942269717913dfc2725ea><p class=pgc-img-caption></p></div><p>A2根據A1循環計算返回新的序表，其中包含兩個字段，一個是A1中的成員，另一個則是該成員的平方值。表達式中的 ~ 前面已經介紹過了，表示當前循環到的序列成員，結果如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8ea2dfef70614937ad895260a7c3ca6d><p class=pgc-img-caption></p></div><p>A3從數據表EMPLOYEE中取出數據產生一個序表，A4從中獲取NAME和BIRTHDAY兩個字段，並根據BIRTHDAY計算出該職員的年齡，形成一個新字段Age，最終生成包含了NAME和Age兩個字段的新序表。結果如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/778ac438bba64fd3839e8dfac2ced03e><p class=pgc-img-caption></p></div><p>A5和A6看上去類似，但實際上卻有區別，A5從A3序表中取出NAME字段，然後直接生成包含了一個NAME字段的新序表；而A6則是根據A3中序表循環計算出由NAME字段構成的序列，兩個結果的不同在於，序表有數據結構而序列無數據結構：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b8eb44039fa74687948d4b94e036b9dc><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c18285bbea5144bbbdc02ef524498849><p class=pgc-img-caption></p></div><p>另外，還有一個僅用於計算的run函數，它直接修改原序列本身，而不是對位計算後返回新的結果序列，一般用於針對排列（序表）修改字段值。</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ae0be35f2b6e47bba0dc88e72b82f819><p class=pgc-img-caption></p></div><p>例子中，A2中生成新序表，列出員工的名字並計算出他們的年齡。而在A3中針對新序表A2進行計算，將每位員工的年齡加1。run函數改變的是原序表A2中的數據，因此A2與A3中結果是相同的，將一同返回修改後的結果。使用分步執行可以看到A2中序表的變化：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b266edd3310a40ad8f8e7e3cabe93993><p class=pgc-img-caption></p></div><p><strong>5 不純的集合</strong></p><p>SPL不要求序列成員的數據類型一致，因此完全可以把數值、字串以及複雜的記錄作為同一個序列的成員。</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3d82be8c012f48edb13dc545f3a6a833><p class=pgc-img-caption></p></div><p>A1中包含多種數據類型的成員，而A2中的序列是由序列A1與整數成員構成的，A1與A2中的數據如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/071aebfe7de74d419085ca1a27aa9da3><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3cf01e1cf5524a7799b8edb5930f5768><p class=pgc-img-caption></p></div><p>不過，對於一般的序列，在大多數情況下，將不同類型的數據置於同一序列中並沒有多少實際的業務意義，因此不必過於關注。</p><p>但是，對於排列，即以記錄構成的序列，允許由來自不同序表的記錄構成，這一點會有實實在在的方便性。</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/edd25b6fa28844eeb3b25dfaac9cf939><p class=pgc-img-caption></p></div><p>A4計算員工和家屬中，女性一共有多少人。即使員工表和家屬表結構不同，但只要其中都包含GENDER字段，就可以正常計算。</p><p>從這個例子可以看出，SPL並不關心排列中的記錄是否來自同一序表，只要它們有名稱相同的字段就可以對其執行一致的操作，而不必象SQL那樣必須將兩個不同結構的表先用UNION語句聯合成一個新表才能操作。這樣不僅思路清楚、書寫簡單，而且不會佔用多餘的內存，同時運算效率更高。</p><p><strong>6 集合的集合</strong></p><p>特別地，集合成員的任意性還允許集合本身作為成員。同時，當A是集合的集合時，還可以進一步使用<strong>A</strong>.conj()，<strong>A</strong>.union()，<strong>A</strong>.diff()，<strong>A</strong>.isect()這些函數，計算A中各個集合的和列、並列、差列和交列。</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/ffc6ca23b4a247d589d6c79e64876929><p class=pgc-img-caption></p></div><p>A1中是一個序列構成的序列。A2,A3,A4和A5分別計算A1中序列成員的和序列、交集序列、各個序列求和的結果以及各個系列每個成員的平方構成的序列。計算後，A2~A5中的結果如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/49611842f2a64b3c8538f999135e7ef3><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bf11948f178e442b95cf910a30a54657><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/2e7c5b1afe4f44a795196725f53c3979><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/10932ee418f44952ab0a75dc23e3a2da><p class=pgc-img-caption></p></div><p>類似的，排列也可以作為序列的成員。</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d8a896053a1e4d45aa5a4ae5efa5f6a4><p class=pgc-img-caption></p></div><p>A2,A3與A4中分別取出California,Indiana和Florida這3個州的員工數據。A5中獲得的就是由A2~A4這3個排列構成的序列，是個集合的集合：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f07069384ba44b4fa94d096d1c24b53c><p class=pgc-img-caption></p></div><p>A6分別計算各州員工數，結果如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1f1976b3dee148428395c53307f3052e><p class=pgc-img-caption></p></div><p>A7中取出各個州的名稱，表達式中的~(1)是可以省略的，也就是說A8與A7是等價的，結果也一樣：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e45b8f441b4f4db7a92b93d2e61d0a91><p class=pgc-img-caption></p></div><p>A9效果看上去和A6一樣，也是統計3個州的員工數，但通過new生成了一個新的序表，看上去更加清晰，也方便以後根據州名檢索使用：：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/2d7b538165c34ec0a909fd8059b50cc5><p class=pgc-img-caption></p></div><p><strong>7 理解分組</strong></p><p>分組是SQL中很常用的運算，但未必所有人都能深刻理解它。</p><p>從集合的角度看，分組運算的實質是將一個集合按某種規則拆分成若干子集，也就是說，其返回值應當是若干個集合構成的集合。只不過人們經常不需要直接察看集合中的這些子集，而是對子集的某些彙總值更感興趣，因此，分組常常伴隨著對子集的進一步彙總計算。</p><p>SQL正是這樣處理的，它的GROUP BY語句總是配合相應的彙總計算。當然，這也是因為SQL自身沒有顯式的集合數據類型，所以無法直接返回“集合的集合”這類數據，只能把彙總計算強加到分組計算之後。</p><p>久而久之，人們習慣了分組總是需要配合後續的彙總計算，而忘記了分組和彙總其實是兩個獨立的步驟。</p><p>但是無論如何，我們仍然會有對這些分組子集感興趣的時候。而且退一步講，即使只對彙總值有興趣，保持住這些子集也有價值，因為如果可以重複利用，不必每次都重新生成，那麼無論在代碼的簡潔還是性能的提升方面都會有很大的幫助。</p><p>而對於SPL來說，因為它充分實現了集合思維，所以就能夠做到還原分組運算的本意。事實上，SPL中的基本分組函數就是隻做純粹的分組，而把彙總計算剝離出去了。</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1a4a30f673e044af9378fc639af189f4><p class=pgc-img-caption></p></div><p>分組的結果本身是一個集合的集合，因此當然還可以繼續分組。而分組結果集合中的各個成員也是集合，各自也能夠再繼續分組。這是兩種不同的操作，但都會形成多層集合。</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/c0980cdff432434f953c9ca67dbbac6e><p class=pgc-img-caption></p></div><p>如果集合運算結果的層次太深，那麼現實的業務含義可能不是很大，但可以用來體會集合的思維方式及運算的實質。</p><p>在分組的同時，group函數會同時將各個組按照分組表達式的結果排序，如：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/dfca59f1557b4a8388b27acdfec1545b><p class=pgc-img-caption></p></div><p>A1中得到的序表如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0de605d1099444278f4eed5a137c0b0a><p class=pgc-img-caption></p></div><p>A2中按部門名稱將員工數據分組，默認情況下，A2中的分組結果就會按照部門名稱升序排序。在B列中統計了各種分組情況下各部門的人數，以便通過DEPT列直接查看排序情況。A2和B2中結果如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/0ba5bdd56e684265a5ea0484dc7bdacd><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7352a0b4765541b3877925a09e62d1cd><p class=pgc-img-caption></p></div><p>A3將A2中的分組結果改為按照部門降序排序，效果可以在B3中看到，結果如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c6de629ee51a4ab3b13ad635f77f480b><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c11a538f35ef48da93ca7ed4c3a6103d><p class=pgc-img-caption></p></div><p>除了將分組結果重新排序，還可以在執行group時添加選項來調整分組順序。</p><p>A4中添加通過@u選項在分組時保持各部門在員工表中出現的原始順序。</p><p>A5中添加的@o選項指定分組時不對記錄做整體排序，而只會將分組表達式相等的相鄰記錄分為一組，因此更像是“相鄰合併”。顯然，這種情況可能會出現的“重複”分組。B4和B5顯示了這兩種情況的效果：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d7db6737f6864e5ea0e03bfe00058d32><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/01329531037a4f168cbe88a918427076><p class=pgc-img-caption></p></div><p><strong>8 非等值分組</strong></p><p>除了常規的group函數，SPL還提供了處理對齊分組的<strong>A</strong>.align@a()函數和處理枚舉分組的<strong>A</strong>.enum()函數。</p><p>我們稱通過group函數完成的分組為等值分組，它具有這樣的特點：</p><p>1) 原集合中任何成員都必須在且只能在某一個子集中，也就是分組後的子集成員完全覆蓋原集合，並且子集之間沒有重疊；</p><p>2) 沒有空子集</p><p>而對齊分組和枚舉分組則不一定滿足這兩點。</p><p>對齊分組是指，用集合中成員計算分組表達式，根據計算結果與事先指定的一個序列中的值一一對應，完成分組。對齊分組需要如下幾步：</p><p>1) 事先指定一組值</p><p>2) 將待分組集合中某個表達式計算結果和指定值相同的成員劃分到同一個子集</p><p>3) 結果的每個子集將和事先指定的值一一對應。</p><p>在這種分組規則下，可能有某個成員不在任何一個子集中，也可能出現空集，或者某成員在兩個子集中都存在。</p><p>如下面的例子，將員工按指定的州序列分組：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/8197205a244342dbb3f0b51e6d659700><p class=pgc-img-caption></p></div><p>在A3中，將集合A1根據A2對齊分組，將A1成員的州名稱與A2的成員做對應。在這樣的分組過程中，有可能有些員工不在任何一個分組中（其他州的員工），也有可能出現沒有任何成員的空組（Chicago不是州名稱，根本沒有對應的員工）。例如，在某種數據情況下，A3結果：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e923171ad55847a1b8ab8103909a1f33><p class=pgc-img-caption></p></div><p>枚舉分組是指，事先指定一組條件，將待分組集合中成員作為參數計算該條件，條件成立者將被劃分到對應的子集。這時也可能有某個成員不在任何一個子集中，以及出現空集，還可能有成員同時在兩個子集中。</p><p>如下面的例子，將員工按照指定的年齡段分組：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6daec3b0e6144bad87438f355d0c0a11><p class=pgc-img-caption></p></div><p>A3中，根據A2中的年齡條件序列進行枚舉分組。enum()函數不指定選項時，不允許分組結果出現重複，也就是說A1中某個員工的記錄可以不在任何分組中（不過例子中的條件是全覆蓋的），但是不會同時出現在兩個分組中（也就是不會重疊）。A3結果如下：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b38408e6525142809e983f1599e5d128><p class=pgc-img-caption></p></div><p>此時，某個年輕的（35歲以下）員工會被分配到第1個分組中。而由於不允許重疊，因此即便他也滿足第二個條件，45歲以下，仍不會再被重複分配到第2組中。</p><p>A5也是根據A4中的條件序列進行枚舉分組，不過這裡使用enum函數時添加了@r選項，表示分組時可重複。此時，某個員工的記錄有可能同時出現在多個分組中了。例如：</p><div class=pgc-img><img alt="SPL 的集合思維" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/af1c584dff1a4688933f29976146aef5><p class=pgc-img-caption></p></div><p>可以看到，某些員工記錄會同時存在於前兩個分組中。</p><p>align@a函數和enum函數雖然看起來和group函數相差很大，不過在理解了分組運算的本質後，就能明白它們其實都是在做同一件事：即把一個集合拆分成若干個子集，所不同的只是拆分的具體條件和規則不同罷了。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>SPL</a></li><li><a>思維</a></li><li><a>集合</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/f605b4b8.html alt=懂了數據結構框架思維，一切算法不過是紙老虎 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ad2c8a60d9634e0aa36b5d8a664de355 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f605b4b8.html title=懂了數據結構框架思維，一切算法不過是紙老虎>懂了數據結構框架思維，一切算法不過是紙老虎</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/739f0ea0.html alt="SPL 的序號思維及定位計算（上）" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1437e9d2ac5b4a208d1104e11ba96f07 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/739f0ea0.html title="SPL 的序號思維及定位計算（上）">SPL 的序號思維及定位計算（上）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eef61410.html alt=瞭解系統化思維，看清自我成長的本質：構建自己“複利循環系統” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/50597beed0fb42d28de8c3d56ed01c6f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eef61410.html title=瞭解系統化思維，看清自我成長的本質：構建自己“複利循環系統”>瞭解系統化思維，看清自我成長的本質：構建自己“複利循環系統”</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d42f90e8.html alt=48思維模型：分形理論一非線性科學三大理論前沿之一 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/00c119ff8622460f86077d5ce9eb6796 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d42f90e8.html title=48思維模型：分形理論一非線性科學三大理論前沿之一>48思維模型：分形理論一非線性科學三大理論前沿之一</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2e9a1834.html alt=如何用分類思維，高效解決問題？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e1b69e792ba04844aac95973708a78d4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2e9a1834.html title=如何用分類思維，高效解決問題？>如何用分類思維，高效解決問題？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ac4fe2c3.html alt=思維的完備性——分類討論 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/4389b097d88b473f85695025d3d7e4c6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ac4fe2c3.html title=思維的完備性——分類討論>思維的完備性——分類討論</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f01bc625.html alt=孩子為何如此幼稚？培養立體思維模式，讓他的思維不再流於表面 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b8d75adbce9a4e79b915e93320a4428e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f01bc625.html title=孩子為何如此幼稚？培養立體思維模式，讓他的思維不再流於表面>孩子為何如此幼稚？培養立體思維模式，讓他的思維不再流於表面</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/da488e5c.html alt=Java集合-Collection class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/da488e5c.html title=Java集合-Collection>Java集合-Collection</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f1ee224b.html alt=Java集合-Queue class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7b956858a7a540d0990d7831eb906983 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f1ee224b.html title=Java集合-Queue>Java集合-Queue</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1e4549b9.html alt=Java集合框架綜述 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/fca2a03e52a1473db53da27e12467181 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1e4549b9.html title=Java集合框架綜述>Java集合框架綜述</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8001e6b0.html alt=java集合框架-Collection與List集合 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8001e6b0.html title=java集合框架-Collection與List集合>java集合框架-Collection與List集合</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/80dcc482.html alt=最常用的Java集合類，你一定用過 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/c67cd5e4de3b459c8010e8be5a995e0d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/80dcc482.html title=最常用的Java集合類，你一定用過>最常用的Java集合類，你一定用過</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fcb4e09c.html alt=詳談Java集合框架 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fcb4e09c.html title=詳談Java集合框架>詳談Java集合框架</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/aa2e8109.html alt="Java集合Set 集合、List和Collections類" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e1ec4b6968944a9aba6a970e3792728c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/aa2e8109.html title="Java集合Set 集合、List和Collections類">Java集合Set 集合、List和Collections類</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/65ba507a.html alt=Java集合類之Collection接口，集合的“爸爸”接口瞭解一下？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9e3bf229076045f18e5bb24370a78db0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/65ba507a.html title=Java集合類之Collection接口，集合的“爸爸”接口瞭解一下？>Java集合類之Collection接口，集合的“爸爸”接口瞭解一下？</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>