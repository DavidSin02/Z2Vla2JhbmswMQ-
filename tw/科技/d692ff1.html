<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>PathAuditor：谷歌開源的路徑缺陷檢測工具 | 极客快訊</title><meta property="og:title" content="PathAuditor：谷歌開源的路徑缺陷檢測工具 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/5987c8b80d6740a1b49c8795878e51a1"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d692ff1.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d692ff1.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d692ff1.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d692ff1.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d692ff1.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d692ff1.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d692ff1.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d692ff1.html><meta property="article:published_time" content="2020-10-29T21:08:07+08:00"><meta property="article:modified_time" content="2020-10-29T21:08:07+08:00"><meta name=Keywords content><meta name=description content="PathAuditor：谷歌開源的路徑缺陷檢測工具"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/d692ff1.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>PathAuditor：谷歌開源的路徑缺陷檢測工具</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>近期，谷歌開源了一個名為PathAuditor的安全工具，旨在幫助開發人員找出和文件訪問相關的漏洞。</p><p>雖然該開源項目由谷歌主導，但是這家科技巨頭表示希望軟件後續的維護由安全社區進行，並強調這不是一個官方支持的谷歌產品。</p><div class=pgc-img><img alt=PathAuditor：谷歌開源的路徑缺陷檢測工具 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5987c8b80d6740a1b49c8795878e51a1><p class=pgc-img-caption></p></div><p><br>根據谷歌的說法，PathAuditor會監控所有的文件訪問行為，記錄下潛藏的漏洞。而他們之所以編寫這個工具正是為了大規模地發現和“文件訪問”所相關的一系列漏洞。PathAuditor是一個共享庫，可以使用LD_PRELOAD加載到進程中，然後hook所有與libc函數相關的filesystem，檢查相關訪問是否安全。</p><p>而這安全檢查主要是通過遍歷路徑並檢查是否有任何組件可以被普通用戶替換。例如，如果某個目錄是普通用戶可寫的，一旦被工具探測到，就會將其記錄到syslog中以進行手動分析。</p><p>文件訪問一類的漏洞可以被攻擊者利用來執行某些非法提升權限的惡意代碼，開發人員可以用此來檢測隱藏著危險的路徑訪問模式。</p><p>再具體一點，就是該工具可以檢查普通用戶是否可以用符號鏈接（symlink）替換文件或目錄，這種情況可能潛藏漏洞。</p><p>除了PathAuditor的源代碼，谷歌還分享了一個用PathAuditor檢測到tmpreaper（遍歷/tmp目錄，刪除舊文件）中漏洞的例子（CVE-2019-3461）。</p><pre>if (S_ISDIR (sb.st_mode)) { char *dst; if ((dst = malloc(strlen(ent-&gt;d_name) + 3)) == NULL) message (LOG_FATAL, "malloc failed.\n"); strcpy(dst, ent-&gt;d_name); strcat(dst, "/X"); rename(ent-&gt;d_name, dst); if (errno == EXDEV) { free(dst); message (LOG_VERBOSE, "File on different device skipped: `%s/%s'\n", dirname, ent-&gt;d_name); continue; } // [...]</pre><p>由於tmpreaper通常以root身份運行，且為了防止刪除tmp之外的文件，所以需要代碼來檢測某個目錄是否為掛載點。</p><p>重點在於以上代碼會調用rename("/tmp/foo", "/tmp/foo/x")，而一旦/tmp/foo確實是掛載點，就將返回EXDEV。如果/tmp/foo屬於除root用戶以外的任何用戶，PathAuditor就會將此調用標記為潛在的漏洞。為了理解到底發生了什麼，我們需要看看內核在重命名時有什麼操作：</p><ol start=1><li>內核針對第一個參數遍歷路徑/tmp/foo。</li><li>內核針對第二個參數遍歷路徑/tmp/foo/x。</li><li>如果源和目標位於不同的文件系統上，則返回EXDEV。</li><li>否則，將文件從第一個目錄移動到第二個目錄。</li></ol><p>因為/tmp/foo將被解析兩次，所以存在競態條件。如果它能被普通用戶所控制，則可在任何時候被不同的文件所替換。</p><p>在代碼進入系統調用之前，我們先用一個文件替換它。當內核解析第一個參數時，它將看到用戶所控制的文件內容。現在我們再次替換它，這一次是使用到同一文件系統上任意目錄的符號鏈接。最後內核將第二次解析路徑，遵循符號鏈接將文件移動到所選定的目錄。</p><p>利用這種方法，我們可以把/tmp中的文件移動到/etc/cron，以root權限運行。</p><p>“這個項目仍處於早期階段，我們也在積極進行下一步工作。我們期待聽到你關於該工具的任何建議，以及其自身的漏洞。”</p><p>在今年早些時候，谷歌發佈了名為ClusterFuzz的模糊測試工具，這主要是為發現Chrome瀏覽器中的內存損壞漏洞而開發的。</p><p><br></p><p>本文由白帽彙整理並翻譯，不代表白帽匯任何觀點和立場</p><p>來源：https://nosec.org/home/detail/3357.html</p><p>原文：https://securityaffairs.co/wordpress/94872/hacking/pathauditor-tool.html</p><p>白帽匯從事信息安全，專注於安全大數據、企業威脅情報。</p><p>公司產品：FOFA-網絡空間安全搜索引擎、FOEYE-網絡空間檢索系統、NOSEC-安全訊息平臺。</p><p>為您提供：網絡空間測繪、企業資產收集、企業威脅情報、應急響應服務。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>PathAuditor</a></li><li><a>開源</a></li><li><a>路徑</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/a2871b0c.html alt="可用於企業的 7 個最佳開源 Web 服務器！" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1531874286737ba179830a5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a2871b0c.html title="可用於企業的 7 個最佳開源 Web 服務器！">可用於企業的 7 個最佳開源 Web 服務器！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5cd7abc7.html alt=分享一組開源的匹配中國大陸手機號碼的正則表達式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ef9e7cc39f8b46b6a66d5b3de5c68e5c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5cd7abc7.html title=分享一組開源的匹配中國大陸手機號碼的正則表達式>分享一組開源的匹配中國大陸手機號碼的正則表達式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fa0e7702.html alt=阿里巴巴開源的超輕量的跨平臺圖形渲染引擎——GCanvas class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/549e2d3e22db49d4a5e13667f7bdd3e3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fa0e7702.html title=阿里巴巴開源的超輕量的跨平臺圖形渲染引擎——GCanvas>阿里巴巴開源的超輕量的跨平臺圖形渲染引擎——GCanvas</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9ef2b040.html alt=開源的的二維繪圖引擎，EChart在用的圖形渲染器——ZRender class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/c2d8dcb7ff7945758fe1df812324bd89 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9ef2b040.html title=開源的的二維繪圖引擎，EChart在用的圖形渲染器——ZRender>開源的的二維繪圖引擎，EChart在用的圖形渲染器——ZRender</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1cd5d250.html alt=3個案例讀懂：全鏈路用戶路徑分析 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RjZyevYGAPnBiN style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1cd5d250.html title=3個案例讀懂：全鏈路用戶路徑分析>3個案例讀懂：全鏈路用戶路徑分析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fefdfee3.html alt=開源的iT和資源管理--GLPI class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fefdfee3.html title=開源的iT和資源管理--GLPI>開源的iT和資源管理--GLPI</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/caf49203.html alt="免費開源資源管理器——RX 文件管理器" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9069364bb291498eba907fca4e2c38df style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/caf49203.html title="免費開源資源管理器——RX 文件管理器">免費開源資源管理器——RX 文件管理器</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/888474fb.html alt=PHP開源項目那麼多，你們都喜歡哪幾個？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/153097330447768a536afb3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/888474fb.html title=PHP開源項目那麼多，你們都喜歡哪幾個？>PHP開源項目那麼多，你們都喜歡哪幾個？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/89a099de.html alt=「開源分享」一個仿網易嚴選的微信小程序商城，包括後臺接口 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/78d6ba7fe094418186990242c5eb8635 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/89a099de.html title=「開源分享」一個仿網易嚴選的微信小程序商城，包括後臺接口>「開源分享」一個仿網易嚴選的微信小程序商城，包括後臺接口</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3106c5a7.html alt=如何更好地擁抱新零售？開源！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a38094e444704c6db6b98bdc5a6c20ea style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3106c5a7.html title=如何更好地擁抱新零售？開源！>如何更好地擁抱新零售？開源！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dbe2103e.html alt=技術在左，分享在右，商派用開源發力新零售！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15317113618129d71470735 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dbe2103e.html title=技術在左，分享在右，商派用開源發力新零售！>技術在左，分享在右，商派用開源發力新零售！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/833fcd87.html alt="重磅開源｜AOP for Flutter開發利器——AspectD" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a9081cd0f8f5469dbff78c136b207e34 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/833fcd87.html title="重磅開源｜AOP for Flutter開發利器——AspectD">重磅開源｜AOP for Flutter開發利器——AspectD</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cef95023.html alt="開源 | Umajs：輕量級 Node.js Web 框架" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/186828b5b34b4255903df4a9fadc6158 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cef95023.html title="開源 | Umajs：輕量級 Node.js Web 框架">開源 | Umajs：輕量級 Node.js Web 框架</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3d7933e0.html alt=電力電纜路徑圖識讀與繪製 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9b36b3bdd13641c986f2bdc461682e48 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3d7933e0.html title=電力電纜路徑圖識讀與繪製>電力電纜路徑圖識讀與繪製</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cbb2df13.html alt="3 款用於學術出版的開源工具" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e4a610b1ed674a928b379a8b8a57e06e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cbb2df13.html title="3 款用於學術出版的開源工具">3 款用於學術出版的開源工具</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>