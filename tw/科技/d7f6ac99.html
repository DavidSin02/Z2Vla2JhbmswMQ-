<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ä½ çš„redisåˆ†ä½ˆå¼å¯é‡å…¥é–æ˜¯æ€éº¼è¨­è¨ˆçš„(pythonå¯¦ç¾ï¼‰ | æå®¢å¿«è¨Š</title><meta property="og:title" content="ä½ çš„redisåˆ†ä½ˆå¼å¯é‡å…¥é–æ˜¯æ€éº¼è¨­è¨ˆçš„(pythonå¯¦ç¾ï¼‰ - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/19325eb39de0464e81ae82d3555d1126"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d7f6ac99.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d7f6ac99.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d7f6ac99.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d7f6ac99.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d7f6ac99.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d7f6ac99.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/d7f6ac99.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/d7f6ac99.html><meta property="article:published_time" content="2020-11-14T20:55:06+08:00"><meta property="article:modified_time" content="2020-11-14T20:55:06+08:00"><meta name=Keywords content><meta name=description content="ä½ çš„redisåˆ†ä½ˆå¼å¯é‡å…¥é–æ˜¯æ€éº¼è¨­è¨ˆçš„(pythonå¯¦ç¾ï¼‰"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/d7f6ac99.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ä½ çš„redisåˆ†ä½ˆå¼å¯é‡å…¥é–æ˜¯æ€éº¼è¨­è¨ˆçš„(pythonå¯¦ç¾ï¼‰</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><h1 class=pgc-h-center-line>åŸºæœ¬æ¦‚å¿µ</h1><p><br></p><ul><li>åˆ†ä½ˆå¼é–</li></ul><p><br></p><p>åˆ†ä½ˆå¼é–æ˜¯æ§åˆ¶åˆ†ä½ˆå¼ç³»çµ±ä¹‹é–“åŒæ­¥è¨ªå•å…±äº«è³‡æºçš„ä¸€ç¨®æ–¹å¼ã€‚åœ¨åˆ†ä½ˆå¼ç³»çµ±ä¸­ï¼Œå¸¸å¸¸éœ€è¦å”èª¿ä»–å€‘çš„å‹•ä½œã€‚å¦‚æœä¸åŒçš„ç³»çµ±æˆ–æ˜¯åŒä¸€å€‹ç³»çµ±çš„ä¸åŒä¸»æ©Ÿä¹‹é–“å…±äº«äº†ä¸€å€‹æˆ–ä¸€çµ„è³‡æºï¼Œé‚£éº¼è¨ªå•é€™äº›è³‡æºçš„æ™‚å€™ï¼Œå¾€å¾€éœ€è¦äº’æ–¥ä¾†é˜²æ­¢å½¼æ­¤å¹²æ“¾ä¾†ä¿è­‰ä¸€è‡´æ€§ï¼Œåœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œä¾¿éœ€è¦ä½¿ç”¨åˆ°åˆ†ä½ˆå¼é–ã€‚</p><p>åˆ†ä½ˆå¼é–ä¸€èˆ¬æœ‰ä¸‰ç¨®å¯¦ç¾æ–¹å¼ï¼š1. æ•¸æ“šåº«æ¨‚è§€é–ï¼›2. åŸºæ–¼Redisçš„åˆ†ä½ˆå¼é–ï¼›3. åŸºæ–¼ZooKeeperçš„åˆ†ä½ˆå¼é–ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç´¹åŸºæ–¼redisæ–¹å¼ã€‚</p><p><br></p><ul><li>å¯é‡å…¥</li></ul><p><br></p><p>å¯é‡å…¥é–æŒ‡çš„æ˜¯åŒä¸€ç·šç¨‹ä¸­å¯é‡è¤‡å¯éæ­¸èª¿ç”¨çš„é–ï¼Œåœ¨å¤–å±¤ä½¿ç”¨é–ä¹‹å¾Œï¼Œåœ¨å…§å±¤ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œå¦‚æœæ²’æœ‰å¯é‡å…¥é–çš„æ”¯æŒï¼Œåœ¨ç¬¬äºŒæ¬¡å˜—è©¦ç²å¾—é–æ™‚å°‡æœƒé€²å…¥æ­»é–ç‹€æ…‹ã€‚</p><p>å¯é‡å…¥é–çš„è¦é»æ˜¯å°æ–¼åŒä¸€ç·šç¨‹å¯ä»¥å¤šæ¬¡ç²å–é–ï¼Œä¸åŒç·šç¨‹ä¹‹é–“åŒä¸€æŠŠé–ä¸èƒ½é‡è¤‡ç²å–ï¼Œå› æ­¤ç†è«–ä¸Šéœ€è¦ä¿å­˜é–æ“æœ‰è€…çš„ç·šç¨‹æ¨™è­˜ã€‚åœ¨Javaå’Œpythonä¸­éƒ½å¯ä»¥ç”¨ threadlocalè®Šé‡åŒä¾†åŒæ­¥åŒä¸€ç·šç¨‹ä¹‹é–“çš„è³‡æºã€‚</p><p><br></p><h1 class=pgc-h-center-line>åˆ†ä½ˆå¼é–è¨­è¨ˆè¦é»</h1><p><br></p><p>ä¸€å€‹å®Œæ•´çš„åˆ†ä½ˆå¼é–ï¼Œéœ€è¦æ»¿è¶³ä»¥ä¸‹å¹¾å€‹æ¢ä»¶ï¼š</p><ul><li>äº’æ–¥æ€§ã€‚åœ¨ä»»æ„æ™‚åˆ»ï¼Œåªæœ‰ä¸€å€‹å®¢æˆ¶ç«¯èƒ½æŒæœ‰é–ã€‚</li><li>ä¸æœƒç™¼ç”Ÿæ­»é–ã€‚å³ä½¿æœ‰ä¸€å€‹å®¢æˆ¶ç«¯åœ¨æŒæœ‰é–çš„æœŸé–“å´©æ½°è€Œæ²’æœ‰ä¸»å‹•è§£é–ï¼Œä¹Ÿèƒ½ä¿è­‰å¾ŒçºŒå…¶ä»–å®¢æˆ¶ç«¯èƒ½åŠ é–ã€‚é€™å°±è¦æ±‚å¿…é ˆç‚ºé–åŠ ä¸Šè¶…æ™‚æ™‚é–“ã€‚</li><li>å…·æœ‰å®¹éŒ¯æ€§ã€‚åªè¦å¤§éƒ¨åˆ†çš„Redisç¯€é»æ­£å¸¸é‹è¡Œï¼Œå®¢æˆ¶ç«¯å°±å¯ä»¥åŠ é–å’Œè§£é–ã€‚é€™é»æ˜¯è¦æ±‚å¿…é ˆèƒ½å¤ ä¿è­‰ç›¸é—œæ“ä½œçš„åŸå­æ€§ã€‚</li><li>è§£éˆ´é‚„é ˆç¹«éˆ´äººã€‚åŠ é–å’Œè§£é–å¿…é ˆæ˜¯åŒä¸€å€‹å®¢æˆ¶ç«¯ï¼Œå®¢æˆ¶ç«¯è‡ªå·±ä¸èƒ½æŠŠåˆ¥äººåŠ çš„é–çµ¦è§£äº†ã€‚é€™å°±è¦æ±‚æ¯æŠŠé–å¿…é ˆæœ‰è‡ªå·±çš„æ¨™è­˜ï¼Œåœ¨è§£é–æ™‚é€šéåˆ¤æ–·æ¨™è­˜ä¾†ä¿è­‰æ˜¯é‡‹æ”¾çš„è‡ªå·±çš„é–ã€‚</li></ul><p><br></p><h1 class=pgc-h-center-line>ä»£ç¢¼å¯¦ç¾</h1><p><br></p><p>Talk is cheap, show me the codeã€‚ä¸‹é¢æ˜¯ä¸€å€‹åˆ†ä½ˆå¼é–çš„åŸºæœ¬å¯¦ç¾ï¼š</p><pre><code>class DistributedLock(object): Â  Â """ Â   This is not a 100% reliable distributed lock implementation. It is a try best one. Â   And this distributed lock algorithm is based on the time synchronization between Â   each node. Â   But it should be enough for our project. Â   """â€‹ Â  Â def __init__(self, lock_name, expire_time=3): Â  Â  Â  Â self.name = lock_name + '_distributed_lock' Â  Â  Â  Â self.expire_time = expire_time Â  Â  Â  Â self.uuid = str(uuid.uuid4())â€‹ Â  Â @redis_exc Â  Â def __enter__(self): Â  Â  Â  Â """ Â  Â  Â   If driver is not redis, nothing will happen. Â  Â  Â   """ Â  Â  Â  Â redis_conn = driver_manager.get_global_redis_conn() Â  Â  Â  Â while True: Â  Â  Â  Â  Â  Â if redis_conn.set(self.name, self.uuid, ex=self.expire_time*2, nx=True) == 1: Â  Â  Â  Â  Â  Â  Â  Â LOG.debug('Get lock %s' % self.name) Â  Â  Â  Â  Â  Â  Â  Â break Â  Â  Â  Â  Â  Â LOG.debug('Sleep 0.1s to try to get lock %s' % self.name) Â  Â  Â  Â  Â  Â time.sleep(0.1) Â  Â  Â  Â return selfâ€‹ Â  Â @redis_exc Â  Â def __exit__(self, exc_type, exc_val, exc_tb): Â  Â  Â  Â redis_conn = driver_manager.get_global_redis_conn() Â  Â  Â  Â owner_id = redis_conn.get(self.name) Â  Â  Â  Â if owner_id == self.uuid: Â  Â  Â  Â  Â  Â redis_conn.delete(self.name) Â  Â  Â  Â  Â  Â LOG.debug('Release lock %s' % self.name) Â  Â  Â  Â else: Â  Â  Â  Â  Â  Â LOG.warning('Transaction locked by distributed lock %s need larger expire time' % self.name) Â  Â  Â  Â return</code></pre><p><br></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘å€‘åŠ é–å°±ä¸€è¡Œä»£ç¢¼ï¼šredis_conn.set(self.name, self.uuid, ex=self.expire_time, nx=True)ï¼Œé€™å€‹set()æ–¹æ³•ä¸€å…±æœ‰äº”å€‹å½¢åƒï¼š</p><ul><li>ç¬¬ä¸€å€‹ç‚ºkeyï¼Œè¡¨ç¤ºé–çš„å”¯ä¸€æ€§æ¨™è­˜ã€‚</li><li>ç¬¬äºŒå€‹ç‚ºvalueï¼Œæˆ‘å€‘å‚³çš„æ˜¯uuidï¼Œå¾ˆå¤šç«¥é‹å¯èƒ½ä¸æ˜ç™½ï¼Œæœ‰keyä½œç‚ºé–ä¸å°±å¤ äº†å—ï¼Œç‚ºä»€éº¼é‚„è¦ç”¨åˆ°valueï¼ŸåŸå› å°±æ˜¯æˆ‘å€‘åœ¨ä¸Šé¢è¬›åˆ°å¯é æ€§æ™‚ï¼Œåˆ†ä½ˆå¼é–è¦æ»¿è¶³ç¬¬å››å€‹æ¢ä»¶è§£éˆ´é‚„é ˆç¹«éˆ´äººï¼Œé€šéçµ¦valueè³¦å€¼ç‚ºuuidï¼Œæˆ‘å€‘å°±çŸ¥é“é€™æŠŠé–æ˜¯å“ªå€‹è«‹æ±‚åŠ çš„äº†ï¼Œåœ¨è§£é–çš„æ™‚å€™å°±å¯ä»¥æœ‰ä¾æ“šã€‚</li><li>ç¬¬ä¸‰å€‹è¡¨ç¤ºé–çš„éæœŸæ™‚é–“ï¼Œå¦‚æœç¨‹åºç™¼ç”Ÿæ„å¤–æ²’æœ‰åŠæ™‚è§£é–ï¼Œä¹Ÿèƒ½ä¿è­‰åœ¨è¶…æ™‚å¾Œå…¶ä»–è«‹æ±‚èƒ½å¤ æ­£å¸¸åŠ é–</li><li>ç¬¬å››å€‹nx=Trueï¼Œæ„æ€æ˜¯SET IF NOT EXISTï¼Œå³ç•¶keyä¸å­˜åœ¨æ™‚ï¼Œæˆ‘å€‘é€²è¡Œsetæ“ä½œï¼›è‹¥keyå·²ç¶“å­˜åœ¨ï¼Œå‰‡ä¸åšä»»ä½•æ“ä½œï¼›</li></ul><p>ç¸½çš„ä¾†èªªï¼ŒåŸ·è¡Œä¸Šé¢çš„set()æ–¹æ³•å°±åªæœƒå°è‡´å…©ç¨®çµæœï¼š1. ç•¶å‰æ²’æœ‰é–ï¼ˆkeyä¸å­˜åœ¨ï¼‰ï¼Œé‚£éº¼å°±é€²è¡ŒåŠ é–æ“ä½œï¼Œä¸¦å°é–è¨­ç½®å€‹æœ‰æ•ˆæœŸï¼ŒåŒæ™‚valueè¡¨ç¤ºåŠ é–çš„å®¢æˆ¶ç«¯ã€‚2. å·²æœ‰é–å­˜åœ¨ï¼Œä¸åšä»»ä½•æ“ä½œã€‚</p><p>å¿ƒç´°çš„ç«¥é‹å°±æœƒç™¼ç¾äº†ï¼Œæˆ‘å€‘çš„åŠ é–ä»£ç¢¼æ»¿è¶³æˆ‘å€‘å¯é æ€§è£¡æè¿°çš„ä¸‰å€‹æ¢ä»¶ã€‚é¦–å…ˆï¼Œset()åŠ å…¥äº†NXåƒæ•¸ï¼Œå¯ä»¥ä¿è­‰å¦‚æœå·²æœ‰keyå­˜åœ¨ï¼Œå‰‡å‡½æ•¸ä¸æœƒèª¿ç”¨æˆåŠŸï¼Œä¹Ÿå°±æ˜¯éš»æœ‰ä¸€å€‹å®¢æˆ¶ç«¯èƒ½æŒæœ‰é–ï¼Œæ»¿è¶³äº’æ–¥æ€§ã€‚å…¶æ¬¡ï¼Œç”±æ–¼æˆ‘å€‘å°é–è¨­ç½®äº†éæœŸæ™‚é–“ï¼Œå³ä½¿é–çš„æŒæœ‰è€…å¾ŒçºŒç™¼ç”Ÿå´©æ½°è€Œæ²’æœ‰è§£é–ï¼Œé–ä¹Ÿæœƒå› ç‚ºåˆ°äº†éæœŸæ™‚é–“è€Œè‡ªå‹•è§£é–ï¼ˆå³keyè¢«åˆªé™¤ï¼‰ï¼Œä¸æœƒç™¼ç”Ÿæ­»é–ã€‚æœ€å¾Œï¼Œå› ç‚ºæˆ‘å€‘å°‡valueè³¦å€¼ç‚ºuuidï¼Œä»£è¡¨åŠ é–çš„å®¢æˆ¶ç«¯è«‹æ±‚æ¨™è­˜ï¼Œé‚£éº¼åœ¨å®¢æˆ¶ç«¯åœ¨è§£é–çš„æ™‚å€™å°±å¯ä»¥é€²è¡Œæ ¡é©—ã€‚</p><p>ä¸Šé¢åˆ†ä½ˆå¼é–è§£é–éšæ®µåˆ†äº†å…©æ­¥ï¼Œå…ˆç²å–é–çš„owner_idï¼Œç„¶å¾Œæ ¹æ“šowner_idé€²è¡Œè§£é–åˆ¤æ–·ï¼Œå¯¦éš›ä¸Šï¼Œä¸€èˆ¬æ¨è–¦çš„éƒ½æ˜¯å°‡å…©æ­¥æ“ä½œåŸå­åŒ–ï¼Œä½¿ç”¨LUAè…³æœ¬é€²è¡ŒåŸ·è¡Œï¼Œæ­¤è™•æš«æ™‚æœªå°æ­¤åšç›¸æ‡‰å„ªåŒ–ã€‚</p><p><br></p><h1 class=pgc-h-center-line>åˆ†ä½ˆå¼é–æ”¯æŒå¯é‡å…¥</h1><p><br></p><p>ä¸Šé¢ä»‹ç´¹äº†ä¸€å€‹å®Œæ•´çš„åŸºæ–¼redisçš„åˆ†ä½ˆå¼é–pythonå¯¦ç¾ç‰ˆæœ¬å’Œæ€è·¯ï¼Œåœ¨å¯¦éš›å ´æ™¯ä¸­ï¼Œå°åŒä¸€å€‹ç·šç¨‹æˆ–è€…å”ç¨‹çš„åŒä¸€æŠŠé–éœ€è¦æ”¯æŒå¯é‡å…¥ï¼Œå¦‚éæ­¸èª¿ç”¨æ™‚ä¸ç™¼ç”Ÿæ­»é–ï¼Œä¸‹é¢å¯¦ç¾ç‰ˆæœ¬åœ¨ä¸Šè¿°çš„åˆ†ä½ˆå¼é–ä¸­é€²è¡Œäº†ç›¸é—œä»£ç¢¼ä¿®æ”¹ã€‚</p><pre><code>_request_store = threading.local()â€‹â€‹def _add_locker_info(lock_name, owner_uuid): Â  Â setattr(_request_store, lock_name, owner_uuid)â€‹â€‹def _get_locker_info(lock_name): Â  Â return getattr(_request_store, lock_name, None)â€‹â€‹class DistributedLock(object): Â  Â """ Â   This is not a 100% reliable distributed lock implementation. It is a try best one. Â   And this distributed lock algorithm is based on the time synchronization between Â   each node. Â   But it should be enough for our project. Â   """â€‹ Â  Â def __init__(self, lock_name, expire_time=3): Â  Â  Â  Â self.name = lock_name + '_distributed_lock' Â  Â  Â  Â self.expire_time = expire_time Â  Â  Â  Â self.uuid = str(uuid.uuid4())â€‹ Â  Â @redis_exc Â  Â def __enter__(self): Â  Â  Â  Â """ Â  Â  Â   If driver is not redis, nothing will happen. Â  Â  Â   """ Â  Â  Â  Â redis_conn = driver_manager.get_global_redis_conn() Â  Â  Â  Â while True: Â  Â  Â  Â  Â  Â if redis_conn.set(self.name, self.uuid, ex=self.expire_time*2, nx=True) == 1: Â  Â  Â  Â  Â  Â  Â  Â _add_locker_info(self.name, self.uuid) Â  Â  Â  Â  Â  Â  Â  Â LOG.debug('Get lock %s' % self.name) Â  Â  Â  Â  Â  Â  Â  Â break Â  Â  Â  Â  Â  Â if _get_locker_info(self.name): Â  Â  Â  Â  Â  Â  Â  Â LOG.debug('Get re-entrant lock %s' % self.name) Â  Â  Â  Â  Â  Â  Â  Â break Â  Â  Â  Â  Â  Â LOG.debug('Sleep 0.1s to try to get lock %s' % self.name) Â  Â  Â  Â  Â  Â time.sleep(0.1) Â  Â  Â  Â return selfâ€‹ Â  Â @redis_exc Â  Â def __exit__(self, exc_type, exc_val, exc_tb): Â  Â  Â  Â redis_conn = driver_manager.get_global_redis_conn() Â  Â  Â  Â owner_id = redis_conn.get(self.name) Â  Â  Â  Â if owner_id == self.uuid: Â  Â  Â  Â  Â  Â redis_conn.delete(self.name) Â  Â  Â  Â  Â  Â LOG.debug('Release lock %s' % self.name) Â  Â  Â  Â elif owner_id == _get_locker_info(self.name): Â  Â  Â  Â  Â  Â LOG.debug('Quit from re-entrant lock %s, do nothing ' % self.name) Â  Â  Â  Â else: Â  Â  Â  Â  Â  Â LOG.warning('Transaction locked by distributed lock %s need larger expire time' % self.name) Â  Â  Â  Â return</code></pre><p>python çš„threadlocalè®Šé‡å’ŒJavaä¸­é¡ä¼¼ï¼Œå°åŒä¸€å€‹ç·šç¨‹ä¸­çš„è®Šé‡é€²è¡Œéš”é›¢ï¼Œå› æ­¤å°å¯é‡å…¥é–çš„æ”¯æŒåªéœ€è¦åˆ¤æ–·ä¸‹ç•¶å‰ç·šç¨‹ä¸­æ˜¯å¦å·²ç¶“æœ‰é€™æŠŠé–ï¼Œå¦‚æœæœ‰ï¼Œå‰‡ç›´æ¥è¿”å›ï¼Œå¦å‰‡é€²è¡Œç­‰å¾…é–é‡‹æ”¾æˆ–è€…è¶…æ™‚ã€‚</p><p><br></p><h1 class=pgc-h-center-line>æ³¨æ„é»</h1><p><br></p><ul><li>threadlocalä¸­çš„å…§å­˜ä¸ä¸»å‹•é‡‹æ”¾ï¼Œæœƒä¸æœƒå…§å­˜æ´©æ¼ï¼Ÿ</li></ul><p>ä¸æœƒï¼Œå› ç‚ºæ¯å€‹ç·šç¨‹å°æ‡‰ä¸€å€‹å‰¯æœ¬å­—å…¸ï¼Œç•¶åœ¨è©²ç·šç¨‹ä¸­ ç²å–ã€è¨­ç½®ã€åˆªé™¤ ThreadLocalå°è±¡çš„å±¬æ€§æ™‚ï¼Œæœƒå…ˆé€šé_patchå‡½æ•¸ï¼Œå°‡ç·šç¨‹çš„å‰¯æœ¬å­—å…¸ï¼Œè¨­ç½®æˆThreadLocalå°è±¡çš„å±¬æ€§å­—å…¸ï¼Œç„¶å¾Œå°ThreadLocalå°è±¡çš„å±¬æ€§çš„æ“ä½œï¼Œå¯¦éš›ä¸Šå°±æ˜¯å°å‰¯æœ¬å­—å…¸çš„æ“ä½œã€‚ç•¶ç·šç¨‹çµæŸï¼Œç·šç¨‹å°è±¡è¢«éŠ·ç‡¬æ™‚ï¼Œå‰¯æœ¬å­—å…¸çš„å¼•ç”¨è¨ˆæ•¸ä¹Ÿæœƒéš¨ä¹‹æ¸›å°‘ï¼Œæœ€å¾Œè¢«GCæ‰ã€‚</p><ul><li>å¯é‡å…¥é–çš„counterè¨ˆæ•¸</li></ul><p>ä¸€èˆ¬çš„è¨­è¨ˆä¸­éƒ½æœƒå°å¯é‡å…¥é–ç¶­è­·ä¸€å€‹counterè¨ˆæ•¸ï¼Œä¹Ÿå°±æ˜¯åœ¨counterå°æ–¼ç­‰æ–¼0æ™‚é€²è¡Œé‡‹æ”¾ï¼Œç”±æ–¼è€ƒæ…®åˆ°è‡ªå¢è‡ªæ¸›æ“ä½œçš„éåŸå­æ€§ï¼Œæ²’æœ‰é€šécounterå€¼é€²è¡Œé–é‡‹æ”¾ï¼Œè€Œæ˜¯æ¡ç”¨èª°ä¸€é–‹å§‹å‰µå»ºé–ï¼Œå°±æœ€å¾Œåˆªé™¤é–ã€‚å¯é‡å…¥é–çš„å¤šæ¬¡é‡å…¥è¡¨ç¾ç‚ºå †æ£§ï¼Œå¾Œå…¥å…ˆå‡ºï¼Œä¹Ÿå°±æ˜¯èªªæœ‰ä¸€é–‹å§‹åŠ é–çš„å°è±¡é€²è¡Œé–åˆªé™¤å³å¯ã€‚</p><ul><li>é—œæ–¼threadlocalçš„ç·šç¨‹éš”é›¢</li></ul><p>å¾ˆå¤šæƒ…æ³ä¸‹éƒ½æ˜¯åœ¨åŒä¸€å€‹é€²ç¨‹ä¸­èµ·ä¸åŒçš„å”ç¨‹å»è™•ç†APIè«‹æ±‚ï¼Œä¹Ÿå°±æ˜¯èªªä¸åŒçš„APIè«‹æ±‚æ˜¯æœ‰å¯èƒ½åœ¨åŒä¸€å€‹ç·šç¨‹ä¸­çš„ï¼Œå¯¦éš›æ¸¬è©¦ä¹Ÿé©—è­‰äº†é€™ä¸€é»ã€‚å¦‚ä¸‹æ‰“å°çš„æ—¥èªŒï¼Œç¸½å…±æœ‰ä¸‰æ¬¡APIè«‹æ±‚ï¼Œä½†æ˜¯ç·šç¨‹è™Ÿæ˜¯ä¸€æ¨£çš„ã€‚</p><pre><code>classÂ DistributedLock(object):Â  Â """Â  This is not a 100% reliable distributed lock implementation. It is a try best one.Â  And this distributed lock algorithm is based on the time synchronization betweenÂ  each node.Â  But it should be enough for our project.Â  """Â  Â defÂ __init__(self,Â lock_name,Â expire_time=3):Â  Â  Â  Â self.nameÂ =Â lock_nameÂ +Â '_distributed_lock'Â  Â  Â  Â self.expire_timeÂ =Â expire_timeÂ  Â  Â  Â self.uuidÂ =Â str(uuid.uuid4())Â  Â @redis_excÂ  Â defÂ __enter__(self):Â  Â  Â  Â """Â  Â  Â  If driver is not redis, nothing will happen.Â  Â  Â  """Â  Â  Â  Â redis_connÂ =Â driver_manager.get_global_redis_conn()Â  Â  Â  Â whileÂ True:Â  Â  Â  Â  Â  Â ifÂ redis_conn.set(self.name,Â self.uuid,Â ex=self.expire_time*2,Â nx=True) ==Â 1:Â  Â  Â  Â  Â  Â  Â  Â LOG.debug('Get lock %s'Â %Â self.name)Â  Â  Â  Â  Â  Â  Â  Â breakÂ  Â  Â  Â  Â  Â LOG.debug('Sleep 0.1s to try to get lock %s'Â %Â self.name)Â  Â  Â  Â  Â  Â time.sleep(0.1)Â  Â  Â  Â returnÂ selfÂ  Â @redis_excÂ  Â defÂ __exit__(self,Â exc_type,Â exc_val,Â exc_tb):Â  Â  Â  Â redis_connÂ =Â driver_manager.get_global_redis_conn()Â  Â  Â  Â owner_idÂ =Â redis_conn.get(self.name)Â  Â  Â  Â ifÂ owner_idÂ ==Â self.uuid:Â  Â  Â  Â  Â  Â redis_conn.delete(self.name)Â  Â  Â  Â  Â  Â LOG.debug('Release lock %s'Â %Â self.name)Â  Â  Â  Â else:Â  Â  Â  Â  Â  Â LOG.warning('Transaction locked by distributed lock %s need larger expire time'Â %Â self.name)Â  Â  Â  Â return</code></pre><p>å¦‚æœå¾ç·šç¨‹å‡ºç™¼ï¼Œthreadlocalçš„è¡¨ç¾æ‡‰è©²æ˜¯åœ¨åŒä¸€å€‹ç·šç¨‹å…§æ•¸æ“šå…±äº«ï¼Œå¦‚æœæ²’æœ‰ä¸»å‹•åˆªé™¤æ•¸æ“šï¼Œå‰‡åœ¨ç·šç¨‹æ¶ˆäº¡æ™‚é‡‹æ”¾å…§å­˜ã€‚ç”±æ–¼åœ¨åŠ é–å’Œè§£é–æ™‚ä¸¦æ²’æœ‰ä¸»å‹•åˆªé™¤threadlocalä¸­çš„æ•¸æ“šï¼Œä¹Ÿå°±æ˜¯èªªåŒä¸€å€‹ç·šç¨‹ä¸­çš„æ•¸æ“šæ‡‰è©²æ˜¯æœƒç´¯åŠ çš„ï¼Œä½†æ˜¯å¯¦éš›ä¸Šæ²’æœ‰ï¼Œæ—¥èªŒå¦‚ä¸‹ï¼š</p><pre><code>2020-05-14 08:29:06.808 6745 DEBUG neutron.services.vpc.common.vpc_utils [req-7abbea26-d87b-4804-8003-36b723471c6e 0d1b6b9e31fa455cab2e865740ebd6e7 df68d52f6ce94bd7a152fc16d96fa6a8 - - -] show threadlocal :{'vif_42212f87-005c-c608-b043-14beb2214e9f_distributed_lock': '7ccfe267-6fce-4ada-9b88-c85de4da8f76', 'eip_59715e2f-a30e-46c8-9ee8-1f882e43e745_distributed_lock': '073547c0-53d1-477d-ae64-d41dfe992d5b'} _add_locker_info /opt/ksc_lbaas/.venv/lib/python2.7/site-packages/neutron/services/vpc/common/vpc_utils.py:1042020-05-14 08:29:10.006 6745 DEBUG neutron.services.vpc.common.vpc_utils [req-1570d840-244a-4373-b95e-03a799331e9a 0d1b6b9e31fa455cab2e865740ebd6e7 df68d52f6ce94bd7a152fc16d96fa6a8 - - -] show threadlocal :{'vif_42212f87-005c-c608-b043-14beb2214e9f_distributed_lock': 'c4a99ed2-9afd-452f-b24d-e0cbd37c331b'} _add_locker_info /opt/ksc_lbaas/.venv/lib/python2.7/site-packages/neutron/services/vpc/common/vpc_utils.py:1042020-05-14 08:29:10.122 6745 DEBUG neutron.services.vpc.common.vpc_utils [req-1570d840-244a-4373-b95e-03a799331e9a 0d1b6b9e31fa455cab2e865740ebd6e7 df68d52f6ce94bd7a152fc16d96fa6a8 - - -] show threadlocal :{'vif_42212f87-005c-c608-b043-14beb2214e9f_distributed_lock': 'c4a99ed2-9afd-452f-b24d-e0cbd37c331b', 'eip_59715e2f-a30e-46c8-9ee8-1f882e43e745_distributed_lock': '32eb9ab3-7e54-4439-bbd0-1ee183aac29d'} _add_locker_info /opt/ksc_lbaas/.venv/lib/python2.7/site-packages/neutron/services/vpc/common/vpc_utils.py:1042020-05-14 08:29:10.199 6745 DEBUG neutron.services.vpc.common.vpc_utils [req-1570d840-244a-4373-b95e-03a799331e9a 0d1b6b9e31fa455cab2e865740ebd6e7 df68d52f6ce94bd7a152fc16d96fa6a8 - - -] show threadlocal :{'e840a917-c2d5-414a-8ad1-a9965d654e12_vgw01_distributed_lock': 'b5b14883-9786-484a-860c-82a1a5672744', 'vif_42212f87-005c-c608-b043-14beb2214e9f_distributed_lock': 'c4a99ed2-9afd-452f-b24d-e0cbd37c331b', 'eip_59715e2f-a30e-46c8-9ee8-1f882e43e745_distributed_lock': '32eb9ab3-7e54-4439-bbd0-1ee183aac29d'} _add_locker_info /opt/ksc_lbaas/.venv/lib/python2.7/site-packages/neutron/services/vpc/common/vpc_utils.py:1042020-05-14 08:42:33.291 6745 DEBUG neutron.services.vpc.common.vpc_utils [req-4bfc56b5-c3db-4288-a1c3-a993bcf7a3a3 0d1b6b9e31fa455cab2e865740ebd6e7 df68d52f6ce94bd7a152fc16d96fa6a8 - - -] show threadlocal :{'vif_42212f87-005c-c608-b043-14beb2214e9f_distributed_lock': 'fa7ed1b1-a9dc-416b-8419-3043a1c92100'} _add_locker_info /opt/ksc_lbaas/.venv/lib/python2.7/site-packages/neutron/services/vpc/common/vpc_utils.py:1042020-05-14 08:42:33.424 6745 DEBUG neutron.services.vpc.common.vpc_utils [req-4bfc56b5-c3db-4288-a1c3-a993bcf7a3a3 0d1b6b9e31fa455cab2e865740ebd6e7 df68d52f6ce94bd7a152fc16d96fa6a8 - - -] show threadlocal :{'e840a917-c2d5-414a-8ad1-a9965d654e12_vgw01_distributed_lock': '67741a6a-b89b-4c7f-ad4e-9ae40455f20a', 'vif_42212f87-005c-c608-b043-14beb2214e9f_distributed_lock': 'fa7ed1b1-a9dc-416b-8419-3043a1c92100'} _add_locker_info /opt/ksc_lbaas/.venv/lib/python2.7/site-packages/neutron/services/vpc/common/vpc_utils.py:104</code></pre><p><strong>threadlocalå”ç¨‹éš”é›¢</strong></p><p>è¡¨ç¾çš„è¡Œç‚ºæ˜¯å”ç¨‹éš”é›¢ï¼Œä¹Ÿå°±æ˜¯èªªå…©å€‹APIè«‹æ±‚é›–ç„¶è™•æ–¼åŒä¸€å€‹ç·šç¨‹å…§ï¼Œä½†æ˜¯ä¸¦æ²’æœ‰å…±äº«threadlocalçš„æ•¸æ“šã€‚</p><p>é€šéå®šä½å¾Œç™¼ç¾åœ¨é …ç›®çš„eventletæ¨¡å¡Šä¸­å°é€šémonkey_patchæ–¹å¼å°åŸç”Ÿçš„threading.localé€²è¡Œäº†æ”¹å¯«ï¼Œåœ¨åŸç”Ÿçš„threading.local é€šéå¦‚ä¸‹çš„å‡½æ•¸ç²å–ç•¶å‰çš„ç·šç¨‹è™Ÿ</p><pre><code>def currentThread(): Â  Â """Return the current Thread object, corresponding to the caller's thread of control.â€‹ Â   If the caller's thread of control was not created through the threading Â   module, a dummy thread object with limited functionality is returned.â€‹ Â   """ Â  Â try: Â  Â  Â  Â return _active[_get_ident()] Â  Â except KeyError: Â  Â  Â  Â ##print "current_thread(): no current thread for", _get_ident() Â  Â  Â  Â return _DummyThread()# ç²å–ç·šç¨‹è™Ÿå‡½æ•¸ Â  Â  Â  Â _get_ident = thread.get_ident</code></pre><p>åœ¨eventletåº«ä¸­å°è©²å‡½æ•¸é€²è¡Œäº†æ”¹å¯«ï¼Œå‡½æ•¸currentThreadç²å–åˆ°çš„æ˜¯å”ç¨‹è™Ÿï¼Œå¦‚ä¸‹ï¼š</p><pre><code>def current_thread(): Â  Â g = greenlet.getcurrent() Â  Â if not g: Â  Â  Â  Â # Not currently in a greenthread, fall back to standard function Â  Â  Â  Â return _fixup_thread(__orig_threading.current_thread())â€‹ Â  Â try: Â  Â  Â  Â active = __threadlocal.active Â  Â except AttributeError: Â  Â  Â  Â active = __threadlocal.active = {}â€‹ Â  Â try: Â  Â  Â  Â t = active[id(g)] Â  Â except KeyError: Â  Â  Â  Â # Add green thread to active if we can clean it up on exit Â  Â  Â  Â def cleanup(g): Â  Â  Â  Â  Â  Â del active[id(g)] Â  Â  Â  Â try: Â  Â  Â  Â  Â  Â g.link(cleanup) Â  Â  Â  Â except AttributeError: Â  Â  Â  Â  Â  Â # Not a GreenThread type, so there's no way to hook into Â  Â  Â  Â  Â  Â # the green thread exiting. Fall back to the standard Â  Â  Â  Â  Â  Â # function then. Â  Â  Â  Â  Â  Â t = _fixup_thread(__orig_threading.currentThread()) Â  Â  Â  Â else: Â  Â  Â  Â  Â  Â t = active[id(g)] = _GreenThread(g)â€‹ Â  Â return t</code></pre><p>æœ€çµ‚èª¿ç”¨çš„å¦‚ä¸‹greenletåº«ä¸­çš„getcurrentç²å–ç•¶å‰å”ç¨‹æ¨™è­˜</p><pre><code> greenlet.getcurrent() ã€€ã€€Returns the current greenlet (i.e. the one which called this function).ã€€ã€€è¿”å›ç•¶å‰greenletï¼Œä¹Ÿå°±æ˜¯èª°åœ¨èª¿ç”¨é€™å€‹å‡½æ•¸ã€‚</code></pre><p>ç›¸é—œpatchå‡½æ•¸åœ¨/neutron/common/eventlet_utils.pyã€‚</p><p><br></p><h1 class=pgc-h-center-line>é™„éŒ„ï¼špython threading.RLockæºç¢¼</h1><p><br></p><pre><code>_allocate_lock = thread.allocate_lock_get_ident = thread.get_identLock = _allocate_lockâ€‹def RLock(*args, **kwargs): Â  Â """Factory function that returns a new reentrant lock.â€‹ Â   A reentrant lock must be released by the thread that acquired it. Once a Â   thread has acquired a reentrant lock, the same thread may acquire it again Â   without blocking; the thread must release it once for each time it has Â   acquired it.â€‹ Â   """ Â  Â return _RLock(*args, **kwargs)â€‹class _RLock(_Verbose): Â  Â """A reentrant lock must be released by the thread that acquired it. Once a Â  Â  Â  thread has acquired a reentrant lock, the same thread may acquire it Â  Â  Â  again without blocking; the thread must release it once for each time it Â  Â  Â  has acquired it. Â   """â€‹ Â  Â def __init__(self, verbose=None): Â  Â  Â  Â _Verbose.__init__(self, verbose) Â  Â  Â  Â self.__block = _allocate_lock() Â  Â  Â  Â self.__owner = None Â  Â  Â  Â self.__count = 0â€‹ Â  Â def __repr__(self): Â  Â  Â  Â owner = self.__owner Â  Â  Â  Â try: Â  Â  Â  Â  Â  Â owner = _active[owner].name Â  Â  Â  Â except KeyError: Â  Â  Â  Â  Â  Â pass Â  Â  Â  Â return "&lt;%s owner=%r count=%d&gt;" % ( Â  Â  Â  Â  Â  Â  Â  Â self.__class__.__name__, owner, self.__count)â€‹ Â  Â def acquire(self, blocking=1): Â  Â  Â  Â """Acquire a lock, blocking or non-blocking.â€‹ Â  Â  Â   When invoked without arguments: if this thread already owns the lock, Â  Â  Â   increment the recursion level by one, and return immediately. Otherwise, Â  Â  Â   if another thread owns the lock, block until the lock is unlocked. Once Â  Â  Â   the lock is unlocked (not owned by any thread), then grab ownership, set Â  Â  Â   the recursion level to one, and return. If more than one thread is Â  Â  Â   blocked waiting until the lock is unlocked, only one at a time will be Â  Â  Â   able to grab ownership of the lock. There is no return value in this Â  Â  Â   case.â€‹ Â  Â  Â   When invoked with the blocking argument set to true, do the same thing Â  Â  Â   as when called without arguments, and return true.â€‹ Â  Â  Â   When invoked with the blocking argument set to false, do not block. If a Â  Â  Â   call without an argument would block, return false immediately; Â  Â  Â   otherwise, do the same thing as when called without arguments, and Â  Â  Â   return true.â€‹ Â  Â  Â   """ Â  Â  Â  Â me = _get_ident() Â  Â  Â  Â if self.__owner == me: Â  Â  Â  Â  Â  Â self.__count = self.__count + 1 Â  Â  Â  Â  Â  Â if __debug__: Â  Â  Â  Â  Â  Â  Â  Â self._note("%s.acquire(%s): recursive success", self, blocking) Â  Â  Â  Â  Â  Â return 1 Â  Â  Â  Â rc = self.__block.acquire(blocking) Â  Â  Â  Â if rc: Â  Â  Â  Â  Â  Â self.__owner = me Â  Â  Â  Â  Â  Â self.__count = 1 Â  Â  Â  Â  Â  Â if __debug__: Â  Â  Â  Â  Â  Â  Â  Â self._note("%s.acquire(%s): initial success", self, blocking) Â  Â  Â  Â else: Â  Â  Â  Â  Â  Â if __debug__: Â  Â  Â  Â  Â  Â  Â  Â self._note("%s.acquire(%s): failure", self, blocking) Â  Â  Â  Â return rcâ€‹ Â  Â __enter__ = acquireâ€‹ Â  Â def release(self): Â  Â  Â  Â """Release a lock, decrementing the recursion level.â€‹ Â  Â  Â   If after the decrement it is zero, reset the lock to unlocked (not owned Â  Â  Â   by any thread), and if any other threads are blocked waiting for the Â  Â  Â   lock to become unlocked, allow exactly one of them to proceed. If after Â  Â  Â   the decrement the recursion level is still nonzero, the lock remains Â  Â  Â   locked and owned by the calling thread.â€‹ Â  Â  Â   Only call this method when the calling thread owns the lock. A Â  Â  Â   RuntimeError is raised if this method is called when the lock is Â  Â  Â   unlocked.â€‹ Â  Â  Â   There is no return value.â€‹ Â  Â  Â   """ Â  Â  Â  Â if self.__owner != _get_ident(): Â  Â  Â  Â  Â  Â raise RuntimeError("cannot release un-acquired lock") Â  Â  Â  Â self.__count = count = self.__count - 1 Â  Â  Â  Â if not count: Â  Â  Â  Â  Â  Â self.__owner = None Â  Â  Â  Â  Â  Â self.__block.release() Â  Â  Â  Â  Â  Â if __debug__: Â  Â  Â  Â  Â  Â  Â  Â self._note("%s.release(): final release", self) Â  Â  Â  Â else: Â  Â  Â  Â  Â  Â if __debug__: Â  Â  Â  Â  Â  Â  Â  Â self._note("%s.release(): non-final release", self)â€‹ Â  Â def __exit__(self, t, v, tb): Â  Â  Â  Â self.release()â€‹ Â  Â # Internal methods used by condition variablesâ€‹ Â  Â def _acquire_restore(self, count_owner): Â  Â  Â  Â count, owner = count_owner Â  Â  Â  Â self.__block.acquire() Â  Â  Â  Â self.__count = count Â  Â  Â  Â self.__owner = owner Â  Â  Â  Â if __debug__: Â  Â  Â  Â  Â  Â self._note("%s._acquire_restore()", self)â€‹ Â  Â def _release_save(self): Â  Â  Â  Â if __debug__: Â  Â  Â  Â  Â  Â self._note("%s._release_save()", self) Â  Â  Â  Â count = self.__count Â  Â  Â  Â self.__count = 0 Â  Â  Â  Â owner = self.__owner Â  Â  Â  Â self.__owner = None Â  Â  Â  Â self.__block.release() Â  Â  Â  Â return (count, owner)â€‹ Â  Â def _is_owned(self): Â  Â  Â  Â return self.__owner == _get_ident()</code></pre><p><br></p><ul><li>ç°¡å–®åˆ†æ</li></ul><p>pythonæºç¢¼ä¸­çš„å¯é‡å…¥é–ç›¸å°ç°¡å–®ï¼ŒåŠ é–éƒ¨åˆ†ï¼Œç¬¬ä¸€æ¬¡ç²å–é–æ™‚ä¿å­˜é–çš„ç·šç¨‹æ¨™è­˜ï¼Œå¾ŒçºŒå†æ¬¡ç²å–é–ï¼Œå…ˆçœ‹æ˜¯å¦æ˜¯åŒä¸€å€‹ç·šç¨‹ï¼Œå¦‚æœæ˜¯çš„è©±åªå°é–è¨ˆæ•¸é€²è¡Œéå¢ã€‚è§£é–æ™‚ï¼Œå°é–è¨ˆæ•¸é€²è¡Œéæ¸›ï¼Œå¦‚æœè¨ˆæ•¸ç‚º0ï¼Œæœ€çµ‚é‡‹æ”¾é–ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯éœ€è¦å…ˆåˆå§‹åŒ–é¡ï¼Œå¾ŒçºŒåŠ é–è§£é–éƒ½æ‡‰ä½¿ç”¨åŒä¸€å€‹å°è±¡ï¼Œè€Œä¸èƒ½æ¯æ¬¡åŠ é–å’Œè§£é–ä½¿ç”¨æ–°çš„RLockå°è±¡ï¼Œé€™æ¨£æœƒå°è‡´ownerä¿¡æ¯å’Œcountä¿¡æ¯æ²’æœ‰åˆå§‹åŒ–ã€‚é€™å€‹å•é¡Œæœ¬è³ªä¸Šæ˜¯ç·šç¨‹è®Šé‡åŒæ­¥çš„å•é¡Œã€‚</p><p><br></p><h1 class=pgc-h-center-line>åƒè€ƒæ–‡æª”</h1><ul><li>https://www.cnblogs.com/linjiqin/p/8003838.html</li><li>https://segmentfault.com/a/1190000021199037</li><li>https://github.com/yangfeixxx/python_redis</li><li>https://leaveslm.github.io/2018/08/08/2018-2018-08-08-åŸºæ–¼-Redis-å¯¦ç¾å¯é‡å…¥åˆ†ä½ˆå¼é–/</li><li>https://www.cnblogs.com/xybaby/p/6420873.html</li></ul><p><br></p><div class=pgc-img><img alt=ä½ çš„redisåˆ†ä½ˆå¼å¯é‡å…¥é–æ˜¯æ€éº¼è¨­è¨ˆçš„(pythonå¯¦ç¾ï¼‰ onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/19325eb39de0464e81ae82d3555d1126><p class=pgc-img-caption>é—œæ–¼å¾®ä¿¡æœ‰æ›´å¤šç²¾å½©</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>redis</a></li><li><a>é‡å…¥é–</a></li><li><a>æ€éº¼</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/2146c4b1.html alt=éœ²å¤©æ¨“æ¢¯é›¨æ£šæ€éº¼åš class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/R6XWzD87AaIs0W style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2146c4b1.html title=éœ²å¤©æ¨“æ¢¯é›¨æ£šæ€éº¼åš>éœ²å¤©æ¨“æ¢¯é›¨æ£šæ€éº¼åš</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3a2e003a.html alt=ä½ æ˜¯æ€éº¼èªè­˜æ›¼æ©çš„ï¼Ÿåœ¨è€è·¯èªªè»Šäº’å‹•å¹³è‡ºæ„Ÿå—æ›¼æ©é­…åŠ› class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/cc30aa4b32114cb7aa98314ba1519473 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3a2e003a.html title=ä½ æ˜¯æ€éº¼èªè­˜æ›¼æ©çš„ï¼Ÿåœ¨è€è·¯èªªè»Šäº’å‹•å¹³è‡ºæ„Ÿå—æ›¼æ©é­…åŠ›>ä½ æ˜¯æ€éº¼èªè­˜æ›¼æ©çš„ï¼Ÿåœ¨è€è·¯èªªè»Šäº’å‹•å¹³è‡ºæ„Ÿå—æ›¼æ©é­…åŠ›</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f24146de.html alt=æ€éº¼ç§Ÿç”¨æœå‹™å™¨ï¼Œå“ªç¨®å»ºç«™æœ€å¥½ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/52874987-e2c8-4404-99f4-38f53bad4aec style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f24146de.html title=æ€éº¼ç§Ÿç”¨æœå‹™å™¨ï¼Œå“ªç¨®å»ºç«™æœ€å¥½ï¼Ÿ>æ€éº¼ç§Ÿç”¨æœå‹™å™¨ï¼Œå“ªç¨®å»ºç«™æœ€å¥½ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6b4b1f22.html alt=ç„¡äººæ©Ÿæ€éº¼åšæ¸¬ç¹ªï¼Ÿæ‰‹æŠŠæ‰‹æ•™ä½ é«˜ç²¾åº¦åœ°åœ–å’Œæ•¸å­—ç·šç•«åœ–çš„å…·é«”æ“ä½œ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/479ff6260a5545549cb39946a5cbbd91 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6b4b1f22.html title=ç„¡äººæ©Ÿæ€éº¼åšæ¸¬ç¹ªï¼Ÿæ‰‹æŠŠæ‰‹æ•™ä½ é«˜ç²¾åº¦åœ°åœ–å’Œæ•¸å­—ç·šç•«åœ–çš„å…·é«”æ“ä½œ>ç„¡äººæ©Ÿæ€éº¼åšæ¸¬ç¹ªï¼Ÿæ‰‹æŠŠæ‰‹æ•™ä½ é«˜ç²¾åº¦åœ°åœ–å’Œæ•¸å­—ç·šç•«åœ–çš„å…·é«”æ“ä½œ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e0c52137.html alt=ä½œæ–‡è£¡é¢æ€éº¼é€²è¡Œå ´é¢æå¯«ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/230976bf-ee1d-44c0-8ce9-4a4714b8ad40 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e0c52137.html title=ä½œæ–‡è£¡é¢æ€éº¼é€²è¡Œå ´é¢æå¯«ï¼Ÿ>ä½œæ–‡è£¡é¢æ€éº¼é€²è¡Œå ´é¢æå¯«ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/40568794.html alt=æ‰‹æ©Ÿæ¥æ”¶ä¸åˆ°é©—è­‰ç¢¼æ€éº¼è¾¦ï¼Ÿæ•™ä½ å¿«é€Ÿè§£æ±ºï¼Œå­¸æœƒä»¥å‚™ä¸æ™‚ä¹‹éœ€ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5edf6bf6494e4d2799657427beba8616 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/40568794.html title=æ‰‹æ©Ÿæ¥æ”¶ä¸åˆ°é©—è­‰ç¢¼æ€éº¼è¾¦ï¼Ÿæ•™ä½ å¿«é€Ÿè§£æ±ºï¼Œå­¸æœƒä»¥å‚™ä¸æ™‚ä¹‹éœ€>æ‰‹æ©Ÿæ¥æ”¶ä¸åˆ°é©—è­‰ç¢¼æ€éº¼è¾¦ï¼Ÿæ•™ä½ å¿«é€Ÿè§£æ±ºï¼Œå­¸æœƒä»¥å‚™ä¸æ™‚ä¹‹éœ€</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ed39a73b.html alt=æ‰‹æ©Ÿæ”¶ä¸åˆ°çŸ­ä¿¡æ€éº¼å›äº‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/4c867ab694d54b19954e5777769cc540 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ed39a73b.html title=æ‰‹æ©Ÿæ”¶ä¸åˆ°çŸ­ä¿¡æ€éº¼å›äº‹>æ‰‹æ©Ÿæ”¶ä¸åˆ°çŸ­ä¿¡æ€éº¼å›äº‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7a0039e6.html alt=æ‰‹æ©Ÿæ”¶ä¸åˆ°çŸ­ä¿¡é©—è­‰ç¢¼æ€éº¼å›äº‹ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/7cd7583238d44cfeb3be6147f9417125 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7a0039e6.html title=æ‰‹æ©Ÿæ”¶ä¸åˆ°çŸ­ä¿¡é©—è­‰ç¢¼æ€éº¼å›äº‹ï¼Ÿ>æ‰‹æ©Ÿæ”¶ä¸åˆ°çŸ­ä¿¡é©—è­‰ç¢¼æ€éº¼å›äº‹ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b61d16fd.html alt=æ‰‹æ©Ÿç¶“å¸¸æ”¶ä¸åˆ°æ¶ˆæ¯æ˜¯æ€éº¼å›äº‹ï¼Ÿçœ‹å®Œä½ å°±çŸ¥é“æ€éº¼æ˜¯ä»€éº¼åŸå› äº†ï¼ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/53f300040692811299c9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b61d16fd.html title=æ‰‹æ©Ÿç¶“å¸¸æ”¶ä¸åˆ°æ¶ˆæ¯æ˜¯æ€éº¼å›äº‹ï¼Ÿçœ‹å®Œä½ å°±çŸ¥é“æ€éº¼æ˜¯ä»€éº¼åŸå› äº†ï¼>æ‰‹æ©Ÿç¶“å¸¸æ”¶ä¸åˆ°æ¶ˆæ¯æ˜¯æ€éº¼å›äº‹ï¼Ÿçœ‹å®Œä½ å°±çŸ¥é“æ€éº¼æ˜¯ä»€éº¼åŸå› äº†ï¼</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c9f02601.html alt=æ•™ä½ æ€éº¼è¨ˆç®—å…‰æ¨¡å¡Šå’Œå…‰çº–è·³ç·šæ•¸é‡ï¼Œå­¸æœƒé€™å€‹æ–¹æ³•ï¼Œä»¥å¾Œä¸æ±‚äºº class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1bb69fa9b57247babf32efd4a040a7f3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c9f02601.html title=æ•™ä½ æ€éº¼è¨ˆç®—å…‰æ¨¡å¡Šå’Œå…‰çº–è·³ç·šæ•¸é‡ï¼Œå­¸æœƒé€™å€‹æ–¹æ³•ï¼Œä»¥å¾Œä¸æ±‚äºº>æ•™ä½ æ€éº¼è¨ˆç®—å…‰æ¨¡å¡Šå’Œå…‰çº–è·³ç·šæ•¸é‡ï¼Œå­¸æœƒé€™å€‹æ–¹æ³•ï¼Œä»¥å¾Œä¸æ±‚äºº</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/135c11db.html alt=çŸ¥é“æ‰‹æ©ŸåŸºç«™æ˜¯æ€éº¼å®‰è£çš„å—ï¼Ÿå·¥è—æœ‰å“ªäº›è¦æ±‚ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3dc892aae9c74d6a80d6579347b13473 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/135c11db.html title=çŸ¥é“æ‰‹æ©ŸåŸºç«™æ˜¯æ€éº¼å®‰è£çš„å—ï¼Ÿå·¥è—æœ‰å“ªäº›è¦æ±‚>çŸ¥é“æ‰‹æ©ŸåŸºç«™æ˜¯æ€éº¼å®‰è£çš„å—ï¼Ÿå·¥è—æœ‰å“ªäº›è¦æ±‚</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1d3b415c.html alt="æ‹›è¡ŒæŒä¸Šç”Ÿæ´»æ€éº¼é ˜å–é¦–åˆ·ç¦®æŠ€å·§ é ˜é¦–åˆ·ç¦®æ¢ä»¶æµç¨‹" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/Rh68nYy2e9LgVS style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1d3b415c.html title="æ‹›è¡ŒæŒä¸Šç”Ÿæ´»æ€éº¼é ˜å–é¦–åˆ·ç¦®æŠ€å·§ é ˜é¦–åˆ·ç¦®æ¢ä»¶æµç¨‹">æ‹›è¡ŒæŒä¸Šç”Ÿæ´»æ€éº¼é ˜å–é¦–åˆ·ç¦®æŠ€å·§ é ˜é¦–åˆ·ç¦®æ¢ä»¶æµç¨‹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/81acd6e9.html alt="æŒä¸Šç”Ÿæ´»æ€éº¼é ˜å–æ‹‰æ¡¿ç®± æ”¯æŒé¦–åˆ·ç¦®æ‹‰æ¡¿ç®±å¡ç¨®" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/Rh68nYy2e9LgVS style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/81acd6e9.html title="æŒä¸Šç”Ÿæ´»æ€éº¼é ˜å–æ‹‰æ¡¿ç®± æ”¯æŒé¦–åˆ·ç¦®æ‹‰æ¡¿ç®±å¡ç¨®">æŒä¸Šç”Ÿæ´»æ€éº¼é ˜å–æ‹‰æ¡¿ç®± æ”¯æŒé¦–åˆ·ç¦®æ‹‰æ¡¿ç®±å¡ç¨®</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c90e11f6.html alt=ã€Œç­è§£ã€æˆ¿å±‹çš„å±¤é«˜å’Œæ·¨é«˜æ€éº¼ç®—ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1526054178152a496189726 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c90e11f6.html title=ã€Œç­è§£ã€æˆ¿å±‹çš„å±¤é«˜å’Œæ·¨é«˜æ€éº¼ç®—ï¼Ÿ>ã€Œç­è§£ã€æˆ¿å±‹çš„å±¤é«˜å’Œæ·¨é«˜æ€éº¼ç®—ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/96fad265.html alt=æ¨“æˆ¿çš„å±¤é«˜å’Œæ·¨é«˜æ˜¯æ€éº¼å›äº‹ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/96fad265.html title=æ¨“æˆ¿çš„å±¤é«˜å’Œæ·¨é«˜æ˜¯æ€éº¼å›äº‹>æ¨“æˆ¿çš„å±¤é«˜å’Œæ·¨é«˜æ˜¯æ€éº¼å›äº‹</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>