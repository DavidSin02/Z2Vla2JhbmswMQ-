<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>使用了這麼久的lombok，你知道它的原理嗎 | 极客快訊</title><meta property="og:title" content="使用了這麼久的lombok，你知道它的原理嗎 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/dcdf280face24dc1b73c4cab6b87c280"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/da044c0.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/da044c0.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/da044c0.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/da044c0.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/da044c0.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/da044c0.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/da044c0.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/da044c0.html><meta property="article:published_time" content="2020-10-29T20:50:13+08:00"><meta property="article:modified_time" content="2020-10-29T20:50:13+08:00"><meta name=Keywords content><meta name=description content="使用了這麼久的lombok，你知道它的原理嗎"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/da044c0.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>使用了這麼久的lombok，你知道它的原理嗎</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>在日常的Java開發中，最常見的就是Javabean對象，常常一個對象中有很多，私有屬性，我們需要進行setter和getter的操作，如下</p><pre><code>public class Student {        private Integer id;        private String name;        private Integer age;        private Integer sex;        private String address;        private Float score;    public Integer getId() {        return id;    }    public void setId(Integer id) {        this.id = id;    }    public String getName() {        return name;    }    public void setName(String name) {        this.name = name;    }    public Integer getAge() {        return age;    }    public void setAge(Integer age) {        this.age = age;    }    public Integer getSex() {        return sex;    }    public void setSex(Integer sex) {        this.sex = sex;    }    public String getAddress() {        return address;    }    public void setAddress(String address) {        this.address = address;    }    public Float getScore() {        return score;    }    public void setScore(Float score) {        this.score = score;    }}</code></pre><p>這樣的代碼，顯得很臃腫，尤其是當我們再添加屬性，或者修改屬性名稱時，都需要手動更改或新增setter和getter方法，維護起來比較麻煩，因此很多開發者在日常使用過程中，都使用lombok工具來簡化相關代碼，代碼如下</p><pre><code>@Datapublic class Student {    private Integer id;    private String name;    private Integer age;    private Integer sex;    private String address;    private Float score;}</code></pre><h1 class=pgc-h-arrow-right>lombok工具常見使用方法</h1><p>以idea舉例，我們使用lombok首先需要安裝lombok插件，如下圖</p><div class=pgc-img><img alt=使用了這麼久的lombok，你知道它的原理嗎 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/dcdf280face24dc1b73c4cab6b87c280><p class=pgc-img-caption></p></div><p>然後在使用的項目中引入依賴（以maven舉例）</p><pre><code>&lt;dependency&gt;    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;    &lt;artifactId&gt;lombok&lt;/artifactId&gt;    &lt;version&gt;1.18.12&lt;/version&gt;    &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;</code></pre><p>接下來我們就可以使用lombok工具提供的註解功能，進行開發。下面對常見的lombok工具註解進行介紹：</p><pre><code>@Getter // 生成getter方法@Setter // 生成setter方法@ToString // 自動重寫 toString() 方法，會印出所有變量@EqualsAndHashCode // 自動生成equals和hashcode方法@NoArgsConstructor // 生成一個沒有參數的構造器@AllArgsConstructor // 生成一個包含所有參數的構造器@RequiredArgsConstructor // 生成一個包含 "特定參數" 的構造器（特定參數指的是那些有加上 final 修飾詞的變量們）@Data //這個註解，等於同時加了@Getter、@Setter、@ToString、@EqualsAndHashCode、@RequiredArgsConstructor註解@Builder // 自動生成流式 set 值寫法@Slf4j //自動生成該類的 log 靜態常量，直接通過log寫日</code></pre><p>如下圖</p><div class=pgc-img><img alt=使用了這麼久的lombok，你知道它的原理嗎 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e4c387f38d414053bf4c723e0dfcbdf2><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>為什麼使用了註解就可以做到這些功能？</h1><p>對於代碼增強，一般有兩種方式，一種運行時增強，例如spring的aop，在運行時，對代碼做功能增強；另一種是編譯器增強，即編譯時，通過字節碼技術，將相應的代碼植入到class中，lombok就採用兩編譯器增強。</p><p>上面我們對student這個類，加入@Data註解，編譯後，我們查看下class文件，發現getter方法、setter方法、tostring方法等都寫了相關代碼，如下圖</p><div class=pgc-img><img alt=使用了這麼久的lombok，你知道它的原理嗎 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/8e15723b825e4e7cb347dc8b738f23df><p class=pgc-img-caption></p></div><div class=pgc-img><img alt=使用了這麼久的lombok，你知道它的原理嗎 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9a0fd9af56ab4690847fd27bbb14b3b8><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>原理</h1><p>針對運行期增強，一般基於動態代理、反射技術實現，性能相對損耗大；編譯器增強，一般基於<span style="color:#404040;--tt-darkmode-color: #A3A3A3">Annotation Processing Tool（APT技術在JDK8中已經徹底刪除）以及Pluggable Annotation Processing API技術。</span></p><p><span style="color:#404040;--tt-darkmode-color: #A3A3A3">因此我們主要看看Pluggable Annotation Processing API技術，</span>自從Java 6起，javac就支持“JSR 269 Pluggable Annotation Processing API”規範，只要程序實現了該API，就能在javac運行的時候得到調用。</p><p>插件化註解處理API的使用步驟大概如下：</p><pre><code>1、自定義一個Annotation Processor，需要繼承javax.annotation.processing.AbstractProcessor，並覆寫process方法。2、自定義一個註解，註解的元註解需要指定@Retention(RetentionPolicy.SOURCE)。3、需要在聲明的自定義Annotation Processor中使用javax.annotation.processing.SupportedAnnotationTypes指定在第2步創建的註解類型的名稱(注意需要全類名，"包名.註解類型名稱"，否則會不生效)。4、需要在聲明的自定義Annotation Processor中使用javax.annotation.processing.SupportedSourceVersion指定編譯版本。5、可選操作，可以通在聲明的自定義Annotation Processor中使用javax.annotation.processing.SupportedOptions指定編譯參數。6、通過服務註冊指定，META-INF/services/javax.annotation.processing.Processor文件中添加 前面定義AnnotationProcessor</code></pre><p>下面我們按照上面步驟來演示一下：</p><p>自定義註解解析器（此處可以通過asm字節碼技術寫入新方法等，本文不介紹字節碼技術，有興趣的可以研究）</p><pre><code>@SupportedAnnotationTypes(value = {"com.example.demo.plugin.Demo"})@SupportedSourceVersion(value = SourceVersion.RELEASE_8)public class AnnotationProcessor extends AbstractProcessor {    @Override    public boolean process(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv) {        System.out.println("Log in AnnotationProcessor.process");        for (TypeElement typeElement : annotations) {            System.out.println(typeElement);        }        System.out.println(roundEnv);        return true;    }}</code></pre><p>自定義註解</p><pre><code>@Retention(RetentionPolicy.SOURCE)@Target(ElementType.TYPE)public @interface Demo {}</code></pre><p>使用spi注入註解解析器</p><div class=pgc-img><img alt=使用了這麼久的lombok，你知道它的原理嗎 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fc897a2d98284f1da04bd3ce5cf9c7c9><p class=pgc-img-caption></p></div><p>使用註解</p><div class=pgc-img><img alt=使用了這麼久的lombok，你知道它的原理嗎 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b21e9829546f45a48faba5ac45162af9><p class=pgc-img-caption></p></div><p>編寫測試用例</p><pre><code>public class App {    public static void main( String[] args )    {        System.out.println( "Hello World!" );        Student student = new Student();    }}</code></pre><p>運行結果如下，<strong>可以看到</strong><strong>編譯期</strong><strong>AnnotationProcessor生效了</strong></p><pre><code>Log in AnnotationProcessor.processcom.example.Demo[errorRaised=false, rootElements=[com.example.Demo, com.example.App, com.example.Student], processingOver=false]Log in AnnotationProcessor.process[errorRaised=false, rootElements=[], processingOver=true]</code></pre><p>注意：如果出現下列報錯，可以將AnnotationProcessor先編譯，或者放到jar中即可。</p><pre><code>[ERROR] Bad service configuration file, or exception thrown whileconstructing Processor object: javax.annotation.processing.Processor: Provider com.example.demo.plugin.AnnotationProcessor not found</code></pre><p><strong>Lombok便是通過Pluggable Annotation Processing API來實現代碼生成的。</strong></p><p>根據上面的原理，我們查看下lombok源碼，發現的確如此</p><div class=pgc-img><img alt=使用了這麼久的lombok，你知道它的原理嗎 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/d3df2e4c0a5b491194f61fd31088c710><p class=pgc-img-caption></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>這麼</a></li><li><a>lombok</a></li><li><a>原理</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/4adca96d.html alt=不鏽鋼旋轉樓梯—不鏽鋼旋轉樓梯的原理和尺寸介紹 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1532917894689e20edadba9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4adca96d.html title=不鏽鋼旋轉樓梯—不鏽鋼旋轉樓梯的原理和尺寸介紹>不鏽鋼旋轉樓梯—不鏽鋼旋轉樓梯的原理和尺寸介紹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7bd06eba.html alt=超震撼的歐美公鐵兩用車，沒想到有這麼多用途 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2a8d17dd47ec44dcb46bb714e4fc4b3f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7bd06eba.html title=超震撼的歐美公鐵兩用車，沒想到有這麼多用途>超震撼的歐美公鐵兩用車，沒想到有這麼多用途</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/798c35eb.html alt=鼠標滾輪工作原理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a32f01002df34196a3ca95824a0705c9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/798c35eb.html title=鼠標滾輪工作原理>鼠標滾輪工作原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0fe7a863.html alt=土壤採樣器的工作原理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/3591b04ce0ef4b24b7f04dcf6d4f0e5a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0fe7a863.html title=土壤採樣器的工作原理>土壤採樣器的工作原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9e2d615f.html alt=流浪了這麼多年，我最後還是死了…… class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/SGEhDSs4csHp0N style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9e2d615f.html title=流浪了這麼多年，我最後還是死了……>流浪了這麼多年，我最後還是死了……</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/998130e4.html alt=聽了這麼久的拳擊，知道這些嗎 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/434b00023ddd03d0223a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/998130e4.html title=聽了這麼久的拳擊，知道這些嗎>聽了這麼久的拳擊，知道這些嗎</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/10196651.html alt=高層住宅這麼密，冬天能有日照嗎？國家規定日照最少要多長時間？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/6079ee8f-c9f6-45a6-befe-4d89e9f9ecdc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/10196651.html title=高層住宅這麼密，冬天能有日照嗎？國家規定日照最少要多長時間？>高層住宅這麼密，冬天能有日照嗎？國家規定日照最少要多長時間？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bd7a84b7.html alt=鑑別被追尾車就是這麼簡單！這4個方法你都瞭解嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a51a16723af8485ab69705c547ea4fd8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bd7a84b7.html title=鑑別被追尾車就是這麼簡單！這4個方法你都瞭解嗎？>鑑別被追尾車就是這麼簡單！這4個方法你都瞭解嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a2071e8e.html alt=磚混結構施工方案，自建房就該這麼幹 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5f8e058930504f6187918f035fcdae38 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a2071e8e.html title=磚混結構施工方案，自建房就該這麼幹>磚混結構施工方案，自建房就該這麼幹</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/edc7ccb7.html alt=九齒釘耙擁有這麼多強大功能，八戒為何從不展示？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/c7de69f4b84443989183f933a2ecfe66 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/edc7ccb7.html title=九齒釘耙擁有這麼多強大功能，八戒為何從不展示？>九齒釘耙擁有這麼多強大功能，八戒為何從不展示？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1afbb1e9.html alt=全世界最短高速公路，耗資3.4萬，長度竟這麼短，司機：限速嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d93d0777370447dfa68b6f0cfabbce6d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1afbb1e9.html title=全世界最短高速公路，耗資3.4萬，長度竟這麼短，司機：限速嗎？>全世界最短高速公路，耗資3.4萬，長度竟這麼短，司機：限速嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a1ff65af.html alt=SUMIF函數還可以這麼用？Excel多列求和技巧分享 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/365914e7fd834f4db9c1708941a54153 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a1ff65af.html title=SUMIF函數還可以這麼用？Excel多列求和技巧分享>SUMIF函數還可以這麼用？Excel多列求和技巧分享</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1c9afde0.html alt="一起來談談ThreadLocal 原理吧！你需要了解！" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/499a403f2b63464db8e3e12298c1a3e5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1c9afde0.html title="一起來談談ThreadLocal 原理吧！你需要了解！">一起來談談ThreadLocal 原理吧！你需要了解！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/164e69c4.html alt=定了！蕭山的村級班子要這麼選！可一票否決、推進“一肩挑”、後備有年齡要求…… class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/R69kBo0BbZoONc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/164e69c4.html title=定了！蕭山的村級班子要這麼選！可一票否決、推進“一肩挑”、後備有年齡要求……>定了！蕭山的村級班子要這麼選！可一票否決、推進“一肩挑”、後備有年齡要求……</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/db7606e8.html alt=中美高中差異分析：差距咋就這麼大吶？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/096326f612d14693b6bc8f2234bcddeb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/db7606e8.html title=中美高中差異分析：差距咋就這麼大吶？>中美高中差異分析：差距咋就這麼大吶？</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>