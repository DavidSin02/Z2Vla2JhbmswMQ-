<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>c#之控制反轉（IOC）和依賴注入（DI）的理解 | 极客快訊</title><meta property="og:title" content="c#之控制反轉（IOC）和依賴注入（DI）的理解 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/de6a4652835d4ec3b2afdaa7a1a03c75"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dad185f1.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dad185f1.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/dad185f1.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dad185f1.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dad185f1.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/dad185f1.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/dad185f1.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dad185f1.html><meta property="article:published_time" content="2020-11-14T21:04:04+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:04+08:00"><meta name=Keywords content><meta name=description content="c#之控制反轉（IOC）和依賴注入（DI）的理解"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/dad185f1.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>c#之控制反轉（IOC）和依賴注入（DI）的理解</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p>這兩個東西曾經困擾很多新手朋友，下面就給大家詳細介紹一下！</p><h1 class=pgc-h-arrow-right>首先說控制反轉（IOC）</h1><p>控制反轉不是一種技術，只是一種思想，一個重要的面向對象編程的法則，它能指導我們如何設計出鬆耦合、更優良的程序。</p><p>其實IoC對編程帶來的最大改變不是從代碼上，而是從思想上，發生了“主從換位”的變化。應用程序原本是老大，要獲取什麼資源都是主動出擊自己去找，但是在IoC思想中，應用程序就變成被動的了，被動的等待調用方來創建並注入它所需要的資源了。</p><p>簡單的說就是：“<strong>別找我們，我們找你</strong>”；</p><p>下面用一個簡單的例子來講解讓大家更容易理解。</p><p>下面是一段演示代碼：</p><p><br></p><div class=pgc-img><img alt=c#之控制反轉（IOC）和依賴注入（DI）的理解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/de6a4652835d4ec3b2afdaa7a1a03c75><p class=pgc-img-caption></p></div><p>在shop類中， Log4NetServices是一個日誌類，_logServices直通過new Log4NetServices()實例化，日誌記錄會自動保存數據庫中。</p><p>現在問題來了，領導要求日誌要到文件中去，兩種解決辦法：</p><p>1、修改shop類。</p><pre><code>_logServices=new FileLogServices()</code></pre><p>這樣改有下面幾個問題。</p><p>1.1、後續如果要改為數據庫保存日誌，又要去改shop類。</p><p>1.2、如果有的日誌要保存數據庫，有的日誌要保存在文件，也要修改shop類。</p><p>當一個類會出現類似的需求的時候，我們就需要用到這個依賴注入這個思想。就是_logServices由誰來實例化，不要在shop中來定義，而是由調用方來實現。</p><p>改進後的代碼如下：</p><p><br></p><div class=pgc-img><img alt=c#之控制反轉（IOC）和依賴注入（DI）的理解 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/188aaac3b9fa497c92d8607f17e89349><p class=pgc-img-caption></p></div><p>在shop類中，_logServices只是一個ILogServices接口，沒有具體的實現，由調用方來實現。</p><p>通過上面改進，就可以實現靈活的擴展，對於不復雜的應用，這種改進已經足夠用了，但是有一天程序越來越龐大，參與的人越來越多的時候，就會出現下面的問題：</p><p>1、參與的人多了，每個人調用時候都一個個的new。</p><p>2、ILogServices出現更多的實現（如保存成excle，保存為txt，保存到緩存等等），也就是種類多了，調用方需要一個一個的new。</p><p>當業務變龐大以後，架構師就要考慮這個問題，能不能new統一起來管理，需要的人統一從一個固定的地方獲取呢？</p><p>然後依賴注入框架出現了。</p><h1 class=pgc-h-arrow-right>DI依賴注入（Dependency Injection）</h1><p>網上有很多描述，我自己都看的雲裡霧裡的，最後也不知道說什麼，下面用我的話來總結：</p><p>類和類之間依賴關係由容器在運行期決定，形象的說，即由容器動態的將某個依賴關係注入到類之中。依賴注入的目的並非為軟件系統帶來更多功能，而是為了提升組件重用的頻率。</p><p>簡單的說就是：“誰依賴誰，為什麼需要依賴，誰注入誰，注入了什麼”</p><p>●誰依賴於誰：當然是應用程序依賴於IoC容器；</p><p>●為什麼需要依賴：應用程序需要IoC容器來提供對象需要的外部資源；</p><p>●誰注入誰：很明顯是IoC容器注入應用程序某個對象，應用程序依賴的對象；</p><p>●注入了什麼：就是注入某個對象所需要的外部資源（包括對象、資源、常量數據）。</p><p>IoC和DI由什麼關係呢？其實它們是同一個概念的不同角度描述，由於控制反轉概念比較含糊（可能只是理解為容器控制對象這一個層面，很難讓人想到誰來維護對象關係），所以2004年大師級人物Martin Fowler又給出了一個新的名字：“依賴注入”，相對IoC 而言，“依賴注入”明確描述了“被注入對象依賴IoC容器配置依賴對象”。</p><p>目前有很多成熟的IOC框架，如unity和Auotfac，這兩個框架網上都有詳細的使用配置教程，這裡就不講解了。因為在在NetCore後，框架已經可通過ServiceProvider類和ServiceCollection類實現依賴注入，代碼如下：</p><div class=pgc-img><img alt=c#之控制反轉（IOC）和依賴注入（DI）的理解 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/551a2489a0094e6c9cd7666513c25d48><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>總結</h1><p>使用IoC對於複雜的項目來說，非常有意義，能夠為我們搭建一個好的開發層次。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>c#</a></li><li><a>反轉</a></li><li><a>IOC</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/04bb3d55.html alt=面向接口編程對控制反轉IOC的理解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/941fa6e7-5f39-4dfc-a429-db206117543b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/04bb3d55.html title=面向接口編程對控制反轉IOC的理解>面向接口編程對控制反轉IOC的理解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5820f543.html alt=反轉、反轉、再反轉，這部小成本電影，讓我看到了港片的“復活” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/32d34aea941c4085bf45d7a02cc37bcb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5820f543.html title=反轉、反轉、再反轉，這部小成本電影，讓我看到了港片的“復活”>反轉、反轉、再反轉，這部小成本電影，讓我看到了港片的“復活”</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c5f23ac4.html alt=高分神片：騙中騙！局中局!反轉反轉再反轉，真心太精彩！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e01e35ee073146849bc02c712b448828 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c5f23ac4.html title=高分神片：騙中騙！局中局!反轉反轉再反轉，真心太精彩！>高分神片：騙中騙！局中局!反轉反轉再反轉，真心太精彩！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6afd9711.html alt=反轉！IBM打臉谷歌量子霸權，稱其實驗存在巨大缺陷 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/775e771ecbe44cc28d78e2abe0939d3b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6afd9711.html title=反轉！IBM打臉谷歌量子霸權，稱其實驗存在巨大缺陷>反轉！IBM打臉谷歌量子霸權，稱其實驗存在巨大缺陷</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b6bdae4c.html alt="搞不懂的高深術語 依賴倒置•控制反轉•依賴注入•面向接口編程" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/d7be1a4e542841bfa34d7c6faa1a7012 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b6bdae4c.html title="搞不懂的高深術語 依賴倒置•控制反轉•依賴注入•面向接口編程">搞不懂的高深術語 依賴倒置•控制反轉•依賴注入•面向接口編程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/85e688b1.html alt="面向接口編程—依賴注入 IOC的詳解" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/85e688b1.html title="面向接口編程—依賴注入 IOC的詳解">面向接口編程—依賴注入 IOC的詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/b92c5607.html alt="反轉？'董事長被指性侵兒媳'再發聲：刁蠻兒媳讓爺倆反目，都是房子惹的禍" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/0ac321fa76f4498593018162ebd8c02a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/b92c5607.html title="反轉？'董事長被指性侵兒媳'再發聲：刁蠻兒媳讓爺倆反目，都是房子惹的禍">反轉？'董事長被指性侵兒媳'再發聲：刁蠻兒媳讓爺倆反目，都是房子惹的禍</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/90ae49f1.html alt=《街舞》反轉！大婷公孫無名宣佈放棄復活，肖傑退出，他拒絕陪跑 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/516655bec8a24c26877dba0df01b1163 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/90ae49f1.html title=《街舞》反轉！大婷公孫無名宣佈放棄復活，肖傑退出，他拒絕陪跑>《街舞》反轉！大婷公孫無名宣佈放棄復活，肖傑退出，他拒絕陪跑</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/373ac70a.html alt=神級反轉，金鐘民倒數第一變第一，也許這就是人生 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/51a31eb678ca40c8a31cb1cf26f523c5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/373ac70a.html title=神級反轉，金鐘民倒數第一變第一，也許這就是人生>神級反轉，金鐘民倒數第一變第一，也許這就是人生</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a2546a6.html alt=同軸反轉螺旋槳原理動圖解說，看懂的都是高手，直升機都這個原理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6c360ea6d0d64431a4a59dd0fa9f0ff3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a2546a6.html title=同軸反轉螺旋槳原理動圖解說，看懂的都是高手，直升機都這個原理>同軸反轉螺旋槳原理動圖解說，看懂的都是高手，直升機都這個原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2927a8f.html alt="磷酸一銨：硫磺連續漲 行情要反轉？" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/1178316b-066b-4735-85e5-994a80014d77 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2927a8f.html title="磷酸一銨：硫磺連續漲 行情要反轉？">磷酸一銨：硫磺連續漲 行情要反轉？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3a80ef0.html alt=“我不跟他離，我耗著他，不能成全和便宜了他們”錯！要反轉取勝 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/d7d64f41829f4b378d513458508a28ee style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3a80ef0.html title=“我不跟他離，我耗著他，不能成全和便宜了他們”錯！要反轉取勝>“我不跟他離，我耗著他，不能成全和便宜了他們”錯！要反轉取勝</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/858325d.html alt=K線錘頭線反轉形態，一種強烈的見底信號，捕捉主升浪行情 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9d81c9d38c394e16ae59da299fac7e0a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/858325d.html title=K線錘頭線反轉形態，一種強烈的見底信號，捕捉主升浪行情>K線錘頭線反轉形態，一種強烈的見底信號，捕捉主升浪行情</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ef4e064.html alt=巧用“錘頭線”走勢，輕鬆把握反轉行情 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RBBmmv214MiEE0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ef4e064.html title=巧用“錘頭線”走勢，輕鬆把握反轉行情>巧用“錘頭線”走勢，輕鬆把握反轉行情</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ade223b.html alt="第八節 重要的反轉K線（6）錘頭" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/451a79ff26e54a7da082de5ae71b6a37 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ade223b.html title="第八節 重要的反轉K線（6）錘頭">第八節 重要的反轉K線（6）錘頭</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>