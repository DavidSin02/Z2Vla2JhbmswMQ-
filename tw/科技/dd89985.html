<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。 | 极客快訊</title><meta property="og:title" content="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/154047961018239d2cc8e07"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dd89985.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dd89985.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/dd89985.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dd89985.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dd89985.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/dd89985.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/dd89985.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/dd89985.html><meta property="article:published_time" content="2020-10-29T20:54:10+08:00"><meta property="article:modified_time" content="2020-10-29T20:54:10+08:00"><meta name=Keywords content><meta name=description content="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/dd89985.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><br></p><p>如今微<strong>服務架構討論</strong>的如火如荼。但在企業架構裡除了大量的OLTP交易外，還存在海量的批處理交易。在諸如銀行的金融機構中，每天有3-4萬筆的批處理作業需要處理。針對OLTP，業界有大量的開源框架、優秀的架構設計給予支撐；但批處理領域的框架確鳳毛麟角。是時候和我們一起來了解下批處理的世界哪些優秀的框架和設計了，今天我將以Spring Batch為例，和大家一起探祕批處理的世界。</p><ul><li>初識批處理典型場景</li><li>探祕領域模型及關鍵架構</li><li>實現作業健壯性與擴展性</li><li>批處理框架的不足與增強</li></ul><h1 class=pgc-h-arrow-right><strong>批處理典型業務場景</strong></h1><p>對賬是典型的批處理業務處理場景，各個金融機構的往來業務和跨主機系統的業務都會涉及到對賬的過程，如大小額支付、銀聯交易、人行往來、現金管理、POS業務、ATM業務、證券公司資金賬戶、證券公司與證券結算公司。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/154047961018239d2cc8e07><p class=pgc-img-caption></p></div><p>下面是某行網銀的部分日終跑批實例場景需求。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/154047961017245fd02e5df><p class=pgc-img-caption></p></div><p>涉及到的需求點包括：</p><ol start=1><li>批量的每個單元都需要錯誤處理和回退；</li><li>每個單元在不同平臺中運行；</li><li>需要有分支選擇；</li><li>每個單元需要監控和獲取單元處理日誌；</li><li>提供多種觸發規則，按日期，日曆，週期觸發；</li></ol><p>除此之外典型的批處理適用於如下的業務場景：</p><ol start=1><li>定期提交批處理任務（日終處理）</li><li>並行批處理：並行處理任務</li><li>企業消息驅動處理</li><li>大規模的並行處理</li><li>手動或定時重啟</li><li>按順序處理依賴的任務(可擴展為工作流驅動的批處理)</li><li>部分處理：忽略記錄(例如在回滾時)</li><li>完整的批處理事務</li></ol><p>與OLTP類型交易不同，批處理作業兩個典型特徵是批量執行與自動執行（需要無人值守）：前者能夠處理大批量數據的導入、導出和業務邏輯計算；後者無需人工干預，能夠自動化執行批量任務。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15404796102240d9819c8fa><p class=pgc-img-caption></p></div><p>在關注其基本功能之外，還需要關注如下的幾點：</p><ul><li><strong>健壯性：</strong>不會因為無效數據或錯誤數據導致程序崩潰；</li><li><strong>可靠性：</strong>通過跟蹤、監控、日誌及相關的處理策略（重試、跳過、重啟）實現批作業的可靠執行；</li><li><strong>擴展性：</strong>通過併發或者並行技術實現應用的縱向和橫向擴展，滿足海量數據處理的性能需求；</li></ul><p>苦於業界真的缺少比較好的批處理框架，Spring Batch是業界目前為數不多的優秀批處理框架（Java語言開發），SpringSource和Accenture（埃森哲）共同貢獻了智慧。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/154047961017651bf531023><p class=pgc-img-caption></p></div><p><strong>Accenture在批處理架構上有著豐富的工業級別的經驗</strong>，貢獻了之前專用的批處理體系框架（這些框架歷經數十年研發和使用，為Spring Batch提供了大量的參考經驗）。</p><p><strong>SpringSource則有著深刻的技術認知和Spring框架編程模型</strong>，同時借鑑了JCL(Job Control Language)和COBOL的語言特性。2013年JSR-352將批處理納入規範體系，並被包含在了JEE7之中。這意味著，所有的JEE7應用服務器都會有批處理的能力，目前第一個實現此規範的應用服務器是Glassfish 4。當然也可以在Java SE中使用。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1540479610219f587656444><p class=pgc-img-caption></p></div><p>但最為關鍵的一點是：JSR-352規範大量借鑑了Spring Batch框架的設計思路,從上圖中的核心模型和概念中可以看出究竟，核心的概念模型完全一致。</p><p>通過Spring Batch框架可以構建出輕量級的健壯的並行處理應用,支持事務、併發、流程、監控、縱向和橫向擴展,提供統一的接口管理和任務管理。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/15404796101727bdcc2ebb3><p class=pgc-img-caption></p></div><p>框架提供了諸如以下的核心能力，讓大家更關注在業務處理上。更是提供瞭如下的豐富能力：</p><ol start=1><li>明確分離批處理的執行環境和應用</li><li>將通用核心的服務以接口形式提供</li><li>提供“開箱即用” 的簡單的默認的核心執行接口</li><li>提供Spring框架中配置、自定義、和擴展服務</li><li>所有默認實現的核心服務能夠容易的被擴展與替換，不會影響基礎層</li><li>提供一個簡單的部署模式，使用Maven進行編譯</li></ol><h1 class=pgc-h-arrow-right><strong>批處理關鍵領域模型及關鍵架構</strong></h1><p>先來個Hello World示例，一個典型的批處理作業。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1540479610314de8129bd52><p class=pgc-img-caption></p></div><p>典型的一個作業分為3部分：作業讀、作業處理、作業寫，也是典型的三步式架構。整個批處理框架基本上圍繞Read、Process、Writer來處理。除此之外，框架提供了作業調度器、作業倉庫（用以存放Job的元數據信息，支持內存、DB兩種模式）。</p><p>完整的領域概念模型參加下圖：</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1540479610362170c28bc18><p class=pgc-img-caption></p></div><p>Job Launcher（作業調度器）是Spring Batch框架基礎設施層提供的運行Job的能力。通過給定的Job名稱和作Job Parameters，可以通過Job Launcher執行Job。</p><p>通過Job Launcher可以在Java程序中調用批處理任務，也可以在通過命令行或者其它框架（如定時調度框架Quartz）中調用批處理任務。</p><p>Job Repository來存儲Job執行期的元數據（這裡的元數據是指Job Instance、Job Execution、Job Parameters、Step Execution、Execution Context等數據），並提供兩種默認實現。</p><p>一種是存放在內存中；另一種將元數據存放在數據庫中。通過將元數據存放在數據庫中，可以隨時監控批處理Job的執行狀態。Job執行結果是成功還是失敗，並且使得在Job失敗的情況下重新啟動Job成為可能。Step表示作業中的一個完整步驟，一個Job可以有一個或者多個Step組成。</p><p>批處理框架運行期的模型也非常簡單：</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/154047961035578a939f96c><p class=pgc-img-caption></p></div><p>Job Instance（作業實例）是一個運行期的概念，Job每執行一次都會涉及到一個Job Instance。</p><p>Job Instance來源可能有兩種：一種是根據設置的Job Parameters從Job Repository（作業倉庫）中獲取一個；如果根據Job Parameters從Job Repository沒有獲取Job Instance，則新創建一個新的Job Instance。</p><p>Job Execution表示Job執行的句柄，一次Job的執行可能成功也可能失敗。只有Job執行成功後，對應的Job Instance才會被完成。因此在Job執行失敗的情況下，會有一個Job Instance對應多個Job Execution的場景發生。</p><p>總結下批處理的典型概念模型，其設計非常精簡的十個概念，完整支撐了整個框架。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15404796104135952bfcc64><p class=pgc-img-caption></p></div><p>Job提供的核心能力包括作業的抽象與繼承，類似面向對象中的概念。對於執行異常的作業，提供重啟的能力。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1540479610390f66b67e3ff><p class=pgc-img-caption></p></div><p>框架在Job層面，同樣提供了作業編排的概念，包括順序、條件、並行作業編排。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1540479610409dca3f4c076><p class=pgc-img-caption></p></div><p>在一個Job中配置多個Step。不同的Step間可以順序執行，也可以按照不同的條件有選擇的執行（條件通常使用Step的退出狀態決定），通過next元素或者decision元素來定義跳轉規則；</p><p>為了提高多個Step的執行效率，框架提供了Step並行執行的能力（使用split進行聲明，通常該情況下需要Step之間沒有任何的依賴關係，否則容易引起業務上的錯誤）。Step包含了一個實際運行的批處理任務中的所有必需的信息，其實現可以是非常簡單的業務實現，也可以是非常複雜的業務處理，Step的複雜程度通常是業務決定的。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/15404796105121fb5b43cce><p class=pgc-img-caption></p></div><p>每個Step由ItemReader、ItemProcessor、ItemWriter組成，當然根據不同的業務需求，ItemProcessor可以做適當的精簡。同時框架提供了大量的ItemReader、ItemWriter的實現，提供了對FlatFile、XML、Json、DataBase、Message等多種數據類型的支持。</p><p>框架還為Step提供了重啟、事務、重啟次數、併發數；以及提交間隔、異常跳過、重試、完成策略等能力。基於Step的靈活配置，可以完成常見的業務功能需求。其中三步走（Read、Processor、Writer）是批處理中的經典抽象。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/154047972981617162aec98><p class=pgc-img-caption></p></div><p>作為面向批的處理，在Step層提供了多次讀、處理，一次提交的能力。</p><p>在Chunk的操作中，可以通過屬性commit-interval設置read多少條記錄後進行一次提交。通過設置commit-interval的間隔值，減少提交頻次，降低資源使用率。Step的每一次提交作為一個完整的事務存在。默認採用Spring提供的聲明式事務管理模式，事務編排非常方便。如下是一個聲明事務的示例：</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1540479750166a1cc83f1a3><p class=pgc-img-caption></p></div><p>框架對於事務的支持能力包括：</p><ol start=1><li>Chunk支持事務管理，通過commit-interval設置每次提交的記錄數；</li><li>支持對每個Tasklet設置細粒度的事務配置：隔離界別、傳播行為、超時；</li><li>支持rollback和no rollback，通過skippable-exception-classes和no-rollback-exception-classes進行支撐；</li><li>支持JMS Queue的事務級別配置；</li></ol><p>另外，在框架資深的模型抽象方面，Spring Batch也做了極為精簡的抽象。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/15404796106132c9f7f98f7><p class=pgc-img-caption></p></div><p>僅僅使用六張業務表存儲了所有的元數據信息（包括Job、Step的實例，上下文，執行器信息，為後續的監控、重啟、重試、狀態恢復等提供了可能）。</p><ul><li>BATCH_JOB_INSTANCE：作業實例表，用於存放Job的實例信息</li><li>BATCH_JOB_EXECUTION_PARAMS：作業參數表，用於存放每個Job執行時候的參數信息，該參數實際對應Job實例的。</li><li>BATCH_JOB_EXECUTION：作業執行器表，用於存放當前作業的執行信息，比如創建時間，執行開始時間，執行結束時間，執行的那個Job實例，執行狀態等。</li><li>BATCH_JOB_EXECUTION_CONTEXT：作業執行上下文表，用於存放作業執行器上下文的信息。</li><li>BATCH_STEP_EXECUTION：作業步執行器表，用於存放每個Step執行器的信息，比如作業步開始執行時間，執行完成時間，執行狀態，讀寫次數，跳過次數等信息。</li><li>BATCH_STEP_EXECUTION_CONTEXT：作業步執行上下文表，用於存放每個作業步上下文的信息。</li></ul><h1 class=pgc-h-arrow-right><strong>實現作業的健壯性與擴展性</strong></h1><p>批處理要求Job必須有較強的健壯性，通常Job是批量處理數據、無人值守的，這要求在Job執行期間能夠應對各種發生的異常、錯誤，並對Job執行進行有效的跟蹤。</p><p>一個健壯的Job通常需要具備如下的幾個特性：</p><p><strong>1. 容錯性</strong></p><p>在Job執行期間非致命的異常，Job執行框架應能夠進行有效的容錯處理，而不是讓整個Job執行失敗；通常只有致命的、導致業務不正確的異常才可以終止Job的執行。</p><p><strong>2. 可追蹤性</strong></p><p>Job執行期間任何發生錯誤的地方都需要進行有效的記錄，方便後期對錯誤點進行有效的處理。例如在Job執行期間任何被忽略處理的記錄行需要被有效的記錄下來，應用程序維護人員可以針對被忽略的記錄後續做有效的處理。</p><p><strong>3. 可重啟性</strong></p><p>Job執行期間如果因為異常導致失敗，應該能夠在失敗的點重新啟動Job；而不是從頭開始重新執行Job。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1540479610617e00de75ff2><p class=pgc-img-caption></p></div><p>框架提供了支持上面所有能力的特性，包括Skip（跳過記錄處理）、Retry（重試給定的操作）、Restart（從錯誤點開始重新啟動失敗的Job）：</p><ul><li><strong>Skip</strong>，在對數據處理期間，如果數據的某幾條的格式不能滿足要求，可以通過Skip跳過該行記錄的處理，讓Processor能夠順利的處理其餘的記錄行。</li><li><strong>Retry</strong>，將給定的操作進行多次重試，在某些情況下操作因為短暫的異常導致執行失敗，如網絡連接異常、併發處理異常等，可以通過重試的方式避免單次的失敗，下次執行操作時候網絡恢復正常，不再有併發的異常，這樣通過重試的能力可以有效的避免這類短暫的異常。</li><li><strong>Restart</strong>，在Job執行失敗後，可以通過重啟功能來繼續完成Job的執行。在重啟時候，批處理框架允許在上次執行失敗的點重新啟動Job，而不是從頭開始執行，這樣可以大幅提高Job執行的效率。</li></ul><p>對於擴展性，框架提供的擴展能力包括如下的四種模式 :</p><ul><li>Multithreaded Step 多線程執行一個Step;</li><li>Parallel Step 通過多線程並行執行多個Step;</li><li>Remote Chunking 在遠端節點上執行分佈式Chunk操作;</li><li>Partitioning Step 對數據進行分區，並分開執行;</li></ul><p>我們先來看第一種的實現Multithreaded Step：</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1540479794220c7dca1aab8><p class=pgc-img-caption></p></div><p>批處理框架在Job執行時默認使用單個線程完成任務的執行，同時框架提供了線程池的支持（Multithreaded Step模式），可以在Step執行時候進行並行處理，這裡的並行是指同一個Step使用線程池進行執行，同一個Step被並行的執行。使用tasklet的屬性task-executor可以非常容易的將普通的Step變成多線程Step。</p><p>Multithreaded Step的實現示例：</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/1540479810981b2e9b9a169><p class=pgc-img-caption></p></div><p>需要注意的是Spring Batch框架提供的大部分的ItemReader、ItemWriter等操作都是線程不安全的。</p><p>可以通過擴展的方式顯現線程安全的Step。</p><p>下面為大家展示一個擴展的實現：</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1540479610617d899e73c1d><p class=pgc-img-caption></p></div><p>需求：針對數據表的批量處理，實現線程安全的Step，並且支持重啟能力，即在執行失敗點可以記錄批處理的狀態。</p><p>對於示例中的數據庫讀取組件JdbcCursorItemReader，在設計數據庫表時，在表中增加一個字段Flag，用於標識當前的記錄是否已經讀取並處理成功，如果處理成功則標識Flag=true，等下次重新讀取的時候，對於已經成功讀取且處理成功的記錄直接跳過處理。</p><p>Multithreaded Step（多線程步）提供了多個線程執行一個Step的能力，但這種場景在實際的業務中使用的並不是非常多。</p><p>更多的業務場景是Job中不同的Step沒有明確的先後順序，可以在執行期並行的執行。</p><p>Parallel Step：提供單個節點橫向擴展的能力</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1540479610570541c8efb59><p class=pgc-img-caption></p></div><p>使用場景：Step A、Step B兩個作業步由不同的線程執行，兩者均執行完畢後，Step C才會被執行。</p><p>框架提供了並行Step的能力。可以通過Split元素來定義並行的作業流，並制定使用的線程池。</p><p>Parallel Step模式的執行效果如下：</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1540479610633b48c9803d2><p class=pgc-img-caption></p></div><p>每個作業步並行處理不同的記錄，示例中三個作業步，處理同一張表中的不同數據。</p><p>並行Step提供了在一個節點上橫向處理，但隨著作業處理量的增加，有可能一臺節點無法滿足Job的處理，此時我們可以採用遠程Step的方式將多個機器節點組合起來完成一個Job的處理。</p><p>Remote Chunking：遠程Step技術本質上是將對Item讀、寫的處理邏輯進行分離；通常情況下讀的邏輯放在一個節點進行操作，將寫操作分發到另外的節點執行。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1540479890295727ebfb1bb><p class=pgc-img-caption></p></div><p>遠程分塊是一個把step進行技術分割的工作，不需要對處理數據的結構有明確瞭解。</p><p>任何輸入源能夠使用單進程讀取並在動態分割後作為"塊"發送給遠程的工作進程。</p><p>遠程進程實現了監聽者模式，反饋請求、處理數據最終將處理結果異步返回。請求和返回之間的傳輸會被確保在發送者和單個消費者之間。</p><p>在Master節點，作業步負責讀取數據，並將讀取的數據通過遠程技術發送到指定的遠端節點上，進行處理，處理完畢後Master負責回收Remote端執行的情況。</p><p>在Spring Batch框架中通過兩個核心的接口來完成遠程Step的任務，分別是ChunkProvider與ChunkProcessor。</p><p>ChunkProvider：根據給定的ItemReader操作產生批量的Chunk操作；</p><p>ChunkProcessor：負責獲取ChunkProvider產生的Chunk操作，執行具體的寫邏輯；</p><p>Spring Batch中對遠程Step沒有默認的實現，但我們可以藉助SI或者AMQP實現來實現遠程通訊能力。</p><p>Step本地節點負責讀取數據，並通過MessagingGateway將請求發送到遠程Step上；遠程Step提供了隊列的監聽器，當請求隊列中有消息時候獲取請求信息並交給ChunkHander負責處理。</p><p>接下來我們看下最後一種分區模式；Partitioning Step：分區模式需要對數據的結構有一定的瞭解，如主鍵的範圍、待處理的文件的名字等。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1540479610715188ec2f08f><p class=pgc-img-caption></p></div><p>這種模式的優點在於分區中每一個元素的處理器都能夠像一個普通Spring Batch任務的單步一樣運行，也不必去實現任何特殊的或是新的模式，來讓他們能夠更容易配置與測試。</p><p>通過分區可以實現以下的優點：</p><ul><li>分區實現了更細粒度的擴展；</li><li>基於分區可以實現高性能的數據切分；</li><li>分區比遠程通常具有更高的擴展性；</li><li>分區後的處理邏輯，支持本地與遠程兩種模式；</li><li>分區作業典型的可以分成兩個處理階段，數據分區、分區處理；</li></ul><p><strong>數據分區</strong>：根據特殊的規則（例如：根據文件名稱，數據的唯一性標識，或者哈希算法）將數據進行合理的數據切片，為不同的切片生成數據執行上下文Execution Context、作業步執行器Step Execution。可以通過接口Partitioner生成自定義的分區邏輯，Spring Batch批處理框架默認實現了對多文件的實現org.springframework.batch.core.partition.support.MultiResourcePartitioner；也可以自行擴展接口Partitioner來實現自定義的分區邏輯。</p><p><strong>分區處理</strong>：通過數據分區後，不同的數據已經被分配到不同的作業步執行器中，接下來需要交給分區處理器進行作業，分區處理器可以本地執行也可以遠程執行被劃分的作業。接口PartitionHandler定義了分區處理的邏輯，Spring Batch批處理框架默認實現了本地多線程的分區處理org.springframework.batch.core.partition.support.TaskExecutorPartitionHandler；也可以自行擴展接口PartitionHandler來實現自定義的分區處理邏輯。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1540479610773a5814cb1e8><p class=pgc-img-caption></p></div><p>Spring Batch框架提供了對文件分區的支持，實現類org.springframework.batch.core.partition.support.MultiResourcePartitioner提供了對文件分區的默認支持，根據文件名將不同的文件處理進行分區，提升處理的速度和效率，適合有大量小文件需要處理的場景。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/1540479610887bce5cea80c><p class=pgc-img-caption></p></div><p><br></p><p>示例展示了將不同文件分配到不同的作業步中，使用MultiResourcePartitioner進行分區，意味著每個文件會被分配到一個不同的分區中。如果有其它的分區規則，可以通過實現接口Partitioner來進行自定義的擴展。有興趣的TX，可以自己實現基於數據庫的分區能力哦。</p><p>總結一下，批處理框架在擴展性上提供了4中不同能力，每種都是各自的使用場景，我們可以根據實際的業務需要進行選擇。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/1540479610838717a442499><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right><strong>批處理框架的不足與增強</strong></h1><p>Spring Batch批處理框架雖然提供了4種不同的監控方式，但從目前的使用情況來看，都不是非常的友好。</p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/154047961082422492652b3><p class=pgc-img-caption></p></div><ul><li>通過DB直接查看，對於管理人員來講，真的不忍直視；</li><li>通過API實現自定義的查詢，這是程序員的天堂，確實運維人員的地獄；</li><li>提供了Web控制檯，進行Job的監控和操作，目前提供的功能太裸露，無法直接用於生產；</li><li>提供JMX查詢方式，對於非開發人員太不友好；</li></ul><p>但在企業級應用中面對批量數據處理，僅僅提供批處理框架僅能滿足批處理作業的快速開發、執行能力。</p><p>企業需要統一的批處理平臺來處理複雜的企業批處理應用，批處理平臺需要解決作業的統一調度、批處理作業的集中管理和管控、批處理作業的統一監控等能力。</p><p><strong>那完美的解決方案是什麼呢？</strong></p><blockquote class=article-blockquote><p><strong>關注我：轉發+私信回覆“架構資料”獲取Java高級架構資料、源碼、筆記、視頻</strong></p><p><strong>Dubbo、Redis、設計模式、Netty、zookeeper、Spring cloud、分佈式、微服務</strong></p><p><strong>高併發等架構技術</strong></p></blockquote><p>企業級批處理平臺需要在Spring Batch批處理框架的基礎上，集成調度框架，通過調度框架可以將任務按照企業的需求進行任務的定期執行；</p><p>豐富目前Spring Batch Admin（Spring Batch的管理監控平臺，目前能力比較薄弱）框架，提供對Job的統一管理功能，增強Job作業的監控、預警等能力；</p><p>通過與企業的組織機構、權限管理、認證系統進行合理的集成，增強平臺對Job作業的權限控制、安全管理能力。</p><p>由於時間關係，今天的分享就到這裡，很多內容未能展開討論。歡迎大家在實際業務中使用Spring Batch框架。</p><h1 class=pgc-h-arrow-right><strong>最後的話</strong></h1><blockquote class=article-blockquote><p><strong>覺得還不錯可以轉發+關注支持一波~私信【架構資料】獲取一些我私人整理的Java進階資料！</strong></p></blockquote><p><br></p><div class=pgc-img><img alt="一文搞懂大數據批量處理框架Spring Batch的完美解析方案是什麼。" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0b9ffccada5f4112970c3e6f26c0dabb><p class=pgc-img-caption></p></div><p><br></p><p><strong>為什麼某些人會一直比你優秀，是因為他本身就很優秀還一直在持續努力變得更優秀。而你是不是還在滿足於現狀且內心在竊喜?“對於程序員來說，如果哪一天開始他停止了學習，那麼他的職業生涯便開始宣告消亡。”所以行動起來，學習起來！</strong></p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>搞懂</a></li><li><a>大數據</a></li><li><a>處理</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/9b893ffd.html alt=大數據處理經典方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/aafcb0ae-1169-4605-98f1-3c041f9fd2a4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9b893ffd.html title=大數據處理經典方法>大數據處理經典方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c08f7fcf.html alt=寶信軟件：公司聚焦大數據、人工智能、虛擬製造等七大關鍵技術的研究 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c08f7fcf.html title=寶信軟件：公司聚焦大數據、人工智能、虛擬製造等七大關鍵技術的研究>寶信軟件：公司聚焦大數據、人工智能、虛擬製造等七大關鍵技術的研究</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/10c7d8fd.html alt=神州泰嶽：公司在自然語言處理領域的基礎技術研究和應用落地均走在行業前列 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/10c7d8fd.html title=神州泰嶽：公司在自然語言處理領域的基礎技術研究和應用落地均走在行業前列>神州泰嶽：公司在自然語言處理領域的基礎技術研究和應用落地均走在行業前列</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b49977fa.html alt=20個機械設計知識點總結，搞懂也是半個行家 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b49977fa.html title=20個機械設計知識點總結，搞懂也是半個行家>20個機械設計知識點總結，搞懂也是半個行家</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0be408a4.html alt="MySQL 事務處理" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0be408a4.html title="MySQL 事務處理">MySQL 事務處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/011d2da0.html alt=MySql併發與事務的處理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/f13d8a1e-5e60-4b48-90bc-3c26e312a208 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/011d2da0.html title=MySql併發與事務的處理>MySql併發與事務的處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d3c48fcc.html alt=Spring聲明式事務處理的實現原理，來自面試官的窮追拷問 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d3c48fcc.html title=Spring聲明式事務處理的實現原理，來自面試官的窮追拷問>Spring聲明式事務處理的實現原理，來自面試官的窮追拷問</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/efc2a519.html alt=你知道MySQL的事務處理和隔離級別嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/efc2a519.html title=你知道MySQL的事務處理和隔離級別嗎？>你知道MySQL的事務處理和隔離級別嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/160af1cf.html alt=牆面基層處理有哪些基本步驟 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RZdKr6O1pG4jKu style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/160af1cf.html title=牆面基層處理有哪些基本步驟>牆面基層處理有哪些基本步驟</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bf790e4b.html alt=地面基層處理是什麼意思？地面基層清理方法及注意事項有哪些 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/339700cdb9c04fdd98fcc3e95cdc166c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bf790e4b.html title=地面基層處理是什麼意思？地面基層清理方法及注意事項有哪些>地面基層處理是什麼意思？地面基層清理方法及注意事項有哪些</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/44c6d5cb.html alt=豎向鋼筋位移施工加固處理措施 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a7d965c73c1542978ae9091d6bf34aa9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/44c6d5cb.html title=豎向鋼筋位移施工加固處理措施>豎向鋼筋位移施工加固處理措施</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/319bc575.html alt=電工最常見的幾個電路圖，全都搞懂的才是老師傅，你搞懂了幾個？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/47783c95e3a34185be9ff00f54b4fe7e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/319bc575.html title=電工最常見的幾個電路圖，全都搞懂的才是老師傅，你搞懂了幾個？>電工最常見的幾個電路圖，全都搞懂的才是老師傅，你搞懂了幾個？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6720a0ac.html alt=殷佔堂：再談日本垃圾處理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9d101ab3a11348a9ad723bf8df3accb4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6720a0ac.html title=殷佔堂：再談日本垃圾處理>殷佔堂：再談日本垃圾處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3844d7f0.html alt=幹熄焦事故處理及案例分析 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/4f2463465a6a4c5fb2e8f708400ba596 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3844d7f0.html title=幹熄焦事故處理及案例分析>幹熄焦事故處理及案例分析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c33990cd.html alt=幹熄焦常見故障及處理方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c4733b279b994389b8d95831dbfa98d0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c33990cd.html title=幹熄焦常見故障及處理方法>幹熄焦常見故障及處理方法</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>