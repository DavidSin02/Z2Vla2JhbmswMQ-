<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>計算機網絡之運輸層 | 极客快訊</title><meta property="og:title" content="計算機網絡之運輸層 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/66c90002f59ea83b2f60"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/de150a1b.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/de150a1b.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/de150a1b.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/de150a1b.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/de150a1b.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/de150a1b.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/de150a1b.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/de150a1b.html><meta property="article:published_time" content="2020-10-29T21:12:28+08:00"><meta property="article:modified_time" content="2020-10-29T21:12:28+08:00"><meta name=Keywords content><meta name=description content="計算機網絡之運輸層"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/de150a1b.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>計算機網絡之運輸層</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>內容導讀</h1><blockquote><p>兩個主機進行通信實際上是兩個主機中的應用進程通信 應用進程間通信又稱為端到端的通信 運輸層的一個很重要的功能就是複用和分用 應用層不同進程的報文通過不同的端口向下交到運輸層，再往下就共用網絡層提供的服務。為應用進程之間提供端到端的邏輯通信（但網絡層是為主機之間提供邏輯通信） 對收到的報文進行差錯檢測 需要有兩種不同的運輸協議，即面向連接的 TCP 和無連接的 UDP。源/目的端口——各佔 2 字節 端口是運輸層與應用層的服務接口:運輸層的 複用和分用 都要通過端口實現 序號——佔 4 字節 傳送的數據流中的 每一個字節都編上一個序號 :序號的值則指的是本報文段所發送數據的第一個字節的序號 確認號——佔 4 字節 期望收到對方下一個報文段的數據的第一個字節的序號 數據偏移（首部長度）——佔 4 位 指出報文段的 數據起始處 距離報文段的 起始處 有多遠:“數據偏移”的單位是 32 位字（以 4 字節為計算單位） 保留——佔 6 位 為今後使用,但目前應置為 0 緊急 URG URG = 1:緊急指針字段有效.它告訴系統此報文段中有 緊急數據 ,應 儘快傳送 (相當於高優先級的數據) 確認 ACK 只有當 ACK = 1 時確認號字段才有效; 當 ACK = 0 時,確認號無效 推送 PSH (PuSH) 接收 TCP 收到 PSH = 1 的報文段，就儘快地交付接收應用進程，而不再等到整個緩存都填滿了後再向上交付 復位 RST (ReSeT) 當 RST = 1 時:TCP 連接中出現嚴重差錯（如由於主機崩潰或其他原因），必須釋放連接，然後再重新建立運輸連接 同步 SYN SYN = 1:這是一個連接請求或連接接受報文 終止 FIN (FINis) 用來釋放一個連接 FIN = 1:此報文段的發送端的數據已發送完畢,並要求釋放運輸連接 窗口字段 —— 佔 2 字節 用來讓對方設置發送窗口的依據,單位為字節（ 發送方的接收窗口 ） 檢驗和 —— 佔 2 字節 檢驗的範圍包括首部和數據兩部分 在計算檢驗和時,要在 TCP 報文段的前面加上 12 字節的偽首部 緊急指針字段 —— 佔 16 位 指出在本報文段中緊急數據共有多少個字節（緊急數據放在本報文段數據的最前面） 選項 —— 長度可變 TCP 最初只規定了一種選項:最大報文段長度(MSS). MSS 告訴對方 TCP：“我的緩存所能接收的報文段的數據字段的最大長度是 MSS 個字節。當前網絡正朝著高速化的方向發展，這很容易出現緩存不夠大而造成分組的丟失。在許多情況下，甚至正是擁塞控制本身成為引起網絡性能惡化甚至發生死鎖的原因。發送方每收到一個對新報文段的確認（重傳的不算在內）就使 cwnd 加 1。</p></blockquote><h1>1 功能</h1><h2>1.1 進程間通信</h2><ul class=list-paddingleft-2><li><p>從通信和信息處理的角度看,運輸層嚮應用層提供通信服務,它屬於面向通信部分的最高層,同時也是用戶功能中的最底層</p></li><li><p>當網絡的邊緣部分中的兩個主機使用網絡的核心部分的功能進行端到端的通信時,只有位於網絡邊緣部分的主機的協議棧才有運輸層,而網絡核心部分中的路由器在轉發分組時都只用到下三層的功能</p><p><img alt=計算機網絡之運輸層 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/66c90002f59ea83b2f60></p><p>運輸層為相互通信的應用進程提供了邏輯通信</p></li></ul><h2>1.2 應用進程間通信</h2><ul class=list-paddingleft-2><li><p>兩個主機進行通信實際上是兩個主機中的應用進程通信</p></li><li><p>應用進程間通信又稱為端到端的通信</p></li><li><p>運輸層的一個很重要的功能就是複用和分用<br>應用層不同進程的報文通過不同的端口向下交到運輸層，再往下就共用網絡層提供的服務。</p></li><li><p>運輸層提供應用進程間的邏輯通信<br>"邏輯通信"：運輸層之間的通信好像是沿水平方向傳送數據。但事實上這兩個運輸層之間並沒有一條水平方向的物理連接</p><p><img alt=計算機網絡之運輸層 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/66c4000562c062577cbe></p><p>運輸層協議和網絡層協議的主要區別</p></li></ul><h2>1.3 運輸層的主要功能</h2><ul class=list-paddingleft-2><li><p>為應用進程之間提供端到端的邏輯通信（但網絡層是為主機之間提供邏輯通信）</p></li><li><p>對收到的報文進行差錯檢測</p></li><li><p>需要有兩種不同的運輸協議，即面向連接的 TCP 和無連接的 UDP。</p></li></ul><h2>1.4 兩種不同的運輸協議</h2><ul class=list-paddingleft-2><li><p>運輸層向高層用戶屏蔽了下面網絡核心的細節,它使應用進程看見的就是好像在兩個運輸層實體之間有一條端到端的邏輯通信信道</p></li><li><p>當運輸層採用面向連接的 TCP 協議時，儘管下面的網絡是不可靠的（只提供盡最大努力服務），但這種邏輯通信信道就相當於一條全雙工的可靠信道</p></li><li><p>當運輸層採用無連接的 UDP 協議時，這種邏輯通信信道是一條不可靠信道</p></li></ul><h1>2 UDP與TCP異同</h1><h2>2.1 TCP 與 UDP</h2><ul class=list-paddingleft-2><li><p>兩個對等運輸實體在通信時傳送的數據單位叫作運輸協議數據單元 TPDU (Transport Protocol Data Unit)。</p></li><li><p>TCP 傳送的數據單位協議是 TCP 報文段(segment)</p></li><li><p>UDP 傳送的數據單位協議是 UDP 報文或用戶數據報</p><p><img alt=計算機網絡之運輸層 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/66c500053ee056e76042></p><p>TCP/IP 體系中的運輸層協議</p></li><li><p>UDP 在傳送數據之前不需要先建立連接。對方的運輸層在收到 UDP 報文後，不需要給出任何確認。雖然 UDP 不提供可靠交付，但在某些情況下 UDP 是一種最有效的工作方式。</p></li><li><p>TCP 則提供面向連接的服務。TCP 不提供廣播或多播服務。由於 TCP 要提供可靠的、面向連接的運輸服務，因此不可避免地增加了許多的開銷。這不僅使協議數據單元的首部增大很多，還要佔用許多的處理機資源</p></li><li><p>運輸層的 UDP 用戶數據報與網際層的IP數據報有很大區別。IP 數據報要經過互連網中許多路由器的存儲轉發，但 UDP 用戶數據報是在運輸層的端到端抽象的邏輯信道中傳送的。</p></li><li><p>TCP 報文段是在運輸層抽象的端到端邏輯信道中傳送，這種信道是可靠的全雙工信道。但這樣的信道卻不知道究竟經過了哪些路由器，而這些路由器也根本不知道上面的運輸層是否建立了 TCP 連接。</p></li></ul><h2>3.1 運輸層的端口</h2><ul class=list-paddingleft-2><li><p>運行在計算機中的進程是用進程標識符來標誌的。</p></li><li><p>運行在應用層的各種應用進程卻不應當讓計算機操作系統指派它的進程標識符。這是因為在因特網上使用的計算機的操作系統種類很多，而不同的操作系統又使用不同格式的進程標識符。</p></li><li><p>為了使運行不同操作系統的計算機的應用進程能夠互相通信，就必須用統一的方法對 TCP/IP 體系的應用進程進行標誌。</p></li></ul><h2>3.2 需要解決的問題</h2><ul class=list-paddingleft-2><li><p>由於進程的創建和撤銷都是動態的，發送方几乎無法識別其他機器上的進程。</p></li><li><p>有時我們會改換接收報文的進程，但並不需要通知所有發送方。</p></li><li><p>我們往往需要利用目的主機提供的功能來識別終點，而不需要知道實現這個功能的進程。</p></li><li><p>解決這個問題的方法就是在運輸層使用協議端口號(protocol port number)，或通常簡稱為端口(port)。<br>雖然通信的終點是應用進程，但我們可以把端口想象是通信的終點，因為我們只要把要傳送的報文交到目的主機的某一個合適的目的端口，剩下的工作（即最後交付目的進程）就由 TCP 來完成。</p></li></ul><p>軟件端口與硬件端口</p><ul class=list-paddingleft-2><li><p>在協議棧層間的抽象的協議端口是軟件端口。</p></li><li><p>路由器或交換機上的端口是硬件端口。</p></li><li><p>硬件端口是不同硬件設備進行交互的接口，而軟件端口是應用層的各種協議進程與運輸實體進行層間交互的一種地址</p></li></ul><h2>3.3 TCP 的端口</h2><ul class=list-paddingleft-2><li><p>端口用一個 16 位端口號進行標誌。</p></li><li><p>端口號只具有本地意義，即端口號只是為了標誌本計算機應用層中的各進程。在因特網中不同計算機的相同端口號是沒有聯繫的。</p></li></ul><h2>3.4 三類端口</h2><ul class=list-paddingleft-2><li><p>熟知端口，數值一般為 0~1023。</p></li><li><p>登記端口號，數值為1024~49151，為沒有熟知端口號的應用程序使用的。使用這個範圍的端口號必須在 IANA 登記，以防止重複。</p></li><li><p>客戶端口號或短暫端口號，數值為49152~65535，留給客戶進程選擇暫時使用。當服務器進程收到客戶進程的報文時，就知道了客戶進程所使用的動態端口號。通信結束後，這個端口號可供其他客戶進程以後使用</p></li></ul><h2>4.1 TCP 最主要的特點</h2><ul class=list-paddingleft-2><li><p>TCP 是面向連接的運輸層協議</p></li><li><p>每一條 TCP 連接只能有兩個端點(endpoint)，每一條 TCP 連接只能是點對點的（一對一）。</p></li><li><p>TCP 提供可靠交付的服務</p></li><li><p>TCP 提供全雙工通信</p></li><li><p>面向字節流</p><p><img alt=計算機網絡之運輸層 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/66c80003f10cdc281a5a></p><p>TCP 面向流的概念</p></li><li><p>應當注意</p></li><ul class=list-paddingleft-2><li><p>TCP 連接是一條虛連接而不是一條真正的物理連接</p></li><li><p>TCP 對應用進程一次把多長的報文發送到TCP 的緩存中是不關心的</p></li><li><p>TCP 根據對方給出的窗口值和當前網絡擁塞的程度來決定一個報文段應包含多少個字節（而UDP 發送的報文長度是應用進程給出的）</p></li><li><p>TCP 可把太長的數據塊劃分短一些再傳送。TCP 也可等待積累有足夠多的字節後再構成報文段發送出去</p></li></ul></ul><h2>4.2 TCP 的連接</h2><ul class=list-paddingleft-2><li><p>TCP 把連接作為最基本的抽象</p></li><li><p>每一條 TCP 連接有兩個端點</p></li><li><p>TCP 連接的端點不是主機,不是主機的IP 地址,不是應用進程,也不是運輸層的協議端口.TCP 連接的端點叫做套接字(socket)</p></li><li><p>端口號拼接到(contatenated with) IP 地址即構成了套接字</p></li></ul><h3>套接字 (socket)</h3><ul class=list-paddingleft-2><li><p>套接字 socket = (IP地址: 端口號)<br>每一條 TCP 連接唯一地被通信兩端的兩個端點（即兩個套接字）所確定。即：<br>TCP 連接 ::= {socket1, socket2}<br>= {(IP1: port1), (IP2: port2)}</p></li></ul><h3>同一個名詞 socket有多種不同的意思</h3><ul class=list-paddingleft-2><li><p>應用編程接口 API 稱為 socket API, 簡稱為 socket</p></li><li><p>socket API 中使用的一個函數名也叫作 socket</p></li><li><p>調用 socket 函數的端點稱為 socket</p></li><li><p>調用 socket 函數時其返回值稱為 socket 描述符，可簡稱為 socket</p></li><li><p>在操作系統內核中連網協議的 Berkeley 實現，稱為 socket 實現</p></li></ul><p><img alt=計算機網絡之運輸層 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/66c4000562c1a70f9d4b></p><p>TCP建立連接的三次握手</p><p>第一次握手：建立連接時，客戶端發送syn包(syn=j)到服務器，並進入SYN_SEND狀態，等待服務器確認</p><p>第二次握手：服務器收到syn包，必須確認客戶的SYN（ack=j+1），同時自己也發送一個SYN包（syn=k），即SYN+ACK包，此時服務器進入SYN_RECV狀態</p><p>第三次握手：客戶端收到服務器的SYN＋ACK包，向服務器發送確認包ACK(ack=k+1)，此包發送完畢，客戶端和服務器進入 ESTABLISHED狀態，完成三次握手。</p><p>完成三次握手，客戶端與服務器開始傳送數據.<br>一個完整的三次握手也就是 請求---應答---再次確認</p><h2>四次揮手</h2><p>由於TCP連接是全雙工的，因此每個方向都必須單獨進行關閉<br>這個原則是<br><code>當一方完成它的數據發送任務後就能發送一個FIN來終止這個方向的連接</code><br>收到一個 FIN只意味著這一方向上沒有數據流動，一個TCP連接在收到一個FIN後仍能發送數據<br><code>首先進行關閉的一方將執行主動關閉，而另一方執行被動關閉</code></p><p>（1）客戶端A發送一個FIN，用來關閉Client A ---->>>Server B的數據傳送<br>（2）B收FIN，發ACK，確認序號為收到的序號加1<br>（3）B關閉與A的連接，發FIN給A<br>（4）A發ACK報文確認，並將確認序號設置為收到序號加1</p><p><img alt=計算機網絡之運輸層 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/66c70004cb829fe95283></p><p>四次分手</p><h3>為什麼建立連接協議是三次握手，而關閉連接卻是四次握手呢</h3><p>這是因為服務端的listen狀態下的socket當收到syn報文的建連請求後，它可以把ACK和SYN（ACK起應答作用，而SYN起同步作用）放在一個報文裡來發送。<br>但關連接時，當收到對方的FIN報文時，它僅僅表示對方沒有數據發送給你了；但未必你所有的數據都全部發送給對方了，所以你可以未必馬上關閉socket,即你可能還需發送一些數據後，再發FIN來表示你可以關連接了，所以這裡的ACK報文和FIN報文多數情況下都是分開發送的</p><h4>簡單點說</h4><p>在TCP/IP協議中,TCP協議提供可靠的連接服務,採用三次握手建立一個連接.</p><p>第一次握手：建立連接時,客戶端發送syn包(syn=j)到服務器,並進入SYN_SEND狀態,等待服務器確認；</p><p>SYN：同步序列編號(Synchronize Sequence Numbers)</p><p>第二次握手：服務器收到syn包,必須確認客戶的SYN（ack=j+1）,同時自己也發送一個SYN包（syn=k）,即SYN+ACK包,此時服務器進入SYN_RECV狀態；</p><p>第三次握手：客戶端收到服務器的SYN＋ACK包,向服務器發送確認包ACK(ack=k+1),此包發送完畢,客戶端和服務器進入ESTABLISHED狀態,完成三次握手.</p><p>完成三次握手,客戶端與服務器開始傳送數據</p><h4>再簡單點說</h4><p>A與B建立TCP連接時：首先A向B發SYN（同步請求），然後B回覆SYN+ACK（同步請求應答），最後A回覆ACK確認，這樣TCP的一次連接（三次握手）的過程就建立了！</p><h1>可靠傳輸的工作原理</h1><p><img alt=計算機網絡之運輸層 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/66c500053ee3103c13f3></p><p>停止等待協議</p><h2>1 注意</h2><ul class=list-paddingleft-2><li><p>在發送完一個分組後,必須暫時保留已發送的分組的副本</p></li><li><p>分組和確認分組都必須進行編號</p></li><li><p>超時計時器的重傳時間應當比數據在分組傳輸的平均往返時間更長一些</p><p><img alt=計算機網絡之運輸層 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/66c500053ee481d08107></p><p>確認丟失和確認遲到</p></li></ul><h1>可靠傳輸的實現</h1><p>使用上述的確認和重傳機制,我們就可以<strong>在不可靠的傳輸網絡上實現可靠的通信</strong></p><p>這種可靠傳輸協議常稱為<strong>自動重傳請求ARQ</strong> (Automatic Repeat reQuest)</p><p>ARQ表明重傳的請求是<strong>自動</strong>進行的:接收方不需要請求發送方重傳某個出錯的分組</p><h2>TCP 可靠通信的具體實現</h2><p>TCP 連接的每一端都必須設有兩個窗口</p><ul class=list-paddingleft-2><li><p>一個發送窗口</p></li><li><p>一個接收窗口</p></li></ul><p>TCP 的可靠傳輸機制用字節的序號進行控制:所有的確認都是基於序號而不是基於報文段</p><p>TCP 兩端的四個窗口經常處於動態變化中</p><p>TCP 連接的往返時間 <strong>RTT</strong> 也不是固定不變的:需要使用特定的算法估算較為合理的重傳時間</p><h1>TCP 報文段的首部格式</h1><p><img alt=計算機網絡之運輸層 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/66c90002f5a8d06ba9f4></p><p>TCP 報文段結構</p><ul class=list-paddingleft-2><li><p>源/目的端口——各佔 2 字節<br>端口是運輸層與應用層的服務接口:運輸層的<strong>複用和分用</strong>都要通過端口實現</p></li><li><p>序號——佔 4 字節<br>傳送的數據流中的<strong>每一個字節都編上一個序號</strong>:序號的值則指的是本報文段所發送數據的第一個字節的序號</p></li><li><p>確認號——佔 4 字節<br>期望收到對方下一個報文段的數據的第一個字節的序號</p></li><li><p>數據偏移（首部長度）——佔 4 位<br>指出報文段的<strong>數據起始處</strong>距離報文段的<strong>起始處</strong>有多遠:“數據偏移”的單位是 32 位字（以 4 字節為計算單位）</p></li><li><p>保留——佔 6 位<br>為今後使用,但目前應置為 0</p></li><li><p>緊急 URG<br>URG = 1:緊急指針字段有效.它告訴系統此報文段中有<strong>緊急數據</strong>,應<strong>儘快傳送</strong>(相當於高優先級的數據)</p></li><li><p>確認 ACK<br>只有當 ACK = 1 時確認號字段才有效;<br>當 ACK = 0 時,確認號無效</p></li><li><p>推送 PSH (PuSH)<br>接收 TCP 收到 PSH = 1 的報文段，就儘快地交付接收應用進程，而不再等到整個緩存都填滿了後再向上交付</p></li><li><p>復位 RST (ReSeT)<br>當 RST = 1 時:TCP 連接中出現嚴重差錯（如由於主機崩潰或其他原因），必須釋放連接，然後再重新建立運輸連接</p></li><li><p>同步 SYN<br>SYN = 1:這是一個連接請求或連接接受報文</p></li><li><p>終止 FIN (FINis)<br>用來釋放一個連接<br>FIN = 1:此報文段的發送端的數據已發送完畢,並要求釋放運輸連接</p></li><li><p>窗口字段 —— 佔 2 字節<br>用來讓對方設置發送窗口的依據,單位為字節（<strong>發送方的接收窗口</strong>）</p></li><li><p>檢驗和 —— 佔 2 字節<br>檢驗的範圍包括首部和數據兩部分<br>在計算檢驗和時,要在 TCP 報文段的前面加上 12 字節的偽首部</p></li><li><p>緊急指針字段 —— 佔 16 位<br>指出在本報文段中緊急數據共有多少個字節（緊急數據放在本報文段數據的最前面）</p></li><li><p>選項 —— 長度可變<br>TCP 最初只規定了一種選項:最大報文段長度(MSS).<br>MSS 告訴對方 TCP：“我的緩存所能接收的報文段的數據字段的最大長度是 MSS 個字節。”</p></li><ul class=list-paddingleft-2><li><p>MSS (Maximum Segment Size)<br>是 TCP 報文段中的數據字段的最大長度.<br>數據字段加上 TCP 首部,才等於整個的 TCP 報文段。</p></li></ul><li><p>窗口擴大 ——佔 3 字節<br>有一個字節表示移位值 S。<br>新的窗口值等於TCP 首部中的窗口位數增大到(16 + S)，相當於把窗口值向左移動 S 位後獲得實際的窗口大小</p></li><li><p>時間戳選項——佔10 字節<br>其中最主要的字段時間戳值字段（4 字節）和時間戳回送回答字段（4 字節）</p></li><li><p>選擇確認選項</p></li><li><p>填充<br>這是為了使整個首部長度是 4 字節的整數倍</p></li></ul><h1>TCP 的流量控制</h1><h2>1 利用滑動窗口實現流量控制</h2><p>一般我們總希望數據傳輸得更快一些.但如果發送方把數據發送得過快,接收方就可能來不及接收,這就會造成數據的丟失</p><p>流量控制(flow control)就是讓發送方的發送速率不要太快,既要讓接收方來得及接收,也不要使網絡發生擁塞<br>利用滑動窗口機制可以很方便地在 TCP 連接上實現流量控制</p><ul class=list-paddingleft-2><li><p>TCP 在發送數據時,發送方的發送窗口不能超過接收方給出的接收窗口的數值<br>注意：TCP窗口的單位是字節<br>TCP就利用這一原理實現流量控制</p></li><li><p>當接收方接收數據的速度變慢時,就在確認報文中告訴發送方接收窗口的大小.發送方根據接收窗口的大小確認發送窗口的大小,從而達到控制流量的目的</p><p><img alt=計算機網絡之運輸層 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/66c4000562c8b408c16e></p><p>流量控制舉例</p></li><li><p>持續計時器(persistence timer)</p></li><ul class=list-paddingleft-2><li><p>若窗口仍是零，則收到這個報文段的一方就重新設置持續計時器。</p></li><li><p>若窗口不是零，則死鎖的僵局就可以打破了</p></li><li><p>TCP 為每一個連接設有一個持續計時器</p></li><li><p>只要 TCP 連接的一方收到對方的零窗口通知，就啟動持續計時器</p></li><li><p>若持續計時器設置的時間到期，就發送一個零窗口探測報文段（僅攜帶 1 字節的數據），而對方就在確認這個探測報文段時給出了現在的窗口值</p></li></ul></ul><h2>2 考慮傳輸效率</h2><p>可以用不同的機制來控制 TCP 報文段的發送時機</p><ul class=list-paddingleft-2><li><p>TCP 維持一個變量，等於最大報文段長度(MSS)<br>只要緩存中存放的數據達到MSS 字節，就組裝成一個 TCP 報文段發送出去</p></li><li><p>由發送方的應用進程指明要求發送報文段<br>即 TCP 支持的推送(push)操作</p></li><li><p>發送方的一個計時器期限到了，這時就把當前已有的緩存數據裝入報文段（但長度不能超過 MSS）發送出去</p></li></ul><h1>TCP的擁塞控制</h1><h2>1 原理</h2><p>在某段時間,若對網絡中某資源的需求超過了該資源所能提供的可用部分,網絡的性能就要變壞——產生擁塞(congestion)</p><ul class=list-paddingleft-2><li><p>出現擁塞的條件<br>對資源需求 > 可用資源</p></li><li><p>若網絡中有許多資源同時產生擁塞，網絡性能就會明顯變壞，整個網絡的吞吐量將隨輸入負荷的增大而下降</p></li></ul><h3>擁塞控制與流量控制的關係</h3><ul class=list-paddingleft-2><li><p>擁塞控制</p></li><ul class=list-paddingleft-2><li><p>所要做的都有一個前提，就是網絡能夠承受現有的網絡負荷</p></li><li><p>是一個全局性的過程，涉及到所有的主機、所有的路由器，以及與降低網絡傳輸性能有關的所有因素。</p></li></ul><li><p>流量控制</p></li><ul class=list-paddingleft-2><li><p>在給定的發送端和接收端之間的點對點通信量的控制</p></li><li><p>抑制發送端發數據的速率，以便使接收端來得及接收</p><p><img alt=計算機網絡之運輸層 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/66c600052a4f04f1e021></p><p>擁塞控制所起的作用</p></li></ul></ul><h3>1.3 擁塞控制的一般原理</h3><p>擁塞控制是很難設計的，因為它是一個動態的（而不是靜態的）問題</p><p>當前網絡正朝著高速化的方向發展，這很容易出現緩存不夠大而造成分組的丟失。但分組的丟失是網絡發生擁塞的徵兆而不是原因。</p><p>在許多情況下，甚至正是擁塞控制本身成為引起網絡性能惡化甚至發生死鎖的原因。這點應特別引起重視</p><h3>1.4 開環控制和閉環控制</h3><ul class=list-paddingleft-2><li><p>開環控制方法就是在設計網絡時事先將有關發生擁塞的因素考慮周到，力求網絡在工作時不產生擁塞</p></li><li><p>閉環控制是基於反饋環路的概念。屬於閉環控制的有以下幾種措施</p></li><ul class=list-paddingleft-2><li><p>監測網絡系統以便檢測到擁塞在何時、何處發生。</p></li><li><p>將擁塞發生的信息傳送到可採取行動的地方。</p></li><li><p>調整網絡系統的運行以解決出現的問題。</p></li></ul></ul><h2>2 幾種擁塞控制方法</h2><h3>2.1 慢開始和擁塞避免</h3><ul class=list-paddingleft-2><li><p>發送方維持一個叫做擁塞窗口 cwnd (congestion window)的狀態變量。<br>擁塞窗口的大小取決於網絡的擁塞程度，並且動態地在變化。<br>發送方讓自己的發送窗口等於擁塞窗口。<br>如再考慮到接收方的接收能力，則發送窗口還可能小於擁塞窗口。</p></li><li><p>發送方控制擁塞窗口的原則是</p></li><ul class=list-paddingleft-2><li><p>網絡沒有出現擁塞，擁塞窗口就再增大一些，以便把更多的分組發送出去</p></li><li><p>網絡出現擁塞，擁塞窗口就減小一些，以減少注入到網絡中的分組數</p></li></ul></ul><h4>2.1.1 慢開始算法的原理</h4><ul class=list-paddingleft-2><li><p>在主機剛剛開始發送報文段時可先設置擁塞窗口 cwnd = 1，即設置為一個最大報文段 MSS 的數值</p></li><li><p>在每收到一個對新的報文段的確認後，將擁塞窗口加 1，即增加一個 MSS 的數值</p></li><li><p>用這樣的方法逐步增大發送端的擁塞窗口 cwnd，可以使分組注入到網絡的速率更加合理</p><p><img alt=計算機網絡之運輸層 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/66c600052a51d1f8a494></p><p>發送方每收到一個對新報文段的確認（重傳的不算在內）就使 cwnd 加 1。</p></li></ul><h4>2.1.2 傳輸輪次(transmission round)</h4><ul class=list-paddingleft-2><li><p>使用慢開始算法後，每經過一個傳輸輪次，擁塞窗口 cwnd 就加倍</p></li><li><p>一個傳輸輪次所經歷的時間其實就是往返時間 RTT</p></li><li><p>“傳輸輪次”更加強調：把擁塞窗口 cwnd 所允許發送的報文段都連續發送出去，並收到了對已發送的最後一個字節的確認</p></li><li><p>例如，擁塞窗口 cwnd = 4，這時的往返時間 RTT 就是發送方連續發送 4 個報文段，並收到這 4 個報文段的確認，總共經歷的時間</p></li></ul><h4>2.1.3 設置慢開始門限狀態變量ssthresh</h4><ul class=list-paddingleft-2><li><p>當 cwnd &lt; ssthresh 時，使用慢開始算法。</p></li><li><p>當 cwnd > ssthresh 時，停止使用慢開始算法而改用擁塞避免算法。</p></li><li><p>當 cwnd = ssthresh 時，既可使用慢開始算法，也可使用擁塞避免算法。</p></li><li><p>擁塞避免算法的思路是讓擁塞窗口 cwnd 緩慢地增大，即每經過一個往返時間 RTT 就把發送方的擁塞窗口 cwnd 加 1，而不是加倍，使擁塞窗口 cwnd 按線性規律緩慢增長</p></li></ul><h4>2.1.4 當網絡出現擁塞時</h4><ul class=list-paddingleft-2><li><p>無論在慢開始階段還是在擁塞避免階段，只要發送方判斷網絡出現擁塞（其根據就是沒有按時收到確認），就要把慢開始門限 ssthresh 設置為出現擁塞時的發送方窗口值的一半（但不能小於2）</p></li><li><p>然後把擁塞窗口 cwnd 重新設置為 1，執行慢開始算法</p></li><li><p>這樣做的目的就是要迅速減少主機發送到網絡中的分組數，使得發生擁塞的路由器有足夠時間把隊列中積壓的分組處理完畢</p></li></ul><h4>2.1.5 乘法減小�(multiplicative decrease)</h4><ul class=list-paddingleft-2><li><p>不論在慢開始階段還是擁塞避免階段，只要出現一次超時（即出現一次網絡擁塞），就把慢開始門限值 ssthresh 設置為當前的擁塞窗口值乘以 0.5</p></li><li><p>當網絡頻繁出現擁塞時，ssthresh 值就下降得很快，以大大減少注入到網絡中的分組數</p></li></ul><h4>2.1.6 加法增大�(additive increase)</h4><p>執行擁塞避免算法後，在收到對所有報文段的確認後（即經過一個往返時間），就把擁塞窗口 cwnd增加一個 MSS 大小，使擁塞窗口緩慢增大，以防止網絡過早出現擁塞</p><p><img alt=計算機網絡之運輸層 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/6c2c0000084033bc2e85></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>計算機</a></li><li><a>網絡</a></li><li><a>運輸層</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/1267d3e8.html alt=計算機網絡-數據鏈路層 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/125a70d9a286430b8d5aabb35a77904a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1267d3e8.html title=計算機網絡-數據鏈路層>計算機網絡-數據鏈路層</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/09972eef.html alt="計算機網絡: 鏈路層(入門)" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e50e09971c3a4165866d14abf2df9da4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/09972eef.html title="計算機網絡: 鏈路層(入門)">計算機網絡: 鏈路層(入門)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d469ff43.html alt=計算機網絡之碼分多址技術 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1be327daace445728399d2409f694a17 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d469ff43.html title=計算機網絡之碼分多址技術>計算機網絡之碼分多址技術</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c624a086.html alt=計算機網絡自學筆記：IP數據報格式與編址 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/7aa7f2180be1441c8bd9393af4355c9b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c624a086.html title=計算機網絡自學筆記：IP數據報格式與編址>計算機網絡自學筆記：IP數據報格式與編址</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/aecf487e.html alt=計算機網絡基礎：局域網協議相關知識 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b843ca1dae9a4662aa8b04d696310359 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/aecf487e.html title=計算機網絡基礎：局域網協議相關知識>計算機網絡基礎：局域網協議相關知識</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6c561f23.html alt=計算機網絡：網絡設備知識筆記 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6813b32307144172939b3aac5d917dce style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6c561f23.html title=計算機網絡：網絡設備知識筆記>計算機網絡：網絡設備知識筆記</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/63902cc0.html alt=計算機網絡太難了？瞭解這一篇就夠了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a0bf5c9306514f8d922e5b287829d174 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/63902cc0.html title=計算機網絡太難了？瞭解這一篇就夠了>計算機網絡太難了？瞭解這一篇就夠了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1a983287.html alt=計算機網絡之數據交換技術 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3303aa6a77b24d84b87fb0dd7df2eb04 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1a983287.html title=計算機網絡之數據交換技術>計算機網絡之數據交換技術</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fd64cb45.html alt=計算機網絡筆記 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/152964353345380b3db60fd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fd64cb45.html title=計算機網絡筆記>計算機網絡筆記</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7417a507.html alt=計算機網絡和視頻監控組網方式與選擇 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/92c42588-b6ea-4852-9320-2adbe1a30d44 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7417a507.html title=計算機網絡和視頻監控組網方式與選擇>計算機網絡和視頻監控組網方式與選擇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/13df51b2.html alt=校園計算機網絡系統設計方案 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1532871630549af3fac49f9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/13df51b2.html title=校園計算機網絡系統設計方案>校園計算機網絡系統設計方案</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/af4efdc3.html alt=計算機網絡系統圖例 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1528370273066bcd30a8c70 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/af4efdc3.html title=計算機網絡系統圖例>計算機網絡系統圖例</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/9e500aba.html alt=自學網絡工程師-計算機組成原理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/19f1dd76842d4ab7affe5fe525789e06 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/9e500aba.html title=自學網絡工程師-計算機組成原理>自學網絡工程師-計算機組成原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/592058ff.html alt=計算機：網絡協議的概念和網絡拓撲結構 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/06f271e3fa2f475c88af210ccce912d5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/592058ff.html title=計算機：網絡協議的概念和網絡拓撲結構>計算機：網絡協議的概念和網絡拓撲結構</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/09ddb291.html alt=計算機網絡基礎知識--日常工作的寶庫，收藏必備 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/b25621c28cb24220b71c32b4e2c0d0b9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/09ddb291.html title=計算機網絡基礎知識--日常工作的寶庫，收藏必備>計算機網絡基礎知識--日常工作的寶庫，收藏必備</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>