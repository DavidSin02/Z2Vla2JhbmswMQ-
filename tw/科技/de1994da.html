<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>用樹莓派構建一臺服務器，永久運行網站 | 极客快訊</title><meta property="og:title" content="用樹莓派構建一臺服務器，永久運行網站 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/58213c92f40941f481e699f3b2420245"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/de1994da.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/de1994da.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/de1994da.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/de1994da.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/de1994da.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/de1994da.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/de1994da.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/de1994da.html><meta property="article:published_time" content="2020-11-14T21:08:28+08:00"><meta property="article:modified_time" content="2020-11-14T21:08:28+08:00"><meta name=Keywords content><meta name=description content="用樹莓派構建一臺服務器，永久運行網站"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/de1994da.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>用樹莓派構建一臺服務器，永久運行網站</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><span>本文原載於 SegmentFault 社區</span><br><span>作者：彭小呆</span><span><br></span><hr><p><span><strong>No.1</strong></span></p><p><span><strong>前言</strong></span></p><span><br></span><span>由於本人在這段時候，看到了一個叫做樹莓派的東東，初步瞭解之後覺得很有意思，於是想把整個過程記錄下來。</span><span><br></span><p><span><strong>No.2</strong></span></p><p><span><strong>樹莓派是什麼？</strong></span></p><span>Raspberry Pi</span><span>(中文名為樹莓派,簡寫為 RPi，(或者 RasPi / RPI) 是為學習計算機編程教育而設計)</span><span>，只有信用卡大小的微型電腦，其系統基於 Linux。隨著 Windows 10 IoT 的發佈，我們也將可以用上運行 Windows 的樹莓派。</span><span><br>自問世以來，受眾多計算機發燒友和創客的追捧，曾經一“派”難求。別看其外表“嬌小”，內“心”卻很強大，視頻、音頻等功能通通皆有，可謂是麻雀雖小，五臟俱全。</span><span><br></span><h2><span><strong><span>1. 用我的話理解</span></strong></span></h2><span><strong><span><br></span></strong></span><span>用我的話理解就是樹莓派就是一臺主機，你可以外接顯示器，鍵盤鼠標，u盤等等外設，因為它體積很小，而且又有很多串口和外接的口，可以直接調用很多底層硬件。</span><span><br></span><h2><span><strong><span>2. 市面上的型號</span></strong></span></h2><span><strong><span><br></span></strong></span><span>市面上大多是 3 代 B+ 型，淘寶一搜樹莓派一大堆都是，價錢純主板</span><span>（不要任何外設）</span><span>在 230+ 左右，有點小貴，超過我的預算，所以我繼續尋找廉價的，終於讓我發現了一款 100+ 的樹莓派。</span><span><br></span><h2><span><strong><span>3. 樹莓派 zero w</span></strong></span></h2><span><strong><span><br></span></strong></span><span>樹莓派 zero w 是一款 mini 的樹莓派，體質只有 3b+ 的 1/3。實際到手後，你會發現它真的超級小，超級可愛。以下是我的實物圖，你可以看看大小到底有多 mini。</span><span><br></span><img alt=用樹莓派構建一臺服務器，永久運行網站 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/58213c92f40941f481e699f3b2420245><span>你可以看到，最上面是一根普通的黑色簽字筆，接下來是一個即插即用型的外接 wifi 網卡，然後是一個 USB 讀卡器，最底下的就是我們今天的主角 zero w。它真的超級小，有木有。真的是完美的詮釋了那句“麻雀雖小，五臟俱全”的話。</span><span><br></span><span>zero w </span><span>這款樹莓派的主要參數如下：</span><span><br></span><span>• BCM2835 處理器，1GHz 主頻，512MB RAM</span><span><span>• </span>BCM43438 WiFi / BT 芯片</span><span><span>• </span>micro-USB 電源接口</span><span><span>• </span>micro-USB OTG 接口</span><span><span>• </span>miniHDMI 端口</span><span><span>• </span>複合視頻和重置擴展接口</span><span><span>• </span>脆弱的 CSI 攝像頭接口</span><span><span>• </span>micro-SD 卡座，存放操作系統</span><span><span>• </span>40-pin GPIO 擴展接口</span><span><span>• </span>尺寸：65mm*30mm</span><span>你別看它的 cpu 只有 1 核，內存只有 512MB，就覺得它可能什麼都做不了，但是實際上它的性能還是很好的，用於跑一個網站真的是小 case。</span><h2><br></h2><h2><span><strong><span>4. 更多樹莓派</span></strong></span></h2><span><br></span><span>關於更多樹莓派型號或者使用教程你可以去樹莓派實驗室這個網站，上面有豐富的資源。</span><span><br></span><p><span><strong>No.3</strong></span></p><p><span><strong>樹莓派zero w安裝系統</strong></span></p><h1><span><br></span></h1><h2><span><strong><span>1. 準備</span></strong></span></h2><span><strong><span><br></span></strong></span><span>你可能提前需要準備的東西如下:</span><span><br></span><span><span>• </span>16GB or 32GB 的 SanDisk 內存卡</span><span>（注意是以前那種放在手機上，很小的哦）</span><span><span>• </span>一根最普通不過的 usb 安卓數據線</span><span>（not type-c）</span><span><span>• </span>u 盤格式化工具</span><span>（推薦使用 SDFormatter）</span><span><span>• </span>系統燒寫工具</span><span>（Win32DiskImager）</span><span><span>• </span>樹莓派系統</span><span>（可以去官網下載）</span><span><br></span><span>我使用的是 Raspbian Stretch Lite 這個系統鏡像，這個系統是官方製作的，lite 是無桌面版的，只有黑漆漆的控制檯，優點是體積小，省性能和內存。</span><span><br></span><span>名字帶有 desktop 的是有桌面 ui 的，對不熟悉 liunx 系統的朋友可能更友好，但是體積很大，佔用的性能也會更高。</span><span><br></span><img alt=用樹莓派構建一臺服務器，永久運行網站 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/65e7205568db49c9894bfe0b2af33142><h2><span><strong><span><br></span></strong></span></h2><h2><span><strong><span>2. 第一步下載系統鏡像</span></strong></span></h2><span><br></span><span>下載好你需要的系統鏡像後，如下圖</span><span><br></span><img alt=用樹莓派構建一臺服務器，永久運行網站 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/53affe14f6a54dc2a352b685cb392690><span>一開始只有一個 zip 的壓縮包，大小大概 360MB 左右，你需要把它解壓，得到上圖的文件夾。</span><img alt=用樹莓派構建一臺服務器，永久運行網站 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3941bf6178cd4b089f1b8800bd86f5ec><span><br></span><span>然後進入文件夾可以看到一個 img 的鏡像，大小為 1.7GB 左右。</span><span><br></span><span>ps：這個官方的 Raspbian 鏡像，如果是其他第三方的鏡像，可能下載後的壓縮包解壓後不是 img 鏡像，這種情況請另行百度解決。</span><span><br></span><h2><span><strong><span>3. 使用 Win32DiskImager 往內存卡中寫入鏡像</span></strong></span></h2><span><strong><span><br></span></strong></span><img alt=用樹莓派構建一臺服務器，永久運行網站 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/adb1b31ec91141c88f59b6f2dccecb02><span><br></span><span>把內存卡插入讀卡器後，插入電腦。<br><br></span><span>打開 Win32DiskImager 軟件後，選擇 img 鏡像，設備選擇你的 U 盤，然後點擊寫入就可以了，寫入完成後會彈出成功的提示框。</span><span><br></span><span>ps: 我上圖沒有選擇設備，因為的沒插入讀卡器，僅僅是示範而已</span><h2><span><br></span></h2><h2><span><strong><span>4. 修改 boot 分區的文件</span></strong></span></h2><span><strong><span><br></span></strong></span><span>先別急著拔出讀卡器，此時，我們電腦可以看到 u 盤中只有一個名為 boot 的分區，大小可能只有 40MB 左右，不要著急，因為 window 不識別內存卡中 liunx 系統的其他分區。 </span><span><br></span><h3><span><strong><span>4.1 新建 ssh 文件</span></strong></span></h3><span><br></span><span>因為我們的 zero w 有一個 mini hdmi 的接口，但是我不需要屏幕，所以需要使用 ssh 連接到 zero w 中的系統，所以需要在第一次開機就能</span><span>開啟 ssh 功能。</span><span><br></span><span>我們進入 boot 分區內，然後新建一個名為 ssh 的文件，注意不要後綴名！！！！也不要往裡面寫任何東西！！</span><span><br></span><h3><span><strong><span>4.2 新建 wpa_supplicant.conf 文件</span></strong></span></h3><span><br></span><span>因為 ssh 連接是需要 ip 地址的，所以我們需要將 zero w 在第一次開機自動連接 wifi，使其和我們的電腦處於一個局域網，這樣我們才可以通過 ssh 連接到 zero w 的系統。</span><span><br>同樣的在 boot 分區內，新建一個名為 wpa_supplicant.conf 的文件，然後往裡面寫入如下內容後保存：</span><pre class="hljs nix"><code class=conf>country=CN<br>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev<br>update_config=1<br><br>network={<br>ssid="你的wifi名字"<br>psk="你的wifi密碼"<br></code><p><code class=conf>}</code></p></pre><h2><br></h2><h2><span><strong><span>5. 組裝我們的最小主機並連接</span></strong></span></h2><span><strong><span><br></span></strong></span><span>取出讀卡器中的內存卡，然後插入到 zero w 中，使用一根 usb 安卓數據線連接電源</span><span>（5V1A）</span><span>即可。</span><span><br></span><span><br>等待幾分鐘，期間我們的 zero w 的指示燈會一直閃爍，很正常，等待指示燈常亮的時候，我們去路由器上，查看一下樹莓派的 ip 地址。</span><span><br></span><img alt=用樹莓派構建一臺服務器，永久運行網站 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3312f6330c4043d9bb7ba4ea92e4f6fd><span><br></span><span><br></span><span>可以看到我們 zero w 的 ip 為 192.168.0.104，然後使用 ssh 連接工具</span><span>（推薦使用 putty）</span><span>連接樹莓派，初始賬戶為 pi，密碼是 raspberry。</span><span><br></span><img alt=用樹莓派構建一臺服務器，永久運行網站 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/85185ffa82bb4e3e9f86ac5de10f7811><span><br></span><span>連接成功，如上圖所示。這樣我們的系統就正確無誤的安裝好了。</span><span><br></span><span>ps: 如果是手機開啟熱點當做一個路由器的話，咱們手機下載一個名叫 android terminal 的 app，然後輸入 ip neigh 指令，就可以查到連接到手機的設備的 ip 信息了。</span><span><br></span><h2><span><strong><span>6. 優化咱們樹莓派的系統</span></strong></span></h2><h3><span><br></span></h3><h3><span><strong><span>6.1 修改源</span></strong></span></h3><strong><span><br></span></strong><span>因為國外的源，咱們在國內的連接過去網速很慢，所以我們需要修改為國內的源，我修改的是中科大的源。</span><span><br></span><h4><strong><span>6.1.1 修改 sources.list 文件</span></strong></h4><strong><span><br></span></strong><pre class="javascript hljs"><code class=javascript>sudo nano /etc/apt/sources.list<br>--註釋其他內容，添加以下:<br>deb http:<span class=hljs-comment>//mirrors.ustc.edu.cn/raspbian/raspbian/raspbian stretch main contrib non-free rpi</span></code></pre><h4><strong><span>6.1.2 修改 raspi.list 文件</span></strong></h4><strong><span><br></span></strong><pre class="javascript hljs"><pre class="javascript hljs"><code class=javascript>sudo nano /etc/apt/sources.list.d/raspi.list<br>--註釋其他內容，添加以下:<br>deb http:<span class=hljs-comment>//mirrors.ustc.edu.cn/archive.raspberrypi.org/debian stretch main ui</span></code></pre><strong><span>6.1.3 執行更新</span></strong><strong><span><br></span></strong><pre class="javascript hljs"><code class=javascript>sudo apt-get update<br>sudo apt-get upgrade</code></pre></pre><h3><span><strong><span>6.2 修改時區</span></strong></span></h3><span><strong><span><br></span></strong></span><pre class="javascript hljs"><pre class="javascript hljs"><code class=javascript>sudo dpkg-reconfigure tzdata</code></pre></pre><span>找到亞洲 Asia，然後選擇 shanghai 就可以了。</span><span><br></span><h3><span><strong><span>6.3 開機自啟 ssh</span></strong></span></h3><span><br></span><span>第一種：</span><span><br></span><pre class="javascript hljs"><pre class="javascript hljs"><code class=javascript>sudo raspi-config</code></pre></pre><span>進入選擇找到 interfacing option 選擇，然後找到 ssh，按回車使能 enable 就可以了。</span><span><br></span><span>第二種：</span><span><br>在終端命令行中啟動 SSH 服務後，如果系統重啟或關機後啟動，SSH 服務默認是關閉的，依然需要手動啟動，為了方便可以設置 SSH 服務開機自動啟動，打開 /etc/rc.local 文件，在語句 exit 0 之前加入：</span><strong><span>/etc/init.d/ssh start</span></strong><span>建議都試試，反之我的是可以了。</span><h2><span><br></span></h2><h2><span><strong><span>7. 安裝 nginx</span></strong></span></h2><pre class="shell hljs vala"><span><br></span><pre class="shell hljs vala"><code class=shell><span class=hljs-meta>#安裝</span><br>sudo apt-<span class=hljs-keyword>get</span> install nginx<br><span class=hljs-meta>#啟動</span><br>sudo /etc/init.d/nginx start<br><span class=hljs-meta>#重啟</span><br>sudo /etc/init.d/nginx restart<br><span class=hljs-meta>#停止</span><br>sudo /etc/init.d/nginx stop</code></pre></pre><span>打開瀏覽器訪問 192.168.0.104</span><span>（你的樹莓派 ip 地址）</span><span>，可以看到 nginx 的頁面，說明安裝好了。</span><span><br>我這邊上傳了我的博客，如下圖</span><span><br></span><img alt=用樹莓派構建一臺服務器，永久運行網站 onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/0dc2706a806444c795a0ab2e2c2e8306><span><br></span><span>可以正常的看到頁面了，但是這樣只能在內網</span><span>（局域網中）</span><span>看到，我想讓所有人都可以訪問怎麼辦？</span><span><br></span><h2><span><strong><span>8. 內網穿透</span></strong></span></h2><span><strong><span><br></span></strong></span><span>內網穿透，意思就是將內網</span><span>（本地）</span><span>的 web 應用通過 nat 穿透到公網上，從而讓別人可以訪問到。</span><span><br></span><span>內網穿透目前主要由 ngrok 和 frp 兩種，都非常好用，國內 ngrok 免費的有 ittun、sunny 和 natapp，這三個都是免費的，前面兩個可以自定義域名，後面的需要 vip 版本才可以自定義域名。</span><span><br></span><span>我這三種都試過，我發現 sunny 的 arm 版本的 ngrok 客戶端在我的樹莓派運行不了，ittun 的和 natpp 的 ngrok 都可以，由於需要自定義域名，我使用的是 ittun 的 ngrok_arm 版本的。</span><span><br></span><span>使用方法這三者官網都有詳細說明，大家自行查看。</span><span><br></span><span>這是正常運行時的截圖，訪問 http://zerow.ittun.com/ 時可以...</span><span><br></span><img alt=用樹莓派構建一臺服務器，永久運行網站 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/73095064d27a4114af61f4b2cf4834fe><img alt=用樹莓派構建一臺服務器，永久運行網站 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/cacf1881eb88427c9d69affe2b6d842b><span>因為需要 ngrok 在後臺運行，所以我用的是 screen 會話使其可以在後臺運行。但是開啟自啟，還沒有實現，萬一斷電或者斷網了，我必須手動去運行一下 ngrok，這是目前沒有解決的痛點。</span><span><br></span><h2><strong><span>9. 更多</span></strong></h2><strong><span><br></span></strong><span>樹莓派不僅僅只是可以用於運行一個網站，還有很多很多的功能等待你的開發，可以多去看看樹莓派實驗室裡面，很多大神都寫了很多實用的教程。</span><span><br></span><span>我的 zero w 狀態信息如下：</span><span><br></span><img alt=用樹莓派構建一臺服務器，永久運行網站 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/946a6f9552e64520a4f2785799251677><span>在上面開啟了一個 nginx 和 ngrok 服務，內存剩餘還有 250MB，還是很舒服的，cpu 溫度也不算高，運行兩天了，基本在 37-39 之間。</span><span><br></span><img alt=用樹莓派構建一臺服務器，永久運行網站 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6f71e18666504a66b66ab9a933d261ad></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>用樹莓</a></li><li><a>派構</a></li><li><a>建一</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>