<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Lucene（全文檢索）進階-第二篇 | 极客快訊</title><meta property="og:title" content="Lucene（全文檢索）進階-第二篇 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/37d9000385d3ea9c9c67"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e3c80a1.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e3c80a1.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e3c80a1.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e3c80a1.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e3c80a1.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e3c80a1.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e3c80a1.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e3c80a1.html><meta property="article:published_time" content="2020-10-29T21:07:51+08:00"><meta property="article:modified_time" content="2020-10-29T21:07:51+08:00"><meta name=Keywords content><meta name=description content="Lucene（全文檢索）進階-第二篇"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/e3c80a1.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Lucene（全文檢索）進階-第二篇</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1>1.Lucene入門</h1><p>1.1. 需求</p><p>將數據庫中的圖書信息，創建為索引，然後去根據索引進行搜索。</p><p>1.2. Lucene準備</p><p>Lucene可以在官網上下載。我們使用的是4.10.3版本，如下圖：</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/37d9000385d3ea9c9c67></p><p>解壓後的效果：</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/37e20001a984373dd864></p><p>使用這三個文件的jar包，就可以實現lucene功能</p><p>使用的數據是MySQL數據庫的數據，所以還需要MySQL的連接包</p><p>如下圖：</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/37e00003b19d905fdc86></p><p>1.1. 開發環境</p><p>JDK： 1.7 （Lucene4.8以上，必須使用JDK1.7及以上版本）</p><p>IDE： eclipse Mars2</p><p>數據庫： MySQL</p><p>MySQL數據如下圖：</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/37df0003c00a79e872cc></p><p>1.1. 創建Java工程</p><p>創建java工程測試即可，效果如下：</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/37d800039bf2dbcceaf6></p><p>1.1. 索引流程</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/37d9000389a6c9f980d7></p><p><strong>IndexWriter</strong>是Lucene實現索引過程的核心組件，通過IndexWriter可以創建新索引、更新索引、刪除索引操作。IndexWriter需要通過Directory對索引進行存儲操作。</p><p><strong>Directory</strong>描述了索引的存儲位置，底層封裝了I/O操作，負責對索引進行存儲。它是一個抽象類，它的子類常用的包括</p><p>FSDirectory（在文件系統存儲索引）、RAMDirectory（在內存存儲索引）。</p><p>1.1.1. 數據採集</p><p>在電商網站中，全文檢索的數據源在數據庫中，需要通過jdbc訪問數據庫中book表的內容。</p><p>1.1.1.1. 創建pojo</p><p><strong>public</strong> <strong>class</strong> Book {</p><p>// 圖書ID</p><p><strong>private</strong> Integer id;</p><p>// 圖書名稱</p><p><strong>private</strong> String name;</p><p>// 圖書價格</p><p><strong>private</strong> Float price;</p><p>// 圖書圖片</p><p><strong>private</strong> String pic;</p><p>// 圖書描述</p><p><strong>private</strong> String description;</p><p>get/set。。。</p><p>}</p><p>1.1.1.2. 創建DAO接口</p><p><strong>public</strong> <strong>interface</strong> BookDao {</p><p>/**</p><p>* 查詢所有的book數據</p><p>* <strong>@return</strong></p><p>*/</p><p>List&lt;Book> queryBookList();</p><p>}</p><p>1.1.1.3. 創建DAO接口實現類</p><p>使用jdbc實現</p><p><strong>public</strong> <strong>class</strong> BookDaoImpl <strong>implements</strong> BookDao {</p><p>@Override</p><p><strong>public</strong> List&lt;Book> queryBookList() {</p><p>// 數據庫鏈接</p><p>Connection connection = <strong>null</strong>;</p><p>// 預編譯statement</p><p>PreparedStatement preparedStatement = <strong>null</strong>;</p><p>// 結果集</p><p>ResultSet resultSet = <strong>null</strong>;</p><p>// 圖書列表</p><p>List&lt;Book> list = <strong>new</strong> ArrayList&lt;Book>();</p><p><strong>try</strong> {</p><p>// 加載數據庫驅動</p><p>Class.forName("com.mysql.jdbc.Driver");</p><p>// 連接數據庫</p><p>connection = DriverManager.getConnection("jdbc:mysql://localhost:3306/solr", "root", "root");</p><p>// SQL語句</p><p>String sql = "SELECT * FROM book";</p><p>// 創建preparedStatement</p><p>preparedStatement = connection.prepareStatement(sql);</p><p>// 獲取結果集</p><p>resultSet = preparedStatement.executeQuery();</p><p>// 結果集解析</p><p><strong>while</strong> (resultSet.next()) {</p><p>Book book = <strong>new</strong> Book();</p><p>book.setId(resultSet.getInt("id"));</p><p>book.setName(resultSet.getString("name"));</p><p>book.setPrice(resultSet.getFloat("price"));</p><p>book.setPic(resultSet.getString("pic"));</p><p>book.setDesc(resultSet.getString("desc"));</p><p>list.add(book);</p><p>}</p><p>} <strong>catch</strong> (Exception e) {</p><p>e.printStackTrace();</p><p>}</p><p><strong>return</strong> list;</p><p>}</p><p>}</p><p>1.1.2. 實現索引流程</p><p>1. 採集數據</p><p>2. 創建Document文檔對象</p><p>3. 創建分析器（分詞器）</p><p>4. 創建IndexWriterConfig配置信息類</p><p>5. 創建Directory流對象，聲明索引庫存儲位置</p><p>6. 創建IndexWriter寫入對象</p><p>7. 把Document寫入到索引庫中</p><p>8. 釋放資源</p><p><strong>public</strong> <strong>class</strong> CreateIndexTest{</p><p>@Test</p><p><strong>public</strong> <strong>void</strong> testCreateIndex() <strong>throws</strong> Exception {</p><p>// 1. 採集數據</p><p>BookDao bookDao = <strong>new</strong> BookDaoImpl();</p><p>List&lt;Book> bookList = bookDao.queryBookList();</p><p>// 2. 創建Document文檔對象</p><p>List&lt;Document> documents = <strong>new</strong> ArrayList&lt;>();</p><p><strong>for</strong> (Book book : bookList) {</p><p>Document document = <strong>new</strong> Document();</p><p>// Document文檔中添加Field域</p><p>// 圖書Id</p><p>// Store.YES:表示存儲到文檔域中</p><p>document.add(<strong>new</strong> TextField("id", book.getId().toString(), Store.<strong>YES</strong>));</p><p>// 圖書名稱</p><p>document.add(<strong>new</strong> TextField("name", book.getName().toString(), Store.<strong>YES</strong>));</p><p>// 圖書價格</p><p>document.add(<strong>new</strong> TextField("price", book.getPrice().toString(), Store.<strong>YES</strong>));</p><p>// 圖書圖片地址</p><p>document.add(<strong>new</strong> TextField("pic", book.getPic().toString(), Store.<strong>YES</strong>));</p><p>// 圖書描述</p><p>document.add(<strong>new</strong> TextField("desc", book.getDesc().toString(), Store.<strong>YES</strong>));</p><p>// 把Document放到list中</p><p>documents.add(document);</p><p>}</p><p>// 3. 創建Analyzer分詞器,分析文檔，對文檔進行分詞</p><p>Analyzer analyzer = <strong>new</strong> StandardAnalyzer();</p><p>// 4. 創建Directory對象,聲明索引庫的位置</p><p>Directory directory = FSDirectory.open(<strong>new</strong> File("C:/itcast/lucene/index"));</p><p>// 5. 創建IndexWriteConfig對象，寫入索引需要的配置</p><p>IndexWriterConfig config = <strong>new</strong> IndexWriterConfig(Version.<strong>LUCENE_4_10_3</strong>, analyzer);</p><p>// 6.創建IndexWriter寫入對象</p><p>IndexWriter indexWriter = <strong>new</strong> IndexWriter(directory, config);</p><p>// 7.寫入到索引庫，通過IndexWriter添加文檔對象document</p><p><strong>for</strong> (Document doc : documents) {</p><p>indexWriter.addDocument(doc);</p><p>}</p><p>// 8.釋放資源</p><p>indexWriter.close();</p><p>}</p><p>}</p><p>執行效果：</p><p>在文件夾中出現了以下文件，表示創建索引成功</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/37e00003b3814e8a154a></p><p>1.1.1. 使用Luke查看索引</p><p>Luke作為Lucene工具包中的一個工具（http://www.getopt.org/luke/），可以通過界面來進行索引文件的查詢、修改</p><p>luke所在位置如下圖：</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/37df0003c1dbfa40863c></p><p>打開Luke方法：打開cmd命令行運行命令：java -jar lukeall-4.10.3.jar</p><p>打開後，使用如下圖：</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/37e20001ae0582c247b9></p><p>下圖是索引域的展示效果：</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/37e20001ae3a1d6ea0d8></p><p>下圖是文檔域展示效果</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/37d900038b177de577d9></p><p>1.1. 搜索流程</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/37e00003b4c267cf1451></p><p>1.1.1. 輸入查詢語句</p><p>Lucene可以通過<strong>Query</strong><strong>對象</strong>輸入查詢語句。同數據庫的sql一樣，lucene也有固定的查詢語法：</p><p>最基本的有比如：<strong>AND, OR, NOT</strong> 等（必須大寫）</p><p>舉個栗子:</p><p>用戶想找一個description中包括java關鍵字和lucene關鍵字的文檔。</p><p>它對應的查詢語句：description:java AND description:lucene</p><p>如下圖是使用luke搜索的例子：</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/37d900038baa84591b54></p><p>1.1.1. 搜索分詞</p><p>和索引過程的分詞一樣，這裡要對用戶輸入的關鍵字進行分詞，一般情況<strong>索引和搜索使用的分詞器一致</strong>。</p><p>比如：輸入搜索關鍵字“java學習”，分詞後為java和學習兩個詞，與java和學習有關的內容都搜索出來了，如下：</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/37d8000396a3acbac978></p><p>1.1.1. 代碼實現</p><p>1. 創建Query搜索對象</p><p>2. 創建Directory流對象,聲明索引庫位置</p><p>3. 創建索引讀取對象IndexReader</p><p>4. 創建索引搜索對象IndexSearcher</p><p>5. 使用索引搜索對象，執行搜索，返回結果集TopDocs</p><p>6. 解析結果集</p><p>7. 釋放資源</p><p>IndexSearcher搜索方法如下：</p><table><tbody><tr class=firstRow><td><p>方法</p></td><td><p>說明</p></td></tr><tr><td><p>indexSearcher.search(query, n)</p></td><td><p>根據Query搜索，返回評分最高的n條記錄</p></td></tr><tr><td><p>indexSearcher.search(query, filter, n)</p></td><td><p>根據Query搜索，添加過濾策略，返回評分最高的n條記錄</p></td></tr><tr><td><p>indexSearcher.search(query, n, sort)</p></td><td><p>根據Query搜索，添加排序策略，返回評分最高的n條記錄</p></td></tr><tr><td><p>indexSearcher.search(booleanQuery, filter, n, sort)</p></td><td><p>根據Query搜索，添加過濾策略，添加排序策略，返回評分最高的n條記錄</p></td></tr></tbody></table><p>代碼實現</p><p>public class SearchIndexTest {</p><p>@Test</p><p>public void testSearchIndex() throws Exception {</p><p>// 1. 創建Query搜索對象</p><p>// 創建分詞器</p><p>Analyzer analyzer = new StandardAnalyzer();</p><p>// 創建搜索解析器，第一個參數：默認Field域，第二個參數：分詞器</p><p>QueryParser queryParser = new QueryParser("description", analyzer);</p><p>// 創建搜索對象</p><p>Query query = queryParser.parse("description:java AND lucene");</p><p>// 2. 創建Directory流對象,聲明索引庫位置</p><p>Directory directory = FSDirectory.open(new File("C:/itcast/lucene/index"));</p><p>// 3. 創建索引讀取對象IndexReader</p><p>IndexReader reader = DirectoryReader.open(directory);</p><p>// 4. 創建索引搜索對象</p><p>IndexSearcher searcher = new IndexSearcher(reader);</p><p>// 5. 使用索引搜索對象，執行搜索，返回結果集TopDocs</p><p>// 第一個參數：搜索對象，第二個參數：返回的數據條數，指定查詢結果最頂部的n條數據返回</p><p>TopDocs topDocs = searcher.search(query, 10);</p><p>System.out.println("查詢到的數據總條數是：" + topDocs.totalHits);</p><p>// 獲取查詢結果集</p><p>ScoreDoc[] docs = topDocs.scoreDocs;</p><p>// 6. 解析結果集</p><p>for (ScoreDoc scoreDoc : docs) {</p><p>// 獲取文檔</p><p>int docID = scoreDoc.doc;</p><p>Document doc = searcher.doc(docID);</p><p>System.out.println("=============================");</p><p>System.out.println("docID:" + docID);</p><p>System.out.println("bookId:" + doc.get("id"));</p><p>System.out.println("name:" + doc.get("name"));</p><p>System.out.println("price:" + doc.get("price"));</p><p>System.out.println("pic:" + doc.get("pic"));</p><p>// System.out.println("description:" + doc.get("description"));</p><p>}</p><p>// 7. 釋放資源</p><p>reader.close();</p><p>}</p><p>}</p><h1>1.分詞器</h1><p>1.1. 分詞理解</p><p>在對Docuemnt中的內容進行索引之前，需要使用分詞器進行分詞 ，分詞的目的是為了搜索。分詞的主要過程就是先分詞後過濾。</p><p>l分詞：採集到的數據會存儲到document對象的Field域中，分詞就是將Document中Field的值切分成一個一個的詞。</p><p>l過濾：包括去除標點符號過濾、去除停用詞過濾（的、是、a、an、the等）、大寫轉小寫、詞的形還原（複數形式轉成單數形參、過去式轉成現在式。。。）等。</p><p>什麼是停用詞？停用詞是為節省存儲空間和提高搜索效率，搜索引擎在索引頁面或處理搜索請求時會自動忽略某些字或詞，這些字或詞即被稱為Stop Words(停用詞)。比如語氣助詞、副詞、介詞、連接詞等，通常自身並無明確的意義，只有將其放入一個完整的句子中才有一定作用，如常見的“的”、“在”、“是”、“啊”等。</p><p>對於分詞來說，不同的語言，分詞規則不同。Lucene作為一個工具包提供不同國家的分詞器，本例子使用StandardAnalyzer，它可以對用英文進行分詞。</p><p>如下是org.apache.lucene.analysis.standard.standardAnalyzer的部分源碼：</p><p>@Override</p><p><strong>protected</strong> TokenStreamComponents createComponents(<strong>final</strong> String fieldName, <strong>final</strong> Reader reader) {</p><p><strong>final</strong> StandardTokenizer src = <strong>new</strong> StandardTokenizer(getVersion(), reader);</p><p>src.setMaxTokenLength(maxTokenLength);</p><p>TokenStream tok = <strong>new</strong> StandardFilter(getVersion(), src);</p><p>tok = <strong>new</strong> LowerCaseFilter(getVersion(), tok);</p><p>tok = <strong>new</strong> StopFilter(getVersion(), tok, stopwords);</p><p><strong>return</strong> <strong>new</strong> TokenStreamComponents(src, tok) {</p><p>@Override</p><p><strong>protected</strong> <strong>void</strong> setReader(<strong>final</strong> Reader reader) <strong>throws</strong> IOException {</p><p>src.setMaxTokenLength(StandardAnalyzer.<strong>this</strong>.maxTokenLength);</p><p><strong>super</strong>.setReader(reader);</p><p>}</p><p>};</p><p>}</p><p>Tokenizer就是分詞器，負責將reader轉換為語彙單元即進行分詞處理，Lucene提供了很多的分詞器，也可以使用第三方的分詞，比如IKAnalyzer一箇中文分詞器。</p><p>TokenFilter是分詞過濾器，負責對語彙單元進行過濾，TokenFilter可以是一個過濾器鏈兒，Lucene提供了很多的分詞器過濾器，比如大小寫轉換、去除停用詞等。</p><p>如下圖是語彙單元的生成過程：</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/37d8000396fd8b94798b></p><p>從一個Reader字符流開始，創建一個基於Reader的Tokenizer分詞器，經過三個TokenFilter生成語彙單元Token。</p><p>比如下邊的文檔經過分析器分析如下：</p><p>Ø原文檔內容：</p><table><tbody><tr class=firstRow><td><p>Lucene is a Java full-text search engine.</p></td></tr></tbody></table><p>Ø分析後得到的多個語彙單元：</p><table><tbody><tr class=firstRow><td><p>lucene 、java、full、text、search、engine</p></td></tr></tbody></table><p>1.1. Analyzer使用時機</p><p>1.1.1. 索引時使用Analyzer</p><p>輸入關鍵字進行搜索，當需要讓該關鍵字與文檔域內容所包含的詞進行匹配時需要對文檔域內容進行分析，需要經過Analyzer分析器處理生成語彙單元（Token）。分析器分析的對象是文檔中的Field域。當Field的屬性tokenized（是否分詞）為true時會對Field值進行分析，如下圖：</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/37df0003c40ee07cfe18></p><p>對於一些Field可以不用分析：</p><p>1、不作為查詢條件的內容，比如文件路徑</p><p>2、不是匹配內容中的詞而匹配Field的整體內容，比如訂單號、身份證號等。</p><p>1.1.1. 搜索時使用Analyzer</p><p>對搜索關鍵字進行分析和索引分析一樣，使用Analyzer對搜索關鍵字進行分析、分詞處理，使用分析後每個詞語進行搜索。比如：搜索關鍵字：spring web ，經過分析器進行分詞，得出：spring web拿詞去索引詞典表查找 ，找到索引鏈接到Document，解析Document內容。</p><p>對於匹配整體Field域的查詢可以在搜索時不分析，比如根據訂單號、身份證號查詢等。</p><p><strong></strong><strong>注意：搜索使用的分析器要和索引使用的分析器一致。</strong></p><p>1.2. 中文分詞器</p><p>1.2.1. 什麼是中文分詞器</p><p>學過英文的都知道，英文是以單詞為單位的，單詞與單詞之間以空格或者逗號句號隔開。所以對於英文，我們可以簡單以空格判斷某個字符串是否為一個單詞，比如I love China，love 和 China很容易被程序區分開來。</p><p>而中文則以字為單位，字又組成詞，字和詞再組成句子。中文“我愛中國”就不一樣了，電腦不知道“中國”是一個詞語還是“愛中”是一個詞語。</p><p><strong>把中文的句子切分成有意義的詞，就是中文分詞，也稱切詞</strong>。我愛中國，分詞的結果是：我、愛、中國。</p><p>1.2.2. Lucene自帶中文分詞器</p><p>lStandardAnalyzer：</p><p>單字分詞：就是按照中文一個字一個字地進行分詞。如：“我愛中國”，</p><p>效果：“我”、“愛”、“中”、“國”。</p><p>lCJKAnalyzer</p><p>二分法分詞：按兩個字進行切分。如：“我是中國人”，效果：“我是”、“是中”、“中國”“國人”。</p><p>上邊兩個分詞器無法滿足需求。</p><p>lSmartChineseAnalyzer</p><p>對中文支持較好，但擴展性差，擴展詞庫，禁用詞庫和同義詞庫等不好處理</p><p>1.3. 第三方中文分詞器</p><p>lpaoding： 庖丁解牛最新版在 https://code.google.com/p/paoding/ 中最多支持Lucene 3.0，且最新提交的代碼在 2008-06-03，在svn中最新也是2010年提交，已經過時，不予考慮。</p><p>lmmseg4j：最新版已從 https://code.google.com/p/mmseg4j/ 移至 https://github.com/chenlb/mmseg4j-solr，支持Lucene 4.10，且在github中最新提交代碼是2014年6月，從09年～14年一共有：18個版本，也就是一年幾乎有3個大小版本，有較大的活躍度，用了mmseg算法。</p><p>l<strong>IK-analyzer</strong>： 最新版在https://code.google.com/p/ik-analyzer/上，支持Lucene 4.10從2006年12月推出1.0版開始， IKAnalyzer已經推出了4個大版本。最初，它是以開源項目Luence為應用主體的，結合詞典分詞和文法分析算法的中文分詞組件。從3.0版本開 始，IK發展為面向Java的公用分詞組件，獨立於Lucene項目，同時提供了對Lucene的默認優化實現。在2012版本中，IK實現了簡單的分詞 歧義排除算法，標誌著IK分詞器從單純的詞典分詞向模擬語義分詞衍化。 但是也就是2012年12月後沒有在更新。</p><p>lansj_seg：最新版本在 https://github.com/NLPchina/ansj_seg tags僅有1.1版本，從2012年到2014年更新了大小6次，但是作者本人在2014年10月10日說明：“可能我以後沒有精力來維護ansj_seg了”，現在由”nlp_china”管理。2014年11月有更新。並未說明是否支持Lucene，是一個由CRF（條件隨機場）算法所做的分詞算法。</p><p>limdict-chinese-analyzer：最新版在 https://code.google.com/p/imdict-chinese-analyzer/ ， 最新更新也在2009年5月，下載源碼，不支持Lucene 4.10 。是利用HMM（隱馬爾科夫鏈）算法。</p><p>lJcseg：最新版本在git.oschina.net/lionsoul/jcseg，支持Lucene 4.10，作者有較高的活躍度。利用mmseg算法。</p><p>1.4. 使用中文分詞器IKAnalyzer</p><p>IKAnalyzer繼承Lucene的Analyzer抽象類，使用IKAnalyzer和Lucene自帶的分析器方法一樣，將Analyzer測試代碼改為IKAnalyzer測試中文分詞效果。</p><p>如果使用中文分詞器ik-analyzer，就需要在索引和搜索程序中使用一致的分詞器：IK-analyzer。</p><p>1.4.1. 添加jar包</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/37df0003c44d3d172f9c></p><p>1.1.1. 修改分詞器代碼</p><p>@Test</p><p><strong>public</strong> <strong>void</strong> testCreateIndex() <strong>throws</strong> Exception {</p><p>// 1. 採集數據</p><p>BookDao bookDao = <strong>new</strong> BookDaoImpl();</p><p>List&lt;Book> bookList = bookDao.queryBookList();</p><p>// 2. 創建Document文檔對象</p><p>List&lt;Document> documents = <strong>new</strong> ArrayList&lt;>();</p><p><strong>for</strong> (Book book : bookList) {</p><p>Document document = <strong>new</strong> Document();</p><p>// Document文檔中添加Field域</p><p>// 圖書Id</p><p>// Store.YES:表示存儲到文檔域中</p><p>document.add(<strong>new</strong> TextField("id", book.getId().toString(), Store.<strong>YES</strong>));</p><p>// 圖書名稱</p><p>document.add(<strong>new</strong> TextField("name", book.getName().toString(), Store.<strong>YES</strong>));</p><p>// 圖書價格</p><p>document.add(<strong>new</strong> TextField("price", book.getPrice().toString(), Store.<strong>YES</strong>));</p><p>// 圖書圖片地址</p><p>document.add(<strong>new</strong> TextField("pic", book.getPic().toString(), Store.<strong>YES</strong>));</p><p>// 圖書描述</p><p>document.add(<strong>new</strong> TextField("description", book.getDescription().toString(), Store.<strong>YES</strong>));</p><p>// 把Document放到list中</p><p>documents.add(document);</p><p>}</p><p>// 3. 創建Analyzer分詞器,分析文檔，對文檔進行分詞</p><p>// Analyzer analyzer = new StandardAnalyzer();</p><p>Analyzer analyzer = <strong>new</strong> IKAnalyzer();</p><p>// 4. 創建Directory對象,聲明索引庫的位置</p><p>Directory directory = FSDirectory.open(<strong>new</strong> File("C:/itcast/lucene/index"));</p><p>// 5. 創建IndexWriteConfig對象，寫入索引需要的配置</p><p>IndexWriterConfig config = <strong>new</strong> IndexWriterConfig(Version.<strong>LUCENE_4_10_3</strong>, analyzer);</p><p>// 6.創建IndexWriter寫入對象</p><p>IndexWriter indexWriter = <strong>new</strong> IndexWriter(directory, config);</p><p>// 7.寫入到索引庫，通過IndexWriter添加文檔對象document</p><p><strong>for</strong> (Document doc : documents) {</p><p>indexWriter.addDocument(doc);</p><p>}</p><p>// 8.釋放資源</p><p>indexWriter.close();</p><p>}</p><p>1.2. 擴展中文詞庫</p><p>如果想配置擴展詞和停用詞，就創建擴展詞的文件和停用詞的文件。</p><p>注意：不要用window自帶的記事本保存擴展詞文件和停用詞文件，那樣的話，格式中是含有bom的。</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/37dd0001db20abeceb0e></p><p>從ikanalyzer包中拷貝配置文件</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/37df0003c5003936cc5a></p><p>拷貝到資源文件夾中</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/37d900038e2c5f8d9993></p><p>IKAnalyzer.cfg.xml配置文件</p><p>&lt;?xml version="1.0" encoding="UTF-8"?></p><p>&lt;!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd"></p><p>&lt;properties></p><p>&lt;comment>IK Analyzer 擴展配置&lt;/comment></p><p>&lt;!--用戶可以在這裡配置自己的擴展字典 --></p><p>&lt;entry key="ext_dict">ext.dic;&lt;/entry></p><p>&lt;!--用戶可以在這裡配置自己的擴展停止詞字典--></p><p>&lt;entry key="ext_stopwords">stopword.dic;&lt;/entry></p><p>&lt;/properties></p><p>中文詞庫，添加新詞的地方</p><p>最終分詞效果</p><p><img alt=Lucene（全文檢索）進階-第二篇 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/37d800039a7c1c7bb4c7></p><p>持續發佈中，敬請關注。如有問題，歡迎交流指正。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Lucene</a></li><li><a>檢索</a></li><li><a>進階</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/4e632b6e.html alt=PHP進階教程-PHP的協程怎麼玩？這一篇帶你搞定swoole協程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a646cf102cf74b4a953855ebedbc7d29 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4e632b6e.html title=PHP進階教程-PHP的協程怎麼玩？這一篇帶你搞定swoole協程>PHP進階教程-PHP的協程怎麼玩？這一篇帶你搞定swoole協程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cd56e2f3.html alt=PHP進階教程-PHP還能玩多線程？看我怎麼用多線程實現CC攻擊器。 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/cce9b3fb23ce41b88311823510e419da style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cd56e2f3.html title=PHP進階教程-PHP還能玩多線程？看我怎麼用多線程實現CC攻擊器。>PHP進階教程-PHP還能玩多線程？看我怎麼用多線程實現CC攻擊器。</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/637cf111.html alt=PHP進階教程-phper需要知道常駐內存中的上下文是什麼東西 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/bc66832213514f2996f2e48c9e9cc747 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/637cf111.html title=PHP進階教程-phper需要知道常駐內存中的上下文是什麼東西>PHP進階教程-phper需要知道常駐內存中的上下文是什麼東西</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e3b6719c.html alt=PHP進階教程-一文理解和實現現代PHP框架裡的IOC容器 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/423ce7eefc5d433f86a14589b1ba0043 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e3b6719c.html title=PHP進階教程-一文理解和實現現代PHP框架裡的IOC容器>PHP進階教程-一文理解和實現現代PHP框架裡的IOC容器</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fe9184d7.html alt=PHP進階教程-實現一個簡單的MySQL連接池 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/aa2df096a4274ba1b5c8540bcb5b5c73 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fe9184d7.html title=PHP進階教程-實現一個簡單的MySQL連接池>PHP進階教程-實現一個簡單的MySQL連接池</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/45c31c17.html alt=PHP進階教程-設計模式之建造者模式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ef25f91086df41eca76e35ff3434b003 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/45c31c17.html title=PHP進階教程-設計模式之建造者模式>PHP進階教程-設計模式之建造者模式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b034084e.html alt=PHP進階教程-設計模式之橋接模式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/3719c139b93342fe9e5526fa59ca1c89 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b034084e.html title=PHP進階教程-設計模式之橋接模式>PHP進階教程-設計模式之橋接模式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a89954da.html alt=PHP進階教程-設計模式之組合模式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6f2acee37d624649ac7a592bfe5b29af style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a89954da.html title=PHP進階教程-設計模式之組合模式>PHP進階教程-設計模式之組合模式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/baec5ab6.html alt=PHP進階教程-設計模式之裝飾器模式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8cbbfcfedd544572a62adc6df84d2e60 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/baec5ab6.html title=PHP進階教程-設計模式之裝飾器模式>PHP進階教程-設計模式之裝飾器模式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7d369518.html alt="WWW 2020 | 用於圖像檢索的等距離等分佈三元組損失函數" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/Rw8d6J11AAULRN style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7d369518.html title="WWW 2020 | 用於圖像檢索的等距離等分佈三元組損失函數">WWW 2020 | 用於圖像檢索的等距離等分佈三元組損失函數</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0ef4a8fd.html alt=「網工進階」路由交換：鏈路聚合的配置，你都會嗎 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f5b7228828484a249973d030a8ae92a6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0ef4a8fd.html title=「網工進階」路由交換：鏈路聚合的配置，你都會嗎>「網工進階」路由交換：鏈路聚合的配置，你都會嗎</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c8c89331.html alt=描述統計學上的一些基本概念（二）——投資技能進階 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/6586a65a-a953-4eae-a29b-ea386ca13f79 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c8c89331.html title=描述統計學上的一些基本概念（二）——投資技能進階>描述統計學上的一些基本概念（二）——投資技能進階</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a62070b8.html alt=「N合1服務器進階指南」，搞定NAS部署軟路由雙線寬帶接入 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2d4fdb792a3c4e6fa2819e6193ddc980 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a62070b8.html title=「N合1服務器進階指南」，搞定NAS部署軟路由雙線寬帶接入>「N合1服務器進階指南」，搞定NAS部署軟路由雙線寬帶接入</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a60faf0f.html alt=醫生的等級與修煉進階 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c3894a8f37e742f7a5eade6debed4329 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a60faf0f.html title=醫生的等級與修煉進階>醫生的等級與修煉進階</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a1734e9b.html alt=高手進階：如何設計注塑機螺桿 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/fe34d1371034410f8c0470cb1a6b36eb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a1734e9b.html title=高手進階：如何設計注塑機螺桿>高手進階：如何設計注塑機螺桿</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>