<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>java日誌規約及配置示例終極總結 | 极客快訊</title><meta property="og:title" content="java日誌規約及配置示例終極總結 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/0c37161f872e469b9ce6b306c9ae6042"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e88aa42.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e88aa42.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e88aa42.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e88aa42.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e88aa42.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e88aa42.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/e88aa42.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/e88aa42.html><meta property="article:published_time" content="2020-10-29T21:01:26+08:00"><meta property="article:modified_time" content="2020-10-29T21:01:26+08:00"><meta name=Keywords content><meta name=description content="java日誌規約及配置示例終極總結"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/e88aa42.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>java日誌規約及配置示例終極總結</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><h1 class=ql-align-justify><strong>1、什麼是日誌？</strong></h1><p class=ql-align-justify>簡單的說，日誌就是記錄程序的運行軌跡，方便查找關鍵信息，也方便快速定位解決問題。我們 Java 程序員在開發項目時都是依賴 Eclipse/ Idea 等開發工具的 Debug 調試功能來跟蹤解決 Bug，在開發環境可以這麼做，但項目發佈到了測試、生產環境呢？你有可能會說可以使用遠程調試，但實際並不能允許讓你這麼做。所以，日誌的作用就是在測試、生產環境沒有 Debug 調試工具時開發、測試人員定位問題的手段。日誌打得好，就能根據日誌的軌跡快速定位並解決線上問題，反之，日誌輸出不好不能定位到問題不說反而會影響系統的性能。優秀的項目都是能根據日誌定位問題的，而不是在線調試，或者半天找不到有用的日誌。</p><h1 class=ql-align-justify><strong>2、常用日誌框架</strong></h1><p class=ql-align-justify>如果想學習Java工程化、高性能及分佈式、深入淺出。微服務、Spring，MyBatis，Netty源碼分析的朋友可以加我的Java高級交流：854630135，群裡有阿里大牛直播講解技術，以及Java大型互聯網技術的視頻免費分享給大家。</p><p class=ql-align-justify>log4j、Logging、commons-logging、slf4j、logback，開發的同學對這幾個日誌相關的技術不陌生吧，為什麼有這麼多日誌技術，它們都是什麼區別和聯繫呢？相信大多數人搞不清楚它們的關係，下面我將一一介紹一下，以後大家再也不用傻傻分不清楚了。</p><p class=ql-align-justify><strong>Logging 【java 自帶工具】</strong></p><p class=ql-align-justify>這是 Java 自帶的日誌工具類，在 JDK 1.5 開始就已經有了，在java.util.logging 包下。</p><p class=ql-align-justify><strong>Log4j 【框架實現】</strong></p><p class=ql-align-justify>Log4j 是 Apache 的一個開源日誌框架，也是市場佔有率最多的一個框架。大多數沒用過 Java Logging， 但沒人敢說沒用過 Log4j 吧，反正從我接觸 Java 開始就是這種情況，做 Java 項目必有 Log4j 日誌框架。注意：log4j 在 2015/08/05 這一天被 Apache 宣佈停止維護了，用戶需要切換到 Log4j2上面去。</p><p class=ql-align-justify><em>下面是官方宣佈原文</em></p><p class=ql-align-justify>On August 5, 2015 the Logging Services Project Management Committee announced that Log4j 1.x had reached end of life. For complete text of the announcement please see the Apache Blog. Users of Log4j 1 are recommended to upgrade to Apache Log4j 2.</p><p class=ql-align-justify><strong>Commons-logging 【日誌接口】</strong></p><p class=ql-align-justify>上面介紹的 log4j 是一個具體的日誌框架的實現，而 commons-logging 就是日誌門面接口，它也是 apache 最早提供的日誌門面接口，用戶可以根據喜好選擇不同的日誌實現框架，而不必改動日誌定義，這就是日誌門面的好處，符合面向接口抽象編程。</p><p class=ql-align-justify><strong>Slf4j 【日誌接口】</strong></p><p class=ql-align-justify>全稱：Simple Logging Facade for Java，即簡單日誌門面接口，和 Apache 的 commons-logging是一樣的概念，它們都不是具體的日誌框架，你可以指定其他主流的日誌實現框架。Slf4j也是現在主流的日誌門面框架，使用Slf4j可以很靈活的使用佔位符進行參數佔位，簡化代碼，擁有更好的可讀性，這個後面會講到。</p><p class=ql-align-justify><strong>Logback 【框架實現】</strong></p><p class=ql-align-justify>Logback 是 Slf4j 的原生實現框架，同樣也是出自 Log4j一個人之手，但擁有比log4j更多的優點、特性和更做強的性能，現在基本都用來代替 log4j 成為主流。</p><p class=ql-align-justify><strong>日誌框架總結</strong></p><ol><li class=ql-align-justify>commons-loggin、slf4j 只是一種日誌抽象門面，不是具體的日誌框架。</li><li class=ql-align-justify>log4j、logback 是具體的日誌實現框架。</li><li class=ql-align-justify>一般首選強烈推薦使用 slf4j + logback。當然也可以使用slf4j + log4j、commons-logging + log4j 這兩種日誌組合框架。</li></ol><h1 class=ql-align-justify><strong>3、日誌級別詳解</strong></h1><p class=ql-align-justify>日誌的輸出都是分級別的，不同的設置不同的場合打印不同的日誌。下面拿最普遍用的 Log4j 日誌框架來做個日誌級別的說明，這個也比較全面，其他的日誌框架也都大同小異。Log4j 的級別類 org.apache.log4j.Level 裡面定義了日誌級別，日誌輸出優先級由高到底分別為以下8種。</p><p class=ql-align-justify><strong>日誌級別及描述</strong></p><ul><li class=ql-align-justify>ERROR：系統發生了錯誤事件，但仍然不影響系統的繼續運行。系統需要將錯誤或異常細節記錄ERROR日誌中，方便後續人工回溯解決。</li><li class=ql-align-justify>WARN： 系統在業務處理時觸發了異常流程(參數驗證不過)，但系統可恢復到正常態，下一次業務可以正常執行。如程序調用了一箇舊版本的接口，可選參數不合法，非業務預期的狀態但仍可繼續處理等</li><li class=ql-align-justify>INFO： 記錄系統關鍵信息，旨在保留系統正常工作期間關鍵運行指標，開發人員可以將初始化系統配置、業務狀態變化信息，或者用戶業務流程中的核心處理記錄到INFO日誌中，方便日常運維工作以及錯誤回溯時上下文場景復現</li><li class=ql-align-justify>DEBUG： 可以將各類詳細信息記錄到DEBUG裡，起到調試的作用，包括參數信息，調試細節信息，返回值信息等。</li></ul><p class=ql-align-justify><strong>日誌優先級別標準順序</strong></p><p class=ql-align-justify>ALL &lt; TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL &lt; OFF</p><p class=ql-align-justify><strong>設置級別和打印級別的關係</strong></p><p class=ql-align-justify>如果日誌級別設置 INFO，只有輸出級別為 INFO、WARN，後面的日誌才會正常輸出。</p><h1 class=ql-align-justify><strong>4、日誌的記錄時機</strong></h1><p class=ql-align-justify><strong>系統初始化</strong></p><p class=ql-align-justify>系統初始化時會依賴一些關鍵配置，根據參數不同會提供不一樣的服務。將系統的啟動參數記錄INFO日誌，打印出參數以及服務啟動完成狀態。</p><p class=ql-align-justify><strong>業務流程與預期不符</strong></p><p class=ql-align-justify>系統中結果與期望不符，應當記錄日誌。常見的合適場景包括外部參數不正確，數據處理問題導致返回碼不在合理範圍內等等。</p><p class=ql-align-justify><strong>系統核心的關鍵動作</strong></p><p class=ql-align-justify>系統中核心角色觸發的業務動作是需要多加關注的，是衡量系統正常運行的重要指標，建議記錄INFO級別日誌，比如微服務各服務節點交互等。</p><p class=ql-align-justify><strong>捕獲到異常時</strong></p><p class=ql-align-justify>這類捕獲的異常是系統告知開發人員需要加以關注的，應當記錄日誌，根據實際情況使用warn或者error級別。</p><p class=ql-align-justify><strong>外部接口日誌</strong></p><p class=ql-align-justify>這類日誌涉及到與外部系統的交互，事關責任問題，建議將原始數據文件內容寫入日誌或數據庫（如mongodb），核心處理邏輯關鍵業務數據也儘量寫入日誌。如果涉及到重發，建議將處理失敗的原始數據文件日誌寫入數據庫，以便重發執行。</p><h1 class=ql-align-justify><strong>5、日誌使用規約</strong></h1><ul><li class=ql-align-justify>使用@SLF4J中的API進行日誌打印。</li><li class=ql-align-justify>日誌輸出必須採用UTF-8字符集，推薦打印日誌時輸出英文，防止中文不支持而打印出亂碼的情況。</li><li class=ql-align-justify>不允許記錄日誌後又拋出異常，因為這樣會多次記錄日誌，只允許記錄一次日誌，應拋出異常，頂層打印一次日誌。</li></ul><p class=ql-align-right><br></p><pre>try { // 錯誤} catch (Exception e) { log.error("xxxxxx", e); throw e；}</pre><ul><li class=ql-align-justify>輸出Exceptions的全部堆棧信息，但是不能使用e.printStackTrace()</li></ul><p class=ql-align-right><br></p><pre>// 錯誤例子, 丟失掉StackTrace信息log.error(e.getMessage());// 錯誤例子,丟失掉StackTrace信息log.error(“Bad things : {}“, e.getMessage());// 正確例子log.error(“Bad things : {}“,e); // e.printStackTrace()的源碼public void printStackTrace() { printStackTrace(System.err);}</pre><ul><li class=ql-align-justify>禁止system.out 用於日誌記錄。</li><li class=ql-align-justify>線上必須關閉 DEBUG 級別日誌。</li><li class=ql-align-justify>非正常的情況，需要根據情況選擇打印warn 或 error 日誌,不能使用錯誤的日誌級別。</li></ul><p class=ql-align-right><br></p><pre>try {// ...} catch (Exception e) {// 錯誤LOG.info("XX 發生異常...", e);}// 用 info 記錄 error 日誌，日誌輸出到了 info 日誌文件中了，</pre><p>同事拼命地在 error 錯誤日誌文件裡 面找怎麼能找到呢？</p><ul><li class=ql-align-justify>日誌輸出，必須使用佔位符的方式，因為即使信息不打印，也會執行字符串拼接，造成資源浪費。</li><li class=ql-align-justify>日誌中不允許出現計算或方法調用，防止在打印日誌的時候報錯。</li><li class=ql-align-justify>輸出的POJO類必須重寫toString方法，否則只輸出對象的hashCode值，沒有參考意義。</li></ul><pre class=ql-align-justify>不記錄對於排查故障毫無意義的日誌信息，日誌信息一定要帶有業務信息。//錯誤log.error(“handle failed“);//正確log.error(“handle failed，id= {}“, id);</pre><ul><li class=ql-align-justify>禁止大量無效重複的日誌輸出，通常情況下在程序日誌只記錄一些有意義的狀態數據，參考日誌記錄時機。</li><li class=ql-align-justify>不可以講敏感業務信息記錄入日誌文件。</li><li class=ql-align-justify>嚴防日誌佔滿磁盤，定期檢查磁盤（確定是否有磁盤告警）。</li><li class=ql-align-justify>不要在千層循環中打印日誌</li></ul><pre>for(int i=0; i&lt;2000; i++){LOG.info("XX");}</pre><p>// 這個是什麼意思，如果你的框架使用了性能不高的 Log4j 框架，</p><p>那就不要在上千個 for 循環中打印日誌，</p><p>// 這樣可能會拖垮你的應用程序，如果你的程序響應時間變慢，</p><p>那要考慮是不是日誌打印的過多了。</p><h1 class=ql-align-justify><strong>6、logback配置參考</strong></h1><p class=ql-align-justify><strong>配置說明</strong></p><ul><li class=ql-align-justify>統一使用logback.xml配置，logback.xml 文件放在 classpath 目錄下。</li><li class=ql-align-justify>所有的jar包中不建議包含logback.xml文件，避免干擾實際的業務系統。</li><li class=ql-align-justify>通過在文件logback.xml中引入資源文件log.properties定義logback屬性信息，log.properties根據不同的profile放置在不同位置；</li></ul><pre>&lt;property resource="log.properties"/&gt;</pre><ul><li class=ql-align-justify>log.properties文件</li><li class=ql-align-justify>屬性命名推薦使用統一使用大寫，以下劃線分隔，參考</li></ul><p class=ql-align-right>如果想學習Java工程化、高性能及分佈式、深入淺出。微服務、Spring，MyBatis，Netty源碼分析的朋友可以加我的Java高級交流：854630135，群裡有阿里大牛直播講解技術，以及Java大型互聯網技術的視頻免費分享給大家。</p><pre>APP_NAME = yourAppNameLOG_DIR = /export/home/logs/yourSystem/yourAppNameLOG_PATTERN = [%date{yyyy-MM-dd HH:mm:ss.SSS}] %level [%mdc{invokeNo}] %C{0}:%line - %message%n</pre><ul><li class=ql-align-justify>注意Logger間的繼承關係，推薦additivity設置false;</li></ul><ol><li class=ql-align-justify>子logger會默認繼承父logger的appender，將它們加入到自己的Appender中；除非加上了additivity="false"，則不再繼承父logger的appender。</li><li class=ql-align-justify>子logger只在自己未定義輸出級別的情況下，才會繼承父logger的輸出級別。</li></ol><ul><li class=ql-align-justify>將日誌輸出到文件當中，禁止使用FileAppender，推薦使用提供自動切換功能的RollingFileAppender Log文件位置和命名，目前Log文件的位置統一放在相同目錄下面。</li></ul><div class=pgc-img><img alt=java日誌規約及配置示例終極總結 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/0c37161f872e469b9ce6b306c9ae6042><p class=pgc-img-caption></p></div><ul><li class=ql-align-justify>日誌按天記錄，單個日誌文件最大不超過2000MB，考慮到有些bug按月規律出現，推薦歷史日誌保留30天。</li></ul><p class=ql-align-justify><br></p><pre class=ql-align-justify>&lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;　　&lt;fileNamePattern&gt;${LOG_DIR}/all-%d{yyyy-MM-dd}.log&lt;/fileNamePattern&gt;　　&lt;maxHistory&gt;30&lt;/maxHistory&gt;　　&lt;timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"&gt;　　&lt;maxFileSize&gt;2000MB&lt;/maxFileSize&gt;　　&lt;/timeBasedFileNamingAndTriggeringPolicy&gt;&lt;/rollingPolicy&gt;</pre><p class=ql-align-justify><br></p><ul><li class=ql-align-justify>在出現問題之後，需要立即根據日誌定位問題。對於INFO及以上級別的日誌，要求按照一定順序，輸出以下必要的信息。參考日誌格式定義</li></ul><pre class=ql-align-justify>&lt;encoder charset="UTF-8"&gt;　　&lt;pattern&gt;[%date{yyyy-MM-dd HH:mm:ss.SSS}] %level 　　[%mdc{invokeNo}] %C{0}:%line - %message%n&lt;/pattern&gt;&lt;/encoder&gt;</pre><ul><li class=ql-align-justify>一個完整的Appender配置如下</li></ul><p class=ql-align-justify><br></p><pre class=ql-align-justify>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;configuration&gt;　　&lt;property resource="log.properties"/&gt; 　　&lt;contextName&gt;${APP_NAME}&lt;/contextName&gt; 　　&lt;appender name="console" class="ch.qos.logback.core.ConsoleAppender"&gt;　　　　&lt;encoder charset="UTF-8"&gt;　　　　　　&lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt;　　　　&lt;/encoder&gt;　　&lt;/appender&gt;&lt;appender name="all" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;　　&lt;file&gt;${LOG_DIR}/all.log&lt;/file&gt;　　&lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;　　　　&lt;fileNamePattern&gt;${LOG_DIR}/all-%d{yyyy-MM-dd}.%i.log&lt;/fileNamePattern&gt;　　　　&lt;maxHistory&gt;30&lt;/maxHistory&gt;　　　　&lt;timeBasedFileNamingAndTriggeringPolicy 　　　　　　class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"&gt; 　　　　　　&lt;maxFileSize&gt;2000MB&lt;/maxFileSize&gt; &lt;!-- 每個日誌文件大小不超過2GB --&gt;　　　　&lt;/timeBasedFileNamingAndTriggeringPolicy&gt;　　&lt;/rollingPolicy&gt;　　&lt;encoder charset="UTF-8"&gt;　　　　&lt;pattern&gt;${LOG_PATTERN}&lt;/pattern&gt;　　&lt;/encoder&gt;　　&lt;filter class="ch.qos.logback.classic.filter.ThresholdFilter"&gt;　　　　&lt;level&gt;info&lt;/level&gt;　　&lt;/filter&gt;&lt;/appender&gt;&lt;appender name="all-error" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;　　&lt;file&gt;${LOG_DIR}/all-error.log&lt;/file&gt;　　&lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt;　　　　&lt;level&gt;ERROR&lt;/level&gt;　　　　&lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;　　　　&lt;onMismatch&gt;DENY&lt;/onMismatch&gt;　　&lt;/filter&gt;　　&lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;　　　　&lt;fileNamePattern&gt;　　　　　　${LOG_DIR}/all-error-%d{yyyy-MM-dd}.%i.log 　　　　&lt;/fileNamePattern&gt;　　　　&lt;maxHistory&gt;30&lt;/maxHistory&gt;　　　　&lt;timeBasedFileNamingAndTriggeringPolicy　　　　　 class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"&gt;　　　　　　&lt;!-- 每個日誌文件大小不超過2GB --&gt;　　　　　　&lt;maxFileSize&gt;2000MB&lt;/maxFileSize&gt;　　　　&lt;/timeBasedFileNamingAndTriggeringPolicy&gt;　　&lt;/rollingPolicy&gt;　　&lt;encoder charset="UTF-8"&gt;　　　　&lt;pattern&gt;　　　　　　[%date{yyyy-MM-dd HH:mm:ss.SSS}] %level [%mdc{invokeNo}] %C{0}:%line - %message%n　　　　&lt;/pattern&gt;　　&lt;/encoder&gt;&lt;/appender&gt;&lt;root level="debug"&gt;　　&lt;appender-ref ref="all"/&gt;　　&lt;appender-ref ref="all-error"/&gt;　　&lt;appender-ref ref="console"/&gt;&lt;/root&gt;&lt;/configuration&gt;</pre><p class=ql-align-justify><br></p><h1 class=ql-align-justify><strong>7、Log4j2配置參考</strong></h1><p class=ql-align-justify><strong>配置說明</strong></p><ul><li class=ql-align-justify>統一使用log4j2.xml配置，log4j2.xml 文件放在 resource目錄下。</li><li class=ql-align-justify>注意Logger間的繼承關係，推薦additivity設置false：</li></ul><ol><li class=ql-align-justify>子logger會默認繼承父logger的appender，將它們加入到自己的Appender中；除非加上了additivity="false"，則不再繼承父logger的appender。</li><li class=ql-align-justify>子logger只在自己未定義輸出級別的情況下，才會繼承父logger的輸出級別。</li></ol><ul><li class=ql-align-justify>將日誌輸出到文件當中，考慮到RollingRandomAccessFile比RollingFile更靈活，推薦統一使用RollingRandomAccessFile。</li><li class=ql-align-justify>Log文件位置和命名，目前Log文件的位置統一放在相同目錄下面。</li></ul><div class=pgc-img><img alt=java日誌規約及配置示例終極總結 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/50cd5d68b16741089384603af9d97b0c><p class=pgc-img-caption></p></div><ul><li class=ql-align-justify>日誌按天記錄，單個日誌文件最大不超過3000MB，考慮到有些bug按周規律出現，推薦歷史日誌保留14天。</li></ul><p class=ql-align-justify><br></p><pre class=ql-align-justify>&lt;RollingRandomAccessFile name="all-append" immediateFlush="true" 　　　　fileName="${LOG_DIR}/all.log" filePattern="${LOG_DIR}/all-%d{yyyy-MM-dd}-%i.log"&gt;&lt;Policies&gt;&lt;SizeBasedTriggeringPolicy size="3GB" /&gt;&lt;TimeBasedTriggeringPolicy interval="8" modulate="true" /&gt;&lt;!-- 最多備份14天以內||日誌文件大小達到50GB的日誌||文件數量超過20此處為策略限制，　　　　Delete中可以按自己需要用正則表達式編寫 --&gt;&lt;DefaultRolloverStrategy&gt;　　&lt;Delete basePath="${filePath}" maxDepth="1"&gt;　　　　&lt;IfLastModified age="14d" /&gt;　　　　&lt;IfAccumulatedFileSize exceeds="50 GB" /&gt;　　　　&lt;IfAccumulatedFileCount exceeds="20" /&gt;　　&lt;/Delete&gt;&lt;/DefaultRolloverStrategy&gt;</pre><p class=ql-align-justify><br></p><ul><li class=ql-align-justify>在出現問題之後，需要立即根據日誌定位問題。對於INFO及以上級別的日誌，要求按照一定順序，輸出以下必要的信息。參考日誌格式定義</li></ul><pre class=ql-align-justify>&lt;PatternLayout&gt;　　&lt;Pattern&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level [%mdc{invokeNo}] %C{2}:%L %M - %msg%n　　&lt;/Pattern&gt;&lt;/PatternLayout&gt;</pre><ul><li class=ql-align-justify>一個完整的Appender配置如下</li></ul><p class=ql-align-justify><br></p><pre class=ql-align-justify>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;!-- Configuration後面的status，這個用於設置log4j2自身內部的信息輸出，可以不設置，當設置成trace時，　　你會看到log4j2內部各種詳細輸出。monitorInterval：Log4j能夠自動檢測修改配置文件和重新配置本身，　　設置間隔秒數。--&gt;&lt;configuration status="OFF" monitorInterval=”600″&gt;&lt;properties&gt;　　&lt;property name="LOG_PATH"&gt;/export/home/logs/yourSystem/yourAppName&lt;/property&gt;　　&lt;property name="LOG_PATTERN"&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level [%mdc{invokeNo}]　　　　　　　　 %C{2}:%L %M - %msg%n &lt;/property&gt;　　&lt;property name="EVERY_FILE_SIZE"&gt;3GB&lt;/property&gt;　　&lt;property name="OUTPUT_LOG_LEVEL"&gt;info&lt;/property&gt;　　&lt;property name="FILE_COUNT"&gt;20&lt;/property&gt;　　&lt;property name="ERROR_FILE_COUNT"&gt;3&lt;/property&gt;&lt;/properties&gt;&lt;!--先定義所有的appender--&gt;&lt;appenders&gt;　　&lt;!--輸出控制檯的配置--&gt;　　&lt;Console name="console" target="SYSTEM_OUT"&gt;　　　　&lt;!--控制檯只輸出level及以上級別的信息（onMatch），其他的直接拒絕（onMismatch）--&gt;　　　　&lt;ThresholdFilter level="info" onMatch="ACCEPT" onMismatch="DENY"/&gt;　　　　&lt;!--輸出日誌的格式--&gt;　　　　&lt;PatternLayout pattern="${LOG_PATTERN}"/&gt;　　&lt;/Console&gt;&lt;!-- 打印信息，每次大小超過size，則這size大小的日誌會自動存入按年份-月份建立的文件夾下面並進行壓縮，　　作為存檔--&gt;&lt;RollingRandomAccessFile 　　name="all"　　immediateFlush="true" 　　fileName="${LOG_DIR}/all.log"　　filePattern="${LOG_DIR}/all-%d{yyyy-MM-dd}-%i.log"&gt;　　&lt;Filters&gt;　　　　&lt;ThresholdFilter level="error" onMatch="ACCEPT" onMismatch="NEUTRAL"/&gt;　　　　&lt;ThresholdFilter level="warn" onMatch="ACCEPT" onMismatch="NEUTRAL"/&gt;　　　　&lt;ThresholdFilter level="info" onMatch="ACCEPT" onMismatch="NEUTRAL"/&gt;　　　　&lt;ThresholdFilter level="trace" onMatch="DENY" onMismatch="DENY"/&gt;　　&lt;/Filters&gt;&lt;PatternLayout&gt;　　&lt;Pattern&gt;${LOG_PATTERN}&lt;/Pattern&gt;&lt;/PatternLayout&gt;&lt;Policies&gt;　　&lt;SizeBasedTriggeringPolicy size="${EVERY_FILE_SIZE}" /&gt;　　&lt;TimeBasedTriggeringPolicy interval="1" modulate="true" /&gt;&lt;/Policies&gt;&lt;!-- DefaultRolloverStrategy屬性如不設置，則默認為最多同一文件夾下7個文件，這裡設置了20 --&gt; &lt;DefaultRolloverStrategy&gt;　　&lt;!-- 最多備14 天以內||日誌文件大小達到50GB的日誌||文件數量超過20此處為策略限制，Delete中可以按自　　　　　己需要用正則表達式編寫 --&gt;　　&lt;Delete basePath="${LOG_DIR}" maxDepth="1"&gt;　　　　&lt;IfLastModified age="14d" /&gt;　　　　&lt;IfAccumulatedFileSize exceeds="50 GB" /&gt;　　　　&lt;IfAccumulatedFileCount exceeds="20" /&gt;　　&lt;/Delete&gt;&lt;/DefaultRolloverStrategy&gt;&lt;/RollingRandomAccessFile&gt;&lt;RollingRandomAccessFile 　　name="all-error"　　immediateFlush="true" 　　fileName="${LOG_DIR}/all-error.log"　　filePattern="${LOG_DIR}/all-error-%d{yyyy-MM-dd}-%i.log"&gt;　　&lt;Filters&gt;　　　　&lt;ThresholdFilter level="error" onMatch="ACCEPT"onMismatch="NEUTRAL"/&gt;　　　　&lt;ThresholdFilter level="warn" onMatch="ACCEPT"onMismatch="DENY"/&gt;　　&lt;/Filters&gt;　　&lt;PatternLayout&gt;　　　　&lt;Pattern&gt;${LOG_PATTERN}&lt;/Pattern&gt;　　&lt;/PatternLayout&gt;　　&lt;Policies&gt;　　　　&lt;SizeBasedTriggeringPolicy size="${EVERY_FILE_SIZE}" /&gt;　　　　&lt;TimeBasedTriggeringPolicy interval="1" modulate="true" /&gt;　　&lt;/Policies&gt;　　&lt;!-- DefaultRolloverStrategy屬性如不設置，則默認為最多同一文件夾下7個文件，這裡設置了20 --&gt;&lt;DefaultRolloverStrategy max="${ERROR_FILE_COUNT}"/&gt;&lt;/RollingRandomAccessFile&gt;&lt;/appenders&gt;&lt;!--然後定義logger，只有定義了logger並引入的appender，appender才會生效--&gt;&lt;loggers&gt;　　&lt;!--默認的root的logger--&gt;　　&lt;Logger name="all" level="info" additivity="false"&gt; 　　　　&lt;AppenderRef ref="all" /&gt; 　　&lt;/Logger&gt;　　&lt;Logger name="all-error" level="error" additivity="false"&gt; 　　　　&lt;AppenderRef ref="all-error" /&gt; 　　&lt;/Logger&gt;　　&lt;root level="${OUTPUT_LOG_LEVEL}"&gt;　　　　&lt;appender-ref ref="console"/&gt;　　&lt;/root&gt; &lt;/loggers&gt;&lt;/configuration&gt;</pre><p>歡迎工作一到八年的Java工程師朋友們加入Java高級交流：854630135</p><p>本群提供免費的學習指導 架構資料 以及免費的解答</p><p>不懂得問題都可以在本群提出來 之後還會有直播平臺和講師直接交流噢</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>示例</a></li><li><a>java</a></li><li><a>日誌</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/f47db3ae.html alt=關於java中基類和子類構造方法相互調用示例 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1527800643820d38441d576 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f47db3ae.html title=關於java中基類和子類構造方法相互調用示例>關於java中基類和子類構造方法相互調用示例</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/69818103.html alt=java相關知識(10)總結 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/84649e6ba0f8442a8b10584403bf6635 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/69818103.html title=java相關知識(10)總結>java相關知識(10)總結</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/02729303.html alt=java實戰項目常用類，Date、Calendar、BigDecimal、Math、UUID class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/d69c7c9d8b85444da9360e334ba6555d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/02729303.html title=java實戰項目常用類，Date、Calendar、BigDecimal、Math、UUID>java實戰項目常用類，Date、Calendar、BigDecimal、Math、UUID</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5f8b26e0.html alt=多態的本質，java動態綁定 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/50ac000493fbc8532b5e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5f8b26e0.html title=多態的本質，java動態綁定>多態的本質，java動態綁定</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9cdd9391.html alt=9.29炒股日誌，賺3714元，如何快速買進賣出股票併成交 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/4c74ae96a7cb43149f4141d0a6bf996e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9cdd9391.html title=9.29炒股日誌，賺3714元，如何快速買進賣出股票併成交>9.29炒股日誌，賺3714元，如何快速買進賣出股票併成交</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2ea7884b.html alt=java程序員注意：少有人知的哈希衝突解決策略，學到就是賺到 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/54d45b20ef6a4a3f960411db61474538 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2ea7884b.html title=java程序員注意：少有人知的哈希衝突解決策略，學到就是賺到>java程序員注意：少有人知的哈希衝突解決策略，學到就是賺到</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/19cbd4c3.html alt="java 常用的正則表達式" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1540129072390e6c4c05126 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/19cbd4c3.html title="java 常用的正則表達式">java 常用的正則表達式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a81470d4.html alt=java常用正則表達式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c811c3c14e4a4fa4825845b2868ee645 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a81470d4.html title=java常用正則表達式>java常用正則表達式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a2847433.html alt=常用JavaScript正則表達式彙編與示例詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/dca255e6-9611-4395-afc6-7e9fa5ac5e38 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a2847433.html title=常用JavaScript正則表達式彙編與示例詳解>常用JavaScript正則表達式彙編與示例詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/48f7c5e6.html alt=Java工具類教程：詳解正則表達式及應用示例 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/4002000140fde581089b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/48f7c5e6.html title=Java工具類教程：詳解正則表達式及應用示例>Java工具類教程：詳解正則表達式及應用示例</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/115806c0.html alt=Java正則表達式教程及示例 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/07559bf8adcd496d8267aad619be8a94 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/115806c0.html title=Java正則表達式教程及示例>Java正則表達式教程及示例</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d5b99796.html alt=java正則表達式括號的使用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/88ce74502881405281b2e2e5ae84f5d7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d5b99796.html title=java正則表達式括號的使用>java正則表達式括號的使用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/03619879.html alt="java foreach  對異常的處理" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/66551f46-dfc4-46b3-8cb2-b3551d77e648 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/03619879.html title="java foreach  對異常的處理">java foreach 對異常的處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c67e6cfe.html alt=java反射機制的講解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9ad2c92f100a4d2e8213dcf70d4781c0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c67e6cfe.html title=java反射機制的講解>java反射機制的講解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ff2ba73c.html alt=java併發編程-學習方法、進程和線程的區別 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/96ffe13dbf2b45109664e14541532812 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ff2ba73c.html title=java併發編程-學習方法、進程和線程的區別>java併發編程-學習方法、進程和線程的區別</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>