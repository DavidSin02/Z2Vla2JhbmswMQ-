<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>第五章 跳轉 | 极客快訊</title><meta property="og:title" content="第五章 跳轉 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/a2eec5c3db3c4779b719e60d5ec1a0c2"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ea462aa3.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ea462aa3.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ea462aa3.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ea462aa3.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ea462aa3.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ea462aa3.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ea462aa3.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ea462aa3.html><meta property="article:published_time" content="2020-11-14T21:04:32+08:00"><meta property="article:modified_time" content="2020-11-14T21:04:32+08:00"><meta name=Keywords content><meta name=description content="第五章 跳轉"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/ea462aa3.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>第五章 跳轉</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><br></p><div class=pgc-img><img alt="第五章 跳轉" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a2eec5c3db3c4779b719e60d5ec1a0c2><div class=pgc-img-handler><div class="pgc-img-button editorImage fix-ios"><section></section></div><div class="pgc-img-button setImageCover fix-ios"><section></section></div><div class="pgc-img-button deleteImage fix-ios"><section></section></div></div><div class="pgc-img-border pgc-img-border-ios"></div></div><p><br></p><h1>分支</h1><p>到現在為止，我們的小型彙編程序在一條指令之後執行另一條指令。如果我們的ARM處理器只能以這種方式運行，那將是有限的用途。它無法對可能需要不同指令順序的現有條件做出反應。這是分支指令的目的。</p><h1>特殊寄存器</h1><p>在第2章中，我們瞭解到Raspberry Pi ARM處理器具有16個整數通用寄存器，並且當時指出其中有些寄存器有特殊的作用。 因為那時還用不到，我故意忽略了。</p><p>現在我們將用到其中一個特殊的寄存器R15,聽到這個名字可能你對這個寄存器的功能會很困惑，但是聽到他的別名PC寄存器你可能會有更深刻的認知，當然前提是你對計算機原理有過了解。</p><p>PC代表什麼？ pc表示程序計數器。 這個名字的起源是在計算的蠻荒時期，如今幾乎沒有任何意義。 通常，pc寄存器（在其他體系結構（如386或x86_64）中也稱為ip，指令指針）包含要執行的下一條指令的地址。</p><p>當ARM處理器執行一條指令時，在其執行結束時可能會發生兩件事。 如果指令沒有修改pc（大多數指令沒有修改），則pc只會增加4（就像我們確實添加了pc，pc，＃4一樣）。 為什麼是4？ 因為在ARM中，指令為32位寬，所以每條指令之間有4個字節。 如果指令修改了pc，則使用pc的新值。</p><p>一旦處理器完全執行了一條指令，它就將pc中的值用作下一條要執行的指令的地址。 這樣，一條不會修改pc的指令將緊隨內存中的下一條連續指令（因為它已自動增加4）。 這稱為指令的隱式排序：一條指令運行後，通常會運行內存中的下一條指令。 但是，如果一條指令確實將pc修改為例如pc + 4以外的其他值，那麼我們可以運行該程序的另一條指令。 更改pc值的過程稱為分支。 在ARM中，這是使用分支指令完成的。</p><h1>無條件分支</h1><p>您可以使用指令b（用於轉移）和標籤來告訴處理器無條件轉移。 考慮下面的程序。</p><p>/* -- branch01.s */</p><p>.text</p><p>.global main</p><p>main:</p><p>mov r0, #2 /* r0 ← 2 */</p><p>b end /* branch to 'end' */</p><p>mov r0, #3 /* r0 ← 3 */</p><p>end:</p><p>bx lr</p><p>如果執行此程序，您將看到它返回錯誤代碼2。（如果不知道下面輸出的意思可以參考第一章的說明）</p><p>$ ./branch01 ; echo $?</p><p>2</p><p>發生的是，指令b end分支（修改了pc）到標籤端的指令bx lr，即我們在程序末尾運行的指令。 這樣，指令mov r0，＃3實際上根本沒有運行（處理器從未到達該指令）。</p><p>在這一點上，無條件分支指令b可能看起來毫無用處。 事實並非如此。 實際上，該指令在某些情況下是必不可少的，特別是在與條件分支一塊使用時。</p><h1>條件分支</h1><p>如果我們的處理器僅能夠順序執行，那將不會很有用。 滿足某些條件時分支將更加有用。 因此，處理器應該能夠根據某些條件進行分別處理。</p><p>在繼續之前，我們需要公開另一個名為cpsr的寄存器（用於“當前程序狀態寄存器”）。 該寄存器有點特殊，直接修改它超出了本章的範圍。 也就是說，它保留一些在執行指令時可以讀取和更新的值。 該寄存器的值包括四個條件代碼標誌，分別稱為N（負），Z（零），C（進位）和V（溢出）。 這四個條件代碼標誌通常由分支指令讀取。 如果需要，算術指令以及特殊的測試和比較指令也可以更新這個寄存器的值。</p><p>在更新cpsr的指令中，這四個條件代碼的語義大致如下:</p><ul><li>N: 如果指令結果為負數，則啟用N。 否則禁用。</li><li>Z: 如果指令的結果為零，則將啟用Z。 如果非零，則禁用。</li><li>C: 如果指令的結果產生的值需要完全表示第33位，則將啟用C。 例如，加法溢出了32位整數範圍。</li><li>V: 如果指令結果產生的值不能用32位二進制補碼錶示，則將啟用V。</li></ul><p>因此，我們具有所有必要的條件來有條件地執行分支。 但首先，讓我們開始比較兩個值。 為此，我們使用指令cmp。</p><p>cmp r1, r2 /* updates cpsr doing "r1 - r2", but r1 and r2 are not modified */</p><p>該指令將第二個寄存器中的值減去第一個寄存器中的值。 上面的代碼片段可能發生什麼事？</p><ul><li>如果r2的值（嚴格地）大於r1，則將啟用N，因為r1-r2將產生負結果。</li><li>如果r1和r2具有相同的值，則將啟用Z，因為r1-r2將為零。</li><li>如果r1為1且r2為0，則r1-r2將不會借用，因此在這種情況下將啟用C。 如果交換了值（r1為0，r2為1），則C將被禁用，因為減法確實會借用。</li><li>如果r1為2147483647（32位二進制補碼中的最大正整數）且r2為-1，則r1-r2將為2147483648，但該數字不能用32位二進制補碼錶示，因此將啟用V來表示這一點。</li></ul><p>我們如何使用這些標誌來表示程序的有用條件？</p><ul><li>EQ（相等）啟用Z時（Z為1）</li><li>NE（不相等）。 Z禁用時。 （Z為0）</li><li>GE（大於或等於，用兩個補碼錶示）。 當V和N都啟用或禁用時（V為N）</li><li>LT（低於兩位數）。 這與GE相反，因此當V和N均未啟用或禁用時（V不是N）</li><li>GT（大於2）。 當禁用Z且同時啟用或禁用N和V時（Z為0，N為V）</li><li>LE（小於或等於，用兩個補碼錶示）。 啟用Z或啟用Z時，N和V均啟用或禁用（Z為1。如果Z不為1，則N為V）</li><li>MI（負/負）啟用N時（N為1）</li><li>PL（正/正或零）當禁用N時（N為0）</li><li>VS（溢出設置）啟用V時（V為1）</li><li>VC（溢出清除）禁用V時（V為0）</li><li>HI（較高）當啟用C而禁用Z時（C為1並且Z為0）</li><li>LS（較低或相同）當禁用C或啟用Z（C為0或Z為1）時</li><li>CS / HS（進位設置/更高或相同）當啟用C（C為1）時</li><li>CC / LO（進位清除/降低）當C被禁用（C為0）時</li></ul><p>這些條件可以與我們的b指令組合以生成新指令。 這樣，僅當Z為1時，beq才會分支。如果不滿足條件分支的條件，則忽略該分支，並運行下一條指令。 確保在條件分支之前正確設置條件代碼是程序員的任務。</p><p>/* -- compare01.s */</p><p>.text</p><p>.global main</p><p>main:</p><p>mov r1, #2 /* r1 ← 2 */</p><p>mov r2, #2 /* r2 ← 2 */</p><p>cmp r1, r2 /* update cpsr condition codes with the value of r1-r2 */</p><p>beq case_equal /* branch to case_equal only if Z = 1 */</p><p>case_different :</p><p>mov r0, #2 /* r0 ← 2 */</p><p>b end /* branch to end */</p><p>case_equal:</p><p>mov r0, #1 /* r0 ← 1 */</p><p>end:</p><p>bx lr</p><p>如果運行該程序，則由於r1和r2的值相同，因此將返回錯誤代碼1。 現在，將第5行中的mov r1，＃2更改為mov r1，＃3，返回的錯誤代碼應為2。請注意，case_different我們不想運行case_equal指令，因此我們必須跳轉到結束（否則錯誤 代碼始終為1）。</p><p>以上就是今天的內容。如有不懂可以先看前幾章內容或在下方提問。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>跳轉</a></li><li><a>第五章</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/c57ab4b0.html alt=第五章:函數 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/2466a268-feac-46a2-9bfa-ea0a5723a32f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c57ab4b0.html title=第五章:函數>第五章:函數</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/637a16cf.html alt="泔河塬人家  第五章" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/637a16cf.html title="泔河塬人家  第五章">泔河塬人家 第五章</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/80b0adb.html alt="第五章 棧和隊列" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f539b17725974b3fb257d8e003e0edbc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/80b0adb.html title="第五章 棧和隊列">第五章 棧和隊列</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/49277a6.html alt=彙編語言跳轉指令中跳轉地址的計算 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/51da69bb90cf44a998306bebeb6ba837 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/49277a6.html title=彙編語言跳轉指令中跳轉地址的計算>彙編語言跳轉指令中跳轉地址的計算</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a8e056a.html alt=HTML中網頁的跳轉和刷新 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/65247c5828db4c46a79952d0f1421118 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a8e056a.html title=HTML中網頁的跳轉和刷新>HTML中網頁的跳轉和刷新</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/e56fce9.html alt="第五章 組隊！" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/e56fce9.html title="第五章 組隊！">第五章 組隊！</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>