<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>你知道MySQL的事務處理和隔離級別嗎？ | 极客快訊</title><meta property="og:title" content="你知道MySQL的事務處理和隔離級別嗎？ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/efc2a519.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/efc2a519.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/efc2a519.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/efc2a519.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/efc2a519.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/efc2a519.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/efc2a519.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/efc2a519.html><meta property="article:published_time" content="2020-11-14T21:08:11+08:00"><meta property="article:modified_time" content="2020-11-14T21:08:11+08:00"><meta name=Keywords content><meta name=description content="你知道MySQL的事務處理和隔離級別嗎？"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/efc2a519.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>你知道MySQL的事務處理和隔離級別嗎？</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>事務是DBMS得執行單位。它由有限得數據庫操作序列組成得。但不是任意得數據庫操作序列都能成為事務。一般來說，事務是必須滿足4個條件（ACID）</p><p>原子性（Autmic）：事務在執行性，要做到“要麼不做，要麼全做！”，就是說不允許事務部分得執行。即使因為故障而使事務不能完成，在rollback時也要消除對數據庫得影響！</p><p>一致性（Consistency）：事務操作之後,數據庫所處的狀態和業務規則是一致的;比如a,b賬戶相互轉賬之後，總金額不變！</p><p>隔離性（Isolation）：如果多個事務併發執行，應像各個事務獨立執行一樣！</p><p>持久性（Durability）：事務提交後被持久化到數據庫.</p><p><strong>MYSQL的事務處理主要有兩種方法。</strong></p><p>1、用BEGIN,ROLLBACK,COMMIT來實現</p><p>開始：START TRANSACTION或BEGIN語句可以開始一項新的事務</p><p>提交：COMMIT可以提交當前事務，是變更成為永久變更</p><p>回滾：ROLLBACK可以回滾當前事務，取消其變更</p><p>2、直接用set來改變mysql的自動提交模式</p><p>MYSQL默認是自動提交的，也就是你提交一個QUERY，它就直接執行！</p><p>我們可以通過set autocommit=0 禁止自動提交</p><p>set autocommit=1 開啟自動提交</p><p>來實現事務的處理。</p><p>但注意當你用 set autocommit=0 的時候，你以後所有的SQL都將做為事務處理，直到你用commit確認或rollback結束，並且只用於當前連接。</p><p>※ MYSQL中只有INNODB和BDB類型的數據表才能支持事務處理！其他的類型是不支持！</p><p><strong>自己的理解(關於髒讀，不可重複讀，幻讀)</strong></p><p>※髒讀：一個事務讀取了另一個未提交的並行事務寫的數據。</p><p>(事務T1更新了一行記錄的內容，但是並沒有提交所做的修改。事務T2讀取更新後的行，然後T1執行回滾操作，取消了剛才所做的修改。現在T2所讀取的行就無效了。)</p><p>exp:</p><p>小明的分數為89,事務A中把他的分數改為98,但事務A尚未提交。</p><p>與此同時，</p><p>事務B正在讀取小明的分數，讀取到小明的分數為98。</p><p>隨後，</p><p>事務A發生異常，而回滾了事務。小明的分數又回滾為89。</p><p>最後，</p><p>事務B讀取到的小明的分數為98的數據即為髒數據，事務B做了一次髒讀。</p><p>(大部分數據庫缺省的事物隔離級別都不會出現這種狀況)</p><p>※不可重複讀：一個事務重新讀取前面讀取過的數據，發現該數據已經被另一個已提交的事務修改過。</p><p>(事務T1讀取一行記錄，緊接著事務T2修改了T1剛才讀取的那一行記錄。然後T1又再次讀取這行記錄，發現與剛才讀取的結果不同。這就稱為“不可重複”讀，因為T1原來讀取的那行記錄已經發生了變化。)</p><p>exp：</p><p>在事務A中，讀取到小明的分數為89，操作沒有完成，事務還沒提交。</p><p>與此同時，</p><p>事務B把小明的分數改為98，並提交了事務。</p><p>隨後，</p><p>在事務A中，再次讀取小明的分數，此時工資變為98。在一個事務中前後兩次讀取的結果並不致，導致了不可重複讀。</p><p>※幻讀：一個事務重新執行一個查詢，返回一套符合查詢條件的行，發現這些行因為其他最近提交的事務而發生了改變。</p><p>(事務T1讀取一條指定的WHERE子句所返回的結果集。然後事務T2新插入 一行記錄，這行記錄恰好可以滿足T1所使用的查詢條件中的WHERE 子句的條件。然後T1又使用相同的查詢再次對錶進行檢索，但是此時卻看到了事務T2剛才插入的新行。這個新行就稱為“幻像”，因為對T1來說這一行就像突 然出現的一樣。)</p><p>exp：</p><p>目前分數為90分以上的的學生有15人，事務A讀取所有分數為90分以上的的學生人數有15人。</p><p>此時，事務B插入一條分數為99的學生記錄。</p><p>這是，事務A再次讀取90分以上的的學生，記錄為16人。此時產生了幻讀。</p><p>(大部分數據庫缺省的事物隔離級別都會出現這種狀況，此種事物隔離級別將帶來表級鎖)</p><p><strong>事務隔離級別描述：</strong></p><p>READ UNCOMMITTED：幻讀，不可重複讀和髒讀均允許；</p><p>READ COMMITTED：允許幻讀和不可重複讀，但不允許髒讀；</p><p>REPEATABLE READ：允許幻讀，但不允許不可重複讀和髒讀；</p><p>SERIALIZABLE:幻讀，不可重複讀和髒讀都不允許；</p><p>ORACLE默認的是 READ COMMITTED。</p><p>MYSQL默認的是 REPEATABLE READ。</p><p>如果數據庫的隔離級別為REAE_UNCOMMITTED， 則其他線程可以看到未提交的數據， 因此就出現髒讀；</p><p>如果數據庫隔離級別設為READ_COMMITTED，即沒提交的數據別人是看不見的，就避免了髒讀；但是，正在讀取的數據只獲得了讀取鎖，讀完之後就解鎖，不管當前事務有沒有結束，這樣就容許其他事務修改本事務正在讀取的數據。導致不可重複讀。</p><p>REPEATABLE READ因為對正在操作的數據加鎖，並且只有等到事務結束才放開鎖， 則可以避免不可重複讀；</p><p>REPEATABLE READ只能保證正在被本事務操作的數據不被其他事務修改，卻無法保證有其他事務提交新的數據。 則有可能線程1在操作表T1的時候（特別是統計性的事務），其他線程仍然可以提交新數據到表T1，這樣會導致線程1兩次統計的結果不一致，就像發生幻覺一樣。</p><p>SERIALIZABLE因為獲得範圍鎖，且事務是一個接著一個串行執行，則保證了不會發生幻讀。</p><p>由此可見，隔離級別越高，受其他事物干擾越少，併發性能越差。</p><p>二個或以上事務在操作同一個共享記錄集時，可能會出現的問題：</p><p>（A）髒讀 （B）不可重複讀 （C）幻讀</p><p>隔離級別：</p><p>（1）read-uncommit, （2）read-commit, （3）read-repeatable, （4）read-serializable</p><p>都是用來阻止上面的問題的，其中：</p><p>（1）什麼都阻止不了。</p><p>（2）阻止（A）</p><p>（3）阻止（A）（B）</p><p>（4）阻止（A）（B）（C）</p><p>(1)->(4)隔離級別越高，性能損失越大。</p><p><strong>修改事務的隔離級別：</strong></p><p>在MySQL中默認事務隔離級別是可重複讀(Repeatable read).可通過SQL語句查詢：</p><p>查看InnoDB系統級別的事務隔離級別：</p><p>mysql> SELECT @@global.tx_isolation;</p><p>結果：</p><p>+-----------------------+</p><p>| @@global.tx_isolation |</p><p>+-----------------------+</p><p>| REPEATABLE-READ |</p><p>+-----------------------+</p><p>查看InnoDB會話級別的事務隔離級別：</p><p>mysql> SELECT @@tx_isolation;</p><p>結果：</p><p>+-----------------+</p><p>| @@tx_isolation |</p><p>+-----------------+</p><p>| REPEATABLE-READ |</p><p>+-----------------+</p><p>修改事務隔離級別：</p><p>mysql> set global transaction isolation level read committed;</p><p>mysql> set session transaction isolation level read committed;</p><p>點擊瞭解更多</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>MySQL</a></li><li><a>事務</a></li><li><a>處理</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/0be408a4.html alt="MySQL 事務處理" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0be408a4.html title="MySQL 事務處理">MySQL 事務處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8a538d3c.html alt=MySQL——事務(Transaction)詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/29d4c92c9c2344838eb72ef948cf08fa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8a538d3c.html title=MySQL——事務(Transaction)詳解>MySQL——事務(Transaction)詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3269d080.html alt=MySQL數據庫的事務管理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/152203544367254a708f807 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3269d080.html title=MySQL數據庫的事務管理>MySQL數據庫的事務管理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/011d2da0.html alt=MySql併發與事務的處理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/f13d8a1e-5e60-4b48-90bc-3c26e312a208 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/011d2da0.html title=MySql併發與事務的處理>MySql併發與事務的處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7d322f7b.html alt=MySQL系列-第14篇：事務詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/a5b520dd476345e2b3aac97a8fcb77d5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7d322f7b.html title=MySQL系列-第14篇：事務詳解>MySQL系列-第14篇：事務詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d3c48fcc.html alt=Spring聲明式事務處理的實現原理，來自面試官的窮追拷問 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d3c48fcc.html title=Spring聲明式事務處理的實現原理，來自面試官的窮追拷問>Spring聲明式事務處理的實現原理，來自面試官的窮追拷問</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cf061a5c.html alt="我對 MySQL 鎖、事務、MVCC 的一些認識" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5d6e32482c364fe3b5f9436a30671330 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cf061a5c.html title="我對 MySQL 鎖、事務、MVCC 的一些認識">我對 MySQL 鎖、事務、MVCC 的一些認識</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4959ed6a.html alt="技術分享 | MySQL 的嵌套事務、自治事務與鏈式事務" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4959ed6a.html title="技術分享 | MySQL 的嵌套事務、自治事務與鏈式事務">技術分享 | MySQL 的嵌套事務、自治事務與鏈式事務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/175f9730.html alt=深入學習MySQL事務：ACID特性的實現原理「轉」 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/cdc702d66d6943499997d11e931425eb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/175f9730.html title=深入學習MySQL事務：ACID特性的實現原理「轉」>深入學習MySQL事務：ACID特性的實現原理「轉」</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8aa8e939.html alt="MySQL 傳統複製中常見故障處理和結構優化案例分析" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c993e94407a64d11a011fbe9f2793025 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8aa8e939.html title="MySQL 傳統複製中常見故障處理和結構優化案例分析">MySQL 傳統複製中常見故障處理和結構優化案例分析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0482a52.html alt="MySQL 事務的四種隔離級別，研讀完了你能吊打面試官" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1a7cb2436dec4249b34a8c79cdb17e9c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0482a52.html title="MySQL 事務的四種隔離級別，研讀完了你能吊打面試官">MySQL 事務的四種隔離級別，研讀完了你能吊打面試官</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dacc263.html alt=MySQL數據庫中的事務以及創建表的注意事項 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dacc263.html title=MySQL數據庫中的事務以及創建表的注意事項>MySQL數據庫中的事務以及創建表的注意事項</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/daee1f6.html alt=MySQL事務提交過程（一） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/61f7b3575cea4b20b5e0400f9ad4d11b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/daee1f6.html title=MySQL事務提交過程（一）>MySQL事務提交過程（一）</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/720ab20.html alt=MySQL事務管理的介紹（附示例） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/720ab20.html title=MySQL事務管理的介紹（附示例）>MySQL事務管理的介紹（附示例）</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/7d8255b.html alt=分佈式系統常見的事務處理機制 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/7d8255b.html title=分佈式系統常見的事務處理機制>分佈式系統常見的事務處理機制</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>