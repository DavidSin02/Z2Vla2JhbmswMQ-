<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>支付系統：整體架構 | 极客快訊</title><meta property="og:title" content="支付系統：整體架構 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/f1d94fa40459462fa825d407a1904c7e"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f270aa9d.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f270aa9d.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f270aa9d.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f270aa9d.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f270aa9d.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f270aa9d.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f270aa9d.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f270aa9d.html><meta property="article:published_time" content="2020-11-14T21:06:32+08:00"><meta property="article:modified_time" content="2020-11-14T21:06:32+08:00"><meta name=Keywords content><meta name=description content="支付系統：整體架構"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/f270aa9d.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>支付系統：整體架構</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>產品架構圖</p><div class=pgc-img><img alt=支付系統：整體架構 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f1d94fa40459462fa825d407a1904c7e><p class=pgc-img-caption></p></div><p>產品層</p><p>通過核心層提供的服務組合起來，對最終用戶、商戶、運營系統提供服務的系統。</p><p>支付系統的支撐系統、核心系統每家公司的架構都大同小異，而且都是必不可少的模塊。而每家公司的支付業務、運營策略各自不同，所以，上面的應用層各自不同。通常我們可以按照使用對象劃分為：針對最終用戶應用、針對商戶應用、針對運營人員應用、針對分控人員應用...</p><p><strong>支付流程圖</strong></p><div class=pgc-img><img alt=支付系統：整體架構 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9515a6c30a144e8495883f04b75efd24><p class=pgc-img-caption></p></div><p><strong>資金流處理</strong></p><div class=pgc-img><img alt=支付系統：整體架構 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/72e00c98c20849d9986cba2367073770><p class=pgc-img-caption></p></div><p>EE65D732-B8D5-48ee-9741-17E0FDFD40EF.png</p><p>核心層</p><p>支付系統的核心模塊，內部又分為兩個部分： 支付核心模塊以及支付服務模塊</p><p>支付應用</p><p>支付核心層通過支付應用對上冊提供服務，用戶從這裡啟動支付流程。</p><p>支付網關</p><p>在支付系統中，支付網關和支付渠道的對接是最核心的功能。其中支付網關是對外提供服務的接口，所有需要渠道支持的資金操作都需要通過網關分發到對應的渠道模塊上。一旦定型，後續就很少，也很難調整。而支付渠道模塊是接收網關的請求，調用渠道接口執行真正的資金操作。每個渠道的接口，傳輸方式都不盡相同，所以在這裡，支付網關相對於支付渠道模塊的作用，類似設計模式中的wrapper，封裝各個渠道的差異，對網關呈現統一的接口。而網關的功能是為業務提供通用接口，一些和渠道交互的公共操作，也會放置到網關中</p><p>支付網關工作流程:</p><ul><li>商戶側應用發起支付請求。注意，這個請求一般是從服務器端發起的。比如用戶在手機端提交“立即支付”按鈕後，商戶的服務器端會先生成訂單，然後請求支付網關執行支付</li><li>支付請求被髮送到支付（API)網關上。網關對這個請求進行一些通用的處理，比如QPS控制、驗籤等，然後根據支付請求的場景（網銀、快捷、外卡等），調用對應的支付產品</li><li>支付產品對用戶請求進行預處理，包括執行參數校驗、根據支付路由尋找合適的支付通道、評估交易風險、生成訂單、調用通道落地執行支付、響應通道的結果並將交易結果通知到商戶側</li><li>支付產品調用支付通道執行支付。這個請求並不是直接落地到通道上，而是通過支付通道前置來封裝，由支付通道前置來完成和通道的交付。 支付產品是按照可以提供的支付服務來設計的</li><li>支付通道前置，（以下在不引起混淆的情況下，都簡稱支付通道）負責和支付通道之間的通訊，調用支付通道接口完成最終的支付操作數</li></ul><p><strong>設計原則</strong></p><p>如上所述，支付網關、支付產品和支付渠道的職責分工為：</p><ul><li>按照支付能力來劃分支付產品。</li><li>同一支付能力的公共支付流程，在支付產品中實現。 支付產品提供的是和渠道無關的、和支付能力流程相關的功能。</li><li>在各支付產品中，其和支付能力無關的公共功能，在支付網關上實現。</li></ul><p>按照這個分工，在支付網關上實現的主要功能：</p><ul><li>API路由。在聚合支付場景下，當有多個支付產品可以提供支持時，使用支付網關可以讓接入方對接時無需考慮支付產品的部署問題。</li><li>接口安全： 熔斷、限流與隔離。 這對支付服務來說尤為重要。 這是微服務架構的基本功能，本文不做描述。</li></ul><p>如下功能，是在支付產品中提供：</p><ul><li>風控攔截： 風控是和支付產品有關，不同產品的風控措施、處理對策也是不同的，所以風控是在產品層實現。</li><li>支付路由： 路由也是和產品有關。不同產品路由策略也不同。</li><li>參數校驗： 這也是和支付產品相關的，不同的產品接口其參數也不同。</li><li>支付流程： 生成交易記錄、落地渠道執行支付、同步和異步通知等操作。</li></ul><p>如下功能，可以在產品層或者網關層實現：</p><ul><li>身份驗證： 確認付款方、收款方、渠道是否有執行當前操作的權限。 在那一層實現取決於這些信息是否有提煉為公共行為。</li><li>驗籤： 對接口參數進行簽名並驗證其簽名。這是為了避免接口被盜刷和篡改的必要手段。如果對各個接口採用統一的簽名規則，則可以在網關層實現。</li></ul><p>支付產品</p><p>在不同的公司由於接入渠道和應用的差異，對支付產品分類略有不同。支付產品是由支付系統對支付渠道進行封裝而對業務方提供的支付能力。</p><ul><li>快捷支付</li><li>用戶在完成綁卡之後，在支付的時候，不需要再輸入卡或者身份信息，僅需要輸入支付密碼就可以完成支付。對於小額度的支付，甚至可以開通小額免密，直接完成支付。 這種支付方式不會打斷用戶的體驗，是目前主要的在線支付方式。一般快捷支付產品是通過封裝銀行或者第三方支付平臺提供的快捷支付接口或者代付接口來實現的。</li><li>網銀支付</li><li>用戶在支付的時候，需要跳轉到銀行網銀頁面來完成支付。在網銀頁面，需要輸入用戶的卡號和身份信息。這種支付方式會中斷用戶當前的體驗，一般僅用於 PC Web 上的支付。 網銀支付是封裝銀行提供的網銀支付來實現。</li><li>賬戶支付</li><li>也稱為餘額支付、零錢支付等。 指為用戶建立本地賬戶， 支持充值，之後可以使用這個賬戶來完成支付。</li></ul><p>支付路由</p><p>用戶在前端選擇一種支付方式，比如使用招行借記卡來支付後，系統不一定就是調用招行的接口來執行支付。支付寶、百付寶等第三方支付平臺以及銀聯等，都支持招行借記卡支付。 這種將支付方式落地到具體的支付接口的模塊，就是支付路由。</p><p>支付路由在支付系統中的核心作用，除了本職工作路由外，還承擔如下職責：</p><ul><li>省錢，省錢，省錢，這是支付路由選擇支付通道的最主要的規則。 哪個通道省錢，基本會優先考慮這個通道。</li><li>提升支付產品的QOS。這體現在系統的可靠性、穩定性、性能和可用性上。通過屏蔽掉無法連接、不穩定、性能低的通道來提升這些指標。</li><li>支持營銷。通過優先選擇有優惠活動的通道，可以幫助業務提升付費客戶量。</li><li>降低運營成本。一個設計良好的支付路由，可以大大降低運營投入。</li></ul><p><strong>架構圖</strong></p><div class=pgc-img><img alt=支付系統：整體架構 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a2ea0f5561bc4d0ca104512e0ea83b9e><p class=pgc-img-caption></p></div><p>route-arch.jpg</p><p>支付渠道</p><p>包括銀行渠道和第三方支付（微信、支付寶、通聯、易寶）渠道</p><p>用戶管理</p><p>包括對用戶、商戶的實名身份、基本信息、協議的管理</p><p>資金管理</p><p>管理公司在各個支付渠道的頭寸，在餘額不足時進行打款。 對第三方支付公司，還需要對備付金進行管理</p><p>清算分潤</p><p>對於有分潤需求的業務，還需要提供清分清算、對賬處理和計費分潤功能</p><p>會計財務</p><p>提供會計科目、內部賬務、試算平衡、日切、流水登記、核算和歸檔的功能</p><p>核算</p><p>賬戶賬務</p><p>管理賬戶信息以及交易流水、記賬憑證等。這裡的賬務一般指對接線上系統的賬務，採用單邊賬的記賬方式。 內部賬記錄在會計核算系統中</p><p>風控</p><p>風控包括，賬戶風險、交易風險、資金風險、套現風險、操作風險、合規風險、洗錢風險，每一塊都是一個課題。</p><p>基礎層</p><p>用來支持核心系統的基礎軟件包和基礎設施， 包括運維監控系統、日誌分析系統等</p><ul><li>運維監控</li><li>支付系統運行的基礎設施受到外界的干擾（壓力、bug、掉電、黑客攻擊...）造成系統不穩定，需要能夠被及時響應，這就需要一個運維監控系統來協助完成。</li><li>日誌分析</li><li>日誌是支付系統統計分析、運維監控的重要依據。需要提供基礎設施來支持日誌統一收集和分析</li><li>短信平臺</li><li>短信在支付系統中有重要作用： 身份驗證、安全登錄、找回密碼、以及報警監控，都需要短信的支持</li><li>實時計算</li><li>全文檢索</li><li>數據存儲</li></ul><div class=pgc-img><img alt=支付系統：整體架構 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/f41aaee9db7341198abd7d61075fd159><p class=pgc-img-caption></p></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>系統</a></li><li><a>整體</a></li><li><a>架構</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/6c984f60.html alt=Kafka整體架構圖解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/05ae540358854cb3ba0aa4577709330d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6c984f60.html title=Kafka整體架構圖解>Kafka整體架構圖解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f15af9d2.html alt=MyBatis整體架構分析：基礎支持層、核心處理層和接口層 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8d6a0b300b114d07b2f3fe66d7ef7005 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f15af9d2.html title=MyBatis整體架構分析：基礎支持層、核心處理層和接口層>MyBatis整體架構分析：基礎支持層、核心處理層和接口層</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5747aeb3.html alt=K8S整體架構解析，簡單明瞭 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/37380f3294a54bbf8c6bec1de3e08ba0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5747aeb3.html title=K8S整體架構解析，簡單明瞭>K8S整體架構解析，簡單明瞭</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8fb29e71.html alt=乾貨！支付系統整體架構詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5365094f7560418bbb4eee2f00d5732f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8fb29e71.html title=乾貨！支付系統整體架構詳解>乾貨！支付系統整體架構詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8c2dbd39.html alt=「系統架構」什麼是鏈路追蹤？分佈式系統如何實現鏈路追蹤？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/bd78fffbaaf54bd79c6e463d5b69ed9f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8c2dbd39.html title=「系統架構」什麼是鏈路追蹤？分佈式系統如何實現鏈路追蹤？>「系統架構」什麼是鏈路追蹤？分佈式系統如何實現鏈路追蹤？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b52ff792.html alt=什麼是分佈式系統！以及分佈式系統架構的優缺點 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RSbrXx83dpwdLU style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b52ff792.html title=什麼是分佈式系統！以及分佈式系統架構的優缺點>什麼是分佈式系統！以及分佈式系統架構的優缺點</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/eefb8205.html alt=終於有架構大牛把分佈式系統概念講明白了，竟然用了足足800頁 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/478d30d249914d4d996df9d4007bd1d0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/eefb8205.html title=終於有架構大牛把分佈式系統概念講明白了，竟然用了足足800頁>終於有架構大牛把分佈式系統概念講明白了，竟然用了足足800頁</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5b9be76b.html alt=Hadoop分佈式文件系統架構和設計原理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/c200950907404ad4bfb1d0172e71b4ef style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5b9be76b.html title=Hadoop分佈式文件系統架構和設計原理>Hadoop分佈式文件系統架構和設計原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5184104a.html alt="【系統架構】8種至關重要的OAuth API授權流與能力" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3deb0d521aaa45b2bc63333d0d136f57 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5184104a.html title="【系統架構】8種至關重要的OAuth API授權流與能力">【系統架構】8種至關重要的OAuth API授權流與能力</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8b00b993.html alt=《深入精通Mysql（一）》Mysql整體架構和sql執行過程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3a03943b7e3c456fb535e18f902470e4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8b00b993.html title=《深入精通Mysql（一）》Mysql整體架構和sql執行過程>《深入精通Mysql（一）》Mysql整體架構和sql執行過程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e26caebb.html alt=拿下系統架構師證書，有這一篇筆記就足夠了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8eb27d5939cc4b18aa846a27cb4d3403 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e26caebb.html title=拿下系統架構師證書，有這一篇筆記就足夠了>拿下系統架構師證書，有這一篇筆記就足夠了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9cfb070.html alt="億級流量分佈式系統核心架構設計——Spring Cloud微服務" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/fb9445e8a1ab4f4a960020ad28c054fc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9cfb070.html title="億級流量分佈式系統核心架構設計——Spring Cloud微服務">億級流量分佈式系統核心架構設計——Spring Cloud微服務</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e99fef0.html alt=收藏：最全銀行核心系統架構解讀（165頁PPT） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/d4f9e9d92cc64f18b93f06fc20559066 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e99fef0.html title=收藏：最全銀行核心系統架構解讀（165頁PPT）>收藏：最全銀行核心系統架構解讀（165頁PPT）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d577223.html alt=主流消息系統框架「架構師必看」 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1525076574068c4b92090ce style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d577223.html title=主流消息系統框架「架構師必看」>主流消息系統框架「架構師必看」</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/111d3d0.html alt="系統架構設計師 -- 計算機組成與結構（上）" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/f7463327-5dc2-4357-ae10-d0403a9050fc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/111d3d0.html title="系統架構設計師 -- 計算機組成與結構（上）">系統架構設計師 -- 計算機組成與結構（上）</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>