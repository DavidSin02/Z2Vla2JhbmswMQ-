<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Java 異步編程導論 | 极客快訊</title><meta property="og:title" content="Java 異步編程導論 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/3c356b1aa9b4416ca7b35a07f3033e13"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f74b39f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f74b39f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f74b39f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f74b39f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f74b39f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f74b39f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f74b39f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f74b39f.html><meta property="article:published_time" content="2020-10-29T20:59:18+08:00"><meta property="article:modified_time" content="2020-10-29T20:59:18+08:00"><meta name=Keywords content><meta name=description content="Java 異步編程導論"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/f74b39f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Java 異步編程導論</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p>異步編程是可以讓程序並行運行的一種手段，其可以讓程序中的一個工作單元與主應用程序線程分開獨立運行，並且等工作單元運行結束後通知主應用程序線程它的運行結果或者失敗原因。使用它有許多好處，例如改進的應用程序性能和減少用戶等待時間等。</p><p>在日常開發中我們經常會遇到這樣的情況，就是需要異步的處理一些事情，而主線程不需要知道異步任務的結果，最常見的是在調用線程裡面異步打日誌，在高併發系統中為了不讓日誌打印阻塞調用線程，會把日誌設置為異步方式，也就是使用一個隊列把日誌打印異步化，這種情況下調用線程把日誌任務放入隊列後就繼續去幹自己的事情了，而不再關心日誌任務具體是什麼時候入盤的。在Spring框架中提供的@Async註解就可以把一個任務異步化來進行處理，這個後面章節會具體講解。</p><p>另外有時候我們還需要開啟異步任務執行後，在主線程等待異步任務的執行結果，這時候Future就排上用場了，比如線程A要做從數據庫I和數據庫II查詢一條記錄，並且把兩者結果拼接起來作為前端展示使用，如線程A是同步調用兩次查詢，則整個過程耗時時間為訪問數據庫I的耗時加上訪問數據庫II的耗時，如下圖：</p><p class=ql-align-center><br></p><div class=pgc-img><img alt="Java 異步編程導論" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3c356b1aa9b4416ca7b35a07f3033e13><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>image.png</p><p>如果為異步調用則可以在線程A內開啟一個異步運行單元來從數據庫I獲取數據，然後線程A本身來從數據庫II獲取數據，並且等兩者結果都返回後，在拼接兩者結果，這時候整個過程耗時為max(線程A從數據庫II獲取數據耗時，異步運行單元從數據庫I獲取數據耗時），如下圖：</p><p class=ql-align-center><br></p><div class=pgc-img><img alt="Java 異步編程導論" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9d676a4ccf114aff8bf3fed45082a0bd><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>image.png</p><p>可見整個過程耗時有顯著縮短，對於用戶來說頁面響應時間會更短，對用戶體驗會更好，其中異步單元的執行一般是線程池中的線程。</p><p>使用Future確實可以獲取異步任務的執行結果，但是獲取其結果還是會阻塞調用線程的，並沒有實現完全異步化處理，在JDK8中提供了CompletableFuture來彌補了其缺點，實現了實際意義上的異步處理。</p><p>Java 8引入了lambdas和CompletableFuture，Lambdas允許編寫簡潔的回調，而CompletionStage接口和CompletableFuture類最終允許以非阻塞方式和基於推送的方式處理結果，其通過設置回調函數方式，讓主線程徹底解放出來，做自己的事情。</p><p>Java 8還引入了Stream，它旨在有效地處理數據流（包括原始類型），這些數據流可以在沒有延遲或很少延遲的情況下訪問，其使用聲明式編程讓我們可以寫出可讀性可維護性很強的代碼，其結合CompletableFuture可以完美的實現異步編程。但是它是基於拉的，只能使用一次，缺少與時間相關的操作，雖然可以執行並行計算，但無法指定要使用的線程池。它還沒有設計用於處理延遲的操作，例如I / O操作。這就是Reactor或RxJava等Reactive API的用武之地。</p><p>Reactor或RxJava等反應性API也提供Java 8 Stream等運算符，但它們更適用於任何流序列（不僅僅是集合），並允許定義一個轉換操作的管道，該管道將應用於通過它的數據，這要歸功於方便的流暢API和使用lambdas。它們旨在處理同步或異步操作，並允許您緩衝，合併，連接或對數據應用各種轉換。</p><p>另外對於網絡傳輸來說，同步調用時比較直截了當的，但是同步調用意味著當前發起請求的機器中的線程在遠端機器返回結果前必須阻塞等待，這明顯很浪費資源，好的做法應該是發起請求的機器發起調用線程發起請求後，註冊一個回調函數，然後馬上返回去做其他事情，當遠端把結果返回後在使用IO線程執行回調函數，也就是發起方實現了異步調用，調用線程不會被阻塞。</p><p>比如在使用rpc(遠程過程調用)發起請時候，使用異步編程也可以提高系統的性能，比如我們在一個線程A中通過rpc請求獲取服務B和服務C的數據然後基於兩者結果做一些事情。在同步rpc調用情況下，線程A需要調用服務B後需要等待服務B結果返回後，才可以對服務C發起調用，然後等服務C結果返回後才可以結合服務B和C的結果做一件事,如下圖：</p><p class=ql-align-center><br></p><div class=pgc-img><img alt="Java 異步編程導論" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/d1ada746628e4be0a1d77223f4c9a9cc><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>image.png</p><p>線程A同步獲取服務B結果後，在同步調用服務C獲取結果，可見在同步調用情況下線程A必須順序的對多個服務請求進行調用。</p><p>而在異步調用情況下，當線程A調用服務B時候，服務B直接會返回一個異步的futureB對象，然後線程A可以繼續訪問服務C，服務C也會返回一個futureC對象，然後線程A就可以基於futureB和futureC來獲取最終的返回結果，然後基於結果做一些事情，如下圖：</p><p class=ql-align-center><br></p><div class=pgc-img><img alt="Java 異步編程導論" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/e0ea543705584c5f969a7d1e97ffb0a1><p class=pgc-img-caption></p></div><p class=ql-align-center><br></p><p class=ql-align-center>image.png</p><p>可知異步調用情況下線程A可以併發的調用服務B和服務C，而不再是順序的，由於服務B和服務C是併發運行，所以相比線程A同步調用，線程A獲取到服務B和服務C結果的時間會縮短很多（同步調用情況下耗時時間為服務B和服務C返回結果耗時的和，異步調用時候耗時為max(服務B耗時，服務C耗時）），後面章節我們會以Dubbo框架為例其藉助Netty的非阻塞異步API實現了服務消費端的異步調用。</p><p>在Web應用中Servlet佔有一席之地，在Servlet3.0規範前，Servlet容器對Servlet的處理都是每個請求對應一個線程這種1：1的模式進行處理的，每當來一個請求時候都會開啟一個Servlet容器內的線程來進行處理，如果Servlet內處理比較耗時，則會把Servlet容器內線程使用耗盡，然後就不能再處理新的請求；Servlet3.0中則提供了異步處理的能力，讓Servlet容器中的線程可以及時釋放，具體Servlet業務處理邏輯是在業務自己線程池內來處理；雖然Servlet3.0規範讓Servlet的執行變為了異步，但是其IO還是阻塞式的，IO阻塞是說在Servlet處理請求時候從ServletInputStream中讀取請求體時候是阻塞的，而我們想要的是當數據已經就緒時候通知我們去讀取就可以了，因為這可以避免佔用我們自己的線程來進行阻塞讀取，Servlet3.1規範則提供了非阻塞IO來解決這個問題。</p><p>雖然Servlet技術棧的不斷髮展實現了異步處理與非阻塞IO，但是其異步是不徹底的，因為受制於Servlet規範本身，比如其規範是同步的（Filter，Servlet）或阻塞（getParameter，getPart）。所以新的使用少量線程和較少的硬件資源來處理併發非阻塞Web技術棧應運而生-WebFlux,其是與Servlet技術棧並行存在的一種新的技術，其基於JDK8函數式編程與Netty實現天然的異步、非阻塞處理。</p><p>另外為了更好的處理異步執行，一些框架也應運而生，比如高性能線程間消息傳遞庫Disruptor，其通過為事件（events）預先分配內存、無鎖CAS算法、緩衝行填充、兩階段協議提交來實現多線程併發的處理不同的元素，從而實現高性能的異步處理,關於併發編程相關知識可以參考《Java併發編程之美》一書；比如Akka其基於Actor模式實現了天然支持分佈式的使用消息進行異步處理的服務。</p><p>一些新興的語言對異步處理的支持能力讓我們忍不住稱讚，golang就是其中之一，其通過goroutine與channel可以輕鬆的實現複雜的異步處理能力。</p><div class=tt-column-card data-content='{"new_thumb_url": "http://sf1-ttcdn-tos.pstatp.com/img/pgc-image/156154482609605e3db01c4", "title": "\u5206\u5e03\u5f0fRPC\u6846\u67b6Dubbo\u5185\u6838\u539f\u7406\u5256\u6790", "distribution_user_id": 1624358660504589, "price": 29.9, "column_id": "6706788500336804110", "share_price": 2.39, "author_description": "\u683c\u5c40\u591a", "thumb_url": "http://p4.pstatp.com/large/pgc-image/156154482609605e3db01c4", "sold": 34}'></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Java</a></li><li><a>異步</a></li><li><a>編程</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/a6fdce0f.html alt=Java高級編程基礎：如何理解進程、線程與併發編程的關係 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/426d60ae-7dd7-4ab4-90bd-4dfeb286a68b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a6fdce0f.html title=Java高級編程基礎：如何理解進程、線程與併發編程的關係>Java高級編程基礎：如何理解進程、線程與併發編程的關係</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b4cccd0e.html alt=Java基礎：面向接口編程詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/fdda4de3-84ff-4cff-bb1e-c691ed81ff9c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b4cccd0e.html title=Java基礎：面向接口編程詳解>Java基礎：面向接口編程詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/06b80ade.html alt=5種人工智能編程語言！Java依然屹立不倒！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/e322fe75a0d34e36a7a876d3ccebf871 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/06b80ade.html title=5種人工智能編程語言！Java依然屹立不倒！>5種人工智能編程語言！Java依然屹立不倒！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2a836fe1.html alt=Java編程技巧：如何實現參數的輸入輸出？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/b36247aabf154a46aca31b642fc3cd0c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2a836fe1.html title=Java編程技巧：如何實現參數的輸入輸出？>Java編程技巧：如何實現參數的輸入輸出？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/85f832a.html alt=最佳推薦：阿里巴巴對Java編程的規約—集合處理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/0698a302502242dabe2d579bbe9869a9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/85f832a.html title=最佳推薦：阿里巴巴對Java編程的規約—集合處理>最佳推薦：阿里巴巴對Java編程的規約—集合處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fd08b19.html alt=異步編程：協作性多任務處理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/dbd0ddd7-eda4-430a-8176-da9804319771 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fd08b19.html title=異步編程：協作性多任務處理>異步編程：協作性多任務處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4cb74cd.html alt="Spring異步編程 | 你的@Async就真的異步嗎？異步歷險奇遇記" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b9d102263d0f46a0b5b203d7b6cd4a2e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4cb74cd.html title="Spring異步編程 | 你的@Async就真的異步嗎？異步歷險奇遇記">Spring異步編程 | 你的@Async就真的異步嗎？異步歷險奇遇記</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/325007f.html alt="教你如何用 Java 實現異步調用" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/325007f.html title="教你如何用 Java 實現異步調用">教你如何用 Java 實現異步調用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/852c87e.html alt="有了 CompletableFuture，使得異步編程沒有那麼難了" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e66a7bcfded64b34b43ebc1565b3e557 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/852c87e.html title="有了 CompletableFuture，使得異步編程沒有那麼難了">有了 CompletableFuture，使得異步編程沒有那麼難了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/630242c.html alt=認識Java異步編程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e1e2b766f8f9413597586d35d1739683 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/630242c.html title=認識Java異步編程>認識Java異步編程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8829489.html alt="Java NIO(8) : 異步模型之狀態機" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1522223705458c14ec4daaf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8829489.html title="Java NIO(8) : 異步模型之狀態機">Java NIO(8) : 異步模型之狀態機</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2c802a4.html alt="Java面向對象編程三大特徵 - 多態" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a5bb9d2879b949319bd0cff669dad24a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2c802a4.html title="Java面向對象編程三大特徵 - 多態">Java面向對象編程三大特徵 - 多態</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3e8c3b8.html alt=詳解編程中的同步和異步 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/b292fb03b256422bb94215ce3ec3bbaf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3e8c3b8.html title=詳解編程中的同步和異步>詳解編程中的同步和異步</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3a0dfd7.html alt="異步編程實例：Java8 API的理解和CompletableFuture類的實現" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1522150125651deaa9d51b2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3a0dfd7.html title="異步編程實例：Java8 API的理解和CompletableFuture類的實現">異步編程實例：Java8 API的理解和CompletableFuture類的實現</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c81ec36.html alt=異步編程提升服務性能 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15260210063976700d35c2d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c81ec36.html title=異步編程提升服務性能>異步編程提升服務性能</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>