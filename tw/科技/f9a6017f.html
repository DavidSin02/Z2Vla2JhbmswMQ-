<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>ä¸€æ–‡æå®šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFS | æå®¢å¿«è¨Š</title><meta property="og:title" content="ä¸€æ–‡æå®šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFS - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/c4fc524877574c51905170a1f43effdb"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f9a6017f.html><meta property="article:published_time" content="2020-11-14T21:03:23+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:23+08:00"><meta name=Keywords content><meta name=description content="ä¸€æ–‡æå®šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFS"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/f9a6017f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>ä¸€æ–‡æå®šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFS</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><div><p><strong>å¿…é ˆå…ˆè½‰ç™¼ï¼Œè½‰ç™¼ï¼Œè½‰ç™¼ï¼ŒåŠ â€œå¤§æ•¸æ“šjavaæ¶æ§‹å¸«â€é—œæ³¨ï¼Œé—œæ³¨ï¼Œç„¶å¾Œç§ä¿¡æˆ‘â€œDFSâ€å³å¯å…è²»ç²å–æ›´å¤šè³‡æ–™ä¸‹è¼‰åœ°å€</strong></p><p>æ¦‚è¿°</p><p>åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±ï¼šDistributed file system, DFSï¼Œåˆå«åšç¶²çµ¡æ–‡ä»¶ç³»çµ±ï¼šNetwork File Systemã€‚ä¸€ç¨®å…è¨±æ–‡ä»¶é€šéç¶²çµ¡åœ¨å¤šè‡ºä¸»æ©Ÿä¸Šåˆ†äº«çš„æ–‡ä»¶ç³»çµ±ï¼Œå¯è®“å¤šæ©Ÿå™¨ä¸Šçš„å¤šç”¨æˆ¶åˆ†äº«æ–‡ä»¶å’Œå­˜å„²ç©ºé–“ã€‚</p><p>FastDFSæ˜¯ç”¨cèªè¨€ç·¨å¯«çš„ä¸€æ¬¾é–‹æºçš„åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±ï¼Œå……åˆ†è€ƒæ…®äº†å†—é¤˜å‚™ä»½ã€è² è¼‰å‡è¡¡ã€ç·šæ€§æ“´å®¹ç­‰æ©Ÿåˆ¶ï¼Œä¸¦æ³¨é‡é«˜å¯ç”¨ã€é«˜æ€§èƒ½ç­‰æŒ‡æ¨™ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼šæ–‡ä»¶å­˜å„²ã€æ–‡ä»¶åŒæ­¥ã€æ–‡ä»¶è¨ªå•ï¼ˆæ–‡ä»¶ä¸Šå‚³ã€æ–‡ä»¶ä¸‹è¼‰ï¼‰ç­‰ï¼Œè§£æ±ºäº†å¤§å®¹é‡å­˜å„²å’Œè² è¼‰å‡è¡¡çš„å•é¡Œã€‚ç‰¹åˆ¥é©åˆä¸­å°æ–‡ä»¶ï¼ˆå»ºè­°ç¯„åœï¼š4KB &lt; file_size &lt;500MBï¼‰ï¼Œå°ä»¥æ–‡ä»¶ç‚ºè¼‰é«”çš„åœ¨ç·šæœå‹™ï¼Œå¦‚ç›¸å†Šç¶²ç«™ã€è¦–é »ç¶²ç«™ç­‰ã€‚</p><p>FastDFS æ¶æ§‹</p><p>FastDFSæ¶æ§‹åŒ…æ‹¬Tracker serverå’ŒStorage serverã€‚å®¢æˆ¶ç«¯è«‹æ±‚Tracker serveré€²è¡Œæ–‡ä»¶ä¸Šå‚³ã€ä¸‹è¼‰ï¼Œé€šéTracker serverèª¿åº¦æœ€çµ‚ç”±Storage serverå®Œæˆæ–‡ä»¶ä¸Šå‚³å’Œä¸‹è¼‰ã€‚</p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c4fc524877574c51905170a1f43effdb><p class=pgc-img-caption></p></div><p>è·Ÿè¹¤æœå‹™å™¨Tracker Server</p><p>ä¸»è¦åšèª¿åº¦å·¥ä½œï¼Œèµ·åˆ°å‡è¡¡çš„ä½œç”¨ï¼›è² è²¬ç®¡ç†æ‰€æœ‰çš„ storage serverå’Œ groupï¼Œæ¯å€‹ storage åœ¨å•Ÿå‹•å¾Œæœƒé€£æ¥ Trackerï¼Œå‘ŠçŸ¥è‡ªå·±æ‰€å±¬ group ç­‰ä¿¡æ¯ï¼Œä¸¦ä¿æŒé€±æœŸæ€§å¿ƒè·³ã€‚trackeræ ¹æ“šstorageçš„å¿ƒè·³ä¿¡æ¯ï¼Œå»ºç«‹group==>[storage serverlist]çš„æ˜ å°„è¡¨ã€‚</p><p>Trackeréœ€è¦ç®¡ç†çš„å…ƒä¿¡æ¯å¾ˆå°‘ï¼Œæœƒå…¨éƒ¨å­˜å„²åœ¨å…§å­˜ä¸­ï¼›å¦å¤–trackerä¸Šçš„å…ƒä¿¡æ¯éƒ½æ˜¯ç”±storageå½™å ±çš„ä¿¡æ¯ç”Ÿæˆçš„ï¼Œæœ¬èº«ä¸éœ€è¦æŒä¹…åŒ–ä»»ä½•æ•¸æ“šï¼Œé€™æ¨£ä½¿å¾—trackeréå¸¸å®¹æ˜“æ“´å±•ï¼Œç›´æ¥å¢åŠ trackeræ©Ÿå™¨å³å¯æ“´å±•ç‚ºtracker clusterä¾†æœå‹™ï¼Œclusterè£¡æ¯å€‹trackerä¹‹é–“æ˜¯å®Œå…¨å°ç­‰çš„ï¼Œæ‰€æœ‰çš„trackeréƒ½æ¥å—stroageçš„å¿ƒè·³ä¿¡æ¯ï¼Œç”Ÿæˆå…ƒæ•¸æ“šä¿¡æ¯ä¾†æä¾›è®€å¯«æœå‹™ã€‚</p><p>å­˜å„²æœå‹™å™¨Storage Server</p><p>ä¸»è¦æä¾›å®¹é‡å’Œå‚™ä»½æœå‹™ï¼›ä»¥ group ç‚ºå–®ä½ï¼Œæ¯å€‹ group å…§å¯ä»¥æœ‰å¤šè‡º storage serverï¼Œæ•¸æ“šäº’ç‚ºå‚™ä»½ã€‚ä»¥groupç‚ºå–®ä½çµ„ç¹”å­˜å„²èƒ½æ–¹ä¾¿çš„é€²è¡Œæ‡‰ç”¨éš”é›¢ã€è² è¼‰å‡è¡¡ã€å‰¯æœ¬æ•¸å®šè£½ï¼ˆgroupå…§storage serveræ•¸é‡å³ç‚ºè©²groupçš„å‰¯æœ¬æ•¸ï¼‰ï¼Œæ¯”å¦‚å°‡ä¸åŒæ‡‰ç”¨æ•¸æ“šå­˜åˆ°ä¸åŒçš„groupå°±èƒ½éš”é›¢æ‡‰ç”¨æ•¸æ“šï¼ŒåŒæ™‚é‚„å¯æ ¹æ“šæ‡‰ç”¨çš„è¨ªå•ç‰¹æ€§ä¾†å°‡æ‡‰ç”¨åˆ†é…åˆ°ä¸åŒçš„groupä¾†åšè² è¼‰å‡è¡¡ï¼›ç¼ºé»æ˜¯groupçš„å®¹é‡å—å–®æ©Ÿå­˜å„²å®¹é‡çš„é™åˆ¶ï¼ŒåŒæ™‚ç•¶groupå…§æœ‰æ©Ÿå™¨å£æ‰æ™‚ï¼Œæ•¸æ“šæ¢å¾©åªèƒ½ä¾è³´groupå…§åœ°å…¶ä»–æ©Ÿå™¨ï¼Œä½¿å¾—æ¢å¾©æ™‚é–“æœƒå¾ˆé•·ã€‚</p><p>groupå…§æ¯å€‹storageçš„å­˜å„²ä¾è³´æ–¼æœ¬åœ°æ–‡ä»¶ç³»çµ±ï¼Œstorageå¯é…ç½®å¤šå€‹æ•¸æ“šå­˜å„²ç›®éŒ„ï¼Œæ¯”å¦‚æœ‰10å¡Šç£ç›¤ï¼Œåˆ†åˆ¥æ›è¼‰åœ¨/data/disk1-/data/disk10ï¼Œå‰‡å¯å°‡é€™10å€‹ç›®éŒ„éƒ½é…ç½®ç‚ºstorageçš„æ•¸æ“šå­˜å„²ç›®éŒ„ã€‚storageæ¥å—åˆ°å¯«æ–‡ä»¶è«‹æ±‚æ™‚ï¼Œæœƒæ ¹æ“šé…ç½®å¥½çš„è¦å‰‡é¸æ“‡å…¶ä¸­ä¸€å€‹å­˜å„²ç›®éŒ„ä¾†å­˜å„²æ–‡ä»¶ã€‚ç‚ºäº†é¿å…å–®å€‹ç›®éŒ„ä¸‹çš„æ–‡ä»¶æ•¸å¤ªå¤šï¼Œåœ¨storageç¬¬ä¸€æ¬¡å•Ÿå‹•æ™‚ï¼Œæœƒåœ¨æ¯å€‹æ•¸æ“šå­˜å„²ç›®éŒ„è£¡å‰µå»º2ç´šå­ç›®éŒ„ï¼Œæ¯ç´š256å€‹ï¼Œç¸½å…±65536å€‹æ–‡ä»¶ï¼Œæ–°å¯«çš„æ–‡ä»¶æœƒä»¥hashçš„æ–¹å¼è¢«è·¯ç”±åˆ°å…¶ä¸­æŸå€‹å­ç›®éŒ„ä¸‹ï¼Œç„¶å¾Œå°‡æ–‡ä»¶æ•¸æ“šä½œç‚ºæœ¬åœ°æ–‡ä»¶å­˜å„²åˆ°è©²ç›®éŒ„ä¸­ã€‚</p><p>FastDFSçš„å­˜å„²ç­–ç•¥</p><p>ç‚ºäº†æ”¯æŒå¤§å®¹é‡ï¼Œå­˜å„²ç¯€é»ï¼ˆæœå‹™å™¨ï¼‰æ¡ç”¨äº†åˆ†å·ï¼ˆæˆ–åˆ†çµ„ï¼‰çš„çµ„ç¹”æ–¹å¼ã€‚å­˜å„²ç³»çµ±ç”±ä¸€å€‹æˆ–å¤šå€‹å·çµ„æˆï¼Œå·èˆ‡å·ä¹‹é–“çš„æ–‡ä»¶æ˜¯ç›¸äº’ç¨ç«‹çš„ï¼Œæ‰€æœ‰å·çš„æ–‡ä»¶å®¹é‡ç´¯åŠ å°±æ˜¯æ•´å€‹å­˜å„²ç³»çµ±ä¸­çš„æ–‡ä»¶å®¹é‡ã€‚ä¸€å€‹å·å¯ä»¥ç”±ä¸€è‡ºæˆ–å¤šè‡ºå­˜å„²æœå‹™å™¨çµ„æˆï¼Œä¸€å€‹å·ä¸‹çš„å­˜å„²æœå‹™å™¨ä¸­çš„æ–‡ä»¶éƒ½æ˜¯ç›¸åŒçš„ï¼Œå·ä¸­çš„å¤šè‡ºå­˜å„²æœå‹™å™¨èµ·åˆ°äº†å†—é¤˜å‚™ä»½å’Œè² è¼‰å‡è¡¡çš„ä½œç”¨ã€‚</p><p>åœ¨å·ä¸­å¢åŠ æœå‹™å™¨æ™‚ï¼ŒåŒæ­¥å·²æœ‰çš„æ–‡ä»¶ç”±ç³»çµ±è‡ªå‹•å®Œæˆï¼ŒåŒæ­¥å®Œæˆå¾Œï¼Œç³»çµ±è‡ªå‹•å°‡æ–°å¢æœå‹™å™¨åˆ‡æ›åˆ°ç·šä¸Šæä¾›æœå‹™ã€‚ç•¶å­˜å„²ç©ºé–“ä¸è¶³æˆ–å³å°‡è€—ç›¡æ™‚ï¼Œå¯ä»¥å‹•æ…‹æ·»åŠ æ²ã€‚åªéœ€è¦å¢åŠ ä¸€è‡ºæˆ–å¤šè‡ºæœå‹™å™¨ï¼Œä¸¦å°‡å®ƒå€‘é…ç½®ç‚ºä¸€å€‹æ–°çš„å·ï¼Œé€™æ¨£å°±æ“´å¤§äº†å­˜å„²ç³»çµ±çš„å®¹é‡ã€‚</p><p>FastDFSçš„ä¸Šå‚³éç¨‹</p><p>FastDFSå‘ä½¿ç”¨è€…æä¾›åŸºæœ¬æ–‡ä»¶è¨ªå•æ¥å£ï¼Œæ¯”å¦‚uploadã€downloadã€appendã€deleteç­‰ï¼Œä»¥å®¢æˆ¶ç«¯åº«çš„æ–¹å¼æä¾›çµ¦ç”¨æˆ¶ä½¿ç”¨ã€‚</p><p>Storage Serveræœƒå®šæœŸçš„å‘Tracker Serverç™¼é€è‡ªå·±çš„å­˜å„²ä¿¡æ¯ã€‚ç•¶Tracker Server Clusterä¸­çš„Tracker Serverä¸æ­¢ä¸€å€‹æ™‚ï¼Œå„å€‹Trackerä¹‹é–“çš„é—œä¿‚æ˜¯å°ç­‰çš„ï¼Œæ‰€ä»¥å®¢æˆ¶ç«¯ä¸Šå‚³æ™‚å¯ä»¥é¸æ“‡ä»»æ„ä¸€å€‹Trackerã€‚</p><p>ç•¶Trackeræ”¶åˆ°å®¢æˆ¶ç«¯ä¸Šå‚³æ–‡ä»¶çš„è«‹æ±‚æ™‚ï¼Œæœƒç‚ºè©²æ–‡ä»¶åˆ†é…ä¸€å€‹å¯ä»¥å­˜å„²æ–‡ä»¶çš„groupï¼Œç•¶é¸å®šäº†groupå¾Œå°±è¦æ±ºå®šçµ¦å®¢æˆ¶ç«¯åˆ†é…groupä¸­çš„å“ªä¸€å€‹storage serverã€‚ç•¶åˆ†é…å¥½storage serverå¾Œï¼Œå®¢æˆ¶ç«¯å‘storageç™¼é€å¯«æ–‡ä»¶è«‹æ±‚ï¼Œstorageå°‡æœƒç‚ºæ–‡ä»¶åˆ†é…ä¸€å€‹æ•¸æ“šå­˜å„²ç›®éŒ„ã€‚ç„¶å¾Œç‚ºæ–‡ä»¶åˆ†é…ä¸€å€‹fileidï¼Œæœ€å¾Œæ ¹æ“šä»¥ä¸Šçš„ä¿¡æ¯ç”Ÿæˆæ–‡ä»¶åå­˜å„²æ–‡ä»¶ã€‚</p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/01f99f6d91f94b6b8b31e47feb7e2c6d><p class=pgc-img-caption></p></div><p>é¸æ“‡tracker server</p><p>ç•¶é›†ç¾¤ä¸­ä¸æ­¢ä¸€å€‹tracker serveræ™‚ï¼Œç”±æ–¼trackerä¹‹é–“æ˜¯å®Œå…¨å°ç­‰çš„é—œä¿‚ï¼Œå®¢æˆ¶ç«¯åœ¨uploadæ–‡ä»¶æ™‚å¯ä»¥ä»»æ„é¸æ“‡ä¸€å€‹trakcerã€‚</p><p>é¸æ“‡å­˜å„²çš„group</p><p>ç•¶trackeræ¥æ”¶åˆ°upload fileçš„è«‹æ±‚æ™‚ï¼Œæœƒç‚ºè©²æ–‡ä»¶åˆ†é…ä¸€å€‹å¯ä»¥å­˜å„²è©²æ–‡ä»¶çš„groupï¼Œæ”¯æŒå¦‚ä¸‹é¸æ“‡groupçš„è¦å‰‡ï¼š 1. Round robinï¼Œæ‰€æœ‰çš„groupé–“è¼ªè©¢ 2. Specified groupï¼ŒæŒ‡å®šæŸä¸€å€‹ç¢ºå®šçš„group 3. Load balanceï¼Œå‰©é¤˜å­˜å„²ç©ºé–“å¤šå¤šgroupå„ªå…ˆ</p><p>é¸æ“‡storage server</p><p>ç•¶é¸å®šgroupå¾Œï¼Œtrackeræœƒåœ¨groupå…§é¸æ“‡ä¸€å€‹storage serverçµ¦å®¢æˆ¶ç«¯ï¼Œæ”¯æŒå¦‚ä¸‹é¸æ“‡storageçš„è¦å‰‡ï¼š 1. Round robinï¼Œåœ¨groupå…§çš„æ‰€æœ‰storageé–“è¼ªè©¢ 2. First server ordered by ipï¼ŒæŒ‰ipæ’åº 3. First server ordered by priorityï¼ŒæŒ‰å„ªå…ˆç´šæ’åºï¼ˆå„ªå…ˆç´šåœ¨storageä¸Šé…ç½®ï¼‰</p><p>é¸æ“‡storage path</p><p>ç•¶åˆ†é…å¥½storage serverå¾Œï¼Œå®¢æˆ¶ç«¯å°‡å‘storageç™¼é€å¯«æ–‡ä»¶è«‹æ±‚ï¼Œstorageå°‡æœƒç‚ºæ–‡ä»¶åˆ†é…ä¸€å€‹æ•¸æ“šå­˜å„²ç›®éŒ„ï¼Œæ”¯æŒå¦‚ä¸‹è¦å‰‡ï¼š 1. Round robinï¼Œå¤šå€‹å­˜å„²ç›®éŒ„é–“è¼ªè©¢ 2. å‰©é¤˜å­˜å„²ç©ºé–“æœ€å¤šçš„å„ªå…ˆ</p><p>ç”ŸæˆFileid</p><p>é¸å®šå­˜å„²ç›®éŒ„ä¹‹å¾Œï¼Œstorageæœƒç‚ºæ–‡ä»¶ç”Ÿä¸€å€‹Fileidï¼Œç”±storage server ipã€æ–‡ä»¶å‰µå»ºæ™‚é–“ã€æ–‡ä»¶å¤§å°ã€æ–‡ä»¶crc32å’Œä¸€å€‹éš¨æ©Ÿæ•¸æ‹¼æ¥è€Œæˆï¼Œç„¶å¾Œå°‡é€™å€‹äºŒé€²åˆ¶ä¸²é€²è¡Œbase64ç·¨ç¢¼ï¼Œè½‰æ›ç‚ºå¯æ‰“å°çš„å­—ç¬¦ä¸²ã€‚</p><p>é¸æ“‡å…©ç´šç›®éŒ„</p><p>ç•¶é¸å®šå­˜å„²ç›®éŒ„ä¹‹å¾Œï¼Œstorageæœƒç‚ºæ–‡ä»¶åˆ†é…ä¸€å€‹fileidï¼Œæ¯å€‹å­˜å„²ç›®éŒ„ä¸‹æœ‰å…©ç´š256*256çš„å­ç›®éŒ„ï¼ŒstorageæœƒæŒ‰æ–‡ä»¶fileidé€²è¡Œå…©æ¬¡hashï¼ˆçŒœæ¸¬ï¼‰ï¼Œè·¯ç”±åˆ°å…¶ä¸­ä¸€å€‹å­ç›®éŒ„ï¼Œç„¶å¾Œå°‡æ–‡ä»¶ä»¥fileidç‚ºæ–‡ä»¶åå­˜å„²åˆ°è©²å­ç›®éŒ„ä¸‹ã€‚</p><p>ç”Ÿæˆæ–‡ä»¶å</p><p>ç•¶æ–‡ä»¶å­˜å„²åˆ°æŸå€‹å­ç›®éŒ„å¾Œï¼Œå³èªç‚ºè©²æ–‡ä»¶å­˜å„²æˆåŠŸï¼Œæ¥ä¸‹ä¾†æœƒç‚ºè©²æ–‡ä»¶ç”Ÿæˆä¸€å€‹æ–‡ä»¶åï¼Œæ–‡ä»¶åç”±groupã€å­˜å„²ç›®éŒ„ã€å…©ç´šå­ç›®éŒ„ã€fileidã€æ–‡ä»¶å¾Œç¶´åï¼ˆç”±å®¢æˆ¶ç«¯æŒ‡å®šï¼Œä¸»è¦ç”¨æ–¼å€åˆ†æ–‡ä»¶é¡å‹ï¼‰æ‹¼æ¥è€Œæˆã€‚</p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/32867cb165b0459bb46f06c0a825cd82><p class=pgc-img-caption></p></div><p>FastDFSçš„æ–‡ä»¶åŒæ­¥</p><p>å¯«æ–‡ä»¶æ™‚ï¼Œå®¢æˆ¶ç«¯å°‡æ–‡ä»¶å¯«è‡³groupå…§ä¸€å€‹storage serverå³èªç‚ºå¯«æ–‡ä»¶æˆåŠŸï¼Œstorage serverå¯«å®Œæ–‡ä»¶å¾Œï¼Œæœƒç”±å¾Œè‡ºç·šç¨‹å°‡æ–‡ä»¶åŒæ­¥è‡³åŒgroupå…§å…¶ä»–çš„storage serverã€‚</p><p>æ¯å€‹storageå¯«æ–‡ä»¶å¾Œï¼ŒåŒæ™‚æœƒå¯«ä¸€ä»½binlogï¼Œbinlogè£¡ä¸åŒ…å«æ–‡ä»¶æ•¸æ“šï¼ŒåªåŒ…å«æ–‡ä»¶åç­‰å…ƒä¿¡æ¯ï¼Œé€™ä»½binlogç”¨æ–¼å¾Œè‡ºåŒæ­¥ï¼Œstorageæœƒè¨˜éŒ„å‘groupå…§å…¶ä»–storageåŒæ­¥çš„é€²åº¦ï¼Œä»¥ä¾¿é‡å•Ÿå¾Œèƒ½æ¥ä¸Šæ¬¡çš„é€²åº¦ç¹¼çºŒåŒæ­¥ï¼›é€²åº¦ä»¥æ™‚é–“æˆ³çš„æ–¹å¼é€²è¡Œè¨˜éŒ„ï¼Œæ‰€ä»¥æœ€å¥½èƒ½ä¿è­‰é›†ç¾¤å…§æ‰€æœ‰serverçš„æ™‚é˜ä¿æŒåŒæ­¥ã€‚</p><p>storageçš„åŒæ­¥é€²åº¦æœƒä½œç‚ºå…ƒæ•¸æ“šçš„ä¸€éƒ¨åˆ†å½™å ±åˆ°trackerä¸Šï¼Œtrackeåœ¨é¸æ“‡è®€storageçš„æ™‚å€™æœƒä»¥åŒæ­¥é€²åº¦ä½œç‚ºåƒè€ƒã€‚</p><p>æ¯”å¦‚ä¸€å€‹groupå…§æœ‰Aã€Bã€Cä¸‰å€‹storage serverï¼ŒAå‘CåŒæ­¥åˆ°é€²åº¦ç‚ºT1 (T1ä»¥å‰å¯«çš„æ–‡ä»¶éƒ½å·²ç¶“åŒæ­¥åˆ°Bä¸Šäº†ï¼‰ï¼ŒBå‘CåŒæ­¥åˆ°æ™‚é–“æˆ³ç‚ºT2ï¼ˆT2 > T1)ï¼Œtrackeræ¥æ”¶åˆ°é€™äº›åŒæ­¥é€²åº¦ä¿¡æ¯æ™‚ï¼Œå°±æœƒé€²è¡Œæ•´ç†ï¼Œå°‡æœ€å°çš„é‚£å€‹åšç‚ºCçš„åŒæ­¥æ™‚é–“æˆ³ï¼Œæœ¬ä¾‹ä¸­T1å³ç‚ºCçš„åŒæ­¥æ™‚é–“æˆ³ç‚ºT1ï¼ˆå³æ‰€æœ‰T1ä»¥å‰å¯«çš„æ•¸æ“šéƒ½å·²ç¶“åŒæ­¥åˆ°Cä¸Šäº†ï¼‰ï¼›åŒç†ï¼Œæ ¹æ“šä¸Šè¿°è¦å‰‡ï¼Œtrackeræœƒç‚ºAã€Bç”Ÿæˆä¸€å€‹åŒæ­¥æ™‚é–“æˆ³ã€‚</p><p>FastDFSçš„æ–‡ä»¶ä¸‹è¼‰</p><p>å®¢æˆ¶ç«¯uploadfileæˆåŠŸå¾Œï¼Œæœƒæ‹¿åˆ°ä¸€å€‹storageç”Ÿæˆçš„æ–‡ä»¶åï¼Œæ¥ä¸‹ä¾†å®¢æˆ¶ç«¯æ ¹æ“šé€™å€‹æ–‡ä»¶åå³å¯è¨ªå•åˆ°è©²æ–‡ä»¶ã€‚</p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/010c054136f84170900a3d04086edd24><p class=pgc-img-caption></p></div><p>è·Ÿupload fileä¸€æ¨£ï¼Œåœ¨downloadfileæ™‚å®¢æˆ¶ç«¯å¯ä»¥é¸æ“‡ä»»æ„tracker serverã€‚trackerç™¼é€downloadè«‹æ±‚çµ¦æŸå€‹trackerï¼Œå¿…é ˆå¸¶ä¸Šæ–‡ä»¶åä¿¡æ¯ï¼Œtrackeå¾æ–‡ä»¶åä¸­è§£æå‡ºæ–‡ä»¶çš„groupã€å¤§å°ã€å‰µå»ºæ™‚é–“ç­‰ä¿¡æ¯ï¼Œç„¶å¾Œç‚ºè©²è«‹æ±‚é¸æ“‡ä¸€å€‹storageç”¨ä¾†æœå‹™è®€è«‹æ±‚ã€‚</p><p>FastDFSæ€§èƒ½æ–¹æ¡ˆ</p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ccf74326f11d4bb0a37cfd1885433b76><p class=pgc-img-caption></p></div><p>FastDFS å®‰è£</p><p>è»Ÿä»¶åŒ…ç‰ˆæœ¬FastDFSv5.05libfastcommonv1.0.7</p><p>ä¸‹è¼‰å®‰è£libfastcommon</p><ul><li>ä¸‹è¼‰</li></ul><pre>wget https://github.com/happyfish100/libfastcommon/archive/V1.0.7.tar.gz</pre><ul><li>è§£å£“</li></ul><pre>tar -xvf V1.0.7.tar.gzcd libfastcommon-1.0.7</pre><ul><li>ç·¨è­¯ã€å®‰è£</li></ul><pre>./make.sh./make.sh install</pre><ul><li>å‰µå»ºè»Ÿéˆæ¥</li></ul><pre>ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.soln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.soln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.soln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so </pre><p>ä¸‹è¼‰å®‰è£FastDFS</p><ul><li>ä¸‹è¼‰FastDFS</li></ul><pre> wget https://github.com/happyfish100/fastdfs/archive/V5.05.tar.gz</pre><ul><li>è§£å£“</li></ul><pre>tar -xvf V5.05.tar.gzcd fastdfs-5.05</pre><ul><li>ç·¨è­¯ã€å®‰è£</li></ul><pre>./make.sh./make.sh install</pre><p>é…ç½® Tracker æœå‹™</p><p>ä¸Šè¿°å®‰è£æˆåŠŸå¾Œï¼Œåœ¨/etc/ç›®éŒ„ä¸‹æœƒæœ‰ä¸€å€‹fdfsçš„ç›®éŒ„ï¼Œé€²å…¥å®ƒã€‚æœƒçœ‹åˆ°ä¸‰å€‹.sampleå¾Œç¶´çš„æ–‡ä»¶ï¼Œé€™æ˜¯ä½œè€…çµ¦æˆ‘å€‘çš„ç¤ºä¾‹æ–‡ä»¶ï¼Œæˆ‘å€‘éœ€è¦æŠŠå…¶ä¸­çš„tracker.conf.sampleæ–‡ä»¶æ”¹ç‚ºtracker.confé…ç½®æ–‡ä»¶ä¸¦ä¿®æ”¹å®ƒï¼š</p><pre>cp tracker.conf.sample tracker.confvi tracker.conf</pre><p>ç·¨è¼¯tracker.conf</p><pre># é…ç½®æ–‡ä»¶æ˜¯å¦ä¸ç”Ÿæ•ˆï¼Œfalse ç‚ºç”Ÿæ•ˆdisabled=false# æä¾›æœå‹™çš„ç«¯å£port=22122# Tracker æ•¸æ“šå’Œæ—¥èªŒç›®éŒ„åœ°å€base_path=//home/data/fastdfs# HTTP æœå‹™ç«¯å£http.server_port=80</pre><p>å‰µå»ºtrackeråŸºç¤æ•¸æ“šç›®éŒ„ï¼Œå³base_pathå°æ‡‰çš„ç›®éŒ„</p><pre>mkdir -p /home/data/fastdfs</pre><p>ä½¿ç”¨ln -s å»ºç«‹è»Ÿéˆæ¥</p><pre>ln -s /usr/bin/fdfs_trackerd /usr/local/binln -s /usr/bin/stop.sh /usr/local/binln -s /usr/bin/restart.sh /usr/local/bin</pre><p>å•Ÿå‹•æœå‹™</p><pre>service fdfs_trackerd start</pre><p>æŸ¥çœ‹ç›£è½</p><pre>netstat -unltp|grep fdfs</pre><p>å¦‚æœçœ‹åˆ°22122ç«¯å£æ­£å¸¸è¢«ç›£è½å¾Œï¼Œé€™æ™‚å€™èªªæ˜Trackeræœå‹™å•Ÿå‹•æˆåŠŸå•¦ï¼</p><p>tracker server ç›®éŒ„åŠæ–‡ä»¶çµæ§‹ Trackeræœå‹™å•Ÿå‹•æˆåŠŸå¾Œï¼Œæœƒåœ¨base_pathä¸‹å‰µå»ºdataã€logså…©å€‹ç›®éŒ„ã€‚ç›®éŒ„çµæ§‹å¦‚ä¸‹ï¼š</p><pre>${base_path} |__data | |__storage_groups.datï¼šå­˜å„²åˆ†çµ„ä¿¡æ¯ | |__storage_servers.datï¼šå­˜å„²æœå‹™å™¨åˆ—è¡¨ |__logs | |__trackerd.logï¼š tracker server æ—¥èªŒæ–‡ä»¶ </pre><p>é…ç½® Storage æœå‹™</p><p>é€²å…¥ /etc/fdfs ç›®éŒ„ï¼Œè¤‡è£½ FastDFS å­˜å„²å™¨æ¨£ä¾‹é…ç½®æ–‡ä»¶ storage.conf.sampleï¼Œä¸¦é‡å‘½åç‚º storage.conf</p><pre># cd /etc/fdfs# cp storage.conf.sample storage.conf# vi storage.conf</pre><p>ç·¨è¼¯storage.conf</p><pre># é…ç½®æ–‡ä»¶æ˜¯å¦ä¸ç”Ÿæ•ˆï¼Œfalse ç‚ºç”Ÿæ•ˆdisabled=false# æŒ‡å®šæ­¤ storage server æ‰€åœ¨ çµ„(å·)group_name=group1# storage server æœå‹™ç«¯å£port=23000# å¿ƒè·³é–“éš”æ™‚é–“ï¼Œå–®ä½ç‚ºç§’ (é€™è£¡æ˜¯æŒ‡ä¸»å‹•å‘ tracker server ç™¼é€å¿ƒè·³)heart_beat_interval=30# Storage æ•¸æ“šå’Œæ—¥èªŒç›®éŒ„åœ°å€(æ ¹ç›®éŒ„å¿…é ˆå­˜åœ¨ï¼Œå­ç›®éŒ„æœƒè‡ªå‹•ç”Ÿæˆ)base_path=/home/data/fastdfs/storage# å­˜æ”¾æ–‡ä»¶æ™‚ storage server æ”¯æŒå¤šå€‹è·¯å¾‘ã€‚é€™è£¡é…ç½®å­˜æ”¾æ–‡ä»¶çš„åŸºè·¯å¾‘æ•¸ç›®ï¼Œé€šå¸¸åªé…ä¸€å€‹ç›®éŒ„ã€‚store_path_count=1# é€ä¸€é…ç½® store_path_count å€‹è·¯å¾‘ï¼Œç´¢å¼•è™ŸåŸºæ–¼ 0ã€‚# å¦‚æœä¸é…ç½® store_path0ï¼Œé‚£å®ƒå°±å’Œ base_path å°æ‡‰çš„è·¯å¾‘ä¸€æ¨£ã€‚store_path0=/home/data/fastdfs/storage# FastDFS å­˜å„²æ–‡ä»¶æ™‚ï¼Œæ¡ç”¨äº†å…©ç´šç›®éŒ„ã€‚é€™è£¡é…ç½®å­˜æ”¾æ–‡ä»¶çš„ç›®éŒ„å€‹æ•¸ã€‚ # å¦‚æœæœ¬åƒæ•¸åªç‚º Nï¼ˆå¦‚ï¼š 256ï¼‰ï¼Œé‚£éº¼ storage server åœ¨åˆæ¬¡é‹è¡Œæ™‚ï¼Œæœƒåœ¨ store_path ä¸‹è‡ªå‹•å‰µå»º N * N å€‹å­˜æ”¾æ–‡ä»¶çš„å­ç›®éŒ„ã€‚subdir_count_per_path=256# tracker_server çš„åˆ—è¡¨ ï¼Œæœƒä¸»å‹•é€£æ¥ tracker_server# æœ‰å¤šå€‹ tracker server æ™‚ï¼Œæ¯å€‹ tracker server å¯«ä¸€è¡Œtracker_server=192.168.1.190:22122# å…è¨±ç³»çµ±åŒæ­¥çš„æ™‚é–“æ®µ (é»˜èªæ˜¯å…¨å¤©) ã€‚ä¸€èˆ¬ç”¨æ–¼é¿å…é«˜å³°åŒæ­¥ç”¢ç”Ÿä¸€äº›å•é¡Œè€Œè¨­å®šã€‚sync_start_time=00:00sync_end_time=23:59</pre><p>ä½¿ç”¨ln -s å»ºç«‹è»Ÿéˆæ¥</p><pre>ln -s /usr/bin/fdfs_storaged /usr/local/bin</pre><p>å•Ÿå‹•æœå‹™</p><pre>service fdfs_storaged start</pre><p>æŸ¥çœ‹ç›£è½</p><pre>netstat -unltp|grep fdfs</pre><p>å•Ÿå‹•Storageå‰ç¢ºä¿Trackeræ˜¯å•Ÿå‹•çš„ã€‚åˆæ¬¡å•Ÿå‹•æˆåŠŸï¼Œæœƒåœ¨ /home/data/fastdfs/storage ç›®éŒ„ä¸‹å‰µå»º dataã€ logs å…©å€‹ç›®éŒ„ã€‚å¦‚æœçœ‹åˆ°23000ç«¯å£æ­£å¸¸è¢«ç›£è½å¾Œï¼Œé€™æ™‚å€™èªªæ˜Storageæœå‹™å•Ÿå‹•æˆåŠŸå•¦ï¼</p><p>æŸ¥çœ‹Storageå’ŒTrackeræ˜¯å¦åœ¨é€šä¿¡</p><pre>/usr/bin/fdfs_monitor /etc/fdfs/storage.conf</pre><p>FastDFS é…ç½® Nginx æ¨¡å¡Š</p><p>è»Ÿä»¶åŒ…ç‰ˆæœ¬openrestyv1.13.6.1fastdfs-nginx-modulev1.1.6</p><p>FastDFS é€šé Tracker æœå‹™å™¨ï¼Œå°‡æ–‡ä»¶æ”¾åœ¨ Storage æœå‹™å™¨å­˜å„²ï¼Œ ä½†æ˜¯åŒçµ„å­˜å„²æœå‹™å™¨ä¹‹é–“éœ€è¦é€²è¡Œæ–‡ä»¶è¤‡è£½ï¼Œæœ‰åŒæ­¥å»¶é²çš„å•é¡Œã€‚</p><p>å‡è¨­ Tracker æœå‹™å™¨å°‡æ–‡ä»¶ä¸Šå‚³åˆ°äº† 192.168.1.190ï¼Œä¸Šå‚³æˆåŠŸå¾Œæ–‡ä»¶ IDå·²ç¶“è¿”å›çµ¦å®¢æˆ¶ç«¯ã€‚æ­¤æ™‚ FastDFS å­˜å„²é›†ç¾¤æ©Ÿåˆ¶æœƒå°‡é€™å€‹æ–‡ä»¶åŒæ­¥åˆ°åŒçµ„å­˜192.168.1.190ï¼Œåœ¨æ–‡ä»¶é‚„æ²’æœ‰è¤‡è£½å®Œæˆçš„æƒ…æ³ä¸‹ï¼Œå®¢æˆ¶ç«¯å¦‚æœç”¨é€™å€‹æ–‡ä»¶ ID åœ¨ 192.168.1.190 ä¸Šå–æ–‡ä»¶,å°±æœƒå‡ºç¾æ–‡ä»¶ç„¡æ³•è¨ªå•çš„éŒ¯èª¤ã€‚è€Œ fastdfs-nginx-module å¯ä»¥é‡å®šå‘æ–‡ä»¶éˆæ¥åˆ°æºæœå‹™å™¨å–æ–‡ä»¶ï¼Œé¿å…å®¢æˆ¶ç«¯ç”±æ–¼è¤‡è£½å»¶é²å°è‡´çš„æ–‡ä»¶ç„¡æ³•è¨ªå•éŒ¯èª¤ã€‚</p><p>ä¸‹è¼‰ å®‰è£ Nginx å’Œ fastdfs-nginx-moduleï¼š</p><p>æ¨è–¦æ‚¨ä½¿ç”¨yumå®‰è£ä»¥ä¸‹çš„é–‹ç™¼åº«:</p><pre>yum install readline-devel pcre-devel openssl-devel -y</pre><p>ä¸‹è¼‰æœ€æ–°ç‰ˆæœ¬ä¸¦è§£å£“ï¼š</p><pre>wget https://openresty.org/download/openresty-1.13.6.1.tar.gztar -xvf openresty-1.13.6.1.tar.gzwget https://github.com/happyfish100/fastdfs-nginx-module/archive/master.zipunzip master.zip</pre><p>é…ç½® nginx å®‰è£ï¼ŒåŠ å…¥fastdfs-nginx-moduleæ¨¡å¡Šï¼š</p><pre>./configure --add-module=../fastdfs-nginx-module-master/src/</pre><p>ç·¨è­¯ã€å®‰è£ï¼š</p><pre>make &amp;&amp; make install</pre><p>æŸ¥çœ‹Nginxçš„æ¨¡å¡Šï¼š</p><pre>/usr/local/openresty/nginx/sbin/nginx -v</pre><p>æœ‰ä¸‹é¢é€™å€‹å°±èªªæ˜æ·»åŠ æ¨¡å¡ŠæˆåŠŸ</p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a79861202b6542259f8e45e474232e2b><p class=pgc-img-caption></p></div><p>è¤‡è£½ fastdfs-nginx-module æºç¢¼ä¸­çš„é…ç½®æ–‡ä»¶åˆ°/etc/fdfs ç›®éŒ„ï¼Œ ä¸¦ä¿®æ”¹ï¼š</p><pre>cp /fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs/# é€£æ¥è¶…æ™‚æ™‚é–“connect_timeout=10# Tracker Servertracker_server=192.168.1.190:22122# StorageServer é»˜èªç«¯å£storage_server_port=23000# å¦‚æœæ–‡ä»¶IDçš„uriä¸­åŒ…å«/group**ï¼Œå‰‡è¦è¨­ç½®ç‚ºtrueurl_have_group_name = true# Storage é…ç½®çš„store_path0è·¯å¾‘ï¼Œå¿…é ˆå’Œstorage.confä¸­çš„ä¸€è‡´store_path0=/home/data/fastdfs/storage</pre><p>è¤‡è£½ FastDFS çš„éƒ¨åˆ†é…ç½®æ–‡ä»¶åˆ°/etc/fdfs ç›®éŒ„ï¼š</p><pre>cp /fastdfs-nginx-module/src/http.conf /etc/fdfs/cp /fastdfs-nginx-module/src/mime.types /etc/fdfs/</pre><p>é…ç½®nginxï¼Œä¿®æ”¹nginx.confï¼š</p><pre>location ~/group([0-9])/M00 { ngx_fastdfs_module;}</pre><p>å•Ÿå‹•Nginxï¼š</p><pre>[root@iz2ze7tgu9zb2gr6av1tysz sbin]# ./nginxngx_http_fastdfs_set pid=9236</pre><p>æ¸¬è©¦ä¸Šå‚³ï¼š</p><pre>[root@iz2ze7tgu9zb2gr6av1tysz fdfs]# /usr/bin/fdfs_upload_file /etc/fdfs/client.conf /etc/fdfs/4.jpggroup1/M00/00/00/rBD8EFqVACuAI9mcAAC_ornlYSU088.jpg</pre><p>éƒ¨ç½²çµæ§‹åœ–ï¼š</p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ee55bfdb87f6471498455185dfd98de9><p class=pgc-img-caption></p></div><p>JAVA å®¢æˆ¶ç«¯é›†æˆ</p><p>pom.xmlå¼•å…¥ï¼š</p><pre>&lt;!-- fastdfs --&gt;&lt;dependency&gt;	&lt;groupId&gt;org.csource&lt;/groupId&gt;	&lt;artifactId&gt;fastdfs-client-java&lt;/artifactId&gt;	&lt;version&gt;1.27&lt;/version&gt;&lt;/dependency&gt;</pre><p>fdfs_client.confé…ç½®ï¼š</p><pre>#é€£æ¥trackeræœå‹™å™¨è¶…æ™‚æ™‚é•·connect_timeout = 2 #socketé€£æ¥è¶…æ™‚æ™‚é•·network_timeout = 30#æ–‡ä»¶å…§å®¹ç·¨ç¢¼ charset = UTF-8 #trackeræœå‹™å™¨ç«¯å£http.tracker_http_port = 8080http.anti_steal_token = nohttp.secret_key = FastDFS1234567890#trackeræœå‹™å™¨IPå’Œç«¯å£ï¼ˆå¯ä»¥å¯«å¤šå€‹ï¼‰tracker_server = 192.168.1.190:22122 </pre><p>FastDFSClientä¸Šå‚³é¡ï¼š</p><pre>public class FastDFSClient{	private static final String CONFIG_FILENAME = "D:\\itstyle\\src\\main\\resources\\fdfs_client.conf";	private static final String GROUP_NAME = "market1";	private TrackerClient trackerClient = null; private TrackerServer trackerServer = null; private StorageServer storageServer = null; private StorageClient storageClient = null; static{ 	try {			ClientGlobal.init(CONFIG_FILENAME);		} catch (IOException e) {			e.printStackTrace();		} catch (MyException e) {			e.printStackTrace();		} } public FastDFSClient() throws Exception {	 trackerClient = new TrackerClient(ClientGlobal.g_tracker_group);	 trackerServer = trackerClient.getConnection();	 storageServer = trackerClient.getStoreStorage(trackerServer);;	 storageClient = new StorageClient(trackerServer, storageServer); } /** * ä¸Šå‚³æ–‡ä»¶ * @param file æ–‡ä»¶å°è±¡ * @param fileName æ–‡ä»¶å * @return */ public String[] uploadFile(File file, String fileName) { return uploadFile(file,fileName,null); } /** * ä¸Šå‚³æ–‡ä»¶ * @param file æ–‡ä»¶å°è±¡ * @param fileName æ–‡ä»¶å * @param metaList æ–‡ä»¶å…ƒæ•¸æ“š * @return */ public String[] uploadFile(File file, String fileName, Map&lt;String,String&gt; metaList) { try { byte[] buff = IOUtils.toByteArray(new FileInputStream(file)); NameValuePair[] nameValuePairs = null; if (metaList != null) { nameValuePairs = new NameValuePair[metaList.size()]; int index = 0; for (Iterator&lt;Map.Entry&lt;String,String&gt;&gt; iterator = metaList.entrySet().iterator(); iterator.hasNext();) { Map.Entry&lt;String,String&gt; entry = iterator.next(); String name = entry.getKey(); String value = entry.getValue(); nameValuePairs[index++] = new NameValuePair(name,value); } } return storageClient.upload_file(GROUP_NAME,buff,fileName,nameValuePairs); } catch (Exception e) { e.printStackTrace(); } return null; } /** * ç²å–æ–‡ä»¶å…ƒæ•¸æ“š * @param fileId æ–‡ä»¶ID * @return */ public Map&lt;String,String&gt; getFileMetadata(String groupname,String fileId) { try { NameValuePair[] metaList = storageClient.get_metadata(groupname,fileId); if (metaList != null) { HashMap&lt;String,String&gt; map = new HashMap&lt;String, String&gt;(); for (NameValuePair metaItem : metaList) { map.put(metaItem.getName(),metaItem.getValue()); } return map; } } catch (Exception e) { e.printStackTrace(); } return null; } /** * åˆªé™¤æ–‡ä»¶ * @param fileId æ–‡ä»¶ID * @return åˆªé™¤å¤±æ•—è¿”å›-1ï¼Œå¦å‰‡è¿”å›0 */ public int deleteFile(String groupname,String fileId) { try { return storageClient.delete_file(groupname,fileId); } catch (Exception e) { e.printStackTrace(); } return -1; } /** * ä¸‹è¼‰æ–‡ä»¶ * @param fileId æ–‡ä»¶IDï¼ˆä¸Šå‚³æ–‡ä»¶æˆåŠŸå¾Œè¿”å›çš„IDï¼‰ * @param outFile æ–‡ä»¶ä¸‹è¼‰ä¿å­˜ä½ç½® * @return */ public int downloadFile(String groupName,String fileId, File outFile) { FileOutputStream fos = null; try { byte[] content = storageClient.download_file(groupName,fileId); fos = new FileOutputStream(outFile); InputStream ips = new ByteArrayInputStream(content);  IOUtils.copy(ips,fos); return 0; } catch (Exception e) { e.printStackTrace(); } finally { if (fos != null) { try { fos.close(); } catch (IOException e) { e.printStackTrace(); } } } return -1; } public static void main(String[] args) throws Exception { 	FastDFSClient client = new FastDFSClient(); 	File file = new File("D:\\23456.png"); String[] result = client.uploadFile(file, "png"); System.out.println(result.length); System.out.println(result[0]); System.out.println(result[1]); }}</pre><p>åŸ·è¡Œmainæ–¹æ³•æ¸¬è©¦è¿”å›ï¼š</p><pre>2group1M00/00/00/rBD8EFqTrNyAWyAkAAKCRJfpzAQ227.png</pre><p><strong>å¿…é ˆå…ˆè½‰ç™¼ï¼Œè½‰ç™¼ï¼Œè½‰ç™¼ï¼ŒåŠ â€œå¤§æ•¸æ“šjavaæ¶æ§‹å¸«â€é—œæ³¨ï¼Œé—œæ³¨ï¼Œç„¶å¾Œç§ä¿¡æˆ‘â€œDFSâ€å³å¯å…è²»ç²å–æ›´å¤šè³‡æ–™ä¸‹è¼‰åœ°å€</strong></p><div class=pgc-img><img alt=ä¸€æ–‡æå®šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b061b0d4ad4f4b04880908202540b791><p class=pgc-img-caption></p></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>ç³»çµ±</a></li><li><a>FastDFS</a></li><li><a>æå®š</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/6a888def.html alt="æ¨è–¦åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ± FastDFS" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ec0369a50bef43748d07ab58f99b6056 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6a888def.html title="æ¨è–¦åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ± FastDFS">æ¨è–¦åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ± FastDFS</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/89d62274.html alt="FastDFS åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±è©³è§£" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f75efb8752b74ea384109115f7d8c4f6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/89d62274.html title="FastDFS åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±è©³è§£">FastDFS åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±è©³è§£</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ff3705fd.html alt=åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFSå®‰è£éƒ¨ç½²(é«˜å¯ç”¨) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/cb2346c189b7453fa0d3b98ad3c71cee style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ff3705fd.html title=åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFSå®‰è£éƒ¨ç½²(é«˜å¯ç”¨)>åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFSå®‰è£éƒ¨ç½²(é«˜å¯ç”¨)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0bc3d310.html alt="æœ€è¿‘éƒ½èªªåƒâ€œå¾©æ´»â€äº†ä¸€èˆ¬ï¼ŒFastDFS 6.05 ç™¼ä½ˆï¼Œåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0bc3d310.html title="æœ€è¿‘éƒ½èªªåƒâ€œå¾©æ´»â€äº†ä¸€èˆ¬ï¼ŒFastDFS 6.05 ç™¼ä½ˆï¼Œåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±">æœ€è¿‘éƒ½èªªåƒâ€œå¾©æ´»â€äº†ä¸€èˆ¬ï¼ŒFastDFS 6.05 ç™¼ä½ˆï¼Œåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c0bfc933.html alt=éå±è”½ç·šçºœå¦‚ä½•æå®šEMC class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9c5d51ce26004738ad3d722b11ae7a6d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c0bfc933.html title=éå±è”½ç·šçºœå¦‚ä½•æå®šEMC>éå±è”½ç·šçºœå¦‚ä½•æå®šEMC</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/031eafc4.html alt=é›»å» ç›´æµç³»çµ±èª¿è©¦æ–¹æ¡ˆ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/5e8200036f19e04c25bf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/031eafc4.html title=é›»å» ç›´æµç³»çµ±èª¿è©¦æ–¹æ¡ˆ>é›»å» ç›´æµç³»çµ±èª¿è©¦æ–¹æ¡ˆ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fc3b4b2c.html alt=ä¸€æ–‡è®€æ‡‚æ™ºèƒ½å®¢æœï¼šç™¼å±•æ­·ç¨‹ã€ç³»çµ±æ­å»ºã€å¸‚å ´æ¨å»£ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RbYMTZ55OrJUgU style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fc3b4b2c.html title=ä¸€æ–‡è®€æ‡‚æ™ºèƒ½å®¢æœï¼šç™¼å±•æ­·ç¨‹ã€ç³»çµ±æ­å»ºã€å¸‚å ´æ¨å»£>ä¸€æ–‡è®€æ‡‚æ™ºèƒ½å®¢æœï¼šç™¼å±•æ­·ç¨‹ã€ç³»çµ±æ­å»ºã€å¸‚å ´æ¨å»£</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/51410370.html alt=ç”Ÿæ´»åƒåœ¾ç„šç‡’ç™¼é›»åŠè’¸æ±½ç³»çµ±å„ªåŒ–æ”¹é€ é …ç›®å…¬å‘Š class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RcblrbTDBokV23 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/51410370.html title=ç”Ÿæ´»åƒåœ¾ç„šç‡’ç™¼é›»åŠè’¸æ±½ç³»çµ±å„ªåŒ–æ”¹é€ é …ç›®å…¬å‘Š>ç”Ÿæ´»åƒåœ¾ç„šç‡’ç™¼é›»åŠè’¸æ±½ç³»çµ±å„ªåŒ–æ”¹é€ é …ç›®å…¬å‘Š</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b4913b56.html alt=é›»é©…å‹•æ©‹ç³»çµ±æˆ–åŠ å¿«é›»æ°£åŒ–é€²ç¨‹ï¼Œå¤šå€‹æ¡ˆä¾‹å…±åŒèªªæ˜å•é¡Œ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1539571595921bc5b27eff6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b4913b56.html title=é›»é©…å‹•æ©‹ç³»çµ±æˆ–åŠ å¿«é›»æ°£åŒ–é€²ç¨‹ï¼Œå¤šå€‹æ¡ˆä¾‹å…±åŒèªªæ˜å•é¡Œ>é›»é©…å‹•æ©‹ç³»çµ±æˆ–åŠ å¿«é›»æ°£åŒ–é€²ç¨‹ï¼Œå¤šå€‹æ¡ˆä¾‹å…±åŒèªªæ˜å•é¡Œ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9a7b7719.html alt=åŸºæ–¼æ··æ²Œç³»çµ±çš„å½éš¨æ©Ÿæ•¸ç™¼ç”Ÿå™¨è¨­è¨ˆ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9a7b7719.html title=åŸºæ–¼æ··æ²Œç³»çµ±çš„å½éš¨æ©Ÿæ•¸ç™¼ç”Ÿå™¨è¨­è¨ˆ>åŸºæ–¼æ··æ²Œç³»çµ±çš„å½éš¨æ©Ÿæ•¸ç™¼ç”Ÿå™¨è¨­è¨ˆ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/99558abe.html alt=win10ç³»çµ±æ‰“å°æ©Ÿæ‰“å°ä¸äº†é¡¯ç¤ºå·²æš«åœçš„è§£æ±ºæ–¹æ³• class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/10d0de369d4746c7a0c220ff59bd2470 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/99558abe.html title=win10ç³»çµ±æ‰“å°æ©Ÿæ‰“å°ä¸äº†é¡¯ç¤ºå·²æš«åœçš„è§£æ±ºæ–¹æ³•>win10ç³»çµ±æ‰“å°æ©Ÿæ‰“å°ä¸äº†é¡¯ç¤ºå·²æš«åœçš„è§£æ±ºæ–¹æ³•</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2564328d.html alt=è™›è¨­æŠ•è³‡äº¤æ˜“ç³»çµ±å¸å¼•æŠ•è³‡Â æˆéƒ½ç ´ç²ä¸€ç‰¹å¤§åœ˜å¤¥è©é¨™æ¡ˆ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2564328d.html title=è™›è¨­æŠ•è³‡äº¤æ˜“ç³»çµ±å¸å¼•æŠ•è³‡Â æˆéƒ½ç ´ç²ä¸€ç‰¹å¤§åœ˜å¤¥è©é¨™æ¡ˆ>è™›è¨­æŠ•è³‡äº¤æ˜“ç³»çµ±å¸å¼•æŠ•è³‡Â æˆéƒ½ç ´ç²ä¸€ç‰¹å¤§åœ˜å¤¥è©é¨™æ¡ˆ</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e4b6c065.html alt=å…¨çƒå®šä½ç³»çµ±ï¼ˆGPSï¼‰ï¼Œä¸åªæ˜¯å°èˆª class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/S7sY2h8G8GOmul style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e4b6c065.html title=å…¨çƒå®šä½ç³»çµ±ï¼ˆGPSï¼‰ï¼Œä¸åªæ˜¯å°èˆª>å…¨çƒå®šä½ç³»çµ±ï¼ˆGPSï¼‰ï¼Œä¸åªæ˜¯å°èˆª</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f75e014c.html alt=è¬¹è¨˜ï¼çŸ­ç·šç‹è€…äº¤æ˜“ç³»çµ±ï¼Œå­¸æœƒæ¥µå¤§æ¦‚ç‡æé«˜è²·å…¥èˆ‡è³£å‡ºçš„æ™‚æ©Ÿï¼æŒæ¡çµ‚èº«ç²ç›Šç„¡çª®ï¼ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RL8KN4P57T39Db style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f75e014c.html title=è¬¹è¨˜ï¼çŸ­ç·šç‹è€…äº¤æ˜“ç³»çµ±ï¼Œå­¸æœƒæ¥µå¤§æ¦‚ç‡æé«˜è²·å…¥èˆ‡è³£å‡ºçš„æ™‚æ©Ÿï¼æŒæ¡çµ‚èº«ç²ç›Šç„¡çª®ï¼>è¬¹è¨˜ï¼çŸ­ç·šç‹è€…äº¤æ˜“ç³»çµ±ï¼Œå­¸æœƒæ¥µå¤§æ¦‚ç‡æé«˜è²·å…¥èˆ‡è³£å‡ºçš„æ™‚æ©Ÿï¼æŒæ¡çµ‚èº«ç²ç›Šç„¡çª®ï¼</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0ad4f2c9.html alt="ç„¦çˆç³»çµ±åœé›» â€”â€” æ‡‰æ€¥æ“ä½œ" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8ca2e135770644bfb97620aad1b362c0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0ad4f2c9.html title="ç„¦çˆç³»çµ±åœé›» â€”â€” æ‡‰æ€¥æ“ä½œ">ç„¦çˆç³»çµ±åœé›» â€”â€” æ‡‰æ€¥æ“ä½œ</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>