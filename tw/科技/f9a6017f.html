<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>一文搞定分佈式文件系統FastDFS | 极客快訊</title><meta property="og:title" content="一文搞定分佈式文件系統FastDFS - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/c4fc524877574c51905170a1f43effdb"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/f9a6017f.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/f9a6017f.html><meta property="article:published_time" content="2020-11-14T21:03:23+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:23+08:00"><meta name=Keywords content><meta name=description content="一文搞定分佈式文件系統FastDFS"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/f9a6017f.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>一文搞定分佈式文件系統FastDFS</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><p><strong>必須先轉發，轉發，轉發，加“大數據java架構師”關注，關注，然後私信我“DFS”即可免費獲取更多資料下載地址</strong></p><p>概述</p><p>分佈式文件系統：Distributed file system, DFS，又叫做網絡文件系統：Network File System。一種允許文件通過網絡在多臺主機上分享的文件系統，可讓多機器上的多用戶分享文件和存儲空間。</p><p>FastDFS是用c語言編寫的一款開源的分佈式文件系統，充分考慮了冗餘備份、負載均衡、線性擴容等機制，並注重高可用、高性能等指標，功能包括：文件存儲、文件同步、文件訪問（文件上傳、文件下載）等，解決了大容量存儲和負載均衡的問題。特別適合中小文件（建議範圍：4KB &lt; file_size &lt;500MB），對以文件為載體的在線服務，如相冊網站、視頻網站等。</p><p>FastDFS 架構</p><p>FastDFS架構包括Tracker server和Storage server。客戶端請求Tracker server進行文件上傳、下載，通過Tracker server調度最終由Storage server完成文件上傳和下載。</p><div class=pgc-img><img alt=一文搞定分佈式文件系統FastDFS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c4fc524877574c51905170a1f43effdb><p class=pgc-img-caption></p></div><p>跟蹤服務器Tracker Server</p><p>主要做調度工作，起到均衡的作用；負責管理所有的 storage server和 group，每個 storage 在啟動後會連接 Tracker，告知自己所屬 group 等信息，並保持週期性心跳。tracker根據storage的心跳信息，建立group==>[storage serverlist]的映射表。</p><p>Tracker需要管理的元信息很少，會全部存儲在內存中；另外tracker上的元信息都是由storage彙報的信息生成的，本身不需要持久化任何數據，這樣使得tracker非常容易擴展，直接增加tracker機器即可擴展為tracker cluster來服務，cluster裡每個tracker之間是完全對等的，所有的tracker都接受stroage的心跳信息，生成元數據信息來提供讀寫服務。</p><p>存儲服務器Storage Server</p><p>主要提供容量和備份服務；以 group 為單位，每個 group 內可以有多臺 storage server，數據互為備份。以group為單位組織存儲能方便的進行應用隔離、負載均衡、副本數定製（group內storage server數量即為該group的副本數），比如將不同應用數據存到不同的group就能隔離應用數據，同時還可根據應用的訪問特性來將應用分配到不同的group來做負載均衡；缺點是group的容量受單機存儲容量的限制，同時當group內有機器壞掉時，數據恢復只能依賴group內地其他機器，使得恢復時間會很長。</p><p>group內每個storage的存儲依賴於本地文件系統，storage可配置多個數據存儲目錄，比如有10塊磁盤，分別掛載在/data/disk1-/data/disk10，則可將這10個目錄都配置為storage的數據存儲目錄。storage接受到寫文件請求時，會根據配置好的規則選擇其中一個存儲目錄來存儲文件。為了避免單個目錄下的文件數太多，在storage第一次啟動時，會在每個數據存儲目錄裡創建2級子目錄，每級256個，總共65536個文件，新寫的文件會以hash的方式被路由到其中某個子目錄下，然後將文件數據作為本地文件存儲到該目錄中。</p><p>FastDFS的存儲策略</p><p>為了支持大容量，存儲節點（服務器）採用了分卷（或分組）的組織方式。存儲系統由一個或多個卷組成，卷與卷之間的文件是相互獨立的，所有卷的文件容量累加就是整個存儲系統中的文件容量。一個卷可以由一臺或多臺存儲服務器組成，一個卷下的存儲服務器中的文件都是相同的，卷中的多臺存儲服務器起到了冗餘備份和負載均衡的作用。</p><p>在卷中增加服務器時，同步已有的文件由系統自動完成，同步完成後，系統自動將新增服務器切換到線上提供服務。當存儲空間不足或即將耗盡時，可以動態添加捲。只需要增加一臺或多臺服務器，並將它們配置為一個新的卷，這樣就擴大了存儲系統的容量。</p><p>FastDFS的上傳過程</p><p>FastDFS向使用者提供基本文件訪問接口，比如upload、download、append、delete等，以客戶端庫的方式提供給用戶使用。</p><p>Storage Server會定期的向Tracker Server發送自己的存儲信息。當Tracker Server Cluster中的Tracker Server不止一個時，各個Tracker之間的關係是對等的，所以客戶端上傳時可以選擇任意一個Tracker。</p><p>當Tracker收到客戶端上傳文件的請求時，會為該文件分配一個可以存儲文件的group，當選定了group後就要決定給客戶端分配group中的哪一個storage server。當分配好storage server後，客戶端向storage發送寫文件請求，storage將會為文件分配一個數據存儲目錄。然後為文件分配一個fileid，最後根據以上的信息生成文件名存儲文件。</p><div class=pgc-img><img alt=一文搞定分佈式文件系統FastDFS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/01f99f6d91f94b6b8b31e47feb7e2c6d><p class=pgc-img-caption></p></div><p>選擇tracker server</p><p>當集群中不止一個tracker server時，由於tracker之間是完全對等的關係，客戶端在upload文件時可以任意選擇一個trakcer。</p><p>選擇存儲的group</p><p>當tracker接收到upload file的請求時，會為該文件分配一個可以存儲該文件的group，支持如下選擇group的規則： 1. Round robin，所有的group間輪詢 2. Specified group，指定某一個確定的group 3. Load balance，剩餘存儲空間多多group優先</p><p>選擇storage server</p><p>當選定group後，tracker會在group內選擇一個storage server給客戶端，支持如下選擇storage的規則： 1. Round robin，在group內的所有storage間輪詢 2. First server ordered by ip，按ip排序 3. First server ordered by priority，按優先級排序（優先級在storage上配置）</p><p>選擇storage path</p><p>當分配好storage server後，客戶端將向storage發送寫文件請求，storage將會為文件分配一個數據存儲目錄，支持如下規則： 1. Round robin，多個存儲目錄間輪詢 2. 剩餘存儲空間最多的優先</p><p>生成Fileid</p><p>選定存儲目錄之後，storage會為文件生一個Fileid，由storage server ip、文件創建時間、文件大小、文件crc32和一個隨機數拼接而成，然後將這個二進制串進行base64編碼，轉換為可打印的字符串。</p><p>選擇兩級目錄</p><p>當選定存儲目錄之後，storage會為文件分配一個fileid，每個存儲目錄下有兩級256*256的子目錄，storage會按文件fileid進行兩次hash（猜測），路由到其中一個子目錄，然後將文件以fileid為文件名存儲到該子目錄下。</p><p>生成文件名</p><p>當文件存儲到某個子目錄後，即認為該文件存儲成功，接下來會為該文件生成一個文件名，文件名由group、存儲目錄、兩級子目錄、fileid、文件後綴名（由客戶端指定，主要用於區分文件類型）拼接而成。</p><div class=pgc-img><img alt=一文搞定分佈式文件系統FastDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/32867cb165b0459bb46f06c0a825cd82><p class=pgc-img-caption></p></div><p>FastDFS的文件同步</p><p>寫文件時，客戶端將文件寫至group內一個storage server即認為寫文件成功，storage server寫完文件後，會由後臺線程將文件同步至同group內其他的storage server。</p><p>每個storage寫文件後，同時會寫一份binlog，binlog裡不包含文件數據，只包含文件名等元信息，這份binlog用於後臺同步，storage會記錄向group內其他storage同步的進度，以便重啟後能接上次的進度繼續同步；進度以時間戳的方式進行記錄，所以最好能保證集群內所有server的時鐘保持同步。</p><p>storage的同步進度會作為元數據的一部分彙報到tracker上，tracke在選擇讀storage的時候會以同步進度作為參考。</p><p>比如一個group內有A、B、C三個storage server，A向C同步到進度為T1 (T1以前寫的文件都已經同步到B上了），B向C同步到時間戳為T2（T2 > T1)，tracker接收到這些同步進度信息時，就會進行整理，將最小的那個做為C的同步時間戳，本例中T1即為C的同步時間戳為T1（即所有T1以前寫的數據都已經同步到C上了）；同理，根據上述規則，tracker會為A、B生成一個同步時間戳。</p><p>FastDFS的文件下載</p><p>客戶端uploadfile成功後，會拿到一個storage生成的文件名，接下來客戶端根據這個文件名即可訪問到該文件。</p><div class=pgc-img><img alt=一文搞定分佈式文件系統FastDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/010c054136f84170900a3d04086edd24><p class=pgc-img-caption></p></div><p>跟upload file一樣，在downloadfile時客戶端可以選擇任意tracker server。tracker發送download請求給某個tracker，必須帶上文件名信息，tracke從文件名中解析出文件的group、大小、創建時間等信息，然後為該請求選擇一個storage用來服務讀請求。</p><p>FastDFS性能方案</p><div class=pgc-img><img alt=一文搞定分佈式文件系統FastDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ccf74326f11d4bb0a37cfd1885433b76><p class=pgc-img-caption></p></div><p>FastDFS 安裝</p><p>軟件包版本FastDFSv5.05libfastcommonv1.0.7</p><p>下載安裝libfastcommon</p><ul><li>下載</li></ul><pre>wget https://github.com/happyfish100/libfastcommon/archive/V1.0.7.tar.gz</pre><ul><li>解壓</li></ul><pre>tar -xvf V1.0.7.tar.gzcd libfastcommon-1.0.7</pre><ul><li>編譯、安裝</li></ul><pre>./make.sh./make.sh install</pre><ul><li>創建軟鏈接</li></ul><pre>ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.soln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.soln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.soln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so </pre><p>下載安裝FastDFS</p><ul><li>下載FastDFS</li></ul><pre> wget https://github.com/happyfish100/fastdfs/archive/V5.05.tar.gz</pre><ul><li>解壓</li></ul><pre>tar -xvf V5.05.tar.gzcd fastdfs-5.05</pre><ul><li>編譯、安裝</li></ul><pre>./make.sh./make.sh install</pre><p>配置 Tracker 服務</p><p>上述安裝成功後，在/etc/目錄下會有一個fdfs的目錄，進入它。會看到三個.sample後綴的文件，這是作者給我們的示例文件，我們需要把其中的tracker.conf.sample文件改為tracker.conf配置文件並修改它：</p><pre>cp tracker.conf.sample tracker.confvi tracker.conf</pre><p>編輯tracker.conf</p><pre># 配置文件是否不生效，false 為生效disabled=false# 提供服務的端口port=22122# Tracker 數據和日誌目錄地址base_path=//home/data/fastdfs# HTTP 服務端口http.server_port=80</pre><p>創建tracker基礎數據目錄，即base_path對應的目錄</p><pre>mkdir -p /home/data/fastdfs</pre><p>使用ln -s 建立軟鏈接</p><pre>ln -s /usr/bin/fdfs_trackerd /usr/local/binln -s /usr/bin/stop.sh /usr/local/binln -s /usr/bin/restart.sh /usr/local/bin</pre><p>啟動服務</p><pre>service fdfs_trackerd start</pre><p>查看監聽</p><pre>netstat -unltp|grep fdfs</pre><p>如果看到22122端口正常被監聽後，這時候說明Tracker服務啟動成功啦！</p><p>tracker server 目錄及文件結構 Tracker服務啟動成功後，會在base_path下創建data、logs兩個目錄。目錄結構如下：</p><pre>${base_path} |__data | |__storage_groups.dat：存儲分組信息 | |__storage_servers.dat：存儲服務器列表 |__logs | |__trackerd.log： tracker server 日誌文件 </pre><p>配置 Storage 服務</p><p>進入 /etc/fdfs 目錄，複製 FastDFS 存儲器樣例配置文件 storage.conf.sample，並重命名為 storage.conf</p><pre># cd /etc/fdfs# cp storage.conf.sample storage.conf# vi storage.conf</pre><p>編輯storage.conf</p><pre># 配置文件是否不生效，false 為生效disabled=false# 指定此 storage server 所在 組(卷)group_name=group1# storage server 服務端口port=23000# 心跳間隔時間，單位為秒 (這裡是指主動向 tracker server 發送心跳)heart_beat_interval=30# Storage 數據和日誌目錄地址(根目錄必須存在，子目錄會自動生成)base_path=/home/data/fastdfs/storage# 存放文件時 storage server 支持多個路徑。這裡配置存放文件的基路徑數目，通常只配一個目錄。store_path_count=1# 逐一配置 store_path_count 個路徑，索引號基於 0。# 如果不配置 store_path0，那它就和 base_path 對應的路徑一樣。store_path0=/home/data/fastdfs/storage# FastDFS 存儲文件時，採用了兩級目錄。這裡配置存放文件的目錄個數。 # 如果本參數只為 N（如： 256），那麼 storage server 在初次運行時，會在 store_path 下自動創建 N * N 個存放文件的子目錄。subdir_count_per_path=256# tracker_server 的列表 ，會主動連接 tracker_server# 有多個 tracker server 時，每個 tracker server 寫一行tracker_server=192.168.1.190:22122# 允許系統同步的時間段 (默認是全天) 。一般用於避免高峰同步產生一些問題而設定。sync_start_time=00:00sync_end_time=23:59</pre><p>使用ln -s 建立軟鏈接</p><pre>ln -s /usr/bin/fdfs_storaged /usr/local/bin</pre><p>啟動服務</p><pre>service fdfs_storaged start</pre><p>查看監聽</p><pre>netstat -unltp|grep fdfs</pre><p>啟動Storage前確保Tracker是啟動的。初次啟動成功，會在 /home/data/fastdfs/storage 目錄下創建 data、 logs 兩個目錄。如果看到23000端口正常被監聽後，這時候說明Storage服務啟動成功啦！</p><p>查看Storage和Tracker是否在通信</p><pre>/usr/bin/fdfs_monitor /etc/fdfs/storage.conf</pre><p>FastDFS 配置 Nginx 模塊</p><p>軟件包版本openrestyv1.13.6.1fastdfs-nginx-modulev1.1.6</p><p>FastDFS 通過 Tracker 服務器，將文件放在 Storage 服務器存儲， 但是同組存儲服務器之間需要進行文件複製，有同步延遲的問題。</p><p>假設 Tracker 服務器將文件上傳到了 192.168.1.190，上傳成功後文件 ID已經返回給客戶端。此時 FastDFS 存儲集群機制會將這個文件同步到同組存192.168.1.190，在文件還沒有複製完成的情況下，客戶端如果用這個文件 ID 在 192.168.1.190 上取文件,就會出現文件無法訪問的錯誤。而 fastdfs-nginx-module 可以重定向文件鏈接到源服務器取文件，避免客戶端由於複製延遲導致的文件無法訪問錯誤。</p><p>下載 安裝 Nginx 和 fastdfs-nginx-module：</p><p>推薦您使用yum安裝以下的開發庫:</p><pre>yum install readline-devel pcre-devel openssl-devel -y</pre><p>下載最新版本並解壓：</p><pre>wget https://openresty.org/download/openresty-1.13.6.1.tar.gztar -xvf openresty-1.13.6.1.tar.gzwget https://github.com/happyfish100/fastdfs-nginx-module/archive/master.zipunzip master.zip</pre><p>配置 nginx 安裝，加入fastdfs-nginx-module模塊：</p><pre>./configure --add-module=../fastdfs-nginx-module-master/src/</pre><p>編譯、安裝：</p><pre>make &amp;&amp; make install</pre><p>查看Nginx的模塊：</p><pre>/usr/local/openresty/nginx/sbin/nginx -v</pre><p>有下面這個就說明添加模塊成功</p><div class=pgc-img><img alt=一文搞定分佈式文件系統FastDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/a79861202b6542259f8e45e474232e2b><p class=pgc-img-caption></p></div><p>複製 fastdfs-nginx-module 源碼中的配置文件到/etc/fdfs 目錄， 並修改：</p><pre>cp /fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs/# 連接超時時間connect_timeout=10# Tracker Servertracker_server=192.168.1.190:22122# StorageServer 默認端口storage_server_port=23000# 如果文件ID的uri中包含/group**，則要設置為trueurl_have_group_name = true# Storage 配置的store_path0路徑，必須和storage.conf中的一致store_path0=/home/data/fastdfs/storage</pre><p>複製 FastDFS 的部分配置文件到/etc/fdfs 目錄：</p><pre>cp /fastdfs-nginx-module/src/http.conf /etc/fdfs/cp /fastdfs-nginx-module/src/mime.types /etc/fdfs/</pre><p>配置nginx，修改nginx.conf：</p><pre>location ~/group([0-9])/M00 { ngx_fastdfs_module;}</pre><p>啟動Nginx：</p><pre>[root@iz2ze7tgu9zb2gr6av1tysz sbin]# ./nginxngx_http_fastdfs_set pid=9236</pre><p>測試上傳：</p><pre>[root@iz2ze7tgu9zb2gr6av1tysz fdfs]# /usr/bin/fdfs_upload_file /etc/fdfs/client.conf /etc/fdfs/4.jpggroup1/M00/00/00/rBD8EFqVACuAI9mcAAC_ornlYSU088.jpg</pre><p>部署結構圖：</p><div class=pgc-img><img alt=一文搞定分佈式文件系統FastDFS onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ee55bfdb87f6471498455185dfd98de9><p class=pgc-img-caption></p></div><p>JAVA 客戶端集成</p><p>pom.xml引入：</p><pre>&lt;!-- fastdfs --&gt;&lt;dependency&gt;	&lt;groupId&gt;org.csource&lt;/groupId&gt;	&lt;artifactId&gt;fastdfs-client-java&lt;/artifactId&gt;	&lt;version&gt;1.27&lt;/version&gt;&lt;/dependency&gt;</pre><p>fdfs_client.conf配置：</p><pre>#連接tracker服務器超時時長connect_timeout = 2 #socket連接超時時長network_timeout = 30#文件內容編碼 charset = UTF-8 #tracker服務器端口http.tracker_http_port = 8080http.anti_steal_token = nohttp.secret_key = FastDFS1234567890#tracker服務器IP和端口（可以寫多個）tracker_server = 192.168.1.190:22122 </pre><p>FastDFSClient上傳類：</p><pre>public class FastDFSClient{	private static final String CONFIG_FILENAME = "D:\\itstyle\\src\\main\\resources\\fdfs_client.conf";	private static final String GROUP_NAME = "market1";	private TrackerClient trackerClient = null; private TrackerServer trackerServer = null; private StorageServer storageServer = null; private StorageClient storageClient = null; static{ 	try {			ClientGlobal.init(CONFIG_FILENAME);		} catch (IOException e) {			e.printStackTrace();		} catch (MyException e) {			e.printStackTrace();		} } public FastDFSClient() throws Exception {	 trackerClient = new TrackerClient(ClientGlobal.g_tracker_group);	 trackerServer = trackerClient.getConnection();	 storageServer = trackerClient.getStoreStorage(trackerServer);;	 storageClient = new StorageClient(trackerServer, storageServer); } /** * 上傳文件 * @param file 文件對象 * @param fileName 文件名 * @return */ public String[] uploadFile(File file, String fileName) { return uploadFile(file,fileName,null); } /** * 上傳文件 * @param file 文件對象 * @param fileName 文件名 * @param metaList 文件元數據 * @return */ public String[] uploadFile(File file, String fileName, Map&lt;String,String&gt; metaList) { try { byte[] buff = IOUtils.toByteArray(new FileInputStream(file)); NameValuePair[] nameValuePairs = null; if (metaList != null) { nameValuePairs = new NameValuePair[metaList.size()]; int index = 0; for (Iterator&lt;Map.Entry&lt;String,String&gt;&gt; iterator = metaList.entrySet().iterator(); iterator.hasNext();) { Map.Entry&lt;String,String&gt; entry = iterator.next(); String name = entry.getKey(); String value = entry.getValue(); nameValuePairs[index++] = new NameValuePair(name,value); } } return storageClient.upload_file(GROUP_NAME,buff,fileName,nameValuePairs); } catch (Exception e) { e.printStackTrace(); } return null; } /** * 獲取文件元數據 * @param fileId 文件ID * @return */ public Map&lt;String,String&gt; getFileMetadata(String groupname,String fileId) { try { NameValuePair[] metaList = storageClient.get_metadata(groupname,fileId); if (metaList != null) { HashMap&lt;String,String&gt; map = new HashMap&lt;String, String&gt;(); for (NameValuePair metaItem : metaList) { map.put(metaItem.getName(),metaItem.getValue()); } return map; } } catch (Exception e) { e.printStackTrace(); } return null; } /** * 刪除文件 * @param fileId 文件ID * @return 刪除失敗返回-1，否則返回0 */ public int deleteFile(String groupname,String fileId) { try { return storageClient.delete_file(groupname,fileId); } catch (Exception e) { e.printStackTrace(); } return -1; } /** * 下載文件 * @param fileId 文件ID（上傳文件成功後返回的ID） * @param outFile 文件下載保存位置 * @return */ public int downloadFile(String groupName,String fileId, File outFile) { FileOutputStream fos = null; try { byte[] content = storageClient.download_file(groupName,fileId); fos = new FileOutputStream(outFile); InputStream ips = new ByteArrayInputStream(content);  IOUtils.copy(ips,fos); return 0; } catch (Exception e) { e.printStackTrace(); } finally { if (fos != null) { try { fos.close(); } catch (IOException e) { e.printStackTrace(); } } } return -1; } public static void main(String[] args) throws Exception { 	FastDFSClient client = new FastDFSClient(); 	File file = new File("D:\\23456.png"); String[] result = client.uploadFile(file, "png"); System.out.println(result.length); System.out.println(result[0]); System.out.println(result[1]); }}</pre><p>執行main方法測試返回：</p><pre>2group1M00/00/00/rBD8EFqTrNyAWyAkAAKCRJfpzAQ227.png</pre><p><strong>必須先轉發，轉發，轉發，加“大數據java架構師”關注，關注，然後私信我“DFS”即可免費獲取更多資料下載地址</strong></p><div class=pgc-img><img alt=一文搞定分佈式文件系統FastDFS onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/b061b0d4ad4f4b04880908202540b791><p class=pgc-img-caption></p></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>系統</a></li><li><a>FastDFS</a></li><li><a>搞定</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/6a888def.html alt="推薦分佈式文件系統 FastDFS" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ec0369a50bef43748d07ab58f99b6056 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6a888def.html title="推薦分佈式文件系統 FastDFS">推薦分佈式文件系統 FastDFS</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/89d62274.html alt="FastDFS 分佈式文件系統詳解" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f75efb8752b74ea384109115f7d8c4f6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/89d62274.html title="FastDFS 分佈式文件系統詳解">FastDFS 分佈式文件系統詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ff3705fd.html alt=分佈式文件系統FastDFS安裝部署(高可用) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/cb2346c189b7453fa0d3b98ad3c71cee style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ff3705fd.html title=分佈式文件系統FastDFS安裝部署(高可用)>分佈式文件系統FastDFS安裝部署(高可用)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0bc3d310.html alt="最近都說像“復活”了一般，FastDFS 6.05 發佈，分佈式文件系統" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0bc3d310.html title="最近都說像“復活”了一般，FastDFS 6.05 發佈，分佈式文件系統">最近都說像“復活”了一般，FastDFS 6.05 發佈，分佈式文件系統</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c0bfc933.html alt=非屏蔽線纜如何搞定EMC class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9c5d51ce26004738ad3d722b11ae7a6d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c0bfc933.html title=非屏蔽線纜如何搞定EMC>非屏蔽線纜如何搞定EMC</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/031eafc4.html alt=電廠直流系統調試方案 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/5e8200036f19e04c25bf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/031eafc4.html title=電廠直流系統調試方案>電廠直流系統調試方案</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fc3b4b2c.html alt=一文讀懂智能客服：發展歷程、系統搭建、市場推廣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RbYMTZ55OrJUgU style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fc3b4b2c.html title=一文讀懂智能客服：發展歷程、系統搭建、市場推廣>一文讀懂智能客服：發展歷程、系統搭建、市場推廣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/51410370.html alt=生活垃圾焚燒發電及蒸汽系統優化改造項目公告 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RcblrbTDBokV23 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/51410370.html title=生活垃圾焚燒發電及蒸汽系統優化改造項目公告>生活垃圾焚燒發電及蒸汽系統優化改造項目公告</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b4913b56.html alt=電驅動橋系統或加快電氣化進程，多個案例共同說明問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1539571595921bc5b27eff6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b4913b56.html title=電驅動橋系統或加快電氣化進程，多個案例共同說明問題>電驅動橋系統或加快電氣化進程，多個案例共同說明問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9a7b7719.html alt=基於混沌系統的偽隨機數發生器設計 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9a7b7719.html title=基於混沌系統的偽隨機數發生器設計>基於混沌系統的偽隨機數發生器設計</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/99558abe.html alt=win10系統打印機打印不了顯示已暫停的解決方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/10d0de369d4746c7a0c220ff59bd2470 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/99558abe.html title=win10系統打印機打印不了顯示已暫停的解決方法>win10系統打印機打印不了顯示已暫停的解決方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2564328d.html alt=虛設投資交易系統吸引投資 成都破獲一特大團夥詐騙案 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2564328d.html title=虛設投資交易系統吸引投資 成都破獲一特大團夥詐騙案>虛設投資交易系統吸引投資 成都破獲一特大團夥詐騙案</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e4b6c065.html alt=全球定位系統（GPS），不只是導航 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/S7sY2h8G8GOmul style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e4b6c065.html title=全球定位系統（GPS），不只是導航>全球定位系統（GPS），不只是導航</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f75e014c.html alt=謹記！短線王者交易系統，學會極大概率提高買入與賣出的時機！掌握終身獲益無窮！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RL8KN4P57T39Db style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f75e014c.html title=謹記！短線王者交易系統，學會極大概率提高買入與賣出的時機！掌握終身獲益無窮！>謹記！短線王者交易系統，學會極大概率提高買入與賣出的時機！掌握終身獲益無窮！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0ad4f2c9.html alt="焦爐系統停電 —— 應急操作" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8ca2e135770644bfb97620aad1b362c0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0ad4f2c9.html title="焦爐系統停電 —— 應急操作">焦爐系統停電 —— 應急操作</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>