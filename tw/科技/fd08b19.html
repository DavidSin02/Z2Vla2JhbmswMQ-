<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>異步編程：協作性多任務處理 | 极客快訊</title><meta property="og:title" content="異步編程：協作性多任務處理 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/dfic-imagehandler/dbd0ddd7-eda4-430a-8176-da9804319771"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fd08b19.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fd08b19.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/fd08b19.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fd08b19.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fd08b19.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/fd08b19.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/fd08b19.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fd08b19.html><meta property="article:published_time" content="2020-10-29T21:00:06+08:00"><meta property="article:modified_time" content="2020-10-29T21:00:06+08:00"><meta name=Keywords content><meta name=description content="異步編程：協作性多任務處理"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/fd08b19.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>異步編程：協作性多任務處理</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><div class=pgc-img><img alt=異步編程：協作性多任務處理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/dbd0ddd7-eda4-430a-8176-da9804319771></div><p>如何確保同時處理多個請求，我們可以使用線程或進程進行多任務處理實現，但還有一個選擇 - 協作性多任務處理。</p><p>這個選項是最困難的。在這裡我們說操作系統當然很酷，它有調度程序/計劃程序，它可以處理進程，線程，組織它們之間的切換，處理鎖等，但它仍然不知道應用程序是如何工作的，而這些工作原理應該是我們作為開發人員所知道的。</p><p>我們知道在CPU上會有短暫的時刻執行某些計算操作，但大多數時候我們都期望網​​絡I / O能更清楚何時在處理多個請求之間切換。</p><p>從操作系統的角度來看，協作式多任務只是一個執行線程，在其中，應用程序在處理多個請求/命令之間切換。通常情況是：只要一些數據到達，就會讀取它們，解析請求，將數據發送到數據庫，這是一個阻塞操作；而非堵塞操作時在等待來自數據庫的響應時，可以開始處理另一個請求，它被稱為“合作或協作”，因為所有任務/命令必須通過合作以使整個調度方案起作用。它們彼此交錯，但是有一個控制線程，稱為協作調度程序，其角色只是啟動進程並讓這些線程自動將控制權返回給它。</p><p>這比線程的多任務處理更簡單，因為程序員總是知道當一個任務執行時，另一個任務不會執行，雖然在單處理器系統中，線程應用程序也將以交錯模式執行這種模型，但使用線程的程序員仍應考慮此方法的缺陷，以免應用程序在移動到多處理器系統時工作不正常。但是，即使在多處理器系統上，單線程異步系統也總是以交錯方式執行。</p><p>編寫這樣的程序的困難在於，這種切換，維護上下文的過程，將每個任務組織為一系列間歇性執行的較小步驟，落在開發人員身上。另一方面，我們獲得了效率，因為沒有不必要的切換，例如，在線程和進程之間切換時切換處理器上下文沒有問題。</p><p>有兩種方法可以實現協作式多任務處理 ：回調和綠色線程。</p><div class=pgc-img><img alt=異步編程：協作性多任務處理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/0755a4ef-3f5b-4d77-b481-2c2cb9c088db></div><p><strong>回調</strong></p><p>由於所有阻塞操作都會導致某個動作將在未來的某個時間發生，並且我們的執行線程應該在準備就緒時返回結果。因此，為了獲得結果，我們必須註冊回調 - 當請求/操作成功時，它將執行一個回調，或者如果它不成功，它將執行另一個回調。回調是一個明確的選項 - 開發人員應該以這樣的方式編寫程序，使他不知道何時將調用回調函數。</p><p>這是最常用的選項，因為它是顯式的，並且得到了大多數現代語言的支持。</p><p><strong>利弊</strong>：</p><ul><li>與線程併發程序不同，沒有線程併發的問題;</li><li>線程/協同程序對程序員來說是不可見的;</li><li>回調會吞掉異常;</li><li>回調後的回調變得混亂，難以調試。</li></ul><p><strong>綠色線程</strong></p><p>第二個選項是隱式的 ，當開發人員以這樣的方式編寫程序時，似乎不需要進行合作的多任務處理。我們就像之前一樣做了一個阻塞操作，我們希望像只有一個進程或線程情況下獲得結果。但是有一個黑魔法“在幕後” ： 框架或編程語言使阻塞操作實現非阻塞，並將控制轉移到其他一些執行線程，而不是轉移到OS線程上，是在一個邏輯線程（用戶 -級別線程）。它們由“普通”用戶級進程調度，而不是由內核調度，這個線程稱為綠色線程。</p><p><strong>利弊</strong>：</p><ul><li>是在應用程序級別而不是OS;</li><li>他們感覺像線程;</li><li>包括除CPU上下文切換之外的普通基於線程的編程的所有問題。</li></ul><p>Reactor模式</p><p>在協作式多任務處理中，總有一個任務處理內核負責所有I / O處理。設計模式上稱為Reactor模式。Reactor接口說：“給我一堆你的Socket和你的回調，當某個Socket準備好進行I / O時，我會調用你的回調函數。”</p><p>Reactor提供了第二個接口，稱為定時器 - “在X毫秒內調用我，這是我需要你調用的回調。”</p><p>這種東西在任何地方都是協作式的多任務處理，無論是明確的還是隱含的。</p><p>“在引擎蓋下”Reactor非常簡單。它有一個按響應時間排序的計時器列表。它獲取給出它的Socket列表，並將它們發送到輪詢準備機制中。可用性輪詢機制總是有一個參數: 它說明了如果沒有網絡活動他將堵塞多長時間。阻塞時間表示最近的計時器的響應時間。因此，要麼存在某種網絡活動，一些Socket將為I / O做好準備，或者我們將等待下一個定時器觸發，解鎖並將控制轉移到一個或另一個回調，基本上是邏輯流程執行。</p><p>最好的方法</p><p>但實際上，這些選項都不是理想選擇。合併後的版本效果最好，因為協作式多任務通常會帶來好處，特別是如果您的連接掛起很長時間。例如，Web Socket是一種長期連接。如果分配一個進程或一個線程來處理單個Web Socket，則會顯著地限制同時在一個後端服務器上可以擁有的連接數。由於連接存在很長時間，因此保持多個同時連接非常重要，而每個連接的工作量很少。</p><p>沒有協作式多任務處理的程序只能使用一個處理器核心。當然，您可以在同一臺機器上運行應用程序的多個實例（這並不總是方便且有其缺點），因此在每個進程內運行多個線程並使用reactor進行協同多任務處理會很不錯。</p><p>這種組合一方面可以在我們的系統中使用所有可用的處理器內核，另一方面，它可以在每個內核中高效工作，而無需分配大量資源來處理每個單獨的連接。</p><div class=pgc-img><img alt=異步編程：協作性多任務處理 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/dfic-imagehandler/1bf7cc75-18a7-436c-a5da-b4c2fdc46e5c></div></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>異步</a></li><li><a>編程</a></li><li><a>協作性</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/f74b39f.html alt="Java 異步編程導論" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3c356b1aa9b4416ca7b35a07f3033e13 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f74b39f.html title="Java 異步編程導論">Java 異步編程導論</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4cb74cd.html alt="Spring異步編程 | 你的@Async就真的異步嗎？異步歷險奇遇記" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b9d102263d0f46a0b5b203d7b6cd4a2e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4cb74cd.html title="Spring異步編程 | 你的@Async就真的異步嗎？異步歷險奇遇記">Spring異步編程 | 你的@Async就真的異步嗎？異步歷險奇遇記</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/852c87e.html alt="有了 CompletableFuture，使得異步編程沒有那麼難了" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/e66a7bcfded64b34b43ebc1565b3e557 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/852c87e.html title="有了 CompletableFuture，使得異步編程沒有那麼難了">有了 CompletableFuture，使得異步編程沒有那麼難了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3e8c3b8.html alt=詳解編程中的同步和異步 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/b292fb03b256422bb94215ce3ec3bbaf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3e8c3b8.html title=詳解編程中的同步和異步>詳解編程中的同步和異步</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3a0dfd7.html alt="異步編程實例：Java8 API的理解和CompletableFuture類的實現" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1522150125651deaa9d51b2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3a0dfd7.html title="異步編程實例：Java8 API的理解和CompletableFuture類的實現">異步編程實例：Java8 API的理解和CompletableFuture類的實現</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c81ec36.html alt=異步編程提升服務性能 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/15260210063976700d35c2d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c81ec36.html title=異步編程提升服務性能>異步編程提升服務性能</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9cfcdd6f.html alt=《JAVA編程思想》5分鐘速成：第8章（多態） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/399a29d93fde48fca4bae44dffbced07 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9cfcdd6f.html title=《JAVA編程思想》5分鐘速成：第8章（多態）>《JAVA編程思想》5分鐘速成：第8章（多態）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ede16bf9.html alt=「編程基礎」PHP基礎教程（二） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/17685aad04c54d02928724fb99fea026 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ede16bf9.html title=「編程基礎」PHP基礎教程（二）>「編程基礎」PHP基礎教程（二）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/69e45bf9.html alt=「編程基礎」PHP基礎教程（一） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/355d0f0c0f274bdfaeb90747dbd918fb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/69e45bf9.html title=「編程基礎」PHP基礎教程（一）>「編程基礎」PHP基礎教程（一）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b96f9421.html alt=零基礎如何學PHP編程語言？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b96f9421.html title=零基礎如何學PHP編程語言？>零基礎如何學PHP編程語言？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6e6dcd03.html alt=編程是什麼——世界第一臺電子計算機 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/aac93e54a8f84d04b0d01165200ce1a2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6e6dcd03.html title=編程是什麼——世界第一臺電子計算機>編程是什麼——世界第一臺電子計算機</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7eb8afcd.html alt=遊戲引擎編程需要哪些基本數學知識？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3f6ca97249fa468db6982c44a024979d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7eb8afcd.html title=遊戲引擎編程需要哪些基本數學知識？>遊戲引擎編程需要哪些基本數學知識？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e4bfe813.html alt=UG編程獨當一面，如何提高鑽孔精度方法？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1532093430052c29be7656f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e4bfe813.html title=UG編程獨當一面，如何提高鑽孔精度方法？>UG編程獨當一面，如何提高鑽孔精度方法？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f9db061d.html alt=三相異步電動機絕緣處理的目的及方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/3c439a15bdf64f1f975914c96a2c66e7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f9db061d.html title=三相異步電動機絕緣處理的目的及方法>三相異步電動機絕緣處理的目的及方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b44410f0.html alt=異步電機典型結構簡述 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/15349080656472f5dd62512 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b44410f0.html title=異步電機典型結構簡述>異步電機典型結構簡述</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>