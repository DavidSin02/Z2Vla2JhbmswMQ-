<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>微信、支付寶以及美團等各大開放平臺是如何使用OAuth 2.0的？ | 极客快訊</title><meta property="og:title" content="微信、支付寶以及美團等各大開放平臺是如何使用OAuth 2.0的？ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/ad74bbac6f9245b49ed441bcaa02cc3f"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fd7b0c94.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fd7b0c94.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/fd7b0c94.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fd7b0c94.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fd7b0c94.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/fd7b0c94.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/fd7b0c94.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fd7b0c94.html><meta property="article:published_time" content="2020-11-14T21:00:28+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:28+08:00"><meta name=Keywords content><meta name=description content="微信、支付寶以及美團等各大開放平臺是如何使用OAuth 2.0的？"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/fd7b0c94.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>微信、支付寶以及美團等各大開放平臺是如何使用OAuth 2.0的？</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p style=text-align:center>歡迎關注公眾號“碼農架構”</p><p style=text-align:center>專注於高可用、高性能、高併發類技術分享！</p><div class=pgc-img><img alt="微信、支付寶以及美團等各大開放平臺是如何使用OAuth 2.0的？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ad74bbac6f9245b49ed441bcaa02cc3f><p class=pgc-img-caption></p></div><p>在正式介紹各大開放平臺的使用細節之前，我們先來看看大廠的開放平臺全局體系。據我觀察，各個開放平臺基本的系統結構和授權系統在中間的交互流程，大同小異，都是通過授權服務來授權，通過網關來鑑權。所以接下來，我就以京東商家開放平臺為例，來和你說說開放平臺的體系到底是什麼樣子的。開放平臺體系是什麼樣子的？我們首先來看一下京東商家開放平臺全局體系的結構，如下圖所示。</p><div class=pgc-img><img alt="微信、支付寶以及美團等各大開放平臺是如何使用OAuth 2.0的？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/9a891bc67cd8406c8d334ee1e92abfb1><p class=pgc-img-caption></p></div><p>我們可以把這個架構體系分為三部分來看：</p><ul><li>第三方軟件，一般是指第三方開發者或者 ISV 通過對接開放平臺來實現的應用軟件，比如小兔打單軟件。</li><li>京東商家開放平臺，包含 API 網關服務、OAuth 2.0 授權服務和第三方軟件開發者中心服務。其中，API 網關服務和 OAuth 2.0 授權服務，是開放平臺的“兩條腿”；</li><li>第三方軟件開發者中心服務，是為開發者提供管理第三方軟件應用基本信息的服務，比如 app_id、app_secret 等信息。京東內部的各個微服務，比如訂單服務、商品服務等。這些微服務，就是我們之前提到的受保護資源服務。</li></ul><p>從圖中我們還可以看到這個體系整體的調用關係是：第三方軟件通過 HTTP 協議請求到開放平臺，更具體地說是開放平臺的 API 網關服務，然後由 API 網關通過內部的 RPC 調用到各個微服務。</p><p>接下來，我們再以用戶小明使用小兔打單軟件為例，來看看這些系統角色之間具體又是怎樣交互的？</p><div class=pgc-img><img alt="微信、支付寶以及美團等各大開放平臺是如何使用OAuth 2.0的？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/93ae2cd8b09444278aa75e4b1eeaf032><p class=pgc-img-caption></p></div><p>到這裡，我們可以發現，在開放平臺體系中各個系統角色間的交互可以歸結為：</p><ul><li>當用戶小明訪問小兔軟件的時候，小兔會首先向開放平臺的 OAuth 2.0 授權服務去請求訪問令牌，接著小兔拿著訪問令牌去請求 API 網關服務；</li><li>在 API 網關服務中，會做最基本的兩種校驗，一種是訪問令牌的合法性校驗，比如訪問令牌是否過期的校驗，另一種是小兔打單軟件的基本信息的合法性校驗，比如 app_id 和 app_secret 的校驗；</li><li>都校驗成功之後，API 網關服務會發起最終的數據請求。</li></ul><p>依靠開放平臺提供的能力，可以說開放平臺、用戶和開發者實現了三贏：小明因為使用小兔提高了打單效率；小兔的開發者因為小明的訂購服務獲得了收益；而通過開放出去的 API 讓小兔幫助小明能夠極快地處理 C 端用戶的訂單，京東提高了用戶的使用體驗。</p><p>我們已經知道，用戶給第三方軟件授權之後，授權服務就會生成一個訪問令牌，而且這個訪問令牌是跟用戶關聯的。比如，小明給小兔打單軟件進行了授權，那麼此時訪問令牌的粒度就是：小兔打單軟件 + 小明。</p><p>我們還知道了，小兔打單軟件可以拿著這個訪問令牌去代表小明訪問小明的數據；如果訪問令牌過期了，小兔打單軟件還可以繼續使用刷新令牌來訪問，直到刷新令牌也過期了。</p><p>現在問題來了，如果小明註銷了賬號，或者修改了自己的密碼，那他之前為其它第三方軟件進行授權的訪問令牌就應該立即失效。否則，在刷新令牌過期之前，第三方軟件可以一直拿著之前的訪問令牌去請求數據。這顯然不合理。</p><p>所以在這種情況下，授權服務就要通過 MQ（消息隊列）接收用戶的註銷和修改密碼這兩類消息，然後對訪問令牌進行清理。</p><div class=pgc-img><img alt="微信、支付寶以及美團等各大開放平臺是如何使用OAuth 2.0的？" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/c2b0796774d74811a9a20cfb3720bc6a><p class=pgc-img-caption></p></div><p>其實，這個案例中解決訪問令牌安全問題的方式，不僅僅適用於開放平臺，還可以為你在企業內構建自己的 OAuth 2.0 授權體系結構時提供借鑑。</p><p>以上就是開放平臺整體的結構，以及其中需要重點關注的用戶訪問令牌的安全性問題了。我們作為第三方軟件開發者，在對接到這些開放平臺或者瀏覽它們的網站時，幾乎都能看到類似這樣的一句話：“所有接口都需要接入 OAuth 授權，經過用戶確認授權後才可以調用”，這正是 OAuth 2.0 的根本性作用。</p><p>理解了開放平臺的脈絡之後，接下來，就讓我們通過一組圖看一看開放平臺是如何使用 OAuth 2.0 授權流程的吧。</p><p><strong>各大開放平臺授權流程</strong></p><p>我們以微信、支付寶、美團為例，看看它們在開放授權上是如何使用 OAuth 2.0 的。我們首先看一下官方的授權流程圖：</p><p>引自微信官方文檔</p><div class=pgc-img><img alt="微信、支付寶以及美團等各大開放平臺是如何使用OAuth 2.0的？" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/e9eb03425b6c4815a9b16bfc10142efa><p class=pgc-img-caption></p></div><p>引自支付寶開放平臺文檔</p><div class=pgc-img><img alt="微信、支付寶以及美團等各大開放平臺是如何使用OAuth 2.0的？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5e0609a050294428932229d7bb5eb0fa><p class=pgc-img-caption></p></div><p>引自美團外賣開放平臺</p><div class=pgc-img><img alt="微信、支付寶以及美團等各大開放平臺是如何使用OAuth 2.0的？" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5192623f1d3447879c91ed8d4c49d306><p class=pgc-img-caption></p></div><p>我們可以在這三張授權流程圖中看到，都有和授權碼 code 相關的文字。這就說明，它們都建議開發者首選授權碼流程。</p><p><strong>總結</strong></p><ul><li>當有多個受保護資源服務的時候，基本的鑑權工作，包括訪問令牌的驗證、第三方軟件應用信息的驗證都應該抽出一個 API 網關層，並把這些基本的工作放到這個 API 網關層。</li><li>各大開放平臺都是推薦使用授權碼許可流程，無論是網頁版的 Web 應用程序，還是移動應用程序。</li><li>對於第三方軟件開發者重點關注的參數，可以從授權服務的授權端點和令牌端點來區分，授權端點重點是授權碼請求和響應的處理，令牌端點重點是訪問令牌請求和響應的處理。</li></ul><blockquote class=pgc-blockquote-abstract><p>歡迎關注公眾號“碼農架構” 專注於高可用、高性能、高併發類技術分享！</p></blockquote></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>微信</a></li><li><a>美團</a></li><li><a>各大開</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/bbee85dc.html alt=掌上生活App還信用卡秒殺微信 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bbee85dc.html title=掌上生活App還信用卡秒殺微信>掌上生活App還信用卡秒殺微信</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/670b9f63.html alt=微信正在輸入還有這麼多意思？還能自動關閉，現在才曉得 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ab67e272a13445b5b977a83567625b54 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/670b9f63.html title=微信正在輸入還有這麼多意思？還能自動關閉，現在才曉得>微信正在輸入還有這麼多意思？還能自動關閉，現在才曉得</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1a50f170.html alt=微信公眾平臺菜單欄目設置小竅門 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/53f90001f04fee80fa7b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1a50f170.html title=微信公眾平臺菜單欄目設置小竅門>微信公眾平臺菜單欄目設置小竅門</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/134fd230.html alt=新零售時代如何玩轉微信商城 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b2a587596cbd430fa464faab5594e217 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/134fd230.html title=新零售時代如何玩轉微信商城>新零售時代如何玩轉微信商城</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/73795864.html alt=教你如何三秒鐘生成微信圖文長條圖 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1b52272a317449978c428a5d77bbe761 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/73795864.html title=教你如何三秒鐘生成微信圖文長條圖>教你如何三秒鐘生成微信圖文長條圖</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b271f518.html alt=美團內部講座｜北航全權：一種城市空中移動性管理分佈式控制框架 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/2403e92f40a84c5e8122ad956d0c4514 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b271f518.html title=美團內部講座｜北航全權：一種城市空中移動性管理分佈式控制框架>美團內部講座｜北航全權：一種城市空中移動性管理分佈式控制框架</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4d70201a.html alt="可愛表情包   垃圾微信 連個勾引我的人都沒有" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/a96cbc8cf8f64b24acd12425f8e79c51 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4d70201a.html title="可愛表情包   垃圾微信 連個勾引我的人都沒有">可愛表情包 垃圾微信 連個勾引我的人都沒有</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cf7f98c8.html alt="面試阿里，美團都會被問到的Spring ,從基礎到源碼統統幫你搞定" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/0ca013e258664cbb94ab2d6883b0fd97 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cf7f98c8.html title="面試阿里，美團都會被問到的Spring ,從基礎到源碼統統幫你搞定">面試阿里，美團都會被問到的Spring ,從基礎到源碼統統幫你搞定</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7d864e9b.html alt=Wxid法加微信好友，一種犀利的加友辦法，天天用微信居然不知道！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1522483898928dc5b708dfa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7d864e9b.html title=Wxid法加微信好友，一種犀利的加友辦法，天天用微信居然不知道！>Wxid法加微信好友，一種犀利的加友辦法，天天用微信居然不知道！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7c5a95db.html alt=“領導”主動加微信，女子因此被騙18萬元！幸好…… class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6474d4c1a4574f6fb8ed9d87580e20c4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7c5a95db.html title=“領導”主動加微信，女子因此被騙18萬元！幸好……>“領導”主動加微信，女子因此被騙18萬元！幸好……</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/04828551.html alt=入門級微信加粉大法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7e683cb64acb403ab55bcd7a1edc3fb2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/04828551.html title=入門級微信加粉大法>入門級微信加粉大法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/987496c1.html alt=怎麼能加女孩子的微信？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/4eee17f1-b421-490f-ad54-d2bed294e5cd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/987496c1.html title=怎麼能加女孩子的微信？>怎麼能加女孩子的微信？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c21bc630.html alt=“快遞員”要加你微信？千萬別輕易相信 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/SFcGSao3mcBecP style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c21bc630.html title=“快遞員”要加你微信？千萬別輕易相信>“快遞員”要加你微信？千萬別輕易相信</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/032f6ffc.html alt=怎麼添加微信好友？全過程圖文詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b1b50c103cd04ecfa9fa6032ec7ce3c6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/032f6ffc.html title=怎麼添加微信好友？全過程圖文詳解>怎麼添加微信好友？全過程圖文詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9a275b9f.html alt=手把手教你微信如何添加好友 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1bba7a01e18c4c5bb1bcd480868839c2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9a275b9f.html title=手把手教你微信如何添加好友>手把手教你微信如何添加好友</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>