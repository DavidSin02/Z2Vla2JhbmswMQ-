<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>滲透人員福利：曝光黑客構造GIF動圖邪惡鏈接攻擊全過程 | 极客快訊</title><meta property="og:title" content="滲透人員福利：曝光黑客構造GIF動圖邪惡鏈接攻擊全過程 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p1.pstatp.com/large/pgc-image/408c6eaf305c4dde9460074bede9a7af"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fe8acc12.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fe8acc12.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/fe8acc12.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fe8acc12.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fe8acc12.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/fe8acc12.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/fe8acc12.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/fe8acc12.html><meta property="article:published_time" content="2020-11-14T21:00:28+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:28+08:00"><meta name=Keywords content><meta name=description content="滲透人員福利：曝光黑客構造GIF動圖邪惡鏈接攻擊全過程"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/fe8acc12.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>滲透人員福利：曝光黑客構造GIF動圖邪惡鏈接攻擊全過程</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><p><br></p><div class=pgc-img><img alt=滲透人員福利：曝光黑客構造GIF動圖邪惡鏈接攻擊全過程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/408c6eaf305c4dde9460074bede9a7af><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>域名劫持</h1><p>有了"authtoken"和"skypetoken"後，就能通過Teams API接口發起API請求，實現消息發送、讀取，創建群組、添加移除新用戶或更改群組用戶權限等。但還需要一個條件，由於"authtoken"和"skypetoken"只會發送到teams.microsoft.com和其相關的域名中，所以，成功的利用條件是teams.microsoft.com和其相關子域名存在域名劫持。恰巧的是，經過測試，我們發現以下兩個teams.microsoft.com的子域名存在可劫持漏洞：</p><blockquote class=pgc-blockquote-abstract><p>aadsync-test.teams.microsoft.com</p><p>data-dev.teams.microsoft.com</p></blockquote><p>如果攻擊者劫持了上述兩個域名，就能竊取到受害者發往Microsoft Teams服務端的cookie，然後通過其中的"authtoken"生成"skypetoken"，就能對受害者賬戶數據的竊取。但該利用中還存在：</p><blockquote class=pgc-blockquote-abstract><p>1、攻擊者需要為上述可被劫持的子域名發佈一個證書，因為"authtoken"被標記為了secure，只能通過https通道傳遞。但對於攻擊者來說，這並不算是一個問題，因為域名已經可以劫持了，只要能上傳相應文件到指定的路徑下，證書頒佈機構即能發佈有效證書；</p><p>2、如何利用該漏洞方法實現Microsoft Teams賬戶劫持，如果可能的話，最好不要用惡意鏈接的方式，因為這種方法已經被用爛了，稍微有點安全意識的人都不會上當。</p></blockquote><p>為此，我們設計了一種不一樣的手法。</p><h1 class=pgc-h-arrow-right>構造邪惡的GIF</h1><p>如前所述，Microsoft Teams在跨域的Teams和Skype賬戶中進行圖片分享或瀏覽時，用"authtoken" 來驗證用戶身份然後加載圖片，因此，我們可以通過Microsoft Teams群聊，向受害者發送一張"src"屬性指向上述兩個可被劫持的子域名的圖片，當受害者打開該圖片後，其瀏覽器就會向攻擊者劫持的子域名發送包括"authtoken"的Cookie。</p><p>這樣一來，攻擊者就能獲取受害者的"authtoken"，然後生成"skypetoken"，進而竊取到受害者的所有數據信息。</p><div class=pgc-img><img alt=滲透人員福利：曝光黑客構造GIF動圖邪惡鏈接攻擊全過程 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/5f90d4e70fcf44d9942da8b957c36ac6><p class=pgc-img-caption></p></div><p>攻擊就是如下這麼簡單：受害者只需在Microsoft Teams賬戶中瀏覽一張正常的GIF，即可中招！子域名劫持+Cookie竊取=賬戶劫持。雖然這種攻擊場景大多限於內部，但也會引入外部因素，如邀請第三方人員或局外人加入視頻會議等。</p><div class=pgc-img><img alt=滲透人員福利：曝光黑客構造GIF動圖邪惡鏈接攻擊全過程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b189ab76fe0243639f852f34e83ea46c><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>形成類似蠕蟲的攻擊利用（Worm-like Vulnerability）</h1><p>該漏洞利用最大最可怕的一點就在於能在群組中廣泛傳播，類似蠕蟲一樣，受害者看到的是一張經過構造的正常圖片，每個受害者賬戶都會稱為一個擴散點，影響所有群組用戶，並且，這種圖片分享傳播也有可能被傳播給其它公司群組，形成更快更有效的攻擊步驟。POC視頻參考：</p><p><u>https://www.cyberark.com/threat-research-blog/beware-of-the-gif-account-takeover-vulnerability-in-microsoft-teams/</u></p><p>除此之外，我們還寫了一個腳本，可以跑出受害者的所有會話信息並保存在本地，如下圖所示：</p><div class=pgc-img><img alt=滲透人員福利：曝光黑客構造GIF動圖邪惡鏈接攻擊全過程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/4b154b812c8340c1a5505eff47d991c9><p class=pgc-img-caption></p></div><p>CyberArk發現了該漏洞，影響範圍波及客戶端和網頁版的app用戶。該團隊發現該漏洞後在3月23日報送給微軟，微軟在4月20日發佈的更新中修復了該漏洞。</p><p>從CyberArk安全人員Omer Tsarfati可以得知，一旦黑客給目標對象發送GIF惡意圖像，那麼他們就可以接管用戶賬號，獲取機密信息、會議行程、競爭數據、密碼、隱私、商業計劃等等。</p><p>Microsoft Teams是類似Zoom的一款視頻會議軟件，在COVID19期間也是見證了用戶視頻使用需求的崛起，世界範圍的企業、學生、政府僱員都必須使用視頻會議軟件來進行工作和社交。</p><h1 class=pgc-h-arrow-right>的域名接管漏洞</h1><p>該漏洞是在Microsoft Teams處理圖像資源身份驗證方式時出現的。每次打開應用程序時，都會在此過程中創建訪問令牌，JSON Web令牌（JWT），從而使用戶可以查看個人或其他人在對話中共享的圖像。該令牌也成為"skype令牌"，即" skypetoken_asm"的cookie，這不僅僅限於訪問圖像，還有其他用途。</p><p>Teams使用多個API端點與服務進行通信，並將用戶操作發送到相關API端點，此時則需要進行身份驗證來匹配操作和用戶身份。常用方式是發送訪問令牌，而Teams在圖像方面出現問題。比如用戶身份驗證不是基於Cookie，加載圖像則比身份驗證更為複雜。</p><p>為了解決此問題，有一種方法可以使用JavaScript代碼作為Blob提取圖像內容，然後將IMG標籤的src屬性設置為創建的Blob。在某些情況下，Teams使用瀏覽器的常規資源加載，這意味著Teams只是將URI的" src"屬性設置為HTML IMG標籤</p><blockquote class=pgc-blockquote-abstract><p>&lt;img ng-show ="！giphyCtrl.playVideo" ng-src ="</p><p>https://media2.giphy.com/media/gB4KWtd3uSsJq/giphy.GIF" height =" 240" width ="</p><p>480" load-image-handler src ="</p><p>https://media2.giphy.com/media/gB4KWtd3uSsJq/giphy.GIF"></p></blockquote><p>為了限制訪問權限，微軟又建立了一個名為" authtoken"和" skypetoken_asm"的cookie。</p><p>這就是問題所在，研究人員能夠獲得一個authtoken cookie，該cookie授予對資源服務器（api.spaces.skype.com）的訪問權限，並使用它來創建上述的" skype令牌"，因此他們具有很大的不受限制的權限，可以發送消息、閱讀消息、創建群組、添加新用戶或從群組中刪除用戶，甚至通過Teams API更改群組中的權限。</p><p>由於authtoken cookie設置為發送到team.microsoft.team或其任何子域，因此研究人員發現了兩個容易受到攻擊的子域（aadsync-test.teams.microsoft.com和data-dev.teams.microsoft.com），這兩個子域容易發生接管攻擊。</p><p>研究人員說："如果攻擊者以某種方式迫使用戶訪問已被接管的子域，則受害者的瀏覽器會將此Cookie發送到攻擊者的服務器，並且攻擊者（在收到authtoken之後）可以創建一個Skype令牌。完成所有這些操作後，攻擊者可以竊取受害者團隊的賬戶數據。"</p><div class=pgc-img><img alt=滲透人員福利：曝光黑客構造GIF動圖邪惡鏈接攻擊全過程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/670ce29b15394d5380833558b10c7dd3><p class=pgc-img-caption></p></div><h1 class=pgc-h-arrow-right>GIF惡意圖像載入</h1><p>Teams設置" authtoken" cookie的原因是對用戶進行身份驗證，方便在Teams和Skype的域中加載圖像。現在，攻擊者感染子域，可以利用這個漏洞發送惡意GIF圖片給群聊成員或者特定用戶，當用戶查看時，瀏覽器會嘗試加載圖像，並將authtoken cookie發送到受感染的子域。</p><div class=pgc-img><img alt=滲透人員福利：曝光黑客構造GIF動圖邪惡鏈接攻擊全過程 onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/6465b484f0bd4ec2a8fb62d2845b0348><p class=pgc-img-caption></p></div><p>然後，攻擊者可以使用此authtoken cookie創建一個Skype令牌，從而訪問所有受害者的數據。只要交互涉及聊天界面，例如邀請電話會議進行潛在的工作面試，任何人都可以發起攻擊。</p><blockquote class=pgc-blockquote-abstract><p>受害者永遠不會知道自己受到了攻擊，這使得利用此漏洞變得隱祕而危險。</p></blockquote><p>利用該漏洞最可怕之處在於其會自動傳播，類似蠕蟲病毒。</p><p>在COVID19這個特殊時期，基於環境的變化，全球用戶對視頻會議軟件需求激增，不管上文所述的Teams GIF入侵也好，還是前段時間引發熱議的"Zoom轟炸"也好，視頻會議軟件也開始是黑客發動攻擊青睞的對象。</p><p>因此，企業也要更加防範這個領域可能遭受的風險，比如網絡監聽、服務器或流量攻擊、身份冒充、會議內容數據竊取或篡改等。</p><h1 class=pgc-h-arrow-right>最後</h1><p>so 2020.4.20 微軟釋放補丁 over。。。</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>滲透</a></li><li><a>人員</a></li><li><a>構造</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/0a06ff55.html alt=區塊鏈上的隨機性：概述與構造 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RJjGCjxAt6MQlC style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0a06ff55.html title=區塊鏈上的隨機性：概述與構造>區塊鏈上的隨機性：概述與構造</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/51a9663e.html alt=橫滑式單元幕牆防水構造典型誤區分析 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/31a722f1541d41fa9475a525a782a0a7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/51a9663e.html title=橫滑式單元幕牆防水構造典型誤區分析>橫滑式單元幕牆防水構造典型誤區分析</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bd2e41b9.html alt=二、地球運行的方式-3(板塊構造) class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/4785b7af93d249b0972f939f77351e73 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bd2e41b9.html title=二、地球運行的方式-3(板塊構造)>二、地球運行的方式-3(板塊構造)</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/416cd00d.html alt=地球構造板塊開始移動的時間比以前認為的更早 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/5ff9ade37cba4a7e9239926d89584046 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/416cd00d.html title=地球構造板塊開始移動的時間比以前認為的更早>地球構造板塊開始移動的時間比以前認為的更早</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1c2deaa5.html alt=原子熒光光譜儀的構造原理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f47572eecf684fc79c8ea400d9985f61 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1c2deaa5.html title=原子熒光光譜儀的構造原理>原子熒光光譜儀的構造原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0be0973b.html alt="用戶和農機站人員共同推薦的10大播種機品牌 你為誰打call？" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/152040977417953b5af20dd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0be0973b.html title="用戶和農機站人員共同推薦的10大播種機品牌 你為誰打call？">用戶和農機站人員共同推薦的10大播種機品牌 你為誰打call？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/594c757d.html alt=嵩明縣持有第二、三代《殘疾人證》人員可參加免費健康體檢 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/976c43e3384a457c8dc5840491af4f2e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/594c757d.html title=嵩明縣持有第二、三代《殘疾人證》人員可參加免費健康體檢>嵩明縣持有第二、三代《殘疾人證》人員可參加免費健康體檢</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e2ad303f.html alt=給JAVA開發人員的正則表達式入門課 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/5d620d422d0a4855924c5bcbf8ba483a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e2ad303f.html title=給JAVA開發人員的正則表達式入門課>給JAVA開發人員的正則表達式入門課</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1a5783a2.html alt=史上最全圖解汽車構造與原理系列（九）活塞連桿組圖解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/37d7000172f8074b6abc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1a5783a2.html title=史上最全圖解汽車構造與原理系列（九）活塞連桿組圖解>史上最全圖解汽車構造與原理系列（九）活塞連桿組圖解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f6aa19dd.html alt=汽車發動機構造---曲柄連桿機構 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c8524852e5654ae1b3e82b4df617e501 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f6aa19dd.html title=汽車發動機構造---曲柄連桿機構>汽車發動機構造---曲柄連桿機構</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/70bde363.html alt=圖文解剖剎車構造原理——解讀制動系統剎車的歷史及未來 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3d92b7bc5ee44899939efd4f8f9ddf60 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/70bde363.html title=圖文解剖剎車構造原理——解讀制動系統剎車的歷史及未來>圖文解剖剎車構造原理——解讀制動系統剎車的歷史及未來</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/bd76328b.html alt=混床的設備構造 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/7887fee51ec542229e649d6d67f6d8b2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/bd76328b.html title=混床的設備構造>混床的設備構造</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9e7dc8cb.html alt=精釀啤酒設備的基本構造及設計原理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/74addd9fbd4b48439fb3f60435e27db8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9e7dc8cb.html title=精釀啤酒設備的基本構造及設計原理>精釀啤酒設備的基本構造及設計原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a3e6ba64.html alt=“百名紅通人員”已有58人歸案（下） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/RDygZAVDCACh74 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a3e6ba64.html title=“百名紅通人員”已有58人歸案（下）>“百名紅通人員”已有58人歸案（下）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3097ef6c.html alt=各種擋土牆構造與施工最全解讀！看了你才真正瞭解！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/153926362844833ae90c1eb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3097ef6c.html title=各種擋土牆構造與施工最全解讀！看了你才真正瞭解！>各種擋土牆構造與施工最全解讀！看了你才真正瞭解！</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>