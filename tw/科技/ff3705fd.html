<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFSå®‰è£éƒ¨ç½²(é«˜å¯ç”¨) | æå®¢å¿«è¨Š</title><meta property="og:title" content="åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFSå®‰è£éƒ¨ç½²(é«˜å¯ç”¨) - æå®¢å¿«è¨Š"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p9.pstatp.com/large/pgc-image/cb2346c189b7453fa0d3b98ad3c71cee"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ff3705fd.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ff3705fd.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ff3705fd.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ff3705fd.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ff3705fd.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ff3705fd.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ff3705fd.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ff3705fd.html><meta property="article:published_time" content="2020-11-14T21:03:23+08:00"><meta property="article:modified_time" content="2020-11-14T21:03:23+08:00"><meta name=Keywords content><meta name=description content="åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFSå®‰è£éƒ¨ç½²(é«˜å¯ç”¨)"><meta name=author content="æå®¢å¿«è¨Š"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/ff3705fd.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>ğŸ¤“ æå®¢å¿«è¨Š Geek Bank</a></h1><p class=description>ç‚ºä½ å¸¶ä¾†æœ€å…¨çš„ç§‘æŠ€çŸ¥è­˜ ğŸ§¡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>çŒœä½ å–œæ­¡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=ç§‘æŠ€>ç§‘æŠ€</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=éŠæˆ²>éŠæˆ²</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=ç§‘å­¸>ç§‘å­¸</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFSå®‰è£éƒ¨ç½²(é«˜å¯ç”¨)</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>ç§‘æŠ€</a></span></div><div class=post-content><p>æœ¬æ–‡æœƒæ­å»ºä¸€å€‹é©åˆä½æ¥­å‹™è¨ªå•æ¥­å‹™é‡çš„é«˜å¯ç”¨çš„FastDFSé›†ç¾¤ç’°å¢ƒï¼šå…©å€‹Trackeræœå‹™ï¼Œä¸€å€‹storage groupä¸­å…©å€‹storageæœå‹™ç¯€é»ï¼›è©²æ–¹æ¡ˆåƒ…é©ç”¨æ–¼æ¥­å‹™è¨ªå•é‡è¼ƒä½çš„ç’°å¢ƒä¸‹ã€‚å°æ–¼å¤§é‡æ¥­å‹™ç³»çµ±çš„é«˜ä½µç™¼è¨ªå•ï¼Œç‚ºäº†ä¿è­‰å­˜å„²ç³»çµ±æ­£å¸¸å·¥ä½œä¸€èˆ¬çš„æ¶æ§‹æ€è·¯ï¼šå®‰è£å¤šå€‹Trackeræœå‹™(è‡³å°‘å…©å€‹ï¼Œæ ¹æ“šæ¥­å‹™é‡èª¿æ•´)ï¼Œæ­å»ºå¤šå€‹storage group(è‡³å°‘å…©å€‹ï¼Œæ ¹æ“šæ¥­å‹™é‡èª¿æ•´)ï¼Œæ¯å€‹storage groupä¸­å¤šå€‹storage node(è‡³å°‘å…©å€‹ï¼Œåšæ•¸æ“šçš„å†—é¤˜å‚™ä»½ï¼Œé€²è¡Œå®¹ç½æ©Ÿåˆ¶ï¼Œè€Œä¸”nodeå¿…é ˆåœ¨ä¸åŒçš„æ©Ÿå™¨ä¸Š)</p><p><strong>ä¸€ã€FastDFSç°¡ä»‹</strong></p><p>FastDFSæ˜¯ä¸€å€‹é–‹æºçš„è¼•é‡ç´šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±ï¼Œå®ƒå°æ–‡ä»¶é€²è¡Œç®¡ç†ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼šæ–‡ä»¶å­˜å„²ã€æ–‡ä»¶åŒæ­¥ã€æ–‡ä»¶è¨ªå•ï¼ˆæ–‡ä»¶ä¸Šå‚³ã€æ–‡ä»¶ä¸‹è¼‰ï¼‰ç­‰ï¼Œè§£æ±ºäº†å¤§å®¹é‡å­˜å„²å’Œè² è¼‰å‡è¡¡çš„å•é¡Œã€‚ç‰¹åˆ¥é©åˆä»¥æ–‡ä»¶ç‚ºè¼‰é«”çš„åœ¨ç·šæœå‹™ï¼Œå¦‚ç›¸å†Šç¶²ç«™ã€è¦–é »ç¶²ç«™ç­‰ç­‰ã€‚</p><p>FastDFSç‚ºäº’è¯ç¶²é‡èº«å®šè£½ï¼Œå……åˆ†è€ƒæ…®äº†å†—é¤˜å‚™ä»½ã€è² è¼‰å‡è¡¡ã€ç·šæ€§æ“´å®¹ç­‰æ©Ÿåˆ¶ï¼Œä¸¦æ³¨é‡é«˜å¯ç”¨ã€é«˜æ€§èƒ½ç­‰æŒ‡æ¨™ï¼Œä½¿ç”¨FastDFSå¾ˆå®¹æ˜“æ­å»ºä¸€å¥—é«˜æ€§èƒ½çš„æ–‡ä»¶æœå‹™å™¨é›†ç¾¤æä¾›æ–‡ä»¶ä¸Šå‚³ã€ä¸‹è¼‰ç­‰æœå‹™ã€‚</p><p>FastDFSæœå‹™ç«¯æœ‰å…©å€‹è§’è‰²ï¼šè·Ÿè¹¤å™¨ï¼ˆtrackerï¼‰å’Œå­˜å„²ç¯€é»ï¼ˆstorageï¼‰ã€‚è·Ÿè¹¤å™¨ä¸»è¦åšèª¿åº¦å·¥ä½œï¼Œåœ¨è¨ªå•ä¸Šèµ·è² è¼‰å‡è¡¡çš„ä½œç”¨ã€‚</p><p>å­˜å„²ç¯€é»å­˜å„²æ–‡ä»¶ï¼Œå®Œæˆæ–‡ä»¶ç®¡ç†çš„æ‰€æœ‰åŠŸèƒ½ï¼šå°±æ˜¯é€™æ¨£çš„å­˜å„²ã€åŒæ­¥å’Œæä¾›å­˜å–æ¥å£ï¼ŒFastDFSåŒæ™‚å°æ–‡ä»¶çš„metadataé€²è¡Œç®¡ç†ã€‚æ‰€è¬‚æ–‡ä»¶çš„meta dataå°±æ˜¯æ–‡ä»¶çš„ç›¸é—œå±¬æ€§ï¼Œä»¥éµå€¼å°ï¼ˆkey valueï¼‰æ–¹å¼è¡¨ç¤ºï¼Œå¦‚ï¼šwidth=1024ï¼Œå…¶ä¸­çš„keyç‚ºwidthï¼Œvalueç‚º1024ã€‚æ–‡ä»¶metadataæ˜¯æ–‡ä»¶å±¬æ€§åˆ—è¡¨ï¼Œå¯ä»¥åŒ…å«å¤šå€‹éµå€¼å°ã€‚</p><p>è·Ÿè¹¤å™¨å’Œå­˜å„²ç¯€é»éƒ½å¯ä»¥ç”±ä¸€è‡ºæˆ–å¤šè‡ºæœå‹™å™¨æ§‹æˆã€‚è·Ÿè¹¤å™¨å’Œå­˜å„²ç¯€é»ä¸­çš„æœå‹™å™¨å‡å¯ä»¥éš¨æ™‚å¢åŠ æˆ–ä¸‹ç·šè€Œä¸æœƒå½±éŸ¿ç·šä¸Šæœå‹™ã€‚å…¶ä¸­è·Ÿè¹¤å™¨ä¸­çš„æ‰€æœ‰æœå‹™å™¨éƒ½æ˜¯å°ç­‰çš„ï¼Œå¯ä»¥æ ¹æ“šæœå‹™å™¨çš„å£“åŠ›æƒ…æ³éš¨æ™‚å¢åŠ æˆ–æ¸›å°‘ã€‚</p><p>ç‚ºäº†æ”¯æŒå¤§å®¹é‡ï¼Œå­˜å„²ç¯€é»ï¼ˆæœå‹™å™¨ï¼‰æ¡ç”¨äº†åˆ†å·ï¼ˆæˆ–åˆ†çµ„ï¼‰çš„çµ„ç¹”æ–¹å¼ã€‚å­˜å„²ç³»çµ±ç”±ä¸€å€‹æˆ–å¤šå€‹å·çµ„æˆï¼Œå·èˆ‡å·ä¹‹é–“çš„æ–‡ä»¶æ˜¯ç›¸äº’ç¨ç«‹çš„ï¼Œæ‰€æœ‰å·çš„æ–‡ä»¶å®¹é‡ç´¯åŠ å°±æ˜¯æ•´å€‹å­˜å„²ç³»çµ±ä¸­çš„æ–‡ä»¶å®¹é‡ã€‚ä¸€å€‹å·å¯ä»¥ç”±ä¸€è‡ºæˆ–å¤šè‡ºå­˜å„²æœå‹™å™¨çµ„æˆï¼Œä¸€å€‹å·ä¸‹çš„å­˜å„²æœå‹™å™¨ä¸­çš„æ–‡ä»¶éƒ½æ˜¯ç›¸åŒçš„ï¼Œå·ä¸­çš„å¤šè‡ºå­˜å„²æœå‹™å™¨èµ·åˆ°äº†å†—é¤˜å‚™ä»½å’Œè² è¼‰å‡è¡¡çš„ä½œç”¨ã€‚</p><p>åœ¨å·ä¸­å¢åŠ æœå‹™å™¨æ™‚ï¼ŒåŒæ­¥å·²æœ‰çš„æ–‡ä»¶ç”±ç³»çµ±è‡ªå‹•å®Œæˆï¼ŒåŒæ­¥å®Œæˆå¾Œï¼Œç³»çµ±è‡ªå‹•å°‡æ–°å¢æœå‹™å™¨åˆ‡æ›åˆ°ç·šä¸Šæä¾›æœå‹™ã€‚</p><p>ç•¶å­˜å„²ç©ºé–“ä¸è¶³æˆ–å³å°‡è€—ç›¡æ™‚ï¼Œå¯ä»¥å‹•æ…‹æ·»åŠ æ²ã€‚åªéœ€è¦å¢åŠ ä¸€è‡ºæˆ–å¤šè‡ºæœå‹™å™¨ï¼Œä¸¦å°‡å®ƒå€‘é…ç½®ç‚ºä¸€å€‹æ–°çš„å·ï¼Œé€™æ¨£å°±æ“´å¤§äº†å­˜å„²ç³»çµ±çš„å®¹é‡ã€‚</p><p>FastDFSä¸­çš„æ–‡ä»¶æ¨™è­˜åˆ†ç‚ºå…©å€‹éƒ¨åˆ†ï¼šå·åå’Œæ–‡ä»¶åï¼ŒäºŒè€…ç¼ºä¸€ä¸å¯ã€‚</p><p>â€”â€”â€”ç°¡ä»‹æ‘˜è‡ªç™¾åº¦ç™¾ç§‘</p><p><strong>äºŒã€FastDFSåŸç†ä»‹ç´¹</strong></p><p>1.æ–‡ä»¶ä¸Šå‚³</p><p>FastDFSä»¥å®¢æˆ¶ç«¯åº«çš„æ–¹å¼æä¾›åŸºæœ¬çš„æ–‡ä»¶è¨ªå•æ¥å£å¦‚uploadã€downloadã€appendã€deleteç­‰ï¼ŒStorage æœå‹™æœƒå®šæ™‚çš„å‘Trackeræœå‹™ç™¼é€è‡ªå·±çš„å­˜å„²ä¿¡æ¯ã€‚ç•¶Tracker æœå‹™é›†ç¾¤ä¸­çš„Tracker æœå‹™æ˜¯å¤šå€‹æ™‚ï¼Œå„å€‹Trackeræœå‹™ä¹‹é–“çš„é—œä¿‚æ˜¯å°ç­‰çš„ï¼Œå› æ­¤å®¢æˆ¶ç«¯ä¸Šå‚³æ™‚æœƒä»»æ„é¸æ“‡ä¸€å€‹Trackreæœå‹™ã€‚ç•¶Trackeræœå‹™æ”¶åˆ°å®¢æˆ¶ç«¯ä¸Šå‚³æ–‡ä»¶è«‹æ±‚æ™‚ï¼Œæœƒç‚ºè©²æ–‡ä»¶åˆ†é…ä¸€å€‹å¯ä»¥å­˜å„²æ–‡ä»¶çš„groupï¼Œç•¶é¸å®šäº†groupå¾Œå°±è¦æ±ºå®šçµ¦å®¢æˆ¶ç«¯åˆ†é…groupä¸­çš„å“ªä¸€å€‹storageæœå‹™ã€‚ç•¶åˆ†é…å¥½storage æœå‹™å¾Œï¼Œå®¢æˆ¶ç«¯å‘storageç™¼é€å¯«æ–‡ä»¶è«‹æ±‚ï¼Œstorageå°‡æœƒç‚ºæ–‡ä»¶åˆ†é…ä¸€å€‹æ•¸æ“šå­˜å„²ç›®éŒ„ã€‚ç„¶å¾Œç‚ºæ–‡ä»¶åˆ†é…ä¸€å€‹æ–‡ä»¶IDæ¨™ç¤ºï¼Œç„¶å¾Œæ ¹æ“šä»¥ä¸Šçš„ä¿¡æ¯ç”Ÿæˆæ–‡ä»¶åå­˜å„²æ–‡ä»¶ã€‚</p><p>2.æ–‡ä»¶åŒæ­¥</p><p>ä¸Šå‚³æ–‡ä»¶å¾Œï¼Œå®¢æˆ¶ç«¯å°‡æ–‡ä»¶å¯«åˆ°groupå…§çš„ä¸€å€‹storage æœå‹™å³ç‚ºä¸Šå‚³æ–‡ä»¶æˆåŠŸï¼Œstorageæœå‹™å¯«å®Œæ–‡ä»¶å¾Œï¼Œæœƒç”±å¾Œè‡ºç·šç¨‹å°‡æ–‡ä»¶åŒæ­¥è‡³åŒgroupå…§çš„å…¶ä»–çš„storage æœå‹™ç¯€é»ä¸Šã€‚ æ¯å€‹storageæœå‹™å¯«æ–‡ä»¶å¾Œï¼ŒæœƒåŒæ™‚å¯«ä¸€ä»½binlogï¼Œbinlogè£¡ä¸åŒ…å«æ–‡ä»¶æ•¸æ“šï¼ŒåªåŒ…å«æ–‡ä»¶åç­‰å…ƒä¿¡æ¯ï¼Œé€™ä»½binlogç”¨æ–¼å¾Œè‡ºåŒæ­¥ï¼Œstorageæœƒè¨˜éŒ„å‘groupå…§å…¶ä»–storageåŒæ­¥çš„é€²åº¦ï¼Œä»¥ä¾¿é‡å•Ÿå¾Œèƒ½æ¥ä¸Šæ¬¡çš„é€²åº¦ç¹¼çºŒåŒæ­¥ï¼›é€²åº¦ä»¥æ™‚é–“æˆ³çš„æ–¹å¼é€²è¡Œè¨˜éŒ„ï¼Œæ‰€ä»¥æœ€å¥½èƒ½ä¿è­‰é›†ç¾¤å…§çš„æ‰€æœ‰serverçš„å§‹çµ‚ä¿æŒåŒæ­¥ã€‚æœ€å¾ŒStorageæœå‹™çš„åŒæ­¥é€²åº¦æœƒä½œç‚ºå…ƒæ•¸æ“šçš„ä¸€éƒ¨åˆ†å½™å ±åˆ°trackeræœå‹™ä¸Šï¼Œtrackeræœå‹™åœ¨é¸æ“‡è®€storageçš„æ™‚å€™æœƒä»¥åŒæ­¥é€²åº¦ä½œç‚ºåƒè€ƒæŒ‡æ¨™ã€‚</p><p>3.ä¸‹è¼‰æ–‡ä»¶</p><p>ç•¶ä¸‹è¼‰æ–‡ä»¶æ™‚ï¼Œå®¢æˆ¶ç«¯å…ˆè©¢å•trackeræœå‹™ä¸‹è¼‰æ–‡ä»¶çš„storageï¼Œåƒæ•¸ç‚ºæ–‡ä»¶æ¨™è­˜ï¼ˆå·åå’Œæ–‡ä»¶åï¼‰ï¼›ç„¶å¾Œtrackerå‘å®¢æˆ¶ç«¯è¿”å›ä¸€è‡ºå¯ç”¨çš„storageï¼›æœ€å¾Œå®¢æˆ¶ç«¯ç›´æ¥å’Œstorageé€šè¨Šå®Œæˆæ–‡ä»¶ä¸‹è¼‰ã€‚</p><p><strong>ä¸‰ã€éƒ¨ç½²ç’°å¢ƒæº–å‚™</strong></p><p>1.ç’°å¢ƒèªªæ˜</p><p>æ“ä½œç³»çµ±CentOS7.6</p><p>fastdfsç‰ˆæœ¬ï¼š6.01</p><p>nginxç‰ˆæœ¬ï¼š1.16.1</p><p>keepalivedç‰ˆæœ¬ï¼š2.0.19</p><p>2.ç³»çµ±ä¾è³´</p><p>gcc gcc-c++ perl pcre pcre-devel zlib zlib-devel openssl openssl-devel</p><p>3.è»Ÿä»¶ç’°å¢ƒ</p><p>libeventä¸‹è¼‰åœ°å€ï¼šhttp://libevent.org/</p><p>nginxä¸‹è¼‰åœ°å€ï¼šhttp://nginx.org/en/download.html</p><p>keepalivedä¸‹è¼‰åœ°å€ï¼šhttps://www.keepalived.org/software/</p><p>fastdfsä¸‹è¼‰åœ°å€ï¼šhttps://github.com/happyfish100/fastdfs/releases</p><p>libfasttcommonä¸‹è¼‰åœ°å€ï¼šhttps://github.com/happyfish100/libfastcommon/releases</p><p>fastdfs-nginx-moduleä¸‹è¼‰åœ°å€ï¼šhttps://github.com/happyfish100/fastdfs-nginx-module/releases</p><p>4.æ©Ÿå™¨åŠç¶²çµ¡ç’°å¢ƒè¦åŠƒ</p><pre>Fdfs Server VIPï¼š 192.168.100.110Tracker Server1ï¼š 192.168.100.111Tracker Server2ï¼š 192.168.100.112Storage Group1 Node1ï¼š 192.168.100.111Storage Group1 Node2ï¼š 192.168.100.112</pre><p>5.é˜²ç«ç‰†è¨­ç½®</p><p>é—œé–‰ç³»çµ±é˜²ç«ç‰†ï¼šsudo systemctl stop firewalld && systemctl disable firewalld</p><p><strong>å››ã€Keepalivedæœå‹™å®‰è£é…ç½®</strong></p><p>1.ä¸‹è¼‰Keepalivedæºç¢¼åŒ…</p><p>å®˜ç¶²åœ°å€ï¼šhttps://www.keepalived.org/</p><p>ä¸‹è¼‰åœ°å€ï¼šhttps://www.keepalived.org/software/keepalived-2.0.19.tar.gz</p><p>2.ä¸Šå‚³ä¸¦è§£å£“Keepalivedæºç¢¼åŒ…</p><p>tar -zxvf keepalived-2.0.19.tar.gz</p><p>3.ç·¨è­¯Keepalivedæº–å‚™</p><p>é€²å…¥è§£å£“ç›®éŒ„ï¼šcd keepalived-2.0.19</p><p>åŸ·è¡Œç·¨è­¯æº–å‚™ï¼š./configure --prefix=/work/keepalived</p><p>æ³¨æ„ï¼šä¸€å®šè¦æœ‰gccå’Œopensslç·¨è­¯ç›¸é—œçš„ä¾è³´</p><p>4.ç·¨è­¯å®‰è£Keepalived</p><p>make && make install</p><p>5.å®‰è£é…ç½®Keepalived</p><p>keepalivedå•Ÿå‹•æ™‚æœƒå¾/etc/keepalived/ä¸­ç›¸é—œçš„ç›®éŒ„ä¸‹æŸ¥æ‰¾keepalived.confé…ç½®æ–‡ä»¶ï¼Œå› æ­¤å°‡keepalivedå®‰è£éŒ„/usr/local/keepalived/etc/keepalived.conf æ‹·è²åˆ°/etc/keepalived/ä¸­ã€‚</p><p>mkdir /etc/keepalived/</p><p>cp /work/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf</p><p>cp /work/keepalived/etc/sysconfig/keepalived /etc/sysconfig/keepalived</p><p>6.è¨­ç½®Keepalivedé–‹æ©Ÿå•Ÿå‹•é …</p><p>systemctl enable keepalived</p><p>ç„¶å¾Œå°±èƒ½ä½¿ç”¨systemctl start/stop/status keepalivedç®¡ç†keepalivedäº†</p><p>7.é…ç½®Keepalivedæœå‹™</p><p>192.168.100.111æ©Ÿå™¨ä¸Šé…ç½®ï¼švi /etc/keepalived/keepalived.conf</p><pre>vrrp_script check_nginx { interval 3 script "/work/script/check_nginx.sh"} vrrp_instance fdfs_server { state MASTER interface enp0s3 virtual_router_id 110 priority 100 advert_int 3 authentication { auth_type PASS auth_pass password } virtual_ipaddress { 192.168.100.110 } track_script { check_nginx }}</pre><p>192.168.100.112æ©Ÿå™¨ä¸Šé…ç½®ï¼švi /etc/keepalived/keepalived.conf</p><pre>vrrp_script check_nginx { interval 3 script "/work/script/check_nginx.sh"} vrrp_instance fdfs_server { state BACKUP interface enp0s3 virtual_router_id 110 priority 90 advert_int 3 authentication { auth_type PASS auth_pass password } virtual_ipaddress { 192.168.100.110 } track_script { check_nginx }}</pre><p>8.ç·¨å¯«nginxæœå‹™æª¢æ¸¬è…³æœ¬</p><p>vi /work/script/check_nginx.sh</p><pre>#!/bin/bashactive_status=`netstat -lntp|grep nginx|wc -l`if [ $active_status -gt 0 ]; then exit 0else exit 1fi</pre><p>ç„¶å¾Œçµ¦è…³æœ¬è³¦äºˆåŸ·è¡Œæ¬Šé™ï¼šchmod +x /work/script/check_nginx.sh</p><p>9.ä¿®æ”¹å…§æ ¸åƒæ•¸</p><p>vi /etc/sysctl.conf</p><p>å¢åŠ å¦‚ä¸‹å…§å®¹ï¼š</p><pre>net.ipv4.ip_nonlocal_bind = 1 #å…è¨±å¿½è¦–VIPçš„å­˜åœ¨net.ipv4.ip_forward = 1 #å…è¨±è½‰ç™¼</pre><p>sysctl --system ä½¿é…ç½®ç”Ÿæ•ˆ</p><p><strong>äº”ã€å®‰è£FastDFSä¾è³´åº«</strong></p><p>1.å®‰è£libeventä¾è³´</p><p>è§£å£“libeventæºç¢¼åŒ…ï¼štar -zxvf libevent-2.1.11-stable.tar.gz</p><p>é€²å…¥æºç¢¼ç›®éŒ„ï¼šcd libevent-2.1.11-stable</p><p>ç·¨è­¯å®‰è£å‰é…ç½®ï¼š./configure</p><p>ç·¨è­¯å®‰è£ï¼šmake && make install</p><p>é»˜èªå®‰è£ä½ç½®ï¼š/usr/local/lib</p><p>2.å®‰è£libfasttcommonä¾è³´</p><p>è§£å£“libfasttcommonæºç¢¼åŒ…ï¼štar -zxvf libfastcommon-1.0.41.tar.gz</p><p>é€²å…¥æºç¢¼ç›®éŒ„ï¼šcd libfastcommon-1.0.41</p><p>ç·¨è­¯å®‰è£ï¼š./make.sh && ./make.sh install</p><p>é»˜èªå®‰è£ä½ç½®ï¼š/usr/lib64</p><p><strong>å…­ã€å®‰è£éƒ¨ç½²Trackeræœå‹™å’ŒStorageæœå‹™</strong></p><p>1.å®‰è£fastdfsæœå‹™</p><p>è§£å£“fastdfsæºç¢¼åŒ…ï¼štar -zxvf fastdfs-6.01.tar.gz</p><p>é€²å…¥fastdfsæºç¢¼åŒ…ï¼šcd fastdfs-6.01</p><p>ç·¨è­¯å®‰è£ï¼š./make.sh && ./make.sh install</p><p>2.fastdfsæœå‹™ç›®éŒ„ä¿¡æ¯</p><p>å®‰è£å®Œæˆå¾Œæœå‹™åŠè…³æœ¬æ‹·è²åˆ°/usr/bin ç›®éŒ„ï¼Œé…ç½®æ–‡ä»¶æ‹·è²åˆ°/etc/fdfsç›®éŒ„ï¼Œå•Ÿå‹•è…³æœ¬æ‹·è²åˆ°/etc/init.d/ç›®éŒ„</p><p>3.è¨»å†Šé–‹æ©Ÿå•Ÿå‹•</p><p>chkconfig --add fdfs_trackerd</p><p>chkconfig fdfs_trackerd on</p><p>chkconfig --add fdfs_storaged</p><p>chkconfig fdfs_storaged on</p><p>4.æ•¸æ“šç›®éŒ„è¦åŠƒ</p><p>å‰µå»ºfdfsæ•¸æ“šä¸»ç›®éŒ„ï¼šmkdir /work/fdfs</p><p>å‰µå»ºtrackeræ•¸æ“šç›®éŒ„ï¼šmkdir /work/fdfs/tracker</p><p>å‰µå»ºstorageæ•¸æ“šç›®éŒ„ï¼šmkdir /work/fdfs/storage</p><p>5.é…ç½®trackeræœå‹™</p><p>å°‡/etc/fdfsç›®éŒ„ä¸‹çš„tracker.conf.sampleæ”¹ç‚ºtracker.confï¼šmv tracker.conf.sample tracker.confä¿®æ”¹å…§å®¹å¦‚ä¸‹ï¼š</p><p>å°‡base_path=/home/yuqing/fastdfs æ”¹ç‚ºï¼š/work/fdfs/tracker(è©²ç›®éŒ„ç‚ºä¸Šé¢å®šç¾©å‰µå»º)</p><p>å•Ÿå‹•Trackeræœå‹™ï¼šsystemctl start fdfs_trackerd</p><p>6.é…ç½®storageæœå‹™</p><p>å°‡/etc/fdfsç›®éŒ„ä¸‹çš„storage.conf.sampleæ”¹ç‚ºstorage.confï¼šmv storage.conf.sample storage.confä¿®æ”¹å…§å®¹å¦‚ä¸‹ï¼š</p><p>base_path=/home/yuqing/fastdfs æ”¹ç‚ºï¼šbase_path=/work/fdfs/storage(è©²ç›®éŒ„ç‚ºä¸Šé¢å®šç¾©å‰µå»º)</p><p>store_path0=/home/yuqing/fastdfs æ”¹ç‚ºï¼šstore_path0=/work/fdfs/storage(è©²ç›®éŒ„ç‚ºä¸Šé¢å®šç¾©å‰µå»º)</p><p>tracker_server=192.168.209.121:22122 æ”¹ç‚ºï¼štracker_server=192.168.100.111:22122å’Œtracker_server=192.168.100.112:22122</p><p>å°‡/etc/fdfs/torage_ids.conf.sample ç‚ºstorage_ids.confï¼Œå…§å®¹ä¿®æ”¹ç‚ºç•¶å‰groupçš„storageç¯€é»ä¿¡æ¯ï¼š</p><p>100001 group1 192.168.100.111</p><p>100002 group1 192.168.100.112</p><p>å•Ÿå‹•Storageæœå‹™ï¼šsystemctl start fdfs_storaged</p><p><strong>ä¸ƒã€Nginxæœå‹™å®‰è£é…ç½®</strong></p><p>1.ä¸‹è¼‰Nginxæºç¢¼åŒ…</p><p>å®˜ç¶²åœ°å€ï¼šhttp://nginx.org/</p><p>ä¸‹è¼‰åœ°å€ï¼šhttp://nginx.org/en/download.html</p><p>2.ä¸Šå‚³ä¸¦è§£å£“Nginxæºç¢¼åŒ…åŠfastdfsæ’ä»¶åŒ…</p><p>tar -zxvf nginx-1.16.1.tar.gz</p><p>tar -zxvf fastdfs-nginx-module-1.21.tar.gz</p><p>3.ç·¨è­¯Nginxæº–å‚™</p><p>é€²å…¥è§£å£“ç›®éŒ„ï¼šcd nginx-1.16.1</p><p>æ‹·è²fastdfsæ’ä»¶åŒ…åˆ°nginxæºç¢¼ç›®éŒ„ï¼šmv ../fastdfs-nginx-module-1.21 .</p><p>åŸ·è¡Œç·¨è­¯æº–å‚™ï¼š./configure --prefix=/work/nginx \--with-stream \--add-module=fastdfs-nginx-module-1.21/src</p><p>æ³¨æ„ï¼šä¸€å®šè¦æœ‰gccå’Œopensslç·¨è­¯ç›¸é—œçš„ä¾è³´</p><p>4.ç·¨è­¯å®‰è£Nginx</p><p>make && make install</p><p>5.è¨»å†Šåˆ°ç³»çµ±æœå‹™</p><p>vi /usr/lib/systemd/system/nginx.service</p><pre>[Unit]Description=nginxDocumentation=http://nginx.org/en/docs/After=network.target[Service]Type=forkingPIDFile=/work/nginx/logs/nginx.pidExecStartPre=/work/nginx/sbin/nginx -t -c /work/nginx/conf/nginx.confExecStart=/work/nginx/sbin/nginx -c /work/nginx/conf/nginx.confExecReload=/bin/kill -s HUP $MAINPIDExecStop=/bin/kill -s QUIT $MAINPIDPrivateTmp=true[Install]WantedBy=multi-user.target</pre><p>6.è¨­ç½®Nginxé–‹æ©Ÿå•Ÿå‹•é …</p><p>systemctl enable nginx</p><p>ç„¶å¾Œå°±èƒ½ä½¿ç”¨systemctl start/stop/status nginxç®¡ç†nginxäº†</p><p>7.ä¿®æ”¹Nginxé…ç½®</p><p>vi /work/nginx/conf/nginx.conf</p><pre>#user nobody;worker_processes 1;#error_log logs/error.log;#error_log logs/error.log notice;#error_log logs/error.log info;#pid logs/nginx.pid;events { worker_connections 1024;}stream { upstream tracker { server 192.168.100.111:22122 weight=1 max_fails=2 fail_timeout=10s; server 192.168.100.112:22122 weight=1 max_fails=2 fail_timeout=10s; } server { listen 7777; proxy_timeout 5m; proxy_pass tracker; proxy_connect_timeout 10s; }}http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; upstream storage { server 192.168.100.111:8888 weight=1 max_fails=2 fail_timeout=10s; server 192.168.100.112:8888 weight=1 max_fails=2 fail_timeout=10s; } server { listen 80; server_name localhost;  location /group1 { proxy_pass http://storage; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; }  error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } server { listen 8888; server_name localhost; location / { alias /work/fdfs/storage/data/; ngx_fastdfs_module; } }}</pre><p>8.é…ç½®nginxçš„fdfsæ’ä»¶</p><p>å°‡/etc/fdfsä¸‹çš„http.conf.sampleå’Œmime.types.sampleé‡å‘½åç‚ºï¼šhttp.confå’Œmime.types</p><p>å°‡fastdfs-nginx-module-1.21/srcä¸‹çš„mod_fastdfs.confæ‹·è²åˆ°/etc/fdfsä¸‹</p><p>ä¿®æ”¹mod_fastdfs.confå¦‚ä¸‹ï¼š</p><p>é€£æ¥è¶…æ™‚æ™‚é–“ï¼š connect_timeout=5</p><p>Trackeræœå‹™åœ°å€ï¼štracker_server=192.168.100.111:22122 å’Œtracker_server=192.168.100.112:22122</p><p>Storageæœå‹™ç«¯å£ï¼šstorage_server_port=23000</p><p>å¦‚æœæ–‡ä»¶IDçš„uriä¸­åŒ…å«/group**ï¼Œå‰‡è¦è¨­ç½®ç‚ºtrueï¼šurl_have_group_name = true</p><p>Storageé…ç½®çš„store_path0è·¯å¾‘ï¼Œå¿…é ˆå’Œstorage.confä¸­çš„ä¸€è‡´ï¼šstore_path0=/work/fdfs/storage</p><p>å…¶ä»–è©³ç´°é…ç½®å¦‚ä¸‹ï¼š</p><pre># connect timeout in seconds# default value is 30sconnect_timeout=5# network recv and send timeout in seconds# default value is 30snetwork_timeout=10# the base path to store log filesbase_path=/work/fdfs/storage# if load FastDFS parameters from tracker server# since V1.12# default value is falseload_fdfs_parameters_from_tracker=true# storage sync file max delay seconds# same as tracker.conf# valid only when load_fdfs_parameters_from_tracker is false# since V1.12# default value is 86400 seconds (one day)storage_sync_file_max_delay = 86400# if use storage ID instead of IP address# same as tracker.conf# valid only when load_fdfs_parameters_from_tracker is false# default value is false# since V1.13use_storage_id = false# specify storage ids filename, can use relative or absolute path# same as tracker.conf# valid only when load_fdfs_parameters_from_tracker is false# since V1.13storage_ids_filename = storage_ids.conf# FastDFS tracker_server can ocur more than once, and tracker_server format is# "host:port", host can be hostname or ip address# valid only when load_fdfs_parameters_from_tracker is truetracker_server=192.168.100.111:22122tracker_server=192.168.100.112:22122# the port of the local storage server# the default value is 23000storage_server_port=23000# the group name of the local storage servergroup_name=group1# if the url / uri including the group name# set to false when uri like /M00/00/00/xxx# set to true when uri like ${group_name}/M00/00/00/xxx, such as group1/M00/xxx# default value is falseurl_have_group_name = true# path(disk or mount point) count, default value is 1# must same as storage.confstore_path_count=1# store_path#, based 0, if store_path0 not exists, it's value is base_path# the paths must be exist# must same as storage.confstore_path0=/work/fdfs/storage# standard log level as syslog, case insensitive, value list:### emerg for emergency### alert### crit for critical### error### warn for warning### notice### info### debuglog_level=info# set the log filename, such as /usr/local/apache2/logs/mod_fastdfs.log# empty for output to stderr (apache and nginx error_log file)log_filename=# response mode when the file not exist in the local file system## proxy: get the content from other storage server, then send to client## redirect: redirect to the original storage server (HTTP Header is Location)response_mode=proxy# the NIC alias prefix, such as eth in Linux, you can see it by ifconfig -a# multi aliases split by comma. empty value means auto set by OS type# this paramter used to get all ip address of the local host# default values is emptyif_alias_prefix=# use "#include" directive to include HTTP config file# NOTE: #include is an include directive, do NOT remove the # before include#include http.conf# if support flv# default value is false# since v1.15flv_support = true# flv file extension name# default value is flv# since v1.15flv_extension = flv# set the group count# set to none zero to support multi-group on this storage server# set to 0 for single group only# groups settings section as [group1], [group2], ..., [groupN]# default value is 0# since v1.14group_count = 1# group settings for group #1# since v1.14# when support multi-group on this storage server, uncomment following section[group1]group_name=group1storage_server_port=23000store_path_count=1store_path0=/work/fdfs/storage# group settings for group #2# since v1.14# when support multi-group, uncomment following section as neccessary#[group2]#group_name=group2#storage_server_port=23000#store_path_count=1#store_path0=/home/yuqing/fastdfs</pre><p><strong>å…«ã€æœå‹™å•Ÿå‹•åŠé©—è­‰</strong></p><p>åˆ†åˆ¥å•Ÿå‹•keepaliveã€nginxã€trackerã€storageæœå‹™</p><p>æŸ¥çœ‹æœå‹™æ˜¯å¦æ­£å¸¸æœå‹™ï¼š</p><div class=pgc-img><img alt=åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFSå®‰è£éƒ¨ç½²(é«˜å¯ç”¨) onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/cb2346c189b7453fa0d3b98ad3c71cee><p class=pgc-img-caption></p></div><p>åœ¨ä»»æ„Storageæ©Ÿå™¨ä¸ŠæŸ¥çœ‹é›†ç¾¤ç‹€æ…‹ï¼šfdfs_monitor /etc/fdfs/storage.conf</p><div class=pgc-img><img alt=åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFSå®‰è£éƒ¨ç½²(é«˜å¯ç”¨) onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/9158363a50154d49b8f9d41648645e25><p class=pgc-img-caption></p></div><p><strong>ä¹ã€Javaå®¢æˆ¶ç«¯æ¸¬è©¦</strong></p><p>1.javaé …ç›®Mavenä¾è³´</p><pre>é …ç›®åœ°å€ï¼šhttps://github.com/tobato/FastDFS_Clientç›®å‰å®¢æˆ¶ç«¯ä¸»è¦ä¾è³´æ–¼SpringBootï¼Œå› æ­¤å¿…é ˆå¼•å…¥:&lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.0.RELEASE&lt;/version&gt; &lt;relativePath/&gt;&lt;/parent&gt;FastDFS ä¾è³´åŒ…ï¼š&lt;dependency&gt; &lt;groupId&gt;com.github.tobato&lt;/groupId&gt; &lt;artifactId&gt;fastdfs-client&lt;/artifactId&gt; &lt;version&gt;1.26.7&lt;/version&gt;&lt;/dependency&gt;å°‡FastDFSå¼•å…¥é …ç›®ï¼š@Import(FdfsClientConfig.class)åœ¨application.ymlç•¶ä¸­é…ç½®Fdfsç›¸é—œåƒæ•¸ï¼šfdfs: pool: #é€£æ¥æ± æœ€å¤§æ•¸é‡ max-total: 200 #æ¯å€‹trackeråœ°å€çš„æœ€å¤§é€£æ¥æ•¸ max-total-per-key: 50 #é€£æ¥è€—ç›¡æ™‚ç­‰å¾…ç²å–é€£æ¥çš„æœ€å¤§æ¯«ç§’æ•¸ max-wait-millis: 5000 so-timeout: 1500 connect-timeout: 600 thumb-image: width: 150 height: 150 tracker-list: - 192.168.100.110:7777æˆ–è€…fdfs: pool: #é€£æ¥æ± æœ€å¤§æ•¸é‡ max-total: 200 #æ¯å€‹trackeråœ°å€çš„æœ€å¤§é€£æ¥æ•¸ max-total-per-key: 50 #é€£æ¥è€—ç›¡æ™‚ç­‰å¾…ç²å–é€£æ¥çš„æœ€å¤§æ¯«ç§’æ•¸ max-wait-millis: 5000 so-timeout: 1500 connect-timeout: 600 thumb-image: width: 150 height: 150 tracker-list: - 192.168.100.111:22122 - 192.168.100.112:22122ä½¿ç”¨æ¥å£æœå‹™å°Fdfsæœå‹™ç«¯é€²è¡Œæ“ä½œï¼Œä¸»è¦æ¥å£åŒ…æ‹¬ï¼šTrackerClient - TrackerServeræ¥å£GenerateStorageClient - ä¸€èˆ¬æ–‡ä»¶å­˜å„²æ¥å£ (StorageServeræ¥å£)FastFileStorageClient - ç‚ºæ–¹ä¾¿é …ç›®é–‹ç™¼é›†æˆçš„ç°¡å–®æ¥å£(StorageServeræ¥å£)AppendFileStorageClient - æ”¯æŒæ–‡ä»¶çºŒå‚³æ“ä½œçš„æ¥å£ (StorageServeræ¥å£)</pre><p>2.ä»£ç¢¼æ¸¬è©¦</p><pre>package com.maxbill;import com.github.tobato.fastdfs.FdfsClientConfig;import com.github.tobato.fastdfs.domain.fdfs.MetaData;import com.github.tobato.fastdfs.domain.fdfs.StorePath;import com.github.tobato.fastdfs.domain.proto.storage.DownloadByteArray;import com.github.tobato.fastdfs.service.FastFileStorageClient;import lombok.extern.log4j.Log4j2;import org.apache.commons.lang3.StringUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.annotation.Import;import org.springframework.stereotype.Component;import javax.annotation.PostConstruct;import java.io.File;import java.io.FileInputStream;import java.text.DateFormat;import java.text.SimpleDateFormat;import java.util.*;@Log4j2@Component@Import(FdfsClientConfig.class)public class FdfsClientUtil { private static final String BASE_URL = "http://192.168.100.110:8888/"; @Autowired private FastFileStorageClient storageClient; private static FdfsClientUtil fdfsClientUtil; @PostConstruct public void init() { fdfsClientUtil = this; } /** * æ–‡ä»¶ä¸Šå‚³ * * @param file æ–‡ä»¶ä¿¡æ¯ * @param infoMap æ–‡ä»¶æ“´å±•ä¿¡æ¯ * @return ä¸Šå‚³è·¯å¾‘ */ public static Map&lt;String, Object&gt; uploadFile(File file, Map&lt;String, String&gt; infoMap) { try { String fileName = file.getName(); String fileType = fileName.substring(fileName.lastIndexOf("\\") + 1); //String fileType = FilenameUtils.getExtension(file.getName()) log.info("[fdfs-upload]-start upload file ... "); log.info("[fdfs-upload]-request upload file name: {}", fileName); log.info("[fdfs-upload]-request upload file info: {}", infoMap); StorePath path = fdfsClientUtil.storageClient.uploadFile(new FileInputStream(file), file.length(), fileType, getMetaData(infoMap)); log.info("[fdfs-upload]-upload success path: {}", path.getFullPath()); return getResultMap(BASE_URL.concat(path.getFullPath()), null); } catch (Exception e) { log.error("[fdfs-upload]-upload file exception info: {}", e.getMessage()); return getResultMap(null, e.getMessage()); } } /** * ä¸‹è¼‰æ–‡ä»¶ * * @param filePath æ–‡ä»¶è·¯å¾‘æ¨™è­˜ * @return æ–‡ä»¶å­—ç¯€ */ public static Map&lt;String, Object&gt; downloadFile(String filePath) { try { filePath = filePath.replace(BASE_URL, ""); StorePath storePath = StorePath.parseFromUrl(filePath); String group = storePath.getGroup(); String path = storePath.getPath(); log.info("[fdfs-download]-start download file ... "); log.info("[fdfs-download]-request download file group: {}", group); log.info("[fdfs-download]-request download file path: {}", path); byte[] data = fdfsClientUtil.storageClient.downloadFile(group, path, new DownloadByteArray()); log.info("[fdfs-download]-request download file success ... "); return getResultMap(data, null); } catch (Exception e) { log.error("[fdfs-download]-download file exception info: {}", e.getMessage()); return getResultMap(null, e.getMessage()); } } /** * åˆªé™¤æ–‡ä»¶ * * @param filePath æ–‡ä»¶è·¯å¾‘æ¨™è­˜ * @return æ“ä½œçµæœ */ public static boolean deleteFile(String filePath) { try { filePath = filePath.replace(BASE_URL, ""); StorePath storePath = StorePath.parseFromUrl(filePath); String group = storePath.getGroup(); String path = storePath.getPath(); log.info("[fdfs-delete]-start delete file ... "); log.info("[fdfs-delete]-request delete file group: {}", group); log.info("[fdfs-delete]-request delete file path: {}", path); fdfsClientUtil.storageClient.deleteFile(storePath.getGroup(), storePath.getPath()); log.info("[fdfs-delete]-request delete file success ... "); return true; } catch (Exception e) { log.error("[fdfs-delete]-delete file exception info: {}", e.getMessage()); return false; } } /** * æŸ¥çœ‹æ–‡ä»¶å…ƒä¿¡æ¯ * * @param filePath æ–‡ä»¶è·¯å¾‘æ¨™è­˜ * @return æ–‡ä»¶ä¿¡æ¯ */ public static Map&lt;String, Object&gt; getFileInfo(String filePath) { try { filePath = filePath.replace(BASE_URL, ""); StorePath storePath = StorePath.parseFromUrl(filePath); String group = storePath.getGroup(); String path = storePath.getPath(); log.info("[fdfs-meta]-start meta file ... "); log.info("[fdfs-meta]-request meta file group: {}", group); log.info("[fdfs-meta]-request meta file path: {}", path); Map&lt;String, String&gt; infoMap = new HashMap&lt;&gt;(); infoMap.put("createPath", filePath); Set&lt;MetaData&gt; metaData = fdfsClientUtil.storageClient.getMetadata(storePath.getGroup(), storePath.getPath()); log.info("[fdfs-meta]-request meta file success ... "); if (null != metaData &amp;&amp; !metaData.isEmpty()) { metaData.forEach(meta -&gt; { infoMap.put(meta.getName(), meta.getValue()); }); } return getResultMap(infoMap, null); } catch (Exception e) { log.error("[fdfs-meta]-meta file exception info: {}", e.getMessage()); return getResultMap(null, e.getMessage()); } } /** * å°è£é™„ä»¶å…ƒä¿¡æ¯ * * @param infoMap è‡ªå®šç¾©æ•¸æ“š * @return é™„ä»¶å…ƒä¿¡æ¯ */ private static Set&lt;MetaData&gt; getMetaData(Map&lt;String, String&gt; infoMap) { if (null != infoMap &amp;&amp; !infoMap.isEmpty()) { Set&lt;MetaData&gt; metaDataSet = new HashSet&lt;&gt;(); for (String key : infoMap.keySet()) { metaDataSet.add(new MetaData(key, infoMap.get(key))); } return metaDataSet; } else { DateFormat df = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"); Set&lt;MetaData&gt; metaDataSet = new HashSet&lt;&gt;(); metaDataSet.add(new MetaData("createUser", "MaxBill")); metaDataSet.add(new MetaData("createDate", df.format(new Date()))); return metaDataSet; } } /** * å°è£çµæœä¿¡æ¯ * * @param data æ•¸æ“š * @param info ä¿¡æ¯ * @return æ“ä½œçµæœ */ private static Map&lt;String, Object&gt; getResultMap(Object data, String info) { Map&lt;String, Object&gt; resultMap = new HashMap&lt;&gt;(); if (StringUtils.isEmpty(info)) { resultMap.put("flag", true); resultMap.put("data", data); resultMap.put("info", "success"); } else { resultMap.put("flag", false); resultMap.put("info", info); resultMap.put("data", null); } return resultMap; }}</pre><p><br></p><p>ä¾†æºï¼šé–‹æºä¸­åœ‹</p><p>åŸæ–‡ï¼šhttps://my.oschina.net/zss1993/blog/3131684</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>ç³»çµ±</a></li><li><a>FastDFS</a></li><li><a>å®‰è£</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=æœç´¢>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>ğŸ”</button></form></section><section class=widget><h3 class=widget-title>æœ€æ–°æ–‡ç«  âš¡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/6a888def.html alt="æ¨è–¦åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ± FastDFS" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ec0369a50bef43748d07ab58f99b6056 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6a888def.html title="æ¨è–¦åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ± FastDFS">æ¨è–¦åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ± FastDFS</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/89d62274.html alt="FastDFS åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±è©³è§£" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f75efb8752b74ea384109115f7d8c4f6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/89d62274.html title="FastDFS åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±è©³è§£">FastDFS åˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±è©³è§£</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f9a6017f.html alt=ä¸€æ–‡æå®šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFS class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/c4fc524877574c51905170a1f43effdb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f9a6017f.html title=ä¸€æ–‡æå®šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFS>ä¸€æ–‡æå®šåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±FastDFS</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0bc3d310.html alt="æœ€è¿‘éƒ½èªªåƒâ€œå¾©æ´»â€äº†ä¸€èˆ¬ï¼ŒFastDFS 6.05 ç™¼ä½ˆï¼Œåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0bc3d310.html title="æœ€è¿‘éƒ½èªªåƒâ€œå¾©æ´»â€äº†ä¸€èˆ¬ï¼ŒFastDFS 6.05 ç™¼ä½ˆï¼Œåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±">æœ€è¿‘éƒ½èªªåƒâ€œå¾©æ´»â€äº†ä¸€èˆ¬ï¼ŒFastDFS 6.05 ç™¼ä½ˆï¼Œåˆ†ä½ˆå¼æ–‡ä»¶ç³»çµ±</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/11f7a1e.html alt=å¦‚ä½•ç”¨Uç›¤è‡ªå·±å®‰è£è¨ˆç®—æ©Ÿæ“ä½œç³»çµ±ï¼ˆæœ€è©³ç´°çš„æ–°æ‰‹DIYæ“ä½œæ‰‹å†Šï¼‰ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/703d742a-d309-4fe5-b886-2548c5fbee85 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/11f7a1e.html title=å¦‚ä½•ç”¨Uç›¤è‡ªå·±å®‰è£è¨ˆç®—æ©Ÿæ“ä½œç³»çµ±ï¼ˆæœ€è©³ç´°çš„æ–°æ‰‹DIYæ“ä½œæ‰‹å†Šï¼‰>å¦‚ä½•ç”¨Uç›¤è‡ªå·±å®‰è£è¨ˆç®—æ©Ÿæ“ä½œç³»çµ±ï¼ˆæœ€è©³ç´°çš„æ–°æ‰‹DIYæ“ä½œæ‰‹å†Šï¼‰</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e151d2c.html alt=å¦‚ä½•ç¡¬ç›¤å®‰è£ç³»çµ± class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b6cb8f7cd99c4927874577bdd60fe5e3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e151d2c.html title=å¦‚ä½•ç¡¬ç›¤å®‰è£ç³»çµ±>å¦‚ä½•ç¡¬ç›¤å®‰è£ç³»çµ±</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/832e28e.html alt=æ–°æ‰‹å¿…é ˆçŸ¥é“çš„æ“ä½œç³»çµ±çš„å®‰è£æ–¹æ³• class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/68f0ed227a2a482580c78d2a24e3cb7b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/832e28e.html title=æ–°æ‰‹å¿…é ˆçŸ¥é“çš„æ“ä½œç³»çµ±çš„å®‰è£æ–¹æ³•>æ–°æ‰‹å¿…é ˆçŸ¥é“çš„æ“ä½œç³»çµ±çš„å®‰è£æ–¹æ³•</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/08feb79.html alt=å®‰è£æ“ä½œç³»çµ±å¿…é ˆçš„ç¡¬ç›¤åˆ†å€çŸ¥è­˜ï¼Œä½ ç­è§£å¤šå°‘ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/d7ac9f5df37b45af956dd0f9a830d277 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/08feb79.html title=å®‰è£æ“ä½œç³»çµ±å¿…é ˆçš„ç¡¬ç›¤åˆ†å€çŸ¥è­˜ï¼Œä½ ç­è§£å¤šå°‘>å®‰è£æ“ä½œç³»çµ±å¿…é ˆçš„ç¡¬ç›¤åˆ†å€çŸ¥è­˜ï¼Œä½ ç­è§£å¤šå°‘</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d3bdf8e.html alt=æˆ¶ç”¨å…‰ä¼ç³»çµ±å®‰è£éç¨‹ä¸­çš„é—œéµé»å½™ç¸½ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d3bdf8e.html title=æˆ¶ç”¨å…‰ä¼ç³»çµ±å®‰è£éç¨‹ä¸­çš„é—œéµé»å½™ç¸½>æˆ¶ç”¨å…‰ä¼ç³»çµ±å®‰è£éç¨‹ä¸­çš„é—œéµé»å½™ç¸½</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4d24040.html alt=æ¶²å£“ç³»çµ±å›æ²¹ç®¡çš„å®‰è£ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/9ec10809204347a0b835e43f0fed4f35 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4d24040.html title=æ¶²å£“ç³»çµ±å›æ²¹ç®¡çš„å®‰è£>æ¶²å£“ç³»çµ±å›æ²¹ç®¡çš„å®‰è£</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/98b788e.html alt=Linuxç³»çµ±å®‰è£å¤šå€‹æ¡Œé¢ç’°å¢ƒæœ‰å¹«åŠ©å—ï¼Ÿ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ffd1b067fd4f4d45bc9c2bf098a7ed4b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/98b788e.html title=Linuxç³»çµ±å®‰è£å¤šå€‹æ¡Œé¢ç’°å¢ƒæœ‰å¹«åŠ©å—ï¼Ÿ>Linuxç³»çµ±å®‰è£å¤šå€‹æ¡Œé¢ç’°å¢ƒæœ‰å¹«åŠ©å—ï¼Ÿ</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/d67e059.html alt=é›»å­ç³»çµ±çš„å®‰è£ã€èª¿è©¦æ–¹æ³• class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/206a1353-8c17-4799-ba5b-adcdabc7aff5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/d67e059.html title=é›»å­ç³»çµ±çš„å®‰è£ã€èª¿è©¦æ–¹æ³•>é›»å­ç³»çµ±çš„å®‰è£ã€èª¿è©¦æ–¹æ³•</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ea18613.html alt=æˆ‘è¢«å®‰è£äº†è²§çª®ç‰ˆâ€œæ“ä½œç³»çµ±â€ï¼Œé›£æ€ªè¶ŠåŠªåŠ›ã€è¶Šè²§çª®ï¼ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/8d9f5303-2ba0-478e-9525-01eb09914e16 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ea18613.html title=æˆ‘è¢«å®‰è£äº†è²§çª®ç‰ˆâ€œæ“ä½œç³»çµ±â€ï¼Œé›£æ€ªè¶ŠåŠªåŠ›ã€è¶Šè²§çª®ï¼>æˆ‘è¢«å®‰è£äº†è²§çª®ç‰ˆâ€œæ“ä½œç³»çµ±â€ï¼Œé›£æ€ªè¶ŠåŠªåŠ›ã€è¶Šè²§çª®ï¼</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9b12202.html alt=ä¸­å¤®é™¤å¡µç³»çµ±çš„å®‰è£æ³¨æ„äº‹é …å¤§è©³è§£ï¼Œä¸­å¤®é™¤å¡µç³»çµ±çŸ¥è­˜è¦çŸ¥é“ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/154031713807410963a6e06 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9b12202.html title=ä¸­å¤®é™¤å¡µç³»çµ±çš„å®‰è£æ³¨æ„äº‹é …å¤§è©³è§£ï¼Œä¸­å¤®é™¤å¡µç³»çµ±çŸ¥è­˜è¦çŸ¥é“>ä¸­å¤®é™¤å¡µç³»çµ±çš„å®‰è£æ³¨æ„äº‹é …å¤§è©³è§£ï¼Œä¸­å¤®é™¤å¡µç³»çµ±çŸ¥è­˜è¦çŸ¥é“</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/041eb04f.html alt=é˜¿é‡Œé›²æœå‹™å™¨å¿«é€Ÿå»ºç¶²ç«™_å®‰è£BTå¯¶å¡”é¢æ¿å’Œwordpress class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/f2aaf81828344428b39b2102e2a62c2a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/041eb04f.html title=é˜¿é‡Œé›²æœå‹™å™¨å¿«é€Ÿå»ºç¶²ç«™_å®‰è£BTå¯¶å¡”é¢æ¿å’Œwordpress>é˜¿é‡Œé›²æœå‹™å™¨å¿«é€Ÿå»ºç¶²ç«™_å®‰è£BTå¯¶å¡”é¢æ¿å’Œwordpress</a></li><hr></ul></section><section class=widget><h3 class=widget-title>å…¶ä»–</h3><ul class=widget-list><li><a href=TOS.html>ä½¿ç”¨æ¢æ¬¾</a></li><li><a href=CommentPolicy.html>ç•™è¨€æ”¿ç­–</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>è¯çµ¡æˆ‘å€‘</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>æå®¢å¿«è¨Š</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>