<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>python詞法作用域和動態作用域 | 极客快訊</title><meta property="og:title" content="python詞法作用域和動態作用域 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/dfic-imagehandler/ca259624-7126-44b3-a451-29f178fdb11d"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ffd0e657.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ffd0e657.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ffd0e657.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ffd0e657.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ffd0e657.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ffd0e657.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e7%a7%91%e6%8a%80/ffd0e657.html><link rel=canonical href=https://geekbank.cf/tw/%e7%a7%91%e6%8a%80/ffd0e657.html><meta property="article:published_time" content="2020-11-14T21:00:34+08:00"><meta property="article:modified_time" content="2020-11-14T21:00:34+08:00"><meta name=Keywords content><meta name=description content="python詞法作用域和動態作用域"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E7%A7%91%E6%8A%80/ffd0e657.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>python詞法作用域和動態作用域</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E7%A7%91%E6%8A%80.html>科技</a></span></div><div class=post-content><div><div class=pgc-img><img alt=python詞法作用域和動態作用域 onerror=errorimg.call(this); src=https://p3.pstatp.com/large/dfic-imagehandler/ca259624-7126-44b3-a451-29f178fdb11d><p class=pgc-img-caption></p></div><p>不管什麼語言，我們總要學習作用域(或生命週期)的概念，比如常見的稱呼：全局變量、包變量、模塊變量、本地變量、局部變量等等。不管如何稱呼這些作用域的範圍，實現它們的目的都一樣：</p><ol><li>為了避免名稱衝突;</li><li>為了限定變量的生命週期(本文以變量名說事，其它的名稱在規則上是一樣的)。</li></ol><p>但是不同語言的作用域規則不一樣，雖然學個簡單的基礎就足夠應用，因為我們有編程規範：</p><ol><li>儘量避免名稱衝突;</li><li>加上類似於local的修飾符儘量縮小生效範圍;</li><li>放進代碼塊，等等。</li></ol><p>但是真正去細心驗證作用域的生效機制卻並非易事(我學Python的時候，花了很長時間細細驗證，學perl的時候又花了很長時間細細驗證)，但可以肯定的是，理解本文的詞法作用域規則(Lexical scoping)和動態作用域規則(dynamic scoping)，對學習任何語言的作用域規則都有很大幫助，這兩個規則是各種語言都宏觀通用的。</p><p>很簡單的一段bash下的代碼：</p><pre>1 x=12 function g(){ echo "g: $x" ; x=2; }3 function f(){ local x=3 ; g; echo "f: $x"; } # 輸出2還是34 f # 輸出1還是3？5 echo $x # 輸出1還是2？</pre><p>對於bash來說，上面輸出的分別是3(g函數中echo)、2(f函數中的echo)和1(最後一行echo)。但是同樣語義的代碼在其它語言下得到的結果可能就不一樣(分別輸出1、3和2，例如perl中將local替換為my)。</p><p>這牽扯到兩種貫穿所有程序語言的作用域概念：<strong>詞法作用域(類似於C語言中static)和動態作用域</strong>。詞法作用域和"詞法"這個詞真的沒什麼關係，反而更應該稱之為"文本段作用域"。要區別它們，只需要回答"函數out_func中嵌套的內層函數in_func能否看見out_func中的環境"。</p><p>對於上面的bash代碼來說，假如這段代碼是適用於所有語言的偽代碼：</p><ul><li>對於詞法作用域的語言，執行f時會調用g，<strong>g將無法訪問f文本段的變量，詞法作用域認為g並不是f的一部分，而是跳出f的，因為g的定義文本段是在全局範圍內的，所以它是全局文本段的一部分。如果函數g的定義文本段是在f內部，則g屬於f文本段的一部分</strong>。</li><li class=ql-indent-1>所以g不知道f文本段中local x=3的設置，於是g的echo會輸出全局變量x=1，然後設置x=2，因為它沒有加上作用域修飾符，而g又是全局內的函數，所以x將修改全局作用域的x值，使得最後的echo輸出2，而f中的echo則輸出它自己文本段中的local x=3。所以整個流程輸出1 3 2</li><li>對於動態作用域的語言，執行f時會調用g，<strong>g將可以訪問f文本中的變量，動態作用域認為g是f文本段的一部分，是f中的嵌套函數</strong>。</li><li class=ql-indent-1>所以g能看到local x=3的設置，所以g的echo會輸出3。g中設置x=2後，僅僅只是在f的內層嵌套函數中設置，所以x=2對g文本段和f文本段(因為g是f的一部分)都可見，但對f文本段外部不可見，所以f中的echo輸出2，最後一行的echo輸出1。所以整個流程輸出3 2 1</li><li>總結來說：</li><li class=ql-indent-1><strong>詞法作用域是關聯在編譯期間的，對於函數來說就是函數的定義文本段的位置決定這個函數所屬的範圍</strong>。</li><li class=ql-indent-1><strong>動態作用域是關聯在程序執行期間的，對於函數來說就是函數執行的位置決定這個函數所屬的範圍</strong>。</li></ul><p>由於bash實現的是動態作用域規則。所以，輸出的是3 2 1。對於perl來說，my修飾符實現詞法作用域規則，local修飾符實現動態作用域規則。</p><p>例如，使用my修飾符的perl程序：</p><pre>1 #!/usr/bin/perl23 $x=1;4 sub g { print "g: $x\n"; $x=2; }5 sub f { my $x=3; g(); print "f: $x\n"; } # 詞法作用域6 f(); 7 print "$x\n"; </pre><p>執行結果：</p><pre>1 [fairy@fairy:/perlapp]$ perl scope2.pl 2 g: 13 f: 34 2</pre><p>使用local修飾符的perl程序：</p><pre>1 #!/usr/bin/perl23 $x=1;4 sub g { print "g: $x\n"; $x=2; }5 sub f { local $x=3; g(); print "f: $x\n"; } # 動態作用域6 f(); 7 print "$x\n"; </pre><p>執行結果：</p><pre>1 [fairy@fairy:/perlapp]$ perl scope2.pl 2 g: 33 f: 24 1</pre><p>有些語言只支持一種作用域規則，特別是那些比較現代化的語言，而有些語言支持兩種作用域規則(正如perl語言，my實現詞法變量作用域規則，local實現動態作用域規則)。</p><p>相對來說，詞法作用域規則比較好控制整個流程，還能借此實現更豐富的功能(如最典型的"閉包"以及高階函數)，而動態作用域由於讓變量生命週期"沒有任何深度"(回想一下shell腳本對函數和作用域的控制，非常傻瓜化)，比較少應用上，甚至有些語言根本不支持動態作用域。</p><p><strong>覺得文章還不錯的話不妨點個贊，有任何建議或看法歡迎大家在評論區分享討論！</strong></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>作用域</a></li><li><a>python</a></li><li><a>詞法</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/aac90270.html alt=什麼是作用域？什麼是詞法作用域？什麼是作用域鏈？一張圖搞定 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/84298ca6-295b-41eb-bf1a-75463b37b8ab style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/aac90270.html title=什麼是作用域？什麼是詞法作用域？什麼是作用域鏈？一張圖搞定>什麼是作用域？什麼是詞法作用域？什麼是作用域鏈？一張圖搞定</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f8c3b92d.html alt=python安全開發軍規之四：使用安全的隨機數生成器 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bbda123b84db44148aca9d3e26ddf119 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f8c3b92d.html title=python安全開發軍規之四：使用安全的隨機數生成器>python安全開發軍規之四：使用安全的隨機數生成器</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e27caade.html alt=python基礎知識，多態實例講解以及多態的作用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/2506d9fe7f6641a6a12c35a35a9335db style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e27caade.html title=python基礎知識，多態實例講解以及多態的作用>python基礎知識，多態實例講解以及多態的作用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c56ee116.html alt=小猿圈python學習-三大特性之多態 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ad0e8e3777854337abeb7c779ad79a04 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c56ee116.html title=小猿圈python學習-三大特性之多態>小猿圈python學習-三大特性之多態</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2a403db5.html alt=教你用python爬取自己加入的QQ群成員名單，它們竟然是這樣的人 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f99591661318437ca58c24bce4d3c5bb style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2a403db5.html title=教你用python爬取自己加入的QQ群成員名單，它們竟然是這樣的人>教你用python爬取自己加入的QQ群成員名單，它們竟然是這樣的人</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/01920188.html alt=python乾貨｜python多進程併發 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/153075082008107d9bdbb84 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/01920188.html title=python乾貨｜python多進程併發>python乾貨｜python多進程併發</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d7504b3a.html alt=python併發編程：進程的創建和結束 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d7504b3a.html title=python併發編程：進程的創建和結束>python併發編程：進程的創建和結束</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6221fc43.html alt=python入門技能：併發編程之多進程 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/876b9b75cb7d413cab99ea1cc2303b75 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6221fc43.html title=python入門技能：併發編程之多進程>python入門技能：併發編程之多進程</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6a6bffe7.html alt=簡單使用python多進程併發下載大量圖片 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1539696513135d6d300d7f0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6a6bffe7.html title=簡單使用python多進程併發下載大量圖片>簡單使用python多進程併發下載大量圖片</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/589021d3.html alt=python之函數的參數詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/589021d3.html title=python之函數的參數詳解>python之函數的參數詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0ab2e80b.html alt=python一些常見的文件操作 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0ab2e80b.html title=python一些常見的文件操作>python一些常見的文件操作</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b0f5ec7e.html alt=小猿圈python學習-字符編碼之文字是如何顯示的 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/1251374d9bbe4e5689cfac50c0a5dab4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b0f5ec7e.html title=小猿圈python學習-字符編碼之文字是如何顯示的>小猿圈python學習-字符編碼之文字是如何顯示的</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/521bc355.html alt=最近很火的文章自動生成器，python源碼公開了（內附python代碼） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/ad825257-b4c7-4ade-881e-1137b0ed08bd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/521bc355.html title=最近很火的文章自動生成器，python源碼公開了（內附python代碼）>最近很火的文章自動生成器，python源碼公開了（內附python代碼）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7e432d3d.html alt=python滲透庫大集合 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/31d04c5999934cc694ffe8a7e279d13e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7e432d3d.html title=python滲透庫大集合>python滲透庫大集合</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/992fc5cb.html alt=python怎麼統計txt文件的字數 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/c7073b5396334cfb8fbdadd7fc1fbb5c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/992fc5cb.html title=python怎麼統計txt文件的字數>python怎麼統計txt文件的字數</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>