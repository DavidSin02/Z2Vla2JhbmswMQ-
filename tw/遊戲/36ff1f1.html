<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>有關Spring事務，看這一篇就足夠了 | 极客快訊</title><meta property="og:title" content="有關Spring事務，看這一篇就足夠了 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="http://p1.pstatp.com/large/pgc-image/82ef9adc02ab44258403653c42dda8f4"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/36ff1f1.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/36ff1f1.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/36ff1f1.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/36ff1f1.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/36ff1f1.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/36ff1f1.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/36ff1f1.html><link rel=canonical href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/36ff1f1.html><meta property="article:published_time" content="2020-10-29T20:46:29+08:00"><meta property="article:modified_time" content="2020-10-29T20:46:29+08:00"><meta name=Keywords content><meta name=description content="有關Spring事務，看這一篇就足夠了"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E9%81%8A%E6%88%B2/36ff1f1.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>有關Spring事務，看這一篇就足夠了</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E9%81%8A%E6%88%B2.html>遊戲</a></span></div><div class=post-content><div><p>本文將按照聲明式事務的五個特性進行介紹：</p><ol><li>事務傳播機制</li><li>事務隔離機制</li><li>只讀</li><li>事務超時</li><li>回滾規則</li></ol><h1><strong>Spring事務傳播機制</strong></h1><p><strong>事務的特性</strong></p><ul><li>原子性（Atomicity）：事務是一個原子操作，由一系列動作組成。事務的原子性確保動作要麼全部完成，要麼完全不起作用。</li><li>一致性（Consistency）：一旦事務完成（不管成功還是失敗），系統必須確保它所建模的業務處於一致的狀態，而不會是部分完成部分失敗。在現實中的數據不應該被破壞。</li><li>隔離性（Isolation）：可能有許多事務會同時處理相同的數據，因此每個事務都應該與其他事務隔離開來，防止數據損壞。</li><li>持久性（Durability）：一旦事務完成，無論發生什麼系統錯誤，它的結果都不應該受到影響，這樣就能從任何系統崩潰中恢復過來。通常情況下，事務的結果被寫到持久化存儲器中。</li></ul><p><strong>Spring事務的配置方式</strong></p><p>Spring支持編程式事務管理以及聲明式事務管理兩種方式。</p><p><strong>1. 編程式事務管理</strong></p><p>編程式事務管理是侵入性事務管理，使用TransactionTemplate或者直接使用PlatformTransactionManager，對於編程式事務管理，Spring推薦使用TransactionTemplate。</p><p><strong>2. 聲明式事務管理</strong></p><p>聲明式事務管理建立在AOP之上，其本質是對方法前後進行攔截，然後在目標方法開始之前創建或者加入一個事務，執行完目標方法之後根據執行的情況提交或者回滾。</p><p>編程式事務每次實現都要單獨實現，但業務量大功能複雜時，使用編程式事務無疑是痛苦的，而聲明式事務不同，聲明式事務屬於無侵入式，不會影響業務邏輯的實現，只需要在配置文件中做相關的事務規則聲明或者通過註解的方式，便可以將事務規則應用到業務邏輯中。</p><p>顯然聲明式事務管理要優於編程式事務管理，這正是Spring倡導的非侵入式的編程方式。唯一不足的地方就是聲明式事務管理的粒度是方法級別，而編程式事務管理是可以到代碼塊的，但是可以通過提取方法的方式完成聲明式事務管理的配置。</p><p><strong>Spring事務的傳播機制</strong></p><p>事務的傳播性一般用在事務嵌套的場景，比如一個事務方法裡面調用了另外一個事務方法，那麼兩個方法是各自作為獨立的方法提交還是內層的事務合併到外層的事務一起提交，這就是需要事務傳播機制的配置來確定怎麼樣執行。</p><p>常用的事務傳播機制如下：</p><ul><li>PROPAGATION_REQUIRED</li><li>Spring默認的傳播機制，能滿足絕大部分業務需求，如果外層有事務，則當前事務加入到外層事務，一塊提交，一塊回滾。如果外層沒有事務，新建一個事務執行</li><li>PROPAGATION_REQUES_NEW</li><li>該事務傳播機制是每次都會新開啟一個事務，同時把外層事務掛起，噹噹前事務執行完畢，恢復上層事務的執行。如果外層沒有事務，執行當前新開啟的事務即可</li><li>PROPAGATION_SUPPORT</li><li>如果外層有事務，則加入外層事務，如果外層沒有事務，則直接使用非事務方式執行。完全依賴外層的事務</li><li>PROPAGATION_NOT_SUPPORT</li><li>該傳播機制不支持事務，如果外層存在事務則掛起，執行完當前代碼，則恢復外層事務，無論是否異常都不會回滾當前的代碼</li><li>PROPAGATION_NEVER</li><li>該傳播機制不支持外層事務，即如果外層有事務就拋出異常</li><li>PROPAGATION_MANDATORY</li><li>與NEVER相反，如果外層沒有事務，則拋出異常</li><li>PROPAGATION_NESTED</li><li>該傳播機制的特點是可以保存狀態保存點，當前事務回滾到某一個點，從而避免所有的嵌套事務都回滾，即各自回滾各自的，如果子事務沒有把異常吃掉，基本還是會引起全部回滾的。</li></ul><blockquote><p>傳播規則回答了這樣一個問題：一個新的事務應該被啟動還是被掛起，或者是一個方法是否應該在事務性上下文中運行。</p></blockquote><h1><strong>Spring事務的隔離級別</strong></h1><p>事務的隔離級別定義一個事務可能受其他併發務活動活動影響的程度，可以把事務的隔離級別想象為這個事務對於<span>事物處理</span>數據的自私程度。</p><p>在一個典型的應用程序中，多個事務同時運行，經常會為了完成他們的工作而操作同一個數據。併發雖然是必需的，但是會導致以下問題：</p><ol><li>髒讀（Dirty read）</li><li>髒讀發生在一個事務讀取了被另一個事務改寫但尚未提交的數據時。如果這些改變在稍後被回滾了，那麼第一個事務讀取的數據就會是無效的。</li><li>不可重複讀（Nonrepeatable read）</li><li>不可重複讀發生在一個事務執行相同的查詢兩次或兩次以上，但每次查詢結果都不相同時。這通常是由於另一個併發事務在兩次查詢之間更新了數據。</li></ol><blockquote><p>不可重複讀重點在修改。</p></blockquote><ol><li>幻讀（Phantom reads）</li><li>幻讀和不可重複讀相似。當一個事務（T1）讀取幾行記錄後，另一個併發事務（T2）插入了一些記錄時，幻讀就發生了。在後來的查詢中，第一個事務（T1）就會發現一些原來沒有的額外記錄。</li></ol><blockquote><p>幻讀重點在新增或刪除。</p></blockquote><p>在理想狀態下，事務之間將完全隔離，從而可以防止這些問題發生。然而，完全隔離會影響性能，因為隔離經常涉及到鎖定在數據庫中的記錄（甚至有時是鎖表）。完全隔離要求事務相互等待來完成工作，會阻礙併發。因此，可以根據業務場景選擇不同的隔離級別。</p><div class=pgc-img><img alt=有關Spring事務，看這一篇就足夠了 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/82ef9adc02ab44258403653c42dda8f4><p class=pgc-img-caption></p></div><h1><strong>只讀</strong></h1><p>如果一個事務只對數據庫執行讀操作，那麼該數據庫就可能利用那個事務的只讀特性，採取某些優化措施。通過把一個事務聲明為只讀，可以給後端數據庫一個機會來應用那些它認為合適的優化措施。由於只讀的優化措施是在一個事務啟動時由後端數據庫實施的， 因此，只有對於那些具有可能啟動一個新事務的傳播行為（PROPAGATION_REQUIRES_NEW、PROPAGATION_REQUIRED、 ROPAGATION_NESTED）的方法來說，將事務聲明為只讀才有意義。</p><h1><strong>事務超時</strong></h1><p>為了使一個應用程序很好地執行，它的事務不能運行太長時間。因此，聲明式事務的下一個特性就是它的超時。</p><p>假設事務的運行時間變得格外的長，由於事務可能涉及對數據庫的鎖定，所以長時間運行的事務會不必要地佔用數據庫資源。這時就可以聲明一個事務在特定秒數後自動回滾，不必等它自己結束。</p><p>由於超時時鐘在一個事務啟動的時候開始的，因此，只有對於那些具有可能啟動一個新事務的傳播行為（PROPAGATION_REQUIRES_NEW、PROPAGATION_REQUIRED、ROPAGATION_NESTED）的方法來說，聲明事務超時才有意義。</p><h1><strong>回滾規則</strong></h1><p>在默認設置下，事務只在出現運行時異常（runtime exception）時回滾，而在出現受檢查異常（checked exception）時不回滾（這一行為和EJB中的回滾行為是一致的）。</p><p>不過，可以聲明在出現特定受檢查異常時像運行時異常一樣回滾。同樣，也可以聲明一個事務在出現特定的異常時不回滾，即使特定的異常是運行時異常。</p><h1><strong>Spring聲明式事務配置參考</strong></h1><p>事物配置中有哪些屬性可以配置?以下只是簡單的使用參考</p><p>1.事務的傳播性：</p><p>@Transactional(propagation=Propagation.REQUIRED)</p><p>2.事務的隔離級別：</p><p>@Transactional(isolation = Isolation.READ_UNCOMMITTED)</p><blockquote><p>讀取未提交數據(會出現髒讀, 不可重複讀) 基本不使用</p></blockquote><p>3.只讀：</p><p>@Transactional(readOnly=true)</p><p>該屬性用於設置當前事務是否為只讀事務，設置為true表示只讀，false則表示可讀寫，默認值為false。</p><p>4.事務的超時性：</p><p>@Transactional(timeout=30)</p><p>5.回滾：</p><p>指定單一異常類：@Transactional(rollbackFor=RuntimeException.class)</p><p>指定多個異常類：@Transactional(rollbackFor={RuntimeException.class, Exception.class})</p><blockquote><p>該屬性用於設置需要進行回滾的異常類數組，當方法中拋出指定異常數組中的異常時，則進行事務回滾。</p></blockquote></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>有關</a></li><li><a>Spring</a></li><li><a>事務</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/090306a0.html alt="[Spring] 深入瞭解事務原理" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/a8c6dbd7c51741f5a76262e8e2c7a670 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/090306a0.html title="[Spring] 深入瞭解事務原理">[Spring] 深入瞭解事務原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fb2bc471.html alt="「譯」 Spring 的分佈式事務實現—使用和不使用 XA—第二部分" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fb2bc471.html title="「譯」 Spring 的分佈式事務實現—使用和不使用 XA—第二部分">「譯」 Spring 的分佈式事務實現—使用和不使用 XA—第二部分</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1678b1c4.html alt=（收藏）Spring事務專題：事務的基本概念，Mysql事務處理原理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/433259b5-1936-4cee-ab74-70aef36536ee style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1678b1c4.html title=（收藏）Spring事務專題：事務的基本概念，Mysql事務處理原理>（收藏）Spring事務專題：事務的基本概念，Mysql事務處理原理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d3c48fcc.html alt=Spring聲明式事務處理的實現原理，來自面試官的窮追拷問 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d3c48fcc.html title=Spring聲明式事務處理的實現原理，來自面試官的窮追拷問>Spring聲明式事務處理的實現原理，來自面試官的窮追拷問</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dcf7d4b4.html alt="Spring事務失效的 8 大原因，這次可以吊打面試官了" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dcf7d4b4.html title="Spring事務失效的 8 大原因，這次可以吊打面試官了">Spring事務失效的 8 大原因，這次可以吊打面試官了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/9fda6a1.html alt=Spring事務的三個坑，你踩過幾個呢？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/a9ecbb60-4a8e-42b9-98f4-a8925075f9b3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9fda6a1.html title=Spring事務的三個坑，你踩過幾個呢？>Spring事務的三個坑，你踩過幾個呢？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b748ad6.html alt="使用Spring Boot的事件和事務，容易被忽視的點，你有踩過嗎？" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/ae11deaa7ce44232a1fa67b224125bb2 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b748ad6.html title="使用Spring Boot的事件和事務，容易被忽視的點，你有踩過嗎？">使用Spring Boot的事件和事務，容易被忽視的點，你有踩過嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/65c5ac44.html alt=跟新型冠狀病毒有關的10個謠言，別被騙了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/8d29a0c1-76c9-462f-93a3-12ac1fb91bb1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/65c5ac44.html title=跟新型冠狀病毒有關的10個謠言，別被騙了>跟新型冠狀病毒有關的10個謠言，別被騙了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/000afa08.html alt="Spring Boot 2.x基礎教程：Swagger接口分類與各元素排序問題詳解" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/daa2cfd29ec34306a4be6f3f257b824b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/000afa08.html title="Spring Boot 2.x基礎教程：Swagger接口分類與各元素排序問題詳解">Spring Boot 2.x基礎教程：Swagger接口分類與各元素排序問題詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0be408a4.html alt="MySQL 事務處理" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0be408a4.html title="MySQL 事務處理">MySQL 事務處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8a538d3c.html alt=MySQL——事務(Transaction)詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/29d4c92c9c2344838eb72ef948cf08fa style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8a538d3c.html title=MySQL——事務(Transaction)詳解>MySQL——事務(Transaction)詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3269d080.html alt=MySQL數據庫的事務管理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/152203544367254a708f807 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3269d080.html title=MySQL數據庫的事務管理>MySQL數據庫的事務管理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8293e598.html alt=MySQl事務最全詳解 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/c61163c863114226b14bb3760da19e4d style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8293e598.html title=MySQl事務最全詳解>MySQl事務最全詳解</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/011d2da0.html alt=MySql併發與事務的處理 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/f13d8a1e-5e60-4b48-90bc-3c26e312a208 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/011d2da0.html title=MySql併發與事務的處理>MySql併發與事務的處理</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4ab1dd0d.html alt=Mysql事務 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4ab1dd0d.html title=Mysql事務>Mysql事務</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>