<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>分佈式服務架構一致性保障，就這六招搞定所有問題【架構師清單】 | 极客快訊</title><meta property="og:title" content="分佈式服務架構一致性保障，就這六招搞定所有問題【架構師清單】 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="http://p1.pstatp.com/large/pgc-image/178f87e319d040e0a8b7b842f13ec37b"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/42ba646.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/42ba646.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/42ba646.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/42ba646.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/42ba646.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/42ba646.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/42ba646.html><link rel=canonical href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/42ba646.html><meta property="article:published_time" content="2020-10-29T20:46:28+08:00"><meta property="article:modified_time" content="2020-10-29T20:46:28+08:00"><meta name=Keywords content><meta name=description content="分佈式服務架構一致性保障，就這六招搞定所有問題【架構師清單】"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E9%81%8A%E6%88%B2/42ba646.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>分佈式服務架構一致性保障，就這六招搞定所有問題【架構師清單】</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E9%81%8A%E6%88%B2.html>遊戲</a></span></div><div class=post-content><div><h1>1 背景</h1><p>一致性是一個抽象的、具有多重含義的計算機術語，在不同應用場景下，有不同的定義和含義。在傳統的IT時代，一致性通常指強一致性，強一致性通常體現在你中有我、我中有你、渾然一體；</p><p>但現在這樣的一個互聯網的時代和環境，一致性又增加了新的屬性，分佈式服務化系統之間的弱一致性，包括應用系統一致性和數據一致性，最終一致性。</p><p>本文根據作者在互聯網項目中的實際經驗，對服務化系統中最難解決的一致性問題進行研究和探討，試圖從實踐經驗中找到規律，抽象出模式，希望能幫助大家徹底理解一致性的本質，並能將其應用到實踐，解決讀者現實中遇到的服務化系統的一致性問題。</p><blockquote>歡迎關注筆者，優質文章都在這裡等你。</blockquote><h1>2 問題</h1><p>本節列舉不一致會導致的種種問題，這也包括一例生活中的問題。</p><p><strong>案例1：買房</strong></p><p>假如你想要享受生活的隨意，只想買個兩居，不想讓房貸有太大壓力，而你媳婦卻想要買個三居，還得帶花園的，那麼你們就不一致了，不一致導致生活不愉快、不協調，嚴重情況下還會吵架，可見生活中的不一致問題影響很大。</p><p><strong>案例2：轉賬</strong></p><p>轉賬是經典的不一致案例，設想一下銀行為你處理一筆轉賬，扣減你賬戶上的餘額，然後增加別人賬戶的餘額；如果扣減你的賬戶餘額成功，增加別人賬戶餘額失敗，那麼你就會損失這筆資金。反過來，如果扣減你的賬戶餘額失敗，增加別人賬戶餘額成功，那麼銀行就會損失這筆資金，銀行需要賠付。對於資金處理系統來說，上面任何一種場景都是不允許發生的，一旦發生就會有資金損失，後果是不堪設想的，嚴重情況會讓一個公司瞬間倒閉，可參考案例。</p><p><strong>案例3：下訂單和扣庫存</strong></p><p>電商系統中也有一個經典的案例，下訂單和扣庫存如何保持一致，如果先下訂單，扣庫存失敗，那麼將會導致超賣；如果下訂單沒有成功，扣庫存成功，那麼會導致少賣。兩種情況都會導致運營成本的增加，嚴重情況下需要賠付。</p><p><strong>案例4：同步超時</strong></p><p>服務化的系統間調用常常因為網絡問題導致系統間調用超時，即使是網絡很好的機房，在億次流量的基數下，同步調用超時也是家常便飯。系統A同步調用系統B超時，系統A可以明確得到超時反饋，但是無法確定系統B是否已經完成了預定的功能或者沒有完成預定的功能。於是，系統A就迷茫了，不知道應該繼續做什麼，如何反饋給使用方。（曾經的一個B2B產品的客戶要求接口超時重新通知他們，這個在技術上是難以實現的，因為服務器本身可能並不知道自己超時，可能會繼續正常的返回數據，只是客戶端並沒有接受到結果罷了，因此這不是一個合理的解決方案）。</p><p><strong>案例5：異步回調超時</strong></p><p>此案例和上一個同步超時案例類似，不過這個場景使用了異步回調，系統A同步調用系統B發起指令，系統B採用受理模式，受理後則返回受理成功，然後系統B異步通知系統A。在這個過程中，如果系統A由於某種原因遲遲沒有收到回調結果，那麼兩個系統間的狀態就不一致，互相認知不同會導致系統間發生錯誤，嚴重情況下會影響核心事務，甚至會導致資金損失。</p><p><strong>案例6：掉單</strong></p><p>分佈式系統中，兩個系統協作處理一個流程，分別為對方的上下游，如果一個系統中存在一個請求，通常指訂單，另外一個系統不存在，則導致掉單，掉單的後果很嚴重，有時候也會導致資金損失。</p><p><strong>案例7：系統間狀態不一致</strong></p><p>這個案例與上面掉單案例類似，不同的是兩個系統間都存在請求，但是請求的狀態不一致。</p><p><strong>案例8：緩存和數據庫不一致</strong></p><p>交易相關係統基本離不開關係型數據庫，依賴關係型數據庫提供的ACID特性（後面介紹），但是在大規模高併發的互聯網系統裡，一些特殊的場景對讀的性能要求極高，服務於交易的數據庫難以抗住大規模的讀流量，通常需要在數據庫前墊緩存，那麼緩存和數據庫之間的數據如何保持一致性？是要保持強一致呢還是弱一致性呢？</p><p><strong>案例9：本地緩存節點間不一致</strong></p><p>一個服務池上的多個節點為了滿足較高的性能需求，需要使用本地緩存，使用了本地緩存，每個節點都會有一份緩存數據的拷貝，如果這些數據是靜態的、不變的，那永遠都不會有問題，但是如果這些數據是半靜態的或者常被更新的，當被更新的時候，各個節點更新是有先後順序的，在更新的瞬間，各個節點的數據是不一致的，如果這些數據是為某一個開關服務的，想象一下重複的請求走進了不同的節點（在failover或者補償導致的場景下，重複請求是一定會發生的，也是服務化系統必須處理的），一個請求走了開關打開的邏輯，同時另外一個請求走了開關關閉的邏輯，這導致請求被處理兩次，最壞的情況下會導致災難性的後果，就是資金損失。</p><p><strong>案例10：緩存數據結構不一致</strong></p><p>這個案例會時有發生，某系統需要種某一數據結構的緩存，這一數據結構有多個數據元素組成，其中，某個數據元素都需要從數據庫中或者服務中獲取，如果一部分數據元素獲取失敗，由於程序處理不正確，仍然將不完全的數據結構存入緩存，那麼緩存的消費者消費的時候很有可能因為沒有合理處理異常情況而出錯。</p><h1>3 模式</h1><h1>3.1 生活中不一致問題的解決</h1><p>大家回顧一下上一節列舉的生活中的案例1-買房，如果置身事外來看，解決這種不一致的辦法有兩個，一個是避免不一致的發生，如果已經是媳婦了就不好辦了:)，還有一種方法就是慢慢的補償，先買個兩居，然後慢慢的等資金充裕了再換三居，買比特幣賺了再換帶花園的房子，於是問題最終被解決了，最終大家處於一致的狀態，都開心了。這樣可以解決案例1的問題，很自然由於有了過渡的方法，問題在不經意間就消失了，可見“過渡”也是解決一致性問題的一個模式。</p><p>從案例1的解決方案來看，我們要解決一致性問題，一個最直接最簡單的方法就是保持強一致性，對於案例1的情況，儘量避免在結婚前兩個人能夠互相瞭解達成一致，避免不一致問題的發生；不過有些事情事已至此，發生了就是發生了，出現了不一致的問題，我們應該考慮去補償，盡最大的努力從不一致狀態修復到一致狀態，避免損失全部或者一部分，也不失為一個好方法。</p><p>因此，避免不一致是上策，出現了不一致及時發現及時修復是中策，有問題不積極解決留給他人解決是下策。</p><h1>3.2 酸鹼平衡理論</h1><p>ACID在英文中的意思是“酸”，BASE的意識是“鹼”，這一段講的是“酸鹼平衡”的故事。</p><h1>1. ACID（酸）</h1><p>如何保證強一致性呢？計算機專業的童鞋在學習關係型數據庫的時候都學習了ACID原理，這裡對ACID做個簡單的介紹。如果想全面的學習ACID原理，請參考ACID。</p><p>關係型數據庫天生就是解決具有複雜事務場景的問題，關係型數據庫完全滿足ACID的特性。</p><p>ACID指的是：</p><ul><li>A: Atomicity，原子性</li><li>C: Consistency，一致性</li><li>I: Isolation，隔離性</li><li>D: Durability，持久性</li></ul><p>具有ACID的特性的數據庫支持強一致性，強一致性代表數據庫本身不會出現不一致，每個事務是原子的，或者成功或者失敗，事物間是隔離的，互相完全不影響，而且最終狀態是持久落盤的，因此，數據庫會從一個明確的狀態到另外一個明確的狀態，中間的臨時狀態是不會出現的，如果出現也會及時的自動的修復，因此是強一致的。</p><p>3個典型的關係型數據庫Oracle、Mysql、Db2都能保證強一致性，Oracle和Mysql使用多版本控制協議實現，而DB2使用改進的兩階段提交協議來實現。</p><p>如果你在為交易相關係統做技術選型，交易的存儲應該只考慮關係型數據庫，對於核心系統，如果需要較好的性能，可以考慮使用更強悍的硬件，這種向上擴展（升級硬件）雖然成本較高，但是是最簡單粗暴有效的方式，另外，Nosql完全不適合交易場景，Nosql主要用來做數據分析、ETL、報表、數據挖掘、推薦、日誌處理等非交易場景。</p><p>前面提到的案例2-轉賬和案例3-下訂單和扣庫存都可以利用關係型數據庫的強一致性解決。</p><p>然而，前面提到，互聯網項目多數具有大規模高併發的特性，必須應用拆分的理念，對高併發的壓力採取“大而化小、小而化了”的方法，否則難以滿足動輒億級流量的需求，即使使用關係型數據庫，單機也難以滿足存儲和TPS上的需求。為了保證案例2-轉賬可以利用關係型數據庫的強一致性，在拆分的時候儘量的把轉賬相關的賬戶放入一個數據庫分片，對於案例3，儘量的保證把訂單和庫存放入同一個數據庫分片，這樣通過關係型數據庫自然就解決了不一致的問題。</p><p>然而，有些時候事與願違，由於業務規則的限制，無法將相關的數據分到同一個數據庫分片，這個時候我們就需要實現最終一致性。</p><p>對於案例2-轉賬場景，假設賬戶數量巨大，對賬戶存儲進行了拆分，關係型數據庫一共分了8個實例，每個實例8個庫，每個庫8個表，共512張表，假如要轉賬的兩個賬戶正好落在了一個庫裡，那麼可以依賴關係型數據庫的事務保持強一致性。</p><p>如果要轉賬的兩個賬戶正好落在了不同的庫裡，轉賬操作是無法封裝在同一個數據庫事務中的，這個時候會發生一個庫的賬戶扣減餘額成功，另外一個庫的賬戶增加餘額失敗的情況。</p><p>對於這種情況，我們需要繼續探討解決之道，CAP原理和BASE原理，BASE原理通過記錄事務的中間的臨時狀態，實現最終一致性。</p><h1>2. CAP（帽子理論）</h1><p>如果想深入的學習CAP理論，請參考CAP。</p><p>由於對系統或者數據進行了拆分，我們的系統不再是單機系統，而是分佈式系統，針對分佈式系的帽子理論包含三個元素：</p><ul><li>C：Consistency，一致性, 數據一致更新，所有數據變動都是同步的</li><li>A：Availability，可用性, 好的響應性能，完全的可用性指的是在任何故障模型下，服務都會在有限的時間處理響應</li><li>P：Partition tolerance，分區容錯性，可靠性</li></ul><p>帽子理論證明，任何分佈式系統只可同時滿足二點，沒法三者兼顧。關係型數據庫由於關係型數據庫是單節點的，因此，不具有分區容錯性，但是具有一致性和可用性，而分佈式的服務化系統都需要滿足分區容錯性，那麼我們必須在一致性和可用性中進行權衡，具體表現在服務化系統處理的異常請求在某一個時間段內可能是不完全的，但是經過自動的或者手工的補償後，達到了最終的一致性。</p><p>3. BASE（鹼）</p><p>BASE理論解決CAP理論提出了分佈式系統的一致性和可用性不能兼得的問題，如果想全面的學習BASE原理，請參考Eventual consistency。</p><p>BASE在英文中有“鹼”的意思，對應本節開頭的ACID在英文中“酸”的意思，基於這兩個名詞提出了酸鹼平衡的結論，簡單來說是在不同的場景下，可以分別利用ACID和BASE來解決分佈式服務化系統的一致性問題。</p><p>BASE模型與ACID模型截然不同，滿足CAP理論，通過犧牲強一致性，獲得可用性，一般應用在服務化系統的應用層或者大數據處理系統，通過達到最終一致性來儘量滿足業務的絕大部分需求。</p><p>BASE模型包含個三個元素：</p><ul><li>BA：Basically Available，基本可用</li><li>S：Soft State，軟狀態，狀態可以有一段時間不同步</li><li>E：Eventually Consistent，最終一致，最終數據是一致的就可以了，而不是時時保持強一致</li></ul><p>BASE模型的軟狀態是實現BASE理論的方法，基本可用和最終一致是目標。按照BASE模型實現的系統，由於不保證強一致性，系統在處理請求的過程中，可以存在短暫的不一致，在短暫的不一致窗口請求處理處在臨時狀態中，系統在做每步操作的時候，通過記錄每一個臨時狀態，在系統出現故障的時候，可以從這些中間狀態繼續未完成的請求處理或者退回到原始狀態，最後達到一致的狀態。</p><p>以案例1-轉賬為例，我們把用戶A給用戶B轉賬分成四個階段，第一個階段用戶A準備轉賬，第二個階段從用戶A賬戶扣減餘額，第三個階段對用戶B增加餘額，第四個階段完成轉賬。系統需要記錄操作過程中每一步驟的狀態，一旦系統出現故障，系統能夠自動發現沒有完成的任務，然後，根據任務所處的狀態，繼續執行任務，最終完成任務，達到一致的最終狀態。</p><p>在實際應用中，上面這個過程通常是通過持久化執行任務的狀態和環境信息，一旦出現問題，定時任務會撈取未執行完的任務，繼續未執行完的任務，直到執行完成為止，或者取消已經完成的部分操作回到原始狀態。這種方法在任務完成每個階段的時候，都要更新數據庫中任務的狀態，這在大規模高併發系統中不會有太好的性能，一個更好的辦法是用Write-Ahead Log（寫前日誌），這和數據庫的Bin Log（操作日誌）相似，在做每一個操作步驟，都先寫入日誌，如果操作遇到問題而停止的時候，可以讀取日誌按照步驟進行恢復，並且繼續執行未完成的工作，最後達到一致。寫前日誌可以利用機械硬盤的追加寫而達到較好性能，因此，這是一種專業化的實現方式，多數業務繫系統還是使用數據庫記錄的字段來記錄任務的執行狀態，也就是記錄中間的“軟狀態”，一個任務的狀態流轉一般可以通過數據庫的行級鎖來實現，這比使用Write-Ahead Log實現更簡單、更快速。</p><p>有了BASE理論作為基礎，我們對複雜的分佈式事務進行拆解，對其中的每一步驟都記錄其狀態，有問題的時候可以根據記錄的狀態來繼續執行任務，達到最終的一致，通過這個方法我們可以解決案例2-轉賬和案例3-下訂單和扣庫存中遇到的問題。</p><p>4. 酸鹼平衡的總結</p><ul><li>使用向上擴展（強悍的硬件）運行專業的關係型數據庫（例如：Oracle或者DB2）能夠保證強一致性，錢能解決的問題就不是問題</li></ul><ol><li>如果錢是問題，可以對廉價硬件運行的開源關係型數據庫（例如：Mysql）進行分片，將相關的數據分到數據庫的同一個片，仍然能夠使用關係型數據庫保證事務</li><li>如果業務規則限制，無法將相關的數據分到同一個片，就需要實現最終一致性，通過記錄事務的軟狀態（中間狀態、臨時狀態），一旦處於不一致，可以通過系統自動化或者人工干預來修復不一致的情況</li></ol><h1>3.3 分佈式一致性協議</h1><p>國際開放標準組織Open Group定義了DTS（分佈式事務處理模型），模型中包含4個角色：應用程序、事務管理器、資源管理器、通信資源管理器四部分。事務處理器是統管全局的管理者，資源處理器和通信資源處理器是事務的參與者。</p><p>J2EE規範也包含此分佈式事務處理模型的規範，並在所有的AppServer中進行實現，J2EE規範中定義了TX協議和XA協議，TX協議定義應用程序與事務管理器之間的接口，而XA協議定義了事務管理器與資源處理器之間的接口，在過去，大家使用AppServer，例如：Websphere、Weblogic、Jboss等配置數據源的時候會看見類似XADatasource的數據源，這就是實現了DTS的關係型數據庫的數據源。企業級開發JEE中，關係型數據庫、JMS服務扮演資源管理器的角色，而EJB容器則扮演事務管理器的角色。</p><p>下面我們就介紹兩階段提交協議、三階段提交協議以及阿里巴巴提出的TCC，它們都是根據DTS這一思想演變出來的。</p><h1>1. 兩階段提交協議</h1><p>上面描述的JEE的XA協議就是根據兩階段提交來保證事務的完整性，並實現分佈式服務化的強一致性。</p><p>兩階段提交協議把分佈式事務分成兩個過程，一個是準備階段，一個是提交階段，準備階段和提交階段都是由事務管理器發起的，為了接下來講解方便，我們把事務管理器稱為協調者，把資管管理器稱為參與者。</p><p>兩階段如下：</p><ul><li>準備階段：協調者向參與者發起指令，參與者評估自己的狀態，如果參與者評估指令可以完成，參與者會寫redo或者undo日誌（這也是前面提起的Write-Ahead Log的一種），然後鎖定資源，執行操作，但是並不提交</li></ul><ol><li>提交階段：如果每個參與者明確返回準備成功，也就是預留資源和執行操作成功，協調者向參與者發起提交指令，參與者提交資源變更的事務，釋放鎖定的資源；如果任何一個參與者明確返回準備失敗，也就是預留資源或者執行操作失敗，協調者向參與者發起中止指令，參與者取消已經變更的事務，執行undo日誌，釋放鎖定的資源</li></ol><p>兩階段提交協議成功場景示意圖如下：</p><div class=pgc-img><img alt=分佈式服務架構一致性保障，就這六招搞定所有問題【架構師清單】 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/178f87e319d040e0a8b7b842f13ec37b></div><p>兩階段提交協議</p><p>我們看到兩階段提交協議在準備階段鎖定資源，是一個重量級的操作，並能保證強一致性，但是實現起來複雜、成本較高，不夠靈活，更重要的是它有如下致命的問題：</p><ul><li>阻塞：從上面的描述來看，對於任何一次指令必須收到明確的響應，才會繼續做下一步，否則處於阻塞狀態，佔用的資源被一直鎖定，不會被釋放</li></ul><ol><li>單點故障：如果協調者宕機，參與者沒有了協調者指揮，會一直阻塞，儘管可以通過選舉新的協調者替代原有協調者，但是如果之前協調者在發送一個提交指令後宕機，而提交指令僅僅被一個參與者接受，並且參與者接收後也宕機，新上任的協調者無法處理這種情況</li><li>腦裂：協調者發送提交指令，有的參與者接收到執行了事務，有的參與者沒有接收到事務，就沒有執行事務，多個參與者之間是不一致的</li></ol><p>上面所有的這些問題，都是需要人工干預處理，沒有自動化的解決方案，因此兩階段提交協議在正常情況下能保證系統的強一致性，但是在出現異常情況下，當前處理的操作處於錯誤狀態，需要管理員人工干預解決，因此可用性不夠好，這也符合CAP協議的一致性和可用性不能兼得的原理。</p><p>2. 三階段提交協議</p><p>三階段提交協議是兩階段提交協議的改進版本。它通過超時機制解決了阻塞的問題，並且把兩個階段增加為三個階段：</p><ul><li>詢問階段：協調者詢問參與者是否可以完成指令，協調者只需要回答是還是不是，而不需要做真正的操作，這個階段超時導致中止</li></ul><ol><li>準備階段：如果在詢問階段所有的參與者都返回可以執行操作，協調者向參與者發送預執行請求，然後參與者寫redo和undo日誌，執行操作，但是不提交操作；如果在詢問階段任何參與者返回不能執行操作的結果，則協調者向參與者發送中止請求，這裡的邏輯與兩階段提交協議的的準備階段是相似的，這個階段超時導致成功</li><li>提交階段：如果每個參與者在準備階段返回準備成功，也就是預留資源和執行操作成功，協調者向參與者發起提交指令，參與者提交資源變更的事務，釋放鎖定的資源；如果任何一個參與者返回準備失敗，也就是預留資源或者執行操作失敗，協調者向參與者發起中止指令，參與者取消已經變更的事務，執行undo日誌，釋放鎖定的資源，這裡的邏輯與兩階段提交協議的提交階段一致</li></ol><p>三階段提交協議成功場景示意圖如下：</p><div class=pgc-img><img alt=分佈式服務架構一致性保障，就這六招搞定所有問題【架構師清單】 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/794cae06054f4f219acd9e1c415a6429></div><h1>三階段提交協議</h1><p>然而，這裡與兩階段提交協議有兩個主要的不同：</p><ul><li>增加了一個詢問階段，詢問階段可以確保儘可能早的發現無法執行操作而需要中止的行為，但是它並不能發現所有的這種行為，只會減少這種情況的發生</li></ul><ol><li>在準備階段以後，協調者和參與者執行的任務中都增加了超時，一旦超時，協調者和參與者都繼續提交事務，默認為成功，這也是根據概率統計上超時後默認成功的正確性最大</li></ol><p>三階段提交協議與兩階段提交協議相比，具有如上的優點，但是一旦發生超時，系統仍然會發生不一致，只不過這種情況很少見罷了，好處就是至少不會阻塞和永遠鎖定資源。</p><h1>3. TCC</h1><p>上面兩節講解了兩階段提交協議和三階段提交協議，實際上他們能解決案例2-轉賬和案例3-下訂單和扣庫存中的分佈式事務的問題，但是遇到極端情況，系統會發生阻塞或者不一致的問題，需要運營或者技術人工解決。無論兩階段還是三階段方案中都包含多個參與者、多個階段實現一個事務，實現複雜，性能也是一個很大的問題，因此，在互聯網高併發系統中，鮮有使用兩階段提交和三階段提交協議的場景。</p><p>阿里巴巴提出了新的TCC協議，TCC協議將一個任務拆分成Try、Confirm、Cancel，正常的流程會先執行Try，如果執行沒有問題，再執行Confirm，如果執行過程中出了問題，則執行操作的逆操Cancel，從正常的流程上講，這仍然是一個兩階段的提交協議，但是，在執行出現問題的時候，有一定的自我修復能力，如果任何一個參與者出現了問題，協調者通過執行操作的逆操作來取消之前的操作，達到最終的一致狀態。</p><p>可以看出，從時序上，如果遇到極端情況下TCC會有很多問題的，例如，如果在Cancel的時候一些參與者收到指令，而一些參與者沒有收到指令，整個系統仍然是不一致的，這種複雜的情況，系統首先會通過補償的方式，嘗試自動修復的，如果系統無法修復，必須由人工參與解決。</p><p>從TCC的邏輯上看，可以說TCC是簡化版的三階段提交協議，解決了兩階段提交協議的阻塞問題，但是沒有解決極端情況下會出現不一致和腦裂的問題。然而，TCC通過自動化補償手段，會把需要人工處理的不一致情況降到到最少，也是一種非常有用的解決方案，根據線人，阿里在內部的一些中間件上實現了TCC模式。</p><p>我們給出一個使用TCC的實際案例，在秒殺的場景，用戶發起下單請求，應用層先查詢庫存，確認商品庫存還有餘量，則鎖定庫存，此時訂單狀態為待支付，然後指引用戶去支付，由於某種原因用戶支付失敗，或者支付超時，系統會自動將鎖定的庫存解鎖供其他用戶秒殺。</p><p>TCC協議使用場景示意圖如下：</p><div class=pgc-img><img alt=分佈式服務架構一致性保障，就這六招搞定所有問題【架構師清單】 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/985ff94182a745f3b220e4964c090e1a></div><p>TCC</p><p>總結一下，兩階段提交協議、三階段提交協議、TCC協議都能保證分佈式事務的一致性，他們保證的分佈式系統的一致性從強到弱，TCC達到的目標是最終一致性，其中任何一種方法都可以不同程度的解決案例2：轉賬、案例3：下訂單和扣庫存的問題，只是實現的一致性的級別不一樣而已，對於案例4：同步超時可以通過TCC的理念解決，如果同步調用超時，調用方可以使用fastfail策略，返回調用方的使用方失敗的結果，同時調用服務的逆向cancel操作，保證服務的最終一致性。</p><h1>3.4 保證最終一致性的模式</h1><p>在大規模高併發服務化系統中，一個功能被拆分成多個具有單一功能的元功能，一個流程會有多個系統的多個元功能組合實現，如果使用兩階段提交協議和三階段提交協議，確實能解決系統間一致性問題，除了這兩個協議帶來的自身的問題，這些協議的實現比較複雜、成本比較高，最重要的是性能並不好，相比來看，TCC協議更簡單、容易實現，但是TCC協議由於每個事務都需要執行Try，再執行Confirm，略微顯得臃腫，因此，在現實的系統中，底線要求僅僅需要能達到最終一致性，而不需要實現專業的、複雜的一致性協議，實現最終一致性有一些非常有效的、簡單粗暴的模式，下面就介紹這些模式及其應用場景。</p><h1>1. 查詢模式</h1><p>任何一個服務操作都需要提供一個查詢接口，用來向外部輸出操作執行的狀態。服務操作的使用方可以通過查詢接口，得知服務操作執行的狀態，然後根據不同狀態來做不同的處理操作。</p><p>為了能夠實現查詢，每個服務操作都需要有唯一的流水號標識，也可使用此次服務操作對應的資源ID來標誌，例如：請求流水號、訂單號等。</p><p>首先，單筆查詢操作是必須提供的，我們也鼓勵使用單筆訂單查詢，這是因為每次調用需要佔用的負載是可控的，批量查詢則根據需要來提供，如果使用了批量查詢，需要有合理的分頁機制，並且必須限制分頁的大小，以及對批量查詢的QPS需要有容量評估和流控等。</p><p>查詢模式的示意圖如下：</p><div class=pgc-img><img alt=分佈式服務架構一致性保障，就這六招搞定所有問題【架構師清單】 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/922299335a0f443a9f98f86729061ec3></div><p>查詢模式</p><p>對於案例4：同步超時、案例5：異步回調超時、案例6：掉單、案例7：系統間狀態不一致，我們都需要使用查詢模式來了解被調用服務的處理情況，來決定下一步做什麼：補償未完成的操作還是回滾已經完成的操作。</p><h1>2. 補償模式</h1><p>有了上面的查詢模式，在任何情況下，我們都能得知具體的操作所處的狀態，如果整個操作處於不正常的狀態，我們需要修正操作中有問題的子操作，這可能需要重新執行未完成的子操作，後者取消已經完成的子操作，通過修復使整個分佈式系統達到一致，為了讓系統最終一致而做的努力都叫做補償。</p><p>對於服務化系統中同步調用的操作，業務操作發起的主動方在還沒有得到業務操作執行方的明確返回或者調用超時，場景可參考案例4：同步超時，這個時候業務發起的主動方需要及時的調用業務執行方獲得操作執行的狀態，這裡使用查詢模式，獲得業務操作的執行方的狀態後，如果業務執行方已經完預設的工作，則業務發起方給業務的使用方返回成功，如果業務操作的執行方的狀態為失敗或者未知，則會立即告訴業務的使用方失敗，然後調用業務操作的逆向操作，保證操作不被執行或者回滾已經執行的操作，讓業務的使用方、業務發起的主動方、業務的操作方最終達成一致的狀態。</p><p>補償模式的示意圖如下：</p><div class=pgc-img><img alt=分佈式服務架構一致性保障，就這六招搞定所有問題【架構師清單】 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/fdf79605bbf54c3ba84f209cf9909f59></div><p>補償模式</p><p>補償操作根據發起形式分為：</p><ul><li>自動恢復：程序根據發生不一致的環境，通過繼續未完成的操作，或者回滾已經完成的操作，自動來達到一致</li></ul><ol><li>通知運營：如果程序無法自動恢復，並且設計時考慮到了不一致的場景，可以提供運營功能，通過運營手工進行補償</li><li>通知技術：如果很不巧，系統無法自動回覆，又沒有運營功能，那必須通過技術手段來解決，技術手段包括走數據庫變更或者代碼變更來解決，這是最糟的一種場景</li></ol><h1>3. 異步確保模式</h1><p>異步確保模式是補償模式的一個典型案例，經常應用到使用方對響應時間要求並不太高，我們通常把這類操作從主流程中摘除，通過異步的方式進行處理，處理後把結果通過通知系統通知給使用方，這個方案最大的好處能夠對高併發流量進行消峰，例如：電商系統中的物流、配送，以及支付系統中的計費、入賬等。</p><p>實踐中，將要執行的異步操作封裝後持久入庫，然後通過定時撈取未完成的任務進行補償操作來實現異步確保模式，只要定時系統足夠健壯，任何一個任務最終會被成功執行。</p><p>異步確保模式的示意圖如下：</p><div class=pgc-img><img alt=分佈式服務架構一致性保障，就這六招搞定所有問題【架構師清單】 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/f50e3d4562554fdca3da47b6a8cd68e2></div><p>異步確保模式</p><p>對於案例5：異步回調超時，使用的就是異步確保模式，這種情況下對於某個操作，如果遲遲沒有收到響應，我們通過查詢模式和補償模式來繼續未完成的操作。</p><h1>4. 定期校對模式</h1><p>既然我們在系統中實現最終一致性，系統在沒有達到一致之前，系統間的狀態是不一致的，甚至是混亂的，需要補償操作來達到一致的目的，但是我們如何來發現需要補償的操作呢？</p><p>在操作的主流程中的系統間執行校對操作，我們可以事後異步的批量校對操作的狀態，如果發現不一致的操作，則進行補償，補償操作與補償模式中的補償操作是一致的。</p><p>另外，實現定期校對的一個關鍵就是分佈式系統中需要有一個自始至終唯一的ID，ID的生成請參考SnowFlake。</p><p>在分佈式系統中，全局唯一ID的示意圖如下：</p><div class=pgc-img><img alt=分佈式服務架構一致性保障，就這六招搞定所有問題【架構師清單】 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/7b15da09712b4459843de665120a9992></div><p>唯一ID</p><p>一般情況下，生成全局唯一ID有兩種方法：</p><ul><li>持久型：使用數據庫表自增字段或者Sequence生成，為了提高效率，每個應用節點可以緩存一批次的ID，如果機器重啟可能會損失一部分ID，但是這並不會產生任何問題</li></ul><ol><li>時間型：一般由機器號、業務號、時間、單節點內自增ID組成，由於時間一般精確到秒或者毫秒，因此不需要持久就能保證在分佈式系統中全局唯一、粗略遞增能特點</li></ol><p>實踐中，為了能在分佈式系統中迅速的定位問題，一般的分佈式系統都有技術支持系統，它能夠跟蹤一個請求的調用鏈，調用鏈是在二維的維度跟蹤一個調用請求，最後形成一個調用樹，原理可參考谷歌的論文Dapper, a Large-Scale Distributed Systems Tracing Infrastructure，一個開源的參考實現為pinpoint。</p><p>在分佈式系統中，調用鏈的示意圖如下：</p><div class=pgc-img><img alt=分佈式服務架構一致性保障，就這六招搞定所有問題【架構師清單】 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/dfic-imagehandler/b655e8cf-57d6-4556-96fd-bb2afd595c3b></div><p>調用鏈</p><p>全局的唯一流水ID可以把一個請求在分佈式系統中的流轉的路徑聚合，而調用鏈中的spanid可以把聚合的請求路徑通過樹形結構進行展示，讓技術支持人員輕鬆的發現系統出現的問題，能夠快速定位出現問題的服務節點，提高應急效率。</p><p>關於訂單跟蹤、調用鏈跟蹤、業務鏈跟蹤，我們會在後續文章中詳細介紹。</p><p>在分佈式系統中構建了唯一ID，調用鏈等基礎設施，我們很容易對系統間的不一致進行核對，通常我們需要構建第三方的定期核對系統，以第三方的角度來監控服務執行的健康程度。</p><p>定期核對系統示意圖如下：</p><div class=pgc-img><img alt=分佈式服務架構一致性保障，就這六招搞定所有問題【架構師清單】 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/b0ea51e1e5ba41fa8f3bbff0cf8e5cb3></div><p>定期核對模式</p><p>對於案例6：掉單、案例7：系統間狀態不一致通常通過定期校對模式發現問題，並通過補償模式來修復，最後完成系統間的最終一致性。</p><p>定期校對模式多應用在金融系統，金融系統由於涉及到資金安全，需要保證百分之百的準確性，所以，需要多重的一致性保證機制，包括：系統間的一致性對賬、現金對賬、賬務對賬、手續費對賬等等，這些都屬於定期校對模式，順便說一下，金融系統與社交應用在技術上本質的區別在於社交應用在於量大，而金融系統在於數據的準確性。</p><p>到現在為止，我們看到通過查詢模式、補償模式、定期核對模式可以解決案例4到案例7的所有問題，對於案例4：同步超時，如果同步超時，我們需要查詢狀態進行補償，對於案例5：異步回調超時，如果遲遲沒有收到回調響應，我們也會通過查詢狀態進行補償，對於案例6：掉單、案例7：系統間狀態不一致，我們通過定期核對模式可以保證系統間操作的一致性，避免掉單和狀態不一致導致問題。</p><h1>5. 可靠消息模式</h1><p>在分佈式系統中，對於主流程中優先級比較低的操作，大多采用異步的方式執行，也就是前面提到的異步確保型，為了讓異步操作的調用方和被調用方充分的解耦，也由於專業的消息隊列本身具有可伸縮、可分片、可持久等功能，我們通常通過消息隊列實現異步化，對於消息隊列，我們需要建立特殊的設施保證可靠的消息發送以及處理機的冪等等。</p><p><strong>消息的可靠發送</strong></p><p>消息的可靠發送可以認為是盡最大努力發送消息通知，有兩種實現方法：</p><p>第一種，發送消息之前，把消息持久到數據庫，狀態標記為待發送，然後發送消息，如果發送成功，將消息改為發送成功。定時任務定時從數據庫撈取一定時間內未發送的消息，將消息發送。</p><div class=pgc-img><img alt=分佈式服務架構一致性保障，就這六招搞定所有問題【架構師清單】 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/64c288c01e38401a80c3eb918abb93d3></div><p>消息發送模式1</p><p>第二種，實現方式與第一種類似，不同的是持久消息的數據庫是獨立的，並不耦合在業務系統中。發送消息之前，先發送一個預消息給某一個第三方的消息管理器，消息管理器將其持久到數據庫，並標記狀態為待發送，發送成功後，標記消息為發送成功。定時任務定時從數據庫撈取一定時間內未發送的消息，回查業務系統是否要繼續發送，根據查詢結果來確定消息的狀態。</p><div class=pgc-img><img alt=分佈式服務架構一致性保障，就這六招搞定所有問題【架構師清單】 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/e6be36ac6dda49e9b9ea385594e6e7e1></div><p>消息發送模式2</p><p>一些公司把消息的可靠發送實現在了中間件裡，通過Spring的注入，在消息發送的時候自動持久消息記錄，如果有消息記錄沒有發送成功，定時會補償發送。</p><p><strong>消息處理器的冪等性</strong></p><p>如果我們要保證消息可靠的發送，簡單來說，要保證消息一定要發送出去，那麼就需要有重試機制，有了重試機制，消息一定會重複，那麼我們需要對重複做處理。</p><p>處理重複的最佳方式為保證操作的冪等性，冪等性的數學公式為：</p><blockquote>f(f(x)) = f(x)</blockquote><p>保證操作的冪等性常用的幾個方法：</p><ul><li>使用數據庫表的唯一鍵進行濾重，拒絕重複的請求</li></ul><ol><li>使用分佈式表對請求進行濾重</li><li>使用狀態流轉的方向性來濾重，通常使用行級鎖來實現(後續在鎖相關的文章中詳細說明)</li><li>根據業務的特點，操作本身就是冪等的，例如：刪除一個資源、增加一個資源、獲得一個資源等</li></ol><h1>6. 緩存一致性模型</h1><p>大規模高併發系統中一個常見的核心需求就是億級的讀需求，顯然，關係型數據庫並不是解決高併發讀需求的最佳方案，互聯網的經典做法就是使用緩存抗讀需求，下面有一些使用緩存的保證一致性的最佳實踐：</p><ul><li>如果性能要求不是非常的高，儘量使用分佈式緩存，而不要使用本地緩存</li></ul><ol><li>種緩存的時候一定種完全，如果緩存數據的一部分有效，一部分無效，寧可放棄種緩存，也不要把部分數據種入緩存</li><li>數據庫與緩存只需要保持弱一致性，而不需要強一致性，讀的順序要先緩存，後數據庫，寫的順序要先數據庫，後緩存</li></ol><p>這裡的最佳實踐能夠解決案例8：緩存和數據庫不一致、案例9：本地緩存節點間不一致、案例10：緩存數據結構不一致的問題，對於數據存儲層、緩存與數據庫、Nosql等的一致性是更深入的存儲一致性技術，將會在後續文章單獨介紹，這裡的數據一致性主要是處理應用層與緩存、應用層與數據庫、一部分的緩存與數據庫的一致性。</p><h1>總結</h1><p>本文從一致性問題的實踐出發，從大規模高併發服務化系統的實踐經驗中進行總結，列舉導致不一致的具體問題，圍繞著具體問題，總結出解決不一致的方法，並且抽象成模式，供大家在開發服務化系統的過程中參考。</p><blockquote>作者：李豔鵬鏈接：https://www.jianshu.com/p/1156151e20c8(本文在原文中有做一定修改，語言更加精簡，突出要點，提高大家閱讀效率)</blockquote><p><strong>您的轉發+關注就是對筆者最大的支持，歡迎關注。</strong></p><p>另外喜歡聽互聯網圈裡那些趣聞軼事，或者對大廠架構設計，BAT面試題分享, 編程語言理論這些感興趣歡迎關注筆者，乾貨文章都在這裡。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>服務架構</a></li><li><a>六招</a></li><li><a>問題</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/2f87337a.html alt=收不到交警便民通知？可能是這裡出了問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bdf88511c83f431c9f75609d9e44d585 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2f87337a.html title=收不到交警便民通知？可能是這裡出了問題>收不到交警便民通知？可能是這裡出了問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8db1a012.html alt=問題408:在變壓器送電前後怎樣檢測差動保護裝置？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e7912ea051664f678d2616da1c042a37 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8db1a012.html title=問題408:在變壓器送電前後怎樣檢測差動保護裝置？>問題408:在變壓器送電前後怎樣檢測差動保護裝置？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/84e317ac.html alt=檢測虛設問題，應當採取強有力的措施加以解決 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/115bad769be144f19346317e77eed4b3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/84e317ac.html title=檢測虛設問題，應當採取強有力的措施加以解決>檢測虛設問題，應當採取強有力的措施加以解決</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/dfdb3278.html alt=南通中海問題多多？！竟遭市住建局通報批評 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RZ6gaqQHcJXxWV style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/dfdb3278.html title=南通中海問題多多？！竟遭市住建局通報批評>南通中海問題多多？！竟遭市住建局通報批評</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3afc3600.html alt="歡居改造家 一篇看懂，砌牆需要注意的問題有哪些，再也不怕被坑" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/fe51a7bcc26445fa95824ca74c172f17 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3afc3600.html title="歡居改造家 一篇看懂，砌牆需要注意的問題有哪些，再也不怕被坑">歡居改造家 一篇看懂，砌牆需要注意的問題有哪些，再也不怕被坑</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/97268c50.html alt=蛋糕製作中的十一個常見問題及原因 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/2658ec69-8ea5-490e-a30a-08c8ed990c73 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/97268c50.html title=蛋糕製作中的十一個常見問題及原因>蛋糕製作中的十一個常見問題及原因</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7245dc43.html alt=別說我沒提醒你！螺栓連接有問題，趕緊測一下扭矩！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/35dce4fcbaa64306ab138cc84d150d4e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7245dc43.html title=別說我沒提醒你！螺栓連接有問題，趕緊測一下扭矩！>別說我沒提醒你！螺栓連接有問題，趕緊測一下扭矩！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/56faa63d.html alt=航空發動機軸承問題解析：慎重選用軸承遊隙和​防止軸承打滑 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/fa005c54189c4c61bf01b5c6f8afe285 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/56faa63d.html title=航空發動機軸承問題解析：慎重選用軸承遊隙和​防止軸承打滑>航空發動機軸承問題解析：慎重選用軸承遊隙和​防止軸承打滑</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7deecdbb.html alt=定製文件櫃需要注意哪些問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/931a82db62a14175b712856354243b2e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7deecdbb.html title=定製文件櫃需要注意哪些問題>定製文件櫃需要注意哪些問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/25ca0d4f.html alt=有些暗傷，破解與和解，從來都不是問題 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b5e2b6f988c141fdbd859d5f5e943129 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/25ca0d4f.html title=有些暗傷，破解與和解，從來都不是問題>有些暗傷，破解與和解，從來都不是問題</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ae35566a.html alt="分析問題 查找差距 添新舉措——九重二小召開疫情後測試質量分析會" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/S09WOUFHmuIHOE style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ae35566a.html title="分析問題 查找差距 添新舉措——九重二小召開疫情後測試質量分析會">分析問題 查找差距 添新舉措——九重二小召開疫情後測試質量分析會</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f8902836.html alt="分析問題尋差距 鼓足幹勁再出發" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f8902836.html title="分析問題尋差距 鼓足幹勁再出發">分析問題尋差距 鼓足幹勁再出發</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/8777ea19.html alt=對同一省份不同單位領取基本養老金差距問題的分析與解讀？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/f50b917fab194c1280c4057fc27199e6 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/8777ea19.html title=對同一省份不同單位領取基本養老金差距問題的分析與解讀？>對同一省份不同單位領取基本養老金差距問題的分析與解讀？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/541714b0.html alt=墊鼻基底解決臉上的哪些問題？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8bd84cfa42df4c9c8f16fd7b7b88edd4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/541714b0.html title=墊鼻基底解決臉上的哪些問題？>墊鼻基底解決臉上的哪些問題？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7a979471.html alt=風雨蘭可以露天過冬嗎？過冬需要注意哪些問題呢？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/6c1c7841a0b24630a44c30e56917bfae style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7a979471.html title=風雨蘭可以露天過冬嗎？過冬需要注意哪些問題呢？>風雨蘭可以露天過冬嗎？過冬需要注意哪些問題呢？</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>