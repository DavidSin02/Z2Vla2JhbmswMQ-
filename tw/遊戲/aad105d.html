<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>大型互聯網公司微服務架構的10個核心問題，你知道嗎？ | 极客快訊</title><meta property="og:title" content="大型互聯網公司微服務架構的10個核心問題，你知道嗎？ - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="http://p1.pstatp.com/large/pgc-image/10bf03e0dfcb49b6b336ec03cd0ab77f"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/aad105d.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/aad105d.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/aad105d.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/aad105d.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/aad105d.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/aad105d.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/aad105d.html><link rel=canonical href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/aad105d.html><meta property="article:published_time" content="2020-10-29T20:46:28+08:00"><meta property="article:modified_time" content="2020-10-29T20:46:28+08:00"><meta name=Keywords content><meta name=description content="大型互聯網公司微服務架構的10個核心問題，你知道嗎？"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E9%81%8A%E6%88%B2/aad105d.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>大型互聯網公司微服務架構的10個核心問題，你知道嗎？</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E9%81%8A%E6%88%B2.html>遊戲</a></span></div><div class=post-content><div><p>微服務最近非常流行，各大互聯網公司紛紛採用微服務架構體系，微服務架構模式正在為敏捷部署以及複雜企業應用實施提供巨大的幫助。</p><p>今天小編特意寫一篇關於微服務的文章，讓大家10分鐘瞭解微服務。</p><p>1.什麼是微服務？</p><p>微服務架構我們沒有一個明確的定義，但簡單來說微服務架構是： 採用一組服務的方式來構建一個應用，服務獨立部署在不同的進程中，不同服務通過一些輕量級交互機制來通信，例如 RPC、HTTP 等，服務可獨立擴展伸縮，每個服務定義了明確的邊界，不同的服務甚至可以採用不同的編程語言來實現，由獨立的團隊來維護。</p><div class=pgc-img><img alt=大型互聯網公司微服務架構的10個核心問題，你知道嗎？ onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/10bf03e0dfcb49b6b336ec03cd0ab77f><p class=pgc-img-caption></p></div><p>2 微服務架構有哪些特徵（Characteristics）？</p><p>1. 通過服務實現組件化</p><p>傳統實現組件的方式是通過庫（library），傳統組件是和應用一起運行在進程中，組件的局部變化意味著整個應用的重新部署。 通過服務來實現組件，意味著將應用拆散為一系列的服務運行在不同的進程中，那麼單一服務的局部變化只需重新部署對應的服務進程。 另外將服務作為組件可以更明確的定義出組件的邊界。</p><p>2. 按業務能力來劃分服務與組織團隊</p><p>康威定律（Conway's law）指出：</p><p>organizations which design systems ... are constrained to produce designs which are copies of the communication structures of these organizations.</p><p>任何設計系統的組織，最終產生的設計等同於組織之內、之間的溝通結構。</p><p>傳統開發方式中，我們將工程師按技能專長分層為前端層、中間層、數據層，前端對應的角色為UI、頁面構建師等，中間層對應的角色為服務端業務開發工程師，數據層對應著DBA等角色。 事實上傳統應用設計架構的分層結構正反應了不同角色的溝通結構。 而微服務架構的開發模式不同於傳統方式，它將應用按業務能力來劃分為不同的服務，每個服務都要求在對應業務領域的全棧（從前端到後端）軟件實現，從界面到數據存儲到外部溝通協作等等。 因此團隊的組織是跨功能的，包含實現業務所需的全面的技能。 近年興起的全棧工程師正是因為架構和開發模式的轉變而出現，當然具備全棧的工程師其實很少，但將不同領域的工程師組織為一個全棧的團隊就容易的多。</p><p>3. 服務即產品</p><p>傳統的應用開發都是基於項目模式的，開發團隊根據一堆功能列表開發出一個軟件應用並交付給客戶後，該軟件應用就進入維護模式，由另一個維護團隊負責，開發團隊的職責結束。 而微服務架構的倡導者提議避免採用這種項目模式，更傾向於讓開發團隊負責整個產品的全部生命週期。Amazon 對此提出了一個觀點：</p><p>You buidl it, you run it.</p><p>開發團隊對軟件在生產環境的運行負全部責任，讓服務的開發者與服務的使用者（客戶）形成每天的交流反饋，來自直接客戶端的反饋有助於開發者提升服務的質量。</p><p>4. 智能終端與啞管道</p><p>微服務架構拋棄了 ESB 過度複雜的業務規則編排、消息路由等。 服務作為智能終端，所有的業務智能邏輯在服務內部處理，而服務間的通信儘可能的輕量化，不添加任何額外的業務規則。</p><p>5. 去中心統一化</p><p>傳統應用中傾向採用統一的技術平臺或產品來解決所有問題。 不是每個問題都是釘子，也不是每個解決方案都是一個錘子。 問題有其具體性，解決方案也應有其針對性。 用最適合的技術方案去解決具體的問題，在大一統的傳統應用中其實很難做到，而微服務的架構意味著，你可以針對不同的業務服務特徵選擇不同的技術平臺或產品，有針對性的解決具體的業務問題。</p><p>6. 基礎設施自動化</p><p>單一進程的傳統應用被拆分為一系列的多進程服務後，意味著開發、調試、測試、集成、監控和發佈的複雜度都會相應增大。 必須要有合適的自動化基礎設施來支持微服務架構模式，否則開發、運維成本將大大增加。</p><p>7. Design for failure</p><p>正因為將服務獨立在不同的進程中後，引入了額外的失敗因素。 任何時刻對服務的調用都可能因為服務方不可用導致失敗，這就要求服務的消費方需要優雅的處理此類錯誤。 這其實是相對傳統應用開發方式的一個缺點，不過隨著一些開源服務化框架的出現，對業務開發人員而言適當的屏蔽了類似的錯誤處理，不過開發人員依然需要知道對服務的調用是完全不同於進程內的方法或函數調用的。</p><p>8. 進化設計</p><p>一旦採用了微服務架構模式，那麼在服務需要變更時我們要特別小心，服務提供者的變更可能引發服務消費者的兼容性破壞，時刻謹記保持服務契約（接口）的兼容性。 對於解耦服務消費方和服務提供方，伯斯塔爾法則（Postel's law）特別適用：</p><p>Be conservative in what you send, be liberal in what you accept.</p><p>發送時要保守，接收時要開放。</p><p>按照伯斯塔爾法則的思想來設計實現服務調用時，發送的數據要更保守，意味著最小化的傳送必要的信息，接收時更開放意味著要最大限度的容忍信息的兼容性。 多餘的信息不認識可以忽略，而不應該拒絕或拋出錯誤。</p><p>3.為什麼要使用微服務架構？</p><p>開發單體式應用</p><p>假設你正準備開發一款與Uber和Hailo競爭的出租車調度軟件，經過初步會議和需求分析，你可能會手動或者使用基於Rails、Spring Boot、Play或者Maven的生成器開始這個新項目，它的六邊形架構是模塊化的</p><p>應用核心是業務邏輯，由定義服務、域對象和事件的模塊完成。圍繞著核心的是與外界打交道的適配器。適配器包括數據庫訪問組件、生產和處理消息的消息組件，以及提供API或者UI訪問支持的web模塊等。</p><p>儘管也是模塊化邏輯，但是最終它還是會打包並部署為單體式應用。具體的格式依賴於應用語言和框架。例如，許多Java應用會被打包為WAR格式，部署在Tomcat或者Jetty上，而另外一些Java應用會被打包成自包含的JAR格式，同樣，Rails和Node.js會被打包成層級目錄。</p><p>這種應用開發風格很常見，因為IDE和其它工具都擅長開發一個簡單應用，這類應用也很易於調試，只需要簡單運行此應用，用Selenium鏈接UI就可以完成端到端測試。單體式應用也易於部署，只需要把打包應用拷貝到服務器端，通過在負載均衡器後端運行多個拷貝就可以輕鬆實現應用擴展。在早期這類應用運行的很好。</p><p>單體式應用的不足</p><p>不幸的是，這種簡單方法卻有很大的侷限性。一個簡單的應用會隨著時間推移逐漸變大。在每次的sprint中，開發團隊都會面對新“故事”，然後開發許多新代碼。幾年後，這個小而簡單的應用會變成了一個巨大的怪物。</p><p>一旦你的應用變成一個又大又複雜的怪物，那開發團隊肯定很痛苦。敏捷開發和部署舉步維艱，其中最主要問題就是這個應用太複雜，以至於任何單個開發者都不可能搞懂它。因此，修正bug和正確的添加新功能變的非常困難，並且很耗時。另外，團隊士氣也會走下坡路。如果代碼難於理解，就不可能被正確的修改。最終會走向巨大的、不可理解的泥潭。</p><p>單體式應用也會降低開發速度。應用越大，啟動時間會越長。比如，最近的一個調查表明，有時候應用的啟動時間居然超過了12分鐘。我還聽說某些應用需要40分鐘啟動時間。如果開發者需要經常重啟應用，那麼大部分時間就要在等待中渡過，生產效率受到極大影響。</p><p>另外，複雜而巨大的單體式應用也不利於持續性開發。今天，SaaS應用常態就是每天會改變很多次，而這對於單體式應用模式非常困難。另外，這種變化帶來的影響並沒有很好的被理解，所以不得不做很多手工測試。那麼接下來，持續部署也會很艱難。</p><p>單體式應用在不同模塊發生資源衝突時，擴展將會非常困難。比如，一個模塊完成一個CPU敏感邏輯，應該部署在AWS EC2 Compute Optimized instances，而另外一個內存數據庫模塊更合適於EC2 Memory-optimized instances。然而，由於這些模塊部署在一起，因此不得不在硬件選擇上做一個妥協。</p><p>單體式應用另外一個問題是可靠性。因為所有模塊都運行在一個進程中，任何一個模塊中的一個bug，比如內存洩露，將會有可能弄垮整個進程。除此之外，因為所有應用實例都是唯一的，這個bug將會影響到整個應用的可靠性。</p><p>最後，單體式應用使得采用新架構和語言非常困難。比如，設想你有兩百萬行採用XYZ框架寫的代碼。如果想改成ABC框架，無論是時間還是成本都是非常昂貴的，即使ABC框架更好。因此，這是一個無法逾越的鴻溝。你不得不在最初選擇面前低頭。</p><p>那麼如何應對上述的問題呢？</p><p>解決方案：微處理架構——處理複雜事務</p><p>許多公司，比如Amazon、eBay和NetFlix，通過採用微處理結構模式解決了上述問題。其思路不是開發一個巨大的單體式的應用，而是將應用分解為小的、互相連接的微服務。</p><p>一個微服務一般完成某個特定的功能，比如下單管理、客戶管理等等。每一個微服務都是微型六角形應用，都有自己的業務邏輯和適配器。一些微服務還會發布API給其它微服務和應用客戶端使用。其它微服務完成一個Web UI，運行時，每一個實例可能是一個雲VM或者是Docker容器。</p><p>比如，一個系統可能分解，讓每一個應用功能區都使用微服務完成，另外，Web應用會被拆分成一系列簡單的Web應用（比如一個對乘客，一個對出租車駕駛員）。這樣的拆分對於不同用戶、設備和特殊應用場景部署都更容易。</p><p>每一個後臺服務開放一個REST API，許多服務本身也採用了其它服務提供的API。比如，駕駛員管理使用了告知駕駛員一個潛在需求的通知服務。UI服務激活其它服務來更新Web頁面。所有服務都是採用異步的，基於消息的通訊。微服務內部機制將會在後續系列中討論。</p><p>一些REST API也對乘客和駕駛員採用的移動應用開放。這些應用並不直接訪問後臺服務，而是通過API Gateway來傳遞中間消息。API Gateway負責負載均衡、緩存、訪問控制、API 計費監控等等任務，可以通過NGINX方便實現，後續文章將會介紹到API Gateway。</p><p>微服務架構模式在上圖中對應於代表可擴展Scale Cube的Y軸，這是一個在《The Art of Scalability》書中描述過的三維擴展模型。另外兩個可擴展軸，X軸由負載均衡器後端運行的多個應用副本組成，Z軸是將需求路由到相關服務。</p><p>應用基本可以用以上三個維度來表示，Y軸代表將應用分解為微服務。運行時，X軸代表運行多個隱藏在負載均衡器之後的實例，提供吞吐能力。一些應用可能還是用Z軸將服務分區。下面的圖演示行程管理服務如何部署在運行於AWS EC2上的Docker上。</p><p>運行時，行程管理服務由多個服務實例構成。每一個服務實例都是一個Docker容器。為了保證高可用，這些容器一般都運行在多個雲VM上。服務實例前是一層諸如NGINX的負載均衡器，他們負責在各個實例間分發請求。負載均衡器也同時處理其它請求，例如緩存、權限控制、API統計和監控。</p><p>這種微服務架構模式深刻影響了應用和數據庫之間的關係，不像傳統多個服務共享一個數據庫，微服務架構每個服務都有自己的數據庫。另外，這種思路也影響到了企業級數據模式。同時，這種模式意味著多份數據，但是，如果你想獲得微服務帶來的好處，每個服務獨有一個數據庫是必須的，因為這種架構需要這種鬆耦合。</p><p>每種服務都有自己的數據庫，另外，每種服務可以用更適合自己的數據庫類型，也被稱作多語言一致性架構。比如，駕駛員管理（發現哪個駕駛員更靠近乘客），必須使用支持地理信息查詢的數據庫。</p><p>表面上看來，微服務架構模式有點像SOA，他們都由多個服務構成。但是，可以從另外一個角度看此問題，微服務架構模式是一個不包含Web服務（WS-）和ESB服務的SOA。微服務應用樂於採用簡單輕量級協議，比如REST，而不是WS-，在微服務內部避免使用ESB以及ESB類似功能。微服務架構模式也拒絕使用canonical schema等SOA概念。</p><p>4.微服務架構跟SOA有什麼不一樣？</p><p>SOA與微服務應用了很多相同的原則，只是在組織中的應用層次不同。SOA專注於對“大型服務”進行編排操作，但這些大型服務也可以通過對一系列微服務進行組合而實現。服務的大小並不是一種定義微服務的好方法。</p><p>表面上看來，微服務架構模式有點像SOA，他們都由多個服務構成。從另外一個角度看此，微服務架構模式是一個不包含Web服務（WS-）和ESB服務的SOA。</p><p>SOA的提出是在企業計算領域，就是要將緊耦合的系統，劃分為面向業務的，粗粒度，鬆耦合，無狀態的服務。服務發佈出來供其他服務調用，一組互相依賴的服務就構成了SOA架構下的系統。</p><p>基於這些基礎的服務，可以將業務過程用類似BPEL流程的方式編排起來，而BPEL反映的是業務處理的過程，這些過程對於業務人員更為直觀，調整也比hardcode的代碼更容易。當然企業還需要對服務治理，比如服務註冊庫，監控管理等。</p><p>我們知道企業計算領域，如果不是交易系統的話，併發量都不是很大的，所以大多數情況下，一臺服務器就容納將許許多多的服務，這些服務採用統一的基礎設施，可能都運行在一個應用服務器的進程中。雖然說是面向服務了，但還是單一的系統。</p><p>而微服務架構大體是從互聯網企業興起的，由於大規模用戶，對分佈式系統的要求很高，如果像企業計算那樣的系統，伸縮就需要多個容納續續多多的服務的系統實例，前面通過負載均衡使得多個系統成為一個集群。</p><p>但這是很不方便的，互聯網企業迭代的週期很短，一週可能發佈一個版本，甚至可能每天一個版本，而不同的子系統的發佈週期是不一樣的。</p><p>而且，不同的子系統也不像原來企業計算那樣採用集中式的存儲，使用昂貴的Oracle存儲整個系統的數據，二是使用MongoDB，HBase，Cassandra等NOSQL數據庫和Redis，memcache等分佈式緩存。</p><p>那麼就傾向採用以子系統為分割，不同的子系統採用自己的架構，那麼各個服務運行自己的Web容器中，當需要增加計算能力的時候，只需要增加這個子系統或服務的實例就好了，當升級的時候，可以不影響別的子系統。這種組織方式大體上就被稱作微服務架構。</p><p>微服務與SOA相比，更強調分佈式系統的特性，比如橫向伸縮性，服務發現，負載均衡，故障轉移，高可用。互聯網開發對服務治理提出了更多的要求，比如多版本，比如灰度升級，比如服務降級，比如分佈式跟蹤，這些都是在SOA實踐中重視不夠的。</p><p>5.微服務架構的好處有哪些？</p><p>微服務架構模式有很多好處。</p><p>首先，通過分解巨大單體式應用為多個服務方法解決了複雜性問題。在功能不變的情況下，應用被分解為多個可管理的分支或服務。每個服務都有一個用RPC-或者消息驅動API定義清楚的邊界。微服務架構模式給採用單體式編碼方式很難實現的功能提供了模塊化的解決方案，由此，單個服務很容易開發、理解和維護。</p><p>第二，這種架構使得每個服務都可以有專門開發團隊來開發。開發者可以自由選擇開發技術，提供API服務。當然，許多公司試圖避免混亂，只提供某些技術選擇。然後，這種自由意味著開發者不需要被迫使用某項目開始時採用的過時技術，他們可以選擇現在的技術。甚至於，因為服務都是相對簡單，即使用現在技術重寫以前代碼也不是很困難的事情。</p><p>第三，微服務架構模式是每個微服務獨立的部署。開發者不再需要協調其它服務部署對本服務的影響。這種改變可以加快部署速度。UI團隊可以採用AB測試，快速的部署變化。微服務架構模式使得持續化部署成為可能。</p><p>最後，微服務架構模式使得每個服務獨立擴展。你可以根據每個服務的規模來部署滿足需求的規模。甚至於，你可以使用更適合於服務資源需求的硬件。比如，你可以在EC2 Compute Optimized instances上部署CPU敏感的服務，而在EC2 memory-optimized instances上部署內存數據庫。</p><p>6.微服務架構的不足有哪些？</p><p>像任何其它科技一樣，微服務架構也有不足。其中一個跟他的名字類似，『微服務』強調了服務大小，實際上，有一些開發者鼓吹建立稍微大一些的，10-100 LOC服務組。儘管小服務更樂於被採用，但是不要忘了這只是終端的選擇而不是最終的目的。微服務的目的是有效的拆分應用，實現敏捷開發和部署。</p><p>另外一個主要的不足是，微服務應用是分佈式系統，由此會帶來固有的複雜性。開發者需要在RPC或者消息傳遞之間選擇並完成進程間通訊機制。更甚於，他們必須寫代碼來處理消息傳遞中速度過慢或者不可用等局部失效問題。當然這並不是什麼難事，但相對於單體式應用中通過語言層級的方法或者進程調用，微服務下這種技術顯得更復雜一些。</p><p>另外一個關於微服務的挑戰來自於分區的數據庫架構。商業交易中同時給多個業務分主體更新消息很普遍。這種交易對於單體式應用來說很容易，因為只有一個數據庫。在微服務架構應用中，需要更新不同服務所使用的不同的數據庫。使用分佈式交易並不一定是好的選擇，不僅僅是因為CAP理論，還因為今天高擴展性的NoSQL數據庫和消息傳遞中間件並不支持這一需求。最終你不得不使用一個最終一致性的方法，從而對開發者提出了更高的要求和挑戰。</p><p>測試一個基於微服務架構的應用也是很複雜的任務。比如，採用流行的Spring Boot架構，對一個單體式web應用，測試它的REST API，是很容易的事情。反過來，同樣的服務測試需要啟動和它有關的所有服務（至少需要這些服務的stubs）。再重申一次，不能低估了採用微服務架構帶來的複雜性。</p><p>另外一個挑戰在於，微服務架構模式應用的改變將會波及多個服務。比如，假設你在完成一個案例，需要修改服務A、B、C，而A依賴B，B依賴C。在單體式應用中，你只需要改變相關模塊，整合變化，部署就好了。對比之下，微服務架構模式就需要考慮相關改變對不同服務的影響。比如，你需要更新服務C，然後是B，最後才是A，幸運的是，許多改變一般隻影響一個服務，而需要協調多服務的改變很少。</p><p>部署一個微服務應用也很複雜，一個分佈式應用只需要簡單在複雜均衡器後面部署各自的服務器就好了。每個應用實例是需要配置諸如數據庫和消息中間件等基礎服務。相對比，一個微服務應用一般由大批服務構成。例如，根據Adrian Cockcroft，Hailo有160個不同服務構成，NetFlix有大約600個服務。每個服務都有多個實例。這就造成許多需要配置、部署、擴展和監控的部分，除此之外，你還需要完成一個服務發現機制，以用來發現與它通訊服務的地址（包括服務器地址和端口）。傳統的解決問題辦法不能用於解決這麼複雜的問題。接續而來，成功部署一個微服務應用需要開發者有足夠的控制部署方法，並高度自動化。</p><p>一種自動化方法是使用PaaS服務，例如Cloud Foundry。PaaS給開發者提供一個部署和管理微服務的簡單方法，它把所有這些問題都打包內置解決了。同時，配置PaaS的系統和網絡專家可以採用最佳實踐和策略來簡化這些問題。另外一個自動部署微服務應用的方法是開發對於你來說最基礎的PaaS系統。一個典型的開始點是使用一個集群化方案，比如配合Docker使用Mesos或者Kubernetes。</p><p>7.微服務架構的開發團隊組織結構是怎樣的？</p><p>“微”服務並不一定微。服務的具體規模可謂多種多樣。其中規模最大的成果源自Amazon公司旗下的“兩塊披薩”團隊（即整個團隊只需兩塊披薩即可填飽肚子），這意味著其總人數在十位左右。而規模較小的團隊則由六人組成，負責支持六項服務。</p><p>採取此類組織方式的企業實例，其各職能團隊共同負責構建並運營每款產品，而每款產品則被拆分為一系列獨立的服務——且各服務間通過一套消息收發總線實現通信。</p><p>大型整體應用程序亦可以始終圍繞業務功能實際模塊化，由大型團隊構建的單一整體應用程序根據自身業務線進行設計與劃分。然而在這類情況下，最大的問題在於整體應用程序在組織當中需要考慮太多背景信息。如果其整體範疇當中包含太多模塊邊界，那麼團隊中的單一成員將很難通過短期記憶對其進行管理。</p><p>這種模塊化業務線的維護工作還要求相關人員具備極高的專業技能水平。相比之下，服務組件能夠令拆分方式更為明確，從而大大簡化團隊邊界的設定與認知。</p><p>8.為什麼微服務是產品而非項目視角？</p><p>大部分應用程序開發工作都會遵循項目模式：其目標在於交付軟件方案中的特定部分，並擁有直觀的完成指標。在軟件開發工作完成後，其會被傳遞至運維部門，這時負責構建該軟件的團隊也將即刻解散。</p><p>微服務的支持者們則認為這種模式並不可取——他們的主張是相關團隊應該伴隨產品走過整個生命週期。這方面最典型的例子應該是Amazon公司提出的“誰構建，誰運行”原則，其中開發團隊需要對生產環境下的軟件成果承擔全部責任。這就要求開發人員在日常工作中全程關注其軟件的生產運行情況，同時掌握來自用戶的反饋意見，意味著他們需要在一定程度上為用戶提供技術支持服務。</p><p>產品的定位應始終與業務功能相協調。相較於以往將軟件視為一整套已經完成的功能集的心態，微服務架構要求我們全程與之保持關聯，並思考該軟件能夠如何協助用戶加強業務功能。</p><p>當然，我們完全可以將同樣的思路引入整體應用程序當中，不過大量小型服務集合能夠顯著簡化服務開發人員與及用戶之間的個人聯繫。</p><p>9.微服務跨越不同進程構建通信結構的方式是怎樣的？</p><p>在跨越不同進程構建通信結構時，我們發現很多產品及方案會直接把智能化機制塞進通信機制本體當中。這方面的典型實例就是企業服務總線（簡稱ESB），ESB產品當中通常包含複雜度極高的消息跌幅、編排、轉換以及業務規則應用等機制。</p><p>微服務社區則傾向於使用另一種實現方式：智能化端點與傻瓜式流程。採用微服務架構的應用程序旨在儘可能實現解耦化與關聯性——它們各自擁有自己的域邏輯，而且在經典Unix場景下的運作方式更像是過濾器機制——接收請求、應用合適的邏輯並生成響應。這一切都通過簡單的REST類協議實現編排，而非經由WS-Choreography或者BPEL等複雜協議以及中央編排工具實現。</p><p>目前最常用的兩類協議為配合源API的HTTP請求-響應與輕量化消息收發協議。對於前者，最簡練而準確的說明是：</p><p>立足於Web，而非居於Web背後。</p><p>-- Ian Robinson</p><p>微服務團隊採用的正是萬維網（在很大程度上亦包括Unix在內）所遵循的原則與協議。一般來講，其使用的資源能夠為開發人員或者運維人員輕鬆實現緩存處理。</p><p>第二類作法則是立足於輕量化消息總線實現消息收發。這類基礎設施選項通常具備傻瓜式特性（這種傻瓜特性體現在實現操作上，即只需匹配消息路由機制，再無其它）——以RabbitMQ或者ZeroMQ為代表的簡單實現方案僅僅需要提供一套可靠的異步結構，而服務的全部智能化元素仍然存在於端點當中並負責消息的生成與消費。</p><p>在整體應用程序當中，各組件在進程內執行並通過方法調用或者函數調用的方式實現彼此通信。將整體應用程序轉化為微服務形式的最大難題在於改變這種通信模式。由內存內方法調用指向PC通信機制的簡單轉換往往無法良好起效。相反，大家需要利用粗粒度方式取代原本的細粒度通信機制。</p><p>10.實施微服務架構，應該從哪些維度來考量？</p><p>建模</p><p>服務圍繞業務能力建模，服務應該清晰地反應業務能力。</p><p>協作</p><p>採用微服務架構模式後，開發和運行的協作模式都會發生變化。</p><p>按微服務的組織方式，不同人或小團隊負責一個或一組微服務，服務之間可能存在相互調用關係，所以在服務之間也完全採用了像面向外部開放的契約化開發模式。</p><p>每一個服務都提供了一份契約文檔，發佈到公開的內部 wiki，方便服務干係人可自由獲取查看。契約文檔要求至少對服務的幾個基本方面作出說明，如下：</p><p>API，具體接口的 API 接入技術說明。</p><p>能力，服務能力的描述。</p><p>契約，提供這些能力所約定的一些限制條件說明。</p><p>版本，支持的最新和歷史的版本說明。</p><p>使用契約文檔來減少多餘且可能反覆重複的口頭溝通，降低協作成本。</p><p>採用微服務後一個業務功能的調用會涉及多個服務間的協同工作，由於服務間都是跨進城的調用通信，一個業務功能的完成涉及的服務調用鏈條可能較長，這就涉及到服務間需遵循一些規則來確保協作的可靠性和可用性。我們採用的原則是：長鏈條的內部服務之間的調用異步化。若一個調用鏈條中的個別服務變慢或阻塞可能導致整個鏈條產生雪崩效應，採用異步化來規避調用阻塞等待導致的雪崩情形。</p><p>測試</p><p>而微服務的測試，服務開發和運營人員專注於做好服務實現層面的單元測試和服務契約層面的接口測試。而面向業務功能的端到端測試，更多是依賴自動化腳本完成。而為了維護好這些自動化測試腳本，也需要保持服務接口和契約的兼容性和穩定性，這些自動化測試腳本也屬於服務的消費方之一。</p><p>部署</p><p>藉助於虛擬化或容器等隔離技術，每個服務感覺都是獨享資源，不必考慮額外的資源使用衝突。</p><p>監控</p><p>大量鬆耦合的微服務通過相互協作來完成業務功能的流程處理，在這樣一個複雜的生產環境中，出現異常或錯誤是很難迅速定位的。這就需要一套成體系的監控基礎設施，在我們的實踐中藉助了公司統一的監控基礎設施，對監控進行了分層，頂層的監控站在用戶視角，底層的監控站在系統視角，形成更完善的反饋鏈路。</p><p>總結</p><p>構建複雜的應用真的是非常困難。單體式的架構更適合輕量級的簡單應用。如果你用它來開發複雜應用，那真的會很糟糕。微服務架構模式可以用來構建複雜應用，當然，這種架構模型也有自己的缺點和挑戰。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>互聯網</a></li><li><a>務架構</a></li><li><a>10</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/602bcbcd.html alt="每天這樣陪玩 10 分鐘，勝過上萬元早教班" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RlIqLlfA7COpuB style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/602bcbcd.html title="每天這樣陪玩 10 分鐘，勝過上萬元早教班">每天這樣陪玩 10 分鐘，勝過上萬元早教班</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1017785d.html alt=手機收不到短信？這10種排查方法，看看你都會了沒？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/557c2fac09c941f69a7359acbaa810b4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1017785d.html title=手機收不到短信？這10種排查方法，看看你都會了沒？>手機收不到短信？這10種排查方法，看看你都會了沒？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/831354a0.html alt=一看就懂！10年老電工經驗總結：3個區分光纖是多模還是單模方法 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5bfee759920547be9fa569ef49842ad0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/831354a0.html title=一看就懂！10年老電工經驗總結：3個區分光纖是多模還是單模方法>一看就懂！10年老電工經驗總結：3個區分光纖是多模還是單模方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4a9d2887.html alt=10塊錢，可以撬動多大的槓桿？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8d6ace340ff04af9945e80694c8429cc style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4a9d2887.html title=10塊錢，可以撬動多大的槓桿？>10塊錢，可以撬動多大的槓桿？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e342e11c.html alt="2019掌上生活10元風暴怎麼玩攻略 快速獲取小招喵方法" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/Rk8ZSn39iz0Be8 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e342e11c.html title="2019掌上生活10元風暴怎麼玩攻略 快速獲取小招喵方法">2019掌上生活10元風暴怎麼玩攻略 快速獲取小招喵方法</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/75414528.html alt=招行掌上生活10元風暴續-10元購的膳魔師電飯煲到貨 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/c737032a00314e3091e2d81d467d777f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/75414528.html title=招行掌上生活10元風暴續-10元購的膳魔師電飯煲到貨>招行掌上生活10元風暴續-10元購的膳魔師電飯煲到貨</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/43600b7e.html alt=推薦10個值得一去的國外神器網站！登錄無需任何手段，實用又有趣 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/8716c57443b84bf39d12f7181c19e5d7 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/43600b7e.html title=推薦10個值得一去的國外神器網站！登錄無需任何手段，實用又有趣>推薦10個值得一去的國外神器網站！登錄無需任何手段，實用又有趣</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/65c5ac44.html alt=跟新型冠狀病毒有關的10個謠言，別被騙了 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/8d29a0c1-76c9-462f-93a3-12ac1fb91bb1 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/65c5ac44.html title=跟新型冠狀病毒有關的10個謠言，別被騙了>跟新型冠狀病毒有關的10個謠言，別被騙了</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/256535bb.html alt="小米10又推'億級像素'，方向錯了為何還要越走越遠？" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/e25a6761fe874f28a49818dabfc7d87a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/256535bb.html title="小米10又推'億級像素'，方向錯了為何還要越走越遠？">小米10又推'億級像素'，方向錯了為何還要越走越遠？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/4f8d6ade.html alt=耗時4年，奴役勞工10萬餘人，偽滿時期水豐、水滿水電站施工場景 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/152094458108473fb60ec01 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/4f8d6ade.html title=耗時4年，奴役勞工10萬餘人，偽滿時期水豐、水滿水電站施工場景>耗時4年，奴役勞工10萬餘人，偽滿時期水豐、水滿水電站施工場景</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f448e7cc.html alt=10月市區日照時數僅27.3小時創十年新低，這真的很“貴陽” class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1541124052858d1740db0d4 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f448e7cc.html title=10月市區日照時數僅27.3小時創十年新低，這真的很“貴陽”>10月市區日照時數僅27.3小時創十年新低，這真的很“貴陽”</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1bbb42bf.html alt=2020年10月7日，世界職業拳壇新鮮事兒 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/0939c8b4612246ab8bd720d63240562e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1bbb42bf.html title=2020年10月7日，世界職業拳壇新鮮事兒>2020年10月7日，世界職業拳壇新鮮事兒</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/5cb94ee8.html alt=60年來新低！佛山10天日照時數僅0.8小時！去年洗的衣服，今年幹了嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/R8aij9CAatiYf5 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/5cb94ee8.html title=60年來新低！佛山10天日照時數僅0.8小時！去年洗的衣服，今年幹了嗎？>60年來新低！佛山10天日照時數僅0.8小時！去年洗的衣服，今年幹了嗎？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d989bb55.html alt=創60年新低！佛山10天日照時數僅0.8小時！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/88a602fd3e244777a8e3504eba69edac style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d989bb55.html title=創60年新低！佛山10天日照時數僅0.8小時！>創60年新低！佛山10天日照時數僅0.8小時！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/73a10505.html alt="甘肅冬季降水量為近10年最多 日照時數為近50年最少" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RKI3zXA8zfQbRR style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/73a10505.html title="甘肅冬季降水量為近10年最多 日照時數為近50年最少">甘肅冬季降水量為近10年最多 日照時數為近50年最少</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>