<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署 | 极客快訊</title><meta property="og:title" content="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="https://p3.pstatp.com/large/pgc-image/3132252589134132810d13c0590f8774"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/cdecfde8.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/cdecfde8.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/cdecfde8.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/cdecfde8.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/cdecfde8.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/cdecfde8.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/cdecfde8.html><link rel=canonical href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/cdecfde8.html><meta property="article:published_time" content="2020-11-14T20:54:26+08:00"><meta property="article:modified_time" content="2020-11-14T20:54:26+08:00"><meta name=Keywords content><meta name=description content="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E9%81%8A%E6%88%B2/cdecfde8.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署</h1></header><date class="post-meta meta-date">2020-11-14</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E9%81%8A%E6%88%B2.html>遊戲</a></span></div><div class=post-content><div><h1><strong>繼<a class=pgc-link data-content=mp href="https://www.toutiao.com/i6685589275297186318/?group_id=6685589275297186318" target=_blank>使用Docker搭建Gitlab</a>、<a class=pgc-link data-content=mp href="https://www.toutiao.com/i6687456305533157902/?group_id=6687456305533157902" target=_blank>使用Jenkins+Docker+Gitlab+Maven搭建持續集成環境</a>後</strong></h1><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/3132252589134132810d13c0590f8774><p class=pgc-img-caption></p></div><p><strong>CI\CD整個流程：</strong></p><ol><li>idea修改工程後push到gitlab >> gitlab通過webhook通知jenkins工程有改變 >>jenkins到gitlab取最新工程 。</li><li>jenkins 自動 maven （構建、單元測試）工程。</li><li>jenkins完成容器構建 docker images >> push到docker hub私有鏡像倉庫並自動化運行容器應用。</li><li>通過Kubernetes到Harbor私有鏡像倉庫拉取鏡像，自動化編排服務，運行微服務容器應用。<strong>（下一章節）</strong>。</li></ol><p><strong>一、通過GitLab的webhook與Jenkins 連通。</strong></p><p>一個比較典型的微服務應用 這裡只強調應用中的兩個比較重要的文件 一個是Dockerfile 另外一個是build.sh。</p><p>接下來是idea 修改工程 功能後push到gitlab之後。</p><p><strong>1、jenkins 創建一個新任務</strong></p><p><strong></strong>任務名稱跟Gitlab 工程目錄下的其中一個微服務模塊名稱對應，選擇流水線 ，點確定。</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/ae6ba8180d834ad09ed5cfcbb82acd15><p class=pgc-img-caption></p></div><p><strong>2、在任務詳情的 “構建觸發器” ，勾選 “觸發遠程構建” ，輸入身份驗證令牌（自定義）</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/bea45406f5a64d669138319707d88947><p class=pgc-img-caption></p></div><p>複製/job/register-center/build?token=123456 到Gitlab 工程下的Integrations 右邊 URL中，</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/fd8656950da5444abdbb6fe3450f1b2f><p class=pgc-img-caption></p></div><p>點擊 Add webhook 生成一條 webhook 記錄 。</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d2871b2549ca43f18ba972df7ee9dbd0><p class=pgc-img-caption></p></div><p><strong>3、jenkins進入系統設置>全局安全配置 不選擇 跨站請求偽造保護下的“防止跨站點請求偽造”，勾選 授權策略下的 “匿名用戶具有可讀權限” 點保存。</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/77918c1859624c00994a08ba9853af3e><p class=pgc-img-caption></p></div><p><strong>4、在Gitlab的webhook 點擊 test >push events 測試是否與jenkins連通。</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/bc51ac2a1bda4eadaf78245183015d90><p class=pgc-img-caption></p></div><p>如果頁面上方出現 Hook executed successfully: HTTP 201 提示，表示已連通。</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/22b799159bca42f4be31553d1b795d2c><p class=pgc-img-caption></p></div><p>在jenkins 查看對應的 控制檯輸出 Finished: SUCCESS 。</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/45068eee876c4ba99d1bfda62c140246><p class=pgc-img-caption></p></div><p><strong>二、jenkins maven 自動（構建、單元測試）</strong></p><p><strong>1、jenkins進入任務詳情的 “流水線”Pipeline 腳本編寫，點擊 “流水線語法”進入，查看語法。</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/aecdd2e1473847a1a484ebb807363878><p class=pgc-img-caption></p></div><p>步驟>示例步驟 選擇 Git</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/e54587595a6f44ae9c5e70c1833c2ba0><p class=pgc-img-caption></p></div><p>從GitLab 獲取工程的git 地址到 複製到 Repository URL 然後點擊 “生成流水線腳本”，複製到流水線的腳本中</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/c7ffb684f52f4dc6a0b4c254d6c1e12a><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/7d7199fefcf5485ab63f07bce332c247><p class=pgc-img-caption></p></div><p>編寫自動獲取代碼、自動編譯、單元測試 腳本 ，保存返回，點立即構建 ，進入自動構建。</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/33b75f5f72af44b2b70da74f065856a9><p class=pgc-img-caption></p></div><p>查看jenkins首頁 可以看到工程狀態信息，進入控制檯查看日誌，如出現 BUILD SUCCESS 表示 自動獲取代碼、自動編譯成功。</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/796682cb859e4d919a16ada1b0c11986><p class=pgc-img-caption></p></div><p><strong>三、jenkins構建鏡像 （docker images）push到docker 私有鏡像倉庫並自動化運行容器應用。</strong></p><p><strong>1、新建腳本路徑與構建鏡像腳本文件，編寫腳本</strong></p><p>cd /usr/local</p><p>mkdir build_script</p><p>cd build_script</p><p>vi build-images.sh</p><p>chmod 775 build-images.sh</p><p><strong>編寫腳本</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p9.pstatp.com/large/pgc-image/b542eee3eaac4447816865b3274f6e9b><p class=pgc-img-caption>應用docker鏡像構建、推送私有鏡像倉庫、運行鏡像生成容器</p></div><p><strong>2、在jenkins流水線的腳本中添加build-images.sh執行步驟</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/b08ec38d0e384f4596aca582e25b4bcc><p class=pgc-img-caption></p></div><p><strong>3、在idea修改微服務工程代碼後push到gitlab，查看jenkins控制檯輸出及返回項目主頁，如出現下圖表示整理流程沒問題了。</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p3.pstatp.com/large/pgc-image/d7083858c4f0442fa9ef7e3779b720bd><p class=pgc-img-caption></p></div><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/3530f18d265f45788987207954e95381><p class=pgc-img-caption></p></div><p><strong>4、在服務器上通過docker命令查看鏡像 可以發現已經構建成鏡像了</strong></p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/cf9d90d6c8ef449a8fa76f314af7e05e><p class=pgc-img-caption>docker images</p></div><p>查看是否在運行：</p><div class=pgc-img><img alt="Jenkins+Docker+Gitlab+Kubernetes 完成容器化微服務自動化部署" onerror=errorimg.call(this); src=https://p1.pstatp.com/large/pgc-image/5ac5f7ae0a3744789a5770e6082fd1e8><p class=pgc-img-caption>docker ps -a</p></div><p><strong>已實現自動化構建容器應用，通過Kubernetes到Harbor私有鏡像倉庫拉取鏡像，自動化編排服務，運行微服務容器應用。（下一計劃）</strong></p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>Jenkins</a></li><li><a>Docker</a></li><li><a>Gitlab</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/9f3a95de.html alt="整理了一份 Docker系統知識，從安裝到熟練操作看這篇就夠了 | 原力計劃" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/RrlSVa01MRUDMJ style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/9f3a95de.html title="整理了一份 Docker系統知識，從安裝到熟練操作看這篇就夠了 | 原力計劃">整理了一份 Docker系統知識，從安裝到熟練操作看這篇就夠了 | 原力計劃</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/e2c3abb3.html alt=持續集成工具Jenkins，開發也需要知道的項目打包部署技術 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/7eb82fb44ae44f1ebe500bc7ff5e891a style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/e2c3abb3.html title=持續集成工具Jenkins，開發也需要知道的項目打包部署技術>持續集成工具Jenkins，開發也需要知道的項目打包部署技術</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/a6492138.html alt=Gitlab合併代碼的幾種情況 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/bc826ee82465475e90674f574fb1d295 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/a6492138.html title=Gitlab合併代碼的幾種情況>Gitlab合併代碼的幾種情況</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/98cb8bb.html alt=Jenkins擴展共享庫進階 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/33443a51-98a8-4ff5-878c-7fd0a579d929 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/98cb8bb.html title=Jenkins擴展共享庫進階>Jenkins擴展共享庫進階</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/68ae211.html alt="使用Jenkins Git參數實現分支標籤動態選擇" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/b2879af0-59eb-4a60-9813-6c302f9a02b3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/68ae211.html title="使用Jenkins Git參數實現分支標籤動態選擇">使用Jenkins Git參數實現分支標籤動態選擇</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/21aaed3.html alt="Jenkins Hackfest 用戶體驗文檔報告" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/0c4d78a7-f5f1-44fa-ad11-8a93ea398056 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/21aaed3.html title="Jenkins Hackfest 用戶體驗文檔報告">Jenkins Hackfest 用戶體驗文檔報告</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/16c7c76.html alt=軟件架構和Docker class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/714125b2ab454d2cb86cd0c969da5669 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/16c7c76.html title=軟件架構和Docker>軟件架構和Docker</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/fb7a88d.html alt="使用 Docker 容器快速開發物聯網應用程序" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/b181402e-605e-4bcd-810a-bdf19610f5a0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/fb7a88d.html title="使用 Docker 容器快速開發物聯網應用程序">使用 Docker 容器快速開發物聯網應用程序</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>