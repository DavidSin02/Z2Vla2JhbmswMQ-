<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>查找返回多個數據值新思路，自制多功能查詢函數比vlookup更簡單 | 极客快訊</title><meta property="og:title" content="查找返回多個數據值新思路，自制多功能查詢函數比vlookup更簡單 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="http://p3.pstatp.com/large/pgc-image/1535456630178aaa084c150"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/d250b08.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/d250b08.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/d250b08.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/d250b08.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/d250b08.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/d250b08.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/d250b08.html><link rel=canonical href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/d250b08.html><meta property="article:published_time" content="2020-10-29T20:48:05+08:00"><meta property="article:modified_time" content="2020-10-29T20:48:05+08:00"><meta name=Keywords content><meta name=description content="查找返回多個數據值新思路，自制多功能查詢函數比vlookup更簡單"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E9%81%8A%E6%88%B2/d250b08.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>查找返回多個數據值新思路，自制多功能查詢函數比vlookup更簡單</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E9%81%8A%E6%88%B2.html>遊戲</a></span></div><div class=post-content><div><p>在工作中我們經常會碰到根據某個單一條件去查找對應的數據值，這個時候我們常用的一個萬能查詢函數那就是vlookup函數，vlookup函數可以實現基本的向左、向右以及多條件值數據查詢等功能。但是這個函數有個弊端就是，不能實現返回多個數據值。</p><p>如當我們在查詢某個人當天所有門禁刷卡時間或當天人員的所有銷售記錄時候，從上往下查找只能查找出最上面的第一條數據，無法提取出整天的數據。如果要實現這個功能就需要用輔助操作來實現，會顯得比較麻煩。那麼今天我們就來講講自定義多功能查詢函數和vlookup函數分別是如何解決這個問題的。</p><blockquote><p><strong>方法一、vlookup函數如何查找返回多個數據值</strong></p></blockquote><p>問題：提取張三7月1日所有刷卡記錄</p><div class=pgc-img><img alt=查找返回多個數據值新思路，自制多功能查詢函數比vlookup更簡單 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/1535456630178aaa084c150><p class=pgc-img-caption></p></div><p>如上圖效果圖所示，當我們輸入函數=VLOOKUP(ROW(A1),A:D,4,0)往下拖動，張三當天的所有刷卡記錄都會顯示出來，因為總共只有3條數據，所以第四條結果開始就會出現錯誤值。</p><p><strong>操作方法：</strong></p><p>第一步：首先用countif函數做一個輔助列，因為單純的vlookup函數查詢是無法返回多個數值的。插入A列，輔助列函數為：COUNTIF(C$2:C2,F$4)。</p><div class=pgc-img><img alt=查找返回多個數據值新思路，自制多功能查詢函數比vlookup更簡單 onerror=errorimg.call(this); src=http://p9.pstatp.com/large/pgc-image/15354566300305645117dfc><p class=pgc-img-caption></p></div><p>注意點：函數COUNTIF函數中C$2:C2，是非常有深意的，用相對引用的方式往下拖動，分別代表的數據區域則為：C$2:C3、C$2:C4、C$2:C5等。這樣代表的意思就是可以查找出對應的人出現過多少次。</p><p>第二步：輸入函數VLOOKUP(ROW(A1),A:D,4,0)進行數據查詢，然後往下拖動即可返回姓名為張三的所有值。</p><p>注意點：vlookup函數第一參數使用ROW(A1)為條件值的目的是，通過對應姓名所在的數值來進行數據查詢。比如第一條記錄8:38分，選擇函數ROW(A1)按F9，返回的是1；第二條記錄10:15分，選擇函數ROW(A1)按F9，返回的是2，以此類推。效果如下圖所示：</p><div class=pgc-img><img alt=查找返回多個數據值新思路，自制多功能查詢函數比vlookup更簡單 onerror=errorimg.call(this); src=http://p9.pstatp.com/large/pgc-image/15354566302132491c3c990><p class=pgc-img-caption></p></div><blockquote><p><strong>方法二：自定義Mlookup多功能函數查找返回多個數據值</strong></p></blockquote><p>問題：提取張三7月1日所有銷售單號</p><div class=pgc-img><img alt=查找返回多個數據值新思路，自制多功能查詢函數比vlookup更簡單 onerror=errorimg.call(this); src=http://p9.pstatp.com/large/pgc-image/1535456630138aac2b5f0e3><p class=pgc-img-caption></p></div><p>如上圖效果圖所示，輸入函數：Nlookup(F4,C:D,2,-1)，即可返回張三7月1日銷售的所有單號：2018070101,2018070106,2018070111，是不是感覺比vlookup函數更加簡單神奇。這需要用到的是VBA代碼來自定義一個Nlookup函數。</p><p>操作方法：</p><p>第一步：按alt+f11進入代碼編輯窗口，新建一個模塊；</p><div class=pgc-img><img alt=查找返回多個數據值新思路，自制多功能查詢函數比vlookup更簡單 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/153545663010849b8d12648><p class=pgc-img-caption></p></div><p>第二步：輸入以下代碼後，保存為宏文件，即可使用自定義的Nlookup函數，如果你需要修改為其他自己喜歡的函數，可以全部替換即可。</p><p>代碼如下：</p><p>Function Nlookup(rg, rgs As Range, L As Integer, M As Integer)</p><p>Dim arr1, ARR2, 列數</p><p>Dim R, n, K, X, cc, sr As String</p><p>arr1 = rg.Value</p><p>ARR2 = rgs</p><p>If VBA.IsArray(arr1) Then</p><p>For Each R In arr1</p><p>If R &lt;> "" Then</p><p>cc = cc & R</p><p>列數 = 列數 + 1</p><p>End If</p><p>Next R</p><p>Else</p><p>cc = arr1</p><p>End If</p><p>If M > 0 Then '非查找最後一個</p><p>For X = 1 To UBound(ARR2)</p><p>sr = ""</p><p>If 列數 > 1 Then</p><p>For q = 1 To 列數</p><p>sr = sr & ARR2(X, q)</p><p>Next q</p><p>Else</p><p>sr = ARR2(X, 1)</p><p>End If</p><p>If sr = cc Then</p><p>K = K + 1</p><p>If K = M Then</p><p>Nlookup = ARR2(X, L)</p><p>Exit Function</p><p>End If</p><p>End If</p><p>Next X</p><p>ElseIf M = -1 Then '查找所有值</p><p>For X = 1 To UBound(ARR2)</p><p>sr = ""</p><p>If 列數 > 1 Then</p><p>For q = 1 To 列數</p><p>sr = sr & ARR2(X, q)</p><p>Next q</p><p>Else</p><p>sr = ARR2(X, 1)</p><p>End If</p><p>If sr = cc Then</p><p>Nlookup = Nlookup & "," & ARR2(X, L)</p><p>End If</p><p>Next X</p><p>Nlookup = Right(Nlookup, Len(Nlookup) - 1)</p><p>Exit Function</p><p>Else '查找最後一個</p><p>For X = UBound(ARR2) To 1 Step -1</p><p>sr = ""</p><p>If 列數 > 1 Then</p><p>For q = 1 To 列數</p><p>sr = sr & ARR2(X, q)</p><p>Next q</p><p>Else</p><p>sr = ARR2(X, 1)</p><p>End If</p><p>If sr = cc Then</p><p>Nlookup = ARR2(X, L)</p><p>Exit Function</p><p>End If</p><p>Next X</p><p>End If</p><p>Nlookup = ""</p><p>End Function</p><p>學習完上面的兩種查詢多個數據的方法，你現在認為哪一種方法更加簡單了？當然這個多功能函數還包含有其他的功能，趕快嘗試一下吧。</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>多個</a></li><li><a>數據值</a></li><li><a>查詢</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/756b16fb.html alt=奶粉寄出一個月，家人遲遲收不到，物流信息也查詢不到，事發阜陽某韻達快遞網點 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/3fd8ec4e-64c1-446a-adfa-38088fb06c01 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/756b16fb.html title=奶粉寄出一個月，家人遲遲收不到，物流信息也查詢不到，事發阜陽某韻達快遞網點>奶粉寄出一個月，家人遲遲收不到，物流信息也查詢不到，事發阜陽某韻達快遞網點</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7d9c446c.html alt=基於語義關聯的中文查詢糾錯框架 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/fa7ec24a3f3245009b0462435b47db27 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7d9c446c.html title=基於語義關聯的中文查詢糾錯框架>基於語義關聯的中文查詢糾錯框架</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/0a028173.html alt=美國將突現急速衰落？多個盟國紛紛遠離，轉頭接連向東方示好 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/66984f43a03d4505b19859572751646e style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/0a028173.html title=美國將突現急速衰落？多個盟國紛紛遠離，轉頭接連向東方示好>美國將突現急速衰落？多個盟國紛紛遠離，轉頭接連向東方示好</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e88a3a39.html alt=壓力單位概述（壓力單位快速查詢） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/458d052864cf4e30b7372dac21d825ad style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e88a3a39.html title=壓力單位概述（壓力單位快速查詢）>壓力單位概述（壓力單位快速查詢）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/d68a0097.html alt=浙江最大的人工湖，有90個西湖大小，由1000多個小島嶼組成 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/2197d83483ac4cefa8cdb2de117125f0 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/d68a0097.html title=浙江最大的人工湖，有90個西湖大小，由1000多個小島嶼組成>浙江最大的人工湖，有90個西湖大小，由1000多個小島嶼組成</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/00ace6e2.html alt=北京西城迴應入學派位查詢系統異常：代碼錯誤導致，未發現人為因素和外部入侵 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/70aaebe5d7424441a84356f3ff357715 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/00ace6e2.html title=北京西城迴應入學派位查詢系統異常：代碼錯誤導致，未發現人為因素和外部入侵>北京西城迴應入學派位查詢系統異常：代碼錯誤導致，未發現人為因素和外部入侵</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/78f96068.html alt="西城區教育考試中心：查詢系統異常 與派位結果無關聯" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/78f96068.html title="西城區教育考試中心：查詢系統異常 與派位結果無關聯">西城區教育考試中心：查詢系統異常 與派位結果無關聯</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cd3511a2.html alt=分析多物理場的多個問題軟件-ADINA class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/f11b420edc5844a0b94c19283d9cc805 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cd3511a2.html title=分析多物理場的多個問題軟件-ADINA>分析多物理場的多個問題軟件-ADINA</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e65cf1cd.html alt=常用電話查詢，想要的這兒都有~（收藏，以備不時之需） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/39bb00015c66c6b0555a style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e65cf1cd.html title=常用電話查詢，想要的這兒都有~（收藏，以備不時之需）>常用電話查詢，想要的這兒都有~（收藏，以備不時之需）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/51cec254.html alt=百度多個短視頻嵌套了“收徒做任務賺現金”模式 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/R8Ld2A5AsKC7Zw style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/51cec254.html title=百度多個短視頻嵌套了“收徒做任務賺現金”模式>百度多個短視頻嵌套了“收徒做任務賺現金”模式</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b0f0ddcc.html alt=微軟多個在線服務中斷，全美911系統同時宕機 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b0f0ddcc.html title=微軟多個在線服務中斷，全美911系統同時宕機>微軟多個在線服務中斷，全美911系統同時宕機</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1744eb6d.html alt="天津 多個地鐵站扶梯維修施工" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1744eb6d.html title="天津 多個地鐵站扶梯維修施工">天津 多個地鐵站扶梯維修施工</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1d0b8766.html alt=突發！一油罐車發生爆炸，多個收費站緊急關閉 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/S1mzZHNC6OKBEB style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1d0b8766.html title=突發！一油罐車發生爆炸，多個收費站緊急關閉>突發！一油罐車發生爆炸，多個收費站緊急關閉</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b96f6964.html alt=在多個瀏覽器中添加IDM插件 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/7a235092f6244f0db94a546bc46d2bdf style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b96f6964.html title=在多個瀏覽器中添加IDM插件>在多個瀏覽器中添加IDM插件</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3175dd21.html alt=合併多個Excel文件（每個文件包含多個sheet表） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/8729e28003da4696908aee0eb3a21d9c style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3175dd21.html title=合併多個Excel文件（每個文件包含多個sheet表）>合併多個Excel文件（每個文件包含多個sheet表）</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>