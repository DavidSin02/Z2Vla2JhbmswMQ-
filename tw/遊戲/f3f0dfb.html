<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>進階必學之微服務架構下分佈式事務解決方案，你不知道的58同城 | 极客快訊</title><meta property="og:title" content="進階必學之微服務架構下分佈式事務解決方案，你不知道的58同城 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="http://p3.pstatp.com/large/pgc-image/727f3fb06f0542399bc812a286433fcd"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/f3f0dfb.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/f3f0dfb.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/f3f0dfb.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/f3f0dfb.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/f3f0dfb.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/f3f0dfb.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/f3f0dfb.html><link rel=canonical href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/f3f0dfb.html><meta property="article:published_time" content="2020-10-29T20:46:28+08:00"><meta property="article:modified_time" content="2020-10-29T20:46:28+08:00"><meta name=Keywords content><meta name=description content="進階必學之微服務架構下分佈式事務解決方案，你不知道的58同城"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E9%81%8A%E6%88%B2/f3f0dfb.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>進階必學之微服務架構下分佈式事務解決方案，你不知道的58同城</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E9%81%8A%E6%88%B2.html>遊戲</a></span></div><div class=post-content><div><p>1 微服務的發展</p><p>微服務倡導將複雜的單體應用拆分為若干個功能簡單、鬆耦合的服務，這樣可以降低開發難度、增強擴展性、便於敏捷開發。當前被越來越多的開發者推崇，很多互聯網行業巨頭、開源社區等都開始了微服務的討論和實踐。Hailo有160個不同服務構成，NetFlix有大約600個服務。國內方面，阿里巴巴、騰訊、360、京東、58同城等很多互聯網公司都進行了微服務化實踐。當前微服務的開發框架也非常多，比較著名的有Dubbo、SpringCloud、thrift 、grpc等。</p><p>2 微服務落地存在的問題</p><p>雖然微服務現在如火如荼，但對其實踐其實仍處於探索階段。很多中小型互聯網公司，鑑於經驗、技術實力等問題，微服務落地比較困難。如著名架構師Chris Richardson所言，目前存在的主要困難有如下幾方面：</p><p>1）單體應用拆分為分佈式系統後，進程間的通訊機制和故障處理措施變的更加複雜。</p><p>2）系統微服務化後，一個看似簡單的功能，內部可能需要調用多個服務並操作多個數據庫實現，服務調用的分佈式事務問題變的非常突出。</p><p>3）微服務數量眾多，其測試、部署、監控等都變的更加困難。</p><p>隨著RPC框架的成熟，第一個問題已經逐漸得到解決。例如dubbo可以支持多種通訊協議，springcloud可以非常好的支持restful調用。對於第三個問題，隨著docker、devops技術的發展以及各公有云paas平臺自動化運維工具的推出，微服務的測試、部署與運維會變得越來越容易。</p><p>而對於第二個問題，現在還沒有通用方案很好的解決微服務產生的事務問題。分佈式事務已經成為微服務落地最大的阻礙，也是最具挑戰性的一個技術難題。 為此，本文將深入和大家探討微服務架構下，分佈式事務的各種解決方案，並重點為大家解讀阿里巴巴提出的分佈式事務解決方案----GTS。<strong>該方案中提到的GTS是全新一代解決微服務問題的分佈式事務互聯網中間件</strong>。</p><p>3 SOA分佈式事務解決方案</p><p>3.1 基於XA協議的兩階段提交方案</p><p>交易中間件與數據庫通過 XA 接口規範，使用兩階段提交來完成一個全局事務， XA 規範的基礎是兩階段提交協議。</p><p>第一階段是表決階段，所有參與者都將本事務能否成功的信息反饋發給協調者；第二階段是執行階段，協調者根據所有參與者的反饋，通知所有參與者，步調一致地在所有分支上提交或者回滾。</p><div class=pgc-img><img alt=進階必學之微服務架構下分佈式事務解決方案，你不知道的58同城 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/727f3fb06f0542399bc812a286433fcd><p class=pgc-img-caption></p></div><p>基於XA協議的兩階段提交方案</p><p>兩階段提交方案應用非常廣泛，幾乎所有商業OLTP數據庫都支持XA協議。但是兩階段提交方案鎖定資源時間長，對性能影響很大，基本不適合解決微服務事務問題。</p><p>3.2 TCC方案</p><p>TCC方案在電商、金融領域落地較多。TCC方案其實是兩階段提交的一種改進。其將整個業務邏輯的每個分支顯式的分成了Try、Confirm、Cancel三個操作。Try部分完成業務的準備工作，confirm部分完成業務的提交，cancel部分完成事務的回滾。基本原理如下圖所示。</p><div class=pgc-img><img alt=進階必學之微服務架構下分佈式事務解決方案，你不知道的58同城 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/66a82bfcebe347b18c8f3fdd3beb4b83><p class=pgc-img-caption></p></div><p>TCC方案</p><p>事務開始時，業務應用會向事務協調器註冊啟動事務。之後業務應用會調用所有服務的try接口，完成一階段準備。之後事務協調器會根據try接口返回情況，決定調用confirm接口或者cancel接口。如果接口調用失敗，會進行重試。</p><p>TCC方案讓應用自己定義數據庫操作的粒度，使得降低鎖衝突、提高吞吐量成為可能。 當然TCC方案也有不足之處，集中表現在以下兩個方面：</p><ul><li><strong>對應用的侵入性強</strong>。業務邏輯的每個分支都需要實現try、confirm、cancel三個操作，應用侵入性較強，改造成本高。</li><li><strong>實現難度較大</strong>。需要按照網絡狀態、系統故障等不同的失敗原因實現不同的回滾策略。為了滿足一致性的要求，confirm和cancel接口必須實現冪等。</li></ul><p>上述原因導致TCC方案大多被研發實力較強、有迫切需求的大公司所採用。微服務倡導服務的輕量化、易部署，而TCC方案中很多事務的處理邏輯需要應用自己編碼實現，複雜且開發量大。</p><p>3.3 基於消息的最終一致性方案</p><p>消息一致性方案是通過消息中間件保證上、下游應用數據操作的一致性。基本思路是將本地操作和發送消息放在一個事務中，保證本地操作和消息發送要麼兩者都成功或者都失敗。下游應用向消息系統訂閱該消息，收到消息後執行相應操作。</p><div class=pgc-img><img alt=進階必學之微服務架構下分佈式事務解決方案，你不知道的58同城 onerror=errorimg.call(this); src=http://p9.pstatp.com/large/pgc-image/5a397c423275452ebbb1fd9d8ba55814><p class=pgc-img-caption></p></div><p>消息一致性方案</p><p>消息方案從本質上講是將分佈式事務轉換為兩個本地事務，然後依靠下游業務的重試機制達到最終一致性。基於消息的最終一致性方案對應用侵入性也很高，應用需要進行大量業務改造，成本較高。</p><p>4 GTS--分佈式事務解決方案</p><p>GTS是一款分佈式事務中間件，由阿里巴巴中間件部門研發，可以為微服務架構中的分佈式事務提供一站式解決方案。</p><p>更多GTS資料請訪問創始人微博。</p><p>4.1 GTS的核心優勢</p><ul><li><strong>性能超強</strong></li><li>GTS通過大量創新，解決了事務ACID特性與高性能、高可用、低侵入不可兼得的問題。單事務分支的平均響應時間在2ms左右，3臺服務器組成的集群可以支撐3萬TPS以上的分佈式事務請求。</li><li><strong>應用侵入性極低</strong></li><li>GTS對業務低侵入，業務代碼最少只需要添加一行註解（@TxcTransaction）聲明事務即可。業務與事務分離，將微服務從事務中解放出來，微服務關注於業務本身，不再需要考慮反向接口、冪等、回滾策略等複雜問題，極大降低了微服務開發的難度與工作量。</li><li><strong>完整解決方案</strong></li><li>GTS支持多種主流的服務框架，包括EDAS，Dubbo，Spring Cloud等。</li><li>有些情況下，應用需要調用第三方系統的接口，而第三方系統沒有接入GTS。此時需要用到GTS的MT模式。GTS的MT模式可以等價於TCC模式，用戶可以根據自身業務需求自定義每個事務階段的具體行為。MT模式提供了更多的靈活性，可能性，以達到特殊場景下的自定義優化及特殊功能的實現。</li><li><strong>容錯能力強</strong></li><li>GTS解決了XA事務協調器單點問題，實現真正的高可用，可以保證各種異常情況下的嚴格數據一致。</li></ul><p>4.2 GTS的應用場景</p><p>GTS可應用在涉及服務調用的多個領域，包括但不限於金融支付、電信、電子商務、快遞物流、廣告營銷、社交、即時通信、手遊、視頻、物聯網、車聯網等，詳細介紹可以閱讀 《GTS--阿里巴巴分佈式事務全新解決方案》一文。</p><p>4.3 GTS與微服務的集成</p><p>GTS包括客戶端（GTS Client）、資源管理器（GTS RM）和事務協調器（GTS Server）三個部分。GTS Client主要用來界定事務邊界，完成事務的發起與結束。GTS RM完成事務分支的創建、提交、回滾等操作。GTS Server主要負責分佈式事務的整體推進，事務生命週期的管理。GTS和微服務集成的結構圖如下所示，GTS Client需要和業務應用集成部署，RM與微服務集成部署。</p><div class=pgc-img><img alt=進階必學之微服務架構下分佈式事務解決方案，你不知道的58同城 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/ce6c1673b8a740c598035ebc21849dbc><p class=pgc-img-caption></p></div><p>GTS與微服務集成</p><p>4.4 GTS的輸出形式</p><p>GTS目前有三種輸出形式：公有云輸出、公網輸出、專有云輸出。</p><p>4.4.1 公有云輸出</p><p>這種輸出形式面向阿里雲用戶。如果用戶的業務系統已經部署到阿里雲上，可以申請開通公有云GTS。開通後業務應用即可通過GTS保證服務調用的一致性。這種使用場景下，業務系統和GTS間的網絡環境比較理想，達到很好性能。</p><div class=pgc-img><img alt=進階必學之微服務架構下分佈式事務解決方案，你不知道的58同城 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/8c0384b0e020442a8849bb85018d81af><p class=pgc-img-caption></p></div><p>公有云輸出</p><p>4.4.2 公網輸出</p><p>這種輸出形式面向於非阿里雲的用戶，使用更加方便、靈活，業務系統只要能連接互聯網即可享受GTS提供的雲服務（與公有云輸出的差別在於客戶端部署於用戶本地，而不在雲上）。</p><p>在正常網絡環境下，以包含兩個本地事務的全局事務為例，事務完成時間在20ms左右，50個併發就可以輕鬆實現1000TPS以上分佈式事務，對絕大多數業務來說性能是足夠的。在公網環境，網絡閃斷很難完全避免，這種情況下GTS仍能保證服務調用的數據一致性。</p><div class=pgc-img><img alt=進階必學之微服務架構下分佈式事務解決方案，你不知道的58同城 onerror=errorimg.call(this); src=http://p9.pstatp.com/large/pgc-image/94c8da96baf147afb387d476e7186f02><p class=pgc-img-caption></p></div><p>公網輸出</p><p>具體使用樣例使用參見4.7節GTS的工程樣例。</p><p>4.4.3 專有云輸出</p><p>這種形式主要面向於已建設了自己專有云平臺的大用戶，GTS可以直接部署到用戶的專有云上，為專有云提供分佈式事務服務。目前已經有10多個特大型企業的專有云使用GTS解決分佈式事務難題，性能與穩定性經過了用戶的嚴格檢測。</p><p>4.5 GTS的使用方式</p><p>GTS對應用的侵入性非常低，使用也很簡單。下面以訂單存儲應用為例說明。訂單業務應用通過調用訂單服務和庫存服務完成訂單業務，服務開發框架為Dubbo。</p><p>4.5.1 訂單業務應用</p><p>在業務函數外圍使用@TxcTransaction註解即可開啟分佈式事務。Dubbo應用通過隱藏參數將GTS的事務xid傳播到服務端。</p><pre>@TxcTransaction(timeout = 1000 * 10)public void Bussiness(OrderService orderService, StockService stockService, String userId) { //獲取事務上下文 String xid = TxcContext.getCurrentXid(); //通過RpcContext將xid傳到一個服務端 RpcContext.getContext().setAttachment("xid", xid);  //執行自己的業務邏輯 int productId = new Random().nextInt(100); int productNum = new Random().nextInt(100); OrderDO orderDO = new OrderDO(userId, productId, productNum,  new Timestamp(new Date().getTime())); orderService.createOrder(orderDO);  //通過RpcContext將xid傳到另一個服務端 RpcContext.getContext().setAttachment("xid",xid); stockService.updateStock(orderDO);}</pre><p>4.5.2 服務提供者</p><p>更新庫存方法</p><pre>public int updateStock(OrderDO orderDO) { //獲取全局事務ID，並綁定到上下文 String xid = RpcContext.getContext().getAttachment("xid"); TxcContext.bind(xid,null); //執行自己的業務邏輯 String sql = "update stock set amount = amount - ? where product_id = ?"; int ret = jdbcTemplate.update(sql,new Object[]{orderDO.getNumber(),  orderDO.getProductId()}); TxcContext.unbind(); return ret;}</pre><p>4.6 GTS的應用情況</p><p>GTS目前已經在淘寶、天貓、阿里影業、淘票票、阿里媽媽、1688等阿里各業務系統廣泛使用，經受了16年和17年兩年雙十一海量請求的考驗。某線上業務系統最高流量已達十萬TPS（每秒鐘10萬筆事務）。</p><p>GTS在公有云和專有云輸出後，已經有了100多個線上用戶，很多用戶通過GTS解決SpringCloud、Dubbo、Edas等服務框架的分佈式事務問題。業務領域涉及電力、物流、ETC、菸草、金融、零售、電商、共享出行等十幾個行業，得到用戶的一致認可。</p><div class=pgc-img><img alt=進階必學之微服務架構下分佈式事務解決方案，你不知道的58同城 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/c21239f46d7d4b43973c9ceaba15dff2><p class=pgc-img-caption></p></div><p>GTS與springCloud集成案例</p><p>上圖是GTS與SpringCloud集成，應用於某共享出行系統。業務共享出行場景下，通過GTS支撐物聯網系統、訂單系統、支付系統、運維繫統、分析系統等系各統應用的數據一致性，保證海量訂單和數千萬流水的交易。4.7 GTS的工程樣例</p><p>GTS的公有云樣例可參考阿里雲網站。在公網環境下提供sample-txc-simple和sample-txc-dubbo兩個樣例工程。(點擊下載)</p><p>注意</p><ul><li>mysql-connector-java 的版本需要和 MySQL 數據庫版本匹配。樣例 pom.xml 中推薦的 5.1.38 版本已經在 5.0.55、5.6.16、5.6.21 三個 MySQL 數據庫版本上運行過。</li><li>MySQL 數據庫的庫名、表名和字段名需要設置為大小寫不敏感。</li><li>sample-txc-dubbo樣例使用 Multicast 註冊中心的聲明方式。如果本機使用無線網絡，Dubbo 服務在綁定地址時有可能獲取 IPv6 地址，可以通過 JVM 啟動參數禁用。方法是配置 JVM 啟動參數 -Djava.net.preferIPv4Stack=true。</li></ul><p>4.7.1 sample-txc-simple樣例</p><p>4.7.1.1 樣例業務邏輯</p><p>該樣例是GTS的入門sample，案例的業務邏輯是從A賬戶轉賬給B賬戶，其中A和B分別位於兩個MySQL數據庫中，使用GTS事務保證A和B賬戶錢的總數始終不變。</p><p>4.7.1.2 樣例搭建方法</p><ol><li>準備本地數據庫環境</li></ol><ul><li>準備一臺能連接公網的電腦，配置 Java 環境和 Maven 環境。</li><li>安裝 MySQL 數據庫軟件，並創建兩個數據庫 db1 和 db2。</li><li>在 db1 和 db2 中分別創建 txc_undo_log 表。</li><li>在 db1 庫中創建 user_money_a 表，在 db2 庫中創建 user_money_b 表</li></ul><ol><li>下載樣例</li></ol><p>將sample-txc-simple(點擊下載)文件下載到本地，樣例中已經包含了GTS的SDK。</p><ol><li>修改配置</li></ol><ul><li>數據源配置：</li><li>打開sample-txc-simple/src/main/resources目錄下的txc-client-context.xml，將數據源的url、username、password修改為實際值。</li><li>scanner配置</li><li>將 txc-client-context.xml 中的 scanner 配置修改為:</li><li>&lt;bean class="com.taobao.txc.client.aop.TxcTransactionScaner"></li><li>&lt;constructor-arg value="myapp"/></li><li>&lt;constructor-arg value="txc_test_public.1129361738553704.QD"/></li><li>&lt;constructor-arg value="1" /></li><li>&lt;constructor-arg value="https://test-cs-gts.aliyuncs.com" /></li><li>&lt;/bean></li></ul><ol><li>編譯樣例</li></ol><ul><li>Mac OS 或 Linux 系統</li><li>在 sample-txc-simple 目錄下執行 build.sh 命令。</li><li>Windows 系統</li><li>在 sample-txc-simple 目錄下執行 build.bat 命令。</li></ul><ol><li>運行樣例</li></ol><ul><li>Mac OS 或 Linux 系統</li><li>在 txc-yun-sample/sample-txc-simple/client/bin 目錄下執行 run.sh 命令。</li><li>Windows 系統</li><li>啟動 cmd.exe，在 txc-yun-sample/sample-txc-simple/client/bin 目錄下執行 start.bat 命令。</li></ul><p>4.7.2 sample-txc-dubbo 樣例</p><p>4.7.2.1 樣例業務邏輯</p><p>本案例模擬了用戶下訂單、減庫存的業務邏輯。客戶端（Client）通過調用訂單服務（OrderService）創建訂單，之後通過調用庫存服務（StockService）扣庫存。其中訂單服務讀寫訂單數據庫，庫存服務讀寫庫存數據庫。由 GTS 保證跨服務事務的一致性。</p><p>4.7.2.2 樣例搭建方法</p><ol><li>準備數據庫環境</li></ol><p>安裝MySQL，創建兩個數據庫db1和db2。在db1和db2中分別創建txc_undo_log表。在db1庫中創建orders表，在db2庫中創建stock表。</p><ol><li>下載樣例</li><li>將樣例文件(點擊下載)下載到本地機器，樣例中已經包含了GTS的SDK。</li><li>修改配置</li></ol><ul><li>數據源配置</li><li>打開sample-txc-dubbo/src/main/resources目錄，將dubbo-order-service.xml、dubbo-stock-service.xml兩個文件中數據源的url、username、password修改為實際值。</li><li>scanner配置</li><li>將 resource 目錄下的每個 xml 文件中的 scanner 配置修改為:</li><li>&lt;bean class="com.taobao.txc.client.aop.TxcTransactionScaner"></li><li>&lt;constructor-arg value="myapp"/></li><li>&lt;constructor-arg value="txc_test_public.1129361738553704.QD"/></li><li>&lt;constructor-arg value="1" /></li><li>&lt;constructor-arg value="https://test-cs-gts.aliyuncs.com" /></li><li>&lt;/bean></li></ul><ol><li>編譯樣例</li></ol><ul><li>Mac OS 或 Linux 系統</li><li>在 sample-txc-dubbo 目錄下執行 build.sh 命令。</li><li>Windows 系統</li><li>在 sample-txc-dubbo 目錄下執行 build.bat 命令。</li></ul><p>5 運行樣例</p><ul><li>Mac OS 或 Linux 系統</li><li>在 txc-yun-sample/sample-txc-dubbo 目錄下執行 run.sh 命令。</li><li>該腳本會依次啟動 order_run.sh(訂單服務)、stock_run.sh(庫存服務)和 client_run.sh(客戶端程序)。</li><li>Windows 系統</li><li>啟動 cmd.exe，進入 txc-yun-sample/sample-txc-dubbo/client/bin 目錄。</li><li>執行 order.bat 命令，運行訂單服務。</li><li>執行 stock.bat 命令，運行庫存服務。</li><li>訂單服務和庫存服務都啟動成功後，執行 client.bat 命令， 運行客戶端程序。</li></ul><p>4.7.3 SQL</p><p>4.7.3.1 建表 txc_undo_log</p><p>CREATE TABLE txc_undo_log (</p><p>id bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主鍵',</p><p>gmt_create datetime NOT NULL COMMENT '創建時間',</p><p>gmt_modified datetime NOT NULL COMMENT '修改時間',</p><p>xid varchar(100) NOT NULL COMMENT '全局事務ID',</p><p>branch_id bigint(20) NOT NULL COMMENT '分支事務ID',</p><p>rollback_info longblob NOT NULL COMMENT 'LOG',</p><p>status int(11) NOT NULL COMMENT '狀態',</p><p>server varchar(32) NOT NULL COMMENT '分支所在DB IP',</p><p>PRIMARY KEY (id),</p><p>KEY unionkey (xid,branch_id)</p><p>) ENGINE=InnoDB AUTO_INCREMENT=211225994 DEFAULT CHARSET=utf8 COMMENT='事務日誌表';</p><p>4.7.3.2 建表 user_money_a</p><p>CREATE TABLE user_money_a (</p><p>id int(11) NOT NULL AUTO_INCREMENT,</p><p>money int(11) DEFAULT NULL,</p><p>PRIMARY KEY (id)</p><p>) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;</p><p>4.7.3.3 建表 user_money_b</p><p>CREATE TABLE user_money_b (</p><p>id int(11) NOT NULL AUTO_INCREMENT,</p><p>money int(11) DEFAULT NULL,</p><p>PRIMARY KEY (id)</p><p>) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;</p><p>4.7.3.4 建表 orders</p><p>CREATE TABLE orders (</p><p>id bigint(20) NOT NULL AUTO_INCREMENT,</p><p>user_id varchar(255) NOT NULL,</p><p>product_id int(11) NOT NULL,</p><p>number int(11) NOT NULL,</p><p>gmt_create timestamp NOT NULL,</p><p>PRIMARY KEY (id)</p><p>) ENGINE=MyISAM AUTO_INCREMENT=351 DEFAULT CHARSET=utf8</p><p>4.7.3.5 建表 stock</p><p>CREATE TABLE stock (</p><p>product_id int(11) NOT NULL,</p><p>price float NOT NULL,</p><p>amount int(11) NOT NULL,</p><p>PRIMARY KEY (product_id)</p><p>) ENGINE=InnoDB DEFAULT CHARSET=utf8</p><p>QQ群號碼：786947691</p><p>群內提供免費的Java架構學習資料（裡面有高可用、高併發、高性能及分佈式、Jvm性能調優、Spring源碼，MyBatis，Netty,Redis,Kafka,Mysql,Zookeeper,Tomcat,Docker,Dubbo,Nginx等多個知識點的架構資料）合理利用自己每一分每一秒的時間來學習提升自己，不要再用"沒有時間“來掩飾自己思想上的懶惰！趁年輕，使勁拼，給未來的自己一個交代！</p></div></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>進階必學</a></li><li><a>務架構</a></li><li><a>下分</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/17b21f70.html alt=深入理解微服務架構spring的各個知識點（面試必問知識點） class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/b970816462884435bec0b1a8fc618b0b style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/17b21f70.html title=深入理解微服務架構spring的各個知識點（面試必問知識點）>深入理解微服務架構spring的各個知識點（面試必問知識點）</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/cec715b8.html alt=深入聊聊微服務架構的身份認證問題「轉」 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/f2dd2ce800384b23b0223080c34eea42 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/cec715b8.html title=深入聊聊微服務架構的身份認證問題「轉」>深入聊聊微服務架構的身份認證問題「轉」</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/b0936139.html alt=宜信微服務架構落地及其演進｜分享實錄 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/6a00c7615d33412187af0ad04d29d039 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/b0936139.html title=宜信微服務架構落地及其演進｜分享實錄>宜信微服務架構落地及其演進｜分享實錄</a></li><hr><li><a href=../../tw/%E7%A7%91%E5%AD%B8/3170684d.html alt=從架構的演進之路，一起聊聊微服務架構 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/4b93a47d192b42449ab8d6ef274f7bdd style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E5%AD%B8/3170684d.html title=從架構的演進之路，一起聊聊微服務架構>從架構的演進之路，一起聊聊微服務架構</a></li><hr><li><a href=../../tw/%E9%81%8A%E6%88%B2/aad105d.html alt=大型互聯網公司微服務架構的10個核心問題，你知道嗎？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=http://p1.pstatp.com/large/pgc-image/10bf03e0dfcb49b6b336ec03cd0ab77f style=border-radius:25px></a>
<a href=../../tw/%E9%81%8A%E6%88%B2/aad105d.html title=大型互聯網公司微服務架構的10個核心問題，你知道嗎？>大型互聯網公司微服務架構的10個核心問題，你知道嗎？</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>