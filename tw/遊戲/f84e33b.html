<!doctype html><html lang=tw><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><link rel=dns-prefetch href=https://i.geekbank.cf/><title>數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 | 极客快訊</title><meta property="og:title" content="數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 - 极客快訊"><meta property="og:type" content="article"><meta property="og:locale" content="tw"><meta property="og:image" content="http://p1.pstatp.com/large/pgc-image/7993832ba451469e9de4c8165b45cdfd"><link rel=alternate hreflang=x-default href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/f84e33b.html><link rel=alternate hreflang=zh-tw href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/f84e33b.html><link rel=alternate hreflang=zh-cn href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/f84e33b.html><link rel=alternate hreflang=zh-hk href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/f84e33b.html><link rel=alternate hreflang=zh-mo href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/f84e33b.html><link rel=alternate hreflang=zh-my href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/f84e33b.html><link rel=alternate hreflang=zh-sg href=https://geekbank.cf/cn/%e9%81%8a%e6%88%b2/f84e33b.html><link rel=canonical href=https://geekbank.cf/tw/%e9%81%8a%e6%88%b2/f84e33b.html><meta property="article:published_time" content="2020-10-29T20:48:05+08:00"><meta property="article:modified_time" content="2020-10-29T20:48:05+08:00"><meta name=Keywords content><meta name=description content="數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡"><meta name=author content="极客快訊"><meta property="og:url" content="/tw/%E9%81%8A%E6%88%B2/f84e33b.html"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=manifest href=../../site.webmanifest><link rel=mask-icon href=../../safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#ffc40d"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://geekbank.cf/css/normalize.css><link rel=stylesheet href=https://geekbank.cf/css/style.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script type=text/javascript src=https://geekbank.cf/js/jqthumb.min.js></script><script data-ad-client=ca-pub-3525055026201463 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href>🤓 极客快訊 Geek Bank</a></h1><p class=description>為你帶來最全的科技知識 🧡</p></div><div><nav id=nav-menu class=clearfix><a class=current href>猜你喜歡</a>
<a href=../../tw/categories/%E7%A7%91%E6%8A%80.html title=科技>科技</a>
<a href=../../tw/categories/%E9%81%8A%E6%88%B2.html title=遊戲>遊戲</a>
<a href=../../tw/categories/%E7%A7%91%E5%AD%B8.html title=科學>科學</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡</h1></header><date class="post-meta meta-date">2020-10-29</date><div class=post-meta><span>|</span>
<span class=meta-category><a href=tw/categories/%E9%81%8A%E6%88%B2.html>遊戲</a></span></div><div class=post-content><p>選自TowardsDataScience</p><p><strong>作者：Lianne & Justin</strong></p><p><strong>機器之心編譯</strong></p><p><strong>參與：魔王、杜偉</strong></p><p>要獲得優秀的模型，首先需要清洗數據。這是一篇如何在 Python 中執行數據清洗的分步指南。</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/7993832ba451469e9de4c8165b45cdfd><p class=pgc-img-caption></p></div><p>在擬合機器學習或統計模型之前，我們通常需要清洗數據。用雜亂數據訓練出的模型無法輸出有意義的結果。</p><p>數據清洗：從記錄集、表或數據庫中檢測和修正（或刪除）受損或不準確記錄的過程。它識別出數據中不完善、不準確或不相關的部分，並替換、修改或刪除這些髒亂的數據。</p><p>「數據清洗」光定義就這麼長，執行過程肯定既枯燥又耗時。</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/7a66b0038f8041c79a2a94849299e400><p class=pgc-img-caption></p></div><p>圖源：https://www.kdnuggets.com/2017/09/cartoon-machine-learning-class.html</p><p>為了將數據清洗簡單化，本文介紹了一種新型完備分步指南，支持在 Python 中執行數據清洗流程。讀者可以學習找出並清洗以下數據的方法：</p><p>缺失數據；</p><p>不規則數據（異常值）；</p><p>不必要數據：重複數據（repetitive data）、複製數據（duplicate data）等；</p><p>不一致數據：大寫、地址等；</p><p>該指南使用的數據集是 Kaggle 競賽 Sberbank 俄羅斯房地產價值預測競賽數據（該項目的目標是預測俄羅斯的房價波動）。本文並未使用全部數據，僅選取了其中的一部分樣本。</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/7114bf5b722f4938a5e52a7889fce108><p class=pgc-img-caption></p></div><p>本文兩位作者 Lianne & Justin。</p><p>在進入數據清洗流程之前，我們先來看一下數據概況。</p><p># import packagesimport pandas as pdimport numpy as npimport seaborn as sns</p><p>import matplotlib.pyplot as pltimport matplotlib.mlab as mlabimport matplotlibplt.style.use('ggplot')from matplotlib.pyplot import figure</p><p>%matplotlib inlinematplotlib.rcParams['figure.figsize'] = (12,8)</p><p>pd.options.mode.chained_assignment = None</p><p># read the datadf = pd.read_csv('sberbank.csv')</p><p># shape and data types of the dataprint(df.shape)print(df.dtypes)</p><p># select numeric columnsdf_numeric = df.select_dtypes(include=[np.number])numeric_cols = df_numeric.columns.valuesprint(numeric_cols)</p><p># select non numeric columnsdf_non_numeric = df.select_dtypes(exclude=[np.number])non_numeric_cols = df_non_numeric.columns.valuesprint(non_numeric_cols)</p><p>從以上結果中，我們可以看到該數據集共有 30,471 行、292 列，還可以辨別特徵屬於數值變量還是分類變量。這些都是有用的信息。</p><p>現在，我們可以瀏覽「髒」數據類型檢查清單，並一一攻破。</p><p>開始吧！</p><p><strong>缺失數據</strong></p><p>處理缺失數據/缺失值是數據清洗中最棘手也最常見的部分。很多模型可以與其他數據問題和平共處，但大多數模型無法接受缺失數據問題。</p><p><strong>如何找出缺失數據？</strong></p><p>本文將介紹三種方法，幫助大家更多地瞭解數據集中的缺失數據。</p><p>方法 1：缺失數據熱圖</p><p>當特徵數量較少時，我們可以通過熱圖對缺失數據進行可視化。</p><p>cols = df.columns[:30] # first 30 columnscolours = ['#000099', '#ffff00'] # specify the colours - yellow is missing. blue is not missing.sns.heatmap(df[cols].isnull(), cmap=sns.color_palette(colours))</p><p>下表展示了前 30 個特徵的缺失數據模式。橫軸表示特徵名，縱軸表示觀察值/行數，黃色表示缺失數據，藍色表示非缺失數據。</p><p>例如，下圖中特徵 life_sq 在多個行中存在缺失值。而特徵 floor 只在第 7000 行左右出現零星缺失值。</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p9.pstatp.com/large/pgc-image/0aed996682884dc384ad23c2b7167596><p class=pgc-img-caption></p></div><p>缺失數據熱圖</p><p>方法 2：缺失數據百分比列表</p><p>當數據集中存在很多特徵時，我們可以為每個特徵列出缺失數據的百分比。</p><p># if it's a larger dataset and the visualization takes too long can do this.# % of missing.for col in df.columns: pct_missing = np.mean(df[col].isnull()) print('{} - {}%'.format(col, round(pct_missing*100)))</p><p>得到如下列表，該表展示了每個特徵的缺失值百分比。</p><p>具體而言，我們可以從下表中看到特徵 life_sq 有 21% 的缺失數據，而特徵 floor 僅有 1% 的缺失數據。該列表有效地總結了每個特徵的缺失數據百分比情況，是對熱圖可視化的補充。</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/a6711d3025b14f268b2adb66b4c171b6><p class=pgc-img-caption></p></div><p>前 30 個特徵的缺失數據百分比列表</p><p>方法 3：缺失數據直方圖</p><p>在存在很多特徵時，缺失數據直方圖也不失為一種有效方法。</p><p>要想更深入地瞭解觀察值中的缺失值模式，我們可以用直方圖的形式進行可視化。</p><p># first create missing indicator for features with missing datafor col in df.columns: missing = df[col].isnull() num_missing = np.sum(missing)</p><p>if num_missing > 0: print('created missing indicator for: {}'.format(col)) df['{}_ismissing'.format(col)] = missing</p><p># then based on the indicator, plot the histogram of missing valuesismissing_cols = [col for col in df.columns if 'ismissing' in col]df['num_missing'] = df[ismissing_cols].sum(axis=1)</p><p>df['num_missing'].value_counts().reset_index().sort_values(by='index').plot.bar(x='index', y='num_missing')</p><p>直方圖可以幫助在 30,471 個觀察值中識別缺失值狀況。</p><p>例如，從下圖中可以看到，超過 6000 個觀察值不存在缺失值，接近 4000 個觀察值具備一個缺失值。</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/f9cadf895b7843ebbda4a071461037c8><p class=pgc-img-caption></p></div><p>缺失數據直方圖</p><p><strong>如何處理缺失數據？</strong></p><p>這方面沒有統一的解決方案。我們必須研究特定特徵和數據集，據此決定處理缺失數據的最佳方式。</p><p>下面介紹了四種最常用的缺失數據處理方法。不過，如果情況較為複雜，我們需要創造性地使用更復雜的方法，如缺失數據建模。</p><p>解決方案 1：丟棄觀察值</p><p>在統計學中，該方法叫做成列刪除（listwise deletion），需要丟棄包含缺失值的整列觀察值。</p><p>只有在我們確定缺失數據無法提供信息時，才可以執行該操作。否則，我們應當考慮其他解決方案。</p><p>此外，還存在其他標準。</p><p>例如，從缺失數據直方圖中，我們可以看到只有少量觀察值的缺失值數量超過 35。因此，我們可以創建一個新的數據集 df_less_missing_rows，該數據集刪除了缺失值數量超過 35 的觀察值。</p><p># drop rows with a lot of missing values.ind_missing = df[df['num_missing'] > 35].indexdf_less_missing_rows = df.drop(ind_missing, axis=0)</p><p>解決方案 2：丟棄特徵</p><p>與解決方案 1 類似，我們只在確定某個特徵無法提供有用信息時才丟棄它。</p><p>例如，從缺失數據百分比列表中，我們可以看到 hospital_beds_raion 具備較高的缺失值百分比——47%，因此我們丟棄這一整個特徵。</p><p># hospital_beds_raion has a lot of missing.# If we want to drop.cols_to_drop = ['hospital_beds_raion']df_less_hos_beds_raion = df.drop(cols_to_drop, axis=1)</p><p>解決方案 3：填充缺失數據</p><p>當特徵是數值變量時，執行缺失數據填充。對同一特徵的其他非缺失數據取平均值或中位數，用這個值來替換缺失值。</p><p>當特徵是分類變量時，用眾數（最頻值）來填充缺失值。</p><p>以特徵 life_sq 為例，我們可以用特徵中位數來替換缺失值。</p><p># replace missing values with the median.med = df['life_sq'].median()print(med)df['life_sq'] = df['life_sq'].fillna(med)</p><p>此外，我們還可以對所有數值特徵一次性應用同樣的填充策略。</p><p># impute the missing values and create the missing value indicator variables for each numeric column.df_numeric = df.select_dtypes(include=[np.number])numeric_cols = df_numeric.columns.values</p><p>for col in numeric_cols: missing = df[col].isnull() num_missing = np.sum(missing) if num_missing > 0: # only do the imputation for the columns that have missing values. print('imputing missing values for: {}'.format(col)) df['{}_ismissing'.format(col)] = missing med = df[col].median() df[col] = df[col].fillna(med)</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/2bbe9e51e00e4838b28b99dee2fbf6c5><p class=pgc-img-caption></p></div><p>很幸運，本文使用的數據集中的分類特徵沒有缺失值。不然，我們也可以對所有分類特徵一次性應用眾數填充策略。</p><p># impute the missing values and create the missing value indicator variables for each non-numeric column.df_non_numeric = df.select_dtypes(exclude=[np.number])non_numeric_cols = df_non_numeric.columns.values</p><p>for col in non_numeric_cols: missing = df[col].isnull() num_missing = np.sum(missing) if num_missing > 0: # only do the imputation for the columns that have missing values. print('imputing missing values for: {}'.format(col)) df['{}_ismissing'.format(col)] = missing top = df[col].describe()['top'] # impute with the most frequent value. df[col] = df[col].fillna(top)</p><p>解決方案 4：替換缺失值</p><p>對於分類特徵，我們可以添加新的帶值類別，如 _MISSING_。對於數值特徵，我們可以用特定值（如-999）來替換缺失值。</p><p>這樣，我們就可以保留缺失值，使之提供有價值的信息。</p><p># categoricaldf['sub_area'] = df['sub_area'].fillna('_MISSING_')</p><p># numericdf['life_sq'] = df['life_sq'].fillna(-999)</p><p><strong>不規則數據（異常值）</strong></p><p>異常值指與其他觀察值具備顯著差異的數據，它們可能是真的異常值也可能是錯誤。</p><p><strong>如何找出異常值？</strong></p><p>根據特徵的屬性（數值或分類），使用不同的方法來研究其分佈，進而檢測異常值。</p><p>方法 1：直方圖/箱形圖</p><p>當特徵是數值變量時，使用直方圖和箱形圖來檢測異常值。</p><p>下圖展示了特徵 life_sq 的直方圖。</p><p># histogram of life_sq.df['life_sq'].hist(bins=100)</p><p>由於數據中可能存在異常值，因此下圖中數據高度偏斜。</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/731ac81527a74318b689957a88d74a29><p class=pgc-img-caption></p></div><p>直方圖</p><p>為了進一步研究特徵，我們來看一下箱形圖。</p><p># box plot.df.boxplot(column=['life_sq'])</p><p>從下圖中我們可以看到，異常值是一個大於 7000 的數值。</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/8d1b23e747a947b99e8b261493d046f3><p class=pgc-img-caption></p></div><p>箱形圖</p><p>方法 2：描述統計學</p><p>對於數值特徵，當異常值過於獨特時，箱形圖無法顯示該值。因此，我們可以查看其描述統計學。</p><p>例如，對於特徵 life_sq，我們可以看到其最大值是 7478，而上四分位數（數據的第 75 個百分位數據）是 43。因此值 7478 是異常值。</p><p>df['life_sq'].describe()</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/b440975620cc42aa9294be6cb97ef64e><p class=pgc-img-caption></p></div><p>方法 3：條形圖</p><p>當特徵是分類變量時，我們可以使用條形圖來了解其類別和分佈。</p><p>例如，特徵 ecology 具備合理的分佈。但如果某個類別「other」僅有一個值，則它就是異常值。</p><p># bar chart -  distribution of a categorical variabledf['ecology'].value_counts().plot.bar()</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/82c3408261a342378eec9c9278741c71><p class=pgc-img-caption></p></div><p>條形圖</p><p>其他方法：還有很多方法可以找出異常值，如散點圖、z 分數和聚類，本文不過多探討全部方法。</p><p><strong>如何處理異常值？</strong></p><p>儘管異常值不難檢測，但我們必須選擇合適的處理辦法。而這高度依賴於數據集和項目目標。</p><p>處理異常值的方法與處理缺失值有些類似：要麼丟棄，要麼修改，要麼保留。（讀者可以返回上一章節處理缺失值的部分查看相關解決方案。）</p><p><strong>不必要數據</strong></p><p>處理完缺失數據和異常值，現在我們來看不必要數據，處理不必要數據的方法更加直接。</p><p>輸入到模型中的所有數據應服務於項目目標。不必要數據即無法增加價值的數據。</p><p>這裡將介紹三種主要的不必要數據類型。</p><p><strong>不必要數據類型 1：信息不足/重複</strong></p><p>有時一個特徵不提供信息，是因為它擁有太多具備相同值的行。</p><p>如何找出重複數據？</p><p>我們可以為具備高比例相同值的特徵創建一個列表。</p><p>例如，下圖展示了 95% 的行是相同值的特徵。</p><p>num_rows = len(df.index)low_information_cols = [] #</p><p>for col in df.columns: cnts = df[col].value_counts(dropna=False) top_pct = (cnts/num_rows).iloc[0] if top_pct > 0.95: low_information_cols.append(col) print('{0}: {1:.5f}%'.format(col, top_pct*100)) print(cnts) print()</p><p>我們可以逐一查看這些變量，確認它們是否提供有用信息。（此處不再詳述。）</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/9ca66c3c51e646a28b742145cfd916cb><p class=pgc-img-caption></p></div><p>如何處理重複數據？</p><p>我們需要了解重複特徵背後的原因。當它們的確無法提供有用信息時，我們就可以丟棄它。</p><p><strong>不必要數據類型 2：不相關</strong></p><p>再次強調，數據需要為項目提供有價值的信息。如果特徵與項目試圖解決的問題無關，則這些特徵是不相關數據。</p><p>如何找出不相關數據？</p><p>瀏覽特徵，找出不相關的數據。</p><p>例如，記錄多倫多氣溫的特徵無法為俄羅斯房價預測項目提供任何有用信息。</p><p>如何處理不相關數據？</p><p>當這些特徵無法服務於項目目標時，刪除之。</p><p><strong>不必要數據類型 3：複製</strong></p><p>複製數據即，觀察值存在副本。</p><p>複製數據有兩個主要類型。</p><p>複製數據類型 1：基於所有特徵</p><p>如何找出基於所有特徵的複製數據？</p><p>這種複製發生在觀察值內所有特徵的值均相同的情況下，很容易找出。</p><p>我們需要先刪除數據集中的唯一標識符 id，然後刪除複製數據得到數據集 df_dedupped。對比 df 和 df_dedupped 這兩個數據集的形態，找出複製行的數量。</p><p># we know that column 'id' is unique, but what if we drop it?df_dedupped = df.drop('id', axis=1).drop_duplicates()</p><p># there were duplicate rowsprint(df.shape)print(df_dedupped.shape)</p><p>我們發現，有 10 行是完全複製的觀察值。</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/5b2095e527c7436684bbd97b78e6c9cb><p class=pgc-img-caption></p></div><p>如何處理基於所有特徵的複製數據？</p><p>刪除這些複製數據。</p><p>複製數據類型 2：基於關鍵特徵</p><p>如何找出基於關鍵特徵的複製數據？</p><p>有時候，最好的方法是刪除基於一組唯一標識符的複製數據。</p><p>例如，相同使用面積、相同價格、相同建造年限的兩次房產交易同時發生的概率接近零。</p><p>我們可以設置一組關鍵特徵作為唯一標識符，比如 timestamp、full_sq、life_sq、floor、build_year、num_room、price_doc。然後基於這些特徵檢查是否存在複製數據。</p><p>key = ['timestamp', 'full_sq', 'life_sq', 'floor', 'build_year', 'num_room', 'price_doc']</p><p>df.fillna(-999).groupby(key)['id'].count().sort_values(ascending=False).head(20)</p><p>基於這組關鍵特徵，我們找到了 16 條複製數據。</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p9.pstatp.com/large/pgc-image/ab0b3579b9bb4c60bcd7da6f358998a3><p class=pgc-img-caption></p></div><p>如何處理基於關鍵特徵的複製數據？</p><p>刪除這些複製數據。</p><p># drop duplicates based on an subset of variables.</p><p>key = ['timestamp', 'full_sq', 'life_sq', 'floor', 'build_year', 'num_room', 'price_doc']df_dedupped2 = df.drop_duplicates(subset=key)</p><p>print(df.shape)print(df_dedupped2.shape)</p><p>刪除 16 條複製數據，得到新數據集 df_dedupped2。</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/b7853f8f9eaa44f180f4354f47a13b9f><p class=pgc-img-caption></p></div><p><strong>不一致數據</strong></p><p>在擬合模型時，數據集遵循特定標準也是很重要的一點。我們需要使用不同方式來探索數據，找出不一致數據。大部分情況下，這取決於觀察和經驗。不存在運行和修復不一致數據的既定代碼。</p><p>下文介紹了四種不一致數據類型。</p><p><strong>不一致數據類型 1：大寫</strong></p><p>在類別值中混用大小寫是一種常見的錯誤。這可能帶來一些問題，因為 Python 分析對大小寫很敏感。</p><p>如何找出大小寫不一致的數據？</p><p>我們來看特徵 sub_area。</p><p>df['sub_area'].value_counts(dropna=False)</p><p>它存儲了不同地區的名稱，看起來非常標準化。</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p9.pstatp.com/large/pgc-image/f96f210fd24f4682a1bbaee100168a88><p class=pgc-img-caption></p></div><p>但是，有時候相同特徵內存在不一致的大小寫使用情況。「Poselenie Sosenskoe」和「pOseleNie sosenskeo」指的是相同的地區。</p><p>如何處理大小寫不一致的數據？</p><p>為了避免這個問題，我們可以將所有字母設置為小寫（或大寫）。</p><p># make everything lower case.df['sub_area_lower'] = df['sub_area'].str.lower()df['sub_area_lower'].value_counts(dropna=False)</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/380c971f456c40f7b7f8383d77004ee9><p class=pgc-img-caption></p></div><p>不一致數據類型 2：格式</p><p>我們需要執行的另一個標準化是數據格式。比如將特徵從字符串格式轉換為 DateTime 格式。</p><p>如何找出格式不一致的數據？</p><p>特徵 timestamp 在表示日期時是字符串格式。</p><p>df</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/ca353a89116d4c529c9cb57a783af8dc><p class=pgc-img-caption></p></div><p>如何處理格式不一致的數據？</p><p>使用以下代碼進行格式轉換，並提取日期或時間值。然後，我們就可以很容易地用年或月的方式分析交易量數據。</p><p>df['timestamp_dt'] = pd.to_datetime(df['timestamp'], format='%Y-%m-%d')df['year'] = df['timestamp_dt'].dt.yeardf['month'] = df['timestamp_dt'].dt.monthdf['weekday'] = df['timestamp_dt'].dt.weekday</p><p>print(df['year'].value_counts(dropna=False))print()print(df['month'].value_counts(dropna=False))</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/e4a4d5bfe7514de2953d63376a2f26c5><p class=pgc-img-caption></p></div><p>相關文章：https://towardsdatascience.com/how-to-manipulate-date-and-time-in-python-like-a-boss-ddea677c6a4d</p><p><strong>不一致數據類型 3：類別值</strong></p><p>分類特徵的值數量有限。有時由於拼寫錯誤等原因可能出現其他值。</p><p>如何找出類別值不一致的數據？</p><p>我們需要觀察特徵來找出類別值不一致的情況。舉例來說：</p><p>由於本文使用的房地產數據集不存在這類問題，因此我們創建了一個新的數據集。例如，city 的值被錯誤輸入為「torontoo」和「tronto」，其實二者均表示「toronto」（正確值）。</p><p>識別它們的一種簡單方式是模糊邏輯（或編輯距離）。該方法可以衡量使一個值匹配另一個值需要更改的字母數量（距離）。</p><p>已知這些類別應僅有四個值：「toronto」、「vancouver」、「montreal」和「calgary」。計算所有值與單詞「toronto」（和「vancouver」）之間的距離，我們可以看到疑似拼寫錯誤的值與正確值之間的距離較小，因為它們只有幾個字母不同。</p><p>from nltk.metrics import edit_distance</p><p>df_city_ex = pd.DataFrame(data={'city': ['torontoo', 'toronto', 'tronto', 'vancouver', 'vancover', 'vancouvr', 'montreal', 'calgary']})</p><p>df_city_ex['city_distance_toronto'] = df_city_ex['city'].map(lambda x: edit_distance(x, 'toronto'))df_city_ex['city_distance_vancouver'] = df_city_ex['city'].map(lambda x: edit_distance(x, 'vancouver'))df_city_ex</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/2754678de8104cc8a5483e4bc9113940><p class=pgc-img-caption></p></div><p>如何處理類別值不一致的數據？</p><p>我們可以設置標準將這些拼寫錯誤轉換為正確值。例如，下列代碼規定所有值與「toronto」的距離在 2 個字母以內。</p><p>msk = df_city_ex['city_distance_toronto'] df_city_ex.loc[msk, 'city'] = 'toronto'</p><p>msk = df_city_ex['city_distance_vancouver'] df_city_ex.loc[msk, 'city'] = 'vancouver'</p><p>df_city_ex</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p3.pstatp.com/large/pgc-image/db37bb7c097d4c24b86e30c7a76ec2c6><p class=pgc-img-caption></p></div><p>不一致數據類型 4：地址</p><p>地址特徵對很多人來說是老大難問題。因為人們往數據庫中輸入數據時通常不會遵循標準格式。</p><p>如何找出地址不一致的數據？</p><p>用瀏覽的方式可以找出混亂的地址數據。即便有時我們看不出什麼問題，也可以運行代碼執行標準化。</p><p>出於隱私原因，本文采用的房地產數據集沒有地址列。因此我們創建具備地址特徵的新數據集 df_add_ex。</p><p># no address column in the housing dataset. So create one to show the code.df_add_ex = pd.DataFrame(['123 MAIN St Apartment 15', '123 Main Street Apt 12 ', '543 FirSt Av', ' 876 FIRst Ave.'], columns=['address'])df_add_ex</p><p>我們可以看到，地址特徵非常混亂。</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p9.pstatp.com/large/pgc-image/938b089fe752419da0a1284a7a194bf6><p class=pgc-img-caption></p></div><p>如何處理地址不一致的數據？</p><p>運行以下代碼將所有字母轉為小寫，刪除空格，刪除句號，並將措辭標準化。</p><p>df_add_ex['address_std'] = df_add_ex['address'].str.lower()df_add_ex['address_std'] = df_add_ex['address_std'].str.strip() # remove leading and trailing whitespace.df_add_ex['address_std'] = df_add_ex['address_std'].str.replace('\\.', '') # remove period.df_add_ex['address_std'] = df_add_ex['address_std'].str.replace('\\bstreet\\b', 'st') # replace street with st.df_add_ex['address_std'] = df_add_ex['address_std'].str.replace('\\bapartment\\b', 'apt') # replace apartment with apt.df_add_ex['address_std'] = df_add_ex['address_std'].str.replace('\\bav\\b', 'ave') # replace apartment with apt.</p><p>df_add_ex</p><p>現在看起來好多了：</p><div class=pgc-img><img alt=數據缺失、混亂、重複怎麼辦？最全數據清洗指南讓你所向披靡 onerror=errorimg.call(this); src=http://p1.pstatp.com/large/pgc-image/04cd47953d7e4e17b201b6dd61acbdd3><p class=pgc-img-caption></p></div><p>結束了！我們走過了長長的數據清洗旅程。</p><p>現在你可以運用本文介紹的方法清洗所有阻礙你擬合模型的「髒」數據了。</p><p>參考鏈接：https://towardsdatascience.com/data-cleaning-in-python-the-ultimate-guide-2020-c63b88bf0a0d</p></div><div class="post-meta meta-tags"><ul class=clearfix><li><a>數據</a></li><li><a>混亂</a></li><li><a>怎麼</a></li></ul></div></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=搜索>
<input type=hidden name=sitesearch value=geekbank.cf>
<button type=submit>🔍</button></form></section><section class=widget><h3 class=widget-title>最新文章 ⚡</h3><ul class=widget-list><li><a href=../../tw/%E7%A7%91%E6%8A%80/36515c07.html alt=銀行數據治理怎麼做，先了解一下元數據管理在銀行業務中的應用 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p9.pstatp.com/large/pgc-image/f2b258092a354b6b8bae575a426eb8ad style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/36515c07.html title=銀行數據治理怎麼做，先了解一下元數據管理在銀行業務中的應用>銀行數據治理怎麼做，先了解一下元數據管理在銀行業務中的應用</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/12c61a79.html alt=談談數據治理：怎麼做元數據管理？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/Rn3A19mCZUynPn style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/12c61a79.html title=談談數據治理：怎麼做元數據管理？>談談數據治理：怎麼做元數據管理？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/046dff6.html alt=誤格式化，刪除文件怎麼恢復？3款最好用的數據恢復軟件推薦 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/ba59abc098b3470b813877bdf1eabc8f style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/046dff6.html title=誤格式化，刪除文件怎麼恢復？3款最好用的數據恢復軟件推薦>誤格式化，刪除文件怎麼恢復？3款最好用的數據恢復軟件推薦</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/2146c4b1.html alt=露天樓梯雨棚怎麼做 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/R6XWzD87AaIs0W style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/2146c4b1.html title=露天樓梯雨棚怎麼做>露天樓梯雨棚怎麼做</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/3a2e003a.html alt=你是怎麼認識曼恩的？在老路說車互動平臺感受曼恩魅力 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/cc30aa4b32114cb7aa98314ba1519473 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/3a2e003a.html title=你是怎麼認識曼恩的？在老路說車互動平臺感受曼恩魅力>你是怎麼認識曼恩的？在老路說車互動平臺感受曼恩魅力</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/f24146de.html alt=怎麼租用服務器，哪種建站最好？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/dfic-imagehandler/52874987-e2c8-4404-99f4-38f53bad4aec style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/f24146de.html title=怎麼租用服務器，哪種建站最好？>怎麼租用服務器，哪種建站最好？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/6b4b1f22.html alt=無人機怎麼做測繪？手把手教你高精度地圖和數字線畫圖的具體操作 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/479ff6260a5545549cb39946a5cbbd91 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/6b4b1f22.html title=無人機怎麼做測繪？手把手教你高精度地圖和數字線畫圖的具體操作>無人機怎麼做測繪？手把手教你高精度地圖和數字線畫圖的具體操作</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/e0c52137.html alt=作文裡面怎麼進行場面描寫？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/dfic-imagehandler/230976bf-ee1d-44c0-8ce9-4a4714b8ad40 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/e0c52137.html title=作文裡面怎麼進行場面描寫？>作文裡面怎麼進行場面描寫？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/40568794.html alt=手機接收不到驗證碼怎麼辦？教你快速解決，學會以備不時之需 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/5edf6bf6494e4d2799657427beba8616 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/40568794.html title=手機接收不到驗證碼怎麼辦？教你快速解決，學會以備不時之需>手機接收不到驗證碼怎麼辦？教你快速解決，學會以備不時之需</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/ed39a73b.html alt=手機收不到短信怎麼回事 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/4c867ab694d54b19954e5777769cc540 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/ed39a73b.html title=手機收不到短信怎麼回事>手機收不到短信怎麼回事</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/7a0039e6.html alt=手機收不到短信驗證碼怎麼回事？ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/7cd7583238d44cfeb3be6147f9417125 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/7a0039e6.html title=手機收不到短信驗證碼怎麼回事？>手機收不到短信驗證碼怎麼回事？</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/b61d16fd.html alt=手機經常收不到消息是怎麼回事？看完你就知道怎麼是什麼原因了！ class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/53f300040692811299c9 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/b61d16fd.html title=手機經常收不到消息是怎麼回事？看完你就知道怎麼是什麼原因了！>手機經常收不到消息是怎麼回事？看完你就知道怎麼是什麼原因了！</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/c9f02601.html alt=教你怎麼計算光模塊和光纖跳線數量，學會這個方法，以後不求人 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p1.pstatp.com/large/pgc-image/1bb69fa9b57247babf32efd4a040a7f3 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/c9f02601.html title=教你怎麼計算光模塊和光纖跳線數量，學會這個方法，以後不求人>教你怎麼計算光模塊和光纖跳線數量，學會這個方法，以後不求人</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/135c11db.html alt=知道手機基站是怎麼安裝的嗎？工藝有哪些要求 class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/3dc892aae9c74d6a80d6579347b13473 style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/135c11db.html title=知道手機基站是怎麼安裝的嗎？工藝有哪些要求>知道手機基站是怎麼安裝的嗎？工藝有哪些要求</a></li><hr><li><a href=../../tw/%E7%A7%91%E6%8A%80/1d3b415c.html alt="招行掌上生活怎麼領取首刷禮技巧 領首刷禮條件流程" class="image featured" style=display:block;margin-left:auto;margin-right:auto;width:100%><img src=https://p3.pstatp.com/large/pgc-image/Rh68nYy2e9LgVS style=border-radius:25px></a>
<a href=../../tw/%E7%A7%91%E6%8A%80/1d3b415c.html title="招行掌上生活怎麼領取首刷禮技巧 領首刷禮條件流程">招行掌上生活怎麼領取首刷禮技巧 領首刷禮條件流程</a></li><hr></ul></section><section class=widget><h3 class=widget-title>其他</h3><ul class=widget-list><li><a href=TOS.html>使用條款</a></li><li><a href=CommentPolicy.html>留言政策</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>DMCA</a></li><li><a href=mailto:gdnews@tuta.io rel=nofollow>聯絡我們</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href>极客快訊</a></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src=https://kknews.cf/js/totop.js async></script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e508ed9e4e698bb"></script></body></html>